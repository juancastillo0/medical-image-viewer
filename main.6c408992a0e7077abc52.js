(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"/kWe":function(e,t){e.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH:16}},0:function(e,t,n){e.exports=n("zUnb")},"0I5M":function(e,t,n){var r,i=(r="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(r=r||__filename),function(e){var t,i=void 0!==(e=e||{})?e:{},a={};for(t in i)i.hasOwnProperty(t)&&(a[t]=i[t]);var o=[],s=function(e,t){throw t},l=!1,u=!1,c=!1,d=!1;l="object"==typeof window,u="function"==typeof importScripts,c="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,d=!l&&!c&&!u;var h,f,p,m,g="";function v(e){return i.locateFile?i.locateFile(e,g):g+e}c?(g=u?n(6).dirname(g)+"/":__dirname+"/",h=function(e,t){return p||(p=n(7)),m||(m=n(6)),e=m.normalize(e),p.readFileSync(e,t?null:"utf8")},f=function(e){var t=h(e,!0);return t.buffer||(t=new Uint8Array(t)),E(t.buffer),t},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),o=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof Te))throw e})),process.on("unhandledRejection",ne),s=function(e){process.exit(e)},i.inspect=function(){return"[Emscripten Module object]"}):d?("undefined"!=typeof read&&(h=function(e){return read(e)}),f=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(E("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?o=scriptArgs:void 0!==arguments&&(o=arguments),"function"==typeof quit&&(s=function(e){quit(e)}),"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(l||u)&&(u?g=self.location.href:document.currentScript&&(g=document.currentScript.src),r&&(g=r),g=0!==g.indexOf("blob:")?g.substr(0,g.lastIndexOf("/")+1):"",h=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},u&&(f=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}));var y,b,x,w=i.print||console.log.bind(console),_=i.printErr||console.warn.bind(console);for(t in a)a.hasOwnProperty(t)&&(i[t]=a[t]);a=null,i.arguments&&(o=i.arguments),i.quit&&(s=i.quit),i.wasmBinary&&(y=i.wasmBinary),i.noExitRuntime&&(b=i.noExitRuntime),"object"!=typeof WebAssembly&&_("no native wasm support detected"),new WebAssembly.Table({initial:149,maximum:149,element:"anyfunc"});var k=!1;function E(e,t){e||ne("Assertion failed: "+t)}function S(e){var t=i["_"+e];return E(t,"Cannot call unknown function "+e+", make sure it is exported"),t}function T(e,t,n,r,i){var a={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);F(e,t=Ee(n),n)}return t},array:function(e){var t=Ee(e.length);return R(e,t),t}},o=S(e),s=[],l=0;if(r)for(var u=0;u<r.length;u++){var c=a[n[u]];c?(0===l&&(l=ke()),s[u]=c(r[u])):s[u]=r[u]}var d=o.apply(null,s);return d=function(e){return"string"===t?N(e):"boolean"===t?Boolean(e):e}(d),0!==l&&Se(l),d}function C(e,t,n,r){var i=(n=n||[]).every((function(e){return"number"===e}));return"string"!==t&&i&&!r?S(e):function(){return T(e,t,n,arguments)}}var I,A,O,D="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function M(e,t,n){for(var r=t+n,i=t;e[i]&&!(i>=r);)++i;if(i-t>16&&e.subarray&&D)return D.decode(e.subarray(t,i));for(var a="";t<i;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var l=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|l:(7&o)<<18|s<<12|l<<6|63&e[t++])<65536)a+=String.fromCharCode(o);else{var u=o-65536;a+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else a+=String.fromCharCode((31&o)<<6|s)}else a+=String.fromCharCode(o)}return a}function N(e,t){return e?M(A,e,t):""}function j(e,t,n,r){if(!(r>0))return 0;for(var i=n,a=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(n>=a)break;t[n++]=s}else if(s<=2047){if(n+1>=a)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=a)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=a)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}return t[n]=0,n-i}function F(e,t,n){return j(e,A,t,n)}function R(e,t){I.set(e,t)}function P(e){i.HEAP8=I=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=O=new Int32Array(e),i.HEAPU8=A=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}function L(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?i.dynCall_v(n):i.dynCall_vi(n,t.arg):n(void 0===t.arg?null:t.arg)}else t(i)}}var B=[],$=[],z=[],U=[];function H(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)G(i.preRun.shift());L(B)}function W(){L($)}function V(){L(z)}function q(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)Y(i.postRun.shift());L(U)}function G(e){B.unshift(e)}function Y(e){U.unshift(e)}var X=Math.ceil,K=Math.floor,Z=0,J=null,Q=null;function ee(e){Z++,i.monitorRunDependencies&&i.monitorRunDependencies(Z)}function te(e){if(Z--,i.monitorRunDependencies&&i.monitorRunDependencies(Z),0==Z&&(null!==J&&(clearInterval(J),J=null),Q)){var t=Q;Q=null,t()}}function ne(e){throw i.onAbort&&i.onAbort(e),w(e+=""),_(e),k=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(e)}function re(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}i.preloadedImages={},i.preloadedAudios={};var ie="data:application/octet-stream;base64,";function ae(e){return re(e,ie)}var oe="file://";function se(e){return re(e,oe)}var le="tfjs-backend-wasm.wasm";function ue(){try{if(y)return new Uint8Array(y);if(f)return f(le);throw"both async and sync fetching of the wasm failed"}catch(_){ne(_)}}function ce(){return y||!l&&!u||"function"!=typeof fetch||se(le)?new Promise((function(e,t){e(ue())})):fetch(le,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+le+"'";return e.arrayBuffer()})).catch((function(){return ue()}))}function de(){var e={env:xe,wasi_snapshot_preview1:xe};function t(e,t){var n=e.exports;i.asm=n,P((x=n.memory).buffer),te()}function n(e){t(e.instance)}function r(t){return ce().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){_("failed to asynchronously prepare wasm: "+e),ne(e)}))}if(ee(),i.instantiateWasm)try{return i.instantiateWasm(e,t)}catch(a){return _("Module.instantiateWasm callback failed with error: "+a),!1}return function(){if(y||"function"!=typeof WebAssembly.instantiateStreaming||ae(le)||se(le)||"function"!=typeof fetch)return r(n);fetch(le,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){_("wasm streaming compile failed: "+e),_("falling back to ArrayBuffer instantiation"),r(n)}))}))}(),{}}function he(e){P(x.buffer)}ae(le)||(le=v(le)),$.push();var fe={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var n=fe.buffers[e];0===t||10===t?((1===e?w:_)(M(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function(){return fe.varargs+=4,O[fe.varargs-4>>2]},getStr:function(e){return N(e)},get64:function(e,t){return e}};function pe(e){return 0}function me(e,t,n,r,i){}function ge(e,t,n,r){for(var i=0,a=0;a<n;a++){for(var o=O[t+8*a>>2],s=O[t+(8*a+4)>>2],l=0;l<s;l++)fe.printChar(e,A[o+l]);i+=s}return O[r>>2]=i,0}function ve(e){Ae(e)}function ye(e){ve(e)}function be(e){return(e=+e)>=0?+K(e+.5):+X(e-.5)}var xe={emscripten_notify_memory_growth:he,fd_close:pe,fd_seek:me,fd_write:ge,proc_exit:ye,roundf:be},we=de();i.asm=we,i._init=function(){return(i._init=i.asm.init).apply(null,arguments)},i._register_tensor=function(){return(i._register_tensor=i.asm.register_tensor).apply(null,arguments)},i._dispose_data=function(){return(i._dispose_data=i.asm.dispose_data).apply(null,arguments)},i._dispose=function(){return(i._dispose=i.asm.dispose).apply(null,arguments)},i._Abs=function(){return(i._Abs=i.asm.Abs).apply(null,arguments)},i._Add=function(){return(i._Add=i.asm.Add).apply(null,arguments)},i._AddN=function(){return(i._AddN=i.asm.AddN).apply(null,arguments)},i._ArgMax=function(){return(i._ArgMax=i.asm.ArgMax).apply(null,arguments)},i._AvgPool=function(){return(i._AvgPool=i.asm.AvgPool).apply(null,arguments)},i._BatchMatMul=function(){return(i._BatchMatMul=i.asm.BatchMatMul).apply(null,arguments)},i._ClipByValue=function(){return(i._ClipByValue=i.asm.ClipByValue).apply(null,arguments)},i._Conv2D=function(){return(i._Conv2D=i.asm.Conv2D).apply(null,arguments)},i._Conv2DBackpropInput=function(){return(i._Conv2DBackpropInput=i.asm.Conv2DBackpropInput).apply(null,arguments)},i._Cos=function(){return(i._Cos=i.asm.Cos).apply(null,arguments)},i._CropAndResize=function(){return(i._CropAndResize=i.asm.CropAndResize).apply(null,arguments)},i._Cumsum=function(){return(i._Cumsum=i.asm.Cumsum).apply(null,arguments)},i._DepthToSpace=function(){return(i._DepthToSpace=i.asm.DepthToSpace).apply(null,arguments)},i._DepthwiseConv2dNative=function(){return(i._DepthwiseConv2dNative=i.asm.DepthwiseConv2dNative).apply(null,arguments)},i._Equal=function(){return(i._Equal=i.asm.Equal).apply(null,arguments)},i._Exp=function(){return(i._Exp=i.asm.Exp).apply(null,arguments)},i._FlipLeftRight=function(){return(i._FlipLeftRight=i.asm.FlipLeftRight).apply(null,arguments)},i._Floor=function(){return(i._Floor=i.asm.Floor).apply(null,arguments)},i._FloorDiv=function(){return(i._FloorDiv=i.asm.FloorDiv).apply(null,arguments)},i._FusedBatchNorm=function(){return(i._FusedBatchNorm=i.asm.FusedBatchNorm).apply(null,arguments)},i._FusedConv2D=function(){return(i._FusedConv2D=i.asm.FusedConv2D).apply(null,arguments)},i._FusedDepthwiseConv2D=function(){return(i._FusedDepthwiseConv2D=i.asm.FusedDepthwiseConv2D).apply(null,arguments)},i._Gather=function(){return(i._Gather=i.asm.Gather).apply(null,arguments)},i._GatherNd=function(){return(i._GatherNd=i.asm.GatherNd).apply(null,arguments)},i._Greater=function(){return(i._Greater=i.asm.Greater).apply(null,arguments)},i._GreaterEqual=function(){return(i._GreaterEqual=i.asm.GreaterEqual).apply(null,arguments)},i._LeakyRelu=function(){return(i._LeakyRelu=i.asm.LeakyRelu).apply(null,arguments)},i._Less=function(){return(i._Less=i.asm.Less).apply(null,arguments)},i._LessEqual=function(){return(i._LessEqual=i.asm.LessEqual).apply(null,arguments)},i._Log=function(){return(i._Log=i.asm.Log).apply(null,arguments)},i._LogicalAnd=function(){return(i._LogicalAnd=i.asm.LogicalAnd).apply(null,arguments)},i._Max=function(){return(i._Max=i.asm.Max).apply(null,arguments)},i._MaxPool=function(){return(i._MaxPool=i.asm.MaxPool).apply(null,arguments)},i._Maximum=function(){return(i._Maximum=i.asm.Maximum).apply(null,arguments)},i._Mean=function(){return(i._Mean=i.asm.Mean).apply(null,arguments)},i._Min=function(){return(i._Min=i.asm.Min).apply(null,arguments)},i._Minimum=function(){return(i._Minimum=i.asm.Minimum).apply(null,arguments)},i._Multiply=function(){return(i._Multiply=i.asm.Multiply).apply(null,arguments)},i._Neg=function(){return(i._Neg=i.asm.Neg).apply(null,arguments)},i._NonMaxSuppressionV3=function(){return(i._NonMaxSuppressionV3=i.asm.NonMaxSuppressionV3).apply(null,arguments)},i._NonMaxSuppressionV4=function(){return(i._NonMaxSuppressionV4=i.asm.NonMaxSuppressionV4).apply(null,arguments)},i._NonMaxSuppressionV5=function(){return(i._NonMaxSuppressionV5=i.asm.NonMaxSuppressionV5).apply(null,arguments)},i._NotEqual=function(){return(i._NotEqual=i.asm.NotEqual).apply(null,arguments)},i._OneHot=function(){return(i._OneHot=i.asm.OneHot).apply(null,arguments)},i._PadV2=function(){return(i._PadV2=i.asm.PadV2).apply(null,arguments)},i._Pow=function(){return(i._Pow=i.asm.Pow).apply(null,arguments)},i._Prelu=function(){return(i._Prelu=i.asm.Prelu).apply(null,arguments)},i._Prod=function(){return(i._Prod=i.asm.Prod).apply(null,arguments)},i._RealDiv=function(){return(i._RealDiv=i.asm.RealDiv).apply(null,arguments)},i._Relu=function(){return(i._Relu=i.asm.Relu).apply(null,arguments)},i._Relu6=function(){return(i._Relu6=i.asm.Relu6).apply(null,arguments)},i._ResizeBilinear=function(){return(i._ResizeBilinear=i.asm.ResizeBilinear).apply(null,arguments)},i._Reverse=function(){return(i._Reverse=i.asm.Reverse).apply(null,arguments)},i._RotateWithOffset=function(){return(i._RotateWithOffset=i.asm.RotateWithOffset).apply(null,arguments)},i._Rsqrt=function(){return(i._Rsqrt=i.asm.Rsqrt).apply(null,arguments)},i._ScatterNd=function(){return(i._ScatterNd=i.asm.ScatterNd).apply(null,arguments)},i._SelectV2=function(){return(i._SelectV2=i.asm.SelectV2).apply(null,arguments)},i._Sigmoid=function(){return(i._Sigmoid=i.asm.Sigmoid).apply(null,arguments)},i._Sin=function(){return(i._Sin=i.asm.Sin).apply(null,arguments)},i._Softmax=function(){return(i._Softmax=i.asm.Softmax).apply(null,arguments)},i._Sqrt=function(){return(i._Sqrt=i.asm.Sqrt).apply(null,arguments)},i._Square=function(){return(i._Square=i.asm.Square).apply(null,arguments)},i._SquaredDifference=function(){return(i._SquaredDifference=i.asm.SquaredDifference).apply(null,arguments)},i._StridedSlice=function(){return(i._StridedSlice=i.asm.StridedSlice).apply(null,arguments)},i._Sub=function(){return(i._Sub=i.asm.Sub).apply(null,arguments)},i._Sum=function(){return(i._Sum=i.asm.Sum).apply(null,arguments)},i._Tanh=function(){return(i._Tanh=i.asm.Tanh).apply(null,arguments)},i._Tile=function(){return(i._Tile=i.asm.Tile).apply(null,arguments)},i._TopK=function(){return(i._TopK=i.asm.TopK).apply(null,arguments)},i._Transpose=function(){return(i._Transpose=i.asm.Transpose).apply(null,arguments)},i.__FusedMatMul=function(){return(i.__FusedMatMul=i.asm._FusedMatMul).apply(null,arguments)},i._malloc=function(){return(i._malloc=i.asm.malloc).apply(null,arguments)},i._free=function(){return(i._free=i.asm.free).apply(null,arguments)},i.__start=function(){return(i.__start=i.asm._start).apply(null,arguments)};var _e,ke=i.stackSave=function(){return(ke=i.stackSave=i.asm.stackSave).apply(null,arguments)},Ee=i.stackAlloc=function(){return(Ee=i.stackAlloc=i.asm.stackAlloc).apply(null,arguments)},Se=i.stackRestore=function(){return(Se=i.stackRestore=i.asm.stackRestore).apply(null,arguments)};function Te(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function Ce(e){var t=i.__start;try{t(),Ae(0,!0)}catch(r){if(r instanceof Te)return;if("unwind"==r)return void(b=!0);var n=r;r&&"object"==typeof r&&r.stack&&(n=[r,r.stack]),_("exception thrown: "+n),s(1,r)}}function Ie(e){function t(){_e||(_e=!0,i.calledRun=!0,k||(W(),V(),i.onRuntimeInitialized&&i.onRuntimeInitialized(),Oe&&Ce(),q()))}e=e||o,Z>0||(H(),Z>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t()))}function Ae(e,t){t&&b&&0===e||(b||(k=!0,i.onExit&&i.onExit(e)),s(e,new Te(e)))}if(i.asm=we,i.cwrap=C,i.then=function(e){if(_e)e(i);else{var t=i.onRuntimeInitialized;i.onRuntimeInitialized=function(){t&&t(),e(i)}}return i},Q=function e(){_e||Ie(),_e||(Q=e)},i.run=Ie,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();var Oe=!0;return i.noInitialRun&&(Oe=!1),b=!0,Ie(),e});e.exports=i},"0eLh":function(e,t,n){const r=n("3wIk"),i=n("vwDW"),{ANY:a}=i,o=n("ex/Z"),s=n("MpxT"),l=n("7sNm"),u=n("JCZO"),c=n("bdwG"),d=n("Dknc");e.exports=(e,t,n,h)=>{let f,p,m,g,v;switch(e=new r(e,h),t=new o(t,h),n){case">":f=l,p=c,m=u,g=">",v=">=";break;case"<":f=u,p=d,m=l,g="<",v="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(e,t,h))return!1;for(let r=0;r<t.set.length;++r){let n=null,o=null;if(t.set[r].forEach(e=>{e.semver===a&&(e=new i(">=0.0.0")),n=n||e,o=o||e,f(e.semver,n.semver,h)?n=e:m(e.semver,o.semver,h)&&(o=e)}),n.operator===g||n.operator===v)return!1;if((!o.operator||o.operator===g)&&p(e,o.semver))return!1;if(o.operator===v&&m(e,o.semver))return!1}return!0}},1:function(e,t){},"18Y9":function(e,t,n){const r=n("ex/Z");e.exports=(e,t,n)=>(e=new r(e,n),t=new r(t,n),e.intersects(t))},2:function(e,t){},"23LK":function(e,t,n){window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.external=void 0;var r,i=(r=n(4))&&r.__esModule?r:{default:r},a=void 0;t.external={set cornerstone(e){(0,i.default)(a=e)},get cornerstone(){return a}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadImage=function(e){var t=r.external.cornerstone,n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",s.beforeSend(n),n.onprogress=function(n){if(n.lengthComputable){var r=n.loaded,i=n.total,a=Math.round(r/i*100);t.triggerEvent(t.events,"cornerstoneimageloadprogress",{imageId:e,loaded:r,total:i,percentComplete:a})}},{promise:new Promise((function(t,r){n.onload=function(){(0,i.default)(this.response).then((function(n){var r=(0,a.default)(n,e);t(r)}),r)},n.send()})),cancelFn:function(){n.abort()}}},t.configure=function(e){s=e};var r=n(0),i=o(n(3)),a=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}var s={beforeSend:function(){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.naturalHeight,o=e.naturalWidth;return{imageId:t,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:128,windowWidth:255,render:r.external.cornerstone.renderWebImage,getPixelData:function(){return(n=void 0,a===t?n=i.getContext("2d"):(i.height=e.naturalHeight,i.width=e.naturalWidth,(n=i.getContext("2d")).drawImage(e,0,0),a=t),n.getImageData(0,0,e.naturalWidth,e.naturalHeight)).data;var n},getCanvas:function(){return a===t||(i.height=e.naturalHeight,i.width=e.naturalWidth,i.getContext("2d").drawImage(e,0,0),a=t),i},getImage:function(){return e},rows:n,columns:o,height:n,width:o,color:!0,rgba:!1,columnPixelSpacing:void 0,rowPixelSpacing:void 0,invert:!1,sizeInBytes:n*o*4}};var r=n(0),i=document.createElement("canvas"),a=void 0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return new Promise((function(t,n){var r=new Image,i=new Uint8Array(e),a=new Blob([i]),o=window.URL||window.webkitURL,s=o.createObjectURL(a);r.src=s,r.onload=function(){t(r),o.revokeObjectURL(s)},r.onerror=function(e){o.revokeObjectURL(s),n(e)}}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.registerImageLoader("http",r.loadImage),e.registerImageLoader("https",r.loadImage)};var r=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.external=t.configure=t.loadImage=t.createImage=t.arrayBufferToImage=void 0;var r=s(n(3)),i=s(n(2)),a=n(1),o=n(0);function s(e){return e&&e.__esModule?e:{default:e}}var l={arrayBufferToImage:r.default,createImage:i.default,loadImage:a.loadImage,configure:a.configure,external:o.external};t.arrayBufferToImage=r.default,t.createImage=i.default,t.loadImage=a.loadImage,t.configure=a.configure,t.external=o.external,t.default=l}])},"27OZ":function(e,t,n){const r=n("iEBQ");e.exports=(e,t)=>e.sort((e,n)=>r(n,e,t))},"2wtF":function(e,t,n){const r=n("0eLh");e.exports=(e,t,n)=>r(e,t,"<",n)},3:function(e,t){},"3cPs":function(e,t,n){const r=n("IsDc");e.exports={re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:n("/kWe").SEMVER_SPEC_VERSION,SemVer:n("3wIk"),compareIdentifiers:n("KHQI").compareIdentifiers,rcompareIdentifiers:n("KHQI").rcompareIdentifiers,parse:n("Ybu3"),valid:n("gqzR"),clean:n("oBeb"),inc:n("eQf7"),diff:n("Yn5A"),major:n("Br5v"),minor:n("YJ14"),patch:n("LJ9E"),prerelease:n("O9TA"),compare:n("8GxW"),rcompare:n("oh0K"),compareLoose:n("8YLp"),compareBuild:n("iEBQ"),sort:n("lYj8"),rsort:n("27OZ"),gt:n("7sNm"),lt:n("JCZO"),eq:n("xfvg"),neq:n("dtu/"),gte:n("Dknc"),lte:n("bdwG"),cmp:n("VMJL"),coerce:n("eXNJ"),Comparator:n("vwDW"),Range:n("ex/Z"),satisfies:n("MpxT"),toComparators:n("j0pM"),maxSatisfying:n("d43V"),minSatisfying:n("ygsx"),minVersion:n("lkeM"),validRange:n("zv5s"),outside:n("0eLh"),gtr:n("VmpX"),ltr:n("2wtF"),intersects:n("18Y9"),simplifyRange:n("v6YA"),subset:n("I9dd")}},"3wIk":function(e,t,n){const r=n("DXxi"),{MAX_LENGTH:i,MAX_SAFE_INTEGER:a}=n("/kWe"),{re:o,t:s}=n("IsDc"),l=n("4S+G"),{compareIdentifiers:u}=n("KHQI");class c{constructor(e,t){if(t=l(t),e instanceof c){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>i)throw new TypeError(`version is longer than ${i} characters`);r("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?o[s.LOOSE]:o[s.FULL]);if(!n)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>a||this.major<0)throw new TypeError("Invalid major version");if(this.minor>a||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>a||this.patch<0)throw new TypeError("Invalid patch version");this.prerelease=n[4]?n[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<a)return t}return e}):[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version}toString(){return this.version}compare(e){if(r("SemVer.compare",this.version,this.options,e),!(e instanceof c)){if("string"==typeof e&&e===this.version)return 0;e=new c(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof c||(e=new c(e,this.options)),u(this.major,e.major)||u(this.minor,e.minor)||u(this.patch,e.patch)}comparePre(e){if(e instanceof c||(e=new c(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],i=e.prerelease[t];if(r("prerelease compare",t,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return u(n,i)}while(++t)}compareBuild(e){e instanceof c||(e=new c(e,this.options));let t=0;do{const n=this.build[t],i=e.build[t];if(r("prerelease compare",t,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return u(n,i)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this}}e.exports=c},4:function(e,t){},"4S+G":function(e,t){const n=["includePrerelease","loose","rtl"];e.exports=e=>e?"object"!=typeof e?{loose:!0}:n.filter(t=>e[t]).reduce((e,t)=>(e[t]=!0,e),{}):{}},5:function(e,t){},"5q2q":function(e,t,n){var r;window,r=function(){return function(e){var t=window.webpackHotUpdate;window.webpackHotUpdate=function(e,n){!function(e,t){if(x[e]&&b[e]){for(var n in b[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(p[n]=t[n]);0==--g&&0===v&&E()}}(e,n),t&&t(e,n)};var n,r=!0,i="27483cfdfb7fceb94238",a={},o=[],s=[];function l(e){var t=T[e];if(!t)return C;var r=function(r){return t.hot.active?(T[r]?-1===T[r].parents.indexOf(e)&&T[r].parents.push(e):(o=[e],n=r),-1===t.children.indexOf(r)&&t.children.push(r)):(console.warn("[HMR] unexpected require("+r+") from disposed module "+e),o=[]),C(r)},i=function(e){return{configurable:!0,enumerable:!0,get:function(){return C[e]},set:function(t){C[e]=t}}};for(var a in C)Object.prototype.hasOwnProperty.call(C,a)&&"e"!==a&&"t"!==a&&Object.defineProperty(r,a,i(a));return r.e=function(e){return"ready"===d&&h("prepare"),v++,C.e(e).then(t,(function(e){throw t(),e}));function t(){v--,"prepare"===d&&(y[e]||k(e),0===v&&0===g&&E())}},r.t=function(e,t){return 1&t&&(e=r(e)),C.t(e,-2&t)},r}function u(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:n!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var r=0;r<e.length;r++)t._acceptedDependencies[e[r]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:_,apply:S,status:function(e){if(!e)return d;c.push(e)},addStatusHandler:function(e){c.push(e)},removeStatusHandler:function(e){var t=c.indexOf(e);t>=0&&c.splice(t,1)},data:a[e]};return n=void 0,t}var c=[],d="idle";function h(e){d=e;for(var t=0;t<c.length;t++)c[t].call(null,e)}var f,p,m,g=0,v=0,y={},b={},x={};function w(e){return+e+""===e?+e:e}function _(e){if("idle"!==d)throw new Error("check() is only allowed in idle status");return r=e,h("check"),(t=1e4,t=t||1e4,new Promise((function(e,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var r=new XMLHttpRequest,a=C.p+""+i+".hot-update.json";r.open("GET",a,!0),r.timeout=t,r.send(null)}catch(o){return n(o)}r.onreadystatechange=function(){if(4===r.readyState)if(0===r.status)n(new Error("Manifest request to "+a+" timed out."));else if(404===r.status)e();else if(200!==r.status&&304!==r.status)n(new Error("Manifest request to "+a+" failed."));else{try{var t=JSON.parse(r.responseText)}catch(i){return void n(i)}e(t)}}}))).then((function(e){if(!e)return h("idle"),null;b={},y={},x=e.c,m=e.h,h("prepare");var t=new Promise((function(e,t){f={resolve:e,reject:t}}));return p={},k("cornerstoneTools"),"prepare"===d&&0===v&&0===g&&E(),t}));var t}function k(e){x[e]?(b[e]=!0,g++,function(e){var t=document.createElement("script");t.charset="utf-8",t.src=C.p+""+e+"."+i+".hot-update.js",document.head.appendChild(t)}(e)):y[e]=!0}function E(){h("ready");var e=f;if(f=null,e)if(r)Promise.resolve().then((function(){return S(r)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var n in p)Object.prototype.hasOwnProperty.call(p,n)&&t.push(w(n));e.resolve(t)}}function S(t){if("ready"!==d)throw new Error("apply() is only allowed in ready status");var n,r,s,l,u;function c(e){for(var t=[e],n={},r=t.map((function(e){return{chain:[e],id:e}}));r.length>0;){var i=r.pop(),a=i.id,o=i.chain;if((l=T[a])&&!l.hot._selfAccepted){if(l.hot._selfDeclined)return{type:"self-declined",chain:o,moduleId:a};if(l.hot._main)return{type:"unaccepted",chain:o,moduleId:a};for(var s=0;s<l.parents.length;s++){var u=l.parents[s],c=T[u];if(c){if(c.hot._declinedDependencies[a])return{type:"declined",chain:o.concat([u]),moduleId:a,parentId:u};-1===t.indexOf(u)&&(c.hot._acceptedDependencies[a]?(n[u]||(n[u]=[]),f(n[u],[a])):(delete n[u],t.push(u),r.push({chain:o.concat([u]),id:u})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];-1===e.indexOf(r)&&e.push(r)}}t=t||{};var g={},v=[],y={},b=function(){console.warn("[HMR] unexpected require("+k.moduleId+") to disposed module")};for(var _ in p)if(Object.prototype.hasOwnProperty.call(p,_)){var k;u=w(_);var E=!1,S=!1,I=!1,A="";switch((k=p[_]?c(u):{type:"disposed",moduleId:_}).chain&&(A="\nUpdate propagation: "+k.chain.join(" -> ")),k.type){case"self-declined":t.onDeclined&&t.onDeclined(k),t.ignoreDeclined||(E=new Error("Aborted because of self decline: "+k.moduleId+A));break;case"declined":t.onDeclined&&t.onDeclined(k),t.ignoreDeclined||(E=new Error("Aborted because of declined dependency: "+k.moduleId+" in "+k.parentId+A));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(k),t.ignoreUnaccepted||(E=new Error("Aborted because "+u+" is not accepted"+A));break;case"accepted":t.onAccepted&&t.onAccepted(k),S=!0;break;case"disposed":t.onDisposed&&t.onDisposed(k),I=!0;break;default:throw new Error("Unexception type "+k.type)}if(E)return h("abort"),Promise.reject(E);if(S)for(u in y[u]=p[u],f(v,k.outdatedModules),k.outdatedDependencies)Object.prototype.hasOwnProperty.call(k.outdatedDependencies,u)&&(g[u]||(g[u]=[]),f(g[u],k.outdatedDependencies[u]));I&&(f(v,[k.moduleId]),y[u]=b)}var O,D=[];for(r=0;r<v.length;r++)T[u=v[r]]&&T[u].hot._selfAccepted&&y[u]!==b&&D.push({module:u,errorHandler:T[u].hot._selfAccepted});h("dispose"),Object.keys(x).forEach((function(e){!1===x[e]&&function(e){delete installedChunks[e]}(e)}));for(var M,N=v.slice();N.length>0;)if(u=N.pop(),l=T[u]){var j={},F=l.hot._disposeHandlers;for(s=0;s<F.length;s++)(n=F[s])(j);for(a[u]=j,l.hot.active=!1,delete T[u],delete g[u],s=0;s<l.children.length;s++){var R=T[l.children[s]];R&&(O=R.parents.indexOf(u))>=0&&R.parents.splice(O,1)}}for(u in g)if(Object.prototype.hasOwnProperty.call(g,u)&&(l=T[u]))for(M=g[u],s=0;s<M.length;s++)(O=l.children.indexOf(M[s]))>=0&&l.children.splice(O,1);for(u in h("apply"),i=m,y)Object.prototype.hasOwnProperty.call(y,u)&&(e[u]=y[u]);var P=null;for(u in g)if(Object.prototype.hasOwnProperty.call(g,u)&&(l=T[u])){M=g[u];var L=[];for(r=0;r<M.length;r++)if(n=l.hot._acceptedDependencies[M[r]]){if(-1!==L.indexOf(n))continue;L.push(n)}for(r=0;r<L.length;r++){n=L[r];try{n(M)}catch($){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:u,dependencyId:M[r],error:$}),t.ignoreErrored||P||(P=$)}}}for(r=0;r<D.length;r++){var B=D[r];o=[u=B.module];try{C(u)}catch($){if("function"==typeof B.errorHandler)try{B.errorHandler($)}catch(z){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:u,error:z,originalError:$}),t.ignoreErrored||P||(P=z),P||(P=$)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:u,error:$}),t.ignoreErrored||P||(P=$)}}return P?(h("fail"),Promise.reject(P)):(h("idle"),new Promise((function(e){e(v)})))}var T={};function C(t){if(T[t])return T[t].exports;var n=T[t]={i:t,l:!1,exports:{},hot:u(t),parents:(s=o,o=[],s),children:[]};return e[t].call(n.exports,n,n.exports,l(t)),n.l=!0,n.exports}return C.m=e,C.c=T,C.d=function(e,t,n){C.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},C.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},C.t=function(e,t){if(1&t&&(e=C(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(C.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)C.d(n,r,(function(t){return e[t]}).bind(null,r));return n},C.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return C.d(t,"a",t),t},C.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},C.p="",C.h=function(){return i},l("./index.js")(C.s="./index.js")}({"../node_modules/@babel/runtime/helpers/arrayWithHoles.js":function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},"../node_modules/@babel/runtime/helpers/arrayWithoutHoles.js":function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},"../node_modules/@babel/runtime/helpers/assertThisInitialized.js":function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},"../node_modules/@babel/runtime/helpers/asyncToGenerator.js":function(e,t){function n(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(u){return void n(u)}s.done?t(l):Promise.resolve(l).then(r,i)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(i,a){var o=e.apply(t,r);function s(e){n(o,i,a,s,l,"next",e)}function l(e){n(o,i,a,s,l,"throw",e)}s(void 0)}))}}},"../node_modules/@babel/runtime/helpers/classCallCheck.js":function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},"../node_modules/@babel/runtime/helpers/createClass.js":function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},"../node_modules/@babel/runtime/helpers/defineProperty.js":function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},"../node_modules/@babel/runtime/helpers/getPrototypeOf.js":function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},"../node_modules/@babel/runtime/helpers/inherits.js":function(e,t,n){var r=n("../node_modules/@babel/runtime/helpers/setPrototypeOf.js");e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},"../node_modules/@babel/runtime/helpers/iterableToArray.js":function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},"../node_modules/@babel/runtime/helpers/iterableToArrayLimit.js":function(e,t){e.exports=function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(l){i=!0,a=l}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}},"../node_modules/@babel/runtime/helpers/nonIterableRest.js":function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},"../node_modules/@babel/runtime/helpers/nonIterableSpread.js":function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},"../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js":function(e,t,n){var r=n("../node_modules/@babel/runtime/helpers/typeof.js"),i=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js");e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?i(e):t}},"../node_modules/@babel/runtime/helpers/setPrototypeOf.js":function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},"../node_modules/@babel/runtime/helpers/slicedToArray.js":function(e,t,n){var r=n("../node_modules/@babel/runtime/helpers/arrayWithHoles.js"),i=n("../node_modules/@babel/runtime/helpers/iterableToArrayLimit.js"),a=n("../node_modules/@babel/runtime/helpers/nonIterableRest.js");e.exports=function(e,t){return r(e)||i(e,t)||a()}},"../node_modules/@babel/runtime/helpers/toConsumableArray.js":function(e,t,n){var r=n("../node_modules/@babel/runtime/helpers/arrayWithoutHoles.js"),i=n("../node_modules/@babel/runtime/helpers/iterableToArray.js"),a=n("../node_modules/@babel/runtime/helpers/nonIterableSpread.js");e.exports=function(e){return r(e)||i(e)||a()}},"../node_modules/@babel/runtime/helpers/typeof.js":function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return e.exports=r="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(e){return n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},"../node_modules/@babel/runtime/regenerator/index.js":function(e,t,n){e.exports=n("../node_modules/regenerator-runtime/runtime-module.js")},"../node_modules/ms/index.js":function(e,t){var n=1e3,r=60*n,i=60*r,a=24*i;function o(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,t){t=t||{};var s,l,u=typeof e;if("string"===u&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^((?:\d+)?\-?\d?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var o=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*a;case"hours":case"hour":case"hrs":case"hr":case"h":return o*i;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===u&&!1===isNaN(e))return t.long?(s=e,(l=Math.abs(s))>=a?o(s,l,a,"day"):l>=i?o(s,l,i,"hour"):l>=r?o(s,l,r,"minute"):l>=n?o(s,l,n,"second"):s+" ms"):function(e){var t=Math.abs(e);return t>=a?Math.round(e/a)+"d":t>=i?Math.round(e/i)+"h":t>=r?Math.round(e/r)+"m":t>=n?Math.round(e/n)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},"../node_modules/process/browser.js":function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var l,u=[],c=!1,d=-1;function h(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length&&f())}function f(){if(!c){var e=s(h);c=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||c||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},"../node_modules/regenerator-runtime/runtime-module.js":function(e,t,n){var r=function(){return this||"object"==typeof self&&self}()||Function("return this")(),i=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,a=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n("../node_modules/regenerator-runtime/runtime.js"),i)r.regeneratorRuntime=a;else try{delete r.regeneratorRuntime}catch(o){r.regeneratorRuntime=void 0}},"../node_modules/regenerator-runtime/runtime.js":function(e,t){!function(t){"use strict";var n,r=Object.prototype,i=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag",u="object"==typeof e,c=t.regeneratorRuntime;if(c)u&&(e.exports=c);else{(c=t.regeneratorRuntime=u?e.exports:{}).wrap=x;var d="suspendedStart",h="suspendedYield",f="executing",p="completed",m={},g={};g[o]=function(){return this};var v=Object.getPrototypeOf,y=v&&v(v(D([])));y&&y!==r&&i.call(y,o)&&(g=y);var b=E.prototype=_.prototype=Object.create(g);k.prototype=b.constructor=E,E.constructor=k,E[l]=k.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===k||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,l in e||(e[l]="GeneratorFunction")),e.prototype=Object.create(b),e},c.awrap=function(e){return{__await:e}},S(T.prototype),T.prototype[s]=function(){return this},c.AsyncIterator=T,c.async=function(e,t,n,r){var i=new T(x(e,t,n,r));return c.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(b),b[l]="Generator",b[o]=function(){return this},b.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},c.values=D,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(A),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return s.type="throw",s.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),u=i.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:D(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),m}}}function x(e,t,n,r){var i=Object.create((t&&t.prototype instanceof _?t:_).prototype),a=new O(r||[]);return i._invoke=function(e,t,n){var r=d;return function(i,a){if(r===f)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw a;return M()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=C(o,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var l=w(e,t,n);if("normal"===l.type){if(r=n.done?p:h,l.arg===m)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=p,n.method="throw",n.arg=l.arg)}}}(e,n,a),i}function w(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}function _(){}function k(){}function E(){}function S(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function T(e){var t;this._invoke=function(n,r){function a(){return new Promise((function(t,a){!function t(n,r,a,o){var s=w(e[n],e,r);if("throw"!==s.type){var l=s.arg,u=l.value;return u&&"object"==typeof u&&i.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,a,o)}),(function(e){t("throw",e,a,o)})):Promise.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return t("throw",e,a,o)}))}o(s.arg)}(n,r,t,a)}))}return t=t?t.then(a,a):a()}}function C(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,C(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=w(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,m;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,m):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function D(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return a.next=a}}return{next:M}}function M(){return{value:n,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},"./drawing/draw.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){e.save(),t(e),e.restore()}},"./drawing/drawArrow.js":function(e,t,n){"use strict";n.r(t);var r=n("./drawing/drawLine.js"),i=n("./drawing/drawJoinedLines.js");t.default=function(e,t,n,a,o,s){var l=Math.atan2(n.y-t.y,n.x-t.x),u={color:a,lineWidth:o};s&&(u.lineDash=s),Object(r.default)(e,void 0,t,n,u,"canvas"),u={color:a,lineWidth:o,fillStyle:a};var c=[{x:n.x-10*Math.cos(l-Math.PI/7),y:n.y-10*Math.sin(l-Math.PI/7)},{x:n.x-10*Math.cos(l+Math.PI/7),y:n.y-10*Math.sin(l+Math.PI/7)},n];Object(i.default)(e,void 0,n,c,u,"canvas")}},"./drawing/drawCircle.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./drawing/path.js");t.default=function(e,t,n,a,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";"pixel"===s&&(n=r.default.cornerstone.pixelToCanvas(t,n)),Object(i.default)(e,o,(function(e){e.arc(n.x,n.y,a,0,2*Math.PI)}))}},"./drawing/drawEllipse.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./drawing/path.js"),a=n("./util/pointProjector.js");t.default=function(e,t,n,o,s){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel",u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;"pixel"===l&&(n=r.default.cornerstone.pixelToCanvas(t,n),o=r.default.cornerstone.pixelToCanvas(t,o));var c=r.default.cornerstone.getViewport(t),d=t.clientWidth,h=t.clientHeight,f=c.scale,p=c.translation,m=c.rotation-u,g={x:d/2+p.x*f,y:h/2+p.y*f};Math.abs(m)>.05&&(n=Object(a.rotatePoint)(n,g,-m),o=Object(a.rotatePoint)(o,g,-m));var v=Math.abs(n.x-o.x),y=Math.abs(n.y-o.y),b=Math.min(n.x,o.x),x=Math.min(n.y,o.y),w={x:b+v/2,y:x+y/2};Math.abs(m)>.05&&(w=Object(a.rotatePoint)(w,g,m));var _=m*Math.PI/180;Object(i.default)(e,s,(function(e){e.ellipse(w.x,w.y,v/2,y/2,_,0,2*Math.PI),e.closePath()}))}},"./drawing/drawHandles.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./stateManagement/toolStyle.js"),a=n("./stateManagement/toolColors.js"),o=n("./drawing/path.js"),s=n("./store/index.js");t.default=function(e,t,n){var l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=t.element,c=a.default.getToolColor();e.strokeStyle=l.color||c;for(var d=Object.keys(n),h=function(t){var a=n[d[t]];if(!0===a.drawnIndependently)return"continue";if(!0===l.drawHandlesIfActive&&!a.active)return"continue";if(l.hideHandlesIfMoving&&a.moving)return"continue";var c={lineWidth:a.active?i.default.getActiveWidth():i.default.getToolWidth(),fillStyle:l.fill};l.lineDash&&(c.lineDash=l.lineDash),Object(o.default)(e,c,(function(e){var t=r.default.cornerstone.pixelToCanvas(u,a);e.arc(t.x,t.y,a.radius||l.handleRadius||s.state.handleRadius,0,2*Math.PI)}))},f=0;f<d.length;f++)h(f)}},"./drawing/drawJoinedLines.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./drawing/path.js");t.default=function(e,t,n,a,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";Object(i.default)(e,o,(function(e){"pixel"===s&&(n=r.default.cornerstone.pixelToCanvas(t,n),a=a.map((function(e){return r.default.cornerstone.pixelToCanvas(t,e)}))),e.moveTo(n.x,n.y),a.forEach((function(t){e.lineTo(t.x,t.y)}))}))}},"./drawing/drawLine.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=n("./externalModules.js"),i=n("./drawing/path.js");function a(e,t,n,a,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";Object(i.default)(e,o,(function(e){"pixel"===s&&(n=r.default.cornerstone.pixelToCanvas(t,n),a=r.default.cornerstone.pixelToCanvas(t,a)),e.moveTo(n.x,n.y),e.lineTo(a.x,a.y)}))}},"./drawing/drawLines.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./drawing/path.js");t.default=function(e,t,n,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"pixel";Object(i.default)(e,a,(function(e){n.forEach((function(n){var i=n.start,a=n.end;if("pixel"===o){var s=r.default.cornerstone;i=s.pixelToCanvas(t,i),a=s.pixelToCanvas(t,a)}e.moveTo(i.x,i.y),e.lineTo(a.x,a.y)}))}))}},"./drawing/drawLink.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./drawing/drawLine.js");t.default=function(e,t,n,a,o,s){var l=e.length>0?r.default.cornerstoneMath.point.findClosestPoint(e,t):t,u=r.default.cornerstoneMath.point.findClosestPoint([{x:n.left+n.width/2,y:n.top},{x:n.left,y:n.top+n.height/2},{x:n.left+n.width/2,y:n.top+n.height},{x:n.left+n.width,y:n.top+n.height/2}],l),c={color:o,lineWidth:s,lineDash:[2,3]};Object(i.default)(a,void 0,l,u,c,"canvas")}},"./drawing/drawLinkedTextBox.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./drawing/drawTextBox.js"),a=n("./drawing/drawLink.js");t.default=function(e,t,n,o,s,l,u,c,d,h){var f=r.default.cornerstone,p=f.pixelToCanvas(t,n);d&&(p.x+=d);var m={centering:{x:!1,y:h}};if(n.boundingBox=Object(i.default)(e,o,p.x,p.y,u,m),n.hasMoved){var g=l(s).map((function(e){return f.pixelToCanvas(t,e)}));Object(a.default)(g,p,n.boundingBox,e,u,c)}}},"./drawing/drawRect.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./drawing/path.js"),a=n("./util/pointProjector.js");t.default=function(e,t,n,o,s){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel",u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if("pixel"===l){var c=r.default.cornerstone;n=c.pixelToCanvas(t,n),o=c.pixelToCanvas(t,o)}var d=r.default.cornerstone.getViewport(t),h=t.clientWidth,f=t.clientHeight,p=d.scale,m=d.translation,g=d.rotation-u,v={x:h/2+m.x*p,y:f/2+m.y*p};Math.abs(g)>.05&&(n=Object(a.rotatePoint)(n,v,-g),o=Object(a.rotatePoint)(o,v,-g));var y=Math.abs(n.x-o.x),b=Math.abs(n.y-o.y);n={x:Math.min(n.x,o.x),y:Math.min(n.y,o.y)},o={x:n.x+y,y:n.y+b};var x={x:n.x+y,y:n.y},w={x:n.x,y:n.y+b};Math.abs(g)>.05&&(n=Object(a.rotatePoint)(n,v,g),o=Object(a.rotatePoint)(o,v,g),x=Object(a.rotatePoint)(x,v,g),w=Object(a.rotatePoint)(w,v,g)),Object(i.default)(e,s,(function(e){e.moveTo(n.x,n.y),e.lineTo(x.x,x.y),e.lineTo(o.x,o.y),e.lineTo(w.x,w.y),e.lineTo(n.x,n.y)}))}},"./drawing/drawTextBox.js":function(e,t,n){"use strict";n.r(t),n.d(t,"textBoxWidth",(function(){return s}));var r=n("./stateManagement/textStyle.js"),i=n("./drawing/draw.js"),a=n("./drawing/fillTextLines.js"),o=n("./drawing/fillBox.js");function s(e,t,n){var i=r.default.getFont(),a=e.font;i&&i!==a&&(e.font=i);var o=e.measureText(t).width;return i&&i!==a&&(e.font=a),o+2*n}t.default=function(e,t,n,l,u,c){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var d=r.default.getFontSize(),h=r.default.getBackgroundColor(),f=0;t.forEach((function(t){var n=s(e,t,5);f=Math.max(f,n)}));var p={width:f,height:5+t.length*(d+5)};return Object(i.default)(e,(function(e){e.strokeStyle=u,c&&c.centering&&!0===c.centering.x&&(n-=p.width/2),c&&c.centering&&!0===c.centering.y&&(l-=p.height/2),p.left=n,p.top=l;var r=c&&!0===c.debug?"#FF0000":h;Object(o.default)(e,p,r),Object(a.default)(e,p,t,u,5)})),p}},"./drawing/fillBox.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){e.fillStyle=n,e.fillRect(t.left,t.top,t.width,t.height)}},"./drawing/fillOutsideRect.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./drawing/path.js");t.default=function(e,t,n,a,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";if("pixel"===s){var l=r.default.cornerstone;n=l.pixelToCanvas(t,n),a=l.pixelToCanvas(t,a)}var u=Math.min(n.x,a.x),c=Math.min(n.y,a.y),d=Math.abs(n.x-a.x),h=Math.abs(n.y-a.y);Object(i.default)(e,o,(function(e){e.rect(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.rect(u+d,c,-d,h)}))}},"./drawing/fillTextLines.js":function(e,t,n){"use strict";n.r(t);var r=n("./stateManagement/textStyle.js");t.default=function(e,t,n,i,a){var o=r.default.getFontSize();e.font=r.default.getFont(),e.textBaseline="top",e.fillStyle=i,n.forEach((function(n,r){e.fillText(n,t.left+a,t.top+a+r*(o+a))}))}},"./drawing/getNewContext.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=e.getContext("2d");return t.setTransform(1,0,0,1,0,0),t}},"./drawing/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./drawing/draw.js");n.d(t,"draw",(function(){return r.default}));var i=n("./drawing/drawArrow.js");n.d(t,"drawArrow",(function(){return i.default}));var a=n("./drawing/drawCircle.js");n.d(t,"drawCircle",(function(){return a.default}));var o=n("./drawing/drawEllipse.js");n.d(t,"drawEllipse",(function(){return o.default}));var s=n("./drawing/drawHandles.js");n.d(t,"drawHandles",(function(){return s.default}));var l=n("./drawing/drawJoinedLines.js");n.d(t,"drawJoinedLines",(function(){return l.default}));var u=n("./drawing/drawLine.js");n.d(t,"drawLine",(function(){return u.default}));var c=n("./drawing/drawLines.js");n.d(t,"drawLines",(function(){return c.default}));var d=n("./drawing/drawLink.js");n.d(t,"drawLink",(function(){return d.default}));var h=n("./drawing/drawLinkedTextBox.js");n.d(t,"drawLinkedTextBox",(function(){return h.default}));var f=n("./drawing/drawRect.js");n.d(t,"drawRect",(function(){return f.default}));var p=n("./drawing/drawTextBox.js");n.d(t,"drawTextBox",(function(){return p.default}));var m=n("./drawing/fillBox.js");n.d(t,"fillBox",(function(){return m.default}));var g=n("./drawing/fillOutsideRect.js");n.d(t,"fillOutsideRect",(function(){return g.default}));var v=n("./drawing/fillTextLines.js");n.d(t,"fillTextLines",(function(){return v.default}));var y=n("./drawing/getNewContext.js");n.d(t,"getNewContext",(function(){return y.default}));var b=n("./drawing/path.js");n.d(t,"path",(function(){return b.default}));var x=n("./drawing/setShadow.js");n.d(t,"setShadow",(function(){return x.default}));var w=n("./drawing/transformCanvasContext.js");n.d(t,"transformCanvasContext",(function(){return w.default}));var _=n("./drawing/resetCanvasContextTransform.js");n.d(t,"resetCanvasContextTransform",(function(){return _.default}))},"./drawing/path.js":function(e,t,n){"use strict";n.r(t);var r=n("./stateManagement/toolStyle.js");t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=t.color,a=t.lineWidth,o=t.fillStyle,s=t.lineDash,l=t.shouldDrawLines,u=void 0===l||l;e.beginPath(),e.strokeStyle=i||e.strokeStyle,e.lineWidth=a||void 0===a&&r.default.getToolWidth()||e.lineWidth,s&&e.setLineDash(s),n(e),o&&(e.fillStyle=o,e.fill()),u&&e.stroke(),s&&e.setLineDash([])}},"./drawing/resetCanvasContextTransform.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){e.setTransform(1,0,0,1,0,0)}},"./drawing/setShadow.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/getDefault.js");t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.shadow&&(e.shadowColor=Object(r.default)(t.shadowColor,"#000000"),e.shadowBlur=Object(r.default)(t.shadowBlur,0),e.shadowOffsetX=Object(r.default)(t.shadowOffsetX,1),e.shadowOffsetY=Object(r.default)(t.shadowOffsetY,1))}},"./drawing/transformCanvasContext.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){if(n.hflip||n.vflip||n.rotation){var r={x:t.width/2+n.translation.x*n.scale,y:t.height/2+n.translation.y*n.scale};e.translate(r.x,r.y),n.rotation&&e.rotate(n.rotation*Math.PI/180),n.vflip&&e.scale(1,-1),n.hflip&&e.scale(-1,1),e.translate(-r.x,-r.y)}}},"./eventDispatchers/imageRenderedEventDispatcher.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./stateManagement/toolState.js"),a=n("./eventListeners/onImageRenderedBrushEventHandler.js"),o=n("./externalModules.js"),s=Object(r.getModule)("segmentation"),l=function(e){var t=e.detail,n=t.element,o=r.state.tools.filter((function(e){return e.element===n&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)})),l=Object(i.getToolState)(n,"stack"),u=s.configuration;l&&(u.renderFill||u.renderOutline)&&Object(a.default)(e);var c=t.canvasContext.canvas.getContext("2d");o.forEach((function(t){t.renderToolData&&(c.save(),t.renderToolData(e),c.restore())}))};t.default={enable:function(e){e.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,l)},disable:function(e){e.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,l)}}},"./eventDispatchers/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./eventDispatchers/imageRenderedEventDispatcher.js");n.d(t,"imageRenderedEventDispatcher",(function(){return r.default}));var i=n("./eventDispatchers/mouseToolEventDispatcher.js");n.d(t,"mouseToolEventDispatcher",(function(){return i.default}));var a=n("./eventDispatchers/newImageEventDispatcher.js");n.d(t,"newImageEventDispatcher",(function(){return a.default}));var o=n("./eventDispatchers/touchToolEventDispatcher.js");n.d(t,"touchToolEventDispatcher",(function(){return o.default}))},"./eventDispatchers/mouseEventHandlers/addNewMeasurement.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./externalModules.js"),a=n("./stateManagement/toolState.js"),o=n("./manipulators/index.js"),s=n("./util/logger.js"),l=n("./util/triggerEvent.js"),u=Object(s.getLogger)("eventDispatchers:mouseEventHandlers");t.default=function(e,t){u.log("addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,s=n.element,c=t.createNewMeasurement(n);c&&(Object(a.addToolState)(s,t.name,c),i.default.cornerstone.updateImage(s),(1===Object.keys(c.handles).length?o.moveHandle:o.moveNewHandle)(n,t.name,c,c.handles.end,t.options,"mouse",(function(e){if(!c.cancelled)if(e){var n=r.default.MEASUREMENT_COMPLETED,i={toolName:t.name,toolType:t.name,element:s,measurementData:c};Object(l.default)(s,n,i)}else Object(a.removeToolState)(s,t.name,c)})))}},"./eventDispatchers/mouseEventHandlers/index.js":function(e,t,n){"use strict";n.r(t),n.d(t,"mouseClick",(function(){return l})),n.d(t,"mouseDoubleClick",(function(){return u})),n.d(t,"mouseUp",(function(){return c})),n.d(t,"mouseWheel",(function(){return d}));var r=n("./eventDispatchers/shared/customCallbackHandler.js"),i=n("./eventDispatchers/mouseEventHandlers/mouseDown.js");n.d(t,"mouseDown",(function(){return i.default}));var a=n("./eventDispatchers/mouseEventHandlers/mouseDownActivate.js");n.d(t,"mouseDownActivate",(function(){return a.default}));var o=n("./eventDispatchers/mouseEventHandlers/mouseDrag.js");n.d(t,"mouseDrag",(function(){return o.default}));var s=n("./eventDispatchers/mouseEventHandlers/mouseMove.js");n.d(t,"mouseMove",(function(){return s.default}));var l=r.default.bind(null,"Mouse","mouseClickCallback"),u=r.default.bind(null,"Mouse","doubleClickCallback"),c=r.default.bind(null,"Mouse","mouseUpCallback"),d=r.default.bind(null,"MouseWheel","mouseWheelCallback")},"./eventDispatchers/mouseEventHandlers/mouseDown.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./stateManagement/toolState.js"),a=n("./store/getToolsWithMoveableHandles.js"),o=n("./util/findAndMoveHelpers.js"),s=n("./store/getInteractiveToolsForElement.js"),l=n("./store/getToolsWithDataForElement.js"),u=n("./store/filterToolsUsableWithMultiPartTools.js");t.default=function(e){if(!r.state.isToolLocked){var t=e.detail,n=e.detail.element,c=e.detail.currentPoints.canvas,d=Object(s.default)(n,r.getters.mouseTools()),h=d.filter((function(e){return"active"===e.mode&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(t.buttons)&&e.options.isMouseActive}));if(r.state.isMultiPartToolActive&&(h=Object(u.default)(h)),h.length>0){var f=h.find((function(e){return"function"==typeof e.preMouseDownCallback}));if(f&&f.preMouseDownCallback(e))return}if(!r.state.isMultiPartToolActive){var p=Object(l.default)(n,d),m=Object(a.default)(n,p,c,"mouse");if(m.length>0){var g=m[0],v=Object(i.getToolState)(n,g.name),y=Object(o.findHandleDataNearImagePoint)(n,v,g.name,c);g.handleSelectedCallback(e,y.data,y.handle,"mouse")}else{var b=d.filter((function(e){var t=Object(i.getToolState)(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,c,"mouse")}))}));if(b.length>0){var x=b[0],w=Object(i.getToolState)(n,x.name).data.find((function(e){return x.pointNearTool(n,e,c)}));x.toolSelectedCallback(e,w,"mouse")}else if(h.length>0){var _=h.find((function(e){return"function"==typeof e.postMouseDownCallback}));if(_&&_.postMouseDownCallback(e))return}}}}}},"./eventDispatchers/mouseEventHandlers/mouseDownActivate.js":function(e,t,n){"use strict";n.r(t);var r=n("./eventDispatchers/mouseEventHandlers/addNewMeasurement.js"),i=n("./store/index.js"),a=n("./tools/base/BaseAnnotationTool.js"),o=n("./util/getActiveTool.js");t.default=function(e){if(!i.state.isToolLocked){var t=e.detail,n=t.element,s=t.buttons,l=Object(o.default)(n,s,"mouse");if(l){if("function"==typeof l.preMouseDownActivateCallback&&l.preMouseDownActivateCallback(e))return;i.state.isMultiPartToolActive||(l.addNewMeasurement?l.addNewMeasurement(e,"mouse"):l instanceof a.default&&Object(r.default)(e,l))}}}},"./eventDispatchers/mouseEventHandlers/mouseDrag.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./store/getActiveToolsForElement.js"),a=n("./store/filterToolsUsableWithMultiPartTools.js");t.default=function(e){if(!r.state.isToolLocked){var t,n=e.detail,o=n.element;t=(t=(t=Object(i.default)(o,r.getters.mouseTools())).filter((function(e){return Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(n.buttons)&&e.options.isMouseActive}))).filter((function(e){return"function"==typeof e.mouseDragCallback})),r.state.isMultiPartToolActive&&(t=Object(a.default)(t)),0!==t.length&&t[0].mouseDragCallback(e)}}},"./eventDispatchers/mouseEventHandlers/mouseMove.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./store/index.js"),a=n("./store/getInteractiveToolsForElement.js"),o=n("./store/getToolsWithDataForElement.js");t.default=function(e){if(!i.state.isToolLocked&&!i.state.isMultiPartToolActive){var t,n=e.detail,s=n.element;i.state.mousePositionImage=n.currentPoints.image;var l=(t=Object(a.default)(s,i.getters.mouseTools())).filter((function(e){return"active"===e.mode&&e.options.isMouseActive})),u=!1;l.length>0&&(u=l.some((function(e){return e.updateOnMouseMove}))),t=Object(o.default)(s,t);for(var c=0;c<t.length;c++){var d=t[c];"function"==typeof d.mouseMoveCallback&&(u=d.mouseMoveCallback(e)||u)}!0===u&&r.default.cornerstone.updateImage(s)}}},"./eventDispatchers/mouseToolEventDispatcher.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./eventDispatchers/mouseEventHandlers/index.js");t.default={enable:function(e){e.addEventListener(r.default.MOUSE_CLICK,i.mouseClick),e.addEventListener(r.default.MOUSE_DOWN,i.mouseDown),e.addEventListener(r.default.MOUSE_DOWN_ACTIVATE,i.mouseDownActivate),e.addEventListener(r.default.MOUSE_DOUBLE_CLICK,i.mouseDoubleClick),e.addEventListener(r.default.MOUSE_DRAG,i.mouseDrag),e.addEventListener(r.default.MOUSE_MOVE,i.mouseMove),e.addEventListener(r.default.MOUSE_UP,i.mouseUp),e.addEventListener(r.default.MOUSE_WHEEL,i.mouseWheel)},disable:function(e){e.removeEventListener(r.default.MOUSE_CLICK,i.mouseClick),e.removeEventListener(r.default.MOUSE_DOWN,i.mouseDown),e.removeEventListener(r.default.MOUSE_DOWN_ACTIVATE,i.mouseDownActivate),e.removeEventListener(r.default.MOUSE_DOUBLE_CLICK,i.mouseDoubleClick),e.removeEventListener(r.default.MOUSE_DRAG,i.mouseDrag),e.removeEventListener(r.default.MOUSE_MOVE,i.mouseMove),e.removeEventListener(r.default.MOUSE_UP,i.mouseUp),e.removeEventListener(r.default.MOUSE_WHEEL,i.mouseWheel)}}},"./eventDispatchers/newImageEventDispatcher.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./externalModules.js"),a=function(e){if(r.state.isToolLocked)return!1;var t=e.detail.element,n=r.state.tools.filter((function(e){return e.element===t&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)}));if(0===n.length)return!1;n.forEach((function(t){t.newImageCallback&&t.newImageCallback(e)}))};t.default={enable:function(e){e.addEventListener(i.default.cornerstone.EVENTS.NEW_IMAGE,a)},disable:function(e){e.removeEventListener(i.default.cornerstone.EVENTS.NEW_IMAGE,a)}}},"./eventDispatchers/shared/customCallbackHandler.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./store/getActiveToolsForElement.js"),a=n("./store/filterToolsUsableWithMultiPartTools.js");t.default=function(e,t,n){if(r.state.isToolLocked)return!1;var o=n.detail.element,s=r.state.tools.filter((function(t){return t.supportedInteractionTypes.includes(e)}));if(s=(s=Object(i.default)(o,s,e)).filter((function(e){return"function"==typeof e[t]})),r.state.isMultiPartToolActive&&(s=Object(a.default)(s)),0===s.length)return!1;s[0][t](n)}},"./eventDispatchers/touchEventHandlers/addNewMeasurement.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./externalModules.js"),a=n("./store/index.js"),o=n("./manipulators/anyHandlesOutsideImage.js"),s=n("./manipulators/index.js"),l=n("./stateManagement/toolState.js"),u=n("./util/triggerEvent.js"),c=n("./util/logger.js"),d=Object(c.getLogger)("eventDispatchers:touchEventHandlers");t.default=function(e,t){d.log("addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,c=n.element,h=t.createNewMeasurement(n);if(h){if(Object(l.addToolState)(c,t.name,h),1===Object.keys(h.handles).length&&n.type===r.default.TAP)return h.active=!1,h.handles.end.active=!1,h.handles.end.highlight=!1,h.invalidated=!0,(a.state.deleteIfHandleOutsideImage||t.options.deleteIfHandleOutsideImage)&&Object(o.default)(n,h.handles)&&Object(l.removeToolState)(c,t.name,h),void i.default.cornerstone.updateImage(c);i.default.cornerstone.updateImage(c),Object(s.moveNewHandle)(n,t.name,h,h.handles.end,t.options,"touch",(function(){var e=r.default.MEASUREMENT_COMPLETED,n={toolName:t.name,toolType:t.name,element:c,measurementData:h};Object(u.default)(c,e,n)}))}}},"./eventDispatchers/touchEventHandlers/index.js":function(e,t,n){"use strict";n.r(t),n.d(t,"doubleTap",(function(){return l})),n.d(t,"touchDrag",(function(){return u})),n.d(t,"touchEnd",(function(){return c})),n.d(t,"touchPinch",(function(){return d})),n.d(t,"touchPress",(function(){return h})),n.d(t,"touchRotate",(function(){return f}));var r=n("./eventDispatchers/shared/customCallbackHandler.js"),i=n("./eventDispatchers/touchEventHandlers/multiTouchDrag.js");n.d(t,"multiTouchDrag",(function(){return i.default}));var a=n("./eventDispatchers/touchEventHandlers/tap.js");n.d(t,"tap",(function(){return a.default}));var o=n("./eventDispatchers/touchEventHandlers/touchStart.js");n.d(t,"touchStart",(function(){return o.default}));var s=n("./eventDispatchers/touchEventHandlers/touchStartActive.js");n.d(t,"touchStartActive",(function(){return s.default}));var l=r.default.bind(null,"DoubleTap","doubleTapCallback"),u=r.default.bind(null,"Touch","touchDragCallback"),c=r.default.bind(null,"Touch","touchEndCallback"),d=r.default.bind(null,"TouchPinch","touchPinchCallback"),h=r.default.bind(null,"Touch","touchPressCallback"),f=r.default.bind(null,"TouchRotate","touchRotateCallback")},"./eventDispatchers/touchEventHandlers/multiTouchDrag.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./store/getActiveToolsForElement.js"),a=n("./store/filterToolsUsableWithMultiPartTools.js");t.default=function(e){if(r.state.isToolLocked)return!1;var t=e.detail,n=t.element,o=t.numPointers,s=r.state.tools.filter((function(e){return e.supportedInteractionTypes.includes("MultiTouch")}));if(s=(s=Object(i.default)(n,s,"MultiTouch")).filter((function(e){return"function"==typeof e.multiTouchDragCallback&&o===e.configuration.touchPointers})),r.state.isMultiPartToolActive&&(s=Object(a.default)(s)),0===s.length)return!1;s[0].multiTouchDragCallback(e)}},"./eventDispatchers/touchEventHandlers/shared/deactivateAllToolInstances.js":function(e,t,n){"use strict";function r(e){Object.keys(e).forEach((function(t){e[t].active=!1}))}n.r(t),t.default=function(e){if(e)for(var t=0;t<e.data.length;t++){var n=e.data[t];n.active=!1,n.handles&&r(n.handles)}}},"./eventDispatchers/touchEventHandlers/tap.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./eventDispatchers/touchEventHandlers/touchStartActive.js"),a=n("./store/index.js"),o=n("./store/getActiveToolsForElement.js"),s=n("./store/getToolsWithDataForElement.js"),l=n("./stateManagement/toolState.js"),u=n("./manipulators/getHandleNearImagePoint.js"),c=n("./manipulators/index.js"),d=n("./eventDispatchers/touchEventHandlers/shared/deactivateAllToolInstances.js");t.default=function(e){if(!a.state.isToolLocked&&!a.state.isMultiPartToolActive){var t,n=e.detail.element,h=e.detail.currentPoints.canvas;t=Object(o.default)(n,a.getters.touchTools());var f=(t=Object(s.default)(n,t)).filter((function(e){for(var t=Object(l.getToolState)(n,e.name),r=0;r<t.data.length;r++)if(void 0!==Object(u.default)(n,t.data[r].handles,h,28))return!0;return!1}));if(f.length>0){var p=f[0],m=Object(l.getToolState)(n,p.name),g=m.data.find((function(e){return void 0!==Object(u.default)(n,e.handles,h,28)}));return m.data.active=!0,g.active=!0,r.default.cornerstone.updateImage(n),Object(c.moveHandle)(e.detail,p.name,m.data,g,p.options,"touch",(function(){return Object(d.default)(m)})),e.stopImmediatePropagation(),void e.preventDefault()}var v=t.filter((function(e){var t=Object(l.getToolState)(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,h)}))}));if(v.length>0){var y=v[0],b=Object(l.getToolState)(n,y.name),x=b.data.find((function(e){return y.pointNearTool(n,e,h)}));return x.active=!0,r.default.cornerstone.updateImage(n),Object(c.moveAllHandles)(e.detail,y.name,x,null,y.options,"touch",(function(){return Object(d.default)(b)})),e.stopImmediatePropagation(),void e.preventDefault()}var w=Object(o.default)(n,a.getters.touchTools());return w.length>0&&w[0].touchStartActiveCallback?w[0].touchStartActiveCallback(e):Object(i.default)(e),!1}}},"./eventDispatchers/touchEventHandlers/touchStart.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./util/findAndMoveHelpers.js"),a=n("./store/getToolsWithMoveableHandles.js"),o=n("./stateManagement/toolState.js"),s=n("./store/getInteractiveToolsForElement.js"),l=n("./store/getToolsWithDataForElement.js"),u=n("./store/filterToolsUsableWithMultiPartTools.js");t.default=function(e){if(!r.state.isToolLocked){var t=e.detail,n=t.element,c=t.startPoints.canvas,d=Object(s.default)(n,r.getters.touchTools()),h=d.filter((function(e){return"active"===e.mode&&e.options.isTouchActive}));if(r.state.isMultiPartToolActive&&(h=Object(u.default)(h)),h.length>0){var f=h.find((function(e){return"function"==typeof e.preTouchStartCallback}));if(f&&f.preTouchStartCallback(e))return}if(!r.state.isMultiPartToolActive){var p=Object(l.default)(n,d),m=Object(a.default)(n,p,c,"touch");if(m.length>0){var g=m[0],v=Object(o.getToolState)(n,g.name),y=Object(i.findHandleDataNearImagePoint)(n,v,g.name,c,"touch");g.handleSelectedCallback(e,y.data,y.handle,"touch")}else{var b=p.filter((function(e){var t=Object(o.getToolState)(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,c,"touch")}))}));if(b.length>0){var x=b[0],w=Object(o.getToolState)(n,x.name).data.find((function(e){return x.pointNearTool(n,e,c)}));x.toolSelectedCallback(e,w,"touch")}else if(h.length>0){var _=h.find((function(e){return"function"==typeof e.postTouchStartCallback}));if(_&&_.postTouchStartCallback(e))return}}}}}},"./eventDispatchers/touchEventHandlers/touchStartActive.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./eventDispatchers/touchEventHandlers/addNewMeasurement.js"),a=n("./tools/base/BaseAnnotationTool.js"),o=n("./util/getActiveTool.js");t.default=function(e){if(!r.state.isToolLocked&&!r.state.isMultiPartToolActive){var t=e.detail.element,n=Object(o.default)(t,null,"touch");n&&n.addNewMeasurement?n.addNewMeasurement(e,"touch"):n instanceof a.default&&Object(i.default)(e,n)}}},"./eventDispatchers/touchToolEventDispatcher.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./eventDispatchers/touchEventHandlers/index.js");t.default={enable:function(e){e.addEventListener(r.default.TAP,i.tap),e.addEventListener(r.default.TOUCH_START,i.touchStart,{passive:!1}),e.addEventListener(r.default.TOUCH_DRAG,i.touchDrag,{passive:!1}),e.addEventListener(r.default.TOUCH_END,i.touchEnd),e.addEventListener(r.default.TOUCH_START_ACTIVE,i.touchStartActive),e.addEventListener(r.default.TOUCH_PRESS,i.touchPress),e.addEventListener(r.default.DOUBLE_TAP,i.doubleTap),e.addEventListener(r.default.TOUCH_PINCH,i.touchPinch),e.addEventListener(r.default.TOUCH_ROTATE,i.touchRotate),e.addEventListener(r.default.MULTI_TOUCH_DRAG,i.multiTouchDrag)},disable:function(e){e.removeEventListener(r.default.TAP,i.tap),e.removeEventListener(r.default.TOUCH_START,i.touchStart),e.removeEventListener(r.default.TOUCH_DRAG,i.touchDrag),e.removeEventListener(r.default.TOUCH_END,i.touchEnd),e.removeEventListener(r.default.TOUCH_START_ACTIVE,i.touchStartActive),e.removeEventListener(r.default.TOUCH_PRESS,i.touchPress),e.removeEventListener(r.default.DOUBLE_TAP,i.doubleTap),e.removeEventListener(r.default.TOUCH_PINCH,i.touchPinch),e.removeEventListener(r.default.TOUCH_ROTATE,i.touchRotate),e.removeEventListener(r.default.MULTI_TOUCH_DRAG,i.multiTouchDrag)}}},"./eventListeners/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./eventListeners/mouseEventListeners.js");n.d(t,"mouseEventListeners",(function(){return r.default}));var i=n("./eventListeners/wheelEventListener.js");n.d(t,"wheelEventListener",(function(){return i.default}));var a=n("./eventListeners/touchEventListeners.js");n.d(t,"touchEventListeners",(function(){return a.default}))},"./eventListeners/internals/normalizeWheel.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=0,n=0,r=0,i=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),r=10*t,i=10*n,"deltaY"in e&&(i=e.deltaY),"deltaX"in e&&(r=e.deltaX),(r||i)&&e.deltaMode&&(1===e.deltaMode?(r*=40,i*=40):(r*=800,i*=800)),r&&!t&&(t=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:t,spinY:n,pixelX:r,pixelY:i}}},"./eventListeners/internals/renderSegmentation.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));var r=n("./store/index.js"),i=n("./eventListeners/internals/renderSegmentationFill.js"),a=n("./eventListeners/internals/renderSegmentationOutline.js"),o=Object(r.getModule)("segmentation");function s(e,t,n,r,s){(function(e){var t=o.configuration;return t.renderFill&&(e&&0!==t.fillAlpha||!e&&0!==t.fillAlphaInactive)})(s)&&Object(i.default)(e,t,r,n,s),function(e){var t=o.configuration;return t.renderOutline&&(e&&0!==t.outlineAlpha||!e&&0!==t.outlineAlphaInactive)}(s)&&Object(a.default)(e,t,r,n,s)}},"./eventListeners/internals/renderSegmentationFill.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s})),n.d(t,"getLabelmapCanvas",(function(){return l})),n.d(t,"renderFill",(function(){return u}));var r=n("./store/index.js"),i=n("./drawing/index.js"),a=n("./externalModules.js"),o=Object(r.getModule)("segmentation");function s(e,t,n,r,i){u(e,l(e,t,n),i)}function l(e,t,n){var r=e.detail.image,a=r.width,s=r.height,l=t.segmentsHidden,u=n.pixelData,c=o.state.colorLutTables[t.colorLUTIndex],d=document.createElement("canvas");d.width=a,d.height=s;for(var h=Object(i.getNewContext)(d),f=new ImageData(a,s),p=f.data,m=0;m<u.length;m++){var g=u[m];if(0!==g&&!l[g]){var v=c[u[m]];p[4*m]=v[0],p[4*m+1]=v[1],p[4*m+2]=v[2],p[4*m+3]=v[3]}}return h.putImageData(f,0,0),d}function u(e,t,n){var r=o.configuration,s=e.detail,l=Object(i.getNewContext)(s.canvasContext.canvas),u=a.default.cornerstone.pixelToCanvas(s.element,{x:0,y:0}),c=a.default.cornerstone.pixelToCanvas(s.element,{x:s.image.width,y:0}),d=a.default.cornerstone.pixelToCanvas(s.element,{x:s.image.width,y:s.image.height}),h=a.default.cornerstoneMath.point.distance(u,c),f=a.default.cornerstoneMath.point.distance(c,d),p=s.canvasContext.canvas,m=s.viewport,g=l.imageSmoothingEnabled,v=l.globalAlpha;l.imageSmoothingEnabled=!1,l.globalAlpha=n?r.fillAlpha:r.fillAlphaInactive,Object(i.transformCanvasContext)(l,p,m);var y=function(e){var t=e.viewport,n=e.image,r=t.scale,i=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?r*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(i*=n.rowPixelSpacing/n.columnPixelSpacing),{x:t.translation.x*r,y:t.translation.y*i}}(s);l.drawImage(t,p.width/2-h/2+y.x,p.height/2-f/2+y.y,h,f),l.globalAlpha=v,l.imageSmoothingEnabled=g,Object(i.resetCanvasContextTransform)(l)}},"./eventListeners/internals/renderSegmentationOutline.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s})),n.d(t,"renderOutline",(function(){return l})),n.d(t,"getOutline",(function(){return u})),n.d(t,"_addTopRightCorner",(function(){return h}));var r=n("./store/index.js"),i=n("./externalModules.js"),a=n("./drawing/index.js"),o=(n("./index.js"),Object(r.getModule)("segmentation"));function s(e,t,n,r,i){l(e,u(e,t,n,o.configuration.outlineWidth),t.colorLUTIndex,i)}function l(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=o.configuration,s=o.state,l=e.detail,u=l.element,c=l.canvasContext,d=i.outlineWidth||1,h=Object(a.getNewContext)(c.canvas),f=s.colorLutTables[n],p=h.globalAlpha;h.globalAlpha=r?i.outlineAlpha:i.outlineAlphaInactive,Object(a.draw)(h,(function(e){for(var n=1;n<t.length;n++)if(t[n]){var r=f[n];Object(a.drawLines)(e,u,t[n],{color:"rgba(".concat(r[0],", ").concat(r[1],", ").concat(r[2],", 1.0 )"),lineWidth:d},"canvas")}})),h.globalAlpha=p}function u(e,t,n,r){var i=e.detail,a=i.element,o=i.image,s=i.viewport,l=o.width,u=o.height;r=r||1;var b=t.segmentsHidden,x=n.pixelData,w=t.activeSegmentIndex,_=[];n.segmentsOnLabelmap.forEach((function(e){!b[e]&&(_[e]=[])})),_[w]||(_[w]=[]);for(var k,E=function(e,t){var n=t/2,r=e.rotation;r*=Math.PI/180;var i=Math.cos(r),a=Math.sin(r),o=[i,a],s=[-a,i],l={x:n*o[0],y:n*o[1]},u={x:n*s[0],y:n*s[1]};return e.hflip&&(l.x*=-1,l.y*=-1),e.vflip&&(u.x*=-1,u.y*=-1),{i:l,j:u}}(s,r),S=0;S<x.length;S++){var T=x[S];if(0!==T&&!b[T]){var C={x:(k=S)%l,y:Math.floor(k/l)},I=c(C,u,l);void 0!==I.top&&x[I.top]===T||m(_[T],a,C,E),void 0!==I.bottom&&x[I.bottom]===T||g(_[T],a,C,E),void 0!==I.left&&x[I.left]===T||v(_[T],a,C,E),void 0!==I.right&&x[I.right]===T||y(_[T],a,C,E),void 0!==I.topLeft&&x[I.topLeft]!==T&&x[I.top]===T&&x[I.left]===T&&d(_[T],a,C,E),void 0!==I.topRight&&x[I.topRight]!==T&&x[I.top]===T&&x[I.right]===T&&h(_[T],a,C,E),void 0!==I.bottomLeft&&x[I.bottomLeft]!==T&&x[I.bottom]===T&&x[I.left]===T&&f(_[T],a,C,E),void 0!==I.bottomRight&&x[I.bottomRight]!==T&&x[I.bottom]===T&&x[I.right]===T&&p(_[T],a,C,E)}}return _}function c(e,t,n){var r=e.y*n+e.x,i={},a=e.y+1<t,o=e.x-1>=0,s=e.x+1<n;return e.y-1>=0&&(i.top=r-n,s&&(i.topRight=i.top+1),o&&(i.topLeft=i.top-1)),a&&(i.bottom=r+n,s&&(i.bottomRight=i.bottom+1),o&&(i.bottomLeft=i.bottom-1)),o&&(i.left=r-1),s&&(i.right=r+1),i}function d(e,t,n,r){var a=(0,i.default.cornerstone.pixelToCanvas)(t,n);a.x+=r.j.x,a.y+=r.j.y;var o={x:a.x,y:a.y};o.x+=2*r.i.x,o.y+=2*r.i.y,e.push({start:a,end:o})}function h(e,t,n,r){var a=(0,i.default.cornerstone.pixelToCanvas)(t,{x:n.x+1,y:n.y});a.x+=r.j.x,a.y+=r.j.y;var o={x:a.x,y:a.y};o.x-=2*r.i.x,o.y-=2*r.i.y,e.push({start:a,end:o})}function f(e,t,n,r){var a=(0,i.default.cornerstone.pixelToCanvas)(t,{x:n.x,y:n.y+1});a.x-=r.j.x,a.y-=r.j.y;var o={x:a.x,y:a.y};o.x+=2*r.i.x,o.y+=2*r.i.y,e.push({start:a,end:o})}function p(e,t,n,r){var a=(0,i.default.cornerstone.pixelToCanvas)(t,{x:n.x+1,y:n.y+1});a.x-=r.j.x,a.y-=r.j.y;var o={x:a.x,y:a.y};o.x-=2*r.i.x,o.y-=2*r.i.y,e.push({start:a,end:o})}function m(e,t,n,r){var a=i.default.cornerstone.pixelToCanvas,o=a(t,n),s=a(t,{x:n.x+1,y:n.y});o.x+=r.j.x,o.y+=r.j.y,s.x+=r.j.x,s.y+=r.j.y,e.push({start:o,end:s})}function g(e,t,n,r){var a=i.default.cornerstone.pixelToCanvas,o=a(t,{x:n.x,y:n.y+1}),s=a(t,{x:n.x+1,y:n.y+1});o.x-=r.j.x,o.y-=r.j.y,s.x-=r.j.x,s.y-=r.j.y,e.push({start:o,end:s})}function v(e,t,n,r){var a=i.default.cornerstone.pixelToCanvas,o=a(t,n),s=a(t,{x:n.x,y:n.y+1});o.x+=r.i.x,o.y+=r.i.y,s.x+=r.i.x,s.y+=r.i.y,e.push({start:o,end:s})}function y(e,t,n,r){var a=i.default.cornerstone.pixelToCanvas,o=a(t,{x:n.x+1,y:n.y}),s=a(t,{x:n.x+1,y:n.y+1});o.x-=r.i.x,o.y-=r.i.y,s.x-=r.i.x,s.y-=r.i.y,e.push({start:o,end:s})}},"./eventListeners/mouseEventListeners.js":function(e,t,n){"use strict";n.r(t);var r,i=n("./events.js"),a=n("./externalModules.js"),o=n("./util/copyPoints.js"),s=n("./util/triggerEvent.js"),l=n("./util/logger.js"),u=Object(l.getLogger)("eventListeners:mouseEventListeners"),c=!0;function d(e){if("number"==typeof e.buttons)return e.buttons;switch(e.which){case 0:return 0;case 1:return 1;case 2:return 4;case 3:return 2}return 0}function h(){c=!1}function f(e){var t=e.currentTarget,n=a.default.cornerstone.getEnabledElement(t);if(n.image){var r=i.default.MOUSE_DOUBLE_CLICK,l={page:a.default.cornerstoneMath.point.pageToPoint(e),image:a.default.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};l.canvas=a.default.cornerstone.pixelToCanvas(t,l.image);var c=Object(o.default)(l);u.log("double-click: %o",d(e));var h={event:e,buttons:d(e),viewport:a.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:l,lastPoints:c,currentPoints:l,deltaPoints:{x:0,y:0},type:r};Object(s.default)(t,r,h)}}function p(e){var t=e.currentTarget,n=a.default.cornerstone.getEnabledElement(t);if(n.image){r=setTimeout(h,200),t.removeEventListener("mousemove",m);var l={page:a.default.cornerstoneMath.point.pageToPoint(e),image:a.default.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};l.canvas=a.default.cornerstone.pixelToCanvas(t,l.image);var f=Object(o.default)(l),p={event:e,buttons:d(e),viewport:a.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:l,lastPoints:f,currentPoints:l,deltaPoints:{x:0,y:0},type:i.default.MOUSE_DOWN};Object(s.default)(p.element,i.default.MOUSE_DOWN,p)&&(p.type=i.default.MOUSE_DOWN_ACTIVATE,Object(s.default)(p.element,i.default.MOUSE_DOWN_ACTIVATE,p)),document.addEventListener("mousemove",g),document.addEventListener("mouseup",(function e(o){clearTimeout(r);var h=i.default.MOUSE_UP;c&&(h=i.default.MOUSE_CLICK);var p={page:a.default.cornerstoneMath.point.pageToPoint(o),image:a.default.cornerstone.pageToPixel(t,o.pageX,o.pageY),client:{x:o.clientX,y:o.clientY}};p.canvas=a.default.cornerstone.pixelToCanvas(t,p.image);var v={page:a.default.cornerstoneMath.point.subtract(p.page,f.page),image:a.default.cornerstoneMath.point.subtract(p.image,f.image),client:a.default.cornerstoneMath.point.subtract(p.client,f.client),canvas:a.default.cornerstoneMath.point.subtract(p.canvas,f.canvas)};u.log("mouseup: %o",d(o));var y={event:o,buttons:d(o),viewport:a.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:l,lastPoints:f,currentPoints:p,deltaPoints:v,type:h};Object(s.default)(y.element,h,y),document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",e),t.addEventListener("mousemove",m),c=!0}))}function g(e){var r=i.default.MOUSE_DRAG,c={page:a.default.cornerstoneMath.point.pageToPoint(e),image:a.default.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};c.canvas=a.default.cornerstone.pixelToCanvas(t,c.image);var h={page:a.default.cornerstoneMath.point.subtract(c.page,f.page),image:a.default.cornerstoneMath.point.subtract(c.image,f.image),client:a.default.cornerstoneMath.point.subtract(c.client,f.client),canvas:a.default.cornerstoneMath.point.subtract(c.canvas,f.canvas)};u.log("mousemove: %o",d(e));var p={buttons:d(e),viewport:a.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:l,lastPoints:f,currentPoints:c,deltaPoints:h,type:r,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey};Object(s.default)(p.element,r,p),f=Object(o.default)(c)}}function m(e){var t=e.currentTarget,n=a.default.cornerstone.getEnabledElement(t);if(n.image){var r=i.default.MOUSE_MOVE,l={page:a.default.cornerstoneMath.point.pageToPoint(e),image:a.default.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};l.canvas=a.default.cornerstone.pixelToCanvas(t,l.image);var u=Object(o.default)(l),c={page:a.default.cornerstoneMath.point.pageToPoint(e),image:a.default.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};c.canvas=a.default.cornerstone.pixelToCanvas(t,c.image);var d={page:a.default.cornerstoneMath.point.subtract(c.page,u.page),image:a.default.cornerstoneMath.point.subtract(c.image,u.image),client:a.default.cornerstoneMath.point.subtract(c.client,u.client),canvas:a.default.cornerstoneMath.point.subtract(c.canvas,u.canvas)},h={viewport:a.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:l,lastPoints:u,currentPoints:c,deltaPoints:d,type:r};Object(s.default)(t,r,h),u=Object(o.default)(c)}}function g(e){e.removeEventListener("mousedown",p),e.removeEventListener("mousemove",m),e.removeEventListener("dblclick",f)}t.default={enable:function(e){g(e),e.addEventListener("mousedown",p),e.addEventListener("mousemove",m),e.addEventListener("dblclick",f)},disable:g}},"./eventListeners/onImageRenderedBrushEventHandler.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./eventListeners/internals/renderSegmentation.js"),a=Object(r.getModule)("segmentation");t.default=function(e){var t=a.configuration,n=a.getters.labelmaps3D(e.detail.element),r=n.activeLabelmapIndex,o=n.labelmaps3D,s=n.currentImageIdIndex;o&&(t.shouldRenderInactiveLabelmaps&&function(e,t,n,r){for(var a=0;a<t.length;a++){var o=t[a];if(a!==n&&o){var s=o.labelmaps2D[r];s&&Object(i.default)(e,o,a,s,!1)}}}(e,o,r,s),function(e,t,n,r){var a=t[n];if(a){var o=a.labelmaps2D[r];o&&Object(i.default)(e,a,n,o,!0)}}(e,o,r,s))}},"./eventListeners/preventGhostClick.js":function(e,t,n){"use strict";var r,i;function a(e,t){var n=Date.now();if(e!==r){if(n-i<=2e3)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;r=e}i=n}n.r(t);var o=a.bind(null,0),s=a.bind(null,1);function l(e,t,n){var r=n?o:s;t.forEach((function(t){e.addEventListener(t,r,{passive:!1})}))}function u(e,t,n){var r=n?o:s;t.forEach((function(t){e.removeEventListener(t,r)}))}var c=["mousedown","mouseup"],d=["touchstart","touchend"];function h(e){u(e,c,0),u(e,d,1)}t.default={enable:function(e){h(e),l(e,c,0),l(e,d,1)},disable:h}},"./eventListeners/touchEventListeners.js":function(e,t,n){"use strict";n.r(t);var r,i,a,o,s,l,u,c,d,h=n("./events.js"),f=n("./externalModules.js"),p=n("./util/copyPoints.js"),m=n("./eventListeners/preventGhostClick.js"),g=n("./util/triggerEvent.js"),v=n("./toolOptions.js"),y=1,b=0,x=!1,w=!1,_="touchInput";function k(e){var t=e.currentTarget||e.srcEvent.currentTarget,n=f.default.cornerstone.getEnabledElement(t);if(n.image){var m,v,_,k;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.touches&&e.touches.length>1)&&(w=!1,clearTimeout(u)),e.type){case"tap":w=!1,clearTimeout(u),(i={page:f.default.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:f.default.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=f.default.cornerstone.pixelToCanvas(t,i.image),m=h.default.TAP,s={event:e,viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:i,type:m,isTouchEvent:!0},Object(g.default)(t,m,s);break;case"doubletap":w=!1,clearTimeout(u),(i={page:f.default.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:f.default.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=f.default.cornerstone.pixelToCanvas(t,i.image),m=h.default.DOUBLE_TAP,s={event:e,viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:i,type:m,isTouchEvent:!0},Object(g.default)(t,m,s);break;case"pinchstart":w=!1,clearTimeout(u),y=1;break;case"pinchmove":if(w=!1,clearTimeout(u),!0===x){y=e.scale,x=!1;break}v=(e.scale-y)/y,(r={page:e.center,image:f.default.cornerstone.pageToPixel(t,e.center.x,e.center.y)}).canvas=f.default.cornerstone.pixelToCanvas(t,r.image),m=h.default.TOUCH_PINCH,s={event:e,startPoints:r,viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,direction:e.scale<1?1:-1,scaleChange:v,type:m,isTouchEvent:!0},Object(g.default)(t,m,s),y=e.scale;break;case"touchstart":y=1,clearTimeout(u),clearTimeout(l),l=setTimeout((function(){(r={page:f.default.cornerstoneMath.point.pageToPoint(e.touches[0]),image:f.default.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=f.default.cornerstone.pixelToCanvas(t,r.image),m=h.default.TOUCH_START,e.touches.length>1&&(m=h.default.MULTI_TOUCH_START),s={event:e,viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,currentPoints:r,type:m,isTouchEvent:!0},!0===Object(g.default)(t,m,s)&&(m=h.default.TOUCH_START_ACTIVE,e.touches.length>1&&(m=h.default.MULTI_TOUCH_START_ACTIVE),s.type=m,Object(g.default)(t,m,s)),a=Object(p.default)(r)}),50),w=!0,c=0,u=setTimeout((function(){w&&((i={page:f.default.cornerstoneMath.point.pageToPoint(e.touches[0]),image:f.default.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=f.default.cornerstone.pixelToCanvas(t,r.image),m=h.default.TOUCH_PRESS,s={event:e,viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:i,type:m,isTouchEvent:!0},Object(g.default)(t,m,s))}),700);break;case"touchend":y=1,w=!1,clearTimeout(u),setTimeout((function(){(r={page:f.default.cornerstoneMath.point.pageToPoint(e.changedTouches[0]),image:f.default.cornerstone.pageToPixel(t,e.changedTouches[0].pageX,e.changedTouches[0].pageY),client:{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}).canvas=f.default.cornerstone.pixelToCanvas(t,r.image),m=h.default.TOUCH_END,s={event:e,viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,currentPoints:r,type:m,isTouchEvent:!0},Object(g.default)(t,m,s)}),50);break;case"panmove":_={x:e.deltaX-d.x,y:e.deltaY-d.y},d={x:e.deltaX,y:e.deltaY},(i={page:{x:a.page.x+_.x,y:a.page.y+_.y},image:f.default.cornerstone.pageToPixel(t,a.page.x+_.x,a.page.y+_.y),client:{x:a.client.x+_.x,y:a.client.y+_.y}}).canvas=f.default.cornerstone.pixelToCanvas(t,i.image),o={page:f.default.cornerstoneMath.point.subtract(i.page,a.page),image:f.default.cornerstoneMath.point.subtract(i.image,a.image),client:f.default.cornerstoneMath.point.subtract(i.client,a.client),canvas:f.default.cornerstoneMath.point.subtract(i.canvas,a.canvas)},(c+=Math.sqrt(o.page.x*o.page.x+o.page.y*o.page.y))>5&&(w=!1,clearTimeout(u)),m=h.default.TOUCH_DRAG,e.pointers.length>1&&(m=h.default.MULTI_TOUCH_DRAG),s={viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,lastPoints:a,currentPoints:i,deltaPoints:o,numPointers:e.pointers.length,type:m,isTouchEvent:!0},Object(g.default)(t,m,s),a=Object(p.default)(i);break;case"panstart":d={x:e.deltaX,y:e.deltaY},(i={page:f.default.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:f.default.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=f.default.cornerstone.pixelToCanvas(t,i.image),a=Object(p.default)(i);break;case"panend":if(w=!1,clearTimeout(u),!a)return!1;(i={page:f.default.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:f.default.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=f.default.cornerstone.pixelToCanvas(t,i.image),o={page:f.default.cornerstoneMath.point.subtract(i.page,a.page),image:f.default.cornerstoneMath.point.subtract(i.image,a.image),client:f.default.cornerstoneMath.point.subtract(i.client,a.client),canvas:f.default.cornerstoneMath.point.subtract(i.canvas,a.canvas)},m=h.default.TOUCH_DRAG_END,s={event:e.srcEvent,viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,lastPoints:a,currentPoints:i,deltaPoints:o,type:m,isTouchEvent:!0},Object(g.default)(t,m,s),2==e.pointers.length-e.changedPointers.length&&(x=!0);break;case"rotatemove":w=!1,clearTimeout(u),k=e.rotation-b,b=e.rotation,m=h.default.TOUCH_ROTATE,s={event:e.srcEvent,viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,rotation:k,type:m},Object(g.default)(t,m,s)}return!1}}function E(e){m.default.disable(e),["touchstart","touchend"].forEach((function(t){e.removeEventListener(t,k)}));var t=Object(v.getToolOptions)(_,e).hammer;t&&t.off("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",k)}t.default={enable:function(e){E(e);var t=f.default.Hammer,n=new t.Manager(e,{inputClass:t.SUPPORT_POINTER_EVENTS?t.PointerEventInput:t.TouchInput}),r=new t.Pan({pointers:0,direction:t.DIRECTION_ALL,threshold:0}),i=new t.Pinch({threshold:0}),a=new t.Rotate({threshold:0});i.recognizeWith(r),i.recognizeWith(a),a.recognizeWith(r);var o=new t.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});o.recognizeWith(r),n.add([o,r,a,i]),n.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",k),m.default.enable(e),["touchstart","touchend"].forEach((function(t){e.addEventListener(t,k,{passive:!1})}));var s=Object(v.getToolOptions)(_,e);s.hammer=n,Object(v.setToolOptions)(_,e,s)},disable:E}},"./eventListeners/wheelEventListener.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./externalModules.js"),a=n("./util/triggerEvent.js"),o=n("./eventListeners/internals/normalizeWheel.js");function s(e){var t=e.currentTarget,n=i.default.cornerstone.getEnabledElement(t);if(n.image&&!(e.deltaY>-1&&e.deltaY<1)){e.preventDefault();var s=e.pageX,l=e.pageY,u=i.default.cornerstone.pageToPixel(t,s,l),c=Object(o.default)(e),d=c.spinX,h=c.spinY,f=c.pixelX,p=c.pixelY,m=h<0?-1:1,g={element:t,viewport:i.default.cornerstone.getViewport(t),detail:e,image:n.image,direction:m,spinX:d,spinY:h,pixelX:f,pixelY:p,pageX:s,pageY:l,imageX:u.x,imageY:u.y};Object(a.default)(t,r.default.MOUSE_WHEEL,g)}}function l(e){e.removeEventListener("wheel",s,{passive:!1})}t.default={enable:function(e){l(e),e.addEventListener("wheel",s,{passive:!1})},disable:l}},"./eventListeners/windowResizeHandler.js":function(e,t,n){"use strict";n.r(t),n.d(t,"forceEnabledElementResize",(function(){return l}));var r,i=n("./store/index.js"),a=n("./externalModules.js"),o=function(){window.removeEventListener("resize",s,!1)};function s(){r||(r=setTimeout((function(){r=null,l()}),66))}var l=function(){i.state.enabledElements.forEach((function(e){a.default.cornerstone.resize(e)}))};t.default={enable:function(){o(),window.addEventListener("resize",s,!1)},disable:o}},"./events.js":function(e,t,n){"use strict";n.r(t),t.default={MOUSE_DOWN:"cornerstonetoolsmousedown",MOUSE_UP:"cornerstonetoolsmouseup",MOUSE_DOWN_ACTIVATE:"cornerstonetoolsmousedownactivate",MOUSE_DRAG:"cornerstonetoolsmousedrag",MOUSE_MOVE:"cornerstonetoolsmousemove",MOUSE_CLICK:"cornerstonetoolsmouseclick",MOUSE_DOUBLE_CLICK:"cornerstonetoolsmousedoubleclick",MOUSE_WHEEL:"cornerstonetoolsmousewheel",TOUCH_START:"cornerstonetoolstouchstart",TOUCH_START_ACTIVE:"cornerstonetoolstouchstartactive",TOUCH_END:"cornerstonetoolstouchend",TOUCH_DRAG:"cornerstonetoolstouchdrag",TOUCH_DRAG_END:"cornerstonetoolstouchdragend",TOUCH_PINCH:"cornerstonetoolstouchpinch",TOUCH_ROTATE:"cornerstonetoolstouchrotate",TOUCH_PRESS:"cornerstonetoolstouchpress",TAP:"cornerstonetoolstap",DOUBLE_TAP:"cornerstonetoolsdoubletap",MULTI_TOUCH_START:"cornerstonetoolsmultitouchstart",MULTI_TOUCH_START_ACTIVE:"cornerstonetoolsmultitouchstartactive",MULTI_TOUCH_DRAG:"cornerstonetoolsmultitouchdrag",KEY_DOWN:"cornerstonetoolskeydown",KEY_UP:"cornerstonetoolskeyup",KEY_PRESS:"cornerstonetoolskeypress",MEASUREMENT_ADDED:"cornerstonetoolsmeasurementadded",MEASUREMENT_MODIFIED:"cornerstonetoolsmeasurementmodified",MEASUREMENT_COMPLETED:"cornerstonetoolsmeasurementcompleted",MEASUREMENT_REMOVED:"cornerstonetoolsmeasurementremoved",TOOL_DEACTIVATED:"cornerstonetoolstooldeactivated",CLIP_STOPPED:"cornerstonetoolsclipstopped",STACK_SCROLL:"cornerstonetoolsstackscroll",STACK_PREFETCH_IMAGE_LOADED:"cornerstonetoolsstackprefetchimageloaded",STACK_PREFETCH_DONE:"cornerstonetoolsstackprefetchdone",LABELMAP_MODIFIED:"cornersontetoolslabelmapmodified"}},"./externalModules.js":function(e,t,n){"use strict";n.r(t);var r=window.cornerstone,i=window.cornerstoneMath,a=window.Hammer;t.default={set cornerstone(e){r=e},get cornerstone(){return r},set cornerstoneMath(e){i=e},get cornerstoneMath(){return i},set Hammer(e){a=e},get Hammer(){return a}}},"./importInternal.js":function(e,t,n){"use strict";n.r(t);var r=n("./lib.js");t.default=function(e){return r.lib[e]}},"./index.js":function(e,t,n){"use strict";n.r(t);var r=n("./tools/annotation/index.js");n.d(t,"AngleTool",(function(){return r.AngleTool})),n.d(t,"ArrowAnnotateTool",(function(){return r.ArrowAnnotateTool})),n.d(t,"BidirectionalTool",(function(){return r.BidirectionalTool})),n.d(t,"CircleRoiTool",(function(){return r.CircleRoiTool})),n.d(t,"CobbAngleTool",(function(){return r.CobbAngleTool})),n.d(t,"EllipticalRoiTool",(function(){return r.EllipticalRoiTool})),n.d(t,"FreehandRoiTool",(function(){return r.FreehandRoiTool})),n.d(t,"LengthTool",(function(){return r.LengthTool})),n.d(t,"ProbeTool",(function(){return r.ProbeTool})),n.d(t,"RectangleRoiTool",(function(){return r.RectangleRoiTool})),n.d(t,"TextMarkerTool",(function(){return r.TextMarkerTool}));var i=n("./tools/segmentation/index.js");n.d(t,"BrushTool",(function(){return i.BrushTool})),n.d(t,"SphericalBrushTool",(function(){return i.SphericalBrushTool})),n.d(t,"RectangleScissorsTool",(function(){return i.RectangleScissorsTool})),n.d(t,"FreehandScissorsTool",(function(){return i.FreehandScissorsTool})),n.d(t,"CircleScissorsTool",(function(){return i.CircleScissorsTool})),n.d(t,"CorrectionScissorsTool",(function(){return i.CorrectionScissorsTool}));var a=n("./tools/index.js");n.d(t,"CrosshairsTool",(function(){return a.CrosshairsTool})),n.d(t,"DoubleTapFitToWindowTool",(function(){return a.DoubleTapFitToWindowTool})),n.d(t,"DragProbeTool",(function(){return a.DragProbeTool})),n.d(t,"EraserTool",(function(){return a.EraserTool})),n.d(t,"FreehandRoiSculptorTool",(function(){return a.FreehandRoiSculptorTool})),n.d(t,"MagnifyTool",(function(){return a.MagnifyTool})),n.d(t,"OverlayTool",(function(){return a.OverlayTool})),n.d(t,"OrientationMarkersTool",(function(){return a.OrientationMarkersTool})),n.d(t,"PanMultiTouchTool",(function(){return a.PanMultiTouchTool})),n.d(t,"PanTool",(function(){return a.PanTool})),n.d(t,"ReferenceLinesTool",(function(){return a.ReferenceLinesTool})),n.d(t,"RotateTool",(function(){return a.RotateTool})),n.d(t,"RotateTouchTool",(function(){return a.RotateTouchTool})),n.d(t,"ScaleOverlayTool",(function(){return a.ScaleOverlayTool})),n.d(t,"StackScrollMouseWheelTool",(function(){return a.StackScrollMouseWheelTool})),n.d(t,"StackScrollMultiTouchTool",(function(){return a.StackScrollMultiTouchTool})),n.d(t,"StackScrollTool",(function(){return a.StackScrollTool})),n.d(t,"WwwcRegionTool",(function(){return a.WwwcRegionTool})),n.d(t,"WwwcTool",(function(){return a.WwwcTool})),n.d(t,"ZoomMouseWheelTool",(function(){return a.ZoomMouseWheelTool})),n.d(t,"ZoomTool",(function(){return a.ZoomTool})),n.d(t,"ZoomTouchPinchTool",(function(){return a.ZoomTouchPinchTool}));var o=n("./init.js");n.d(t,"init",(function(){return o.default}));var s=n("./stackTools/stackPrefetch.js");n.d(t,"stackPrefetch",(function(){return s.default}));var l=n("./stackTools/stackRenderers.js");n.d(t,"stackRenderers",(function(){return l.default}));var u=n("./stackTools/playClip.js");n.d(t,"playClip",(function(){return u.playClip})),n.d(t,"stopClip",(function(){return u.stopClip}));var c=n("./store/index.js");n.d(t,"store",(function(){return c.default})),n.d(t,"getModule",(function(){return c.getModule}));var d=n("./store/getToolForElement.js");n.d(t,"getToolForElement",(function(){return d.default}));var h=n("./store/addTool.js");n.d(t,"addTool",(function(){return h.addTool})),n.d(t,"addToolForElement",(function(){return h.addToolForElement}));var f=n("./store/removeTool.js");n.d(t,"removeTool",(function(){return f.removeTool})),n.d(t,"removeToolForElement",(function(){return f.removeToolForElement}));var p=n("./store/setToolOptions.js");n.d(t,"setToolOptions",(function(){return p.setToolOptions})),n.d(t,"setToolOptionsForElement",(function(){return p.setToolOptionsForElement}));var m=n("./store/setToolMode.js");n.d(t,"setToolActive",(function(){return m.setToolActive})),n.d(t,"setToolActiveForElement",(function(){return m.setToolActiveForElement})),n.d(t,"setToolEnabled",(function(){return m.setToolEnabled})),n.d(t,"setToolEnabledForElement",(function(){return m.setToolEnabledForElement})),n.d(t,"setToolDisabled",(function(){return m.setToolDisabled})),n.d(t,"setToolDisabledForElement",(function(){return m.setToolDisabledForElement})),n.d(t,"setToolPassive",(function(){return m.setToolPassive})),n.d(t,"setToolPassiveForElement",(function(){return m.setToolPassiveForElement}));var g=n("./store/isToolActiveForElement.js");n.d(t,"isToolActiveForElement",(function(){return g.default}));var v=n("./stateManagement/toolState.js");n.d(t,"addToolState",(function(){return v.addToolState})),n.d(t,"getToolState",(function(){return v.getToolState})),n.d(t,"removeToolState",(function(){return v.removeToolState})),n.d(t,"clearToolState",(function(){return v.clearToolState})),n.d(t,"setElementToolStateManager",(function(){return v.setElementToolStateManager})),n.d(t,"getElementToolStateManager",(function(){return v.getElementToolStateManager}));var y=n("./stateManagement/textStyle.js");n.d(t,"textStyle",(function(){return y.default}));var b=n("./stateManagement/toolStyle.js");n.d(t,"toolStyle",(function(){return b.default}));var x=n("./stateManagement/toolColors.js");n.d(t,"toolColors",(function(){return x.default}));var w=n("./stateManagement/toolCoordinates.js");n.d(t,"toolCoordinates",(function(){return w.default}));var _=n("./stateManagement/stackSpecificStateManager.js");n.d(t,"stackSpecificStateManager",(function(){return _.stackSpecificStateManager})),n.d(t,"newStackSpecificToolStateManager",(function(){return _.newStackSpecificToolStateManager})),n.d(t,"addStackStateManager",(function(){return _.addStackStateManager}));var k=n("./stateManagement/loadHandlerManager.js");n.d(t,"loadHandlerManager",(function(){return k.default}));var E=n("./stateManagement/imageIdSpecificStateManager.js");n.d(t,"newImageIdSpecificToolStateManager",(function(){return E.newImageIdSpecificToolStateManager})),n.d(t,"globalImageIdSpecificToolStateManager",(function(){return E.globalImageIdSpecificToolStateManager}));var S=n("./stateManagement/frameOfReferenceStateManager.js");n.d(t,"newFrameOfReferenceSpecificToolStateManager",(function(){return S.newFrameOfReferenceSpecificToolStateManager})),n.d(t,"globalFrameOfReferenceSpecificToolStateManager",(function(){return S.globalFrameOfReferenceSpecificToolStateManager}));var T=n("./eventListeners/windowResizeHandler.js");n.d(t,"forceEnabledElementResize",(function(){return T.forceEnabledElementResize}));var C=n("./orientation/index.js");n.d(t,"orientation",(function(){return C.default}));var I=n("./util/SaveAs.js");n.d(t,"SaveAs",(function(){return I.default}));var A=n("./util/logger.js");n.d(t,"enableLogger",(function(){return A.enable})),n.d(t,"disableLogger",(function(){return A.disable}));var O=n("./thirdParty/register.js");n.d(t,"register",(function(){return O.default}));var D=n("./thirdParty/registerSome.js");n.d(t,"registerSome",(function(){return D.default}));var M=n("./synchronization/wwwcSynchronizer.js");n.d(t,"wwwcSynchronizer",(function(){return M.default}));var N=n("./synchronization/updateImageSynchronizer.js");n.d(t,"updateImageSynchronizer",(function(){return N.default}));var j=n("./synchronization/Synchronizer.js");n.d(t,"Synchronizer",(function(){return j.default}));var F=n("./synchronization/stackScrollSynchronizer.js");n.d(t,"stackScrollSynchronizer",(function(){return F.default}));var R=n("./synchronization/stackImagePositionSynchronizer.js");n.d(t,"stackImagePositionSynchronizer",(function(){return R.default}));var P=n("./synchronization/stackImagePositionOffsetSynchronizer.js");n.d(t,"stackImagePositionOffsetSynchronizer",(function(){return P.default}));var L=n("./synchronization/stackImageIndexSynchronizer.js");n.d(t,"stackImageIndexSynchronizer",(function(){return L.default}));var B=n("./synchronization/panZoomSynchronizer.js");n.d(t,"panZoomSynchronizer",(function(){return B.default}));var $=n("./requestPool/requestPoolManager.js");n.d(t,"requestPoolManager",(function(){return $.default}));var z=n("./externalModules.js");n.d(t,"external",(function(){return z.default}));var U=n("./events.js");n.d(t,"EVENTS",(function(){return U.default}));var H=n("./version.js");n.d(t,"version",(function(){return H.default}));var W=n("./importInternal.js");n.d(t,"importInternal",(function(){return W.default})),n.d(t,"import",(function(){return W.default})),t.default={AngleTool:r.AngleTool,ArrowAnnotateTool:r.ArrowAnnotateTool,BidirectionalTool:r.BidirectionalTool,CircleRoiTool:r.CircleRoiTool,CobbAngleTool:r.CobbAngleTool,EllipticalRoiTool:r.EllipticalRoiTool,FreehandRoiTool:r.FreehandRoiTool,LengthTool:r.LengthTool,ProbeTool:r.ProbeTool,RectangleRoiTool:r.RectangleRoiTool,TextMarkerTool:r.TextMarkerTool,BrushTool:i.BrushTool,SphericalBrushTool:i.SphericalBrushTool,RectangleScissorsTool:i.RectangleScissorsTool,FreehandScissorsTool:i.FreehandScissorsTool,CircleScissorsTool:i.CircleScissorsTool,CorrectionScissorsTool:i.CorrectionScissorsTool,CrosshairsTool:a.CrosshairsTool,DoubleTapFitToWindowTool:a.DoubleTapFitToWindowTool,DragProbeTool:a.DragProbeTool,EraserTool:a.EraserTool,FreehandRoiSculptorTool:a.FreehandRoiSculptorTool,MagnifyTool:a.MagnifyTool,OverlayTool:a.OverlayTool,OrientationMarkersTool:a.OrientationMarkersTool,PanMultiTouchTool:a.PanMultiTouchTool,PanTool:a.PanTool,ReferenceLinesTool:a.ReferenceLinesTool,RotateTool:a.RotateTool,RotateTouchTool:a.RotateTouchTool,ScaleOverlayTool:a.ScaleOverlayTool,StackScrollMouseWheelTool:a.StackScrollMouseWheelTool,StackScrollMultiTouchTool:a.StackScrollMultiTouchTool,StackScrollTool:a.StackScrollTool,WwwcRegionTool:a.WwwcRegionTool,WwwcTool:a.WwwcTool,ZoomMouseWheelTool:a.ZoomMouseWheelTool,ZoomTool:a.ZoomTool,ZoomTouchPinchTool:a.ZoomTouchPinchTool,init:o.default,stackPrefetch:s.default,stackRenderers:l.default,playClip:u.playClip,stopClip:u.stopClip,store:c.default,getModule:c.getModule,getToolForElement:d.default,addTool:h.addTool,addToolForElement:h.addToolForElement,removeTool:f.removeTool,removeToolForElement:f.removeToolForElement,setToolOptions:p.setToolOptions,setToolOptionsForElement:p.setToolOptionsForElement,isToolActiveForElement:g.default,setToolActive:m.setToolActive,setToolActiveForElement:m.setToolActiveForElement,setToolEnabled:m.setToolEnabled,setToolEnabledForElement:m.setToolEnabledForElement,setToolDisabled:m.setToolDisabled,setToolDisabledForElement:m.setToolDisabledForElement,setToolPassive:m.setToolPassive,setToolPassiveForElement:m.setToolPassiveForElement,addToolState:v.addToolState,getToolState:v.getToolState,removeToolState:v.removeToolState,clearToolState:v.clearToolState,setElementToolStateManager:v.setElementToolStateManager,getElementToolStateManager:v.getElementToolStateManager,textStyle:y.default,toolStyle:b.default,toolColors:x.default,toolCoordinates:w.default,stackSpecificStateManager:_.stackSpecificStateManager,newStackSpecificToolStateManager:_.newStackSpecificToolStateManager,addStackStateManager:_.addStackStateManager,loadHandlerManager:k.default,newImageIdSpecificToolStateManager:E.newImageIdSpecificToolStateManager,globalImageIdSpecificToolStateManager:E.globalImageIdSpecificToolStateManager,newFrameOfReferenceSpecificToolStateManager:S.newFrameOfReferenceSpecificToolStateManager,globalFrameOfReferenceSpecificToolStateManager:S.globalFrameOfReferenceSpecificToolStateManager,forceEnabledElementResize:T.forceEnabledElementResize,orientation:C.default,SaveAs:I.default,enableLogger:A.enable,disableLogger:A.disable,importInternal:W.default,import:W.default,register:O.default,registerSome:D.default,wwwcSynchronizer:M.default,updateImageSynchronizer:N.default,Synchronizer:j.default,stackScrollSynchronizer:F.default,stackImagePositionSynchronizer:R.default,stackImagePositionOffsetSynchronizer:P.default,stackImageIndexSynchronizer:L.default,panZoomSynchronizer:B.default,requestPoolManager:$.default,external:z.default,EVENTS:U.default,version:H.default}},"./init.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./store/index.js"),a=n("./store/internals/addEnabledElement.js"),o=n("./store/internals/removeEnabledElement.js"),s=n("./eventListeners/windowResizeHandler.js");function l(){!function(){var e=r.default.cornerstone,t=e.EVENTS.ELEMENT_DISABLED;e.events.removeEventListener(e.EVENTS.ELEMENT_ENABLED,a.default),e.events.removeEventListener(t,o.default)}();var e=r.default.cornerstone,t=e.EVENTS.ELEMENT_DISABLED;e.events.addEventListener(e.EVENTS.ELEMENT_ENABLED,a.default),e.events.addEventListener(t,o.default)}function u(){var e=i.default.modules;Object.keys(e).forEach((function(t){"function"==typeof e[t].onRegisterCallback&&e[t].onRegisterCallback()}))}t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l(),u();var t=Object(i.getModule)("globalConfiguration");Array.isArray(e)?e.forEach((function(e){var t=e.moduleName,n=e.configuration,r=Object(i.getModule)(t);r&&(r.configuration=Object.assign({},r.configuration,n))})):t.configuration=Object.assign({},t.configuration,e),t.configuration.autoResizeViewports&&s.default.enable()}},"./lib.js":function(e,t,n){"use strict";n.r(t),n.d(t,"lib",(function(){return J}));var r=n("./tools/base/BaseTool.js"),i=n("./tools/base/BaseAnnotationTool.js"),a=n("./tools/base/BaseBrushTool.js"),o=n("./manipulators/index.js"),s=n("./util/findAndMoveHelpers.js"),l=n("./mixins/index.js"),u=n("./tools/cursors/index.js"),c=n("./drawing/index.js"),d=n("./util/clip.js"),h=n("./util/debounce.js"),f=n("./util/deepmerge.js"),p=n("./util/getDefault.js"),m=n("./util/getPixelSpacing.js"),g=n("./util/isEmptyObject.js"),v=n("./util/isObject.js"),y=n("./util/isPointInImage.js"),b=n("./util/isPointInPolygon.js"),x=n("./util/throttle.js"),w=n("./util/wait.js"),_=n("./util/getKeyPressData.js"),k=n("./drawing/drawTextBox.js"),E=n("./drawing/drawArrow.js"),S=n("./drawing/drawLink.js"),T=n("./drawing/drawLinkedTextBox.js"),C=n("./drawing/drawHandles.js"),I=n("./util/getLuminance.js"),A=n("./util/getROITextBoxCoords.js"),O=n("./util/copyPoints.js"),D=n("./util/calculateSUV.js"),M=n("./util/setContextToDisplayFontSize.js"),N=n("./util/scrollToIndex.js"),j=n("./util/scroll.js"),F=n("./util/roundToDecimal.js"),R=n("./util/pointProjector.js"),P=n("./util/lineSegDistance.js"),L=n("./util/logger.js"),B=n("./util/pointInsideBoundingBox.js"),$=n("./util/makeUnselectable.js"),z=n("./util/getRGBPixels.js"),U=n("./util/getMaxSimultaneousRequests.js"),H=n("./util/angleBetweenPoints.js"),W=n("./util/numbersWithCommas.js"),V=n("./tools/cursors/MouseCursor.js"),q=n("./util/ellipse/index.js"),G=n("./util/freehand/index.js"),Y=n("./util/segmentation/index.js"),X=n("./util/zoom/index.js"),K=n("./util/triggerEvent.js"),Z=n("./util/convertToVector3.js"),J={"base/BaseTool":r.default,"base/BaseAnnotationTool":i.default,"base/BaseBrushTool":a.default,"tools/cursors/MouseCursor":V.default,"tools/cursors":u,"manipulators/anyHandlesOutsideImage":o.anyHandlesOutsideImage,"manipulators/getHandleNearImagePoint":o.getHandleNearImagePoint,"manipulators/handleActivator":o.handleActivator,"manipulators/moveAllHandles":o.moveAllHandles,"manipulators/moveHandle":o.moveHandle,"manipulators/moveNewHandle":o.moveNewHandle,"manipulators/moveHandleNearImagePoint":s.moveHandleNearImagePoint,"manipulators/findHandleDataNearImagePoint":s.findHandleDataNearImagePoint,"manipulators/moveAnnotation":s.moveAnnotation,"mixins/activeOrDisabledBinaryTool":l.default.activeOrDisabledBinaryTool,"mixins/enabledOrDisabledBinaryTool":l.default.enabledOrDisabledBinaryTool,"drawing/getNewContext":c.getNewContext,"drawing/draw":c.draw,"drawing/path":c.path,"drawing/setShadow":c.setShadow,"drawing/drawLine":c.drawLine,"drawing/drawLines":c.drawLines,"drawing/drawJoinedLines":c.drawJoinedLines,"drawing/drawCircle":c.drawCircle,"drawing/drawEllipse":c.drawEllipse,"drawing/drawRect":c.drawRect,"drawing/fillOutsideRect":c.fillOutsideRect,"drawing/drawTextBox":k.default,"drawing/drawArrow":E.default,"drawing/fillBox":c.fillBox,"drawing/fillTextLines":c.fillTextLines,"drawing/drawLink":S.default,"drawing/drawLinkedTextBox":T.default,"drawing/drawHandles":C.default,"drawing/textBoxWidth":k.textBoxWidth,"util/getLuminance":I.default,"util/getROITextBoxCoords":A.default,"util/copyPoints":O.default,"util/calculateSUV":D.default,"util/setContextToDisplayFontSize":M.default,"util/scrollToIndex":N.default,"util/scroll":j.default,"util/roundToDecimal":F.default,"util/projectPatientPointToImagePlane":R.projectPatientPointToImagePlane,"util/imagePointToPatientPoint":R.imagePointToPatientPoint,"util/planePlaneIntersection":R.planePlaneIntersection,"util/pointInsideBoundingBox":B.default,"util/makeUnselectable":$.default,"util/getRGBPixels":z.default,"util/getDefaultSimultaneousRequests":U.getDefaultSimultaneousRequests,"util/getMaxSimultaneousRequests":U.getMaxSimultaneousRequests,"util/getBrowserInfo":U.getBrowserInfo,"util/isMobileDevice":U.isMobileDevice,"util/angleBetweenPoints":H.default,"util/numbersWithCommas":W.default,"util/lineSegDistance":P.default,"util/triggerEvent":K.default,"util/convertToVector3":Z.default,"util/clip":d.clip,"util/clipToBox":d.clipToBox,"util/debounce":h.default,"util/deepmerge":f.default,"util/getDefault":p.default,"util/getPixelSpacing":m.default,"util/isEmptyObject":g.default,"util/isObject":v.default,"util/isPointInImage":y.default,"util/isPointInPolygon":b.default,"util/getLogger":L.getLogger,"util/throttle":x.default,"util/wait":w.wait,"util/waitForEnabledElementImageToLoad":w.waitForEnabledElementImageToLoad,"util/getKeyPressData":_.default,"util/ellipseUtils":q.default,"util/freehandUtils":G.default,"util/segmentationUtils":Y,"util/zoomUtils":X.default}},"./manipulators/anyHandlesOutsideImage.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t){var n=e.image,i={left:0,top:0,width:n.width,height:n.height},a=!1;return Object.keys(t).forEach((function(e){var n=t[e];!0!==n.allowedOutsideImage&&!1===r.default.cornerstoneMath.point.insideRect(n,i)&&(a=!0)})),a}},"./manipulators/getHandleNearImagePoint.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/typeof.js"),i=n.n(r),a=n("./externalModules.js"),o=n("./util/pointInsideBoundingBox.js"),s=function(e,t,n,r){if(e.hasOwnProperty("pointNearHandle")){if(e.pointNearHandle(t,e,n))return!0}else if(!0===e.hasBoundingBox){if(Object(o.default)(e,n))return!0}else{var i=a.default.cornerstone.pixelToCanvas(t,e);if(a.default.cornerstoneMath.point.distance(i,n)<=r)return!0}return!1};t.default=function e(t,n,r,a){var o;if(n){if(Array.isArray(n))for(var l=Object.keys(n),u=0;u<l.length;u++){var c=n[l[u]];if(c.hasOwnProperty("x")&&c.hasOwnProperty("y")&&s(c,t,r,a)){o=c;break}}else if("object"===i()(n))for(var d=Object.keys(n),h=0;h<d.length;h++){var f=d[h];if(Array.isArray(n[f])){if(o=e(t,n[f],r,a))break}else{var p=n[f];if(s(p,t,r,a)){o=p;break}}}return o}}},"./manipulators/handleActivator.js":function(e,t,n){"use strict";n.r(t);var r=n("./manipulators/getHandleNearImagePoint.js");t.default=function(e,t,n,i){i||(i=6);var a=function(e){var t;return Object.keys(e).forEach((function(n){var r=e[n];!0!==r.active||(t=r)})),t}(t),o=Object(r.default)(e,t,n,i);return a!==o&&(void 0!==o&&(o.active=!0),void 0!==a&&(a.active=!1),!0)}},"./manipulators/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./manipulators/anyHandlesOutsideImage.js");n.d(t,"anyHandlesOutsideImage",(function(){return r.default}));var i=n("./manipulators/getHandleNearImagePoint.js");n.d(t,"getHandleNearImagePoint",(function(){return i.default}));var a=n("./manipulators/handleActivator.js");n.d(t,"handleActivator",(function(){return a.default}));var o=n("./manipulators/moveAllHandles.js");n.d(t,"moveAllHandles",(function(){return o.default}));var s=n("./manipulators/moveHandle.js");n.d(t,"moveHandle",(function(){return s.default}));var l=n("./manipulators/moveNewHandle.js");n.d(t,"moveNewHandle",(function(){return l.default}))},"./manipulators/moveAllHandles.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./externalModules.js"),a=n("./manipulators/anyHandlesOutsideImage.js"),o=n("./stateManagement/toolState.js"),s=n("./util/triggerEvent.js"),l=n("./util/clip.js"),u=n("./store/index.js"),c=n("./util/getActiveTool.js"),d=n("./tools/base/BaseAnnotationTool.js"),h=n("./util/logger.js"),f=Object(h.getLogger)("manipulators:moveAllHandles"),p=Object(u.getModule)("manipulatorState"),m={mouse:[r.default.MOUSE_DRAG],touch:[r.default.TOUCH_DRAG]},g={mouse:[r.default.MOUSE_UP,r.default.MOUSE_CLICK],touch:[r.default.TOUCH_END,r.default.TOUCH_DRAG_END,r.default.TOUCH_PINCH,r.default.TOUCH_PRESS,r.default.TAP]};function v(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,u=o.detail,h=u.element,f=u.image,p=u.buttons,m=o.detail.deltaPoints.image,g=m.x,v=m.y;t.active=!0,t.invalidated=!0;for(var y=Object.keys(t.handles),b=0;b<y.length;b++){var x=y[b],w=t.handles[x];!0!==w.movesIndependently&&w.hasOwnProperty("x")&&w.hasOwnProperty("y")&&(w.x+=g,w.y+=v,n.preventHandleOutsideImage&&Object(l.clipToBox)(w,f))}i.default.cornerstone.updateImage(h);var _=Object(c.default)(h,p,a);_ instanceof d.default&&_.updateCachedStats(f,h,t);var k=r.default.MEASUREMENT_MODIFIED,E={toolName:e,toolType:e,element:h,measurementData:t};Object(s.default)(h,k,E),o.preventDefault(),o.stopPropagation()}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=r.dragHandler,a=r.upOrEndHandler,o=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0;x(e,t,n,{dragHandler:i,upOrEndHandler:a},o,s,!1)}function b(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,s=i.dragHandler,l=i.upOrEndHandler,u=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0,d=u.detail,h=d.element;p.setters.removeActiveManipulatorForElement(h),n.deleteIfHandleOutsideImage&&Object(a.default)(d,t.handles)&&Object(o.removeToolState)(h,e,t),x(t,n,r,{dragHandler:s,upOrEndHandler:l},h,c,!0)}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=r.dragHandler,o=r.upOrEndHandler,s=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0,c=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];e.active=!1,e.invalidated=!0,u.state.isToolLocked=!1,m[n].forEach((function(e){s.removeEventListener(e,a)})),g[n].forEach((function(e){s.removeEventListener(e,o)})),"function"==typeof t.doneMovingCallback&&(f.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),t.doneMovingCallback(c)),"function"==typeof l&&l(c),i.default.cornerstone.updateImage(s)}t.default=function(e,t,n,r){var i=e.element,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",s=arguments.length>6?arguments[6]:void 0;a=Object.assign({deleteIfHandleOutsideImage:u.state.deleteIfHandleOutsideImage,preventHandleOutsideImage:u.state.preventHandleOutsideImage},a);var l=v.bind(this,t,n,a,o),c=function e(r){b(t,n,a,o,{dragHandler:l,upOrEndHandler:e},r,s)};p.setters.addActiveManipulatorForElement(i,y.bind(null,n,a,o,{dragHandler:l,upOrEndHandler:c},i,s)),n.active=!0,u.state.isToolLocked=!0,m[o].forEach((function(e){i.addEventListener(e,l)})),g[o].forEach((function(e){i.addEventListener(e,c)}))}},"./manipulators/moveHandle.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./externalModules.js"),a=n("./manipulators/anyHandlesOutsideImage.js"),o=n("./stateManagement/toolState.js"),s=n("./util/triggerEvent.js"),l=n("./util/clip.js"),u=n("./store/index.js"),c=n("./util/getActiveTool.js"),d=n("./tools/base/BaseAnnotationTool.js"),h=n("./util/logger.js"),f=Object(h.getLogger)("manipulators:moveHandle"),p=Object(u.getModule)("manipulatorState"),m={value:!1},g={mouse:[r.default.MOUSE_DRAG],touch:[r.default.TOUCH_DRAG]},v={mouse:[r.default.MOUSE_UP,r.default.MOUSE_CLICK],touch:[r.default.TOUCH_END,r.default.TOUCH_DRAG_END,r.default.TOUCH_PINCH,r.default.TOUCH_PRESS,r.default.TAP]};function y(e,t,n,a,o,u){var h=u.detail,f=h.image,p=h.element,g=h.buttons,v=h.currentPoints.page,y=i.default.cornerstone.pageToPixel(p,v.x,"touch"===o?v.y+-57:v.y);m.value=!1,n.active=!0,n.hasMoved=!0,n.x=y.x,n.y=y.y,t.invalidated=!0,a.preventHandleOutsideImage&&Object(l.clipToBox)(n,f),i.default.cornerstone.updateImage(p);var b=Object(c.default)(p,g,o);b instanceof d.default&&b.updateCachedStats(f,p,t);var x=r.default.MEASUREMENT_MODIFIED,w={toolName:e,toolType:e,element:p,measurementData:t};Object(s.default)(p,x,w)}function b(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=o.dragHandler,l=o.upOrEndHandler,u=arguments.length>7?arguments[7]:void 0;w(e,t,n,r,i,a,{dragHandler:s,upOrEndHandler:l},u,!1)}function x(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=o.dragHandler,l=o.upOrEndHandler,u=arguments.length>7?arguments[7]:void 0,c=t.element;p.setters.removeActiveManipulatorForElement(c),w(e,t,n,r,i,a,{dragHandler:s,upOrEndHandler:l},u,!0)}function w(e,t,n,r){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},l=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0,d=c.dragHandler,h=c.upOrEndHandler,p=arguments.length>7?arguments[7]:void 0,y=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],b=t.element;r.active=!1,r.moving=!1,n.active=!1,n.invalidated=!0,m.value=!1,u.state.isToolLocked=!1,g[l].forEach((function(e){b.removeEventListener(e,d)})),v[l].forEach((function(e){b.removeEventListener(e,h)})),s.deleteIfHandleOutsideImage&&Object(a.default)(t,n.handles)&&Object(o.removeToolState)(b,e,n),"function"==typeof s.doneMovingCallback&&(f.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),s.doneMovingCallback(y)),"function"==typeof p&&p(y),i.default.cornerstone.updateImage(b)}function _(e,t,n,r){if(t.value){var a=Math.abs(e.y-r.y),o=a/10;if(a<1)return e.y=r.y,void(t.value=!1);e.y>r.y?e.y-=o:e.y<r.y&&(e.y+=o),i.default.cornerstone.updateImage(n.element),i.default.cornerstone.requestAnimationFrame((function(){_(e,t,n,r)}))}}t.default=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",s=arguments.length>6?arguments[6]:void 0;a=Object.assign({deleteIfHandleOutsideImage:u.state.deleteIfHandleOutsideImage,preventHandleOutsideImage:u.state.preventHandleOutsideImage},a);var l=e.element,c=y.bind(this,t,n,r,a,o),d=function i(){x(t,e,n,r,a,o,{dragHandler:c,upOrEndHandler:i},s)};if(p.setters.addActiveManipulatorForElement(l,b.bind(null,t,e,n,r,a,o,{dragHandler:c,upOrEndHandler:d},s)),r.active=!0,r.moving=!0,n.active=!0,u.state.isToolLocked=!0,g[o].forEach((function(e){l.addEventListener(e,c)})),v[o].forEach((function(e){l.addEventListener(e,d)})),"touch"===o){m.value=!0;var h=i.default.cornerstone.getEnabledElement(l),f=-57,w={x:e.currentPoints.page.x,y:e.currentPoints.page.y+f},k=i.default.cornerstone.pageToPixel(l,w.x,w.y);_(r,m,h,k)}}},"./manipulators/moveNewHandle.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./externalModules.js"),a=n("./manipulators/anyHandlesOutsideImage.js"),o=n("./stateManagement/toolState.js"),s=n("./util/triggerEvent.js"),l=n("./util/clip.js"),u=n("./store/index.js"),c=n("./util/getActiveTool.js"),d=n("./tools/base/BaseAnnotationTool.js"),h=n("./util/logger.js"),f=Object(h.getLogger)("manipulators:moveNewHandle"),p=Object(u.getModule)("manipulatorState"),m={mouse:[r.default.MOUSE_MOVE,r.default.MOUSE_DRAG],touch:[r.default.TOUCH_DRAG]},g={mouse:[r.default.MOUSE_UP,r.default.MOUSE_CLICK],touch:[r.default.TOUCH_END,r.default.TOUCH_PINCH,r.default.TAP]};function v(e,t,n,a,o,u){var h=u.detail,f=h.currentPoints,p=h.image,m=h.element,g=h.buttons;a.hasMoved=!0;var v=f.page,y=i.default.cornerstone.pageToPixel(m,"touch"===o?v.x+-57:v.x,"touch"===o?v.y+-57:v.y);t.invalidated=!0,n.active=!0,n.x=y.x,n.y=y.y,a&&a.preventHandleOutsideImage&&Object(l.clipToBox)(n,p),i.default.cornerstone.updateImage(m);var b=Object(c.default)(m,g,o);b instanceof d.default&&b.updateCachedStats(p,m,t);var x=r.default.MEASUREMENT_MODIFIED,w={toolName:e,toolType:e,element:m,measurementData:t};Object(s.default)(m,x,w)}function y(e,t,n,a,o){var s=a.moveHandler,l=a.moveEndHandler,c=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];m[e].forEach((function(e){n.removeEventListener(e,s)})),g[e].forEach((function(e){n.removeEventListener(e,l)})),n.removeEventListener(r.default.TOUCH_START,w),u.state.isToolLocked=!1,"function"==typeof o&&o(c),"function"==typeof t.doneMovingCallback&&(f.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),t.doneMovingCallback(c)),i.default.cornerstone.updateImage(n)}function b(e,t,n,r,s,u,c,d){var h=u.moveHandler,f=u.moveEndHandler,m=c.detail,g=m.element;if(!1!==r.hasMoved){var v=m.currentPoints.page,b=i.default.cornerstone.pageToPixel(g,"touch"===s?v.x+-57:v.x,"touch"===s?v.y+-57:v.y);t.active=!1,t.invalidated=!0,n.active=!1,n.moving=!1,n.x=b.x,n.y=b.y,p.setters.removeActiveManipulatorForElement(g),r.preventHandleOutsideImage&&Object(l.clipToBox)(n,c.detail.image),r.deleteIfHandleOutsideImage&&Object(a.default)(c.detail,t.handles)&&(t.cancelled=!0,Object(o.removeToolState)(g,e,t)),y(s,r,g,{moveHandler:h,moveEndHandler:f},d,!0)}}function x(e,t,n,r,i,a,o){var s=i.moveHandler,l=i.moveEndHandler;e.active=!1,e.invalidated=!0,t.active=!1,y(r,n,a,{moveHandler:s,moveEndHandler:l},o,!1)}function w(e){return e.stopImmediatePropagation(),!1}t.default=function(e,t,n,i,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",s=arguments.length>6?arguments[6]:void 0;(a=Object.assign({deleteIfHandleOutsideImage:u.state.deleteIfHandleOutsideImage,preventHandleOutsideImage:u.state.preventHandleOutsideImage},a)).hasMoved=!1;var l=e.element;function c(e){v(t,n,i,a,o,e)}function d(e){b(t,n,i,a,o,{moveHandler:c,moveEndHandler:d},e,s)}n.active=!0,i.moving=!0,i.active=!0,u.state.isToolLocked=!0,m[o].forEach((function(e){l.addEventListener(e,c)})),l.addEventListener(r.default.TOUCH_START,w),g[o].forEach((function(e){l.addEventListener(e,d)})),p.setters.addActiveManipulatorForElement(l,x.bind(null,n,i,a,o,{moveHandler:c,moveEndHandler:d},l,s))}},"./mixins/activeOrDisabledBinaryTool.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/setToolMode.js");t.default={passiveCallback:function(e){Object(r.setToolDisabledForElement)(e,this.name)},enabledCallback:function(e){Object(r.setToolActiveForElement)(e,this.name)}}},"./mixins/enabledOrDisabledBinaryTool.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/setToolMode.js");t.default={passiveCallback:function(e){Object(r.setToolDisabledForElement)(e,this.name)},activeCallback:function(e){Object(r.setToolEnabledForElement)(e,this.name)}}},"./mixins/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./mixins/activeOrDisabledBinaryTool.js"),i=n("./mixins/enabledOrDisabledBinaryTool.js"),a=n("./mixins/segmentation/circleSegmentationMixin.js"),o=n("./mixins/segmentation/polylineSegmentationMixin.js"),s=n("./mixins/segmentation/freehandSegmentationMixin.js"),l=n("./mixins/segmentation/rectangleSegmentationMixin.js"),u=n("./mixins/segmentation/renderBrushMixin.js");t.default={activeOrDisabledBinaryTool:r.default,enabledOrDisabledBinaryTool:i.default,circleSegmentationMixin:a.default,polylineSegmentationMixin:o.default,freehandSegmentationMixin:s.default,rectangleSegmentationMixin:l.default,renderBrushMixin:u.default}},"./mixins/segmentation/circleSegmentationMixin.js":function(e,t,n){"use strict";n.r(t);var r=n("./drawing/index.js"),i=n("./externalModules.js"),a=n("./util/isEmptyObject.js"),o=n("./store/index.js"),s=n("./util/segmentation/index.js"),l=Object(o.getModule)("segmentation"),u=l.getters,c=l.setters;function d(){this.handles={start:{},end:{}}}function h(e){var t=e.detail.element,n=e.detail.currentPoints.image;return Object(a.default)(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),i.default.cornerstone.updateImage(t),!0}function f(e){var t=e.detail,n=t.element;this.handles.end=t.currentPoints.image,i.default.cornerstone.updateImage(n)}function p(e){e.detail.handles=this.handles;var t=e.detail.element,n=u.labelmap2D(t),r=n.labelmap2D,a=n.labelmap3D,o=n.currentImageIdIndex,l=r.pixelData,d=l.slice();this.applyActiveStrategy(e,{points:{start:{x:this.handles.start.x,y:this.handles.start.y},end:{x:this.handles.end.x,y:this.handles.end.y}},pixelData:l,segmentIndex:a.activeSegmentIndex,segmentationMixinType:"circleSegmentationMixin"});var h={imageIdIndex:o,diff:Object(s.getDiffBetweenPixelData)(d,l)};c.pushState(this.element,[h]),c.updateSegmentsOnLabelmap2D(r),i.default.cornerstone.updateImage(t),this._resetHandles()}t.default={postTouchStartCallback:h,postMouseDownCallback:h,mouseClickCallback:h,touchDragCallback:f,mouseDragCallback:f,mouseMoveCallback:f,touchEndCallback:p,mouseUpCallback:p,initializeMixin:d,renderToolData:function(e){var t=this,n=e.detail,a=n.element,o=u.brushColor(a,!0),s=Object(r.getNewContext)(n.canvasContext.canvas),l=i.default.cornerstoneMath.point.distance;Object(r.draw)(s,(function(e){if(!t.handles)return null;var n=i.default.cornerstone.pixelToCanvas(a,t.handles.start),s=i.default.cornerstone.pixelToCanvas(a,t.handles.end),u=l(n,s);Object(r.drawCircle)(e,a,t.handles.start,u,{color:o})}))},_resetHandles:d,_applyStrategy:p}},"./mixins/segmentation/freehandSegmentationMixin.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=n.n(r),a=n("./externalModules.js"),o=n("./store/index.js"),s=n("./util/logger.js"),l=n("./drawing/index.js"),u=n("./util/segmentation/index.js"),c=Object(s.getLogger)("tools:ScissorsTool"),d=Object(o.getModule)("segmentation"),h=d.getters,f=d.setters;function p(e){var t=e.detail.element,n=e.detail.currentPoints.image,r=this.handles.points;if(!r.length)return c.warn("Something went wrong, empty handles detected."),null;r.push({x:n.x,y:n.y,lines:[]}),this.currentHandle+=1,a.default.cornerstone.updateImage(t)}function m(e){var t=e.detail.element;this._addPoint(e.detail),a.default.cornerstone.updateImage(t)}function g(e){var t=this.handles.points,n=e.detail.element,r=h.labelmap2D(n),i=r.labelmap2D,o=r.labelmap3D,s=r.currentImageIdIndex,l=i.pixelData,c=l.slice();this.applyActiveStrategy(e,{points:t,pixelData:l,segmentIndex:o.activeSegmentIndex,segmentationMixinType:"freehandSegmentationMixin"});var d={imageIdIndex:s,diff:Object(u.getDiffBetweenPixelData)(c,l)};f.pushState(this.element,[d]),f.updateSegmentsOnLabelmap2D(i),a.default.cornerstone.updateImage(n),this._resetHandles()}function v(){this.handles={points:[]},this.currentHandle=0}t.default={postTouchStartCallback:p,postMouseDownCallback:p,mouseClickCallback:p,touchDragCallback:m,mouseDragCallback:m,mouseMoveCallback:m,touchEndCallback:g,mouseUpCallback:g,initializeMixin:v,renderToolData:function(e){var t=e.detail,n=t.element,r=h.brushColor(n,!0),a=Object(l.getNewContext)(t.canvasContext.canvas),o=this.handles.points;o.length<2||Object(l.draw)(a,(function(e){for(var t=0;t<o.length;t++){var a=i()(o[t].lines);t===o.length-1&&a.push(o[0]),Object(l.drawJoinedLines)(e,n,o[t],a,{color:r})}}))},_resetHandles:v,_addPoint:function(e){var t=this.handles.points;t.length&&t[this.currentHandle-1].lines.push({x:e.currentPoints.image.x,y:e.currentPoints.image.y,lines:[]}),t.push({x:e.currentPoints.image.x,y:e.currentPoints.image.y,lines:[]}),this.currentHandle+=1,a.default.cornerstone.updateImage(e.element)},_applyStrategy:g}},"./mixins/segmentation/polylineSegmentationMixin.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=n.n(r),a=n("./drawing/index.js"),o=n("./store/index.js"),s=n("./mixins/segmentation/freehandSegmentationMixin.js"),l=Object(o.getModule)("segmentation").getters,u=Object.assign({},s.default,{renderToolData:function(e){var t=this,n=e.detail,r=n.element,o=l.brushColor(r,!0),s=Object(a.getNewContext)(n.canvasContext.canvas),u=this.handles;Object(a.draw)(s,(function(e){if(u.points.length>1)for(var n=0;n<u.points.length;n++){var s=i()(u.points[n].lines);Object(a.drawJoinedLines)(e,r,t.handles.points[n],s,{color:o})}}))}});t.default=u},"./mixins/segmentation/rectangleSegmentationMixin.js":function(e,t,n){"use strict";n.r(t);var r=n("./drawing/index.js"),i=n("./externalModules.js"),a=n("./util/isEmptyObject.js"),o=n("./store/index.js"),s=n("./util/segmentation/index.js"),l=Object(o.getModule)("segmentation"),u=l.getters,c=l.setters;function d(e){var t=e.detail.element,n=e.detail.currentPoints.image;return Object(a.default)(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),i.default.cornerstone.updateImage(t),!0}function h(e){var t=e.detail,n=t.element;this.handles.end=t.currentPoints.image,i.default.cornerstone.updateImage(n)}function f(e){e.detail.handles=this.handles;var t=e.detail.element,n=u.labelmap2D(t),r=n.labelmap2D,a=n.labelmap3D,o=n.currentImageIdIndex,l=r.pixelData,d=l.slice();this.applyActiveStrategy(e,{points:[{x:this.handles.start.x,y:this.handles.start.y},{x:this.handles.end.x,y:this.handles.end.y}],pixelData:l,segmentIndex:a.activeSegmentIndex,segmentationMixinType:"rectangleSegmentationMixin"});var h={imageIdIndex:o,diff:Object(s.getDiffBetweenPixelData)(d,l)};c.pushState(this.element,[h]),c.updateSegmentsOnLabelmap2D(r),i.default.cornerstone.updateImage(t),this._resetHandles()}function p(){this.handles={start:{},end:{}}}t.default={postTouchStartCallback:d,postMouseDownCallback:d,mouseClickCallback:d,touchDragCallback:h,mouseDragCallback:h,mouseMoveCallback:h,touchEndCallback:f,mouseUpCallback:f,initializeMixin:p,renderToolData:function(e){var t=this,n=e.detail,i=n.element,a=u.brushColor(i,!0),o=Object(r.getNewContext)(n.canvasContext.canvas);Object(r.draw)(o,(function(e){Object(r.drawRect)(e,i,t.handles.start,t.handles.end,{color:a})}))},_resetHandles:p,_applyStrategy:f}},"./mixins/segmentation/renderBrushMixin.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./store/index.js");t.default={renderBrush:function(e){var t,n=r.default.cornerstone,a=Object(i.getModule)("segmentation"),o=a.getters,s=a.configuration,l=e.detail,u=l.viewport;if(this._drawing?t=this._lastImageCoords:this._mouseUpRender?(t=this._lastImageCoords,this._mouseUpRender=!1):t=i.default.state.mousePositionImage,t){var c=l.image,d=t.x,h=t.y;if(!(d<0||d>c.columns||h<0||h>c.rows)){var f=s.radius,p=l.canvasContext,m=l.element,g=o.brushColor(m,this._drawing);p.setTransform(1,0,0,1,0,0);var v=f*u.scale,y=n.pixelToCanvas(m,t);p.beginPath(),p.strokeStyle=g,p.ellipse(y.x,y.y,v,v,0,0,2*Math.PI),p.stroke()}}}}},"./orientation/getOrientationString.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./util/convertToVector3.js");t.default=function(e){for(var t=Object(i.default)(e),n="",a=t.x<0?"R":"L",o=t.y<0?"A":"P",s=t.z<0?"F":"H",l=new r.default.cornerstoneMath.Vector3(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z)),u=1e-4,c=0;c<3;c++)if(l.x>u&&l.x>l.y&&l.x>l.z)n+=a,l.x=0;else if(l.y>u&&l.y>l.x&&l.y>l.z)n+=o,l.y=0;else if(l.z>u&&l.z>l.x&&l.z>l.y)n+=s,l.z=0;else if(l.x>u&&l.y>u&&l.x===l.y)n+=a+o,l.x=0,l.y=0;else if(l.x>u&&l.z>u&&l.x===l.z)n+=a+s,l.x=0,l.z=0;else{if(!(l.y>u&&l.z>u&&l.y===l.z))break;n+=o+s,l.y=0,l.z=0}return n}},"./orientation/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./orientation/getOrientationString.js"),i=n("./orientation/invertOrientationString.js");t.default={getOrientationString:r.default,invertOrientationString:i.default}},"./orientation/invertOrientationString.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=e.replace("H","f");return(t=(t=(t=(t=(t=t.replace("F","h")).replace("R","l")).replace("L","r")).replace("A","p")).replace("P","a")).toUpperCase()}},"./requestPool/requestPoolManager.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./util/getMaxSimultaneousRequests.js"),a={interaction:[],thumbnail:[],prefetch:[]},o={interaction:0,thumbnail:0,prefetch:0},s={interaction:6,thumbnail:6,prefetch:5},l=!1;function u(){l&&setTimeout((function(){d()}),20)}function c(e){var t=r.default.cornerstone,n=e.type;o[n]++,l=!0;var i=e.imageId,a=e.doneCallback,s=e.failCallback,c=t.imageCache.getImageLoadObject(i);if(c)c.promise.then((function(e){o[n]--,a(e),u()}),(function(e){o[n]--,s(e),u()}));else{var d=function(e){return"prefetch"===e.type?-5:"interactive"===e.type?0:"thumbnail"===e.type?5:void 0}(e);(!0===e.preventCache?t.loadImage(i,{priority:d,type:e.type}):t.loadAndCacheImage(i,{priority:d,type:e.type})).then((function(e){o[n]--,a(e),u()}),(function(e){o[n]--,s(e),u()}))}}function d(){var e=Object(i.getMaxSimultaneousRequests)();s={interaction:Math.max(e,1),thumbnail:Math.max(e-2,1),prefetch:Math.max(e-1,1)};for(var t=e-(o.interaction+o.thumbnail+o.prefetch),n=0;n<t;n++){var r=a.interaction.length&&o.interaction<s.interaction?a.interaction.shift():a.thumbnail.length&&o.thumbnail<s.thumbnail?a.thumbnail.shift():a.prefetch.length&&o.prefetch<s.prefetch?a.prefetch.shift():(a.interaction.length||a.thumbnail.length||a.prefetch.length||(l=!1),!1);r&&c(r)}}t.default={addRequest:function(e,t,n,i,o,s,u){if(!a.hasOwnProperty(n))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");if(e&&t){var c={type:n,imageId:t,preventCache:i,doneCallback:o,failCallback:s},d=r.default.cornerstone.imageCache.getImageLoadObject(t);d?d.promise.then((function(e){o(e)}),(function(e){s(e)})):(u?a[n].unshift(c):a[n].push(c),l=!0)}},clearRequestStack:function(e){if(!a.hasOwnProperty(e))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");a[e]=[]},startGrabbing:d,getRequestPool:function(){return a}}},"./stackTools/fusionRenderer.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("./externalModules.js"),l=n("./stateManagement/toolState.js"),u=function(){function e(){i()(this,e),this.currentImageIdIndex=0,this.layerIds=[],this.findImageFn=void 0}return o()(e,[{key:"render",value:function(e,t){var n=this;if(!Number.isInteger(this.currentImageIdIndex))throw new Error("FusionRenderer: render - Image ID Index is not an integer");if(!this.findImageFn)throw new Error("No findImage function has been defined");t||(t=Object(l.getToolState)(e,"stack").data);var r=s.default.cornerstone,i=t[0],a=i.imageIds[this.currentImageIdIndex],o=t.slice(1,t.length);r.loadAndCacheImage(a).then((function(t){var s=n.layerIds[0];s?r.setLayerImage(e,t,s):(s=r.addLayer(e,t,i.options),n.layerIds.push(s)),r.displayImage(e,t),o.forEach((function(t,i){var o=n.findImageFn(t.imageIds,a),l=n.layerIds[i+1];l||(l=r.addLayer(e,void 0,t.options),n.layerIds.push(l)),o?r.loadAndCacheImage(o).then((function(t){r.setLayerImage(e,t,l),r.updateImage(e)})):(r.setLayerImage(e,void 0,l),r.setActiveLayer(e,s),r.updateImage(e))}))}))}}]),e}()},"./stackTools/playClip.js":function(e,t,n){"use strict";n.r(t),n.d(t,"playClip",(function(){return c})),n.d(t,"stopClip",(function(){return d}));var r=n("./events.js"),i=n("./externalModules.js"),a=n("./stateManagement/loadHandlerManager.js"),o=n("./stateManagement/toolState.js"),s=n("./util/triggerEvent.js"),l="playClip";function u(e){var t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}function c(e,t){var n,c;if(void 0===e)throw new Error("playClip: element must not be undefined");var d=Object(o.getToolState)(e,"stack");if(d&&d.data&&d.data.length){var h,f=i.default.cornerstone;if(d.data.length>1){var p=Object(o.getToolState)(e,"stackRenderer");p&&p.data&&p.data.length&&(h=p.data[0])}var m=d.data[0],g=Object(o.getToolState)(e,l);g&&g.data&&g.data.length?u(n=g.data[0]):(n={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0},Object(o.addToolState)(e,l,n)),(t<0||t>0)&&(n.framesPerSecond=Number(t),n.reverse=n.framesPerSecond<0,n.ignoreFrameTimeVector=!0),!0!==n.ignoreFrameTimeVector&&n.frameTimeVector&&n.frameTimeVector.length===m.imageIds.length&&(c=function(e,t){var n,r,i,a=0,o=e.length,s=[];for(s.isTimeVarying=!1,("number"!=typeof t||t<=0)&&(t=1),n=1;n<o;n++)i=Number(e[n])/t|0,s.push(i),1===n?r=i:i!==r&&(s.isTimeVarying=!0),a+=i;return s.length>0&&s.push(i=s.isTimeVarying?a/s.length|0:s[0]),s}(n.frameTimeVector,n.speed));var v=function(){var t,i,o,l=m.currentImageIdIndex,c=m.imageIds.length;if(n.reverse?l--:l++,!n.loop&&(l<0||l>=c))return u(n),void function(e){var t={element:e};Object(s.default)(e,r.default.CLIP_STOPPED,t)}(e);l>=c&&(l=0),l<0&&(l=c-1),l!==m.currentImageIdIndex&&(t=a.default.getStartLoadHandler(e),i=a.default.getEndLoadHandler(e),o=a.default.getErrorLoadingHandler(e),t&&t(e),(!0===m.preventCache?f.loadImage(m.imageIds[l]):f.loadAndCacheImage(m.imageIds[l])).then((function(t){try{m.currentImageIdIndex=l,h?(h.currentImageIdIndex=l,h.render(e,d.data)):f.displayImage(e,t),i&&i(e,t)}catch(n){return}}),(function(t){o&&o(e,m.imageIds[l],t)})))};c&&c.length>0&&c.isTimeVarying?(n.usingFrameTimeVector=!0,n.intervalId=setTimeout((function e(){n.intervalId=setTimeout(e,c[m.currentImageIdIndex]),v()}),0)):(n.usingFrameTimeVector=!1,n.intervalId=setInterval(v,1e3/Math.abs(n.framesPerSecond)))}}function d(e){var t=Object(o.getToolState)(e,l);t&&t.data&&t.data.length&&u(t.data[0])}},"./stackTools/stackPrefetch.js":function(e,t,n){"use strict";n.r(t);var r,i=n("./externalModules.js"),a=n("./requestPool/requestPoolManager.js"),o=n("./stateManagement/loadHandlerManager.js"),s=n("./stateManagement/toolState.js"),l=n("./util/getMaxSimultaneousRequests.js"),u=n("./util/logger.js"),c=n("./util/triggerEvent.js"),d=n("./events.js"),h=Object(u.getLogger)("stackTools:stackPrefetch"),f="stackPrefetch",p="prefetch",m={maxImagesToPrefetch:1/0,preserveExistingPool:!1};function g(e,t){e=Math.round(e)||0;var n=[],r=(t=Math.round(t)||0)-e+1;if(r<=0)return n;for(;r--;)n[r]=t--;return n}var v=function(e){return Math.max.apply(null,e)},y=function(e){return Math.min.apply(null,e)};function b(e){var t=Object(s.getToolState)(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0],r=Object(s.getToolState)(e,f);if(r){var l=r.data[0]||{};if(l.indicesToRequest&&l.indicesToRequest.length||(l.enabled=!1),!1!==l.enabled&&(r.data[0].indicesToRequest.sort((function(e,t){return e-t})),l.indicesToRequest.slice().forEach((function(e){var t=n.imageIds[e];t&&i.default.cornerstone.imageCache.getImageLoadObject(t)&&R(e)})),l.indicesToRequest.length)){m.preserveExistingPool||a.default.clearRequestStack(p);for(var u,g,b,x,w,_,k=(g=n.currentImageIdIndex,b=[],x=[],(u=l.indicesToRequest).forEach((function(e){e<g?b.push(e):e>g&&x.push(e)})),{low:u.indexOf(v(b)),high:u.indexOf(y(x))}),E=o.default.getErrorLoadingHandler(e),S=k.low,T=k.high,C=[];S>=0||T<l.indicesToRequest.length;){var I=n.currentImageIdIndex,A=!(I-l.indicesToRequest[S]>m.maxImagesToPrefetch)&&S>=0,O=!(l.indicesToRequest[T]-I>m.maxImagesToPrefetch)&&T<l.indicesToRequest.length;if(!O&&!A)break;A&&(_=l.indicesToRequest[S--],C.push(w=n.imageIds[_])),O&&(_=l.indicesToRequest[T++],C.push(w=n.imageIds[_]))}var D=!0,M=!1,N=void 0;try{for(var j,F=C.reverse()[Symbol.iterator]();!(D=(j=F.next()).done);D=!0)a.default.addRequest(e,j.value,p,!1,P,L,!0)}catch(B){M=!0,N=B}finally{try{D||null==F.return||F.return()}finally{if(M)throw N}}a.default.startGrabbing()}}}function R(e){var t=l.indicesToRequest.indexOf(e);t>-1&&l.indicesToRequest.splice(t,1)}function P(t){h.log("prefetch done: %s",t.imageId);var r=n.imageIds.indexOf(t.imageId);R(r),Object(c.default)(e,d.default.STACK_PREFETCH_IMAGE_LOADED,{element:e,imageId:t.imageId,imageIndex:r,stackPrefetch:l,stack:n}),l.indicesToRequest&&l.indicesToRequest.length>0||Object(c.default)(e,d.default.STACK_PREFETCH_DONE,{element:e,stackPrefetch:l,stack:n})}function L(t){h.log("prefetch errored: %o",t),E&&E(e,w,t,"stackPrefetch")}}function x(e){return function(t){var n,r=t.detail;try{n=Object(s.getToolState)(e,"stack")}catch(o){return}if(n&&n.data&&n.data.length){var i=n.data[0].imageIds.indexOf(r.imageId);if(!(i<0)){var a=Object(s.getToolState)(e,f);a&&a.data&&a.data.length&&a.data[0].indicesToRequest.push(i)}}}}function w(e){clearTimeout(r),r=setTimeout((function(){var t=e.target;try{b(t)}catch(n){return}}),10)}t.default={enable:function(e){Object(s.getToolState)(e,f).data=[];var t=Object(s.getToolState)(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];if(!0!==n.preventCache){var r={indicesToRequest:g(0,n.imageIds.length-1),enabled:!0,direction:1},a=r.indicesToRequest.indexOf(n.currentImageIdIndex);r.indicesToRequest.splice(a,1),Object(s.addToolState)(e,f,r),b(e),e.removeEventListener(i.default.cornerstone.EVENTS.NEW_IMAGE,w),e.addEventListener(i.default.cornerstone.EVENTS.NEW_IMAGE,w);var o=x(e);i.default.cornerstone.events.removeEventListener(i.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,o),i.default.cornerstone.events.addEventListener(i.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,o)}else h.warn("A stack that should not be cached was given the stackPrefetch")}},disable:function(e){clearTimeout(r),e.removeEventListener(i.default.cornerstone.EVENTS.NEW_IMAGE,w);var t=x(e);i.default.cornerstone.events.removeEventListener(i.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,t);var n=Object(s.getToolState)(e,f);n&&n.data.length&&(n.data[0].enabled=!1,a.default.clearRequestStack(p))},getConfiguration:function(){return m},setConfiguration:function(e){m=e,e.maxSimultaneousRequests&&Object(l.setMaxSimultaneousRequests)(e.maxSimultaneousRequests)}}},"./stackTools/stackRenderers.js":function(e,t,n){"use strict";n.r(t);var r=n("./stackTools/fusionRenderer.js"),i={};i.FusionRenderer=r.default,t.default=i},"./stateManagement/frameOfReferenceStateManager.js":function(e,t,n){"use strict";function r(){var e={};return{get:function(t,n){if(!1!==e.hasOwnProperty(t)){var r=e[t];if(!1!==r.hasOwnProperty(n))return r[n]}},add:function(t,n,r){!1===e.hasOwnProperty(t)&&(e[t]={});var i=e[t];!1===i.hasOwnProperty(n)&&(i[n]={data:[]}),i[n].data.push(r)},remove:function(t,n,r){if(!1!==e.hasOwnProperty(t)){var i=e[t];if(!1!==i.hasOwnProperty(n)){for(var a=i[n],o=-1,s=0;s<a.data.length;s++)a.data[s]===r&&(o=s);-1!==o&&a.data.splice(o,1)}}}}}n.r(t),n.d(t,"newFrameOfReferenceSpecificToolStateManager",(function(){return r})),n.d(t,"globalFrameOfReferenceSpecificToolStateManager",(function(){return i}));var i=r()},"./stateManagement/imageIdSpecificStateManager.js":function(e,t,n){"use strict";n.r(t),n.d(t,"newImageIdSpecificToolStateManager",(function(){return i})),n.d(t,"globalImageIdSpecificToolStateManager",(function(){return a}));var r=n("./externalModules.js");function i(){var e={};function t(t,n,r){!1===e.hasOwnProperty(t)&&(e[t]={});var i=e[t];!1===i.hasOwnProperty(n)&&(i[n]={data:[]}),i[n].data.push(r)}function n(t,n){if(!1!==e.hasOwnProperty(t)){var r=e[t];if(!1!==r.hasOwnProperty(n))return r[n]}}function i(t){!1!==e.hasOwnProperty(t)&&delete e[t]}return{get:function(e,t){var i=r.default.cornerstone.getEnabledElement(e);if(i.image)return n(i.image.imageId,t)},add:function(e,n,i){var a=r.default.cornerstone.getEnabledElement(e);a.image&&t(a.image.imageId,n,i)},clear:function(e){var t=r.default.cornerstone.getEnabledElement(e);t.image&&i(t.image.imageId)},getImageIdToolState:n,addImageIdToolState:t,clearImageIdToolState:i,saveImageIdToolState:function(t){return e[t]},restoreImageIdToolState:function(t,n){e[t]=n},saveToolState:function(){return e},restoreToolState:function(t){e=t},toolState:e}}var a=i()},"./stateManagement/loadHandlerManager.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i={},a={},o={};function s(e){if(!e)return"DEFAULT";var t=r.default.cornerstone.getEnabledElement(e).uuid;if(!t)throw new Error("Something went wrong when getting uuid from element");return t}t.default={setStartLoadHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=s(t);i[n]=e},getStartLoadHandler:function(e){var t=s(e);return i[t]||i.DEFAULT},setEndLoadHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=s(t);a[n]=e},getEndLoadHandler:function(e){var t=s(e);return a[t]||a.DEFAULT},setErrorLoadingHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=s(t);o[n]=e},getErrorLoadingHandler:function(e){var t=s(e);return o[t]||o.DEFAULT},removeHandlers:function(e){var t=s(e);delete i[t],delete a[t],delete o[t]}}},"./stateManagement/stackSpecificStateManager.js":function(e,t,n){"use strict";n.r(t),n.d(t,"stackSpecificStateManager",(function(){return l})),n.d(t,"newStackSpecificToolStateManager",(function(){return a})),n.d(t,"addStackStateManager",(function(){return s}));var r=n("./stateManagement/imageIdSpecificStateManager.js"),i=n("./stateManagement/toolState.js");function a(e,t){var n={};return{get:function(r,i){return e.indexOf(i)>=0?(!1===n.hasOwnProperty(i)&&(n[i]={data:[]}),n[i]):t.get(r,i)},add:function(r,i,a){if(!(e.indexOf(i)>=0))return t.add(r,i,a);!1===n.hasOwnProperty(i)&&(n[i]={data:[]}),n[i].data.push(a)},saveToolState:function(){return n},restoreToolState:function(e){n=e},toolState:n}}var o=[];function s(e,t){var n=Object(i.getElementToolStateManager)(e);n||(n=r.globalImageIdSpecificToolStateManager);var s=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs","stackRenderer"];t&&(s=s.concat(t));var l=a(s,n);o.push(l),Object(i.setElementToolStateManager)(e,l)}var l={newStackSpecificToolStateManager:a,addStackStateManager:s}},"./stateManagement/textStyle.js":function(e,t,n){"use strict";n.r(t);var r=15,i="".concat(r,"px Arial"),a="transparent";t.default={setFont:function(e){i=e},getFont:function(){return i},setFontSize:function(e){r=e},getFontSize:function(){return r},setBackgroundColor:function(e){a=e},getBackgroundColor:function(){return a}}},"./stateManagement/toolColors.js":function(e,t,n){"use strict";n.r(t);var r="white",i="greenyellow",a="transparent";t.default={setFillColor:function(e){a=e},getFillColor:function(){return a},setToolColor:function(e){r=e},getToolColor:function(){return r},setActiveColor:function(e){i=e},getActiveColor:function(){return i},getColorIfActive:function(e){return e.color?e.color:e.active?i:r}}},"./stateManagement/toolCoordinates.js":function(e,t,n){"use strict";var r;n.r(t),t.default={setCoords:function(e){r=e.currentPoints.canvas},getCoords:function(){return r}}},"./stateManagement/toolState.js":function(e,t,n){"use strict";n.r(t),n.d(t,"addToolState",(function(){return u})),n.d(t,"getToolState",(function(){return c})),n.d(t,"removeToolState",(function(){return d})),n.d(t,"clearToolState",(function(){return h})),n.d(t,"setElementToolStateManager",(function(){return f})),n.d(t,"getElementToolStateManager",(function(){return l}));var r=n("./events.js"),i=n("./externalModules.js"),a=n("./stateManagement/imageIdSpecificStateManager.js"),o=n("./util/triggerEvent.js"),s=n("./util/uuidv4.js");function l(e){var t=i.default.cornerstone.getEnabledElement(e);return void 0===t.toolStateManager&&(t.toolStateManager=a.globalImageIdSpecificToolStateManager),t.toolStateManager}function u(e,t,n){var i=l(e);n.uuid=n.uuid||Object(s.default)(),i.add(e,t,n);var a=r.default.MEASUREMENT_ADDED,u={toolName:t,toolType:t,element:e,measurementData:n};Object(o.default)(e,a,u)}function c(e,t){return l(e).get(e,t)}function d(e,t,n){var i=l(e).get(e,t);if(i&&i.data&&i.data.length){for(var a=-1,s=0;s<i.data.length;s++)i.data[s]===n&&(a=s);if(-1!==a){i.data.splice(a,1);var u=r.default.MEASUREMENT_REMOVED,c={toolName:t,toolType:t,element:e,measurementData:n};Object(o.default)(e,u,c)}}}function h(e,t){var n=l(e).get(e,t);void 0!==n&&(n.data=[])}function f(e,t){i.default.cornerstone.getEnabledElement(e).toolStateManager=t}},"./stateManagement/toolStyle.js":function(e,t,n){"use strict";n.r(t);var r=1,i=2;t.default={setToolWidth:function(e){r=e},getToolWidth:function(){return r},setActiveWidth:function(e){i=e},getActiveWidth:function(){return i}}},"./store/addTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"addTool",(function(){return l})),n.d(t,"addToolForElement",(function(){return s}));var r=n("./store/index.js"),i=n("./store/getToolForElement.js"),a=n("./util/logger.js"),o=Object(a.getLogger)("addTool"),s=function(e,t,n){var a=new t(n);Object(i.default)(e,a.name)?o.warn("%s has already been added to the target element",a.name):(a.element=e,r.default.state.tools.push(a))},l=function(e,t){u(e,t),r.default.state.enabledElements.forEach((function(n){s(n,e,t)}))},u=function(e,t){if(Object(r.getModule)("globalConfiguration").configuration.globalToolSyncEnabled){var n=new e(t);void 0!==r.default.state.globalTools[n.name]?o.warn("%s has already been added globally",n.name):r.default.state.globalTools[n.name]={tool:e,props:t,activeBindings:[]}}}},"./store/filterToolsUsableWithMultiPartTools.js":function(e,t,n){"use strict";n.r(t);var r=n("./tools/base/BaseAnnotationTool.js"),i=n("./tools/base/BaseBrushTool.js");t.default=function(e){return e.filter((function(e){return!(e.isMultiPartTool||e instanceof r.default||e instanceof i.default)}))}},"./store/getActiveToolsForElement.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){return t.filter((function(t){return t.element===e&&"active"===t.mode&&(void 0===n||t.options["is".concat(n,"Active")])}))}},"./store/getInteractiveToolsForElement.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){return t.filter((function(t){return t.element===e&&("active"===t.mode||"passive"===t.mode)}))}},"./store/getToolForElement.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js");t.default=function(e,t){return r.state.tools.find((function(n){return n.element===e&&n.name===t}))}},"./store/getToolsWithDataForElement.js":function(e,t,n){"use strict";n.r(t);var r=n("./stateManagement/toolState.js");t.default=function(e,t){return t.filter((function(t){var n=Object(r.getToolState)(e,t.name);return n&&n.data.length>0}))}},"./store/getToolsWithMoveableHandles.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./stateManagement/toolState.js"),a=n("./manipulators/getHandleNearImagePoint.js");t.default=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",s="mouse"===o?r.state.clickProximity:r.state.touchProximity;return t.filter((function(t){for(var r=Object(i.getToolState)(e,t.name),o=0;o<r.data.length;o++)if(void 0!==Object(a.default)(e,r.data[o].handles,n,s))return!0;return!1}))}},"./store/index.js":function(e,t,n){"use strict";n.r(t),n.d(t,"state",(function(){return u})),n.d(t,"getters",(function(){return c})),n.d(t,"modules",(function(){return d})),n.d(t,"getModule",(function(){return h}));var r=n("./store/modules/segmentationModule/index.js"),i=n("./store/modules/manipulatorStateModule.js"),a=n("./store/modules/cursorModule.js"),o=n("./store/modules/globalConfigurationModule.js"),s=n("./externalModules.js"),l=n("./util/logger.js"),u=(Object(l.getLogger)("store:modules:storeLogger"),{globalTools:{},globalToolChangeHistory:[],enabledElements:[],tools:[],isToolLocked:!1,activeMultiPartTool:null,mousePositionImage:{},clickProximity:6,touchProximity:10,handleRadius:6,deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1,svgCursorUrl:null}),c={mouseTools:function(){return u.tools.filter((function(e){return e.supportedInteractionTypes.includes("Mouse")}))},touchTools:function(){return u.tools.filter((function(e){return e.supportedInteractionTypes.includes("Touch")}))},enabledElementByUID:function(e){return u.enabledElements.find((function(t){return s.default.cornerstone.getEnabledElement(t).uuid===e}))}},d={segmentation:r.default,cursor:a.default,globalConfiguration:o.default,manipulatorState:i.default};function h(e){return d[e]}t.default={modules:d,state:u,getters:c}},"./store/internals/addEnabledElement.js":function(e,t,n){"use strict";n.r(t);var r=n("./eventListeners/index.js"),i=n("./eventDispatchers/index.js"),a=n("./store/addTool.js"),o=n("./store/setToolMode.js"),s=n("./store/index.js"),l=n("./util/logger.js"),u=Object(l.getLogger)("internals:addEnabledElement");t.default=function(e){u.log("EVENT:ELEMENT_ENABLED");var t=e.detail.element;i.imageRenderedEventDispatcher.enable(t),i.newImageEventDispatcher.enable(t);var n=Object(s.getModule)("globalConfiguration").configuration;n.mouseEnabled&&(r.mouseEventListeners.enable(t),r.wheelEventListener.enable(t),i.mouseToolEventDispatcher.enable(t)),n.touchEnabled&&(r.touchEventListeners.enable(t),i.touchToolEventDispatcher.enable(t)),c(t)};var c=function(e){s.default.state.enabledElements.push(e),s.default.modules&&function(e){var t=s.default.modules;Object.keys(t).forEach((function(n){"function"==typeof t[n].enabledElementCallback&&t[n].enabledElementCallback(e)}))}(e),function(e){Object(s.getModule)("globalConfiguration").configuration.globalToolSyncEnabled&&Object.keys(s.default.state.globalTools).forEach((function(t){var n=s.default.state.globalTools[t],r=n.tool,i=n.props;Object(a.addToolForElement)(e,r,i)}))}(e),function(e){if(Object(s.getModule)("globalConfiguration").configuration.globalToolSyncEnabled){var t={active:o.setToolActiveForElement,passive:o.setToolPassiveForElement,enabled:o.setToolEnabledForElement,disabled:o.setToolDisabledForElement};s.default.state.globalToolChangeHistory.forEach((function(n){var r=n.args.slice(0);r.unshift(e),t[n.mode].apply(null,r)}))}}(e)}},"./store/internals/removeEnabledElement.js":function(e,t,n){"use strict";n.r(t);var r=n("./eventListeners/index.js"),i=n("./eventDispatchers/index.js"),a=n("./store/index.js"),o=n("./util/logger.js"),s=n("./stateManagement/loadHandlerManager.js"),l=n("./store/setToolMode.js"),u=Object(o.getLogger)("internals:removeEnabledElement");t.default=function(e){u.log("EVENT:ELEMENT_DISABLED");var t=e.detail.element,n=Object(a.getModule)("globalConfiguration").configuration;i.imageRenderedEventDispatcher.disable(t),i.newImageEventDispatcher.disable(t),n.mouseEnabled&&(r.mouseEventListeners.disable(t),r.wheelEventListener.disable(t),i.mouseToolEventDispatcher.disable(t)),n.touchEnabled&&(r.touchEventListeners.disable(t),i.touchToolEventDispatcher.disable(t)),c(t),d(t),h(t)};var c=function(e){a.default.state.tools.forEach((function(t){t.element===e&&Object(l.setToolDisabledForElement)(t.element,t.name)})),a.default.state.tools=a.default.state.tools.filter((function(t){return t.element!==e}))},d=function(e){a.default.modules&&function(e){var t=a.default.modules;Object.keys(t).forEach((function(n){"function"==typeof t[n].removeEnabledElementCallback&&t[n].removeEnabledElementCallback(e)}))}(e);var t=a.default.state.enabledElements.findIndex((function(t){return t===e}));t>-1?a.default.state.enabledElements.splice(t,1):u.warn("unable to remove element")},h=function(e){s.default.removeHandlers(e)}},"./store/isToolActiveForElement.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/getToolForElement.js");t.default=function(e,t){return"active"===Object(r.default)(e,t).mode}},"./store/modules/cursorModule.js":function(e,t,n){"use strict";n.r(t),n("./externalModules.js");var r={iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:'\n    <path stroke="ACTIVE_COLOR" d="M8 16L8 0"></path>\n    <path stroke="ACTIVE_COLOR" d="M16 8L0 8"></path>\n  '};t.default={configuration:r,getters:{defaultOptions:function(){return r}},setters:{defaultOptions:function(e){Object.assign(r,e)}}}},"./store/modules/globalConfigurationModule.js":function(e,t,n){"use strict";n.r(t),t.default={configuration:{mouseEnabled:!0,touchEnabled:!0,globalToolSyncEnabled:!1,showSVGCursors:!1,autoResizeViewports:!0,lineDash:[4,4]}}},"./store/modules/manipulatorStateModule.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i={activeManipulators:{}};function a(e){var t=r.default.cornerstone.getEnabledElement(e);delete i.activeManipulators[t.uuid]}function o(e){var t=i.activeManipulators,n=t[e];"function"==typeof n&&n(),delete t[e]}function s(e){a(e.detail.element)}t.default={setters:{addActiveManipulatorForElement:function(e,t){var n=r.default.cornerstone.getEnabledElement(e);i.activeManipulators[n.uuid]=t},removeActiveManipulatorForElement:a,cancelActiveManipulatorsForElement:function(e){o(r.default.cornerstone.getEnabledElement(e).uuid)},cancelActiveManipulators:function(){Object.keys(i.activeManipulators).forEach((function(e){return o(e)}))}},state:i,enabledElementCallback:function(e){var t=r.default.cornerstone.EVENTS.NEW_IMAGE;e.removeEventListener(t,s),e.addEventListener(t,s)},removeEnabledElementCallback:function(e){e.removeEventListener(r.default.cornerstone.EVENTS.NEW_IMAGE,s),a(e)}}},"./store/modules/segmentationModule/activeLabelmapIndex.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getActiveLabelmapIndex",(function(){return l})),n.d(t,"setActiveLabelmapIndex",(function(){return u}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./stateManagement/toolState.js"),a=n("./store/modules/segmentationModule/addLabelmap3D.js"),o=n("./store/modules/segmentationModule/state.js"),s=n("./externalModules.js");function l(e){var t=Object(r.default)(e);if(t){var n=Object(i.getToolState)(t,"stack"),a=o.default.series[n.data[0].imageIds[0]];if(a)return a.activeLabelmapIndex}}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(r.default)(e);if(n){var l=s.default.cornerstone,u=Object(i.getToolState)(n,"stack"),c=u.data[0],d=l.getEnabledElement(n),h=d.image,f=h.rows,p=h.columns,m=c.imageIds.length,g=f*p*m,v=c.imageIds[0],y=o.default.series[v];y?(y.activeLabelmapIndex=t,y.labelmaps3D[t]||Object(a.default)(y,t,g)):(o.default.series[v]={activeLabelmapIndex:t,labelmaps3D:[]},y=o.default.series[v],Object(a.default)(y,t,g)),l.updateImage(n)}}},"./store/modules/segmentationModule/activeSegmentIndex.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getActiveSegmentIndex",(function(){return s})),n.d(t,"setActiveSegmentIndex",(function(){return l})),n.d(t,"incrementActiveSegmentIndex",(function(){return u})),n.d(t,"decrementActiveSegmentIndex",(function(){return c}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./stateManagement/toolState.js"),a=n("./store/modules/segmentationModule/state.js"),o=n("./store/index.js");function s(e,t){var n=Object(r.default)(e);if(n){var o=Object(i.getToolState)(n,"stack"),s=a.default.series[o.data[0].imageIds[0]];if(s){var l=s.labelmaps3D[t=void 0===t?s.activeLabelmapIndex:t];if(l)return l.activeSegmentIndex}return 1}}function l(e,t){var n=Object(r.default)(e);if(n){var s=Object(i.getToolState)(n,"stack"),l=a.default.series[s.data[0].imageIds[0]];if(l){var u=l.labelmaps3D[l.activeLabelmapIndex],c=Object(o.getModule)("segmentation").configuration;t<=0?t=1:t>c.segmentsPerLabelmap&&(t=c.segmentsPerLabelmap),u.activeSegmentIndex=t}}}function u(e){var t=Object(r.default)(e);t&&d(t,"increase")}function c(e){var t=Object(r.default)(e);t&&d(t,"decrease")}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"increase",n=Object(o.getModule)("segmentation"),r=n.configuration,s=Object(i.getToolState)(e,"stack"),l=s.data[0],u=l.imageIds[0],c=a.default.series[u];if(c){var d=c.activeLabelmapIndex,h=c.labelmaps3D[d];switch(t){case"increase":h.activeSegmentIndex++,h.activeSegmentIndex>r.segmentsPerLabelmap&&(h.activeSegmentIndex=1);break;case"decrease":h.activeSegmentIndex--,h.activeSegmentIndex<=0&&(h.activeSegmentIndex=r.segmentsPerLabelmap)}}}},"./store/modules/segmentationModule/addLabelmap2D.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));var r=n("./store/modules/segmentationModule/arrayTypes.js"),i=n("./store/index.js"),a=r.default.UINT_16_ARRAY,o=r.default.FLOAT_32_ARRAY;function s(e,t,n,r,s){var l,u=Object(i.getModule)("segmentation").configuration,c=r*s,d=c*n;switch(u.arrayType){case a:l=new Uint16Array(e.labelmaps3D[t].buffer,2*d,c);break;case o:l=new Float32Array(e.labelmaps3D[t].buffer,4*d,c);break;default:throw new Error("Unsupported Array Type ".concat(u.arrayType))}e.labelmaps3D[t].labelmaps2D[n]={pixelData:l,segmentsOnLabelmap:[]}}},"./store/modules/segmentationModule/addLabelmap3D.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));var r=n("./store/modules/segmentationModule/arrayTypes.js"),i=n("./store/index.js"),a=r.default.UINT_16_ARRAY,o=r.default.FLOAT_32_ARRAY;function s(e,t,n){var r,s=Object(i.getModule)("segmentation").configuration;switch(s.arrayType){case a:r=2;break;case o:r=4;break;default:throw new Error("Unsupported Array Type ".concat(s.arrayType))}e.labelmaps3D[t]={buffer:new ArrayBuffer(n*r),labelmaps2D:[],metadata:[],activeSegmentIndex:1,colorLUTIndex:0,segmentsHidden:[],undo:[],redo:[]}}},"./store/modules/segmentationModule/arrayTypes.js":function(e,t,n){"use strict";n.r(t),t.default={UINT_16_ARRAY:0,FLOAT_32_ARRAY:1}},"./store/modules/segmentationModule/colorLUT.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u})),n.d(t,"setColorLUTIndexForLabelmap3D",(function(){return c})),n.d(t,"getColorForSegmentIndexColorLUT",(function(){return d})),n.d(t,"setColorForSegmentIndexOfColorLUT",(function(){return h})),n.d(t,"getColorLUT",(function(){return f}));var r=n("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=n.n(r),a=n("./util/logger.js"),o=n("./store/modules/segmentationModule/state.js"),s=n("./store/index.js"),l=Object(a.getLogger)("store:modules:segmentationModule:setColorLUT");function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Object(s.getModule)("segmentation"),r=n.configuration,a=r.segmentsPerLabelmap;t?(p(t,a),t.length<a&&(t=[].concat(i()(t),i()(m(a-t.length))))):t=t||m(a),t.unshift([0,0,0,0]),o.default.colorLutTables[e]=t}function c(e,t){e.colorLUTIndex=t}function d(e,t){return f(e)[t]}function h(e,t,n){f(e)[t]=n}function f(e){return"number"==typeof e?o.default.colorLutTables[e]:o.default.colorLutTables[e.colorLUTIndex]}function p(e,t){e.length<t?l.warn("The provided colorLUT only provides ".concat(e.length," labels, whereas segmentsPerLabelmap is set to ").concat(t,". Autogenerating the rest.")):e.length>t&&l.warn("segmentsPerLabelmap is set to ".concat(t,", and the provided colorLUT provides ").concat(e.length,". Using the first ").concat(t," colors from the LUT."))}function m(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:255,t=[],n=0;n<e;n++)t.push(x(v(),b()));return t}var g=222.5;function v(){return(g+=137.5)>=360&&(g-=360),g}var y=.6;function b(){return(y+=.07)>.82&&(y=y-.82+.3),y}function x(e){var t,n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.6,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,s=(1-Math.abs(2*a-1))*i,l=s*(1-Math.abs(e/60%2-1)),u=a-s/2;return e<60?(t=s,n=l,r=0):e<120?(t=l,n=s,r=0):e<180?(t=0,n=s,r=l):e<240?(t=0,n=l,r=s):e<300?(t=l,n=0,r=s):e<360&&(t=s,n=0,r=l),[255*(t+u),255*(n+u),255*(r+u),o]}},"./store/modules/segmentationModule/defaultConfiguration.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/modules/segmentationModule/arrayTypes.js");t.default={renderOutline:!0,renderFill:!0,shouldRenderInactiveLabelmaps:!0,radius:10,minRadius:1,maxRadius:50,fillAlpha:.2,fillAlphaInactive:.1,outlineAlpha:.7,outlineAlphaInactive:.35,outlineWidth:3,storeHistory:!0,segmentsPerLabelmap:65535,arrayType:r.default.UINT_16_ARRAY}},"./store/modules/segmentationModule/deleteSegment.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./stateManagement/toolState.js"),a=n("./store/modules/segmentationModule/state.js"),o=n("./externalModules.js");function s(e,t,n){if(t){var s=Object(r.default)(e);if(s){var l=Object(i.getToolState)(s,"stack"),u=a.default.series[l.data[0].imageIds[0]];if(u){var c=u.labelmaps3D[n=void 0===n?u.activeLabelmapIndex:n];if(c){delete c.metadata[t];for(var d=c.labelmaps2D,h=0;h<d.length;h++){var f=d[h];if(f&&f.segmentsOnLabelmap.includes(t)){var p=f.pixelData,m=f.segmentsOnLabelmap.indexOf(t);f.segmentsOnLabelmap.splice(m,1);for(var g=0;g<p.length;g++)p[g]===t&&(p[g]=0)}}o.default.cornerstone.updateImage(s)}}}}}},"./store/modules/segmentationModule/getBrushColor.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l}));var r=n("./stateManagement/toolState.js"),i=n("./store/modules/segmentationModule/state.js"),a=n("./store/modules/segmentationModule/getElement.js"),o=n("./util/logger.js"),s=Object(o.getLogger)("store:modules:segmentationModule:getBrushColor");function l(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(a.default)(e);if(n){var o=Object(r.getToolState)(n,"stack");if(o){var l,u=o.data[0],c=u.imageIds[0],d=i.default.series[c];if(d){var h=d.activeLabelmapIndex,f=d.labelmaps3D[h],p=f.activeSegmentIndex;l=i.default.colorLutTables[f.colorLUTIndex][p]}else l=i.default.colorLutTables[0][1];return t?"rgba(".concat(l[0],", ").concat(l[1],", ").concat(l[2],", 1.0 )"):"rgba(".concat(l[0],", ").concat(l[1],", ").concat(l[2],", 0.8 )")}s.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}}},"./store/modules/segmentationModule/getElement.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./store/index.js");function i(e){return e instanceof HTMLElement?e:r.getters.enabledElementByUID(e)}},"./store/modules/segmentationModule/getLabelmap2D.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return g})),n.d(t,"getLabelmap2DByImageIdIndex",(function(){return v}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./stateManagement/toolState.js"),a=n("./store/modules/segmentationModule/getSegmentsOnPixeldata.js"),o=n("./store/modules/segmentationModule/addLabelmap3D.js"),s=n("./store/modules/segmentationModule/addLabelmap2D.js"),l=n("./externalModules.js"),u=n("./store/modules/segmentationModule/state.js"),c=n("./store/modules/segmentationModule/arrayTypes.js"),d=n("./store/index.js"),h=n("./util/logger.js"),f=c.default.UINT_16_ARRAY,p=c.default.FLOAT_32_ARRAY,m=Object(h.getLogger)("store:modules:segmentationModule:getLabelmap2D");function g(e){var t=Object(r.default)(e);if(t){var n=l.default.cornerstone,a=Object(i.getToolState)(t,"stack");if(a){var c,d=a.data[0],h=n.getEnabledElement(t),f=d.currentImageIdIndex,p=h.image,g=p.rows,v=p.columns,y=d.imageIds.length,b=d.imageIds[0],x=u.default.series[b];if(x){if(!x.labelmaps3D[c=x.activeLabelmapIndex]){var w=g*v*y;Object(o.default)(x,c,w)}x.labelmaps3D[c].labelmaps2D[f]||Object(s.default)(x,c,f,g,v)}else{u.default.series[b]={activeLabelmapIndex:c=0,labelmaps3D:[]},x=u.default.series[b];var _=g*v*y;Object(o.default)(x,c,_),Object(s.default)(x,c,f,g,v)}var k=x.labelmaps3D[c];return{labelmap2D:k.labelmaps2D[f],labelmap3D:k,currentImageIdIndex:f,activeLabelmapIndex:c}}m.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}}function v(e,t,n,r){if(!e.labelmaps2D[t]){var i,o=Object(d.getModule)("segmentation").configuration,s=n*r,l=s*t;switch(o.arrayType){case f:i=new Uint16Array(e.buffer,2*l,s);break;case p:i=new Float32Array(e.buffer,4*l,s);break;default:throw new Error("Unsupported Array Type ".concat(o.arrayType))}e.labelmaps2D[t]={pixelData:i,segmentsOnLabelmap:Object(a.default)(i)}}return e.labelmaps2D[t]}},"./store/modules/segmentationModule/getLabelmapBuffers.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getLabelmapBuffers",(function(){return d})),n.d(t,"getActiveLabelmapBuffer",(function(){return h}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./stateManagement/toolState.js"),a=n("./store/modules/segmentationModule/getLabelmaps3D.js"),o=n("./store/modules/segmentationModule/state.js"),s=n("./store/modules/segmentationModule/arrayTypes.js"),l=n("./store/index.js"),u=s.default.UINT_16_ARRAY,c=s.default.FLOAT_32_ARRAY;function d(e,t){var n=Object(r.default)(e);if(n){var i=Object(a.default)(n).labelmaps3D;if(!i)return[];var s,d,h=Object(l.getModule)("segmentation").configuration;switch(h.arrayType){case u:s="Uint16Array",d="2";break;case c:s="Float32Array",d="4";break;default:throw new Error("Unsupported Array Type ".concat(h.arrayType))}var f=o.default.colorLutTables;if(void 0!==t){var p=i[t];return p?{labelmapIndex:t,bytesPerVoxel:d,type:s,buffer:p.buffer,colorLUT:f[p.colorLUTIndex]}:void 0}for(var m=[],g=0;g<i.length;g++){var v=i[g];v&&m.push({labelmapIndex:g,bytesPerVoxel:2,buffer:v.buffer,colorLUT:f[v.colorLUTIndex]})}return m}}function h(e){var t=Object(r.default)(e);if(t){var n=Object(i.getToolState)(t,"stack"),a=o.default.series[n.data[0].imageIds[0]];if(a)return d(t,a.activeLabelmapIndex)}}},"./store/modules/segmentationModule/getLabelmapStats.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u})),n.d(t,"_calculateLabelmapStats",(function(){return c}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./stateManagement/toolState.js"),a=n("./store/modules/segmentationModule/state.js"),o=n("./externalModules.js"),s=n("./util/logger.js"),l=Object(s.getLogger)("store:modules:segmentationModule:getLabelmapStats");function u(e,t,n){var s=o.default.cornerstone,u=Object(r.default)(e);if(!u)return null;var d=Object(i.getToolState)(u,"stack").data[0].imageIds,h=d[0];return new Promise((function(e){var r=a.default.series[h];r||e(null);var i=function(e){for(var t=[],n=o.default.cornerstone.metaData,r=!0,i=0;i<e.length;i++){var a=n.get("imagePlaneModule",e[i]);if(!a){r=!1;break}t.push(a)}return{sufficientMetadata:r,imagePlanes:t}}(d),u=i.imagePlanes;i.sufficientMetadata||(l.warn("Insufficient imagePlaneModule information to calculate volume statistics."),e(null));for(var f=r.labelmaps3D[n=void 0===n?r.activeLabelmapIndex:n],p=[],m=0;m<d.length;m++)p.push(s.loadAndCacheImage(d[m]));Promise.all(p).then((function(n){var r=c(f,n,u,t);e(r)}))}))}function c(e,t,n,r){for(var i=function(e,t,n,r){for(var i=t[0],a=i.rowPixelSpacing,o=i.columnPixelSpacing,s=e.labelmaps2D,l=[],u=0;u<s.length;u++){var c=s[u];if(c&&c.segmentsOnLabelmap.includes(r)){for(var h=d(t,n,u)*a*o,f=c.pixelData,p=t[u].getPixelData(),m=[],g=0;g<f.length;g++)f[g]===r&&m.push(p[g]);l.push({voxelInMM3:h,values:m})}}return l}(e,t,n,r),a=0,o=i[0].values[0],s=o,l=0,u=0;u<i.length;u++){var c=i[u];l+=(v=c.voxelInMM3)*(m=c.values).length;var h=0;m.forEach((function(e){e>o?o=e:e<s&&(s=e),h+=e})),a+=h*v}a/=l;for(var f=0,p=0;p<i.length;p++){var m,g=i[p],v=g.voxelInMM3,y=0;(m=g.values).forEach((function(e){y+=Math.pow(e-a,2)})),f+=y*v}return f/=l,f=Math.sqrt(f),{volume:l,mean:a,stdDev:f,max:o,min:s}}function d(e,t,n){var r=e.length,i=t[n].imagePositionPatient;if(0===n)return h(i,t[n+1].imagePositionPatient);if(n===r-1)return h(i,t[n-1].imagePositionPatient);var a=t[n+1].imagePositionPatient;return(h(i,t[n-1].imagePositionPatient)+h(i,a))/2}function h(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}},"./store/modules/segmentationModule/getLabelmaps3D.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l})),n.d(t,"getLabelmap3D",(function(){return u}));var r=n("./stateManagement/toolState.js"),i=n("./store/modules/segmentationModule/getElement.js"),a=n("./store/modules/segmentationModule/state.js"),o=n("./util/logger.js"),s=Object(o.getLogger)("store:modules:segmentationModule:getLabelmaps3D");function l(e){var t=Object(i.default)(e);if(t){var n=Object(r.getToolState)(t,"stack");if(n){var o,l,u=n.data[0],c=a.default.series[u.imageIds[0]];return c&&(o=c.labelmaps3D,l=c.activeLabelmapIndex),{labelmaps3D:o,activeLabelmapIndex:l,currentImageIdIndex:u.currentImageIdIndex}}s.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}}function u(e,t){var n=l(e);return n.labelmaps3D[t=void 0!==t?t:n.activeLabelmapIndex]}},"./store/modules/segmentationModule/getSegmentOfActiveLabelmapAtEvent.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l}));var r=n("./stateManagement/toolState.js"),i=n("./store/modules/segmentationModule/state.js"),a=n("./util/isPointInImage.js"),o=n("./util/logger.js"),s=Object(o.getLogger)("store:modules:segmentationModule:getSegmentOfActiveLabelmapAtEvent");function l(e){var t=e.detail,n=t.element,o=t.image,l=t.currentPoints;if(l){var u=o.width,c=o.height;if(n){var d=Object(r.getToolState)(n,"stack").data[0],h=i.default.series[d.imageIds[0]],f=h.labelmaps3D[h.activeLabelmapIndex];if(f){var p=f.labelmaps2D[d.currentImageIdIndex];if(p){var m=p.pixelData,g=l.image,v=g.x,y=g.y;if(v=Math.floor(v),y=Math.floor(y),Object(a.default)({x:v,y:y},c,u)){var b=m[y*u+v];if(0===b)return;return{segmentIndex:b,metadata:f.metadata[b]}}}}}}else s.warn("Not a cornerstone input event.")}},"./store/modules/segmentationModule/getSegmentsOnPixeldata.js":function(e,t,n){"use strict";function r(e){for(var t=new Set(e).values(),n=[],r=!1;!r;){var i=t.next();(r=i.done)||n.push(i.value)}return n}n.r(t),n.d(t,"default",(function(){return r}))},"./store/modules/segmentationModule/history.js":function(e,t,n){"use strict";n.r(t),n.d(t,"pushState",(function(){return s})),n.d(t,"undo",(function(){return l})),n.d(t,"redo",(function(){return u}));var r=n("./store/modules/segmentationModule/getLabelmaps3D.js"),i=n("./util/logger.js"),a=n("./externalModules.js"),o=Object(i.getLogger)("util:segmentation:labelmap3DHistory");function s(e,t,n){var i=Object(r.getLabelmap3D)(e,n);i.undo.push(t),i.redo=[]}function l(e,t){var n=Object(r.getLabelmap3D)(e,t),i=n.undo,s=n.redo;if(i.length){var l=i.pop();c(n,l,1),s.push(l),a.default.cornerstone.updateImage(e)}else o.warn("No undos left.")}function u(e,t){var n=Object(r.getLabelmap3D)(e,t),i=n.undo,s=n.redo;if(s.length){var l=s.pop();c(n,l,2),i.push(l),a.default.cornerstone.updateImage(e)}else o.warn("No redos left.")}function c(e,t,n){var r=e.labelmaps2D;t.forEach((function(e){for(var t=e.diff,i=r[e.imageIdIndex].pixelData,a=0;a<t.length;a++){var o=t[a];i[o[0]]=o[n]}}))}},"./store/modules/segmentationModule/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/modules/segmentationModule/metadata.js"),i=n("./store/modules/segmentationModule/activeLabelmapIndex.js"),a=n("./store/modules/segmentationModule/activeSegmentIndex.js"),o=n("./store/modules/segmentationModule/segmentVisibility.js"),s=n("./store/modules/segmentationModule/getLabelmapBuffers.js"),l=n("./store/modules/segmentationModule/setLabelmap3D.js"),u=n("./store/modules/segmentationModule/getLabelmapStats.js"),c=n("./store/modules/segmentationModule/getLabelmaps3D.js"),d=n("./store/modules/segmentationModule/getLabelmap2D.js"),h=n("./store/modules/segmentationModule/getSegmentOfActiveLabelmapAtEvent.js"),f=n("./store/modules/segmentationModule/colorLUT.js"),p=n("./store/modules/segmentationModule/getBrushColor.js"),m=n("./store/modules/segmentationModule/getSegmentsOnPixeldata.js"),g=n("./store/modules/segmentationModule/deleteSegment.js"),v=n("./store/modules/segmentationModule/state.js"),y=n("./store/modules/segmentationModule/defaultConfiguration.js"),b=n("./store/modules/segmentationModule/history.js"),x=n("./store/modules/segmentationModule/setRadius.js");t.default={state:v.default,configuration:y.default,onRegisterCallback:function(){Object(f.default)(0)},getters:{metadata:r.getMetadata,labelmap3D:c.getLabelmap3D,labelmaps3D:c.default,activeLabelmapIndex:i.getActiveLabelmapIndex,activeSegmentIndex:a.getActiveSegmentIndex,isSegmentVisible:o.isSegmentVisible,labelmap2D:d.default,labelmap2DByImageIdIndex:d.getLabelmap2DByImageIdIndex,labelmapStats:u.default,segmentOfActiveLabelmapAtEvent:h.default,brushColor:p.default,labelmapBuffers:s.getLabelmapBuffers,activeLabelmapBuffer:s.getActiveLabelmapBuffer,colorLUT:f.getColorLUT,colorForSegmentIndexColorLUT:f.getColorForSegmentIndexColorLUT},setters:{metadata:r.setMetadata,labelmap3DForElement:l.setLabelmap3DForElement,labelmap3DByFirstImageId:l.setLabelmap3DByFirstImageId,incrementActiveSegmentIndex:a.incrementActiveSegmentIndex,decrementActiveSegmentIndex:a.decrementActiveSegmentIndex,activeSegmentIndex:a.setActiveSegmentIndex,toggleSegmentVisibility:o.toggleSegmentVisibility,updateSegmentsOnLabelmap2D:function(e){e.segmentsOnLabelmap=Object(m.default)(e.pixelData)},deleteSegment:g.default,colorLUT:f.default,colorLUTIndexForLabelmap3D:f.setColorLUTIndexForLabelmap3D,colorForSegmentIndexOfColorLUT:f.setColorForSegmentIndexOfColorLUT,activeLabelmapIndex:i.setActiveLabelmapIndex,radius:x.default,pushState:b.pushState,undo:b.undo,redo:b.redo}}},"./store/modules/segmentationModule/metadata.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getMetadata",(function(){return c})),n.d(t,"setMetadata",(function(){return d}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./store/modules/segmentationModule/addLabelmap3D.js"),a=n("./stateManagement/toolState.js"),o=n("./externalModules.js"),s=n("./util/logger.js"),l=n("./store/modules/segmentationModule/state.js"),u=Object(s.getLogger)("store:modules:segmentationModule:metadata");function c(e,t,n){var i=Object(r.default)(e);if(i){var o=Object(a.getToolState)(i,"stack"),s=l.default.series[o.data[0].imageIds[0]];if(s){if(s.labelmaps3D[t=void 0===t?s.activeLabelmapIndex:t]){var c=s.labelmaps3D[t];return void 0===n?c.metadata:c.metadata[n]}u.warn("No labelmap3D of labelmap index ".concat(t," on stack."))}else u.warn("brushStackState is undefined")}}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,u=Object(r.default)(e);if(u){var c=o.default.cornerstone,d=Object(a.getToolState)(u,"stack"),h=d.data[0],f=h.imageIds[0],p=l.default.series[f];if(p||(l.default.series[f]={labelmapIndex:t,labelmaps3D:[]},p=l.default.series[f]),!p.labelmaps3D[t]){var m=c.getEnabledElement(u),g=m.image,v=g.rows,y=g.columns,b=h.imageIds.length,x=v*y*b;Object(i.default)(p,t,x)}var w=p.labelmaps3D[t];w.metadata[n]=s}}},"./store/modules/segmentationModule/segmentVisibility.js":function(e,t,n){"use strict";n.r(t),n.d(t,"isSegmentVisible",(function(){return l})),n.d(t,"toggleSegmentVisibility",(function(){return u}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./stateManagement/toolState.js"),a=n("./store/modules/segmentationModule/state.js"),o=n("./util/logger.js"),s=Object(o.getLogger)("store:modules:segmentationModule:segmentVisibility");function l(e,t,n){if(t){var o=Object(r.default)(e);if(o){var l=Object(i.getToolState)(o,"stack"),u=a.default.series[l.data[0].imageIds[0]];if(u){if(u.labelmaps3D[n=void 0===n?u.activeLabelmapIndex:n])return!u.labelmaps3D[n].segmentsHidden[t];s.warn("No labelmap3D of labelmap index ".concat(n," on stack."))}else s.warn("brushStackState is undefined")}}}function u(e,t,n){if(t){var o=Object(r.default)(e);if(o){var l=Object(i.getToolState)(o,"stack"),u=a.default.series[l.data[0].imageIds[0]];if(u){if(u.labelmaps3D[n=void 0===n?u.activeLabelmapIndex:n]){var c=u.labelmaps3D[n].segmentsHidden;return c[t]=!c[t],!c[t]}s.warn("No labelmap3D of labelmap index ".concat(n," on stack."))}else s.warn("brushStackState is undefined")}}}},"./store/modules/segmentationModule/setLabelmap3D.js":function(e,t,n){"use strict";n.r(t),n.d(t,"setLabelmap3DByFirstImageId",(function(){return f})),n.d(t,"setLabelmap3DForElement",(function(){return h}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./stateManagement/toolState.js"),a=n("./store/modules/segmentationModule/state.js"),o=n("./store/modules/segmentationModule/getSegmentsOnPixeldata.js"),s=n("./util/segmentation/index.js"),l=n("./store/modules/segmentationModule/arrayTypes.js"),u=n("./store/index.js"),c=l.default.UINT_16_ARRAY,d=l.default.FLOAT_32_ARRAY;function h(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=Object(r.default)(e);if(u){var c=Object(i.getToolState)(u,"stack"),d=c.data[0].imageIds.length,h=c.data[0].imageIds[0];f(h,t,n,a,d,o,l),Object(s.triggerLabelmapModifiedEvent)(u,n)}}function f(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,h=Object(u.getModule)("segmentation"),f=h.configuration,p=a.default.series[e];p||(a.default.series[e]={activeLabelmapIndex:n,labelmaps3D:[]},p=a.default.series[e]),p.labelmaps3D[n]={buffer:t,labelmaps2D:[],metadata:r,activeSegmentIndex:1,colorLUTIndex:l,segmentsHidden:[],undo:[],redo:[]};for(var m=p.labelmaps3D[n].labelmaps2D,g=t.byteLength/i,v=0;v<i;v++){var y=void 0;switch(f.arrayType){case c:y=new Uint16Array(t,g*v,g/2);break;case d:y=new Float32Array(t,g*v,g/4);break;default:throw new Error("Unsupported Array Type ".concat(f.arrayType))}var b=s?s[v]:Object(o.default)(y);b&&b.some((function(e){return e}))&&(m[v]={pixelData:y,segmentsOnLabelmap:b})}}},"./store/modules/segmentationModule/setRadius.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./store/index.js");function i(e){var t=Object(r.getModule)("segmentation").configuration;t.radius=Math.min(Math.max(e,t.minRadius),t.maxRadius)}},"./store/modules/segmentationModule/state.js":function(e,t,n){"use strict";n.r(t),t.default={series:{},colorLutTables:[]}},"./store/removeTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"removeTool",(function(){return a})),n.d(t,"removeToolForElement",(function(){return i}));var r=n("./store/index.js"),i=function(e,t){var n=r.default.state.tools.findIndex((function(n){return n.element===e&&n.name===t}));n>=0&&r.default.state.tools.splice(n,1)},a=function(e){o(e),r.default.state.enabledElements.forEach((function(t){i(t,e)}))},o=function(e){Object(r.getModule)("globalConfiguration").configuration.globalToolSyncEnabled&&r.default.state.globalTools[e]&&delete r.default.state.globalTools[e]}},"./store/setToolCursor.js":function(e,t,n){"use strict";n.r(t),n.d(t,"setToolCursor",(function(){return a})),n.d(t,"resetToolCursor",(function(){return o})),n.d(t,"hideToolCursor",(function(){return s}));var r=n("./store/index.js"),i=r.modules.globalConfiguration;function a(e,t){if(i.configuration.showSVGCursors){var n=t.getIconWithPointerSVG(),a=t.mousePoint,o=window.URL.createObjectURL(n);e.style.cursor="url('".concat(o,"') ").concat(a,", auto"),r.state.svgCursorUrl=o}}function o(e){l(e,"initial")}function s(e){i.configuration.showSVGCursors&&l(e,"none")}function l(e,t){r.state.svgCursorUrl&&window.URL.revokeObjectURL(r.state.svgCursorUrl),r.state.svgCursorUrl=null,e.style.cursor=t}},"./store/setToolMode.js":function(e,t,n){"use strict";n.r(t),n.d(t,"setToolActive",(function(){return h})),n.d(t,"setToolActiveForElement",(function(){return d})),n.d(t,"setToolDisabled",(function(){return p})),n.d(t,"setToolDisabledForElement",(function(){return f})),n.d(t,"setToolEnabled",(function(){return g})),n.d(t,"setToolEnabledForElement",(function(){return m})),n.d(t,"setToolPassive",(function(){return y})),n.d(t,"setToolPassiveForElement",(function(){return v})),n.d(t,"setToolMode",(function(){return x})),n.d(t,"setToolModeForElement",(function(){return b})),n.d(t,"_getNormalizedOptions",(function(){return E})),n.d(t,"_mergeMouseButtonMask",(function(){return S}));var r=n("./events.js"),i=n("./util/triggerEvent.js"),a=n("./store/getToolForElement.js"),o=n("./store/setToolCursor.js"),s=n("./util/logger.js"),l=n("./store/index.js"),u=Object(l.getModule)("globalConfiguration"),c=Object(s.getLogger)("store:setToolMode"),d=function(e,t,n,r){void 0===r&&Array.isArray(n)&&(r=n,n=null);var i=Object(a.default)(e,t);i&&(function(e,t,n,r){t.supportedInteractionTypes.forEach((function(i){if(void 0===r||r.includes(i)){var a=k[i];a?a(t,e,n):c.warn("Unable to resolve input conflicts for type %s",i)}})),l.default.state.tools.filter((function(t){return t.element===e&&"active"===t.mode&&t.supportedInteractionTypes.length>0})).forEach((function(t){var n=!1;t.supportedInteractionTypes.forEach((function(e){t.options["is".concat(e,"Active")]&&(n=!0)})),n||(c.log("Setting tool %s's to PASSIVE",t.name),v(e,t.name))}))}(e,i,n,r),i.supportedInteractionTypes.forEach((function(e){void 0===r||r.includes(e)?n["is".concat(e,"Active")]=!0:n["is".concat(e,"Active")]=!1})),u.configuration.showSVGCursors&&i.supportedInteractionTypes.includes("Mouse")&&function(e,t,n){("number"==typeof t?[t]:t.mouseButtonMask).includes(1)&&(n.svgCursor?Object(o.setToolCursor)(n.element,n.svgCursor):n.hideDefaultCursor?Object(o.hideToolCursor)(e):Object(o.resetToolCursor)(e))}(e,n,i)),b("active",null,e,t,n)},h=function(e,t,n){_("active",e,t,n),l.default.state.enabledElements.forEach((function(r){d(r,e,t,n)}))},f=b.bind(null,"disabled",null),p=x.bind(null,"disabled",null),m=b.bind(null,"enabled",null),g=x.bind(null,"enabled",null),v=b.bind(null,"passive",r.default.TOOL_DEACTIVATED),y=x.bind(null,"passive",r.default.TOOL_DEACTIVATED);function b(e,t,n,r,o){var s=Object(a.default)(n,r);if(s){if(o=E(o),Array.isArray(o.mouseButtonMask)&&0!==o.mouseButtonMask.length&&Array.isArray(s.options.mouseButtonMask)&&(o.mouseButtonMask=S(o.mouseButtonMask,s.options.mouseButtonMask)),s.mode=e,s.mergeOptions(o),s["".concat(e,"Callback")]&&s["".concat(e,"Callback")](n,o),t){var l={options:o,toolName:r,toolType:r,type:t};Object(i.default)(n,t,l)}}else c.warn('Unable to find tool "%s" for enabledElement',r)}function x(e,t,n,r){_(e,n,r),l.default.state.enabledElements.forEach((function(i){b(e,t,i,n,r)}))}function w(e,t,n){var r="is".concat(e,"Active"),i=l.default.state.tools.find((function(e){return e.element===n&&"active"===e.mode&&!0===e.options[r]}));i&&(c.log("Setting tool %s's %s to false",i.name,r),i.options[r]=!1)}function _(e,t,n,r){if(u.configuration.globalToolSyncEnabled){var i={mode:e,args:[t,n]};r&&i.push(r),l.default.state.globalToolChangeHistory.push(i),l.default.state.globalToolChangeHistory.length>50&&l.default.state.globalToolChangeHistory.shift();var a=l.default.state.globalTools[t];if(a)if("active"===e){var o=function(e,t,n){void 0===n&&Array.isArray(t)&&(n=t,t=null);var r=[],i=l.default.state.globalTools[e];if(i){var a=new i.tool(i.props);a.supportedInteractionTypes.forEach((function(e){if(void 0===n||n.includes(e))if("Mouse"===e){var i=E(t).mouseButtonMask;Array.isArray(i)&&i.length>0?i.forEach((function(t){return r.push("".concat(e,"-").concat(t))})):Array.isArray(i)&&0===i.length&&r.push("".concat(e,"-DELETE"))}else r.push("MultiTouch"===e?"".concat(e,"-").concat(a.configuration.touchPointers):e)}))}return r}(t,n,r);Object.keys(l.default.state.globalTools).forEach((function(e){var t=l.default.state.globalTools[e];t.activeBindings=t.activeBindings.filter((function(e){return!o.includes(e)}))})),o.some((function(e){return e.includes("Mouse-DELETE")}))&&(a.activeBindings=a.activeBindings.filter((function(e){return!e.includes("Mouse")})),o=o.filter((function(e){return!e.includes("Mouse")}))),a.activeBindings=a.activeBindings.concat(o)}else a.activeBindings=[];else c.warn("setToolMode call for tool not available globally: ".concat(t))}}var k={Mouse:function(e,t,n){var r=E(n).mouseButtonMask;if(Array.isArray(r)&&r.length>0){var i=l.default.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMouseActive&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.some((function(e){return r.includes(e)}))}));i&&(i.options.mouseButtonMask=i.options.mouseButtonMask.filter((function(e){return!r.includes(e)})),0===i.options.mouseButtonMask.length&&(i.options.isMouseActive=!1))}},MouseWheel:w.bind(void 0,"MouseWheel"),Touch:function(e,t){var n=l.default.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive})),r=l.default.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMultiTouchActive&&1===e.configuration.touchPointers}));n&&(c.log("Setting tool %s's isTouchActive to false",n.name),n.options.isTouchActive=!1),r&&(c.log("Setting tool %s's isTouchActive to false",r.name),r.options.isMultiTouchActive=!1)},TouchPinch:w.bind(void 0,"TouchPinch"),TouchRotate:w.bind(void 0,"TouchRotate"),DoubleTap:w.bind(void 0,"DoubleTap"),MultiTouch:function(e,t){var n,r=l.default.state.tools.find((function(n){return n.element===t&&"active"===n.mode&&!0===n.options.isMultiTouchActive&&n.configuration.touchPointers===e.configuration.touchPointers}));1===e.configuration.touchPointers&&(n=l.default.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive}))),r&&(c.log("Setting tool %s's isMultiTouchActive to false",r.name),r.options.isMultiTouchActive=!1),n&&(c.log("Setting tool %s's isTouchActive to false",n.name),n.options.isTouchActive=!1)}};function E(e){return Array.isArray(e)?e={mouseButtonMask:e}:e!==Object(e)&&(e={mouseButtonMask:[e]}),e.hasOwnProperty("mouseButtonMask")||(e.mouseButtonMask=[]),Array.isArray(e.mouseButtonMask)||(e.mouseButtonMask=[e.mouseButtonMask]),e.mouseButtonMask=e.mouseButtonMask.filter((function(e){return"number"==typeof e&&0!==e})),e}function S(e,t){return e.concat(t).reduce((function(e,t){return-1===e.indexOf(t)&&e.push(t),e}),[])}},"./store/setToolOptions.js":function(e,t,n){"use strict";n.r(t),n.d(t,"setToolOptions",(function(){return o})),n.d(t,"setToolOptionsForElement",(function(){return a}));var r=n("./store/getToolForElement.js"),i=n("./store/index.js"),a=function(e,t,n){var i=Object(r.default)(e,t);i&&i.mergeOptions(n)},o=function(e,t){i.state.enabledElements.forEach((function(n){a(n,e,t)}))}},"./synchronization/Synchronizer.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./util/convertToVector3.js"),a=n("./toolOptions.js");function o(e){return e.filter((function(e,t,n){return n.indexOf(e)===t}))}t.default=function(e,t){var n=r.default.cornerstone,s=this,l=[],u=[],c=!1,d={},h=t;function f(e){var t=e.detail.element;s.remove(t),Object(a.clearToolOptionsByElement)(t)}this.enabled=!0,this.setHandler=function(e){h=e},this.getHandler=function(){return h},this.getDistances=function(){l.length&&u.length&&(d.distances={},d.imageIds={sourceElements:[],targetElements:[]},l.forEach((function(e){var t=n.getEnabledElement(e);if(t&&t.image){var r=t.image.imageId,a=n.metaData.get("imagePlaneModule",r);if(a&&a.imagePositionPatient){var o=Object(i.default)(a.imagePositionPatient);d.hasOwnProperty(t)||(d.distances[r]={},d.imageIds.sourceElements.push(r),u.forEach((function(t){var a=n.getEnabledElement(t);if(a&&a.image){var s=a.image.imageId;if(d.imageIds.targetElements.push(s),e!==t&&r!==s&&!d.distances[r].hasOwnProperty(s)){var l=n.metaData.get("imagePlaneModule",s);if(l&&l.imagePositionPatient){var u=Object(i.default)(l.imagePositionPatient);d.distances[r][s]=u.clone().sub(o)}}}})),Object.keys(d.distances[r]).length||delete d.distances[r])}}})))},this.fireEvent=function(e,t){!s.enabled||!l.length||!u.length||(c=!0,u.forEach((function(n){var r=u.indexOf(n);if(-1!==r){var i=d.imageIds.targetElements[r],a=l.indexOf(e);if(-1!==a){var o,c=d.imageIds.sourceElements[a];c===i?o=0:void 0!==d.distances[c]&&(o=d.distances[c][i]),h(s,e,n,t,o)}}})),c=!1)},this.onEvent=function(e){!0!==c&&s.fireEvent(e.currentTarget,e.detail)},this.addSource=function(t){-1===l.indexOf(t)&&(l.push(t),e.split(" ").forEach((function(e){t.addEventListener(e,s.onEvent)})),s.getDistances(),s.updateDisableHandlers())},this.addTarget=function(e){-1===u.indexOf(e)&&(u.push(e),s.getDistances(),h(s,e,e,0),s.updateDisableHandlers())},this.add=function(e){s.addSource(e),s.addTarget(e)},this.removeSource=function(t){var n=l.indexOf(t);-1!==n&&(l.splice(n,1),e.split(" ").forEach((function(e){t.removeEventListener(e,s.onEvent)})),s.getDistances(),s.fireEvent(t),s.updateDisableHandlers())},this.removeTarget=function(e){var t=u.indexOf(e);-1!==t&&(u.splice(t,1),s.getDistances(),h(s,e,e,0),s.updateDisableHandlers())},this.remove=function(e){s.removeTarget(e),s.removeSource(e)},this.getSourceElements=function(){return l},this.getTargetElements=function(){return u},this.displayImage=function(e,t,r){c=!0,n.displayImage(e,t,r),c=!1},this.setViewport=function(e,t){c=!0,n.setViewport(e,t),c=!1},this.updateDisableHandlers=function(){o(l.concat(u)).forEach((function(e){e.removeEventListener(r.default.cornerstone.EVENTS.ELEMENT_DISABLED,f),e.addEventListener(r.default.cornerstone.EVENTS.ELEMENT_DISABLED,f)}))},this.destroy=function(){o(l.concat(u)).forEach((function(e){s.remove(e)}))}}},"./synchronization/panZoomSynchronizer.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t,n){if(n!==t){var i=r.default.cornerstone,a=i.getViewport(t),o=i.getViewport(n);o.scale===a.scale&&o.translation.x===a.translation.x&&o.translation.y===a.translation.y||(o.scale=a.scale,o.translation.x=a.translation.x,o.translation.y=a.translation.y,e.setViewport(n,o))}}},"./synchronization/stackImageIndexSynchronizer.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./stateManagement/toolState.js"),a=n("./stateManagement/loadHandlerManager.js"),o=n("./util/clip.js");t.default=function(e,t,n){if(n!==t){var s=r.default.cornerstone,l=Object(i.getToolState)(t,"stack").data[0],u=Object(i.getToolState)(n,"stack").data[0],c=l.currentImageIdIndex;if((c=Object(o.default)(c,0,u.imageIds.length-1))!==u.currentImageIdIndex){var d=a.default.getStartLoadHandler(n),h=a.default.getEndLoadHandler(n),f=a.default.getErrorLoadingHandler(n);d&&d(n),(!0===u.preventCache?s.loadImage(u.imageIds[c]):s.loadAndCacheImage(u.imageIds[c])).then((function(t){var r=s.getViewport(n);u.currentImageIdIndex=c,e.displayImage(n,t,r),h&&h(n,t)}),(function(e){f&&f(n,u.imageIds[c],e)}))}}}},"./synchronization/stackImagePositionOffsetSynchronizer.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./stateManagement/toolState.js"),a=n("./stateManagement/loadHandlerManager.js"),o=n("./util/convertToVector3.js");t.default=function(e,t,n,s,l){if(n!==t){var u=r.default.cornerstone,c=Object(i.getToolState)(t,"stack").data[0],d=u.metaData.get("imagePlaneModule",c.imageIds[c.currentImageIdIndex]);if(void 0!==d&&void 0!==d.imagePositionPatient){var h=Object(o.default)(d.imagePositionPatient),f=Object(i.getToolState)(n,"stack").data[0],p=Number.MAX_VALUE,m=-1;if(l){var g=h.clone().add(l);if(f.imageIds.forEach((function(e,t){var n=u.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var r=Object(o.default)(n.imagePositionPatient),i=g.distanceToSquared(r);i<p&&(p=i,m=t)}})),m!==f.currentImageIdIndex&&-1!==m){var v=a.default.getStartLoadHandler(n),y=a.default.getEndLoadHandler(n),b=a.default.getErrorLoadingHandler(n);f.currentImageIdIndex=m;var x=f.imageIds[m];v&&v(n),(!0===f.preventCache?u.loadImage(x):u.loadAndCacheImage(x)).then((function(t){var r=u.getViewport(n);f.currentImageIdIndex===m&&(e.displayImage(n,t,r),y&&y(n,t))}),(function(e){b&&b(n,f.imageIds[m],e)}))}}}}}},"./synchronization/stackImagePositionSynchronizer.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./stateManagement/toolState.js"),a=n("./stateManagement/loadHandlerManager.js"),o=n("./util/convertToVector3.js");t.default=function(e,t,n){if(n!==t){var s=r.default.cornerstone,l=Object(i.getToolState)(t,"stack").data[0],u=s.metaData.get("imagePlaneModule",l.imageIds[l.currentImageIdIndex]);if(void 0!==u&&void 0!==u.imagePositionPatient){var c=Object(o.default)(u.imagePositionPatient),d=Object(i.getToolState)(n,"stack").data[0],h=Number.MAX_VALUE,f=-1;if(d.imageIds.forEach((function(e,t){var n=s.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var r=Object(o.default)(n.imagePositionPatient).distanceToSquared(c);r<h&&(h=r,f=t)}})),f!==d.currentImageIdIndex){var p=a.default.getStartLoadHandler(n),m=a.default.getEndLoadHandler(n),g=a.default.getErrorLoadingHandler(n);d.currentImageIdIndex=f;var v=d.imageIds[f];p&&p(n),-1!==f&&(!0===d.preventCache?s.loadImage(v):s.loadAndCacheImage(v)).then((function(t){var r=s.getViewport(n);d.currentImageIdIndex===f&&(e.displayImage(n,t,r),m&&m(n,t))}),(function(e){g&&g(n,d.imageIds[f],e)}))}}}}},"./synchronization/stackScrollSynchronizer.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./stateManagement/toolState.js"),a=n("./stateManagement/loadHandlerManager.js"),o=n("./util/clip.js");t.default=function(e,t,n,s){if(t!==n&&s&&s.direction){var l=r.default.cornerstone,u=Object(i.getToolState)(n,"stack").data[0],c=u.currentImageIdIndex+s.direction;if(c=Object(o.default)(c,0,u.imageIds.length-1),u.currentImageIdIndex!==c){var d=a.default.getStartLoadHandler(n),h=a.default.getEndLoadHandler(n),f=a.default.getErrorLoadingHandler(n);u.currentImageIdIndex=c;var p=u.imageIds[c];d&&d(n),(!0===u.preventCache?l.loadImage(p):l.loadAndCacheImage(p)).then((function(t){var r=l.getViewport(n);u.currentImageIdIndex===c&&(e.displayImage(n,t,r),h&&h(n,t))}),(function(e){f&&f(n,u.imageIds[c],e)}))}}}},"./synchronization/updateImageSynchronizer.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t,n){n!==t&&r.default.cornerstone.updateImage(n)}},"./synchronization/wwwcSynchronizer.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t,n){if(n!==t){var i=r.default.cornerstone,a=i.getViewport(t),o=i.getViewport(n);o.voi.windowWidth===a.voi.windowWidth&&o.voi.windowCenter===a.voi.windowCenter&&o.invert===a.invert||(o.voi.windowWidth=a.voi.windowWidth,o.voi.windowCenter=a.voi.windowCenter,o.invert=a.invert,e.setViewport(n,o))}}},"./thirdParty/register.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/typeof.js"),i=n.n(r),a=n("./thirdParty/registerModule.js"),o=n("./thirdParty/registerMixin.js"),s=n("./thirdParty/registerItem.js"),l=n("./util/logger.js"),u=Object(l.getLogger)("thirdParty:register");function c(e,t,n){return e?t?"object"===i()(n)||"function"==typeof n||(u.warn("The %s is a %s, it should be an Object or a function.",n,i()(n)),!1):(u.warn("The %s must have a name in order to register.",e),!1):(u.warn("The type must be given in order to register."),!1)}t.default=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(c(e,t,n))switch(e){case"module":Object(a.default)(t,n,r);break;case"mixin":Object(o.default)(t,n,r);break;default:Object(s.default)(e,t,n,r)}}},"./thirdParty/registerItem.js":function(e,t,n){"use strict";n.r(t);var r=n("./lib.js"),i=n("./util/logger.js"),a=Object(i.getLogger)("thirdParty:registerType");function o(e){return void 0!==r.lib[e]}t.default=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s="".concat(e,"/").concat(t),l=o(s);!l||i?(l&&a.warn("Overwriting %s",s),r.lib[s]=n):a.warn("%s is already registered",s)}},"./thirdParty/registerMixin.js":function(e,t,n){"use strict";n.r(t);var r=n("./lib.js"),i=n("./mixins/index.js"),a=n("./util/logger.js"),o=Object(a.getLogger)("thirdParty:registerMixin");function s(e){return void 0!==i.default[e]}t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=s(e);!a||n?(a&&o.warn("Overwriting mixins/%s",e),i.default[e]=t,r.lib["mixins/".concat(e)]=i.default[e]):o.warn("mixins/%s is already registered",e)}},"./thirdParty/registerModule.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./util/logger.js"),a=Object(i.getLogger)("thirdParty:registerModule");function o(e){return void 0!==r.modules[e]}t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=o(e);!i||n?(i&&a.warn("Overwriting module %s",e),r.modules[e]=t,"function"==typeof r.modules[e].onRegisterCallback&&r.modules[e].onRegisterCallback()):a.warn("A module with the name %s is already registered",e)}},"./thirdParty/registerSome.js":function(e,t,n){"use strict";n.r(t);var r=n("./thirdParty/register.js");t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.forEach((function(e){var n=e.type,i=e.name,a=e.item;Object(r.default)(n,i,a,t)}))}},"./toolOptions.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getToolOptions",(function(){return i})),n.d(t,"setToolOptions",(function(){return a})),n.d(t,"clearToolOptions",(function(){return o})),n.d(t,"clearToolOptionsByToolType",(function(){return s})),n.d(t,"clearToolOptionsByToolName",(function(){return l})),n.d(t,"clearToolOptionsByElement",(function(){return u}));var r={};function i(e,t){if(!r[e])return{};var n=r[e].find((function(e){return e.element===t}));return n?n.options:{}}function a(e,t,n){if(r[e]){var i=r[e].findIndex((function(e){return e.element===t}));-1===i?r[e].push({element:t,options:n}):r[e][i].options=Object.assign(r[e][i].options||{},n)}else r[e]=[{element:t,options:n}]}function o(e,t){var n=r[e];n&&(r[e]=n.filter((function(e){return e.element!==t})))}function s(e){return l(e)}function l(e){delete r[e]}function u(e){for(var t in r)r[t]=r[t].filter((function(t){return t.element!==e}))}},"./tools/CrosshairsTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return k}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./tools/base/BaseTool.js"),g=n("./externalModules.js"),v=n("./stateManagement/loadHandlerManager.js"),y=n("./stateManagement/toolState.js"),b=n("./util/pointProjector.js"),x=n("./util/convertToVector3.js"),w=n("./toolOptions.js"),_=n("./tools/cursors/index.js"),k=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Crosshairs",supportedInteractionTypes:["Mouse","Touch"],svgCursor:_.crosshairsCursor};return(e=l()(this,c()(t).call(this,n,r))).mouseDownCallback=e._chooseLocation.bind(h()(e)),e.mouseDragCallback=e._chooseLocation.bind(h()(e)),e.touchDragCallback=e._chooseLocation.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_chooseLocation",value:function(e){var t=e.detail,n=t.element;e.stopImmediatePropagation();var r=Object(y.getToolState)(n,this.name);if(r){var i=n,a=g.default.cornerstone.getEnabledElement(i),o=g.default.cornerstone.metaData.get("imagePlaneModule",a.image.imageId);if(o){var s=t.currentPoints.image,l=Object(b.imagePointToPatientPoint)(s,o);r.data[0].synchronizationContext.getSourceElements().forEach((function(e){if(e!==i){var t=Number.MAX_VALUE,n=-1,r=Object(y.getToolState)(e,"stack");if(void 0!==r){var a=r.data[0];if(a.imageIds.forEach((function(e,r){var i=g.default.cornerstone.metaData.get("imagePlaneModule",e);if(i&&i.imagePositionPatient&&i.rowCosines&&i.columnCosines){var a=Object(x.default)(i.imagePositionPatient),o=Object(x.default)(i.rowCosines),s=Object(x.default)(i.columnCosines).clone().cross(o.clone()),u=Math.abs(s.clone().dot(a)-s.clone().dot(l));u<t&&(t=u,n=r)}})),n!==a.currentImageIdIndex&&-1!==n&&void 0!==a.imageIds[n]){var o=v.default.getStartLoadHandler(e),s=v.default.getEndLoadHandler(e),u=v.default.getErrorLoadingHandler(e);o&&o(e),(!0===a.preventCache?g.default.cornerstone.loadImage(a.imageIds[n]):g.default.cornerstone.loadAndCacheImage(a.imageIds[n])).then((function(t){var r=g.default.cornerstone.getViewport(e);a.currentImageIdIndex=n,g.default.cornerstone.displayImage(e,t,r),s&&s(e,t)}),(function(t){u&&u(e,a.imageIds[n],t)}))}}}}))}}}},{key:"activeCallback",value:function(e,t){var n=t.mouseButtonMask,r=t.synchronizationContext;Object(w.setToolOptions)(this.name,e,{mouseButtonMask:n}),Object(y.clearToolState)(e,this.name),Object(y.addToolState)(e,this.name,{synchronizationContext:r})}}]),t}(m.default)},"./tools/DoubleTapFitToWindowTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"DoubleTapFitToWindow",supportedInteractionTypes:["DoubleTap"]};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"doubleTapCallback",value:function(e){f.default.cornerstone.fitToWindow(e.detail.element)}}]),t}(n("./tools/base/BaseTool.js").default)},"./tools/DragProbeTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return E}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./externalModules.js"),g=n("./tools/base/BaseTool.js"),v=n("./stateManagement/textStyle.js"),y=n("./stateManagement/toolColors.js"),b=n("./util/getRGBPixels.js"),x=n("./util/calculateSUV.js"),w=n("./drawing/index.js"),_=n("./drawing/drawTextBox.js"),k=n("./tools/cursors/index.js"),E=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"DragProbe",strategies:{default:S,minimal:T},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],svgCursor:k.probeCursor};return(e=l()(this,c()(t).call(this,n,r))).touchDragCallback=e._movingEventCallback.bind(h()(e)),e.touchEndCallback=e._endMovingEventCallback.bind(h()(e)),e.mouseDragCallback=e._movingEventCallback.bind(h()(e)),e.mouseUpCallback=e._endMovingEventCallback.bind(h()(e)),e.dragEventData={},e}return p()(t,e),o()(t,[{key:"_movingEventCallback",value:function(e){var t=e.detail,n=t.element;this.dragEventData=t,m.default.cornerstone.updateImage(n)}},{key:"_endMovingEventCallback",value:function(e){var t=e.detail.element;this.dragEventData={},m.default.cornerstone.updateImage(t)}},{key:"renderToolData",value:function(e){this.dragEventData.currentPoints&&e&&e.detail&&Boolean(Object.keys(this.dragEventData.currentPoints).length)&&(e.detail.currentPoints=this.dragEventData.currentPoints,this.applyActiveStrategy(e))}}]),t}(g.default);function S(e){var t=this.configuration,n=m.default.cornerstone,r=e.detail,i=r.element,a=r.image,o=r.currentPoints,s=r.canvasContext,l=Object(w.getNewContext)(s.canvas),u=y.default.getActiveColor(),c=v.default.getFontSize(),d=Math.round(o.image.x),h=Math.round(o.image.y);d<0||h<0||d>=a.columns||h>=a.rows||Object(w.draw)(l,(function(e){Object(w.setShadow)(e,t);var r,s,l="".concat(d,", ").concat(h);if(a.color)r=Object(b.default)(i,d,h,1,1),s="R: ".concat(r[0]," G: ").concat(r[1]," B: ").concat(r[2]," A: ").concat(r[3]);else{var f=(r=n.getStoredPixels(i,d,h,1,1))[0],p=f*a.slope+a.intercept,m=Object(x.default)(a,f);s="SP: ".concat(f," MO: ").concat(parseFloat(p.toFixed(3))),m&&(s+=" SUV: ".concat(parseFloat(m.toFixed(3))))}var g={x:o.canvas.x+5,y:o.canvas.y-5};Object(_.default)(e,s,g.x,g.y+c+5,u),Object(_.default)(e,l,g.x,g.y,u)}))}function T(e){var t=this.configuration,n=m.default.cornerstone,r=e.detail,i=r.element,a=r.image,o=r.currentPoints,s=r.canvasContext,l=r.isTouchEvent,u=Object(w.getNewContext)(s.canvas),c=y.default.getActiveColor(),d=o.page.y-v.default.getFontSize()/2;l&&(d=o.page.y-4*v.default.getFontSize());var h=n.pageToPixel(i,o.page.x,d);h.x<0||h.y<0||h.x>=a.columns||h.y>=a.rows||Object(w.draw)(u,(function(e){Object(w.setShadow)(e,t);var r,o=n.metaData.get("generalSeriesModule",a.imageId),s=o&&o.modality,u="";if(a.color)r=Object(b.default)(i,h.x,h.y,1,1),u="R: ".concat(r[0]," G: ").concat(r[1]," B: ").concat(r[2]);else{var d=(r=n.getStoredPixels(i,h.x,h.y,1,1))[0],f=parseFloat((d*a.slope+a.intercept).toFixed(2));if("CT"===s)u+="HU: ".concat(f);else if("PT"===s){u+=f;var p=Object(x.default)(a,d);p&&(u+=" SUV: ".concat(parseFloat(p.toFixed(2))))}else u+=f}var m=n.pixelToCanvas(i,h),g={x:12,y:-(v.default.getFontSize()+10)/2},y=Object(_.textBoxWidth)(e,u,5);l&&(g={x:-y/2,y:-v.default.getFontSize()-10-12}),Object(w.drawCircle)(e,i,m,6,{color:c},"canvas"),Object(_.default)(e,u,m.x+g.x,m.y+g.y,c)}))}},"./tools/EraserTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return x}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./externalModules.js"),g=n("./tools/base/BaseTool.js"),v=n("./stateManagement/toolState.js"),y=n("./store/index.js"),b=n("./tools/cursors/index.js"),x=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Eraser",supportedInteractionTypes:["Mouse","Touch"],svgCursor:b.eraserCursor};return(e=l()(this,c()(t).call(this,n,r))).preMouseDownCallback=e._deleteAllNearbyTools.bind(h()(e)),e.preTouchStartCallback=e._deleteAllNearbyTools.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_deleteAllNearbyTools",value:function(e){var t=e.detail.currentPoints.canvas,n=e.detail.element;return y.state.tools.forEach((function(e){var r=Object(v.getToolState)(n,e.name);r&&r.data.forEach((function(r){"function"==typeof e.pointNearTool&&e.pointNearTool(n,r,t)&&(Object(v.removeToolState)(n,e.name,r),m.default.cornerstone.updateImage(n))}))})),!0}}]),t}(g.default)},"./tools/FreehandRoiSculptorTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return I}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./events.js"),g=n("./externalModules.js"),v=n("./stateManagement/toolColors.js"),y=n("./drawing/drawHandles.js"),b=n("./store/index.js"),x=n("./stateManagement/toolState.js"),w=n("./util/clip.js"),_=n("./store/getToolForElement.js"),k=n("./tools/base/BaseTool.js"),E=n("./store/setToolCursor.js"),S=n("./tools/cursors/index.js"),T=n("./util/freehand/index.js"),C=T.default.FreehandHandleData,I=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"FreehandRoiSculptor",referencedToolName:"FreehandRoi",supportedInteractionTypes:["Mouse","Touch","DoubleTap"],mixins:["activeOrDisabledBinaryTool"],configuration:A(),svgCursor:S.freehandRoiSculptorCursor};return(e=l()(this,c()(t).call(this,n,r))).updateOnMouseMove=!0,e.isMultiPartTool=!0,e.referencedToolName=e.initialConfiguration.referencedToolName,e._active=!1,e.activeMouseUpCallback=e.activeMouseUpCallback.bind(h()(e)),e.activeTouchEndCallback=e.activeTouchEndCallback.bind(h()(e)),e.activeMouseDragCallback=e.activeMouseDragCallback.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"renderToolData",value:function(e){var t=e.detail;if(null===this.configuration.currentTool)return!1;var n=t.element,r=this.configuration;if(!Object(x.getToolState)(n,this.referencedToolName).data[r.currentTool])return!1;if(this._active){var i=t.canvasContext.canvas.getContext("2d"),a={color:this.configuration.dragColor,fill:null,handleRadius:this._toolSizeCanvas};Object(y.default)(i,t,this.configuration.mouseLocation.handles,a)}else this.configuration.showCursorOnHover&&!this._recentTouchEnd&&this._renderHoverCursor(e)}},{key:"doubleClickCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),g.default.cornerstone.updateImage(t.element)}},{key:"doubleTapCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),g.default.cornerstone.updateImage(t.element)}},{key:"preTouchStartCallback",value:function(e){return this._initialiseSculpting(e),!0}},{key:"preMouseDownCallback",value:function(e){if(this.options.mouseButtonMask.includes(e.detail.buttons))return this._initialiseSculpting(e),!0}},{key:"activeMouseDragCallback",value:function(e){var t=this.configuration;if(this._active){var n=e.detail,r=Object(x.getToolState)(n.element,this.referencedToolName);if(r){var i=r.data[t.currentTool].handles.points;this._getMouseLocation(n),this._sculpt(n,i),g.default.cornerstone.updateImage(n.element)}}}},{key:"activeMouseUpCallback",value:function(e){this._activeEnd(e)}},{key:"activeTouchEndCallback",value:function(e){this._activeEnd(e),this._deselectAllTools(e),this._recentTouchEnd=!0}},{key:"_activeEnd",value:function(e){var t=e.detail,n=t.element,r=this.configuration;this._active=!1,b.state.isMultiPartToolActive=!1,this._getMouseLocation(t),this._invalidateToolData(t),r.mouseUpRender=!0,this._deactivateSculpt(n),g.default.cornerstone.updateImage(t.element),function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}(e)}},{key:"_renderHoverCursor",value:function(e){var t,n=e.detail,r=n.element,i=n.canvasContext.canvas.getContext("2d"),a=Object(x.getToolState)(r,this.referencedToolName).data[this.configuration.currentTool];this._recentTouchEnd=!1,this.configuration.mouseUpRender?(t=this.configuration.mouseLocation.handles.start,this.configuration.mouseUpRender=!1):t=b.state.mousePositionImage;var o=Object(_.default)(r,this.referencedToolName).distanceFromPointCanvas(r,a,t);if(this.configuration.mouseLocation.handles.start.x=t.x,this.configuration.mouseLocation.handles.start.y=t.y,this.configuration.limitRadiusOutsideRegion){var s=o;o=this._limitCursorRadiusCanvas(n,o),s>this.configuration.hoverCursorFadeDistance*o&&(i.globalAlpha=this.configuration.hoverCursorFadeAlpha)}var l={fill:null,color:this.configuration.hoverColor,handleRadius:o};Object(y.default)(i,n,this.configuration.mouseLocation.handles,l),this.configuration.limitRadiusOutsideRegion&&(i.globalAlpha=1)}},{key:"newImageCallback",value:function(e){this._deselectAllTools(e)}},{key:"enabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"passiveCallback",value:function(e){this._deselectAllTools(e)}},{key:"disabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"_selectFreehandTool",value:function(e){var t=this.configuration,n=e.element,r=this._getClosestFreehandToolOnElement(n,e);void 0!==r&&(t.currentTool=r,Object(E.hideToolCursor)(n))}},{key:"_activateFreehandTool",value:function(e,t){var n=Object(x.getToolState)(e,this.referencedToolName).data;this.configuration.currentTool=t;for(var r=0;r<n.length;r++)n[r].active=r===t}},{key:"_initialiseSculpting",value:function(e){var t=e.detail,n=this.configuration,r=t.element;null===n.currentTool&&(this._selectFreehandTool(t),null===n.currentTool)||(this._active=!0,b.state.isMultiPartToolActive=!0,this._configureToolSize(t),this._getMouseLocation(t),this._activateFreehandTool(r,n.currentTool),this._activateSculpt(r),g.default.cornerstone.updateImage(t.element))}},{key:"_sculpt",value:function(e,t){var n=this.configuration;this._sculptData={element:e.element,image:e.image,mousePoint:e.currentPoints.image,points:t,toolSize:this._toolSizeImage,minSpacing:n.minSpacing,maxSpacing:Math.max(this._toolSizeImage,2*n.minSpacing)};var r=this._pushHandles();void 0!==r.first&&(this._insertNewHandles(r),this._consolidateHandles())}},{key:"_pushHandles",value:function(){for(var e=this._sculptData,t=e.points,n=e.mousePoint,r=e.toolSize,i={},a=0;a<t.length;a++){var o=g.default.cornerstoneMath.point.distance(t[a],n);o>r||(this._pushOneHandle(a,o),void 0===i.first?(i.first=a,i.last=a):i.last=a)}return i}},{key:"_pushOneHandle",value:function(e,t){var n=this._sculptData,r=n.points,i=n.mousePoint,a=n.toolSize,o=n.image,s=r[e],l={x:i.x+a*((s.x-i.x)/t),y:i.y+a*((s.y-i.y)/t)};Object(w.clipToBox)(l,o),s.x=l.x,s.y=l.y;var u=this.constructor._getPreviousHandleIndex(e,r.length);r[u].lines.pop(),r[u].lines.push(s)}},{key:"_insertNewHandles",value:function(e){for(var t=this._findNewHandleIndicies(e),n=0,r=0;r<t.length;r++)this._insertHandleRadially(t[r]+1+n),n++}},{key:"_findNewHandleIndicies",value:function(e){for(var t=this._sculptData,n=t.points,r=t.maxSpacing,i=[],a=e.first;a<=e.last;a++)this._checkSpacing(a,n,i,r);var o=this.constructor._getNextHandleIndex(e.last,n.length);if(o!==e.first){this._checkSpacing(o,n,i,r);var s=this.constructor._getPreviousHandleIndex(e.first,n.length);s!==o&&this._checkSpacing(s,n,i,r)}return i}},{key:"_checkSpacing",value:function(e,t,n,r){var i=this.constructor._getNextHandleIndex(e,t.length);g.default.cornerstoneMath.point.distance(t[e],t[i])>r&&n.push(e)}},{key:"_insertHandleRadially",value:function(e){var t=this._sculptData.points,n=e-1,r=this.constructor._getNextHandleIndexBeforeInsert(e,t.length),i=this._getInsertPosition(e,n,r),a=new C(i);t.splice(e,0,a),t[n].lines.pop(),t[n].lines.push(t[e]),T.default.addLine(t,e)}},{key:"_consolidateHandles",value:function(){if(!(this._sculptData.points.length<=3)){var e=this._findCloseHandlePairs();this._mergeCloseHandles(e)}}},{key:"_findCloseHandlePairs",value:function(){for(var e=this._sculptData,t=e.points,n=e.minSpacing,r=[],i=t.length,a=0;a<i;a++){var o=this.constructor._getNextHandleIndex(a,t.length);g.default.cornerstoneMath.point.distance(t[a],t[o])<n&&(r.push([a,o]),0===a&&(i-=1),a++)}return r}},{key:"_mergeCloseHandles",value:function(e){for(var t=0,n=0;n<e.length;n++){var r=this.constructor._getCorrectedPair(e[n],t);this._combineHandles(r),t++}var i=this._findCloseHandlePairs();i.length&&this._mergeCloseHandles(i)}},{key:"_combineHandles",value:function(e){var t=this._sculptData,n=t.points,r=t.image,i={x:(n[e[0]].x+n[e[1]].x)/2,y:(n[e[0]].y+n[e[1]].y)/2};Object(w.clipToBox)(i,r),n[e[0]].x=i.x,n[e[0]].y=i.y;var a=this.constructor._getNextHandleIndex(e[1],n.length);n[e[0]].lines.pop(),n[e[0]].lines.push(n[a]),n.splice(e[1],1)}},{key:"_configureToolSize",value:function(e){var t=e.element,n=this.configuration,r=n.currentTool,i=e.currentPoints.image,a=Object(x.getToolState)(t,this.referencedToolName).data[r],o=Object(_.default)(t,this.referencedToolName),s=o.distanceFromPoint(t,a,i),l=o.distanceFromPointCanvas(t,a,i);n.limitRadiusOutsideRegion&&(s=this._limitCursorRadiusImage(e,s),l=this._limitCursorRadiusCanvas(e,l)),this._toolSizeImage=s,this._toolSizeCanvas=l}},{key:"_getMouseLocation",value:function(e){var t=this.configuration;t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,Object(w.clipToBox)(t.mouseLocation.handles.start,e.image)}},{key:"_activateSculpt",value:function(e){this._deactivateSculpt(e),e.addEventListener(m.default.MOUSE_UP,this.activeMouseUpCallback),e.addEventListener(m.default.MOUSE_CLICK,this.activeMouseUpCallback),e.addEventListener(m.default.MOUSE_DRAG,this.activeMouseDragCallback),e.addEventListener(m.default.TOUCH_END,this.activeTouchEndCallback),e.addEventListener(m.default.TOUCH_TAP,this.activeTouchEndCallback),e.addEventListener(m.default.TOUCH_DRAG,this.activeMouseDragCallback),g.default.cornerstone.updateImage(e)}},{key:"_deactivateSculpt",value:function(e){e.removeEventListener(m.default.MOUSE_UP,this.activeMouseUpCallback),e.removeEventListener(m.default.MOUSE_CLICK,this.activeMouseUpCallback),e.removeEventListener(m.default.MOUSE_DRAG,this.activeMouseDragCallback),e.removeEventListener(m.default.TOUCH_END,this.activeTouchEndCallback),e.removeEventListener(m.default.TOUCH_TAP,this.activeTouchEndCallback),e.removeEventListener(m.default.TOUCH_DRAG,this.activeMouseDragCallback),g.default.cornerstone.updateImage(e)}},{key:"_invalidateToolData",value:function(e){var t=this.configuration,n=e.element;Object(x.getToolState)(n,this.referencedToolName).data[t.currentTool].invalidated=!0}},{key:"_deselectAllTools",value:function(e){var t=this.configuration,n=Object(x.getToolState)(this.element,this.referencedToolName);if(t.currentTool=null,n)for(var r=0;r<n.data.length;r++)n.data[r].active=!1;Object(E.setToolCursor)(this.element,this.svgCursor),g.default.cornerstone.updateImage(this.element)}},{key:"_limitCursorRadiusCanvas",value:function(e,t){return this._limitCursorRadius(e,t,!0)}},{key:"_limitCursorRadiusImage",value:function(e,t){return this._limitCursorRadius(e,t,!1)}},{key:"_limitCursorRadius",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.element,i=e.image,a=this.configuration,o=Object(x.getToolState)(r,this.referencedToolName),s=o.data[a.currentTool],l=1;if(n){var u=g.default.cornerstone.pixelToCanvas(r,{x:0,y:0}),c=g.default.cornerstone.pixelToCanvas(r,{x:i.width,y:i.height}),d=(c.x-u.x)*(c.y-u.y);l=d/(i.width*i.height)}var h=s.area*l,f=Math.pow(h/Math.PI,.5);return Math.min(t,f)}},{key:"_getClosestFreehandToolOnElement",value:function(e,t){var n=Object(_.default)(e,this.referencedToolName),r=Object(x.getToolState)(e,this.referencedToolName);if(r){for(var i=r.data,a=t.currentPoints.image,o={distance:1/0,toolIndex:null},s=0;s<i.length;s++){var l=n.distanceFromPoint(e,i[s],a);-1!==l&&l<o.distance&&(o.distance=l,o.toolIndex=s)}return o.toolIndex}}},{key:"_getInsertPosition",value:function(e,t,n){var r,i=this._sculptData,a=i.points,o=i.toolSize,s=i.mousePoint,l=i.image,u={x:(a[t].x+a[n].x)/2,y:(a[t].y+a[n].y)/2},c=g.default.cornerstoneMath.point.distance(s,u);if(c<o){var d={x:(u.x-s.x)/c,y:(u.y-s.y)/c};r={x:s.x+o*d.x,y:s.y+o*d.y}}else r=u;return Object(w.clipToBox)(r,l),r}},{key:"minSpacing",get:function(){return this.configuration.minSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter minSpacing to a value other than a number.");this.configuration.minSpacing=e}},{key:"maxSpacing",get:function(){return this.configuration.maxSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter maxSpacing to a value other than a number.");this.configuration.maxSpacing=e}},{key:"showCursorOnHover",get:function(){return this.configuration.showCursorOnHover},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter showCursorOnHover to a value other than a boolean.");this.configuration.showCursorOnHover=e,g.default.cornerstone.updateImage(this.element)}},{key:"limitRadiusOutsideRegion",get:function(){return this.configuration.limitRadiusOutsideRegion},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter limitRadiusOutsideRegion to a value other than a boolean.");this.configuration.limitRadiusOutsideRegion=e,g.default.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeAlpha",get:function(){return this.configuration.hoverCursorFadeAlpha},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeAlpha to a value other than a number.");e=Math.max(Math.min(e,1),0),this.configuration.hoverCursorFadeAlpha=e,g.default.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeDistance",get:function(){return this.configuration.hoverCursorFadeDistance},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeDistance to a value other than a number.");e=Math.max(e,1),this.configuration.hoverCursorFadeDistance=e,g.default.cornerstone.updateImage(this.element)}}],[{key:"_getCorrectedPair",value:function(e,t){var n=[e[0]-t,e[1]-t];return n[1]<0&&(n[1]=0),n}},{key:"_getNextHandleIndex",value:function(e,t){return e===t-1?0:e+1}},{key:"_getPreviousHandleIndex",value:function(e,t){return 0===e?t-1:e-1}},{key:"_getNextHandleIndexBeforeInsert",value:function(e,t){return e===t?0:e}}]),t}(k.default);function A(){return{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},minSpacing:1,currentTool:null,dragColor:v.default.getActiveColor(),hoverColor:v.default.getToolColor(),showCursorOnHover:!0,limitRadiusOutsideRegion:!0,hoverCursorFadeAlpha:.5,hoverCursorFadeDistance:1.2}}},"./tools/MagnifyTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return x}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./externalModules.js"),g=n("./drawing/index.js"),v=n("./tools/base/BaseTool.js"),y=n("./store/setToolCursor.js"),b=n("./tools/cursors/index.js"),x=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Magnify",supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:300,magnificationLevel:2},svgCursor:b.magnifyCursor};return(e=l()(this,c()(t).call(this,n,r))).zoomCanvas=void 0,e.zoomElement=void 0,e.activeCallback=e._createMagnificationCanvas.bind(h()(e)),e.enabledCallback=e._createMagnificationCanvas.bind(h()(e)),e.disabledCallback=e._destroyMagnificationCanvas.bind(h()(e)),e.postTouchStartCallback=e._addMagnifyingGlass.bind(h()(e)),e.touchDragCallback=e._updateMagnifyingGlass.bind(h()(e)),e.touchEndCallback=e._removeMagnifyingGlass.bind(h()(e)),e.touchDragEndCallback=e._removeMagnifyingGlass.bind(h()(e)),e.postMouseDownCallback=e._addMagnifyingGlass.bind(h()(e)),e.mouseDragCallback=e._updateMagnifyingGlass.bind(h()(e)),e.mouseUpCallback=e._removeMagnifyingGlass.bind(h()(e)),e.mouseClickCallback=e._removeMagnifyingGlass.bind(h()(e)),e.newImageCallback=e._drawMagnificationTool.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_addMagnifyingGlass",value:function(e){var t=this;this._removeZoomElement(),this._drawZoomedElement(e),window.requestAnimationFrame((function(){return t._drawMagnificationTool(e)})),Object(y.hideToolCursor)(e.detail.element),e.preventDefault(),e.stopPropagation()}},{key:"_updateMagnifyingGlass",value:function(e){this._drawMagnificationTool(e),e.preventDefault(),e.stopPropagation()}},{key:"_removeMagnifyingGlass",value:function(e){var t=e.detail.element;Object(y.setToolCursor)(this.element,this.svgCursor),t.querySelector(".magnifyTool").style.display="none",this._removeZoomElement()}},{key:"_drawMagnificationTool",value:function(e){var t=e.detail.element,n=t.querySelector(".magnifyTool");if(n||this._createMagnificationCanvas(t),void 0!==this.zoomCanvas){var r=t.querySelector("canvas:not(.magnifyTool)"),i=Object(g.getNewContext)(n),a=m.default.cornerstone.pixelToCanvas(e.detail.element,e.detail.currentPoints.image),o=Math.min(this.configuration.magnifySize,r.width,r.height),s=this.configuration.magnificationLevel;n.width=o,n.height=o,a.x=Math.max(a.x,.5*o/s),a.x=Math.min(a.x,r.width-.5*o/s),a.y=Math.max(a.y,.5*o/s),a.y=Math.min(a.y,r.height-.5*o/s);var l={x:a.x*s-.5*o,y:a.y*s-.5*o};l.x=Math.max(l.x,0),l.y=Math.max(l.y,0),i.drawImage(this.zoomCanvas,l.x,l.y,o,o,0,0,o,o);var u={top:Math.max(a.y-.5*o-(e.detail.isTouchEvent?120:0),0),left:Math.max(a.x-.5*o,0)},c=n.getBoundingClientRect();u.top=Math.min(u.top,r.height-c.height),u.left=Math.min(u.left,r.width-c.width),n.style.top="".concat(u.top,"px"),n.style.left="".concat(u.left,"px"),n.style.display="block"}}},{key:"_drawZoomedElement",value:function(e){var t=e.detail.enabledElement;void 0===t&&(t=m.default.cornerstone.getEnabledElement(e.detail.element));var n=this.configuration.magnificationLevel,r=t.canvas,i=t.image;this.zoomElement||(this.zoomElement=document.createElement("div"),this.zoomElement.width=r.width*n,this.zoomElement.height=r.height*n,m.default.cornerstone.enable(this.zoomElement,t.options));var a=m.default.cornerstone.getEnabledElement(this.zoomElement),o=m.default.cornerstone.getViewport(t.element);this.zoomCanvas=a.canvas,this.zoomCanvas.width=r.width*n,this.zoomCanvas.height=r.height*n,a.viewport=Object.assign({},o),o.scale*=n,m.default.cornerstone.displayImage(this.zoomElement,i),m.default.cornerstone.setViewport(this.zoomElement,o)}},{key:"_removeZoomElement",value:function(){void 0!==this.zoomElement&&(m.default.cornerstone.disable(this.zoomElement),this.zoomElement=void 0,this.zoomCanvas=void 0)}},{key:"_createMagnificationCanvas",value:function(e){if(null===e.querySelector(".magnifyTool")){var t=document.createElement("canvas");t.classList.add("magnifyTool"),t.width=this.configuration.magnifySize,t.height=this.configuration.magnifySize,t.style.position="absolute",t.style.display="none",e.appendChild(t)}}},{key:"_destroyMagnificationCanvas",value:function(e){var t=e.querySelector(".magnifyTool");t&&e.removeChild(t)}}]),t}(v.default)},"./tools/OrientationMarkersTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return b}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseTool.js"),m=n("./orientation/index.js"),g=n("./drawing/index.js"),v=n("./stateManagement/toolColors.js"),y=n("./drawing/drawTextBox.js"),b=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"OrientationMarkers",configuration:{drawAllMarkers:!0},mixins:["enabledOrDisabledBinaryTool"]};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){var t=f.default.cornerstone;t.getEnabledElement(e).image&&t.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=Object(g.getNewContext)(t.canvasContext.canvas),r=t.element,i=_(r);if(i){var a=k(r,i),o=v.default.getToolColor(),s={top:Object(y.textBoxWidth)(n,i.top,0),left:Object(y.textBoxWidth)(n,i.left,0),right:Object(y.textBoxWidth)(n,i.right,0),bottom:Object(y.textBoxWidth)(n,i.bottom,0),height:Object(y.textBoxWidth)(n,"M",0)};x(n,i,a,s,o),this.configuration.drawAllMarkers&&w(n,i,a,s,o)}}}]),t}(p.default),x=function(e,t,n,r,i){Object(y.default)(e,t.top,n.top.x-r.top/2,n.top.y,i),Object(y.default)(e,t.left,n.left.x-r.left/2,n.left.y,i)},w=function(e,t,n,r,i){Object(y.default)(e,t.right,n.right.x-r.right,n.right.y,i),Object(y.default)(e,t.bottom,n.bottom.x-r.bottom/2,n.bottom.y-r.height,i)},_=function(e){var t=f.default.cornerstone,n=t.getEnabledElement(e),r=t.metaData.get("imagePlaneModule",n.image.imageId);if(r&&r.rowCosines&&r.columnCosines){var i=m.default.getOrientationString(r.rowCosines),a=m.default.getOrientationString(r.columnCosines),o=m.default.invertOrientationString(i);return{top:m.default.invertOrientationString(a),bottom:a,left:o,right:i}}},k=function(e){var t=f.default.cornerstone.getEnabledElement(e);return{top:f.default.cornerstone.pixelToCanvas(e,{x:t.image.width/2,y:5}),bottom:f.default.cornerstone.pixelToCanvas(e,{x:t.image.width/2,y:t.image.height-15}),left:f.default.cornerstone.pixelToCanvas(e,{x:5,y:t.image.height/2}),right:f.default.cornerstone.pixelToCanvas(e,{x:t.image.width-10,y:t.image.height/2})}}},"./tools/OverlayTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Overlay",configuration:{},mixins:["enabledOrDisabledBinaryTool"]},a=Object.assign(r,n);return(e=l()(this,c()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),o()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){f.default.cornerstone.getEnabledElement(e).image&&f.default.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=t.image,r=t.viewport,i=t.canvasContext;if(t&&t.enabledElement&&n){var a=f.default.cornerstone.metaData.get("overlayPlaneModule",n.imageId);if(a&&a.overlays&&a.overlays.length){var o=r.displayedArea.columnPixelSpacing||1,s=r.displayedArea.rowPixelSpacing||1,l=Math.abs(r.displayedArea.brhc.x-r.displayedArea.tlhc.x)*o,u=Math.abs(r.displayedArea.brhc.y-r.displayedArea.tlhc.y)*s;a.overlays.forEach((function(e){if(!1!==e.visible){var t=document.createElement("canvas");t.width=l,t.height=u;var n=t.getContext("2d");n.fillStyle=e.fillStyle||"white","R"===e.type&&(n.fillRect(0,0,t.width,t.height),n.globalCompositeOperation="xor");for(var r=0,a=0;a<e.rows;a++)for(var o=0;o<e.columns;o++)e.pixelData[r++]>0&&n.fillRect(o,a,1,1);var s=!isNaN(parseFloat(e.x))&&isFinite(e.x)?e.x:0,c=!isNaN(parseFloat(e.y))&&isFinite(e.y)?e.y:0;i.drawImage(t,s,c)}}))}}}}]),t}(n("./tools/base/BaseTool.js").default)},"./tools/PanMultiTouchTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return g}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./externalModules.js"),g=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"PanMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{touchPointers:2}};return(e=l()(this,c()(t).call(this,n,r))).multiTouchDragCallback=e._dragCallback.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport;if(t.numPointers===this.configuration.touchPointers){var i=this._getTranslation(t);this._applyTranslation(r,i),m.default.cornerstone.setViewport(n,r)}}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,r=e.deltaPoints,i=t.scale,a=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?i*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(a*=n.rowPixelSpacing/n.columnPixelSpacing),{x:r.page.x/i,y:r.page.y/a}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(n("./tools/base/BaseTool.js").default)},"./tools/PanTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return y}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./externalModules.js"),g=n("./tools/base/BaseTool.js"),v=n("./tools/cursors/index.js"),y=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Pan",supportedInteractionTypes:["Mouse","Touch"],svgCursor:v.panCursor};return(e=l()(this,c()(t).call(this,n,r))).touchDragCallback=e._dragCallback.bind(h()(e)),e.mouseDragCallback=e._dragCallback.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport,i=this._getTranslation(t);this._applyTranslation(r,i),m.default.cornerstone.setViewport(n,r)}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,r=e.deltaPoints,i=t.scale,a=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?i*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(a*=n.rowPixelSpacing/n.columnPixelSpacing),{x:r.page.x/i,y:r.page.y/a}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(g.default)},"./tools/ReferenceLinesTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return E}));var r=n("../node_modules/@babel/runtime/regenerator/index.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/asyncToGenerator.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/createClass.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),p=n.n(f),m=n("../node_modules/@babel/runtime/helpers/inherits.js"),g=n.n(m),v=n("./externalModules.js"),y=n("./tools/base/BaseTool.js"),b=n("./drawing/index.js"),x=n("./tools/referenceLines/renderActiveReferenceLine.js"),w=n("./util/wait.js"),_=n("./util/logger.js"),k=Object(_.getLogger)("tools:ReferenceLinesTool"),E=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l()(this,t);var r={name:"ReferenceLines",mixins:["enabledOrDisabledBinaryTool"],configuration:{renderer:x.default}};return(e=h()(this,p()(t).call(this,n,r))).renderer=null,e.synchronizationContext=null,e}var n;return g()(t,e),c()(t,[{key:"enabledCallback",value:(n=o()(i.a.mark((function e(t){var n,r,a=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(a.length>1&&void 0!==a[1]?a[1]:{}).synchronizationContext,r=this.configuration.renderer,e.next=4,Object(w.waitForEnabledElementImageToLoad)(t);case 4:if(e.sent&&r&&n){e.next=8;break}return k.warn("Unable to enable ".concat(this.name,". Exiting enable callback. Tool will be enabled, but will not render.")),e.abrupt("return");case 8:this.renderer=r,this.synchronizationContext=n,this.forceImageUpdate(t);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){v.default.cornerstone.getEnabledElement(e).image&&v.default.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=this,n=e.detail;if(this.renderer&&this.synchronizationContext){var r=this.synchronizationContext.getSourceElements(),i=Object(b.getNewContext)(n.canvasContext.canvas);v.default.cornerstone.setToPixelCoordinateSystem(n.enabledElement,i),r.forEach((function(r){r!==e.currentTarget&&t.renderer(i,n,e.currentTarget,r)}))}}}]),t}(y.default)},"./tools/RotateTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return v}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseTool.js"),m=n("./util/angleBetweenPoints.js"),g=n("./tools/cursors/index.js"),v=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Rotate",strategies:{default:y,horizontal:b,vertical:x},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{roundAngles:!1,flipHorizontal:!1,flipVertical:!1},svgCursor:g.rotateCursor};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"touchDragCallback",value:function(e){this.dragCallback(e)}},{key:"mouseDragCallback",value:function(e){this.dragCallback(e)}},{key:"postMouseDownCallback",value:function(e){this.initialRotation=e.detail.viewport.rotation}},{key:"dragCallback",value:function(e){e.detail.viewport.initialRotation=this.initialRotation,this.applyActiveStrategy(e),f.default.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(p.default);function y(e){var t=this.configuration.roundAngles,n=e.detail,r=n.element,i=n.viewport,a=i.initialRotation,o=r.getBoundingClientRect(r),s={x:n.startPoints.client.x,y:n.startPoints.client.y},l=i.scale,u=i.translation,c={x:o.left+r.clientWidth/2+u.x*l,y:o.top+r.clientHeight/2+u.y*l},d={x:n.currentPoints.client.x,y:n.currentPoints.client.y},h=Object(m.default)(c,s,d);t&&(h.angle=Math.ceil(h.angle)),h.direction<0&&(h.angle=-h.angle),i.rotation=a+h.angle}function b(e){var t=this.configuration,n=t.flipHorizontal,r=e.detail,i=r.viewport,a=r.deltaPoints.page.x/i.scale;t.roundAngles&&(a=Math[a>0?"ceil":"floor"](a)),n&&(a=-a),i.rotation+=a}function x(e){var t=this.configuration,n=t.flipVertical,r=e.detail,i=r.viewport,a=r.deltaPoints.page.y/i.scale;t.roundAngles&&(a=Math[a>0?"ceil":"floor"](a)),n&&(a=-a),i.rotation+=a}},"./tools/RotateTouchTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"RotateTouch",supportedInteractionTypes:["TouchRotate"]};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"touchRotateCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport;r.rotation+=t.rotation,f.default.cornerstone.setViewport(n,r)}}]),t}(n("./tools/base/BaseTool.js").default)},"./tools/ScaleOverlayTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return x}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseTool.js"),m=n("./drawing/index.js"),g=n("./stateManagement/toolStyle.js"),v=n("./stateManagement/toolColors.js"),y=n("./util/logger.js"),b=Object(y.getLogger)("tools:ScaleOverlayTool"),x=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ScaleOverlay",configuration:{minorTickLength:12.5,majorTickLength:25},mixins:["enabledOrDisabledBinaryTool"]};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){f.default.cornerstone.getEnabledElement(e).image&&f.default.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=Object(m.getNewContext)(t.canvasContext.canvas),r=t.image,i=t.viewport,a=t.element,o=r.rowPixelSpacing,s=r.columnPixelSpacing,l=f.default.cornerstone.metaData.get("imagePlaneModule",r.imageId);if(l&&(o=l.rowPixelSpacing||l.rowImagePixelSpacing,s=l.columnPixelSpacing||l.colImagePixelSpacing),o&&s){var u={width:n.canvas.width,height:n.canvas.height},c=10/o*i.scale,d=10/s*i.scale,h=w(u,.25,.05),p=w(u,.05,.15);if(u.width&&u.height&&h&&p){var y=v.default.getToolColor(),x=g.default.getToolWidth(),E=Object.assign({},{hscaleBounds:h,vscaleBounds:p,verticalMinorTick:c,horizontalMinorTick:d,verticalLine:{start:{x:p.bottomRight.x,y:p.topLeft.y},end:{x:p.bottomRight.x,y:p.bottomRight.y}},horizontalLine:{start:{x:h.topLeft.x,y:h.bottomRight.y},end:{x:h.bottomRight.x,y:h.bottomRight.y}},color:y,lineWidth:x},this.configuration);Object(m.draw)(n,(function(e){Object(m.setShadow)(e,E),Object(m.drawLine)(e,a,E.verticalLine.start,E.verticalLine.end,{color:E.color,lineWidth:E.lineWidth},"canvas"),_(e,a,E),Object(m.drawLine)(e,a,E.horizontalLine.start,E.horizontalLine.end,{color:E.color,lineWidth:E.lineWidth},"canvas"),k(e,a,E)}))}}else b.warn("unable to define rowPixelSpacing or colPixelSpacing from data on ".concat(this.name,"'s renderToolData"))}}]),t}(p.default),w=function(e,t,n){var r=t*Math.min(1e3,e.width),i=n*Math.min(1e3,e.height),a={left:r,top:i,width:e.width-2*r,height:e.height-2*i};return{topLeft:{x:a.left,y:a.top},bottomRight:{x:a.left+a.width,y:a.top+a.height}}},_=function(e,t,n){for(var r=0;n.verticalLine.start.y+r*n.verticalMinorTick<=n.vscaleBounds.bottomRight.y;){var i=n.color,a=n.lineWidth,o={x:n.verticalLine.start.x,y:n.verticalLine.start.y+r*n.verticalMinorTick},s={x:0,y:n.verticalLine.start.y+r*n.verticalMinorTick};s.x=r%5==0?n.verticalLine.start.x-n.majorTickLength:n.verticalLine.start.x-n.minorTickLength,Object(m.drawLine)(e,t,o,s,{color:i,lineWidth:a},"canvas"),r++}},k=function(e,t,n){for(var r=0;n.horizontalLine.start.x+r*n.horizontalMinorTick<=n.hscaleBounds.bottomRight.x;){var i=n.color,a=n.lineWidth,o={x:n.horizontalLine.start.x+r*n.horizontalMinorTick,y:n.horizontalLine.start.y},s={x:n.horizontalLine.start.x+r*n.horizontalMinorTick,y:0};s.y=r%5==0?n.horizontalLine.start.y-n.majorTickLength:n.horizontalLine.start.y-n.minorTickLength,Object(m.drawLine)(e,t,o,s,{color:i,lineWidth:a},"canvas"),r++}}},"./tools/StackScrollMouseWheelTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return m}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./tools/base/BaseTool.js"),p=n("./util/scroll.js"),m=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"StackScrollMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{loop:!1,allowSkipping:!0,invert:!1}};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.direction,r=t.element,i=this.configuration,a=i.loop,o=i.allowSkipping,s=i.invert?-n:n;Object(p.default)(r,s,a,o)}}]),t}(f.default)},"./tools/StackScrollMultiTouchTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return b}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./tools/base/BaseTool.js"),g=n("./util/scroll.js"),v=n("./stateManagement/toolState.js"),y=n("./toolOptions.js"),b=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"StackScrollMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{loop:!1,allowSkipping:!0,touchPointers:3}};return(e=l()(this,c()(t).call(this,n,r))).multiTouchDragCallback=e._dragCallback.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_dragCallback",value:function(e){var t=e.detail;if(t.numPointers===this.configuration.touchPointers){var n=t.element,r=t.deltaPoints,i=this.configuration,a=i.loop,o=i.allowSkipping,s=Object(y.getToolOptions)(this.name,n),l=this._getPixelPerImage(n),u=this._getDeltaY(n,r.page.y);if(!l)return;if(Math.abs(u)>=l){var c=Math.round(u/l);Object(g.default)(n,c,a,o),s.deltaY=u%l}else s.deltaY=u;Object(y.setToolOptions)(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return(Object(y.getToolOptions)(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=Object(v.getToolState)(e,"stack");if(t&&t.data&&t.data.length)return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(t.data[0].imageIds.length,8))}}]),t}(m.default)},"./tools/StackScrollTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return x}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./tools/base/BaseTool.js"),g=n("./util/scroll.js"),v=n("./stateManagement/toolState.js"),y=n("./toolOptions.js"),b=n("./tools/cursors/index.js"),x=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"StackScroll",supportedInteractionTypes:["Mouse","Touch"],configuration:{loop:!1,allowSkipping:!0},svgCursor:b.stackScrollCursor};return(e=l()(this,c()(t).call(this,n,r))).mouseDragCallback=e._dragCallback.bind(h()(e)),e.touchDragCallback=e._dragCallback.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,r=t.deltaPoints,i=this.configuration,a=i.loop,o=i.allowSkipping,s=Object(y.getToolOptions)(this.name,n),l=this._getPixelPerImage(n),u=this._getDeltaY(n,r.page.y);if(l){if(Math.abs(u)>=l){var c=Math.round(u/l);Object(g.default)(n,c,a,o),s.deltaY=u%l}else s.deltaY=u;Object(y.setToolOptions)(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return(Object(y.getToolOptions)(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=Object(v.getToolState)(e,"stack");if(t&&t.data&&t.data.length)return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(t.data[0].imageIds.length,8))}}]),t}(m.default)},"./tools/WwwcRegionTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return _}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./externalModules.js"),g=n("./tools/base/BaseTool.js"),v=n("./drawing/index.js"),y=n("./util/clip.js"),b=n("./util/getLuminance.js"),x=n("./stateManagement/toolColors.js"),w=n("./tools/cursors/index.js"),_=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"WwwcRegion",supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10},svgCursor:w.wwwcRegionCursor};return(e=l()(this,c()(t).call(this,n,r)))._resetHandles(),e.postTouchStartCallback=e._startOutliningRegion.bind(h()(e)),e.touchDragCallback=e._setHandlesAndUpdate.bind(h()(e)),e.touchEndCallback=e._applyStrategy.bind(h()(e)),e.postMouseDownCallback=e._startOutliningRegion.bind(h()(e)),e.mouseClickCallback=e._startOutliningRegion.bind(h()(e)),e.mouseDragCallback=e._setHandlesAndUpdate.bind(h()(e)),e.mouseMoveCallback=e._setHandlesAndUpdate.bind(h()(e)),e.mouseUpCallback=e._applyStrategy.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=n.element,i=x.default.getColorIfActive({active:!0}),a=Object(v.getNewContext)(n.canvasContext.canvas);Object(v.draw)(a,(function(e){Object(v.drawRect)(e,r,t.handles.start,t.handles.end,{color:i})}))}},{key:"_startOutliningRegion",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;return k(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),m.default.cornerstone.updateImage(t),!0}},{key:"_setHandlesAndUpdate",value:function(e){var t=e.detail.element;this.handles.end=e.detail.currentPoints.image,m.default.cornerstone.updateImage(t)}},{key:"_applyStrategy",value:function(e){k(this.handles.start)||k(this.handles.end)||(e.detail.handles=this.handles,E(e,this.configuration),this._resetHandles())}},{key:"_resetHandles",value:function(){this.handles={start:{},end:{}}}}]),t}(g.default),k=function(e){return 0===Object.keys(e).length&&e.constructor===Object},E=function(e,t){var n=e.detail,r=n.image,i=n.element,a=e.detail.handles,o=a.start,s=a.end,l=Math.min(o.x,s.x),u=Math.min(o.y,s.y),c=Math.abs(o.x-s.x),d=Math.abs(o.y-s.y);l=Object(y.default)(l,0,r.width),u=Object(y.default)(u,0,r.height),c=Math.floor(Math.min(c,Math.abs(r.width-l))),d=Math.floor(Math.min(d,Math.abs(r.height-u)));var h=Object(b.default)(i,l,u,c,d),f=S(h,r.minPixelValue,r.maxPixelValue),p=n.viewport;void 0===t.minWindowWidth&&(t.minWindowWidth=10),p.voi.windowWidth=Math.max(Math.abs(f.max-f.min),t.minWindowWidth),p.voi.windowCenter=f.mean,p.voiLUT=void 0,m.default.cornerstone.setViewport(i,p),m.default.cornerstone.updateImage(i)},S=function(e,t,n){var r=e.length,i=n,a=t,o=0;if(r<2)return{min:i,max:a,mean:(t+n)/2};for(var s=0;s<r;s++){var l=e[s];i=Math.min(i,l),a=Math.max(a,l),o+=l}return{min:i,max:a,mean:o/r}}},"./tools/WwwcTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return g}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseTool.js"),m=n("./tools/cursors/index.js"),g=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Wwwc",strategies:{basicLevelingStrategy:v},supportedInteractionTypes:["Mouse","Touch"],configuration:{orientation:0},svgCursor:m.wwwcCursor};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"mouseDragCallback",value:function(e){this.applyActiveStrategy(e),f.default.cornerstone.setViewport(e.detail.element,e.detail.viewport)}},{key:"touchDragCallback",value:function(e){e.stopImmediatePropagation(),this.applyActiveStrategy(e),f.default.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(p.default);function v(e){var t=e.detail,n=(t.image.maxPixelValue*t.image.slope+t.image.intercept-(t.image.minPixelValue*t.image.slope+t.image.intercept))/1024,r=t.deltaPoints.page.x*n,i=t.deltaPoints.page.y*n;0===this.configuration.orientation?(t.viewport.voi.windowWidth+=r,t.viewport.voi.windowCenter+=i):(t.viewport.voi.windowWidth+=i,t.viewport.voi.windowCenter+=r),t.viewport.voiLUT=void 0}},"./tools/ZoomMouseWheelTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return g}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseTool.js"),m=n("./util/zoom/index.js"),g=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ZoomMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{minScale:.25,maxScale:20,invert:!1}};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport,i=t.spinY,a=this.configuration,o=a.maxScale,s=a.minScale,l=a.invert?i/4:-i/4,u=Object(m.changeViewportScale)(r,l,{maxScale:o,minScale:s});f.default.cornerstone.setViewport(n,u)}}]),t}(p.default)},"./tools/ZoomTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return x}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseTool.js"),m=n("./util/clip.js"),g=n("./util/zoom/index.js"),v=n("./tools/cursors/index.js"),y=g.default.correctShift,b=g.default.changeViewportScale,x=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Zoom",strategies:{default:_,translate:k,zoomToCenter:E},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,preventZoomOutsideImage:!1,minScale:.25,maxScale:20},svgCursor:v.zoomCursor};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"touchDragCallback",value:function(e){w.call(this,e)}},{key:"mouseDragCallback",value:function(e){w.call(this,e)}}]),t}(p.default),w=function(e){if(!e.detail.deltaPoints.page.y)return!1;this.applyActiveStrategy(e,this.configuration),f.default.cornerstone.setViewport(e.detail.element,e.detail.viewport)};function _(e){var t=this.configuration,n=e.detail.deltaPoints.page.y,r=e.detail,i=r.element,a=r.viewport,o=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],s=o[0],l=o[1],u=o[2],c=o[3],d=b(a,t.invert?-n/100:n/100,{maxScale:t.maxScale,minScale:t.minScale});f.default.cornerstone.setViewport(i,d);var h=f.default.cornerstone.pageToPixel(i,s,l),p={x:u-h.x,y:c-h.y};p=y(p,d),a.translation.x-=p.x,a.translation.y-=p.y}function k(e){var t=this.configuration,n=t.preventZoomOutsideImage,r=e.detail.deltaPoints.page.y,i=t.invert?-r/100:r/100,a=e.detail.image,o=[e.detail.startPoints.image.x,e.detail.startPoints.image.y],s=o[0],l=o[1],u=b(e.detail.viewport,i,{maxScale:t.maxScale,minScale:t.minScale}),c={x:0,y:0},d=.01;if(i<0)u.scale<3&&(Math.abs(u.translation.x)<d?u.translation.x=0:c.x=u.translation.x/8,Math.abs(u.translation.y)<d?u.translation.y=0:c.y=u.translation.y/8);else{n&&Object(m.clipToBox)(e.detail.startPoints.image,a);var h={x:a.width/2-s,y:a.height/2-l};h=y(h,u);var f={x:u.translation.x-h.x,y:u.translation.y-h.y};Math.abs(f.x)<d?u.translation.x=h.x:c.x=f.x/8,Math.abs(f.y)<d?u.translation.y=h.y:c.y=f.y/8}u.translation.x-=c.x,u.translation.y-=c.y}function E(e){var t=this.configuration,n=e.detail.deltaPoints.page.y;b(e.detail.viewport,t.invert?-n/100:n/100,{maxScale:t.maxScale,minScale:t.minScale})}},"./tools/ZoomTouchPinchTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return g}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseTool.js"),m=n("./util/zoom/index.js").default.correctShift,g=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ZoomTouchPinch",supportedInteractionTypes:["TouchPinch"],configuration:{minScale:.25,maxScale:20}};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"touchPinchCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport,i=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],a=i[0],o=i[1],s=i[2],l=i[3],u=this.configuration,c=u.maxScale,d=u.minScale;r.scale+=t.scaleChange*r.scale,c&&r.scale>c?r.scale=c:d&&r.scale<d&&(r.scale=d),f.default.cornerstone.setViewport(n,r);var h=f.default.cornerstone.pageToPixel(n,a,o),p={x:s-h.x,y:l-h.y};p=m(p,r),r.translation.x-=p.x,r.translation.y-=p.y,f.default.cornerstone.setViewport(n,r)}}]),t}(p.default)},"./tools/annotation/AngleTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return D}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseAnnotationTool.js"),m=n("./stateManagement/toolState.js"),g=n("./stateManagement/toolStyle.js"),v=n("./stateManagement/toolColors.js"),y=n("./manipulators/index.js"),b=n("./drawing/index.js"),x=n("./drawing/drawLinkedTextBox.js"),w=n("./drawing/drawTextBox.js"),_=n("./drawing/drawHandles.js"),k=n("./util/lineSegDistance.js"),E=n("./util/roundToDecimal.js"),S=n("./tools/cursors/index.js"),T=n("./util/triggerEvent.js"),C=n("./events.js"),I=n("./util/getPixelSpacing.js"),A=n("./util/throttle.js"),O=n("./store/index.js"),D=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Angle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:S.angleCursor,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(e=l()(this,c()(t).call(this,n,r))).preventNewMeasurement=!1,e.throttledUpdateCachedStats=Object(A.default)(e.updateCachedStats,110),e}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&(Object(k.default)(e,t.handles.start,t.handles.middle,n)<25||Object(k.default)(e,t.handles.middle,t.handles.end,n)<25)}},{key:"updateCachedStats",value:function(e,t,n){var r=N(e,n.handles.middle,n.handles.start),i=N(e,n.handles.end,n.handles.middle),a=N(e,n.handles.end,n.handles.start),o=M(r),s=M(i),l=M(a),u=Math.acos((Math.pow(o,2)+Math.pow(s,2)-Math.pow(l,2))/(2*o*s));u*=180/Math.PI,n.rAngle=Object(E.default)(u,2),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=n.enabledElement,i=this.configuration,a=i.handleRadius,o=i.drawHandlesOnHover,s=i.hideHandlesIfMoving,l=i.renderDashed,u=Object(m.getToolState)(e.currentTarget,this.name),c=Object(O.getModule)("globalConfiguration").configuration.lineDash;if(u)for(var d=Object(b.getNewContext)(n.canvasContext.canvas),h=n.image,p=n.element,y=Object(I.default)(h),k=y.rowPixelSpacing,E=y.colPixelSpacing,S=g.default.getToolWidth(),T=function(e){var i=u.data[e];if(!1===i.visible)return"continue";Object(b.draw)(d,(function(e){Object(b.setShadow)(e,t.configuration);var u=v.default.getColorIfActive(i),d=f.default.cornerstone.pixelToCanvas(n.element,i.handles.start),m=f.default.cornerstone.pixelToCanvas(n.element,i.handles.middle),g={color:u};l&&(g.lineDash=c),Object(b.drawJoinedLines)(e,n.element,i.handles.start,[i.handles.middle,i.handles.end],g);var y={color:u,handleRadius:a,drawHandlesIfActive:o,hideHandlesIfMoving:s};if(t.configuration.drawHandles&&Object(_.default)(e,n,i.handles,y),!0===i.invalidated&&(i.rAngle?t.throttledUpdateCachedStats(h,p,i):t.updateCachedStats(h,p,i)),i.rAngle){var T,C=function(e,t,n){var r=t&&n?"":" (isotropic)";return e.rAngle.toString()+String.fromCharCode(parseInt("00B0",16))+r}(i,k,E);if(!i.handles.textBox.hasMoved){T={x:m.x,y:m.y};var I=Object(w.textBoxWidth)(e,C,5);m.x<d.x?T.x-=15+I+10:T.x+=15;var O=f.default.cornerstone.internal.getTransform(r);O.invert();var D=O.transformPoint(T.x,T.y);i.handles.textBox.x=D.x,i.handles.textBox.y=D.y}Object(x.default)(e,n.element,i.handles.textBox,C,i.handles,A,u,S,0,!0)}}))},C=0;C<u.data.length;C++)T(C);function A(e){return[e.start,e.middle,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this;if(!this.preventNewMeasurement){this.preventNewMeasurement=!0,e.preventDefault(),e.stopPropagation();var r=e.detail,i=this.createNewMeasurement(r),a=e.detail.element;Object(m.addToolState)(a,this.name,i),f.default.cornerstone.updateImage(a),Object(y.moveNewHandle)(r,this.name,i,i.handles.middle,this.options,t,(function(e){if(i.active=!1,!e)return Object(m.removeToolState)(a,n.name,i),void(n.preventNewMeasurement=!1);i.handles.end.active=!0,f.default.cornerstone.updateImage(a),Object(y.moveNewHandle)(r,n.name,i,i.handles.end,n.options,t,(function(e){e?(i.active=!1,f.default.cornerstone.updateImage(a)):Object(m.removeToolState)(a,n.name,i),n.preventNewMeasurement=!1,f.default.cornerstone.updateImage(a);var t={toolName:n.name,toolType:n.name,element:a,measurementData:i};Object(T.default)(a,C.default.MEASUREMENT_COMPLETED,t)}))}))}}}]),t}(p.default);function M(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function N(e,t,n){var r=Object(I.default)(e);return{x:(t.x-n.x)*(r.colPixelSpacing||1),y:(t.y-n.y)*(r.rowPixelSpacing||1)}}},"./tools/annotation/ArrowAnnotateTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return D}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseAnnotationTool.js"),m=n("./events.js"),g=n("./stateManagement/toolStyle.js"),v=n("./stateManagement/textStyle.js"),y=n("./stateManagement/toolColors.js"),b=n("./manipulators/index.js"),x=n("./util/pointInsideBoundingBox.js"),w=n("./util/lineSegDistance.js"),_=n("./util/triggerEvent.js"),k=n("./stateManagement/toolState.js"),E=n("./drawing/drawLinkedTextBox.js"),S=n("./drawing/index.js"),T=n("./drawing/drawArrow.js"),C=n("./drawing/drawHandles.js"),I=n("./drawing/drawTextBox.js"),A=n("./tools/cursors/index.js"),O=n("./store/index.js"),D=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"ArrowAnnotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:M,changeTextCallback:N,drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,arrowFirst:!0,renderDashed:!1,allowEmptyLabel:!1},svgCursor:A.arrowAnnotateCursor};return(e=l()(this,c()(t).call(this,n,r))).preventNewMeasurement=!1,e}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&Object(w.default)(e,t.handles.start,t.handles.end,n)<25}},{key:"updateCachedStats",value:function(){}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=n.element,i=n.enabledElement,a=this.configuration,o=a.handleRadius,s=a.drawHandlesOnHover,l=a.hideHandlesIfMoving,u=a.renderDashed,c=Object(k.getToolState)(r,this.name);if(c){var d,h=e.detail.canvasContext.canvas,p=Object(S.getNewContext)(h),m=g.default.getToolWidth();u&&(d=Object(O.getModule)("globalConfiguration").configuration.lineDash);for(var b=function(n){var a=c.data[n];if(!1===a.visible)return"continue";Object(S.draw)(p,(function(n){Object(S.setShadow)(n,t.configuration);var u=y.default.getColorIfActive(a),c=f.default.cornerstone.pixelToCanvas(r,a.handles.start),h=f.default.cornerstone.pixelToCanvas(r,a.handles.end);t.configuration.arrowFirst?Object(T.default)(n,h,c,u,m,d):Object(T.default)(n,c,h,u,m,d);var p={color:u,handleRadius:o,drawHandlesIfActive:s,hideHandlesIfMoving:l};t.configuration.drawHandles&&Object(C.default)(n,e.detail,a.handles,p);var g=function(e){return e.text}(a);if(g&&""!==g){var b=Object(I.textBoxWidth)(n,g,5),x=v.default.getFontSize()+10,_=Math.max(b,x)/2+5;if(h.x<c.x&&(_=-_),!a.handles.textBox.hasMoved){var k;k=t.configuration.arrowFirst?{x:h.x-b/2+_,y:h.y-x/2}:{x:c.x-b/2-_,y:c.y-x/2};var A=f.default.cornerstone.internal.getTransform(i);A.invert();var O=A.transformPoint(k.x,k.y);a.handles.textBox.x=O.x,a.handles.textBox.y=O.y}Object(E.default)(n,r,a.handles.textBox,g,a.handles,w,u,m,0,!1)}}))},x=0;x<c.data.length;x++)b(x)}function w(e){return[e.start,{x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2},e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this,r=e.detail.element,i=this.createNewMeasurement(e),a=this.configuration.allowEmptyLabel;Object(k.addToolState)(r,this.name,i),f.default.cornerstone.updateImage(r),Object(b.moveNewHandle)(e.detail,this.name,i,i.handles.end,this.options,t,(function(t){t?void 0===i.text&&n.configuration.getTextCallback((function(e){if(e||a){i.text=e,i.active=!1;var t={toolName:n.name,toolType:n.name,element:r,measurementData:i};f.default.cornerstone.updateImage(r),Object(_.default)(r,m.default.MEASUREMENT_COMPLETED,t)}else Object(k.removeToolState)(r,n.name,i)}),e.detail):Object(k.removeToolState)(r,n.name,i),f.default.cornerstone.updateImage(r)}))}},{key:"doubleClickCallback",value:function(e){return this._updateTextForNearbyAnnotation(e)}},{key:"touchPressCallback",value:function(e){return this._updateTextForNearbyAnnotation(e)}},{key:"_updateTextForNearbyAnnotation",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.canvas,r=Object(k.getToolState)(t,this.name);if(!r)return!1;for(var i=0;i<r.data.length;i++){var a=r.data[i];if(this.pointNearTool(t,a,n)||Object(x.default)(a.handles.textBox,n))return a.active=!0,f.default.cornerstone.updateImage(t),this.configuration.changeTextCallback(a,e.detail,this._doneChangingTextCallback.bind(this,t,a)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}}},{key:"_doneChangingTextCallback",value:function(e,t,n,r){!0===r?Object(k.removeToolState)(e,this.name,t):t.text=n,t.active=!1,f.default.cornerstone.updateImage(e),Object(_.default)(e,m.default.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}}]),t}(p.default);function M(e){e(prompt("Enter your annotation:"))}function N(e,t,n){n(prompt("Change your annotation:"))}},"./tools/annotation/BidirectionalTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return A}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./tools/base/BaseAnnotationTool.js"),g=n("./tools/annotation/bidirectionalTool/createNewMeasurement.js"),v=n("./tools/annotation/bidirectionalTool/pointNearTool.js"),y=n("./tools/annotation/bidirectionalTool/renderToolData.js"),b=n("./tools/annotation/bidirectionalTool/addNewMeasurement.js"),x=n("./tools/annotation/bidirectionalTool/mouseMoveCallback.js"),w=n("./tools/annotation/bidirectionalTool/handleSelectedCallback.js"),_=n("./tools/annotation/bidirectionalTool/handleSelectedMouseCallback.js"),k=n("./tools/annotation/bidirectionalTool/handleSelectedTouchCallback.js"),E=n("./tools/cursors/index.js"),S=n("./util/throttle.js"),T=n("./util/getPixelSpacing.js"),C=n("./tools/annotation/bidirectionalTool/utils/calculateLongestAndShortestDiameters.js"),I=function(e,t,n){return n()},A=function(e){function t(e){var n;i()(this,t);var r={name:"Bidirectional",supportedInteractionTypes:["Mouse","Touch"],configuration:{changeMeasurementLocationCallback:I,getMeasurementLocationCallback:I,textBox:"",shadow:"",drawHandles:!0,drawHandlesOnHover:!0,hideHandlesIfMoving:!1,renderDashed:!1,additionalData:[]},svgCursor:E.bidirectionalCursor};return(n=l()(this,c()(t).call(this,e,r))).throttledUpdateCachedStats=Object(S.default)(n.updateCachedStats,110),n.createNewMeasurement=g.default.bind(h()(n)),n.pointNearTool=v.default.bind(h()(n)),n.renderToolData=y.default.bind(h()(n)),n.addNewMeasurement=b.default.bind(h()(n)),n._moveCallback=x.default.bind(h()(n)),n.handleSelectedCallback=w.default.bind(h()(n)),n.handleSelectedMouseCallback=_.default.bind(h()(n)),n.handleSelectedTouchCallback=k.default.bind(h()(n)),n}return p()(t,e),o()(t,[{key:"updateCachedStats",value:function(e,t,n){if(n.toolName===this.name){var r=Object(T.default)(e),i=Object(C.default)(n,r),a=i.shortestDiameter;n.longestDiameter=i.longestDiameter,n.shortestDiameter=a,n.invalidated=!1}}}]),t}(m.default)},"./tools/annotation/CircleRoiTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return O}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseAnnotationTool.js"),m=n("./stateManagement/toolState.js"),g=n("./stateManagement/toolStyle.js"),v=n("./stateManagement/toolColors.js"),y=n("./store/index.js"),b=n("./drawing/index.js"),x=n("./util/calculateSUV.js"),w=n("./util/ellipse/index.js"),_=n("./util/getROITextBoxCoords.js"),k=n("./util/numbersWithCommas.js"),E=n("./util/throttle.js"),S=n("./util/logger.js"),T=n("./util/getPixelSpacing.js"),C=n("./tools/cursors/index.js"),I=n("./util/getCircleCoords.js"),A=Object(S.getLogger)("tools:annotation:CircleRoiTool"),O=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"CircleRoi",supportedInteractionTypes:["Mouse","Touch"],svgCursor:C.circleRoiCursor,configuration:{renderDashed:!1,hideHandlesIfMoving:!1}};return(e=l()(this,c()(t).call(this,n,r))).throttledUpdateCachedStats=Object(E.default)(e.updateCachedStats,110),e}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};A.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,r){var i=t&&t.handles&&t.handles.start&&t.handles.end,a=f.default.cornerstoneMath.point.distance;if(i||A.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!i||!1===t.visible)return!1;var o="mouse"===r?15:25,s=f.default.cornerstone.pixelToCanvas(e,t.handles.start),l=f.default.cornerstone.pixelToCanvas(e,t.handles.end),u=a(s,n),c=a(s,l);return u>c-o/2&&u<c+o/2}},{key:"updateCachedStats",value:function(e,t,n){var r=(f.default.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,i=Object(T.default)(e),a=function(e,t,n,r,i){var a,o=Object(I.default)(n.start,n.end),s=f.default.cornerstone.getPixels(t,o.left,o.top,o.width,o.height),l=Object(w.calculateEllipseStatistics)(s,o);return"PT"===r&&(a={mean:Object(x.default)(e,l.mean,!0)||0,stdDev:Object(x.default)(e,l.stdDev,!0)||0}),{area:Math.PI*(o.width*(i.colPixelSpacing||1)/2)*(o.height*(i.rowPixelSpacing||1)/2)||0,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:a}}(e,t,n.handles,r,i);n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=Object(m.getToolState)(e.currentTarget,this.name);if(n){var r=f.default.cornerstoneMath.point.distance,i=e.detail,a=i.image,o=i.element,s=i.canvasContext,l=g.default.getToolWidth(),u=this.configuration,c=u.handleRadius,d=u.drawHandlesOnHover,h=u.hideHandlesIfMoving,p=u.renderDashed,x=Object(b.getNewContext)(s.canvas),w=Object(T.default)(a),k=w.rowPixelSpacing,E=w.colPixelSpacing,S=Object(y.getModule)("globalConfiguration").configuration.lineDash,C=(f.default.cornerstone.metaData.get("generalSeriesModule",a.imageId)||{}).modality,A=k&&E;Object(b.draw)(x,(function(e){for(var s=0;s<n.data.length;s++){var u=n.data[s];if(!1!==u.visible){var m=v.default.getColorIfActive(u),g={color:m,handleRadius:c,drawHandlesIfActive:d,hideHandlesIfMoving:h};Object(b.setShadow)(e,t.configuration);var y=f.default.cornerstone.pixelToCanvas(o,u.handles.start),x=f.default.cornerstone.pixelToCanvas(o,u.handles.end),w=r(y,x),k={color:m};if(p&&(k.lineDash=S),Object(b.drawCircle)(e,o,u.handles.start,w,k,"pixel"),Object(b.drawHandles)(e,i,u.handles,g),!0===u.invalidated&&(u.cachedStats?t.throttledUpdateCachedStats(a,o,u):t.updateCachedStats(a,o,u)),!u.handles.textBox.hasMoved){var E=Object(_.default)(i.viewport,u.handles);Object.assign(u.handles.textBox,E)}var T=M(e,a.color,u.cachedStats,C,A,t.configuration);u.unit=D(C,t.configuration.showHounsfieldUnits),Object(b.drawLinkedTextBox)(e,o,u.handles.textBox,T,u.handles,(function(e){return t=e.start,n=e.end,[{x:(i=(r=Object(I.default)(t,n)).left)+(o=r.width)/2,y:a=r.top},{x:i,y:a+(s=r.height)/2},{x:i+o/2,y:a+s},{x:i+o,y:a+s/2}];var t,n,r,i,a,o,s}),m,l,10,!0)}}}))}}}]),t}(p.default);function D(e,t){return"CT"===e&&!1!==t?"HU":""}function M(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.area,i=n.mean,a=n.stdDev,o=n.min,s=n.max,l=n.meanStdDevSUV,u=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},h=d.showMinMax||!1,f=[],p=[];if(!t){var m=l&&0!==l.mean,g=D(u,d.showHounsfieldUnits),v="Mean: ".concat(Object(k.default)(i.toFixed(2))," ").concat(g),y="Std Dev: ".concat(Object(k.default)(a.toFixed(2))," ").concat(g);if(m){for(var b=" SUV: ",x="".concat(b).concat(Object(k.default)(l.mean.toFixed(2))),w="".concat(b).concat(Object(k.default)(l.stdDev.toFixed(2))),_=Math.floor(e.measureText("".concat(y,"     ")).width);e.measureText(v).width<_;)v+=" ";p.push("".concat(v).concat(x)),p.push("".concat(y,"     ").concat(w))}else p.push("".concat(v,"     ").concat(y));if(h){for(var E="Min: ".concat(o," ").concat(g),S="Max: ".concat(s," ").concat(g),T=m?Math.floor(e.measureText("".concat(y,"     ")).width):Math.floor(e.measureText("".concat(v,"     ")).width);e.measureText(E).width<T;)E+=" ";p.push("".concat(E).concat(S))}}return f.push(N(r,c)),p.forEach((function(e){return f.push(e)})),f}function N(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(Object(k.default)(e.toFixed(2))).concat(n)}},"./tools/annotation/CobbAngleTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return D}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseAnnotationTool.js"),m=n("./stateManagement/textStyle.js"),g=n("./stateManagement/toolState.js"),v=n("./stateManagement/toolStyle.js"),y=n("./stateManagement/toolColors.js"),b=n("./manipulators/index.js"),x=n("./drawing/index.js"),w=n("./drawing/drawHandles.js"),_=n("./drawing/drawLinkedTextBox.js"),k=n("./util/lineSegDistance.js"),E=n("./util/roundToDecimal.js"),S=n("./events.js"),T=n("./tools/cursors/index.js"),C=n("./util/triggerEvent.js"),I=n("./util/throttle.js"),A=n("./util/getPixelSpacing.js"),O=n("./store/index.js"),D=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"CobbAngle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:T.cobbAngleCursor,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(e=l()(this,c()(t).call(this,n,r))).hasIncomplete=!1,e.throttledUpdateCachedStats=Object(I.default)(e.updateCachedStats,110),e}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){return this.hasIncomplete=!0,{visible:!0,active:!0,color:void 0,invalidated:!0,complete:!1,value:"",handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},end2:{x:e.currentPoints.image.x+1,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&!this.hasIncomplete&&(Object(k.default)(e,t.handles.start,t.handles.end,n)<25||Object(k.default)(e,t.handles.start2,t.handles.end2,n)<25)}},{key:"updateCachedStats",value:function(e,t,n){var r=Object(A.default)(e),i=r.rowPixelSpacing,a=r.colPixelSpacing,o=(Math.ceil(n.handles.start.x)-Math.ceil(n.handles.end.x))*(a||1),s=(Math.ceil(n.handles.start.y)-Math.ceil(n.handles.end.y))*(i||1),l=(Math.ceil(n.handles.start2.x)-Math.ceil(n.handles.end2.x))*(a||1),u=(Math.ceil(n.handles.start2.y)-Math.ceil(n.handles.end2.y))*(i||1),c=Math.acos(Math.abs((o*l+s*u)/(Math.sqrt(o*o+s*s)*Math.sqrt(l*l+u*u))));c*=180/Math.PI,n.rAngle=Object(E.default)(c,2),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=this.configuration,i=r.handleRadius,a=r.drawHandlesOnHover,o=r.hideHandlesIfMoving,s=r.renderDashed,l=Object(g.getToolState)(e.currentTarget,this.name);if(l)for(var u=Object(x.getNewContext)(n.canvasContext.canvas),c=v.default.getToolWidth(),d=Object(O.getModule)("globalConfiguration").configuration.lineDash,h=m.default.getFont(),f=function(e){var r=l.data[e];if(!1===r.visible)return"continue";Object(x.draw)(u,(function(e){Object(x.setShadow)(e,t.configuration);var l=y.default.getColorIfActive(r),u={color:l};s&&(u.lineDash=d),Object(x.drawLine)(e,n.element,r.handles.start,r.handles.end,u),r.complete&&Object(x.drawLine)(e,n.element,r.handles.start2,r.handles.end2,u);var f={color:l,handleRadius:i,drawHandlesIfActive:a,hideHandlesIfMoving:o};t.configuration.drawHandles&&Object(w.default)(e,n,r.handles,f),e.fillStyle=l;var p=r.value;if(!r.handles.textBox.hasMoved){var m={x:(r.handles.start.x+r.handles.end.x)/2,y:(r.handles.start.y+r.handles.end.y)/2-10};e.font=h,r.handles.textBox.x=m.x,r.handles.textBox.y=m.y}Object(_.default)(e,n.element,r.handles.textBox,p,r.handles,b,l,c,0,!0)}))},p=0;p<l.data.length;p++)f(p);function b(e){return[e.start,e.start2,e.end,e.end2]}}},{key:"getIncomplete",value:function(e){var t=Object(g.getToolState)(e,this.name);if(t&&Array.isArray(t.data))return t.data.find((function(e){return!1===e.complete}))}},{key:"addNewMeasurement",value:function(e,t){var n=this;e.preventDefault(),e.stopPropagation();var r,i,a=e.detail,o=function(e){e||Object(g.removeToolState)(s,n.name,r)},s=e.detail.element,l=this.getIncomplete(s);l?((r=l).complete=!0,r.handles.start2={x:a.currentPoints.image.x,y:a.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!1},r.handles.end2={x:a.currentPoints.image.x,y:a.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!0},i=r.handles.end2,this.hasIncomplete=!1,o=function(e){if(e){var t=S.default.MEASUREMENT_COMPLETED,i={toolName:n.name,toolType:n.name,element:s,measurementData:r};Object(C.default)(s,t,i)}else Object(g.removeToolState)(s,n.name,r)}):(r=this.createNewMeasurement(a),Object(g.addToolState)(s,this.name,r),i=r.handles.end),f.default.cornerstone.updateImage(s),Object(b.moveNewHandle)(a,this.name,r,i,this.options,t,o)}},{key:"onMeasureModified",value:function(e){var t=e.detail.element,n=f.default.cornerstone.getEnabledElement(t).image,r=Object(A.default)(n),i=r.rowPixelSpacing,a=r.colPixelSpacing;if(e.detail.toolName===this.name){var o=e.detail.measurementData;!0===o.invalidated&&(o.rAngle?this.throttledUpdateCachedStats(n,t,o):this.updateCachedStats(n,t,o));var s=o.rAngle;o.value="",Number.isNaN(s)||(o.value=function(e,t,n){var r=t&&n?"":" (isotropic)";return e.toString()+String.fromCharCode(parseInt("00B0",16))+r}(s,i,a))}}},{key:"activeCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(S.default.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"passiveCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(S.default.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"enabledCallback",value:function(e){e.removeEventListener(S.default.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"disabledCallback",value:function(e){e.removeEventListener(S.default.MEASUREMENT_MODIFIED,this.onMeasureModified)}}]),t}(p.default)},"./tools/annotation/EllipticalRoiTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return O}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseAnnotationTool.js"),m=n("./stateManagement/toolState.js"),g=n("./stateManagement/toolStyle.js"),v=n("./stateManagement/toolColors.js"),y=n("./manipulators/getHandleNearImagePoint.js"),b=n("./drawing/index.js"),x=n("./util/calculateSUV.js"),w=n("./util/ellipse/index.js"),_=n("./util/getROITextBoxCoords.js"),k=n("./util/numbersWithCommas.js"),E=n("./util/throttle.js"),S=n("./tools/cursors/index.js"),T=n("./util/logger.js"),C=n("./util/getPixelSpacing.js"),I=n("./store/index.js"),A=Object(T.getLogger)("tools:annotation:EllipticalRoiTool"),O=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"EllipticalRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:S.ellipticalRoiCursor};return(e=l()(this,c()(t).call(this,n,r))).throttledUpdateCachedStats=Object(E.default)(e.updateCachedStats,110),e}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};A.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,r){var i=t&&t.handles&&t.handles.start&&t.handles.end;if(i||A.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!i||!1===t.visible)return!1;if(Object(y.default)(e,t.handles,n,6))return!0;var a="mouse"===r?15:25,o=f.default.cornerstone.pixelToCanvas(e,t.handles.start),s=f.default.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(o.x,s.x)+a/2,top:Math.min(o.y,s.y)+a/2,width:Math.abs(o.x-s.x)-a,height:Math.abs(o.y-s.y)-a},u={left:Math.min(o.x,s.x)-a/2,top:Math.min(o.y,s.y)-a/2,width:Math.abs(o.x-s.x)+a,height:Math.abs(o.y-s.y)+a},c=Object(w.pointInEllipse)(l,n);return!(!Object(w.pointInEllipse)(u,n)||c)}},{key:"updateCachedStats",value:function(e,t,n){var r=(f.default.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,i=Object(C.default)(e),a=function(e,t,n,r,i){var a,o=j(n.start,n.end),s=f.default.cornerstone.getPixels(t,o.left,o.top,o.width,o.height),l=Object(w.calculateEllipseStatistics)(s,o);return"PT"===r&&(a={mean:Object(x.default)(e,l.mean,!0)||0,stdDev:Object(x.default)(e,l.stdDev,!0)||0}),{area:Math.PI*(o.width*(i.colPixelSpacing||1)/2)*(o.height*(i.rowPixelSpacing||1)/2)||0,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:a}}(e,t,n.handles,r,i);n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=Object(m.getToolState)(e.currentTarget,this.name);if(n){var r=e.detail,i=r.image,a=r.element,o=g.default.getToolWidth(),s=Object(I.getModule)("globalConfiguration").configuration.lineDash,l=this.configuration,u=l.handleRadius,c=l.drawHandlesOnHover,d=l.hideHandlesIfMoving,h=l.renderDashed,p=Object(b.getNewContext)(r.canvasContext.canvas),y=Object(C.default)(i),x=y.rowPixelSpacing,w=y.colPixelSpacing,k=(f.default.cornerstone.metaData.get("generalSeriesModule",i.imageId)||{}).modality,E=x&&w;Object(b.draw)(p,(function(e){for(var l=0;l<n.data.length;l++){var f=n.data[l];if(!1!==f.visible){var p=v.default.getColorIfActive(f),m={color:p,handleRadius:u,drawHandlesIfActive:c,hideHandlesIfMoving:d};Object(b.setShadow)(e,t.configuration);var g={color:p};if(h&&(g.lineDash=s),Object(b.drawEllipse)(e,a,f.handles.start,f.handles.end,g,"pixel",f.handles.initialRotation),Object(b.drawHandles)(e,r,f.handles,m),!0===f.invalidated&&(f.cachedStats?t.throttledUpdateCachedStats(i,a,f):t.updateCachedStats(i,a,f)),!f.handles.textBox.hasMoved){var y=Object(_.default)(r.viewport,f.handles);Object.assign(f.handles.textBox,y)}var x=M(e,i.color,f.cachedStats,k,E,t.configuration);f.unit=D(k,t.configuration.showHounsfieldUnits),Object(b.drawLinkedTextBox)(e,a,f.handles.textBox,x,f.handles,(function(e){return[{x:(n=(t=j(e.start,e.end)).left)+(i=t.width)/2,y:r=t.top},{x:n,y:r+(a=t.height)/2},{x:n+i/2,y:r+a},{x:n+i,y:r+a/2}];var t,n,r,i,a}),p,o,10,!0)}}}))}}}]),t}(p.default);function D(e,t){return"CT"===e&&!1!==t?"HU":""}function M(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.area,i=n.mean,a=n.stdDev,o=n.min,s=n.max,l=n.meanStdDevSUV,u=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},h=d.showMinMax||!1,f=[],p=[];if(!t){var m=l&&0!==l.mean,g=D(u,d.showHounsfieldUnits),v="Mean: ".concat(Object(k.default)(i.toFixed(2))," ").concat(g),y="Std Dev: ".concat(Object(k.default)(a.toFixed(2))," ").concat(g);if(m){for(var b=" SUV: ",x="".concat(b).concat(Object(k.default)(l.mean.toFixed(2))),w="".concat(b).concat(Object(k.default)(l.stdDev.toFixed(2))),_=Math.floor(e.measureText("".concat(y,"     ")).width);e.measureText(v).width<_;)v+=" ";p.push("".concat(v).concat(x)),p.push("".concat(y,"     ").concat(w))}else p.push("".concat(v,"     ").concat(y));if(h){for(var E="Min: ".concat(o," ").concat(g),S="Max: ".concat(s," ").concat(g),T=m?Math.floor(e.measureText("".concat(y,"     ")).width):Math.floor(e.measureText("".concat(v,"     ")).width);e.measureText(E).width<T;)E+=" ";p.push("".concat(E).concat(S))}}return f.push(N(r,c)),p.forEach((function(e){return f.push(e)})),f}function N(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(Object(k.default)(e.toFixed(2))).concat(n)}function j(e,t){return{left:Math.round(Math.min(e.x,t.x)),top:Math.round(Math.min(e.y,t.y)),width:Math.round(Math.abs(e.x-t.x)),height:Math.round(Math.abs(e.y-t.y))}}},"./tools/annotation/FreehandRoiTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return U}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./events.js"),g=n("./externalModules.js"),v=n("./tools/base/BaseAnnotationTool.js"),y=n("./stateManagement/toolState.js"),b=n("./stateManagement/toolStyle.js"),x=n("./stateManagement/toolColors.js"),w=n("./store/index.js"),_=n("./util/triggerEvent.js"),k=n("./util/findAndMoveHelpers.js"),E=n("./util/pointInsideBoundingBox.js"),S=n("./util/calculateSUV.js"),T=n("./util/numbersWithCommas.js"),C=n("./drawing/index.js"),I=n("./drawing/drawLinkedTextBox.js"),A=n("./drawing/drawHandles.js"),O=n("./util/clip.js"),D=n("./store/setToolCursor.js"),M=n("./tools/cursors/index.js"),N=n("./util/freehand/index.js"),j=n("./util/logger.js"),F=n("./util/throttle.js"),R=Object(j.getLogger)("tools:annotation:FreehandRoiTool"),P=N.default.insertOrDelete,L=N.default.freehandArea,B=N.default.calculateFreehandStatistics,$=N.default.freehandIntersect,z=N.default.FreehandHandleData,U=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"FreehandRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},spacing:1,activeHandleRadius:3,completeHandleRadius:6,completeHandleRadiusTouch:28,alwaysShowHandles:!1,invalidColor:"crimson",currentHandle:0,currentTool:-1,drawHandles:!0,renderDashed:!1},svgCursor:M.freehandRoiCursor};return(e=l()(this,c()(t).call(this,n,r))).isMultiPartTool=!0,e._drawing=!1,e._dragging=!1,e._modifying=!1,e._drawingMouseDownCallback=e._drawingMouseDownCallback.bind(h()(e)),e._drawingMouseMoveCallback=e._drawingMouseMoveCallback.bind(h()(e)),e._drawingMouseDragCallback=e._drawingMouseDragCallback.bind(h()(e)),e._drawingMouseUpCallback=e._drawingMouseUpCallback.bind(h()(e)),e._drawingMouseDoubleClickCallback=e._drawingMouseDoubleClickCallback.bind(h()(e)),e._editMouseUpCallback=e._editMouseUpCallback.bind(h()(e)),e._editMouseDragCallback=e._editMouseDragCallback.bind(h()(e)),e._drawingTouchStartCallback=e._drawingTouchStartCallback.bind(h()(e)),e._drawingTouchDragCallback=e._drawingTouchDragCallback.bind(h()(e)),e._drawingDoubleTapClickCallback=e._drawingDoubleTapClickCallback.bind(h()(e)),e._editTouchDragCallback=e._editTouchDragCallback.bind(h()(e)),e.throttledUpdateCachedStats=Object(F.default)(e.updateCachedStats,110),e}return p()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t={visible:!0,active:!0,invalidated:!0,color:void 0,handles:{points:[]}};return t.handles.textBox={active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0},t}R.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var r=t&&t.handles&&t.handles.points;if(!r)throw new Error("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool"));return!(!r||!1===t.visible)&&void 0!==this._pointNearHandle(e,t,n)}},{key:"distanceFromPoint",value:function(e,t,n){for(var r=1/0,i=0;i<t.handles.points.length;i++){var a=g.default.cornerstoneMath.point.distance(t.handles.points[i],n);r=Math.min(r,a)}return r===1/0?-1:r}},{key:"distanceFromPointCanvas",value:function(e,t,n){var r=1/0;if(!t)return-1;for(var i=g.default.cornerstone.pixelToCanvas(e,n),a=t.handles.points,o=0;o<a.length;o++){var s=g.default.cornerstone.pixelToCanvas(e,a[o]),l=g.default.cornerstoneMath.point.distance(s,i);r=Math.min(r,l)}return r===1/0?-1:r}},{key:"updateCachedStats",value:function(e,t,n){for(var r,i,a=g.default.cornerstone.metaData.get("generalSeriesModule",e.imageId),o=a?a.modality:null,s=n.handles.points,l={left:s[0].x,right:s[0].x,bottom:s[0].y,top:s[0].x},u=0;u<s.length;u++)l.left=Math.min(l.left,s[u].x),l.right=Math.max(l.right,s[u].x),l.bottom=Math.min(l.bottom,s[u].y),l.top=Math.max(l.top,s[u].y);var c={left:l.left,top:l.bottom,width:Math.abs(l.right-l.left),height:Math.abs(l.top-l.bottom)};if(n.polyBoundingBox=c,!e.color){var d=g.default.cornerstone.getPixels(t,c.left,c.top,c.width,c.height);r=B.call(this,d,c,n.handles.points),"PT"===o&&(i={mean:Object(S.default)(e,(r.mean-e.intercept)/e.slope),stdDev:Object(S.default)(e,(r.stdDev-e.intercept)/e.slope)}),r&&!isNaN(r.mean)&&(n.meanStdDev=r,n.meanStdDevSUV=i)}var h=L(n.handles.points,(e.columnPixelSpacing||1)*(e.rowPixelSpacing||1));isNaN(h)||(n.area=h),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=Object(y.getToolState)(e.currentTarget,this.name);if(r)for(var i=n.image,a=n.element,o=this.configuration,s=g.default.cornerstone.metaData.get("generalSeriesModule",i.imageId),l=s?s.modality:null,u=Object(C.getNewContext)(n.canvasContext.canvas),c=b.default.getToolWidth(),d=o.renderDashed,h=Object(w.getModule)("globalConfiguration").configuration.lineDash,f=function(e){var s=r.data[e];if(!1===s.visible)return"continue";Object(C.draw)(u,(function(e){var r,l=x.default.getColorIfActive(s);s.active?s.handles.invalidHandlePlacement?(l=o.invalidColor,r=o.invalidColor):(l=x.default.getColorIfActive(s),r=x.default.getFillColor()):r=x.default.getToolColor();var u={color:l};if(d&&(u.lineDash=h),s.handles.points.length){var f=s.handles.points;Object(C.drawJoinedLines)(e,a,f[0],f,u),s.polyBoundingBox?Object(C.drawJoinedLines)(e,a,f[f.length-1],[f[0]],u):Object(C.drawJoinedLines)(e,a,f[f.length-1],[o.mouseLocation.handles.start],u)}if(u={color:l,fill:r},(o.alwaysShowHandles||s.active&&s.polyBoundingBox)&&(u.handleRadius=o.activeHandleRadius,t.configuration.drawHandles&&Object(A.default)(e,n,s.handles.points,u)),s.canComplete){u.handleRadius=o.completeHandleRadius;var p=s.handles.points[0];t.configuration.drawHandles&&Object(A.default)(e,n,[p],u)}if(s.active&&!s.polyBoundingBox){u.handleRadius=o.activeHandleRadius,t.configuration.drawHandles&&Object(A.default)(e,n,o.mouseLocation.handles,u);var g=s.handles.points[0];t.configuration.drawHandles&&Object(A.default)(e,n,[g],u)}if(!0!==s.invalidated||s.active||(s.meanStdDev&&s.meanStdDevSUV&&s.area?t.throttledUpdateCachedStats(i,a,s):t.updateCachedStats(i,a,s)),s.polyBoundingBox&&!s.handles.textBox.freehand){s.handles.textBox.hasMoved||(s.handles.textBox.x=s.polyBoundingBox.left+s.polyBoundingBox.width,s.handles.textBox.y=s.polyBoundingBox.top+s.polyBoundingBox.height/2);var y=m.call(t,s);Object(I.default)(e,a,s.handles.textBox,y,s.handles.points,v,l,c,0,!0)}}))},p=0;p<r.data.length;p++)f(p);function m(e){var t=e.meanStdDev,n=e.meanStdDevSUV,r=e.area,a=[];if(t&&void 0!==t.mean){var o="";"CT"===l&&(o="HU"),e.unit=o;var s="Mean: ".concat(Object(T.default)(t.mean.toFixed(2))," ").concat(o),u="StdDev: ".concat(Object(T.default)(t.stdDev.toFixed(2))," ").concat(o);if(n&&void 0!==n.mean){var c=" SUV: ";s+=c+Object(T.default)(n.mean.toFixed(2)),u+=c+Object(T.default)(n.stdDev.toFixed(2))}a.push(s),a.push(u)}if(r){var d=" mm".concat(String.fromCharCode(178));i.rowPixelSpacing&&i.columnPixelSpacing||(d=" pixels".concat(String.fromCharCode(178)));var h="Area: ".concat(Object(T.default)(r.toFixed(2))).concat(d);a.push(h)}return a}function v(e){return e}}},{key:"addNewMeasurement",value:function(e){var t=e.detail;this._startDrawing(e),this._addPoint(t),H(e)}},{key:"preMouseDownCallback",value:function(e){var t=e.detail,n=this._pointNearHandleAllTools(t);return!!t.event.ctrlKey&&(void 0!==n&&n.handleNearby.hasBoundingBox||P.call(this,e,n),H(e),!0)}},{key:"handleSelectedCallback",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",i=e.detail.element,a=Object(y.getToolState)(i,this.name);if(n.hasBoundingBox)Object(k.moveHandleNearImagePoint)(e,this,t,n,r);else{var o=this.configuration;o.dragOrigin={x:n.x,y:n.y};for(var s=0;s<a.data.length;s++)for(var l=a.data[s].handles.points,u=0;u<l.length;u++)l[u]===n&&(o.currentHandle=u,o.currentTool=s);this._modifying=!0,this._activateModify(i),H(e)}}},{key:"_drawingMouseMoveCallback",value:function(e){var t=e.detail,n=t.currentPoints,r=t.element,i=Object(y.getToolState)(r,this.name),a=this.configuration,o=i.data[a.currentTool],s=n.canvas;this._getMouseLocation(t),this._checkInvalidHandleLocation(o,t);var l=this._pointNearHandle(r,o,s),u=o.handles.points;void 0!==l&&!l.hasBoundingBox&&l<u.length-1&&(a.mouseLocation.handles.start.x=u[l].x,a.mouseLocation.handles.start.y=u[l].y),g.default.cornerstone.updateImage(r)}},{key:"_drawingMouseDragCallback",value:function(e){this.options.mouseButtonMask.includes(e.detail.buttons)&&this._drawingDrag(e)}},{key:"_drawingTouchDragCallback",value:function(e){this._drawingDrag(e)}},{key:"_drawingDrag",value:function(e){var t=e.detail,n=t.element,r=Object(y.getToolState)(n,this.name).data[this.configuration.currentTool];this._getMouseLocation(t),this._checkInvalidHandleLocation(r,t),this._addPointPencilMode(t,r.handles.points),this._dragging=!0,g.default.cornerstone.updateImage(n)}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail.element;if(this._dragging){this._dragging=!1;var n=this.configuration,r=n.currentTool,i=Object(y.getToolState)(t,this.name).data[r];!$.end(i.handles.points)&&i.canComplete&&this._endDrawing(t,n.currentHandle),H(e)}}},{key:"_drawingMouseDownCallback",value:function(e){var t=e.detail,n=t.currentPoints,r=t.element;if(this.options.mouseButtonMask.includes(t.buttons)){var i=n.canvas,a=this.configuration,o=a.currentTool,s=Object(y.getToolState)(r,this.name).data[o],l=this._pointNearHandle(r,s,i);!$.end(s.handles.points)&&s.canComplete?this._endDrawing(r,a.currentHandle):void 0===l&&this._addPoint(t),H(e)}}},{key:"_drawingTouchStartCallback",value:function(e){var t=e.detail,n=t.element,r=t.currentPoints.canvas,i=this.configuration,a=i.currentTool,o=Object(y.getToolState)(n,this.name).data[a],s=this._pointNearHandle(n,o,r);!$.end(o.handles.points)&&o.canComplete?this._endDrawing(n,i.currentHandle):void 0===s&&this._addPoint(t),H(e)}},{key:"completeDrawing",value:function(e){if(this._drawing){var t=Object(y.getToolState)(e,this.name),n=this.configuration,r=t.data[n.currentTool];if(!$.end(r.handles.points)&&r.handles.points.length>=2){var i=n.currentHandle;r.polyBoundingBox={},this._endDrawing(e,i)}}}},{key:"_drawingMouseDoubleClickCallback",value:function(e){this.completeDrawing(e.detail.element),H(e)}},{key:"_drawingDoubleTapClickCallback",value:function(e){this.completeDrawing(e.detail.element),H(e)}},{key:"_editMouseDragCallback",value:function(e){var t=e.detail,n=t.element;if(this.options.mouseButtonMask.includes(t.buttons)){var r,i=Object(y.getToolState)(n,this.name),a=this.configuration,o=i.data[a.currentTool],s=a.currentHandle,l=o.handles.points;if(this._getMouseLocation(t),o.handles.invalidHandlePlacement=$.modify(l,s),o.active=!0,o.highlight=!0,l[s].x=a.mouseLocation.handles.start.x,l[s].y=a.mouseLocation.handles.start.y,r=this._getPrevHandleIndex(s,l),s>=0){var u=l[r].lines[l[r].lines.length-1];u.x=a.mouseLocation.handles.start.x,u.y=a.mouseLocation.handles.start.y}g.default.cornerstone.updateImage(n)}}},{key:"_editTouchDragCallback",value:function(e){var t,n=e.detail,r=n.element,i=Object(y.getToolState)(r,this.name),a=this.configuration,o=i.data[a.currentTool],s=a.currentHandle,l=o.handles.points;if(this._getMouseLocation(n),o.handles.invalidHandlePlacement=$.modify(l,s),o.active=!0,o.highlight=!0,l[s].x=a.mouseLocation.handles.start.x,l[s].y=a.mouseLocation.handles.start.y,t=this._getPrevHandleIndex(s,l),s>=0){var u=l[t].lines[l[t].lines.length-1];u.x=a.mouseLocation.handles.start.x,u.y=a.mouseLocation.handles.start.y}g.default.cornerstone.updateImage(r)}},{key:"_getPrevHandleIndex",value:function(e,t){return 0===e?t.length-1:e-1}},{key:"_editMouseUpCallback",value:function(e){var t=e.detail,n=t.element,r=Object(y.getToolState)(n,this.name);this._deactivateModify(n),this._dropHandle(t,r),this._endDrawing(n),g.default.cornerstone.updateImage(n)}},{key:"_dropHandle",value:function(e,t){var n=this.configuration,r=t.data[n.currentTool].handles,i=r.points;if(r.invalidHandlePlacement){var a,o=n.currentHandle,s=i[o];a=0===o?i[i.length-1]:i[o-1],s.x=n.dragOrigin.x,s.y=n.dragOrigin.y,a.lines[0]=s,r.invalidHandlePlacement=!1}}},{key:"_startDrawing",value:function(e){var t,n=e.detail,r=this.createNewMeasurement(n),i=n.element,a=this.configuration;e.type===m.default.MOUSE_DOWN_ACTIVATE?t="Mouse":e.type===m.default.TOUCH_START_ACTIVE&&(t="Touch"),this._activateDraw(i,t),this._getMouseLocation(n),Object(y.addToolState)(i,this.name,r);var o=Object(y.getToolState)(i,this.name);a.currentTool=o.data.length-1,this._activeDrawingToolReference=o.data[a.currentTool]}},{key:"_addPoint",value:function(e){var t=e.currentPoints,n=e.element,r=Object(y.getToolState)(n,this.name),i=this.configuration,a=r.data[i.currentTool];if(!a.handles.invalidHandlePlacement){var o=new z(t.image);a.handles.points.length&&a.handles.points[i.currentHandle-1].lines.push(t.image),a.handles.points.push(o),i.currentHandle+=1,g.default.cornerstone.updateImage(n),this.fireModifiedEvent(n,a)}}},{key:"_addPointPencilMode",value:function(e,t){var n=this,r=e.element,i=this.configuration.mouseLocation.handles.start;t.every((function(e){return n._isDistanceLargerThanSpacing(r,e,i)}))&&this._addPoint(e)}},{key:"_endDrawing",value:function(e,t){var n=Object(y.getToolState)(e,this.name),r=this.configuration,i=n.data[r.currentTool];if(i.active=!1,i.highlight=!1,i.handles.invalidHandlePlacement=!1,void 0!==t){var a=i.handles.points;a[r.currentHandle-1].lines.push(a[0])}this._modifying&&(this._modifying=!1,i.invalidated=!0),r.currentHandle=0,r.currentTool=-1,i.canComplete=!1,this._drawing&&this._deactivateDraw(e),g.default.cornerstone.updateImage(e),this.fireModifiedEvent(e,i),this.fireCompletedEvent(e,i)}},{key:"_pointNearHandle",value:function(e,t,n){if(void 0!==t.handles&&void 0!==t.handles.points&&!1!==t.visible){for(var r=0;r<t.handles.points.length;r++){var i=g.default.cornerstone.pixelToCanvas(e,t.handles.points[r]);if(g.default.cornerstoneMath.point.distance(i,n)<6)return r}return t.handles.textBox&&Object(E.default)(t.handles.textBox,n)?t.handles.textBox:void 0}}},{key:"_pointNearHandleAllTools",value:function(e){var t=e.element,n=e.currentPoints.canvas,r=Object(y.getToolState)(t,this.name);if(r)for(var i,a=0;a<r.data.length;a++)if(void 0!==(i=this._pointNearHandle(t,r.data[a],n)))return{handleNearby:i,toolIndex:a}}},{key:"_getMouseLocation",value:function(e){var t=e.currentPoints,n=e.image,r=this.configuration;r.mouseLocation.handles.start.x=t.image.x,r.mouseLocation.handles.start.y=t.image.y,Object(O.clipToBox)(r.mouseLocation.handles.start,n)}},{key:"_checkInvalidHandleLocation",value:function(e,t){if(e.handles.points.length<2)return!0;var n;n=this._dragging?this._checkHandlesPencilMode(e,t):this._checkHandlesPolygonMode(e,t),e.handles.invalidHandlePlacement=n}},{key:"_checkHandlesPolygonMode",value:function(e,t){var n=t.element,r=this.configuration.mouseLocation.handles.start,i=e.handles.points,a=!1;return e.canComplete=!1,this._isDistanceSmallerThanCompleteSpacingCanvas(n,i[0],r)&&!$.end(i)&&i.length>2?(e.canComplete=!0,a=!1):a=$.newHandle(r,i),a}},{key:"_checkHandlesPencilMode",value:function(e,t){var n=$.newHandle(this.configuration.mouseLocation.handles.start,e.handles.points);return!1===n&&(n=this._invalidHandlePencilMode(e,t)),n}},{key:"_invalidHandlePencilMode",value:function(e,t){var n=t.element,r=this.configuration.mouseLocation.handles.start,i=e.handles.points;if(this._isDistanceSmallerThanCompleteSpacingCanvas(n,i[0],r))return e.canComplete=!0,!1;e.canComplete=!1;for(var a=1;a<i.length-1;a++)if(this._isDistanceSmallerThanSpacing(n,i[a],r))return!0;return!1}},{key:"_isDistanceSmallerThanCompleteSpacingCanvas",value:function(e,t,n){var r,i=g.default.cornerstone.pixelToCanvas(e,t),a=g.default.cornerstone.pixelToCanvas(e,n);return"Mouse"===this._drawingInteractionType?r=this.configuration.completeHandleRadius:"Touch"===this._drawingInteractionType&&(r=this.configuration.completeHandleRadiusTouch),this._compareDistanceToSpacing(e,i,a,"<",r)}},{key:"_isDistanceSmallerThanSpacing",value:function(e,t,n){return this._compareDistanceToSpacing(e,t,n,"<")}},{key:"_isDistanceLargerThanSpacing",value:function(e,t,n){return this._compareDistanceToSpacing(e,t,n,">")}},{key:"_compareDistanceToSpacing",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:">",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.configuration.spacing;return">"===r?g.default.cornerstoneMath.point.distance(t,n)>i:g.default.cornerstoneMath.point.distance(t,n)<i}},{key:"_activateDraw",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Mouse";this._drawing=!0,this._drawingInteractionType=t,w.state.isMultiPartToolActive=!0,Object(D.hideToolCursor)(this.element),e.addEventListener(m.default.MOUSE_DOWN,this._drawingMouseDownCallback),e.addEventListener(m.default.MOUSE_MOVE,this._drawingMouseMoveCallback),e.addEventListener(m.default.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),e.addEventListener(m.default.MOUSE_DRAG,this._drawingMouseDragCallback),e.addEventListener(m.default.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(m.default.TOUCH_START,this._drawingMouseMoveCallback),e.addEventListener(m.default.TOUCH_START,this._drawingTouchStartCallback),e.addEventListener(m.default.TOUCH_DRAG,this._drawingTouchDragCallback),e.addEventListener(m.default.TOUCH_END,this._drawingMouseUpCallback),e.addEventListener(m.default.DOUBLE_TAP,this._drawingDoubleTapClickCallback),g.default.cornerstone.updateImage(e)}},{key:"_deactivateDraw",value:function(e){this._drawing=!1,w.state.isMultiPartToolActive=!1,this._activeDrawingToolReference=null,this._drawingInteractionType=null,Object(D.setToolCursor)(this.element,this.svgCursor),e.removeEventListener(m.default.MOUSE_DOWN,this._drawingMouseDownCallback),e.removeEventListener(m.default.MOUSE_MOVE,this._drawingMouseMoveCallback),e.removeEventListener(m.default.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),e.removeEventListener(m.default.MOUSE_DRAG,this._drawingMouseDragCallback),e.removeEventListener(m.default.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(m.default.TOUCH_START,this._drawingTouchStartCallback),e.removeEventListener(m.default.TOUCH_DRAG,this._drawingTouchDragCallback),e.removeEventListener(m.default.TOUCH_START,this._drawingMouseMoveCallback),e.removeEventListener(m.default.TOUCH_END,this._drawingMouseUpCallback),g.default.cornerstone.updateImage(e)}},{key:"_activateModify",value:function(e){w.state.isToolLocked=!0,e.addEventListener(m.default.MOUSE_UP,this._editMouseUpCallback),e.addEventListener(m.default.MOUSE_DRAG,this._editMouseDragCallback),e.addEventListener(m.default.MOUSE_CLICK,this._editMouseUpCallback),e.addEventListener(m.default.TOUCH_END,this._editMouseUpCallback),e.addEventListener(m.default.TOUCH_DRAG,this._editTouchDragCallback),g.default.cornerstone.updateImage(e)}},{key:"_deactivateModify",value:function(e){w.state.isToolLocked=!1,e.removeEventListener(m.default.MOUSE_UP,this._editMouseUpCallback),e.removeEventListener(m.default.MOUSE_DRAG,this._editMouseDragCallback),e.removeEventListener(m.default.MOUSE_CLICK,this._editMouseUpCallback),e.removeEventListener(m.default.TOUCH_END,this._editMouseUpCallback),e.removeEventListener(m.default.TOUCH_DRAG,this._editTouchDragCallback),g.default.cornerstone.updateImage(e)}},{key:"passiveCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"enabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"disabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"_closeToolIfDrawing",value:function(e){this._drawing&&(this._endDrawing(e,this.configuration.currentHandle),g.default.cornerstone.updateImage(e))}},{key:"fireModifiedEvent",value:function(e,t){var n=m.default.MEASUREMENT_MODIFIED,r={toolName:this.name,toolType:this.name,element:e,measurementData:t};Object(_.default)(e,n,r)}},{key:"fireCompletedEvent",value:function(e,t){var n=m.default.MEASUREMENT_COMPLETED,r={toolName:this.name,toolType:this.name,element:e,measurementData:t};Object(_.default)(e,n,r)}},{key:"cancelDrawing",value:function(e){if(this._drawing){var t=Object(y.getToolState)(e,this.name),n=this.configuration,r=t.data[n.currentTool];r.active=!1,r.highlight=!1,r.handles.invalidHandlePlacement=!1,n.currentHandle=0,n.currentTool=-1,r.canComplete=!1,Object(y.removeToolState)(e,this.name,r),this._deactivateDraw(e),g.default.cornerstone.updateImage(e)}}},{key:"newImageCallback",value:function(e){var t=this.configuration;if(this._drawing&&this._activeDrawingToolReference){var n=e.detail.element,r=this._activeDrawingToolReference;r.active=!1,r.highlight=!1,r.handles.invalidHandlePlacement=!1;var i=r.handles.points;i[t.currentHandle-1].lines.push(i[0]),t.currentHandle=0,t.currentTool=-1,r.canComplete=!1,this._deactivateDraw(n),g.default.cornerstone.updateImage(n)}}},{key:"spacing",get:function(){return this.configuration.spacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand spacing to a value other than a number.");this.configuration.spacing=e,g.default.cornerstone.updateImage(this.element)}},{key:"activeHandleRadius",get:function(){return this.configuration.activeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand activeHandleRadius to a value other than a number.");this.configuration.activeHandleRadius=e,g.default.cornerstone.updateImage(this.element)}},{key:"completeHandleRadius",get:function(){return this.configuration.completeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand completeHandleRadius to a value other than a number.");this.configuration.completeHandleRadius=e,g.default.cornerstone.updateImage(this.element)}},{key:"alwaysShowHandles",get:function(){return this.configuration.alwaysShowHandles},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehand alwaysShowHandles to a value other than a boolean.");this.configuration.alwaysShowHandles=e,g.default.cornerstone.updateImage(this.element)}},{key:"invalidColor",get:function(){return this.configuration.invalidColor},set:function(e){this.configuration.invalidColor=e,g.default.cornerstone.updateImage(this.element)}}]),t}(v.default);function H(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}},"./tools/annotation/LengthTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return C}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./tools/base/BaseAnnotationTool.js"),p=n("./stateManagement/toolState.js"),m=n("./stateManagement/toolStyle.js"),g=n("./stateManagement/toolColors.js"),v=n("./drawing/index.js"),y=n("./drawing/drawLinkedTextBox.js"),b=n("./drawing/drawHandles.js"),x=n("./util/lineSegDistance.js"),w=n("./tools/cursors/index.js"),_=n("./util/logger.js"),k=n("./util/getPixelSpacing.js"),E=n("./util/throttle.js"),S=n("./store/index.js"),T=Object(_.getLogger)("tools:annotation:LengthTool"),C=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Length",supportedInteractionTypes:["Mouse","Touch"],svgCursor:w.lengthCursor,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(e=l()(this,c()(t).call(this,n,r))).throttledUpdateCachedStats=Object(E.default)(e.updateCachedStats,110),e}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t=e.currentPoints.image,n=t.x,r=t.y;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:n,y:r,highlight:!0,active:!1},end:{x:n,y:r,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}T.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){return t&&t.handles&&t.handles.start&&t.handles.end?!1!==t.visible&&Object(x.default)(e,t.handles.start,t.handles.end,n)<25:(T.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!1)}},{key:"updateCachedStats",value:function(e,t,n){var r=Object(k.default)(e),i=(n.handles.end.x-n.handles.start.x)*(r.colPixelSpacing||1),a=(n.handles.end.y-n.handles.start.y)*(r.rowPixelSpacing||1),o=Math.sqrt(i*i+a*a);n.length=o,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=this.configuration,i=r.handleRadius,a=r.drawHandlesOnHover,o=r.hideHandlesIfMoving,s=r.renderDashed,l=Object(p.getToolState)(e.currentTarget,this.name);if(l)for(var u=Object(v.getNewContext)(n.canvasContext.canvas),c=n.image,d=n.element,h=Object(k.default)(c),f=h.rowPixelSpacing,x=h.colPixelSpacing,w=m.default.getToolWidth(),_=Object(S.getModule)("globalConfiguration").configuration.lineDash,E=function(e){var r=l.data[e];if(!1===r.visible)return"continue";Object(v.draw)(u,(function(e){Object(v.setShadow)(e,t.configuration);var l=g.default.getColorIfActive(r),u={color:l};s&&(u.lineDash=_),Object(v.drawLine)(e,d,r.handles.start,r.handles.end,u);var h={color:l,handleRadius:i,drawHandlesIfActive:a,hideHandlesIfMoving:o};if(t.configuration.drawHandles&&Object(b.default)(e,n,r.handles,h),!r.handles.textBox.hasMoved){var p={x:Math.max(r.handles.start.x,r.handles.end.x)};p.y=p.x===r.handles.start.x?r.handles.start.y:r.handles.end.y,r.handles.textBox.x=p.x,r.handles.textBox.y=p.y}!0===r.invalidated&&(r.length?t.throttledUpdateCachedStats(c,d,r):t.updateCachedStats(c,d,r));var m=function(e,t,n){var r,i=(r=Number(e.length),isNaN(r)?void 0:r);if(!i)return"";var a="mm";return t&&n||(a="pixels"),e.unit=a,"".concat(i.toFixed(2)," ").concat(a)}(r,f,x);Object(y.default)(e,d,r.handles.textBox,m,r.handles,C,l,w,10,!0)}))},T=0;T<l.data.length;T++)E(T);function C(e){return[e.start,{x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2},e.end]}}}]),t}(f.default)},"./tools/annotation/ProbeTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return I}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseAnnotationTool.js"),m=n("./stateManagement/toolState.js"),g=n("./stateManagement/textStyle.js"),v=n("./stateManagement/toolColors.js"),y=n("./drawing/index.js"),b=n("./drawing/drawTextBox.js"),x=n("./drawing/drawHandles.js"),w=n("./util/getRGBPixels.js"),_=n("./util/calculateSUV.js"),k=n("./tools/cursors/index.js"),E=n("./util/logger.js"),S=n("./util/throttle.js"),T=n("./store/index.js"),C=Object(E.getLogger)("tools:annotation:ProbeTool"),I=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Probe",supportedInteractionTypes:["Mouse","Touch"],svgCursor:k.probeCursor,configuration:{drawHandles:!0,renderDashed:!1}};return(e=l()(this,c()(t).call(this,n,r))).throttledUpdateCachedStats=Object(S.default)(e.updateCachedStats,110),e}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};C.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var r=t&&t.handles&&t.handles.end;if(r||C.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!r||!1===t.visible)return!1;var i=f.default.cornerstone.pixelToCanvas(e,t.handles.end);return f.default.cornerstoneMath.point.distance(i,n)<5}},{key:"updateCachedStats",value:function(e,t,n){var r=Math.round(n.handles.end.x),i=Math.round(n.handles.end.y),a={};r>=0&&i>=0&&r<e.columns&&i<e.rows&&(a.x=r,a.y=i,e.color?a.storedPixels=Object(w.default)(t,r,i,1,1):(a.storedPixels=f.default.cornerstone.getStoredPixels(t,r,i,1,1),a.sp=a.storedPixels[0],a.mo=a.sp*e.slope+e.intercept,a.suv=Object(_.default)(e,a.sp))),n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=this.configuration,i=r.handleRadius,a=r.renderDashed,o=Object(m.getToolState)(e.currentTarget,this.name);if(o)for(var s=Object(y.getNewContext)(n.canvasContext.canvas),l=n.image,u=n.element,c=g.default.getFontSize(),d=Object(T.getModule)("globalConfiguration").configuration.lineDash,h=function(e){var r=o.data[e];if(!1===r.visible)return"continue";Object(y.draw)(s,(function(e){var o,s,h=v.default.getColorIfActive(r);if(t.configuration.drawHandles){var p={handleRadius:i,color:h};a&&(p.lineDash=d),Object(x.default)(e,n,r.handles,p)}!0===r.invalidated&&(r.cachedStats?t.throttledUpdateCachedStats(l,u,r):t.updateCachedStats(l,u,r));var m=r.cachedStats,g=m.x,y=m.y,w=m.storedPixels,_=m.sp,k=m.mo,E=m.suv;if(g>=0&&y>=0&&g<l.columns&&y<l.rows){o="".concat(g,", ").concat(y),l.color?s="R: ".concat(w[0]," G: ").concat(w[1]," B: ").concat(w[2]):(s="SP: ".concat(_," MO: ").concat(parseFloat(k.toFixed(3))),E&&(s+=" SUV: ".concat(parseFloat(E.toFixed(3)))));var S=f.default.cornerstone.pixelToCanvas(n.element,{x:r.handles.end.x+3,y:r.handles.end.y-3});Object(b.default)(e,s,S.x,S.y+c+5,h),Object(b.default)(e,o,S.x,S.y,h)}}))},p=0;p<o.data.length;p++)h(p)}}]),t}(p.default)},"./tools/annotation/RectangleRoiTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return I}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseAnnotationTool.js"),m=n("./stateManagement/toolState.js"),g=n("./stateManagement/toolStyle.js"),v=n("./stateManagement/toolColors.js"),y=n("./drawing/index.js"),b=n("./util/calculateSUV.js"),x=n("./util/getROITextBoxCoords.js"),w=n("./util/numbersWithCommas.js"),_=n("./util/throttle.js"),k=n("./tools/cursors/index.js"),E=n("./util/logger.js"),S=n("./util/getPixelSpacing.js"),T=n("./store/index.js"),C=Object(E.getLogger)("tools:annotation:RectangleRoiTool"),I=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"RectangleRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:k.rectangleRoiCursor};return(e=l()(this,c()(t).call(this,n,r))).throttledUpdateCachedStats=Object(_.default)(e.updateCachedStats,110),e}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};C.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,r){var i=t&&t.handles&&t.handles.start&&t.handles.end;if(i||C.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!i||!1===t.visible)return!1;var a="mouse"===r?15:25,o=f.default.cornerstone.pixelToCanvas(e,t.handles.start),s=f.default.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(o.x,s.x),top:Math.min(o.y,s.y),width:Math.abs(o.x-s.x),height:Math.abs(o.y-s.y)};return f.default.cornerstoneMath.rect.distanceToPoint(l,n)<a}},{key:"updateCachedStats",value:function(e,t,n){var r=(f.default.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,i=Object(S.default)(e),a=function(e,t,n,r,i){var a,o=A(n.start,n.end),s=function(e,t){for(var n=0,r=0,i=0,a=0,o=e?e[0]:null,s=e?e[0]:null,l=t.top;l<t.top+t.height;l++)for(var u=t.left;u<t.left+t.width;u++)n+=e[a],r+=e[a]*e[a],o=Math.min(o,e[a]),s=Math.max(s,e[a]),i++,a++;if(0===i)return{count:i,mean:0,variance:0,stdDev:0,min:0,max:0};var c=n/i,d=r/i-c*c;return{count:i,mean:c,variance:d,stdDev:Math.sqrt(d),min:o,max:s}}(f.default.cornerstone.getPixels(t,o.left,o.top,o.width,o.height),o);return"PT"===r&&(a={mean:Object(b.default)(e,s.mean,!0)||0,stdDev:Object(b.default)(e,s.stdDev,!0)||0}),{area:o.width*(i.colPixelSpacing||1)*(o.height*(i.rowPixelSpacing||1))||0,count:s.count||0,mean:s.mean||0,variance:s.variance||0,stdDev:s.stdDev||0,min:s.min||0,max:s.max||0,meanStdDevSUV:a}}(e,t,n.handles,r,i);n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=Object(m.getToolState)(e.currentTarget,this.name);if(n){var r=e.detail,i=r.image,a=r.element,o=g.default.getToolWidth(),s=Object(T.getModule)("globalConfiguration").configuration.lineDash,l=this.configuration,u=l.handleRadius,c=l.drawHandlesOnHover,d=l.hideHandlesIfMoving,h=l.renderDashed,p=Object(y.getNewContext)(r.canvasContext.canvas),b=Object(S.default)(i),w=b.rowPixelSpacing,_=b.colPixelSpacing,k=(f.default.cornerstone.metaData.get("generalSeriesModule",i.imageId)||{}).modality,E=w&&_;Object(y.draw)(p,(function(e){for(var l=0;l<n.data.length;l++){var f=n.data[l];if(!1!==f.visible){var p=v.default.getColorIfActive(f),m={color:p,handleRadius:u,drawHandlesIfActive:c,hideHandlesIfMoving:d};Object(y.setShadow)(e,t.configuration);var g={color:p};if(h&&(g.lineDash=s),Object(y.drawRect)(e,a,f.handles.start,f.handles.end,g,"pixel",f.handles.initialRotation),t.configuration.drawHandles&&Object(y.drawHandles)(e,r,f.handles,m),!0===f.invalidated&&(f.cachedStats?t.throttledUpdateCachedStats(i,a,f):t.updateCachedStats(i,a,f)),!f.handles.textBox.hasMoved){var b=Object(x.default)(r.viewport,f.handles);Object.assign(f.handles.textBox,b)}var w=M(e,i.color,f.cachedStats,k,E,t.configuration);f.unit=D(k,t.configuration.showHounsfieldUnits),Object(y.drawLinkedTextBox)(e,a,f.handles.textBox,w,f.handles,(function(e){return[{x:(n=(t=A(e.start,e.end)).left)+(i=t.width)/2,y:r=t.top},{x:n,y:r+(a=t.height)/2},{x:n+i/2,y:r+a},{x:n+i,y:r+a/2}];var t,n,r,i,a}),p,o,10,!0)}}}))}}}]),t}(p.default);function A(e,t){return{left:Math.min(e.x,t.x),top:Math.min(e.y,t.y),width:Math.abs(e.x-t.x),height:Math.abs(e.y-t.y)}}function O(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(Object(w.default)(e.toFixed(2))).concat(n)}function D(e,t){return"CT"===e&&!1!==t?"HU":""}function M(e,t,n,r,i){var a=n.area,o=n.mean,s=n.stdDev,l=n.min,u=n.max,c=n.meanStdDevSUV,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},h=d.showMinMax||!1,f=[],p=[];if(!t){var m=c&&0!==c.mean,g=D(r,d.showHounsfieldUnits),v="Mean: ".concat(Object(w.default)(o.toFixed(2))," ").concat(g),y="Std Dev: ".concat(Object(w.default)(s.toFixed(2))," ").concat(g);if(m){for(var b=" SUV: ",x="".concat(b).concat(Object(w.default)(c.mean.toFixed(2))),_="".concat(b).concat(Object(w.default)(c.stdDev.toFixed(2))),k=Math.floor(e.measureText("".concat(y,"     ")).width);e.measureText(v).width<k;)v+=" ";p.push("".concat(v).concat(x)),p.push("".concat(y,"     ").concat(_))}else p.push("".concat(v)),p.push("".concat(y));if(h){for(var E="Min: ".concat(l," ").concat(g),S="Max: ".concat(u," ").concat(g),T=m?Math.floor(e.measureText("".concat(y,"     ")).width):Math.floor(e.measureText("".concat(v,"     ")).width);e.measureText(E).width<T;)E+=" ";p.push("".concat(E).concat(S))}}return f.push(O(a,i)),p.forEach((function(e){return f.push(e)})),f}},"./tools/annotation/TextMarkerTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return k}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./tools/base/BaseAnnotationTool.js"),g=n("./externalModules.js"),v=n("./util/pointInsideBoundingBox.js"),y=n("./stateManagement/toolColors.js"),b=n("./drawing/index.js"),x=n("./drawing/drawTextBox.js"),w=n("./stateManagement/toolState.js"),_=n("./tools/cursors/index.js"),k=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"TextMarker",supportedInteractionTypes:["Mouse","Touch"],configuration:{markers:[],current:"",ascending:!0,loop:!1,changeTextCallback:E},svgCursor:_.textMarkerCursor};return(e=l()(this,c()(t).call(this,n,r))).touchPressCallback=e._changeText.bind(h()(e)),e.doubleClickCallback=e._changeText.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){var t=this.configuration;if(t.current){var n={visible:!0,active:!0,text:t.current,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}};if(g.default.cornerstoneMath.point.insideRect(n.handles.end,{left:0,top:0,width:e.image.width,height:e.image.height})){var r=t.markers.indexOf(t.current);return(r+=t.ascending?1:-1)>=t.markers.length?r=t.loop?0:-1:r<0&&(r=t.loop?t.markers.length:-1),t.current=t.markers[r],n}}}},{key:"pointNearTool",value:function(e,t,n){if(!1===t.visible)return!1;if(t.handles.end.boundingBox){var r=g.default.cornerstoneMath.rect.distanceToPoint(t.handles.end.boundingBox,n),i=Object(v.default)(t.handles.end,n);return r<10||i}}},{key:"updateCachedStats",value:function(){}},{key:"renderToolData",value:function(e){var t=e.detail,n=this.configuration,r=Object(w.getToolState)(t.element,this.name);if(r)for(var i=Object(b.getNewContext)(t.canvasContext.canvas),a=function(e){var a=r.data[e];if(!1===a.visible)return"continue";var o=y.default.getColorIfActive(a);Object(b.draw)(i,(function(e){Object(b.setShadow)(e,n);var r=g.default.cornerstone.pixelToCanvas(t.element,a.handles.end);a.handles.end.boundingBox=Object(x.default)(e,a.text,r.x,r.y-10,o,{centering:{x:!0,y:!0}})}))},o=0;o<r.data.length;o++)a(o)}},{key:"_changeText",value:function(e){var t,n=e.detail,r=n.element;function i(e,t,n){!0===n?Object(w.removeToolState)(r,this.name,e):e.text=t,e.active=!1,g.default.cornerstone.updateImage(r)}var a=this.configuration,o=n.currentPoints.canvas,s=Object(w.getToolState)(r,this.name);if(s)for(var l=0;l<s.data.length;l++)if(this.pointNearTool(r,t=s.data[l],o))return t.active=!0,g.default.cornerstone.updateImage(r),a.changeTextCallback(t,n,i),e.stopImmediatePropagation(),e.preventDefault(),void e.stopPropagation()}}]),t}(m.default),E=function(e,t,n){n(e,prompt("Change your annotation:"))}},"./tools/annotation/bidirectionalTool/addNewMeasurement.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./events.js"),a=n("./manipulators/index.js"),o=n("./manipulators/anyHandlesOutsideImage.js"),s=n("./stateManagement/toolState.js"),l=n("./util/triggerEvent.js"),u=n("./util/getActiveTool.js"),c=n("./tools/annotation/BidirectionalTool.js"),d=n("./tools/annotation/bidirectionalTool/utils/updatePerpendicularLineHandles.js");t.default=function(e,t){var n=this,f=e.detail,p=f.element,m=f.image,g=f.buttons,v=this.configuration;if(!h(m)){var y=this.createNewMeasurement(f),b=function(){y.active=!1,r.default.cornerstone.updateImage(p)};Object(s.addToolState)(p,this.name,y),r.default.cornerstone.updateImage(p);var x=(new Date).getTime(),w=y.handles,_=w.end,k=w.perpendicularStart;Object(a.moveNewHandle)(f,this.name,y,_,{},t,(function(e){if(e){var a=y.handles,h=y.longestDiameter,w=y.shortestDiameter,_=Object(o.default)(f,a),E=parseFloat(h)||0,S=parseFloat(w)||0,T=E<1||S<1,C=(new Date).getTime()-x<150;_||T||C?(y.cancelled=!0,Object(s.removeToolState)(p,n.name,y)):v.getMeasurementLocationCallback(y,f,b),Object(d.default)(f,y),k.locked=!1,y.invalidated=!0,r.default.cornerstone.updateImage(p);var I=Object(u.default)(p,g,t);I instanceof c.default&&I.updateCachedStats(m,p,y);var A={toolName:n.name,toolType:n.name,element:p,measurementData:y};Object(l.default)(p,i.default.MEASUREMENT_MODIFIED,A),Object(l.default)(p,i.default.MEASUREMENT_COMPLETED,A)}else Object(s.removeToolState)(p,n.name,y)}))}};var h=function(e){var t=r.default.cornerstone.metaData.get("imagePlaneModule",e.imageId),n=e.rowPixelSpacing,i=e.columnPixelSpacing;return t&&(n=t.rowPixelSpacing||t.rowImagePixelSpacing,i=t.columnPixelSpacing||t.colImagePixelSpacing),!n||!i}},"./tools/annotation/bidirectionalTool/createNewMeasurement.js":function(e,t,n){"use strict";n.r(t);var r=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object.assign({x:e,y:t,index:n,drawnIndependently:!1,allowedOutsideImage:!1,highlight:!0,active:!1},r)};t.default=function(e){var t=e.currentPoints.image,n=t.x,i=t.y;return{toolName:this.name,toolType:this.name,isCreating:!0,visible:!0,active:!0,invalidated:!0,handles:{start:r(n,i,0),end:r(n,i,1,{active:!0}),perpendicularStart:r(n,i,2,{locked:!0}),perpendicularEnd:r(n,i,3),textBox:r(n-50,i-70,null,{highlight:!1,hasMoved:!0,active:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0})},longestDiameter:0,shortestDiameter:0}}},"./tools/annotation/bidirectionalTool/handleSelectedCallback.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";"touch"===r?this.handleSelectedTouchCallback(e):this.handleSelectedMouseCallback(e)}},"./tools/annotation/bidirectionalTool/handleSelectedMouseCallback.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/typeof.js"),i=n.n(r),a=n("./externalModules.js"),o=n("./store/index.js"),s=n("./events.js"),l=n("./stateManagement/toolState.js"),u=n("./manipulators/anyHandlesOutsideImage.js"),c=n("./manipulators/getHandleNearImagePoint.js"),d=n("./manipulators/index.js"),h=n("./tools/annotation/bidirectionalTool/moveHandle/moveHandle.js"),f=n("./tools/annotation/bidirectionalTool/invertHandles.js"),p=n("./store/setToolCursor.js");t.default=function(e){var t,n=this,r=e.detail,y=r.element,b=o.state.clickProximity,x=function(e){t.invalidated=!0,Object(u.default)(r,t.handles)&&Object(l.removeToolState)(y,n.name,t),e&&(e.moving=!1,e.selected=!0),Object(p.setToolCursor)(n.element,n.svgCursor),a.default.cornerstone.updateImage(y),y.addEventListener(s.default.MOUSE_MOVE,n._moveCallback),y.addEventListener(s.default.TOUCH_START,n._moveCallback)},w=r.startPoints.canvas,_=Object(l.getToolState)(e.currentTarget,this.name);if(_){for(var k=function(i){var a=c.default.apply(void 0,[y,(t=_.data[i]).handles,w,b]);if(a)return y.removeEventListener(s.default.MOUSE_MOVE,n._moveCallback),y.removeEventListener(s.default.TOUCH_START,n._moveCallback),t.active=!0,m(t.handles),a.moving=!0,(a=Object(f.default)(r,t,a)).hasBoundingBox||Object(p.hideToolCursor)(n.element),Object(h.default)(r,n.name,t,a,(function(){return x(a)})),v(e),{v:!0}},E=0;E<_.data.length;E++){var S=k(E);if("object"===i()(S))return S.v}var T=function(e){return function(){g(e,!1),x()}};for(E=0;E<_.data.length;E++)if(this.pointNearTool(y,t=_.data[E],w,"mouse")){y.removeEventListener(s.default.MOUSE_MOVE,this._moveCallback),y.removeEventListener(s.default.TOUCH_START,this._moveCallback),t.active=!0,m(t.handles),g(t.handles,!0);var C=T(t.handles);return Object(d.moveAllHandles)(r,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},"mouse",C),v(e),!0}}};var m=function(e){var t=!1;return Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)})),t},g=function(e,t){Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].moving=t)}))},v=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}},"./tools/annotation/bidirectionalTool/handleSelectedTouchCallback.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/typeof.js"),i=n.n(r),a=n("./externalModules.js"),o=n("./store/index.js"),s=n("./events.js"),l=n("./stateManagement/toolState.js"),u=n("./manipulators/anyHandlesOutsideImage.js"),c=n("./manipulators/getHandleNearImagePoint.js"),d=n("./manipulators/index.js"),h=n("./tools/annotation/bidirectionalTool/moveHandle/touchMoveHandle.js");t.default=function(e){var t,n=this,r=e.detail,g=r.element,v=o.state.touchProximity,y=function(e){t.invalidated=!0,Object(u.default)(r,t.handles)&&Object(l.removeToolState)(g,n.name,t),e&&(e.moving=!1,e.selected=!0),a.default.cornerstone.updateImage(g),g.addEventListener(s.default.TOUCH_DRAG,n._moveCallback)},b=r.startPoints.canvas,x=Object(l.getToolState)(e.currentTarget,this.name);if(x){for(var w=function(i){var a=c.default.apply(void 0,[g,(t=x.data[i]).handles,b,v]);if(a)return g.removeEventListener(s.default.TOUCH_DRAG,n._moveCallback),t.active=!0,f(t.handles),a.moving=!0,Object(h.default)(r,n.name,t,a,(function(){return y(a)})),m(e),{v:!0}},_=0;_<x.data.length;_++){var k=w(_);if("object"===i()(k))return k.v}var E=function(e){return function(){p(e,!1),y()}};for(_=0;_<x.data.length;_++)if(this.pointNearTool(g,t=x.data[_],b,"touch")){g.removeEventListener(s.default.TOUCH_DRAG,this._moveCallback),t.active=!0,f(t.handles),p(t.handles,!0);var S=E(t.handles);return Object(d.moveAllHandles)(r,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},"touch",S),m(e),!0}}};var f=function(e){var t=!1;return Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)})),t},p=function(e,t){Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].moving=t)}))},m=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}},"./tools/annotation/bidirectionalTool/invertHandles.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=function(e,t,n){var r=e[n];e[n]=t[n],t[n]=r},i=function(e,t){r(e,t,"x"),r(e,t,"y"),r(e,t,"moving"),r(e,t,"hover"),r(e,t,"active"),r(e,t,"selected")};function a(e,t,n){var r=e.image,a=r.rowPixelSpacing,o=r.columnPixelSpacing,s=t.handles,l=s.start,u=s.end,c=s.perpendicularStart,d=s.perpendicularEnd,h=(l.x-u.x)*(o||1),f=(l.y-u.y)*(a||1),p=Math.sqrt(h*h+f*f),m=(c.x-d.x)*(o||1),g=(c.y-d.y)*(a||1);return(Math.sqrt(m*m+g*g)||0)>p?(i(l,u),i(l,c),i(u,d),Object.values(s).find((function(e){return!0===e.moving}))):n}},"./tools/annotation/bidirectionalTool/mouseMoveCallback.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./stateManagement/toolCoordinates.js"),a=n("./manipulators/getHandleNearImagePoint.js"),o=n("./stateManagement/toolState.js");t.default=function(e){var t=this,n=e.detail,s=n.element;i.default.setCoords(n);var l=Object(o.getToolState)(s,this.name);if(l){for(var u=!1,c=function(e){var r=n.currentPoints.canvas,i=l.data[e],o=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,i=Object(a.default)(e,t,n,r),o=!1;return Object.keys(t).forEach((function(e){if("textBox"!==e){var n=t[e],r=n===i;n.active!==r&&(o=!0),n.active=r}})),o}(s,i.handles,r);Object.keys(i.handles).forEach((function(e){if("textBox"!==e){var t=i.handles[e];t.hover=t.active}})),o&&(u=!0);var c=t.pointNearTool(s,i,r,"mouse");(c&&!i.active||!c&&i.active)&&(i.active=!i.active,u=!0)},d=0;d<l.data.length;d++)c(d);!0===u&&r.default.cornerstone.updateImage(s)}}},"./tools/annotation/bidirectionalTool/moveHandle/getBaseData.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));var r=n("./externalModules.js"),i=n("./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js");function a(e,t){return{start:e,end:t}}function o(e,t,n){var o=r.default.cornerstoneMath.lineSegment,s=e.handles,l=s.start,u=s.end,c=s.perpendicularStart,d=s.perpendicularEnd,h=t.image,f=h.columnPixelSpacing,p=void 0===f?1:f,m=h.rowPixelSpacing,g=void 0===m?1:m,v=a(l,u),y=a(c,d),b=o.intersectLine(v,y);return{columnPixelSpacing:p,rowPixelSpacing:g,start:l,end:u,perpendicularStart:c,perpendicularEnd:d,longLine:v,intersection:b,distanceToFixed:Object(i.default)(p,g,n,b),fixedPoint:n}}},"./tools/annotation/bidirectionalTool/moveHandle/moveHandle.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./store/index.js"),a=n("./events.js"),o=n("./tools/annotation/bidirectionalTool/moveHandle/setHandlesPosition.js"),s=n("./util/getActiveTool.js"),l=n("./tools/base/BaseAnnotationTool.js");t.default=function(e,t,n,u,c,d){var h=e.element,f=e.image,p=e.buttons,m={x:u.x-e.currentPoints.image.x,y:u.y-e.currentPoints.image.y},g=function(e){var i=e.detail;u.hasMoved=!0,null==u.index?(u.x=i.currentPoints.image.x+m.x,u.y=i.currentPoints.image.y+m.y):Object(o.default)(u,i,n,m),d&&(u.x=Math.max(u.x,0),u.x=Math.min(u.x,i.image.width),u.y=Math.max(u.y,0),u.y=Math.min(u.y,i.image.height)),n.invalidated=!0,r.default.cornerstone.updateImage(h);var c=Object(s.default)(h,p,"mouse");c instanceof l.default&&c.updateCachedStats(f,h,n),r.default.cornerstone.triggerEvent(h,a.default.MEASUREMENT_MODIFIED,{toolName:t,toolType:t,element:h,measurementData:n})};u.active=!0,u.moving=!0,i.state.isToolLocked=!0,h.addEventListener(a.default.MOUSE_DRAG,g),h.addEventListener(a.default.TOUCH_DRAG,g);var v=r.default.cornerstone.getImage(h),y=function(){r.default.cornerstone.getImage(h).imageId!==v.imageId&&b()};h.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,y);var b=function e(){u.active=!1,i.state.isToolLocked=!1,h.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,y),h.removeEventListener(a.default.MOUSE_DRAG,g),h.removeEventListener(a.default.MOUSE_UP,e),h.removeEventListener(a.default.MOUSE_CLICK,e),h.removeEventListener(a.default.TOUCH_DRAG,g),h.removeEventListener(a.default.TOUCH_DRAG_END,e),h.removeEventListener(a.default.TAP,e),r.default.cornerstone.updateImage(h),"function"==typeof c&&c()};h.addEventListener(a.default.MOUSE_UP,b),h.addEventListener(a.default.MOUSE_CLICK,b),h.addEventListener(a.default.TOUCH_DRAG_END,b),h.addEventListener(a.default.TAP,b)}},"./tools/annotation/bidirectionalTool/moveHandle/moveLongLine/moveLongLine.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));var r=n("./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js"),i=n("./tools/annotation/bidirectionalTool/moveHandle/getBaseData.js"),a=n("./tools/annotation/bidirectionalTool/moveHandle/moveLongLine/updatePerpendicularLine.js");function o(e,t,n,o){var s=Object(i.default)(t,n,o),l=s.columnPixelSpacing,u=s.rowPixelSpacing,c=s.distanceToFixed,d=Object(r.default)(l,u,o,e);if(d<=c)return!1;var h=c/d,f={x:o.x+(e.x-o.x)*h,y:o.y+(e.y-o.y)*h},p=Object(a.default)(s,f);return t.handles.perpendicularStart.x=p.start.x,t.handles.perpendicularStart.y=p.start.y,t.handles.perpendicularEnd.x=p.end.x,t.handles.perpendicularEnd.y=p.end.y,!0}},"./tools/annotation/bidirectionalTool/moveHandle/moveLongLine/updatePerpendicularLine.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=n("./tools/annotation/bidirectionalTool/utils/getLineVector.js"),i=n("./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js");function a(e,t){var n=e.columnPixelSpacing,a=e.rowPixelSpacing,o=e.start,s=e.perpendicularStart,l=e.perpendicularEnd,u=e.intersection,c=e.fixedPoint,d=Object(i.default)(n,a,s,u),h=Object(i.default)(n,a,l,u),f=Object(r.default)(n,a,c,t),p=c===o?1:-1,m=p*a,g=p*n;return{start:{x:t.x+f.y*d*m,y:t.y+f.x*d*g*-1},end:{x:t.x+f.y*h*m*-1,y:t.y+f.x*h*g}}}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getDirectionMultiplier.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/isPerpendicularEndFixed.js");function i(e,t){return Object(r.default)(e,t)?-1:1}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getHelperLine.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getDirectionMultiplier.js");function i(e,t,n){var i=e.columnPixelSpacing,a=e.rowPixelSpacing,o=e.perpendicularEnd,s=e.fixedPoint,l=Number.MAX_SAFE_INTEGER,u=Object(r.default)(s,o)*l;return{start:t,end:{x:t.x+n.y*a*u,y:t.y+n.x*i*u*-1}}}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getMovingPoint.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/isPerpendicularEndFixed.js");function i(e,t,n){return Object(r.default)(e,n)?t:n}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/isPerpendicularEndFixed.js":function(e,t,n){"use strict";function r(e,t){return e===t}n.r(t),n.d(t,"default",(function(){return r}))},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/lineHasLength.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js");function i(e,t,n){return 0!==Object(r.default)(e,t,n.start,n.end)}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/movePerpendicularLine.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));var r=n("./externalModules.js"),i=n("./tools/annotation/bidirectionalTool/utils/getLineVector.js"),a=n("./tools/annotation/bidirectionalTool/moveHandle/getBaseData.js"),o=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/lineHasLength.js"),s=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getHelperLine.js"),l=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/updatePerpendicularLine.js");function u(e,t,n,u){var c=r.default.cornerstoneMath.lineSegment,d=Object(a.default)(t,n,u),h=d.columnPixelSpacing,f=d.rowPixelSpacing,p=d.start,m=d.longLine,g=d.intersection;if(!Object(o.default)(h,f,m))return!1;var v=Object(i.default)(h,f,p,g),y=Object(s.default)(d,e,v),b=c.intersectLine(m,y);if(!b)return!1;var x=Object(l.default)(d,b,y,v);return t.handles.perpendicularStart.x=x.start.x,t.handles.perpendicularStart.y=x.start.y,t.handles.perpendicularEnd.x=x.end.x,t.handles.perpendicularEnd.y=x.end.y,!0}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/updatePerpendicularLine.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));var r=n("../node_modules/@babel/runtime/helpers/defineProperty.js"),i=n.n(r),a=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getDirectionMultiplier.js"),o=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getMovingPoint.js");function s(e,t,n,r){var s,l=e.columnPixelSpacing,u=e.rowPixelSpacing,c=e.fixedPoint,d=e.perpendicularStart,h=e.perpendicularEnd,f=e.distanceToFixed,p=Object(a.default)(c,h)*f,m=Object(o.default)(c,d,h)===d,g=m?"start":"end",v=m?"end":"start";return s={},i()(s,g,{x:n.start.x,y:n.start.y}),i()(s,v,{x:t.x+r.y*u*p,y:t.y+r.x*l*p*-1}),s}},"./tools/annotation/bidirectionalTool/moveHandle/setHandlesPosition.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./tools/annotation/bidirectionalTool/moveHandle/moveLongLine/moveLongLine.js"),a=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/movePerpendicularLine.js");t.default=function(e,t,n,o){var s,l,u,c,d={},h={},f={x:t.currentPoints.image.x+o.x,y:t.currentPoints.image.y+o.y};0===e.index?Object(i.default)(f,n,t,n.handles.end)?(e.x=f.x,e.y=f.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):1===e.index?Object(i.default)(f,n,t,n.handles.start)?(e.x=f.x,e.y=f.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):2===e.index?(s=!1,d.start={x:n.handles.start.x,y:n.handles.start.y},d.end={x:n.handles.end.x,y:n.handles.end.y},h.start={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},h.end={x:f.x,y:f.y},(l=r.default.cornerstoneMath.lineSegment.intersectLine(d,h))||(h.end={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},l=r.default.cornerstoneMath.lineSegment.intersectLine(d,h),u=r.default.cornerstoneMath.point.distance(l,n.handles.start),c=r.default.cornerstoneMath.point.distance(l,n.handles.end),(!l||u<3||c<3)&&(s=!0)),s||Object(a.default)(f,n,t,n.handles.perpendicularEnd)||(t.currentPoints.image.x=n.handles.perpendicularStart.x,t.currentPoints.image.y=n.handles.perpendicularStart.y)):3===e.index&&(s=!1,d.start={x:n.handles.start.x,y:n.handles.start.y},d.end={x:n.handles.end.x,y:n.handles.end.y},h.start={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},h.end={x:f.x,y:f.y},(l=r.default.cornerstoneMath.lineSegment.intersectLine(d,h))||(h.end={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},l=r.default.cornerstoneMath.lineSegment.intersectLine(d,h),u=r.default.cornerstoneMath.point.distance(l,n.handles.start),c=r.default.cornerstoneMath.point.distance(l,n.handles.end),(!l||u<3||c<3)&&(s=!0)),s||Object(a.default)(f,n,t,n.handles.perpendicularStart)||(t.currentPoints.image.x=n.handles.perpendicularEnd.x,t.currentPoints.image.y=n.handles.perpendicularEnd.y))}},"./tools/annotation/bidirectionalTool/moveHandle/touchMoveHandle.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./store/index.js"),a=n("./events.js"),o=n("./tools/annotation/bidirectionalTool/moveHandle/setHandlesPosition.js"),s=n("./util/getActiveTool.js"),l=n("./tools/base/BaseAnnotationTool.js"),u=[a.default.TOUCH_END,a.default.TOUCH_DRAG_END,a.default.TOUCH_PINCH,a.default.TOUCH_PRESS,a.default.TAP];t.default=function(e,t,n,c,d,h){var f=e.element,p=e.image,m=e.buttons,g={x:c.x-e.currentPoints.image.x,y:c.y-e.currentPoints.image.y},v=function(e){var i=e.detail;c.hasMoved=!0,null==c.index?(c.x=i.currentPoints.image.x+g.x,c.y=i.currentPoints.image.y+g.y):Object(o.default)(c,i,n,g),h&&(c.x=Math.max(c.x,0),c.x=Math.min(c.x,i.image.width),c.y=Math.max(c.y,0),c.y=Math.min(c.y,i.image.height)),n.invalidated=!0,r.default.cornerstone.updateImage(f);var u=Object(s.default)(f,m,"touch");u instanceof l.default&&u.updateCachedStats(p,f,n),r.default.cornerstone.triggerEvent(f,a.default.MEASUREMENT_MODIFIED,{toolName:t,toolType:t,element:f,measurementData:n})};c.active=!0,i.state.isToolLocked=!0,f.addEventListener(a.default.TOUCH_DRAG,v);var y=function e(){c.active=!1,i.state.isToolLocked=!1,f.removeEventListener(a.default.TOUCH_DRAG,v),u.forEach((function(t){f.removeEventListener(t,e)})),r.default.cornerstone.updateImage(f),"function"==typeof d&&d()};u.forEach((function(e){f.addEventListener(e,y)}))}},"./tools/annotation/bidirectionalTool/pointNearTool.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./externalModules.js"),a=n("./util/pointInsideBoundingBox.js"),o=function(e,t,n,r){var a=i.default.cornerstone,o=i.default.cornerstoneMath,s={start:a.pixelToCanvas(e,t.perpendicularStart),end:a.pixelToCanvas(e,t.perpendicularEnd)};return o.lineSegment.distanceToPoint(s,n)<r};t.default=function(e,t,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",l=i.default.cornerstone,u=i.default.cornerstoneMath,c=t.handles,d={start:l.pixelToCanvas(e,c.start),end:l.pixelToCanvas(e,c.end)},h=u.lineSegment.distanceToPoint(d,n);if(Object(a.default)(c.textBox,n))return!0;var f="mouse"===s?r.state.clickProximity:r.state.touchProximity;return!!o(e,c,n,f)||h<f}},"./tools/annotation/bidirectionalTool/renderToolData.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=n.n(r),a=n("./drawing/drawHandles.js"),o=n("./tools/annotation/bidirectionalTool/utils/updatePerpendicularLineHandles.js"),s=n("./store/index.js"),l=n("./stateManagement/toolStyle.js"),u=n("./stateManagement/toolColors.js"),c=n("./stateManagement/toolState.js"),d=n("./drawing/index.js"),h=n("./drawing/drawLinkedTextBox.js"),f=n("./util/getPixelSpacing.js");t.default=function(e){var t=this,n=e.detail,r=n.element,i=n.canvasContext,m=n.image,g=this.configuration,v=g.handleRadius,y=g.drawHandlesOnHover,b=g.hideHandlesIfMoving,x=g.renderDashed,w=Object(s.getModule)("globalConfiguration").configuration.lineDash,_=Object(c.getToolState)(r,this.name);if(_){var k=Object(f.default)(m),E=k.rowPixelSpacing,S=k.colPixelSpacing;if(E&&S)for(var T,C=Object(d.getNewContext)(i.canvas),I=u.default.getActiveColor(),A=l.default.getToolWidth(),O=function(e){var i=_.data[e];if(!1===i.visible)return"continue";T=i.active?I:u.default.getToolColor(),!0===i.invalidated&&(i.longestDiameter&&i.shortestDiameter?t.throttledUpdateCachedStats(m,r,i):t.updateCachedStats(m,r,i)),Object(d.draw)(C,(function(e){Object(d.setShadow)(e,t.configuration);var s=i.handles,l=s.start,u=s.end,c=s.perpendicularStart,f=s.perpendicularEnd,m=s.textBox,g={color:T},_={color:T,strokeWidth:k};x&&(g.lineDash=w,_.lineDash=w),Object(d.drawLine)(e,r,l,u,g);var k=A;Object(o.default)(n,i),Object(d.drawLine)(e,r,c,f,_);var C={color:T,handleRadius:v,drawHandlesIfActive:y,hideHandlesIfMoving:b};t.configuration.drawHandles&&Object(a.default)(e,n,i.handles,C);var I=p(i,E,S);Object(h.default)(e,r,m,I,i.handles,(function(e){return[e.start,e.end,e.perpendicularStart,e.perpendicularEnd]}),T,A,10,!0)}))},D=0;D<_.data.length;D++)O(D)}};var p=function(e,t,n){var r=" mm";t&&n||(r=" pixels");var a=" L ".concat(e.longestDiameter).concat(r),o=" W ".concat(e.shortestDiameter).concat(r),s=e.labels;return s&&Array.isArray(s)?[].concat(i()(s),[a,o]):[a,o]}},"./tools/annotation/bidirectionalTool/utils/calculateLongestAndShortestDiameters.js":function(e,t,n){"use strict";function r(e,t){var n=t.rowPixelSpacing,r=t.colPixelSpacing,i=e.handles,a=i.start,o=i.end,s=i.perpendicularStart,l=i.perpendicularEnd,u=(a.x-o.x)*(r||1),c=(a.y-o.y)*(n||1),d=Math.sqrt(u*u+c*c),h=(s.x-l.x)*(r||1),f=(s.y-l.y)*(n||1),p=Math.sqrt(h*h+f*f);if(p||(p=0),p>d){var m=d;d=p,p=m}return{longestDiameter:d.toFixed(1),shortestDiameter:p.toFixed(1)}}n.r(t),n.d(t,"default",(function(){return r}))},"./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js":function(e,t,n){"use strict";function r(e,t,n,r){var i=(n.x-r.x)/t,a=(n.y-r.y)/e;return Math.sqrt(i*i+a*a)}n.r(t),n.d(t,"default",(function(){return r}))},"./tools/annotation/bidirectionalTool/utils/getLineVector.js":function(e,t,n){"use strict";function r(e,t,n,r){var i=(n.x-r.x)*e,a=(n.y-r.y)*t,o=Math.sqrt(i*i+a*a);return{x:i/o,y:a/o,length:o}}n.r(t),n.d(t,"default",(function(){return r}))},"./tools/annotation/bidirectionalTool/utils/updatePerpendicularLineHandles.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./tools/annotation/bidirectionalTool/utils/getLineVector.js");function i(e,t){if(!t.handles.perpendicularStart.locked)return!1;var n,i,a,o,s=t.handles,l=s.start,u=s.end,c=e.image,d=c.columnPixelSpacing,h=void 0===d?1:d,f=c.rowPixelSpacing,p=void 0===f?1:f;if(l.x===u.x&&l.y===u.y)n=l.x,i=l.y,a=u.x,o=u.y;else{var m={x:(l.x+u.x)/2,y:(l.y+u.y)/2},g=Object(r.default)(h,p,l,u),v=g.length/2,y=v/(2*p),b=v/(2*h);n=m.x+b*g.y,i=m.y-y*g.x,a=m.x-b*g.y,o=m.y+y*g.x}return t.handles.perpendicularStart.x=n,t.handles.perpendicularStart.y=i,t.handles.perpendicularEnd.x=a,t.handles.perpendicularEnd.y=o,!0}},"./tools/annotation/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./tools/annotation/AngleTool.js"),i=n("./tools/annotation/ArrowAnnotateTool.js"),a=n("./tools/annotation/BidirectionalTool.js"),o=n("./tools/annotation/CircleRoiTool.js"),s=n("./tools/annotation/CobbAngleTool.js"),l=n("./tools/annotation/EllipticalRoiTool.js"),u=n("./tools/annotation/FreehandRoiTool.js"),c=n("./tools/annotation/LengthTool.js"),d=n("./tools/annotation/ProbeTool.js"),h=n("./tools/annotation/RectangleRoiTool.js"),f=n("./tools/annotation/TextMarkerTool.js");n.d(t,"AngleTool",(function(){return r.default})),n.d(t,"ArrowAnnotateTool",(function(){return i.default})),n.d(t,"BidirectionalTool",(function(){return a.default})),n.d(t,"CircleRoiTool",(function(){return o.default})),n.d(t,"CobbAngleTool",(function(){return s.default})),n.d(t,"EllipticalRoiTool",(function(){return l.default})),n.d(t,"FreehandRoiTool",(function(){return u.default})),n.d(t,"LengthTool",(function(){return c.default})),n.d(t,"ProbeTool",(function(){return d.default})),n.d(t,"RectangleRoiTool",(function(){return h.default})),n.d(t,"TextMarkerTool",(function(){return f.default})),t.default={AngleTool:r.default,ArrowAnnotateTool:i.default,BidirectionalTool:a.default,CircleRoiTool:o.default,CobbAngleTool:s.default,EllipticalRoiTool:l.default,FreehandRoiTool:u.default,LengthTool:c.default,ProbeTool:d.default,RectangleRoiTool:h.default,TextMarkerTool:f.default}},"./tools/base/BaseAnnotationTool.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./tools/base/BaseTool.js"),p=n("./stateManagement/toolState.js"),m=n("./manipulators/handleActivator.js"),g=n("./util/findAndMoveHelpers.js"),v=n("./util/logger.js"),y=Object(v.getLogger)("baseAnnotationTool");t.default=function(e){function t(){return i()(this,t),l()(this,c()(t).apply(this,arguments))}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){throw new Error("Method createNewMeasurement not implemented for ".concat(this.name,"."))}},{key:"pointNearTool",value:function(e,t,n){throw new Error("Method pointNearTool not implemented for ".concat(this.name,"."))}},{key:"distanceFromPoint",value:function(e,t,n){throw new Error("Method distanceFromPoint not implemented for ".concat(this.name,"."))}},{key:"renderToolData",value:function(e){throw new Error("renderToolData not implemented for ".concat(this.name,"."))}},{key:"mouseMoveCallback",value:function(e){for(var t=e.detail,n=t.element,r=t.currentPoints.canvas,i=Object(p.getToolState)(n,this.name),a=!1,o=0;o<i.data.length;o++){var s=i.data[o];!0===Object(m.default)(n,s.handles,r)&&(a=!0);var l=this.pointNearTool(n,s,r,"mouse")&&!s.active,u=!this.pointNearTool(n,s,r,"mouse")&&s.active;(l||u)&&(s.active=!s.active,a=!0)}return a}},{key:"handleSelectedCallback",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";Object(g.moveHandleNearImagePoint)(e,this,t,n,r)}},{key:"toolSelectedCallback",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse";Object(g.moveAnnotation)(e,this,t,n)}},{key:"updateCachedStats",value:function(e,t,n){y.warn("updateCachedStats not implemented for ".concat(this.name,"."))}}]),t}(f.default)},"./tools/base/BaseBrushTool.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./tools/base/BaseTool.js"),g=n("./events.js"),v=n("./externalModules.js"),y=n("./store/isToolActiveForElement.js"),b=n("./store/index.js"),x=n("./util/segmentation/index.js"),w=Object(b.getModule)("segmentation");t.default=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i()(this,t),r.configuration||(r.configuration={alwaysEraseOnClick:!1}),(n=l()(this,c()(t).call(this,e,r))).updateOnMouseMove=!0,n.hideDefaultCursor=!0,n._drawing=!1,n._drawingMouseUpCallback=n._drawingMouseUpCallback.bind(h()(n)),n}return p()(t,e),o()(t,[{key:"renderBrush",value:function(e){throw new Error("Method renderBrush not implemented for ".concat(this.name,"."))}},{key:"_paint",value:function(e){throw new Error("Method _paint not implemented for ".concat(this.name,"."))}},{key:"mouseDragCallback",value:function(e){this._lastImageCoords=e.detail.currentPoints.image,this._drawing&&this._paint(e)}},{key:"preMouseDownCallback",value:function(e){var t=e.detail,n=t.element,r=t.currentPoints;return this._startPainting(e),this._lastImageCoords=r.image,this._drawing=!0,this._startListeningForMouseUp(n),this._paint(e),!0}},{key:"_startPainting",value:function(e){var t=e.detail,n=w.configuration,r=w.getters.labelmap2D(t.element),i=r.labelmap2D,a=r.labelmap3D,o=r.currentImageIdIndex,s=r.activeLabelmapIndex,l=this._isCtrlDown(t)||this.configuration.alwaysEraseOnClick;if(this.paintEventData={labelmap2D:i,labelmap3D:a,currentImageIdIndex:o,activeLabelmapIndex:s,shouldErase:l},n.storeHistory){var u=i.pixelData.slice();this.paintEventData.previousPixelData=u}}},{key:"_endPainting",value:function(e){for(var t=w.configuration,n=w.setters,r=this.paintEventData,i=r.labelmap2D,a=r.currentImageIdIndex,o=new Set(i.pixelData).values(),s=[],l=!1;!l;){var u=o.next();(l=u.done)||s.push(u.value)}if(i.segmentsOnLabelmap=s,t.storeHistory){var c=this.paintEventData.previousPixelData,d=i.pixelData,h={imageIdIndex:a,diff:Object(x.getDiffBetweenPixelData)(c,d)};n.pushState(this.element,[h])}Object(x.triggerLabelmapModifiedEvent)(this.element)}},{key:"mouseMoveCallback",value:function(e){this._lastImageCoords=e.detail.currentPoints.image}},{key:"renderToolData",value:function(e){var t=e.detail.element;Object(y.default)(t,this.name)&&this.renderBrush(e)}},{key:"passiveCallback",value:function(e){try{v.default.cornerstone.updateImage(this.element)}catch(t){return}}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail.element;this._endPainting(e),this._drawing=!1,this._mouseUpRender=!0,this._stopListeningForMouseUp(t)}},{key:"newImageCallback",value:function(e){this._drawing&&(this._endPainting(e),this._startPainting(e))}},{key:"_startListeningForMouseUp",value:function(e){e.removeEventListener(g.default.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(g.default.MOUSE_CLICK,this._drawingMouseUpCallback),e.addEventListener(g.default.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(g.default.MOUSE_CLICK,this._drawingMouseUpCallback),v.default.cornerstone.updateImage(e)}},{key:"_stopListeningForMouseUp",value:function(e){e.removeEventListener(g.default.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(g.default.MOUSE_CLICK,this._drawingMouseUpCallback),v.default.cornerstone.updateImage(e)}},{key:"increaseBrushSize",value:function(){var e=w.setters,t=w.configuration.radius,n=Math.floor(1.2*t);n===t&&(n+=1),e.radius(n)}},{key:"decreaseBrushSize",value:function(){var e=w.setters,t=Math.floor(.8*w.configuration.radius);e.radius(t)}},{key:"_isCtrlDown",value:function(e){return e.event&&e.event.ctrlKey||e.ctrlKey}}]),t}(m.default)},"./tools/base/BaseTool.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/typeof.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/createClass.js"),l=n.n(s),u=n("./mixins/index.js"),c=n("./util/logger.js"),d=n("./util/deepmerge.js"),h=n("./store/setToolCursor.js"),f=n("./store/index.js"),p=Object(c.getLogger)("tools:base:BaseTool"),m=Object(f.getModule)("globalConfiguration");t.default=function(){function e(t,n){o()(this,e),this.initialConfiguration=Object(d.default)(n,t);var r=this.initialConfiguration,i=r.strategies,a=r.defaultStrategy,s=r.configuration,l=r.supportedInteractionTypes,u=r.mixins,c=r.svgCursor;this.name=r.name,this.mode="disabled",this.element=void 0,this.supportedInteractionTypes=l||[],this.strategies=i||{},this.defaultStrategy=a||Object.keys(this.strategies)[0]||void 0,this.activeStrategy=this.defaultStrategy,c&&(this.svgCursor=c),this._options={},this._configuration=Object.assign({},s),this.updateOnMouseMove=!1,this.hideDefaultCursor=!1,u&&u.length&&this._applyMixins(u),this._cursors=Object.assign({},this.initialConfiguration.cursors);var h=this.defaultStrategy&&this._cursors[this.activeStrategy];h&&(this.svgCursor=h)}return l()(e,[{key:"mergeOptions",value:function(e){this._options=Object.assign({},this._options,e)}},{key:"clearOptions",value:function(){this._options={}}},{key:"applyActiveStrategy",value:function(e,t){return this.strategies[this.activeStrategy].call(this,e,t)}},{key:"_applyMixins",value:function(e){for(var t=0;t<e.length;t++){var n=u.default["".concat(e[t])];"object"===i()(n)?(Object.assign(this,n),"function"==typeof this.initializeMixin&&this.initializeMixin()):p.warn("".concat(this.name,": mixin ").concat(u.default[t]," does not exist."))}"function"===this.initializeMixin&&delete this.initializeMixin}},{key:"setActiveStrategy",value:function(e){this.activeStrategy=e,m.configuration.showSVGCursors&&this.changeCursor(this.element,e)}},{key:"changeCursor",value:function(e,t){if(e){var n=this._cursors[t];n&&(this.svgCursor=n,"active"===this.mode&&Object(h.setToolCursor)(e,n))}}},{key:"configuration",get:function(){return this._configuration},set:function(e){this._configuration=e}},{key:"options",get:function(){return this._options}}],[{key:"configuration",get:function(){}}]),e}()},"./tools/base/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./tools/base/BaseAnnotationTool.js"),i=n("./tools/base/BaseTool.js"),a=n("./tools/base/BaseBrushTool.js");n.d(t,"BaseAnnotationTool",(function(){return r.default})),n.d(t,"BaseBrushTool",(function(){return a.default})),n.d(t,"BaseTool",(function(){return i.default})),t.default={BaseAnnotationTool:r.default,BaseBrushTool:a.default,BaseTool:i.default}},"./tools/cursors/MouseCursor.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("./stateManagement/toolColors.js"),l=n("./store/index.js").modules.cursor,u=function(){function e(t,n){i()(this,e),this.iconGroupString=t,this.options=Object.assign({},l.getters.defaultOptions(),n)}return o()(e,[{key:"getIconSVG",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._generateIconSVGString(e);return new Blob([t],{type:"image/svg+xml"})}},{key:"getIconSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._generateIconSVGString(e)}},{key:"getIconWithPointerSVG",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._generateIconWithPointerSVGString(e);return new Blob([t],{type:"image/svg+xml"})}},{key:"getIconWithPointerString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._generateIconWithPointerSVGString(e)}},{key:"_generateIconWithPointerSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},this.options,e),n=t.mousePointerGroupString,r=t.iconSize,i=t.viewBox,a=r/Math.max(i.x,i.y),o=16+r,s='\n        <svg\n        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n        width="'.concat(o,'" height="').concat(o,'" viewBox="0 0 ').concat(o," ").concat(o,'"\n      >\n        <g>\n          ').concat(n,'\n        </g>\n        <g transform="translate(16, 16) scale(').concat(a,')">\n          ').concat(this.iconGroupString,"\n        </g>\n      </svg>");return this._injectColors(s,t)}},{key:"_generateIconSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},this.options,e),n=t.iconSize,r=t.viewBox,i='\n      <svg\n        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n        width="'.concat(n,'" height="').concat(n,'" viewBox="0 0\n        ').concat(r.x," ").concat(r.y,'"\n      >\n        ').concat(this.iconGroupString,"\n      </svg>");return this._injectColors(i,t)}},{key:"_injectColors",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.activeColor||s.default.getActiveColor(),r=t.toolColor||s.default.getToolColor(),i=t.fillColor||s.default.getFillColor();return e.replace(/ACTIVE_COLOR/g,"".concat(n)).replace(/TOOL_COLOR/g,"".concat(r)).replace(/FILL_COLOR/g,"".concat(i))}},{key:"mousePoint",get:function(){var e=this.options.mousePoint;return"".concat(e.x," ").concat(e.y)}}]),e}()},"./tools/cursors/index.js":function(e,t,n){"use strict";n.r(t),n.d(t,"angleCursor",(function(){return i})),n.d(t,"arrowAnnotateCursor",(function(){return a})),n.d(t,"bidirectionalCursor",(function(){return o})),n.d(t,"cobbAngleCursor",(function(){return s})),n.d(t,"circleRoiCursor",(function(){return l})),n.d(t,"ellipticalRoiCursor",(function(){return u})),n.d(t,"freehandRoiCursor",(function(){return c})),n.d(t,"freehandRoiSculptorCursor",(function(){return d})),n.d(t,"lengthCursor",(function(){return h})),n.d(t,"probeCursor",(function(){return f})),n.d(t,"rectangleRoiCursor",(function(){return p})),n.d(t,"textMarkerCursor",(function(){return m})),n.d(t,"crosshairsCursor",(function(){return g})),n.d(t,"eraserCursor",(function(){return v})),n.d(t,"magnifyCursor",(function(){return y})),n.d(t,"panCursor",(function(){return b})),n.d(t,"rotateCursor",(function(){return x})),n.d(t,"stackScrollCursor",(function(){return w})),n.d(t,"wwwcRegionCursor",(function(){return _})),n.d(t,"wwwcCursor",(function(){return k})),n.d(t,"zoomCursor",(function(){return E})),n.d(t,"freehandEraseInsideCursor",(function(){return D})),n.d(t,"freehandFillInsideCursor",(function(){return M})),n.d(t,"freehandEraseOutsideCursor",(function(){return N})),n.d(t,"freehandFillOutsideCursor",(function(){return j})),n.d(t,"segRectangleEraseInsideCursor",(function(){return F})),n.d(t,"segRectangleFillInsideCursor",(function(){return R})),n.d(t,"segRectangleEraseOutsideCursor",(function(){return P})),n.d(t,"segRectangleFillOutsideCursor",(function(){return L})),n.d(t,"segCircleEraseInsideCursor",(function(){return B})),n.d(t,"segCircleFillInsideCursor",(function(){return $})),n.d(t,"segCircleEraseOutsideCursor",(function(){return z})),n.d(t,"segCircleFillOutsideCursor",(function(){return U}));var r=n("./tools/cursors/MouseCursor.js"),i=new r.default('<path fill="ACTIVE_COLOR" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50\n        50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23\n        10l50 50q10 10 10 23z"\n      />',{viewBox:{x:1792,y:1792}}),a=new r.default('<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />\n  </g>',{viewBox:{x:24,y:24}}),o=new r.default('<g fill="ACTIVE_COLOR" stroke-width="3" stroke="ACTIVE_COLOR">\n    <path d="M27.63 3.21L3.12 28.81"></path>\n    <path d="M27.63 15.75L15.27 4.43"></path>\n    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>\n    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>\n    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>\n    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>\n  </g>',{viewBox:{x:48,y:48}}),s=new r.default('<g stroke="ACTIVE_COLOR" stroke-width="3">\n    <path d="M28.59 2.34L3.82 12.32"></path>\n    <path d="M28.59 29.66L3.82 19.68"></path>\n    <path stroke-dasharray="2" fill-opacity="0" d="M12.37\n      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15\n      9.33C13.11 9.24 13.02 9 12.88 8.63">\n    </path>\n  </g>',{viewBox:{x:32,y:32}}),l=new r.default('<circle stroke="ACTIVE_COLOR" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',{viewBox:{x:32,y:32}}),u=new r.default('<path stroke="ACTIVE_COLOR" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16\n    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14\n    6.3 30.74 10.54 30.74 15.76Z"\n    />',{viewBox:{x:32,y:32}}),c=new r.default('\n  <g fill="ACTIVE_COLOR" stroke="ACTIVE_COLOR" stroke-width="2">\n    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>\n    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>\n    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>\n    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>\n    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>\n    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>\n    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>\n    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>\n    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>\n    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>\n    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>\n    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>\n    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>\n    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>\n    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>\n    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>\n    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>\n    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>\n    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>\n    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>\n    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>\n    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>\n    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>\n    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>\n    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>\n    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>\n    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>\n    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>\n    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>\n    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>\n  </g>',{viewBox:{x:18,y:18}}),d=new r.default('<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n      <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>\n      <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>\n      <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>\n      <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>\n      <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>\n      <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>\n      <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>\n      <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>\n      <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>\n      <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>\n      <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>\n      <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>\n      <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>\n      <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>\n      <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>\n      <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>\n      <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>\n      <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>\n      <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>\n      <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>\n      <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>\n      <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>\n      <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>\n      <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>\n      <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>\n      <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>\n      <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>\n      <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>\n      <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>\n      <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>\n      <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>\n      <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>\n    </g>',{viewBox:{x:18,y:18}}),h=new r.default('<g id="length-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />\n  </g>',{viewBox:{x:24,y:24}}),f=new r.default('<path fill="ACTIVE_COLOR" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75\n    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73\n    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5\n    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5\n    385.5-103 385.5 103 279.5 279.5 103 385.5z"\n  />',{viewBox:{x:1792,y:1792}}),p=new r.default('<path fill="ACTIVE_COLOR" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47\n    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0\n    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119\n    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z"\n  />',{viewBox:{x:1792,y:1792}}),m=new r.default('<path fill="ACTIVE_COLOR" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0\n    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29\n    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15\n    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5\n    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0\n    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11\n    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0\n    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58\n    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z"\n  />',{viewBox:{x:1792,y:1792}}),g=new r.default('<path fill="ACTIVE_COLOR" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26\n    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45\n    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26\n    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5\n    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32\n    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5\n    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26\n    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26\n    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161\n    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161\n    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z"\n  />',{viewBox:{x:1792,y:1792}}),v=new r.default('<path transform="translate(0,1792) scale(1,-1)" fill="ACTIVE_COLOR" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15\n      34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38\n      0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38\n      0 69.5 20.5t47.5 54.5z"\n    />',{viewBox:{x:2048,y:1792}}),y=new r.default('<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z"\n    />',{viewBox:{x:512,y:512}}),b=new r.default('<path fill="ACTIVE_COLOR" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17\n      39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355\n      355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59\n      39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12\n      0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144\n      144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19\n      45v448q0 42-39 59-13 5-25 5-26 0-45-19z"\n    />',{viewBox:{x:1792,y:1792}}),x=new r.default('<path fill="ACTIVE_COLOR" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39\n      14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5\n      163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0\n      225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109\n      132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298\n      164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14\n      39 17 39 59z"\n    />',{viewBox:{x:1792,y:1792}}),w=new r.default('<path fill="ACTIVE_COLOR" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0\n      0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547\n      0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z"\n      />',{viewBox:{x:24,y:28}}),_=new r.default('<path fill="ACTIVE_COLOR" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119\n    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5\n    84.5t84.5 203.5z"\n  />',{viewBox:{x:1792,y:1792}}),k=new r.default('<path fill="ACTIVE_COLOR" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />\n    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="ACTIVE_COLOR" />',{viewBox:{x:18,y:18}}),E=new r.default('<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z"\n    />\n    <path fill="ACTIVE_COLOR" transform="scale(0.22,0.22) translate(1400,0)" d="M1216\n      320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19\n      19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26\n      0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z"\n    />',{viewBox:{x:640,y:512}}),S={x:127,y:60},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ACTIVE_COLOR";return'<rect fill="'.concat(e,'" x="80.19" y="25.03" width="47.14" height="15.85"/>')},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ACTIVE_COLOR";return'<rect fill="'.concat(e,'" x="80.19" y="25.03" width="47.14" height="15.85"/>\n      <rect fill="').concat(e,'" x="95.84" y="9.38" width="15.85" height="47.14"/>')},I='<path fill="ACTIVE_COLOR" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',A='<path fill="ACTIVE_COLOR" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',O='<path fill="ACTIVE_COLOR" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',D=new r.default("".concat(I," ").concat(T()),{viewBox:S}),M=new r.default("".concat(I," ").concat(C()),{viewBox:S}),N=new r.default("".concat(I," ").concat(T()),{viewBox:S}),j=new r.default("".concat(I," ").concat(C()),{viewBox:S}),F=new r.default("".concat(A," ").concat(T()),{viewBox:S}),R=new r.default("".concat(A," ").concat(C()),{viewBox:S}),P=new r.default("".concat(A," ").concat(T()),{viewBox:S}),L=new r.default("".concat(A," ").concat(C()),{viewBox:S}),B=new r.default("".concat(O," ").concat(T()),{viewBox:S}),$=new r.default("".concat(O," ").concat(C()),{viewBox:S}),z=new r.default("".concat(O," ").concat(T()),{viewBox:S}),U=new r.default("".concat(O," ").concat(C()),{viewBox:S})},"./tools/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./tools/CrosshairsTool.js");n.d(t,"CrosshairsTool",(function(){return r.default}));var i=n("./tools/DoubleTapFitToWindowTool.js");n.d(t,"DoubleTapFitToWindowTool",(function(){return i.default}));var a=n("./tools/DragProbeTool.js");n.d(t,"DragProbeTool",(function(){return a.default}));var o=n("./tools/EraserTool.js");n.d(t,"EraserTool",(function(){return o.default}));var s=n("./tools/FreehandRoiSculptorTool.js");n.d(t,"FreehandRoiSculptorTool",(function(){return s.default}));var l=n("./tools/MagnifyTool.js");n.d(t,"MagnifyTool",(function(){return l.default}));var u=n("./tools/OverlayTool.js");n.d(t,"OverlayTool",(function(){return u.default}));var c=n("./tools/OrientationMarkersTool.js");n.d(t,"OrientationMarkersTool",(function(){return c.default}));var d=n("./tools/PanMultiTouchTool.js");n.d(t,"PanMultiTouchTool",(function(){return d.default}));var h=n("./tools/PanTool.js");n.d(t,"PanTool",(function(){return h.default}));var f=n("./tools/ReferenceLinesTool.js");n.d(t,"ReferenceLinesTool",(function(){return f.default}));var p=n("./tools/RotateTool.js");n.d(t,"RotateTool",(function(){return p.default}));var m=n("./tools/RotateTouchTool.js");n.d(t,"RotateTouchTool",(function(){return m.default}));var g=n("./tools/ScaleOverlayTool.js");n.d(t,"ScaleOverlayTool",(function(){return g.default}));var v=n("./tools/StackScrollMouseWheelTool.js");n.d(t,"StackScrollMouseWheelTool",(function(){return v.default}));var y=n("./tools/StackScrollMultiTouchTool.js");n.d(t,"StackScrollMultiTouchTool",(function(){return y.default}));var b=n("./tools/StackScrollTool.js");n.d(t,"StackScrollTool",(function(){return b.default}));var x=n("./tools/WwwcRegionTool.js");n.d(t,"WwwcRegionTool",(function(){return x.default}));var w=n("./tools/WwwcTool.js");n.d(t,"WwwcTool",(function(){return w.default}));var _=n("./tools/ZoomMouseWheelTool.js");n.d(t,"ZoomMouseWheelTool",(function(){return _.default}));var k=n("./tools/ZoomTool.js");n.d(t,"ZoomTool",(function(){return k.default}));var E=n("./tools/ZoomTouchPinchTool.js");n.d(t,"ZoomTouchPinchTool",(function(){return E.default})),t.default={CrosshairsTool:r.default,DoubleTapFitToWindowTool:i.default,DragProbeTool:a.default,EraserTool:o.default,FreehandRoiSculptorTool:s.default,MagnifyTool:l.default,OverlayTool:u.default,OrientationMarkersTool:c.default,PanMultiTouchTool:d.default,PanTool:h.default,ReferenceLinesTool:f.default,RotateTool:p.default,RotateTouchTool:m.default,ScaleOverlayTool:g.default,StackScrollMouseWheelTool:v.default,StackScrollMultiTouchTool:y.default,StackScrollTool:b.default,WwwcRegionTool:x.default,WwwcTool:w.default,ZoomMouseWheelTool:_.default,ZoomTool:k.default,ZoomTouchPinchTool:E.default}},"./tools/referenceLines/calculateReferenceLine.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/pointProjector.js");t.default=function(e,t){var n=Object(r.planePlaneIntersection)(e,t);if(n)return{start:Object(r.projectPatientPointToImagePlane)(n.start,e),end:Object(r.projectPatientPointToImagePlane)(n.end,e)}}},"./tools/referenceLines/renderActiveReferenceLine.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./tools/referenceLines/calculateReferenceLine.js"),a=n("./stateManagement/toolColors.js"),o=n("./util/convertToVector3.js"),s=n("./drawing/index.js");t.default=function(e,t,n,l){var u=r.default.cornerstone,c=u.getEnabledElement(n).image,d=u.getEnabledElement(l).image;if(c&&d){var h=u.metaData.get("imagePlaneModule",c.imageId),f=u.metaData.get("imagePlaneModule",d.imageId);if(h&&f&&h.rowCosines&&h.columnCosines&&h.imagePositionPatient&&f.rowCosines&&f.columnCosines&&f.imagePositionPatient&&h.frameOfReferenceUID===f.frameOfReferenceUID){h.rowCosines=Object(o.default)(h.rowCosines),h.columnCosines=Object(o.default)(h.columnCosines),h.imagePositionPatient=Object(o.default)(h.imagePositionPatient),f.rowCosines=Object(o.default)(f.rowCosines),f.columnCosines=Object(o.default)(f.columnCosines),f.imagePositionPatient=Object(o.default)(f.imagePositionPatient);var p=h.rowCosines.clone().cross(h.columnCosines),m=f.rowCosines.clone().cross(f.columnCosines),g=p.angleTo(m);if(!((g=Math.abs(g))<.5)){var v=Object(i.default)(h,f);if(v){var y=a.default.getActiveColor();e.setTransform(1,0,0,1,0,0),Object(s.draw)(e,(function(e){Object(s.drawLine)(e,t.element,v.start,v.end,{color:y})}))}}}}}},"./tools/segmentation/BrushTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return w}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./externalModules.js"),g=n("./tools/base/index.js"),v=n("./store/index.js"),y=n("./util/segmentation/index.js"),b=n("./util/logger.js"),x=(Object(b.getLogger)("tools:BrushTool"),Object(v.getModule)("segmentation")),w=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Brush",supportedInteractionTypes:["Mouse","Touch"],configuration:{},mixins:["renderBrushMixin"]};return(e=l()(this,c()(t).call(this,n,r))).touchDragCallback=e._paint.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_paint",value:function(e){var t=e.detail,n=t.image,r=n.rows,i=n.columns,a=t.currentPoints.image,o=a.x,s=a.y;if(!(o<0||o>i||s<0||s>r)){var l=x.configuration.radius,u=Object(y.getCircle)(l,r,i,o,s),c=this.paintEventData,d=c.labelmap2D,h=c.labelmap3D,f=c.shouldErase;Object(y.drawBrushPixels)(u,d.pixelData,h.activeSegmentIndex,i,f),m.default.cornerstone.updateImage(e.detail.element)}}}]),t}(g.BaseBrushTool)},"./tools/segmentation/CircleScissorsTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/inherits.js"),c=n.n(u),d=n("./tools/base/index.js"),h=n("./tools/segmentation/strategies/index.js"),f=n("./tools/cursors/index.js"),p=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"CircleScissors",strategies:{FILL_INSIDE:h.fillInsideCircle,FILL_OUTSIDE:h.fillOutsideCircle,ERASE_OUTSIDE:h.eraseOutsideCircle,ERASE_INSIDE:h.eraseInsideCircle},cursors:{FILL_INSIDE:f.segCircleFillInsideCursor,FILL_OUTSIDE:f.segCircleFillOutsideCursor,ERASE_OUTSIDE:f.segCircleEraseOutsideCursor,ERASE_INSIDE:f.segCircleEraseInsideCursor},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],svgCursor:f.segCircleFillInsideCursor,mixins:["circleSegmentationMixin"]};return o()(this,l()(t).call(this,e,n))}return c()(t,e),t}(d.BaseTool)},"./tools/segmentation/CorrectionScissorsTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/inherits.js"),c=n.n(u),d=n("./tools/base/index.js"),h=n("./tools/cursors/index.js"),f=n("./tools/segmentation/strategies/index.js"),p=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"CorrectionScissors",strategies:{CORRECTION:f.correction},cursors:{CORRECTION:h.freehandFillInsideCursor},defaultStrategy:"CORRECTION",supportedInteractionTypes:["Mouse","Touch"],svgCursor:h.freehandFillInsideCursor,mixins:["polylineSegmentationMixin"]};return o()(this,l()(t).call(this,e,n))}return c()(t,e),t}(d.BaseTool)},"./tools/segmentation/FreehandScissorsTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return f}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/inherits.js"),c=n.n(u),d=n("./tools/cursors/index.js"),h=n("./tools/segmentation/strategies/index.js"),f=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"FreehandScissors",strategies:{FILL_INSIDE:h.fillInsideFreehand,FILL_OUTSIDE:h.fillOutsideFreehand,ERASE_OUTSIDE:h.eraseOutsideFreehand,ERASE_INSIDE:h.eraseInsideFreehand},cursors:{FILL_INSIDE:d.freehandFillInsideCursor,FILL_OUTSIDE:d.freehandFillOutsideCursor,ERASE_OUTSIDE:d.freehandEraseOutsideCursor,ERASE_INSIDE:d.freehandEraseInsideCursor},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],svgCursor:d.freehandFillInsideCursor,mixins:["freehandSegmentationMixin"]};return o()(this,l()(t).call(this,e,n))}return c()(t,e),t}(n("./tools/base/index.js").BaseTool)},"./tools/segmentation/RectangleScissorsTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/inherits.js"),c=n.n(u),d=n("./tools/base/index.js"),h=n("./tools/segmentation/strategies/index.js"),f=n("./tools/cursors/index.js"),p=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"RectangleScissors",strategies:{FILL_INSIDE:h.fillInsideRectangle,FILL_OUTSIDE:h.fillOutsideRectangle,ERASE_OUTSIDE:h.eraseOutsideRectangle,ERASE_INSIDE:h.eraseInsideRectangle},cursors:{FILL_INSIDE:f.segRectangleFillInsideCursor,FILL_OUTSIDE:f.segRectangleFillOutsideCursor,ERASE_OUTSIDE:f.segRectangleEraseOutsideCursor,ERASE_INSIDE:f.segRectangleEraseInsideCursor},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],mixins:["rectangleSegmentationMixin"]};return o()(this,l()(t).call(this,e,n))}return c()(t,e),t}(d.BaseTool)},"./tools/segmentation/SphericalBrushTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return k}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./externalModules.js"),g=n("./tools/base/BaseBrushTool.js"),v=n("./store/index.js"),y=n("./util/segmentation/index.js"),b=n("./stateManagement/toolState.js"),x=n("./util/logger.js"),w=Object(x.getLogger)("tools:SphericalBrushTool"),_=Object(v.getModule)("segmentation"),k=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"SphericalBrush",supportedInteractionTypes:["Mouse","Touch"],configuration:{alwaysEraseOnClick:!1},mixins:["renderBrushMixin"]};return(e=l()(this,c()(t).call(this,n,r))).touchDragCallback=e._paint.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_startPainting",value:function(e){var t,n=_.configuration,r=_.getters,i=e.detail,a=i.element,o=i.image,s=m.default.cornerstone,l=n.radius,u=o.rows,c=o.columns,d=Math.max(o.rowPixelSpacing,o.columnPixelSpacing),h=Object(b.getToolState)(a,"stack").data[0].imageIds,f=r.labelmap2D(a),p=f.labelmap2D,g=f.labelmap3D,v=f.currentImageIdIndex,y=f.activeLabelmapIndex,x=this._isCtrlDown(i)||this.configuration.alwaysEraseOnClick,k=s.metaData.get("imagePlaneModule",o.imageId);if(k?t=this._getImagesInRange(v,k.imagePositionPatient,h,l,d):(w.warn("No imagePlane metadata found for image, defaulting to circle brush application."),t=[{imageIdIndex:v,radiusOnImage:l}]),this.paintEventData={labelmap2D:p,labelmap3D:g,currentImageIdIndex:v,activeLabelmapIndex:y,shouldErase:x,imagesInRange:t},n.storeHistory){for(var E=[],S=0;S<t.length;S++){var T=r.labelmap2DByImageIdIndex(g,t[S].imageIdIndex,u,c).pixelData.slice();E.push(T)}this.paintEventData.previousPixeldataForImagesInRange=E}}},{key:"_paint",value:function(e){var t=_.getters,n=e.detail,r=n.image,i=r.rows,a=r.columns,o=n.currentPoints.image,s=o.x,l=o.y;if(!(s<0||s>a||l<0||l>i)){for(var u=this.paintEventData,c=u.labelmap3D,d=u.imagesInRange,h=u.shouldErase,f=0;f<d.length;f++){var p=d[f],g=p.imageIdIndex,v=p.radiusOnImage,b=Object(y.getCircle)(v,i,a,s,l),x=t.labelmap2DByImageIdIndex(c,g,i,a);Object(y.drawBrushPixels)(b,x.pixelData,c.activeSegmentIndex,a,h)}m.default.cornerstone.updateImage(e.detail.element)}}},{key:"_getImagesInRange",value:function(e,t,n,r,i){for(var a=r*i,o=[{imageIdIndex:e,radiusOnImage:r}],s=e+1;s<n.length;s++){var l=this._getRadiusOnImage(n[s],t,a,i);if(!l)break;o.push({imageIdIndex:s,radiusOnImage:l})}for(var u=e-1;u>=0;u--){var c=this._getRadiusOnImage(n[u],t,a,i);if(!c)break;o.push({imageIdIndex:u,radiusOnImage:c})}return o}},{key:"_getRadiusOnImage",value:function(e,t,n,r){var i=m.default.cornerstone.metaData.get("imagePlaneModule",e);if(i){var a=i.imagePositionPatient,o=Math.sqrt(Math.pow(a[0]-t[0],2)+Math.pow(a[1]-t[1],2)+Math.pow(a[2]-t[2],2));if(!(o>n))return Math.floor(Math.sqrt(Math.pow(n,2)-Math.pow(o,2))/r)}else w.warn("Can't find imagePlane metadata for image, cancelling spherical brushing on: ".concat(e,","))}},{key:"_endPainting",value:function(e){for(var t=this.paintEventData,n=t.labelmap3D,r=t.imagesInRange,i=[],a=_.configuration,o=_.setters,s=0;s<r.length;s++){for(var l=r[s].imageIdIndex,u=n.labelmaps2D[l],c=new Set(u.pixelData).values(),d=[],h=!1;!h;){var f=c.next();(h=f.done)||d.push(f.value)}if(u.segmentsOnLabelmap=d,a.storeHistory){var p=this.paintEventData.previousPixeldataForImagesInRange[s],m=n.labelmaps2D[l].pixelData;i.push({imageIdIndex:l,diff:Object(y.getDiffBetweenPixelData)(p,m)})}}a.storeHistory&&o.pushState(this.element,i),Object(y.triggerLabelmapModifiedEvent)(this.element)}}]),t}(g.default)},"./tools/segmentation/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./tools/segmentation/BrushTool.js"),i=n("./tools/segmentation/SphericalBrushTool.js"),a=n("./tools/segmentation/FreehandScissorsTool.js"),o=n("./tools/segmentation/RectangleScissorsTool.js"),s=n("./tools/segmentation/CircleScissorsTool.js"),l=n("./tools/segmentation/CorrectionScissorsTool.js");n.d(t,"BrushTool",(function(){return r.default})),n.d(t,"SphericalBrushTool",(function(){return i.default})),n.d(t,"FreehandScissorsTool",(function(){return a.default})),n.d(t,"RectangleScissorsTool",(function(){return o.default})),n.d(t,"CircleScissorsTool",(function(){return s.default})),n.d(t,"CorrectionScissorsTool",(function(){return l.default})),t.default={BrushTool:r.default,SphericalBrushTool:i.default,CircleScissorsTool:s.default,CorrectionScissorsTool:l.default,FreehandScissorsTool:a.default,RectangleScissorsTool:o.default}},"./tools/segmentation/strategies/correction.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return d}));var r=n("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=n.n(r),a=n("./tools/segmentation/strategies/index.js"),o=n("./util/segmentation/index.js"),s=n("./util/clip.js"),l=n("./util/isPointInImage.js"),u=n("./util/logger.js"),c=Object(u.getLogger)("util:segmentation:operations:correction");function d(e,t){var n=t.pixelData,r=t.segmentIndex,u=t.segmentationMixinType;if("freehandSegmentationMixin"===u){var d=function(e,t){for(var n=t.pixelData,r=t.points,i=e.detail.image,a=i.width,o=i.height,l=[],u=0;u<r.length;u++){var c=r[u],d=Math.floor(c.x),h=Math.floor(c.y);d=Object(s.default)(d,0,a-1),h=Object(s.default)(h,0,o-1);var f=l[l.length-1];f&&d===f.x&&h===f.y||l.push({x:d,y:h,segment:n[h*a+d]})}return l}(e,t),p=function(e,t){for(var n=!0,r=!0,i=0;i<e.length&&(e[i].segment===t?r=!1:n=!1,n||r);i++);return r?{isScissorOperation:!0,operation:"fillInsideFreehand"}:n?{isScissorOperation:!0,operation:"eraseInsideFreehand"}:{isScissorOperation:!1}}(d,r);if(p.isScissorOperation)"fillInsideFreehand"===p.operation?(c.warn("The line never intersects a segment."),Object(a.fillInsideFreehand)(e,t)):"eraseInsideFreehand"===p.operation&&(c.warn("The line is only ever inside the segment."),Object(a.eraseInsideFreehand)(e,t));else{var m=new Uint8Array(n.length);(function(e,t){var n=e[0].segment===t,r=[];r.push({additive:!n,nodes:[]});for(var i=0,a=0;a<e.length;a++){var o=e[a];n?(r[i].nodes.push(o),o.segment!==t&&(i++,n=!n,r.push({additive:!0,nodes:[]}),r[i].nodes.push(e[a-1]),r[i].nodes.push(o))):(r[i].nodes.push(o),o.segment===t&&(i++,n=!n,r.push({additive:!1,nodes:[]}),r[i].nodes.push(e[a-1]),r[i].nodes.push(o)))}return r.pop(),r.shift(),r})(d,r).forEach((function(t){!function(e,t,n,r,a){var s=a.detail.image,u=s.width,d=s.height,p=e.nodes,m=e.additive,g=m?0:1,v=function(e){return e.y*u+e.x},y=function(e){return{x:e%u,y:Math.floor(e/u)}};c.warn(m?"additive operation...":"subtractive operation...");for(var b=function(e){for(var t=[],n=0;n<e.length-1;n++)t.push(e[n]),t.push.apply(t,i()(Object(o.getPixelPathBetweenPixels)(e[n],e[n+1])));for(var r=[],a=[],s=0;s<t.length-1;s++){var l=(void 0,-1===(f={x:(h=t[s+1]).x-(d=t[s]).x,y:h.y-d.y}).x&&1===f.y?{left:{x:d.x-1,y:d.y-1},right:{x:d.x+1,y:d.y+1}}:0===f.x&&1===f.y?{left:{x:d.x-1,y:d.y},right:{x:d.x+1,y:d.y}}:1===f.x&&1===f.y?{left:{x:d.x-1,y:d.y+1},right:{x:d.x+1,y:d.y-1}}:1===f.x&&0===f.y?{left:{x:d.x,y:d.y+1},right:{x:d.x,y:d.y-1}}:1===f.x&&-1===f.y?{left:{x:d.x+1,y:d.y+1},right:{x:d.x-1,y:d.y-1}}:0===f.x&&-1===f.y?{left:{x:d.x+1,y:d.y},right:{x:d.x-1,y:d.y}}:-1===f.x&&-1===f.y?{left:{x:d.x+1,y:d.y-1},right:{x:d.x-1,y:d.y+1}}:-1===f.x&&0===f.y?{left:{x:d.x,y:d.y-1},right:{x:d.x,y:d.y+1}}:void c.error("Unable to find left and right paths for flood fill ",d,h,f)),u=l.right;r.push(l.left),a.push(u)}var d,h,f;return{pixelPath:t,leftPath:r,rightPath:a}}(p),x=b.pixelPath,w=b.leftPath,_=b.rightPath,k=x[0],E={xMin:k.x,xMax:k.x,yMin:k.y,yMax:k.y},S=0;S<n.length;S++)t[S]===r?(h(E,y(S)),n[S]=1):n[S]=0;for(var T=0;T<x.length;T++){var C=x[T];n[v(C)]=2,h(E,C)}!function(e,t,n){e.xMax=Math.min(e.xMax+2,n),e.xMin=Math.max(e.xMin-2,0),e.yMax=Math.min(e.yMax+2,t),e.yMin=Math.max(e.yMin-2,0)}(E,d,u);var I=E.xMin,A=E.xMax,O=E.yMin,D=E.yMax;function M(e,t){if(!(e>=A||e<I||t>=D||t<O))return n[t*u+e]}for(var N=0,j=0,F=0;F<w.length;F++){var R=w[F];n[v(R)]===g&&Object(l.default)(R,d,u)&&(N+=f(R,3,n,M,u));var P=_[F];n[v(P)]===g&&Object(l.default)(P,d,u)&&(j+=f(P,4,n,M,u))}if(0!==N&&0!==j){for(var L=m?r:0,B=N<j?3:4,$=0;$<n.length;$++)n[$]===B&&(t[$]=L);if(L===r)for(var z=0;z<x.length;z++)t[v(x[z])]=r;else for(var U=0;U<x.length;U++){var H=v(x[U]);t[H]===r&&(t[H]=0)}}}(t,n,m,r,e)}))}}else c.error("correction operation requires freehandSegmentationMixin operationData, recieved ".concat(u))}function h(e,t){var n=t.x,r=t.y;n<e.xMin&&(e.xMin=n),n>e.xMax&&(e.xMax=n),r<e.yMin&&(e.yMin=r),r>e.yMax&&(e.yMax=r)}function f(e,t,n,r,i){for(var a=Object(o.floodFill)(r,[e.x,e.y]).flooded,s=0;s<a.length;s++){var l=a[s];n[l[1]*i+l[0]]=t}return a.length}},"./tools/segmentation/strategies/eraseCircle.js":function(e,t,n){"use strict";n.r(t),n.d(t,"eraseInsideCircle",(function(){return d})),n.d(t,"eraseOutsideCircle",(function(){return h}));var r=n("../node_modules/@babel/runtime/helpers/slicedToArray.js"),i=n.n(r),a=n("./util/ellipse/index.js"),o=n("./util/logger.js"),s=n("./util/segmentation/index.js"),l=n("./util/getCircleCoords.js"),u=Object(o.getLogger)("util:segmentation:operations:eraseInsideCircle");function c(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.segmentationMixinType;if("circleSegmentationMixin"===r){var o=e.detail,c=Object(s.getBoundingBoxAroundCircle)(e),d=i()(c,2),h=d[0],f=d[1],p=Object(l.default)(o.handles.start,o.handles.end);n?Object(s.eraseInsideShape)(e,t,(function(e){return Object(a.pointInEllipse)(p,e)}),h,f):Object(s.eraseOutsideShape)(e,t,(function(e){return Object(a.pointInEllipse)(p,e)}),h,f)}else u.error("eraseInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(r))}function d(e,t){c(e,t,!0)}function h(e,t){c(e,t,!1)}},"./tools/segmentation/strategies/eraseFreehand.js":function(e,t,n){"use strict";n.r(t),n.d(t,"eraseInsideFreehand",(function(){return c})),n.d(t,"eraseOutsideFreehand",(function(){return d}));var r=n("../node_modules/@babel/runtime/helpers/slicedToArray.js"),i=n.n(r),a=n("./util/segmentation/index.js"),o=n("./util/isPointInPolygon.js"),s=n("./util/logger.js"),l=Object(s.getLogger)("util:segmentation:operations:eraseInsideFreehand");function u(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.points,s=t.segmentationMixinType;if("freehandSegmentationMixin"===s){var u=e.detail.image,c=r.map((function(e){return[e.x,e.y]})),d=Object(a.getBoundingBoxAroundPolygon)(c,u),h=i()(d,2),f=h[0],p=h[1];n?Object(a.eraseInsideShape)(e,t,(function(e){return Object(o.default)([e.x,e.y],c)}),f,p):Object(a.eraseOutsideShape)(e,t,(function(e){return Object(o.default)([e.x,e.y],c)}),f,p)}else l.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(s))}function c(e,t){u(e,t,!0)}function d(e,t){u(e,t,!1)}},"./tools/segmentation/strategies/eraseRectangle.js":function(e,t,n){"use strict";n.r(t),n.d(t,"eraseInsideRectangle",(function(){return u})),n.d(t,"eraseOutsideRectangle",(function(){return c}));var r=n("../node_modules/@babel/runtime/helpers/slicedToArray.js"),i=n.n(r),a=n("./util/logger.js"),o=n("./util/segmentation/index.js"),s=Object(a.getLogger)("util:segmentation:operations:eraseInsideRectangle");function l(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.points,a=t.segmentationMixinType;if("rectangleSegmentationMixin"===a){var l=e.detail,u=l.image,c=r.map((function(e){return[e.x,e.y]})),d=Object(o.getBoundingBoxAroundPolygon)(c,u),h=i()(d,2),f=h[0],p=h[1];n?Object(o.eraseInsideShape)(e,t,(function(){return!0}),f,p):Object(o.eraseOutsideBoundingBox)(e,t,f,p)}else s.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(a))}function u(e,t){l(e,t,!0)}function c(e,t){l(e,t,!1)}},"./tools/segmentation/strategies/fillCircle.js":function(e,t,n){"use strict";n.r(t),n.d(t,"fillInsideCircle",(function(){return d})),n.d(t,"fillOutsideCircle",(function(){return h}));var r=n("../node_modules/@babel/runtime/helpers/slicedToArray.js"),i=n.n(r),a=n("./util/segmentation/index.js"),o=n("./util/ellipse/index.js"),s=n("./util/getCircleCoords.js"),l=n("./util/logger.js"),u=Object(l.getLogger)("util:segmentation:operations:fillCircle");function c(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.segmentationMixinType;if("circleSegmentationMixin"===r){var l=e.detail,c=Object(a.getBoundingBoxAroundCircle)(e),d=i()(c,2),h=d[0],f=d[1],p=Object(s.default)(l.handles.start,l.handles.end);n?Object(a.fillInsideShape)(e,t,(function(e){return Object(o.pointInEllipse)(p,e)}),h,f):Object(a.fillOutsideShape)(e,t,(function(e){return Object(o.pointInEllipse)(p,e)}),h,f)}else u.error("fillInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(r))}function d(e,t){c(e,t,!0)}function h(e,t){c(e,t,!1)}},"./tools/segmentation/strategies/fillFreehand.js":function(e,t,n){"use strict";n.r(t),n.d(t,"fillInsideFreehand",(function(){return c})),n.d(t,"fillOutsideFreehand",(function(){return d}));var r=n("../node_modules/@babel/runtime/helpers/slicedToArray.js"),i=n.n(r),a=n("./util/segmentation/index.js"),o=n("./util/isPointInPolygon.js"),s=n("./util/logger.js"),l=Object(s.getLogger)("util:segmentation:operations:fillInsideFreehand");function u(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.points,s=t.segmentationMixinType;if("freehandSegmentationMixin"===s){var u=e.detail.image,c=r.map((function(e){return[e.x,e.y]})),d=Object(a.getBoundingBoxAroundPolygon)(c,u),h=i()(d,2),f=h[0],p=h[1];n?Object(a.fillInsideShape)(e,t,(function(e){return Object(o.default)([e.x,e.y],c)}),f,p):Object(a.fillOutsideShape)(e,t,(function(e){return Object(o.default)([e.x,e.y],c)}),f,p)}else l.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(s))}function c(e,t){u(e,t,!0)}function d(e,t){u(e,t,!1)}},"./tools/segmentation/strategies/fillRectangle.js":function(e,t,n){"use strict";n.r(t),n.d(t,"fillInsideRectangle",(function(){return u})),n.d(t,"fillOutsideRectangle",(function(){return c}));var r=n("../node_modules/@babel/runtime/helpers/slicedToArray.js"),i=n.n(r),a=n("./util/segmentation/index.js"),o=n("./util/logger.js"),s=Object(o.getLogger)("util:segmentation:operations:fillInsideRectangle");function l(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.points,o=t.segmentationMixinType;if("rectangleSegmentationMixin"===o){var l=e.detail.image,u=r.map((function(e){return[e.x,e.y]})),c=Object(a.getBoundingBoxAroundPolygon)(u,l),d=i()(c,2),h=d[0],f=d[1];n?Object(a.fillInsideShape)(e,t,(function(){return!0}),h,f):Object(a.fillOutsideBoundingBox)(e,t,h,f)}else s.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(o))}function u(e,t){l(e,t,!0)}function c(e,t){l(e,t,!1)}},"./tools/segmentation/strategies/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./tools/segmentation/strategies/correction.js");n.d(t,"correction",(function(){return r.default}));var i=n("./tools/segmentation/strategies/eraseFreehand.js");n.d(t,"eraseInsideFreehand",(function(){return i.eraseInsideFreehand})),n.d(t,"eraseOutsideFreehand",(function(){return i.eraseOutsideFreehand}));var a=n("./tools/segmentation/strategies/eraseRectangle.js");n.d(t,"eraseInsideRectangle",(function(){return a.eraseInsideRectangle})),n.d(t,"eraseOutsideRectangle",(function(){return a.eraseOutsideRectangle}));var o=n("./tools/segmentation/strategies/fillFreehand.js");n.d(t,"fillInsideFreehand",(function(){return o.fillInsideFreehand})),n.d(t,"fillOutsideFreehand",(function(){return o.fillOutsideFreehand}));var s=n("./tools/segmentation/strategies/fillRectangle.js");n.d(t,"fillInsideRectangle",(function(){return s.fillInsideRectangle})),n.d(t,"fillOutsideRectangle",(function(){return s.fillOutsideRectangle}));var l=n("./tools/segmentation/strategies/fillCircle.js");n.d(t,"fillInsideCircle",(function(){return l.fillInsideCircle})),n.d(t,"fillOutsideCircle",(function(){return l.fillOutsideCircle}));var u=n("./tools/segmentation/strategies/eraseCircle.js");n.d(t,"eraseInsideCircle",(function(){return u.eraseInsideCircle})),n.d(t,"eraseOutsideCircle",(function(){return u.eraseOutsideCircle}))},"./util/SaveAs.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",r=e.querySelector("canvas");if(r.msToBlob){var i=r.msToBlob();return window.navigator.msSaveBlob(i,t)}var a=document.createElement("a");if(a.download=t,a.href=r.toDataURL(n,1),document.createEvent){var o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(o)}else a.fireEvent&&a.fireEvent("onclick")}},"./util/angleBetweenPoints.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){var r=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),i=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)),a=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2));return{angle:180*Math.acos((Math.pow(r,2)+Math.pow(i,2)-Math.pow(a,2))/(2*r*i))/Math.PI,direction:(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)}}},"./util/calculateSUV.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");function i(e){return parseFloat(".".concat(e))}t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=r.default.cornerstone,o=a.metaData.get("patientStudyModule",e.imageId),s=a.metaData.get("generalSeriesModule",e.imageId);if(o&&s){var l=s.modality;if("PT"===l){var u=n?t:t*e.slope+e.intercept,c=o.patientWeight;if(c){var d=a.metaData.get("petIsotopeModule",e.imageId);if(d){var h=d.radiopharmaceuticalInfo,f=h.radiopharmaceuticalStartTime,p=h.radionuclideTotalDose,m=h.radionuclideHalfLife,g=s.seriesTime;if(f&&p&&m&&g){var v=i(g.fractionalSeconds||0)+g.seconds+60*g.minutes+60*g.hours*60,y=i(f.fractionalSeconds||0)+f.seconds+60*f.minutes+60*f.hours*60,b=v-y,x=p*Math.exp(-b*Math.log(2)/m),w=u*c/x*1e3;return w}}}}}}},"./util/clip.js":function(e,t,n){"use strict";function r(e,t,n){return Math.min(Math.max(t,e),n)}function i(e,t){e.x=r(e.x,0,t.width),e.y=r(e.y,0,t.height)}n.r(t),n.d(t,"clip",(function(){return r})),n.d(t,"clipToBox",(function(){return i})),t.default=r},"./util/convertToVector3.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./externalModules.js");function i(e){var t=r.default.cornerstoneMath;if(e instanceof t.Vector3)return e;var n=Object.keys(e);return n.includes("x")&&n.includes("y")&&n.includes("z")?new t.Vector3(e.x,e.y,e.z):new t.Vector3(e[0],e[1],e[2])}},"./util/copyPoints.js":function(e,t,n){"use strict";function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.x,n=e.y;return{x:t,y:n}}n.r(t),t.default=function(e){return{page:r(e.page),image:r(e.image),client:r(e.client),canvas:r(e.canvas)}}},"./util/debounce.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/isObject.js");t.default=function(e,t,n){var i,a,o,s,l,u,c=0,d=!1,h=!1,f=!0,p=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var n=i,r=a;return i=a=void 0,c=t,s=e.apply(r,n)}function g(e,t){return p?window.requestAnimationFrame(e):setTimeout(e,t)}function v(e){return c=e,l=g(b,t),d?m(e):s}function y(e){var n=e-u;return void 0===u||n>=t||n<0||h&&e-c>=o}function b(){var e=Date.now();if(y(e))return x(e);l=g(b,function(e){var n=t-(e-u);return h?Math.min(n,o-(e-c)):n}(e))}function x(e){return l=void 0,f&&i?m(e):(i=a=void 0,s)}function w(){for(var e=Date.now(),n=y(e),r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];if(i=o,a=this,u=e,n){if(void 0===l)return v(u);if(h)return l=g(b,t),m(u)}return void 0===l&&(l=g(b,t)),s}return t=Number(t)||0,Object(r.default)(n)&&(d=Boolean(n.leading),o=(h="maxWait"in n)?Math.max(Number(n.maxWait)||0,t):o,f="trailing"in n?Boolean(n.trailing):f),w.cancel=function(){void 0!==l&&function(e){if(p)return window.cancelAnimationFrame(e);clearTimeout(e)}(l),c=0,i=u=a=l=void 0},w.flush=function(){return void 0===l?s:x(Date.now())},w.pending=function(){return void 0!==l},w}},"./util/debugLib/common.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=n.n(r);t.default=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){var n;function i(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];if(i.enabled){var o=i,s=Number(new Date),l=s-(n||s);o.diff=l,o.prev=n,o.curr=s,n=s,t[0]=r.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var u=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,n){if("%%"===e)return e;u++;var i=r.formatters[n];return"function"==typeof i&&(e=i.call(o,t[u]),t.splice(u,1),u--),e})),r.formatArgs.call(o,t);var c=o.log||r.log;c.apply(o,t)}}return i.namespace=e,i.enabled=r.enabled(e),i.useColors=r.useColors(),i.color=t(e),i.destroy=a,i.extend=o,"function"==typeof r.init&&r.init(i),r.instances.push(i),i}function a(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function o(e,t){var n=r(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){var e=[].concat(i()(r.names.map(s)),i()(r.skips.map(s).map((function(e){return"-".concat(e)})))).join(",");return r.enable(""),e},r.enable=function(e){var t;r.save(e),r.names=[],r.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^".concat(e.substr(1),"$"))):r.names.push(new RegExp("^".concat(e,"$"))));for(t=0;t<r.instances.length;t++){var a=r.instances[t];a.enabled=r.enabled(a.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n("../node_modules/ms/index.js"),Object.keys(e).forEach((function(t){r[t]=e[t]})),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},"./util/debugLib/index.js":function(e,t,n){"use strict";n.r(t),(function(e){var r=n("./util/debugLib/common.js"),i={formatArgs:function(e){if(e[0]="".concat((this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" "),"+").concat(a.humanize(this.diff)),this.useColors){var t="color: ".concat(this.color);e.splice(1,0,t,"color: inherit");var n=0,r=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(r=n))})),e.splice(r,0,t)}},save:function(e){try{e?i.storage.setItem("debug",e):i.storage.removeItem("debug")}catch(t){}},load:function(){var t;try{t=i.storage.getItem("debug")}catch(n){console.warn(n)}return!t&&void 0!==e&&"env"in e&&(t=e.env.DEBUG),t},useColors:function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},storage:function(){try{return localStorage}catch(e){}}(),colors:["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"]};i.log=console.debug||console.log||function(){};var a=Object(r.default)(i);a.formatters.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: ".concat(t.message)}},t.default=a}).call(this,n("../node_modules/process/browser.js"))},"./util/deepmerge.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/typeof.js"),i=n.n(r),a=function(e){return e&&"object"===i()(e)&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)},o=function(e,t){return t&&!0===t.clone&&a(e)?u(Array.isArray(e)?[]:{},e,t):e},s=function(e,t,n){var r=e.slice();return t.forEach((function(t,i){void 0===r[i]?r[i]=o(t,n):a(t)?r[i]=u(e[i],t,n):-1===e.indexOf(t)&&r.push(o(t,n))})),r},l=function(e,t,n){var r={};return a(e)&&Object.keys(e).forEach((function(t){r[t]=o(e[t],n)})),Object.keys(t).forEach((function(i){r[i]=a(t[i])&&e[i]?u(e[i],t[i],n):o(t[i],n)})),r},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=Array.isArray(t),i=n||{arrayMerge:s},a=i.arrayMerge||s;return r?Array.isArray(e)?a(e,t,n):o(t,n):l(e,t,n)};t.default=u},"./util/ellipse/calculateEllipseStatistics.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/ellipse/pointInEllipse.js");t.default=function(e,t){for(var n=0,i=0,a=0,o=0,s=null,l=null,u=t.top;u<t.top+t.height;u++)for(var c=t.left;c<t.left+t.width;c++){var d={x:c,y:u};Object(r.default)(t,d)&&(null===s&&(s=e[o],l=e[o]),n+=e[o],i+=e[o]*e[o],s=Math.min(s,e[o]),l=Math.max(l,e[o]),a++),o++}if(0===a)return{count:a,mean:0,variance:0,stdDev:0,min:0,max:0};var h=n/a,f=i/a-h*h;return{count:a,mean:h,variance:f,stdDev:Math.sqrt(f),min:s,max:l}}},"./util/ellipse/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/ellipse/calculateEllipseStatistics.js");n.d(t,"calculateEllipseStatistics",(function(){return r.default}));var i=n("./util/ellipse/pointInEllipse.js");n.d(t,"pointInEllipse",(function(){return i.default})),t.default={calculateEllipseStatistics:r.default,pointInEllipse:i.default}},"./util/ellipse/pointInEllipse.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=e.width/2,r=e.height/2;if(n<=0||r<=0)return!1;var i=t.x-(e.left+n),a=t.y-(e.top+r);return i*i/(n*n)+a*a/(r*r)<=1}},"./util/findAndMoveHelpers.js":function(e,t,n){"use strict";n.r(t),n.d(t,"moveHandleNearImagePoint",(function(){return o})),n.d(t,"findHandleDataNearImagePoint",(function(){return s})),n.d(t,"moveAnnotation",(function(){return l}));var r=n("./store/index.js"),i=n("./manipulators/getHandleNearImagePoint.js"),a=n("./manipulators/index.js"),o=function(e,t,n,i,o){n.active=!0,r.state.isToolLocked=!0,Object(a.moveHandle)(e.detail,t.name,n,i,t.options,o),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},s=function(e,t,n,a){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"mouse",s=0;s<t.data.length;s++){var l=t.data[s],u=Object(i.default)(e,l.handles,a,"mouse"===o?r.state.clickProximity:r.state.touchProximity);if(u)return{handle:u,data:l}}},l=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";n.active=!0,r.state.isToolLocked=!0,Object(a.moveAllHandles)(e.detail,t.name,n,null,t.options,i,(function(){n.active=!1,r.state.isToolLocked=!1})),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}},"./util/freehand/ClickedLineData.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=function e(t,n){i()(this,e),this.toolIndex=t,this.handleIndexArray=n}},"./util/freehand/FreehandHandleData.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];i()(this,e),this.x=t.x,this.y=t.y,this.highlight=n,this.active=r,this.lines=[]}},"./util/freehand/FreehandLineFinder.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return c}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("./stateManagement/toolState.js"),l=n("./externalModules.js"),u=n("./util/freehand/ClickedLineData.js"),c=function(){function e(t,n){i()(this,e),this._eventData=t,this._toolName=n}return o()(e,[{key:"findLine",value:function(){var e=this.findTool();if(null===e)return null;var t=this._getCloseLinesInTool(e);return t?this._findCorrectLine(e,t):null}},{key:"findTool",value:function(){return this._toolData=Object(s.getToolState)(this._eventData.element,this._toolName),this._mousePoint=this._eventData.currentPoints.canvas,this._toolData?this._nearestHandleToPointAllTools().toolIndex:null}},{key:"_nearestHandleToPointAllTools",value:function(){for(var e=this._toolData,t={toolIndex:null,handleIndex:null,distance:1/0},n=0;n<e.data.length;n++){var r=this._nearestHandleToPoint(n);null!==r&&r.distance<t.distance&&(t=r)}return t}},{key:"_nearestHandleToPoint",value:function(e){var t=this._eventData,n=this._toolData.data[e],r=n.handles.points;if(void 0===r)return null;if(!1===n.visible)return null;for(var i={toolIndex:e,handleIndex:null,distance:1/0},a=0;a<r.length;a++){var o=l.default.cornerstone.pixelToCanvas(t.element,r[a]),s=l.default.cornerstoneMath.point.distance(o,this._mousePoint);s<i.distance&&(i.handleIndex=a,i.distance=s)}return i}},{key:"_getCloseLinesInTool",value:function(t){for(var n=this._toolData.data[t].handles.points,r=[],i=0;i<n.length;i++){var a=e.getNextHandleIndex(i,n.length);this._distanceOfPointfromLine(n[i],n[a])<10&&r.push([i,a])}return r}},{key:"_findCorrectLine",value:function(e,t){for(var n=0;n<t.length;n++)if(this._pointProjectsToLineSegment(e,t[n]))return new u.default(e,t[n]);return null}},{key:"_pointProjectsToLineSegment",value:function(t,n){var r=this._toolData.data[t],i=r.handles.points;if(void 0!==r.handles.points){if(!1===r.visible)return!1;var a=e.getCanvasPointsFromHandles(i[n[0]],i[n[1]],this._eventData.element),o=e.getLineAsVector(a),s=this._getLineOriginToMouseAsVector(a),l=(s[0]*o[0]+s[1]*o[1])/o.magnitude;return l>0&&l<o.magnitude}}},{key:"_getLineOriginToMouseAsVector",value:function(e){return[this._mousePoint.x-e[0].x,this._mousePoint.y-e[0].y]}},{key:"_distanceOfPointfromLine",value:function(e,t){var n=this._eventData,r=l.default.cornerstone.pixelToCanvas(n.element,e),i=l.default.cornerstone.pixelToCanvas(n.element,t),a=this._mousePoint;return Math.abs((i.y-r.y)*a.x-(i.x-r.x)*a.y+i.x*r.y-i.y*r.x)/l.default.cornerstoneMath.point.distance(r,i)}}],[{key:"getCanvasPointsFromHandles",value:function(e,t,n){var r=[];return e.x<t.x?(r.push(l.default.cornerstone.pixelToCanvas(n,e)),r.push(l.default.cornerstone.pixelToCanvas(n,t))):(r.push(l.default.cornerstone.pixelToCanvas(n,t)),r.push(l.default.cornerstone.pixelToCanvas(n,e))),r}},{key:"getLineAsVector",value:function(e){var t=[e[1].x-e[0].x,e[1].y-e[0].y];return t.magnitude=l.default.cornerstoneMath.point.distance(e[0],e[1]),t}},{key:"getNextHandleIndex",value:function(e,t){return e<t-1?e+1:0}}]),e}()},"./util/freehand/addLine.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){e[t].lines.push(t===e.length-1?e[0]:e[t+1])}},"./util/freehand/calculateFreehandStatistics.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/freehand/pointInFreehand.js");function i(e,t,n,i){Object(r.default)(e,t)&&(n.value+=i,n.squared+=i*i,n.count++)}t.default=function(e,t,n){var r={count:0,mean:0,variance:0,stdDev:0},a=function(e,t,n){for(var r={value:0,squared:0,count:0},a=0,o=t.top;o<t.top+t.height;o++)for(var s=t.left;s<t.left+t.width;s++)i(n,{x:s,y:o},r,e[a]),a++;return r}(e,t,n);return 0===a.count||(r.count=a.count,r.mean=a.value/a.count,r.variance=a.squared/a.count-r.mean*r.mean,r.stdDev=Math.sqrt(r.variance)),r}},"./util/freehand/freehandArea.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=0,r=e.length-1;t=t||1;for(var i=0;i<e.length;i++)n+=(e[r].x+e[i].x)*(e[r].y-e[i].y),r=i;return Math.abs(n*t/2)}},"./util/freehand/freehandIntersect.js":function(e,t,n){"use strict";function r(e,t,n,r){for(var o=e.length-1,s=0;s<e.length;s++)if(-1===r.indexOf(s)&&-1===r.indexOf(o)){if(i(t,n,a(e[o]),a(e[s])))return!0;o=s}else o=s;return!1}function i(e,t,n,r){var i=!1,a=[o(e,t,n),o(e,t,r),o(n,r,e),o(n,r,t)];return a[0]!==a[1]&&a[2]!==a[3]||((0===a[0]&&s(e,n,t)||0===a[1]&&s(e,r,t)||0===a[2]&&s(n,e,r)||0===a[3]&&s(n,t,r))&&(i=!0),i)}function a(e){return{x:e.x,y:e.y}}function o(e,t,n){var r=(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y);return 0===r?0:r>0?1:2}function s(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}n.r(t),t.default={newHandle:function(e,t){var n=t.length-1;return r(t,a(t[n]),a(e),[n])},end:function(e){var t=e.length-1;return r(e,a(e[t]),a(e[0]),[t,0])},modify:function(e,t){var n=a(e[t]),i=t-1;0===t&&(i=e.length-1);var o=a(e[i]);return!!r(e,n,o,[t,i])||r(e,n,o=a(e[i=t===e.length-1?0:t+1]),[t,i])}}},"./util/freehand/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/freehand/calculateFreehandStatistics.js"),i=n("./util/freehand/ClickedLineData.js"),a=n("./util/freehand/freehandArea.js"),o=n("./util/freehand/FreehandHandleData.js"),s=n("./util/freehand/freehandIntersect.js"),l=n("./util/freehand/FreehandLineFinder.js"),u=n("./util/freehand/insertOrDelete.js"),c=n("./util/freehand/pointInFreehand.js"),d=n("./util/freehand/addLine.js");t.default={calculateFreehandStatistics:r.default,ClickedLineData:i.default,freehandArea:a.default,FreehandHandleData:o.default,freehandIntersect:s.default,FreehandLineFinder:l.default,insertOrDelete:u.default,pointInFreehand:c.default,addLine:d.default}},"./util/freehand/insertOrDelete.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/freehand/FreehandLineFinder.js"),i=n("./util/freehand/FreehandHandleData.js"),a=n("./stateManagement/toolState.js"),o=n("./externalModules.js"),s=n("./util/freehand/addLine.js");function l(e,t){var n=Object(a.getToolState)(e.element,this.name);if(void 0!==n){var r=t.handleIndex,i=n.data[t.toolIndex],s=i.handles.points;s.length<=3||(r===s.length-1?(s[r-1].lines.pop(),s[r-1].lines.push(s[0])):0===r?(s[s.length-1].lines.pop(),s[s.length-1].lines.push(s[r+1])):(s[r-1].lines.pop(),s[r-1].lines.push(s[r+1])),s.splice(r,1),i.invalidated=!0,i.active=!0,i.highlight=!0,o.default.cornerstone.updateImage(e.element))}}function u(e,t){var n=Object(a.getToolState)(e.element,this.name);if(void 0!==n){var r=n.data[t.toolIndex],l=function(e){for(var t=e.handleIndexArray,n=1/0,r=t.includes(0),i=0;i<t.length;i++){var a=t[i];0!==a&&a<n&&(n=a)}return r&&1===n&&(n=0),++n}(t);if(l!==1/0){var u=new i.default(e.currentPoints.image),c=r.handles.points;c.splice(l,0,u),c[l-1].lines.pop(),c[l-1].lines.push(e.currentPoints.image),Object(s.default)(c,l),r.active=!0,r.highlight=!0,r.invalidated=!0,o.default.cornerstone.updateImage(e.element)}}}t.default=function(e,t){var n=e.detail;if(t&&null!==t.handleNearby)l.call(this,n,{toolIndex:t.toolIndex,handleIndex:t.handleNearby});else{var i=new r.default(n,this.name).findLine();i&&u.call(this,n,i)}}},"./util/freehand/pointInFreehand.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){for(var n=!1,r=e.length-1,i=0;i<e.length;i++)void 0,void 0,void 0,c=(s=e[r]).y,!((u=(o=e[i]).y)<(l=(a=t).y)&&l<c||c<l&&l<u)||!function(e,t,n){if(t.x>e.x&&n.x>e.x)return!0;if(t.x===n.x)return e.x<t.x;if(t.x>n.x){var r=t;t=n,n=r}var i=function(e,t,n){var r=(n.y-t.y)/(n.x-t.x);return{value:t.y+r*(e.x-t.x),gradient:r}}(e,t,n);return Math.sign(i.gradient)*e.y>Math.sign(i.gradient)*i.value}(a,o,s)||(n=!n),r=i;var a,o,s,l,u,c;return n}},"./util/getActiveTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));var r=n("./store/index.js"),i=n("./store/getActiveToolsForElement.js"),a=n("./store/filterToolsUsableWithMultiPartTools.js");function o(e,t){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse";if("touch"===o?n=(n=Object(i.default)(e,r.getters.touchTools())).filter((function(e){return e.options.isTouchActive})):(n=(n=Object(i.default)(e,r.getters.mouseTools())).filter((function(e){return Array.isArray(e.options.mouseButtonMask)&&t&&e.options.mouseButtonMask.includes(t)&&e.options.isMouseActive})),r.state.isMultiPartToolActive&&(n=Object(a.default)(n))),0!==n.length)return n[0]}},"./util/getCircleCoords.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./externalModules.js");function i(e,t){var n=(0,r.default.cornerstoneMath.point.distance)(e,t);return{left:Math.floor(Math.min(e.x-n,t.x)),top:Math.floor(Math.min(e.y-n,t.y)),width:2*n,height:2*n}}},"./util/getDefault.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){return void 0===e?t:e}},"./util/getKeyPressData.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=n("./store/index.js"),i=n("./externalModules.js");function a(e){var t=i.default.cornerstone,n=e.currentTarget,a=t.getEnabledElement(n);if(a&&a.image){var o=r.default.state.mousePositionImage;return{event:window.event||e,element:n,viewport:t.getViewport(n),image:a.image,currentPoints:{image:o,canvas:t.pixelToCanvas(n,o)},keyCode:e.keyCode,which:e.which}}}},"./util/getLuminance.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t,n,i,a){if(!e)throw new Error("getLuminance: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var o,s,l,u=r.default.cornerstone.getEnabledElement(e).image,c=[],d=0,h=u.getPixelData();if(u.color)for(s=0;s<a;s++)for(l=0;l<i;l++)c[d++]=.2126*h[o=4*((s+n)*u.columns+(l+t))]+.7152*h[o+1]+.0722*h[o+2];else for(s=0;s<a;s++)for(l=0;l<i;l++)c[d++]=h[o=(s+n)*u.columns+(l+t)]*u.slope+u.intercept;return c}},"./util/getMaxSimultaneousRequests.js":function(e,t,n){"use strict";var r;n.r(t),n.d(t,"getDefaultSimultaneousRequests",(function(){return l})),n.d(t,"getMaxSimultaneousRequests",(function(){return s})),n.d(t,"setMaxSimultaneousRequests",(function(){return o})),n.d(t,"getBrowserInfo",(function(){return a})),n.d(t,"isMobileDevice",(function(){return u}));var i={default:6,IE:{9:6,10:8,default:8},Firefox:{default:6},Opera:{10:8,11:6,12:6,default:6},Chrome:{default:6},Safari:{default:6}};function a(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE ".concat(e[1]||"")):"Chrome"===n[1]&&null!==(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(" "))}function o(e){r=e}function s(){return r||l()}function l(){var e=a().split(" "),t=e[1],n=i[e[0]];return n?n[t]?n[t]:n.default:i.default}function u(){return new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)}},"./util/getPixelSpacing.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./externalModules.js");function i(e){var t=r.default.cornerstone.metaData.get("imagePlaneModule",e.imageId);return t?{rowPixelSpacing:t.rowPixelSpacing||t.rowImagePixelSpacing,colPixelSpacing:t.columnPixelSpacing||t.colImagePixelSpacing}:{rowPixelSpacing:e.rowPixelSpacing,colPixelSpacing:e.columnPixelSpacing}}},"./util/getRGBPixels.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t,n,i,a){if(!e)throw new Error("getRGBPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var o,s,l,u=r.default.cornerstone.getEnabledElement(e),c=[],d=0,h=u.image.getPixelData();if(u.image.color)for(s=0;s<a;s++)for(l=0;l<i;l++){var f=h[1+(o=4*((s+n)*u.image.columns+(l+t)))],p=h[o+2],m=h[o+3];c[d++]=h[o],c[d++]=f,c[d++]=p,c[d++]=m}return c}},"./util/getROITextBoxCoords.js":function(e,t,n){"use strict";function r(e,t){var n=function(e){var t=[e.start,e.end].sort((function(e,t){return e.x<t.x?-1:1})),n=[e.start,e.end].sort((function(e,t){return e.y<t.y?-1:1}));return{top:n[0],left:t[0],bottom:n[n.length-1],right:t[t.length-1]}}(t),r=(n.left.x+n.right.x)/2,i=(n.top.y+n.bottom.y)/2,a={};return e.rotation>=0&&e.rotation<90&&(a.x=e.hflip?n.left.x:n.right.x,a.y=i),e.rotation>=90&&e.rotation<180&&(a.x=r,a.y=e.vflip?n.bottom.y:n.top.y),e.rotation>=180&&e.rotation<270&&(a.x=e.hflip?n.right.x:n.left.x,a.y=i),e.rotation>=270&&e.rotation<360&&(a.x=r,a.y=e.vflip?n.top.y:n.bottom.y),a}n.r(t),n.d(t,"default",(function(){return r}))},"./util/isEmptyObject.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){return 0===Object.keys(e).length&&e.constructor===Object}},"./util/isObject.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/typeof.js"),i=n.n(r);t.default=function(e){var t=i()(e);return null!==e&&("object"===t||"function"===t)}},"./util/isPointInImage.js":function(e,t,n){"use strict";function r(e,t,n){var r=e.x,i=e.y;return r<n&&r>=0&&i<t&&i>=0}n.r(t),n.d(t,"default",(function(){return r}))},"./util/isPointInPolygon.js":function(e,t,n){"use strict";function r(e,t){for(var n=e[0],r=e[1],i=!1,a=0,o=t.length-1;a<t.length;o=a++){var s=t[a][0],l=t[a][1],u=t[o][1];l>r!=u>r&&n<(t[o][0]-s)*(r-l)/(u-l)+s&&(i=!i)}return i}n.r(t),n.d(t,"default",(function(){return r}))},"./util/lineSegDistance.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t,n,i){var a=r.default.cornerstone,o={start:a.pixelToCanvas(e,t),end:a.pixelToCanvas(e,n)};return r.default.cornerstoneMath.lineSegment.distanceToPoint(o,i)}},"./util/logger.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getLogger",(function(){return o})),n.d(t,"enable",(function(){return s})),n.d(t,"disable",(function(){return l}));var r=n("./util/debugLib/index.js"),i="cornerstoneTools",a=Object(r.default)(i);a.enabled||(console.log("%cCornerstone Tools","background: #339955; padding: 4px; font-weight: bold; color: white"),console.info('run %clocalStorage.setItem("debug", "cornerstoneTools")%c to see console output',"background: #eaeaea; color: #333; font-family: monospace",""));var o=function(e){return{log:a.extend(e),warn:console.warn.bind(console),error:console.error.bind(console)}},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"".concat(i,":*");return r.default.enable(e)},l=function(){return r.default.disable()}},"./util/makeUnselectable.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){e.style.webkitUserSelect="none",e.style.webkitTouchCallout="none",e.style.mozUserSelect="none",e.style.msUserSelect="none",e.style.oUserSelect="none",e.style.khtmlUserSelect="none",e.style.userSelect="none",e.unselectable="on",e.oncontextmenu=function(){return!1},!0===t&&(e.style.pointerEvents="none")}},"./util/numbersWithCommas.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}},"./util/pointInsideBoundingBox.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t){if(e.boundingBox)return r.default.cornerstoneMath.point.insideRect(t,e.boundingBox)}},"./util/pointProjector.js":function(e,t,n){"use strict";n.r(t),n.d(t,"projectPatientPointToImagePlane",(function(){return a})),n.d(t,"imagePointToPatientPoint",(function(){return o})),n.d(t,"planePlaneIntersection",(function(){return s})),n.d(t,"rotatePoint",(function(){return l}));var r=n("./externalModules.js"),i=n("./util/convertToVector3.js");function a(e,t){var n=Object(i.default)(t.rowCosines),r=Object(i.default)(t.columnCosines),a=Object(i.default)(t.imagePositionPatient),o=e.clone().sub(a);return{x:n.dot(o)/t.columnPixelSpacing,y:r.dot(o)/t.rowPixelSpacing}}function o(e,t){var n=Object(i.default)(t.rowCosines),r=Object(i.default)(t.columnCosines),a=Object(i.default)(t.imagePositionPatient),o=n.clone().multiplyScalar(e.x);o.multiplyScalar(t.columnPixelSpacing);var s=r.clone().multiplyScalar(e.y);s.multiplyScalar(t.rowPixelSpacing);var l=o.add(s);return l.add(a),l}function s(e,t){var n=Object(i.default)(e.rowCosines),a=Object(i.default)(e.columnCosines),s=Object(i.default)(e.imagePositionPatient),l=Object(i.default)(t.rowCosines),u=Object(i.default)(t.columnCosines),c=Object(i.default)(t.imagePositionPatient),d=n.clone().cross(a),h=new r.default.cornerstoneMath.Plane;h.setFromNormalAndCoplanarPoint(d,s);var f=l.clone().cross(u),p=new r.default.cornerstoneMath.Plane;p.setFromNormalAndCoplanarPoint(f,c);var m=p.clone().intersectPlane(h),g=m.origin,v=m.direction,y=o({x:t.columns,y:t.rows},t),b=c.distanceTo(y),x=new r.default.cornerstoneMath.Line3;x.start=g,x.end=g.clone().add(v.multiplyScalar(b));var w=function(e,t){var n=[];return Object.keys(t).forEach((function(r){var i=e.intersectLine(t[r]);i&&n.push(i)})),n}(x,function(e){var t=o({x:0,y:0},e),n=o({x:e.columns,y:0},e),i=o({x:0,y:e.rows},e),a=o({x:e.columns,y:e.rows},e);return{top:new r.default.cornerstoneMath.Line3(t,n),left:new r.default.cornerstoneMath.Line3(t,i),right:new r.default.cornerstoneMath.Line3(n,a),bottom:new r.default.cornerstoneMath.Line3(i,a)}}(t));if(2===w.length)return{start:w[0],end:w[1]}}function l(e,t,n){var r=n*(Math.PI/180);return{x:Math.cos(r)*(e.x-t.x)-Math.sin(r)*(e.y-t.y)+t.x,y:Math.sin(r)*(e.x-t.x)+Math.cos(r)*(e.y-t.y)+t.y}}},"./util/roundToDecimal.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}},"./util/scroll.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/scrollToIndex.js"),i=n("./stateManagement/toolState.js"),a=n("./util/clip.js"),o=n("./externalModules.js");function s(e,t,n){if(e.pending[0]===t){if(e.currentImageIdIndex===t.index)return e.pending.splice(e.pending.indexOf(t),1),void(e.pending.length>0&&s(e,e.pending[0],n));n.addEventListener(o.default.cornerstone.EVENTS.NEW_IMAGE,(function r(i){e.imageIds.indexOf(i.detail.image.imageId)===t.index&&(e.pending.splice(e.pending.indexOf(t),1),n.removeEventListener(o.default.cornerstone.EVENTS.NEW_IMAGE,r),e.pending.length>0&&s(e,e.pending[0],n))})),Object(r.default)(n,t.index)}}t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],l=Object(i.getToolState)(e,"stack");if(l&&l.data&&l.data.length){var u=l.data[0];u.pending||(u.pending=[]);var c=u.currentImageIdIndex+t;if(n){var d=u.imageIds.length;c%=d}else c=Object(a.default)(c,0,u.imageIds.length-1);if(o)Object(r.default)(e,c);else{var h={index:c};u.pending.push(h),s(u,h,e)}}}},"./util/scrollToIndex.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./externalModules.js"),a=n("./stateManagement/toolState.js"),o=n("./requestPool/requestPoolManager.js"),s=n("./stateManagement/loadHandlerManager.js"),l=n("./util/triggerEvent.js");t.default=function(e,t){var n=Object(a.getToolState)(e,"stack");if(n&&n.data&&n.data.length){var u,c=i.default.cornerstone;if(n.data.length>1){var d=Object(a.getToolState)(e,"stackRenderer");d&&d.data&&d.data.length&&(u=d.data[0])}var h=n.data[0];t<0&&(t+=h.imageIds.length);var f=s.default.getStartLoadHandler(e),p=s.default.getEndLoadHandler(e),m=s.default.getErrorLoadingHandler(e);if(t!==h.currentImageIdIndex){f&&f(e);var g={newImageIdIndex:t,direction:t-h.currentImageIdIndex};h.currentImageIdIndex=t;var v=h.imageIds[t];(Boolean(h.preventCache)?c.loadImage(v):c.loadAndCacheImage(v)).then((function(r){if(h.currentImageIdIndex===t){try{c.getEnabledElement(e)}catch(i){return}u?(u.currentImageIdIndex=t,u.render(e,n.data)):c.displayImage(e,r),p&&p(e,r)}}),(function(n){m&&m(e,h.imageIds[t],n)})),o.default.startGrabbing(),Object(l.default)(e,r.default.STACK_SCROLL,g)}}}},"./util/segmentation/drawBrush.js":function(e,t,n){"use strict";n.r(t),n.d(t,"drawBrushPixels",(function(){return o}));var r=n("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=n.n(r),a=n("./util/segmentation/eraseIfSegmentIndex.js");function o(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=function(e,t){return t*r+e};e.forEach((function(e){var r=s.apply(void 0,i()(e));o?Object(a.default)(r,t,n):t[r]=n}))}},"./util/segmentation/eraseIfSegmentIndex.js":function(e,t,n){"use strict";function r(e,t,n){t[e]===n&&(t[e]=0)}n.r(t),n.d(t,"default",(function(){return r}))},"./util/segmentation/eraseOutsideBoundingBox.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./util/segmentation/eraseIfSegmentIndex.js");function i(e,t,n,i){for(var a=t.pixelData,o=t.segmentIndex,s=e.detail.image,l=s.width,u=s.height,c=0;c<l;c++)for(var d=0;d<n[1];d++)Object(r.default)(d*l+c,a,o);for(var h=0;h<n[0];h++)for(var f=n[1];f<i[1];f++)Object(r.default)(f*l+h,a,o);for(var p=i[0];p<l;p++)for(var m=n[1];m<i[1];m++)Object(r.default)(m*l+p,a,o);for(var g=0;g<l;g++)for(var v=i[1];v<u;v++)Object(r.default)(v*l+g,a,o)}},"./util/segmentation/eraseShape.js":function(e,t,n){"use strict";n.r(t),n.d(t,"eraseInsideShape",(function(){return u})),n.d(t,"eraseOutsideShape",(function(){return c}));var r=n("../node_modules/@babel/runtime/helpers/slicedToArray.js"),i=n.n(r),a=n("./util/segmentation/eraseOutsideBoundingBox.js"),o=n("./util/segmentation/isSameSegment.js"),s=n("./util/logger.js");function l(e,t,n,r,s){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"inside",u=e.detail.image.width,c=t.pixelData,d=t.segmentIndex,h=i()(r,2),f=h[0],p=h[1],m=i()(s,2),g=m[0],v=m[1];"outside"===l&&Object(a.default)(e,t,r,s);for(var y=f;y<g;y++)for(var b=p;b<v;b++){var x=b*u+y;Object(o.default)(x,c,d)&&n({x:y,y:b})&&(c[x]=0)}}function u(e,t,n,r,i){l(e,t,n,r,i,"inside")}function c(e,t,n,r,i){l(e,t,(function(e){return!n(e)}),r,i,"outside")}Object(s.getLogger)("util:segmentation:operations:eraseOutsideCircle")},"./util/segmentation/fillOutsideBoundingBox.js":function(e,t,n){"use strict";function r(e,t,n,r){for(var i=t.pixelData,a=t.segmentIndex,o=e.detail.image,s=o.width,l=o.height,u=0;u<s;u++)for(var c=0;c<n[1];c++)i[c*s+u]=a;for(var d=0;d<n[0];d++)for(var h=n[1];h<r[1];h++)i[h*s+d]=a;for(var f=r[0];f<s;f++)for(var p=n[1];p<r[1];p++)i[p*s+f]=a;for(var m=0;m<s;m++)for(var g=r[1];g<l;g++)i[g*s+m]=a}n.r(t),n.d(t,"default",(function(){return r}))},"./util/segmentation/fillShape.js":function(e,t,n){"use strict";n.r(t),n.d(t,"fillInsideShape",(function(){return u})),n.d(t,"fillOutsideShape",(function(){return c}));var r=n("../node_modules/@babel/runtime/helpers/slicedToArray.js"),i=n.n(r),a=n("./util/segmentation/fillOutsideBoundingBox.js"),o=n("./util/logger.js"),s=Object(o.getLogger)("util:segmentation:operations:helpers:fillShape");function l(e,t,n,r,o){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"inside",u=t.pixelData,c=t.segmentIndex;if(void 0!==u&&void 0!==c){var d=e.detail.image.width,h=i()(r,2),f=h[0],p=h[1],m=i()(o,2),g=m[0],v=m[1];"outside"===l&&Object(a.default)(e,t,r,o);for(var y=f;y<g;y++)for(var b=p;b<v;b++){var x=b*d+y;n({x:y,y:b})&&(u[x]=c)}}else s.error("fillInsideShape requires operationData to contain pixelData and segmentIndex")}function u(e,t,n,r,i){l(e,t,n,r,i,"inside")}function c(e,t,n,r,i){l(e,t,(function(e){return!n(e)}),r,i,"outside")}},"./util/segmentation/floodFill.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=n.n(r);function a(e,t){return e===t}function o(e){for(var t=0,n=0;n<e.length;n+=1)0!==e[n]&&(t+=1);return t}function s(e,t,n){return(new Array(n+1).join(t)+e).slice(-n)}t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.onFlood||function(){},l=n.onBoundary||function(){},u=n.equals||a,c=n.diagonals||!1,d=E(t),h=T(),f=[],p=[],m={},g={};for(f.push({currentArgs:t});f.length>0;)v(f.pop());return{flooded:p,boundaries:I()};function v(e){var t=e.currentArgs,n=e.previousArgs;y(t)||(b(t),x(t)?(w(t),k(t)):_(n))}function y(e){return!0===m[e]}function b(e){m[e]=!0}function x(e){var t=S(E,[e]);return S(u,[t,d])}function w(e){p.push(e),r.apply(void 0,i()(e))}function _(e){g[e]=e,l.apply(void 0,i()(e))}function k(e){for(var t=0;t<h.length;t+=1){for(var n=h[t],r=e.slice(0),i=0;i<e.length;i+=1)r[i]+=n[i];f.push({currentArgs:r,previousArgs:e})}}function E(t){return e.apply(void 0,i()(t))}function S(e,t){try{return e.apply(void 0,i()(t))}catch(n){return}}function T(){return C(t.length).filter((function(e){var t=o(e);return 0!==t&&(1===t||c)}))}function C(e){for(var t=[],n=function(e){return e.split("").map((function(e){return parseInt(e,10)-1}))},r=0;r<Math.pow(3,e);r+=1){var i=s(r.toString(3),"0",e);t.push(n(i))}return t}function I(){var e=[];for(var t in g)g.hasOwnProperty(t)&&e.unshift(g[t]);return e}}},"./util/segmentation/getBoundingBoxAroundCircle.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./util/getCircleCoords.js");function i(e){var t=e.detail.handles,n=e.detail.image,i=n.width,a=n.height,o=Object(r.default)(t.start,t.end),s=o.width+o.left,l=o.left,u=o.top+o.height,c=o.top;return l=Math.floor(l),c=Math.floor(c),s=Math.floor(s),u=Math.floor(u),s=Math.min(i,s),l=Math.max(0,l),u=Math.min(a,u),[[l,c=Math.max(0,c)],[s,u]]}},"./util/segmentation/getBoundingBoxAroundPolygon.js":function(e,t,n){"use strict";function r(e,t){var n=1/0,r=0,i=1/0,a=0,o=t.width,s=t.height;return e.forEach((function(e){n=Math.min(e[0],n),r=Math.max(e[0],r),i=Math.min(e[1],i),a=Math.max(e[1],a)})),n=Math.floor(n),i=Math.floor(i),r=Math.floor(r),a=Math.floor(a),r=Math.min(o,r),n=Math.max(0,n),a=Math.min(s,a),i=Math.max(0,i),[[n,i],[r,a]]}n.r(t),n.d(t,"default",(function(){return r}))},"./util/segmentation/getCircle.js":function(e,t,n){"use strict";function r(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=Math.floor(r),o=Math.floor(i);if(1===e)return[[a,o]];for(var s=[],l=0,u=-e;u<=e;u++){var c=o+u;if(!(c>t||c<0))for(var d=-e;d<=e;d++){var h=a+d;h>=n||h<0||d*d+u*u<e*e&&(s[l++]=[a+d,o+u])}}return s}n.r(t),n.d(t,"default",(function(){return r}))},"./util/segmentation/getDiffBetweenPixelData.js":function(e,t,n){"use strict";function r(e,t){for(var n=[],r=0;r<e.length;r++)e[r]!==t[r]&&n.push([r,e[r],t[r]]);return n}n.r(t),n.d(t,"default",(function(){return r}))},"./util/segmentation/getPixelPathBetweenPixels.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=1/Math.sqrt(2),a={up:{x:0,y:1},upRight:{x:i,y:i},right:{x:1,y:0},downRight:{x:i,y:-i},down:{x:0,y:1},downLeft:{x:-i,y:-i},left:{x:-1,y:0},upLeft:{x:-i,y:i}};function o(e,t){var n=c(e,t);switch(h([d(n,a.up),d(n,a.right),d(n,a.upRight)])){case 0:e.y++;break;case 1:e.x++;break;case 2:e.y++,e.x++}}function s(e,t){var n=c(e,t);switch(h([d(n,a.up),d(n,a.left),d(n,a.upLeft)])){case 0:e.y++;break;case 1:e.x--;break;case 2:e.y++,e.x--}}function l(e,t){var n=c(e,t);switch(h([d(n,a.down),d(n,a.right),d(n,a.downRight)])){case 0:e.y--;break;case 1:e.x++;break;case 2:e.y--,e.x++}}function u(e,t){var n=c(e,t);switch(h([d(n,a.down),d(n,a.left),d(n,a.downLeft)])){case 0:e.y--;break;case 1:e.x--;break;case 2:e.y--,e.x--}}function c(e,t){var n=r.default.cornerstoneMath.point.distance(e,t);return{x:(t.x-e.x)/n,y:(t.y-e.y)/n}}function d(e,t){return e.x*t.x+e.y*t.y}function h(e){var t=e[0]>e[1]?0:1;return e[2]>e[t]&&(t=2),t}t.default=function(e,t){for(var n={x:e.x,y:e.y},r=[];t.x!==n.x||t.y!==n.y;)t.x===n.x?t.y>n.y?n.y++:n.y--:t.y===n.y?t.x>n.x?n.x++:n.x--:t.y>n.y?t.x>n.x?o(n,t):s(n,t):t.x>n.x?l(n,t):u(n,t),r.push({x:n.x,y:n.y});return r.pop(),r}},"./util/segmentation/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/segmentation/drawBrush.js");n.d(t,"drawBrushPixels",(function(){return r.drawBrushPixels}));var i=n("./util/segmentation/eraseIfSegmentIndex.js");n.d(t,"eraseIfSegmentIndex",(function(){return i.default}));var a=n("./util/segmentation/eraseOutsideBoundingBox.js");n.d(t,"eraseOutsideBoundingBox",(function(){return a.default}));var o=n("./util/segmentation/eraseShape.js");n.d(t,"eraseInsideShape",(function(){return o.eraseInsideShape})),n.d(t,"eraseOutsideShape",(function(){return o.eraseOutsideShape}));var s=n("./util/segmentation/fillOutsideBoundingBox.js");n.d(t,"fillOutsideBoundingBox",(function(){return s.default}));var l=n("./util/segmentation/fillShape.js");n.d(t,"fillInsideShape",(function(){return l.fillInsideShape})),n.d(t,"fillOutsideShape",(function(){return l.fillOutsideShape}));var u=n("./util/segmentation/floodFill.js");n.d(t,"floodFill",(function(){return u.default}));var c=n("./util/segmentation/getBoundingBoxAroundCircle.js");n.d(t,"getBoundingBoxAroundCircle",(function(){return c.default}));var d=n("./util/segmentation/getBoundingBoxAroundPolygon.js");n.d(t,"getBoundingBoxAroundPolygon",(function(){return d.default}));var h=n("./util/segmentation/getCircle.js");n.d(t,"getCircle",(function(){return h.default}));var f=n("./util/segmentation/getPixelPathBetweenPixels.js");n.d(t,"getPixelPathBetweenPixels",(function(){return f.default}));var p=n("./util/segmentation/isSameSegment.js");n.d(t,"isSameSegment",(function(){return p.default}));var m=n("./util/segmentation/triggerLabelmapModifiedEvent.js");n.d(t,"triggerLabelmapModifiedEvent",(function(){return m.default}));var g=n("./util/segmentation/getDiffBetweenPixelData.js");n.d(t,"getDiffBetweenPixelData",(function(){return g.default}))},"./util/segmentation/isSameSegment.js":function(e,t,n){"use strict";function r(e,t,n){return t[e]===n}n.r(t),n.d(t,"default",(function(){return r}))},"./util/segmentation/triggerLabelmapModifiedEvent.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));var r=n("./externalModules.js"),i=n("./events.js"),a=n("./store/index.js");function o(e,t){var n=Object(a.getModule)("segmentation");t=void 0===t?n.getters.activeLabelmapIndex(e):t,r.default.cornerstone.triggerEvent(e,i.default.LABELMAP_MODIFIED,{labelmapIndex:t})}},"./util/setContextToDisplayFontSize.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t,n){var i=.1;return r.default.cornerstone.setToPixelCoordinateSystem(e,t,i),{fontSize:n/e.viewport.scale/i,lineHeight:n/e.viewport.scale/i,fontScale:i}}},"./util/throttle.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/debounce.js"),i=n("./util/isObject.js");t.default=function(e,t,n){var a=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Object(i.default)(n)&&(a="leading"in n?Boolean(n.leading):a,o="trailing"in n?Boolean(n.trailing):o),Object(r.default)(e,t,{leading:a,trailing:o,maxWait:t})}},"./util/triggerEvent.js":function(e,t,n){"use strict";function r(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:r,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,r),e.dispatchEvent(n)}n.r(t),n.d(t,"default",(function(){return r}))},"./util/uuidv4.js":function(e,t,n){"use strict";function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}n.r(t),n.d(t,"default",(function(){return r}))},"./util/wait.js":function(e,t,n){"use strict";n.r(t),n.d(t,"wait",(function(){return i})),n.d(t,"waitForEnabledElementImageToLoad",(function(){return a}));var r=n("./externalModules.js"),i=function(e){return new Promise((function(t){return setTimeout(t,e)}))};function a(e){try{var t=r.default.cornerstone.getEnabledElement(e);return t.image?t:i(250).then((function(){return a(e)}))}catch(n){return null}}t.default=i},"./util/zoom/changeViewportScale.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){var r=n.maxScale,i=n.minScale,a=Math.log(e.scale)/Math.log(1.7),o=Math.pow(1.7,a+t);return e.scale=r&&o>r?r:i&&o<i?i:o,e}},"./util/zoom/correctShift.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=t.vflip,r=t.rotation;if(e.x*=t.hflip?-1:1,e.y*=n?-1:1,0!==r){var i=r*Math.PI/180,a=Math.cos(i),o=Math.sin(i),s=e.x*o+e.y*a;e.x=e.x*a-e.y*o,e.y=s}return e}},"./util/zoom/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/zoom/changeViewportScale.js");n.d(t,"changeViewportScale",(function(){return r.default}));var i=n("./util/zoom/correctShift.js");n.d(t,"correctShift",(function(){return i.default})),t.default={changeViewportScale:r.default,correctShift:i.default}},"./version.js":function(e,t,n){"use strict";n.r(t),t.default="4.22.1"}})},e.exports=r()},6:function(e,t){},7:function(e,t){},"7sNm":function(e,t,n){const r=n("8GxW");e.exports=(e,t,n)=>r(e,t,n)>0},8:function(e,t){},"8GxW":function(e,t,n){const r=n("3wIk");e.exports=(e,t,n)=>new r(e,n).compare(new r(t,n))},"8YLp":function(e,t,n){const r=n("8GxW");e.exports=(e,t)=>r(e,t,!0)},9:function(e,t){},"9x6x":function(e,t,n){"use strict";e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n,r="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(n=t.cmp,function(e){return function(t,r){return n({key:t,value:e[t]},{key:r,value:e[r]})}}),a=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var n,o;if(Array.isArray(t)){for(o="[",n=0;n<t.length;n++)n&&(o+=","),o+=e(t[n])||"null";return o+"]"}if(null===t)return"null";if(-1!==a.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=a.push(t)-1,l=Object.keys(t).sort(i&&i(t));for(o="",n=0;n<l.length;n++){var u=l[n],c=e(t[u]);c&&(o&&(o+=","),o+=JSON.stringify(u)+":"+c)}return a.splice(s,1),"{"+o+"}"}}(e)}},B9Yq:function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},Br5v:function(e,t,n){const r=n("3wIk");e.exports=(e,t)=>new r(e,t).major},DXxi:function(e,t){const n="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=n},Dknc:function(e,t,n){const r=n("8GxW");e.exports=(e,t,n)=>r(e,t,n)>=0},EhIR:function(e,t,n){(function(e){var r;!function(e,i,a){function o(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function l(e,t){var n=new o(e),r=t&&t.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(t,n,t,i))||(i.exports=r):this.alea=l}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},HwNo:function(e,t,n){"use strict";e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},HyWp:function(e,t,n){"use strict";const r=n("XPeR"),i=Symbol("max"),a=Symbol("length"),o=Symbol("lengthCalculator"),s=Symbol("allowStale"),l=Symbol("maxAge"),u=Symbol("dispose"),c=Symbol("noDisposeOnSet"),d=Symbol("lruList"),h=Symbol("cache"),f=Symbol("updateAgeOnGet"),p=()=>1,m=(e,t,n)=>{const r=e[h].get(t);if(r){const t=r.value;if(g(e,t)){if(y(e,r),!e[s])return}else n&&(e[f]&&(r.value.now=Date.now()),e[d].unshiftNode(r));return t.value}},g=(e,t)=>{if(!t||!t.maxAge&&!e[l])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[l]&&n>e[l]},v=e=>{if(e[a]>e[i])for(let t=e[d].tail;e[a]>e[i]&&null!==t;){const n=t.prev;y(e,t),t=n}},y=(e,t)=>{if(t){const n=t.value;e[u]&&e[u](n.key,n.value),e[a]-=n.length,e[h].delete(n.key),e[d].removeNode(t)}};class b{constructor(e,t,n,r,i){this.key=e,this.value=t,this.length=n,this.now=r,this.maxAge=i||0}}const x=(e,t,n,r)=>{let i=n.value;g(e,i)&&(y(e,n),e[s]||(i=void 0)),i&&t.call(r,i.value,i.key,e)};e.exports=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[i]=e.max||1/0;const t=e.length||p;if(this[o]="function"!=typeof t?p:t,this[s]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[l]=e.maxAge||0,this[u]=e.dispose,this[c]=e.noDisposeOnSet||!1,this[f]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[i]=e||1/0,v(this)}get max(){return this[i]}set allowStale(e){this[s]=!!e}get allowStale(){return this[s]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[l]=e,v(this)}get maxAge(){return this[l]}set lengthCalculator(e){"function"!=typeof e&&(e=p),e!==this[o]&&(this[o]=e,this[a]=0,this[d].forEach(e=>{e.length=this[o](e.value,e.key),this[a]+=e.length})),v(this)}get lengthCalculator(){return this[o]}get length(){return this[a]}get itemCount(){return this[d].length}rforEach(e,t){t=t||this;for(let n=this[d].tail;null!==n;){const r=n.prev;x(this,e,n,t),n=r}}forEach(e,t){t=t||this;for(let n=this[d].head;null!==n;){const r=n.next;x(this,e,n,t),n=r}}keys(){return this[d].toArray().map(e=>e.key)}values(){return this[d].toArray().map(e=>e.value)}reset(){this[u]&&this[d]&&this[d].length&&this[d].forEach(e=>this[u](e.key,e.value)),this[h]=new Map,this[d]=new r,this[a]=0}dump(){return this[d].map(e=>!g(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[d]}set(e,t,n){if((n=n||this[l])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const r=n?Date.now():0,s=this[o](t,e);if(this[h].has(e)){if(s>this[i])return y(this,this[h].get(e)),!1;const o=this[h].get(e).value;return this[u]&&(this[c]||this[u](e,o.value)),o.now=r,o.maxAge=n,o.value=t,this[a]+=s-o.length,o.length=s,this.get(e),v(this),!0}const f=new b(e,t,s,r,n);return f.length>this[i]?(this[u]&&this[u](e,t),!1):(this[a]+=f.length,this[d].unshift(f),this[h].set(e,this[d].head),v(this),!0)}has(e){if(!this[h].has(e))return!1;const t=this[h].get(e).value;return!g(this,t)}get(e){return m(this,e,!0)}peek(e){return m(this,e,!1)}pop(){const e=this[d].tail;return e?(y(this,e),e.value):null}del(e){y(this,this[h].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const r=e[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{const e=i-t;e>0&&this.set(r.k,r.v,e)}}}prune(){this[h].forEach((e,t)=>m(this,t,!1))}}},I9dd:function(e,t,n){const r=n("ex/Z"),{ANY:i}=n("vwDW"),a=n("MpxT"),o=n("8GxW"),s=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===i)return 1===t.length&&t[0].semver===i;const r=new Set;let s,c,d,h,f,p,m;for(const i of e)">"===i.operator||">="===i.operator?s=l(s,i,n):"<"===i.operator||"<="===i.operator?c=u(c,i,n):r.add(i.semver);if(r.size>1)return null;if(s&&c){if(d=o(s.semver,c.semver,n),d>0)return null;if(0===d&&(">="!==s.operator||"<="!==c.operator))return null}for(const i of r){if(s&&!a(i,String(s),n))return null;if(c&&!a(i,String(c),n))return null;for(const e of t)if(!a(i,String(e),n))return!1;return!0}for(const i of t){if(m=m||">"===i.operator||">="===i.operator,p=p||"<"===i.operator||"<="===i.operator,s)if(">"===i.operator||">="===i.operator){if(h=l(s,i,n),h===i&&h!==s)return!1}else if(">="===s.operator&&!a(s.semver,String(i),n))return!1;if(c)if("<"===i.operator||"<="===i.operator){if(f=u(c,i,n),f===i&&f!==c)return!1}else if("<="===c.operator&&!a(c.semver,String(i),n))return!1;if(!i.operator&&(c||s)&&0!==d)return!1}return!(s&&p&&!c&&0!==d||c&&m&&!s&&0!==d)},l=(e,t,n)=>{if(!e)return t;const r=o(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},u=(e,t,n)=>{if(!e)return t;const r=o(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,n)=>{if(e===t)return!0;e=new r(e,n),t=new r(t,n);let i=!1;e:for(const r of e.set){for(const e of t.set){const t=s(r,e,n);if(i=i||null!==t,t)continue e}if(i)return!1}return!0}},IsDc:function(e,t,n){const{MAX_SAFE_COMPONENT_LENGTH:r}=n("/kWe"),i=n("DXxi"),a=(t=e.exports={}).re=[],o=t.src=[],s=t.t={};let l=0;const u=(e,t,n)=>{const r=l++;i(r,t),s[e]=r,o[r]=t,a[r]=new RegExp(t,n?"g":void 0)};u("NUMERICIDENTIFIER","0|[1-9]\\d*"),u("NUMERICIDENTIFIERLOOSE","[0-9]+"),u("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),u("MAINVERSION",`(${o[s.NUMERICIDENTIFIER]})\\.(${o[s.NUMERICIDENTIFIER]})\\.(${o[s.NUMERICIDENTIFIER]})`),u("MAINVERSIONLOOSE",`(${o[s.NUMERICIDENTIFIERLOOSE]})\\.(${o[s.NUMERICIDENTIFIERLOOSE]})\\.(${o[s.NUMERICIDENTIFIERLOOSE]})`),u("PRERELEASEIDENTIFIER",`(?:${o[s.NUMERICIDENTIFIER]}|${o[s.NONNUMERICIDENTIFIER]})`),u("PRERELEASEIDENTIFIERLOOSE",`(?:${o[s.NUMERICIDENTIFIERLOOSE]}|${o[s.NONNUMERICIDENTIFIER]})`),u("PRERELEASE",`(?:-(${o[s.PRERELEASEIDENTIFIER]}(?:\\.${o[s.PRERELEASEIDENTIFIER]})*))`),u("PRERELEASELOOSE",`(?:-?(${o[s.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${o[s.PRERELEASEIDENTIFIERLOOSE]})*))`),u("BUILDIDENTIFIER","[0-9A-Za-z-]+"),u("BUILD",`(?:\\+(${o[s.BUILDIDENTIFIER]}(?:\\.${o[s.BUILDIDENTIFIER]})*))`),u("FULLPLAIN",`v?${o[s.MAINVERSION]}${o[s.PRERELEASE]}?${o[s.BUILD]}?`),u("FULL",`^${o[s.FULLPLAIN]}$`),u("LOOSEPLAIN",`[v=\\s]*${o[s.MAINVERSIONLOOSE]}${o[s.PRERELEASELOOSE]}?${o[s.BUILD]}?`),u("LOOSE",`^${o[s.LOOSEPLAIN]}$`),u("GTLT","((?:<|>)?=?)"),u("XRANGEIDENTIFIERLOOSE",o[s.NUMERICIDENTIFIERLOOSE]+"|x|X|\\*"),u("XRANGEIDENTIFIER",o[s.NUMERICIDENTIFIER]+"|x|X|\\*"),u("XRANGEPLAIN",`[v=\\s]*(${o[s.XRANGEIDENTIFIER]})(?:\\.(${o[s.XRANGEIDENTIFIER]})(?:\\.(${o[s.XRANGEIDENTIFIER]})(?:${o[s.PRERELEASE]})?${o[s.BUILD]}?)?)?`),u("XRANGEPLAINLOOSE",`[v=\\s]*(${o[s.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[s.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[s.XRANGEIDENTIFIERLOOSE]})(?:${o[s.PRERELEASELOOSE]})?${o[s.BUILD]}?)?)?`),u("XRANGE",`^${o[s.GTLT]}\\s*${o[s.XRANGEPLAIN]}$`),u("XRANGELOOSE",`^${o[s.GTLT]}\\s*${o[s.XRANGEPLAINLOOSE]}$`),u("COERCE",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?(?:$|[^\\d])`),u("COERCERTL",o[s.COERCE],!0),u("LONETILDE","(?:~>?)"),u("TILDETRIM",`(\\s*)${o[s.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",u("TILDE",`^${o[s.LONETILDE]}${o[s.XRANGEPLAIN]}$`),u("TILDELOOSE",`^${o[s.LONETILDE]}${o[s.XRANGEPLAINLOOSE]}$`),u("LONECARET","(?:\\^)"),u("CARETTRIM",`(\\s*)${o[s.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",u("CARET",`^${o[s.LONECARET]}${o[s.XRANGEPLAIN]}$`),u("CARETLOOSE",`^${o[s.LONECARET]}${o[s.XRANGEPLAINLOOSE]}$`),u("COMPARATORLOOSE",`^${o[s.GTLT]}\\s*(${o[s.LOOSEPLAIN]})$|^$`),u("COMPARATOR",`^${o[s.GTLT]}\\s*(${o[s.FULLPLAIN]})$|^$`),u("COMPARATORTRIM",`(\\s*)${o[s.GTLT]}\\s*(${o[s.LOOSEPLAIN]}|${o[s.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",u("HYPHENRANGE",`^\\s*(${o[s.XRANGEPLAIN]})\\s+-\\s+(${o[s.XRANGEPLAIN]})\\s*$`),u("HYPHENRANGELOOSE",`^\\s*(${o[s.XRANGEPLAINLOOSE]})\\s+-\\s+(${o[s.XRANGEPLAINLOOSE]})\\s*$`),u("STAR","(<|>)?=?\\s*\\*"),u("GTE0","^\\s*>=\\s*0.0.0\\s*$"),u("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")},JBAE:function(e,t,n){var r=function(){"use strict";function e(e,t){return null!=t&&e instanceof t}var t,n,r;try{t=Map}catch(s){t=function(){}}try{n=Set}catch(s){n=function(){}}try{r=Promise}catch(s){r=function(){}}function i(a,s,l,u,c){"object"==typeof s&&(l=s.depth,u=s.prototype,c=s.includeNonEnumerable,s=s.circular);var d=[],h=[],f="undefined"!=typeof Buffer;return void 0===s&&(s=!0),void 0===l&&(l=1/0),function a(l,p){if(null===l)return null;if(0===p)return l;var m,g;if("object"!=typeof l)return l;if(e(l,t))m=new t;else if(e(l,n))m=new n;else if(e(l,r))m=new r((function(e,t){l.then((function(t){e(a(t,p-1))}),(function(e){t(a(e,p-1))}))}));else if(i.__isArray(l))m=[];else if(i.__isRegExp(l))m=new RegExp(l.source,o(l)),l.lastIndex&&(m.lastIndex=l.lastIndex);else if(i.__isDate(l))m=new Date(l.getTime());else{if(f&&Buffer.isBuffer(l))return m=Buffer.allocUnsafe?Buffer.allocUnsafe(l.length):new Buffer(l.length),l.copy(m),m;e(l,Error)?m=Object.create(l):void 0===u?(g=Object.getPrototypeOf(l),m=Object.create(g)):(m=Object.create(u),g=u)}if(s){var v=d.indexOf(l);if(-1!=v)return h[v];d.push(l),h.push(m)}for(var y in e(l,t)&&l.forEach((function(e,t){var n=a(t,p-1),r=a(e,p-1);m.set(n,r)})),e(l,n)&&l.forEach((function(e){var t=a(e,p-1);m.add(t)})),l){var b;g&&(b=Object.getOwnPropertyDescriptor(g,y)),b&&null==b.set||(m[y]=a(l[y],p-1))}if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(l);for(y=0;y<x.length;y++){var w=x[y];(!(k=Object.getOwnPropertyDescriptor(l,w))||k.enumerable||c)&&(m[w]=a(l[w],p-1),k.enumerable||Object.defineProperty(m,w,{enumerable:!1}))}}if(c){var _=Object.getOwnPropertyNames(l);for(y=0;y<_.length;y++){var k,E=_[y];(k=Object.getOwnPropertyDescriptor(l,E))&&k.enumerable||(m[E]=a(l[E],p-1),Object.defineProperty(m,E,{enumerable:!1}))}}return m}(a,l)}function a(e){return Object.prototype.toString.call(e)}function o(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return i.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},i.__objToStr=a,i.__isDate=function(e){return"object"==typeof e&&"[object Date]"===a(e)},i.__isArray=function(e){return"object"==typeof e&&"[object Array]"===a(e)},i.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===a(e)},i.__getRegExpFlags=o,i}();e.exports&&(e.exports=r)},JCZO:function(e,t,n){const r=n("8GxW");e.exports=(e,t,n)=>r(e,t,n)<0},KHQI:function(e,t){const n=/^[0-9]+$/,r=(e,t)=>{const r=n.test(e),i=n.test(t);return r&&i&&(e=+e,t=+t),e===t?0:r&&!i?-1:i&&!r?1:e<t?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},LJ9E:function(e,t,n){const r=n("3wIk");e.exports=(e,t)=>new r(e,t).patch},MpxT:function(e,t,n){const r=n("ex/Z");e.exports=(e,t,n)=>{try{t=new r(t,n)}catch(i){return!1}return t.test(e)}},Nm83:function(e,t,n){var r;r=function(){return function(e){var t=this.webpackHotUpdate_name_;this.webpackHotUpdate_name_=function(e,n){!function(e,t){if(x[e]&&b[e]){for(var n in b[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(p[n]=t[n]);0==--g&&0===v&&E()}}(e,n),t&&t(e,n)};var n,r=!0,i="c170bba28ef5906c081d",a={},o=[],s=[];function l(e){var t=T[e];if(!t)return C;var r=function(r){return t.hot.active?(T[r]?-1===T[r].parents.indexOf(e)&&T[r].parents.push(e):(o=[e],n=r),-1===t.children.indexOf(r)&&t.children.push(r)):(console.warn("[HMR] unexpected require("+r+") from disposed module "+e),o=[]),C(r)},i=function(e){return{configurable:!0,enumerable:!0,get:function(){return C[e]},set:function(t){C[e]=t}}};for(var a in C)Object.prototype.hasOwnProperty.call(C,a)&&"e"!==a&&"t"!==a&&Object.defineProperty(r,a,i(a));return r.e=function(e){return"ready"===d&&h("prepare"),v++,C.e(e).then(t,(function(e){throw t(),e}));function t(){v--,"prepare"===d&&(y[e]||k(e),0===v&&0===g&&E())}},r.t=function(e,t){return 1&t&&(e=r(e)),C.t(e,-2&t)},r}function u(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:n!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var r=0;r<e.length;r++)t._acceptedDependencies[e[r]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:_,apply:S,status:function(e){if(!e)return d;c.push(e)},addStatusHandler:function(e){c.push(e)},removeStatusHandler:function(e){var t=c.indexOf(e);t>=0&&c.splice(t,1)},data:a[e]};return n=void 0,t}var c=[],d="idle";function h(e){d=e;for(var t=0;t<c.length;t++)c[t].call(null,e)}var f,p,m,g=0,v=0,y={},b={},x={};function w(e){return+e+""===e?+e:e}function _(e){if("idle"!==d)throw new Error("check() is only allowed in idle status");return r=e,h("check"),(t=1e4,t=t||1e4,new Promise((function(e,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var r=new XMLHttpRequest,a=C.p+""+i+".hot-update.json";r.open("GET",a,!0),r.timeout=t,r.send(null)}catch(o){return n(o)}r.onreadystatechange=function(){if(4===r.readyState)if(0===r.status)n(new Error("Manifest request to "+a+" timed out."));else if(404===r.status)e();else if(200!==r.status&&304!==r.status)n(new Error("Manifest request to "+a+" failed."));else{try{var t=JSON.parse(r.responseText)}catch(i){return void n(i)}e(t)}}}))).then((function(e){if(!e)return h("idle"),null;b={},y={},x=e.c,m=e.h,h("prepare");var t=new Promise((function(e,t){f={resolve:e,reject:t}}));return p={},k("cornerstoneWADOImageLoader"),"prepare"===d&&0===v&&0===g&&E(),t}));var t}function k(e){x[e]?(b[e]=!0,g++,function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.charset="utf-8",n.src=C.p+""+e+"."+i+".hot-update.js",t.appendChild(n)}(e)):y[e]=!0}function E(){h("ready");var e=f;if(f=null,e)if(r)Promise.resolve().then((function(){return S(r)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var n in p)Object.prototype.hasOwnProperty.call(p,n)&&t.push(w(n));e.resolve(t)}}function S(t){if("ready"!==d)throw new Error("apply() is only allowed in ready status");var n,r,s,l,u;function c(e){for(var t=[e],n={},r=t.slice().map((function(e){return{chain:[e],id:e}}));r.length>0;){var i=r.pop(),a=i.id,o=i.chain;if((l=T[a])&&!l.hot._selfAccepted){if(l.hot._selfDeclined)return{type:"self-declined",chain:o,moduleId:a};if(l.hot._main)return{type:"unaccepted",chain:o,moduleId:a};for(var s=0;s<l.parents.length;s++){var u=l.parents[s],c=T[u];if(c){if(c.hot._declinedDependencies[a])return{type:"declined",chain:o.concat([u]),moduleId:a,parentId:u};-1===t.indexOf(u)&&(c.hot._acceptedDependencies[a]?(n[u]||(n[u]=[]),f(n[u],[a])):(delete n[u],t.push(u),r.push({chain:o.concat([u]),id:u})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];-1===e.indexOf(r)&&e.push(r)}}t=t||{};var g={},v=[],y={},b=function(){console.warn("[HMR] unexpected require("+k.moduleId+") to disposed module")};for(var _ in p)if(Object.prototype.hasOwnProperty.call(p,_)){var k;u=w(_);var E=!1,S=!1,I=!1,A="";switch((k=p[_]?c(u):{type:"disposed",moduleId:_}).chain&&(A="\nUpdate propagation: "+k.chain.join(" -> ")),k.type){case"self-declined":t.onDeclined&&t.onDeclined(k),t.ignoreDeclined||(E=new Error("Aborted because of self decline: "+k.moduleId+A));break;case"declined":t.onDeclined&&t.onDeclined(k),t.ignoreDeclined||(E=new Error("Aborted because of declined dependency: "+k.moduleId+" in "+k.parentId+A));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(k),t.ignoreUnaccepted||(E=new Error("Aborted because "+u+" is not accepted"+A));break;case"accepted":t.onAccepted&&t.onAccepted(k),S=!0;break;case"disposed":t.onDisposed&&t.onDisposed(k),I=!0;break;default:throw new Error("Unexception type "+k.type)}if(E)return h("abort"),Promise.reject(E);if(S)for(u in y[u]=p[u],f(v,k.outdatedModules),k.outdatedDependencies)Object.prototype.hasOwnProperty.call(k.outdatedDependencies,u)&&(g[u]||(g[u]=[]),f(g[u],k.outdatedDependencies[u]));I&&(f(v,[k.moduleId]),y[u]=b)}var O,D=[];for(r=0;r<v.length;r++)T[u=v[r]]&&T[u].hot._selfAccepted&&D.push({module:u,errorHandler:T[u].hot._selfAccepted});h("dispose"),Object.keys(x).forEach((function(e){!1===x[e]&&function(e){delete installedChunks[e]}(e)}));for(var M,N=v.slice();N.length>0;)if(u=N.pop(),l=T[u]){var j={},F=l.hot._disposeHandlers;for(s=0;s<F.length;s++)(n=F[s])(j);for(a[u]=j,l.hot.active=!1,delete T[u],delete g[u],s=0;s<l.children.length;s++){var R=T[l.children[s]];R&&(O=R.parents.indexOf(u))>=0&&R.parents.splice(O,1)}}for(u in g)if(Object.prototype.hasOwnProperty.call(g,u)&&(l=T[u]))for(M=g[u],s=0;s<M.length;s++)(O=l.children.indexOf(M[s]))>=0&&l.children.splice(O,1);for(u in h("apply"),i=m,y)Object.prototype.hasOwnProperty.call(y,u)&&(e[u]=y[u]);var P=null;for(u in g)if(Object.prototype.hasOwnProperty.call(g,u)&&(l=T[u])){M=g[u];var L=[];for(r=0;r<M.length;r++)if(n=l.hot._acceptedDependencies[M[r]]){if(-1!==L.indexOf(n))continue;L.push(n)}for(r=0;r<L.length;r++){n=L[r];try{n(M)}catch($){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:u,dependencyId:M[r],error:$}),t.ignoreErrored||P||(P=$)}}}for(r=0;r<D.length;r++){var B=D[r];o=[u=B.module];try{C(u)}catch($){if("function"==typeof B.errorHandler)try{B.errorHandler($)}catch(z){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:u,error:z,originalError:$}),t.ignoreErrored||P||(P=z),P||(P=$)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:u,error:$}),t.ignoreErrored||P||(P=$)}}return P?(h("fail"),Promise.reject(P)):(h("idle"),new Promise((function(e){e(v)})))}var T={};function C(t){if(T[t])return T[t].exports;var n=T[t]={i:t,l:!1,exports:{},hot:u(t),parents:(s=o,o=[],s),children:[]};return e[t].call(n.exports,n,n.exports,l(t)),n.l=!0,n.exports}return C.m=e,C.c=T,C.d=function(e,t,n){C.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},C.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},C.t=function(e,t){if(1&t&&(e=C(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(C.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)C.d(n,r,(function(t){return e[t]}).bind(null,r));return n},C.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return C.d(t,"a",t),t},C.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},C.p="",C.h=function(){return i},l("./imageLoader/index.js")(C.s="./imageLoader/index.js")}({"./externalModules.js":function(e,t,n){"use strict";n.r(t);var r,i,a=n("./imageLoader/registerLoaders.js");t.default={set cornerstone(e){r=e,Object(a.default)(r)},get cornerstone(){if(!r){if(!window||!window.cornerstone)throw new Error("cornerstoneWADOImageLoader requires a copy of Cornerstone to work properly. Please add cornerstoneWADOImageLoader.external.cornerstone = cornerstone; to your application.");r=window.cornerstone,Object(a.default)(r)}return r},set dicomParser(e){i=e},get dicomParser(){if(!i){if(!window||!window.dicomParser)throw new Error("cornerstoneWADOImageLoader requires a copy of dicomParser to work properly. Please add cornerstoneWADOImageLoader.external.dicomParser = dicomParser; to your application.");i=window.dicomParser}return i}}},"./imageLoader/colorSpaceConverters/convertPALETTECOLOR.js":function(e,t,n){"use strict";function r(e,t){for(var n=e.length,r=new Uint8ClampedArray(n),i=0;i<n;++i)r[i]=e[i]>>t;return r}n.r(t),t.default=function(e,t){for(var n=e.columns*e.rows,i=e.pixelData,a=e.greenPaletteColorLookupTableData,o=e.bluePaletteColorLookupTableData,s=e.redPaletteColorLookupTableData.length,l=0,u=0,c=e.redPaletteColorLookupTableDescriptor[1],d=8===e.redPaletteColorLookupTableDescriptor[2]?0:8,h=r(e.redPaletteColorLookupTableData,d),f=r(a,d),p=r(o,d),m=0;m<n;++m){var g=i[l++];g<c?g=0:g>c+s-1?g=s-1:g-=c,t[u++]=h[g],t[u++]=f[g],t[u++]=p[g],t[u++]=255}}},"./imageLoader/colorSpaceConverters/convertRGBColorByPixel.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if(void 0===e)throw new Error("decodeRGB: rgbBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: rgbBuffer length must be divisible by 3");for(var n=e.length/3,r=0,i=0,a=0;a<n;a++)t[i++]=e[r++],t[i++]=e[r++],t[i++]=e[r++],t[i++]=255}},"./imageLoader/colorSpaceConverters/convertRGBColorByPlane.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if(void 0===e)throw new Error("decodeRGB: rgbBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: rgbBuffer length must be divisible by 3");for(var n=e.length/3,r=0,i=0,a=n,o=2*n,s=0;s<n;s++)t[r++]=e[i++],t[r++]=e[a++],t[r++]=e[o++],t[r++]=255}},"./imageLoader/colorSpaceConverters/convertYBRFullByPixel.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");for(var n=e.length/3,r=0,i=0,a=0;a<n;a++){var o=e[r++],s=e[r++],l=e[r++];t[i++]=o+1.402*(l-128),t[i++]=o-.34414*(s-128)-.71414*(l-128),t[i++]=o+1.772*(s-128),t[i++]=255}}},"./imageLoader/colorSpaceConverters/convertYBRFullByPlane.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");for(var n=e.length/3,r=0,i=0,a=n,o=2*n,s=0;s<n;s++){var l=e[i++],u=e[a++],c=e[o++];t[r++]=l+1.402*(c-128),t[r++]=l-.34414*(u-128)-.71414*(c-128),t[r++]=l+1.772*(u-128),t[r++]=255}}},"./imageLoader/colorSpaceConverters/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/colorSpaceConverters/convertRGBColorByPixel.js");n.d(t,"convertRGBColorByPixel",(function(){return r.default}));var i=n("./imageLoader/colorSpaceConverters/convertRGBColorByPlane.js");n.d(t,"convertRGBColorByPlane",(function(){return i.default}));var a=n("./imageLoader/colorSpaceConverters/convertYBRFullByPixel.js");n.d(t,"convertYBRFullByPixel",(function(){return a.default}));var o=n("./imageLoader/colorSpaceConverters/convertYBRFullByPlane.js");n.d(t,"convertYBRFullByPlane",(function(){return o.default}));var s=n("./imageLoader/colorSpaceConverters/convertPALETTECOLOR.js");n.d(t,"convertPALETTECOLOR",(function(){return s.default}))},"./imageLoader/configure.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/internal/index.js");t.default=function(e){Object(r.setOptions)(e)}},"./imageLoader/convertColorSpace.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=n("./imageLoader/colorSpaceConverters/index.js");function i(e,t){0===e.planarConfiguration?Object(r.convertRGBColorByPixel)(e.pixelData,t):Object(r.convertRGBColorByPlane)(e.pixelData,t)}function a(e,t){var n=t.data;if("RGB"===e.photometricInterpretation)i(e,n);else if("YBR_RCT"===e.photometricInterpretation)i(e,n);else if("YBR_ICT"===e.photometricInterpretation)i(e,n);else if("PALETTE COLOR"===e.photometricInterpretation)Object(r.convertPALETTECOLOR)(e,n);else if("YBR_FULL_422"===e.photometricInterpretation)i(e,n);else{if("YBR_FULL"!==e.photometricInterpretation)throw new Error("No color space conversion for photometric interpretation ".concat(e.photometricInterpretation));!function(e,t){0===e.planarConfiguration?Object(r.convertYBRFullByPixel)(e.pixelData,t):Object(r.convertYBRFullByPlane)(e.pixelData,t)}(e,n)}}},"./imageLoader/createImage.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./imageLoader/getImageFrame.js"),a=n("./imageLoader/decodeImageFrame.js"),o=n("./imageLoader/isColorImage.js"),s=n("./imageLoader/convertColorSpace.js"),l=n("./shared/getMinMax.js"),u=n("./imageLoader/isJPEGBaseline8BitColor.js"),c="";t.default=function(e,t,n,d){if(!t||!t.length)return Promise.reject(new Error("The file does not contain image data."));var h=r.default.cornerstone,f=document.createElement("canvas"),p=Object(i.default)(e),m=Object(a.default)(p,n,t,f,d);return new Promise((function(t,r){m.then((function(r){var i=h.metaData.get("imagePlaneModule",e)||{},a=h.metaData.get("voiLutModule",e)||{},d=h.metaData.get("modalityLutModule",e)||{},p=h.metaData.get("sopCommonModule",e)||{},m=Object(o.default)(r.photometricInterpretation);if(!Object(u.default)(r,n)&&(function(e){e.pixelData=32===e.bitsAllocated?new Float32Array(e.pixelData):16===e.bitsAllocated?0===e.pixelRepresentation?new Uint16Array(e.pixelData):new Int16Array(e.pixelData):new Uint8Array(e.pixelData)}(r),m)){f.height=r.rows,f.width=r.columns;var g=f.getContext("2d").createImageData(r.columns,r.rows);Object(s.default)(r,g),r.imageData=g,r.pixelData=g.data;var v=Object(l.default)(r.pixelData);r.smallestPixelValue=v.min,r.largestPixelValue=v.max}var y,b={imageId:e,color:m,columnPixelSpacing:i.columnPixelSpacing,columns:r.columns,height:r.rows,intercept:d.rescaleIntercept?d.rescaleIntercept:0,invert:"MONOCHROME1"===r.photometricInterpretation,minPixelValue:r.smallestPixelValue,maxPixelValue:r.largestPixelValue,rowPixelSpacing:i.rowPixelSpacing,rows:r.rows,sizeInBytes:r.pixelData.length,slope:d.rescaleSlope?d.rescaleSlope:1,width:r.columns,windowCenter:a.windowCenter?a.windowCenter[0]:void 0,windowWidth:a.windowWidth?a.windowWidth[0]:void 0,decodeTimeInMS:r.decodeTimeInMS,floatPixelData:void 0};if(r.pixelData instanceof Float32Array){var x=r.pixelData,w=function(e){for(var t=Object(l.default)(e),n=Math.abs(t.max-t.min)/65535,r=t.min,i=e.length,a=new Uint16Array(i),o=65535,s=0,u=0;u<i;u++){var c=Math.floor((e[u]-r)/n);a[u]=c,o=Math.min(o,c),s=Math.max(s,c)}return{min:o,max:s,intPixelData:a,slope:n,intercept:r}}(x);b.minPixelValue=w.min,b.maxPixelValue=w.max,b.slope=w.slope,b.intercept=w.intercept,b.floatPixelData=x,b.getPixelData=function(){return w.intPixelData}}else b.getPixelData=function(){return r.pixelData};if(b.color&&(b.getCanvas=function(){return c===e||(f.height=b.rows,f.width=b.columns,f.getContext("2d").putImageData(r.imageData,0,0),c=e),f}),d.modalityLUTSequence&&d.modalityLUTSequence.length>0&&"1.2.840.10008.5.1.4.1.1.12.1"!==(y=p.sopClassUID)&&"1.2.840.10008.5.1.4.1.1.12.2.1"!==y&&(b.modalityLUT=d.modalityLUTSequence[0]),a.voiLUTSequence&&a.voiLUTSequence.length>0&&(b.voiLUT=a.voiLUTSequence[0]),b.color&&(b.windowWidth=255,b.windowCenter=127),void 0===b.windowCenter||void 0===b.windowWidth){var _=b.maxPixelValue*b.slope+b.intercept,k=b.minPixelValue*b.slope+b.intercept;b.windowWidth=_-k,b.windowCenter=(_+k)/2}t(b)}),r)}))}},"./imageLoader/decodeImageFrame.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/internal/options.js"),i=n("./imageLoader/webWorkerManager.js"),a=n("./imageLoader/decodeJPEGBaseline8BitColor.js"),o=n("./shared/decodeImageFrame.js"),s=n("./shared/calculateMinMax.js"),l=n("./shared/decoders/decodeJPEG2000.js"),u=n("./shared/decoders/decodeJPEGLS.js"),c=!1;function d(e,t,n,a){var d=a.priority||void 0,h=a.transferPixelData?[n.buffer]:void 0,f=Object(r.getOptions)(),p=f.strict,m=f.decodeConfig;return!1===f.useWebWorkers?(!1===c&&(Object(l.initializeJPEG2000)(m),Object(u.initializeJPEGLS)(m),c=!0),new Promise((function(r,i){try{var l=o.default.apply(void 0,[e,t,n,m,a]);Object(s.default)(l,p),r(l)}catch(u){i(u)}}))):i.default.addTask("decodeTask",{imageFrame:e,transferSyntax:t,pixelData:n,options:a},d,h).promise}t.default=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return"1.2.840.10008.1.2"===t||"1.2.840.10008.1.2.1"===t||"1.2.840.10008.1.2.2"===t||"1.2.840.10008.1.2.1.99"===t||"1.2.840.10008.1.2.5"===t?d(e,t,n,i):"1.2.840.10008.1.2.4.50"===t?8!==e.bitsAllocated||3!==e.samplesPerPixel&&4!==e.samplesPerPixel?d(e,t,n,i):Object(a.default)(e,n,r):"1.2.840.10008.1.2.4.51"===t||"1.2.840.10008.1.2.4.57"===t||"1.2.840.10008.1.2.4.70"===t||"1.2.840.10008.1.2.4.80"===t||"1.2.840.10008.1.2.4.81"===t||"1.2.840.10008.1.2.4.90"===t||"1.2.840.10008.1.2.4.91"===t?d(e,t,n,i):new Promise((function(e,n){n(new Error("No decoder for transfer syntax ".concat(t)))}))}},"./imageLoader/decodeJPEGBaseline8BitColor.js":function(e,t,n){"use strict";n.r(t);var r=n("./shared/getMinMax.js");t.default=function(e,t,n){var i=(new Date).getTime(),a=new Blob([t],{type:"image/jpeg"});return new Promise((function(t,o){var s=new FileReader;void 0===s.readAsBinaryString?s.readAsArrayBuffer(a):s.readAsBinaryString(a),s.onload=function(){var a=new Image;a.onload=function(){n.height=a.height,n.width=a.width,e.rows=a.height,e.columns=a.width;var o=n.getContext("2d");o.drawImage(this,0,0);var s=o.getImageData(0,0,a.width,a.height),l=(new Date).getTime();e.pixelData=s.data,e.imageData=s,e.decodeTimeInMS=l-i;var u=Object(r.default)(e.pixelData);e.smallestPixelValue=u.min,e.largestPixelValue=u.max,t(e)},a.onerror=function(e){o(e)},a.src="data:image/jpeg;base64,".concat(void 0===s.readAsBinaryString?window.btoa(function(e){var t;try{return decodeURIComponent(escape(e))}catch(n){if((t=n)instanceof URIError)return e;throw t}}(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(s.result))))):window.btoa(s.result))},s.onerror=function(e){o(e)}}))}},"./imageLoader/getImageFrame.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e){var t=r.default.cornerstone.metaData.get("imagePixelModule",e);return{samplesPerPixel:t.samplesPerPixel,photometricInterpretation:t.photometricInterpretation,planarConfiguration:t.planarConfiguration,rows:t.rows,columns:t.columns,bitsAllocated:t.bitsAllocated,bitsStored:t.bitsStored,pixelRepresentation:t.pixelRepresentation,smallestPixelValue:t.smallestPixelValue,largestPixelValue:t.largestPixelValue,redPaletteColorLookupTableDescriptor:t.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:t.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:t.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:t.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:t.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:t.bluePaletteColorLookupTableData,pixelData:void 0}}},"./imageLoader/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/colorSpaceConverters/index.js");n.d(t,"convertRGBColorByPixel",(function(){return r.convertRGBColorByPixel})),n.d(t,"convertRGBColorByPlane",(function(){return r.convertRGBColorByPlane})),n.d(t,"convertYBRFullByPixel",(function(){return r.convertYBRFullByPixel})),n.d(t,"convertYBRFullByPlane",(function(){return r.convertYBRFullByPlane})),n.d(t,"convertPALETTECOLOR",(function(){return r.convertPALETTECOLOR}));var i=n("./imageLoader/wadouri/index.js");n.d(t,"wadouri",(function(){return i.default}));var a=n("./imageLoader/wadors/index.js");n.d(t,"wadors",(function(){return a.default}));var o=n("./imageLoader/configure.js");n.d(t,"configure",(function(){return o.default}));var s=n("./imageLoader/convertColorSpace.js");n.d(t,"convertColorSpace",(function(){return s.default}));var l=n("./imageLoader/createImage.js");n.d(t,"createImage",(function(){return l.default}));var u=n("./imageLoader/decodeImageFrame.js");n.d(t,"decodeImageFrame",(function(){return u.default}));var c=n("./imageLoader/decodeJPEGBaseline8BitColor.js");n.d(t,"decodeJPEGBaseline8BitColor",(function(){return c.default}));var d=n("./imageLoader/getImageFrame.js");n.d(t,"getImageFrame",(function(){return d.default}));var h=n("./shared/getMinMax.js");n.d(t,"getMinMax",(function(){return h.default}));var f=n("./imageLoader/isColorImage.js");n.d(t,"isColorImage",(function(){return f.default}));var p=n("./imageLoader/isJPEGBaseline8BitColor.js");n.d(t,"isJPEGBaseline8BitColor",(function(){return p.default}));var m=n("./imageLoader/webWorkerManager.js");n.d(t,"webWorkerManager",(function(){return m.default}));var g=n("./version.js");n.d(t,"version",(function(){return g.default}));var v=n("./imageLoader/internal/index.js");n.d(t,"internal",(function(){return v.internal}));var y=n("./externalModules.js");n.d(t,"external",(function(){return y.default})),t.default={convertRGBColorByPixel:r.convertRGBColorByPixel,convertRGBColorByPlane:r.convertRGBColorByPlane,convertYBRFullByPixel:r.convertYBRFullByPixel,convertYBRFullByPlane:r.convertYBRFullByPlane,convertPALETTECOLOR:r.convertPALETTECOLOR,wadouri:i.default,wadors:a.default,configure:o.default,convertColorSpace:s.default,createImage:l.default,decodeImageFrame:u.default,decodeJPEGBaseline8BitColor:c.default,getImageFrame:d.default,getMinMax:h.default,isColorImage:f.default,isJPEGBaseline8BitColor:p.default,webWorkerManager:m.default,version:g.default,internal:v.internal,external:y.default}},"./imageLoader/internal/index.js":function(e,t,n){"use strict";n.r(t),n.d(t,"internal",(function(){return a}));var r=n("./imageLoader/internal/xhrRequest.js");n.d(t,"xhrRequest",(function(){return r.default}));var i=n("./imageLoader/internal/options.js");n.d(t,"setOptions",(function(){return i.setOptions})),n.d(t,"getOptions",(function(){return i.getOptions}));var a={xhrRequest:r.default,setOptions:i.setOptions,getOptions:i.getOptions}},"./imageLoader/internal/options.js":function(e,t,n){"use strict";n.r(t),n.d(t,"setOptions",(function(){return i})),n.d(t,"getOptions",(function(){return a}));var r={beforeSend:function(){},imageCreated:function(){},strict:!1,useWebWorkers:!0,decodeConfig:{usePDFJS:!1}};function i(e){r=Object.assign(r,e)}function a(){return r}},"./imageLoader/internal/xhrRequest.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./imageLoader/internal/options.js");t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=r.default.cornerstone,s=Object(i.getOptions)();return new Promise((function(r,i){var l=new XMLHttpRequest;l.open("get",e,!0),l.responseType="arraybuffer",s.beforeSend(l,t,n,a),Object.keys(n).forEach((function(e){l.setRequestHeader(e,n[e])})),a.deferred={resolve:r,reject:i},a.url=e,a.imageId=t,l.onloadstart=function(n){s.onloadstart&&s.onloadstart(n,a),o.triggerEvent(o.events,"cornerstoneimageloadstart",{url:e,imageId:t})},l.onloadend=function(n){s.onloadend&&s.onloadend(n,a),o.triggerEvent(o.events,"cornerstoneimageloadend",{url:e,imageId:t})},l.onreadystatechange=function(e){s.onreadystatechange?s.onreadystatechange(e,a):4===l.readyState&&(200===l.status?r(l.response,l):i(l))},l.onprogress=function(n){var r,i,l=n.loaded;n.lengthComputable&&(r=n.total,i=Math.round(l/r*100)),s.onprogress&&s.onprogress(n,a),o.triggerEvent(o.events,"cornerstoneimageloadprogress",{url:e,imageId:t,loaded:l,total:r,percentComplete:i})},l.onerror=function(){i(l)},l.onabort=function(){i(l)},l.send()}))}},"./imageLoader/isColorImage.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){return"RGB"===e||"PALETTE COLOR"===e||"YBR_FULL"===e||"YBR_FULL_422"===e||"YBR_PARTIAL_422"===e||"YBR_PARTIAL_420"===e||"YBR_RCT"===e||"YBR_ICT"===e}},"./imageLoader/isJPEGBaseline8BitColor.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if(t=t||e.transferSyntax,8===e.bitsAllocated&&"1.2.840.10008.1.2.4.50"===t&&(3===e.samplesPerPixel||4===e.samplesPerPixel))return!0}},"./imageLoader/registerLoaders.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadors/index.js"),i=n("./imageLoader/wadouri/index.js");t.default=function(e){r.default.register(e),i.default.register(e)}},"./imageLoader/wadors/findIndexOfString.js":function(e,t,n){"use strict";function r(e,t,n){if(n+e.length>t.length)return!1;for(var r=n,i=0;i<e.length;i++)if(e[i]!==t[r++])return!1;return!0}n.r(t),t.default=function(e,t,n){n=n||0;for(var i=function(e){for(var t=new Uint8Array(e.length),n=0,r=e.length;n<r;n++)t[n]=e.charCodeAt(n);return t}(t),a=n;a<e.length;a++)if(i[0]===e[a]&&r(i,e,a))return a;return-1}},"./imageLoader/wadors/getPixelData.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/internal/index.js"),i=n("./imageLoader/wadors/findIndexOfString.js");function a(e){for(var t=0;t<e.length;t++)if("--"===e[t].substr(0,2))return e[t]}function o(e){for(var t=0;t<e.length;t++)if("Content-Type:"===e[t].substr(0,13))return e[t].substr(13).trim()}function s(e,t,n){t=t||0,n=n||e.length-t;for(var r="",i=t;i<t+n;i++)r+=String.fromCharCode(e[i]);return r}t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/octet-stream",l={accept:n};return new Promise((function(n,u){Object(r.xhrRequest)(e,t,l).then((function(e){var t=new Uint8Array(e),r=Object(i.default)(t,"\r\n\r\n");-1===r&&u(new Error("invalid response - no multipart mime header"));var l=s(t,0,r).split("\r\n"),c=a(l);c||u(new Error("invalid response - no boundary marker"));var d=r+4,h=Object(i.default)(t,c,d);-1===h&&u(new Error("invalid response - terminating boundary not found"));var f=h-d-2;n({contentType:o(l),imageFrame:{pixelData:new Uint8Array(e,d,f)}})}),u)}))}},"./imageLoader/wadors/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadors/metaData/index.js"),i=n("./imageLoader/wadors/findIndexOfString.js"),a=n("./imageLoader/wadors/getPixelData.js"),o=n("./imageLoader/wadors/metaDataManager.js"),s=n("./imageLoader/wadors/loadImage.js"),l=n("./imageLoader/wadors/register.js");t.default={metaData:{getNumberString:r.getNumberString,getNumberValue:r.getNumberValue,getNumberValues:r.getNumberValues,getValue:r.getValue,metaDataProvider:r.metaDataProvider},findIndexOfString:i.default,getPixelData:a.default,loadImage:s.default,metaDataManager:o.default,register:l.default}},"./imageLoader/wadors/loadImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getTransferSyntaxForContentType",(function(){return o}));var r=n("./imageLoader/wadors/metaDataManager.js"),i=n("./imageLoader/wadors/getPixelData.js"),a=n("./imageLoader/createImage.js");function o(e){var t="1.2.840.10008.1.2";if(!e)return t;var n=e.split(";"),r={};n.forEach((function(e){var t=e.split("=");if(2===t.length){var n=t[1].trim().replace(/"/g,"");r[t[0].trim()]=n}}));var i={"image/jpeg":"1.2.840.10008.1.2.4.70","image/x-dicom-rle":"1.2.840.10008.1.2.5","image/x-jls":"1.2.840.10008.1.2.4.80","image/jp2":"1.2.840.10008.1.2.4.90","image/jpx":"1.2.840.10008.1.2.4.92"};return r["transfer-syntax"]?r["transfer-syntax"]:e&&!Object.keys(r).length&&i[e]?i[e]:r.type&&i[r.type]?i[r.type]:t}t.default=function(e,t){var n=(new Date).getTime(),s=e.substring(7);return{promise:new Promise((function(l,u){if(void 0===r.default.get(e)){var c=new Error("no metadata for imageId ".concat(e));return u(c)}Object(i.default)(s,e,'multipart/related; type="application/octet-stream"').then((function(r){var i=o(r.contentType),s=r.imageFrame.pixelData;Object(a.default)(e,s,i,t).then((function(e){var t=(new Date).getTime();e.loadTimeInMS=t-n,l(e)}),u)}),u).catch((function(e){u(e)}))})),cancelFn:void 0}}},"./imageLoader/wadors/metaData/getNumberString.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadors/metaData/getValue.js");t.default=function(e,t,n){var i=Object(r.default)(e,t,n);if(void 0!==i)return parseFloat(i)}},"./imageLoader/wadors/metaData/getNumberValue.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadors/metaData/getValue.js");t.default=function(e,t){var n=Object(r.default)(e,t);if(void 0!==n)return parseFloat(n)}},"./imageLoader/wadors/metaData/getNumberValues.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if(e&&e.Value&&!(t&&e.Value.length<t)){for(var n=[],r=0;r<e.Value.length;r++)n.push(parseFloat(e.Value[r]));return n}}},"./imageLoader/wadors/metaData/getValue.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){return t=t||0,e&&e.Value?e.Value.length<=t?n:e.Value[t]:n}},"./imageLoader/wadors/metaData/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadors/metaData/getNumberString.js");n.d(t,"getNumberString",(function(){return r.default}));var i=n("./imageLoader/wadors/metaData/getNumberValue.js");n.d(t,"getNumberValue",(function(){return i.default}));var a=n("./imageLoader/wadors/metaData/getNumberValues.js");n.d(t,"getNumberValues",(function(){return a.default}));var o=n("./imageLoader/wadors/metaData/getValue.js");n.d(t,"getValue",(function(){return o.default}));var s=n("./imageLoader/wadors/metaData/metaDataProvider.js");n.d(t,"metaDataProvider",(function(){return s.default}))},"./imageLoader/wadors/metaData/metaDataProvider.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./imageLoader/wadors/metaData/getNumberValues.js"),a=n("./imageLoader/wadors/metaData/getValue.js"),o=n("./imageLoader/wadors/metaData/getNumberValue.js"),s=n("./imageLoader/wadors/metaDataManager.js");t.default=function(e,t){var n=r.default.dicomParser,l=s.default.get(t);if(l){if("generalSeriesModule"===e)return{modality:Object(a.default)(l["00080060"]),seriesInstanceUID:Object(a.default)(l["0020000e"]),seriesNumber:Object(o.default)(l["00200011"]),studyInstanceUID:Object(a.default)(l["0020000d"]),seriesDate:n.parseDA(Object(a.default)(l["00080021"])),seriesTime:n.parseTM(Object(a.default)(l["00080031"],0,""))};if("patientStudyModule"===e)return{patientAge:Object(o.default)(l["00101010"]),patientSize:Object(o.default)(l["00101020"]),patientWeight:Object(o.default)(l["00101030"])};if("imagePlaneModule"===e){var u=Object(i.default)(l["00200037"],6),c=Object(i.default)(l["00200032"],3),d=Object(i.default)(l["00280030"],2),h=null,f=null;d&&(f=d[0],h=d[1]);var p=null,m=null;return u&&(p=[parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])],m=[parseFloat(u[3]),parseFloat(u[4]),parseFloat(u[5])]),{frameOfReferenceUID:Object(a.default)(l["00200052"]),rows:Object(o.default)(l["00280010"]),columns:Object(o.default)(l["00280011"]),imageOrientationPatient:u,rowCosines:p,columnCosines:m,imagePositionPatient:c,sliceThickness:Object(o.default)(l["00180050"]),sliceLocation:Object(o.default)(l["00201041"]),pixelSpacing:d,rowPixelSpacing:f,columnPixelSpacing:h}}if("imagePixelModule"===e)return{samplesPerPixel:Object(o.default)(l["00280002"]),photometricInterpretation:Object(a.default)(l["00280004"]),rows:Object(o.default)(l["00280010"]),columns:Object(o.default)(l["00280011"]),bitsAllocated:Object(o.default)(l["00280100"]),bitsStored:Object(o.default)(l["00280101"]),highBit:Object(a.default)(l["00280102"]),pixelRepresentation:Object(o.default)(l["00280103"]),planarConfiguration:Object(o.default)(l["00280006"]),pixelAspectRatio:Object(a.default)(l["00280034"]),smallestPixelValue:Object(o.default)(l["00280106"]),largestPixelValue:Object(o.default)(l["00280107"]),redPaletteColorLookupTableDescriptor:Object(i.default)(l["00281101"]),greenPaletteColorLookupTableDescriptor:Object(i.default)(l["00281102"]),bluePaletteColorLookupTableDescriptor:Object(i.default)(l["00281103"]),redPaletteColorLookupTableData:Object(i.default)(l["00281201"]),greenPaletteColorLookupTableData:Object(i.default)(l["00281202"]),bluePaletteColorLookupTableData:Object(i.default)(l["00281203"])};if("voiLutModule"===e)return{windowCenter:Object(i.default)(l["00281050"],1),windowWidth:Object(i.default)(l["00281051"],1)};if("modalityLutModule"===e)return{rescaleIntercept:Object(o.default)(l["00281052"]),rescaleSlope:Object(o.default)(l["00281053"]),rescaleType:Object(a.default)(l["00281054"])};if("sopCommonModule"===e)return{sopClassUID:Object(a.default)(l["00080016"]),sopInstanceUID:Object(a.default)(l["00080018"])};if("petIsotopeModule"===e){var g=Object(a.default)(l["00540016"]);if(void 0===g)return;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:n.parseTM(Object(a.default)(g["00181072"],0,"")),radionuclideTotalDose:Object(o.default)(g["00181074"]),radionuclideHalfLife:Object(o.default)(g["00181075"])}}}}}},"./imageLoader/wadors/metaDataManager.js":function(e,t,n){"use strict";n.r(t);var r=[];t.default={add:function(e,t){r[e]=t},get:function(e){return r[e]},remove:function(e){r[e]=void 0},purge:function(){r=[]}}},"./imageLoader/wadors/register.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadors/loadImage.js"),i=n("./imageLoader/wadors/metaData/index.js");t.default=function(e){e.registerImageLoader("wadors",r.default),e.metaData.addProvider(i.metaDataProvider)}},"./imageLoader/wadouri/dataSetCacheManager.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getInfo",(function(){return l}));var r=n("./externalModules.js"),i=n("./imageLoader/internal/index.js"),a=0,o={},s={};function l(){return{cacheSizeInBytes:a,numberOfDataSetsCached:Object.keys(o).length}}t.default={isLoaded:function(e){return void 0!==o[e]},load:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.xhrRequest,n=arguments.length>2?arguments[2]:void 0,u=r.default.cornerstone,c=r.default.dicomParser;if(o[e])return new Promise((function(t){o[e].cacheCount++,t(o[e].dataSet)}));if(s[e])return s[e].cacheCount++,s[e];var d=t(e,n),h=new Promise((function(t,n){d.then((function(r){var i,s=new Uint8Array(r);try{i=c.parseDicom(s)}catch(d){return n(d)}o[e]={dataSet:i,cacheCount:h.cacheCount},a+=i.byteArray.length,t(i),u.triggerEvent(u.events,"datasetscachechanged",{uri:e,action:"loaded",cacheInfo:l()})}),n).then((function(){delete s[e]}),(function(){delete s[e]}))}));return h.cacheCount=1,s[e]=h,h},unload:function(e){var t=r.default.cornerstone;o[e]&&(o[e].cacheCount--,0===o[e].cacheCount&&(a-=o[e].dataSet.byteArray.length,delete o[e],t.triggerEvent(t.events,"datasetscachechanged",{uri:e,action:"unloaded",cacheInfo:l()})))},getInfo:l,purge:function(){o={},s={}},get:function(e){if(o[e])return o[e].dataSet}}},"./imageLoader/wadouri/fileManager.js":function(e,t,n){"use strict";n.r(t);var r=[];t.default={add:function(e){var t=r.push(e);return"dicomfile:".concat(t-1)},get:function(e){return r[e]},remove:function(e){r[e]=void 0},purge:function(){r=[]}}},"./imageLoader/wadouri/getEncapsulatedImageFrame.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./externalModules.js");function i(e,t){var n=r.default.dicomParser;if(e.elements.x7fe00010&&e.elements.x7fe00010.basicOffsetTable.length)return n.readEncapsulatedImageFrame(e,e.elements.x7fe00010,t);if(function(e){return e.intString("x00280008")!==e.elements.x7fe00010.fragments.length}(e)){var i=n.createJPEGBasicOffsetTable(e,e.elements.x7fe00010);return n.readEncapsulatedImageFrame(e,e.elements.x7fe00010,t,i)}return n.readEncapsulatedPixelDataFromFragments(e,e.elements.x7fe00010,t)}},"./imageLoader/wadouri/getPixelData.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadouri/getEncapsulatedImageFrame.js"),i=n("./imageLoader/wadouri/getUncompressedImageFrame.js");t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.elements.x7fe00010||e.elements.x7fe00008;return n?n.encapsulatedPixelData?Object(r.default)(e,t):Object(i.default)(e,t):null}},"./imageLoader/wadouri/getUncompressedImageFrame.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadouri/unpackBinaryFrame.js");t.default=function(e,t){var n,i=e.elements.x7fe00010||e.elements.x7fe00008,a=e.uint16("x00280100"),o=e.uint16("x00280010"),s=e.uint16("x00280011"),l=e.uint16("x00280002"),u=i.dataOffset,c=o*s*l;if(8===a){if((n=u+t*c)>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer,n,c)}if(16===a){if((n=u+t*c*2)>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer,n,2*c)}if(1===a){if((n=u+t*c*.125)>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return Object(r.default)(e.byteArray,n,c)}if(32===a){if((n=u+t*c*4)>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer,n,4*c)}throw new Error("unsupported pixel format")}},"./imageLoader/wadouri/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadouri/metaData/index.js"),i=n("./imageLoader/wadouri/dataSetCacheManager.js"),a=n("./imageLoader/wadouri/fileManager.js"),o=n("./imageLoader/wadouri/getEncapsulatedImageFrame.js"),s=n("./imageLoader/wadouri/getUncompressedImageFrame.js"),l=n("./imageLoader/wadouri/loadFileRequest.js"),u=n("./imageLoader/wadouri/loadImage.js"),c=n("./imageLoader/wadouri/parseImageId.js"),d=n("./imageLoader/wadouri/unpackBinaryFrame.js"),h=n("./imageLoader/wadouri/register.js");t.default={metaData:{getImagePixelModule:r.getImagePixelModule,getLUTs:r.getLUTs,getModalityLUTOutputPixelRepresentation:r.getModalityLUTOutputPixelRepresentation,getNumberValues:r.getNumberValues,metaDataProvider:r.metaDataProvider},dataSetCacheManager:i.default,fileManager:a.default,getEncapsulatedImageFrame:o.default,getUncompressedImageFrame:s.default,loadFileRequest:l.default,loadImageFromPromise:u.loadImageFromPromise,getLoaderForScheme:u.getLoaderForScheme,loadImage:u.loadImage,parseImageId:c.default,unpackBinaryFrame:d.default,register:h.default}},"./imageLoader/wadouri/loadFileRequest.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadouri/parseImageId.js"),i=n("./imageLoader/wadouri/fileManager.js");t.default=function(e){var t=Object(r.default)(e),n=parseInt(t.url,10),a=i.default.get(n);return new Promise((function(e,t){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.onerror=t,n.readAsArrayBuffer(a)}))}},"./imageLoader/wadouri/loadImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"loadImageFromPromise",(function(){return c})),n.d(t,"getLoaderForScheme",(function(){return h})),n.d(t,"loadImage",(function(){return f}));var r=n("./imageLoader/createImage.js"),i=n("./imageLoader/wadouri/parseImageId.js"),a=n("./imageLoader/wadouri/dataSetCacheManager.js"),o=n("./imageLoader/wadouri/loadFileRequest.js"),s=n("./imageLoader/wadouri/getPixelData.js"),l=n("./imageLoader/internal/index.js");function u(e,t){e.decache=function(){var e=Object(i.default)(t);a.default.unload(e.url)}}function c(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,l=(new Date).getTime(),c={cancelFn:void 0};return c.promise=new Promise((function(d,h){e.then((function(e){var f=Object(s.default)(e,n),p=e.string("x00020010"),m=(new Date).getTime(),g=Object(r.default)(t,f,p,a);u(c,t),g.then((function(t){t.data=e,t.sharedCacheKey=i;var n=(new Date).getTime();t.loadTimeInMS=m-l,t.totalTimeInMS=n-l,void 0!==o&&void 0!==o.imageDoneCallback&&o.imageDoneCallback(t),d(t)}),(function(t){h({error:t,dataSet:e})}))}),(function(e){h({error:e})}))})),c}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,o=(new Date).getTime(),l=new Promise((function(l,u){var c,d=(new Date).getTime();try{var h=Object(s.default)(e,n),f=e.string("x00020010");c=Object(r.default)(t,h,f,a)}catch(p){return void u({error:p,dataSet:e})}c.then((function(t){t.data=e,t.sharedCacheKey=i;var n=(new Date).getTime();t.loadTimeInMS=d-o,t.totalTimeInMS=n-o,l(t)}),u)}));return{promise:l,cancelFn:void 0}}function h(e){return"dicomweb"===e||"wadouri"===e?l.xhrRequest:"dicomfile"===e?o.default:void 0}function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(i.default)(e),r=(t=Object.assign({},t)).loader;if(void 0===r?r=h(n.scheme):delete t.loader,a.default.isLoaded(n.url)){var o=a.default.get(n.url,r,e);return d(o,e,n.frame,n.url,t)}var s=a.default.load(n.url,r,e);return c(s,e,n.frame,n.url,t)}},"./imageLoader/wadouri/metaData/getImagePixelModule.js":function(e,t,n){"use strict";function r(e,t){if(e.elements[t]&&6===e.elements[t].length)return[e.uint16(t,0),e.uint16(t,1),e.uint16(t,2)]}function i(e,t,n){for(var r=[],i=e.elements[t],a=0;a<n[0];a++)r[a]=16===n[2]?e.uint16(t,a):e.byteArray[a+i.dataOffset];return r}n.r(t),t.default=function(e){var t={samplesPerPixel:e.uint16("x00280002"),photometricInterpretation:e.string("x00280004"),rows:e.uint16("x00280010"),columns:e.uint16("x00280011"),bitsAllocated:e.uint16("x00280100"),bitsStored:e.uint16("x00280101"),highBit:e.uint16("x00280102"),pixelRepresentation:e.uint16("x00280103"),planarConfiguration:e.uint16("x00280006"),pixelAspectRatio:e.string("x00280034")};return function(e,t){0===e.uint16("x00280103")?(t.smallestPixelValue=e.uint16("x00280106"),t.largestPixelValue=e.uint16("x00280107")):(t.smallestPixelValue=e.int16("x00280106"),t.largestPixelValue=e.int16("x00280107"))}(e,t),"PALETTE COLOR"===t.photometricInterpretation&&e.elements.x00281101&&function(e,t){t.redPaletteColorLookupTableDescriptor=r(e,"x00281101"),t.greenPaletteColorLookupTableDescriptor=r(e,"x00281102"),t.bluePaletteColorLookupTableDescriptor=r(e,"x00281103"),0===t.redPaletteColorLookupTableDescriptor[0]&&(t.redPaletteColorLookupTableDescriptor[0]=65536,t.greenPaletteColorLookupTableDescriptor[0]=65536,t.bluePaletteColorLookupTableDescriptor[0]=65536);var n=e.elements.x00281201.length===t.redPaletteColorLookupTableDescriptor[0]?8:16;t.redPaletteColorLookupTableDescriptor[2]!==n&&(t.redPaletteColorLookupTableDescriptor[2]=n,t.greenPaletteColorLookupTableDescriptor[2]=n,t.bluePaletteColorLookupTableDescriptor[2]=n),t.redPaletteColorLookupTableData=i(e,"x00281201",t.redPaletteColorLookupTableDescriptor),t.greenPaletteColorLookupTableData=i(e,"x00281202",t.greenPaletteColorLookupTableDescriptor),t.bluePaletteColorLookupTableData=i(e,"x00281203",t.bluePaletteColorLookupTableDescriptor)}(e,t),t}},"./imageLoader/wadouri/metaData/getLUTs.js":function(e,t,n){"use strict";function r(e,t){var n=t.uint16("x00283002",0);0===n&&(n=65535);for(var r={id:"1",firstValueMapped:0===e?t.uint16("x00283002",1):t.int16("x00283002",1),numBitsPerEntry:t.uint16("x00283002",2),lut:[]},i=0;i<n;i++)r.lut[i]=0===e?t.uint16("x00283006",i):t.int16("x00283006",i);return r}n.r(t),t.default=function(e,t){if(t&&t.items.length){for(var n=[],i=0;i<t.items.length;i++){var a=r(e,t.items[i].dataSet);a&&n.push(a)}return n}}},"./imageLoader/wadouri/metaData/getModalityLUTOutputPixelRepresentation.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=e.string("x00080016");if("1.2.840.10008.5.1.4.1.1.2"===t||"1.2.840.10008.5.1.4.1.1.2.1"===t)return 1;var n=e.floatString("x00281052"),r=e.floatString("x00281053");return void 0!==n&&void 0!==r?function(e){var t=e.uint16("x00280103"),n=e.uint16("x00280101");return 0===t?0:-1<<n-1}(e)*r+n<0?1:0:e.elements.x00283000&&e.elements.x00283000.length>0?0:e.uint16("x00280103")}},"./imageLoader/wadouri/metaData/getNumberValues.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){var r=[],i=e.string(t);if(i){var a=i.split("\\");if(!(n&&a.length<n)){for(var o=0;o<a.length;o++)r.push(parseFloat(a[o]));return r}}}},"./imageLoader/wadouri/metaData/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadouri/metaData/getImagePixelModule.js");n.d(t,"getImagePixelModule",(function(){return r.default}));var i=n("./imageLoader/wadouri/metaData/getLUTs.js");n.d(t,"getLUTs",(function(){return i.default}));var a=n("./imageLoader/wadouri/metaData/getModalityLUTOutputPixelRepresentation.js");n.d(t,"getModalityLUTOutputPixelRepresentation",(function(){return a.default}));var o=n("./imageLoader/wadouri/metaData/getNumberValues.js");n.d(t,"getNumberValues",(function(){return o.default}));var s=n("./imageLoader/wadouri/metaData/metaDataProvider.js");n.d(t,"metaDataProvider",(function(){return s.default}))},"./imageLoader/wadouri/metaData/metaDataProvider.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./imageLoader/wadouri/metaData/getNumberValues.js"),a=n("./imageLoader/wadouri/parseImageId.js"),o=n("./imageLoader/wadouri/dataSetCacheManager.js"),s=n("./imageLoader/wadouri/metaData/getImagePixelModule.js"),l=n("./imageLoader/wadouri/metaData/getLUTs.js"),u=n("./imageLoader/wadouri/metaData/getModalityLUTOutputPixelRepresentation.js");t.default=function(e,t){var n=r.default.dicomParser,c=Object(a.default)(t),d=o.default.get(c.url);if(d){if("generalSeriesModule"===e)return{modality:d.string("x00080060"),seriesInstanceUID:d.string("x0020000e"),seriesNumber:d.intString("x00200011"),studyInstanceUID:d.string("x0020000d"),seriesDate:n.parseDA(d.string("x00080021")),seriesTime:n.parseTM(d.string("x00080031")||"")};if("patientStudyModule"===e)return{patientAge:d.intString("x00101010"),patientSize:d.floatString("x00101020"),patientWeight:d.floatString("x00101030")};if("imagePlaneModule"===e){var h=Object(i.default)(d,"x00200037",6),f=Object(i.default)(d,"x00200032",3),p=Object(i.default)(d,"x00280030",2),m=null,g=null;p&&(g=p[0],m=p[1]);var v=null,y=null;return h&&(v=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])],y=[parseFloat(h[3]),parseFloat(h[4]),parseFloat(h[5])]),{frameOfReferenceUID:d.string("x00200052"),rows:d.uint16("x00280010"),columns:d.uint16("x00280011"),imageOrientationPatient:h,rowCosines:v,columnCosines:y,imagePositionPatient:f,sliceThickness:d.floatString("x00180050"),sliceLocation:d.floatString("x00201041"),pixelSpacing:p,rowPixelSpacing:g,columnPixelSpacing:m}}if("imagePixelModule"===e)return Object(s.default)(d);if("modalityLutModule"===e)return{rescaleIntercept:d.floatString("x00281052"),rescaleSlope:d.floatString("x00281053"),rescaleType:d.string("x00281054"),modalityLUTSequence:Object(l.default)(d.uint16("x00280103"),d.elements.x00283000)};if("voiLutModule"===e){var b=Object(u.default)(d);return{windowCenter:Object(i.default)(d,"x00281050",1),windowWidth:Object(i.default)(d,"x00281051",1),voiLUTSequence:Object(l.default)(b,d.elements.x00283010)}}if("sopCommonModule"===e)return{sopClassUID:d.string("x00080016"),sopInstanceUID:d.string("x00080018")};if("petIsotopeModule"===e){var x=d.elements.x00540016;if(void 0===x)return;var w=x.items[0].dataSet;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:n.parseTM(w.string("x00181072")||""),radionuclideTotalDose:w.floatString("x00181074"),radionuclideHalfLife:w.floatString("x00181075")}}}}}},"./imageLoader/wadouri/parseImageId.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t,n=e.indexOf(":"),r=e.substring(n+1),i=r.indexOf("frame=");if(-1!==i){var a=r.substr(i+6);t=parseInt(a,10),r=r.substr(0,i-1)}return{scheme:e.substr(0,n),url:r,frame:t}}},"./imageLoader/wadouri/register.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadouri/loadImage.js"),i=n("./imageLoader/wadouri/metaData/index.js");t.default=function(e){e.registerImageLoader("dicomweb",r.loadImage),e.registerImageLoader("wadouri",r.loadImage),e.registerImageLoader("dicomfile",r.loadImage),e.metaData.addProvider(i.metaDataProvider)}},"./imageLoader/wadouri/unpackBinaryFrame.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){for(var r=new Uint8Array(n),i=0;i<n;i++){var a=Math.floor(i/8);r[i]=e[a+t]&1<<i%8?1:0}return r}},"./imageLoader/webWorkerManager.js":function(e,t,n){"use strict";n.r(t);var r,i=n("./imageLoader/internal/options.js"),a=0,o=[],s=[],l=Object(i.getOptions)(),u={maxWebWorkers:navigator.hardwareConcurrency||1,startWebWorkersOnDemand:!0,webWorkerPath:"../../dist/cornerstoneWADOImageLoaderWebWorker.js",webWorkerTaskPaths:[],taskConfiguration:{decodeTask:{loadCodecsOnStartup:!0,initializeCodecsOnStartup:!1,codecsPath:"../dist/cornerstoneWADOImageLoaderCodecs.js",usePDFJS:!1,strict:l.strict}}},c={maxWebWorkers:0,numWebWorkers:0,numTasksQueued:0,numTasksExecuting:0,numTasksCompleted:0,totalTaskTimeInMS:0,totalTimeDelayedInMS:0};function d(){if(o.length){for(var e=0;e<s.length;e++)if("ready"===s[e].status){s[e].status="busy";var t=o.shift();t.start=(new Date).getTime();var n=(new Date).getTime();return c.totalTimeDelayedInMS+=n-t.added,s[e].task=t,s[e].worker.postMessage({taskType:t.taskType,workerIndex:e,data:t.data},t.transferList),void c.numTasksExecuting++}s.length<r.maxWebWorkers&&f()}}function h(e){if("initialize"===e.data.taskType)s[e.data.workerIndex].status="ready",d();else{var t=s[e.data.workerIndex].task.start;s[e.data.workerIndex].task.deferred.resolve(e.data.result),s[e.data.workerIndex].task=void 0,c.numTasksExecuting--,s[e.data.workerIndex].status="ready",c.numTasksCompleted++;var n=(new Date).getTime();c.totalTaskTimeInMS+=n-t,d()}}function f(){if(!(s.length>=r.maxWebWorkers)){var e=new Worker(r.webWorkerPath);s.push({worker:e,status:"initializing"}),e.addEventListener("message",h),e.postMessage({taskType:"initialize",workerIndex:s.length-1,config:r})}}function p(e){if(e=e||u,r)throw new Error("WebWorkerManager already initialized");if((r=e).maxWebWorkers=r.maxWebWorkers||navigator.hardwareConcurrency||1,!r.startWebWorkersOnDemand)for(var t=0;t<r.maxWebWorkers;t++)f()}t.default={initialize:p,loadWebWorkerTask:function(e,t){r.webWorkerTaskPaths.push(e),t&&(r.taskConfiguration=Object.assign(r.taskConfiguration,t));for(var n=0;n<s.length;n++)s[n].worker.postMessage({taskType:"loadWebWorkerTask",workerIndex:s.length-1,sourcePath:e,config:r})},addTask:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;r||p();var s,l={},u=new Promise((function(e,t){l={resolve:e,reject:t}}));for(s=0;s<o.length&&!(o[s].priority<n);s++);var c=a++;return o.splice(s,0,{taskId:c,taskType:e,status:"ready",added:(new Date).getTime(),data:t,deferred:l,priority:n,transferList:i}),d(),{taskId:c,promise:u}},getStatistics:function(){return c.maxWebWorkers=r.maxWebWorkers,c.numWebWorkers=s.length,c.numTasksQueued=o.length,c},setTaskPriority:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<o.length;n++)if(o[n].taskId===e){var r=o.splice(n,1)[0];for(r.priority=t,n=0;n<o.length&&!(o[n].priority<t);n++);return o.splice(n,0,r),!0}return!1},cancelTask:function(e,t){for(var n=0;n<o.length;n++)if(o[n].taskId===e)return o.splice(n,1).deferred.reject(t),!0;return!1}}},"./shared/calculateMinMax.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./shared/getMinMax.js");function i(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Object(r.default)(e.pixelData),i=!(a(e.smallestPixelValue)&&a(e.largestPixelValue));!0!==t||i?(e.smallestPixelValue=n.min,e.largestPixelValue=n.max):(e.smallestPixelValue!==n.min&&console.warn("Image smallestPixelValue tag is incorrect. Rendering performance will suffer considerably."),e.largestPixelValue!==n.max&&console.warn("Image largestPixelValue tag is incorrect. Rendering performance will suffer considerably."))}function a(e){return"number"==typeof e}},"./shared/decodeImageFrame.js":function(e,t,n){"use strict";n.r(t);var r=n("./shared/decoders/decodeLittleEndian.js"),i=n("./shared/decoders/decodeBigEndian.js"),a=n("./shared/decoders/decodeRLE.js"),o=n("./shared/decoders/decodeJPEGBaseline.js"),s=n("./shared/decoders/decodeJPEGLossless.js"),l=n("./shared/decoders/decodeJPEGLS.js"),u=n("./shared/decoders/decodeJPEG2000.js");t.default=function(e,t,n,c,d){var h=(new Date).getTime();if("1.2.840.10008.1.2"===t)e=Object(r.default)(e,n);else if("1.2.840.10008.1.2.1"===t)e=Object(r.default)(e,n);else if("1.2.840.10008.1.2.2"===t)e=Object(i.default)(e,n);else if("1.2.840.10008.1.2.1.99"===t)e=Object(r.default)(e,n);else if("1.2.840.10008.1.2.5"===t)e=Object(a.default)(e,n);else if("1.2.840.10008.1.2.4.50"===t)e=Object(o.default)(e,n);else if("1.2.840.10008.1.2.4.51"===t)e=Object(o.default)(e,n);else if("1.2.840.10008.1.2.4.57"===t)e=Object(s.default)(e,n);else if("1.2.840.10008.1.2.4.70"===t)e=Object(s.default)(e,n);else if("1.2.840.10008.1.2.4.80"===t)e=Object(l.default)(e,n);else if("1.2.840.10008.1.2.4.81"===t)e=Object(l.default)(e,n);else if("1.2.840.10008.1.2.4.90"===t)e=Object(u.default)(e,n,c,d);else{if("1.2.840.10008.1.2.4.91"!==t)throw new Error("no decoder for transfer syntax ".concat(t));e=Object(u.default)(e,n,c,d)}var f=void 0!==e.pixelRepresentation&&1===e.pixelRepresentation,p=f&&void 0!==e.bitsStored?32-e.bitsStored:void 0;if(f&&void 0!==p)for(var m=0;m<e.pixelData.length;m++)e.pixelData[m]=e.pixelData[m]<<p>>p;var g=(new Date).getTime();return e.decodeTimeInMS=g-h,e}},"./shared/decoders/decodeBigEndian.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if(16===e.bitsAllocated){var n=t.buffer,r=t.byteOffset,i=t.length;r%2&&(n=n.slice(r),r=0),e.pixelData=0===e.pixelRepresentation?new Uint16Array(n,r,i/2):new Int16Array(n,r,i/2);for(var a=0;a<e.pixelData.length;a++)e.pixelData[a]=(255&(o=e.pixelData[a]))<<8|o>>8&255}else 8===e.bitsAllocated&&(e.pixelData=t);var o;return e}},"./shared/decoders/decodeJPEG2000.js":function(e,t,n){"use strict";function r(e,t){var n=new JpxImage;n.parse(t);var r=n.tiles.length;if(1!==r)throw new Error("JPEG2000 decoder returned a tileCount of ".concat(r,", when 1 is expected"));return e.columns=n.width,e.rows=n.height,e.pixelData=n.tiles[0].items,e}var i;function a(e,t){var n=function(e,t,n){var r=i._malloc(e.length);i.writeArrayToMemory(e,r);var a=i._malloc(4),o=i._malloc(4),s=i._malloc(4),l=i._malloc(4),u=i._malloc(4),c=(new Date).getTime();if(0!==i.ccall("jp2_decode","number",["number","number","number","number","number","number","number"],[r,e.length,a,o,s,l,u]))return console.log("[opj_decode] decoding failed!"),i._free(r),i._free(i.getValue(a,"*")),i._free(s),i._free(l),i._free(o),void i._free(u);var d=i.getValue(a,"*"),h={length:i.getValue(o,"i32"),sx:i.getValue(s,"i32"),sy:i.getValue(l,"i32"),nbChannels:i.getValue(u,"i32"),perf_timetodecode:void 0,pixelData:void 0},f=h.sx*h.sy*h.nbChannels,p=new Int32Array(i.HEAP32.buffer,d,f);if(1===t)if(Uint8Array.from)h.pixelData=Uint8Array.from(p);else{h.pixelData=new Uint8Array(f);for(var m=0;m<f;m++)h.pixelData[m]=p[m]}else if(n)if(Int16Array.from)h.pixelData=Int16Array.from(p);else{h.pixelData=new Int16Array(f);for(var g=0;g<f;g++)h.pixelData[g]=p[g]}else if(Uint16Array.from)h.pixelData=Uint16Array.from(p);else{h.pixelData=new Uint16Array(f);for(var v=0;v<f;v++)h.pixelData[v]=p[v]}var y=(new Date).getTime();return h.perf_timetodecode=y-c,i._free(r),i._free(a),i._free(d),i._free(o),i._free(s),i._free(l),i._free(u),h}(t,e.bitsAllocated<=8?1:2,1===e.pixelRepresentation);return e.columns=n.sx,e.rows=n.sy,e.pixelData=n.pixelData,n.nbChannels>1&&(e.photometricInterpretation="RGB"),e}function o(e){if(!e.usePDFJS&&"undefined"==typeof OpenJPEG)throw new Error("OpenJPEG decoder not loaded");if(!(i||(i=OpenJPEG())&&i._jp2_decode))throw new Error("OpenJPEG failed to initialize")}n.r(t),n.d(t,"initializeJPEG2000",(function(){return o})),t.default=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return o(n),i.usePDFJS||n.usePDFJS?r(e,t):a(e,t)}},"./shared/decoders/decodeJPEGBaseline.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if("undefined"==typeof JpegImage)throw new Error("No JPEG Baseline decoder loaded");var n=new JpegImage;return n.parse(t),n.colorTransform=!1,8===e.bitsAllocated?(e.pixelData=n.getData(e.columns,e.rows),e):16===e.bitsAllocated?(e.pixelData=n.getData16(e.columns,e.rows),e):void 0}},"./shared/decoders/decodeJPEGLS.js":function(e,t,n){"use strict";var r;function i(){if("undefined"==typeof CharLS)throw new Error("No JPEG-LS decoder loaded");if(!(r||(r=CharLS())&&r._jpegls_decode))throw new Error("JPEG-LS failed to initialize")}n.r(t),n.d(t,"initializeJPEGLS",(function(){return i})),t.default=function(e,t){i();var n=function(e,t){var n=r._malloc(e.length);r.writeArrayToMemory(e,n);var i=r._malloc(4),a=r._malloc(4),o=r._malloc(4),s=r._malloc(4),l=r._malloc(4),u=r._malloc(4),c=r._malloc(4),d=r._malloc(4),h=r._malloc(4),f={result:r.ccall("jpegls_decode","number",["number","number","number","number","number","number","number","number","number","number","number"],[n,e.length,i,a,o,s,l,u,d,c,h]),width:r.getValue(o,"i32"),height:r.getValue(s,"i32"),bitsPerSample:r.getValue(l,"i32"),stride:r.getValue(u,"i32"),components:r.getValue(d,"i32"),allowedLossyError:r.getValue(c,"i32"),interleaveMode:r.getValue(h,"i32"),pixelData:void 0},p=r.getValue(i,"*");return f.bitsPerSample<=8?(f.pixelData=new Uint8Array(f.width*f.height*f.components),f.pixelData.set(new Uint8Array(r.HEAP8.buffer,p,f.pixelData.length))):t?(f.pixelData=new Int16Array(f.width*f.height*f.components),f.pixelData.set(new Int16Array(r.HEAP16.buffer,p,f.pixelData.length))):(f.pixelData=new Uint16Array(f.width*f.height*f.components),f.pixelData.set(new Uint16Array(r.HEAP16.buffer,p,f.pixelData.length))),r._free(n),r._free(p),r._free(i),r._free(a),r._free(o),r._free(s),r._free(l),r._free(u),r._free(d),r._free(h),f}(t,1===e.pixelRepresentation);if(0!==n.result&&6!==n.result)throw new Error("JPEG-LS decoder failed to decode frame (error code ".concat(n.result,")"));return e.columns=n.width,e.rows=n.height,e.pixelData=n.pixelData,e}},"./shared/decoders/decodeJPEGLossless.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if("undefined"==typeof jpeg||void 0===jpeg.lossless||void 0===jpeg.lossless.Decoder)throw new Error("No JPEG Lossless decoder loaded");var n=e.bitsAllocated<=8?1:2,r=t.buffer,i=(new jpeg.lossless.Decoder).decode(r,t.byteOffset,t.length,n);return 0===e.pixelRepresentation?16===e.bitsAllocated?(e.pixelData=new Uint16Array(i.buffer),e):(e.pixelData=new Uint8Array(i.buffer),e):(e.pixelData=new Int16Array(i.buffer),e)}},"./shared/decoders/decodeLittleEndian.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=t.buffer,r=t.byteOffset,i=t.length;return 16===e.bitsAllocated?(r%2&&(n=n.slice(r),r=0),e.pixelData=0===e.pixelRepresentation?new Uint16Array(n,r,i/2):new Int16Array(n,r,i/2)):8===e.bitsAllocated||1===e.bitsAllocated?e.pixelData=t:32===e.bitsAllocated&&(r%2&&(n=n.slice(r),r=0),e.pixelData=new Float32Array(n,r,i/4)),e}},"./shared/decoders/decodeRLE.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if(8===e.bitsAllocated)return e.planarConfiguration?function(e,t){for(var n=t,r=e.rows*e.columns,i=new ArrayBuffer(r*e.samplesPerPixel),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i),l=0,u=a.getInt32(0,!0),c=0;c<u;++c){l=c*r;var d=a.getInt32(4*(c+1),!0),h=a.getInt32(4*(c+2),!0);0===h&&(h=n.length);for(var f=r*u;d<h;){var p=o[d++];if(p>=0&&p<=127)for(var m=0;m<p+1&&l<f;++m)s[l]=o[d++],l++;else if(p<=-1&&p>=-127)for(var g=o[d++],v=0;v<1-p&&l<f;++v)s[l]=g,l++}}return e.pixelData=new Uint8Array(i),e}(e,t):function(e,t){for(var n=t,r=e.rows*e.columns,i=new ArrayBuffer(r*e.samplesPerPixel),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i),l=0,u=a.getInt32(0,!0),c=0;c<u;++c){l=c;var d=a.getInt32(4*(c+1),!0),h=a.getInt32(4*(c+2),!0);0===h&&(h=n.length);for(var f=r*u;d<h;){var p=o[d++];if(p>=0&&p<=127)for(var m=0;m<p+1&&l<f;++m)s[l]=o[d++],l+=e.samplesPerPixel;else if(p<=-1&&p>=-127)for(var g=o[d++],v=0;v<1-p&&l<f;++v)s[l]=g,l+=e.samplesPerPixel}}return e.pixelData=new Uint8Array(i),e}(e,t);if(16===e.bitsAllocated)return function(e,t){for(var n=t,r=e.rows*e.columns,i=new ArrayBuffer(r*e.samplesPerPixel*2),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i),l=a.getInt32(0,!0),u=0;u<l;++u){var c=0,d=0===u?1:0,h=a.getInt32(4*(u+1),!0),f=a.getInt32(4*(u+2),!0);for(0===f&&(f=n.length);h<f;){var p=o[h++];if(p>=0&&p<=127)for(var m=0;m<p+1&&c<r;++m)s[2*c+d]=o[h++],c++;else if(p<=-1&&p>=-127)for(var g=o[h++],v=0;v<1-p&&c<r;++v)s[2*c+d]=g,c++}}return e.pixelData=0===e.pixelRepresentation?new Uint16Array(i):new Int16Array(i),e}(e,t);throw new Error("unsupported pixel format for RLE")}},"./shared/getMinMax.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){for(var t,n=e[0],r=e[0],i=e.length,a=1;a<i;a++)t=e[a],n=Math.min(n,t),r=Math.max(r,t);return{min:n,max:r}}},"./version.js":function(e,t,n){"use strict";n.r(t),t.default="2.2.4"}})},e.exports=r()},O9TA:function(e,t,n){const r=n("Ybu3");e.exports=(e,t)=>{const n=r(e,t);return n&&n.prerelease.length?n.prerelease:null}},PDX0:function(e,t){(function(t){e.exports=t}).call(this,{})},VMJL:function(e,t,n){const r=n("xfvg"),i=n("dtu/"),a=n("7sNm"),o=n("Dknc"),s=n("JCZO"),l=n("bdwG");e.exports=(e,t,n,u)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return r(e,n,u);case"!=":return i(e,n,u);case">":return a(e,n,u);case">=":return o(e,n,u);case"<":return s(e,n,u);case"<=":return l(e,n,u);default:throw new TypeError("Invalid operator: "+t)}}},VYYE:function(e,t,n){var r,i=(r="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(r=r||__filename),function(e){function t(){return T.buffer!=H&&Z(T.buffer),W}function r(){return T.buffer!=H&&Z(T.buffer),V}function i(){return T.buffer!=H&&Z(T.buffer),q}function a(){return T.buffer!=H&&Z(T.buffer),G}function o(){return T.buffer!=H&&Z(T.buffer),Y}var s,l=void 0!==(e=e||{})?e:{},u=void 0,c={};for(s in l)l.hasOwnProperty(s)&&(c[s]=l[s]);var d=[],h=!1,f=!1,p=!1,m=!1;h="object"==typeof window,f="function"==typeof importScripts,p="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,m=!h&&!p&&!f;var g=l.ENVIRONMENT_IS_PTHREAD||!1;g&&(H=l.buffer,J=l.DYNAMIC_BASE,Q=l.DYNAMICTOP_PTR);var v,y,b,x,w="";function _(e){return l.locateFile?l.locateFile(e,w):w+e}if(p){var k;w=f?n(6).dirname(w)+"/":__dirname+"/",v=function(e,t){return b||(b=n(7)),x||(x=n(6)),e=x.normalize(e),b.readFileSync(e,t?null:"utf8")},y=function(e){var t=v(e,!0);return t.buffer||(t=new Uint8Array(t)),N(t.buffer),t},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),d=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof dn))throw e})),process.on("unhandledRejection",xe),l.inspect=function(){return"[Emscripten Module object]"};try{k=n(8)}catch(fn){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),fn}Worker=k.Worker}else m?("undefined"!=typeof read&&(v=function(e){return read(e)}),y=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(N("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?d=scriptArgs:void 0!==arguments&&(d=arguments),"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(h||f)&&(f?w=self.location.href:document.currentScript&&(w=document.currentScript.src),u&&(w=u),w=0!==w.indexOf("blob:")?w.substr(0,w.lastIndexOf("/")+1):"",p?(v=function(e,t){return b||(b=n(7)),x||(x=n(6)),e=x.normalize(e),b.readFileSync(e,t?null:"utf8")},y=function(e){var t=v(e,!0);return t.buffer||(t=new Uint8Array(t)),N(t.buffer),t}):(v=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},f&&(y=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)})));p&&"undefined"==typeof performance&&(performance=n(9).performance);var E,S,T,C=l.print||console.log.bind(console),I=l.printErr||console.warn.bind(console);for(s in c)c.hasOwnProperty(s)&&(l[s]=c[s]);c=null,l.arguments&&(d=l.arguments),Atomics,Atomics,Atomics,l.wasmBinary&&(E=l.wasmBinary),l.noExitRuntime&&(S=l.noExitRuntime),"object"!=typeof WebAssembly&&I("no native wasm support detected");var A,O=new WebAssembly.Table({initial:167,maximum:167,element:"anyfunc"}),D=0,M=!1;function N(e,t){e||xe("Assertion failed: "+t)}function j(e){var t=l["_"+e];return N(t,"Cannot call unknown function "+e+", make sure it is exported"),t}function F(e,t,n,r,i){var a={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);$(e,t=ln(n),n)}return t},array:function(e){var t=ln(e.length);return U(e,t),t}},o=j(e),s=[],l=0;if(r)for(var u=0;u<r.length;u++){var c=a[n[u]];c?(0===l&&(l=sn()),s[u]=c(r[u])):s[u]=r[u]}var d=o.apply(null,s);return d=function(e){return"string"===t?L(e):"boolean"===t?Boolean(e):e}(d),0!==l&&un(l),d}function R(e,t,n,r){var i=(n=n||[]).every((function(e){return"number"===e}));return"string"!==t&&i&&!r?j(e):function(){return F(e,t,n,arguments)}}function P(e,t,n){for(var r=t+n,i="";!(t>=r);){var a=e[t++];if(!a)return i;if(128&a){var o=63&e[t++];if(192!=(224&a)){var s=63&e[t++];if((a=224==(240&a)?(15&a)<<12|o<<6|s:(7&a)<<18|o<<12|s<<6|63&e[t++])<65536)i+=String.fromCharCode(a);else{var l=a-65536;i+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else i+=String.fromCharCode((31&a)<<6|o)}else i+=String.fromCharCode(a)}return i}function L(e,t){return e?P(r(),e,t):""}function B(e,t,n,r){if(!(r>0))return 0;for(var i=n,a=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(n>=a)break;t[n++]=s}else if(s<=2047){if(n+1>=a)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=a)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=a)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}return t[n]=0,n-i}function $(e,t,n){return B(e,r(),t,n)}function z(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),r<=127?++t:t+=r<=2047?2:r<=65535?3:4}return t}function U(e,n){t().set(e,n)}var H,W,V,q,G,Y,X=65536;function K(e,t){return e%t>0&&(e+=t-e%t),e}function Z(e){H=e,l.HEAP8=W=new Int8Array(e),l.HEAP16=new Int16Array(e),l.HEAP32=q=new Int32Array(e),l.HEAPU8=V=new Uint8Array(e),l.HEAPU16=new Uint16Array(e),l.HEAPU32=G=new Uint32Array(e),l.HEAPF32=new Float32Array(e),l.HEAPF64=Y=new Float64Array(e)}var J=5256464,Q=12656,ee=l.INITIAL_MEMORY||16777216;if(g)T=l.wasmMemory,H=l.buffer;else if(l.wasmMemory)T=l.wasmMemory;else if(!((T=new WebAssembly.Memory({initial:ee/X,maximum:2147483648/X,shared:!0})).buffer instanceof SharedArrayBuffer))throw I("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),p&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");function te(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?l.dynCall_v(n):l.dynCall_vi(n,t.arg):n(void 0===t.arg?null:t.arg)}else t(l)}}T&&(H=T.buffer),ee=H.byteLength,Z(H),g||(i()[Q>>2]=J);var ne=[],re=[],ie=[],ae=[],oe=[];function se(){if(!g){if(l.preRun)for("function"==typeof l.preRun&&(l.preRun=[l.preRun]);l.preRun.length;)de(l.preRun.shift());te(ne)}}function le(){te(re)}function ue(){g||te(ie)}function ce(){if(!g){if(l.postRun)for("function"==typeof l.postRun&&(l.postRun=[l.postRun]);l.postRun.length;)he(l.postRun.shift());te(oe)}}function de(e){ne.unshift(e)}function he(e){oe.unshift(e)}var fe=Math.ceil,pe=Math.floor,me=0,ge=null,ve=null;function ye(e){N(!g,"addRunDependency cannot be used in a pthread worker"),me++,l.monitorRunDependencies&&l.monitorRunDependencies(me)}function be(e){if(me--,l.monitorRunDependencies&&l.monitorRunDependencies(me),0==me&&(null!==ge&&(clearInterval(ge),ge=null),ve)){var t=ve;ve=null,t()}}function xe(e){throw l.onAbort&&l.onAbort(e),g&&console.error("Pthread aborting at "+(new Error).stack),C(e+=""),I(e),M=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(e)}function we(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}l.preloadedImages={},l.preloadedAudios={};var _e="data:application/octet-stream;base64,";function ke(e){return we(e,_e)}var Ee="file://";function Se(e){return we(e,Ee)}var Te="tfjs-backend-wasm-threaded-simd.wasm";function Ce(){try{if(E)return new Uint8Array(E);if(y)return y(Te);throw"both async and sync fetching of the wasm failed"}catch(I){xe(I)}}function Ie(){return E||!h&&!f||"function"!=typeof fetch||Se(Te)?new Promise((function(e,t){e(Ce())})):fetch(Te,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+Te+"'";return e.arrayBuffer()})).catch((function(){return Ce()}))}function Ae(){var e={a:Vt};function t(e,t){if(l.asm=e.exports,A=t,!g){var n=He.unusedWorkers.length;He.unusedWorkers.forEach((function(e){He.loadWasmModuleToWorker(e,(function(){--n||be()}))}))}}function n(e){t(e.instance,e.module)}function r(t){return Ie().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){I("failed to asynchronously prepare wasm: "+e),xe(e)}))}if(g||ye(),l.instantiateWasm)try{return l.instantiateWasm(e,t)}catch(fn){return I("Module.instantiateWasm callback failed with error: "+fn),!1}return function(){if(E||"function"!=typeof WebAssembly.instantiateStreaming||ke(Te)||Se(Te)||"function"!=typeof fetch)return r(n);fetch(Te,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){I("wasm streaming compile failed: "+e),I("falling back to ArrayBuffer instantiation"),r(n)}))}))}(),{}}ke(Te)||(Te=_(Te));var Oe={};function De(){He.initRuntime()}g||re.push({func:function(){Yt()}});var Me=0,Ne=0,je=0;function Fe(e,t,n){Me=e|=0,je=t|=0,Ne=n|=0}l.__register_pthread_ptr=Fe;var Re={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135},Pe=13568;function Le(e,n){if(e<=0||e>t().length||!0&e||n<0)return-28;if(0==n)return 0;n>=2147483647&&(n=1/0);var r=Atomics.load(i(),Pe>>2),a=0;if(r==e&&Atomics.compareExchange(i(),Pe>>2,r,0)==r&&(a=1,--n<=0))return 1;var o=Atomics.notify(i(),e>>2,n);if(o>=0)return o+a;throw"Atomics.notify returned an unexpected value "+o}function Be(e){if(g)throw"Internal Error! _kill_thread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in _kill_thread!";i()[e+12>>2]=0;var t=He.pthreads[e];t.worker.terminate(),He.freeThreadData(t),He.runningWorkers.splice(He.runningWorkers.indexOf(t.worker),1),t.worker.pthread=void 0}function $e(e){if(g)throw"Internal Error! _cancel_thread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in _cancel_thread!";He.pthreads[e].worker.postMessage({cmd:"cancel"})}function ze(e){if(g)throw"Internal Error! _cleanup_thread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in _cleanup_thread!";i()[e+12>>2]=0;var t=He.pthreads[e];t&&He.returnWorkerToPool(t.worker)}l._emscripten_futex_wake=Le;var Ue,He={MAIN_THREAD_ID:1,mainThreadInfo:{schedPolicy:0,schedPrio:0},unusedWorkers:[],runningWorkers:[],initRuntime:function(){Fe(He.mainThreadBlock,!f,1),nn(He.mainThreadBlock)},initMainThreadBlock:function(){for(var e=0;e<8;++e)He.allocateUnusedWorker();for(He.mainThreadBlock=12816,e=0;e<58;++e)a()[He.mainThreadBlock/4+e]=0;i()[He.mainThreadBlock+12>>2]=He.mainThreadBlock;var t=He.mainThreadBlock+156;for(i()[t>>2]=t,e=0;e<128;++e)a()[3264+e]=0;Atomics.store(a(),He.mainThreadBlock+104>>2,13056),Atomics.store(a(),He.mainThreadBlock+40>>2,He.mainThreadBlock),Atomics.store(a(),He.mainThreadBlock+44>>2,42)},initWorker:function(){},pthreads:{},exitHandlers:null,setThreadStatus:function(){},runExitHandlers:function(){if(null!==He.exitHandlers){for(;He.exitHandlers.length>0;)He.exitHandlers.pop()();He.exitHandlers=null}g&&D&&en()},threadExit:function(e){var t=$t();t&&(Atomics.store(a(),t+4>>2,e),Atomics.store(a(),t+0>>2,1),Atomics.store(a(),t+60>>2,1),Atomics.store(a(),t+64>>2,0),He.runExitHandlers(),Le(t+0,2147483647),Fe(0,0,0),D=0,g&&postMessage({cmd:"exit"}))},threadCancel:function(){He.runExitHandlers(),Atomics.store(a(),D+4>>2,-1),Atomics.store(a(),D+0>>2,1),Le(D+0,2147483647),D=0,Fe(0,0,0),postMessage({cmd:"cancelDone"})},terminateAllThreads:function(){for(var e in He.pthreads)(r=He.pthreads[e])&&r.worker&&He.returnWorkerToPool(r.worker);He.pthreads={};for(var t=0;t<He.unusedWorkers.length;++t)(n=He.unusedWorkers[t]).terminate();for(He.unusedWorkers=[],t=0;t<He.runningWorkers.length;++t){var n,r;He.freeThreadData(r=(n=He.runningWorkers[t]).pthread),n.terminate()}He.runningWorkers=[]},freeThreadData:function(e){if(e){if(e.threadInfoStruct){var t=i()[e.threadInfoStruct+104>>2];i()[e.threadInfoStruct+104>>2]=0,Kt(t),Kt(e.threadInfoStruct)}e.threadInfoStruct=0,e.allocatedOwnStack&&e.stackBase&&Kt(e.stackBase),e.stackBase=0,e.worker&&(e.worker.pthread=null)}},returnWorkerToPool:function(e){delete He.pthreads[e.pthread.thread],He.unusedWorkers.push(e),He.runningWorkers.splice(He.runningWorkers.indexOf(e),1),He.freeThreadData(e.pthread),e.pthread=void 0},receiveObjectTransfer:function(e){},loadWasmModuleToWorker:function(e,t){e.onmessage=function(n){var r=n.data,i=r.cmd;if(e.pthread&&(He.currentProxiedOperationCallerThread=e.pthread.threadInfoStruct),r.targetThread&&r.targetThread!=$t()){var o=He.pthreads[r.targetThread];return o?o.worker.postMessage(n.data,r.transferList):console.error('Internal error! Worker sent a message "'+i+'" to target pthread '+r.targetThread+", but that thread no longer exists!"),void(He.currentProxiedOperationCallerThread=void 0)}"processQueuedMainThreadWork"===i?tn():"spawnThread"===i?Lt(n.data):"cleanupThread"===i?ze(r.thread):"killThread"===i?Be(r.thread):"cancelThread"===i?$e(r.thread):"loaded"===i?(e.loaded=!0,t&&t(e),e.runPthread&&(e.runPthread(),delete e.runPthread)):"print"===i?C("Thread "+r.threadId+": "+r.text):"printErr"===i?I("Thread "+r.threadId+": "+r.text):"alert"===i?alert("Thread "+r.threadId+": "+r.text):"exit"===i?e.pthread&&Atomics.load(a(),e.pthread.thread+68>>2)&&He.returnWorkerToPool(e):"cancelDone"===i?He.returnWorkerToPool(e):"objectTransfer"===i?He.receiveObjectTransfer(n.data):"setimmediate"===n.data.target?e.postMessage(n.data):I("worker sent an unknown command "+i),He.currentProxiedOperationCallerThread=void 0},e.onerror=function(e){I("pthread sent an error! "+e.filename+":"+e.lineno+": "+e.message)},p&&(e.on("message",(function(t){e.onmessage({data:t})})),e.on("error",(function(t){e.onerror(t)})),e.on("exit",(function(e){console.log("worker exited - TODO: update the worker queue?")}))),e.postMessage({cmd:"load",urlOrBlob:l.mainScriptUrlOrBlob||u,wasmMemory:T,wasmModule:A,DYNAMIC_BASE:J,DYNAMICTOP_PTR:Q})},allocateUnusedWorker:function(){var e=_("tfjs-backend-wasm-threaded-simd.worker.js");He.unusedWorkers.push(new Worker(e))},getNewWorker:function(){return 0==He.unusedWorkers.length&&(He.allocateUnusedWorker(),He.loadWasmModuleToWorker(He.unusedWorkers[0])),He.unusedWorkers.length>0?He.unusedWorkers.pop():null},busySpinWait:function(e){for(var t=performance.now()+e;performance.now()<t;);}};function We(e,t){un(e)}function Ve(){return S}function qe(e,t,n,r){xe("Assertion failed: "+L(e)+", at: "+[t?L(t):"unknown filename",n,r?L(r):"unknown function"])}function Ge(e,t){_main(e,t)}function Ye(e){return i()[Jt()>>2]=e,e}function Xe(e,t){if(g)return it(1,1,e,t);ae.unshift({func:e,arg:t})}function Ke(e,t){if(e==t)postMessage({cmd:"processQueuedMainThreadWork"});else if(g)postMessage({targetThread:e,cmd:"processThreadQueue"});else{var n=He.pthreads[e],r=n&&n.worker;if(!r)return;r.postMessage({cmd:"processThreadQueue"})}return 1}function Ze(){xe()}function Je(e,t){}function Qe(e,n,r){if(e<=0||e>t().length||!0&e)return-28;if(f){var a=Atomics.wait(i(),e>>2,n,r);if("timed-out"===a)return-73;if("not-equal"===a)return-6;if("ok"===a)return 0;throw"Atomics.wait returned an unexpected value "+a}if(n!=Atomics.load(i(),e>>2))return-6;var o=performance.now(),s=o+r;Atomics.store(i(),Pe>>2,e);for(var l=e;e==l;){if((o=performance.now())>s)return-73;tn(),e=Atomics.load(i(),Pe>>2)}return 0}function et(){return 0|je}function tt(){return 0|Ne}function nt(e,t,n){r().copyWithin(e,t,t+n)}function rt(){return navigator.hardwareConcurrency}function it(e,t){for(var n=arguments.length-2,r=sn(),i=ln(8*n),a=i>>3,s=0;s<n;s++)o()[a+s]=arguments[2+s];var l=an(e,n,i,t);return un(r),l}l.establishStackSpace=We,l.getNoExitRuntime=Ve,Ue=p?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:g?function(){return performance.now()-l.__performance_now_clock_drift}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var at=[];function ot(e,t){ot.array||(ot.array=[]);var n,a=ot.array;for(a.length=0;n=r()[e++];)100===n||102===n?(t=t+7&-8,a.push(o()[t>>3]),t+=8):(t=t+3&-4,a.push(i()[t>>2]),t+=4);return a}function st(e,t,n){at.length=t;for(var r=n>>3,i=0;i<t;i++)at[i]=o()[r+i];var a=e<0,s=a?Oe[-e-1]:Wt[e];if(a){var l=ot(at[1],at[2]);return s.apply(null,l)}return s.apply(null,at)}function lt(){return r().length}function ut(e){try{return T.grow(e-H.byteLength+65535>>>16),Z(T.buffer),1}catch(fn){}}function ct(e){e>>>=0;var t=lt();if(e<=t)return!1;var n=2147483648;if(e>n)return!1;for(var r=1;r<=4;r*=2){var i=t*(1+.2/r);if(i=Math.min(i,e+100663296),ut(Math.min(n,K(Math.max(16777216,e,i),65536))))return!0}return!1}var dt={keyEvent:0,mouseEvent:0,wheelEvent:0,uiEvent:0,focusEvent:0,deviceOrientationEvent:0,deviceMotionEvent:0,fullscreenChangeEvent:0,pointerlockChangeEvent:0,visibilityChangeEvent:0,touchEvent:0,previousFullscreenElement:null,previousScreenX:null,previousScreenY:null,removeEventListenersRegistered:!1,removeAllEventListeners:function(){for(var e=dt.eventHandlers.length-1;e>=0;--e)dt._removeHandler(e);dt.eventHandlers=[],dt.deferredCalls=[]},registerRemoveEventListeners:function(){dt.removeEventListenersRegistered||(ae.push(dt.removeAllEventListeners),dt.removeEventListenersRegistered=!0)},deferredCalls:[],deferCall:function(e,t,n){function r(e,t){if(e.length!=t.length)return!1;for(var n in e)if(e[n]!=t[n])return!1;return!0}for(var i in dt.deferredCalls){var a=dt.deferredCalls[i];if(a.targetFunction==e&&r(a.argsList,n))return}dt.deferredCalls.push({targetFunction:e,precedence:t,argsList:n}),dt.deferredCalls.sort((function(e,t){return e.precedence<t.precedence}))},removeDeferredCalls:function(e){for(var t=0;t<dt.deferredCalls.length;++t)dt.deferredCalls[t].targetFunction==e&&(dt.deferredCalls.splice(t,1),--t)},canPerformEventHandlerRequests:function(){return dt.inEventHandler&&dt.currentEventHandler.allowsDeferredCalls},runDeferredCalls:function(){if(dt.canPerformEventHandlerRequests())for(var e=0;e<dt.deferredCalls.length;++e){var t=dt.deferredCalls[e];dt.deferredCalls.splice(e,1),--e,t.targetFunction.apply(null,t.argsList)}},inEventHandler:0,currentEventHandler:null,eventHandlers:[],removeAllHandlersOnTarget:function(e,t){for(var n=0;n<dt.eventHandlers.length;++n)dt.eventHandlers[n].target!=e||t&&t!=dt.eventHandlers[n].eventTypeString||dt._removeHandler(n--)},_removeHandler:function(e){var t=dt.eventHandlers[e];t.target.removeEventListener(t.eventTypeString,t.eventListenerFunc,t.useCapture),dt.eventHandlers.splice(e,1)},registerOrRemoveHandler:function(e){var t=function(t){++dt.inEventHandler,dt.currentEventHandler=e,dt.runDeferredCalls(),e.handlerFunc(t),dt.runDeferredCalls(),--dt.inEventHandler};if(e.callbackfunc)e.eventListenerFunc=t,e.target.addEventListener(e.eventTypeString,t,e.useCapture),dt.eventHandlers.push(e),dt.registerRemoveEventListeners();else for(var n=0;n<dt.eventHandlers.length;++n)dt.eventHandlers[n].target==e.target&&dt.eventHandlers[n].eventTypeString==e.eventTypeString&&dt._removeHandler(n--)},queueEventHandlerOnThread_iiii:function(e,t,n,r,a){var o=sn(),s=ln(12);i()[s>>2]=n,i()[s+4>>2]=r,i()[s+8>>2]=a,on(e,637534208,t,r,s),un(o)},getTargetThreadForEventCallback:function(e){switch(e){case 1:return 0;case 2:return He.currentProxiedOperationCallerThread;default:return e}},getNodeNameForTarget:function(e){return e?e==window?"#window":e==screen?"#screen":e&&e.nodeName?e.nodeName:"":""},fullscreenEnabled:function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}};function ht(e){var t=z(e)+1,n=Xt(t);return $(e,n,t),n}function ft(e,t,n,r){var a=sn(),o=ln(12),s=0;t&&(s=ht(t)),i()[o>>2]=s,i()[o+4>>2]=n,i()[o+8>>2]=r,on(e,657457152,0,s,o),un(a)}function pt(e,t,n,r){ft(e,t=t?L(t):"",n,r)}function mt(e){return e>2?L(e):e}var gt=[0,"undefined"!=typeof document?document:0,"undefined"!=typeof window?window:0];function vt(e){return e=mt(e),gt[e]||("undefined"!=typeof document?document.querySelector(e):void 0)}function yt(e){return vt(e)}function bt(e,t,n){var r=yt(e);if(!r)return-4;if(r.canvasSharedPtr&&(i()[r.canvasSharedPtr>>2]=t,i()[r.canvasSharedPtr+4>>2]=n),!r.offscreenCanvas&&r.controlTransferredOffscreen)return r.canvasSharedPtr?(pt(i()[r.canvasSharedPtr+8>>2],e,t,n),1):-4;r.offscreenCanvas&&(r=r.offscreenCanvas);var a=!1;if(r.GLctxObject&&r.GLctxObject.GLctx){var o=r.GLctxObject.GLctx.getParameter(2978);a=0===o[0]&&0===o[1]&&o[2]===r.width&&o[3]===r.height}return r.width=t,r.height=n,a&&r.GLctxObject.GLctx.viewport(0,0,t,n),0}function xt(e,t,n){return g?it(2,1,e,t,n):bt(e,t,n)}function wt(e,t,n){return yt(e)?bt(e,t,n):xt(e,t,n)}function _t(e){}function kt(e,t){}function Et(e){var t=e.getExtension("ANGLE_instanced_arrays");if(t)return e.vertexAttribDivisor=function(e,n){t.vertexAttribDivisorANGLE(e,n)},e.drawArraysInstanced=function(e,n,r,i){t.drawArraysInstancedANGLE(e,n,r,i)},e.drawElementsInstanced=function(e,n,r,i,a){t.drawElementsInstancedANGLE(e,n,r,i,a)},1}function St(e){var t=e.getExtension("OES_vertex_array_object");if(t)return e.createVertexArray=function(){return t.createVertexArrayOES()},e.deleteVertexArray=function(e){t.deleteVertexArrayOES(e)},e.bindVertexArray=function(e){t.bindVertexArrayOES(e)},e.isVertexArray=function(e){return t.isVertexArrayOES(e)},1}function Tt(e){var t=e.getExtension("WEBGL_draw_buffers");if(t)return e.drawBuffers=function(e,n){t.drawBuffersWEBGL(e,n)},1}var Ct={counter:1,lastError:0,buffers:[],mappedBuffers:{},programs:[],framebuffers:[],renderbuffers:[],textures:[],uniforms:[],shaders:[],vaos:[],contexts:{},currentContext:null,offscreenCanvases:{},timerQueriesEXT:[],programInfos:{},stringCache:{},unpackAlignment:4,init:function(){for(var e=new Float32Array(Ct.MINI_TEMP_BUFFER_SIZE),t=0;t<Ct.MINI_TEMP_BUFFER_SIZE;t++)Ct.miniTempBufferFloatViews[t]=e.subarray(0,t+1);var n=new Int32Array(Ct.MINI_TEMP_BUFFER_SIZE);for(t=0;t<Ct.MINI_TEMP_BUFFER_SIZE;t++)Ct.miniTempBufferIntViews[t]=n.subarray(0,t+1)},recordError:function(e){Ct.lastError||(Ct.lastError=e)},getNewId:function(e){for(var t=Ct.counter++,n=e.length;n<t;n++)e[n]=null;return t},MINI_TEMP_BUFFER_SIZE:256,miniTempBufferFloatViews:[0],miniTempBufferIntViews:[0],getSource:function(e,t,n,r){for(var a="",o=0;o<t;++o){var s=r?i()[r+4*o>>2]:-1;a+=L(i()[n+4*o>>2],s<0?void 0:s)}return a},createContext:function(e,t){var n=e.getContext("webgl",t);return n?Ct.registerContext(n,t):0},registerContext:function(e,t){var n=Xt(8);i()[n+4>>2]=$t();var r={handle:n,attributes:t,version:t.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=r),Ct.contexts[n]=r,(void 0===t.enableExtensionsByDefault||t.enableExtensionsByDefault)&&Ct.initExtensions(r),n},makeContextCurrent:function(e){return Ct.currentContext=Ct.contexts[e],l.ctx=Dt=Ct.currentContext&&Ct.currentContext.GLctx,!(e&&!Dt)},getContext:function(e){return Ct.contexts[e]},deleteContext:function(e){Ct.currentContext===Ct.contexts[e]&&(Ct.currentContext=null),"object"==typeof dt&&dt.removeAllHandlersOnTarget(Ct.contexts[e].GLctx.canvas),Ct.contexts[e]&&Ct.contexts[e].GLctx.canvas&&(Ct.contexts[e].GLctx.canvas.GLctxObject=void 0),Kt(Ct.contexts[e].handle),Ct.contexts[e]=null},initExtensions:function(e){if(e||(e=Ct.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var t=e.GLctx;Et(t),St(t),Tt(t),t.disjointTimerQueryExt=t.getExtension("EXT_disjoint_timer_query");var n=["OES_texture_float","OES_texture_half_float","OES_standard_derivatives","OES_vertex_array_object","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","OES_element_index_uint","EXT_texture_filter_anisotropic","EXT_frag_depth","WEBGL_draw_buffers","ANGLE_instanced_arrays","OES_texture_float_linear","OES_texture_half_float_linear","EXT_blend_minmax","EXT_shader_texture_lod","EXT_texture_norm16","WEBGL_compressed_texture_pvrtc","EXT_color_buffer_half_float","WEBGL_color_buffer_float","EXT_sRGB","WEBGL_compressed_texture_etc1","EXT_disjoint_timer_query","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_astc","EXT_color_buffer_float","WEBGL_compressed_texture_s3tc_srgb","EXT_disjoint_timer_query_webgl2","WEBKIT_WEBGL_compressed_texture_pvrtc"];(t.getSupportedExtensions()||[]).forEach((function(e){-1!=n.indexOf(e)&&t.getExtension(e)}))}},populateUniformTable:function(e){for(var t=Ct.programs[e],n=Ct.programInfos[e]={uniforms:{},maxUniformLength:0,maxAttributeLength:-1,maxUniformBlockNameLength:-1},r=n.uniforms,i=Dt.getProgramParameter(t,35718),a=0;a<i;++a){var o=Dt.getActiveUniform(t,a),s=o.name;n.maxUniformLength=Math.max(n.maxUniformLength,s.length+1),"]"==s.slice(-1)&&(s=s.slice(0,s.lastIndexOf("[")));var l=Dt.getUniformLocation(t,s);if(l){var u=Ct.getNewId(Ct.uniforms);r[s]=[o.size,u],Ct.uniforms[u]=l;for(var c=1;c<o.size;++c)l=Dt.getUniformLocation(t,s+"["+c+"]"),u=Ct.getNewId(Ct.uniforms),Ct.uniforms[u]=l}}}},It=["default","low-power","high-performance"];function At(e,t){var n={},r=t>>2;n.alpha=!!i()[r+0],n.depth=!!i()[r+1],n.stencil=!!i()[r+2],n.antialias=!!i()[r+3],n.premultipliedAlpha=!!i()[r+4],n.preserveDrawingBuffer=!!i()[r+5];var a=i()[r+6];n.powerPreference=It[a],n.failIfMajorPerformanceCaveat=!!i()[r+7],n.majorVersion=i()[r+8],n.minorVersion=i()[r+9],n.enableExtensionsByDefault=i()[r+10],n.explicitSwapControl=i()[r+11],n.proxyContextToMainThread=i()[r+12],n.renderViaOffscreenBackBuffer=i()[r+13];var o=yt(e);return o?n.explicitSwapControl?-1:Ct.createContext(o,n):-4}function Ot(e,t){return At(e,t)}var Dt,Mt={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var n=Mt.buffers[e];0===t||10===t?((1===e?C:I)(P(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function(){return Mt.varargs+=4,i()[Mt.varargs-4>>2]},getStr:function(e){return L(e)},get64:function(e,t){return e}};function Nt(e){return g?it(3,1,e):0}function jt(e,t,n,r,i){if(g)return it(4,1,e,t,n,r,i)}function Ft(e,t,n,a){if(g)return it(5,1,e,t,n,a);for(var o=0,s=0;s<n;s++){for(var l=i()[t+8*s>>2],u=i()[t+(8*s+4)>>2],c=0;c<u;c++)Mt.printChar(e,r()[l+c]);o+=u}return i()[a>>2]=o,0}function Rt(e){var t=He.exitHandlers.pop();e&&t()}function Pt(e,t){null===He.exitHandlers&&(He.exitHandlers=[]),He.exitHandlers.push((function(){cn(e,t)}))}function Lt(e){if(g)throw"Internal Error! _spawn_thread() can only ever be called from main application thread!";var t=He.getNewWorker();if(void 0!==t.pthread)throw"Internal error!";if(!e.pthread_ptr)throw"Internal error, no pthread ptr!";He.runningWorkers.push(t);for(var n=Xt(512),r=0;r<128;++r)i()[n+4*r>>2]=0;var o=e.stackBase+e.stackSize,s=He.pthreads[e.pthread_ptr]={worker:t,stackBase:e.stackBase,stackSize:e.stackSize,allocatedOwnStack:e.allocatedOwnStack,thread:e.pthread_ptr,threadInfoStruct:e.pthread_ptr},l=s.threadInfoStruct>>2;Atomics.store(a(),l+0,0),Atomics.store(a(),l+1,0),Atomics.store(a(),l+2,0),Atomics.store(a(),l+17,e.detached),Atomics.store(a(),l+26,n),Atomics.store(a(),l+12,0),Atomics.store(a(),l+10,s.threadInfoStruct),Atomics.store(a(),l+11,42),Atomics.store(a(),l+27,e.stackSize),Atomics.store(a(),l+21,e.stackSize),Atomics.store(a(),l+20,o),Atomics.store(a(),l+29,o),Atomics.store(a(),l+30,e.detached),Atomics.store(a(),l+32,e.schedPolicy),Atomics.store(a(),l+33,e.schedPrio);var u=Zt()+40;Atomics.store(a(),l+44,u),t.pthread=s;var c={cmd:"run",start_routine:e.startRoutine,arg:e.arg,threadInfoStruct:e.pthread_ptr,selfThreadId:e.pthread_ptr,parentThreadId:e.parent_pthread_ptr,stackBase:e.stackBase,stackSize:e.stackSize};t.runPthread=function(){c.time=performance.now(),t.postMessage(c,e.transferList)},t.loaded&&(t.runPthread(),delete t.runPthread)}function Bt(e,t,n){if(!t&&!n)return Re.EINVAL;if(!e)return I("pthread_getschedparam called with a null thread pointer!"),Re.ESRCH;if(i()[e+12>>2]!==e)return I("pthread_getschedparam attempted on thread "+e+", which does not point to a valid thread, or does not exist anymore!"),Re.ESRCH;var r=Atomics.load(a(),e+108+20>>2),o=Atomics.load(a(),e+108+24>>2);return t&&(i()[t>>2]=r),n&&(i()[n>>2]=o),0}function $t(){return 0|Me}function zt(e,t,n,r){if("undefined"==typeof SharedArrayBuffer)return I("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;if(!e)return I("pthread_create called with a null thread pointer!"),28;var o=[];if(g&&0===o.length)return rn(687865856,e,t,n,r);var s=0,l=0,u=0,c=0,d=0;if(t)if(s=i()[t>>2],s+=81920,l=i()[t+8>>2],u=0!==i()[t+12>>2],0===i()[t+16>>2]){var h=i()[t+20>>2],f=i()[t+24>>2];Bt(He.currentProxiedOperationCallerThread?He.currentProxiedOperationCallerThread:$t(),t+20,t+24),c=i()[t+20>>2],d=i()[t+24>>2],i()[t+20>>2]=h,i()[t+24>>2]=f}else c=i()[t+20>>2],d=i()[t+24>>2];else s=2097152;var p=0==l;p?l=Qt(16,s):N((l-=s)>0);for(var m=Xt(232),v=0;v<58;++v)a()[(m>>2)+v]=0;i()[e>>2]=m,i()[m+12>>2]=m;var y=m+156;i()[y>>2]=y;var b={stackBase:l,stackSize:s,allocatedOwnStack:p,schedPolicy:c,schedPrio:d,detached:u,startRoutine:n,pthread_ptr:m,parent_pthread_ptr:$t(),arg:r,transferList:o};return g?(b.cmd="spawnThread",postMessage(b,o)):Lt(b),0}function Ut(e){return(e=+e)>=0?+pe(e+.5):+fe(e-.5)}function Ht(e){if(g)return it(6,1,e);switch(e){case 30:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:case 79:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return Ye(28),-1}l._pthread_self=$t,g?He.initWorker():He.initMainThreadBlock(),Ct.init();var Wt=[null,Xe,xt,Nt,jt,Ft,Ht],Vt={e:qe,r:Ge,w:Ke,a:Ze,l:Je,d:Qe,c:Le,h:Ue,g:et,x:tt,q:nt,B:rt,t:st,A:ct,u:wt,k:_t,s:kt,v:Ot,m:Nt,o:jt,i:Ft,p:De,memory:T||l.wasmMemory,y:Rt,z:Pt,j:zt,b:$t,f:Ut,n:Ht,table:O},qt=Ae();l.asm=qt;var Gt,Yt=l.___wasm_call_ctors=function(){return(Yt=l.___wasm_call_ctors=l.asm.C).apply(null,arguments)},Xt=(l._init=function(){return(l._init=l.asm.D).apply(null,arguments)},l._register_tensor=function(){return(l._register_tensor=l.asm.E).apply(null,arguments)},l._dispose_data=function(){return(l._dispose_data=l.asm.F).apply(null,arguments)},l._dispose=function(){return(l._dispose=l.asm.G).apply(null,arguments)},l._Abs=function(){return(l._Abs=l.asm.H).apply(null,arguments)},l._Add=function(){return(l._Add=l.asm.I).apply(null,arguments)},l._AddN=function(){return(l._AddN=l.asm.J).apply(null,arguments)},l._ArgMax=function(){return(l._ArgMax=l.asm.K).apply(null,arguments)},l._AvgPool=function(){return(l._AvgPool=l.asm.L).apply(null,arguments)},l._BatchMatMul=function(){return(l._BatchMatMul=l.asm.M).apply(null,arguments)},l._ClipByValue=function(){return(l._ClipByValue=l.asm.N).apply(null,arguments)},l._Conv2D=function(){return(l._Conv2D=l.asm.O).apply(null,arguments)},l._Conv2DBackpropInput=function(){return(l._Conv2DBackpropInput=l.asm.P).apply(null,arguments)},l._Cos=function(){return(l._Cos=l.asm.Q).apply(null,arguments)},l._CropAndResize=function(){return(l._CropAndResize=l.asm.R).apply(null,arguments)},l._Cumsum=function(){return(l._Cumsum=l.asm.S).apply(null,arguments)},l._DepthToSpace=function(){return(l._DepthToSpace=l.asm.T).apply(null,arguments)},l._DepthwiseConv2dNative=function(){return(l._DepthwiseConv2dNative=l.asm.U).apply(null,arguments)},l._Equal=function(){return(l._Equal=l.asm.V).apply(null,arguments)},l._Exp=function(){return(l._Exp=l.asm.W).apply(null,arguments)},l._FlipLeftRight=function(){return(l._FlipLeftRight=l.asm.X).apply(null,arguments)},l._Floor=function(){return(l._Floor=l.asm.Y).apply(null,arguments)},l._FloorDiv=function(){return(l._FloorDiv=l.asm.Z).apply(null,arguments)},l._FusedBatchNorm=function(){return(l._FusedBatchNorm=l.asm._).apply(null,arguments)},l._FusedConv2D=function(){return(l._FusedConv2D=l.asm.$).apply(null,arguments)},l._FusedDepthwiseConv2D=function(){return(l._FusedDepthwiseConv2D=l.asm.aa).apply(null,arguments)},l._Gather=function(){return(l._Gather=l.asm.ba).apply(null,arguments)},l._GatherNd=function(){return(l._GatherNd=l.asm.ca).apply(null,arguments)},l._Greater=function(){return(l._Greater=l.asm.da).apply(null,arguments)},l._GreaterEqual=function(){return(l._GreaterEqual=l.asm.ea).apply(null,arguments)},l._LeakyRelu=function(){return(l._LeakyRelu=l.asm.fa).apply(null,arguments)},l._Less=function(){return(l._Less=l.asm.ga).apply(null,arguments)},l._LessEqual=function(){return(l._LessEqual=l.asm.ha).apply(null,arguments)},l._Log=function(){return(l._Log=l.asm.ia).apply(null,arguments)},l._LogicalAnd=function(){return(l._LogicalAnd=l.asm.ja).apply(null,arguments)},l._Max=function(){return(l._Max=l.asm.ka).apply(null,arguments)},l._MaxPool=function(){return(l._MaxPool=l.asm.la).apply(null,arguments)},l._Maximum=function(){return(l._Maximum=l.asm.ma).apply(null,arguments)},l._Mean=function(){return(l._Mean=l.asm.na).apply(null,arguments)},l._Min=function(){return(l._Min=l.asm.oa).apply(null,arguments)},l._Minimum=function(){return(l._Minimum=l.asm.pa).apply(null,arguments)},l._Multiply=function(){return(l._Multiply=l.asm.qa).apply(null,arguments)},l._Neg=function(){return(l._Neg=l.asm.ra).apply(null,arguments)},l._NonMaxSuppressionV3=function(){return(l._NonMaxSuppressionV3=l.asm.sa).apply(null,arguments)},l._NonMaxSuppressionV4=function(){return(l._NonMaxSuppressionV4=l.asm.ta).apply(null,arguments)},l._NonMaxSuppressionV5=function(){return(l._NonMaxSuppressionV5=l.asm.ua).apply(null,arguments)},l._NotEqual=function(){return(l._NotEqual=l.asm.va).apply(null,arguments)},l._OneHot=function(){return(l._OneHot=l.asm.wa).apply(null,arguments)},l._PadV2=function(){return(l._PadV2=l.asm.xa).apply(null,arguments)},l._Pow=function(){return(l._Pow=l.asm.ya).apply(null,arguments)},l._Prelu=function(){return(l._Prelu=l.asm.za).apply(null,arguments)},l._Prod=function(){return(l._Prod=l.asm.Aa).apply(null,arguments)},l._RealDiv=function(){return(l._RealDiv=l.asm.Ba).apply(null,arguments)},l._Relu=function(){return(l._Relu=l.asm.Ca).apply(null,arguments)},l._Relu6=function(){return(l._Relu6=l.asm.Da).apply(null,arguments)},l._ResizeBilinear=function(){return(l._ResizeBilinear=l.asm.Ea).apply(null,arguments)},l._Reverse=function(){return(l._Reverse=l.asm.Fa).apply(null,arguments)},l._RotateWithOffset=function(){return(l._RotateWithOffset=l.asm.Ga).apply(null,arguments)},l._Rsqrt=function(){return(l._Rsqrt=l.asm.Ha).apply(null,arguments)},l._ScatterNd=function(){return(l._ScatterNd=l.asm.Ia).apply(null,arguments)},l._SelectV2=function(){return(l._SelectV2=l.asm.Ja).apply(null,arguments)},l._Sigmoid=function(){return(l._Sigmoid=l.asm.Ka).apply(null,arguments)},l._Sin=function(){return(l._Sin=l.asm.La).apply(null,arguments)},l._Softmax=function(){return(l._Softmax=l.asm.Ma).apply(null,arguments)},l._Sqrt=function(){return(l._Sqrt=l.asm.Na).apply(null,arguments)},l._Square=function(){return(l._Square=l.asm.Oa).apply(null,arguments)},l._SquaredDifference=function(){return(l._SquaredDifference=l.asm.Pa).apply(null,arguments)},l._StridedSlice=function(){return(l._StridedSlice=l.asm.Qa).apply(null,arguments)},l._Sub=function(){return(l._Sub=l.asm.Ra).apply(null,arguments)},l._Sum=function(){return(l._Sum=l.asm.Sa).apply(null,arguments)},l._Tanh=function(){return(l._Tanh=l.asm.Ta).apply(null,arguments)},l._Tile=function(){return(l._Tile=l.asm.Ua).apply(null,arguments)},l._TopK=function(){return(l._TopK=l.asm.Va).apply(null,arguments)},l._Transpose=function(){return(l._Transpose=l.asm.Wa).apply(null,arguments)},l.__FusedMatMul=function(){return(l.__FusedMatMul=l.asm.Xa).apply(null,arguments)},l._malloc=function(){return(Xt=l._malloc=l.asm.Ya).apply(null,arguments)}),Kt=l._free=function(){return(Kt=l._free=l.asm.Za).apply(null,arguments)},Zt=l._emscripten_get_global_libc=function(){return(Zt=l._emscripten_get_global_libc=l.asm._a).apply(null,arguments)},Jt=l.___errno_location=function(){return(Jt=l.___errno_location=l.asm.$a).apply(null,arguments)},Qt=(l.___em_js__initPthreadsJS=function(){return(l.___em_js__initPthreadsJS=l.asm.ab).apply(null,arguments)},l._memalign=function(){return(Qt=l._memalign=l.asm.bb).apply(null,arguments)}),en=l.___pthread_tsd_run_dtors=function(){return(en=l.___pthread_tsd_run_dtors=l.asm.cb).apply(null,arguments)},tn=l._emscripten_main_thread_process_queued_calls=function(){return(tn=l._emscripten_main_thread_process_queued_calls=l.asm.db).apply(null,arguments)},nn=(l._emscripten_current_thread_process_queued_calls=function(){return(l._emscripten_current_thread_process_queued_calls=l.asm.eb).apply(null,arguments)},l._emscripten_register_main_browser_thread_id=function(){return(nn=l._emscripten_register_main_browser_thread_id=l.asm.fb).apply(null,arguments)}),rn=(l._emscripten_main_browser_thread_id=function(){return(l._emscripten_main_browser_thread_id=l.asm.gb).apply(null,arguments)},l._emscripten_async_run_in_main_thread=function(){return(l._emscripten_async_run_in_main_thread=l.asm.hb).apply(null,arguments)},l._emscripten_sync_run_in_main_thread=function(){return(l._emscripten_sync_run_in_main_thread=l.asm.ib).apply(null,arguments)},l._emscripten_sync_run_in_main_thread_0=function(){return(l._emscripten_sync_run_in_main_thread_0=l.asm.jb).apply(null,arguments)},l._emscripten_sync_run_in_main_thread_1=function(){return(l._emscripten_sync_run_in_main_thread_1=l.asm.kb).apply(null,arguments)},l._emscripten_sync_run_in_main_thread_2=function(){return(l._emscripten_sync_run_in_main_thread_2=l.asm.lb).apply(null,arguments)},l._emscripten_sync_run_in_main_thread_xprintf_varargs=function(){return(l._emscripten_sync_run_in_main_thread_xprintf_varargs=l.asm.mb).apply(null,arguments)},l._emscripten_sync_run_in_main_thread_3=function(){return(l._emscripten_sync_run_in_main_thread_3=l.asm.nb).apply(null,arguments)},l._emscripten_sync_run_in_main_thread_4=function(){return(rn=l._emscripten_sync_run_in_main_thread_4=l.asm.ob).apply(null,arguments)}),an=(l._emscripten_sync_run_in_main_thread_5=function(){return(l._emscripten_sync_run_in_main_thread_5=l.asm.pb).apply(null,arguments)},l._emscripten_sync_run_in_main_thread_6=function(){return(l._emscripten_sync_run_in_main_thread_6=l.asm.qb).apply(null,arguments)},l._emscripten_sync_run_in_main_thread_7=function(){return(l._emscripten_sync_run_in_main_thread_7=l.asm.rb).apply(null,arguments)},l._emscripten_run_in_main_runtime_thread_js=function(){return(an=l._emscripten_run_in_main_runtime_thread_js=l.asm.sb).apply(null,arguments)}),on=l._emscripten_async_queue_on_thread_=function(){return(on=l._emscripten_async_queue_on_thread_=l.asm.tb).apply(null,arguments)},sn=(l._emscripten_tls_init=function(){return(l._emscripten_tls_init=l.asm.ub).apply(null,arguments)},l.stackSave=function(){return(sn=l.stackSave=l.asm.vb).apply(null,arguments)}),ln=l.stackAlloc=function(){return(ln=l.stackAlloc=l.asm.wb).apply(null,arguments)},un=l.stackRestore=function(){return(un=l.stackRestore=l.asm.xb).apply(null,arguments)},cn=l.dynCall_vi=function(){return(cn=l.dynCall_vi=l.asm.yb).apply(null,arguments)};function dn(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function hn(e){function t(){Gt||(Gt=!0,l.calledRun=!0,M||(le(),ue(),l.onRuntimeInitialized&&l.onRuntimeInitialized(),ce()))}e=e||d,me>0||(se(),me>0||(l.setStatus?(l.setStatus("Running..."),setTimeout((function(){setTimeout((function(){l.setStatus("")}),1),t()}),1)):t()))}if(l.dynCall_v=function(){return(l.dynCall_v=l.asm.zb).apply(null,arguments)},l.dynCall_ii=function(){return(l.dynCall_ii=l.asm.Ab).apply(null,arguments)},l.asm=qt,l.cwrap=R,l.PThread=He,l.PThread=He,l._pthread_self=$t,l.wasmMemory=T,l.ExitStatus=dn,l.then=function(e){if(Gt)e(l);else{var t=l.onRuntimeInitialized;l.onRuntimeInitialized=function(){t&&t(),e(l)}}return l},ve=function e(){Gt||hn(),Gt||(ve=e)},l.run=hn,l.preInit)for("function"==typeof l.preInit&&(l.preInit=[l.preInit]);l.preInit.length>0;)l.preInit.pop()();return g||(S=!0),g||hn(),e});e.exports=i},VmpX:function(e,t,n){const r=n("0eLh");e.exports=(e,t,n)=>r(e,t,">",n)},"W6+N":function(e,t,n){"undefined"!=typeof self&&self,e.exports=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=41)}([function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.external=void 0;var r=n(44),i=function(e){return e&&e.__esModule?e:{default:e}}(n(55)),a=null,o=r.enhancedNiftiReader;t.external={set cornerstone(e){(0,i.default)(a=e)},get cornerstone(){return a},set niftiReader(e){o=e},get niftiReader(){return o}}},function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)r(n,i)&&(e[i]=n[i])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){var t,n,r,i,a,o;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(o=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)o.set(a=e[t],i),i+=a.length;return o}},o={arraySet:function(e,t,n,r,i){for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(i)},function(e,t){e.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function a(){p&&h&&(p=!1,h.length?f=h.concat(f):m=-1,f.length&&o())}function o(){if(!p){var e=i(a);p=!0;for(var t=f.length;t;){for(h=f,f=[];++m<t;)h&&h[m].run();m=-1,t=f.length}h=null,p=!1,function(e){if(c===clearTimeout)return clearTimeout(e);if((c===r||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}(e)}}function s(e,t){this.fun=e,this.array=t}function l(){}var u,c,d=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{c="function"==typeof clearTimeout?clearTimeout:r}catch(e){c=r}}();var h,f=[],p=!1,m=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new s(e,t)),1!==f.length||p||i(o)},s.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.prependListener=l,d.prependOnceListener=l,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);u.call(this,e),c.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",i)}function i(){this.allowHalfOpen||this._writableState.ended||o(a,this)}function a(e){e.end()}var o=n(10),s=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=r;var l=n(7);l.inherits=n(3);var u=n(34),c=n(38);l.inherits(r,u);for(var d=s(c.prototype),h=0;h<d.length;h++){var f=d[h];r.prototype[f]||(r.prototype[f]=c.prototype[f])}Object.defineProperty(r.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),r.prototype._destroy=function(e,t){this.push(null),this.end(),o(t,e)}},function(e,t,n){"use strict";(function(e){function r(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function i(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return a.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=a.prototype:(null===e&&(e=new a(t)),e.length=t),e}function a(e,t,n){if(!(a.TYPED_ARRAY_SUPPORT||this instanceof a))return new a(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return o(this,e,t,n)}function o(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),a.TYPED_ARRAY_SUPPORT?(e=t).__proto__=a.prototype:e=u(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!a.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|d(t,n),o=(e=i(e,r)).write(t,n);return o!==r&&(e=e.slice(0,o)),e}(e,t,n):function(e,t){if(a.isBuffer(t)){var n=0|c(t.length);return 0===(e=i(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function(e){return e!=e}(t.length)?i(e,0):u(e,t);if("Buffer"===t.type&&z(t.data))return u(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t){if(s(t),e=i(e,t<0?0:0|c(t)),!a.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function u(e,t){var n=t.length<0?0:0|c(t.length);e=i(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function c(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function d(e,t){if(a.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return R(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return P(e).length;default:if(r)return R(e).length;t=(""+t).toLowerCase(),r=!0}}function h(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,n);case"utf8":case"utf-8":return k(this,t,n);case"ascii":return E(this,t,n);case"latin1":case"binary":return S(this,t,n);case"base64":return _(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function f(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function p(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=a.from(t,r)),a.isBuffer(t))return 0===t.length?-1:m(e,t,n,r,i);if("number"==typeof t)return t&=255,a.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):m(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,r,i){function a(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var o,s=1,l=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,l/=2,u/=2,n/=2}if(i){var c=-1;for(o=n;o<l;o++)if(a(e,o)===a(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===u)return c*s}else-1!==c&&(o-=o-c),c=-1}else for(n+u>l&&(n=l-u),o=n;o>=0;o--){for(var d=!0,h=0;h<u;h++)if(a(e,o+h)!==a(t,h)){d=!1;break}if(d)return o}return-1}function g(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function v(e,t,n,r){return L(R(t,e.length-n),e,n,r)}function y(e,t,n,r){return L(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function b(e,t,n,r){return y(e,t,n,r)}function x(e,t,n,r){return L(P(t),e,n,r)}function w(e,t,n,r){return L(function(e,t){for(var n,r,i=[],a=0;a<e.length&&!((t-=2)<0);++a)r=(n=e.charCodeAt(a))>>8,i.push(n%256),i.push(r);return i}(t,e.length-n),e,n,r)}function _(e,t,n){return B.fromByteArray(0===t&&n===e.length?e:e.slice(t,n))}function k(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,l,u=e[i],c=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=n)switch(d){case 1:u<128&&(c=u);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&u)<<6|63&a)>127&&(c=l);break;case 3:o=e[i+2],128==(192&(a=e[i+1]))&&128==(192&o)&&(l=(15&u)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:o=e[i+2],s=e[i+3],128==(192&(a=e[i+1]))&&128==(192&o)&&128==(192&s)&&(l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,d=1):c>65535&&(r.push((c-=65536)>>>10&1023|55296),c=56320|1023&c),r.push(c),i+=d}return function(e){var t=e.length;if(t<=U)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=U));return n}(r)}function E(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function S(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function T(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=F(e[a]);return i}function C(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function I(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function A(e,t,n,r,i,o){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function O(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);i<a;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function D(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);i<a;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function M(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function N(e,t,n,r,i){return i||M(e,0,n,4),$.write(e,t,n,r,23,4),n+4}function j(e,t,n,r,i){return i||M(e,0,n,8),$.write(e,t,n,r,52,8),n+8}function F(e){return e<16?"0"+e.toString(16):e.toString(16)}function R(e,t){t=t||1/0;for(var n,r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function P(e){return B.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(H,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function L(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}var B=n(73),$=n(74),z=n(30);t.Buffer=a,t.SlowBuffer=function(e){return+e!=e&&(e=0),a.alloc(+e)},t.INSPECT_MAX_BYTES=50,a.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=r(),a.poolSize=8192,a._augment=function(e){return e.__proto__=a.prototype,e},a.from=function(e,t,n){return o(null,e,t,n)},a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0})),a.alloc=function(e,t,n){return function(e,t,n,r){return s(t),t<=0?i(e,t):void 0!==n?"string"==typeof r?i(e,t).fill(n,r):i(e,t).fill(n):i(e,t)}(null,e,t,n)},a.allocUnsafe=function(e){return l(null,e)},a.allocUnsafeSlow=function(e){return l(null,e)},a.isBuffer=function(e){return!(null==e||!e._isBuffer)},a.compare=function(e,t){if(!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!z(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=a.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!a.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},a.byteLength=d,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)f(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)f(this,t,t+3),f(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)f(this,t,t+7),f(this,t+1,t+6),f(this,t+2,t+5),f(this,t+3,t+4);return this},a.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?k(this,0,e):h.apply(this,arguments)},a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},a.prototype.compare=function(e,t,n,r,i){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),l=Math.min(o,s),u=this.slice(r,i),c=e.slice(t,n),d=0;d<l;++d)if(u[d]!==c[d]){o=u[d],s=c[d];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},a.prototype.indexOf=function(e,t,n){return p(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return p(this,e,t,n,!1)},a.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return g(this,e,t,n);case"utf8":case"utf-8":return v(this,e,t,n);case"ascii":return y(this,e,t,n);case"latin1":case"binary":return b(this,e,t,n);case"base64":return x(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var U=4096;a.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),a.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=a.prototype;else{var i=t-e;n=new a(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},a.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},a.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},a.prototype.readUInt8=function(e,t){return t||I(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return t||I(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return t||I(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUInt32BE=function(e,t){return t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},a.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},a.prototype.readInt8=function(e,t){return t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},a.prototype.readInt16LE=function(e,t){t||I(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(e,t){t||I(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(e,t){return t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return t||I(e,4,this.length),$.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return t||I(e,4,this.length),$.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return t||I(e,8,this.length),$.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return t||I(e,8,this.length),$.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||A(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},a.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||A(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},a.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,1,255,0),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):O(this,e,t,!0),t+2},a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):O(this,e,t,!1),t+2},a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},a.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);A(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},a.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);A(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,1,127,-128),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):O(this,e,t,!0),t+2},a.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):O(this,e,t,!1),t+2},a.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},a.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},a.prototype.writeFloatLE=function(e,t,n){return N(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return N(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!a.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},a.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=a.isBuffer(e)?e:R(new a(e,r).toString()),l=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%l]}return this};var H=/[^+\/0-9A-Za-z-_]/g}).call(t,n(0))},function(e,t,n){(function(e){function n(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===n(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===n(e)},t.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(t,n(6).Buffer)},function(e,t,n){"use strict";function r(e){return void 0!==e}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n,r){var i=n.dimension,a=n.index;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.filePath=t,this.slice={dimension:i,index:a},this.timePoint=r}return i(e,[{key:"url",get:function(){var e="nifti:"+this.filePath;return(r(this.slice.dimension)||r(this.slice.index))&&(e+="#"),r(this.slice.dimension)&&(e+=this.slice.dimension,r(this.slice.index)&&(e+="-")),r(this.slice.index)&&(e+=this.slice.index),r(this.timePoint)&&(e+=",t-"+this.timePoint),e}}],[{key:"fromURL",value:function(t){var n=/^nifti:([^#]+)(?:#(?:(?=[xyz])(?:([xyz])(?:(?=-[\d]+)-([\d]+))?(?:,t-(\d+))?)|(?![xyz])([\d]+)))?$/.exec(t);if(!n)throw new Error("Not in a valid imageId format: "+t);return new e(n&&n[1],{dimension:n&&n[2]||"z",index:n&&parseInt(n[3]||n[5],0)||0},n&&n[4]&&parseInt(n[4],0)||0)}}]),e}();t.default=a},function(e,t,n){function r(e,t){return e[0]-t[0]}function i(){var e,t=this.stride,n=new Array(t.length);for(e=0;e<n.length;++e)n[e]=[Math.abs(t[e]),e];n.sort(r);var i=new Array(n.length);for(e=0;e<i.length;++e)i[e]=n[e][1];return i}function a(e,t){var n=["View",t,"d",e].join("");t<0&&(n="View_Nil"+e);var r="generic"===e;if(-1===t){var a="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(a)()}if(0===t)return a="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(r?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(r?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}",new Function("TrivialArray",a)(c[e][0]);a=["'use strict'"];var o=s(t),l=o.map((function(e){return"i"+e})),u="this.offset+"+o.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),d=o.map((function(e){return"b"+e})).join(","),h=o.map((function(e){return"c"+e})).join(",");a.push("function "+n+"(a,"+d+","+h+",d){this.data=a","this.shape=["+d+"]","this.stride=["+h+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),a.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+o.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?a.push("proto.order=[0]"):(a.push("Object.defineProperty(proto,'order',{get:"),t<4?(a.push("function "+n+"_order(){"),2===t?a.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&a.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):a.push("ORDER})")),a.push("proto.set=function "+n+"_set("+l.join(",")+",v){"),a.push(r?"return this.data.set("+u+",v)}":"return this.data["+u+"]=v}"),a.push("proto.get=function "+n+"_get("+l.join(",")+"){"),a.push(r?"return this.data.get("+u+")}":"return this.data["+u+"]}"),a.push("proto.index=function "+n+"_index(",l.join(),"){return "+u+"}"),a.push("proto.hi=function "+n+"_hi("+l.join(",")+"){return new "+n+"(this.data,"+o.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+o.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var f=o.map((function(e){return"a"+e+"=this.shape["+e+"]"})),p=o.map((function(e){return"c"+e+"=this.stride["+e+"]"}));a.push("proto.lo=function "+n+"_lo("+l.join(",")+"){var b=this.offset,d=0,"+f.join(",")+","+p.join(","));for(var m=0;m<t;++m)a.push("if(typeof i"+m+"==='number'&&i"+m+">=0){d=i"+m+"|0;b+=c"+m+"*d;a"+m+"-=d}");for(a.push("return new "+n+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"c"+e})).join(",")+",b)}"),a.push("proto.step=function "+n+"_step("+l.join(",")+"){var "+o.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+o.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil"),m=0;m<t;++m)a.push("if(typeof i"+m+"==='number'){d=i"+m+"|0;if(d<0){c+=b"+m+"*(a"+m+"-1);a"+m+"=ceil(-a"+m+"/d)}else{a"+m+"=ceil(a"+m+"/d)}b"+m+"*=d}");a.push("return new "+n+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"b"+e})).join(",")+",c)}");var g=new Array(t),v=new Array(t);for(m=0;m<t;++m)g[m]="a[i"+m+"]",v[m]="b[i"+m+"]";for(a.push("proto.transpose=function "+n+"_transpose("+l+"){"+l.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+g.join(",")+","+v.join(",")+",this.offset)}"),a.push("proto.pick=function "+n+"_pick("+l+"){var a=[],b=[],c=this.offset"),m=0;m<t;++m)a.push("if(typeof i"+m+"==='number'&&i"+m+">=0){c=(c+this.stride["+m+"]*i"+m+")|0}else{a.push(this.shape["+m+"]);b.push(this.stride["+m+"])}");return a.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),a.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+o.map((function(e){return"shape["+e+"]"})).join(",")+","+o.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",a.join("\n"))(c[e],i)}function o(e){if(l(e))return"buffer";if(u)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(e)?"array":"generic"}var s=n(62),l=n(63),u="undefined"!=typeof Float64Array,c={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};e.exports=function(e,t,n,r){if(void 0===e)return(0,c.array[0])([]);"number"==typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var i=t.length;if(void 0===n){n=new Array(i);for(var s=i-1,l=1;s>=0;--s)n[s]=l,l*=t[s]}if(void 0===r)for(r=0,s=0;s<i;++s)n[s]<0&&(r-=(t[s]-1)*n[s]);for(var u=o(e),d=c[u];d.length<=i+1;)d.push(a(u,d.length-1));return(0,d[i+1])(e,t,n,r)}},function(e,t,n){"use strict";(function(t){e.exports=!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?function(e,n,r,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var a,o,s=arguments.length;switch(s){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,n)}));case 3:return t.nextTick((function(){e.call(null,n,r)}));case 4:return t.nextTick((function(){e.call(null,n,r,i)}));default:for(a=new Array(s-1),o=0;o<a.length;)a[o++]=arguments[o];return t.nextTick((function(){e.apply(null,a)}))}}:t.nextTick}).call(t,n(4))},function(e,t,n){function r(e,t){for(var n in e)t[n]=e[n]}function i(e,t,n){return o(e,t,n)}var a=n(6),o=a.Buffer;o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?e.exports=a:(r(a,t),t.Buffer=i),r(o,i),i.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return o(e,t,n)},i.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=o(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return a.SlowBuffer(e)}},function(e,t,n){"use strict";var r=r||{};r.Utils=r.Utils||{},r.Utils.crcTable=null,r.Utils.GUNZIP_MAGIC_COOKIE1=31,r.Utils.GUNZIP_MAGIC_COOKIE2=139,r.Utils.getStringAt=function(e,t,n){var r,i,a="";for(r=t;r<n;r+=1)0!==(i=e.getUint8(r))&&(a+=String.fromCharCode(i));return a},r.Utils.getByteAt=function(e,t){return e.getInt8(t)},r.Utils.getShortAt=function(e,t,n){return e.getInt16(t,n)},r.Utils.getIntAt=function(e,t,n){return e.getInt32(t,n)},r.Utils.getFloatAt=function(e,t,n){return e.getFloat32(t,n)},r.Utils.getDoubleAt=function(e,t,n){return e.getFloat64(t,n)},r.Utils.getLongAt=function(e,t,n){var i,a=[],o=0;for(i=0;i<8;i+=1)a[i]=r.Utils.getByteAt(e,t+i,n);for(i=a.length-1;i>=0;i--)o=256*o+a[i];return o},r.Utils.toArrayBuffer=function(e){var t,n,r;for(t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r+=1)n[r]=e[r];return t},r.Utils.isString=function(e){return"string"==typeof e||e instanceof String},r.Utils.formatNumber=function(e,t){var n=0;return n=(n=r.Utils.isString(e)?Number(e):e).toPrecision(t?5:7),parseFloat(n)},r.Utils.makeCRCTable=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t},r.Utils.crc32=function(e){for(var t=r.Utils.crcTable||(r.Utils.crcTable=r.Utils.makeCRCTable()),n=-1,i=0;i<e.byteLength;i++)n=n>>>8^t[255&(n^e.getUint8(i))];return(-1^n)>>>0},void 0!==e&&e.exports&&(e.exports=r.Utils)},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";function r(e){var t=new CustomEvent(e,{detail:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}});i.external.cornerstone.events.dispatchEvent(t)}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);t.default={imageLoadProgress:function(e){return r("cornerstoneimageloadprogress",e)},imageLoadStart:function(e){return r("cornerstoneimageloadstart",e)},imageLoadEnd:function(e){return r("cornerstoneimageloadend",e)}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){var t=c.external.niftiReader,n=t.readHeader(e);!function(e,t){var n=void 0;switch(7&t.xyzt_units){case e.NIFTI1.UNITS_METER:n=1e3;break;case e.NIFTI1.UNITS_MICRON:n=.001;break;case e.NIFTI1.UNITS_MM:default:n=1}t.pixDims=t.pixDims.map((function(e,r){return r>0&&r<=t.dims[0]?e*n:e})),t.affine&&(t.affine=t.affine.map((function(e){return e.map((function(e){return e*n}))}))),(t.quatern_b||t.quatern_c||t.quatern_d)&&(t.quatern_b*=n,t.quatern_c*=n,t.quatern_d*=n),(t.qoffset_x||t.qoffset_y||t.qoffset_z)&&(t.qoffset_x*=n,t.qoffset_y*=n,t.qoffset_z*=n)}(t,n);var r=n.scl_inter,i=0===n.scl_slope?1:n.scl_slope,a=0==n.cal_max-n.cal_min,d=a?void 0:n.cal_min,h=a?void 0:n.cal_max,f=n.dims.slice(1,4),p=n.dims[0]>3?n.dims[4]:1,m={TypedArrayConstructor:o(t,n.datatypeCode),samplesPerPixel:u(n.dims),isDataInFloat:s(t,n.datatypeCode),isDataInColors:l(t,n.dims,n.datatypeCode)},g=n.pixDims.slice(1,4),v=function(e){if(e.affine&&e.sform_code>0)return e.affine;if(e.qform_code>0)return e.convertNiftiQFormToNiftiSForm(e.quatern_b,e.quatern_c,e.quatern_d,e.qoffset_x,e.qoffset_y,e.qoffset_z,e.pixDims[1],e.pixDims[2],e.pixDims[3],e.pixDims[0]);var t={x:e.pixDims[1],y:e.pixDims[2],z:e.pixDims[3]},n={x:-t.x*e.dims[1]/2,y:-t.y*e.dims[2]/2,z:-t.z*e.dims[3]/2};return[[t.x,0,0,n.x],[0,t.y,0,n.y],[0,0,t.z,n.z],[0,0,0,1]]}(n);return{slope:i,intercept:r,windowMinimumValue:d,windowMaximumValue:h,isWindowInfoAbsent:a,voxelLength:f,timeSlices:p,dataType:m,pixelSpacing:g,orientationMatrix:v,orientationString:n.convertNiftiSFormToNEMA(v),header:n}}function o(e,t){var n;return(n={},i(n,e.NIFTI1.TYPE_UINT8,Uint8Array),i(n,e.NIFTI1.TYPE_UINT16,Uint16Array),i(n,e.NIFTI1.TYPE_UINT32,Uint32Array),i(n,e.NIFTI1.TYPE_INT8,Int8Array),i(n,e.NIFTI1.TYPE_INT16,Int16Array),i(n,e.NIFTI1.TYPE_INT32,Int32Array),i(n,e.NIFTI1.TYPE_FLOAT32,Float32Array),i(n,e.NIFTI1.TYPE_FLOAT64,Float64Array),i(n,e.NIFTI1.TYPE_RGB,Uint8Array),i(n,e.NIFTI1.TYPE_RGBA,Uint8Array),n)[t]}function s(e,t){var n;return(n={},i(n,e.NIFTI1.TYPE_UINT8,!1),i(n,e.NIFTI1.TYPE_UINT16,!1),i(n,e.NIFTI1.TYPE_UINT32,!1),i(n,e.NIFTI1.TYPE_INT8,!1),i(n,e.NIFTI1.TYPE_INT16,!1),i(n,e.NIFTI1.TYPE_INT32,!1),i(n,e.NIFTI1.TYPE_FLOAT32,!0),i(n,e.NIFTI1.TYPE_FLOAT64,!0),i(n,e.NIFTI1.TYPE_RGB,!1),i(n,e.NIFTI1.TYPE_RGBA,!1),n)[t]}function l(e,t,n){var r,a=u(t);return(r={},i(r,e.NIFTI1.TYPE_UINT8,!1),i(r,e.NIFTI1.TYPE_UINT16,!1),i(r,e.NIFTI1.TYPE_UINT32,!1),i(r,e.NIFTI1.TYPE_INT8,!1),i(r,e.NIFTI1.TYPE_INT16,!1),i(r,e.NIFTI1.TYPE_INT32,!1),i(r,e.NIFTI1.TYPE_FLOAT32,!1),i(r,e.NIFTI1.TYPE_FLOAT64,!1),i(r,e.NIFTI1.TYPE_RGB,3===a),i(r,e.NIFTI1.TYPE_RGBA,4===a),r)[n]}function u(e){return e[0]>=5?e[5]:1}Object.defineProperty(t,"__esModule",{value:!0}),t.parseNiftiHeader=a,t.parseNiftiFile=function(e,t){var n=c.external.niftiReader;t||(t=a(e));var r=t.dataType.TypedArrayConstructor,i=n.readImage(t.header,e),o=(0,h.default)(t.header.datatypeCode,new r(i));return t.header.littleEndian||(o=(0,d.default)(t.header.datatypeCode,o)),{metaData:t,imageData:o}};var c=n(1),d=r(n(66)),h=r(n(67))},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(17)),a=n(42),o=r(n(56)),s=r(n(68)),l=r(n(8)),u=r(n(91)),c=r(n(14)),d={headers:{}},h={loadImage:function(e){var t=void 0;try{var n=l.default.fromURL(e),r=o.default.getInstance(d.headers);c.default.imageLoadStart(n),t=r.acquire(n).then((function(e){return e.slice(n)})).then((function(e){return i.default.add(n.url,e.compoundMetaData),c.default.imageLoadEnd(n),e.cornerstoneImageObject}))}catch(e){t=Promise.reject(e)}return(t=(0,u.default)(t)).promise=t,t},loadVolumeTimepoint:function(e){var t=void 0;try{var n=l.default.fromURL(e),r=s.default.getInstance(d.headers);c.default.imageLoadStart(n),t=r.acquireTimepoint(n).then((function(e){return e.slice(n)})).then((function(e){return i.default.add(n.url,e.compoundMetaData),c.default.imageLoadEnd(n),e.cornerstoneImageObject}))}catch(e){t=Promise.reject(e)}return(t=(0,u.default)(t)).promise=t,t},loadHeader:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=void 0;try{var r=l.default.fromURL(e);n=s.default.getInstance(d.headers).acquireHeaderOnly(r,t).then((function(e){return e.slice(r)})).then((function(e){return i.default.add(r.url,e.compoundMetaData),e.compoundMetaData}))}catch(e){n=Promise.reject(e)}return(n=(0,u.default)(n)).promise=n,n},ImageId:l.default,streamingMode:!1,cornerstoneLoader:function(e){return this.streamingMode?this.loadVolumeTimepoint(e):this.loadImage(e)},register:function(e){var t=this;e.registerImageLoader("nifti",(function(e){return t.cornerstoneLoader(e,t)})),e.metaData.addProvider(a.metaDataProvider,1e4)},configure:function(e){Object.assign(d,e)}};t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=[];t.default={add:function(e,t){r[e]=t},get:function(e){return r[e]},remove:function(e){r[e]=void 0},purge:function(){r=[]}}},function(e,t,n){"use strict";var r=r||{};r.Utils=r.Utils||n(12),r.NIFTI1=r.NIFTI1||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.isHDR=!1,this.extensionFlag=[0,0,0,0],this.extensionSize=0,this.extensionCode=0},r.NIFTI1.TYPE_NONE=0,r.NIFTI1.TYPE_BINARY=1,r.NIFTI1.TYPE_UINT8=2,r.NIFTI1.TYPE_INT16=4,r.NIFTI1.TYPE_INT32=8,r.NIFTI1.TYPE_FLOAT32=16,r.NIFTI1.TYPE_COMPLEX64=32,r.NIFTI1.TYPE_FLOAT64=64,r.NIFTI1.TYPE_RGB24=128,r.NIFTI1.TYPE_INT8=256,r.NIFTI1.TYPE_UINT16=512,r.NIFTI1.TYPE_UINT32=768,r.NIFTI1.TYPE_INT64=1024,r.NIFTI1.TYPE_UINT64=1280,r.NIFTI1.TYPE_FLOAT128=1536,r.NIFTI1.TYPE_COMPLEX128=1792,r.NIFTI1.TYPE_COMPLEX256=2048,r.NIFTI1.XFORM_UNKNOWN=0,r.NIFTI1.XFORM_SCANNER_ANAT=1,r.NIFTI1.XFORM_ALIGNED_ANAT=2,r.NIFTI1.XFORM_TALAIRACH=3,r.NIFTI1.XFORM_MNI_152=4,r.NIFTI1.SPATIAL_UNITS_MASK=7,r.NIFTI1.TEMPORAL_UNITS_MASK=56,r.NIFTI1.UNITS_UNKNOWN=0,r.NIFTI1.UNITS_METER=1,r.NIFTI1.UNITS_MM=2,r.NIFTI1.UNITS_MICRON=3,r.NIFTI1.UNITS_SEC=8,r.NIFTI1.UNITS_MSEC=16,r.NIFTI1.UNITS_USEC=24,r.NIFTI1.UNITS_HZ=32,r.NIFTI1.UNITS_PPM=40,r.NIFTI1.UNITS_RADS=48,r.NIFTI1.MAGIC_COOKIE=348,r.NIFTI1.STANDARD_HEADER_SIZE=348,r.NIFTI1.MAGIC_NUMBER_LOCATION=344,r.NIFTI1.MAGIC_NUMBER=[110,43,49],r.NIFTI1.MAGIC_NUMBER2=[110,105,49],r.NIFTI1.EXTENSION_HEADER_SIZE=8,r.NIFTI1.prototype.readHeader=function(e){var t,n,i,a=new DataView(e),o=r.Utils.getIntAt(a,0,this.littleEndian);if(o!==r.NIFTI1.MAGIC_COOKIE&&(this.littleEndian=!0,o=r.Utils.getIntAt(a,0,this.littleEndian)),o!==r.NIFTI1.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=r.Utils.getByteAt(a,39),t=0;t<8;t+=1)this.dims[t]=r.Utils.getShortAt(a,40+2*t,this.littleEndian);for(this.intent_p1=r.Utils.getFloatAt(a,56,this.littleEndian),this.intent_p2=r.Utils.getFloatAt(a,60,this.littleEndian),this.intent_p3=r.Utils.getFloatAt(a,64,this.littleEndian),this.intent_code=r.Utils.getShortAt(a,68,this.littleEndian),this.datatypeCode=r.Utils.getShortAt(a,70,this.littleEndian),this.numBitsPerVoxel=r.Utils.getShortAt(a,72,this.littleEndian),this.slice_start=r.Utils.getShortAt(a,74,this.littleEndian),t=0;t<8;t+=1)this.pixDims[t]=r.Utils.getFloatAt(a,76+4*t,this.littleEndian);for(this.vox_offset=r.Utils.getFloatAt(a,108,this.littleEndian),this.scl_slope=r.Utils.getFloatAt(a,112,this.littleEndian),this.scl_inter=r.Utils.getFloatAt(a,116,this.littleEndian),this.slice_end=r.Utils.getShortAt(a,120,this.littleEndian),this.slice_code=r.Utils.getByteAt(a,122),this.xyzt_units=r.Utils.getByteAt(a,123),this.cal_max=r.Utils.getFloatAt(a,124,this.littleEndian),this.cal_min=r.Utils.getFloatAt(a,128,this.littleEndian),this.slice_duration=r.Utils.getFloatAt(a,132,this.littleEndian),this.toffset=r.Utils.getFloatAt(a,136,this.littleEndian),this.description=r.Utils.getStringAt(a,148,228),this.aux_file=r.Utils.getStringAt(a,228,252),this.qform_code=r.Utils.getShortAt(a,252,this.littleEndian),this.sform_code=r.Utils.getShortAt(a,254,this.littleEndian),this.quatern_b=r.Utils.getFloatAt(a,256,this.littleEndian),this.quatern_c=r.Utils.getFloatAt(a,260,this.littleEndian),this.quatern_d=r.Utils.getFloatAt(a,264,this.littleEndian),this.qoffset_x=r.Utils.getFloatAt(a,268,this.littleEndian),this.qoffset_y=r.Utils.getFloatAt(a,272,this.littleEndian),this.qoffset_z=r.Utils.getFloatAt(a,276,this.littleEndian),n=0;n<3;n+=1)for(i=0;i<4;i+=1)this.affine[n][i]=r.Utils.getFloatAt(a,280+4*(4*n+i),this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=r.Utils.getStringAt(a,328,344),this.magic=r.Utils.getStringAt(a,344,348),this.isHDR=this.magic===r.NIFTI1.MAGIC_NUMBER2,a.byteLength>r.NIFTI1.MAGIC_COOKIE&&(this.extensionFlag[0]=r.Utils.getByteAt(a,348),this.extensionFlag[1]=r.Utils.getByteAt(a,349),this.extensionFlag[2]=r.Utils.getByteAt(a,350),this.extensionFlag[3]=r.Utils.getByteAt(a,351),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(a),this.extensionCode=this.getExtensionCode(a)))},r.NIFTI1.prototype.toFormattedString=function(){var e=r.Utils.formatNumber,t="";return t+="Dim Info = "+this.dim_info+"\n",t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",t+="Intent Code = "+this.intent_code+"\n",t+="Datatype = "+this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",t+="Bits Per Voxel = "+this.numBitsPerVoxel+"\n",t+="Slice Start = "+this.slice_start+"\n",t+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+"\n",t+="Image Offset = "+this.vox_offset+"\n",t+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+"\n",t+="Slice End = "+this.slice_end+"\n",t+="Slice Code = "+this.slice_code+"\n",t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(r.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(r.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",t+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+"\n",t+="Slice Duration = "+this.slice_duration+"\n",t+="Time Axis Shift = "+this.toffset+"\n",t+='Description: "'+this.description+'"\n',t+='Auxiliary File: "'+this.aux_file+'"\n',t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",t+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+"\n",t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",t+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+"\n",t+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+"\n",t+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+"\n",t+='Intent Name: "'+this.intent_name+'"\n',this.extensionFlag[0]&&(t+="Extension: Size = "+this.extensionSize+"  Code = "+this.extensionCode+"\n"),t},r.NIFTI1.prototype.getDatatypeCodeString=function(e){return e===r.NIFTI1.TYPE_UINT8?"1-Byte Unsigned Integer":e===r.NIFTI1.TYPE_INT16?"2-Byte Signed Integer":e===r.NIFTI1.TYPE_INT32?"4-Byte Signed Integer":e===r.NIFTI1.TYPE_FLOAT32?"4-Byte Float":e===r.NIFTI1.TYPE_FLOAT64?"8-Byte Float":e===r.NIFTI1.TYPE_RGB24?"RGB":e===r.NIFTI1.TYPE_INT8?"1-Byte Signed Integer":e===r.NIFTI1.TYPE_UINT16?"2-Byte Unsigned Integer":e===r.NIFTI1.TYPE_UINT32?"4-Byte Unsigned Integer":e===r.NIFTI1.TYPE_INT64?"8-Byte Signed Integer":e===r.NIFTI1.TYPE_UINT64?"8-Byte Unsigned Integer":"Unknown"},r.NIFTI1.prototype.getTransformCodeString=function(e){return e===r.NIFTI1.XFORM_SCANNER_ANAT?"Scanner":e===r.NIFTI1.XFORM_ALIGNED_ANAT?"Aligned":e===r.NIFTI1.XFORM_TALAIRACH?"Talairach":e===r.NIFTI1.XFORM_MNI_152?"MNI":"Unknown"},r.NIFTI1.prototype.getUnitsCodeString=function(e){return e===r.NIFTI1.UNITS_METER?"Meters":e===r.NIFTI1.UNITS_MM?"Millimeters":e===r.NIFTI1.UNITS_MICRON?"Microns":e===r.NIFTI1.UNITS_SEC?"Seconds":e===r.NIFTI1.UNITS_MSEC?"Milliseconds":e===r.NIFTI1.UNITS_USEC?"Microseconds":e===r.NIFTI1.UNITS_HZ?"Hz":e===r.NIFTI1.UNITS_PPM?"PPM":e===r.NIFTI1.UNITS_RADS?"Rads":"Unknown"},r.NIFTI1.prototype.getQformMat=function(){return this.convertNiftiQFormToNiftiSForm(this.quatern_b,this.quatern_c,this.quatern_d,this.qoffset_x,this.qoffset_y,this.qoffset_z,this.pixDims[1],this.pixDims[2],this.pixDims[3],this.pixDims[0])},r.NIFTI1.prototype.convertNiftiQFormToNiftiSForm=function(e,t,n,r,i,a,o,s,l,u){var c,d,h,f,p=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],m=e,g=t,v=n;return p[3][0]=p[3][1]=p[3][2]=0,p[3][3]=1,(c=1-(m*m+g*g+v*v))<1e-7?(m*=c=1/Math.sqrt(m*m+g*g+v*v),g*=c,v*=c,c=0):c=Math.sqrt(c),h=s>0?s:1,f=l>0?l:1,u<0&&(f=-f),p[0][0]=(c*c+m*m-g*g-v*v)*(d=o>0?o:1),p[0][1]=2*(m*g-c*v)*h,p[0][2]=2*(m*v+c*g)*f,p[1][0]=2*(m*g+c*v)*d,p[1][1]=(c*c+g*g-m*m-v*v)*h,p[1][2]=2*(g*v-c*m)*f,p[2][0]=2*(m*v-c*g)*d,p[2][1]=2*(g*v+c*m)*h,p[2][2]=(c*c+v*v-g*g-m*m)*f,p[0][3]=r,p[1][3]=i,p[2][3]=a,p},r.NIFTI1.prototype.convertNiftiSFormToNEMA=function(e){var t,n,r,i,a,o,s,l,u,c,d,h,f,p,m,g,v,y,b,x,w,_,k,E,S,T,C,I,A,O,D,M,N;if(p=0,T=[[0,0,0],[0,0,0],[0,0,0]],C=[[0,0,0],[0,0,0],[0,0,0]],t=e[0][0],n=e[0][1],r=e[0][2],i=e[1][0],a=e[1][1],o=e[1][2],s=e[2][0],l=e[2][1],u=e[2][2],0===(c=Math.sqrt(t*t+i*i+s*s)))return null;if(t/=c,i/=c,s/=c,0===(c=Math.sqrt(n*n+a*a+l*l)))return null;if(c=t*(n/=c)+i*(a/=c)+s*(l/=c),Math.abs(c)>1e-4){if(n-=c*t,a-=c*i,l-=c*s,0===(c=Math.sqrt(n*n+a*a+l*l)))return null;n/=c,a/=c,l/=c}if(0===(c=Math.sqrt(r*r+o*o+u*u))?(r=i*l-s*a,o=s*n-l*t,u=t*a-i*n):(r/=c,o/=c,u/=c),c=t*r+i*o+s*u,Math.abs(c)>1e-4){if(r-=c*t,o-=c*i,u-=c*s,0===(c=Math.sqrt(r*r+o*o+u*u)))return null;r/=c,o/=c,u/=c}if(c=n*r+a*o+l*u,Math.abs(c)>1e-4){if(r-=c*n,o-=c*a,u-=c*l,0===(c=Math.sqrt(r*r+o*o+u*u)))return null;r/=c,o/=c,u/=c}if(T[0][0]=t,T[0][1]=n,T[0][2]=r,T[1][0]=i,T[1][1]=a,T[1][2]=o,T[2][0]=s,T[2][1]=l,T[2][2]=u,0===(d=this.nifti_mat33_determ(T)))return null;for(S=-666,y=w=_=k=1,b=2,x=3,h=1;h<=3;h+=1)for(f=1;f<=3;f+=1)if(h!==f)for(p=1;p<=3;p+=1)if(h!==p&&f!==p)for(C[0][0]=C[0][1]=C[0][2]=C[1][0]=C[1][1]=C[1][2]=C[2][0]=C[2][1]=C[2][2]=0,m=-1;m<=1;m+=2)for(g=-1;g<=1;g+=2)for(v=-1;v<=1;v+=2)C[0][h-1]=m,C[1][f-1]=g,C[2][p-1]=v,this.nifti_mat33_determ(C)*d>0&&(c=(E=this.nifti_mat33_mul(C,T))[0][0]+E[1][1]+E[2][2])>S&&(S=c,y=h,b=f,x=p,w=m,_=g,k=v);switch(I=A=O=D=M=N=0,y*w){case 1:I="X",D="+";break;case-1:I="X",D="-";break;case 2:I="Y",D="+";break;case-2:I="Y",D="-";break;case 3:I="Z",D="+";break;case-3:I="Z",D="-"}switch(b*_){case 1:A="X",M="+";break;case-1:A="X",M="-";break;case 2:A="Y",M="+";break;case-2:A="Y",M="-";break;case 3:A="Z",M="+";break;case-3:A="Z",M="-"}switch(x*k){case 1:O="X",N="+";break;case-1:O="X",N="-";break;case 2:O="Y",N="+";break;case-2:O="Y",N="-";break;case 3:O="Z",N="+";break;case-3:O="Z",N="-"}return I+A+O+D+M+N},r.NIFTI1.prototype.nifti_mat33_mul=function(e,t){var n,r,i=[[0,0,0],[0,0,0],[0,0,0]];for(n=0;n<3;n+=1)for(r=0;r<3;r+=1)i[n][r]=e[n][0]*t[0][r]+e[n][1]*t[1][r]+e[n][2]*t[2][r];return i},r.NIFTI1.prototype.nifti_mat33_determ=function(e){var t,n,r,i,a,o,s,l,u;return(t=e[0][0])*(a=e[1][1])*(u=e[2][2])-t*(l=e[2][1])*(o=e[1][2])-(i=e[1][0])*(n=e[0][1])*u+i*l*(r=e[0][2])+(s=e[2][0])*n*o-s*a*r},r.NIFTI1.prototype.getExtensionLocation=function(){return r.NIFTI1.MAGIC_COOKIE+4},r.NIFTI1.prototype.getExtensionSize=function(e){return r.Utils.getIntAt(e,this.getExtensionLocation(),this.littleEndian)},r.NIFTI1.prototype.getExtensionCode=function(e){return r.Utils.getIntAt(e,this.getExtensionLocation()+4,this.littleEndian)},void 0!==e&&e.exports&&(e.exports=r.NIFTI1)},function(e,t,n){"use strict";var r={};(0,n(2).assign)(r,n(47),n(50),n(24)),e.exports=r},function(e,t,n){"use strict";e.exports=function(e,t,n,r){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{a=a+(i=i+t[r++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,i){var a=r,o=i+n;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},function(e,t,n){"use strict";function r(e,t){if(t<65537&&(e.subarray&&o||!e.subarray&&a))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n}var i=n(2),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var s=new i.Buf8(256),l=0;l<256;l++)s[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;s[254]=s[254]=1,t.string2buf=function(e){var t,n,r,a,o,s=e.length,l=0;for(a=0;a<s;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new i.Buf8(l),o=0,a=0;o<l;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},t.buf2binstring=function(e){return r(e,e.length)},t.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,i,a,o,l=t||e.length,u=new Array(2*l);for(i=0,n=0;n<l;)if((a=e[n++])<128)u[i++]=a;else if((o=s[a])>4)u[i++]=65533,n+=o-1;else{for(a&=2===o?31:3===o?15:7;o>1&&n<l;)a=a<<6|63&e[n++],o--;o>1?u[i++]=65533:a<65536?u[i++]=a:(u[i++]=55296|(a-=65536)>>10&1023,u[i++]=56320|1023&a)}return r(u,i)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+s[e[n]]>t?n:t}},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(n(57)),s=r(n(9)),l=Symbol("convertToNeurologicalView"),u=Symbol("ensureVoxelStorageInXYZ"),c=Symbol("changeVoxelStorageOrder"),d=Symbol("convertRAStoLPS"),h=function(){function e(t,n,r,a){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];i(this,e),this.imageIdObject=t,this.metaData=n,this.imageDataNDarray=r,this.floatImageDataNDarray=a,this.isSingleTimepoint=o,this[u](),this[l](),this[d]()}return a(e,[{key:u,value:function(){for(var e=this.metaData.orientationString.slice(0,3),t=new Array(3).fill(0),n={X:0,Y:1,Z:2},r=!0,i=0;i<e.length;i++){var a=e[i];if(!(a in n)){r=!1;break}t[n[a]]=i}r?"XYZ"!==e&&this[c](t):console.info("The NIfTI file "+this.imageIdObject.filePath+" has its\n        voxel values stored in "+e+" order in the file,\n        which is a rare orientation unsupported by the viewer. Hence,\n        the viewer is not doing auto flipping to match the neurological view.")}},{key:c,value:function(e){var t,n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(e,3),r=n[0],i=n[1],a=n[2];this.hasImageData&&(this.imageDataNDarray=this.imageDataNDarray.transpose(r,i,a,3),this.floatImageDataNDarray&&(this.floatImageDataNDarray=this.floatImageDataNDarray.transpose(r,i,a,3))),this.metaData.voxelLength=[this.metaData.voxelLength[r],this.metaData.voxelLength[i],this.metaData.voxelLength[a]];var o=this.metaData.orientationMatrix,l=JSON.parse(JSON.stringify(o)),u=(0,s.default)((t=[]).concat.apply(t,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(l)),[4,4]).transpose(1,0),c=[u.pick(0,null),u.pick(1,null),u.pick(2,null),u.pick(3,null)];o[0]=[c[r].get(0),c[r].get(1),c[r].get(2),c[3].get(r)],o[1]=[c[i].get(0),c[i].get(1),c[i].get(2),-c[3].get(i)],o[2]=[c[a].get(0),c[a].get(1),c[a].get(2),-c[3].get(a)],this.metaData.pixelSpacing=[this.metaData.pixelSpacing[r],this.metaData.pixelSpacing[i],this.metaData.pixelSpacing[a]].slice(0);var d=this.metaData.orientationString.slice(3,6);d=[d[r],d[i],d[a]].join(""),this.metaData.orientationString="XYZ"+d}},{key:l,value:function(){var e,t,n=this.metaData.orientationMatrix,r=this.metaData.orientationString.slice(3,6),i=[1,1,1];"XYZ"===this.metaData.orientationString.slice(0,3)&&("-"===r[0]&&(n[0][0]*=-1,n[0][1]*=-1,n[0][2]*=-1,n[0][3]*=-1,i[0]=-1),"+"===r[1]&&(n[1][0]*=-1,n[1][1]*=-1,n[1][2]*=-1,n[1][3]*=-1,i[1]=-1),"+"===r[2]&&(n[2][0]*=-1,n[2][1]*=-1,n[2][2]*=-1,n[2][3]*=-1,i[2]=-1)),this.hasImageData&&(this.imageDataNDarray=(e=this.imageDataNDarray).step.apply(e,i.concat([1])),this.floatImageDataNDarray&&(this.floatImageDataNDarray=(t=this.floatImageDataNDarray).step.apply(t,i.concat([1]))))}},{key:d,value:function(){var e=this.metaData.orientationMatrix;e[0][0]*=-1,e[0][1]*=-1,e[0][2]*=-1,e[0][3]*=-1,e[1][0]*=-1,e[1][1]*=-1,e[1][2]*=-1,e[1][3]*=-1}},{key:"slice",value:function(e){return new o.default(this,e,this.isSingleTimepoint)}},{key:"hasImageData",get:function(){return this.imageDataNDarray&&this.imageDataNDarray.data&&this.imageDataNDarray.data.byteLength>0}},{key:"sizeInBytes",get:function(){return(this.imageDataNDarray?this.imageDataNDarray.data.byteLength:0)+(this.floatImageDataView?this.floatImageDataView.data.byteLength:0)}}]),e}();t.default=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e),this.volumeEntries={},this.cacheUses=0}return i(e,[{key:"add",value:function(e,t){this.volumeEntries[e.filePath]=new o(t)}},{key:"addTimepoint",value:function(e,t,n){this.volumeEntries[e.filePath+"-t"+t]=new o(n)}},{key:"get",value:function(e){var t=this.volumeEntries[e.filePath];if(t)return t.lastUseIndex=this.cacheUses++,t.volume}},{key:"getTimepoint",value:function(e,t){var n=this.volumeEntries[e.filePath+"-t"+t];if(n)return n.lastUseIndex=this.cacheUses++,n.volume}}]),e}();t.default=a;var o=function e(t){r(this,e),this.volume=t,this.sizeInBytes=t.sizeInBytes,this.lastUseIndex=-1}},function(e,t,n){"use strict";function r(e,t,n){return(e-n)/t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var n=Math.pow(2,16)-1,a=t.minPixelValue,o=t.maxPixelValue-a,s=0===o?1:o/n,l=a,u=(0,i.default)(new Uint16Array(e.data.length),e.shape,e.stride,e.offset),c=0;c<e.shape[3];c++)for(var d=0;d<e.shape[2];d++)for(var h=0;h<e.shape[1];h++)for(var f=0;f<e.shape[0];f++){var p=e.get(f,h,d,c);p=r(p,s,l),u.set(f,h,d,c,Math.floor(p))}return{convertedImageDataView:u,floatImageDataView:e,metaData:{slope:s,intercept:l,minPixelValue:Math.floor(r(t.minPixelValue,s,l)),maxPixelValue:Math.floor(r(t.maxPixelValue,s,l)),dataType:{TypedArrayConstructor:Uint16Array,OriginalTypedArrayConstructor:t.dataType.TypedArrayConstructor,isDataInFloat:!0,isDataInColors:t.dataType.isDataInColors}}}};var i=function(e){return e&&e.__esModule?e:{default:e}}(n(9))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=e.get(0,0,0,0),n=t,r=0;r<e.shape[3];r++)for(var i=0;i<e.shape[2];i++)for(var a=0;a<e.shape[1];a++)for(var o=0;o<e.shape[0];o++){var s=e.get(o,a,i,r);s<t?t=s:s>n&&(n=s)}return{min:t,max:n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.length,r=new Uint8Array(n+t.length);return r.set(e),r.set(t,n),r}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){(function(e){function n(){if(void 0!==a)return a;if(e.XMLHttpRequest){a=new e.XMLHttpRequest;try{a.open("GET",e.XDomainRequest?"/":"https://example.com")}catch(e){a=null}}else a=null;return a}function r(e){var t=n();if(!t)return!1;try{return t.responseType=e,t.responseType===e}catch(e){}return!1}function i(e){return"function"==typeof e}t.fetch=i(e.fetch)&&i(e.ReadableStream),t.writableStream=i(e.WritableStream),t.abortController=i(e.AbortController),t.blobConstructor=!1;try{new Blob([new ArrayBuffer(1)]),t.blobConstructor=!0}catch(e){}var a,o=void 0!==e.ArrayBuffer,s=o&&i(e.ArrayBuffer.prototype.slice);t.arraybuffer=t.fetch||o&&r("arraybuffer"),t.msstream=!t.fetch&&s&&r("ms-stream"),t.mozchunkedarraybuffer=!t.fetch&&o&&r("moz-chunked-arraybuffer"),t.overrideMimeType=t.fetch||!!n()&&i(n().overrideMimeType),t.vbArray=i(e.VBArray),a=null}).call(t,n(0))},function(e,t,n){(function(e,r,i){var a=n(31),o=n(3),s=n(33),l=t.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},u=t.IncomingMessage=function(t,n,i){var o=this;if(s.Readable.call(o),o._mode=i,o.headers={},o.rawHeaders=[],o.trailers={},o.rawTrailers=[],o.on("end",(function(){e.nextTick((function(){o.emit("close")}))})),"fetch"===i){if(o._fetchResponse=n,o.url=n.url,o.statusCode=n.status,o.statusMessage=n.statusText,n.headers.forEach((function(e,t){o.headers[t.toLowerCase()]=e,o.rawHeaders.push(t,e)})),a.writableStream){var l=new WritableStream({write:function(e){return new Promise((function(t,n){o._destroyed||(o.push(new r(e))?t():o._resumeFetch=t)}))},close:function(){o._destroyed||o.push(null)},abort:function(e){o._destroyed||o.emit("error",e)}});try{return void n.body.pipeTo(l)}catch(e){}}var u=n.body.getReader();!function e(){u.read().then((function(t){if(!o._destroyed){if(t.done)return void o.push(null);o.push(new r(t.value)),e()}})).catch((function(e){o._destroyed||o.emit("error",e)}))}()}else if(o._xhr=t,o._pos=0,o.url=t.responseURL,o.statusCode=t.status,o.statusMessage=t.statusText,t.getAllResponseHeaders().split(/\r?\n/).forEach((function(e){var t=e.match(/^([^:]+):\s*(.*)/);if(t){var n=t[1].toLowerCase();"set-cookie"===n?(void 0===o.headers[n]&&(o.headers[n]=[]),o.headers[n].push(t[2])):void 0!==o.headers[n]?o.headers[n]+=", "+t[2]:o.headers[n]=t[2],o.rawHeaders.push(t[1],t[2])}})),o._charset="x-user-defined",!a.overrideMimeType){var c=o.rawHeaders["mime-type"];if(c){var d=c.match(/;\s*charset=([^;])(;|$)/);d&&(o._charset=d[1].toLowerCase())}o._charset||(o._charset="utf-8")}};o(u,s.Readable),u.prototype._read=function(){var e=this._resumeFetch;e&&(this._resumeFetch=null,e())},u.prototype._onXHRProgress=function(){var e=this,t=e._xhr,n=null;switch(e._mode){case"text:vbarray":if(t.readyState!==l.DONE)break;try{n=new i.VBArray(t.responseBody).toArray()}catch(e){}if(null!==n){e.push(new r(n));break}case"text":try{n=t.responseText}catch(t){e._mode="text:vbarray";break}if(n.length>e._pos){var a=n.substr(e._pos);if("x-user-defined"===e._charset){for(var o=new r(a.length),s=0;s<a.length;s++)o[s]=255&a.charCodeAt(s);e.push(o)}else e.push(a,e._charset);e._pos=n.length}break;case"arraybuffer":if(t.readyState!==l.DONE||!t.response)break;n=t.response,e.push(new r(new Uint8Array(n)));break;case"moz-chunked-arraybuffer":if(n=t.response,t.readyState!==l.LOADING||!n)break;e.push(new r(new Uint8Array(n)));break;case"ms-stream":if(n=t.response,t.readyState!==l.LOADING)break;var u=new i.MSStreamReader;u.onprogress=function(){u.result.byteLength>e._pos&&(e.push(new r(new Uint8Array(u.result.slice(e._pos)))),e._pos=u.result.byteLength)},u.onload=function(){e.push(null)},u.readAsArrayBuffer(n)}e._xhr.readyState===l.DONE&&"ms-stream"!==e._mode&&e.push(null)}}).call(t,n(4),n(6).Buffer,n(0))},function(e,t,n){(t=e.exports=n(34)).Stream=t,t.Readable=t,t.Writable=n(38),t.Duplex=n(5),t.Transform=n(40),t.PassThrough=n(80)},function(e,t,n){"use strict";(function(t,r){function i(e,t){w=w||n(5),this.objectMode=!!(e=e||{}).objectMode,t instanceof w&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark;this.highWaterMark=r||0===r?r:this.objectMode?16:16384,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new D,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(O||(O=n(39).StringDecoder),this.decoder=new O(e.encoding),this.encoding=e.encoding)}function a(e){if(w=w||n(5),!(this instanceof a))return new a(e);this._readableState=new i(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),E.call(this)}function o(e,t,n,r,i){var a,o=e._readableState;return null===t?(o.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,u(e)}}(e,o)):(i||(a=function(e,t){var n;return function(e){return S.isBuffer(e)||e instanceof T}(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(o,t)),a?e.emit("error",a):o.objectMode||t&&t.length>0?("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===S.prototype||(t=function(e){return S.from(e)}(t)),r?o.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):s(e,o,t,!0):o.ended?e.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!n?(t=o.decoder.write(t),o.objectMode||0!==t.length?s(e,o,t,!1):d(e,o)):s(e,o,t,!1))):r||(o.reading=!1)),function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(o)}function s(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&u(e)),d(e,t)}function l(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=j?e=j:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function u(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(A("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?x(c,e):c(e))}function c(e){A("emit readable"),e.emit("readable"),m(e)}function d(e,t){t.readingMore||(t.readingMore=!0,x(h,e,t))}function h(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(A("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function f(e){A("readable nexttick read 0"),e.read(0)}function p(e,t){t.reading||(A("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),m(e),t.flowing&&!t.reading&&e.read(0)}function m(e){var t=e._readableState;for(A("flow",t.flowing);t.flowing&&null!==e.read(););}function g(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var a=n.data,o=e>a.length?a.length:e;if(i+=o===a.length?a:a.slice(0,e),0==(e-=o)){o===a.length?(++r,t.head=n.next?n.next:t.tail=null):(t.head=n,n.data=a.slice(o));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=S.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var a=r.data,o=e>a.length?a.length:e;if(a.copy(n,n.length-e,0,o),0==(e-=o)){o===a.length?(++i,t.head=r.next?r.next:t.tail=null):(t.head=r,r.data=a.slice(o));break}++i}return t.length-=i,n}(e,t),r}(e,t.buffer,t.decoder),n);var n}function v(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,x(y,t,e))}function y(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function b(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}var x=n(10);e.exports=a;var w,_=n(30);a.ReadableState=i;var k=(n(35),function(e,t){return e.listeners(t).length}),E=n(36),S=n(11).Buffer,T=t.Uint8Array||function(){},C=n(7);C.inherits=n(3);var I=n(75),A=void 0;A=I&&I.debuglog?I.debuglog("stream"):function(){};var O,D=n(76),M=n(37);C.inherits(a,E);var N=["error","close","destroy","pause","resume"];Object.defineProperty(a.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),a.prototype.destroy=M.destroy,a.prototype._undestroy=M.undestroy,a.prototype._destroy=function(e,t){this.push(null),t(e)},a.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=S.from(e,t),t=""),n=!0),o(this,e,t,!1,n)},a.prototype.unshift=function(e){return o(this,e,null,!0,!1)},a.prototype.isPaused=function(){return!1===this._readableState.flowing},a.prototype.setEncoding=function(e){return O||(O=n(39).StringDecoder),this._readableState.decoder=new O(e),this._readableState.encoding=e,this};var j=8388608;a.prototype.read=function(e){A("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return A("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?v(this):u(this),null;if(0===(e=l(e,t))&&t.ended)return 0===t.length&&v(this),null;var r,i=t.needReadable;return A("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&A("length less than watermark",i=!0),t.ended||t.reading?A("reading or ended",i=!1):i&&(A("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=l(n,t))),null===(r=e>0?g(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&v(this)),null!==r&&this.emit("data",r),r},a.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},a.prototype.pipe=function(e,t){function n(e,t){A("onunpipe"),e===d&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,a())}function i(){A("onend"),e.end()}function a(){A("cleanup"),e.removeListener("close",l),e.removeListener("finish",u),e.removeListener("drain",p),e.removeListener("error",s),e.removeListener("unpipe",n),d.removeListener("end",i),d.removeListener("end",c),d.removeListener("data",o),g=!0,!h.awaitDrain||e._writableState&&!e._writableState.needDrain||p()}function o(t){A("ondata"),v=!1,!1!==e.write(t)||v||((1===h.pipesCount&&h.pipes===e||h.pipesCount>1&&-1!==b(h.pipes,e))&&!g&&(A("false write response, pause",d._readableState.awaitDrain),d._readableState.awaitDrain++,v=!0),d.pause())}function s(t){A("onerror",t),c(),e.removeListener("error",s),0===k(e,"error")&&e.emit("error",t)}function l(){e.removeListener("finish",u),c()}function u(){A("onfinish"),e.removeListener("close",l),c()}function c(){A("unpipe"),d.unpipe(e)}var d=this,h=this._readableState;switch(h.pipesCount){case 0:h.pipes=e;break;case 1:h.pipes=[h.pipes,e];break;default:h.pipes.push(e)}h.pipesCount+=1,A("pipe count=%d opts=%j",h.pipesCount,t);var f=t&&!1===t.end||e===r.stdout||e===r.stderr?c:i;h.endEmitted?x(f):d.once("end",f),e.on("unpipe",n);var p=function(e){return function(){var t=e._readableState;A("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&k(e,"data")&&(t.flowing=!0,m(e))}}(d);e.on("drain",p);var g=!1,v=!1;return d.on("data",o),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?_(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",s),e.once("close",l),e.once("finish",u),e.emit("pipe",d),h.flowing||(A("pipe resume"),d.resume()),e},a.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)r[a].emit("unpipe",this,n);return this}var o=b(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},a.prototype.addListener=a.prototype.on=function(e,t){var n=E.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&u(this):x(f,this))}return n},a.prototype.resume=function(){var e=this._readableState;return e.flowing||(A("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,x(p,e,t))}(this,e)),this},a.prototype.pause=function(){return A("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(A("pause"),this._readableState.flowing=!1,this.emit("pause")),this},a.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;for(var i in e.on("end",(function(){if(A("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)})),e.on("data",(function(i){A("wrapped data"),t.decoder&&(i=t.decoder.write(i)),t.objectMode&&null==i||!(t.objectMode||i&&i.length)||r.push(i)||(n=!0,e.pause())})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var a=0;a<N.length;a++)e.on(N[a],r.emit.bind(r,N[a]));return r._read=function(t){A("wrapped _read",t),n&&(n=!1,e.resume())},r},a._fromList=g}).call(t,n(0),n(4))},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,o,s,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(a(n=this._events[e]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(i(n))for(s=Array.prototype.slice.call(arguments,1),o=(u=n.slice()).length,l=0;l<o;l++)u[l].apply(this,s);return!0},n.prototype.on=n.prototype.addListener=function(e,t){var o;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(o=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,a,o,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(n=this._events[e]).length,a=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(s=o;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){a=s;break}if(a<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){e.exports=n(35).EventEmitter},function(e,t,n){"use strict";function r(e,t){e.emit("error",t)}var i=n(10);e.exports={destroy:function(e,t){var n=this;this._readableState&&this._readableState.destroyed||this._writableState&&this._writableState.destroyed?t?t(e):!e||this._writableState&&this._writableState.errorEmitted||i(r,this,e):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(i(r,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})))},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){"use strict";(function(t,r,i){function a(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(undefined),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}function o(){}function s(e,t){g=g||n(5),this.objectMode=!!(e=e||{}).objectMode,t instanceof g&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark;this.highWaterMark=r||0===r?r:this.objectMode?16:16384,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1,this.decodeStrings=!(!1===e.decodeStrings),this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(m(i,r),m(p,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(i(r),e._writableState.errorEmitted=!0,e.emit("error",r),p(e,t))}(e,n,r,t,i);else{var a=h(n);a||n.corked||n.bufferProcessing||!n.bufferedRequest||d(e,n),r?v(c,e,n,a,i):c(e,n,a,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function l(e){if(g=g||n(5),!(b.call(l,this)||this instanceof g))return new l(e);this._writableState=new s(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),w.call(this)}function u(e,t,n,r,i,a,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function c(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),p(e,t)}function d(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=new Array(t.bufferedRequestCount),i=t.corkedRequestsFree;i.entry=n;for(var o=0,s=!0;n;)r[o]=n,n.isBuf||(s=!1),n=n.next,o+=1;r.allBuffers=s,u(e,t,!0,t.length,r,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new a(t)}else{for(;n;){var l=n.chunk;if(u(e,t,!1,t.objectMode?1:l.length,l,n.encoding,n.callback),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function h(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function f(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),p(e,t)}))}function p(e,t){var n=h(t);return n&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,m(f,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}var m=n(10);e.exports=l;var g,v=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:m;l.WritableState=s;var y=n(7);y.inherits=n(3);var b,x={deprecate:n(79)},w=n(36),_=n(11).Buffer,k=i.Uint8Array||function(){},E=n(37);y.inherits(l,w),s.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(s.prototype,"buffer",{get:x.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(b=Function.prototype[Symbol.hasInstance],Object.defineProperty(l,Symbol.hasInstance,{value:function(e){return!!b.call(this,e)||e&&e._writableState instanceof s}})):b=function(e){return e instanceof this},l.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},l.prototype.write=function(e,t,n){var r=this._writableState,i=!1,a=function(e){return _.isBuffer(e)||e instanceof k}(e)&&!r.objectMode;return a&&!_.isBuffer(e)&&(e=function(e){return _.from(e)}(e)),"function"==typeof t&&(n=t,t=null),a?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=o),r.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),m(t,n)}(this,n):(a||function(e,t,n,r){var i=!0,a=!1;return null===n?a=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(e.emit("error",a),m(r,a),i=!1),i}(this,r,e,n))&&(r.pendingcb++,i=function(e,t,n,r,i,a){if(!n){var o=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=_.from(t,n)),t}(t,r,i);r!==o&&(n=!0,i="buffer",r=o)}var s=t.objectMode?1:r.length;t.length+=s;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:a,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else u(e,t,!1,s,r,i,a);return l}(this,r,a,e,t,n)),i},l.prototype.cork=function(){this._writableState.corked++},l.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||d(this,e))},l.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},l.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},l.prototype._writev=null,l.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,p(e,t),n&&(t.finished?m(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n)},Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),l.prototype.destroy=E.destroy,l.prototype._undestroy=E.undestroy,l.prototype._destroy=function(e,t){this.end(),t(e)}}).call(t,n(4),n(77).setImmediate,n(0))},function(e,t,n){"use strict";function r(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(h.isEncoding===f||!f(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=o,this.end=s,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=l,this.end=u,t=3;break;default:return this.write=c,void(this.end=d)}this.lastNeed=0,this.lastTotal=0,this.lastChar=h.allocUnsafe(t)}function i(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:-1}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"\ufffd".repeat(n);if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"\ufffd".repeat(n+1);if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"\ufffd".repeat(n+2)}}(this,e,t);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function o(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function s(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("utf16le",0,this.lastTotal-this.lastNeed):t}function l(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function u(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function c(e){return e.toString(this.encoding)}function d(e){return e&&e.length?this.write(e):""}var h=n(11).Buffer,f=h.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};t.StringDecoder=r,r.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},r.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\ufffd".repeat(this.lastTotal-this.lastNeed):t},r.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var a=i(t[r]);return a>=0?(a>0&&(e.lastNeed=a-1),a):--r<n?0:(a=i(t[r]))>=0?(a>0&&(e.lastNeed=a-2),a):--r<n?0:(a=i(t[r]))>=0?(a>0&&(2===a?a=0:e.lastNeed=a-3),a):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},r.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";function r(e){this.afterTransform=function(t,n){return function(e,t,n){var r=e._transformState;r.transforming=!1;var i=r.writecb;if(!i)return e.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=n&&e.push(n),i(t);var a=e._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&e._read(a.highWaterMark)}(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function i(e){if(!(this instanceof i))return new i(e);o.call(this,e),this._transformState=new r(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(e,n){a(t,e,n)})):a(t)}))}function a(e,t,n){if(t)return e.emit("error",t);null!=n&&e.push(n);var r=e._transformState;if(e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(r.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}e.exports=i;var o=n(5),s=n(7);s.inherits=n(3),s.inherits(i,o),i.prototype.push=function(e,t){return this._transformState.needTransform=!1,o.prototype.push.call(this,e,t)},i.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},i.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},i.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},i.prototype._destroy=function(e,t){var n=this;o.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(16);Object.defineProperty(t,"nifti",{enumerable:!0,get:function(){return function(e){return e&&e.__esModule?e:{default:e}}(r).default}});var i=n(1);Object.defineProperty(t,"external",{enumerable:!0,get:function(){return i.external}})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){var n=p.niftiReader,r=p.metaDataManager.get(t);if(r){var i=f.default.fromURL(t);switch(e){case"functional":return{frameOfReferenceUID:i.filePath,timeSlices:r.timeSlices};case"imagePlane":case"imagePlaneModule":return{frameOfReferenceUID:i.filePath,columns:r.columns,rows:r.rows,imageOrientationPatient:r.imageOrientationPatient,columnCosines:r.columnCosines,rowCosines:r.rowCosines,imagePositionPatient:r.imagePositionPatient,sliceThickness:r.slicePixelSpacing,columnPixelSpacing:r.columnPixelSpacing,rowPixelSpacing:r.rowPixelSpacing};case"imagePixel":case"imagePixelModule":return{samplesPerPixel:a(r),photometricInterpretation:o(r,n),rows:r.rows,columns:r.columns,bitsAllocated:r.header.numBitsPerVoxel,bitsStored:r.header.numBitsPerVoxel,highBit:r.header.numBitsPerVoxel-1,pixelRepresentation:s(r,n),planarConfiguration:l(r),pixelAspectRatio:u(r),smallestPixelValue:r.minPixelValue,largestPixelValue:r.maxPixelValue};case"modalityLut":case"modalityLutModule":return{rescaleIntercept:r.intercept,rescaleSlope:r.slope,rescaleType:"US",modalityLutSequence:void 0};case"voiLut":case"voiLutModule":return{windowCenter:r.windowCenter,windowWidth:r.windowWidth,voiLutSequence:void 0};case"multiFrame":case"multiFrameModule":return{numberOfFrames:r.numberOfFrames,frameIncrementPointer:void 0,stereoPairsPresent:"NO"};default:return}}}function a(e){return e.header.dims[0]>=5&&e.header.dims[5]>1?e.header.dims[5]:1}function o(e,t){var n=e.header.datatypeCode,r=a(e);return n===t.NIFTI1.TYPE_RGB&&3===r||n===t.NIFTI1.TYPE_RGBA&&4===r?"RGB":"MONOCHROME2"}function s(e,t){switch(e.header.datatypeCode){case t.NIFTI1.TYPE_UINT8:case t.NIFTI1.TYPE_UINT16:case t.NIFTI1.TYPE_UINT32:case t.NIFTI1.TYPE_UINT64:return"0000H";case t.NIFTI1.TYPE_INT8:case t.NIFTI1.TYPE_INT16:case t.NIFTI1.TYPE_INT32:case t.NIFTI1.TYPE_INT64:return"0001H";case t.NIFTI1.TYPE_FLOAT32:case t.NIFTI1.TYPE_FLOAT64:case t.NIFTI1.TYPE_RGB:case t.NIFTI1.TYPE_RGBA:return"0000H"}}function l(e){return a(e)>1?0:void 0}function u(e){var t=(0,p.decimalToFraction)(e.header.pixDims[2]/e.header.pixDims[1]);return t.numerator+"/"+t.denominator}Object.defineProperty(t,"__esModule",{value:!0}),t.metaDataProvider=i,t.metaDataProviderBuilder=function(e){var t=e.decimalToFraction,n=e.niftiReader;return p.metaDataManager=e.metaDataManager,p.decimalToFraction=t,p.niftiReader=n,i};var c=r(n(17)),d=n(43),h=n(1),f=r(n(8)),p={metaDataManager:c.default,decimalToFraction:d.decimalToFraction,niftiReader:h.external.niftiReader}},function(e,t,n){"use strict";function r(e){return e>0&&e%1>0&&e%1<1||e<0&&e%-1<0&&e%-1>-1}function i(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}function a(e,t){if(!("number"==typeof e||e instanceof Number)||!("number"==typeof t||t instanceof Number))throw new Error("Greatest common factor requires 2 numbers to compute. What was provided: "+e+" and "+t+".");e=Math.abs(e),t=Math.abs(t);for(var n=void 0;t;)n=e%t,e=t,t=n;return e}Object.defineProperty(t,"__esModule",{value:!0});var o=function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.numerator=t,this.denominator=n};t.decimalToFraction=function(e){if("number"!=typeof e||e instanceof Number)throw new Error("The provided argument ("+e+") is not a number.");var t=new o(e,1);if(r(e)){var n=i(e,9),s=Math.pow(10,n.toString().split(".")[1].length);t.numerator=Math.round(t.numerator*s),t.denominator*=s}var l=a(t.numerator,t.denominator);return t.numerator/=l,t.denominator/=l,t},t.hasDecimalPoint=r,t.roundToPlaces=i,t.gcf=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enhancedNiftiReader=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(n(45)).default,i=[r.NIFTI1,r.NIFTI2];!function(e){e.NIFTI1.prototype.readHeader=function(t){var n=new DataView(t),r=e.Utils.getIntAt(n,0,this.littleEndian),i=void 0,a=void 0,o=void 0;if(r!==e.NIFTI1.MAGIC_COOKIE&&(this.littleEndian=!0,r=e.Utils.getIntAt(n,0,this.littleEndian)),r!==e.NIFTI1.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=e.Utils.getByteAt(n,39),i=0;i<8;i+=1)this.dims[i]=e.Utils.getShortAt(n,40+2*i,this.littleEndian);for(this.intent_p1=e.Utils.getFloatAt(n,56,this.littleEndian),this.intent_p2=e.Utils.getFloatAt(n,60,this.littleEndian),this.intent_p3=e.Utils.getFloatAt(n,64,this.littleEndian),this.intent_code=e.Utils.getShortAt(n,68,this.littleEndian),this.datatypeCode=e.Utils.getShortAt(n,70,this.littleEndian),this.numBitsPerVoxel=e.Utils.getShortAt(n,72,this.littleEndian),this.slice_start=e.Utils.getShortAt(n,74,this.littleEndian),i=0;i<8;i+=1)this.pixDims[i]=e.Utils.getFloatAt(n,76+4*i,this.littleEndian);for(this.vox_offset=e.Utils.getFloatAt(n,108,this.littleEndian),this.scl_slope=e.Utils.getFloatAt(n,112,this.littleEndian),this.scl_inter=e.Utils.getFloatAt(n,116,this.littleEndian),this.slice_end=e.Utils.getShortAt(n,120,this.littleEndian),this.slice_code=e.Utils.getByteAt(n,122),this.xyzt_units=e.Utils.getByteAt(n,123),this.cal_max=e.Utils.getFloatAt(n,124,this.littleEndian),this.cal_min=e.Utils.getFloatAt(n,128,this.littleEndian),this.slice_duration=e.Utils.getFloatAt(n,132,this.littleEndian),this.toffset=e.Utils.getFloatAt(n,136,this.littleEndian),this.description=e.Utils.getStringAt(n,148,228),this.aux_file=e.Utils.getStringAt(n,228,252),this.qform_code=e.Utils.getShortAt(n,252,this.littleEndian),this.sform_code=e.Utils.getShortAt(n,254,this.littleEndian),this.quatern_b=e.Utils.getFloatAt(n,256,this.littleEndian),this.quatern_c=e.Utils.getFloatAt(n,260,this.littleEndian),this.quatern_d=e.Utils.getFloatAt(n,264,this.littleEndian),this.qoffset_x=e.Utils.getFloatAt(n,268,this.littleEndian),this.qoffset_y=e.Utils.getFloatAt(n,272,this.littleEndian),this.qoffset_z=e.Utils.getFloatAt(n,276,this.littleEndian),a=0;a<3;a+=1)for(o=0;o<4;o+=1)this.affine[a][o]=e.Utils.getFloatAt(n,280+4*(4*a+o),this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=e.Utils.getStringAt(n,328,344),this.magic=e.Utils.getStringAt(n,344,348),this.isHDR=this.magic===e.NIFTI1.MAGIC_NUMBER2,this.setExtendedHeader(n)},e.NIFTI2.prototype.readHeader=function(t){var n=new DataView(t),r=e.Utils.getIntAt(n,0,this.littleEndian),i=void 0,a=void 0,o=void 0;if(r!==e.NIFTI2.MAGIC_COOKIE&&(this.littleEndian=!0,r=e.Utils.getIntAt(n,0,this.littleEndian)),r!==e.NIFTI2.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.datatypeCode=e.Utils.getShortAt(n,12,this.littleEndian),this.numBitsPerVoxel=e.Utils.getShortAt(n,14,this.littleEndian),i=0;i<8;i+=1)this.dims[i]=e.Utils.getLongAt(n,16+8*i,this.littleEndian);for(this.intent_p1=e.Utils.getDoubleAt(n,80,this.littleEndian),this.intent_p2=e.Utils.getDoubleAt(n,88,this.littleEndian),this.intent_p3=e.Utils.getDoubleAt(n,96,this.littleEndian),i=0;i<8;i+=1)this.pixDims[i]=e.Utils.getDoubleAt(n,104+8*i,this.littleEndian);for(this.vox_offset=e.Utils.getLongAt(n,168,this.littleEndian),this.scl_slope=e.Utils.getDoubleAt(n,176,this.littleEndian),this.scl_inter=e.Utils.getDoubleAt(n,184,this.littleEndian),this.cal_max=e.Utils.getDoubleAt(n,192,this.littleEndian),this.cal_min=e.Utils.getDoubleAt(n,200,this.littleEndian),this.slice_duration=e.Utils.getDoubleAt(n,208,this.littleEndian),this.toffset=e.Utils.getDoubleAt(n,216,this.littleEndian),this.slice_start=e.Utils.getLongAt(n,224,this.littleEndian),this.slice_end=e.Utils.getLongAt(n,232,this.littleEndian),this.description=e.Utils.getStringAt(n,240,320),this.aux_file=e.Utils.getStringAt(n,320,344),this.qform_code=e.Utils.getIntAt(n,344,this.littleEndian),this.sform_code=e.Utils.getIntAt(n,348,this.littleEndian),this.quatern_b=e.Utils.getDoubleAt(n,352,this.littleEndian),this.quatern_c=e.Utils.getDoubleAt(n,360,this.littleEndian),this.quatern_d=e.Utils.getDoubleAt(n,368,this.littleEndian),this.qoffset_x=e.Utils.getDoubleAt(n,376,this.littleEndian),this.qoffset_y=e.Utils.getDoubleAt(n,384,this.littleEndian),this.qoffset_z=e.Utils.getDoubleAt(n,392,this.littleEndian),a=0;a<3;a+=1)for(o=0;o<4;o+=1)this.affine[a][o]=e.Utils.getDoubleAt(n,400+8*(4*a+o),this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=e.Utils.getIntAt(n,496,this.littleEndian),this.xyzt_units=e.Utils.getIntAt(n,500,this.littleEndian),this.intent_code=e.Utils.getIntAt(n,504,this.littleEndian),this.intent_name=e.Utils.getStringAt(n,508,524),this.dim_info=e.Utils.getByteAt(n,524),this.setExtendedHeader(n)},i.forEach((function(t){t.prototype.setExtendedHeader=function(n){n.byteLength>t.MAGIC_COOKIE&&(this.extensionFlag[0]=e.Utils.getByteAt(n,t.MAGIC_COOKIE),this.extensionFlag[1]=e.Utils.getByteAt(n,t.MAGIC_COOKIE+1),this.extensionFlag[2]=e.Utils.getByteAt(n,t.MAGIC_COOKIE+2),this.extensionFlag[3]=e.Utils.getByteAt(n,t.MAGIC_COOKIE+3),this.hasExtendedHeaderData(n)&&(this.extensionSize=this.getExtensionSize(n),this.extensionCode=this.getExtensionCode(n)))},t.prototype.hasExtendedHeaderData=function(e){var t=this.getExtensionLocation();return this.isHDR&&this.extensionFlag[0]&&console.info("Extended header data for hdr file might produce inconsistent values"),this.extensionFlag[0]&&e.byteLength>=t+8}}))}(r),t.enhancedNiftiReader=r},function(e,t,n){"use strict";var r=r||{};r.NIFTI1=r.NIFTI1||n(18),r.NIFTI2=r.NIFTI2||n(46),r.Utils=r.Utils||n(12);var i=i||n(19);r.isNIFTI1=function(e){var t,n,i,a;return!(e.byteLength<r.NIFTI1.STANDARD_HEADER_SIZE||(t=new DataView(e),t&&(n=t.getUint8(r.NIFTI1.MAGIC_NUMBER_LOCATION)),i=t.getUint8(r.NIFTI1.MAGIC_NUMBER_LOCATION+1),a=t.getUint8(r.NIFTI1.MAGIC_NUMBER_LOCATION+2),n!==r.NIFTI1.MAGIC_NUMBER[0]||i!==r.NIFTI1.MAGIC_NUMBER[1]||a!==r.NIFTI1.MAGIC_NUMBER[2]))},r.isNIFTI2=function(e){var t,n,i,a;return!(e.byteLength<r.NIFTI1.STANDARD_HEADER_SIZE||(t=new DataView(e),n=t.getUint8(r.NIFTI2.MAGIC_NUMBER_LOCATION),i=t.getUint8(r.NIFTI2.MAGIC_NUMBER_LOCATION+1),a=t.getUint8(r.NIFTI2.MAGIC_NUMBER_LOCATION+2),n!==r.NIFTI2.MAGIC_NUMBER[0]||i!==r.NIFTI2.MAGIC_NUMBER[1]||a!==r.NIFTI2.MAGIC_NUMBER[2]))},r.isNIFTI=function(e){return r.isNIFTI1(e)||r.isNIFTI2(e)},r.isCompressed=function(e){var t,n,i;if(e){if(n=(t=new DataView(e)).getUint8(0),i=t.getUint8(1),n===r.Utils.GUNZIP_MAGIC_COOKIE1)return!0;if(i===r.Utils.GUNZIP_MAGIC_COOKIE2)return!0}return!1},r.decompress=function(e){return i.inflate(e).buffer},r.readHeader=function(e){var t=null;return r.isCompressed(e)&&(e=r.decompress(e)),r.isNIFTI1(e)?t=new r.NIFTI1:r.isNIFTI2(e)&&(t=new r.NIFTI2),t?t.readHeader(e):console.error("That file does not appear to be NIFTI!"),t},r.hasExtension=function(e){return 0!=e.extensionFlag[0]},r.readImage=function(e,t){var n=e.vox_offset,r=1,i=1;return e.dims[4]&&(r=e.dims[4]),e.dims[5]&&(i=e.dims[5]),t.slice(n,n+e.dims[1]*e.dims[2]*e.dims[3]*r*i*(e.numBitsPerVoxel/8))},r.readExtension=function(e,t){var n=e.getExtensionLocation();return t.slice(n,n+e.extensionSize)},r.readExtensionData=function(e,t){var n=e.getExtensionLocation();return t.slice(n+8,n+e.extensionSize-8)},void 0!==e&&e.exports&&(e.exports=r)},function(e,t,n){"use strict";var r=r||{};r.Utils=r.Utils||n(12),r.NIFTI1=r.NIFTI1||n(18),r.NIFTI2=r.NIFTI2||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.extensionFlag=[0,0,0,0]},r.NIFTI2.MAGIC_COOKIE=540,r.NIFTI2.MAGIC_NUMBER_LOCATION=4,r.NIFTI2.MAGIC_NUMBER=[110,43,50,0,13,10,26,10],r.NIFTI2.prototype.readHeader=function(e){var t,n,i,a=new DataView(e),o=r.Utils.getIntAt(a,0,this.littleEndian);if(o!==r.NIFTI2.MAGIC_COOKIE&&(this.littleEndian=!0,o=r.Utils.getIntAt(a,0,this.littleEndian)),o!==r.NIFTI2.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.datatypeCode=r.Utils.getShortAt(a,12,this.littleEndian),this.numBitsPerVoxel=r.Utils.getShortAt(a,14,this.littleEndian),t=0;t<8;t+=1)this.dims[t]=r.Utils.getLongAt(a,16+8*t,this.littleEndian);for(this.intent_p1=r.Utils.getDoubleAt(a,80,this.littleEndian),this.intent_p2=r.Utils.getDoubleAt(a,88,this.littleEndian),this.intent_p3=r.Utils.getDoubleAt(a,96,this.littleEndian),t=0;t<8;t+=1)this.pixDims[t]=r.Utils.getDoubleAt(a,104+8*t,this.littleEndian);for(this.vox_offset=r.Utils.getLongAt(a,168,this.littleEndian),this.scl_slope=r.Utils.getDoubleAt(a,176,this.littleEndian),this.scl_inter=r.Utils.getDoubleAt(a,184,this.littleEndian),this.cal_max=r.Utils.getDoubleAt(a,192,this.littleEndian),this.cal_min=r.Utils.getDoubleAt(a,200,this.littleEndian),this.slice_duration=r.Utils.getDoubleAt(a,208,this.littleEndian),this.toffset=r.Utils.getDoubleAt(a,216,this.littleEndian),this.slice_start=r.Utils.getLongAt(a,224,this.littleEndian),this.slice_end=r.Utils.getLongAt(a,232,this.littleEndian),this.description=r.Utils.getStringAt(a,240,320),this.aux_file=r.Utils.getStringAt(a,320,344),this.qform_code=r.Utils.getIntAt(a,344,this.littleEndian),this.sform_code=r.Utils.getIntAt(a,348,this.littleEndian),this.quatern_b=r.Utils.getDoubleAt(a,352,this.littleEndian),this.quatern_c=r.Utils.getDoubleAt(a,360,this.littleEndian),this.quatern_d=r.Utils.getDoubleAt(a,368,this.littleEndian),this.qoffset_x=r.Utils.getDoubleAt(a,376,this.littleEndian),this.qoffset_y=r.Utils.getDoubleAt(a,384,this.littleEndian),this.qoffset_z=r.Utils.getDoubleAt(a,392,this.littleEndian),n=0;n<3;n+=1)for(i=0;i<4;i+=1)this.affine[n][i]=r.Utils.getDoubleAt(a,400+8*(4*n+i),this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=r.Utils.getIntAt(a,496,this.littleEndian),this.xyzt_units=r.Utils.getIntAt(a,500,this.littleEndian),this.intent_code=r.Utils.getIntAt(a,504,this.littleEndian),this.intent_name=r.Utils.getStringAt(a,508,524),this.dim_info=r.Utils.getByteAt(a,524),a.byteLength>r.NIFTI2.MAGIC_COOKIE&&(this.extensionFlag[0]=r.Utils.getByteAt(a,540),this.extensionFlag[1]=r.Utils.getByteAt(a,541),this.extensionFlag[2]=r.Utils.getByteAt(a,542),this.extensionFlag[3]=r.Utils.getByteAt(a,543),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(a),this.extensionCode=this.getExtensionCode(a)))},r.NIFTI2.prototype.toFormattedString=function(){var e=r.Utils.formatNumber,t="";return t+="Datatype = "+ +this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",t+="Bits Per Voxel =  = "+this.numBitsPerVoxel+"\n",t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",t+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+"\n",t+="Image Offset = "+this.vox_offset+"\n",t+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+"\n",t+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+"\n",t+="Slice Duration = "+this.slice_duration+"\n",t+="Time Axis Shift = "+this.toffset+"\n",t+="Slice Start = "+this.slice_start+"\n",t+="Slice End = "+this.slice_end+"\n",t+='Description: "'+this.description+'"\n',t+='Auxiliary File: "'+this.aux_file+'"\n',t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",t+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+"\n",t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",t+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+"\n",t+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+"\n",t+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+"\n",t+="Slice Code = "+this.slice_code+"\n",t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(r.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(r.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",t+="Intent Code = "+this.intent_code+"\n",(t+='Intent Name: "'+this.intent_name+'"\n')+"Dim Info = "+this.dim_info+"\n"},r.NIFTI2.prototype.getExtensionLocation=function(){return r.NIFTI2.MAGIC_COOKIE+4},r.NIFTI2.prototype.getExtensionSize=r.NIFTI1.prototype.getExtensionSize,r.NIFTI2.prototype.getExtensionCode=r.NIFTI1.prototype.getExtensionCode,r.NIFTI2.prototype.getDatatypeCodeString=r.NIFTI1.prototype.getDatatypeCodeString,r.NIFTI2.prototype.getTransformCodeString=r.NIFTI1.prototype.getTransformCodeString,r.NIFTI2.prototype.getUnitsCodeString=r.NIFTI1.prototype.getUnitsCodeString,r.NIFTI2.prototype.getQformMat=r.NIFTI1.prototype.getQformMat,r.NIFTI2.prototype.convertNiftiQFormToNiftiSForm=r.NIFTI1.prototype.convertNiftiQFormToNiftiSForm,r.NIFTI2.prototype.convertNiftiSFormToNEMA=r.NIFTI1.prototype.convertNiftiSFormToNEMA,r.NIFTI2.prototype.nifti_mat33_mul=r.NIFTI1.prototype.nifti_mat33_mul,r.NIFTI2.prototype.nifti_mat33_determ=r.NIFTI1.prototype.nifti_mat33_determ,void 0!==e&&e.exports&&(e.exports=r.NIFTI2)},function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);this.options=o.assign({level:h,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var n=a.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==d)throw new Error(l[n]);if(t.header&&a.deflateSetHeader(this.strm,t.header),t.dictionary){var i;if(i="string"==typeof t.dictionary?s.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=a.deflateSetDictionary(this.strm,i))!==d)throw new Error(l[n]);this._dict_set=!0}}function i(e,t){var n=new r(t);if(n.push(e,!0),n.err)throw n.msg||l[n.err];return n.result}var a=n(48),o=n(2),s=n(22),l=n(13),u=n(23),c=Object.prototype.toString,d=0,h=-1,f=0,p=8;r.prototype.push=function(e,t){var n,r,i=this.strm,l=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:!0===t?4:0,i.input="string"==typeof e?s.string2buf(e):"[object ArrayBuffer]"===c.call(e)?new Uint8Array(e):e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new o.Buf8(l),i.next_out=0,i.avail_out=l),1!==(n=a.deflate(i,r))&&n!==d)return this.onEnd(n),this.ended=!0,!1;0!==i.avail_out&&(0!==i.avail_in||4!==r&&2!==r)||this.onData("string"===this.options.to?s.buf2binstring(o.shrinkBuf(i.output,i.next_out)):o.shrinkBuf(i.output,i.next_out))}while((i.avail_in>0||0===i.avail_out)&&1!==n);return 4===r?(n=a.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===d):2!==r||(this.onEnd(d),i.avail_out=0,!0)},r.prototype.onData=function(e){this.chunks.push(e)},r.prototype.onEnd=function(e){e===d&&(this.result="string"===this.options.to?this.chunks.join(""):o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=r,t.deflate=i,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,i(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,i(e,t)}},function(e,t,n){"use strict";function r(e,t){return e.msg=C[t],t}function i(e){return(e<<1)-(e>4?9:0)}function a(e){for(var t=e.length;--t>=0;)e[t]=0}function o(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(k.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function s(e,t){E._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,o(e.strm)}function l(e,t){e.pending_buf[e.pending++]=t}function u(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function c(e,t,n,r){var i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,k.arraySet(t,e.input,e.next_in,i,n),1===e.state.wrap?e.adler=S(e.adler,t,i,n):2===e.state.wrap&&(e.adler=T(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)}function d(e,t){var n,r,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-V?e.strstart-(e.w_size-V):0,u=e.window,c=e.w_mask,d=e.prev,h=e.strstart+W,f=u[a+o-1],p=u[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(n=t)+o]===p&&u[n+o-1]===f&&u[n]===u[a]&&u[++n]===u[a+1]){a+=2,n++;do{}while(u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&a<h);if(r=W-(h-a),a=h-W,r>o){if(e.match_start=t,o=r,r>=s)break;f=u[a+o-1],p=u[a+o]}}}while((t=d[t&c])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function h(e){var t,n,r,i,a,o=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=o+(o-V)){k.arraySet(e.window,e.window,o,o,0),e.match_start-=o,e.strstart-=o,e.block_start-=o,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=o?r-o:0}while(--n);t=n=o;do{r=e.prev[--t],e.prev[t]=r>=o?r-o:0}while(--n);i+=o}if(0===e.strm.avail_in)break;if(n=c(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=H)for(e.ins_h=e.window[a=e.strstart-e.insert],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+H-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<H)););}while(e.lookahead<V&&0!==e.strm.avail_in)}function f(e,t){for(var n,r;;){if(e.lookahead<V){if(h(e),e.lookahead<V&&t===I)return K;if(0===e.lookahead)break}if(n=0,e.lookahead>=H&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+H-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-V&&(e.match_length=d(e,n)),e.match_length>=H)if(r=E._tr_tally(e,e.strstart-e.match_start,e.match_length-H),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=H){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+H-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=E._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(s(e,!1),0===e.strm.avail_out))return K}return e.insert=e.strstart<H-1?e.strstart:H-1,t===A?(s(e,!0),0===e.strm.avail_out?J:Q):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?K:Z}function p(e,t){for(var n,r,i;;){if(e.lookahead<V){if(h(e),e.lookahead<V&&t===I)return K;if(0===e.lookahead)break}if(n=0,e.lookahead>=H&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+H-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=H-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-V&&(e.match_length=d(e,n),e.match_length<=5&&(e.strategy===N||e.match_length===H&&e.strstart-e.match_start>4096)&&(e.match_length=H-1)),e.prev_length>=H&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-H,r=E._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-H),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+H-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=H-1,e.strstart++,r&&(s(e,!1),0===e.strm.avail_out))return K}else if(e.match_available){if((r=E._tr_tally(e,0,e.window[e.strstart-1]))&&s(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return K}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=E._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<H-1?e.strstart:H-1,t===A?(s(e,!0),0===e.strm.avail_out?J:Q):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?K:Z}function m(e,t){for(var n,r,i,a,o=e.window;;){if(e.lookahead<=W){if(h(e),e.lookahead<=W&&t===I)return K;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=H&&e.strstart>0&&(r=o[i=e.strstart-1])===o[++i]&&r===o[++i]&&r===o[++i]){a=e.strstart+W;do{}while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<a);e.match_length=W-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=H?(n=E._tr_tally(e,1,e.match_length-H),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=E._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(s(e,!1),0===e.strm.avail_out))return K}return e.insert=0,t===A?(s(e,!0),0===e.strm.avail_out?J:Q):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?K:Z}function g(e,t){for(var n;;){if(0===e.lookahead&&(h(e),0===e.lookahead)){if(t===I)return K;break}if(e.match_length=0,n=E._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(s(e,!1),0===e.strm.avail_out))return K}return e.insert=0,t===A?(s(e,!0),0===e.strm.avail_out?J:Q):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?K:Z}function v(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function y(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=R,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new k.Buf16(2*z),this.dyn_dtree=new k.Buf16(2*(2*B+1)),this.bl_tree=new k.Buf16(2*(2*$+1)),a(this.dyn_ltree),a(this.dyn_dtree),a(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new k.Buf16(U+1),this.heap=new k.Buf16(2*L+1),a(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new k.Buf16(2*L+1),a(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function b(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=F,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?q:Y,e.adler=2===t.wrap?0:1,t.last_flush=I,E._tr_init(t),O):r(e,D)}function x(e){var t=b(e);return t===O&&function(e){e.window_size=2*e.w_size,a(e.head),e.max_lazy_match=_[e.level].max_lazy,e.good_match=_[e.level].good_length,e.nice_match=_[e.level].nice_length,e.max_chain_length=_[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=H-1,e.match_available=0,e.ins_h=0}(e.state),t}function w(e,t,n,i,a,o){if(!e)return D;var s=1;if(t===M&&(t=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),a<1||a>P||n!==R||i<8||i>15||t<0||t>9||o<0||o>j)return r(e,D);8===i&&(i=9);var l=new y;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+H-1)/H),l.window=new k.Buf8(2*l.w_size),l.head=new k.Buf16(l.hash_size),l.prev=new k.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new k.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=n,x(e)}var _,k=n(2),E=n(49),S=n(20),T=n(21),C=n(13),I=0,A=4,O=0,D=-2,M=-1,N=1,j=4,F=2,R=8,P=9,L=286,B=30,$=19,z=2*L+1,U=15,H=3,W=258,V=W+H+1,q=42,G=103,Y=113,X=666,K=1,Z=2,J=3,Q=4;_=[new v(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(h(e),0===e.lookahead&&t===I)return K;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,s(e,!1),0===e.strm.avail_out))return K;if(e.strstart-e.block_start>=e.w_size-V&&(s(e,!1),0===e.strm.avail_out))return K}return e.insert=0,t===A?(s(e,!0),0===e.strm.avail_out?J:Q):(e.strstart>e.block_start&&s(e,!1),K)})),new v(4,4,8,4,f),new v(4,5,16,8,f),new v(4,6,32,32,f),new v(4,4,16,16,p),new v(8,16,32,32,p),new v(8,16,128,128,p),new v(8,32,128,256,p),new v(32,128,258,1024,p),new v(32,258,258,4096,p)],t.deflateInit=function(e,t){return w(e,t,R,15,8,0)},t.deflateInit2=w,t.deflateReset=x,t.deflateResetKeep=b,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?D:(e.state.gzhead=t,O):D},t.deflate=function(e,t){var n,s,c,d;if(!e||!e.state||t>5||t<0)return e?r(e,D):D;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===X&&t!==A)return r(e,0===e.avail_out?-5:D);if(s.strm=e,n=s.last_flush,s.last_flush=t,s.status===q)if(2===s.wrap)e.adler=0,l(s,31),l(s,139),l(s,8),s.gzhead?(l(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),l(s,255&s.gzhead.time),l(s,s.gzhead.time>>8&255),l(s,s.gzhead.time>>16&255),l(s,s.gzhead.time>>24&255),l(s,9===s.level?2:s.strategy>=2||s.level<2?4:0),l(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(l(s,255&s.gzhead.extra.length),l(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=T(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(l(s,0),l(s,0),l(s,0),l(s,0),l(s,0),l(s,9===s.level?2:s.strategy>=2||s.level<2?4:0),l(s,3),s.status=Y);else{var h=R+(s.w_bits-8<<4)<<8;h|=(s.strategy>=2||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(h|=32),h+=31-h%31,s.status=Y,u(s,h),0!==s.strstart&&(u(s,e.adler>>>16),u(s,65535&e.adler)),e.adler=1}if(69===s.status)if(s.gzhead.extra){for(c=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>c&&(e.adler=T(e.adler,s.pending_buf,s.pending-c,c)),o(e),c=s.pending,s.pending!==s.pending_buf_size));)l(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>c&&(e.adler=T(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=T(e.adler,s.pending_buf,s.pending-c,c)),o(e),c=s.pending,s.pending===s.pending_buf_size)){d=1;break}d=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,l(s,d)}while(0!==d);s.gzhead.hcrc&&s.pending>c&&(e.adler=T(e.adler,s.pending_buf,s.pending-c,c)),0===d&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=T(e.adler,s.pending_buf,s.pending-c,c)),o(e),c=s.pending,s.pending===s.pending_buf_size)){d=1;break}d=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,l(s,d)}while(0!==d);s.gzhead.hcrc&&s.pending>c&&(e.adler=T(e.adler,s.pending_buf,s.pending-c,c)),0===d&&(s.status=G)}else s.status=G;if(s.status===G&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&o(e),s.pending+2<=s.pending_buf_size&&(l(s,255&e.adler),l(s,e.adler>>8&255),e.adler=0,s.status=Y)):s.status=Y),0!==s.pending){if(o(e),0===e.avail_out)return s.last_flush=-1,O}else if(0===e.avail_in&&i(t)<=i(n)&&t!==A)return r(e,-5);if(s.status===X&&0!==e.avail_in)return r(e,-5);if(0!==e.avail_in||0!==s.lookahead||t!==I&&s.status!==X){var f=2===s.strategy?g(s,t):3===s.strategy?m(s,t):_[s.level].func(s,t);if(f!==J&&f!==Q||(s.status=X),f===K||f===J)return 0===e.avail_out&&(s.last_flush=-1),O;if(f===Z&&(1===t?E._tr_align(s):5!==t&&(E._tr_stored_block(s,0,0,!1),3===t&&(a(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),o(e),0===e.avail_out))return s.last_flush=-1,O}return t!==A?O:s.wrap<=0?1:(2===s.wrap?(l(s,255&e.adler),l(s,e.adler>>8&255),l(s,e.adler>>16&255),l(s,e.adler>>24&255),l(s,255&e.total_in),l(s,e.total_in>>8&255),l(s,e.total_in>>16&255),l(s,e.total_in>>24&255)):(u(s,e.adler>>>16),u(s,65535&e.adler)),o(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?O:1)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==q&&69!==t&&73!==t&&91!==t&&t!==G&&t!==Y&&t!==X?r(e,D):(e.state=null,t===Y?r(e,-3):O):D},t.deflateSetDictionary=function(e,t){var n,r,i,o,s,l,u,c,d=t.length;if(!e||!e.state)return D;if(2===(o=(n=e.state).wrap)||1===o&&n.status!==q||n.lookahead)return D;for(1===o&&(e.adler=S(e.adler,t,d,0)),n.wrap=0,d>=n.w_size&&(0===o&&(a(n.head),n.strstart=0,n.block_start=0,n.insert=0),c=new k.Buf8(n.w_size),k.arraySet(c,t,d-n.w_size,n.w_size,0),t=c,d=n.w_size),s=e.avail_in,l=e.next_in,u=e.input,e.avail_in=d,e.next_in=0,e.input=t,h(n);n.lookahead>=H;){r=n.strstart,i=n.lookahead-(H-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+H-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--i);n.strstart=r,n.lookahead=H-1,h(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=H-1,n.match_available=0,e.next_in=l,e.input=u,e.avail_in=s,n.wrap=o,O},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";function r(e){for(var t=e.length;--t>=0;)e[t]=0}function i(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function a(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function o(e){return e<256?$[e]:$[256+(e>>>7)]}function s(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function l(e,t,n){e.bi_valid>A-n?(e.bi_buf|=t<<e.bi_valid&65535,s(e,e.bi_buf),e.bi_buf=t>>A-e.bi_valid,e.bi_valid+=n-A):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function u(e,t,n){l(e,n[2*t],n[2*t+1])}function c(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function d(e,t,n){var r,i,a=new Array(I+1),o=0;for(r=1;r<=I;r++)a[r]=o=o+n[r-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=c(a[s]++,s))}}function h(e){var t;for(t=0;t<E;t++)e.dyn_ltree[2*t]=0;for(t=0;t<S;t++)e.dyn_dtree[2*t]=0;for(t=0;t<T;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*O]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function f(e){e.bi_valid>8?s(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function p(e,t,n,r){var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]}function m(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&p(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!p(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function g(e,t,n){var r,i,a,s,c=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],i=e.pending_buf[e.l_buf+c],c++,0===r?u(e,i,t):(u(e,(a=z[i])+k+1,t),0!==(s=j[a])&&l(e,i-=U[a],s),u(e,a=o(--r),n),0!==(s=F[a])&&l(e,r-=H[a],s))}while(c<e.last_lit);u(e,O,t)}function v(e,t){var n,r,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=C,n=0;n<l;n++)0!==a[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)m(e,a,n);i=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],m(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,a[2*i]=a[2*n]+a[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,a[2*n+1]=a[2*r+1]=i,e.heap[1]=i++,m(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,a,o,s,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(a=0;a<=I;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<C;n++)(a=l[2*l[2*(r=e.heap[n])+1]+1]+1)>p&&(a=p,m++),l[2*r+1]=a,r>u||(e.bl_count[a]++,o=0,r>=f&&(o=h[r-f]),e.opt_len+=(s=l[2*r])*(a+o),d&&(e.static_len+=s*(c[2*r+1]+o)));if(0!==m){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(a=p;0!==a;a--)for(r=e.bl_count[a];0!==r;)(i=e.heap[--n])>u||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),r--)}}(e,t),d(a,u,e.bl_count)}function y(e,t,n){var r,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++s<l&&i===o||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[2*D]++):s<=10?e.bl_tree[2*M]++:e.bl_tree[2*N]++,s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4))}function b(e,t,n){var r,i,a=-1,o=t[1],s=0,c=7,d=4;for(0===o&&(c=138,d=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++s<c&&i===o)){if(s<d)do{u(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(u(e,i,e.bl_tree),s--),u(e,D,e.bl_tree),l(e,s-3,2)):s<=10?(u(e,M,e.bl_tree),l(e,s-3,3)):(u(e,N,e.bl_tree),l(e,s-11,7));s=0,a=i,0===o?(c=138,d=3):i===o?(c=6,d=3):(c=7,d=4)}}function x(e,t,n,r){l(e,(_<<1)+(r?1:0),3),function(e,t,n,r){f(e),s(e,n),s(e,~n),w.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}var w=n(2),_=0,k=256,E=k+1+29,S=30,T=19,C=2*E+1,I=15,A=16,O=256,D=16,M=17,N=18,j=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],F=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],L=new Array(2*(E+2));r(L);var B=new Array(2*S);r(B);var $=new Array(512);r($);var z=new Array(256);r(z);var U=new Array(29);r(U);var H=new Array(S);r(H);var W,V,q,G=!1;t._tr_init=function(e){G||(function(){var e,t,n,r,a,o=new Array(I+1);for(n=0,r=0;r<28;r++)for(U[r]=n,e=0;e<1<<j[r];e++)z[n++]=r;for(z[n-1]=r,a=0,r=0;r<16;r++)for(H[r]=a,e=0;e<1<<F[r];e++)$[a++]=r;for(a>>=7;r<S;r++)for(H[r]=a<<7,e=0;e<1<<F[r]-7;e++)$[256+a++]=r;for(t=0;t<=I;t++)o[t]=0;for(e=0;e<=143;)L[2*e+1]=8,e++,o[8]++;for(;e<=255;)L[2*e+1]=9,e++,o[9]++;for(;e<=279;)L[2*e+1]=7,e++,o[7]++;for(;e<=287;)L[2*e+1]=8,e++,o[8]++;for(d(L,E+1,o),e=0;e<S;e++)B[2*e+1]=5,B[2*e]=c(e,5);W=new i(L,j,k+1,E,I),V=new i(B,F,0,S,I),q=new i(new Array(0),R,0,T,7)}(),G=!0),e.l_desc=new a(e.dyn_ltree,W),e.d_desc=new a(e.dyn_dtree,V),e.bl_desc=new a(e.bl_tree,q),e.bi_buf=0,e.bi_valid=0,h(e)},t._tr_stored_block=x,t._tr_flush_block=function(e,t,n,r){var i,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<k;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),v(e,e.l_desc),v(e,e.d_desc),o=function(e){var t;for(y(e,e.dyn_ltree,e.l_desc.max_code),y(e,e.dyn_dtree,e.d_desc.max_code),v(e,e.bl_desc),t=T-1;t>=3&&0===e.bl_tree[2*P[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),(a=e.static_len+3+7>>>3)<=(i=e.opt_len+3+7>>>3)&&(i=a)):i=a=n+5,n+4<=i&&-1!==t?x(e,t,n,r):4===e.strategy||a===i?(l(e,2+(r?1:0),3),g(e,L,B)):(l(e,4+(r?1:0),3),function(e,t,n,r){var i;for(l(e,t-257,5),l(e,n-1,5),l(e,r-4,4),i=0;i<r;i++)l(e,e.bl_tree[2*P[i]+1],3);b(e,e.dyn_ltree,t-1),b(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),g(e,e.dyn_ltree,e.dyn_dtree)),h(e),r&&f(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(z[n]+k+1)]++,e.dyn_dtree[2*o(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){l(e,2,3),u(e,O,L),function(e){16===e.bi_valid?(s(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=a.inflateInit2(this.strm,t.windowBits);if(n!==l.Z_OK)throw new Error(u[n]);this.header=new d,a.inflateGetHeader(this.strm,this.header)}function i(e,t){var n=new r(t);if(n.push(e,!0),n.err)throw n.msg||u[n.err];return n.result}var a=n(51),o=n(2),s=n(22),l=n(24),u=n(13),c=n(23),d=n(54),h=Object.prototype.toString;r.prototype.push=function(e,t){var n,r,i,u,c,d,f=this.strm,p=this.options.chunkSize,m=this.options.dictionary,g=!1;if(this.ended)return!1;r=t===~~t?t:!0===t?l.Z_FINISH:l.Z_NO_FLUSH,f.input="string"==typeof e?s.binstring2buf(e):"[object ArrayBuffer]"===h.call(e)?new Uint8Array(e):e,f.next_in=0,f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new o.Buf8(p),f.next_out=0,f.avail_out=p),(n=a.inflate(f,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&m&&(d="string"==typeof m?s.string2buf(m):"[object ArrayBuffer]"===h.call(m)?new Uint8Array(m):m,n=a.inflateSetDictionary(this.strm,d)),n===l.Z_BUF_ERROR&&!0===g&&(n=l.Z_OK,g=!1),n!==l.Z_STREAM_END&&n!==l.Z_OK)return this.onEnd(n),this.ended=!0,!1;f.next_out&&(0!==f.avail_out&&n!==l.Z_STREAM_END&&(0!==f.avail_in||r!==l.Z_FINISH&&r!==l.Z_SYNC_FLUSH)||("string"===this.options.to?(i=s.utf8border(f.output,f.next_out),u=f.next_out-i,c=s.buf2string(f.output,i),f.next_out=u,f.avail_out=p-u,u&&o.arraySet(f.output,f.output,i,u,0),this.onData(c)):this.onData(o.shrinkBuf(f.output,f.next_out)))),0===f.avail_in&&0===f.avail_out&&(g=!0)}while((f.avail_in>0||0===f.avail_out)&&n!==l.Z_STREAM_END);return n===l.Z_STREAM_END&&(r=l.Z_FINISH),r===l.Z_FINISH?(n=a.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===l.Z_OK):r!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),f.avail_out=0,!0)},r.prototype.onData=function(e){this.chunks.push(e)},r.prototype.onEnd=function(e){e===l.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=r,t.inflate=i,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,i(e,t)},t.ungzip=i},function(e,t,n){"use strict";function r(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new f.Buf16(320),this.work=new f.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(e){var t;return e&&e.state?(e.total_in=e.total_out=(t=e.state).total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=_,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new f.Buf32(S),t.distcode=t.distdyn=new f.Buf32(T),t.sane=1,t.back=-1,x):w}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,a(e)):w}function s(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?w:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,o(e))):w}function l(e,t){var n,r;return e?(r=new i,e.state=r,r.window=null,(n=s(e,t))!==x&&(e.state=null),n):w}function u(e){if(C){var t;for(d=new f.Buf32(512),h=new f.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(v(y,e.lens,0,288,d,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;v(b,e.lens,0,32,h,0,e.work,{bits:5}),C=!1}e.lencode=d,e.lenbits=9,e.distcode=h,e.distbits=5}function c(e,t,n,r){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new f.Buf8(a.wsize)),r>=a.wsize?(f.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>r&&(i=r),f.arraySet(a.window,t,n-r,i,a.wnext),(r-=i)?(f.arraySet(a.window,t,n-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}var d,h,f=n(2),p=n(20),m=n(21),g=n(52),v=n(53),y=1,b=2,x=0,w=-2,_=1,k=12,E=30,S=852,T=592,C=!0;t.inflateReset=o,t.inflateReset2=s,t.inflateResetKeep=a,t.inflateInit=function(e){return l(e,15)},t.inflateInit2=l,t.inflate=function(e,t){var n,i,a,o,s,l,d,h,S,T,C,I,A,O,D,M,N,j,F,R,P,L,B,$,z=0,U=new f.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return w;(n=e.state).mode===k&&(n.mode=13),s=e.next_out,a=e.output,o=e.next_in,i=e.input,h=n.hold,S=n.bits,T=l=e.avail_in,C=d=e.avail_out,L=x;e:for(;;)switch(n.mode){case _:if(0===n.wrap){n.mode=13;break}for(;S<16;){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}if(2&n.wrap&&35615===h){n.check=0,U[0]=255&h,U[1]=h>>>8&255,n.check=m(n.check,U,2,0),h=0,S=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",n.mode=E;break}if(8!=(15&h)){e.msg="unknown compression method",n.mode=E;break}if(S-=4,P=8+(15&(h>>>=4)),0===n.wbits)n.wbits=P;else if(P>n.wbits){e.msg="invalid window size",n.mode=E;break}n.dmax=1<<P,e.adler=n.check=1,n.mode=512&h?10:k,h=0,S=0;break;case 2:for(;S<16;){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}if(n.flags=h,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=E;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=E;break}n.head&&(n.head.text=h>>8&1),512&n.flags&&(U[0]=255&h,U[1]=h>>>8&255,n.check=m(n.check,U,2,0)),h=0,S=0,n.mode=3;case 3:for(;S<32;){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}n.head&&(n.head.time=h),512&n.flags&&(U[0]=255&h,U[1]=h>>>8&255,U[2]=h>>>16&255,U[3]=h>>>24&255,n.check=m(n.check,U,4,0)),h=0,S=0,n.mode=4;case 4:for(;S<16;){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&n.flags&&(U[0]=255&h,U[1]=h>>>8&255,n.check=m(n.check,U,2,0)),h=0,S=0,n.mode=5;case 5:if(1024&n.flags){for(;S<16;){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}n.length=h,n.head&&(n.head.extra_len=h),512&n.flags&&(U[0]=255&h,U[1]=h>>>8&255,n.check=m(n.check,U,2,0)),h=0,S=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((I=n.length)>l&&(I=l),I&&(n.head&&(P=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),f.arraySet(n.head.extra,i,o,I,P)),512&n.flags&&(n.check=m(n.check,i,I,o)),l-=I,o+=I,n.length-=I),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===l)break e;I=0;do{P=i[o+I++],n.head&&P&&n.length<65536&&(n.head.name+=String.fromCharCode(P))}while(P&&I<l);if(512&n.flags&&(n.check=m(n.check,i,I,o)),l-=I,o+=I,P)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===l)break e;I=0;do{P=i[o+I++],n.head&&P&&n.length<65536&&(n.head.comment+=String.fromCharCode(P))}while(P&&I<l);if(512&n.flags&&(n.check=m(n.check,i,I,o)),l-=I,o+=I,P)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;S<16;){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}if(h!==(65535&n.check)){e.msg="header crc mismatch",n.mode=E;break}h=0,S=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=k;break;case 10:for(;S<32;){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}e.adler=n.check=r(h),h=0,S=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=s,e.avail_out=d,e.next_in=o,e.avail_in=l,n.hold=h,n.bits=S,2;e.adler=n.check=1,n.mode=k;case k:if(5===t||6===t)break e;case 13:if(n.last){h>>>=7&S,S-=7&S,n.mode=27;break}for(;S<3;){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}switch(n.last=1&h,S-=1,3&(h>>>=1)){case 0:n.mode=14;break;case 1:if(u(n),n.mode=20,6===t){h>>>=2,S-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=E}h>>>=2,S-=2;break;case 14:for(h>>>=7&S,S-=7&S;S<32;){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",n.mode=E;break}if(n.length=65535&h,h=0,S=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(I=n.length){if(I>l&&(I=l),I>d&&(I=d),0===I)break e;f.arraySet(a,i,o,I,s),l-=I,o+=I,d-=I,s+=I,n.length-=I;break}n.mode=k;break;case 17:for(;S<14;){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}if(n.nlen=257+(31&h),S-=5,n.ndist=1+(31&(h>>>=5)),S-=5,n.ncode=4+(15&(h>>>=5)),h>>>=4,S-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=E;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;S<3;){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}n.lens[H[n.have++]]=7&h,h>>>=3,S-=3}for(;n.have<19;)n.lens[H[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,L=v(0,n.lens,0,19,n.lencode,0,n.work,B={bits:n.lenbits}),n.lenbits=B.bits,L){e.msg="invalid code lengths set",n.mode=E;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;M=(z=n.lencode[h&(1<<n.lenbits)-1])>>>16&255,N=65535&z,!((D=z>>>24)<=S);){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}if(N<16)h>>>=D,S-=D,n.lens[n.have++]=N;else{if(16===N){for($=D+2;S<$;){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}if(h>>>=D,S-=D,0===n.have){e.msg="invalid bit length repeat",n.mode=E;break}P=n.lens[n.have-1],I=3+(3&h),h>>>=2,S-=2}else if(17===N){for($=D+3;S<$;){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}S-=D,P=0,I=3+(7&(h>>>=D)),h>>>=3,S-=3}else{for($=D+7;S<$;){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}S-=D,P=0,I=11+(127&(h>>>=D)),h>>>=7,S-=7}if(n.have+I>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=E;break}for(;I--;)n.lens[n.have++]=P}}if(n.mode===E)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=E;break}if(n.lenbits=9,L=v(y,n.lens,0,n.nlen,n.lencode,0,n.work,B={bits:n.lenbits}),n.lenbits=B.bits,L){e.msg="invalid literal/lengths set",n.mode=E;break}if(n.distbits=6,n.distcode=n.distdyn,L=v(b,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,B={bits:n.distbits}),n.distbits=B.bits,L){e.msg="invalid distances set",n.mode=E;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(l>=6&&d>=258){e.next_out=s,e.avail_out=d,e.next_in=o,e.avail_in=l,n.hold=h,n.bits=S,g(e,C),s=e.next_out,a=e.output,d=e.avail_out,o=e.next_in,i=e.input,l=e.avail_in,h=n.hold,S=n.bits,n.mode===k&&(n.back=-1);break}for(n.back=0;M=(z=n.lencode[h&(1<<n.lenbits)-1])>>>16&255,N=65535&z,!((D=z>>>24)<=S);){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}if(M&&0==(240&M)){for(j=D,F=M,R=N;M=(z=n.lencode[R+((h&(1<<j+F)-1)>>j)])>>>16&255,N=65535&z,!(j+(D=z>>>24)<=S);){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}h>>>=j,S-=j,n.back+=j}if(h>>>=D,S-=D,n.back+=D,n.length=N,0===M){n.mode=26;break}if(32&M){n.back=-1,n.mode=k;break}if(64&M){e.msg="invalid literal/length code",n.mode=E;break}n.extra=15&M,n.mode=22;case 22:if(n.extra){for($=n.extra;S<$;){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,S-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;M=(z=n.distcode[h&(1<<n.distbits)-1])>>>16&255,N=65535&z,!((D=z>>>24)<=S);){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}if(0==(240&M)){for(j=D,F=M,R=N;M=(z=n.distcode[R+((h&(1<<j+F)-1)>>j)])>>>16&255,N=65535&z,!(j+(D=z>>>24)<=S);){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}h>>>=j,S-=j,n.back+=j}if(h>>>=D,S-=D,n.back+=D,64&M){e.msg="invalid distance code",n.mode=E;break}n.offset=N,n.extra=15&M,n.mode=24;case 24:if(n.extra){for($=n.extra;S<$;){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,S-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=E;break}n.mode=25;case 25:if(0===d)break e;if(n.offset>(I=C-d)){if((I=n.offset-I)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=E;break}A=I>n.wnext?n.wsize-(I-=n.wnext):n.wnext-I,I>n.length&&(I=n.length),O=n.window}else O=a,A=s-n.offset,I=n.length;I>d&&(I=d),d-=I,n.length-=I;do{a[s++]=O[A++]}while(--I);0===n.length&&(n.mode=21);break;case 26:if(0===d)break e;a[s++]=n.length,d--,n.mode=21;break;case 27:if(n.wrap){for(;S<32;){if(0===l)break e;l--,h|=i[o++]<<S,S+=8}if(e.total_out+=C-=d,n.total+=C,C&&(e.adler=n.check=n.flags?m(n.check,a,C,s-C):p(n.check,a,C,s-C)),C=d,(n.flags?h:r(h))!==n.check){e.msg="incorrect data check",n.mode=E;break}h=0,S=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;S<32;){if(0===l)break e;l--,h+=i[o++]<<S,S+=8}if(h!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=E;break}h=0,S=0}n.mode=29;case 29:L=1;break e;case E:L=-3;break e;case 31:return-4;case 32:default:return w}return e.next_out=s,e.avail_out=d,e.next_in=o,e.avail_in=l,n.hold=h,n.bits=S,(n.wsize||C!==e.avail_out&&n.mode<E&&(n.mode<27||4!==t))&&c(e,e.output,e.next_out,C-e.avail_out)?(n.mode=31,-4):(C-=e.avail_out,e.total_in+=T-=e.avail_in,e.total_out+=C,n.total+=C,n.wrap&&C&&(e.adler=n.check=n.flags?m(n.check,a,C,e.next_out-C):p(n.check,a,C,e.next_out-C)),e.data_type=n.bits+(n.last?64:0)+(n.mode===k?128:0)+(20===n.mode||15===n.mode?256:0),(0===T&&0===C||4===t)&&L===x&&(L=-5),L)},t.inflateEnd=function(e){if(!e||!e.state)return w;var t=e.state;return t.window&&(t.window=null),e.state=null,x},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?w:(n.head=t,t.done=!1,x):w},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?w:11===n.mode&&p(1,t,r,0)!==n.check?-3:c(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,x):w},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i,a,o,s,l,u,c,d,h,f,p,m,g,v,y,b,x,w,_,k,E,S,T;S=e.input,i=(r=e.next_in)+(e.avail_in-5),T=e.output,o=(a=e.next_out)-(t-e.avail_out),s=a+(e.avail_out-257),l=(n=e.state).dmax,u=n.wsize,c=n.whave,d=n.wnext,h=n.window,f=n.hold,p=n.bits,m=n.lencode,g=n.distcode,v=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{p<15&&(f+=S[r++]<<p,f+=S[r++]<<(p+=8),p+=8),b=m[f&v];t:for(;;){if(f>>>=x=b>>>24,p-=x,0==(x=b>>>16&255))T[a++]=65535&b;else{if(!(16&x)){if(0==(64&x)){b=m[(65535&b)+(f&(1<<x)-1)];continue t}if(32&x){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}w=65535&b,(x&=15)&&(p<x&&(f+=S[r++]<<p,p+=8),w+=f&(1<<x)-1,f>>>=x,p-=x),p<15&&(f+=S[r++]<<p,f+=S[r++]<<(p+=8),p+=8),b=g[f&y];n:for(;;){if(f>>>=x=b>>>24,p-=x,!(16&(x=b>>>16&255))){if(0==(64&x)){b=g[(65535&b)+(f&(1<<x)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(_=65535&b,p<(x&=15)&&(f+=S[r++]<<p,(p+=8)<x&&(f+=S[r++]<<p,p+=8)),(_+=f&(1<<x)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=x,p-=x,_>(x=a-o)){if((x=_-x)>c&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(k=0,E=h,0===d){if(k+=u-x,x<w){w-=x;do{T[a++]=h[k++]}while(--x);k=a-_,E=T}}else if(d<x){if(k+=u+d-x,(x-=d)<w){w-=x;do{T[a++]=h[k++]}while(--x);if(k=0,d<w){w-=x=d;do{T[a++]=h[k++]}while(--x);k=a-_,E=T}}}else if(k+=d-x,x<w){w-=x;do{T[a++]=h[k++]}while(--x);k=a-_,E=T}for(;w>2;)T[a++]=E[k++],T[a++]=E[k++],T[a++]=E[k++],w-=3;w&&(T[a++]=E[k++],w>1&&(T[a++]=E[k++]))}else{k=a-_;do{T[a++]=T[k++],T[a++]=T[k++],T[a++]=T[k++],w-=3}while(w>2);w&&(T[a++]=T[k++],w>1&&(T[a++]=T[k++]))}break}}break}}while(r<i&&a<s);f&=(1<<(p-=(w=p>>3)<<3))-1,e.next_in=r-=w,e.next_out=a,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=a<s?s-a+257:257-(a-s),n.hold=f,n.bits=p}},function(e,t,n){"use strict";var r=n(2),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,l,u,c,d,h){var f,p,m,g,v,y,b,x,w,_=h.bits,k=0,E=0,S=0,T=0,C=0,I=0,A=0,O=0,D=0,M=0,N=null,j=0,F=new r.Buf16(16),R=new r.Buf16(16),P=null,L=0;for(k=0;k<=15;k++)F[k]=0;for(E=0;E<l;E++)F[t[n+E]]++;for(C=_,T=15;T>=1&&0===F[T];T--);if(C>T&&(C=T),0===T)return u[c++]=20971520,u[c++]=20971520,h.bits=1,0;for(S=1;S<T&&0===F[S];S++);for(C<S&&(C=S),O=1,k=1;k<=15;k++)if(O<<=1,(O-=F[k])<0)return-1;if(O>0&&(0===e||1!==T))return-1;for(R[1]=0,k=1;k<15;k++)R[k+1]=R[k]+F[k];for(E=0;E<l;E++)0!==t[n+E]&&(d[R[t[n+E]]++]=E);if(0===e?(N=P=d,y=19):1===e?(N=i,j-=257,P=a,L-=257,y=256):(N=o,P=s,y=-1),M=0,E=0,k=S,v=c,I=C,A=0,m=-1,g=(D=1<<C)-1,1===e&&D>852||2===e&&D>592)return 1;for(;;){b=k-A,d[E]<y?(x=0,w=d[E]):d[E]>y?(x=P[L+d[E]],w=N[j+d[E]]):(x=96,w=0),f=1<<k-A,S=p=1<<I;do{u[v+(M>>A)+(p-=f)]=b<<24|x<<16|w|0}while(0!==p);for(f=1<<k-1;M&f;)f>>=1;if(0!==f?(M&=f-1,M+=f):M=0,E++,0==--F[k]){if(k===T)break;k=t[n+d[E]]}if(k>C&&(M&g)!==m){for(0===A&&(A=C),v+=S,O=1<<(I=k-A);I+A<T&&!((O-=F[I+A])<=0);)I++,O<<=1;if(D+=1<<I,1===e&&D>852||2===e&&D>592)return 1;u[m=M&g]=C<<24|I<<16|v-c|0}}return 0!==M&&(u[v+M]=k-A<<24|64<<16|0),h.bits=C,0}},function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(16));t.default=function(e){r.default.register(e)}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t,n,r){var i=r*e+t,a=n*e+t;return{windowCenter:(i+a)/2,windowWidth:i-a}}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=r(n(25)),l=r(n(26)),u=r(n(64)),c=r(n(65)),d=n(15),h=r(n(27)),f=r(n(8)),p=r(n(28)),m=r(n(9)),g=Symbol("decompress"),v=Symbol("readMetaData"),y=Symbol("readImageData"),b=Symbol("determineImageDependentMetaData"),x=Symbol("transformImageData"),w=Symbol("createVolume"),_=Symbol("cacheVolume"),k=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e),this.volumeCache=new l.default,this.volumePromises={},this.wholeFileFetcher=new u.default({headers:n}),this.headerOnlyFetcher=new u.default({isFirstBytesOnly:!0,headers:n,beforeSend:function(e){return e.setRequestHeader("Range","bytes=0-10240")},onHeadersReceived:function(e,n,r){if(200===e.status){var i=f.default.fromURL(r.imageId),a=t.headerOnlyFetcher.getFetchPromiseFromCache(i);t.wholeFileFetcher.addFetchPromiseToCache(a.promise,i)}}})}return o(e,[{key:"acquire",value:function(e){var t=this,n=this.volumePromises[e.filePath];if(n&&n.wholeFilePromise)return n.wholeFilePromise;var r=new Promise((function(n,r){var i=t.volumeCache.get(e);i&&i.hasImageData?n(i):t.wholeFileFetcher.fetch(e).then((function(n){return t[g](n,e)})).then((function(e){return t[v](e)})).then((function(e){return t[y](e)})).then((function(e){return t[x](e)})).then((function(e){return t[b](e)})).then((function(n){return t[w](n,e)})).then((function(n){return t[_](n,e)})).then((function(e){return n(e)})).catch(r)}));return this.volumePromises[e.filePath]=this.volumePromises[e.filePath]||{},this.volumePromises[e.filePath].wholeFilePromise=r,r}},{key:"acquireHeaderOnly",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.volumePromises[e.filePath];if(r)return r.headerOnlyPromise||r.wholeFilePromise;var i=new Promise((function(r,i){var a=t.volumeCache.get(e);a?r(a):(n?t.headerOnlyFetcher:t.wholeFileFetcher).fetch(e).then((function(n){return t[g](n,e)})).then((function(e){return t[v](e)})).then((function(n){return t[w](n,e)})).then((function(n){return t[_](n,e)})).then((function(e){return r(e)})).catch(i)}));return this.volumePromises[e.filePath]=this.volumePromises[e.filePath]||{},this.volumePromises[e.filePath].headerOnlyPromise=i,i}},{key:g,value:function(e,t){return(0,c.default)(e,t)}},{key:v,value:function(e){return{decompressedFileData:e,metaData:(0,d.parseNiftiHeader)(e)}}},{key:y,value:function(e){var t=e.metaData,n=(0,d.parseNiftiFile)(e.decompressedFileData,t),r=n.imageData;Object.assign(t,n.metaData);var i=t.voxelLength,a=t.timeSlices,o=[1,i[0],i[0]*i[1],i[0]*i[1]*i[2]],s=(0,m.default)(r,[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(i),[a]),o),l=(0,p.default)(s);return t.minPixelValue=l.min,t.maxPixelValue=l.max,{metaData:t,imageDataNDarray:s}}},{key:x,value:function(e){var t=e.metaData,n=e.imageDataNDarray;if(t.dataType.isDataInFloat){var r=(0,h.default)(n,t);n=r.convertedImageDataView,Object.assign(t,r.metaData,{floatImageDataNDarray:r.floatImageDataView})}return{metaData:t,imageDataNDarray:n}}},{key:b,value:function(e){var t=e.metaData,n=e.imageDataNDarray;return Object.assign(t,t.isWindowInfoAbsent?a(t.slope,t.intercept,t.minPixelValue,t.maxPixelValue):a(1,0,t.windowMinimumValue,t.windowMaximumValue)),{metaData:t,imageDataNDarray:n}}},{key:w,value:function(e,t){var n=e.metaData;return new s.default(t,n,e.imageDataNDarray,n.floatImageDataNDarray)}},{key:_,value:function(e,t){return this.volumeCache.add(t,e),e}}],[{key:"getInstance",value:function(t){return e.instance||(e.instance=new e(t)),e.instance}}]),e}();t.default=k},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),l=r(n(58)),u=r(n(59)),c=r(n(60)),d=r(n(61)),h=Symbol("determineMetaData"),f=Symbol("determinePixelData"),p=Symbol("getDimensionsIndices"),m=Symbol("getPatientOrientation"),g=Symbol("getPatientPosition"),v=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];a(this,e),this.volume=t,this.imageIdObject=n,this.dimension=n.slice.dimension,this.index=n.slice.index,this.timePoint=r?0:n.timePoint,this.metaData={},this[h](),this.volume.hasImageData&&this[f]()}return o(e,[{key:h,value:function(){var e=this.volume.metaData,t=this[p](this.dimension),n=t.rowsIndex,r=t.columnsIndex,a=t.framesIndex,o=e.voxelLength,s=o[n],l=o[r],u=o[a],c=e.pixelSpacing[n],d=e.pixelSpacing[r],h=e.pixelSpacing[a],f=this[m](e.orientationMatrix,r,n),v=f.rowCosines,y=f.columnCosines,b=this[g](e.orientationMatrix,a);Object.assign(this.metaData,{columns:l,rows:s,numberOfFrames:u,columnsIndex:r,rowsIndex:n,framesIndex:a,columnPixelSpacing:d,rowPixelSpacing:c,slicePixelSpacing:h,columnCosines:y,rowCosines:v,imagePositionPatient:b,imageOrientationPatient:[].concat(i(v),i(y)),frameOfReferenceUID:this.imageIdObject.filePath})}},{key:f,value:function(){var e;this.volume.imageDataNDarray.set(0,0,0,255);var t=(0,u.default)([this.index,null,null],this.metaData.framesIndex),n=this.volume.metaData.dataType.TypedArrayConstructor,r=(e=this.volume.imageDataNDarray).pick.apply(e,i(t).concat([this.timePoint]));if(this.pixelData=(0,l.default)(r,n),this.volume.metaData.dataType.isDataInFloat){var a,o=(a=this.volume.imageDataNDarray).pick.apply(a,i(t).concat([this.timePoint]));this.floatPixelData=(0,l.default)(o,this.volume.metaData.dataType.OriginalTypedArrayConstructor)}}},{key:p,value:function(e){var t=void 0,n=void 0,r=void 0;switch(e){case"x":t="xyz".indexOf("z"),n="xyz".indexOf("y"),r="xyz".indexOf("x");break;case"y":t="xyz".indexOf("z"),n="xyz".indexOf("x"),r="xyz".indexOf("y");break;case"z":t="xyz".indexOf("y"),n="xyz".indexOf("x"),r="xyz".indexOf("z")}return{rowsIndex:t,columnsIndex:n,framesIndex:r}}},{key:m,value:function(e,t,n){var r=[e[0][n],e[1][n],e[2][n]];return{rowCosines:(0,d.default)([e[0][t],e[1][t],e[2][t]]),columnCosines:(0,d.default)(r)}}},{key:g,value:function(e,t){var n=(0,u.default)([this.index,0,0],t);return(0,c.default)(e,n).slice(0,3)}},{key:"cornerstoneImageObject",get:function(){var e=this,t=this.volume.metaData,n=this.metaData,r=s.external.cornerstone;return{imageId:this.imageIdObject.url,color:t.dataType.isDataInColors,columnPixelSpacing:n.columnPixelSpacing,columns:n.columns,height:n.rows,intercept:t.intercept,invert:!1,minPixelValue:t.minPixelValue,maxPixelValue:t.maxPixelValue,rowPixelSpacing:n.rowPixelSpacing,rows:n.rows,sizeInBytes:this.pixelData.byteLength,slope:t.slope,width:n.columns,windowCenter:t.windowCenter,windowWidth:t.windowWidth,floatPixelData:this.floatPixelData,decodeTimeInMS:0,getPixelData:function(){return e.pixelData},render:t.dataType.isDataInColors?r.renderColorImage:r.renderGrayscaleImage}}},{key:"compoundMetaData",get:function(){return Object.assign({},this.volume.metaData,this.metaData)}}]),e}();t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=new(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Array)(e.size),n=0,r=0;r<e.shape[1];++r)for(var i=0;i<e.shape[0];++i)t[n++]=e.get(i,r);return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;t-- >0;)e.unshift(e.pop());return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3]||1;return[n*e[0][0]+r*e[0][1]+i*e[0][2]+a*e[0][3],n*e[1][0]+r*e[1][1]+i*e[1][2]+a*e[1][3],n*e[2][0]+r*e[2][1]+i*e[2][2]+a*e[2][3],n*e[3][0]+r*e[3][1]+i*e[3][2]+a*e[3][3]]}},function(e,t,n){"use strict";function r(e,t){return e+t*t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.reduce(r,0),n=Math.sqrt(t);return 0===n&&(n=1),e.map((function(e){return e/n}))}},function(e,t,n){"use strict";e.exports=function(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=n;return t}},function(e,t){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(n(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}(e)||!!e._isBuffer)}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n,r){return function(i){var a=i.loaded,s=void 0,l=void 0;i.lengthComputable&&(s=i.total,l=Math.round(a/s*100)),o(n.onprogress,i,r),u.default.imageLoadProgress({url:e,imageId:t,loaded:a,total:s,percentComplete:l})}}function a(e,t){return function(n){o(e.onreadystatechange,n,t),e.onreadystatechange||(2===this.readyState&&e.onHeadersReceived&&e.onHeadersReceived(this,e,t),4!==this.readyState)||([200,206].includes(this.status)?t.deferred.resolve(this.response):t.deferred.reject(new Error("Could not fetch the file '"+t.url+"'. Error code was "+this.status+".")))}}function o(e,t,n){e&&e(t,n)}function s(){}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e){return e&&e.__esModule?e:{default:e}}(n(14)),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.method,i=void 0===n?"GET":n,a=t.responseType,o=void 0===a?"arraybuffer":a,l=t.beforeSend,u=void 0===l?s:l,c=t.headers,d=void 0===c?{}:c,h=t.onHeadersReceived,f=void 0===h?s:h;r(this,e),this.options={method:i,responseType:o,beforeSend:u,headers:d,onHeadersReceived:f},this.promisesCache={}}return l(e,[{key:"fetch",value:function(e){var t=this,n=this.getFetchPromiseFromCache(e),r=void 0;return n?r=n.promise:(r=new Promise((function(n,r){var o=new XMLHttpRequest,s={deferred:{resolve:n,reject:r},url:e.filePath,imageId:e.url};o.open(t.options.method,e.filePath,!0),o.responseType=t.options.responseType,"function"==typeof t.options.beforeSend&&t.options.beforeSend(o,e.url),Object.keys(t.options.headers).forEach((function(e){o.setRequestHeader(e,t.options.headers[e])})),o.addEventListener("readystatechange",a(t.options,s)),o.addEventListener("progress",i(e.filePath,e.url,t.options,s)),o.send()})),this.addFetchPromiseToCache(r,e)),r}},{key:"getFetchPromiseFromCache",value:function(e){var t=this,n=this.promisesCache[e.filePath];return Array.isArray(n)&&n.find((function(e){return e.fetcher===t}))}},{key:"addFetchPromiseToCache",value:function(e,t){this.promisesCache[t.filePath]=this.promisesCache[t.filePath]||[],this.promisesCache[t.filePath].unshift(new d(this,t,e))}}]),e}();t.default=c;var d=function e(t,n,i){r(this,e),this.fetcher=t,this.imageIdObject=n,this.promise=i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=r.nifti,i=e;if(n.isCompressed(e)&&(i=n.decompress(e)),!n.isNIFTI(i))throw new Error("The file '"+t.filePath+"' is not a valid NIFTI file.");return i};var r={nifti:n(1).external.niftiReader}},function(e,t,n){"use strict";function r(e){return e>>8&255|e<<8&65280}function i(e){return e>>24&255|e>>8&65280|e<<8&16711680|e<<24&4278190080}function a(e){return e>>56&255|e>>40&65280|e>>24&16711680|e>>8&4278190080|e<<8&0xff00000000|e<<24&0xff0000000000|e<<40&0xff000000000000|e<<56&0xff00000000000000}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=o.external.niftiReader;switch(e){case n.NIFTI1.TYPE_INT16:case n.NIFTI1.TYPE_UINT16:t=function(e){for(var t=0;t<e.length;t++)e[t]=r(e[t]);return e}(t);break;case n.NIFTI1.TYPE_RGB24:t=t;break;case n.NIFTI1.TYPE_INT32:case n.NIFTI1.TYPE_FLOAT32:case n.NIFTI1.TYPE_UINT32:t=function(e){for(var t=0;t<e.length;t++)e[t]=i(e[t]);return e}(t);break;case n.NIFTI1.TYPE_COMPLEX64:case n.NIFTI1.TYPE_FLOAT64:case n.NIFTI1.TYPE_INT64:case n.NIFTI1.TYPE_UINT64:t=function(e){for(var t=0;t<e.length;t++)e[t]=a(e[t]);return e}(t);break;case n.NIFTI1.TYPE_FLOAT128:case n.NIFTI1.TYPE_COMPLEX128:t=t;break;case n.NIFTI1.TYPE_COMPLEX256:t=t}return t};var o=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){switch(e){case r.NIFTI1.TYPE_FLOAT32:case r.NIFTI1.TYPE_FLOAT64:return i(t)}return t};var r=n(1).external.niftiReader,i=function(e){for(var t=0;t<e.length;t++)isNaN(e[t])?e[t]=0:isFinite(e[t])||(e[t]=Math.sign(e[t])*Number.MAX_VALUE);return e}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t,n,r){var i=r*e+t,a=n*e+t;return{windowCenter:(i+a)/2,windowWidth:i-a}}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=r(n(25)),l=r(n(26)),u=n(15),c=r(n(27)),d=r(n(8)),h=r(n(28)),f=r(n(29)),p=r(n(69)),m=r(n(9)),g=Symbol("readImageData"),v=Symbol("determineImageDependentMetaData"),y=Symbol("transformImageData"),b=Symbol("createVolume"),x=Symbol("cacheVolume"),w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e),this.volumeCache=new l.default,this.volumeFetchers={},this.httpHeaders=t}return o(e,[{key:"acquireTimepoint",value:function(e){var t=this,n=this.volumeCache.getTimepoint(e,e.timePoint);if(!n||!n.hasImageData){var r=this.getFetcherData(e);if(r.timePointPromises[e.timePoint])return r.timePointPromises[e.timePoint];var i=new Promise((function(n,i){r.volumeFetcher.fetchTimepoint(e.timePoint).then((function(e){return t[g](e)})).then((function(e){return t[y](e)})).then((function(e){return t[v](e)})).then((function(n){return t[b](n,e)})).then((function(n){return t[x](n,e)})).then((function(e){return n(e)})).catch(i)}));return r.timePointPromises[e.timePoint]=i,i}Promise.resolve(n)}},{key:"acquireHeaderOnly",value:function(e){var t=this,n=this.getFetcherData(e);if(n.headerPromise)return n.headerPromise;var r=new Promise((function(r,i){var a=t.volumeCache.getTimepoint(e,e.timePoint);a?r(a):n.volumeFetcher.getHeaderPromise().then((function(n){return t[b](n,e)})).then((function(n){return t[x](n,e)})).then((function(e){return r(e)})).catch(i)}));return this.volumeFetchers[e.filePath]=this.volumeFetchers[e.filePath]||{},this.volumeFetchers[e.filePath].headerOnlyPromise=r,r}},{key:g,value:function(e){var t=e.metaData,n=(0,f.default)(e.headerData,e.volumeData),r=(0,u.parseNiftiFile)(n.buffer,null),i=r.imageData;Object.assign(t,r.metaData);var a=t.voxelLength,o=[1,a[0],a[0]*a[1],a[0]*a[1]*a[2]],s=(0,m.default)(i,[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(a),[1]),o),l=(0,h.default)(s);return t.minPixelValue=l.min,t.maxPixelValue=l.max,{metaData:t,imageDataNDarray:s}}},{key:y,value:function(e){var t=e.metaData,n=e.imageDataNDarray;if(t.dataType.isDataInFloat){var r=(0,c.default)(n,t);n=r.convertedImageDataView,Object.assign(t,r.metaData,{floatImageDataNDarray:r.floatImageDataView})}return{metaData:t,imageDataNDarray:n}}},{key:v,value:function(e){var t=e.metaData,n=e.imageDataNDarray;return Object.assign(t,t.isWindowInfoAbsent?a(t.slope,t.intercept,t.minPixelValue,t.maxPixelValue):a(1,0,t.windowMinimumValue,t.windowMaximumValue)),{metaData:t,imageDataNDarray:n}}},{key:b,value:function(e,t){var n=e.metaData,r=e.imageDataNDarray,i=new d.default(t.filePath,t.slice,0);return new s.default(i,n,r,n.floatImageDataNDarray,!0)}},{key:x,value:function(e,t){return this.volumeCache.add(t,e),e}},{key:"getFetcherData",value:function(e){return this.volumeFetchers[""+e.filePath]=this.volumeFetchers[""+e.filePath]||{headerPromise:null,timePointPromises:[],volumeFetcher:new p.default(e,{headers:this.httpHeaders})},this.volumeFetchers[""+e.filePath]}}],[{key:"getInstance",value:function(t){return e.instance||(e.instance=new e(t)),e.instance}}]),e}();t.default=w},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(){}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),l=r(n(19)),u=r(n(70)),c=n(15),d=r(n(29)),h=s.external.niftiReader,f=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.method,o=void 0===r?"GET":r,s=n.responseType,l=void 0===s?"arraybuffer":s,u=n.beforeSend,c=void 0===u?a:u,d=n.headers,h=void 0===d?{}:d,f=n.onHeadersReceived,p=void 0===f?a:f;i(this,e),this.imageId=t,this.options={method:o,responseType:l,beforeSend:c,headers:h,onHeadersReceived:p},this.volumeData=e.createDefaultVolumeData()}return o(e,[{key:"fetchTimepoint",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.ensureStreaming(this.imageId),new Promise((function(r,i){try{t.getHeaderPromise().then((function(a){var o=e.getVolumeTimepointDataLength(a);t.getBufferPromise(t.volumeData.headerOffset+n*o,o).then((function(e){r({headerData:a.headerData,volumeData:e,metaData:a.metaData})})).catch(i)}))}catch(e){i(e)}}))}},{key:"ensureStreaming",value:function(t){var n=this.volumeData;if(!n.streamer){var r=new u.default(this.options);n.streamer=r,e.runStreamer(t,n)}}},{key:"getHeaderPromise",value:function(){this.ensureStreaming(this.imageId);var e=this.volumeData;return e.header?Promise.resolve(e.header):e.headerPromise}},{key:"getBufferPromise",value:function(e,t){var n=this;return this.ensureStreaming(this.imageId),new Promise((function(r,i){n.volumeData.dataStreamedLength>=t?r(n.volumeData.buffer.slice(e,e+t)):n.volumeData.bufferPromiseEntries.push({offset:e,length:t,promise:{resolve:r,reject:i}})}))}}],[{key:"runStreamer",value:function(t,n){n.streamer.stream(t,(function(t){if(!n.headerParsed){if(!e.tryParseHeader(n,t))return;return n.headerPromiseMethods.resolve(n.header),e.evaluatePromises(n),void(n.headerParsed=!0)}n.isCompressed&&(t=e.uncompress(n,t)),e.addToImageDataBuffer(n,t),e.evaluatePromises(n)}))}},{key:"evaluatePromises",value:function(e){for(var t=e.bufferPromiseEntries.length-1;t>=0;){var n=e.bufferPromiseEntries[t];e.dataStreamedLength>=n.offset+n.length&&(e.bufferPromiseEntries.splice(t,1),n.promise.resolve(e.buffer.slice(n.offset,n.offset+n.length))),t--}}},{key:"createDefaultVolumeData",value:function(){var e={},t=new Promise((function(t,n){e.resolve=t,e.reject=n}));return{streamer:null,buffer:new Uint8Array(0),bufferPromiseEntries:[],dataStreamedLength:0,isCompressed:!1,tmpBuffer:new Uint8Array(0),headerParsed:!1,inflator:new l.default.Inflate,headerPromise:t,headerPromiseMethods:e,headerOffset:352}}},{key:"parseHeaderData",value:function(e){return{headerData:e,metaData:(0,c.parseNiftiHeader)(e.buffer)}}},{key:"uncompress",value:function(e,t){return 0===t.length?t:(e.inflator.push(t,l.default.Z_SYNC_FLUSH),e.inflator.result)}},{key:"addToImageDataBuffer",value:function(e,t){e.dataStreamedLength+t.length>e.buffer.length?e.buffer=(0,d.default)(e.buffer,t):e.buffer.set(t,e.dataStreamedLength),e.dataStreamedLength+=t.length}},{key:"tryParseHeader",value:function(t,n){if(t.isHeaderTypeKnown){t.isCompressed&&(n=e.uncompress(t,n)),e.addToImageDataBuffer(t,n);var r=t.dataStreamedLength>=t.headerOffset;if(r){t.header=e.parseHeaderData(t.buffer.slice(0,t.headerOffset));var i=e.createVolumeBuffer(t);i.set(t.buffer),t.buffer=i}return r}if(t.tmpBuffer.length+n.length<t.headerOffset)return t.tmpBuffer=(0,d.default)(t.tmpBuffer,n),!1;var a=(0,d.default)(t.tmpBuffer,n);if(t.isCompressed=h.isCompressed(a.buffer),t.isCompressed){var o=new l.default.Inflate;o.push(a,l.default.Z_SYNC_FLUSH),a=o.result}var s=new DataView(a.buffer),u=!1,c=h.Utils.getIntAt(s,0,u);return h.isNIFTI2(a.buffer)?(c!==h.NIFTI2.MAGIC_COOKIE&&(u=!0),t.headerOffset=h.Utils.getLongAt(s,168,u)):(c!==h.NIFTI1.MAGIC_COOKIE&&(u=!0),t.headerOffset=h.Utils.getFloatAt(s,108,u)),t.isHeaderTypeKnown=!0,t.buffer=t.isCompressed?e.uncompress(t,t.tmpBuffer):t.tmpBuffer,t.dataStreamedLength=t.buffer.length,t.tmpBuffer=void 0,e.tryParseHeader(t,n)}},{key:"createVolumeBuffer",value:function(t){var n=e.getVolumeTimepointDataLength(t.header),r=new ArrayBuffer(t.headerOffset+n*t.header.metaData.timeSlices);return new Uint8Array(r)}},{key:"getVolumeTimepointDataLength",value:function(e){var t=e.metaData.header.dims,n=1;return t[5]&&(n=t[5]),t[1]*t[2]*t[3]*1*n*(e.metaData.header.numBitsPerVoxel/8)}}]),e}();t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(71)),a=function(e){return e&&e.__esModule?e:{default:e}}(n(14)),o=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.options={headers:t&&t.headers||{}}}return r(e,[{key:"stream",value:function(e,t){var n=this;return new Promise((function(r,o){var s={promise:{resolve:r,reject:o},url:e.filePath,imageId:e.url};i.get({path:e.filePath,headers:n.options.headers},(function(i){var o=i.headers["Content-Length"]||i.headers["content-length"]||0,l=function(e,t,n,r){return function(i){var o=i.detail.loaded,s=i.detail.total,l=Math.round(o/s*100);(function(e,t,n){e&&e(t,n)})(n.onprogress,i,r),a.default.imageLoadProgress({url:e,imageId:t,loaded:o,total:s,percentComplete:l})}}(e.filePath,e.url,n.options,s),u=0;i.on("data",(function(n){l({detail:{loaded:u+=n.length,total:o}}),t(n,e)})),i.on("end",(function(){r()}))})).on("error",(function(t){o(new Error("Could not fetch the file '"+e.url+"'. Error description: "+t+"."))}))}))}}]),e}();t.default=o},function(e,t,n){(function(e){var r=n(72),i=n(32),a=n(82),o=n(83),s=n(84),l=t;l.request=function(t,n){t="string"==typeof t?s.parse(t):a(t);var i=-1===e.location.protocol.search(/^https?:$/)?"http:":"",o=t.protocol||i,l=t.hostname||t.host,u=t.port,c=t.path||"/";l&&-1!==l.indexOf(":")&&(l="["+l+"]"),t.url=(l?o+"//"+l:"")+(u?":"+u:"")+c,t.method=(t.method||"GET").toUpperCase(),t.headers=t.headers||{};var d=new r(t);return n&&d.on("response",n),d},l.get=function(e,t){var n=l.request(e,t);return n.end(),n},l.ClientRequest=r,l.IncomingMessage=i,l.Agent=function(){},l.Agent.defaultMaxSockets=4,l.STATUS_CODES=o,l.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(t,n(0))},function(e,t,n){(function(t,r,i){var a=n(31),o=n(3),s=n(32),l=n(33),u=n(81),c=s.IncomingMessage,d=s.readyStates,h=e.exports=function(e){var n=this;l.Writable.call(n),n._opts=e,n._body=[],n._headers={},e.auth&&n.setHeader("Authorization","Basic "+new t(e.auth).toString("base64")),Object.keys(e.headers).forEach((function(t){n.setHeader(t,e.headers[t])}));var r,i=!0;if("disable-fetch"===e.mode||"requestTimeout"in e&&!a.abortController)i=!1,r=!0;else if("prefer-streaming"===e.mode)r=!1;else if("allow-wrong-content-type"===e.mode)r=!a.overrideMimeType;else{if(e.mode&&"default"!==e.mode&&"prefer-fast"!==e.mode)throw new Error("Invalid value for opts.mode");r=!0}n._mode=function(e,t){return a.fetch&&t?"fetch":a.mozchunkedarraybuffer?"moz-chunked-arraybuffer":a.msstream?"ms-stream":a.arraybuffer&&e?"arraybuffer":a.vbArray&&e?"text:vbarray":"text"}(r,i),n.on("finish",(function(){n._onFinish()}))};o(h,l.Writable),h.prototype.setHeader=function(e,t){var n=e.toLowerCase();-1===f.indexOf(n)&&(this._headers[n]={name:e,value:t})},h.prototype.getHeader=function(e){var t=this._headers[e.toLowerCase()];return t?t.value:null},h.prototype.removeHeader=function(e){delete this._headers[e.toLowerCase()]},h.prototype._onFinish=function(){var e=this;if(!e._destroyed){var n=e._opts,o=e._headers,s=null;"GET"!==n.method&&"HEAD"!==n.method&&(s=a.arraybuffer?u(t.concat(e._body)):a.blobConstructor?new r.Blob(e._body.map((function(e){return u(e)})),{type:(o["content-type"]||{}).value||""}):t.concat(e._body).toString());var l=[];if(Object.keys(o).forEach((function(e){var t=o[e].name,n=o[e].value;Array.isArray(n)?n.forEach((function(e){l.push([t,e])})):l.push([t,n])})),"fetch"===e._mode){var c=null;if(a.abortController){var h=new AbortController;c=h.signal,e._fetchAbortController=h,"requestTimeout"in n&&0!==n.requestTimeout&&r.setTimeout((function(){e.emit("requestTimeout"),e._fetchAbortController&&e._fetchAbortController.abort()}),n.requestTimeout)}r.fetch(e._opts.url,{method:e._opts.method,headers:l,body:s||void 0,mode:"cors",credentials:n.withCredentials?"include":"same-origin",signal:c}).then((function(t){e._fetchResponse=t,e._connect()}),(function(t){e.emit("error",t)}))}else{var f=e._xhr=new r.XMLHttpRequest;try{f.open(e._opts.method,e._opts.url,!0)}catch(t){return void i.nextTick((function(){e.emit("error",t)}))}"responseType"in f&&(f.responseType=e._mode.split(":")[0]),"withCredentials"in f&&(f.withCredentials=!!n.withCredentials),"text"===e._mode&&"overrideMimeType"in f&&f.overrideMimeType("text/plain; charset=x-user-defined"),"requestTimeout"in n&&(f.timeout=n.requestTimeout,f.ontimeout=function(){e.emit("requestTimeout")}),l.forEach((function(e){f.setRequestHeader(e[0],e[1])})),e._response=null,f.onreadystatechange=function(){switch(f.readyState){case d.LOADING:case d.DONE:e._onXHRProgress()}},"moz-chunked-arraybuffer"===e._mode&&(f.onprogress=function(){e._onXHRProgress()}),f.onerror=function(){e._destroyed||e.emit("error",new Error("XHR error"))};try{f.send(s)}catch(t){return void i.nextTick((function(){e.emit("error",t)}))}}}},h.prototype._onXHRProgress=function(){var e=this;(function(e){try{var t=e.status;return null!==t&&0!==t}catch(e){return!1}})(e._xhr)&&!e._destroyed&&(e._response||e._connect(),e._response._onXHRProgress())},h.prototype._connect=function(){var e=this;e._destroyed||(e._response=new c(e._xhr,e._fetchResponse,e._mode),e._response.on("error",(function(t){e.emit("error",t)})),e.emit("response",e._response))},h.prototype._write=function(e,t,n){this._body.push(e),n()},h.prototype.abort=h.prototype.destroy=function(){var e=this;e._destroyed=!0,e._response&&(e._response._destroyed=!0),e._xhr?e._xhr.abort():e._fetchAbortController&&e._fetchAbortController.abort()},h.prototype.end=function(e,t,n){"function"==typeof e&&(n=e,e=void 0),l.Writable.prototype.end.call(this,e,t,n)},h.prototype.flushHeaders=function(){},h.prototype.setTimeout=function(){},h.prototype.setNoDelay=function(){},h.prototype.setSocketKeepAlive=function(){};var f=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"]}).call(t,n(6).Buffer,n(0),n(4))},function(e,t,n){"use strict";function r(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function i(e){return o[e>>18&63]+o[e>>12&63]+o[e>>6&63]+o[63&e]}function a(e,t,n){for(var r=[],a=t;a<n;a+=3)r.push(i((e[a]<<16)+(e[a+1]<<8)+e[a+2]));return r.join("")}t.byteLength=function(e){return 3*e.length/4-r(e)},t.toByteArray=function(e){var t,n,i,a,o,u=e.length;a=r(e),o=new l(3*u/4-a),n=a>0?u-4:u;var c=0;for(t=0;t<n;t+=4)i=s[e.charCodeAt(t)]<<18|s[e.charCodeAt(t+1)]<<12|s[e.charCodeAt(t+2)]<<6|s[e.charCodeAt(t+3)],o[c++]=i>>16&255,o[c++]=i>>8&255,o[c++]=255&i;return 2===a?(i=s[e.charCodeAt(t)]<<2|s[e.charCodeAt(t+1)]>>4,o[c++]=255&i):1===a&&(i=s[e.charCodeAt(t)]<<10|s[e.charCodeAt(t+1)]<<4|s[e.charCodeAt(t+2)]>>2,o[c++]=i>>8&255,o[c++]=255&i),o},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,i="",s=[],l=0,u=n-r;l<u;l+=16383)s.push(a(e,l,l+16383>u?u:l+16383));return 1===r?(i+=o[(t=e[n-1])>>2],i+=o[t<<4&63],i+="=="):2===r&&(i+=o[(t=(e[n-2]<<8)+e[n-1])>>10],i+=o[t>>4&63],i+=o[t<<2&63],i+="="),s.push(i),s.join("")};for(var o=[],s=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,d=u.length;c<d;++c)o[c]=u[c],s[u.charCodeAt(c)]=c;s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,l=(1<<s)-1,u=l>>1,c=-7,d=n?i-1:0,h=n?-1:1,f=e[t+d];for(d+=h,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+e[t+d],d+=h,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=r;c>0;o=256*o+e[t+d],d+=h,c-=8);if(0===a)a=1-u;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),a-=u}return(f?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,l,u=8*a-i-1,c=(1<<u)-1,d=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:a-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+d>=1?h/l:h*Math.pow(2,1-d))*l>=2&&(o++,l/=2),o+d>=c?(s=0,o=c):o+d>=1?(s=(t*l-1)*Math.pow(2,i),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[n+f]=255&o,f+=p,o/=256,u-=8);e[n+f-p]|=128*m}},function(e,t){},function(e,t,n){"use strict";function r(e,t,n){e.copy(t,n)}var i=n(11).Buffer;e.exports=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return this.head=1===this.length?this.tail=null:this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var t=i.allocUnsafe(e>>>0),n=this.head,a=0;n;)r(n.data,t,a),a+=n.data.length,n=n.next;return t},e}()},function(e,t,n){function r(e,t){this._id=e,this._clearFn=t}var i=Function.prototype.apply;t.setTimeout=function(){return new r(i.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new r(i.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(78),t.setImmediate=setImmediate,t.clearImmediate=clearImmediate},function(e,t,n){(function(e,t){!function(e,n){"use strict";function r(e){delete s[e]}function i(e){if(l)setTimeout(i,0,e);else{var t=s[e];if(t){l=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{r(e),l=!1}}}}if(!e.setImmediate){var a,o=1,s={},l=!1,u=e.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(e);c=c&&c.setTimeout?c:e,"[object process]"==={}.toString.call(e.process)?a=function(e){t.nextTick((function(){i(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&i(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),a=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){i(e.data)},a=function(t){e.port2.postMessage(t)}}():u&&"onreadystatechange"in u.createElement("script")?function(){var e=u.documentElement;a=function(t){var n=u.createElement("script");n.onreadystatechange=function(){i(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():a=function(e){setTimeout(i,0,e)},c.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];return s[o]={callback:e,args:t},a(o),o++},c.clearImmediate=r}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,n(0),n(4))},function(e,t,n){(function(t){function n(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(t,n(0))},function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);i.call(this,e)}e.exports=r;var i=n(40),a=n(7);a.inherits=n(3),a.inherits(r,i),r.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){var r=n(6).Buffer;e.exports=function(e){if(e instanceof Uint8Array){if(0===e.byteOffset&&e.byteLength===e.buffer.byteLength)return e.buffer;if("function"==typeof e.buffer.slice)return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}if(r.isBuffer(e)){for(var t=new Uint8Array(e.length),n=e.length,i=0;i<n;i++)t[i]=e[i];return t.buffer}throw new Error("Argument must be a Buffer")}},function(e,t){e.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var i in r)n.call(r,i)&&(e[i]=r[i])}return e};var n=Object.prototype.hasOwnProperty},function(e,t){e.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},function(e,t,n){"use strict";function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function i(e,t,n){if(e&&o.isObject(e)&&e instanceof r)return e;var i=new r;return i.parse(e,t,n),i}var a=n(85),o=n(87);t.parse=i,t.resolve=function(e,t){return i(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?i(e,!1,!0).resolveObject(t):t},t.format=function(e){return o.isString(e)&&(e=i(e)),e instanceof r?e.format():r.prototype.format.call(e)},t.Url=r;var s=/^([a-z0-9.+-]+:)/i,l=/:[0-9]*$/,u=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),d=["'"].concat(c),h=["%","/","?",";","#"].concat(d),f=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},b=n(88);r.prototype.parse=function(e,t,n){if(!o.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),i=-1!==r&&r<e.indexOf("#")?"?":"#",l=e.split(i);l[0]=l[0].replace(/\\/g,"/");var c=e=l.join(i);if(c=c.trim(),!n&&1===e.split("#").length){var x=u.exec(c);if(x)return this.path=c,this.href=c,this.pathname=x[1],x[2]?(this.search=x[2],this.query=t?b.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var w=s.exec(c);if(w){var _=(w=w[0]).toLowerCase();this.protocol=_,c=c.substr(w.length)}if(n||w||c.match(/^\/\/[^@\/]+@[^@\/]+/)){var k="//"===c.substr(0,2);!k||w&&v[w]||(c=c.substr(2),this.slashes=!0)}if(!v[w]&&(k||w&&!y[w])){for(var E=-1,S=0;S<f.length;S++)-1!==(I=c.indexOf(f[S]))&&(-1===E||I<E)&&(E=I);var T,C;for(-1!==(C=-1===E?c.lastIndexOf("@"):c.lastIndexOf("@",E))&&(T=c.slice(0,C),c=c.slice(C+1),this.auth=decodeURIComponent(T)),E=-1,S=0;S<h.length;S++){var I;-1!==(I=c.indexOf(h[S]))&&(-1===E||I<E)&&(E=I)}-1===E&&(E=c.length),this.host=c.slice(0,E),c=c.slice(E),this.parseHost(),this.hostname=this.hostname||"";var A="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!A)for(var O=this.hostname.split(/\./),D=(S=0,O.length);S<D;S++){var M=O[S];if(M&&!M.match(p)){for(var N="",j=0,F=M.length;j<F;j++)M.charCodeAt(j)>127?N+="x":N+=M[j];if(!N.match(p)){var R=O.slice(0,S),P=O.slice(S+1),L=M.match(m);L&&(R.push(L[1]),P.unshift(L[2])),P.length&&(c="/"+P.join(".")+c),this.hostname=R.join(".");break}}}this.hostname=this.hostname.length>255?"":this.hostname.toLowerCase(),A||(this.hostname=a.toASCII(this.hostname)),this.host=(this.hostname||"")+(this.port?":"+this.port:""),this.href+=this.host,A&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==c[0]&&(c="/"+c))}if(!g[_])for(S=0,D=d.length;S<D;S++){var B=d[S];if(-1!==c.indexOf(B)){var $=encodeURIComponent(B);$===B&&($=escape(B)),c=c.split(B).join($)}}var z=c.indexOf("#");-1!==z&&(this.hash=c.substr(z),c=c.slice(0,z));var U=c.indexOf("?");return-1!==U?(this.search=c.substr(U),this.query=c.substr(U+1),t&&(this.query=b.parse(this.query)),c=c.slice(0,U)):t&&(this.search="",this.query={}),c&&(this.pathname=c),y[_]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(this.path=(this.pathname||"")+(this.search||"")),this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,a="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&o.isObject(this.query)&&Object.keys(this.query).length&&(a=b.stringify(this.query));var s=this.search||a&&"?"+a||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||y[t])&&!1!==i?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),t+i+(n=n.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(s=s.replace("#","%23"))+r},r.prototype.resolve=function(e){return this.resolveObject(i(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if(o.isString(e)){var t=new r;t.parse(e,!1,!0),e=t}for(var n=new r,i=Object.keys(this),a=0;a<i.length;a++){var s=i[a];n[s]=this[s]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),u=0;u<l.length;u++){var c=l[u];"protocol"!==c&&(n[c]=e[c])}return y[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!y[e.protocol]){for(var d=Object.keys(e),h=0;h<d.length;h++){var f=d[h];n[f]=e[f]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||v[e.protocol])n.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}return n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,(n.pathname||n.search)&&(n.path=(n.pathname||"")+(n.search||"")),n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var m=n.pathname&&"/"===n.pathname.charAt(0),g=e.host||e.pathname&&"/"===e.pathname.charAt(0),b=g||m||n.host&&e.pathname,x=b,w=n.pathname&&n.pathname.split("/")||[],_=(p=e.pathname&&e.pathname.split("/")||[],n.protocol&&!y[n.protocol]);if(_&&(n.hostname="",n.port=null,n.host&&(""===w[0]?w[0]=n.host:w.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),b=b&&(""===p[0]||""===w[0])),g)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,w=p;else if(p.length)w||(w=[]),w.pop(),w=w.concat(p),n.search=e.search,n.query=e.query;else if(!o.isNullOrUndefined(e.search))return _&&(n.hostname=n.host=w.shift(),(C=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=C.shift(),n.host=n.hostname=C.shift())),n.search=e.search,n.query=e.query,o.isNull(n.pathname)&&o.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!w.length)return n.pathname=null,n.path=n.search?"/"+n.search:null,n.href=n.format(),n;for(var k=w.slice(-1)[0],E=(n.host||e.host||w.length>1)&&("."===k||".."===k)||""===k,S=0,T=w.length;T>=0;T--)"."===(k=w[T])?w.splice(T,1):".."===k?(w.splice(T,1),S++):S&&(w.splice(T,1),S--);if(!b&&!x)for(;S--;S)w.unshift("..");!b||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),E&&"/"!==w.join("/").substr(-1)&&w.push("");var C,I=""===w[0]||w[0]&&"/"===w[0].charAt(0);return _&&(n.hostname=n.host=I?"":w.length?w.shift():"",(C=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=C.shift(),n.host=n.hostname=C.shift())),(b=b||n.host&&w.length)&&!I&&w.unshift(""),w.length?n.pathname=w.join("/"):(n.pathname=null,n.path=null),o.isNull(n.pathname)&&o.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var e=this.host,t=l.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,n){(function(e,r){var i;!function(r){function a(e){throw new RangeError(I[e])}function o(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function s(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+o((e=e.replace(C,".")).split("."),t).join(".")}function l(e){for(var t,n,r=[],i=0,a=e.length;i<a;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<a?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function u(e){return o(e,(function(e){var t="";return e>65535&&(t+=D((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+D(e)})).join("")}function c(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:v}function d(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function h(e,t,n){var r=0;for(e=n?O(e/w):e>>1,e+=O(e/t);e>A*b>>1;r+=v)e=O(e/A);return O(r+(A+1)*e/(e+x))}function f(e){var t,n,r,i,o,s,l,d,f,p,m=[],x=e.length,w=0,S=k,T=_;for((n=e.lastIndexOf(E))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&a("not-basic"),m.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<x;){for(o=w,s=1,l=v;i>=x&&a("invalid-input"),((d=c(e.charCodeAt(i++)))>=v||d>O((g-w)/s))&&a("overflow"),w+=d*s,!(d<(f=l<=T?y:l>=T+b?b:l-T));l+=v)s>O(g/(p=v-f))&&a("overflow"),s*=p;T=h(w-o,t=m.length+1,0==o),O(w/t)>g-S&&a("overflow"),S+=O(w/t),w%=t,m.splice(w++,0,S)}return u(m)}function p(e){var t,n,r,i,o,s,u,c,f,p,m,x,w,S,T,C=[];for(x=(e=l(e)).length,t=k,n=0,o=_,s=0;s<x;++s)(m=e[s])<128&&C.push(D(m));for(r=i=C.length,i&&C.push(E);r<x;){for(u=g,s=0;s<x;++s)(m=e[s])>=t&&m<u&&(u=m);for(u-t>O((g-n)/(w=r+1))&&a("overflow"),n+=(u-t)*w,t=u,s=0;s<x;++s)if((m=e[s])<t&&++n>g&&a("overflow"),m==t){for(c=n,f=v;!(c<(p=f<=o?y:f>=o+b?b:f-o));f+=v)C.push(D(d(p+(T=c-p)%(S=v-p),0))),c=O(T/S);C.push(D(d(c,0))),o=h(n,w,r==i),n=0,++r}++n,++t}return C.join("")}var m,g=2147483647,v=36,y=1,b=26,x=38,w=700,_=72,k=128,E="-",S=/^xn--/,T=/[^\x20-\x7E]/,C=/[\x2E\u3002\uFF0E\uFF61]/g,I={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},A=v-y,O=Math.floor,D=String.fromCharCode;m={version:"1.4.1",ucs2:{decode:l,encode:u},decode:f,encode:p,toASCII:function(e){return s(e,(function(e){return T.test(e)?"xn--"+p(e):e}))},toUnicode:function(e){return s(e,(function(e){return S.test(e)?f(e.slice(4).toLowerCase()):e}))}},void 0!==(i=(function(){return m}).call(t,n,t,e))&&(e.exports=i)}()}).call(t,n(86)(e),n(0))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,n){"use strict";t.decode=t.parse=n(89),t.encode=t.stringify=n(90)},function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,a){n=n||"=";var o={};if("string"!=typeof e||0===e.length)return o;var s=/\+/g;e=e.split(t=t||"&");var l=1e3;a&&"number"==typeof a.maxKeys&&(l=a.maxKeys);var u=e.length;l>0&&u>l&&(u=l);for(var c=0;c<u;++c){var d,h,f,p,m=e[c].replace(s,"%20"),g=m.indexOf(n);g>=0?(d=m.substr(0,g),h=m.substr(g+1)):(d=m,h=""),f=decodeURIComponent(d),p=decodeURIComponent(h),r(o,f)?i(o[f])?o[f].push(p):o[f]=[o[f],p]:o[f]=p}return o};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";function r(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?r(o(e),(function(o){var s=encodeURIComponent(i(o))+n;return a(e[o])?r(e[o],(function(e){return s+encodeURIComponent(i(e))})).join(t):s+encodeURIComponent(i(e[o]))})).join(t):s?encodeURIComponent(i(s))+n+encodeURIComponent(i(e)):""};var a=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if("function"!=typeof e.state){var t="pending";e.then((function(e){return t="resolved",e}),(function(e){return t="rejected",e})),e.state=function(){return t}}return e}}])},XPeR:function(e,t,n){"use strict";function r(e){var t=this;if(t instanceof r||(t=new r),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)t.push(arguments[n]);return t}function i(e,t,n){var r=t===e.head?new s(n,null,t,e):new s(n,t,t.next,e);return null===r.next&&(e.tail=r),null===r.prev&&(e.head=r),e.length++,r}function a(e,t){e.tail=new s(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function o(e,t){e.head=new s(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function s(e,t,n,r){if(!(this instanceof s))return new s(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}e.exports=r,r.Node=s,r.create=r,r.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t},r.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},r.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},r.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)a(this,arguments[e]);return this.length},r.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)o(this,arguments[e]);return this.length},r.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},r.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},r.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;null!==n;r++)e.call(t,n.value,r,this),n=n.next},r.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;null!==n;r--)e.call(t,n.value,r,this),n=n.prev},r.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},r.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},r.prototype.map=function(e,t){t=t||this;for(var n=new r,i=this.head;null!==i;)n.push(e.call(t,i.value,this)),i=i.next;return n},r.prototype.mapReverse=function(e,t){t=t||this;for(var n=new r,i=this.tail;null!==i;)n.push(e.call(t,i.value,this)),i=i.prev;return n},r.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=e(n,r.value,i),r=r.next;return n},r.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=e(n,r.value,i),r=r.prev;return n},r.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},r.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},r.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,a=this.head;null!==a&&i<e;i++)a=a.next;for(;null!==a&&i<t;i++,a=a.next)n.push(a.value);return n},r.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,a=this.tail;null!==a&&i>t;i--)a=a.prev;for(;null!==a&&i>e;i--,a=a.prev)n.push(a.value);return n},r.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,a=this.head;null!==a&&r<e;r++)a=a.next;var o=[];for(r=0;a&&r<t;r++)o.push(a.value),a=this.removeNode(a);for(null===a&&(a=this.tail),a!==this.head&&a!==this.tail&&(a=a.prev),r=0;r<n.length;r++)a=i(this,a,n[r]);return o},r.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this};try{n("HwNo")(r)}catch(l){}},YJ14:function(e,t,n){const r=n("3wIk");e.exports=(e,t)=>new r(e,t).minor},YSVl:function(e,t,n){var r=n("EhIR"),i=n("uDiL"),a=n("pJ6O"),o=n("yuCN"),s=n("euyF"),l=n("ie1u"),u=n("pJ3+");u.alea=r,u.xor128=i,u.xorwow=a,u.xorshift7=o,u.xor4096=s,u.tychei=l,e.exports=u},Ybu3:function(e,t,n){const{MAX_LENGTH:r}=n("/kWe"),{re:i,t:a}=n("IsDc"),o=n("3wIk"),s=n("4S+G");e.exports=(e,t)=>{if(t=s(t),e instanceof o)return e;if("string"!=typeof e)return null;if(e.length>r)return null;if(!(t.loose?i[a.LOOSE]:i[a.FULL]).test(e))return null;try{return new o(e,t)}catch(n){return null}}},Yn5A:function(e,t,n){const r=n("Ybu3"),i=n("xfvg");e.exports=(e,t)=>{if(i(e,t))return null;{const n=r(e),i=r(t),a=n.prerelease.length||i.prerelease.length,o=a?"pre":"",s=a?"prerelease":"";for(const e in n)if(("major"===e||"minor"===e||"patch"===e)&&n[e]!==i[e])return o+e;return s}}},YuTi:function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},ZYJ9:function(e,t,n){"use strict";var r=/("(?:[^\\"]|\\.)*")|[:,]/g;e.exports=function(e,t){var n,i,a;return t=t||{},n=JSON.stringify([1],void 0,void 0===t.indent?2:t.indent).slice(2,-3),i=""===n?1/0:void 0===t.maxLength?80:t.maxLength,a=t.replacer,function e(t,o,s){var l,u,c,d,h,f,p,m,g,v,y,b;if(t&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===(y=JSON.stringify(t,a)))return y;if(y.length<=(p=i-o.length-s)&&(g=y.replace(r,(function(e,t){return t||e+" "}))).length<=p)return g;if(null!=a&&(t=JSON.parse(y),a=void 0),"object"==typeof t&&null!==t){if(m=o+n,c=[],u=0,Array.isArray(t))for(v="[",l="]",p=t.length;u<p;u++)c.push(e(t[u],m,u===p-1?0:1)||"null");else for(v="{",l="}",p=(f=Object.keys(t)).length;u<p;u++)d=f[u],h=JSON.stringify(d)+": ",void 0!==(b=e(t[d],m,h.length+(u===p-1?0:1)))&&c.push(h+b);if(c.length>0)return[v,n+c.join(",\n"+m),l].join("\n"+o)}return y}(e,"",0)}},aUsF:function(e,t,n){"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(i=r;0!=i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(a=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=r;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;0!=i--;){var o=a[i];if(!e(t[o],n[o]))return!1}return!0}return t!=t&&n!=n}},bdwG:function(e,t,n){const r=n("8GxW");e.exports=(e,t,n)=>r(e,t,n)<=0},bkNj:function(e,t,n){window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,(function(t){return e[t]}).bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(n(2)),a=n(1),o=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t||0,this.y=n||0,this.z=r||0}return r(e,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12],this.y=i[1]*t+i[5]*n+i[9]*r+i[13],this.z=i[2]*t+i[6]*n+i[10]*r+i[14],this}},{key:"applyProjection",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*r-o*n,u=s*n+o*t-i*r,c=s*r+i*n-a*t,d=-i*t-a*n-o*r;return this.x=l*s+d*-i+u*-o-c*-a,this.y=u*s+d*-a+c*-i-l*-o,this.z=c*s+d*-o+l*-a-u*-i,this}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize(),this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this}},{key:"min",value:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this}},{key:"max",value:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this}},{key:"clamp",value:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.multiplyScalar(-1)}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,r=this.y,i=this.z;return this.x=r*e.z-i*e.y,this.y=i*e.x-n*e.z,this.z=n*e.y-r*e.x,this}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}},{key:"angleTo",value:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos((0,a.clamp)(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}},{key:"setFromMatrixPosition",value:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){var n=4*e,r=t.elements;return this.x=r[n],this.y=r[n+1],this.z=r[n+2],this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"clone",value:function(){return new e(this.x,this.y,this.z)}}]),e}();o.prototype.projectOnVector=function(){var e=void 0,t=void 0;return function(n){return void 0===e&&(e=new o),e.copy(n).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),o.prototype.projectOnPlane=function(){var e=void 0;return function(t){return void 0===e&&(e=new o),e.copy(this).projectOnVector(t),this.sub(e)}}(),o.prototype.reflect=function(){var e=void 0;return function(t){return void 0===e&&(e=new o),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),o.prototype.clampScalar=function(){var e=void 0,t=void 0;return function(n,r){return void 0===e&&(e=new o,t=new o),e.set(n,n,n),t.set(r,r,r),this.clamp(e,t)}}(),o.prototype.applyAxisAngle=function(){var e=void 0;return function(t,n){return void 0===e&&(e=new i.default),this.applyQuaternion(e.setFromAxisAngle(t.normalize(),n)),this}}(),t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clamp=function(e,t,n){return e<t?t:e>n?n:e},t.degToRad=function(e){return e*(Math.PI/180)},t.approximatelyEquals=function(e,t,n){var r=n||1e-4;return Math.abs(e-t)<=r*Math.max(1,Math.abs(e),Math.abs(t))},t.radToDeg=function(e){return e*(180/Math.PI)},t.sign=function(e){return"number"==typeof e?e?e<0?-1:1:e==e?0:NaN:NaN}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t||0,this.y=n||0,this.z=r||0,this.w=void 0!==i?i:1}return r(e,[{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(n),this}},{key:"multiplyQuaternions",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=e.w,o=t.x,s=t.y,l=t.z,u=t.w;return this.x=n*u+a*o+r*l-i*s,this.y=r*u+a*s+i*o-n*l,this.z=i*u+a*l+n*s-r*o,this.w=a*u-n*o-r*s-i*l,this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],o=t[5],s=t[9],l=t[2],u=t[6],c=t[10],d=n+o+c,h=void 0;return d>0?(h=.5/Math.sqrt(d+1),this.w=.25/h,this.x=(u-s)*h,this.y=(i-l)*h,this.z=(a-r)*h):n>o&&n>c?(h=2*Math.sqrt(1+n-o-c),this.w=(u-s)/h,this.x=.25*h,this.y=(r+a)/h,this.z=(i+l)/h):o>c?(h=2*Math.sqrt(1+o-n-c),this.w=(i-l)/h,this.x=(r+a)/h,this.y=.25*h,this.z=(s+u)/h):(h=2*Math.sqrt(1+c-n-o),this.w=(a-r)/h,this.x=(i+l)/h,this.y=(s+u)/h,this.z=.25*h),this}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);function i(e){return e*e}function a(e,t){return i(e.x-t.x)+i(e.y-t.y)}t.default={distanceToPoint:function(e,t){return Math.sqrt(function(e,t){var n=a(e.start,e.end);if(0===n)return a(t,e.start);var r=((t.x-e.start.x)*(e.end.x-e.start.x)+(t.y-e.start.y)*(e.end.y-e.start.y))/n;return a(t,r<0?e.start:r>1?e.end:{x:e.start.x+r*(e.end.x-e.start.x),y:e.start.y+r*(e.end.y-e.start.y)})}(e,t))},intersectLine:function(e,t){var n,i,a,o,s,l,u,c,d,h,f,p={},m=e.start.x,g=e.start.y,v=e.end.x,y=e.end.y,b=t.start.x,x=t.start.y,w=t.end.x,_=t.end.y,k=void 0;if(h=(n=y-g)*w+(a=m-v)*_+(s=v*g-m*y),(0===(d=n*b+a*x+s)||0===h||(0,r.sign)(d)!==(0,r.sign)(h))&&(c=(i=_-x)*v+(o=b-w)*y+(l=w*x-b*_),0===(u=i*m+o*g+l)||0===c||(0,r.sign)(u)!==(0,r.sign)(c))){f=n*o-i*a,k=a*l-o*s;var E=parseFloat(k/f);k=i*s-n*l;var S=parseFloat(k/f);return p.x=E,p.y=S,p}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vector3=t.rect=t.quaternion=t.point=t.Plane=t.Matrix4=t.sign=t.radToDeg=t.degToRad=t.clamp=t.lineSegment=t.Line3=void 0;var r=h(n(5)),i=h(n(3)),a=n(1),o=h(n(6)),s=h(n(7)),l=h(n(8)),u=h(n(2)),c=h(n(9)),d=h(n(0));function h(e){return e&&e.__esModule?e:{default:e}}var f={Line3:r.default,lineSegment:i.default,clamp:a.clamp,degToRad:a.degToRad,radToDeg:a.radToDeg,sign:a.sign,Matrix4:o.default,Plane:s.default,point:l.default,quaternion:u.default,rect:c.default,Vector3:d.default};t.Line3=r.default,t.lineSegment=i.default,t.clamp=a.clamp,t.degToRad=a.degToRad,t.radToDeg=a.radToDeg,t.sign=a.sign,t.Matrix4=o.default,t.Plane=s.default,t.point=l.default,t.quaternion=u.default,t.rect=c.default,t.Vector3=d.default,t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),a=n(1),o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.start=void 0!==t?t:new i.default,this.end=void 0!==n?n:new i.default}return r(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"center",value:function(e){return(e||new i.default).addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return(e||new i.default).subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){var n=t||new i.default;return this.delta(n).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){var n=new i.default,r=new i.default;n.subVectors(e,this.start),r.subVectors(this.end,this.start);var o=r.dot(r),s=r.dot(n)/o;return t&&(s=(0,a.clamp)(s,0,1)),s}},{key:"closestPointToPoint",value:function(e,t,n){var r=this.closestPointToPointParameter(e,t),a=n||new i.default;return this.delta(a).multiplyScalar(r).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"intersectLine",value:function(e){var t=this.end.clone().sub(this.start),n=e.end.clone().sub(e.start),r=e.start.clone().sub(this.start),i=t.clone().cross(n),o=r.clone().cross(n),s=r.dot(i);if((0,a.approximatelyEquals)(s,0)){var l=o.dot(i)/i.lengthSq();if(!(l>1||isNaN(l))){var u=this.start.clone().add(t.clone().multiplyScalar(l));return u.clone().sub(e.start).lengthSq()+u.clone().sub(e.end).lengthSq()<=e.distanceSq()?u:void 0}}}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),a=function(){function e(t,n,r,i,a,o,s,l,u,c,d,h,f,p,m,g){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.elements=new Float32Array(16);var v=this.elements;v[0]=void 0!==t?t:1,v[4]=n||0,v[8]=r||0,v[12]=i||0,v[1]=a||0,v[5]=void 0!==o?o:1,v[9]=s||0,v[13]=l||0,v[2]=u||0,v[6]=c||0,v[10]=void 0!==d?d:1,v[14]=h||0,v[3]=f||0,v[7]=p||0,v[11]=m||0,v[15]=void 0!==g?g:1}return r(e,[{key:"makeRotationFromQuaternion",value:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,a=e.w,o=n+n,s=r+r,l=i+i,u=n*o,c=n*s,d=n*l,h=r*s,f=r*l,p=i*l,m=a*o,g=a*s,v=a*l;return t[0]=1-(h+p),t[4]=c-v,t[8]=d+g,t[1]=c+v,t[5]=1-(u+p),t[9]=f-m,t[2]=d-g,t[6]=f+m,t[10]=1-(u+h),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],u=n[1],c=n[5],d=n[9],h=n[13],f=n[2],p=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],x=n[15],w=r[0],_=r[4],k=r[8],E=r[12],S=r[1],T=r[5],C=r[9],I=r[13],A=r[2],O=r[6],D=r[10],M=r[14],N=r[3],j=r[7],F=r[11],R=r[15];return i[0]=a*w+o*S+s*A+l*N,i[4]=a*_+o*T+s*O+l*j,i[8]=a*k+o*C+s*D+l*F,i[12]=a*E+o*I+s*M+l*R,i[1]=u*w+c*S+d*A+h*N,i[5]=u*_+c*T+d*O+h*j,i[9]=u*k+c*C+d*D+h*F,i[13]=u*E+c*I+d*M+h*R,i[2]=f*w+p*S+m*A+g*N,i[6]=f*_+p*T+m*O+g*j,i[10]=f*k+p*C+m*D+g*F,i[14]=f*E+p*I+m*M+g*R,i[3]=v*w+y*S+b*A+x*N,i[7]=v*_+y*T+b*O+x*j,i[11]=v*k+y*C+b*D+x*F,i[15]=v*E+y*I+b*M+x*R,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"getInverse",value:function(e,t){var n=this.elements,r=e.elements,i=r[0],a=r[4],o=r[8],s=r[12],l=r[1],u=r[5],c=r[9],d=r[13],h=r[2],f=r[6],p=r[10],m=r[14],g=r[3],v=r[7],y=r[11],b=r[15];n[0]=c*m*v-d*p*v+d*f*y-u*m*y-c*f*b+u*p*b,n[4]=s*p*v-o*m*v-s*f*y+a*m*y+o*f*b-a*p*b,n[8]=o*d*v-s*c*v+s*u*y-a*d*y-o*u*b+a*c*b,n[12]=s*c*f-o*d*f-s*u*p+a*d*p+o*u*m-a*c*m,n[1]=d*p*g-c*m*g-d*h*y+l*m*y+c*h*b-l*p*b,n[5]=o*m*g-s*p*g+s*h*y-i*m*y-o*h*b+i*p*b,n[9]=s*c*g-o*d*g-s*l*y+i*d*y+o*l*b-i*c*b,n[13]=o*d*h-s*c*h+s*l*p-i*d*p-o*l*m+i*c*m,n[2]=u*m*g-d*f*g+d*h*v-l*m*v-u*h*b+l*f*b,n[6]=s*f*g-a*m*g-s*h*v+i*m*v+a*h*b-i*f*b,n[10]=a*d*g-s*u*g+s*l*v-i*d*v-a*l*b+i*u*b,n[14]=s*u*h-a*d*h-s*l*f+i*d*f+a*l*m-i*u*m,n[3]=c*f*g-u*p*g-c*h*v+l*p*v+u*h*y-l*f*y,n[7]=a*p*g-o*f*g+o*h*v-i*p*v-a*h*y+i*f*y,n[11]=o*u*g-a*c*g-o*l*v+i*c*v+a*l*y-i*u*y,n[15]=a*c*h-o*u*h+o*l*f-i*c*f-a*l*p+i*u*p;var x=i*n[0]+l*n[4]+h*n[8]+g*n[12];if(0===x){var w="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(w);return console.warn(w),this.identity(),this}return this.multiplyScalar(1/x),this}},{key:"applyToVector3Array",value:function(){var e=new i.default;return function(t,n,r){void 0===n&&(n=0),void 0===r&&(r=t.length);for(var i=0,a=n;i<r;i+=3,a+=3)e.x=t[a],e.y=t[a+1],e.z=t[a+2],e.applyMatrix4(this),t[a]=e.x,t[a+1]=e.y,t[a+2]=e.z;return t}}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"set",value:function(e,t,n,r,i,a,o,s,l,u,c,d,h,f,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=d,g[3]=h,g[7]=f,g[11]=p,g[15]=m,this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.normal=void 0!==t?t:new i.default(1,0,0),this.constant=void 0!==n?n:0}return r(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return this.orthoPoint(e,t).sub(e).negate()}},{key:"orthoPoint",value:function(e,t){var n=this.distanceToPoint(e);return(t||new i.default).copy(this.normal).multiplyScalar(n)}},{key:"isIntersectionLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectPlane",value:function(e){var t=this.normal.clone().cross(e.normal),n={origin:new i.default,direction:t};if(this.normal.clone().cross(e.normal).length<1e-10)return n.direction=new i.default,n;var r=this.constant,a=e.constant,o=this.normal.clone().dot(e.normal),s=-(r-a*o)/(1-o*o),l=-(a-r*o)/(1-o*o);return n.origin=this.normal.clone().multiplyScalar(s).add(e.normal.clone().multiplyScalar(l)),n}},{key:"coplanarPoint",value:function(e){return(e||new i.default).copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(e){return this.constant=this.constant-e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new e).copy(this)}}]),e}();a.prototype.setFromCoplanarPoints=function(){var e=new i.default,t=new i.default;return function(n,r,i){var a=e.subVectors(i,r).cross(t.subVectors(n,r)).normalize();return this.setFromNormalAndCoplanarPoint(a,n),this}}(),a.prototype.intersectLine=function(){var e=new i.default;return function(t,n){var r=n||new i.default,a=t.delta(e),o=this.normal.dot(a);if(0===o)return 0===this.distanceToPoint(t.start)?r.copy(t.start):void 0;var s=-(t.start.dot(this.normal)+this.constant)/o;return s<0||s>1?void 0:r.copy(a).multiplyScalar(s).add(t.start)}}(),t.default=a},function(e,t,n){"use strict";function r(e,t){return{x:e.x-t.x,y:e.y-t.y}}function i(e,t){return Math.sqrt(a(e,t))}function a(e,t){var n=r(e,t);return n.x*n.x+n.y*n.y}Object.defineProperty(t,"__esModule",{value:!0}),t.default={subtract:r,copy:function(e){return{x:e.x,y:e.y}},pageToPoint:function(e){return{x:e.pageX,y:e.pageY}},distance:i,distanceSquared:a,insideRect:function(e,t){return!(e.x<t.left||e.x>t.left+t.width||e.y<t.top||e.y>t.top+t.height)},findClosestPoint:function(e,t){var n=[],r=void 0;return e.forEach((function(e,a){var o=i(e,t);n.push(o),r=0===a?o:Math.min(o,r)})),e[n.indexOf(r)]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(3));function i(e){return{topLeft:{x:e.left,y:e.top},bottomRight:{x:e.left+e.width,y:e.top+e.height}}}t.default={distanceToPoint:function(e,t){var n=655535;return function(e){return[{start:{x:e.left,y:e.top},end:{x:e.left+e.width,y:e.top}},{start:{x:e.left+e.width,y:e.top},end:{x:e.left+e.width,y:e.top+e.height}},{start:{x:e.left+e.width,y:e.top+e.height},end:{x:e.left,y:e.top+e.height}},{start:{x:e.left,y:e.top+e.height},end:{x:e.left,y:e.top}}]}(e).forEach((function(e){var i=r.default.distanceToPoint(e,t);i<n&&(n=i)})),n},getIntersectionRect:function(e,t){var n={topLeft:{},bottomRight:{}};if(function(e,t){var n=i(e),r=i(t);return!((e.width>=0?t.width>=0?n.bottomRight.x<=r.topLeft.x||r.bottomRight.x<=n.topLeft.x:n.bottomRight.x<=r.bottomRight.x||r.topLeft.x<=n.topLeft.x:t.width>=0?n.topLeft.x<=r.topLeft.x||r.bottomRight.x<=n.bottomRight.x:n.topLeft.x<=r.bottomRight.x||r.topLeft.x<=n.bottomRight.x)||(e.height>=0?t.height>=0?n.bottomRight.y<=r.topLeft.y||r.bottomRight.y<=n.topLeft.y:n.bottomRight.y<=r.bottomRight.y||r.topLeft.y<=n.topLeft.y:t.height>=0?n.topLeft.y<=r.topLeft.y||r.bottomRight.y<=n.bottomRight.y:n.topLeft.y<=r.bottomRight.y||r.top<=n.bottomRight.y))}(e,t)){var r=i(e),a=i(t);return e.width>=0?t.width>=0?(n.topLeft.x=Math.max(r.topLeft.x,a.topLeft.x),n.bottomRight.x=Math.min(r.bottomRight.x,a.bottomRight.x)):(n.topLeft.x=Math.max(r.topLeft.x,a.bottomRight.x),n.bottomRight.x=Math.min(r.bottomRight.x,a.topLeft.x)):t.width>=0?(n.topLeft.x=Math.min(r.topLeft.x,a.bottomRight.x),n.bottomRight.x=Math.max(r.bottomRight.x,a.topLeft.x)):(n.topLeft.x=Math.min(r.topLeft.x,a.topLeft.x),n.bottomRight.x=Math.max(r.bottomRight.x,a.bottomRight.x)),e.height>=0?t.height>=0?(n.topLeft.y=Math.max(r.topLeft.y,a.topLeft.y),n.bottomRight.y=Math.min(r.bottomRight.y,a.bottomRight.y)):(n.topLeft.y=Math.max(r.topLeft.y,a.bottomRight.y),n.bottomRight.y=Math.min(r.bottomRight.y,a.topLeft.y)):t.height>=0?(n.topLeft.y=Math.min(r.topLeft.y,a.bottomRight.y),n.bottomRight.y=Math.max(r.bottomRight.y,a.topLeft.y)):(n.topLeft.y=Math.min(r.topLeft.y,a.topLeft.y),n.bottomRight.y=Math.max(r.bottomRight.y,a.bottomRight.y)),n}}}}])},d43V:function(e,t,n){const r=n("3wIk"),i=n("ex/Z");e.exports=(e,t,n)=>{let a=null,o=null,s=null;try{s=new i(t,n)}catch(l){return null}return e.forEach(e=>{s.test(e)&&(a&&-1!==o.compare(e)||(a=e,o=new r(a,n)))}),a}},"dtu/":function(e,t,n){const r=n("8GxW");e.exports=(e,t,n)=>0!==r(e,t,n)},eQf7:function(e,t,n){const r=n("3wIk");e.exports=(e,t,n,i)=>{"string"==typeof n&&(i=n,n=void 0);try{return new r(e,n).inc(t,i).version}catch(a){return null}}},eXNJ:function(e,t,n){const r=n("3wIk"),i=n("Ybu3"),{re:a,t:o}=n("IsDc");e.exports=(e,t)=>{if(e instanceof r)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){let t;for(;(t=a[o.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&t.index+t[0].length===n.index+n[0].length||(n=t),a[o.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;a[o.COERCERTL].lastIndex=-1}else n=e.match(a[o.COERCE]);return null===n?null:i(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)}},euyF:function(e,t,n){(function(e){var r;!function(e,i,a){function o(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,a=t.i;return t.w=r=r+1640531527|0,n=i[a+34&127],e=i[a=a+1&127],n^=n<<13,e^=e<<17,n=i[a]=(n^=n>>>15)^(e^=e>>>12),t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,i,a,o,s=[],l=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,l=Math.max(l,t.length)),i=0,a=-32;a<l;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(i=0==(n=s[127&a]^=r+(o=o+1640531527|0))?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,a=512;a>0;--a)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,s[i]=(r^=r>>>15)^(n^=n>>>12);e.w=o,e.X=s,e.i=i}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function l(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.X&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(t,n,t,i))||(i.exports=r):this.xor4096=l}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},"ex/Z":function(e,t,n){class r{constructor(e,t){if(t=a(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter(e=>!p(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const t of this.set)if(1===t.length&&m(t[0])){this.set=[t];break}}this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=`parseRange:${Object.keys(this.options).join(",")}:${e}`,n=i.get(t);if(n)return n;const r=this.options.loose;e=e.replace(r?u[c.HYPHENRANGELOOSE]:u[c.HYPHENRANGE],C(this.options.includePrerelease)),s("hyphen replace",e),e=e.replace(u[c.COMPARATORTRIM],d),s("comparator trim",e,u[c.COMPARATORTRIM]),e=(e=(e=e.replace(u[c.TILDETRIM],h)).replace(u[c.CARETTRIM],f)).split(/\s+/).join(" ");const a=r?u[c.COMPARATORLOOSE]:u[c.COMPARATOR],l=e.split(" ").map(e=>v(e,this.options)).join(" ").split(/\s+/).map(e=>T(e,this.options)).filter(this.options.loose?e=>!!e.match(a):()=>!0).map(e=>new o(e,this.options)),m=new Map;for(const i of l){if(p(i))return[i];m.set(i.value,i)}m.size>1&&m.has("")&&m.delete("");const g=[...m.values()];return i.set(t,g),g}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(n=>g(n,t)&&e.set.some(e=>g(e,t)&&n.every(n=>e.every(e=>n.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new l(e,this.options)}catch(t){return!1}for(let n=0;n<this.set.length;n++)if(I(this.set[n],e,this.options))return!0;return!1}}e.exports=r;const i=new(n("HyWp"))({max:1e3}),a=n("4S+G"),o=n("vwDW"),s=n("DXxi"),l=n("3wIk"),{re:u,t:c,comparatorTrimReplace:d,tildeTrimReplace:h,caretTrimReplace:f}=n("IsDc"),p=e=>"<0.0.0-0"===e.value,m=e=>""===e.value,g=(e,t)=>{let n=!0;const r=e.slice();let i=r.pop();for(;n&&r.length;)n=r.every(e=>i.intersects(e,t)),i=r.pop();return n},v=(e,t)=>(s("comp",e,t),e=w(e,t),s("caret",e),e=b(e,t),s("tildes",e),e=k(e,t),s("xrange",e),e=S(e,t),s("stars",e),e),y=e=>!e||"x"===e.toLowerCase()||"*"===e,b=(e,t)=>e.trim().split(/\s+/).map(e=>x(e,t)).join(" "),x=(e,t)=>e.replace(t.loose?u[c.TILDELOOSE]:u[c.TILDE],(t,n,r,i,a)=>{let o;return s("tilde",e,t,n,r,i,a),y(n)?o="":y(r)?o=`>=${n}.0.0 <${+n+1}.0.0-0`:y(i)?o=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:a?(s("replaceTilde pr",a),o=`>=${n}.${r}.${i}-${a} <${n}.${+r+1}.0-0`):o=`>=${n}.${r}.${i} <${n}.${+r+1}.0-0`,s("tilde return",o),o}),w=(e,t)=>e.trim().split(/\s+/).map(e=>_(e,t)).join(" "),_=(e,t)=>{s("caret",e,t);const n=t.includePrerelease?"-0":"";return e.replace(t.loose?u[c.CARETLOOSE]:u[c.CARET],(t,r,i,a,o)=>{let l;return s("caret",e,t,r,i,a,o),y(r)?l="":y(i)?l=`>=${r}.0.0${n} <${+r+1}.0.0-0`:y(a)?l="0"===r?`>=${r}.${i}.0${n} <${r}.${+i+1}.0-0`:`>=${r}.${i}.0${n} <${+r+1}.0.0-0`:o?(s("replaceCaret pr",o),l="0"===r?"0"===i?`>=${r}.${i}.${a}-${o} <${r}.${i}.${+a+1}-0`:`>=${r}.${i}.${a}-${o} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${a}-${o} <${+r+1}.0.0-0`):(s("no pr"),l="0"===r?"0"===i?`>=${r}.${i}.${a}${n} <${r}.${i}.${+a+1}-0`:`>=${r}.${i}.${a}${n} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${a} <${+r+1}.0.0-0`),s("caret return",l),l})},k=(e,t)=>(s("replaceXRanges",e,t),e.split(/\s+/).map(e=>E(e,t)).join(" ")),E=(e,t)=>(e=e.trim()).replace(t.loose?u[c.XRANGELOOSE]:u[c.XRANGE],(n,r,i,a,o,l)=>{s("xRange",e,n,r,i,a,o,l);const u=y(i),c=u||y(a),d=c||y(o);return"="===r&&d&&(r=""),l=t.includePrerelease?"-0":"",u?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&d?(c&&(a=0),o=0,">"===r?(r=">=",c?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):"<="===r&&(r="<",c?i=+i+1:a=+a+1),"<"===r&&(l="-0"),n=`${r+i}.${a}.${o}${l}`):c?n=`>=${i}.0.0${l} <${+i+1}.0.0-0`:d&&(n=`>=${i}.${a}.0${l} <${i}.${+a+1}.0-0`),s("xRange return",n),n}),S=(e,t)=>(s("replaceStars",e,t),e.trim().replace(u[c.STAR],"")),T=(e,t)=>(s("replaceGTE0",e,t),e.trim().replace(u[t.includePrerelease?c.GTE0PRE:c.GTE0],"")),C=e=>(t,n,r,i,a,o,s,l,u,c,d,h,f)=>`${n=y(r)?"":y(i)?`>=${r}.0.0${e?"-0":""}`:y(a)?`>=${r}.${i}.0${e?"-0":""}`:o?">="+n:`>=${n}${e?"-0":""}`} ${l=y(u)?"":y(c)?`<${+u+1}.0.0-0`:y(d)?`<${u}.${+c+1}.0-0`:h?`<=${u}.${c}.${d}-${h}`:e?`<${u}.${c}.${+d+1}-0`:"<="+l}`.trim(),I=(e,t,n)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(s(e[n].semver),e[n].semver!==o.ANY&&e[n].semver.prerelease.length>0){const r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0}},gdl2:function(e,t,n){var r;window,r=function(){return function(e){var t=window.webpackHotUpdate;window.webpackHotUpdate=function(e,n){!function(e,t){if(x[e]&&b[e]){for(var n in b[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(p[n]=t[n]);0==--g&&0===v&&E()}}(e,n),t&&t(e,n)};var n,r=!0,i="f1fc9ee2018efa87b506",a={},o=[],s=[];function l(e){var t=T[e];if(!t)return C;var r=function(r){return t.hot.active?(T[r]?-1===T[r].parents.indexOf(e)&&T[r].parents.push(e):(o=[e],n=r),-1===t.children.indexOf(r)&&t.children.push(r)):(console.warn("[HMR] unexpected require("+r+") from disposed module "+e),o=[]),C(r)},i=function(e){return{configurable:!0,enumerable:!0,get:function(){return C[e]},set:function(t){C[e]=t}}};for(var a in C)Object.prototype.hasOwnProperty.call(C,a)&&"e"!==a&&"t"!==a&&Object.defineProperty(r,a,i(a));return r.e=function(e){return"ready"===d&&h("prepare"),v++,C.e(e).then(t,(function(e){throw t(),e}));function t(){v--,"prepare"===d&&(y[e]||k(e),0===v&&0===g&&E())}},r.t=function(e,t){return 1&t&&(e=r(e)),C.t(e,-2&t)},r}function u(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:n!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var r=0;r<e.length;r++)t._acceptedDependencies[e[r]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:_,apply:S,status:function(e){if(!e)return d;c.push(e)},addStatusHandler:function(e){c.push(e)},removeStatusHandler:function(e){var t=c.indexOf(e);t>=0&&c.splice(t,1)},data:a[e]};return n=void 0,t}var c=[],d="idle";function h(e){d=e;for(var t=0;t<c.length;t++)c[t].call(null,e)}var f,p,m,g=0,v=0,y={},b={},x={};function w(e){return+e+""===e?+e:e}function _(e){if("idle"!==d)throw new Error("check() is only allowed in idle status");return r=e,h("check"),(t=1e4,t=t||1e4,new Promise((function(e,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var r=new XMLHttpRequest,a=C.p+""+i+".hot-update.json";r.open("GET",a,!0),r.timeout=t,r.send(null)}catch(o){return n(o)}r.onreadystatechange=function(){if(4===r.readyState)if(0===r.status)n(new Error("Manifest request to "+a+" timed out."));else if(404===r.status)e();else if(200!==r.status&&304!==r.status)n(new Error("Manifest request to "+a+" failed."));else{try{var t=JSON.parse(r.responseText)}catch(i){return void n(i)}e(t)}}}))).then((function(e){if(!e)return h("idle"),null;b={},y={},x=e.c,m=e.h,h("prepare");var t=new Promise((function(e,t){f={resolve:e,reject:t}}));return p={},k("cornerstone"),"prepare"===d&&0===v&&0===g&&E(),t}));var t}function k(e){x[e]?(b[e]=!0,g++,function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.charset="utf-8",n.src=C.p+""+e+"."+i+".hot-update.js",t.appendChild(n)}(e)):y[e]=!0}function E(){h("ready");var e=f;if(f=null,e)if(r)Promise.resolve().then((function(){return S(r)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var n in p)Object.prototype.hasOwnProperty.call(p,n)&&t.push(w(n));e.resolve(t)}}function S(t){if("ready"!==d)throw new Error("apply() is only allowed in ready status");var n,r,s,l,u;function c(e){for(var t=[e],n={},r=t.slice().map((function(e){return{chain:[e],id:e}}));r.length>0;){var i=r.pop(),a=i.id,o=i.chain;if((l=T[a])&&!l.hot._selfAccepted){if(l.hot._selfDeclined)return{type:"self-declined",chain:o,moduleId:a};if(l.hot._main)return{type:"unaccepted",chain:o,moduleId:a};for(var s=0;s<l.parents.length;s++){var u=l.parents[s],c=T[u];if(c){if(c.hot._declinedDependencies[a])return{type:"declined",chain:o.concat([u]),moduleId:a,parentId:u};-1===t.indexOf(u)&&(c.hot._acceptedDependencies[a]?(n[u]||(n[u]=[]),f(n[u],[a])):(delete n[u],t.push(u),r.push({chain:o.concat([u]),id:u})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];-1===e.indexOf(r)&&e.push(r)}}t=t||{};var g={},v=[],y={},b=function(){console.warn("[HMR] unexpected require("+k.moduleId+") to disposed module")};for(var _ in p)if(Object.prototype.hasOwnProperty.call(p,_)){var k;u=w(_);var E=!1,S=!1,I=!1,A="";switch((k=p[_]?c(u):{type:"disposed",moduleId:_}).chain&&(A="\nUpdate propagation: "+k.chain.join(" -> ")),k.type){case"self-declined":t.onDeclined&&t.onDeclined(k),t.ignoreDeclined||(E=new Error("Aborted because of self decline: "+k.moduleId+A));break;case"declined":t.onDeclined&&t.onDeclined(k),t.ignoreDeclined||(E=new Error("Aborted because of declined dependency: "+k.moduleId+" in "+k.parentId+A));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(k),t.ignoreUnaccepted||(E=new Error("Aborted because "+u+" is not accepted"+A));break;case"accepted":t.onAccepted&&t.onAccepted(k),S=!0;break;case"disposed":t.onDisposed&&t.onDisposed(k),I=!0;break;default:throw new Error("Unexception type "+k.type)}if(E)return h("abort"),Promise.reject(E);if(S)for(u in y[u]=p[u],f(v,k.outdatedModules),k.outdatedDependencies)Object.prototype.hasOwnProperty.call(k.outdatedDependencies,u)&&(g[u]||(g[u]=[]),f(g[u],k.outdatedDependencies[u]));I&&(f(v,[k.moduleId]),y[u]=b)}var O,D=[];for(r=0;r<v.length;r++)T[u=v[r]]&&T[u].hot._selfAccepted&&D.push({module:u,errorHandler:T[u].hot._selfAccepted});h("dispose"),Object.keys(x).forEach((function(e){!1===x[e]&&function(e){delete installedChunks[e]}(e)}));for(var M,N=v.slice();N.length>0;)if(u=N.pop(),l=T[u]){var j={},F=l.hot._disposeHandlers;for(s=0;s<F.length;s++)(n=F[s])(j);for(a[u]=j,l.hot.active=!1,delete T[u],delete g[u],s=0;s<l.children.length;s++){var R=T[l.children[s]];R&&(O=R.parents.indexOf(u))>=0&&R.parents.splice(O,1)}}for(u in g)if(Object.prototype.hasOwnProperty.call(g,u)&&(l=T[u]))for(M=g[u],s=0;s<M.length;s++)(O=l.children.indexOf(M[s]))>=0&&l.children.splice(O,1);for(u in h("apply"),i=m,y)Object.prototype.hasOwnProperty.call(y,u)&&(e[u]=y[u]);var P=null;for(u in g)if(Object.prototype.hasOwnProperty.call(g,u)&&(l=T[u])){M=g[u];var L=[];for(r=0;r<M.length;r++)if(n=l.hot._acceptedDependencies[M[r]]){if(-1!==L.indexOf(n))continue;L.push(n)}for(r=0;r<L.length;r++){n=L[r];try{n(M)}catch($){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:u,dependencyId:M[r],error:$}),t.ignoreErrored||P||(P=$)}}}for(r=0;r<D.length;r++){var B=D[r];o=[u=B.module];try{C(u)}catch($){if("function"==typeof B.errorHandler)try{B.errorHandler($)}catch(z){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:u,error:z,originalError:$}),t.ignoreErrored||P||(P=z),P||(P=$)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:u,error:$}),t.ignoreErrored||P||(P=$)}}return P?(h("fail"),Promise.reject(P)):(h("idle"),new Promise((function(e){e(v)})))}var T={};function C(t){if(T[t])return T[t].exports;var n=T[t]={i:t,l:!1,exports:{},hot:u(t),parents:(s=o,o=[],s),children:[]};return e[t].call(n.exports,n,n.exports,l(t)),n.l=!0,n.exports}return C.m=e,C.c=T,C.d=function(e,t,n){C.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},C.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},C.t=function(e,t){if(1&t&&(e=C(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(C.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)C.d(n,r,(function(t){return e[t]}).bind(null,r));return n},C.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return C.d(t,"a",t),t},C.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},C.p="",C.h=function(){return i},l("./index.js")(C.s="./index.js")}({"./canvasToPixel.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/getTransform.js");t.default=function(e,t){var n=Object(r.getEnabledElement)(e),a=Object(i.default)(n);return a.invert(),a.transformPoint(t.x,t.y)}},"./colors/colormap.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getColormapsList",(function(){return l})),n.d(t,"getColormap",(function(){return u}));var r=n("./colors/lookupTable.js"),i=[0,0,0,0],a={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}};function o(e,t){for(var n=0,r=e.length-1;n<=r;){var i=n+Math.floor((r-n)/2),a=e[i];if(a===t)return i;t<a?r=i-1:n=i+1}return n}function s(e,t,n){var r,i=[],a=[],s=[],l=[];for(n=null===n?1:n,r=0;r<t.length;r++){var u=t[r];i.push((e-1)*u[0]),a.push(u[1]),s.push(u[1])}var c=function(e,t,n){for(var r=(1-e)/((n=null===n?100:n)-1),i=[];n-- >0;)i.push(e),e+=r;return i[i.length-1]=1,i}(0,0,e);for(r=0;r<e;r++)c[r]=(e-1)*Math.pow(c[r],n);var d=function(e,t){var n,r=[],i=t.length;for(e.sort((function(e,t){return e-t})),n=0;n<i;n++)r[n]=o(e,t[n]);return r}(i,c);for(r=1;r<e-1;r++){var h=d[r];l[r]=(c[r]-i[h-1])/(i[h]-i[h-1])*(a[h]-s[h-1])+s[h-1]}return l[0]=s[0],l[e-1]=a[t.length-1],l}function l(){var e=[];return Object.keys(a).forEach((function(t){a.hasOwnProperty(t)&&e.push({id:t,name:a[t].name})})),e.sort((function(e,t){var n=e.name.toLowerCase(),r=t.name.toLowerCase();return n===r?0:n<r?-1:1})),e}function u(e,t){var n=a[e];return n||(n=a[e]=t||{name:"",colors:[]}),!n.colors&&n.segmentedData&&(n.colors=function(e,t,n){var r,i=[],a=s(t=null===t?256:t,e.red,n=null===n?1:n),o=s(t,e.green,n),l=s(t,e.blue,n);for(r=0;r<t;r++){var u=Math.round(255*a[r]),c=Math.round(255*o[r]),d=Math.round(255*l[r]);i.push([u,c,d,255])}return i}(n.segmentedData,n.numColors,n.gamma)),{getId:function(){return e},getColorSchemeName:function(){return n.name},setColorSchemeName:function(e){n.name=e},getNumberOfColors:function(){return n.colors.length},setNumberOfColors:function(e){for(;n.colors.length<e;)n.colors.push(i);n.colors.length=e},getColor:function(e){return this.isValidIndex(e)?n.colors[e]:i},getColorRepeating:function(e){var t=n.colors.length;return this.getColor(e=t?e%t:0)},setColor:function(e,t){this.isValidIndex(e)&&(n.colors[e]=t)},addColor:function(e){n.colors.push(e)},insertColor:function(e,t){this.isValidIndex(e)&&n.colors.splice(e,1,t)},removeColor:function(e){this.isValidIndex(e)&&n.colors.splice(e,1)},clearColors:function(){n.colors=[]},buildLookupTable:function(e){if(e){var t=n.colors.length;e.setNumberOfTableValues(t);for(var r=0;r<t;r++)e.setTableValue(r,n.colors[r])}},createLookupTable:function(){var e=new r.default;return this.buildLookupTable(e),e},isValidIndex:function(e){return e>=0&&e<n.colors.length}}}},"./colors/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./colors/colormap.js"),i=n("./colors/lookupTable.js");t.default={getColormap:r.getColormap,getColormapsList:r.getColormapsList,LookupTable:i.default}},"./colors/lookupTable.js":function(e,t,n){"use strict";function r(e,t,n){if(e>1)throw new Error("HSVToRGB expects hue < 1");var r=[];if(0===t)return r[0]=n,r[1]=n,r[2]=n,r;var i=Math.floor(6*e),a=6*e-i,o=n*(1-t),s=n*(1-t*a),l=n*(1-t*(1-a));switch(i){case 0:case 6:r[0]=n,r[1]=l,r[2]=o;break;case 1:r[0]=s,r[1]=n,r[2]=o;break;case 2:r[0]=o,r[1]=n,r[2]=l;break;case 3:r[0]=o,r[1]=s,r[2]=n;break;case 4:r[0]=l,r[1]=o,r[2]=n;break;case 5:r[0]=n,r[1]=o,r[2]=s}return r}n.r(t),t.default=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}var t;return(t=[{key:"setNumberOfTableValues",value:function(e){this.NumberOfColors=e}},{key:"setRamp",value:function(e){this.Ramp=e}},{key:"setTableRange",value:function(e,t){this.TableRange[0]=e,this.TableRange[1]=t}},{key:"setHueRange",value:function(e,t){this.HueRange[0]=e,this.HueRange[1]=t}},{key:"setSaturationRange",value:function(e,t){this.SaturationRange[0]=e,this.SaturationRange[1]=t}},{key:"setValueRange",value:function(e,t){this.ValueRange[0]=e,this.ValueRange[1]=t}},{key:"setRange",value:function(e,t){this.InputRange[0]=e,this.InputRange[1]=t}},{key:"setAlphaRange",value:function(e,t){this.AlphaRange[0]=e,this.AlphaRange[1]=t}},{key:"getColor",value:function(e){return this.mapValue(e)}},{key:"build",value:function(e){if(!(this.Table.length>1)||e){this.Table=[];var t,n,i,a,o=this.NumberOfColors-1;o?(t=(this.HueRange[1]-this.HueRange[0])/o,n=(this.SaturationRange[1]-this.SaturationRange[0])/o,i=(this.ValueRange[1]-this.ValueRange[0])/o,a=(this.AlphaRange[1]-this.AlphaRange[0])/o):t=n=i=a=0;for(var s=0;s<=o;s++){var l=this.AlphaRange[0]+s*a,u=r(this.HueRange[0]+s*t,this.SaturationRange[0]+s*n,this.ValueRange[0]+s*i),c=[];switch(this.Ramp){case"scurve":c[0]=Math.floor(127.5*(1+Math.cos((1-u[0])*Math.PI))),c[1]=Math.floor(127.5*(1+Math.cos((1-u[1])*Math.PI))),c[2]=Math.floor(127.5*(1+Math.cos((1-u[2])*Math.PI))),c[3]=Math.floor(255*l);break;case"linear":c[0]=Math.floor(255*u[0]+.5),c[1]=Math.floor(255*u[1]+.5),c[2]=Math.floor(255*u[2]+.5),c[3]=Math.floor(255*l+.5);break;case"sqrt":c[0]=Math.floor(255*Math.sqrt(u[0])+.5),c[1]=Math.floor(255*Math.sqrt(u[1])+.5),c[2]=Math.floor(255*Math.sqrt(u[2])+.5),c[3]=Math.floor(255*Math.sqrt(l)+.5);break;default:throw new Error("Invalid Ramp value (".concat(this.Ramp,")"))}this.Table.push(c)}this.buildSpecialColors()}}},{key:"buildSpecialColors",value:function(){var e=this.NumberOfColors,t=e+1,n=e+2;this.Table[e+0]=this.UseBelowRangeColor||0===e?this.BelowRangeColor:this.Table[0],this.Table[t]=this.UseAboveRangeColor||0===e?this.AboveRangeColor:this.Table[e-1],this.Table[n]=this.NaNColor}},{key:"mapValue",value:function(e){var t=this.getIndex(e);if(t<0)return this.NaNColor;if(0===t){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(t===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[t]}},{key:"getIndex",value:function(e){var t={Range:[]};if(t.MaxIndex=this.NumberOfColors-1,t.Shift=-this.TableRange[0],t.Scale=this.TableRange[1]<=this.TableRange[0]?Number.MAX_VALUE:t.MaxIndex/(this.TableRange[1]-this.TableRange[0]),t.Range[0]=this.TableRange[0],t.Range[1]=this.TableRange[1],isNaN(e))return-1;var n=function(e,t){return Math.floor(e<t.Range[0]?t.MaxIndex+0+1.5:e>t.Range[1]?t.MaxIndex+1+1.5:(e+t.Shift)*t.Scale)}(e,t);return n===this.NumberOfColors+0?n=0:n===this.NumberOfColors+1&&(n=this.NumberOfColors-1),n}},{key:"setTableValue",value:function(e,t){if(5===arguments.length&&(t=Array.prototype.slice.call(arguments,1)),e<0)throw new Error("Can't set the table value for negative index (".concat(e,")"));e>=this.NumberOfColors&&new Error("Index ".concat(e," is greater than the number of colors ").concat(this.NumberOfColors)),this.Table[e]=t,0!==e&&e!==this.NumberOfColors-1||this.buildSpecialColors()}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}()},"./disable.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./triggerEvent.js"),a=n("./events.js");t.default=function(e){if(void 0===e)throw new Error("disable: element must not be undefined");for(var t=Object(r.getEnabledElements)(),n=0;n<t.length;n++)if(t[n].element===e){var o={element:e};Object(i.default)(e,a.default.ELEMENT_DISABLED,o),Object(i.default)(a.events,a.default.ELEMENT_DISABLED,o),t[n].element.removeChild(t[n].canvas),t[n].canvas=void 0,t.splice(n,1);break}}},"./displayImage.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/getDefaultViewport.js"),a=n("./updateImage.js"),o=n("./internal/now.js"),s=n("./layers.js"),l=n("./triggerEvent.js"),u=n("./events.js");t.default=function(e,t,n){if(void 0===e)throw new Error("displayImage: parameter element must not be undefined");if(void 0===t)throw new Error("displayImage: parameter image must not be undefined");var c,d=Object(r.getEnabledElement)(e),h=d.image;if(d.image=t,d.layers&&d.layers.length&&Object(s.setLayerImage)(e,t),void 0===d.viewport&&(d.viewport=Object(i.default)(d.canvas,t)),n)for(var f in n)null!==n[f]&&(d.viewport[f]=n[f]);void 0!==d.lastImageTimeStamp&&(c=(1e3/(Object(o.default)()-d.lastImageTimeStamp)).toFixed()),d.lastImageTimeStamp=Object(o.default)();var p={viewport:d.viewport,element:d.element,image:d.image,oldImage:h,enabledElement:d,frameRate:c};Object(l.default)(d.element,u.default.NEW_IMAGE,p),Object(a.default)(e)}},"./draw.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/drawImage.js");t.default=function(e){var t=Object(r.getEnabledElement)(e);if(void 0===t.image)throw new Error("draw: image has not been loaded yet");Object(i.default)(t)}},"./drawInvalidated.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/drawImage.js");t.default=function(){for(var e=Object(r.getEnabledElements)(),t=0;t<e.length;t++){var n=e[t];!0===n.invalid&&Object(i.default)(n,!0)}}},"./enable.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./resize.js"),a=n("./internal/drawImageSync.js"),o=n("./internal/requestAnimationFrame.js"),s=n("./internal/tryEnableWebgl.js"),l=n("./triggerEvent.js"),u=n("./generateUUID.js"),c=n("./events.js"),d=n("./internal/getCanvas.js");t.default=function(e,t){if(void 0===e)throw new Error("enable: parameter element cannot be undefined");t&&t.renderer&&"webgl"===t.renderer.toLowerCase()&&Object(s.default)(t);var n={element:e,canvas:Object(d.default)(e),image:void 0,invalid:!1,needsRedraw:!0,options:t,layers:[],data:{},renderingTools:{},uuid:Object(u.default)()};Object(r.addEnabledElement)(n),Object(l.default)(c.events,c.default.ELEMENT_ENABLED,n),Object(i.default)(e,!0),function e(t){if(void 0!==n.canvas){var r={enabledElement:n,timestamp:t};Object(l.default)(n.element,c.default.PRE_RENDER,r),n.needsRedraw&&function(e){return void 0!==e.image||e.layers.length>0}(n)&&Object(a.default)(n,n.invalid),Object(o.default)(e)}}()}},"./enabledElementData.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getElementData",(function(){return i})),n.d(t,"removeElementData",(function(){return a}));var r=n("./enabledElements.js");function i(e,t){var n=Object(r.getEnabledElement)(e);return!1===n.data.hasOwnProperty(t)&&(n.data[t]={}),n.data[t]}function a(e,t){delete Object(r.getEnabledElement)(e).data[t]}},"./enabledElements.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getEnabledElement",(function(){return i})),n.d(t,"addEnabledElement",(function(){return a})),n.d(t,"getEnabledElementsByImageId",(function(){return o})),n.d(t,"getEnabledElements",(function(){return s}));var r=[];function i(e){if(void 0===e)throw new Error("getEnabledElement: parameter element must not be undefined");for(var t=0;t<r.length;t++)if(r[t].element===e)return r[t];throw new Error("element not enabled")}function a(e){if(void 0===e)throw new Error("getEnabledElement: enabledElement element must not be undefined");r.push(e)}function o(e){var t=[];return r.forEach((function(n){n.image&&n.image.imageId===e&&t.push(n)})),t}function s(){return r}},"./events.js":function(e,t,n){"use strict";n.r(t),n.d(t,"events",(function(){return r})),t.default={NEW_IMAGE:"cornerstonenewimage",INVALIDATED:"cornerstoneinvalidated",PRE_RENDER:"cornerstoneprerender",IMAGE_CACHE_MAXIMUM_SIZE_CHANGED:"cornerstoneimagecachemaximumsizechanged",IMAGE_CACHE_PROMISE_REMOVED:"cornerstoneimagecachepromiseremoved",IMAGE_CACHE_FULL:"cornerstoneimagecachefull",IMAGE_CACHE_CHANGED:"cornerstoneimagecachechanged",WEBGL_TEXTURE_REMOVED:"cornerstonewebgltextureremoved",WEBGL_TEXTURE_CACHE_FULL:"cornerstonewebgltexturecachefull",IMAGE_LOADED:"cornerstoneimageloaded",IMAGE_LOAD_FAILED:"cornerstoneimageloadfailed",ELEMENT_RESIZED:"cornerstoneelementresized",IMAGE_RENDERED:"cornerstoneimagerendered",LAYER_ADDED:"cornerstonelayeradded",LAYER_REMOVED:"cornerstonelayerremoved",ACTIVE_LAYER_CHANGED:"cornerstoneactivelayerchanged",ELEMENT_DISABLED:"cornerstoneelementdisabled",ELEMENT_ENABLED:"cornerstoneelementenabled"};var r=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listeners={},this.namespaces={}}var t;return(t=[{key:"addEventNamespaceListener",value:function(e,t){e.indexOf(".")<=0||(this.namespaces[e]=t,this.addEventListener(e.split(".")[0],t))}},{key:"removeEventNamespaceListener",value:function(e){e.indexOf(".")<=0||!this.namespaces[e]||(this.removeEventListener(e.split(".")[0],this.namespaces[e]),delete this.namespaces[e])}},{key:"addEventListener",value:function(e,t){e.indexOf(".")>0?this.addEventNamespaceListener(e,t):(e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t))}},{key:"removeEventListener",value:function(e,t){if(e.indexOf(".")>0)this.removeEventNamespaceListener(e);else if(e in this.listeners)for(var n=this.listeners[e],r=0,i=n.length;r<i;r++)if(n[r]===t)return void n.splice(r,1)}},{key:"dispatchEvent",value:function(e){if(!(e.type in this.listeners))return!0;for(var t=this.listeners[e.type],n=0,r=t.length;n<r;n++)t[n].call(this,e);return!e.defaultPrevented}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}())},"./falseColorMapping.js":function(e,t,n){"use strict";n.r(t),n.d(t,"convertImageToFalseColorImage",(function(){return s})),n.d(t,"convertToFalseColorImage",(function(){return l})),n.d(t,"restoreImage",(function(){return o}));var r=n("./enabledElements.js"),i=n("./pixelDataToFalseColorData.js"),a=n("./colors/colormap.js");function o(e){return!(!e.restore||"function"!=typeof e.restore||(e.restore(),0))}function s(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");var n=(t=function(e){return e&&"string"==typeof e&&(e=Object(a.getColormap)(e)),e}(t)).getId();if(e.colormapId===n)return!1;if(o(e),n){var r=e.minPixelValue||0,s=e.maxPixelValue||255;e.restore=function(e){if(e.restore)return e.restore;var t=e.color,n=e.rgba,r=e.cachedLut,i=e.slope,a=e.windowWidth,o=e.windowCenter,s=e.minPixelValue,l=e.maxPixelValue;return function(){if(e.color=t,e.rgba=n,e.cachedLut=r,e.slope=i,e.windowWidth=a,e.windowCenter=o,e.minPixelValue=s,e.maxPixelValue=l,e.origPixelData){var u=e.origPixelData;e.getPixelData=function(){return u}}e.origPixelData=void 0,e.colormapId=void 0,e.falseColor=void 0}}(e);var l=t.createLookupTable();l.setTableRange(r,s),Object(i.default)(e,l);var u=function(e){for(var t,n=Number.MAX_VALUE,r=Number.MIN_VALUE,i=e.length,a=0;a<i;a++)n=n<(t=e[a])?n:t,r=r>t?r:t;return{minPixelValue:n,maxPixelValue:r}}(e.getPixelData());e.minPixelValue=u.minPixelValue,e.maxPixelValue=u.maxPixelValue,e.windowWidth=255,e.windowCenter=128,e.colormapId=n}return!0}function l(e,t){return s(Object(r.getEnabledElement)(e).image,t)}},"./fitToWindow.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./updateImage.js"),a=n("./internal/getImageFitScale.js");t.default=function(e){var t=Object(r.getEnabledElement)(e),n=t.image;t.viewport.scale=Object(a.default)(t.canvas,n,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0,Object(i.default)(e)}},"./generateUUID.js":function(e,t,n){"use strict";n.r(t),t.default=function(){var e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"x.x.x.x.x.x.xxxx.xxx.x.x.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))}},"./getDefaultViewportForImage.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/getDefaultViewport.js");t.default=function(e,t){var n=Object(r.getEnabledElement)(e);return Object(i.default)(n.canvas,t)}},"./getImage.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js");t.default=function(e){return Object(r.getEnabledElement)(e).image}},"./getPixels.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./getStoredPixels.js"),a=n("./internal/getModalityLUT.js");t.default=function(e,t,n,o,s){var l=Object(i.default)(e,t,n,o,s),u=Object(r.getEnabledElement)(e),c=Object(a.default)(u.image.slope,u.image.intercept,u.viewport.modalityLUT);return l.map(c)}},"./getStoredPixels.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js");t.default=function(e,t,n,i,a){if(void 0===e)throw new Error("getStoredPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);for(var o=Object(r.getEnabledElement)(e),s=[],l=0,u=o.image.getPixelData(),c=0;c<a;c++)for(var d=0;d<i;d++)s[l++]=u[(c+n)*o.image.columns+(d+t)];return s}},"./getViewport.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js");t.default=function(e){var t=Object(r.getEnabledElement)(e).viewport;if(void 0!==t)return Object.assign({},t)}},"./imageCache.js":function(e,t,n){"use strict";n.r(t),n.d(t,"cachedImages",(function(){return l})),n.d(t,"setMaximumSizeBytes",(function(){return u})),n.d(t,"putImageLoadObject",(function(){return d})),n.d(t,"getImageLoadObject",(function(){return h})),n.d(t,"removeImageLoadObject",(function(){return f})),n.d(t,"getCacheInfo",(function(){return p})),n.d(t,"purgeCache",(function(){return m})),n.d(t,"changeImageIdCacheSize",(function(){return g}));var r=n("./events.js"),i=n("./triggerEvent.js"),a=1073741824,o=0,s={},l=[];function u(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");a=e,Object(i.default)(r.events,r.default.IMAGE_CACHE_MAXIMUM_SIZE_CHANGED),c()}function c(){if(!(o<=a)){for(l.sort((function(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0}));o>a;){var e=l[l.length-1].imageId;f(e),Object(i.default)(r.events,r.default.IMAGE_CACHE_PROMISE_REMOVED,{imageId:e})}var t=p();Object(i.default)(r.events,r.default.IMAGE_CACHE_FULL,t)}}function d(e,t){if(void 0===e)throw new Error("putImageLoadObject: imageId must not be undefined");if(void 0===t.promise)throw new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");if(!0===s.hasOwnProperty(e))throw new Error("putImageLoadObject: imageId already in cache");if(t.cancelFn&&"function"!=typeof t.cancelFn)throw new Error("putImageLoadObject: imageLoadObject.cancelFn must be a function");var n={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:t,timeStamp:Date.now(),sizeInBytes:0};s[e]=n,l.push(n),t.promise.then((function(e){if(-1!==l.indexOf(n)){if(n.loaded=!0,n.image=e,void 0===e.sizeInBytes)throw new Error("putImageLoadObject: image.sizeInBytes must not be undefined");if(void 0===e.sizeInBytes.toFixed)throw new Error("putImageLoadObject: image.sizeInBytes is not a number");n.sizeInBytes=e.sizeInBytes,o+=n.sizeInBytes;var t={action:"addImage",image:n};Object(i.default)(r.events,r.default.IMAGE_CACHE_CHANGED,t),n.sharedCacheKey=e.sharedCacheKey,c()}}),(function(){l.splice(l.indexOf(s[e]),1),delete s[e]}))}function h(e){if(void 0===e)throw new Error("getImageLoadObject: imageId must not be undefined");var t=s[e];if(void 0!==t)return t.timeStamp=Date.now(),t.imageLoadObject}function f(e){if(void 0===e)throw new Error("removeImageLoadObject: imageId must not be undefined");var t=s[e];if(void 0===t)throw new Error("removeImageLoadObject: imageId was not present in imageCache");l.splice(l.indexOf(t),1),o-=t.sizeInBytes;var n,a={action:"deleteImage",image:t};Object(i.default)(r.events,r.default.IMAGE_CACHE_CHANGED,a),(n=t.imageLoadObject).promise.then((function(){n.decache&&n.decache()}),(function(){n.decache&&n.decache()})),delete s[e]}function p(){return{maximumSizeInBytes:a,cacheSizeInBytes:o,numberOfImagesCached:l.length}}function m(){for(;l.length>0;)f(l[0].imageId)}function g(e,t){var n=s[e];n&&n.imageLoadObject.promise.then((function(e){var a=t-e.sizeInBytes;e.sizeInBytes=t,n.sizeInBytes=t,o+=a;var s={action:"changeImageSize",image:e};Object(i.default)(r.events,r.default.IMAGE_CACHE_CHANGED,s)}))}t.default={imageCache:s,cachedImages:l,setMaximumSizeBytes:u,putImageLoadObject:d,getImageLoadObject:h,removeImageLoadObject:f,getCacheInfo:p,purgeCache:m,changeImageIdCacheSize:g}},"./imageLoader.js":function(e,t,n){"use strict";n.r(t),n.d(t,"loadImage",(function(){return u})),n.d(t,"loadAndCacheImage",(function(){return c})),n.d(t,"registerImageLoader",(function(){return d})),n.d(t,"registerUnknownImageLoader",(function(){return h}));var r,i=n("./imageCache.js"),a=n("./events.js"),o=n("./triggerEvent.js"),s={};function l(e,t){var n=e.indexOf(":"),i=e.substring(0,n),l=s[i];if(null==l){if(void 0!==r)return r(e);throw new Error("loadImageFromImageLoader: no image loader for imageId")}var u=l(e,t);return u.promise.then((function(e){Object(o.default)(a.events,a.default.IMAGE_LOADED,{image:e})}),(function(t){var n={imageId:e,error:t};Object(o.default)(a.events,a.default.IMAGE_LOAD_FAILED,n)})),u}function u(e,t){if(void 0===e)throw new Error("loadImage: parameter imageId must not be undefined");var n=Object(i.getImageLoadObject)(e);return void 0!==n?n.promise:l(e,t).promise}function c(e,t){if(void 0===e)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");var n=Object(i.getImageLoadObject)(e);return void 0!==n||(n=l(e,t),Object(i.putImageLoadObject)(e,n)),n.promise}function d(e,t){s[e]=t}function h(e){var t=r;return r=e,t}},"./index.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js");n.d(t,"EVENTS",(function(){return r.default})),n.d(t,"events",(function(){return r.events}));var i=n("./enabledElements.js");n.d(t,"getEnabledElement",(function(){return i.getEnabledElement})),n.d(t,"addEnabledElement",(function(){return i.addEnabledElement})),n.d(t,"getEnabledElementsByImageId",(function(){return i.getEnabledElementsByImageId})),n.d(t,"getEnabledElements",(function(){return i.getEnabledElements}));var a=n("./layers.js");n.d(t,"addLayer",(function(){return a.addLayer})),n.d(t,"removeLayer",(function(){return a.removeLayer})),n.d(t,"getLayer",(function(){return a.getLayer})),n.d(t,"getLayers",(function(){return a.getLayers})),n.d(t,"getVisibleLayers",(function(){return a.getVisibleLayers})),n.d(t,"setActiveLayer",(function(){return a.setActiveLayer})),n.d(t,"getActiveLayer",(function(){return a.getActiveLayer})),n.d(t,"purgeLayers",(function(){return a.purgeLayers})),n.d(t,"setLayerImage",(function(){return a.setLayerImage}));var o=n("./falseColorMapping.js");n.d(t,"convertImageToFalseColorImage",(function(){return o.convertImageToFalseColorImage})),n.d(t,"convertToFalseColorImage",(function(){return o.convertToFalseColorImage})),n.d(t,"restoreImage",(function(){return o.restoreImage}));var s=n("./enabledElementData.js");n.d(t,"getElementData",(function(){return s.getElementData})),n.d(t,"removeElementData",(function(){return s.removeElementData}));var l=n("./imageLoader.js");n.d(t,"loadImage",(function(){return l.loadImage})),n.d(t,"loadAndCacheImage",(function(){return l.loadAndCacheImage})),n.d(t,"registerImageLoader",(function(){return l.registerImageLoader})),n.d(t,"registerUnknownImageLoader",(function(){return l.registerUnknownImageLoader}));var u=n("./canvasToPixel.js");n.d(t,"canvasToPixel",(function(){return u.default}));var c=n("./colors/index.js");n.d(t,"colors",(function(){return c.default}));var d=n("./disable.js");n.d(t,"disable",(function(){return d.default}));var h=n("./displayImage.js");n.d(t,"displayImage",(function(){return h.default}));var f=n("./draw.js");n.d(t,"draw",(function(){return f.default}));var p=n("./internal/drawImage.js");n.d(t,"drawImage",(function(){return p.default}));var m=n("./drawInvalidated.js");n.d(t,"drawInvalidated",(function(){return m.default}));var g=n("./enable.js");n.d(t,"enable",(function(){return g.default}));var v=n("./fitToWindow.js");n.d(t,"fitToWindow",(function(){return v.default}));var y=n("./internal/generateLut.js");n.d(t,"generateLut",(function(){return y.default}));var b=n("./internal/getDefaultViewport.js");n.d(t,"getDefaultViewport",(function(){return b.default}));var x=n("./getDefaultViewportForImage.js");n.d(t,"getDefaultViewportForImage",(function(){return x.default}));var w=n("./getImage.js");n.d(t,"getImage",(function(){return w.default}));var _=n("./getPixels.js");n.d(t,"getPixels",(function(){return _.default}));var k=n("./getStoredPixels.js");n.d(t,"getStoredPixels",(function(){return k.default}));var E=n("./getViewport.js");n.d(t,"getViewport",(function(){return E.default}));var S=n("./imageCache.js");n.d(t,"imageCache",(function(){return S.default}));var T=n("./internal/index.js");n.d(t,"internal",(function(){return T.default}));var C=n("./invalidate.js");n.d(t,"invalidate",(function(){return C.default}));var I=n("./invalidateImageId.js");n.d(t,"invalidateImageId",(function(){return I.default}));var A=n("./metaData.js");n.d(t,"metaData",(function(){return A.default}));var O=n("./pageToPixel.js");n.d(t,"pageToPixel",(function(){return O.default}));var D=n("./pixelDataToFalseColorData.js");n.d(t,"pixelDataToFalseColorData",(function(){return D.default}));var M=n("./pixelToCanvas.js");n.d(t,"pixelToCanvas",(function(){return M.default}));var N=n("./rendering/renderColorImage.js");n.d(t,"renderColorImage",(function(){return N.renderColorImage}));var j=n("./rendering/renderGrayscaleImage.js");n.d(t,"renderGrayscaleImage",(function(){return j.renderGrayscaleImage}));var F=n("./rendering/renderLabelMapImage.js");n.d(t,"renderLabelMapImage",(function(){return F.renderLabelMapImage}));var R=n("./rendering/renderPseudoColorImage.js");n.d(t,"renderPseudoColorImage",(function(){return R.renderPseudoColorImage}));var P=n("./rendering/renderToCanvas.js");n.d(t,"renderToCanvas",(function(){return P.default}));var L=n("./rendering/renderWebImage.js");n.d(t,"renderWebImage",(function(){return L.renderWebImage}));var B=n("./rendering/index.js");n.d(t,"rendering",(function(){return B.default}));var $=n("./internal/requestAnimationFrame.js");n.d(t,"requestAnimationFrame",(function(){return $.default}));var z=n("./reset.js");n.d(t,"reset",(function(){return z.default}));var U=n("./resize.js");n.d(t,"resize",(function(){return U.default}));var H=n("./internal/setDefaultViewport.js");n.d(t,"setDefaultViewport",(function(){return H.default}));var W=n("./setToPixelCoordinateSystem.js");n.d(t,"setToPixelCoordinateSystem",(function(){return W.default}));var V=n("./setViewport.js");n.d(t,"setViewport",(function(){return V.default}));var q=n("./internal/storedColorPixelDataToCanvasImageData.js");n.d(t,"storedColorPixelDataToCanvasImageData",(function(){return q.default}));var G=n("./internal/storedPixelDataToCanvasImageData.js");n.d(t,"storedPixelDataToCanvasImageData",(function(){return G.default}));var Y=n("./internal/storedPixelDataToCanvasImageDataColorLUT.js");n.d(t,"storedPixelDataToCanvasImageDataColorLUT",(function(){return Y.default}));var X=n("./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js");n.d(t,"storedPixelDataToCanvasImageDataPseudocolorLUT",(function(){return X.default}));var K=n("./triggerEvent.js");n.d(t,"triggerEvent",(function(){return K.default}));var Z=n("./updateImage.js");n.d(t,"updateImage",(function(){return Z.default}));var J=n("./webgl/index.js");n.d(t,"webGL",(function(){return J.default})),t.default={drawImage:p.default,generateLut:y.default,getDefaultViewport:b.default,requestAnimationFrame:$.default,storedPixelDataToCanvasImageData:G.default,storedColorPixelDataToCanvasImageData:q.default,storedPixelDataToCanvasImageDataColorLUT:Y.default,storedPixelDataToCanvasImageDataPseudocolorLUT:X.default,internal:T.default,renderLabelMapImage:F.renderLabelMapImage,renderPseudoColorImage:R.renderPseudoColorImage,renderColorImage:N.renderColorImage,renderGrayscaleImage:j.renderGrayscaleImage,renderWebImage:L.renderWebImage,renderToCanvas:P.default,canvasToPixel:u.default,disable:d.default,displayImage:h.default,draw:f.default,drawInvalidated:m.default,enable:g.default,getElementData:s.getElementData,removeElementData:s.removeElementData,getEnabledElement:i.getEnabledElement,addEnabledElement:i.addEnabledElement,getEnabledElementsByImageId:i.getEnabledElementsByImageId,getEnabledElements:i.getEnabledElements,addLayer:a.addLayer,removeLayer:a.removeLayer,getLayer:a.getLayer,getLayers:a.getLayers,getVisibleLayers:a.getVisibleLayers,setActiveLayer:a.setActiveLayer,getActiveLayer:a.getActiveLayer,purgeLayers:a.purgeLayers,setLayerImage:a.setLayerImage,fitToWindow:v.default,getDefaultViewportForImage:x.default,setDefaultViewport:H.default,getImage:w.default,getPixels:_.default,getStoredPixels:k.default,getViewport:E.default,loadImage:l.loadImage,loadAndCacheImage:l.loadAndCacheImage,registerImageLoader:l.registerImageLoader,registerUnknownImageLoader:l.registerUnknownImageLoader,invalidate:C.default,invalidateImageId:I.default,pageToPixel:O.default,pixelToCanvas:M.default,reset:z.default,resize:U.default,setToPixelCoordinateSystem:W.default,setViewport:V.default,updateImage:Z.default,pixelDataToFalseColorData:D.default,rendering:B.default,imageCache:S.default,metaData:A.default,webGL:J.default,colors:c.default,convertImageToFalseColorImage:o.convertImageToFalseColorImage,convertToFalseColorImage:o.convertToFalseColorImage,restoreImage:o.restoreImage,EVENTS:r.default,events:r.events,triggerEvent:K.default}},"./internal/calculateTransform.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/transform.js");t.default=function(e,t){var n=new r.Transform;n.translate(e.canvas.width/2,e.canvas.height/2);var i=e.viewport.rotation;0!==i&&n.rotate(i*Math.PI/180);var a=e.viewport.scale,o=e.viewport.scale,s=e.viewport.displayedArea.brhc.x-(e.viewport.displayedArea.tlhc.x-1),l=e.viewport.displayedArea.brhc.y-(e.viewport.displayedArea.tlhc.y-1);return"NONE"===e.viewport.displayedArea.presentationSizeMode?e.image.rowPixelSpacing<e.image.columnPixelSpacing?a*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(o*=e.image.rowPixelSpacing/e.image.columnPixelSpacing):(a=e.viewport.displayedArea.columnPixelSpacing,o=e.viewport.displayedArea.rowPixelSpacing,"SCALE TO FIT"===e.viewport.displayedArea.presentationSizeMode&&(a=o=Math.min(e.canvas.width/(s*a),e.canvas.height/(l*o)),e.viewport.displayedArea.rowPixelSpacing<e.viewport.displayedArea.columnPixelSpacing?a*=e.viewport.displayedArea.columnPixelSpacing/e.viewport.displayedArea.rowPixelSpacing:e.viewport.displayedArea.columnPixelSpacing<e.viewport.displayedArea.rowPixelSpacing&&(o*=e.viewport.displayedArea.rowPixelSpacing/e.viewport.displayedArea.columnPixelSpacing))),n.scale(a,o),0!==i&&n.rotate(-i*Math.PI/180),n.translate(e.viewport.translation.x,e.viewport.translation.y),0!==i&&n.rotate(i*Math.PI/180),void 0!==t&&n.scale(t,t),e.viewport.hflip&&n.scale(-1,1),e.viewport.vflip&&n.scale(1,-1),n.translate(-s/2,-l/2),n}},"./internal/computeAutoVoi.js":function(e,t,n){"use strict";function r(e,t){if(!function(e){return e.voiLUT&&e.voiLUT.lut&&e.voiLUT.lut.length>0||void 0!==e.voi.windowWidth&&void 0!==e.voi.windowCenter}(e)){var n=t.maxPixelValue*t.slope+t.intercept,r=t.minPixelValue*t.slope+t.intercept,i=n-r,a=(n+r)/2;void 0===e.voi?e.voi={windowWidth:i,windowCenter:a}:(e.voi.windowWidth=i,e.voi.windowCenter=a)}}n.r(t),n.d(t,"default",(function(){return r}))},"./internal/createViewport.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/setDefaultViewport.js");t.default=function(){return Object.assign({},{scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:{tlhc:{x:1,y:1},brhc:{x:1,y:1},rowPixelSpacing:1,columnPixelSpacing:1,presentationSizeMode:"NONE"}},r.state.viewport)}},"./internal/drawCompositeImage.js":function(e,t,n){"use strict";n.r(t);var r=n("./layers.js"),i=n("./rendering/renderGrayscaleImage.js"),a=n("./rendering/renderColorImage.js"),o=n("./rendering/renderPseudoColorImage.js"),s=n("./rendering/renderLabelMapImage.js"),l=n("./setToPixelCoordinateSystem.js");function u(e){var t=e.syncProps||{};t.originalScale=e.viewport.scale,e.syncProps=t}t.default=function(e,t){var n=e.element,c=Object(r.getLayers)(n),d=Object(r.getActiveLayer)(n),h=Object(r.getVisibleLayers)(n),f=!e.lastSyncViewportsState&&e.syncViewports;e.lastSyncViewportsState=e.syncViewports,f&&c.forEach((function(e){e.viewport&&u(e)})),!0===e.syncViewports&&function(e,t){e.forEach((function(e){if(e!==t&&e.viewport&&t.viewport){e.syncProps||u(e);var n,r,i=(r=e,(n=t).syncProps||u(n),r.syncProps||u(r),r.syncProps.originalScale/n.syncProps.originalScale);e.viewport.scale=t.viewport.scale*i,e.viewport.rotation=t.viewport.rotation,e.viewport.translation={x:t.viewport.translation.x/i,y:t.viewport.translation.y/i},e.viewport.hflip=t.viewport.hflip,e.viewport.vflip=t.viewport.vflip}}))}(h,d);var p=e.canvas.getContext("2d");p.setTransform(1,0,0,1,0,0),p.fillStyle="black",p.fillRect(0,0,e.canvas.width,e.canvas.height),function(e,t,n){t.forEach((function(t,r){if(t.image){e.save(),t.canvas=e.canvas,Object(l.default)(t,e);var u=t.viewport.colormap||t.options.colormap,c=t.invalid||n;if(u&&""!==u&&!0===t.viewport.labelmap)Object(s.addLabelMapLayer)(t,c);else if(u&&""!==u)Object(o.addPseudoColorLayer)(t,c);else if(!0===t.image.color)Object(a.addColorLayer)(t,c);else{var d=0===r;Object(i.addGrayscaleLayer)(t,c,d)}e.globalAlpha=t.options&&t.options.opacity?t.options.opacity:1,t.options&&t.options.fillStyle&&(e.fillStyle=t.options.fillStyle),e.imageSmoothingEnabled=!t.viewport.pixelReplication,e.mozImageSmoothingEnabled=e.imageSmoothingEnabled;var h=t.viewport.displayedArea.tlhc.x-1,f=t.viewport.displayedArea.tlhc.y-1,p=t.viewport.displayedArea.brhc.x-h,m=t.viewport.displayedArea.brhc.y-f;e.drawImage(t.canvas,h,f,p,m,0,0,p,m),e.restore(),t.invalid=!1}}))}(p,h,t)}},"./internal/drawImage.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.needsRedraw=!0,t&&(e.invalid=!0)}},"./internal/drawImageSync.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/now.js"),i=n("./internal/drawCompositeImage.js"),a=n("./rendering/renderColorImage.js"),o=n("./rendering/renderGrayscaleImage.js"),s=n("./rendering/renderPseudoColorImage.js"),l=n("./rendering/renderLabelMapImage.js"),u=n("./triggerEvent.js"),c=n("./events.js");t.default=function(e,t){var n=e.image,d=e.element,h=e.layers||[];if(e.canvas&&(e.image||h.length)){var f=Object(r.default)();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},h&&h.length)Object(i.default)(e,t);else if(n){var p=n.render;p||(p=e.viewport.colormap&&""!==e.viewport.colormap&&!0===e.image.labelmap?l.renderLabelMapImage:e.viewport.colormap&&""!==e.viewport.colormap?s.renderPseudoColorImage:n.color?a.renderColorImage:o.renderGrayscaleImage),p(e,t)}var m=Object(r.default)()-f,g={viewport:e.viewport,element:d,image:n,enabledElement:e,canvasContext:e.canvas.getContext("2d"),renderTimeInMs:m};n.stats.lastRenderTime=m,e.invalid=!1,e.needsRedraw=!1,Object(u.default)(d,c.default.IMAGE_RENDERED,g)}}},"./internal/generateColorLut.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/getVOILut.js");t.default=function(e,t,n,i,a){var o=e.maxPixelValue,s=e.minPixelValue,l=Math.min(s,0);if(void 0===e.cachedLut){var u=o-l+1;e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(u)}var c=e.cachedLut.lutArray,d=Object(r.default)(t,n,a);if(!0===i)for(var h=s;h<=o;h++)c[h+-l]=255-d(h);else for(var f=s;f<=o;f++)c[f+-l]=d(f);return c}},"./internal/generateLut.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/getModalityLUT.js"),i=n("./internal/getVOILut.js");t.default=function(e,t,n,a,o,s){var l=e.maxPixelValue,u=e.minPixelValue,c=Math.min(u,0);if(void 0===e.cachedLut){var d=l-c+1;e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(d)}var h=e.cachedLut.lutArray,f=Object(r.default)(e.slope,e.intercept,o),p=Object(i.default)(t,n,s);if(!0===a)for(var m=u;m<=l;m++)h[m+-c]=255-p(f(m));else for(var g=u;g<=l;g++)h[g+-c]=p(f(g));return h}},"./internal/getCanvas.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r="cornerstone-canvas";function i(e){var t="canvas.".concat(r);return e.querySelector(t)||function(e){var t=document.createElement("canvas");return t.style.display="block",t.classList.add(r),e.appendChild(t),t}(e)}},"./internal/getDefaultViewport.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/createViewport.js"),i=n("./internal/getImageFitScale.js");t.default=function(e,t){if(void 0===e)throw new Error("getDefaultViewport: parameter canvas must not be undefined");return void 0===t?Object(r.default)():{scale:Object(i.default)(e,t,0).scaleFactor,translation:{x:0,y:0},voi:{windowWidth:t.windowWidth,windowCenter:t.windowCenter},invert:t.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:t.modalityLUT,voiLUT:t.voiLUT,colormap:t.colormap,labelmap:Boolean(t.labelmap),displayedArea:{tlhc:{x:1,y:1},brhc:{x:t.columns,y:t.rows},rowPixelSpacing:void 0===t.rowPixelSpacing?1:t.rowPixelSpacing,columnPixelSpacing:void 0===t.columnPixelSpacing?1:t.columnPixelSpacing,presentationSizeMode:"NONE"}}}},"./internal/getImageFitScale.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/validator.js"),i=n("./internal/getImageSize.js");t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(r.validateParameterUndefinedOrNull)(e,"getImageScale: parameter windowSize must not be undefined"),Object(r.validateParameterUndefinedOrNull)(t,"getImageScale: parameter image must not be undefined");var a=Object(i.default)(t,n),o=t.rowPixelSpacing||1,s=t.columnPixelSpacing||1,l=1,u=1;o<s?u=s/o:l=o/s;var c=e.height/a.height/l,d=e.width/a.width/u;return{verticalScale:c,horizontalScale:d,scaleFactor:Math.min(d,c)}}},"./internal/getImageSize.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/validator.js");function i(e){return!(null==e||0===e||180===e)}t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Object(r.validateParameterUndefinedOrNull)(e,"getImageSize: parameter image must not be undefined"),Object(r.validateParameterUndefinedOrNull)(e.width,"getImageSize: parameter image must have width"),Object(r.validateParameterUndefinedOrNull)(e.height,"getImageSize: parameter image must have height"),i(t)?{height:e.width,width:e.height}:{width:e.width,height:e.height}}},"./internal/getModalityLUT.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){return n?function(e){var t=e.lut[0],n=e.lut[e.lut.length-1],r=e.firstValueMapped+e.lut.length;return function(i){return i<e.firstValueMapped?t:i>=r?n:e.lut[i]}}(n):function(e,t){return function(n){return n*e+t}}(e,t)}},"./internal/getTransform.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/calculateTransform.js");t.default=function(e){return Object(r.default)(e)}},"./internal/getVOILut.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){return n?function(e){var t,n=Math.max.apply(Math,(t=e.lut,function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(t)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}())).toString(2).length-8,r=e.lut[0]>>n,i=e.lut[e.lut.length-1]>>n,a=e.firstValueMapped+e.lut.length-1;return function(t){return t<e.firstValueMapped?r:t>=a?i:e.lut[t-e.firstValueMapped]>>n}}(n):function(e,t){return function(n){return 255*((n-t)/e+.5)}}(e,t)}},"./internal/guid.js":function(e,t,n){"use strict";function r(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}n.r(t),t.default=function(){return"".concat(r()+r(),"-").concat(r(),"-").concat(r(),"-").concat(r(),"-").concat(r()).concat(r()).concat(r())}},"./internal/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/transform.js"),i=n("./internal/calculateTransform.js"),a=n("./internal/drawImage.js"),o=n("./internal/generateLut.js"),s=n("./internal/getDefaultViewport.js"),l=n("./internal/getTransform.js"),u=n("./internal/requestAnimationFrame.js"),c=n("./internal/setDefaultViewport.js"),d=n("./internal/storedColorPixelDataToCanvasImageData.js"),h=n("./internal/storedPixelDataToCanvasImageData.js"),f=n("./internal/storedPixelDataToCanvasImageDataColorLUT.js"),p=n("./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js"),m=n("./internal/storedPixelDataToCanvasImageDataRGBA.js");t.default={drawImage:a.default,generateLut:o.default,getDefaultViewport:s.default,requestAnimationFrame:u.default,setDefaultViewport:c.default,storedPixelDataToCanvasImageData:h.default,storedPixelDataToCanvasImageDataRGBA:m.default,storedPixelDataToCanvasImageDataColorLUT:f.default,storedPixelDataToCanvasImageDataPseudocolorLUT:p.default,storedColorPixelDataToCanvasImageData:d.default,getTransform:l.default,calculateTransform:i.default,Transform:r.Transform}},"./internal/now.js":function(e,t,n){"use strict";n.r(t),t.default=function(){return window.performance?performance.now():Date.now()}},"./internal/requestAnimationFrame.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){return window.requestAnimationFrame(e)||window.webkitRequestAnimationFrame(e)||window.mozRequestAnimationFrame(e)||window.oRequestAnimationFrame(e)||window.msRequestAnimationFrame(e)||function(e){window.setTimeout(e,1e3/60)}(e)}},"./internal/setDefaultViewport.js":function(e,t,n){"use strict";n.r(t),n.d(t,"state",(function(){return r}));var r={viewport:{}};t.default=function(e){r.viewport=e||{}}},"./internal/storedColorPixelDataToCanvasImageData.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/now.js");t.default=function(e,t,n){var i=Object(r.default)(),a=e.getPixelData();e.stats.lastGetPixelDataTime=Object(r.default)()-i;var o=e.minPixelValue,s=0,l=0,u=a.length;if(i=Object(r.default)(),o<0)for(;l<u;)n[s++]=t[a[l++]+-o],n[s++]=t[a[l++]+-o],n[s]=t[a[l]+-o],l+=2,s+=2;else for(;l<u;)n[s++]=t[a[l++]],n[s++]=t[a[l++]],n[s]=t[a[l]],l+=2,s+=2;e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(r.default)()-i}},"./internal/storedPixelDataToCanvasImageData.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/now.js");t.default=function(e,t,n){var i=Object(r.default)(),a=e.getPixelData();e.stats.lastGetPixelDataTime=Object(r.default)()-i;var o=a.length,s=e.minPixelValue,l=3,u=0;if(i=Object(r.default)(),a instanceof Int16Array)if(s<0)for(;u<o;)n[l]=t[a[u++]+-s],l+=4;else for(;u<o;)n[l]=t[a[u++]],l+=4;else if(a instanceof Uint16Array)for(;u<o;)n[l]=t[a[u++]],l+=4;else if(s<0)for(;u<o;)n[l]=t[a[u++]+-s],l+=4;else for(;u<o;)n[l]=t[a[u++]],l+=4;e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(r.default)()-i}},"./internal/storedPixelDataToCanvasImageDataColorLUT.js":function(e,t,n){"use strict";n.r(t);var r=n("./colors/index.js"),i=n("./internal/now.js");t.default=function(e,t,n){var a=Object(i.default)(),o=e.getPixelData();e.stats.lastGetPixelDataTime=Object(i.default)()-a;var s,l,u=o.length,c=e.minPixelValue,d=0,h=0;if(a=Object(i.default)(),l=t instanceof r.default.LookupTable?t.Table:t,c<0)for(;h<u;)s=l[o[h++]+-c],n[d++]=s[0],n[d++]=s[1],n[d++]=s[2],n[d++]=s[3];else for(;h<u;)s=l[o[h++]],n[d++]=s[0],n[d++]=s[1],n[d++]=s[2],n[d++]=s[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(i.default)()-a}},"./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js":function(e,t,n){"use strict";n.r(t);var r=n("./colors/index.js"),i=n("./internal/now.js");t.default=function(e,t,n,a){var o=Object(i.default)(),s=e.getPixelData();e.stats.lastGetPixelDataTime=Object(i.default)()-o;var l,u,c,d=s.length,h=e.minPixelValue,f=0,p=0;if(o=Object(i.default)(),c=n instanceof r.default.LookupTable?n.Table:n,h<0)for(;p<d;)l=t[s[p++]+-h],a[f++]=(u=c[l])[0],a[f++]=u[1],a[f++]=u[2],a[f++]=u[3];else for(;p<d;)l=t[s[p++]],a[f++]=(u=c[l])[0],a[f++]=u[1],a[f++]=u[2],a[f++]=u[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(i.default)()-o}},"./internal/storedPixelDataToCanvasImageDataRGBA.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/now.js");t.default=function(e,t,n){var i=Object(r.default)(),a=e.getPixelData();e.stats.lastGetPixelDataTime=Object(r.default)()-i;var o,s=a.length,l=e.minPixelValue,u=0,c=0;if(i=Object(r.default)(),a instanceof Int16Array)if(l<0)for(;c<s;)o=t[a[c++]+-l],n[u++]=o,n[u++]=o,n[u++]=o,n[u++]=255;else for(;c<s;)o=t[a[c++]],n[u++]=o,n[u++]=o,n[u++]=o,n[u++]=255;else if(a instanceof Uint16Array)for(;c<s;)o=t[a[c++]],n[u++]=o,n[u++]=o,n[u++]=o,n[u++]=255;else if(l<0)for(;c<s;)o=t[a[c++]+-l],n[u++]=o,n[u++]=o,n[u++]=o,n[u++]=255;else for(;c<s;)o=t[a[c++]],n[u++]=o,n[u++]=o,n[u++]=o,n[u++]=255;e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(r.default)()-i}},"./internal/storedRGBAPixelDataToCanvasImageData.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/now.js");t.default=function(e,t,n){var i=Object(r.default)(),a=e.getPixelData();e.stats.lastGetPixelDataTime=Object(r.default)()-i;var o=e.minPixelValue,s=0,l=0,u=a.length;if(i=Object(r.default)(),o<0)for(;l<u;)n[s++]=t[a[l++]+-o],n[s++]=t[a[l++]+-o],n[s++]=t[a[l++]+-o],n[s++]=a[l++];else for(;l<u;)n[s++]=t[a[l++]],n[s++]=t[a[l++]],n[s++]=t[a[l++]],n[s++]=a[l++];e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(r.default)()-i}},"./internal/transform.js":function(e,t,n){"use strict";n.r(t),n.d(t,"Transform",(function(){return r}));var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.reset()}var t;return(t=[{key:"reset",value:function(){this.m=[1,0,0,1,0,0]}},{key:"clone",value:function(){var t=new e;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t}},{key:"multiply",value:function(e){var t=this.m[1]*e.m[0]+this.m[3]*e.m[1],n=this.m[0]*e.m[2]+this.m[2]*e.m[3],r=this.m[1]*e.m[2]+this.m[3]*e.m[3],i=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],a=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];this.m[0]=this.m[0]*e.m[0]+this.m[2]*e.m[1],this.m[1]=t,this.m[2]=n,this.m[3]=r,this.m[4]=i,this.m[5]=a}},{key:"invert",value:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=-this.m[1]*e,n=-this.m[2]*e,r=this.m[0]*e,i=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),a=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=this.m[3]*e,this.m[1]=t,this.m[2]=n,this.m[3]=r,this.m[4]=i,this.m[5]=a}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.m[1]*t+this.m[3]*n,i=this.m[0]*-n+this.m[2]*t,a=this.m[1]*-n+this.m[3]*t;this.m[0]=this.m[0]*t+this.m[2]*n,this.m[1]=r,this.m[2]=i,this.m[3]=a}},{key:"translate",value:function(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}},{key:"scale",value:function(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}},{key:"transformPoint",value:function(e,t){var n=e;return{x:e=n*this.m[0]+t*this.m[2]+this.m[4],y:t=n*this.m[1]+t*this.m[3]+this.m[5]}}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}()},"./internal/tryEnableWebgl.js":function(e,t,n){"use strict";n.r(t);var r=n("./webgl/index.js");t.default=function(e){return r.default.renderer.isWebGLAvailable()?(r.default.renderer.initRenderer(),e.renderer="webgl",!0):(console.error("WebGL not available, falling back to Canvas renderer"),delete e.renderer,!1)}},"./internal/validator.js":function(e,t,n){"use strict";function r(e,t){if(void 0===e)throw new Error(t)}function i(e,t){if(null==e)throw new Error(t)}n.r(t),n.d(t,"validateParameterUndefined",(function(){return r})),n.d(t,"validateParameterUndefinedOrNull",(function(){return i}))},"./invalidate.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./triggerEvent.js"),a=n("./events.js");t.default=function(e){var t=Object(r.getEnabledElement)(e);t.invalid=!0,t.needsRedraw=!0;var n={element:e};Object(i.default)(e,a.default.INVALIDATED,n)}},"./invalidateImageId.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/drawImage.js");t.default=function(e){Object(r.getEnabledElementsByImageId)(e).forEach((function(e){Object(i.default)(e,!0)}))}},"./layers.js":function(e,t,n){"use strict";n.r(t),n.d(t,"rescaleImage",(function(){return c})),n.d(t,"addLayer",(function(){return d})),n.d(t,"removeLayer",(function(){return h})),n.d(t,"getLayer",(function(){return f})),n.d(t,"getLayers",(function(){return p})),n.d(t,"getVisibleLayers",(function(){return m})),n.d(t,"setActiveLayer",(function(){return g})),n.d(t,"setLayerImage",(function(){return v})),n.d(t,"getActiveLayer",(function(){return y})),n.d(t,"purgeLayers",(function(){return b}));var r=n("./internal/guid.js"),i=n("./enabledElements.js"),a=n("./internal/getDefaultViewport.js"),o=n("./updateImage.js"),s=n("./triggerEvent.js"),l=n("./events.js");function u(e,t,n){var r=t.element,i={viewport:t.viewport,element:t.element,image:t.image,enabledElement:t,layerId:n};Object(s.default)(r,e,i)}function c(e,t){if(e.layerId===t.layerId)throw new Error("rescaleImage: both arguments represent the same layer");var n=e.image,r=t.image;n.imageId&&r.imageId&&(t.viewport.scale=e.viewport.scale*(t.viewport.scale/e.viewport.scale*(t.viewport.displayedArea.columnPixelSpacing*r.width/(e.viewport.displayedArea.columnPixelSpacing*n.width))))}function d(e,t,n){var o,s=Object(r.default)(),d=Object(i.getEnabledElement)(e),h=d.layers;t&&(o=Object(a.default)(d.canvas,t),n&&n.viewport&&(o=Object.assign(o,n.viewport))),!1!==d.syncViewports&&(d.syncViewports=!0);var f={image:t,layerId:s,viewport:o,options:n||{},renderingTools:{}};return h.length&&t&&c(h[0],f),h.push(f),u(l.default.LAYER_ADDED,d,s),1===h.length&&t&&g(e,s),s}function h(e,t){var n=Object(i.getEnabledElement)(e),r=n.layers,a=n.layers.findIndex((function(e){return e.layerId===t}));-1!==a&&(r.splice(a,1),t===n.activeLayerId&&r.length&&g(e,r[0].layerId),u(l.default.LAYER_REMOVED,n,t))}function f(e,t){return Object(i.getEnabledElement)(e).layers.find((function(e){return e.layerId===t}))}function p(e){return Object(i.getEnabledElement)(e).layers}function m(e){return Object(i.getEnabledElement)(e).layers.filter((function(e){return e.options&&!1!==e.options.visible&&0!==e.options.opacity}))}function g(e,t){var n=Object(i.getEnabledElement)(e);if(n.activeLayerId!==t){var r=n.layers.findIndex((function(e){return e.layerId===t}));if(-1===r)throw new Error("setActiveLayer: layer not found in layers array");var a=n.layers[r];if(!a.image)throw new Error("setActiveLayer: layer with undefined image cannot be set as active.");n.activeLayerId=t,n.image=a.image,n.viewport=a.viewport,Object(o.default)(e),u(l.default.ACTIVE_LAYER_CHANGED,n,t)}}function v(e,t,n){var r,o=Object(i.getEnabledElement)(e),s=o.layers[0];if(!(r=n?f(e,n):y(e)))throw new Error("setLayerImage: Layer not found");if(r.image=t,t){if(!r.viewport){var l=Object(a.default)(o.canvas,t);r.options&&r.options.viewport&&(r.viewport=Object.assign(l,r.options.viewport)),s.layerId!==n&&c(s,r)}}else r.viewport=void 0}function y(e){var t=Object(i.getEnabledElement)(e);return t.layers.find((function(e){return e.layerId===t.activeLayerId}))}function b(e){var t=Object(i.getEnabledElement)(e);t.layers=[],delete t.activeLayerId,delete t.lastSyncViewportsState}},"./metaData.js":function(e,t,n){"use strict";n.r(t),n.d(t,"addProvider",(function(){return i})),n.d(t,"removeProvider",(function(){return a}));var r=[];function i(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(t=0;t<r.length&&!(r[t].priority<=n);t++);r.splice(t,0,{priority:n,provider:e})}function a(e){for(var t=0;t<r.length;t++)if(r[t].provider===e){r.splice(t,1);break}}t.default={addProvider:i,removeProvider:a,get:function(e,t){for(var n=0;n<r.length;n++){var i=r[n].provider(e,t);if(void 0!==i)return i}}}},"./pageToPixel.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/getTransform.js");t.default=function(e,t,n){var a=Object(r.getEnabledElement)(e);if(void 0===a.image)throw new Error("image has not been loaded yet");var o=e.getBoundingClientRect(),s={x:t-o.left-window.pageXOffset,y:n-o.top-window.pageYOffset},l=Object(i.default)(a);return l.invert(),l.transformPoint(s.x,s.y)}},"./pixelDataToFalseColorData.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./colors/index.js");function i(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");var n,i,a=e.minPixelValue,o=0,s=0,l=e.width*e.height,u=e.origPixelData||e.getPixelData(),c=new Uint8Array(4*l);if(e.color=!0,e.falseColor=!0,e.origPixelData=u,t instanceof r.default.LookupTable)for(t.build();s<l;)n=u[s++],i=t.mapValue(n),c[o++]=i[0],c[o++]=i[1],c[o++]=i[2],c[o++]=i[3];else if(a<0)for(;s<l;)n=u[s++],c[o++]=t[n+-a][0],c[o++]=t[n+-a][1],c[o++]=t[n+-a][2],c[o++]=t[n+-a][3];else for(;s<l;)n=u[s++],c[o++]=t[n][0],c[o++]=t[n][1],c[o++]=t[n][2],c[o++]=t[n][3];e.rgba=!0,e.cachedLut=void 0,e.render=void 0,e.slope=1,e.intercept=0,e.minPixelValue=0,e.maxPixelValue=255,e.windowWidth=255,e.windowCenter=128,e.getPixelData=function(){return c}}},"./pixelToCanvas.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/getTransform.js");t.default=function(e,t){var n=Object(r.getEnabledElement)(e);return Object(i.default)(n).transformPoint(t.x,t.y)}},"./rendering/doesImageNeedToBeRendered.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=e.renderingTools.lastRenderedViewport;return t.imageId!==e.renderingTools.lastRenderedImageId||!n||n.windowCenter!==e.viewport.voi.windowCenter||n.windowWidth!==e.viewport.voi.windowWidth||n.invert!==e.viewport.invert||n.rotation!==e.viewport.rotation||n.hflip!==e.viewport.hflip||n.vflip!==e.viewport.vflip||n.modalityLUT!==e.viewport.modalityLUT||n.voiLUT!==e.viewport.voiLUT||n.colormap!==e.viewport.colormap}},"./rendering/getLut.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/computeAutoVoi.js"),i=n("./rendering/lutMatches.js"),a=n("./internal/generateLut.js");t.default=function(e,t,n){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&Object(i.default)(e.cachedLut.modalityLUT,t.modalityLUT)&&Object(i.default)(e.cachedLut.voiLUT,t.voiLUT)&&e.cachedLut.invert===t.invert&&!0!==n||(Object(r.default)(t,e),Object(a.default)(e,t.voi.windowWidth,t.voi.windowCenter,t.invert,t.modalityLUT,t.voiLUT),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert,e.cachedLut.voiLUT=t.voiLUT,e.cachedLut.modalityLUT=t.modalityLUT),e.cachedLut.lutArray}},"./rendering/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./rendering/renderColorImage.js"),i=n("./rendering/renderGrayscaleImage.js"),a=n("./rendering/renderWebImage.js"),o=n("./rendering/renderPseudoColorImage.js"),s=n("./rendering/renderLabelMapImage.js"),l=n("./rendering/renderToCanvas.js");t.default={colorImage:r.renderColorImage,grayscaleImage:i.renderGrayscaleImage,webImage:a.renderWebImage,pseudoColorImage:o.renderPseudoColorImage,labelMapImage:s.renderLabelMapImage,toCanvas:l.default}},"./rendering/initializeRenderCanvas.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=e.renderingTools.renderCanvas;n.width=t.width,n.height=t.height;var r=n.getContext("2d");r.fillStyle="white",r.fillRect(0,0,n.width,n.height);var i=r.getImageData(0,0,t.width,t.height);e.renderingTools.renderCanvasContext=r,e.renderingTools.renderCanvasData=i}},"./rendering/lutMatches.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){return!e&&!t||!(!e||!t)&&e.id===t.id}},"./rendering/renderColorImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"renderColorImage",(function(){return f})),n.d(t,"addColorLayer",(function(){return p}));var r=n("./internal/now.js"),i=n("./internal/generateColorLut.js"),a=n("./internal/storedColorPixelDataToCanvasImageData.js"),o=n("./internal/storedRGBAPixelDataToCanvasImageData.js"),s=n("./setToPixelCoordinateSystem.js"),l=n("./webgl/index.js"),u=n("./rendering/doesImageNeedToBeRendered.js"),c=n("./rendering/initializeRenderCanvas.js"),d=n("./rendering/saveLastRendered.js");function h(e,t,n){e.renderingTools.renderCanvas&&!0===e.renderingTools.lastRenderedIsColor||(e.renderingTools.renderCanvas=document.createElement("canvas"));var s=e.renderingTools.renderCanvas;if(255===e.viewport.voi.windowWidth&&128===e.viewport.voi.windowCenter&&!1===e.viewport.invert&&t.getCanvas&&t.getCanvas())return t.getCanvas();if(!1===Object(u.default)(e,t)&&!0!==n)return s;s.width===t.width&&s.height===t.height||Object(c.default)(e,t);var l=Object(r.default)(),d=function(e,t){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&e.cachedLut.invert===t.invert||(Object(i.default)(e,t.voi.windowWidth,t.voi.windowCenter,t.invert),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert),e.cachedLut.lutArray}(t,e.viewport);t.stats=t.stats||{},t.stats.lastLutGenerateTime=Object(r.default)()-l;var h=e.renderingTools.renderCanvasData,f=e.renderingTools.renderCanvasContext;return t.rgba?Object(o.default)(t,d,h.data):Object(a.default)(t,d,h.data),l=Object(r.default)(),f.putImageData(h,0,0),t.stats.lastPutImageDataTime=Object(r.default)()-l,s}function f(e,t){if(void 0===e)throw new Error("renderColorImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("renderColorImage: image must be loaded before it can be drawn");var r,i=e.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0),i.fillStyle="black",i.fillRect(0,0,e.canvas.width,e.canvas.height),i.imageSmoothingEnabled=!e.viewport.pixelReplication,i.mozImageSmoothingEnabled=i.imageSmoothingEnabled,Object(s.default)(e,i),r=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?l.default.renderer.render(e):h(e,n,t);var a=e.viewport.displayedArea.tlhc.x-1,o=e.viewport.displayedArea.tlhc.y-1,u=e.viewport.displayedArea.brhc.x-a,c=e.viewport.displayedArea.brhc.y-o;i.drawImage(r,a,o,u,c,0,0,u,c),e.renderingTools=Object(d.default)(e)}function p(e,t){if(void 0===e)throw new Error("addColorLayer: layer parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("addColorLayer: image must be loaded before it can be drawn");n.rgba=!0,e.canvas=h(e,n,t);var r=e.canvas.getContext("2d");r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,e.renderingTools=Object(d.default)(e)}},"./rendering/renderGrayscaleImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"renderGrayscaleImage",(function(){return f})),n.d(t,"addGrayscaleLayer",(function(){return p}));var r=n("./internal/storedPixelDataToCanvasImageData.js"),i=n("./internal/storedPixelDataToCanvasImageDataRGBA.js"),a=n("./setToPixelCoordinateSystem.js"),o=n("./internal/now.js"),s=n("./webgl/index.js"),l=n("./rendering/getLut.js"),u=n("./rendering/doesImageNeedToBeRendered.js"),c=n("./rendering/initializeRenderCanvas.js"),d=n("./rendering/saveLastRendered.js");function h(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=!0===e.renderingTools.lastRenderedIsColor;e.renderingTools.renderCanvas&&!s||(e.renderingTools.renderCanvas=document.createElement("canvas"),Object(c.default)(e,t));var d=e.renderingTools.renderCanvas;if(!1===Object(u.default)(e,t)&&!0!==n)return d;d.width===t.width&&d.height===t.height||Object(c.default)(e,t);var h=Object(o.default)(),f=Object(l.default)(t,e.viewport,n);t.stats=t.stats||{},t.stats.lastLutGenerateTime=Object(o.default)()-h;var p=e.renderingTools.renderCanvasData,m=e.renderingTools.renderCanvasContext;return a?Object(r.default)(t,f,p.data):Object(i.default)(t,f,p.data),h=Object(o.default)(),m.putImageData(p,0,0),t.stats.lastPutImageDataTime=Object(o.default)()-h,d}function f(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");var r,i=e.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0),i.fillStyle="black",i.fillRect(0,0,e.canvas.width,e.canvas.height),i.imageSmoothingEnabled=!e.viewport.pixelReplication,i.mozImageSmoothingEnabled=i.imageSmoothingEnabled,Object(a.default)(e,i),r=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?s.default.renderer.render(e):h(e,n,t);var o=e.viewport.displayedArea.tlhc.x-1,l=e.viewport.displayedArea.tlhc.y-1,u=e.viewport.displayedArea.brhc.x-o,c=e.viewport.displayedArea.brhc.y-l;i.drawImage(r,o,l,u,c,0,0,u,c),e.renderingTools=Object(d.default)(e)}function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===e)throw new Error("addGrayscaleLayer: layer parameter must not be undefined");var r=e.image;if(void 0===r)throw new Error("addGrayscaleLayer: image must be loaded before it can be drawn");e.canvas=h(e,r,t,n);var i=e.canvas.getContext("2d");i.imageSmoothingEnabled=!e.viewport.pixelReplication,i.mozImageSmoothingEnabled=i.imageSmoothingEnabled,e.renderingTools=Object(d.default)(e)}},"./rendering/renderLabelMapImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"renderLabelMapImage",(function(){return d})),n.d(t,"addLabelMapLayer",(function(){return h}));var r=n("./setToPixelCoordinateSystem.js"),i=n("./internal/now.js"),a=n("./rendering/initializeRenderCanvas.js"),o=n("./rendering/saveLastRendered.js"),s=n("./rendering/doesImageNeedToBeRendered.js"),l=n("./internal/storedPixelDataToCanvasImageDataColorLUT.js"),u=n("./colors/index.js");function c(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));var r=e.renderingTools.renderCanvas,o=e.viewport.colormap||e.options.colormap;if(e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),o&&"string"==typeof o&&(o=u.default.getColormap(o)),!o)throw new Error("renderLabelMapImage: colormap not found.");var c=o.getId();if(!1===Object(s.default)(e,t)&&!0!==n&&e.renderingTools.colormapId===c)return r;r.width===t.width&&r.height===t.height||Object(a.default)(e,t);var d=Object(i.default)();e.renderingTools.colorLut&&!n&&e.renderingTools.colormapId===c||(e.renderingTools.colorLut=o.createLookupTable(),e.renderingTools.colormapId=c),t.stats=t.stats||{},t.stats.lastLutGenerateTime=Object(i.default)()-d;var h=e.renderingTools.colorLut,f=e.renderingTools.renderCanvasData,p=e.renderingTools.renderCanvasContext;return Object(l.default)(t,h,f.data),d=Object(i.default)(),p.putImageData(f,0,0),t.stats.lastPutImageDataTime=Object(i.default)()-d,r}function d(e,t){if(void 0===e)throw new Error("renderLabelMapImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("renderLabelMapImage: image must be loaded before it can be drawn");var i=e.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0),i.fillStyle="black",i.fillRect(0,0,e.canvas.width,e.canvas.height),i.imageSmoothingEnabled=!e.viewport.pixelReplication,i.mozImageSmoothingEnabled=i.imageSmoothingEnabled,Object(r.default)(e,i);var a=c(e,n,t),s=e.viewport.displayedArea.tlhc.x-1,l=e.viewport.displayedArea.tlhc.y-1,u=e.viewport.displayedArea.brhc.x-s,d=e.viewport.displayedArea.brhc.y-l;i.drawImage(a,s,l,u,d,0,0,u,d),e.renderingTools=Object(o.default)(e)}function h(e,t){if(void 0===e)throw new Error("addLabelMapLayer: layer parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("addLabelMapLayer: image must be loaded before it can be drawn");e.canvas=c(e,n,t);var r=e.canvas.getContext("2d");r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,e.renderingTools=Object(o.default)(e)}},"./rendering/renderPseudoColorImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"renderPseudoColorImage",(function(){return h})),n.d(t,"addPseudoColorLayer",(function(){return f}));var r=n("./setToPixelCoordinateSystem.js"),i=n("./internal/now.js"),a=n("./rendering/initializeRenderCanvas.js"),o=n("./rendering/getLut.js"),s=n("./rendering/saveLastRendered.js"),l=n("./rendering/doesImageNeedToBeRendered.js"),u=n("./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js"),c=n("./colors/index.js");function d(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));var r=e.renderingTools.renderCanvas,s=e.viewport.colormap||e.options.colormap;if(e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),s&&"string"==typeof s&&(s=c.default.getColormap(s)),!s)throw new Error("renderPseudoColorImage: colormap not found.");var d=s.getId();if(!1===Object(l.default)(e,t)&&!0!==n&&e.renderingTools.colormapId===d)return r;r.width===t.width&&r.height===t.height||Object(a.default)(e,t);var h=Object(i.default)();e.renderingTools.colorLut&&!n&&e.renderingTools.colormapId===d||(s.setNumberOfColors(256),e.renderingTools.colorLut=s.createLookupTable(),e.renderingTools.colormapId=d);var f=Object(o.default)(t,e.viewport,n);t.stats=t.stats||{},t.stats.lastLutGenerateTime=Object(i.default)()-h;var p=e.renderingTools.colorLut,m=e.renderingTools.renderCanvasData,g=e.renderingTools.renderCanvasContext;return Object(u.default)(t,f,p,m.data),h=Object(i.default)(),g.putImageData(m,0,0),t.stats.lastPutImageDataTime=Object(i.default)()-h,r}function h(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");var i=e.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0),i.fillStyle="black",i.fillRect(0,0,e.canvas.width,e.canvas.height),i.imageSmoothingEnabled=!e.viewport.pixelReplication,i.mozImageSmoothingEnabled=i.imageSmoothingEnabled,Object(r.default)(e,i);var a=d(e,n,t),o=e.viewport.displayedArea.tlhc.x-1,l=e.viewport.displayedArea.tlhc.y-1,u=e.viewport.displayedArea.brhc.x-o,c=e.viewport.displayedArea.brhc.y-l;i.drawImage(a,o,l,u,c,0,0,u,c),e.renderingTools=Object(s.default)(e)}function f(e,t){if(void 0===e)throw new Error("addPseudoColorLayer: layer parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("addPseudoColorLayer: image must be loaded before it can be drawn");e.canvas=d(e,n,t);var r=e.canvas.getContext("2d");r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,e.renderingTools=Object(s.default)(e)}},"./rendering/renderToCanvas.js":function(e,t,n){"use strict";n.r(t);var r=n("./triggerEvent.js"),i=n("./events.js"),a=n("./internal/drawImageSync.js"),o=n("./internal/getDefaultViewport.js"),s=n("./internal/tryEnableWebgl.js");function l(e,t,n,r){return{element:e,canvas:e,image:t,invalid:!0,needsRedraw:!0,options:n,layers:[],data:{},renderingTools:{},viewport:r}}t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(void 0===e)throw new Error("renderToCanvas: parameter canvas cannot be undefined");u&&u.renderer&&"webgl"===u.renderer.toLowerCase()&&Object(s.default)(u);var c=Object(o.default)(e,t);n&&Object.assign(c,n);var d=l(e,t,u,c),h={enabledElement:d,timestamp:Date.now()};Object(r.default)(d.element,i.default.PRE_RENDER,h),Object(a.default)(d,d.invalid)}},"./rendering/renderWebImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"renderWebImage",(function(){return a}));var r=n("./setToPixelCoordinateSystem.js"),i=n("./rendering/renderColorImage.js");function a(e,t){if(void 0===e)throw new Error("renderWebImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("renderWebImage: image must be loaded before it can be drawn");if(e.viewport.voi.windowWidth===e.image.windowWidth&&e.viewport.voi.windowCenter===e.image.windowCenter&&!1===e.viewport.invert){var a=e.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0),a.fillStyle="black",a.fillRect(0,0,e.canvas.width,e.canvas.height),a.imageSmoothingEnabled=!e.viewport.pixelReplication,a.mozImageSmoothingEnabled=a.imageSmoothingEnabled,Object(r.default)(e,a);var o=e.viewport.displayedArea.tlhc.x-1,s=e.viewport.displayedArea.tlhc.y-1,l=e.viewport.displayedArea.brhc.x-o,u=e.viewport.displayedArea.brhc.y-s;a.drawImage(n.getImage(),o,s,l,u,0,0,l,u)}else Object(i.renderColorImage)(e,t)}},"./rendering/saveLastRendered.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=e.viewport,n=e.image.color;return e.renderingTools.lastRenderedImageId=e.image.imageId,e.renderingTools.lastRenderedIsColor=n,e.renderingTools.lastRenderedViewport={windowCenter:t.voi.windowCenter,windowWidth:t.voi.windowWidth,invert:t.invert,rotation:t.rotation,hflip:t.hflip,vflip:t.vflip,modalityLUT:t.modalityLUT,voiLUT:t.voiLUT,colormap:t.colormap},e.renderingTools}},"./reset.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/getDefaultViewport.js"),i=n("./enabledElements.js"),a=n("./updateImage.js");t.default=function(e){var t=Object(i.getEnabledElement)(e);t.viewport=Object(r.default)(t.canvas,t.image),Object(a.default)(e)}},"./resize.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./fitToWindow.js"),a=n("./updateImage.js"),o=n("./triggerEvent.js"),s=n("./internal/getImageSize.js"),l=n("./events.js");t.default=function(e,t){var n=Object(r.getEnabledElement)(e),u=n.canvas.width,c=n.canvas.height;!function(e,t){t.width!==e.clientWidth&&(t.width=e.clientWidth,t.style.width="".concat(e.clientWidth,"px")),t.height!==e.clientHeight&&(t.height=e.clientHeight,t.style.height="".concat(e.clientHeight,"px"))}(e,n.canvas);var d={element:e};Object(o.default)(e,l.default.ELEMENT_RESIZED,d),void 0!==n.image&&(t||function(e,t,n){var r=e.viewport.scale,i=Object(s.default)(e.image,e.viewport.rotation),a=Math.round(i.width*r),o=Math.round(i.height*r);return a===t&&o<=n||a<=t&&o===n&&0===e.viewport.translation.x&&0===e.viewport.translation.y}(n,u,c)?Object(i.default)(e):(function(e,t,n){var r=e.viewport.scale,i=Math.sqrt(e.canvas.width/t*(e.canvas.height/n));e.viewport.scale=i*r}(n,u,c),Object(a.default)(e)))}},"./setToPixelCoordinateSystem.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/calculateTransform.js");t.default=function(e,t,n){if(void 0===e)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(void 0===t)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");var i=Object(r.default)(e,n);t.setTransform(i.m[0],i.m[1],i.m[2],i.m[3],i.m[4],i.m[5])}},"./setViewport.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/getDefaultViewport.js"),i=n("./enabledElements.js"),a=n("./updateImage.js");t.default=function(e,t){var n=Object(i.getEnabledElement)(e);if(void 0===n.viewport&&(n.viewport=Object(r.default)(n.canvas)),t)for(var o in t)null!==t[o]&&(n.viewport[o]=t[o]);n.viewport.voi.windowWidth&&(n.viewport.voi.windowWidth=Math.max(t.voi.windowWidth,1e-6)),n.viewport.scale&&(n.viewport.scale=Math.max(t.scale,1e-4)),n.viewport.rotation%=360,n.viewport.rotation<0&&(n.viewport.rotation+=360),n.image&&Object(a.default)(e)}},"./triggerEvent.js":function(e,t,n){"use strict";function r(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:r,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,r),e.dispatchEvent(n)}n.r(t),n.d(t,"default",(function(){return r}))},"./updateImage.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/drawImage.js");t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(r.getEnabledElement)(e);if(void 0===n.image&&!n.layers.length)throw new Error("updateImage: image has not been loaded yet");Object(i.default)(n,t)}},"./webgl/createProgramFromString.js":function(e,t,n){"use strict";function r(e,t,n){var r=e.createShader(n);if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)&&!e.isContextLost()){var i=e.getShaderInfoLog(r);console.error("Could not compile shader:\n".concat(i))}return r}n.r(t),t.default=function(e,t,n){return function(e,t,n){var r=e.createProgram();if(e.attachShader(r,t),e.attachShader(r,n),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS)&&!e.isContextLost()){var i=e.getProgramInfoLog(r);console.error("WebGL program filed to link:\n".concat(i))}return r}(e,r(e,t,e.VERTEX_SHADER),r(e,n,e.FRAGMENT_SHADER))}},"./webgl/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./webgl/renderer.js"),i=n("./webgl/createProgramFromString.js"),a=n("./webgl/textureCache.js"),o={createProgramFromString:i.default,renderer:{render:r.render,initRenderer:r.initRenderer,getRenderCanvas:r.getRenderCanvas,isWebGLAvailable:r.isWebGLAvailable},textureCache:a.default};Object.defineProperty(o,"isWebGLInitialized",{enumerable:!0,configurable:!1,get:function(){return r.isWebGLInitialized}}),t.default=o},"./webgl/renderer.js":function(e,t,n){"use strict";n.r(t),n.d(t,"isWebGLInitialized",(function(){return d})),n.d(t,"getRenderCanvas",(function(){return h})),n.d(t,"initRenderer",(function(){return f})),n.d(t,"render",(function(){return v})),n.d(t,"isWebGLAvailable",(function(){return y}));var r,i,a,o=n("./webgl/shaders/index.js"),s=n("./webgl/vertexShader.js"),l=n("./webgl/textureCache.js"),u=n("./webgl/createProgramFromString.js"),c=document.createElement("canvas"),d=!1;function h(){return c}function f(){!0!==d&&function(e){r=null;try{var t={preserveDrawingBuffer:!0};r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),e.removeEventListener("webglcontextlost",p,!1),e.addEventListener("webglcontextlost",p,!1),e.removeEventListener("webglcontextrestored",m,!1),e.addEventListener("webglcontextrestored",m,!1)}catch(n){throw new Error("Error creating WebGL context")}return r||(console.error("Unable to initialize WebGL. Your browser may not support it."),r=null),r}(c)&&(a=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,a),r.bufferData(r.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),r.STATIC_DRAW),i=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,i),r.bufferData(r.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),r.STATIC_DRAW),function(){for(var e in o.shaders){var t=o.shaders[e];t.attributes={},t.uniforms={},t.vert=s.vertexShader,t.program=Object(u.default)(r,t.vert,t.frag),t.attributes.texCoordLocation=r.getAttribLocation(t.program,"a_texCoord"),r.enableVertexAttribArray(t.attributes.texCoordLocation),t.attributes.positionLocation=r.getAttribLocation(t.program,"a_position"),r.enableVertexAttribArray(t.attributes.positionLocation),t.uniforms.resolutionLocation=r.getUniformLocation(t.program,"u_resolution")}}(),d=!0)}function p(e){e.preventDefault(),console.warn("WebGL Context Lost!")}function m(e){e.preventDefault(),d=!1,l.default.purgeCache(),f()}function g(e){if(e.color)return"rgb";var t=e.getPixelData();return t instanceof Int16Array?"int16":t instanceof Uint16Array?"uint16":t instanceof Int8Array?"int8":"uint8"}function v(e){var t=e.image;c.width=t.width,c.height=t.height;var n=e.viewport,s=function(e){var t=g(e);return o.shaders.hasOwnProperty(t)?o.shaders[t]:o.shaders.rgb}(t),u=function(e){var t=l.default.getImageTexture(e.imageId);return t||(t=function(e){var t={uint8:r.LUMINANCE,int8:r.LUMINANCE_ALPHA,uint16:r.LUMINANCE_ALPHA,int16:r.RGB,rgb:r.RGB},n=g(e),i=t[n],a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.pixelStorei(r.UNPACK_ALIGNMENT,1);var s=o.dataUtilities[n].storedPixelDataToImageData(e,e.width,e.height);return r.texImage2D(r.TEXTURE_2D,0,i,e.width,e.height,0,i,r.UNSIGNED_BYTE,s),{texture:a,sizeInBytes:e.width*e.height*{int8:1,uint16:2,int16:3,rgb:3}[n]}}(e),l.default.putImageTexture(e,t)),t.texture}(t);return function(e,t,n,o,s){for(var l in r.clearColor(1,0,0,1),r.viewport(0,0,o,s),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.useProgram(e.program),r.bindBuffer(r.ARRAY_BUFFER,i),r.vertexAttribPointer(e.attributes.texCoordLocation,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,a),r.vertexAttribPointer(e.attributes.positionLocation,2,r.FLOAT,!1,0,0),t){var u=r.getUniformLocation(e.program,l);if(u){var c=t[l],d=c.type,h=c.value;"i"===d?r.uniform1i(u,h):"f"===d?r.uniform1f(u,h):"2f"===d&&r.uniform2f(u,h[0],h[1])}}!function(e,t,n){e.bufferData(e.ARRAY_BUFFER,new Float32Array([t,n,0,n,t,0,0,0]),e.STATIC_DRAW)}(r,o,s),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,n),r.drawArrays(r.TRIANGLE_STRIP,0,4)}(s,{u_resolution:{type:"2f",value:[t.width,t.height]},wc:{type:"f",value:n.voi.windowCenter},ww:{type:"f",value:n.voi.windowWidth},slope:{type:"f",value:t.slope},intercept:{type:"f",value:t.intercept},minPixelValue:{type:"f",value:t.minPixelValue},invert:{type:"i",value:n.invert?1:0}},u,t.width,t.height),c}function y(){var e={failIfMajorPerformanceCaveat:!0};try{var t=document.createElement("canvas");return Boolean(window.WebGLRenderingContext)&&(t.getContext("webgl",e)||t.getContext("experimental-webgl",e))}catch(n){return!1}}},"./webgl/shaders/index.js":function(e,t,n){"use strict";n.r(t),n.d(t,"shaders",(function(){return l})),n.d(t,"dataUtilities",(function(){return u}));var r=n("./webgl/shaders/int16.js"),i=n("./webgl/shaders/int8.js"),a=n("./webgl/shaders/rgb.js"),o=n("./webgl/shaders/uint16.js"),s=n("./webgl/shaders/uint8.js"),l={int16:r.int16Shader,int8:i.int8Shader,rgb:a.rgbShader,uint16:o.uint16Shader,uint8:s.uint8Shader},u={int16:r.int16DataUtilities,int8:i.int8DataUtilities,rgb:a.rgbDataUtilities,uint16:o.uint16DataUtilities,uint8:s.uint8DataUtilities}},"./webgl/shaders/int16.js":function(e,t,n){"use strict";n.r(t),n.d(t,"int16DataUtilities",(function(){return i})),n.d(t,"int16Shader",(function(){return r}));var r={},i={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*3),r=0,i=0;i<t.length;i++){var a=Math.abs(t[i]);n[r++]=255&a,n[r++]=a>>8,n[r++]=t[i]<0?0:1}return n}};r.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.g*65536.0;if (color.b == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}"},"./webgl/shaders/int8.js":function(e,t,n){"use strict";n.r(t),n.d(t,"int8DataUtilities",(function(){return i})),n.d(t,"int8Shader",(function(){return r}));var r={},i={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),r=0,i=0;i<t.length;i++)n[r++]=t[i],n[r++]=t[i]<0?0:1;return n}};r.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.;if (color.a == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}"},"./webgl/shaders/rgb.js":function(e,t,n){"use strict";n.r(t),n.d(t,"rgbDataUtilities",(function(){return i})),n.d(t,"rgbShader",(function(){return r}));var r={},i={storedPixelDataToImageData:function(e){var t=e.minPixelValue,n=0,r=0,i=e.width*e.height*4,a=e.width*e.height*3,o=e.getPixelData(),s=new Uint8Array(a);if(t<0)for(;r<i;)s[n++]=o[r++]+-t,s[n++]=o[r++]+-t,s[n++]=o[r++]+-t,r+=1;else for(;r<i;)s[n++]=o[r++],s[n++]=o[r++],s[n++]=o[r++],r+=1;return s}};r.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform float minPixelValue;uniform int invert;varying vec2 v_texCoord;void main() {vec3 color = texture2D(u_image, v_texCoord).xyz;color = color * 256.0 * slope + intercept;float center0 = wc - 0.5 - minPixelValue;float width0 = max(ww, 1.0);color = (color - center0) / width0 + 0.5;gl_FragColor = vec4(color, 1);if (invert == 1)gl_FragColor.rgb = 1. - gl_FragColor.rgb;}"},"./webgl/shaders/uint16.js":function(e,t,n){"use strict";n.r(t),n.d(t,"uint16DataUtilities",(function(){return i})),n.d(t,"uint16Shader",(function(){return r}));var r={},i={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),r=0,i=0;i<t.length;i++){var a=t[i];n[r++]=255&a,n[r++]=a>>8}return n}};r.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.a*65536.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}"},"./webgl/shaders/uint8.js":function(e,t,n){"use strict";n.r(t),n.d(t,"uint8DataUtilities",(function(){return i})),n.d(t,"uint8Shader",(function(){return r}));var r={},i={storedPixelDataToImageData:function(e){return e.getPixelData()}};r.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}"},"./webgl/textureCache.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./triggerEvent.js"),a={},o=[],s=268435456,l=0;function u(){if(!(l<=s)){for(o.sort((function(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0}));l>s;){var e=o[o.length-1];l-=e.sizeInBytes,delete a[e.imageId],o.pop(),Object(i.default)(r.events,r.default.WEBGL_TEXTURE_REMOVED,{imageId:e.imageId})}var t={maximumSizeInBytes:s,cacheSizeInBytes:l,numberOfImagesCached:o.length};Object(i.default)(r.events,r.default.WEBGL_TEXTURE_CACHE_FULL,t)}}t.default={purgeCache:function(){for(;o.length>0;){var e=o.pop();delete a[e.imageId]}l=0},getImageTexture:function(e){if(void 0===e)throw new Error("getImageTexture: imageId must not be undefined");var t=a[e];if(void 0!==t)return t.timeStamp=new Date,t.imageTexture},putImageTexture:function(e,t){var n=e.imageId;if(void 0===e)throw new Error("putImageTexture: image must not be undefined");if(void 0===n)throw new Error("putImageTexture: imageId must not be undefined");if(void 0===t)throw new Error("putImageTexture: imageTexture must not be undefined");if(!0===Object.prototype.hasOwnProperty.call(a,n))throw new Error("putImageTexture: imageId already in cache");var r={imageId:n,imageTexture:t,timeStamp:new Date,sizeInBytes:t.sizeInBytes};if(a[n]=r,o.push(r),void 0===t.sizeInBytes)throw new Error("putImageTexture: imageTexture.sizeInBytes must not be undefined");if(void 0===t.sizeInBytes.toFixed)throw new Error("putImageTexture: imageTexture.sizeInBytes is not a number");l+=r.sizeInBytes,u()},removeImageTexture:function(e){if(void 0===e)throw new Error("removeImageTexture: imageId must not be undefined");var t=a[e];if(void 0===t)throw new Error("removeImageTexture: imageId must not be undefined");return o.splice(o.indexOf(t),1),l-=t.sizeInBytes,delete a[e],t.imageTexture},setMaximumSizeBytes:function(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");s=e,u()}}},"./webgl/vertexShader.js":function(e,t,n){"use strict";n.r(t),n.d(t,"vertexShader",(function(){return r}));var r="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}"}})},e.exports=r()},gqzR:function(e,t,n){const r=n("Ybu3");e.exports=(e,t)=>{const n=r(e,t);return n?n.version:null}},iEBQ:function(e,t,n){const r=n("3wIk");e.exports=(e,t,n)=>{const i=new r(e,n),a=new r(t,n);return i.compare(a)||i.compareBuild(a)}},ie1u:function(e,t,n){(function(e){var r;!function(e,i,a){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function l(e,t){var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(t,n,t,i))||(i.exports=r):this.tychei=l}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},j0pM:function(e,t,n){const r=n("ex/Z");e.exports=(e,t)=>new r(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},lYj8:function(e,t,n){const r=n("iEBQ");e.exports=(e,t)=>e.sort((e,n)=>r(e,n,t))},lkeM:function(e,t,n){const r=n("3wIk"),i=n("ex/Z"),a=n("7sNm");e.exports=(e,t)=>{e=new i(e,t);let n=new r("0.0.0");if(e.test(n))return n;if(n=new r("0.0.0-0"),e.test(n))return n;n=null;for(let i=0;i<e.set.length;++i){let t=null;e.set[i].forEach(e=>{const n=new r(e.semver.version);switch(e.operator){case">":0===n.prerelease.length?n.patch++:n.prerelease.push(0),n.raw=n.format();case"":case">=":t&&!a(n,t)||(t=n);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+e.operator)}}),!t||n&&!a(n,t)||(n=t)}return n&&e.test(n)?n:null}},oBeb:function(e,t,n){const r=n("Ybu3");e.exports=(e,t)=>{const n=r(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null}},oh0K:function(e,t,n){const r=n("8GxW");e.exports=(e,t,n)=>r(t,e,n)},"pJ3+":function(e,t,n){var r;!function(i,a){var o,s=this,l=256,u=a.pow(l,6),c=a.pow(2,52),d=2*c,h=255;function f(e,t,n){var r=[],h=g(function e(t,n){var r,i=[],a=typeof t;if(n&&"object"==a)for(r in t)try{i.push(e(t[r],n-1))}catch(o){}return i.length?i:"string"==a?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[e,v(i)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(l):(e=new Uint8Array(l),(s.crypto||s.msCrypto).getRandomValues(e)),v(e)}catch(r){var t=s.navigator,n=t&&t.plugins;return[+new Date,s,n,s.screen,v(i)]}}():e,3),r),f=new p(r),y=function(){for(var e=f.g(6),t=u,n=0;e<c;)e=(e+n)*l,t*=l,n=f.g(1);for(;e>=d;)e/=2,t/=2,n>>>=1;return(e+n)/t};return y.int32=function(){return 0|f.g(4)},y.quick=function(){return f.g(4)/4294967296},y.double=y,g(v(f.S),i),(t.pass||n||function(e,t,n,r){return r&&(r.S&&m(r,f),e.state=function(){return m(f,{})}),n?(a.random=e,t):e})(y,h,"global"in t?t.global:this==a,t.state)}function p(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);i<l;)o[i]=i++;for(i=0;i<l;i++)o[i]=o[a=h&a+e[i%n]+(t=o[i])],o[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,o=r.S;e--;)t=o[i=h&i+1],n=n*l+o[h&(o[i]=o[a=h&a+t])+(o[a]=t)];return r.i=i,r.j=a,n})(l)}function m(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function g(e,t){for(var n,r=e+"",i=0;i<r.length;)t[h&i]=h&(n^=19*t[h&i])+r.charCodeAt(i++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(a.seedrandom=f,g(a.random(),i),e.exports){e.exports=f;try{o=n(3)}catch(y){}}else void 0===(r=(function(){return f}).call(t,n,t,e))||(e.exports=r)}([],Math)},pJ6O:function(e,t,n){(function(e){var r;!function(e,i,a){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function l(e,t){var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(t,n,t,i))||(i.exports=r):this.xorwow=l}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},qHvB:function(e){e.exports=JSON.parse('{"a":"4.17.0"}')},rNSh:function(e,t,n){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=79)}([function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";(function(e){var r=n(73),i=n(72),a=n(39);function o(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,n){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=h(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!l.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=s(e,r)).write(t,n);return i!==r&&(e=e.slice(0,i)),e}(e,t,n):function(e,t){if(l.isBuffer(t)){var n=0|f(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?s(e,0):h(e,t);if("Buffer"===t.type&&a(t.data))return h(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(c(t),e=s(e,t<0?0:0|f(t)),!l.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function h(e,t){var n=t.length<0?0:0|f(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return $(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(e).length;default:if(r)return $(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=l.from(t,r)),l.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,i);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,i){var a,o=1,s=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,n/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var c=-1;for(a=n;a<s;a++)if(u(e,a)===u(t,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===l)return c*o}else-1!==c&&(a-=a-c),c=-1}else for(n+l>s&&(n=s-l),a=n;a>=0;a--){for(var d=!0,h=0;h<l;h++)if(u(e,a+h)!==u(t,h)){d=!1;break}if(d)return a}return-1}function y(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function b(e,t,n,r){return U($(t,e.length-n),e,n,r)}function x(e,t,n,r){return U(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function w(e,t,n,r){return x(e,t,n,r)}function _(e,t,n,r){return U(z(t),e,n,r)}function k(e,t,n,r){return U(function(e,t){for(var n,r,i=[],a=0;a<e.length&&!((t-=2)<0);++a)r=(n=e.charCodeAt(a))>>8,i.push(n%256),i.push(r);return i}(t,e.length-n),e,n,r)}function E(e,t,n){return r.fromByteArray(0===t&&n===e.length?e:e.slice(t,n))}function S(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,l,u=e[i],c=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=n)switch(d){case 1:u<128&&(c=u);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&u)<<6|63&a)>127&&(c=l);break;case 3:o=e[i+2],128==(192&(a=e[i+1]))&&128==(192&o)&&(l=(15&u)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:o=e[i+2],s=e[i+3],128==(192&(a=e[i+1]))&&128==(192&o)&&128==(192&s)&&(l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,d=1):c>65535&&(r.push((c-=65536)>>>10&1023|55296),c=56320|1023&c),r.push(c),i+=d}return function(e){var t=e.length;if(t<=T)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=T));return n}(r)}t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,n){return u(null,e,t,n)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,n){return function(e,t,n,r){return c(t),t<=0?s(e,t):void 0!==n?"string"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},l.allocUnsafe=function(e){return d(null,e)},l.allocUnsafeSlow=function(e){return d(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=l.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?S(this,0,e):(function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,n);case"utf8":case"utf-8":return S(this,t,n);case"ascii":return C(this,t,n);case"latin1":case"binary":return I(this,t,n);case"base64":return E(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}).apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,n,r,i){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(a,o),u=this.slice(r,i),c=e.slice(t,n),d=0;d<s;++d)if(u[d]!==c[d]){a=u[d],o=c[d];break}return a<o?-1:o<a?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},l.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return y(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return x(this,e,t,n);case"latin1":case"binary":return w(this,e,t,n);case"base64":return _(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var T=4096;function C(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function I(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function A(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=B(e[a]);return i}function O(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function D(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,n,r,i,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function N(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);i<a;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function j(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);i<a;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function F(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function R(e,t,n,r,a){return a||F(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function P(e,t,n,r,a){return a||F(e,0,n,8),i.write(e,t,n,r,52,8),n+8}l.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=l.prototype;else{var i=t-e;n=new l(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+e]}return n},l.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},l.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},l.prototype.readUInt8=function(e,t){return t||D(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||D(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||D(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},l.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return t||D(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||D(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){t||D(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||M(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},l.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||M(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},l.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):j(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):j(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);M(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},l.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);M(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):j(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):j(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,n){return R(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return R(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return P(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return P(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(a<1e3||!l.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},l.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=l.isBuffer(e)?e:$(new l(e,r).toString()),s=o.length;for(a=0;a<n-t;++a)this[a+t]=o[a%s]}return this};var L=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function $(e,t){var n;t=t||1/0;for(var r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function z(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(L,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function U(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(0))},function(e,t,n){"use strict";var r=n(10),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=d;var a=n(6);a.inherits=n(5);var o=n(36),s=n(19);a.inherits(d,o);for(var l=i(s.prototype),u=0;u<l.length;u++){var c=l[u];d.prototype[c]||(d.prototype[c]=s.prototype[c])}function d(e){if(!(this instanceof d))return new d(e);o.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||r.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),d.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var l,u=[],c=!1,d=-1;function h(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length&&f())}function f(){if(!c){var e=s(h);c=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||c||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";return"x"+("00000000"+(256*e.readUint16()*256+e.readUint16()).toString(16)).substr(-8)}},function(e,t){e.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){(function(e){function n(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===n(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===n(e)},t.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(this,n(1).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(14);function a(e,t){return void 0!==e.parser?e.parser:t}var o=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.byteArrayParser=t,this.byteArray=n,this.elements=r}return r(e,[{key:"uint16",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readUint16(this.byteArray,n.dataOffset+2*t)}},{key:"int16",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readInt16(this.byteArray,n.dataOffset+2*t)}},{key:"uint32",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readUint32(this.byteArray,n.dataOffset+4*t)}},{key:"int32",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readInt32(this.byteArray,n.dataOffset+4*t)}},{key:"float",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readFloat(this.byteArray,n.dataOffset+4*t)}},{key:"double",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readDouble(this.byteArray,n.dataOffset+8*t)}},{key:"numStringValues",value:function(e){var t=this.elements[e];if(t&&t.length>0){var n=(0,i.readFixedString)(this.byteArray,t.dataOffset,t.length).match(/\\/g);return null===n?1:n.length+1}}},{key:"string",value:function(e,t){var n=this.elements[e];if(n&&n.length>0){var r=(0,i.readFixedString)(this.byteArray,n.dataOffset,n.length);return t>=0?r.split("\\")[t].trim():r.trim()}}},{key:"text",value:function(e,t){var n=this.elements[e];if(n&&n.length>0){var r=(0,i.readFixedString)(this.byteArray,n.dataOffset,n.length);return t>=0?r.split("\\")[t].replace(/ +$/,""):r.replace(/ +$/,"")}}},{key:"floatString",value:function(e,t){var n=this.elements[e];if(n&&n.length>0){var r=this.string(e,t=void 0!==t?t:0);if(void 0!==r)return parseFloat(r)}}},{key:"intString",value:function(e,t){var n=this.elements[e];if(n&&n.length>0){var r=this.string(e,t=void 0!==t?t:0);if(void 0!==r)return parseInt(r)}}},{key:"attributeTag",value:function(e){var t=this.elements[e];if(t&&4===t.length){var n=a(t,this.byteArrayParser).readUint16,r=this.byteArray,i=t.dataOffset;return"x"+("00000000"+(256*n(r,i)*256+n(r,i+2)).toString(16)).substr(-8)}}}]),e}();t.default=o},function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){var t,n,r,i,a,o;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(o=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)o.set(a=e[t],i),i+=a.length;return o}},o={arraySet:function(e,t,n,r,i){for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(r)},function(e,t,n){var r=n(1),i=r.Buffer;function a(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(a(r,t),t.Buffer=o),a(i,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,n){"use strict";(function(t){e.exports=!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?{nextTick:function(e,n,r,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var a,o,s=arguments.length;switch(s){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,n)}));case 3:return t.nextTick((function(){e.call(null,n,r)}));case 4:return t.nextTick((function(){e.call(null,n,r,i)}));default:for(a=new Array(s-1),o=0;o<a.length;)a[o++]=arguments[o];return t.nextTick((function(){e.apply(null,a)}))}}}:t}).call(this,n(3))},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,n,r){if(void 0!==e&&t instanceof e)return t.slice(n,n+r);if(t instanceof Uint8Array)return new Uint8Array(t.buffer,t.byteOffset+n,r);throw"dicomParser.from: unknown type for byteArray"}}).call(this,n(1).Buffer)},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=(r=n(11))&&r.__esModule?r:{default:r},o=n(14),s=function(){function t(n,r,i){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),void 0===n)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===r)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(r instanceof Uint8Array==0&&r instanceof e==0)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(i<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(i>=r.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=n,this.byteArray=r,this.position=i||0,this.warnings=[]}return i(t,[{key:"seek",value:function(e){if(this.position+e<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=e}},{key:"readByteStream",value:function(e){if(this.position+e>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var n=(0,a.default)(this.byteArray,this.position,e);return this.position+=e,new t(this.byteArrayParser,n)}},{key:"readUint16",value:function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e}},{key:"readUint32",value:function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e}},{key:"readFixedString",value:function(e){var t=(0,o.readFixedString)(this.byteArray,this.position,e);return this.position+=e,t}}]),t}();t.default=s}).call(this,n(1).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(void 0===e)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var t={tag:(0,i.default)(e),length:e.readUint32(),dataOffset:e.position};if("xfffee000"!==t.tag)throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset "+e.position;return t};var r,i=(r=n(4))&&r.__esModule?r:{default:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readFixedString=function(e,t,n){if(n<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(t+n>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var r,i="",a=0;a<n;a++){if(0===(r=e[t+a]))return t+=n,i;i+=String.fromCharCode(r)}return i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var l={tag:(0,a.default)(e),vr:e.readFixedString(2)};return 2===u(l.vr)?(l.length=e.readUint16(),l.dataOffset=e.position):(e.seek(2),l.length=e.readUint32(),l.dataOffset=e.position),4294967295===l.length&&(l.hadUndefinedLength=!0),l.tag===n?l:"SQ"===l.vr?((0,s.default)(e,l,t),l):4294967295===l.length?"x7fe00010"===l.tag?((0,r.default)(e,l,t),l):"UN"===l.vr?((0,i.default)(e,l),l):((0,o.default)(e,l),l):(e.seek(l.length),l)};var r=l(n(42)),i=(l(n(41)),l(n(26))),a=l(n(4)),o=l(n(24)),s=l(n(40));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){return"OB"===e||"OW"===e||"SQ"===e||"OF"===e||"UT"===e||"UN"===e?4:2}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDicomDataSetExplicit=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(void 0===t)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if((n=void 0===n?t.byteArray.length:n)<t.position||n>t.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var a=e.elements;t.position<n;){var o=(0,r.default)(t,e.warnings,i.untilTag);if(a[o.tag]=o,o.tag===i.untilTag)return}if(t.position>n)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"},t.parseDicomDataSetImplicit=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(void 0===t)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if((n=void 0===n?e.byteArray.length:n)<t.position||n>t.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var a=e.elements;t.position<n;){var o=(0,i.default)(t,r.untilTag,r.vrCallback);if(a[o.tag]=o,o.tag===r.untilTag)return}};var r=a(n(15)),i=a(n(25));function a(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};t.isStringVr=function(e){return r[e]},t.isPrivateTag=function(e){return parseInt(e[4],10)%2==1},t.parsePN=function(e){if(void 0!==e){var t=e.split("^");return{familyName:t[0],givenName:t[1],middleName:t[2],prefix:t[3],suffix:t[4]}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,s,u){if(u=u||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===(s=s||1))throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(n>=t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(s<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(n+s>t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var c=new i.default(e.byteArrayParser,e.byteArray,t.dataOffset),d=(0,a.default)(c);if("xfffee000"!==d.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";c.seek(d.length);var h=c.position;if(1===s)return(0,o.default)(c.byteArray,h+u[n].offset+8,u[n].length);for(var f=l(u,n,s),p=(0,r.default)(c.byteArray,f),m=0,g=n;g<n+s;g++)for(var v=h+u[g].offset+8,y=0;y<u[g].length;y++)p[m++]=c.byteArray[v++];return p};var r=s(n(23)),i=s(n(12)),a=s(n(13)),o=s(n(11));function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e,t,n){for(var r=0,i=t;i<t+n;i++)r+=e[i].length;return r}},function(e,t,n){"use strict";(function(t,r,i){var a=n(10);function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(void 0),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=y;var s,l=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:a.nextTick;y.WritableState=v;var u=n(6);u.inherits=n(5);var c,d={deprecate:n(61)},h=n(35),f=n(9).Buffer,p=i.Uint8Array||function(){},m=n(34);function g(){}function v(e,t){s=s||n(2);var r=t instanceof s;this.objectMode=!!(e=e||{}).objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,u=e.writableHighWaterMark;this.highWaterMark=i||0===i?i:r&&(u||0===u)?u:this.objectMode?16:16384,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1,this.decodeStrings=!(!1===e.decodeStrings),this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(a.nextTick(i,r),a.nextTick(E,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(i(r),e._writableState.errorEmitted=!0,e.emit("error",r),E(e,t))}(e,n,r,t,i);else{var o=_(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||w(e,n),r?l(x,e,n,o,i):x(e,n,o,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function y(e){if(s=s||n(2),!(c.call(y,this)||this instanceof s))return new y(e);this._writableState=new v(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),h.call(this)}function b(e,t,n,r,i,a,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function x(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),E(e,t)}function w(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=new Array(t.bufferedRequestCount),i=t.corkedRequestsFree;i.entry=n;for(var a=0,s=!0;n;)r[a]=n,n.isBuf||(s=!1),n=n.next,a+=1;r.allBuffers=s,b(e,t,!0,t.length,r,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new o(t),t.bufferedRequestCount=0}else{for(;n;){var l=n.chunk;if(b(e,t,!1,t.objectMode?1:l.length,l,n.encoding,n.callback),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function _(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function k(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),E(e,t)}))}function E(e,t){var n=_(t);return n&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,a.nextTick(k,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}u.inherits(y,h),v.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(v.prototype,"buffer",{get:d.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(c=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!c.call(this,e)||this===y&&e&&e._writableState instanceof v}})):c=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,n){var r,i=this._writableState,o=!1,s=!i.objectMode&&(f.isBuffer(r=e)||r instanceof p);return s&&!f.isBuffer(e)&&(e=function(e){return f.from(e)}(e)),"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=g),i.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),a.nextTick(t,n)}(this,n):(s||function(e,t,n,r){var i=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),a.nextTick(r,o),i=!1),i}(this,i,e,n))&&(i.pendingcb++,o=function(e,t,n,r,i,a){if(!n){var o=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=f.from(t,n)),t}(t,r,i);r!==o&&(n=!0,i="buffer",r=o)}var s=t.objectMode?1:r.length;t.length+=s;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:a,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else b(e,t,!1,s,r,i,a);return l}(this,i,s,e,t,n)),o},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||w(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},y.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,E(e,t),n&&(t.finished?a.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=m.destroy,y.prototype._undestroy=m.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,n(3),n(63).setImmediate,n(0))},function(e,t,n){(t=e.exports=n(36)).Stream=t,t.Readable=t,t.Writable=n(19),t.Duplex=n(2),t.Transform=n(32),t.PassThrough=n(60)},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,o,s,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(a(n=this._events[e]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(i(n))for(s=Array.prototype.slice.call(arguments,1),o=(u=n.slice()).length,l=0;l<o;l++)u[l].apply(this,s);return!0},n.prototype.on=n.prototype.addListener=function(e,t){var o;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(o=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var n,a,o,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(n=this._events[e]).length,a=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(s=o;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){a=s;break}if(a<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={readUint16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=e[t]+(e[t+1]<<8);return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256},readInt32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)},readFloat:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],n[4]=e[t+4],n[5]=e[t+5],n[6]=e[t+6],n[7]=e[t+7],new Float64Array(n.buffer)[0]}}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,n){if(void 0!==e&&t instanceof e)return e.alloc(n);if(t instanceof Uint8Array)return new Uint8Array(n);throw"dicomParser.alloc: unknown type for byteArray"}}).call(this,n(1).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var n=e.byteArray.length-8;e.position<=n;)if(65534===e.readUint16()&&57357===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position "+(e.position-4)+" while reading element of undefined length with tag "+t.tag),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var s={tag:(0,a.default)(e),length:e.readUint32(),dataOffset:e.position};return 4294967295===s.length&&(s.hadUndefinedLength=!0),s.tag===t?s:l(s,e,n)&&!(0,o.isPrivateTag)(s.tag)?((0,i.default)(e,s),s):s.hadUndefinedLength?((0,r.default)(e,s),s):(e.seek(s.length),s)};var r=s(n(24)),i=s(n(26)),a=s(n(4)),o=n(17);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e,t,n){if(void 0!==n)return"SQ"===n(e.tag);if(t.position+4<=t.byteArray.length){var r=(0,a.default)(t);return t.seek(-4),"xfffee000"===r||"xfffee0dd"===r}return t.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?function(e,t,n){for(;e.position+4<=e.byteArray.length;){var r=(0,o.default)(e);if(e.seek(-4),"xfffee0dd"===r)return t.length=e.position-t.dataOffset,e.seek(8),t;var i=u(e,n);t.items.push(i)}e.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),t.length=e.byteArray.length-t.dataOffset}(e,t,n):function(e,t,n){for(var r=t.dataOffset+t.length;e.position<r;){var i=u(e,n);t.items.push(i)}}(e,t,n)};var r=l(n(7)),i=l(n(25)),a=l(n(13)),o=l(n(4)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(16));function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){var n=(0,a.default)(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,t){for(var n={};e.position<e.byteArray.length;){var a=(0,i.default)(e,void 0,t);if(n[a.tag]=a,"xfffee00d"===a.tag)return new r.default(e.byteArrayParser,e.byteArray,n)}return e.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new r.default(e.byteArrayParser,e.byteArray,n)}(e,t),n.length=e.position-n.dataOffset):(n.dataSet=new r.default(e.byteArrayParser,e.byteArray,{}),s.parseDicomDataSetImplicit(n.dataSet,e,e.position+n.length,{vrCallback:t})),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,s){if(void 0===e)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===(r=r||t.basicOffsetTable))throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===r.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(n<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(n>=r.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var l=a(s=s||t.fragments,r[n]);if(void 0===l)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";var u=o(n,r,s,l);return(0,i.default)(e,t,l,u,s)};var r,i=(r=n(18))&&r.__esModule?r:{default:r},a=function(e,t){for(var n=0;n<e.length;n++)if(e[n].offset===t)return n},o=function(e,t,n,r){if(e===t.length-1)return n.length-r;for(var i=t[e+1],a=r+1;a<n.length;a++)if(n[a].offset===i)return a-r;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"}},function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,i){var a=r,o=i+n;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},function(e,t,n){"use strict";e.exports=function(e,t,n,r){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{a=a+(i=i+t[r++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},function(e,t,n){(function(e,r){var i=/%[sdj%]/g;t.format=function(e){if(!v(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,a=r.length,o=String(e).replace(i,(function(e){if("%%"===e)return"%";if(n>=a)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),l=r[n];n<a;l=r[++n])m(l)||!x(l)?o+=" "+l:o+=" "+s(l);return o},t.deprecate=function(n,i){if(y(e.process))return function(){return t.deprecate(n,i).apply(this,arguments)};if(!0===r.noDeprecation)return n;var a=!1;return function(){if(!a){if(r.throwDeprecation)throw new Error(i);r.traceDeprecation?console.trace(i):console.error(i),a=!0}return n.apply(this,arguments)}};var a,o={};function s(e,n){var r={seen:[],stylize:u};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),p(n)?r.showHidden=n:n&&t._extend(r,n),y(r.showHidden)&&(r.showHidden=!1),y(r.depth)&&(r.depth=2),y(r.colors)&&(r.colors=!1),y(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=l),c(r,e,r.depth)}function l(e,t){var n=s.styles[t];return n?"\x1b["+s.colors[n][0]+"m"+e+"\x1b["+s.colors[n][1]+"m":e}function u(e,t){return e}function c(e,n,r){if(e.customInspect&&n&&k(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return v(i)||(i=c(e,i,r)),i}var a=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(v(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return g(t)?e.stylize(""+t,"number"):p(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}(e,n);if(a)return a;var o=Object.keys(n),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(n)),_(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return d(n);if(0===o.length){if(k(n))return e.stylize("[Function"+(n.name?": "+n.name:"")+"]","special");if(b(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(w(n))return e.stylize(Date.prototype.toString.call(n),"date");if(_(n))return d(n)}var l,u="",x=!1,E=["{","}"];return f(n)&&(x=!0,E=["[","]"]),k(n)&&(u=" [Function"+(n.name?": "+n.name:"")+"]"),b(n)&&(u=" "+RegExp.prototype.toString.call(n)),w(n)&&(u=" "+Date.prototype.toUTCString.call(n)),_(n)&&(u=" "+d(n)),0!==o.length||x&&0!=n.length?r<0?b(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),l=x?function(e,t,n,r,i){for(var a=[],o=0,s=t.length;o<s;++o)C(t,String(o))?a.push(h(e,t,n,r,String(o),!0)):a.push("");return i.forEach((function(i){i.match(/^\d+$/)||a.push(h(e,t,n,r,i,!0))})),a}(e,n,r,s,o):o.map((function(t){return h(e,n,r,s,t,x)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(l,u,E)):E[0]+u+E[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,n,r,i,a){var o,s,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=e.stylize(l.set?"[Getter/Setter]":"[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),C(r,i)||(o="["+i+"]"),s||(e.seen.indexOf(l.value)<0?(s=m(n)?c(e,l.value,null):c(e,l.value,n-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),y(o)){if(a&&i.match(/^\d+$/))return s;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function f(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function v(e){return"string"==typeof e}function y(e){return void 0===e}function b(e){return x(e)&&"[object RegExp]"===E(e)}function x(e){return"object"==typeof e&&null!==e}function w(e){return x(e)&&"[object Date]"===E(e)}function _(e){return x(e)&&("[object Error]"===E(e)||e instanceof Error)}function k(e){return"function"==typeof e}function E(e){return Object.prototype.toString.call(e)}function S(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(y(a)&&(a=r.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(a)){var n=r.pid;o[e]=function(){var r=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,r)}}else o[e]=function(){};return o[e]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=p,t.isNull=m,t.isNullOrUndefined=function(e){return null==e},t.isNumber=g,t.isString=v,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=y,t.isRegExp=b,t.isObject=x,t.isDate=w,t.isError=_,t.isFunction=k,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(54);var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function C(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,n;console.log("%s - %s",(n=[S((e=new Date).getHours()),S(e.getMinutes()),S(e.getSeconds())].join(":"),[e.getDate(),T[e.getMonth()],n].join(" ")),t.format.apply(t,arguments))},t.inherits=n(53),t._extend=function(e,t){if(!t||!x(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,n(0),n(3))},function(e,t,n){"use strict";(function(t){function r(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0}function i(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var a=n(30),o=Object.prototype.hasOwnProperty,s=Array.prototype.slice,l="foo"===(function(){}).name;function u(e){return Object.prototype.toString.call(e)}function c(e){return!i(e)&&"function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}var d=e.exports=v,h=/\s*function\s+([^\(\s]*)\s*/;function f(e){if(a.isFunction(e)){if(l)return e.name;var t=e.toString().match(h);return t&&t[1]}}function p(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function m(e){if(l||!a.isFunction(e))return a.inspect(e);var t=f(e);return"[Function"+(t?": "+t:"")+"]"}function g(e,t,n,r,i){throw new d.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:i})}function v(e,t){e||g(e,!0,t,"==",d.ok)}function y(e,t,n,o){if(e===t)return!0;if(i(e)&&i(t))return 0===r(e,t);if(a.isDate(e)&&a.isDate(t))return e.getTime()===t.getTime();if(a.isRegExp(e)&&a.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(c(e)&&c(t)&&u(e)===u(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===r(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(i(e)!==i(t))return!1;var l=(o=o||{actual:[],expected:[]}).actual.indexOf(e);return-1!==l&&l===o.expected.indexOf(t)||(o.actual.push(e),o.expected.push(t),function(e,t,n,r){if(null==e||null==t)return!1;if(a.isPrimitive(e)||a.isPrimitive(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=b(e),o=b(t);if(i&&!o||!i&&o)return!1;if(i)return y(e=s.call(e),t=s.call(t),n);var l,u,c=_(e),d=_(t);if(c.length!==d.length)return!1;for(c.sort(),d.sort(),u=c.length-1;u>=0;u--)if(c[u]!==d[u])return!1;for(u=c.length-1;u>=0;u--)if(!y(e[l=c[u]],t[l],n,r))return!1;return!0}(e,t,n,o))}return n?e===t:e==t}function b(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function x(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function w(e,t,n,r){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(r=n,n=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),e&&!i&&g(i,n,"Missing expected exception"+r);var o="string"==typeof r,s=!e&&i&&!n;if((!e&&a.isError(i)&&o&&x(i,n)||s)&&g(i,n,"Got unwanted exception"+r),e&&i&&n&&!x(i,n)||!e&&i)throw i}d.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=p(m(this.actual),128)+" "+this.operator+" "+p(m(this.expected),128),this.generatedMessage=!0);var t=e.stackStartFunction||g;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var r=n.stack,i=f(t),a=r.indexOf("\n"+i);if(a>=0){var o=r.indexOf("\n",a+1);r=r.substring(o+1)}this.stack=r}}},a.inherits(d.AssertionError,Error),d.fail=g,d.ok=v,d.equal=function(e,t,n){e!=t&&g(e,t,n,"==",d.equal)},d.notEqual=function(e,t,n){e==t&&g(e,t,n,"!=",d.notEqual)},d.deepEqual=function(e,t,n){y(e,t,!1)||g(e,t,n,"deepEqual",d.deepEqual)},d.deepStrictEqual=function(e,t,n){y(e,t,!0)||g(e,t,n,"deepStrictEqual",d.deepStrictEqual)},d.notDeepEqual=function(e,t,n){y(e,t,!1)&&g(e,t,n,"notDeepEqual",d.notDeepEqual)},d.notDeepStrictEqual=function e(t,n,r){y(t,n,!0)&&g(t,n,r,"notDeepStrictEqual",e)},d.strictEqual=function(e,t,n){e!==t&&g(e,t,n,"===",d.strictEqual)},d.notStrictEqual=function(e,t,n){e===t&&g(e,t,n,"!==",d.notStrictEqual)},d.throws=function(e,t,n){w(!0,e,t,n)},d.doesNotThrow=function(e,t,n){w(!1,e,t,n)},d.ifError=function(e){if(e)throw e};var _=Object.keys||function(e){var t=[];for(var n in e)o.call(e,n)&&t.push(n);return t}}).call(this,n(0))},function(e,t,n){"use strict";e.exports=a;var r=n(2),i=n(6);function a(e){if(!(this instanceof a))return new a(e);r.call(this,e),this._transformState={afterTransform:(function(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}).bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",o)}function o(){var e=this;"function"==typeof this._flush?this._flush((function(t,n){s(e,t,n)})):s(this,null,null)}function s(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=n(5),i.inherits(a,r),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},a.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},a.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},function(e,t,n){"use strict";var r=n(9).Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=u,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=c,this.end=d,t=3;break;default:return this.write=h,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:-1}function s(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"\ufffd".repeat(n);if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"\ufffd".repeat(n+1);if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"\ufffd".repeat(n+2)}}(this,e,t);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("utf16le",0,this.lastTotal-this.lastNeed):t}function c(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.StringDecoder=a,a.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},a.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\ufffd".repeat(this.lastTotal-this.lastNeed):t},a.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=o(t[r]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--r<n?0:(i=o(t[r]))>=0?(i>0&&(e.lastNeed=i-2),i):--r<n?0:(i=o(t[r]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";var r=n(10);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this;return this._readableState&&this._readableState.destroyed||this._writableState&&this._writableState.destroyed?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(r.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){e.exports=n(21).EventEmitter},function(e,t,n){"use strict";(function(t,r){var i=n(10);e.exports=b;var a,o=n(39);b.ReadableState=y,n(21);var s=function(e,t){return e.listeners(t).length},l=n(35),u=n(9).Buffer,c=t.Uint8Array||function(){},d=n(6);d.inherits=n(5);var h=n(66),f=void 0;f=h&&h.debuglog?h.debuglog("stream"):function(){};var p,m=n(65),g=n(34);d.inherits(b,l);var v=["error","close","destroy","pause","resume"];function y(e,t){var r=t instanceof(a=a||n(2));this.objectMode=!!(e=e||{}).objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,o=e.readableHighWaterMark;this.highWaterMark=i||0===i?i:r&&(o||0===o)?o:this.objectMode?16:16384,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=n(33).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function b(e){if(a=a||n(2),!(this instanceof b))return new b(e);this._readableState=new y(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),l.call(this)}function x(e,t,n,r,i){var a,o=e._readableState;return null===t?(o.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,E(e)}}(e,o)):(i||(a=function(e,t){var n,r;return u.isBuffer(r=t)||r instanceof c||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(o,t)),a?e.emit("error",a):o.objectMode||t&&t.length>0?("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===u.prototype||(t=function(e){return u.from(e)}(t)),r?o.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,o,t,!0):o.ended?e.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!n?(t=o.decoder.write(t),o.objectMode||0!==t.length?w(e,o,t,!1):T(e,o)):w(e,o,t,!1))):r||(o.reading=!1)),function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(o)}function w(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&E(e)),T(e,t)}Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),b.prototype.destroy=g.destroy,b.prototype._undestroy=g.undestroy,b.prototype._destroy=function(e,t){this.push(null),t(e)},b.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=u.from(e,t),t=""),n=!0),x(this,e,t,!1,n)},b.prototype.unshift=function(e){return x(this,e,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(e){return p||(p=n(33).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var _=8388608;function k(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=_?e=_:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function E(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(S,e):S(e))}function S(e){f("emit readable"),e.emit("readable"),O(e)}function T(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(C,e,t))}function C(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function I(e){f("readable nexttick read 0"),e.read(0)}function A(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),O(e),t.flowing&&!t.reading&&e.read(0)}function O(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function D(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var a=n.data,o=e>a.length?a.length:e;if(i+=o===a.length?a:a.slice(0,e),0==(e-=o)){o===a.length?(++r,t.head=n.next?n.next:t.tail=null):(t.head=n,n.data=a.slice(o));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=u.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var a=r.data,o=e>a.length?a.length:e;if(a.copy(n,n.length-e,0,o),0==(e-=o)){o===a.length?(++i,t.head=r.next?r.next:t.tail=null):(t.head=r,r.data=a.slice(o));break}++i}return t.length-=i,n}(e,t),r}(e,t.buffer,t.decoder),n);var n}function M(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(N,t,e))}function N(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function j(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}b.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?M(this):E(this),null;if(0===(e=k(e,t))&&t.ended)return 0===t.length&&M(this),null;var r,i=t.needReadable;return f("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",i=!0),t.ended||t.reading?f("reading or ended",i=!1):i&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=k(n,t))),null===(r=e>0?D(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&M(this)),null!==r&&this.emit("data",r),r},b.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},b.prototype.pipe=function(e,t){var n=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=e;break;case 1:a.pipes=[a.pipes,e];break;default:a.pipes.push(e)}a.pipesCount+=1,f("pipe count=%d opts=%j",a.pipesCount,t);var l=t&&!1===t.end||e===r.stdout||e===r.stderr?y:u;function u(){f("onend"),e.end()}a.endEmitted?i.nextTick(l):n.once("end",l),e.on("unpipe",(function t(r,i){f("onunpipe"),r===n&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,f("cleanup"),e.removeListener("close",g),e.removeListener("finish",v),e.removeListener("drain",c),e.removeListener("error",m),e.removeListener("unpipe",t),n.removeListener("end",u),n.removeListener("end",y),n.removeListener("data",p),d=!0,!a.awaitDrain||e._writableState&&!e._writableState.needDrain||c())}));var c=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,O(e))}}(n);e.on("drain",c);var d=!1,h=!1;function p(t){f("ondata"),h=!1,!1!==e.write(t)||h||((1===a.pipesCount&&a.pipes===e||a.pipesCount>1&&-1!==j(a.pipes,e))&&!d&&(f("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,h=!0),n.pause())}function m(t){f("onerror",t),y(),e.removeListener("error",m),0===s(e,"error")&&e.emit("error",t)}function g(){e.removeListener("finish",v),y()}function v(){f("onfinish"),e.removeListener("close",g),y()}function y(){f("unpipe"),n.unpipe(e)}return n.on("data",p),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?o(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",m),e.once("close",g),e.once("finish",v),e.emit("pipe",n),a.flowing||(f("pipe resume"),n.resume()),e},b.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)r[a].emit("unpipe",this,n);return this}var o=j(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},b.prototype.addListener=b.prototype.on=function(e,t){var n=l.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&E(this):i.nextTick(I,this))}return n},b.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(A,e,t))}(this,e)),this},b.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},b.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(f("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){f("wrapped data"),n.decoder&&(i=n.decoder.write(i)),(!n.objectMode||null!=i)&&(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var a=0;a<v.length;a++)e.on(v[a],this.emit.bind(this,v[a]));return this._read=function(t){f("wrapped _read",t),r&&(r=!1,e.resume())},this},b._fromList=D}).call(this,n(0),n(3))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var n=new r.default(a.default,e);return function(){!function(){if(n.seek(128),"DICM"!==n.readFixedString(4))throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file."}();for(var e=[],t={};n.position<n.byteArray.length;){var r=n.position,s=(0,o.default)(n,e);if(s.tag>"x0002ffff"){n.position=r;break}s.parser=a.default,t[s.tag]=s}var l=new i.default(n.byteArrayParser,n.byteArray,t);return l.warnings=n.warnings,l.position=n.position,l}()};var r=s(n(12)),i=s(n(7)),a=s(n(22)),o=s(n(15));function s(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={readUint16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=(e[t]<<8)+e[t+1];return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3]},readInt32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3]},readFloat:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[3]=e[t],n[2]=e[t+1],n[1]=e[t+2],n[0]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[7]=e[t],n[6]=e[t+1],n[5]=e[t+2],n[4]=e[t+3],n[3]=e[t+4],n[2]=e[t+5],n[1]=e[t+6],n[0]=e[t+7],new Float64Array(n.buffer)[0]}}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?function(e,t,n){for(;e.position+4<=e.byteArray.length;){var r=(0,o.default)(e);if(e.seek(-4),"xfffee0dd"===r)return t.length=e.position-t.dataOffset,e.seek(8),t;var i=u(e,n);t.items.push(i)}n.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),t.length=e.position-t.dataOffset}(e,t,n):function(e,t,n){for(var r=t.dataOffset+t.length;e.position<r;){var i=u(e,n);t.items.push(i)}}(e,t,n)};var r=l(n(7)),i=l(n(15)),a=l(n(13)),o=l(n(4)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(16));function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){var n=(0,a.default)(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,t){for(var n={};e.position<e.byteArray.length;){var a=(0,i.default)(e,t);if(n[a.tag]=a,"xfffee00d"===a.tag)return new r.default(e.byteArrayParser,e.byteArray,n)}return t.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new r.default(e.byteArrayParser,e.byteArray,n)}(e,t),n.length=e.position-n.dataOffset):(n.dataSet=new r.default(e.byteArrayParser,e.byteArray,{}),s.parseDicomDataSetExplicit(n.dataSet,e,e.position+n.length)),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var n=e.byteArray.length-8;e.position<=n;)if(65534===e.readUint16()&&57565===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position "+(e.position-4)+" while reading element of undefined length with tag "+t.tag),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(t.encapsulatedPixelData=!0,t.basicOffsetTable=[],t.fragments=[],"xfffee000"!==(0,i.default)(e))throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var r=e.readUint32()/4,a=0;a<r;a++){var o=e.readUint32();t.basicOffsetTable.push(o)}for(var s=e.position;e.position<e.byteArray.length;){var l=(0,i.default)(e),u=e.readUint32();if("xfffee0dd"===l)return e.seek(u),void(t.length=e.position-t.dataOffset);if("xfffee000"!==l)return n&&n.push("unexpected tag "+l+" while searching for end of pixel data element with undefined length"),u>e.byteArray.length-e.position&&(u=e.byteArray.length-e.position),t.fragments.push({offset:e.position-s-8,position:e.position,length:u}),e.seek(u),void(t.length=e.position-t.dataOffset);t.fragments.push({offset:e.position-s-8,position:e.position,length:u}),e.seek(u)}n&&n.push("pixel data element "+t.tag+" missing sequence delimiter tag xfffee0dd")};var r,i=(r=n(4))&&r.__esModule?r:{default:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e||void 0===t)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===t.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var n,i=t.vr,a=t.tag;function o(t,n){for(var r="",i=0;i<t;i++)0!==i&&(r+="/"),r+=n.call(e,a,i).toString();return r}if(!0===r.isStringVr(i))n=e.string(a);else{if("AT"===i){var s=e.uint32(a);if(void 0===s)return;return s<0&&(s=4294967295+s+1),"x"+s.toString(16).toUpperCase()}"US"===i?n=o(t.length/2,e.uint16):"SS"===i?n=o(t.length/2,e.int16):"UL"===i?n=o(t.length/4,e.uint32):"SL"===i?n=o(t.length/4,e.int32):"FD"===i?n=o(t.length/8,e.double):"FL"===i&&(n=o(t.length/4,e.float))}return n};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(o||(o=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),void 0===e)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(n<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return 0!==t.basicOffsetTable.length?(0,r.default)(e,t,n):(0,i.default)(e,t,0,t.fragments.length)};var r=a(n(27)),i=a(n(18));function a(e){return e&&e.__esModule?e:{default:e}}var o=!1},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";var r=n(8),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,l,u,c,d,h){var f,p,m,g,v,y,b,x,w,_=h.bits,k=0,E=0,S=0,T=0,C=0,I=0,A=0,O=0,D=0,M=0,N=null,j=0,F=new r.Buf16(16),R=new r.Buf16(16),P=null,L=0;for(k=0;k<=15;k++)F[k]=0;for(E=0;E<l;E++)F[t[n+E]]++;for(C=_,T=15;T>=1&&0===F[T];T--);if(C>T&&(C=T),0===T)return u[c++]=20971520,u[c++]=20971520,h.bits=1,0;for(S=1;S<T&&0===F[S];S++);for(C<S&&(C=S),O=1,k=1;k<=15;k++)if(O<<=1,(O-=F[k])<0)return-1;if(O>0&&(0===e||1!==T))return-1;for(R[1]=0,k=1;k<15;k++)R[k+1]=R[k]+F[k];for(E=0;E<l;E++)0!==t[n+E]&&(d[R[t[n+E]]++]=E);if(0===e?(N=P=d,y=19):1===e?(N=i,j-=257,P=a,L-=257,y=256):(N=o,P=s,y=-1),M=0,E=0,k=S,v=c,I=C,A=0,m=-1,g=(D=1<<C)-1,1===e&&D>852||2===e&&D>592)return 1;for(;;){b=k-A,d[E]<y?(x=0,w=d[E]):d[E]>y?(x=P[L+d[E]],w=N[j+d[E]]):(x=96,w=0),f=1<<k-A,S=p=1<<I;do{u[v+(M>>A)+(p-=f)]=b<<24|x<<16|w|0}while(0!==p);for(f=1<<k-1;M&f;)f>>=1;if(0!==f?(M&=f-1,M+=f):M=0,E++,0==--F[k]){if(k===T)break;k=t[n+d[E]]}if(k>C&&(M&g)!==m){for(0===A&&(A=C),v+=S,O=1<<(I=k-A);I+A<T&&!((O-=F[I+A])<=0);)I++,O<<=1;if(D+=1<<I,1===e&&D>852||2===e&&D>592)return 1;u[m=M&g]=C<<24|I<<16|v-c|0}}return 0!==M&&(u[v+M]=k-A<<24|64<<16|0),h.bits=C,0}},function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i,a,o,s,l,u,c,d,h,f,p,m,g,v,y,b,x,w,_,k,E,S,T;S=e.input,i=(r=e.next_in)+(e.avail_in-5),T=e.output,o=(a=e.next_out)-(t-e.avail_out),s=a+(e.avail_out-257),l=(n=e.state).dmax,u=n.wsize,c=n.whave,d=n.wnext,h=n.window,f=n.hold,p=n.bits,m=n.lencode,g=n.distcode,v=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{p<15&&(f+=S[r++]<<p,f+=S[r++]<<(p+=8),p+=8),b=m[f&v];t:for(;;){if(f>>>=x=b>>>24,p-=x,0==(x=b>>>16&255))T[a++]=65535&b;else{if(!(16&x)){if(0==(64&x)){b=m[(65535&b)+(f&(1<<x)-1)];continue t}if(32&x){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}w=65535&b,(x&=15)&&(p<x&&(f+=S[r++]<<p,p+=8),w+=f&(1<<x)-1,f>>>=x,p-=x),p<15&&(f+=S[r++]<<p,f+=S[r++]<<(p+=8),p+=8),b=g[f&y];n:for(;;){if(f>>>=x=b>>>24,p-=x,!(16&(x=b>>>16&255))){if(0==(64&x)){b=g[(65535&b)+(f&(1<<x)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(_=65535&b,p<(x&=15)&&(f+=S[r++]<<p,(p+=8)<x&&(f+=S[r++]<<p,p+=8)),(_+=f&(1<<x)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=x,p-=x,_>(x=a-o)){if((x=_-x)>c&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(k=0,E=h,0===d){if(k+=u-x,x<w){w-=x;do{T[a++]=h[k++]}while(--x);k=a-_,E=T}}else if(d<x){if(k+=u+d-x,(x-=d)<w){w-=x;do{T[a++]=h[k++]}while(--x);if(k=0,d<w){w-=x=d;do{T[a++]=h[k++]}while(--x);k=a-_,E=T}}}else if(k+=d-x,x<w){w-=x;do{T[a++]=h[k++]}while(--x);k=a-_,E=T}for(;w>2;)T[a++]=E[k++],T[a++]=E[k++],T[a++]=E[k++],w-=3;w&&(T[a++]=E[k++],w>1&&(T[a++]=E[k++]))}else{k=a-_;do{T[a++]=T[k++],T[a++]=T[k++],T[a++]=T[k++],w-=3}while(w>2);w&&(T[a++]=T[k++],w>1&&(T[a++]=T[k++]))}break}}break}}while(r<i&&a<s);r-=w=p>>3,f&=(1<<(p-=w<<3))-1,e.next_in=r,e.next_out=a,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=a<s?s-a+257:257-(a-s),n.hold=f,n.bits=p}},function(e,t,n){"use strict";var r=n(8),i=n(29),a=n(28),o=n(47),s=n(46),l=-2,u=12,c=30;function d(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function h(e){var t;return e&&e.state?(e.total_in=e.total_out=(t=e.state).total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(852),t.distcode=t.distdyn=new r.Buf32(592),t.sane=1,t.back=-1,0):l}function f(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,h(e)):l}function p(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?l:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,f(e))):l}function m(e,t){var n,i;return e?(i=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=i,i.window=null,0!==(n=p(e,t))&&(e.state=null),n):l}var g,v,y=!0;function b(e){if(y){var t;for(g=new r.Buf32(512),v=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(1,e.lens,0,288,g,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(2,e.lens,0,32,v,0,e.work,{bits:5}),y=!1}e.lencode=g,e.lenbits=9,e.distcode=v,e.distbits=5}function x(e,t,n,i){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new r.Buf8(o.wsize)),i>=o.wsize?(r.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>i&&(a=i),r.arraySet(o.window,t,n-i,a,o.wnext),(i-=a)?(r.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}t.inflateReset=f,t.inflateReset2=p,t.inflateResetKeep=h,t.inflateInit=function(e){return m(e,15)},t.inflateInit2=m,t.inflate=function(e,t){var n,h,f,p,m,g,v,y,w,_,k,E,S,T,C,I,A,O,D,M,N,j,F,R,P=0,L=new r.Buf8(4),B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return l;(n=e.state).mode===u&&(n.mode=13),m=e.next_out,f=e.output,p=e.next_in,h=e.input,y=n.hold,w=n.bits,_=g=e.avail_in,k=v=e.avail_out,j=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;w<16;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(2&n.wrap&&35615===y){n.check=0,L[0]=255&y,L[1]=y>>>8&255,n.check=a(n.check,L,2,0),y=0,w=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",n.mode=c;break}if(8!=(15&y)){e.msg="unknown compression method",n.mode=c;break}if(w-=4,N=8+(15&(y>>>=4)),0===n.wbits)n.wbits=N;else if(N>n.wbits){e.msg="invalid window size",n.mode=c;break}n.dmax=1<<N,e.adler=n.check=1,n.mode=512&y?10:u,y=0,w=0;break;case 2:for(;w<16;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(n.flags=y,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=c;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=c;break}n.head&&(n.head.text=y>>8&1),512&n.flags&&(L[0]=255&y,L[1]=y>>>8&255,n.check=a(n.check,L,2,0)),y=0,w=0,n.mode=3;case 3:for(;w<32;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}n.head&&(n.head.time=y),512&n.flags&&(L[0]=255&y,L[1]=y>>>8&255,L[2]=y>>>16&255,L[3]=y>>>24&255,n.check=a(n.check,L,4,0)),y=0,w=0,n.mode=4;case 4:for(;w<16;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}n.head&&(n.head.xflags=255&y,n.head.os=y>>8),512&n.flags&&(L[0]=255&y,L[1]=y>>>8&255,n.check=a(n.check,L,2,0)),y=0,w=0,n.mode=5;case 5:if(1024&n.flags){for(;w<16;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}n.length=y,n.head&&(n.head.extra_len=y),512&n.flags&&(L[0]=255&y,L[1]=y>>>8&255,n.check=a(n.check,L,2,0)),y=0,w=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((E=n.length)>g&&(E=g),E&&(n.head&&(N=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,h,p,E,N)),512&n.flags&&(n.check=a(n.check,h,E,p)),g-=E,p+=E,n.length-=E),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===g)break e;E=0;do{N=h[p+E++],n.head&&N&&n.length<65536&&(n.head.name+=String.fromCharCode(N))}while(N&&E<g);if(512&n.flags&&(n.check=a(n.check,h,E,p)),g-=E,p+=E,N)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===g)break e;E=0;do{N=h[p+E++],n.head&&N&&n.length<65536&&(n.head.comment+=String.fromCharCode(N))}while(N&&E<g);if(512&n.flags&&(n.check=a(n.check,h,E,p)),g-=E,p+=E,N)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;w<16;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(y!==(65535&n.check)){e.msg="header crc mismatch",n.mode=c;break}y=0,w=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=u;break;case 10:for(;w<32;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}e.adler=n.check=d(y),y=0,w=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=m,e.avail_out=v,e.next_in=p,e.avail_in=g,n.hold=y,n.bits=w,2;e.adler=n.check=1,n.mode=u;case u:if(5===t||6===t)break e;case 13:if(n.last){y>>>=7&w,w-=7&w,n.mode=27;break}for(;w<3;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}switch(n.last=1&y,w-=1,3&(y>>>=1)){case 0:n.mode=14;break;case 1:if(b(n),n.mode=20,6===t){y>>>=2,w-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=c}y>>>=2,w-=2;break;case 14:for(y>>>=7&w,w-=7&w;w<32;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",n.mode=c;break}if(n.length=65535&y,y=0,w=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(E=n.length){if(E>g&&(E=g),E>v&&(E=v),0===E)break e;r.arraySet(f,h,p,E,m),g-=E,p+=E,v-=E,m+=E,n.length-=E;break}n.mode=u;break;case 17:for(;w<14;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(n.nlen=257+(31&y),w-=5,n.ndist=1+(31&(y>>>=5)),w-=5,n.ncode=4+(15&(y>>>=5)),y>>>=4,w-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=c;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;w<3;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}n.lens[B[n.have++]]=7&y,y>>>=3,w-=3}for(;n.have<19;)n.lens[B[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,j=s(0,n.lens,0,19,n.lencode,0,n.work,F={bits:n.lenbits}),n.lenbits=F.bits,j){e.msg="invalid code lengths set",n.mode=c;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;I=(P=n.lencode[y&(1<<n.lenbits)-1])>>>16&255,A=65535&P,!((C=P>>>24)<=w);){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(A<16)y>>>=C,w-=C,n.lens[n.have++]=A;else{if(16===A){for(R=C+2;w<R;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(y>>>=C,w-=C,0===n.have){e.msg="invalid bit length repeat",n.mode=c;break}N=n.lens[n.have-1],E=3+(3&y),y>>>=2,w-=2}else if(17===A){for(R=C+3;w<R;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}w-=C,N=0,E=3+(7&(y>>>=C)),y>>>=3,w-=3}else{for(R=C+7;w<R;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}w-=C,N=0,E=11+(127&(y>>>=C)),y>>>=7,w-=7}if(n.have+E>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=c;break}for(;E--;)n.lens[n.have++]=N}}if(n.mode===c)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=c;break}if(n.lenbits=9,j=s(1,n.lens,0,n.nlen,n.lencode,0,n.work,F={bits:n.lenbits}),n.lenbits=F.bits,j){e.msg="invalid literal/lengths set",n.mode=c;break}if(n.distbits=6,n.distcode=n.distdyn,j=s(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,F={bits:n.distbits}),n.distbits=F.bits,j){e.msg="invalid distances set",n.mode=c;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(g>=6&&v>=258){e.next_out=m,e.avail_out=v,e.next_in=p,e.avail_in=g,n.hold=y,n.bits=w,o(e,k),m=e.next_out,f=e.output,v=e.avail_out,p=e.next_in,h=e.input,g=e.avail_in,y=n.hold,w=n.bits,n.mode===u&&(n.back=-1);break}for(n.back=0;I=(P=n.lencode[y&(1<<n.lenbits)-1])>>>16&255,A=65535&P,!((C=P>>>24)<=w);){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(I&&0==(240&I)){for(O=C,D=I,M=A;I=(P=n.lencode[M+((y&(1<<O+D)-1)>>O)])>>>16&255,A=65535&P,!(O+(C=P>>>24)<=w);){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}y>>>=O,w-=O,n.back+=O}if(y>>>=C,w-=C,n.back+=C,n.length=A,0===I){n.mode=26;break}if(32&I){n.back=-1,n.mode=u;break}if(64&I){e.msg="invalid literal/length code",n.mode=c;break}n.extra=15&I,n.mode=22;case 22:if(n.extra){for(R=n.extra;w<R;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}n.length+=y&(1<<n.extra)-1,y>>>=n.extra,w-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;I=(P=n.distcode[y&(1<<n.distbits)-1])>>>16&255,A=65535&P,!((C=P>>>24)<=w);){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(0==(240&I)){for(O=C,D=I,M=A;I=(P=n.distcode[M+((y&(1<<O+D)-1)>>O)])>>>16&255,A=65535&P,!(O+(C=P>>>24)<=w);){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}y>>>=O,w-=O,n.back+=O}if(y>>>=C,w-=C,n.back+=C,64&I){e.msg="invalid distance code",n.mode=c;break}n.offset=A,n.extra=15&I,n.mode=24;case 24:if(n.extra){for(R=n.extra;w<R;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}n.offset+=y&(1<<n.extra)-1,y>>>=n.extra,w-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=c;break}n.mode=25;case 25:if(0===v)break e;if(n.offset>(E=k-v)){if((E=n.offset-E)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=c;break}S=E>n.wnext?n.wsize-(E-=n.wnext):n.wnext-E,E>n.length&&(E=n.length),T=n.window}else T=f,S=m-n.offset,E=n.length;E>v&&(E=v),v-=E,n.length-=E;do{f[m++]=T[S++]}while(--E);0===n.length&&(n.mode=21);break;case 26:if(0===v)break e;f[m++]=n.length,v--,n.mode=21;break;case 27:if(n.wrap){for(;w<32;){if(0===g)break e;g--,y|=h[p++]<<w,w+=8}if(e.total_out+=k-=v,n.total+=k,k&&(e.adler=n.check=n.flags?a(n.check,f,k,m-k):i(n.check,f,k,m-k)),k=v,(n.flags?y:d(y))!==n.check){e.msg="incorrect data check",n.mode=c;break}y=0,w=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;w<32;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(y!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=c;break}y=0,w=0}n.mode=29;case 29:j=1;break e;case c:j=-3;break e;case 31:return-4;case 32:default:return l}return e.next_out=m,e.avail_out=v,e.next_in=p,e.avail_in=g,n.hold=y,n.bits=w,(n.wsize||k!==e.avail_out&&n.mode<c&&(n.mode<27||4!==t))&&x(e,e.output,e.next_out,k-e.avail_out)?(n.mode=31,-4):(k-=e.avail_out,e.total_in+=_-=e.avail_in,e.total_out+=k,n.total+=k,n.wrap&&k&&(e.adler=n.check=n.flags?a(n.check,f,k,e.next_out-k):i(n.check,f,k,e.next_out-k)),e.data_type=n.bits+(n.last?64:0)+(n.mode===u?128:0)+(20===n.mode||15===n.mode?256:0),(0===_&&0===k||4===t)&&0===j&&(j=-5),j)},t.inflateEnd=function(e){if(!e||!e.state)return l;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?l:(n.head=t,t.done=!1,0):l},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?l:11===n.mode&&i(1,t,r,0)!==n.check?-3:x(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,0):l},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";var r=n(8);function i(e){for(var t=e.length;--t>=0;)e[t]=0}var a=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],o=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],l=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],u=new Array(576);i(u);var c=new Array(60);i(c);var d=new Array(512);i(d);var h=new Array(256);i(h);var f=new Array(29);i(f);var p,m,g,v=new Array(30);function y(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function b(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function x(e){return e<256?d[e]:d[256+(e>>>7)]}function w(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function _(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,w(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function k(e,t,n){_(e,n[2*t],n[2*t+1])}function E(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function S(e,t,n){var r,i,a=new Array(16),o=0;for(r=1;r<=15;r++)a[r]=o=o+n[r-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=E(a[s]++,s))}}function T(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function C(e){e.bi_valid>8?w(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function I(e,t,n,r){var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]}function A(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&I(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!I(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function O(e,t,n){var r,i,s,l,u=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*u]<<8|e.pending_buf[e.d_buf+2*u+1],i=e.pending_buf[e.l_buf+u],u++,0===r?k(e,i,t):(k(e,(s=h[i])+256+1,t),0!==(l=a[s])&&_(e,i-=f[s],l),k(e,s=x(--r),n),0!==(l=o[s])&&_(e,r-=v[s],l))}while(u<e.last_lit);k(e,256,t)}function D(e,t){var n,r,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<l;n++)0!==a[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)A(e,a,n);i=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],A(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,a[2*i]=a[2*n]+a[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,a[2*n+1]=a[2*r+1]=i,e.heap[1]=i++,A(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,a,o,s,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(a=0;a<=15;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(a=l[2*l[2*(r=e.heap[n])+1]+1]+1)>p&&(a=p,m++),l[2*r+1]=a,r>u||(e.bl_count[a]++,o=0,r>=f&&(o=h[r-f]),e.opt_len+=(s=l[2*r])*(a+o),d&&(e.static_len+=s*(c[2*r+1]+o)));if(0!==m){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(a=p;0!==a;a--)for(r=e.bl_count[a];0!==r;)(i=e.heap[--n])>u||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),r--)}}(e,t),S(a,u,e.bl_count)}function M(e,t,n){var r,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++s<l&&i===o||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4))}function N(e,t,n){var r,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++s<l&&i===o)){if(s<u)do{k(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(k(e,i,e.bl_tree),s--),k(e,16,e.bl_tree),_(e,s-3,2)):s<=10?(k(e,17,e.bl_tree),_(e,s-3,3)):(k(e,18,e.bl_tree),_(e,s-11,7));s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4)}}i(v);var j=!1;function F(e,t,n,i){_(e,0+(i?1:0),3),function(e,t,n,i){C(e),w(e,n),w(e,~n),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}t._tr_init=function(e){j||(function(){var e,t,n,r,i,l=new Array(16);for(n=0,r=0;r<28;r++)for(f[r]=n,e=0;e<1<<a[r];e++)h[n++]=r;for(h[n-1]=r,i=0,r=0;r<16;r++)for(v[r]=i,e=0;e<1<<o[r];e++)d[i++]=r;for(i>>=7;r<30;r++)for(v[r]=i<<7,e=0;e<1<<o[r]-7;e++)d[256+i++]=r;for(t=0;t<=15;t++)l[t]=0;for(e=0;e<=143;)u[2*e+1]=8,e++,l[8]++;for(;e<=255;)u[2*e+1]=9,e++,l[9]++;for(;e<=279;)u[2*e+1]=7,e++,l[7]++;for(;e<=287;)u[2*e+1]=8,e++,l[8]++;for(S(u,287,l),e=0;e<30;e++)c[2*e+1]=5,c[2*e]=E(e,5);p=new y(u,a,257,286,15),m=new y(c,o,0,30,15),g=new y(new Array(0),s,0,19,7)}(),j=!0),e.l_desc=new b(e.dyn_ltree,p),e.d_desc=new b(e.dyn_dtree,m),e.bl_desc=new b(e.bl_tree,g),e.bi_buf=0,e.bi_valid=0,T(e)},t._tr_stored_block=F,t._tr_flush_block=function(e,t,n,r){var i,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),D(e,e.l_desc),D(e,e.d_desc),o=function(e){var t;for(M(e,e.dyn_ltree,e.l_desc.max_code),M(e,e.dyn_dtree,e.d_desc.max_code),D(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*l[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),(a=e.static_len+3+7>>>3)<=(i=e.opt_len+3+7>>>3)&&(i=a)):i=a=n+5,n+4<=i&&-1!==t?F(e,t,n,r):4===e.strategy||a===i?(_(e,2+(r?1:0),3),O(e,u,c)):(_(e,4+(r?1:0),3),function(e,t,n,r){var i;for(_(e,t-257,5),_(e,n-1,5),_(e,r-4,4),i=0;i<r;i++)_(e,e.bl_tree[2*l[i]+1],3);N(e,e.dyn_ltree,t-1),N(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),O(e,e.dyn_ltree,e.dyn_dtree)),T(e),r&&C(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(h[n]+256+1)]++,e.dyn_dtree[2*x(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){_(e,2,3),k(e,256,u),function(e){16===e.bi_valid?(w(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";var r,i=n(8),a=n(50),o=n(29),s=n(28),l=n(49),u=-2,c=258,d=262,h=103,f=113,p=666;function m(e,t){return e.msg=l[t],t}function g(e){return(e<<1)-(e>4?9:0)}function v(e){for(var t=e.length;--t>=0;)e[t]=0}function y(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function b(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,y(e.strm)}function x(e,t){e.pending_buf[e.pending++]=t}function w(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function _(e,t){var n,r,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-d?e.strstart-(e.w_size-d):0,u=e.window,h=e.w_mask,f=e.prev,p=e.strstart+c,m=u[a+o-1],g=u[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(n=t)+o]===g&&u[n+o-1]===m&&u[n]===u[a]&&u[++n]===u[a+1]){a+=2,n++;do{}while(u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&a<p);if(r=c-(p-a),a=p-c,r>o){if(e.match_start=t,o=r,r>=s)break;m=u[a+o-1],g=u[a+o]}}}while((t=f[t&h])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function k(e){var t,n,r,a,l,u,c,h,f,p,m=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=m+(m-d)){i.arraySet(e.window,e.window,m,m,0),e.match_start-=m,e.strstart-=m,e.block_start-=m,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=m?r-m:0}while(--n);t=n=m;do{r=e.prev[--t],e.prev[t]=r>=m?r-m:0}while(--n);a+=m}if(0===e.strm.avail_in)break;if(c=e.window,h=e.strstart+e.lookahead,p=void 0,(p=(u=e.strm).avail_in)>(f=a)&&(p=f),n=0===p?0:(u.avail_in-=p,i.arraySet(c,u.input,u.next_in,p,h),1===u.state.wrap?u.adler=o(u.adler,c,p,h):2===u.state.wrap&&(u.adler=s(u.adler,c,p,h)),u.next_in+=p,u.total_in+=p,p),e.lookahead+=n,e.lookahead+e.insert>=3)for(e.ins_h=e.window[l=e.strstart-e.insert],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+3-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<d&&0!==e.strm.avail_in)}function E(e,t){for(var n,r;;){if(e.lookahead<d){if(k(e),e.lookahead<d&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-d&&(e.match_length=_(e,n)),e.match_length>=3)if(r=a._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}function S(e,t){for(var n,r,i;;){if(e.lookahead<d){if(k(e),e.lookahead<d&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-d&&(e.match_length=_(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(b(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=a._tr_tally(e,0,e.window[e.strstart-1]))&&b(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}function T(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function C(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:f,e.adler=2===t.wrap?0:1,t.last_flush=0,a._tr_init(t),0):m(e,u)}function I(e){var t,n=C(e);return 0===n&&((t=e.state).window_size=2*t.w_size,v(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function A(e,t,n,r,a,o){if(!e)return u;var s=1;if(-1===t&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),a<1||a>9||8!==n||r<8||r>15||t<0||t>9||o<0||o>4)return m(e,u);8===r&&(r=9);var l=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),v(this.dyn_ltree),v(this.dyn_dtree),v(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),v(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),v(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=n,I(e)}r=[new T(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(k(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,b(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-d&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&b(e,!1),1)})),new T(4,4,8,4,E),new T(4,5,16,8,E),new T(4,6,32,32,E),new T(4,4,16,16,S),new T(8,16,32,32,S),new T(8,16,128,128,S),new T(8,32,128,256,S),new T(32,128,258,1024,S),new T(32,258,258,4096,S)],t.deflateInit=function(e,t){return A(e,t,8,15,8,0)},t.deflateInit2=A,t.deflateReset=I,t.deflateResetKeep=C,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?u:(e.state.gzhead=t,0):u},t.deflate=function(e,t){var n,i,o,l;if(!e||!e.state||t>5||t<0)return e?m(e,u):u;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===p&&4!==t)return m(e,0===e.avail_out?-5:u);if(i.strm=e,n=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,x(i,31),x(i,139),x(i,8),i.gzhead?(x(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),x(i,255&i.gzhead.time),x(i,i.gzhead.time>>8&255),x(i,i.gzhead.time>>16&255),x(i,i.gzhead.time>>24&255),x(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),x(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(x(i,255&i.gzhead.extra.length),x(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(x(i,0),x(i,0),x(i,0),x(i,0),x(i,0),x(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),x(i,3),i.status=f);else{var d=8+(i.w_bits-8<<4)<<8;d|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(d|=32),d+=31-d%31,i.status=f,w(i,d),0!==i.strstart&&(w(i,e.adler>>>16),w(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),y(e),o=i.pending,i.pending!==i.pending_buf_size));)x(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),y(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,x(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),y(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,x(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.status=h)}else i.status=h;if(i.status===h&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&y(e),i.pending+2<=i.pending_buf_size&&(x(i,255&e.adler),x(i,e.adler>>8&255),e.adler=0,i.status=f)):i.status=f),0!==i.pending){if(y(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&g(t)<=g(n)&&4!==t)return m(e,-5);if(i.status===p&&0!==e.avail_in)return m(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&i.status!==p){var _=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(k(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var n,r,i,o,s=e.window;;){if(e.lookahead<=c){if(k(e),e.lookahead<=c&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=s[i=e.strstart-1])===s[++i]&&r===s[++i]&&r===s[++i]){o=e.strstart+c;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<o);e.match_length=c-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=a._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}(i,t):r[i.level].func(i,t);if(3!==_&&4!==_||(i.status=p),1===_||3===_)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===_&&(1===t?a._tr_align(i):5!==t&&(a._tr_stored_block(i,0,0,!1),3===t&&(v(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),y(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(x(i,255&e.adler),x(i,e.adler>>8&255),x(i,e.adler>>16&255),x(i,e.adler>>24&255),x(i,255&e.total_in),x(i,e.total_in>>8&255),x(i,e.total_in>>16&255),x(i,e.total_in>>24&255)):(w(i,e.adler>>>16),w(i,65535&e.adler)),y(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==h&&t!==f&&t!==p?m(e,u):(e.state=null,t===f?m(e,-3):0):u},t.deflateSetDictionary=function(e,t){var n,r,a,s,l,c,d,h,f=t.length;if(!e||!e.state)return u;if(2===(s=(n=e.state).wrap)||1===s&&42!==n.status||n.lookahead)return u;for(1===s&&(e.adler=o(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===s&&(v(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new i.Buf8(n.w_size),i.arraySet(h,t,f-n.w_size,n.w_size,0),t=h,f=n.w_size),l=e.avail_in,c=e.next_in,d=e.input,e.avail_in=f,e.next_in=0,e.input=t,k(n);n.lookahead>=3;){r=n.strstart,a=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--a);n.strstart=r,n.lookahead=2,k(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=c,e.input=d,e.avail_in=l,n.wrap=s,0},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t){e.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t,n){"use strict";(function(e,r){var i=n(31),a=n(52),o=n(51),s=n(48),l=n(45);for(var u in l)t[u]=l[u];function c(e){if("number"!=typeof e||e<t.DEFLATE||e>t.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=e,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}t.NONE=0,t.DEFLATE=1,t.INFLATE=2,t.GZIP=3,t.GUNZIP=4,t.DEFLATERAW=5,t.INFLATERAW=6,t.UNZIP=7,c.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,i(this.init_done,"close before init"),i(this.mode<=t.UNZIP),this.mode===t.DEFLATE||this.mode===t.GZIP||this.mode===t.DEFLATERAW?o.deflateEnd(this.strm):this.mode!==t.INFLATE&&this.mode!==t.GUNZIP&&this.mode!==t.INFLATERAW&&this.mode!==t.UNZIP||s.inflateEnd(this.strm),this.mode=t.NONE,this.dictionary=null)},c.prototype.write=function(e,t,n,r,i,a,o){return this._write(!0,e,t,n,r,i,a,o)},c.prototype.writeSync=function(e,t,n,r,i,a,o){return this._write(!1,e,t,n,r,i,a,o)},c.prototype._write=function(n,a,o,s,l,u,c,d){if(i.equal(arguments.length,8),i(this.init_done,"write before init"),i(this.mode!==t.NONE,"already finalized"),i.equal(!1,this.write_in_progress,"write already in progress"),i.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,i.equal(!1,void 0===a,"must provide flush value"),this.write_in_progress=!0,a!==t.Z_NO_FLUSH&&a!==t.Z_PARTIAL_FLUSH&&a!==t.Z_SYNC_FLUSH&&a!==t.Z_FULL_FLUSH&&a!==t.Z_FINISH&&a!==t.Z_BLOCK)throw new Error("Invalid flush value");if(null==o&&(o=e.alloc(0),l=0,s=0),this.strm.avail_in=l,this.strm.input=o,this.strm.next_in=s,this.strm.avail_out=d,this.strm.output=u,this.strm.next_out=c,this.flush=a,!n)return this._process(),this._checkError()?this._afterSync():void 0;var h=this;return r.nextTick((function(){h._process(),h._after()})),this},c.prototype._afterSync=function(){var e=this.strm.avail_out,t=this.strm.avail_in;return this.write_in_progress=!1,[t,e]},c.prototype._process=function(){var e=null;switch(this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflate(this.strm,this.flush);break;case t.UNZIP:switch(this.strm.avail_in>0&&(e=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===e)break;if(31!==this.strm.input[e]){this.mode=t.INFLATE;break}if(this.gzip_id_bytes_read=1,e++,1===this.strm.avail_in)break;case 1:if(null===e)break;139===this.strm.input[e]?(this.gzip_id_bytes_read=2,this.mode=t.GUNZIP):this.mode=t.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:for(this.err=s.inflate(this.strm,this.flush),this.err===t.Z_NEED_DICT&&this.dictionary&&(this.err=s.inflateSetDictionary(this.strm,this.dictionary),this.err===t.Z_OK?this.err=s.inflate(this.strm,this.flush):this.err===t.Z_DATA_ERROR&&(this.err=t.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===t.GUNZIP&&this.err===t.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=s.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},c.prototype._checkError=function(){switch(this.err){case t.Z_OK:case t.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===t.Z_FINISH)return this._error("unexpected end of file"),!1;break;case t.Z_STREAM_END:break;case t.Z_NEED_DICT:return this._error(null==this.dictionary?"Missing dictionary":"Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},c.prototype._after=function(){if(this._checkError()){var e=this.strm.avail_out,t=this.strm.avail_in;this.write_in_progress=!1,this.callback(t,e),this.pending_close&&this.close()}},c.prototype._error=function(e){this.strm.msg&&(e=this.strm.msg),this.onerror(e,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},c.prototype.init=function(e,n,r,a,o){i(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),i(e>=8&&e<=15,"invalid windowBits"),i(n>=-1&&n<=9,"invalid compression level"),i(r>=1&&r<=9,"invalid memlevel"),i(a===t.Z_FILTERED||a===t.Z_HUFFMAN_ONLY||a===t.Z_RLE||a===t.Z_FIXED||a===t.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(n,e,r,a,o),this._setDictionary()},c.prototype.params=function(){throw new Error("deflateParams Not supported")},c.prototype.reset=function(){this._reset(),this._setDictionary()},c.prototype._init=function(e,n,r,i,l){switch(this.level=e,this.windowBits=n,this.memLevel=r,this.strategy=i,this.flush=t.Z_NO_FLUSH,this.err=t.Z_OK,this.mode!==t.GZIP&&this.mode!==t.GUNZIP||(this.windowBits+=16),this.mode===t.UNZIP&&(this.windowBits+=32),this.mode!==t.DEFLATERAW&&this.mode!==t.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new a,this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflateInit2(this.strm,this.level,t.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:case t.UNZIP:this.err=s.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==t.Z_OK&&this._error("Init error"),this.dictionary=l,this.write_in_progress=!1,this.init_done=!0},c.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:this.err=o.deflateSetDictionary(this.strm,this.dictionary)}this.err!==t.Z_OK&&this._error("Failed to set dictionary")}},c.prototype._reset=function(){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:case t.GZIP:this.err=o.deflateReset(this.strm);break;case t.INFLATE:case t.INFLATERAW:case t.GUNZIP:this.err=s.inflateReset(this.strm)}this.err!==t.Z_OK&&this._error("Failed to reset stream")},t.Zlib=c}).call(this,n(1).Buffer,n(3))},function(e,t,n){e.exports=n(20).PassThrough},function(e,t,n){e.exports=n(20).Transform},function(e,t,n){e.exports=n(2)},function(e,t,n){e.exports=n(19)},function(e,t,n){"use strict";e.exports=a;var r=n(32),i=n(6);function a(e){if(!(this instanceof a))return new a(e);r.call(this,e)}i.inherits=n(5),i.inherits(a,r),a.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){(function(t){function n(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this,n(0))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,i,a,o,s,l=1,u={},c=!1,d=e.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(e);h=h&&h.setTimeout?h:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){p(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?(o="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&p(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),r=function(t){e.postMessage(o+t,"*")}):e.MessageChannel?((a=new MessageChannel).port1.onmessage=function(e){p(e.data)},r=function(e){a.port2.postMessage(e)}):d&&"onreadystatechange"in d.createElement("script")?(i=d.documentElement,r=function(e){var t=d.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):r=function(e){setTimeout(p,0,e)},h.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];return u[l]={callback:e,args:t},r(l),l++},h.clearImmediate=f}function f(e){delete u[e]}function p(e){if(c)setTimeout(p,0,e);else{var t=u[e];if(t){c=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{f(e),c=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(0),n(3))},function(e,t,n){(function(e){var r=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(r.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(r.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(62),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(0))},function(e,t){},function(e,t,n){"use strict";var r=n(9).Buffer,i=n(64);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return this.head=1===this.length?this.tail=null:this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t=r.allocUnsafe(e>>>0),n=this.head,i=0;n;)n.data.copy(t,i),i+=n.data.length,n=n.next;return t},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,n){e.exports=i;var r=n(21).EventEmitter;function i(){r.call(this)}n(5)(i,r),i.Readable=n(20),i.Writable=n(59),i.Duplex=n(58),i.Transform=n(57),i.PassThrough=n(56),i.Stream=i,i.prototype.pipe=function(e,t){var n=this;function i(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function a(){n.readable&&n.resume&&n.resume()}n.on("data",i),e.on("drain",a),e._isStdio||t&&!1===t.end||(n.on("end",s),n.on("close",l));var o=!1;function s(){o||(o=!0,e.end())}function l(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function u(e){if(c(),0===r.listenerCount(this,"error"))throw e}function c(){n.removeListener("data",i),e.removeListener("drain",a),n.removeListener("end",s),n.removeListener("close",l),n.removeListener("error",u),e.removeListener("error",u),n.removeListener("end",c),n.removeListener("close",c),e.removeListener("close",c)}return n.on("error",u),e.on("error",u),n.on("end",c),n.on("close",c),e.on("close",c),e.emit("pipe",n),e}},function(e,t,n){"use strict";(function(e){var r=n(1).Buffer,i=n(67).Transform,a=n(55),o=n(30),s=n(31).ok,l=n(1).kMaxLength,u="Cannot create final Buffer. It would be larger than 0x"+l.toString(16)+" bytes";a.Z_MIN_WINDOWBITS=8,a.Z_MAX_WINDOWBITS=15,a.Z_DEFAULT_WINDOWBITS=15,a.Z_MIN_CHUNK=64,a.Z_MAX_CHUNK=1/0,a.Z_DEFAULT_CHUNK=16384,a.Z_MIN_MEMLEVEL=1,a.Z_MAX_MEMLEVEL=9,a.Z_DEFAULT_MEMLEVEL=8,a.Z_MIN_LEVEL=-1,a.Z_MAX_LEVEL=9,a.Z_DEFAULT_LEVEL=a.Z_DEFAULT_COMPRESSION;for(var c=Object.keys(a),d=0;d<c.length;d++){var h=c[d];h.match(/^Z/)&&Object.defineProperty(t,h,{enumerable:!0,value:a[h],writable:!1})}for(var f={Z_OK:a.Z_OK,Z_STREAM_END:a.Z_STREAM_END,Z_NEED_DICT:a.Z_NEED_DICT,Z_ERRNO:a.Z_ERRNO,Z_STREAM_ERROR:a.Z_STREAM_ERROR,Z_DATA_ERROR:a.Z_DATA_ERROR,Z_MEM_ERROR:a.Z_MEM_ERROR,Z_BUF_ERROR:a.Z_BUF_ERROR,Z_VERSION_ERROR:a.Z_VERSION_ERROR},p=Object.keys(f),m=0;m<p.length;m++){var g=p[m];f[f[g]]=g}function v(e,t,n){var i=[],a=0;function o(){for(var t;null!==(t=e.read());)i.push(t),a+=t.length;e.once("readable",o)}function s(){var t,o=null;a>=l?o=new RangeError(u):t=r.concat(i,a),i=[],e.close(),n(o,t)}e.on("error",(function(t){e.removeListener("end",s),e.removeListener("readable",o),n(t)})),e.on("end",s),e.end(t),o()}function y(e,t){if("string"==typeof t&&(t=r.from(t)),!r.isBuffer(t))throw new TypeError("Not a string or buffer");return e._processChunk(t,e._finishFlushFlag)}function b(e){if(!(this instanceof b))return new b(e);C.call(this,e,a.DEFLATE)}function x(e){if(!(this instanceof x))return new x(e);C.call(this,e,a.INFLATE)}function w(e){if(!(this instanceof w))return new w(e);C.call(this,e,a.GZIP)}function _(e){if(!(this instanceof _))return new _(e);C.call(this,e,a.GUNZIP)}function k(e){if(!(this instanceof k))return new k(e);C.call(this,e,a.DEFLATERAW)}function E(e){if(!(this instanceof E))return new E(e);C.call(this,e,a.INFLATERAW)}function S(e){if(!(this instanceof S))return new S(e);C.call(this,e,a.UNZIP)}function T(e){return e===a.Z_NO_FLUSH||e===a.Z_PARTIAL_FLUSH||e===a.Z_SYNC_FLUSH||e===a.Z_FULL_FLUSH||e===a.Z_FINISH||e===a.Z_BLOCK}function C(e,n){var o=this;if(this._opts=e=e||{},this._chunkSize=e.chunkSize||t.Z_DEFAULT_CHUNK,i.call(this,e),e.flush&&!T(e.flush))throw new Error("Invalid flush flag: "+e.flush);if(e.finishFlush&&!T(e.finishFlush))throw new Error("Invalid flush flag: "+e.finishFlush);if(this._flushFlag=e.flush||a.Z_NO_FLUSH,this._finishFlushFlag=void 0!==e.finishFlush?e.finishFlush:a.Z_FINISH,e.chunkSize&&(e.chunkSize<t.Z_MIN_CHUNK||e.chunkSize>t.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<t.Z_MIN_WINDOWBITS||e.windowBits>t.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<t.Z_MIN_LEVEL||e.level>t.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<t.Z_MIN_MEMLEVEL||e.memLevel>t.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=t.Z_FILTERED&&e.strategy!=t.Z_HUFFMAN_ONLY&&e.strategy!=t.Z_RLE&&e.strategy!=t.Z_FIXED&&e.strategy!=t.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!r.isBuffer(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new a.Zlib(n);var s=this;this._hadError=!1,this._handle.onerror=function(e,n){I(s),s._hadError=!0;var r=new Error(e);r.errno=n,r.code=t.codes[n],s.emit("error",r)};var l=t.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(l=e.level);var u=t.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(u=e.strategy),this._handle.init(e.windowBits||t.Z_DEFAULT_WINDOWBITS,l,e.memLevel||t.Z_DEFAULT_MEMLEVEL,u,e.dictionary),this._buffer=r.allocUnsafe(this._chunkSize),this._offset=0,this._level=l,this._strategy=u,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!o._handle},configurable:!0,enumerable:!0})}function I(t,n){n&&e.nextTick(n),t._handle&&(t._handle.close(),t._handle=null)}function A(e){e.emit("close")}Object.defineProperty(t,"codes",{enumerable:!0,value:Object.freeze(f),writable:!1}),t.Deflate=b,t.Inflate=x,t.Gzip=w,t.Gunzip=_,t.DeflateRaw=k,t.InflateRaw=E,t.Unzip=S,t.createDeflate=function(e){return new b(e)},t.createInflate=function(e){return new x(e)},t.createDeflateRaw=function(e){return new k(e)},t.createInflateRaw=function(e){return new E(e)},t.createGzip=function(e){return new w(e)},t.createGunzip=function(e){return new _(e)},t.createUnzip=function(e){return new S(e)},t.deflate=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new b(t),e,n)},t.deflateSync=function(e,t){return y(new b(t),e)},t.gzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new w(t),e,n)},t.gzipSync=function(e,t){return y(new w(t),e)},t.deflateRaw=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new k(t),e,n)},t.deflateRawSync=function(e,t){return y(new k(t),e)},t.unzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new S(t),e,n)},t.unzipSync=function(e,t){return y(new S(t),e)},t.inflate=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new x(t),e,n)},t.inflateSync=function(e,t){return y(new x(t),e)},t.gunzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new _(t),e,n)},t.gunzipSync=function(e,t){return y(new _(t),e)},t.inflateRaw=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new E(t),e,n)},t.inflateRawSync=function(e,t){return y(new E(t),e)},o.inherits(C,i),C.prototype.params=function(n,r,i){if(n<t.Z_MIN_LEVEL||n>t.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+n);if(r!=t.Z_FILTERED&&r!=t.Z_HUFFMAN_ONLY&&r!=t.Z_RLE&&r!=t.Z_FIXED&&r!=t.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+r);if(this._level!==n||this._strategy!==r){var o=this;this.flush(a.Z_SYNC_FLUSH,(function(){s(o._handle,"zlib binding closed"),o._handle.params(n,r),o._hadError||(o._level=n,o._strategy=r,i&&i())}))}else e.nextTick(i)},C.prototype.reset=function(){return s(this._handle,"zlib binding closed"),this._handle.reset()},C.prototype._flush=function(e){this._transform(r.alloc(0),"",e)},C.prototype.flush=function(t,n){var i=this,o=this._writableState;("function"==typeof t||void 0===t&&!n)&&(n=t,t=a.Z_FULL_FLUSH),o.ended?n&&e.nextTick(n):o.ending?n&&this.once("end",n):o.needDrain?n&&this.once("drain",(function(){return i.flush(t,n)})):(this._flushFlag=t,this.write(r.alloc(0),"",n))},C.prototype.close=function(t){I(this,t),e.nextTick(A,this)},C.prototype._transform=function(e,t,n){var i,o=this._writableState,s=(o.ending||o.ended)&&(!e||o.length===e.length);return null===e||r.isBuffer(e)?this._handle?(s?i=this._finishFlushFlag:(i=this._flushFlag,e.length>=o.length&&(this._flushFlag=this._opts.flush||a.Z_NO_FLUSH)),void this._processChunk(e,i,n)):n(new Error("zlib binding closed")):n(new Error("invalid input"))},C.prototype._processChunk=function(e,t,n){var i=e&&e.length,a=this._chunkSize-this._offset,o=0,c=this,d="function"==typeof n;if(!d){var h,f=[],p=0;this.on("error",(function(e){h=e})),s(this._handle,"zlib binding closed");do{var m=this._handle.writeSync(t,e,o,i,this._buffer,this._offset,a)}while(!this._hadError&&y(m[0],m[1]));if(this._hadError)throw h;if(p>=l)throw I(this),new RangeError(u);var g=r.concat(f,p);return I(this),g}s(this._handle,"zlib binding closed");var v=this._handle.write(t,e,o,i,this._buffer,this._offset,a);function y(l,u){if(this&&(this.buffer=null,this.callback=null),!c._hadError){var h=a-u;if(s(h>=0,"have should not go down"),h>0){var m=c._buffer.slice(c._offset,c._offset+h);c._offset+=h,d?c.push(m):(f.push(m),p+=m.length)}if((0===u||c._offset>=c._chunkSize)&&(a=c._chunkSize,c._offset=0,c._buffer=r.allocUnsafe(c._chunkSize)),0===u){if(o+=i-l,i=l,!d)return!0;var g=c._handle.write(t,e,o,i,c._buffer,c._offset,c._chunkSize);return g.callback=y,void(g.buffer=e)}if(!d)return!1;n()}}v.buffer=e,v.callback=y},o.inherits(b,C),o.inherits(x,C),o.inherits(w,C),o.inherits(_,C),o.inherits(k,C),o.inherits(E,C),o.inherits(S,C)}).call(this,n(3))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,h){if(void 0===t)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";return function(e,t){for(var n in e.elements)e.elements.hasOwnProperty(n)&&(t.elements[n]=e.elements[n]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}(f=(0,l.default)(t,h),function(l){var f=function(e){if(void 0===e.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var n=e.elements.x00020010;return c.readFixedString(t,n.dataOffset,n.length)}(l),p=function(e){return"1.2.840.10008.1.2"!==e}(f),m=function(o,l){if("1.2.840.10008.1.2.1.99"===o){if(h&&h.inflater){var c=h.inflater(t,l);return new a.default(s.default,c,0)}if(void 0!==e&&this.module!==e){var d=n(68),f=(0,u.default)(t,l,t.length-l),p=d.inflateRawSync(f),m=(0,r.default)(t,p.length+l);return t.copy(m,0,0,l),p.copy(m,l),new a.default(s.default,m,0)}if("undefined"!=typeof pako){var g=t.slice(l),v=pako.inflateRaw(g),y=(0,r.default)(t,v.length+l);return y.set(t.slice(0,l),0),y.set(v,l),new a.default(s.default,y,0)}throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax"}return new a.default("1.2.840.10008.1.2.2"===o?i.default:s.default,t,l)}(f,l.position),g=new o.default(m.byteArrayParser,m.byteArray,{});g.warnings=m.warnings;try{p?d.parseDicomDataSetExplicit(g,m,m.byteArray.length,h):d.parseDicomDataSetImplicit(g,m,m.byteArray.length,h)}catch(e){throw{exception:e,dataSet:g}}return g}(f));var f};var r=f(n(23)),i=f(n(38)),a=f(n(12)),o=f(n(7)),s=f(n(22)),l=f(n(37)),u=f(n(11)),c=h(n(14)),d=h(n(16));function h(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function f(e){return e&&e.__esModule?e:{default:e}}}).call(this,n(69)(e))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="1.8.5"},function(e,t){t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,l=(1<<s)-1,u=l>>1,c=-7,d=n?i-1:0,h=n?-1:1,f=e[t+d];for(d+=h,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+e[t+d],d+=h,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=r;c>0;o=256*o+e[t+d],d+=h,c-=8);if(0===a)a=1-u;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),a-=u}return(f?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,l,u=8*a-i-1,c=(1<<u)-1,d=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:a-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+d>=1?h/l:h*Math.pow(2,1-d))*l>=2&&(o++,l/=2),o+d>=c?(s=0,o=c):o+d>=1?(s=(t*l-1)*Math.pow(2,i),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[n+f]=255&o,f+=p,o/=256,u-=8);e[n+f-p]|=128*m}},function(e,t,n){"use strict";t.byteLength=function(e){return 3*e.length/4-u(e)},t.toByteArray=function(e){var t,n,r,o,s,l=e.length;o=u(e),s=new a(3*l/4-o),n=o>0?l-4:l;var c=0;for(t=0;t<n;t+=4)r=i[e.charCodeAt(t)]<<18|i[e.charCodeAt(t+1)]<<12|i[e.charCodeAt(t+2)]<<6|i[e.charCodeAt(t+3)],s[c++]=r>>16&255,s[c++]=r>>8&255,s[c++]=255&r;return 2===o?(r=i[e.charCodeAt(t)]<<2|i[e.charCodeAt(t+1)]>>4,s[c++]=255&r):1===o&&(r=i[e.charCodeAt(t)]<<10|i[e.charCodeAt(t+1)]<<4|i[e.charCodeAt(t+2)]>>2,s[c++]=r>>8&255,s[c++]=255&r),s},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a="",o=[],s=0,l=n-i;s<l;s+=16383)o.push(c(e,s,s+16383>l?l:s+16383));return 1===i?(a+=r[(t=e[n-1])>>2],a+=r[t<<4&63],a+="=="):2===i&&(a+=r[(t=(e[n-2]<<8)+e[n-1])>>10],a+=r[t>>4&63],a+=r[t<<2&63],a+="="),o.push(a),o.join("")};for(var r=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=o.length;s<l;++s)r[s]=o[s],i[o.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function c(e,t,n){for(var i,a=[],o=t;o<n;o+=3)a.push(r[(i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]))>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t,n){"use strict";function r(e,t){return 255===e.byteArray[t]&&217===e.byteArray[t+1]}function i(e,t,n){var i=t.fragments[n];return!(!r(e,i.position+i.length-2)&&!r(e,i.position+i.length-3))}function a(e,t,n){for(var r=n;r<t.fragments.length;r++)if(i(e,t,r))return r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===t)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==t.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==t.encapsulatedPixelData)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n&&n.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";n=n||t.fragments;for(var r=[],i=0;;){r.push(t.fragments[i].offset);var o=a(e,t,i);if(void 0===o||o===t.fragments.length-1)return r;i=o+1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,n){if(void 0===t)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";n=n||{omitPrivateAttibutes:!0,maxElementLength:128};var r={};for(var o in t.elements){var s=t.elements[o];if(!0!==n.omitPrivateAttibutes||!a.isPrivateTag(o))if(s.items){for(var l=[],u=0;u<s.items.length;u++)l.push(e(s.items[u].dataSet,n));r[o]=l}else{var c;c=void 0,s.length<n.maxElementLength&&(c=(0,i.default)(t,s)),r[o]=void 0!==c?c:{dataOffset:s.dataOffset,length:s.length}}}return r};var r,i=(r=n(43))&&r.__esModule?r:{default:r},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e&&8===e.length){var n=parseInt(e.substring(0,4),10),r=parseInt(e.substring(4,6),10),i=parseInt(e.substring(6,8),10);if(t&&!0!==function(e,t,n){return!isNaN(n)&&t>0&&t<=12&&e>0&&e<=function(e,t){switch(e){case 2:return t%4==0&&t%100||t%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(t,n)}(i,r,n))throw"invalid DA '"+e+"'";return{year:n,month:r,day:i}}if(t)throw"invalid DA '"+e+"'"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.length>=2){var n=parseInt(e.substring(0,2),10),r=e.length>=4?parseInt(e.substring(2,4),10):void 0,i=e.length>=6?parseInt(e.substring(4,6),10):void 0,a=e.length>=8?e.substring(7,13):void 0,o=a?parseInt(a,10)*Math.pow(10,6-a.length):void 0;if(t&&(isNaN(n)||void 0!==r&&isNaN(r)||void 0!==i&&isNaN(i)||void 0!==o&&isNaN(o)||n<0||n>23||r&&(r<0||r>59)||i&&(i<0||i>59)||o&&(o<0||o>999999)))throw"invalid TM '"+e+"'";return{hours:n,minutes:r,seconds:i,fractionalSeconds:o}}if(t)throw"invalid TM '"+e+"'"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createJPEGBasicOffsetTable=t.explicitDataSetToJS=t.explicitElementToString=t.parseDA=t.parseTM=t.parsePN=t.isPrivateTag=t.isStringVr=void 0;var r=n(17),i=u(n(77)),a=u(n(76)),o=u(n(43)),s=u(n(75)),l=u(n(74));function u(e){return e&&e.__esModule?e:{default:e}}t.isStringVr=r.isStringVr,t.isPrivateTag=r.isPrivateTag,t.parsePN=r.parsePN,t.parseTM=i.default,t.parseDA=a.default,t.explicitElementToString=o.default,t.explicitDataSetToJS=s.default,t.createJPEGBasicOffsetTable=l.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readTag=t.readSequenceItem=t.readSequenceItemsImplicit=t.readSequenceItemsExplicit=t.readPart10Header=t.readEncapsulatedPixelDataFromFragments=t.readEncapsulatedPixelData=t.readEncapsulatedImageFrame=t.readDicomElementImplicit=t.readDicomElementExplicit=t.parseDicom=t.littleEndianByteArrayParser=t.findItemDelimitationItemAndSetElementLength=t.findEndOfEncapsulatedElement=t.findAndSetUNElementLength=t.DataSet=t.sharedCopy=t.ByteStream=t.bigEndianByteArrayParser=t.version=t.alloc=t.readFixedString=t.parseDicomDataSetImplicit=t.parseDicomDataSetExplicit=t.createJPEGBasicOffsetTable=t.explicitDataSetToJS=t.explicitElementToString=t.parseDA=t.parseTM=t.parsePN=t.isPrivateTag=t.isStringVr=void 0;var r=n(78),i=n(16),a=n(14),o=C(n(23)),s=C(n(71)),l=C(n(38)),u=C(n(12)),c=C(n(11)),d=C(n(7)),h=C(n(41)),f=C(n(42)),p=C(n(24)),m=C(n(22)),g=C(n(70)),v=C(n(15)),y=C(n(25)),b=C(n(27)),x=C(n(44)),w=C(n(18)),_=C(n(37)),k=C(n(40)),E=C(n(26)),S=C(n(13)),T=C(n(4));function C(e){return e&&e.__esModule?e:{default:e}}var I={isStringVr:r.isStringVr,isPrivateTag:r.isPrivateTag,parsePN:r.parsePN,parseTM:r.parseTM,parseDA:r.parseDA,explicitElementToString:r.explicitElementToString,explicitDataSetToJS:r.explicitDataSetToJS,createJPEGBasicOffsetTable:r.createJPEGBasicOffsetTable,parseDicomDataSetExplicit:i.parseDicomDataSetExplicit,parseDicomDataSetImplicit:i.parseDicomDataSetImplicit,readFixedString:a.readFixedString,alloc:o.default,version:s.default,bigEndianByteArrayParser:l.default,ByteStream:u.default,sharedCopy:c.default,DataSet:d.default,findAndSetUNElementLength:h.default,findEndOfEncapsulatedElement:f.default,findItemDelimitationItemAndSetElementLength:p.default,littleEndianByteArrayParser:m.default,parseDicom:g.default,readDicomElementExplicit:v.default,readDicomElementImplicit:y.default,readEncapsulatedImageFrame:b.default,readEncapsulatedPixelData:x.default,readEncapsulatedPixelDataFromFragments:w.default,readPart10Header:_.default,readSequenceItemsExplicit:k.default,readSequenceItemsImplicit:E.default,readSequenceItem:S.default,readTag:T.default};t.isStringVr=r.isStringVr,t.isPrivateTag=r.isPrivateTag,t.parsePN=r.parsePN,t.parseTM=r.parseTM,t.parseDA=r.parseDA,t.explicitElementToString=r.explicitElementToString,t.explicitDataSetToJS=r.explicitDataSetToJS,t.createJPEGBasicOffsetTable=r.createJPEGBasicOffsetTable,t.parseDicomDataSetExplicit=i.parseDicomDataSetExplicit,t.parseDicomDataSetImplicit=i.parseDicomDataSetImplicit,t.readFixedString=a.readFixedString,t.alloc=o.default,t.version=s.default,t.bigEndianByteArrayParser=l.default,t.ByteStream=u.default,t.sharedCopy=c.default,t.DataSet=d.default,t.findAndSetUNElementLength=h.default,t.findEndOfEncapsulatedElement=f.default,t.findItemDelimitationItemAndSetElementLength=p.default,t.littleEndianByteArrayParser=m.default,t.parseDicom=g.default,t.readDicomElementExplicit=v.default,t.readDicomElementImplicit=y.default,t.readEncapsulatedImageFrame=b.default,t.readEncapsulatedPixelData=x.default,t.readEncapsulatedPixelDataFromFragments=w.default,t.readPart10Header=_.default,t.readSequenceItemsExplicit=k.default,t.readSequenceItemsImplicit=E.default,t.readSequenceItem=S.default,t.readTag=T.default,t.default=I}])},uDiL:function(e,t,n){(function(e){var r;!function(e,i,a){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function l(e,t){var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(t,n,t,i))||(i.exports=r):this.xor128=l}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},v6YA:function(e,t,n){const r=n("MpxT"),i=n("8GxW");e.exports=(e,t,n)=>{const a=[];let o=null,s=null;const l=e.sort((e,t)=>i(e,t,n));for(const i of l)r(i,t,n)?(s=i,o||(o=i)):(s&&a.push([o,s]),s=null,o=null);o&&a.push([o,null]);const u=[];for(const[r,i]of a)u.push(r===i?r:i||r!==l[0]?i?r===l[0]?"<="+i:`${r} - ${i}`:">="+r:"*");const c=u.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return c.length<d.length?c:t}},vwDW:function(e,t,n){const r=Symbol("SemVer ANY");class i{static get ANY(){return r}constructor(e,t){if(t=a(t),e instanceof i){if(e.loose===!!t.loose)return e;e=e.value}u("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.value=this.semver===r?"":this.operator+this.semver.version,u("comp",this)}parse(e){const t=e.match(this.options.loose?o[s.COMPARATORLOOSE]:o[s.COMPARATOR]);if(!t)throw new TypeError("Invalid comparator: "+e);this.operator=void 0!==t[1]?t[1]:"","="===this.operator&&(this.operator=""),this.semver=t[2]?new c(t[2],this.options.loose):r}toString(){return this.value}test(e){if(u("Comparator.test",e,this.options.loose),this.semver===r||e===r)return!0;if("string"==typeof e)try{e=new c(e,this.options)}catch(t){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof i))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new d(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new d(this.value,t).test(e.semver);const n=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),r=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),a=this.semver.version===e.semver.version,o=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),s=l(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),u=l(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||r||a&&o||s||u}}e.exports=i;const a=n("4S+G"),{re:o,t:s}=n("IsDc"),l=n("VMJL"),u=n("DXxi"),c=n("3wIk"),d=n("ex/Z")},xfvg:function(e,t,n){const r=n("8GxW");e.exports=(e,t,n)=>0===r(e,t,n)},yLV6:function(e,t,n){var r;!function(i,a,o,s){"use strict";var l,u=["","webkit","Moz","MS","ms","o"],c=a.createElement("div"),d=Math.round,h=Math.abs,f=Date.now;function p(e,t,n){return setTimeout(w(e,n),t)}function m(e,t,n){return!!Array.isArray(e)&&(g(e,n[t],n),!0)}function g(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==s)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function v(e,t,n){var r="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=i.console&&(i.console.warn||i.console.log);return a&&a.call(i.console,r,n),e.apply(this,arguments)}}l="function"!=typeof Object.assign?function(e){if(e===s||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==s&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}:Object.assign;var y=v((function(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;)(!n||n&&e[r[i]]===s)&&(e[r[i]]=t[r[i]]),i++;return e}),"extend","Use `assign`."),b=v((function(e,t){return y(e,t,!0)}),"merge","Use `assign`.");function x(e,t,n){var r,i=t.prototype;(r=e.prototype=Object.create(i)).constructor=e,r._super=i,n&&l(r,n)}function w(e,t){return function(){return e.apply(t,arguments)}}function _(e,t){return"function"==typeof e?e.apply(t&&t[0]||s,t):e}function k(e,t){return e===s?t:e}function E(e,t,n){g(I(t),(function(t){e.addEventListener(t,n,!1)}))}function S(e,t,n){g(I(t),(function(t){e.removeEventListener(t,n,!1)}))}function T(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function C(e,t){return e.indexOf(t)>-1}function I(e){return e.trim().split(/\s+/g)}function A(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function O(e){return Array.prototype.slice.call(e,0)}function D(e,t,n){for(var r=[],i=[],a=0;a<e.length;){var o=t?e[a][t]:e[a];A(i,o)<0&&r.push(e[a]),i[a]=o,a++}return n&&(r=t?r.sort((function(e,n){return e[t]>n[t]})):r.sort()),r}function M(e,t){for(var n,r,i=t[0].toUpperCase()+t.slice(1),a=0;a<u.length;){if((r=(n=u[a])?n+i:t)in e)return r;a++}return s}var N=1;function j(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||i}var F="ontouchstart"in i,R=M(i,"PointerEvent")!==s,P=F&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),L="touch",B="mouse",$=["x","y"],z=["clientX","clientY"];function U(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){_(e.options.enable,[e])&&n.handler(t)},this.init()}function H(e,t,n){var r=n.pointers.length,i=n.changedPointers.length,a=1&t&&r-i==0,o=12&t&&r-i==0;n.isFirst=!!a,n.isFinal=!!o,a&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,i=r.length;n.firstInput||(n.firstInput=W(t)),i>1&&!n.firstMultiple?n.firstMultiple=W(t):1===i&&(n.firstMultiple=!1);var a=n.firstInput,o=n.firstMultiple,l=o?o.center:a.center,u=t.center=V(r);t.timeStamp=f(),t.deltaTime=t.timeStamp-a.timeStamp,t.angle=X(l,u),t.distance=Y(l,u),function(e,t){var n=t.center,r=e.offsetDelta||{},i=e.prevDelta||{},a=e.prevInput||{};1!==t.eventType&&4!==a.eventType||(i=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y}),t.deltaX=i.x+(n.x-r.x),t.deltaY=i.y+(n.y-r.y)}(n,t),t.offsetDirection=G(t.deltaX,t.deltaY);var c,d,p=q(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=p.x,t.overallVelocityY=p.y,t.overallVelocity=h(p.x)>h(p.y)?p.x:p.y,t.scale=o?(c=o.pointers,Y((d=r)[0],d[1],z)/Y(c[0],c[1],z)):1,t.rotation=o?function(e,t){return X(t[1],t[0],z)+X(e[1],e[0],z)}(o.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,r,i,a,o=e.lastInterval||t,l=t.timeStamp-o.timeStamp;if(8!=t.eventType&&(l>25||o.velocity===s)){var u=t.deltaX-o.deltaX,c=t.deltaY-o.deltaY,d=q(l,u,c);r=d.x,i=d.y,n=h(d.x)>h(d.y)?d.x:d.y,a=G(u,c),e.lastInterval=t}else n=o.velocity,r=o.velocityX,i=o.velocityY,a=o.direction;t.velocity=n,t.velocityX=r,t.velocityY=i,t.direction=a}(n,t);var m=e.element;T(t.srcEvent.target,m)&&(m=t.srcEvent.target),t.target=m}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function W(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:d(e.pointers[n].clientX),clientY:d(e.pointers[n].clientY)},n++;return{timeStamp:f(),pointers:t,center:V(t),deltaX:e.deltaX,deltaY:e.deltaY}}function V(e){var t=e.length;if(1===t)return{x:d(e[0].clientX),y:d(e[0].clientY)};for(var n=0,r=0,i=0;i<t;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:d(n/t),y:d(r/t)}}function q(e,t,n){return{x:t/e||0,y:n/e||0}}function G(e,t){return e===t?1:h(e)>=h(t)?e<0?2:4:t<0?8:16}function Y(e,t,n){n||(n=$);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.sqrt(r*r+i*i)}function X(e,t,n){return n||(n=$),180*Math.atan2(t[n[1]]-e[n[1]],t[n[0]]-e[n[0]])/Math.PI}U.prototype={handler:function(){},init:function(){this.evEl&&E(this.element,this.evEl,this.domHandler),this.evTarget&&E(this.target,this.evTarget,this.domHandler),this.evWin&&E(j(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(j(this.element),this.evWin,this.domHandler)}};var K={mousedown:1,mousemove:2,mouseup:4},Z="mousedown",J="mousemove mouseup";function Q(){this.evEl=Z,this.evWin=J,this.pressed=!1,U.apply(this,arguments)}x(Q,U,{handler:function(e){var t=K[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:B,srcEvent:e}))}});var ee={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},te={2:L,3:"pen",4:B,5:"kinect"},ne="pointerdown",re="pointermove pointerup pointercancel";function ie(){this.evEl=ne,this.evWin=re,U.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}i.MSPointerEvent&&!i.PointerEvent&&(ne="MSPointerDown",re="MSPointerMove MSPointerUp MSPointerCancel"),x(ie,U,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),i=ee[r],a=te[e.pointerType]||e.pointerType,o=a==L,s=A(t,e.pointerId,"pointerId");1&i&&(0===e.button||o)?s<0&&(t.push(e),s=t.length-1):12&i&&(n=!0),s<0||(t[s]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:a,srcEvent:e}),n&&t.splice(s,1))}});var ae={touchstart:1,touchmove:2,touchend:4,touchcancel:8},oe="touchstart",se="touchstart touchmove touchend touchcancel";function le(){this.evTarget=oe,this.evWin=se,this.started=!1,U.apply(this,arguments)}function ue(e,t){var n=O(e.touches),r=O(e.changedTouches);return 12&t&&(n=D(n.concat(r),"identifier",!0)),[n,r]}x(le,U,{handler:function(e){var t=ae[e.type];if(1===t&&(this.started=!0),this.started){var n=ue.call(this,e,t);12&t&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:L,srcEvent:e})}}});var ce={touchstart:1,touchmove:2,touchend:4,touchcancel:8},de="touchstart touchmove touchend touchcancel";function he(){this.evTarget=de,this.targetIds={},U.apply(this,arguments)}function fe(e,t){var n=O(e.touches),r=this.targetIds;if(3&t&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,a,o=O(e.changedTouches),s=[],l=this.target;if(a=n.filter((function(e){return T(e.target,l)})),1===t)for(i=0;i<a.length;)r[a[i].identifier]=!0,i++;for(i=0;i<o.length;)r[o[i].identifier]&&s.push(o[i]),12&t&&delete r[o[i].identifier],i++;return s.length?[D(a.concat(s),"identifier",!0),s]:void 0}function pe(){U.apply(this,arguments);var e=w(this.handler,this);this.touch=new he(this.manager,e),this.mouse=new Q(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function me(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,ge.call(this,t)):12&e&&ge.call(this,t)}function ge(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)}),2500)}}function ve(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],a=Math.abs(t-i.x),o=Math.abs(n-i.y);if(a<=25&&o<=25)return!0}return!1}x(he,U,{handler:function(e){var t=ce[e.type],n=fe.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:L,srcEvent:e})}}),x(pe,U,{handler:function(e,t,n){var r=n.pointerType==B;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(n.pointerType==L)me.call(this,t,n);else if(r&&ve.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ye=M(c.style,"touchAction"),be=ye!==s,xe="compute",we="auto",_e="manipulation",ke="none",Ee="pan-x",Se="pan-y",Te=function(){if(!be)return!1;var e={},t=i.CSS&&i.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){e[n]=!t||i.CSS.supports("touch-action",n)})),e}();function Ce(e,t){this.manager=e,this.set(t)}Ce.prototype={set:function(e){e==xe&&(e=this.compute()),be&&this.manager.element.style&&Te[e]&&(this.manager.element.style[ye]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return g(this.manager.recognizers,(function(t){_(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(C(e,ke))return ke;var t=C(e,Ee),n=C(e,Se);return t&&n?ke:t||n?t?Ee:Se:C(e,_e)?_e:we}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,i=C(r,ke)&&!Te.none,a=C(r,Se)&&!Te["pan-y"],o=C(r,Ee)&&!Te["pan-x"];if(i&&1===e.pointers.length&&e.distance<2&&e.deltaTime<250)return;if(!o||!a)return i||a&&6&n||o&&24&n?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Ie=32;function Ae(e){this.options=l({},this.defaults,e||{}),this.id=N++,this.manager=null,this.options.enable=k(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Oe(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function De(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function Me(e,t){var n=t.manager;return n?n.get(e):e}function Ne(){Ae.apply(this,arguments)}function je(){Ne.apply(this,arguments),this.pX=null,this.pY=null}function Fe(){Ne.apply(this,arguments)}function Re(){Ae.apply(this,arguments),this._timer=null,this._input=null}function Pe(){Ne.apply(this,arguments)}function Le(){Ne.apply(this,arguments)}function Be(){Ae.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function $e(e,t){return(t=t||{}).recognizers=k(t.recognizers,$e.defaults.preset),new ze(e,t)}function ze(e,t){this.options=l({},$e.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new(this.options.inputClass||(R?ie:P?he:F?pe:Q))(this,H),this.touchAction=new Ce(this,this.options.touchAction),Ue(this,!0),g(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function Ue(e,t){var n,r=e.element;r.style&&(g(e.options.cssProps,(function(i,a){n=M(r.style,a),t?(e.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}Ae.prototype={defaults:{},set:function(e){return l(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(m(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=Me(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return m(e,"dropRecognizeWith",this)||(e=Me(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(m(e,"requireFailure",this))return this;var t=this.requireFail;return-1===A(t,e=Me(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(m(e,"dropRequireFailure",this))return this;e=Me(e,this);var t=A(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function r(n){t.manager.emit(n,e)}n<8&&r(t.options.event+Oe(n)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),n>=8&&r(t.options.event+Oe(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=Ie},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=l({},e);if(!_(this.options.enable,[this,t]))return this.reset(),void(this.state=Ie);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},x(Ne,Ae,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=6&t,i=this.attrTest(e);return r&&(8&n||!i)?16|t:r||i?4&n?8|t:2&t?4|t:2:Ie}}),x(je,Ne,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push(Se),24&e&&t.push(Ee),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,i=e.direction,a=e.deltaX,o=e.deltaY;return i&t.direction||(6&t.direction?(i=0===a?1:a<0?2:4,n=a!=this.pX,r=Math.abs(e.deltaX)):(i=0===o?1:o<0?8:16,n=o!=this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&i&t.direction},attrTest:function(e){return Ne.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=De(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),x(Fe,Ne,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ke]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){1!==e.scale&&(e.additionalEvent=this.options.event+(e.scale<1?"in":"out")),this._super.emit.call(this,e)}}),x(Re,Ae,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[we]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!r||!n||12&e.eventType&&!i)this.reset();else if(1&e.eventType)this.reset(),this._timer=p((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return Ie},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=f(),this.manager.emit(this.options.event,this._input)))}}),x(Pe,Ne,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ke]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),x(Le,Ne,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return je.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return 30&n?t=e.overallVelocity:6&n?t=e.overallVelocityX:24&n&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&h(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=De(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),x(Be,Ae,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[_e]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=e.eventType)return this.failTimeout();var a=!this.pTime||e.timeStamp-this.pTime<t.interval,o=!this.pCenter||Y(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,o&&a?this.count+=1:this.count=1,this._input=e,0==this.count%t.taps)return this.hasRequireFailures()?(this._timer=p((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return Ie},failTimeout:function(){return this._timer=p((function(){this.state=Ie}),this.options.interval,this),Ie},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),$e.VERSION="2.0.7",$e.defaults={domEvents:!1,touchAction:xe,enable:!0,inputTarget:null,inputClass:null,preset:[[Pe,{enable:!1}],[Fe,{enable:!1},["rotate"]],[Le,{direction:6}],[je,{direction:6},["swipe"]],[Be],[Be,{event:"doubletap",taps:2},["tap"]],[Re]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},ze.prototype={set:function(e){return l(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var r=this.recognizers,i=t.curRecognizer;(!i||i&&8&i.state)&&(i=t.curRecognizer=null);for(var a=0;a<r.length;)n=r[a],2===t.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(e),!i&&14&n.state&&(i=t.curRecognizer=n),a++}},get:function(e){if(e instanceof Ae)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(m(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(m(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=A(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==s&&t!==s){var n=this.handlers;return g(I(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(e!==s){var n=this.handlers;return g(I(e),(function(e){t?n[e]&&n[e].splice(A(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var n=a.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](t),r++}},destroy:function(){this.element&&Ue(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l($e,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Ie,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:ze,Input:U,TouchAction:Ce,TouchInput:he,MouseInput:Q,PointerEventInput:ie,TouchMouseInput:pe,SingleTouchInput:le,Recognizer:Ae,AttrRecognizer:Ne,Tap:Be,Pan:je,Swipe:Le,Pinch:Fe,Rotate:Pe,Press:Re,on:E,off:S,each:g,merge:b,extend:y,assign:l,inherit:x,bindFn:w,prefixed:M}),(void 0!==i?i:"undefined"!=typeof self?self:{}).Hammer=$e,(r=(function(){return $e}).call(t,n,t,e))===s||(e.exports=r)}(window,document)},ygsx:function(e,t,n){const r=n("3wIk"),i=n("ex/Z");e.exports=(e,t,n)=>{let a=null,o=null,s=null;try{s=new i(t,n)}catch(l){return null}return e.forEach(e=>{s.test(e)&&(a&&1!==o.compare(e)||(a=e,o=new r(a,n)))}),a}},yuCN:function(e,t,n){(function(e){var r;!function(e,i,a){function o(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],r[i]=n^=(e^=e<<13)^e<<9,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function l(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.x&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(t,n,t,i))||(i.exports=r):this.xorshift7=l}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},zUnb:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"JsonPatchError",(function(){return Np})),n.d(r,"deepClone",(function(){return jp})),n.d(r,"getValueByPointer",(function(){return Pp})),n.d(r,"applyOperation",(function(){return Lp})),n.d(r,"applyPatch",(function(){return Bp})),n.d(r,"applyReducer",(function(){return $p})),n.d(r,"validator",(function(){return zp})),n.d(r,"validate",(function(){return Up})),n.d(r,"_areEquals",(function(){return Hp}));var i={};n.r(i),n.d(i,"unobserve",(function(){return Gp})),n.d(i,"observe",(function(){return Yp})),n.d(i,"generate",(function(){return Xp})),n.d(i,"compare",(function(){return Zp}));var a={};n.r(a),n.d(a,"aggregate",(function(){return Pk})),n.d(a,"bin",(function(){return Lk})),n.d(a,"collect",(function(){return $k})),n.d(a,"compare",(function(){return zk})),n.d(a,"countpattern",(function(){return Hk})),n.d(a,"cross",(function(){return Wk})),n.d(a,"density",(function(){return qk})),n.d(a,"dotbin",(function(){return Kk})),n.d(a,"expression",(function(){return Zk})),n.d(a,"extent",(function(){return Qk})),n.d(a,"facet",(function(){return tE})),n.d(a,"field",(function(){return nE})),n.d(a,"filter",(function(){return iE})),n.d(a,"flatten",(function(){return aE})),n.d(a,"fold",(function(){return oE})),n.d(a,"formula",(function(){return sE})),n.d(a,"generate",(function(){return lE})),n.d(a,"impute",(function(){return dE})),n.d(a,"joinaggregate",(function(){return hE})),n.d(a,"kde",(function(){return fE})),n.d(a,"key",(function(){return pE})),n.d(a,"load",(function(){return gE})),n.d(a,"lookup",(function(){return yE})),n.d(a,"multiextent",(function(){return bE})),n.d(a,"multivalues",(function(){return wE})),n.d(a,"params",(function(){return kE})),n.d(a,"pivot",(function(){return EE})),n.d(a,"prefacet",(function(){return SE})),n.d(a,"project",(function(){return TE})),n.d(a,"proxy",(function(){return CE})),n.d(a,"quantile",(function(){return IE})),n.d(a,"relay",(function(){return AE})),n.d(a,"sample",(function(){return OE})),n.d(a,"sequence",(function(){return DE})),n.d(a,"sieve",(function(){return ME})),n.d(a,"subflow",(function(){return eE})),n.d(a,"timeunit",(function(){return NE})),n.d(a,"tupleindex",(function(){return FE})),n.d(a,"values",(function(){return RE})),n.d(a,"window",(function(){return zE}));var o={};n.r(o),n.d(o,"interpolate",(function(){return qA})),n.d(o,"interpolateArray",(function(){return PA})),n.d(o,"interpolateBasis",(function(){return SA})),n.d(o,"interpolateBasisClosed",(function(){return TA})),n.d(o,"interpolateDate",(function(){return $A})),n.d(o,"interpolateDiscrete",(function(){return GA})),n.d(o,"interpolateHue",(function(){return YA})),n.d(o,"interpolateNumber",(function(){return zA})),n.d(o,"interpolateNumberArray",(function(){return FA})),n.d(o,"interpolateObject",(function(){return UA})),n.d(o,"interpolateRound",(function(){return XA})),n.d(o,"interpolateString",(function(){return VA})),n.d(o,"interpolateTransformCss",(function(){return eO})),n.d(o,"interpolateTransformSvg",(function(){return tO})),n.d(o,"interpolateZoom",(function(){return rO})),n.d(o,"interpolateRgb",(function(){return DA})),n.d(o,"interpolateRgbBasis",(function(){return NA})),n.d(o,"interpolateRgbBasisClosed",(function(){return jA})),n.d(o,"interpolateHsl",(function(){return aO})),n.d(o,"interpolateHslLong",(function(){return oO})),n.d(o,"interpolateLab",(function(){return SO})),n.d(o,"interpolateHcl",(function(){return CO})),n.d(o,"interpolateHclLong",(function(){return IO})),n.d(o,"interpolateCubehelix",(function(){return BO})),n.d(o,"interpolateCubehelixLong",(function(){return $O})),n.d(o,"piecewise",(function(){return zO})),n.d(o,"quantize",(function(){return UO}));var s={};n.r(s),n.d(s,"bound",(function(){return ZR})),n.d(s,"identifier",(function(){return eP})),n.d(s,"mark",(function(){return tP})),n.d(s,"overlap",(function(){return nP})),n.d(s,"render",(function(){return uP})),n.d(s,"viewlayout",(function(){return OP}));var l={};n.r(l),n.d(l,"axisticks",(function(){return MP})),n.d(l,"datajoin",(function(){return NP})),n.d(l,"encode",(function(){return FP})),n.d(l,"legendentries",(function(){return RP})),n.d(l,"linkpath",(function(){return zP})),n.d(l,"pie",(function(){return qP})),n.d(l,"scale",(function(){return XP})),n.d(l,"sortitems",(function(){return QP})),n.d(l,"stack",(function(){return iL}));var u={};n.r(u),n.d(u,"contour",(function(){return fU})),n.d(u,"geojson",(function(){return gU})),n.d(u,"geopath",(function(){return vU})),n.d(u,"geopoint",(function(){return yU})),n.d(u,"geoshape",(function(){return bU})),n.d(u,"graticule",(function(){return xU})),n.d(u,"heatmap",(function(){return wU})),n.d(u,"isocontour",(function(){return rU})),n.d(u,"kde2d",(function(){return cU})),n.d(u,"projection",(function(){return kU}));var c={};n.r(c),n.d(c,"force",(function(){return yH}));var d={};n.r(d),n.d(d,"nest",(function(){return vW})),n.d(d,"pack",(function(){return kW})),n.d(d,"partition",(function(){return SW})),n.d(d,"stratify",(function(){return TW})),n.d(d,"tree",(function(){return AW})),n.d(d,"treelinks",(function(){return OW})),n.d(d,"treemap",(function(){return NW}));var h={};n.r(h),n.d(h,"label",(function(){return XW}));var f={};n.r(f),n.d(f,"loess",(function(){return ZW})),n.d(f,"regression",(function(){return QW}));var p={};n.r(p),n.d(p,"voronoi",(function(){return _V}));var m={};n.r(m),n.d(m,"wordcloud",(function(){return FV}));var g={};n.r(g),n.d(g,"crossfilter",(function(){return UV})),n.d(g,"resolvefilter",(function(){return HV}));var v={};n.r(v),n.d(v,"Debug",(function(){return wm})),n.d(v,"Error",(function(){return ym})),n.d(v,"Info",(function(){return xm})),n.d(v,"None",(function(){return vm})),n.d(v,"Warn",(function(){return bm})),n.d(v,"accessor",(function(){return tm})),n.d(v,"accessorFields",(function(){return rm})),n.d(v,"accessorName",(function(){return nm})),n.d(v,"array",(function(){return Ym})),n.d(v,"ascending",(function(){return Jm})),n.d(v,"clampRange",(function(){return Xm})),n.d(v,"compare",(function(){return Zm})),n.d(v,"constant",(function(){return ng})),n.d(v,"debounce",(function(){return rg})),n.d(v,"error",(function(){return sm})),n.d(v,"extend",(function(){return ig})),n.d(v,"extent",(function(){return ag})),n.d(v,"extentIndex",(function(){return og})),n.d(v,"falsy",(function(){return mm})),n.d(v,"fastmap",(function(){return cg})),n.d(v,"field",(function(){return um})),n.d(v,"flush",(function(){return dg})),n.d(v,"hasOwnProperty",(function(){return lg})),n.d(v,"id",(function(){return cm})),n.d(v,"identity",(function(){return dm})),n.d(v,"inherits",(function(){return hg})),n.d(v,"inrange",(function(){return fg})),n.d(v,"isArray",(function(){return km})),n.d(v,"isBoolean",(function(){return pg})),n.d(v,"isDate",(function(){return mg})),n.d(v,"isFunction",(function(){return Km})),n.d(v,"isIterable",(function(){return gg})),n.d(v,"isNumber",(function(){return vg})),n.d(v,"isObject",(function(){return Em})),n.d(v,"isRegExp",(function(){return yg})),n.d(v,"isString",(function(){return bg})),n.d(v,"key",(function(){return xg})),n.d(v,"lerp",(function(){return wg})),n.d(v,"logger",(function(){return _m})),n.d(v,"lruCache",(function(){return _g})),n.d(v,"merge",(function(){return kg})),n.d(v,"mergeConfig",(function(){return Tm})),n.d(v,"one",(function(){return fm})),n.d(v,"pad",(function(){return Sg})),n.d(v,"panLinear",(function(){return Pm})),n.d(v,"panLog",(function(){return Lm})),n.d(v,"panPow",(function(){return Bm})),n.d(v,"panSymlog",(function(){return $m})),n.d(v,"peek",(function(){return Am})),n.d(v,"quarter",(function(){return qm})),n.d(v,"repeat",(function(){return Eg})),n.d(v,"span",(function(){return Tg})),n.d(v,"splitAccessPath",(function(){return lm})),n.d(v,"stringValue",(function(){return Cg})),n.d(v,"toBoolean",(function(){return Ig})),n.d(v,"toDate",(function(){return Og})),n.d(v,"toNumber",(function(){return Om})),n.d(v,"toSet",(function(){return Mg})),n.d(v,"toString",(function(){return Dg})),n.d(v,"truncate",(function(){return Ng})),n.d(v,"truthy",(function(){return pm})),n.d(v,"utcquarter",(function(){return Gm})),n.d(v,"visitArray",(function(){return jg})),n.d(v,"writeConfig",(function(){return Cm})),n.d(v,"zero",(function(){return hm})),n.d(v,"zoomLinear",(function(){return Um})),n.d(v,"zoomLog",(function(){return Hm})),n.d(v,"zoomPow",(function(){return Wm})),n.d(v,"zoomSymlog",(function(){return Vm})),n.d(v,"Dataflow",(function(){return p_})),n.d(v,"EventStream",(function(){return e_})),n.d(v,"MultiPulse",(function(){return c_})),n.d(v,"Operator",(function(){return Zw})),n.d(v,"Parameters",(function(){return Yw})),n.d(v,"Pulse",(function(){return o_})),n.d(v,"Transform",(function(){return g_})),n.d(v,"changeset",(function(){return qw})),n.d(v,"definition",(function(){return y_})),n.d(v,"ingest",(function(){return $w})),n.d(v,"isTuple",(function(){return Pw})),n.d(v,"transform",(function(){return b_})),n.d(v,"transforms",(function(){return v_})),n.d(v,"tupleid",(function(){return Lw})),n.d(v,"bandwidthNRD",(function(){return O_})),n.d(v,"bin",(function(){return D_})),n.d(v,"bootstrapCI",(function(){return j_})),n.d(v,"cumulativeLogNormal",(function(){return X_})),n.d(v,"cumulativeNormal",(function(){return H_})),n.d(v,"cumulativeUniform",(function(){return tk})),n.d(v,"densityLogNormal",(function(){return Y_})),n.d(v,"densityNormal",(function(){return U_})),n.d(v,"densityUniform",(function(){return ek})),n.d(v,"dotbin",(function(){return F_})),n.d(v,"quantileLogNormal",(function(){return K_})),n.d(v,"quantileNormal",(function(){return W_})),n.d(v,"quantileUniform",(function(){return nk})),n.d(v,"quantiles",(function(){return I_})),n.d(v,"quartiles",(function(){return A_})),n.d(v,"random",(function(){return M_})),n.d(v,"randomInteger",(function(){return P_})),n.d(v,"randomKDE",(function(){return q_})),n.d(v,"randomLCG",(function(){return R_})),n.d(v,"randomLogNormal",(function(){return Z_})),n.d(v,"randomMixture",(function(){return J_})),n.d(v,"randomNormal",(function(){return V_})),n.d(v,"randomUniform",(function(){return rk})),n.d(v,"regressionExp",(function(){return ck})),n.d(v,"regressionLinear",(function(){return lk})),n.d(v,"regressionLoess",(function(){return mk})),n.d(v,"regressionLog",(function(){return uk})),n.d(v,"regressionPoly",(function(){return fk})),n.d(v,"regressionPow",(function(){return dk})),n.d(v,"regressionQuad",(function(){return hk})),n.d(v,"sampleCurve",(function(){return bk})),n.d(v,"sampleLogNormal",(function(){return G_})),n.d(v,"sampleNormal",(function(){return z_})),n.d(v,"sampleUniform",(function(){return Q_})),n.d(v,"setRandom",(function(){return N_})),n.d(v,"DATE",(function(){return wy})),n.d(v,"DAY",(function(){return _y})),n.d(v,"DAYOFYEAR",(function(){return ky})),n.d(v,"HOURS",(function(){return Ey})),n.d(v,"MILLISECONDS",(function(){return Cy})),n.d(v,"MINUTES",(function(){return Sy})),n.d(v,"MONTH",(function(){return by})),n.d(v,"QUARTER",(function(){return yy})),n.d(v,"SECONDS",(function(){return Ty})),n.d(v,"TIME_UNITS",(function(){return Iy})),n.d(v,"WEEK",(function(){return xy})),n.d(v,"YEAR",(function(){return vy})),n.d(v,"dayofyear",(function(){return Fy})),n.d(v,"timeBin",(function(){return xb})),n.d(v,"timeFloor",(function(){return Zy})),n.d(v,"timeInterval",(function(){return rb})),n.d(v,"timeOffset",(function(){return ob})),n.d(v,"timeSequence",(function(){return ub})),n.d(v,"timeUnitSpecifier",(function(){return My})),n.d(v,"timeUnits",(function(){return Oy})),n.d(v,"utcFloor",(function(){return eb})),n.d(v,"utcInterval",(function(){return ib})),n.d(v,"utcOffset",(function(){return sb})),n.d(v,"utcSequence",(function(){return cb})),n.d(v,"utcdayofyear",(function(){return zy})),n.d(v,"utcweek",(function(){return Uy})),n.d(v,"week",(function(){return Ry})),n.d(v,"loader",(function(){return Mw})),n.d(v,"read",(function(){return Dw})),n.d(v,"inferType",(function(){return Xg})),n.d(v,"inferTypes",(function(){return Kg})),n.d(v,"typeParsers",(function(){return qg})),n.d(v,"format",(function(){return mv})),n.d(v,"formats",(function(){return gv})),n.d(v,"responseType",(function(){return vv})),n.d(v,"Bounds",(function(){return QM})),n.d(v,"CanvasHandler",(function(){return TF})),n.d(v,"CanvasRenderer",(function(){return DF})),n.d(v,"Gradient",(function(){return oM})),n.d(v,"GroupItem",(function(){return tN})),n.d(v,"Handler",(function(){return lF})),n.d(v,"Item",(function(){return eN})),n.d(v,"Marks",(function(){return Gj})),n.d(v,"RenderType",(function(){return gR})),n.d(v,"Renderer",(function(){return cF})),n.d(v,"ResourceLoader",(function(){return nN})),n.d(v,"SVGHandler",(function(){return NF})),n.d(v,"SVGRenderer",(function(){return tR})),n.d(v,"SVGStringRenderer",(function(){return mR})),n.d(v,"Scenegraph",(function(){return eF})),n.d(v,"boundClip",(function(){return ER})),n.d(v,"boundContext",(function(){return kN})),n.d(v,"boundItem",(function(){return Yj})),n.d(v,"boundMark",(function(){return Kj})),n.d(v,"boundStroke",(function(){return aN})),n.d(v,"domChild",(function(){return iF})),n.d(v,"domClear",(function(){return aF})),n.d(v,"domCreate",(function(){return nF})),n.d(v,"domFind",(function(){return rF})),n.d(v,"font",(function(){return zj})),n.d(v,"fontFamily",(function(){return $j})),n.d(v,"fontSize",(function(){return Fj})),n.d(v,"intersect",(function(){return bR})),n.d(v,"intersectBoxLine",(function(){return jN})),n.d(v,"intersectPath",(function(){return ON})),n.d(v,"intersectPoint",(function(){return DN})),n.d(v,"intersectRule",(function(){return NN})),n.d(v,"lineHeight",(function(){return Rj})),n.d(v,"markup",(function(){return KF})),n.d(v,"multiLineOffset",(function(){return Lj})),n.d(v,"pathCurves",(function(){return lM})),n.d(v,"pathEqual",(function(){return TR})),n.d(v,"pathParse",(function(){return dM})),n.d(v,"pathRectangle",(function(){return FM})),n.d(v,"pathRender",(function(){return _M})),n.d(v,"pathSymbols",(function(){return TM})),n.d(v,"pathTrail",(function(){return RM})),n.d(v,"point",(function(){return sF})),n.d(v,"renderModule",(function(){return yR})),n.d(v,"resetSVGClipId",(function(){return ZM})),n.d(v,"resetSVGDefIds",(function(){return CR})),n.d(v,"sceneEqual",(function(){return SR})),n.d(v,"sceneFromJSON",(function(){return Qj})),n.d(v,"scenePickVisit",(function(){return VN})),n.d(v,"sceneToJSON",(function(){return Jj})),n.d(v,"sceneVisit",(function(){return WN})),n.d(v,"sceneZOrder",(function(){return HN})),n.d(v,"serializeXML",(function(){return ZF})),n.d(v,"textMetrics",(function(){return Aj})),n.d(v,"interpolate",(function(){return DD})),n.d(v,"interpolateColors",(function(){return ID})),n.d(v,"interpolateRange",(function(){return CD})),n.d(v,"quantizeInterpolator",(function(){return AD})),n.d(v,"scale",(function(){return vD})),n.d(v,"scheme",(function(){return FD})),n.d(v,"projection",(function(){return fz})),n.d(v,"View",(function(){return mK})),n.d(v,"defaultLocale",(function(){return Aw})),n.d(v,"formatLocale",(function(){return ww})),n.d(v,"locale",(function(){return Iw})),n.d(v,"resetDefaultLocale",(function(){return Ow})),n.d(v,"timeFormatLocale",(function(){return Tw})),n.d(v,"expressionFunction",(function(){return iX})),n.d(v,"parse",(function(){return r0})),n.d(v,"runtimeContext",(function(){return pX})),n.d(v,"version",(function(){return i0}));var y={};n.r(y),n.d(y,"invalidSpec",(function(){return H2})),n.d(y,"FIT_NON_SINGLE",(function(){return W2})),n.d(y,"containerSizeNonSingle",(function(){return V2})),n.d(y,"containerSizeNotCompatibleWithAutosize",(function(){return q2})),n.d(y,"droppingFit",(function(){return G2})),n.d(y,"unknownField",(function(){return Y2})),n.d(y,"cannotProjectOnChannelWithoutField",(function(){return X2})),n.d(y,"cannotProjectAggregate",(function(){return K2})),n.d(y,"nearestNotSupportForContinuous",(function(){return Z2})),n.d(y,"selectionNotSupported",(function(){return J2})),n.d(y,"selectionNotFound",(function(){return Q2})),n.d(y,"SCALE_BINDINGS_CONTINUOUS",(function(){return e5})),n.d(y,"LEGEND_BINDINGS_MUST_HAVE_PROJECTION",(function(){return t5})),n.d(y,"noSameUnitLookup",(function(){return n5})),n.d(y,"NEEDS_SAME_SELECTION",(function(){return r5})),n.d(y,"INTERVAL_INITIALIZED_WITH_X_Y",(function(){return i5})),n.d(y,"noSuchRepeatedValue",(function(){return a5})),n.d(y,"columnsNotSupportByRowCol",(function(){return o5})),n.d(y,"CONCAT_CANNOT_SHARE_AXIS",(function(){return s5})),n.d(y,"unrecognizedParse",(function(){return l5})),n.d(y,"differentParse",(function(){return u5})),n.d(y,"ADD_SAME_CHILD_TWICE",(function(){return c5})),n.d(y,"invalidTransformIgnored",(function(){return d5})),n.d(y,"NO_FIELDS_NEEDS_AS",(function(){return h5})),n.d(y,"customFormatTypeNotAllowed",(function(){return f5})),n.d(y,"projectionOverridden",(function(){return p5})),n.d(y,"REPLACE_ANGLE_WITH_THETA",(function(){return m5})),n.d(y,"primitiveChannelDef",(function(){return g5})),n.d(y,"invalidFieldType",(function(){return v5})),n.d(y,"invalidFieldTypeForCountAggregate",(function(){return y5})),n.d(y,"invalidAggregate",(function(){return b5})),n.d(y,"missingFieldType",(function(){return x5})),n.d(y,"droppingColor",(function(){return w5})),n.d(y,"emptyFieldDef",(function(){return _5})),n.d(y,"latLongDeprecated",(function(){return k5})),n.d(y,"LINE_WITH_VARYING_SIZE",(function(){return E5})),n.d(y,"incompatibleChannel",(function(){return S5})),n.d(y,"invalidEncodingChannel",(function(){return T5})),n.d(y,"facetChannelShouldBeDiscrete",(function(){return C5})),n.d(y,"facetChannelDropped",(function(){return I5})),n.d(y,"discreteChannelCannotEncode",(function(){return A5})),n.d(y,"rangeMarkAlignmentCannotBeExpression",(function(){return O5})),n.d(y,"lineWithRange",(function(){return D5})),n.d(y,"orientOverridden",(function(){return M5})),n.d(y,"CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN",(function(){return N5})),n.d(y,"RANGE_STEP_DEPRECATED",(function(){return j5})),n.d(y,"cannotUseScalePropertyWithNonColor",(function(){return F5})),n.d(y,"unaggregateDomainHasNoEffectForRawField",(function(){return R5})),n.d(y,"unaggregateDomainWithNonSharedDomainOp",(function(){return P5})),n.d(y,"unaggregatedDomainWithLogScale",(function(){return L5})),n.d(y,"cannotApplySizeToNonOrientedMark",(function(){return B5})),n.d(y,"scaleTypeNotWorkWithChannel",(function(){return $5})),n.d(y,"scaleTypeNotWorkWithFieldDef",(function(){return z5})),n.d(y,"scalePropertyNotWorkWithScaleType",(function(){return U5})),n.d(y,"scaleTypeNotWorkWithMark",(function(){return H5})),n.d(y,"stepDropped",(function(){return W5})),n.d(y,"mergeConflictingProperty",(function(){return V5})),n.d(y,"mergeConflictingDomainProperty",(function(){return q5})),n.d(y,"independentScaleMeansIndependentGuide",(function(){return G5})),n.d(y,"domainSortDropped",(function(){return Y5})),n.d(y,"MORE_THAN_ONE_SORT",(function(){return X5})),n.d(y,"FACETED_INDEPENDENT_DIFFERENT_SOURCES",(function(){return K5})),n.d(y,"FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES",(function(){return Z5})),n.d(y,"FACETED_INDEPENDENT_SAME_SOURCE",(function(){return J5})),n.d(y,"INVALID_CHANNEL_FOR_AXIS",(function(){return Q5})),n.d(y,"cannotStackRangedMark",(function(){return e3})),n.d(y,"cannotStackNonLinearScale",(function(){return t3})),n.d(y,"stackNonSummativeAggregate",(function(){return n3})),n.d(y,"invalidTimeUnit",(function(){return r3})),n.d(y,"droppedDay",(function(){return i3})),n.d(y,"errorBarCenterAndExtentAreNotNeeded",(function(){return a3})),n.d(y,"errorBarCenterIsUsedWithWrongExtent",(function(){return o3})),n.d(y,"errorBarContinuousAxisHasCustomizedAggregate",(function(){return s3})),n.d(y,"errorBand1DNotSupport",(function(){return l3})),n.d(y,"channelRequiredForBinned",(function(){return u3})),n.d(y,"channelShouldNotBeUsedForBinned",(function(){return c3})),n.d(y,"domainRequiredForThresholdScale",(function(){return d3}));var b={};n.r(b),n.d(b,"compile",(function(){return kae})),n.d(b,"deepEqual",(function(){return g0})),n.d(b,"duplicate",(function(){return v0})),n.d(b,"pick",(function(){return y0})),n.d(b,"omit",(function(){return b0})),n.d(b,"stringify",(function(){return x0})),n.d(b,"hash",(function(){return w0})),n.d(b,"isNullOrFalse",(function(){return _0})),n.d(b,"contains",(function(){return k0})),n.d(b,"some",(function(){return E0})),n.d(b,"every",(function(){return S0})),n.d(b,"mergeDeep",(function(){return T0})),n.d(b,"unique",(function(){return I0})),n.d(b,"isEqual",(function(){return A0})),n.d(b,"setEqual",(function(){return O0})),n.d(b,"hasIntersection",(function(){return D0})),n.d(b,"prefixGenerator",(function(){return M0})),n.d(b,"fieldIntersection",(function(){return N0})),n.d(b,"isEmpty",(function(){return j0})),n.d(b,"keys",(function(){return F0})),n.d(b,"vals",(function(){return R0})),n.d(b,"entries",(function(){return P0})),n.d(b,"isBoolean",(function(){return L0})),n.d(b,"varName",(function(){return B0})),n.d(b,"logicalExpr",(function(){return $0})),n.d(b,"deleteNestedProperty",(function(){return z0})),n.d(b,"titleCase",(function(){return U0})),n.d(b,"accessPathWithDatum",(function(){return H0})),n.d(b,"flatAccessWithDatum",(function(){return W0})),n.d(b,"replacePathInField",(function(){return q0})),n.d(b,"replaceAll",(function(){return G0})),n.d(b,"removePathFromField",(function(){return Y0})),n.d(b,"accessPathDepth",(function(){return X0})),n.d(b,"getFirstDefined",(function(){return K0})),n.d(b,"uniqueId",(function(){return J0})),n.d(b,"resetIdCounter",(function(){return Q0})),n.d(b,"internalField",(function(){return e1})),n.d(b,"isInternalField",(function(){return t1})),n.d(b,"normalizeAngle",(function(){return n1})),n.d(b,"isNumeric",(function(){return r1})),n.d(b,"normalize",(function(){return p9})),n.d(b,"version",(function(){return a0.a}));var x={};n.r(x),n.d(x,"dark",(function(){return Tae})),n.d(x,"excel",(function(){return Iae})),n.d(x,"fivethirtyeight",(function(){return Nae})),n.d(x,"ggplot2",(function(){return Fae})),n.d(x,"googlecharts",(function(){return noe})),n.d(x,"latimes",(function(){return zae})),n.d(x,"quartz",(function(){return Wae})),n.d(x,"urbaninstitute",(function(){return Jae})),n.d(x,"version",(function(){return roe})),n.d(x,"vox",(function(){return qae}));var w={};n.r(w),n.d(w,"shuffle",(function(){return Ioe})),n.d(w,"clamp",(function(){return Aoe})),n.d(w,"nearestLargerEven",(function(){return Ooe})),n.d(w,"sum",(function(){return Doe})),n.d(w,"randUniform",(function(){return Moe})),n.d(w,"distSquared",(function(){return Noe})),n.d(w,"assert",(function(){return joe})),n.d(w,"assertShapesMatch",(function(){return Foe})),n.d(w,"assertNonNull",(function(){return Roe})),n.d(w,"flatten",(function(){return Poe})),n.d(w,"sizeFromShape",(function(){return Loe})),n.d(w,"isScalarShape",(function(){return Boe})),n.d(w,"arraysEqual",(function(){return $oe})),n.d(w,"isInt",(function(){return zoe})),n.d(w,"tanh",(function(){return Uoe})),n.d(w,"sizeToSquarishShape",(function(){return Hoe})),n.d(w,"createShuffledIndices",(function(){return Woe})),n.d(w,"rightPad",(function(){return Voe})),n.d(w,"repeatedTry",(function(){return qoe})),n.d(w,"inferFromImplicitShape",(function(){return Goe})),n.d(w,"parseAxisParam",(function(){return Yoe})),n.d(w,"squeezeShape",(function(){return Xoe})),n.d(w,"getTypedArrayFromDType",(function(){return Koe})),n.d(w,"getArrayFromDType",(function(){return Zoe})),n.d(w,"checkConversionForErrors",(function(){return Joe})),n.d(w,"isValidDtype",(function(){return Qoe})),n.d(w,"hasEncodingLoss",(function(){return ese})),n.d(w,"isTypedArray",(function(){return tse})),n.d(w,"bytesPerElement",(function(){return nse})),n.d(w,"bytesFromStringArray",(function(){return rse})),n.d(w,"isString",(function(){return ise})),n.d(w,"isBoolean",(function(){return ase})),n.d(w,"isNumber",(function(){return ose})),n.d(w,"inferDtype",(function(){return sse})),n.d(w,"isFunction",(function(){return lse})),n.d(w,"nearestDivisor",(function(){return use})),n.d(w,"computeStrides",(function(){return cse})),n.d(w,"toNestedArray",(function(){return dse})),n.d(w,"makeOnesTypedArray",(function(){return hse})),n.d(w,"makeZerosTypedArray",(function(){return fse})),n.d(w,"makeZerosNestedTypedArray",(function(){return pse})),n.d(w,"assertNonNegativeIntegerDimensions",(function(){return mse})),n.d(w,"locToIndex",(function(){return gse})),n.d(w,"indexToLoc",(function(){return vse})),n.d(w,"isPromise",(function(){return yse})),n.d(w,"createScalarValue",(function(){return Pce})),n.d(w,"toTypedArray",(function(){return Lce})),n.d(w,"now",(function(){return Bce})),n.d(w,"fetch",(function(){return $ce})),n.d(w,"encodeString",(function(){return zce})),n.d(w,"decodeString",(function(){return Uce}));var _={};n.r(_),n.d(_,"makeTypesMatch",(function(){return rde})),n.d(_,"assertTypesMatch",(function(){return ide})),n.d(_,"isTensorInList",(function(){return ade})),n.d(_,"getTensorsInContainer",(function(){return ode}));var k={};n.r(k),n.d(k,"isMobile",(function(){return hde})),n.d(k,"isBrowser",(function(){return fde}));var E={};n.r(E),n.d(E,"copyModel",(function(){return dhe})),n.d(E,"listModels",(function(){return uhe})),n.d(E,"moveModel",(function(){return hhe})),n.d(E,"removeModel",(function(){return che})),n.d(E,"browserFiles",(function(){return _he})),n.d(E,"browserHTTPRequest",(function(){return Dhe})),n.d(E,"concatenateArrayBuffers",(function(){return Ode})),n.d(E,"decodeWeights",(function(){return Tde})),n.d(E,"encodeWeights",(function(){return Sde})),n.d(E,"fromMemory",(function(){return jhe})),n.d(E,"getLoadHandlers",(function(){return Lde})),n.d(E,"getModelArtifactsInfoForJSON",(function(){return Mde})),n.d(E,"getSaveHandlers",(function(){return Pde})),n.d(E,"http",(function(){return Ohe})),n.d(E,"isHTTPScheme",(function(){return Ihe})),n.d(E,"loadWeights",(function(){return She})),n.d(E,"registerLoadRouter",(function(){return Rde})),n.d(E,"registerSaveRouter",(function(){return Fde})),n.d(E,"weightsLoaderFactory",(function(){return The})),n.d(E,"withSaveHandler",(function(){return Fhe}));var S={};n.r(S),n.d(S,"confusionMatrix",(function(){return Bhe}));var T={};n.r(T),n.d(T,"toPixels",(function(){return Uhe})),n.d(T,"fromPixels",(function(){return Hhe}));var C={};n.r(C),n.d(C,"prepareAndValidate",(function(){return Whe}));var I={};n.r(I),n.d(I,"validateUpdateShape",(function(){return Vhe})),n.d(I,"validateInput",(function(){return qhe})),n.d(I,"calculateShapes",(function(){return Ghe}));var A={};n.r(A),n.d(A,"assertParamsValid",(function(){return Yhe})),n.d(A,"maskToAxes",(function(){return Xhe})),n.d(A,"computeOutShape",(function(){return Khe})),n.d(A,"stridesWithElidedDims",(function(){return Zhe})),n.d(A,"getNormalizedAxes",(function(){return efe})),n.d(A,"startIndicesWithElidedDims",(function(){return tfe})),n.d(A,"stopIndicesWithElidedDims",(function(){return nfe})),n.d(A,"stridesForAxis",(function(){return rfe})),n.d(A,"startForAxis",(function(){return ife})),n.d(A,"stopForAxis",(function(){return afe})),n.d(A,"isSliceContinous",(function(){return ofe})),n.d(A,"computeFlatOffset",(function(){return sfe})),n.d(A,"parseSliceParams",(function(){return lfe})),n.d(A,"sliceInfo",(function(){return ufe}));var O={};n.r(O),n.d(O,"Serializable",(function(){return cfe})),n.d(O,"SerializationMap",(function(){return dfe})),n.d(O,"registerClass",(function(){return hfe}));var D={};n.r(D),n.d(D,"TEST_EPSILON_FLOAT16",(function(){return ffe})),n.d(D,"expectArraysClose",(function(){return pfe})),n.d(D,"testEpsilon",(function(){return mfe})),n.d(D,"expectPromiseToFail",(function(){return vfe})),n.d(D,"expectArraysEqual",(function(){return yfe})),n.d(D,"expectNumbersClose",(function(){return bfe})),n.d(D,"expectValuesInRange",(function(){return wfe})),n.d(D,"expectArrayBuffersEqual",(function(){return _fe})),n.d(D,"encodeStrings",(function(){return kfe}));var M={};n.r(M),n.d(M,"conv2d",(function(){return kye})),n.d(M,"depthwiseConv2d",(function(){return Tye})),n.d(M,"matMul",(function(){return Cye}));var N={};n.r(N),n.d(N,"segOpComputeOptimalWindowSize",(function(){return Ybe})),n.d(N,"computeOutShape",(function(){return Xbe})),n.d(N,"collectGatherOpShapeInfo",(function(){return Kbe}));var j={};n.r(j),n.d(j,"axesAreInnerMostDims",(function(){return lge})),n.d(j,"combineLocations",(function(){return uge})),n.d(j,"computeOutAndReduceShapes",(function(){return cge})),n.d(j,"expandShapeToKeepDim",(function(){return dge})),n.d(j,"assertAxesAreInnerMostDims",(function(){return hge})),n.d(j,"getAxesPermutation",(function(){return fge})),n.d(j,"getUndoAxesPermutation",(function(){return pge})),n.d(j,"getInnerMostAxes",(function(){return mge})),n.d(j,"getBroadcastDims",(function(){return mpe})),n.d(j,"getReductionAxes",(function(){return gpe})),n.d(j,"assertAndGetBroadcastShape",(function(){return vpe})),n.d(j,"assertParamsConsistent",(function(){return bbe})),n.d(j,"computeOutShape",(function(){return xbe})),n.d(j,"computeDilation2DInfo",(function(){return Fpe})),n.d(j,"computePool2DInfo",(function(){return Rpe})),n.d(j,"computePool3DInfo",(function(){return Ppe})),n.d(j,"computeConv2DInfo",(function(){return Lpe})),n.d(j,"computeConv3DInfo",(function(){return Bpe})),n.d(j,"computeDefaultPad",(function(){return $pe})),n.d(j,"tupleValuesAreOne",(function(){return Vpe})),n.d(j,"eitherStridesOrDilationsAreOne",(function(){return qpe})),n.d(j,"convertConv2DDataFormat",(function(){return Gpe})),n.d(j,"getFusedDyActivation",(function(){return bye})),n.d(j,"getFusedBiasGradient",(function(){return xye})),n.d(j,"applyActivation",(function(){return wye})),n.d(j,"shouldFuse",(function(){return _ye})),n.d(j,"PARALLELIZE_THRESHOLD",(function(){return wbe})),n.d(j,"computeOptimalWindowSize",(function(){return _be})),n.d(j,"slice_util",(function(){return A})),n.d(j,"upcastType",(function(){return tde})),n.d(j,"getImageCenter",(function(){return kbe})),n.d(j,"getReshaped",(function(){return Ebe})),n.d(j,"getPermuted",(function(){return Sbe})),n.d(j,"getReshapedPermuted",(function(){return Tbe})),n.d(j,"getSliceBeginCoords",(function(){return Cbe})),n.d(j,"getSliceSize",(function(){return Ibe})),n.d(j,"prepareAndValidate",(function(){return Whe})),n.d(j,"validateUpdateShape",(function(){return Vhe})),n.d(j,"validateInput",(function(){return qhe})),n.d(j,"calculateShapes",(function(){return Ghe})),n.d(j,"SELU_SCALEALPHA",(function(){return Abe})),n.d(j,"SELU_SCALE",(function(){return Obe})),n.d(j,"ERF_P",(function(){return Dbe})),n.d(j,"ERF_A1",(function(){return Mbe})),n.d(j,"ERF_A2",(function(){return Nbe})),n.d(j,"ERF_A3",(function(){return jbe})),n.d(j,"ERF_A4",(function(){return Fbe})),n.d(j,"ERF_A5",(function(){return Rbe})),n.d(j,"warn",(function(){return Pbe})),n.d(j,"log",(function(){return Lbe})),n.d(j,"mergeRealAndImagArrays",(function(){return Bbe})),n.d(j,"splitRealAndImagArrays",(function(){return $be})),n.d(j,"complexWithEvenIndex",(function(){return zbe})),n.d(j,"complexWithOddIndex",(function(){return Ube})),n.d(j,"getComplexWithIndex",(function(){return Hbe})),n.d(j,"assignToTypedArray",(function(){return Wbe})),n.d(j,"exponents",(function(){return Vbe})),n.d(j,"exponent",(function(){return qbe})),n.d(j,"prepareSplitSize",(function(){return Gbe})),n.d(j,"segment_util",(function(){return N})),n.d(j,"castTensor",(function(){return Zbe})),n.d(j,"reshapeTensor",(function(){return Jbe})),n.d(j,"fromUint8ToStringArray",(function(){return Qbe})),n.d(j,"fromStringArrayToUint8",(function(){return exe}));var F={};n.r(F),n.d(F,"nonMaxSuppressionV3Impl",(function(){return Bye})),n.d(F,"nonMaxSuppressionV4Impl",(function(){return $ye})),n.d(F,"nonMaxSuppressionV5Impl",(function(){return zye})),n.d(F,"whereImpl",(function(){return Vve}));var R={};n.r(R),n.d(R,"maxNorm",(function(){return qwe})),n.d(R,"unitNorm",(function(){return Gwe})),n.d(R,"nonNeg",(function(){return Ywe})),n.d(R,"minMaxNorm",(function(){return Xwe}));var P={};n.r(P),n.d(P,"zeros",(function(){return eke})),n.d(P,"ones",(function(){return tke})),n.d(P,"constant",(function(){return nke})),n.d(P,"randomUniform",(function(){return rke})),n.d(P,"randomNormal",(function(){return ike})),n.d(P,"truncatedNormal",(function(){return ake})),n.d(P,"identity",(function(){return oke})),n.d(P,"varianceScaling",(function(){return ske})),n.d(P,"glorotUniform",(function(){return lke})),n.d(P,"glorotNormal",(function(){return uke})),n.d(P,"heNormal",(function(){return cke})),n.d(P,"heUniform",(function(){return dke})),n.d(P,"leCunNormal",(function(){return hke})),n.d(P,"leCunUniform",(function(){return fke})),n.d(P,"orthogonal",(function(){return pke}));var L={};n.r(L),n.d(L,"inputLayer",(function(){return eCe})),n.d(L,"elu",(function(){return tCe})),n.d(L,"reLU",(function(){return nCe})),n.d(L,"leakyReLU",(function(){return rCe})),n.d(L,"prelu",(function(){return iCe})),n.d(L,"softmax",(function(){return aCe})),n.d(L,"thresholdedReLU",(function(){return oCe})),n.d(L,"conv1d",(function(){return sCe})),n.d(L,"conv2d",(function(){return lCe})),n.d(L,"conv2dTranspose",(function(){return uCe})),n.d(L,"conv3d",(function(){return cCe})),n.d(L,"separableConv2d",(function(){return dCe})),n.d(L,"cropping2D",(function(){return hCe})),n.d(L,"upSampling2d",(function(){return fCe})),n.d(L,"depthwiseConv2d",(function(){return pCe})),n.d(L,"activation",(function(){return mCe})),n.d(L,"dense",(function(){return gCe})),n.d(L,"dropout",(function(){return vCe})),n.d(L,"spatialDropout1d",(function(){return yCe})),n.d(L,"flatten",(function(){return bCe})),n.d(L,"repeatVector",(function(){return xCe})),n.d(L,"reshape",(function(){return wCe})),n.d(L,"permute",(function(){return _Ce})),n.d(L,"embedding",(function(){return kCe})),n.d(L,"add",(function(){return ECe})),n.d(L,"average",(function(){return SCe})),n.d(L,"concatenate",(function(){return TCe})),n.d(L,"maximum",(function(){return CCe})),n.d(L,"minimum",(function(){return ICe})),n.d(L,"multiply",(function(){return ACe})),n.d(L,"dot",(function(){return OCe})),n.d(L,"batchNormalization",(function(){return DCe})),n.d(L,"layerNormalization",(function(){return MCe})),n.d(L,"zeroPadding2d",(function(){return NCe})),n.d(L,"averagePooling1d",(function(){return jCe})),n.d(L,"avgPool1d",(function(){return FCe})),n.d(L,"avgPooling1d",(function(){return RCe})),n.d(L,"averagePooling2d",(function(){return PCe})),n.d(L,"avgPool2d",(function(){return LCe})),n.d(L,"avgPooling2d",(function(){return BCe})),n.d(L,"averagePooling3d",(function(){return $Ce})),n.d(L,"avgPool3d",(function(){return zCe})),n.d(L,"avgPooling3d",(function(){return UCe})),n.d(L,"globalAveragePooling1d",(function(){return HCe})),n.d(L,"globalAveragePooling2d",(function(){return WCe})),n.d(L,"globalMaxPooling1d",(function(){return VCe})),n.d(L,"globalMaxPooling2d",(function(){return qCe})),n.d(L,"maxPooling1d",(function(){return GCe})),n.d(L,"maxPooling2d",(function(){return YCe})),n.d(L,"maxPooling3d",(function(){return XCe})),n.d(L,"gru",(function(){return KCe})),n.d(L,"gruCell",(function(){return ZCe})),n.d(L,"lstm",(function(){return JCe})),n.d(L,"lstmCell",(function(){return QCe})),n.d(L,"simpleRNN",(function(){return eIe})),n.d(L,"simpleRNNCell",(function(){return tIe})),n.d(L,"convLstm2d",(function(){return nIe})),n.d(L,"convLstm2dCell",(function(){return rIe})),n.d(L,"rnn",(function(){return iIe})),n.d(L,"stackedRNNCells",(function(){return aIe})),n.d(L,"bidirectional",(function(){return oIe})),n.d(L,"timeDistributed",(function(){return sIe})),n.d(L,"globalMaxPool1d",(function(){return lIe})),n.d(L,"globalMaxPool2d",(function(){return uIe})),n.d(L,"maxPool1d",(function(){return cIe})),n.d(L,"maxPool2d",(function(){return dIe})),n.d(L,"Layer",(function(){return Mke})),n.d(L,"RNN",(function(){return XSe})),n.d(L,"RNNCell",(function(){return KSe})),n.d(L,"input",(function(){return JEe})),n.d(L,"gaussianNoise",(function(){return hIe})),n.d(L,"gaussianDropout",(function(){return fIe})),n.d(L,"alphaDropout",(function(){return pIe})),n.d(L,"masking",(function(){return mIe}));var B={};n.r(B),n.d(B,"binaryAccuracy",(function(){return gIe})),n.d(B,"binaryCrossentropy",(function(){return vIe})),n.d(B,"sparseCategoricalAccuracy",(function(){return yIe})),n.d(B,"categoricalAccuracy",(function(){return bIe})),n.d(B,"categoricalCrossentropy",(function(){return xIe})),n.d(B,"precision",(function(){return wIe})),n.d(B,"recall",(function(){return _Ie})),n.d(B,"cosineProximity",(function(){return kIe})),n.d(B,"meanAbsoluteError",(function(){return EIe})),n.d(B,"meanAbsolutePercentageError",(function(){return SIe})),n.d(B,"MAPE",(function(){return TIe})),n.d(B,"mape",(function(){return CIe})),n.d(B,"meanSquaredError",(function(){return IIe})),n.d(B,"MSE",(function(){return AIe})),n.d(B,"mse",(function(){return OIe}));var $={};n.r($),n.d($,"modelFromJSON",(function(){return GEe}));var z={};n.r(z),n.d(z,"l1l2",(function(){return DIe})),n.d(z,"l1",(function(){return MIe})),n.d(z,"l2",(function(){return NIe}));var U={};n.r(U),n.d(U,"json",(function(){return JIe}));var H={};n.r(H),n.d(H,"json",(function(){return QIe}));var W={};n.r(W),n.d(W,"json",(function(){return eAe}));var V={};n.r(V),n.d(V,"json",(function(){return tAe}));var q={};n.r(q),n.d(q,"json",(function(){return nAe}));var G={};n.r(G),n.d(G,"json",(function(){return rAe}));var Y={};n.r(Y),n.d(Y,"json",(function(){return iAe}));var X={};n.r(X),n.d(X,"json",(function(){return aAe}));var K={};n.r(K),n.d(K,"json",(function(){return oAe}));var Z={};n.r(Z),n.d(Z,"json",(function(){return sAe}));var J={};n.r(J),n.d(J,"json",(function(){return lAe}));var Q={};n.r(Q),n.d(Q,"json",(function(){return uAe}));var ee={};n.r(ee),n.d(ee,"json",(function(){return cAe}));var te={};n.r(te),n.d(te,"json",(function(){return dAe}));var ne={};n.r(ne),n.d(ne,"json",(function(){return hAe}));var re={};n.r(re),n.d(re,"json",(function(){return fAe}));var ie={};n.r(ie),n.d(ie,"json",(function(){return pAe}));var ae={};n.r(ae),n.d(ae,"array",(function(){return TOe})),n.d(ae,"Dataset",(function(){return EOe})),n.d(ae,"zip",(function(){return COe})),n.d(ae,"CSVDataset",(function(){return ROe})),n.d(ae,"TextLineDataset",(function(){return AOe})),n.d(ae,"csv",(function(){return KOe})),n.d(ae,"func",(function(){return ZOe})),n.d(ae,"generator",(function(){return JOe})),n.d(ae,"microphone",(function(){return eDe})),n.d(ae,"webcam",(function(){return QOe})),n.d(ae,"FileDataSource",(function(){return YOe})),n.d(ae,"URLDataSource",(function(){return XOe})),n.d(ae,"version_data",(function(){return tDe}));var oe={};n.r(oe),n.d(oe,"simpleAbsImpl",(function(){return $De})),n.d(oe,"addImpl",(function(){return DDe})),n.d(oe,"bincountImpl",(function(){return kMe})),n.d(oe,"bincountReduceImpl",(function(){return EMe})),n.d(oe,"ceilImpl",(function(){return CMe})),n.d(oe,"concatImpl",(function(){return NMe})),n.d(oe,"expImpl",(function(){return bNe})),n.d(oe,"expm1Impl",(function(){return ENe})),n.d(oe,"floorImpl",(function(){return WNe})),n.d(oe,"gatherV2Impl",(function(){return QNe})),n.d(oe,"greaterImpl",(function(){return tje})),n.d(oe,"lessImpl",(function(){return pje})),n.d(oe,"linSpaceImpl",(function(){return xje})),n.d(oe,"logImpl",(function(){return _je})),n.d(oe,"maxImpl",(function(){return Pje})),n.d(oe,"maximumImpl",(function(){return $je})),n.d(oe,"minimumImpl",(function(){return Jje})),n.d(oe,"multiplyImpl",(function(){return CNe})),n.d(oe,"negImpl",(function(){return lFe})),n.d(oe,"notEqualImpl",(function(){return gFe})),n.d(oe,"prodImpl",(function(){return AFe})),n.d(oe,"rangeImpl",(function(){return DFe})),n.d(oe,"rsqrtImpl",(function(){return HFe})),n.d(oe,"sliceImpl",(function(){return bMe})),n.d(oe,"squaredDifferenceImpl",(function(){return gRe})),n.d(oe,"stridedSliceImpl",(function(){return wRe})),n.d(oe,"subImpl",(function(){return jNe})),n.d(oe,"tileImpl",(function(){return TRe})),n.d(oe,"topKImpl",(function(){return CRe})),n.d(oe,"transposeImpl",(function(){return GDe})),n.d(oe,"uniqueImpl",(function(){return IRe}));var se={};function le(e){return"function"==typeof e}n.r(se),n.d(se,"AdadeltaOptimizer",(function(){return lpe})),n.d(se,"AdagradOptimizer",(function(){return cpe})),n.d(se,"AdamOptimizer",(function(){return fpe})),n.d(se,"AdamaxOptimizer",(function(){return bpe})),n.d(se,"MomentumOptimizer",(function(){return wpe})),n.d(se,"Optimizer",(function(){return spe})),n.d(se,"RMSPropOptimizer",(function(){return _pe})),n.d(se,"SGDOptimizer",(function(){return xpe})),n.d(se,"Tensor",(function(){return Gce})),n.d(se,"TensorBuffer",(function(){return Hce})),n.d(se,"Variable",(function(){return Yce})),n.d(se,"Rank",(function(){return Xce})),n.d(se,"sumOutType",(function(){return nde})),n.d(se,"upcastType",(function(){return tde})),n.d(se,"abs",(function(){return ppe})),n.d(se,"acos",(function(){return kpe})),n.d(se,"acosh",(function(){return Epe})),n.d(se,"add",(function(){return qfe})),n.d(se,"addN",(function(){return Spe})),n.d(se,"all",(function(){return Tpe})),n.d(se,"any",(function(){return Cpe})),n.d(se,"argMax",(function(){return Ipe})),n.d(se,"argMin",(function(){return Ape})),n.d(se,"asin",(function(){return Ope})),n.d(se,"asinh",(function(){return Dpe})),n.d(se,"atan",(function(){return Mpe})),n.d(se,"atan2",(function(){return Npe})),n.d(se,"atanh",(function(){return jpe})),n.d(se,"avgPool",(function(){return Xpe})),n.d(se,"avgPool3d",(function(){return Kpe})),n.d(se,"basicLSTMCell",(function(){return tme})),n.d(se,"batchToSpaceND",(function(){return nme})),n.d(se,"batchNorm",(function(){return rme})),n.d(se,"batchNorm2d",(function(){return ime})),n.d(se,"batchNorm3d",(function(){return ame})),n.d(se,"batchNorm4d",(function(){return ome})),n.d(se,"bincount",(function(){return sme})),n.d(se,"broadcastTo",(function(){return lme})),n.d(se,"buffer",(function(){return mhe})),n.d(se,"cast",(function(){return ghe})),n.d(se,"ceil",(function(){return ume})),n.d(se,"clipByValue",(function(){return cme})),n.d(se,"clone",(function(){return vhe})),n.d(se,"complex",(function(){return wde})),n.d(se,"concat",(function(){return Zpe})),n.d(se,"concat1d",(function(){return dme})),n.d(se,"concat2d",(function(){return hme})),n.d(se,"concat3d",(function(){return fme})),n.d(se,"concat4d",(function(){return pme})),n.d(se,"conv1d",(function(){return gme})),n.d(se,"conv2d",(function(){return mme})),n.d(se,"conv2dTranspose",(function(){return yme})),n.d(se,"conv3d",(function(){return bme})),n.d(se,"conv3dTranspose",(function(){return wme})),n.d(se,"cos",(function(){return _me})),n.d(se,"cosh",(function(){return kme})),n.d(se,"cumsum",(function(){return Eme})),n.d(se,"denseBincount",(function(){return Sme})),n.d(se,"depthToSpace",(function(){return Tme})),n.d(se,"depthwiseConv2d",(function(){return Cme})),n.d(se,"diag",(function(){return Ime})),n.d(se,"dilation2d",(function(){return Ame})),n.d(se,"div",(function(){return Yfe})),n.d(se,"divNoNan",(function(){return Mme})),n.d(se,"dot",(function(){return Nme})),n.d(se,"elu",(function(){return jme})),n.d(se,"equal",(function(){return Ome})),n.d(se,"erf",(function(){return Fme})),n.d(se,"exp",(function(){return Rme})),n.d(se,"expandDims",(function(){return Pme})),n.d(se,"expm1",(function(){return Lme})),n.d(se,"eye",(function(){return $me})),n.d(se,"fill",(function(){return upe})),n.d(se,"floor",(function(){return zme})),n.d(se,"floorDiv",(function(){return Gfe})),n.d(se,"gather",(function(){return Ume})),n.d(se,"greater",(function(){return Hme})),n.d(se,"greaterEqual",(function(){return Wme})),n.d(se,"imag",(function(){return Vme})),n.d(se,"isFinite",(function(){return qme})),n.d(se,"isInf",(function(){return Gme})),n.d(se,"isNaN",(function(){return Yme})),n.d(se,"leakyRelu",(function(){return Xme})),n.d(se,"less",(function(){return Kme})),n.d(se,"lessEqual",(function(){return Zme})),n.d(se,"linspace",(function(){return Jme})),n.d(se,"localResponseNormalization",(function(){return Qme})),n.d(se,"log",(function(){return ege})),n.d(se,"log1p",(function(){return tge})),n.d(se,"logSigmoid",(function(){return ige})),n.d(se,"logSoftmax",(function(){return sge})),n.d(se,"logSumExp",(function(){return gge})),n.d(se,"logicalAnd",(function(){return vge})),n.d(se,"logicalNot",(function(){return yge})),n.d(se,"logicalOr",(function(){return bge})),n.d(se,"logicalXor",(function(){return xge})),n.d(se,"matMul",(function(){return Rhe})),n.d(se,"max",(function(){return age})),n.d(se,"maxPool",(function(){return wge})),n.d(se,"maxPool3d",(function(){return _ge})),n.d(se,"maxPoolWithArgmax",(function(){return kge})),n.d(se,"maximum",(function(){return ype})),n.d(se,"mean",(function(){return Ege})),n.d(se,"min",(function(){return Sge})),n.d(se,"minimum",(function(){return Tge})),n.d(se,"mirrorPad",(function(){return Cge})),n.d(se,"mod",(function(){return Ige})),n.d(se,"moments",(function(){return Age})),n.d(se,"mul",(function(){return Xfe})),n.d(se,"multiRNNCell",(function(){return Oge})),n.d(se,"multinomial",(function(){return Dge})),n.d(se,"neg",(function(){return nge})),n.d(se,"notEqual",(function(){return Mge})),n.d(se,"oneHot",(function(){return Phe})),n.d(se,"ones",(function(){return jge})),n.d(se,"onesLike",(function(){return Fge})),n.d(se,"outerProduct",(function(){return Rge})),n.d(se,"pad",(function(){return Pge})),n.d(se,"pad1d",(function(){return Lge})),n.d(se,"pad2d",(function(){return Bge})),n.d(se,"pad3d",(function(){return $ge})),n.d(se,"pad4d",(function(){return zge})),n.d(se,"pool",(function(){return Hge})),n.d(se,"pow",(function(){return dpe})),n.d(se,"prelu",(function(){return Wge})),n.d(se,"print",(function(){return yhe})),n.d(se,"prod",(function(){return Vge})),n.d(se,"rand",(function(){return qge})),n.d(se,"randomGamma",(function(){return Zge})),n.d(se,"randomNormal",(function(){return Jge})),n.d(se,"randomUniform",(function(){return Qge})),n.d(se,"range",(function(){return eve})),n.d(se,"real",(function(){return tve})),n.d(se,"reciprocal",(function(){return nve})),n.d(se,"relu",(function(){return rve})),n.d(se,"relu6",(function(){return ive})),n.d(se,"reshape",(function(){return Ype})),n.d(se,"reverse",(function(){return ave})),n.d(se,"reverse1d",(function(){return ove})),n.d(se,"reverse2d",(function(){return sve})),n.d(se,"reverse3d",(function(){return lve})),n.d(se,"reverse4d",(function(){return uve})),n.d(se,"round",(function(){return cve})),n.d(se,"rsqrt",(function(){return dve})),n.d(se,"scalar",(function(){return ope})),n.d(se,"selu",(function(){return hve})),n.d(se,"separableConv2d",(function(){return fve})),n.d(se,"setdiff1dAsync",(function(){return pve})),n.d(se,"sigmoid",(function(){return Jpe})),n.d(se,"sign",(function(){return mve})),n.d(se,"sin",(function(){return gve})),n.d(se,"sinh",(function(){return vve})),n.d(se,"slice",(function(){return Qpe})),n.d(se,"slice1d",(function(){return yve})),n.d(se,"slice2d",(function(){return bve})),n.d(se,"slice3d",(function(){return xve})),n.d(se,"slice4d",(function(){return wve})),n.d(se,"softmax",(function(){return _ve})),n.d(se,"softplus",(function(){return rge})),n.d(se,"spaceToBatchND",(function(){return Uge})),n.d(se,"fft",(function(){return kve})),n.d(se,"ifft",(function(){return Eve})),n.d(se,"irfft",(function(){return Sve})),n.d(se,"rfft",(function(){return Cve})),n.d(se,"split",(function(){return Tve})),n.d(se,"sqrt",(function(){return Kfe})),n.d(se,"square",(function(){return Zfe})),n.d(se,"squaredDifference",(function(){return Ive})),n.d(se,"squeeze",(function(){return Ave})),n.d(se,"stack",(function(){return Ove})),n.d(se,"step",(function(){return Dve})),n.d(se,"stridedSlice",(function(){return Mve})),n.d(se,"sub",(function(){return hpe})),n.d(se,"sum",(function(){return oge})),n.d(se,"tan",(function(){return Nve})),n.d(se,"tanh",(function(){return eme})),n.d(se,"tensor",(function(){return kde})),n.d(se,"tensor1d",(function(){return jve})),n.d(se,"tensor2d",(function(){return Fve})),n.d(se,"tensor3d",(function(){return $he})),n.d(se,"tensor4d",(function(){return Rve})),n.d(se,"tensor5d",(function(){return Pve})),n.d(se,"tensor6d",(function(){return Lve})),n.d(se,"tile",(function(){return Bme})),n.d(se,"topk",(function(){return Bve})),n.d(se,"truncatedNormal",(function(){return $ve})),n.d(se,"unique",(function(){return zve})),n.d(se,"unsortedSegmentSum",(function(){return Uve})),n.d(se,"unstack",(function(){return Hve})),n.d(se,"variable",(function(){return Wve})),n.d(se,"where",(function(){return Dme})),n.d(se,"whereAsync",(function(){return qve})),n.d(se,"zeros",(function(){return Nge})),n.d(se,"zerosLike",(function(){return Jfe})),n.d(se,"booleanMaskAsync",(function(){return Gve})),n.d(se,"equalStrict",(function(){return Yve})),n.d(se,"greaterEqualStrict",(function(){return Xve})),n.d(se,"greaterStrict",(function(){return Kve})),n.d(se,"lessEqualStrict",(function(){return Zve})),n.d(se,"lessStrict",(function(){return Jve})),n.d(se,"notEqualStrict",(function(){return Qve})),n.d(se,"addStrict",(function(){return eye})),n.d(se,"divStrict",(function(){return tye})),n.d(se,"maximumStrict",(function(){return nye})),n.d(se,"minimumStrict",(function(){return rye})),n.d(se,"modStrict",(function(){return iye})),n.d(se,"mulStrict",(function(){return aye})),n.d(se,"powStrict",(function(){return oye})),n.d(se,"squaredDifferenceStrict",(function(){return sye})),n.d(se,"subStrict",(function(){return lye})),n.d(se,"transpose",(function(){return Lhe})),n.d(se,"norm",(function(){return uye})),n.d(se,"movingAverage",(function(){return cye})),n.d(se,"scatterND",(function(){return dye})),n.d(se,"sparseToDense",(function(){return hye})),n.d(se,"gatherND",(function(){return fye})),n.d(se,"dropout",(function(){return pye})),n.d(se,"enclosingPowerOfTwo",(function(){return mye})),n.d(se,"cosineWindow",(function(){return gye})),n.d(se,"inTopKAsync",(function(){return vye})),n.d(se,"op",(function(){return xde})),n.d(se,"OP_SCOPE_SUFFIX",(function(){return bde})),n.d(se,"image",(function(){return hbe})),n.d(se,"linalg",(function(){return fbe})),n.d(se,"losses",(function(){return pbe})),n.d(se,"spectral",(function(){return cbe})),n.d(se,"fused",(function(){return M})),n.d(se,"signal",(function(){return dbe})),n.d(se,"Reduction",(function(){return ebe})),n.d(se,"train",(function(){return gbe})),n.d(se,"enableProdMode",(function(){return Sfe})),n.d(se,"enableDebugMode",(function(){return Tfe})),n.d(se,"disableDeprecationWarnings",(function(){return Cfe})),n.d(se,"deprecationWarn",(function(){return Ife})),n.d(se,"disposeVariables",(function(){return Afe})),n.d(se,"engine",(function(){return Ofe})),n.d(se,"memory",(function(){return Dfe})),n.d(se,"profile",(function(){return Mfe})),n.d(se,"tidy",(function(){return Nfe})),n.d(se,"dispose",(function(){return jfe})),n.d(se,"keep",(function(){return Ffe})),n.d(se,"time",(function(){return Rfe})),n.d(se,"setBackend",(function(){return Pfe})),n.d(se,"ready",(function(){return Lfe})),n.d(se,"getBackend",(function(){return Bfe})),n.d(se,"removeBackend",(function(){return $fe})),n.d(se,"findBackend",(function(){return zfe})),n.d(se,"findBackendFactory",(function(){return Ufe})),n.d(se,"registerBackend",(function(){return Hfe})),n.d(se,"backend",(function(){return Wfe})),n.d(se,"setPlatform",(function(){return Vfe})),n.d(se,"getKernel",(function(){return _ce})),n.d(se,"getGradient",(function(){return kce})),n.d(se,"getKernelsForBackend",(function(){return Ece})),n.d(se,"registerKernel",(function(){return Sce})),n.d(se,"registerGradient",(function(){return Tce})),n.d(se,"unregisterKernel",(function(){return Cce})),n.d(se,"unregisterGradient",(function(){return Ice})),n.d(se,"copyRegisteredKernels",(function(){return Ace})),n.d(se,"customGrad",(function(){return ipe})),n.d(se,"grad",(function(){return Qfe})),n.d(se,"grads",(function(){return epe})),n.d(se,"valueAndGrad",(function(){return tpe})),n.d(se,"valueAndGrads",(function(){return npe})),n.d(se,"variableGrads",(function(){return rpe})),n.d(se,"Environment",(function(){return bse})),n.d(se,"env",(function(){return xse})),n.d(se,"ENV",(function(){return _se})),n.d(se,"version_core",(function(){return Efe})),n.d(se,"nextFrame",(function(){return ybe})),n.d(se,"browser",(function(){return T})),n.d(se,"io",(function(){return E})),n.d(se,"math",(function(){return S})),n.d(se,"serialization",(function(){return O})),n.d(se,"test_util",(function(){return D})),n.d(se,"util",(function(){return w})),n.d(se,"backend_util",(function(){return j})),n.d(se,"tensor_util",(function(){return _})),n.d(se,"slice_util",(function(){return A})),n.d(se,"gather_util",(function(){return C})),n.d(se,"scatter_util",(function(){return I})),n.d(se,"device_util",(function(){return k})),n.d(se,"kernel_impls",(function(){return F})),n.d(se,"KernelBackend",(function(){return Toe})),n.d(se,"DataStorage",(function(){return Soe})),n.d(se,"Abs",(function(){return Sse})),n.d(se,"Acos",(function(){return Tse})),n.d(se,"Acosh",(function(){return Cse})),n.d(se,"Add",(function(){return Ise})),n.d(se,"AddN",(function(){return Ase})),n.d(se,"All",(function(){return Ose})),n.d(se,"Any",(function(){return Dse})),n.d(se,"ArgMax",(function(){return Mse})),n.d(se,"ArgMin",(function(){return Nse})),n.d(se,"Asin",(function(){return jse})),n.d(se,"Asinh",(function(){return Fse})),n.d(se,"Atan",(function(){return Rse})),n.d(se,"Atanh",(function(){return Pse})),n.d(se,"Atan2",(function(){return Lse})),n.d(se,"AvgPool",(function(){return Bse})),n.d(se,"AvgPoolGrad",(function(){return $se})),n.d(se,"AvgPool3D",(function(){return zse})),n.d(se,"AvgPool3DGrad",(function(){return Use})),n.d(se,"BatchMatMul",(function(){return Hse})),n.d(se,"BatchToSpaceND",(function(){return Wse})),n.d(se,"Bincount",(function(){return Vse})),n.d(se,"BroadcastTo",(function(){return qse})),n.d(se,"Cast",(function(){return Gse})),n.d(se,"Ceil",(function(){return Yse})),n.d(se,"ClipByValue",(function(){return Xse})),n.d(se,"Complex",(function(){return Kse})),n.d(se,"ComplexAbs",(function(){return Zse})),n.d(se,"Concat",(function(){return Jse})),n.d(se,"Conv2D",(function(){return Qse})),n.d(se,"Conv2DBackpropFilter",(function(){return ele})),n.d(se,"Conv2DBackpropInput",(function(){return tle})),n.d(se,"Conv3D",(function(){return nle})),n.d(se,"Conv3DBackpropFilterV2",(function(){return rle})),n.d(se,"Conv3DBackpropInputV2",(function(){return ile})),n.d(se,"Cos",(function(){return ale})),n.d(se,"Cosh",(function(){return ole})),n.d(se,"Cumsum",(function(){return sle})),n.d(se,"CropAndResize",(function(){return lle})),n.d(se,"DenseBincount",(function(){return ule})),n.d(se,"DepthToSpace",(function(){return cle})),n.d(se,"DepthwiseConv2dNative",(function(){return dle})),n.d(se,"DepthwiseConv2dNativeBackpropFilter",(function(){return hle})),n.d(se,"DepthwiseConv2dNativeBackpropInput",(function(){return fle})),n.d(se,"Diag",(function(){return ple})),n.d(se,"Dilation2D",(function(){return mle})),n.d(se,"Dilation2DBackpropInput",(function(){return gle})),n.d(se,"Dilation2DBackpropFilter",(function(){return vle})),n.d(se,"RealDiv",(function(){return yle})),n.d(se,"Elu",(function(){return ble})),n.d(se,"EluGrad",(function(){return xle})),n.d(se,"Erf",(function(){return wle})),n.d(se,"Equal",(function(){return _le})),n.d(se,"Exp",(function(){return kle})),n.d(se,"ExpandDims",(function(){return Ele})),n.d(se,"Expm1",(function(){return Sle})),n.d(se,"FFT",(function(){return Tle})),n.d(se,"Fill",(function(){return Cle})),n.d(se,"FlipLeftRight",(function(){return Ile})),n.d(se,"Floor",(function(){return Ale})),n.d(se,"FloorDiv",(function(){return Ole})),n.d(se,"FusedBatchNorm",(function(){return Dle})),n.d(se,"GatherV2",(function(){return Mle})),n.d(se,"GatherNd",(function(){return Nle})),n.d(se,"Greater",(function(){return jle})),n.d(se,"GreaterEqual",(function(){return Fle})),n.d(se,"Identity",(function(){return Rle})),n.d(se,"IFFT",(function(){return Ple})),n.d(se,"Imag",(function(){return Lle})),n.d(se,"IsFinite",(function(){return Ble})),n.d(se,"IsInf",(function(){return $le})),n.d(se,"IsNan",(function(){return zle})),n.d(se,"LeakyRelu",(function(){return Ule})),n.d(se,"Less",(function(){return Hle})),n.d(se,"LessEqual",(function(){return Wle})),n.d(se,"LinSpace",(function(){return Vle})),n.d(se,"Log",(function(){return qle})),n.d(se,"Log1p",(function(){return Gle})),n.d(se,"LogicalAnd",(function(){return Yle})),n.d(se,"LogicalNot",(function(){return Xle})),n.d(se,"LogicalOr",(function(){return Kle})),n.d(se,"LogSoftmax",(function(){return Zle})),n.d(se,"LRN",(function(){return Jle})),n.d(se,"LRNGrad",(function(){return Qle})),n.d(se,"Max",(function(){return eue})),n.d(se,"Maximum",(function(){return tue})),n.d(se,"MaxPool",(function(){return nue})),n.d(se,"MaxPoolGrad",(function(){return rue})),n.d(se,"MaxPool3D",(function(){return iue})),n.d(se,"MaxPool3DGrad",(function(){return aue})),n.d(se,"MaxPoolWithArgmax",(function(){return oue})),n.d(se,"Mean",(function(){return sue})),n.d(se,"Min",(function(){return lue})),n.d(se,"Minimum",(function(){return uue})),n.d(se,"MirrorPad",(function(){return cue})),n.d(se,"Mod",(function(){return due})),n.d(se,"Multinomial",(function(){return hue})),n.d(se,"Multiply",(function(){return fue})),n.d(se,"Neg",(function(){return pue})),n.d(se,"NotEqual",(function(){return mue})),n.d(se,"NonMaxSuppressionV3",(function(){return gue})),n.d(se,"NonMaxSuppressionV4",(function(){return vue})),n.d(se,"NonMaxSuppressionV5",(function(){return yue})),n.d(se,"OnesLike",(function(){return bue})),n.d(se,"OneHot",(function(){return xue})),n.d(se,"Pack",(function(){return wue})),n.d(se,"PadV2",(function(){return _ue})),n.d(se,"Pool",(function(){return kue})),n.d(se,"Pow",(function(){return Eue})),n.d(se,"Prelu",(function(){return Sue})),n.d(se,"Prod",(function(){return Tue})),n.d(se,"Range",(function(){return Cue})),n.d(se,"Real",(function(){return Iue})),n.d(se,"Reciprocal",(function(){return Aue})),n.d(se,"Relu",(function(){return Oue})),n.d(se,"Reshape",(function(){return Due})),n.d(se,"ResizeNearestNeighbor",(function(){return Mue})),n.d(se,"ResizeNearestNeighborGrad",(function(){return Nue})),n.d(se,"ResizeBilinear",(function(){return jue})),n.d(se,"ResizeBilinearGrad",(function(){return Fue})),n.d(se,"Relu6",(function(){return Rue})),n.d(se,"Reverse",(function(){return Pue})),n.d(se,"Round",(function(){return Lue})),n.d(se,"Rsqrt",(function(){return Bue})),n.d(se,"ScatterNd",(function(){return $ue})),n.d(se,"Select",(function(){return zue})),n.d(se,"Selu",(function(){return Uue})),n.d(se,"Slice",(function(){return Hue})),n.d(se,"Sin",(function(){return Wue})),n.d(se,"Sinh",(function(){return Vue})),n.d(se,"Sign",(function(){return que})),n.d(se,"Sigmoid",(function(){return Gue})),n.d(se,"Softplus",(function(){return Yue})),n.d(se,"Sqrt",(function(){return Xue})),n.d(se,"Sum",(function(){return Kue})),n.d(se,"SpaceToBatchND",(function(){return Zue})),n.d(se,"SplitV",(function(){return Jue})),n.d(se,"Softmax",(function(){return Que})),n.d(se,"SquaredDifference",(function(){return ece})),n.d(se,"Square",(function(){return tce})),n.d(se,"Sub",(function(){return nce})),n.d(se,"SparseToDense",(function(){return rce})),n.d(se,"StridedSlice",(function(){return ice})),n.d(se,"Tan",(function(){return ace})),n.d(se,"Tanh",(function(){return oce})),n.d(se,"Tile",(function(){return sce})),n.d(se,"TopK",(function(){return lce})),n.d(se,"Transpose",(function(){return uce})),n.d(se,"Unique",(function(){return cce})),n.d(se,"Unpack",(function(){return dce})),n.d(se,"UnsortedSegmentSum",(function(){return hce})),n.d(se,"ZerosLike",(function(){return fce})),n.d(se,"Step",(function(){return pce})),n.d(se,"FromPixels",(function(){return mce})),n.d(se,"RotateWithOffset",(function(){return gce})),n.d(se,"_FusedMatMul",(function(){return vce})),n.d(se,"FusedConv2D",(function(){return yce})),n.d(se,"FusedDepthwiseConv2D",(function(){return bce})),n.d(se,"CallbackList",(function(){return Bke})),n.d(se,"CustomCallback",(function(){return Uke})),n.d(se,"History",(function(){return zke})),n.d(se,"Callback",(function(){return jIe})),n.d(se,"callbacks",(function(){return LIe})),n.d(se,"EarlyStopping",(function(){return PIe})),n.d(se,"InputSpec",(function(){return Cke})),n.d(se,"SymbolicTensor",(function(){return Ike})),n.d(se,"LayersModel",(function(){return VEe})),n.d(se,"input",(function(){return JEe})),n.d(se,"loadLayersModel",(function(){return ZEe})),n.d(se,"model",(function(){return XEe})),n.d(se,"registerCallbackConstructor",(function(){return QEe})),n.d(se,"sequential",(function(){return KEe})),n.d(se,"RNN",(function(){return XSe})),n.d(se,"Sequential",(function(){return YEe})),n.d(se,"LayerVariable",(function(){return Eke})),n.d(se,"version_layers",(function(){return xEe})),n.d(se,"constraints",(function(){return R})),n.d(se,"initializers",(function(){return P})),n.d(se,"layers",(function(){return L})),n.d(se,"metrics",(function(){return B})),n.d(se,"models",(function(){return $})),n.d(se,"regularizers",(function(){return z})),n.d(se,"GraphModel",(function(){return YAe})),n.d(se,"loadGraphModel",(function(){return XAe})),n.d(se,"deregisterOp",(function(){return WIe})),n.d(se,"registerOp",(function(){return UIe})),n.d(se,"version_converter",(function(){return KAe})),n.d(se,"data",(function(){return ae})),n.d(se,"version",(function(){return MWe}));let ue=!1;const ce={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else ue&&console.log("RxJS: Back to a better error behavior. Thank you. <3");ue=e},get useDeprecatedSynchronousErrorHandling(){return ue}};function de(e){setTimeout(()=>{throw e},0)}const he={closed:!0,next(e){},error(e){if(ce.useDeprecatedSynchronousErrorHandling)throw e;de(e)},complete(){}},fe=(()=>Array.isArray||(e=>e&&"number"==typeof e.length))();function pe(e){return null!==e&&"object"==typeof e}const me=(()=>{function e(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((e,t)=>`${t+1}) ${e.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e})();let ge=(()=>{class e{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let t;if(this.closed)return;let{_parentOrParents:n,_ctorUnsubscribe:r,_unsubscribe:i,_subscriptions:a}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(null!==n)for(let e=0;e<n.length;++e)n[e].remove(this);if(le(i)){r&&(this._unsubscribe=void 0);try{i.call(this)}catch(o){t=o instanceof me?ve(o.errors):[o]}}if(fe(a)){let e=-1,n=a.length;for(;++e<n;){const n=a[e];if(pe(n))try{n.unsubscribe()}catch(o){t=t||[],o instanceof me?t=t.concat(ve(o.errors)):t.push(o)}}}if(t)throw new me(t)}add(t){let n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){const t=n;n=new e,n._subscriptions=[t]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}let{_parentOrParents:r}=n;if(null===r)n._parentOrParents=this;else if(r instanceof e){if(r===this)return n;n._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return n;r.push(this)}const i=this._subscriptions;return null===i?this._subscriptions=[n]:i.push(n),n}remove(e){const t=this._subscriptions;if(t){const n=t.indexOf(e);-1!==n&&t.splice(n,1)}}}return e.EMPTY=function(e){return e.closed=!0,e}(new e),e})();function ve(e){return e.reduce((e,t)=>e.concat(t instanceof me?t.errors:t),[])}const ye=(()=>"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random())();class be extends ge{constructor(e,t,n){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=he;break;case 1:if(!e){this.destination=he;break}if("object"==typeof e){e instanceof be?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new xe(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new xe(this,e,t,n)}}[ye](){return this}static create(e,t,n){const r=new be(e,t,n);return r.syncErrorThrowable=!1,r}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class xe extends be{constructor(e,t,n,r){let i;super(),this._parentSubscriber=e;let a=this;le(t)?i=t:t&&(i=t.next,n=t.error,r=t.complete,t!==he&&(a=Object.create(t),le(a.unsubscribe)&&this.add(a.unsubscribe.bind(a)),a.unsubscribe=this.unsubscribe.bind(this))),this._context=a,this._next=i,this._error=n,this._complete=r}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:t}=this;ce.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:t}=this,{useDeprecatedSynchronousErrorHandling:n}=ce;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):de(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;de(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const t=()=>this._complete.call(this._context);ce.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,t),this.unsubscribe()):(this.__tryOrUnsub(t),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,t){try{e.call(this._context,t)}catch(n){if(this.unsubscribe(),ce.useDeprecatedSynchronousErrorHandling)throw n;de(n)}}__tryOrSetError(e,t,n){if(!ce.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(r){return ce.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=r,e.syncErrorThrown=!0,!0):(de(r),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const we=(()=>"function"==typeof Symbol&&Symbol.observable||"@@observable")();function _e(e){return e}let ke=(()=>{class e{constructor(e){this._isScalar=!1,e&&(this._subscribe=e)}lift(t){const n=new e;return n.source=this,n.operator=t,n}subscribe(e,t,n){const{operator:r}=this,i=function(e,t,n){if(e){if(e instanceof be)return e;if(e[ye])return e[ye]()}return e||t||n?new be(e,t,n):new be(he)}(e,t,n);if(i.add(r?r.call(i,this.source):this.source||ce.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),ce.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i}_trySubscribe(e){try{return this._subscribe(e)}catch(t){ce.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){const{closed:t,destination:n,isStopped:r}=e;if(t||r)return!1;e=n&&n instanceof be?n:null}return!0}(e)?e.error(t):console.warn(t)}}forEach(e,t){return new(t=Ee(t))((t,n)=>{let r;r=this.subscribe(t=>{try{e(t)}catch(i){n(i),r&&r.unsubscribe()}},n,t)})}_subscribe(e){const{source:t}=this;return t&&t.subscribe(e)}[we](){return this}pipe(...e){return 0===e.length?this:(0===(t=e).length?_e:1===t.length?t[0]:function(e){return t.reduce((e,t)=>t(e),e)})(this);var t}toPromise(e){return new(e=Ee(e))((e,t)=>{let n;this.subscribe(e=>n=e,e=>t(e),()=>e(n))})}}return e.create=t=>new e(t),e})();function Ee(e){if(e||(e=ce.Promise||Promise),!e)throw new Error("no Promise impl found");return e}const Se=(()=>{function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e})();class Te extends ge{constructor(e,t){super(),this.subject=e,this.subscriber=t,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,t=e.observers;if(this.subject=null,!t||0===t.length||e.isStopped||e.closed)return;const n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}class Ce extends be{constructor(e){super(e),this.destination=e}}let Ie=(()=>{class e extends ke{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[ye](){return new Ce(this)}lift(e){const t=new Ae(this,this);return t.operator=e,t}next(e){if(this.closed)throw new Se;if(!this.isStopped){const{observers:t}=this,n=t.length,r=t.slice();for(let i=0;i<n;i++)r[i].next(e)}}error(e){if(this.closed)throw new Se;this.hasError=!0,this.thrownError=e,this.isStopped=!0;const{observers:t}=this,n=t.length,r=t.slice();for(let i=0;i<n;i++)r[i].error(e);this.observers.length=0}complete(){if(this.closed)throw new Se;this.isStopped=!0;const{observers:e}=this,t=e.length,n=e.slice();for(let r=0;r<t;r++)n[r].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(e){if(this.closed)throw new Se;return super._trySubscribe(e)}_subscribe(e){if(this.closed)throw new Se;return this.hasError?(e.error(this.thrownError),ge.EMPTY):this.isStopped?(e.complete(),ge.EMPTY):(this.observers.push(e),new Te(this,e))}asObservable(){const e=new ke;return e.source=this,e}}return e.create=(e,t)=>new Ae(e,t),e})();class Ae extends Ie{constructor(e,t){super(),this.destination=e,this.source=t}next(e){const{destination:t}=this;t&&t.next&&t.next(e)}error(e){const{destination:t}=this;t&&t.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:t}=this;return t?this.source.subscribe(e):ge.EMPTY}}function Oe(e){return e&&"function"==typeof e.schedule}function De(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new Me(e,t))}}class Me{constructor(e,t){this.project=e,this.thisArg=t}call(e,t){return t.subscribe(new Ne(e,this.project,this.thisArg))}}class Ne extends be{constructor(e,t,n){super(e),this.project=t,this.count=0,this.thisArg=n||this}_next(e){let t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}const je=e=>t=>{for(let n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()};function Fe(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}const Re=Fe(),Pe=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Le(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}const Be=e=>{if(e&&"function"==typeof e[we])return r=e,e=>{const t=r[we]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(Pe(e))return je(e);if(Le(e))return n=e,e=>(n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,de),e);if(e&&"function"==typeof e[Re])return t=e,e=>{const n=t[Re]();for(;;){let t;try{t=n.next()}catch(r){return e.error(r),e}if(t.done){e.complete();break}if(e.next(t.value),e.closed)break}return"function"==typeof n.return&&e.add(()=>{n.return&&n.return()}),e};{const t=pe(e)?"an invalid object":`'${e}'`;throw new TypeError(`You provided ${t} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`)}var t,n,r};function $e(e,t){return new ke(n=>{const r=new ge;let i=0;return r.add(t.schedule((function(){i!==e.length?(n.next(e[i++]),n.closed||r.add(this.schedule())):n.complete()}))),r})}function ze(e,t){return t?function(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[we]}(e))return function(e,t){return new ke(n=>{const r=new ge;return r.add(t.schedule(()=>{const i=e[we]();r.add(i.subscribe({next(e){r.add(t.schedule(()=>n.next(e)))},error(e){r.add(t.schedule(()=>n.error(e)))},complete(){r.add(t.schedule(()=>n.complete()))}}))})),r})}(e,t);if(Le(e))return function(e,t){return new ke(n=>{const r=new ge;return r.add(t.schedule(()=>e.then(e=>{r.add(t.schedule(()=>{n.next(e),r.add(t.schedule(()=>n.complete()))}))},e=>{r.add(t.schedule(()=>n.error(e)))}))),r})}(e,t);if(Pe(e))return $e(e,t);if(function(e){return e&&"function"==typeof e[Re]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new ke(n=>{const r=new ge;let i;return r.add(()=>{i&&"function"==typeof i.return&&i.return()}),r.add(t.schedule(()=>{i=e[Re](),r.add(t.schedule((function(){if(n.closed)return;let e,t;try{const n=i.next();e=n.value,t=n.done}catch(r){return void n.error(r)}t?n.complete():(n.next(e),this.schedule())})))})),r})}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}(e,t):e instanceof ke?e:new ke(Be(e))}class Ue extends be{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class He extends be{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function We(e,t){if(!t.closed)return e instanceof ke?e.subscribe(t):Be(e)(t)}function Ve(e,t,n=Number.POSITIVE_INFINITY){return"function"==typeof t?r=>r.pipe(Ve((n,r)=>ze(e(n,r)).pipe(De((e,i)=>t(n,e,r,i))),n)):("number"==typeof t&&(n=t),t=>t.lift(new qe(e,n)))}class qe{constructor(e,t=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=t}call(e,t){return t.subscribe(new Ge(e,this.project,this.concurrent))}}class Ge extends He{constructor(e,t,n=Number.POSITIVE_INFINITY){super(e),this.project=t,this.concurrent=n,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let t;const n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(t)}_innerSub(e){const t=new Ue(this),n=this.destination;n.add(t);const r=We(e,t);r!==t&&n.add(r)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function Ye(e=Number.POSITIVE_INFINITY){return Ve(_e,e)}function Xe(e,t){return t?$e(e,t):new ke(je(e))}function Ke(){return function(e){return e.lift(new Ze(e))}}class Ze{constructor(e){this.connectable=e}call(e,t){const{connectable:n}=this;n._refCount++;const r=new Je(e,n),i=t.subscribe(r);return r.closed||(r.connection=n.connect()),i}}class Je extends be{constructor(e,t){super(e),this.connectable=t}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);const{connection:n}=this,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}class Qe extends ke{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new ge,e.add(this.source.subscribe(new tt(this.getSubject(),this))),e.closed&&(this._connection=null,e=ge.EMPTY)),e}refCount(){return Ke()(this)}}const et=(()=>{const e=Qe.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}})();class tt extends Ce{constructor(e,t){super(e),this.connectable=t}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}function nt(){return new Ie}function rt(e){return{toString:e}.toString()}const it="__parameters__";function at(e,t,n){return rt(()=>{const r=function(e){return function(...t){if(e){const n=e(...t);for(const e in n)this[e]=n[e]}}}(t);function i(...e){if(this instanceof i)return r.apply(this,e),this;const t=new i(...e);return n.annotation=t,n;function n(e,n,r){const i=e.hasOwnProperty(it)?e[it]:Object.defineProperty(e,it,{value:[]})[it];for(;i.length<=r;)i.push(null);return(i[r]=i[r]||[]).push(t),e}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i})}const ot=at("Inject",e=>({token:e})),st=at("Optional"),lt=at("Self"),ut=at("SkipSelf");var ct=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}({});function dt(e){for(let t in e)if(e[t]===dt)return t;throw Error("Could not find renamed property on target object.")}function ht(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function ft(e){return{factory:e.factory,providers:e.providers||[],imports:e.imports||[]}}function pt(e){return mt(e,e[vt])||mt(e,e[xt])}function mt(e,t){return t&&t.token===e?t:null}function gt(e){return e&&(e.hasOwnProperty(yt)||e.hasOwnProperty(wt))?e[yt]:null}const vt=dt({"\u0275prov":dt}),yt=dt({"\u0275inj":dt}),bt=dt({"\u0275provFallback":dt}),xt=dt({ngInjectableDef:dt}),wt=dt({ngInjectorDef:dt});function _t(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(_t).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return""+e.overriddenName;if(e.name)return""+e.name;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function kt(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const Et=dt({__forward_ref__:dt});function St(e){return e.__forward_ref__=St,e.toString=function(){return _t(this())},e}function Tt(e){return"function"==typeof(t=e)&&t.hasOwnProperty(Et)&&t.__forward_ref__===St?e():e;var t}const Ct="undefined"!=typeof globalThis&&globalThis,It="undefined"!=typeof window&&window,At="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Ot="undefined"!=typeof global&&global,Dt=Ct||Ot||It||At,Mt=dt({"\u0275cmp":dt}),Nt=dt({"\u0275dir":dt}),jt=dt({"\u0275pipe":dt}),Ft=dt({"\u0275mod":dt}),Rt=dt({"\u0275loc":dt}),Pt=dt({"\u0275fac":dt}),Lt=dt({__NG_ELEMENT_ID__:dt});class Bt{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=ht({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return"InjectionToken "+this._desc}}const $t=new Bt("INJECTOR",-1),zt={},Ut=/\n/gm,Ht="__source",Wt=dt({provide:String,useValue:dt});let Vt,qt=void 0;function Gt(e){const t=qt;return qt=e,t}function Yt(e){const t=Vt;return Vt=e,t}function Xt(e,t=ct.Default){if(void 0===qt)throw new Error("inject() must be called from an injection context");return null===qt?Zt(e,void 0,t):qt.get(e,t&ct.Optional?null:void 0,t)}function Kt(e,t=ct.Default){return(Vt||Xt)(Tt(e),t)}function Zt(e,t,n){const r=pt(e);if(r&&"root"==r.providedIn)return void 0===r.value?r.value=r.factory():r.value;if(n&ct.Optional)return null;if(void 0!==t)return t;throw new Error(`Injector: NOT_FOUND [${_t(e)}]`)}function Jt(e){const t=[];for(let n=0;n<e.length;n++){const r=Tt(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");let e=void 0,n=ct.Default;for(let t=0;t<r.length;t++){const i=r[t];i instanceof st||"Optional"===i.ngMetadataName||i===st?n|=ct.Optional:i instanceof ut||"SkipSelf"===i.ngMetadataName||i===ut?n|=ct.SkipSelf:i instanceof lt||"Self"===i.ngMetadataName||i===lt?n|=ct.Self:e=i instanceof ot||i===ot?i.token:i}t.push(Kt(e,n))}else t.push(Kt(r))}return t}class Qt{get(e,t=zt){if(t===zt){const t=new Error(`NullInjectorError: No provider for ${_t(e)}!`);throw t.name="NullInjectorError",t}return t}}class en{}class tn{}function nn(e,t){e.forEach(e=>Array.isArray(e)?nn(e,t):t(e))}function rn(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function an(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function on(e,t,n){let r=ln(e,t);return r>=0?e[1|r]=n:(r=~r,function(e,t,n,r){let i=e.length;if(i==t)e.push(n,r);else if(1===i)e.push(r,e[0]),e[0]=n;else{for(i--,e.push(e[i-1],e[i]);i>t;)e[i]=e[i-2],i--;e[t]=n,e[t+1]=r}}(e,r,t,n)),r}function sn(e,t){const n=ln(e,t);if(n>=0)return e[1|n]}function ln(e,t){return function(e,t,n){let r=0,i=e.length>>1;for(;i!==r;){const n=r+(i-r>>1),a=e[n<<1];if(t===a)return n<<1;a>t?i=n:r=n+1}return~(i<<1)}(e,t)}var un=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}({}),cn=function(e){return e[e.Emulated=0]="Emulated",e[e.Native=1]="Native",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}({});const dn={},hn=[];let fn=0;function pn(e){return rt(()=>{const t={},n={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===un.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||hn,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||cn.Emulated,id:"c",styles:e.styles||hn,_:null,setInput:null,schemas:e.schemas||null,tView:null},r=e.directives,i=e.features,a=e.pipes;return n.id+=fn++,n.inputs=bn(e.inputs,t),n.outputs=bn(e.outputs),i&&i.forEach(e=>e(n)),n.directiveDefs=r?()=>("function"==typeof r?r():r).map(mn):null,n.pipeDefs=a?()=>("function"==typeof a?a():a).map(gn):null,n})}function mn(e){return _n(e)||function(e){return e[Nt]||null}(e)}function gn(e){return function(e){return e[jt]||null}(e)}const vn={};function yn(e){const t={type:e.type,bootstrap:e.bootstrap||hn,declarations:e.declarations||hn,imports:e.imports||hn,exports:e.exports||hn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&rt(()=>{vn[e.id]=e.type}),t}function bn(e,t){if(null==e)return dn;const n={};for(const r in e)if(e.hasOwnProperty(r)){let i=e[r],a=i;Array.isArray(i)&&(a=i[1],i=i[0]),n[i]=r,t&&(t[i]=a)}return n}const xn=pn;function wn(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,onDestroy:e.type.prototype.ngOnDestroy||null}}function _n(e){return e[Mt]||null}function kn(e,t){return e.hasOwnProperty(Pt)?e[Pt]:null}function En(e,t){const n=e[Ft]||null;if(!n&&!0===t)throw new Error(`Type ${_t(e)} does not have '\u0275mod' property.`);return n}const Sn=20,Tn=10;function Cn(e){return Array.isArray(e)&&"object"==typeof e[1]}function In(e){return Array.isArray(e)&&!0===e[1]}function An(e){return 0!=(8&e.flags)}function On(e){return 2==(2&e.flags)}function Dn(e){return 1==(1&e.flags)}function Mn(e){return null!==e.template}function Nn(e){return 0!=(512&e[2])}class jn{constructor(e,t,n){this.previousValue=e,this.currentValue=t,this.firstChange=n}isFirstChange(){return this.firstChange}}function Fn(){const e=Pn(this),t=null==e?void 0:e.current;if(t){const n=e.previous;if(n===dn)e.previous=t;else for(let e in t)n[e]=t[e];e.current=null,this.ngOnChanges(t)}}function Rn(e,t,n,r){const i=Pn(e)||function(e,t){return e.__ngSimpleChanges__=t}(e,{previous:dn,current:null}),a=i.current||(i.current={}),o=i.previous,s=this.declaredInputs[n],l=o[s];a[s]=new jn(l&&l.currentValue,t,o===dn),e[r]=t}function Pn(e){return e.__ngSimpleChanges__||null}let Ln=void 0;function Bn(e){return!!e.listen}const $n={createRenderer:(e,t)=>void 0!==Ln?Ln:"undefined"!=typeof document?document:void 0};function zn(e){for(;Array.isArray(e);)e=e[0];return e}function Un(e,t){return zn(t[e+Sn])}function Hn(e,t){return zn(t[e.index])}function Wn(e,t){return e.data[t+Sn]}function Vn(e,t){return e[t+Sn]}function qn(e,t){const n=t[e];return Cn(n)?n:n[0]}function Gn(e){const t=function(e){return e.__ngContext__||null}(e);return t?Array.isArray(t)?t:t.lView:null}function Yn(e){return 4==(4&e[2])}function Xn(e){return 128==(128&e[2])}function Kn(e,t){return null===e||null==t?null:e[t]}function Zn(e){e[18]=0}function Jn(e,t){e[5]+=t;let n=e,r=e[3];for(;null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}const Qn={lFrame:xr(null),bindingsEnabled:!0,checkNoChangesMode:!1};function er(){return Qn.bindingsEnabled}function tr(){return Qn.lFrame.lView}function nr(){return Qn.lFrame.tView}function rr(e){Qn.lFrame.contextLView=e}function ir(){return Qn.lFrame.currentTNode}function ar(e,t){Qn.lFrame.currentTNode=e,Qn.lFrame.isParent=t}function or(){return Qn.lFrame.isParent}function sr(){return Qn.checkNoChangesMode}function lr(e){Qn.checkNoChangesMode=e}function ur(){const e=Qn.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function cr(){return Qn.lFrame.bindingIndex}function dr(){return Qn.lFrame.bindingIndex++}function hr(e){const t=Qn.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}function fr(e,t){const n=Qn.lFrame;n.bindingIndex=n.bindingRootIndex=e,pr(t)}function pr(e){Qn.lFrame.currentDirectiveIndex=e}function mr(){return Qn.lFrame.currentQueryIndex}function gr(e){Qn.lFrame.currentQueryIndex=e}function vr(e,t){const n=br();Qn.lFrame=n,n.currentTNode=t,n.lView=e}function yr(e){const t=br(),n=e[1];Qn.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex}function br(){const e=Qn.lFrame,t=null===e?null:e.child;return null===t?xr(e):t}function xr(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:0,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null};return null!==e&&(e.child=t),t}function wr(){const e=Qn.lFrame;return Qn.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const _r=wr;function kr(){const e=wr();e.isParent=!0,e.tView=null,e.selectedIndex=0,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Er(){return Qn.lFrame.selectedIndex}function Sr(e){Qn.lFrame.selectedIndex=e}function Tr(){const e=Qn.lFrame;return Wn(e.tView,e.selectedIndex)}function Cr(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const t=e.data[n].type.prototype,{ngAfterContentInit:r,ngAfterContentChecked:i,ngAfterViewInit:a,ngAfterViewChecked:o,ngOnDestroy:s}=t;r&&(e.contentHooks||(e.contentHooks=[])).push(-n,r),i&&((e.contentHooks||(e.contentHooks=[])).push(n,i),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,i)),a&&(e.viewHooks||(e.viewHooks=[])).push(-n,a),o&&((e.viewHooks||(e.viewHooks=[])).push(n,o),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,o)),null!=s&&(e.destroyHooks||(e.destroyHooks=[])).push(n,s)}}function Ir(e,t,n){Dr(e,t,3,n)}function Ar(e,t,n,r){(3&e[2])===n&&Dr(e,t,n,r)}function Or(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function Dr(e,t,n,r){const i=null!=r?r:-1;let a=0;for(let o=void 0!==r?65535&e[18]:0;o<t.length;o++)if("number"==typeof t[o+1]){if(a=t[o],null!=r&&a>=r)break}else t[o]<0&&(e[18]+=65536),(a<i||-1==i)&&(Mr(e,n,t,o),e[18]=(4294901760&e[18])+o+2),o++}function Mr(e,t,n,r){const i=n[r]<0,a=n[r+1],o=e[i?-n[r]:n[r]];i?e[2]>>11<e[18]>>16&&(3&e[2])===t&&(e[2]+=2048,a.call(o)):a.call(o)}const Nr=-1;class jr{constructor(e,t,n){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=n}}function Fr(e,t,n){const r=Bn(e);let i=0;for(;i<n.length;){const a=n[i];if("number"==typeof a){if(0!==a)break;i++;const o=n[i++],s=n[i++],l=n[i++];r?e.setAttribute(t,s,l,o):t.setAttributeNS(o,s,l)}else{const o=a,s=n[++i];Pr(o)?r&&e.setProperty(t,o,s):r?e.setAttribute(t,o,s):t.setAttribute(o,s),i++}}return i}function Rr(e){return 3===e||4===e||6===e}function Pr(e){return 64===e.charCodeAt(0)}function Lr(e,t){if(null===t||0===t.length);else if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const i=t[r];"number"==typeof i?n=i:0===n||Br(e,n,i,null,-1===n||2===n?t[++r]:null)}}return e}function Br(e,t,n,r,i){let a=0,o=e.length;if(-1===t)o=-1;else for(;a<e.length;){const n=e[a++];if("number"==typeof n){if(n===t){o=-1;break}if(n>t){o=a-1;break}}}for(;a<e.length;){const t=e[a];if("number"==typeof t)break;if(t===n){if(null===r)return void(null!==i&&(e[a+1]=i));if(r===e[a+1])return void(e[a+2]=i)}a++,null!==r&&a++,null!==i&&a++}-1!==o&&(e.splice(o,0,t),a=o+1),e.splice(a++,0,n),null!==r&&e.splice(a++,0,r),null!==i&&e.splice(a++,0,i)}function $r(e){return e!==Nr}function zr(e){return 32767&e}function Ur(e,t){let n=e>>16,r=t;for(;n>0;)r=r[15],n--;return r}function Hr(e){return"string"==typeof e?e:null==e?"":""+e}function Wr(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Hr(e)}const Vr=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Dt))();function qr(e){return e instanceof Function?e():e}let Gr=!0;function Yr(e){const t=Gr;return Gr=e,t}let Xr=0;function Kr(e,t){const n=Jr(e,t);if(-1!==n)return n;const r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,Zr(r.data,e),Zr(t,null),Zr(r.blueprint,null));const i=Qr(e,t),a=e.injectorIndex;if($r(i)){const e=zr(i),n=Ur(i,t),r=n[1].data;for(let i=0;i<8;i++)t[a+i]=n[e+i]|r[e+i]}return t[a+8]=i,a}function Zr(e,t){e.push(0,0,0,0,0,0,0,0,t)}function Jr(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function Qr(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,i=t;for(;null!==i;){const e=i[1],t=e.type;if(r=2===t?e.declTNode:1===t?i[6]:null,null===r)return Nr;if(n++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return Nr}function ei(e,t,n){!function(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(Lt)&&(r=n[Lt]),null==r&&(r=n[Lt]=Xr++);const i=255&r,a=1<<i,o=64&i,s=32&i,l=t.data;128&i?o?s?l[e+7]|=a:l[e+6]|=a:s?l[e+5]|=a:l[e+4]|=a:o?s?l[e+3]|=a:l[e+2]|=a:s?l[e+1]|=a:l[e]|=a}(e,t,n)}function ti(e,t,n,r=ct.Default,i){if(null!==e){const i=function(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(Lt)?e[Lt]:void 0;return"number"==typeof t&&t>0?255&t:t}(n);if("function"==typeof i){vr(t,e);try{const e=i();if(null!=e||r&ct.Optional)return e;throw new Error(`No provider for ${Wr(n)}!`)}finally{_r()}}else if("number"==typeof i){if(-1===i)return new li(e,t);let a=null,o=Jr(e,t),s=Nr,l=r&ct.Host?t[16][6]:null;for((-1===o||r&ct.SkipSelf)&&(s=-1===o?Qr(e,t):t[o+8],s!==Nr&&si(r,!1)?(a=t[1],o=zr(s),t=Ur(s,t)):o=-1);-1!==o;){const e=t[1];if(oi(i,o,e.data)){const e=ri(o,t,n,a,r,l);if(e!==ni)return e}s=t[o+8],s!==Nr&&si(r,t[1].data[o+8]===l)&&oi(i,o,t)?(a=e,o=zr(s),t=Ur(s,t)):o=-1}}}if(r&ct.Optional&&void 0===i&&(i=null),0==(r&(ct.Self|ct.Host))){const e=t[9],a=Yt(void 0);try{return e?e.get(n,i,r&ct.Optional):Zt(n,i,r&ct.Optional)}finally{Yt(a)}}if(r&ct.Optional)return i;throw new Error(`NodeInjector: NOT_FOUND [${Wr(n)}]`)}const ni={};function ri(e,t,n,r,i,a){const o=t[1],s=o.data[e+8],l=ii(s,o,n,null==r?On(s)&&Gr:r!=o&&2===s.type,i&ct.Host&&a===s);return null!==l?ai(t,o,l,s):ni}function ii(e,t,n,r,i){const a=e.providerIndexes,o=t.data,s=1048575&a,l=e.directiveStart,u=a>>20,c=i?s+u:e.directiveEnd;for(let d=r?s:s+u;d<c;d++){const e=o[d];if(d<l&&n===e||d>=l&&e.type===n)return d}if(i){const e=o[l];if(e&&Mn(e)&&e.type===n)return l}return null}function ai(e,t,n,r){let i=e[n];const a=t.data;if(i instanceof jr){const o=i;if(o.resolving)throw new Error("Circular dep for "+Wr(a[n]));const s=Yr(o.canSeeViewProviders);o.resolving=!0;const l=o.injectImpl?Yt(o.injectImpl):null;vr(e,r);try{i=e[n]=o.factory(void 0,a,e,r),t.firstCreatePass&&n>=r.directiveStart&&function(e,t,n){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:a}=t.type.prototype;if(r){const r=((o=t).type.prototype.ngOnChanges&&(o.setInput=Rn),Fn);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,r),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,r)}var o;i&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,i),a&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,a),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,a))}(n,a[n],t)}finally{null!==l&&Yt(l),Yr(s),o.resolving=!1,_r()}}return i}function oi(e,t,n){const r=64&e,i=32&e;let a;return a=128&e?r?i?n[t+7]:n[t+6]:i?n[t+5]:n[t+4]:r?i?n[t+3]:n[t+2]:i?n[t+1]:n[t],!!(a&1<<e)}function si(e,t){return!(e&ct.Self||e&ct.Host&&t)}class li{constructor(e,t){this._tNode=e,this._lView=t}get(e,t){return ti(this._tNode,this._lView,e,void 0,t)}}function ui(e){return e.ngDebugContext}function ci(e){return e.ngOriginalError}function di(e,...t){e.error(...t)}class hi{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),n=this._findContext(e),r=function(e){return e.ngErrorLogger||di}(e);r(this._console,"ERROR",e),t&&r(this._console,"ORIGINAL ERROR",t),n&&r(this._console,"ERROR CONTEXT",n)}_findContext(e){return e?ui(e)?ui(e):this._findContext(ci(e)):null}_findOriginalError(e){let t=ci(e);for(;t&&ci(t);)t=ci(t);return t}}let fi=!0,pi=!1;function mi(){return pi=!0,fi}function gi(e,t){e.__ngContext__=t}function vi(e,t,n){let r=e.length;for(;;){const i=e.indexOf(t,n);if(-1===i)return i;if(0===i||e.charCodeAt(i-1)<=32){const n=t.length;if(i+n===r||e.charCodeAt(i+n)<=32)return i}n=i+1}}const yi="ng-template";function bi(e,t,n){let r=0;for(;r<e.length;){let i=e[r++];if(n&&"class"===i){if(i=e[r],-1!==vi(i.toLowerCase(),t,0))return!0}else if(1===i){for(;r<e.length&&"string"==typeof(i=e[r++]);)if(i.toLowerCase()===t)return!0;return!1}}return!1}function xi(e){return 0===e.type&&e.tagName!==yi}function wi(e,t,n){return t===(0!==e.type||n?e.tagName:yi)}function _i(e,t,n){let r=4;const i=e.attrs||[],a=function(e){for(let t=0;t<e.length;t++)if(Rr(e[t]))return t;return e.length}(i);let o=!1;for(let s=0;s<t.length;s++){const l=t[s];if("number"!=typeof l){if(!o)if(4&r){if(r=2|1&r,""!==l&&!wi(e,l,n)||""===l&&1===t.length){if(ki(r))return!1;o=!0}}else{const u=8&r?l:t[++s];if(8&r&&null!==e.attrs){if(!bi(e.attrs,u,n)){if(ki(r))return!1;o=!0}continue}const c=Ei(8&r?"class":l,i,xi(e),n);if(-1===c){if(ki(r))return!1;o=!0;continue}if(""!==u){let e;e=c>a?"":i[c+1].toLowerCase();const t=8&r?e:null;if(t&&-1!==vi(t,u,0)||2&r&&u!==e){if(ki(r))return!1;o=!0}}}}else{if(!o&&!ki(r)&&!ki(l))return!1;if(o&&ki(l))continue;o=!1,r=l|1&r}}return ki(r)||o}function ki(e){return 0==(1&e)}function Ei(e,t,n,r){if(null===t)return-1;let i=0;if(r||!n){let n=!1;for(;i<t.length;){const r=t[i];if(r===e)return i;if(3===r||6===r)n=!0;else{if(1===r||2===r){let e=t[++i];for(;"string"==typeof e;)e=t[++i];continue}if(4===r)break;if(0===r){i+=4;continue}}i+=n?1:2}return-1}return function(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function Si(e,t,n=!1){for(let r=0;r<t.length;r++)if(_i(e,t[r],n))return!0;return!1}function Ti(e,t){return e?":not("+t.trim()+")":t}function Ci(e){let t=e[0],n=1,r=2,i="",a=!1;for(;n<e.length;){let o=e[n];if("string"==typeof o)if(2&r){const t=e[++n];i+="["+o+(t.length>0?'="'+t+'"':"")+"]"}else 8&r?i+="."+o:4&r&&(i+=" "+o);else""===i||ki(o)||(t+=Ti(a,i),i=""),r=o,a=a||!ki(r);n++}return""!==i&&(t+=Ti(a,i)),t}const Ii={};function Ai(e){const t=e[3];return In(t)?t[3]:t}function Oi(e){return Mi(e[13])}function Di(e){return Mi(e[4])}function Mi(e){for(;null!==e&&!In(e);)e=e[4];return e}function Ni(e){ji(nr(),tr(),Er()+e,sr())}function ji(e,t,n,r){if(!r)if(3==(3&t[2])){const r=e.preOrderCheckHooks;null!==r&&Ir(t,r,n)}else{const r=e.preOrderHooks;null!==r&&Ar(t,r,0,n)}Sr(n)}function Fi(e,t){return e<<17|t<<2}function Ri(e){return e>>17&32767}function Pi(e){return 2|e}function Li(e){return(131068&e)>>2}function Bi(e,t){return-131069&e|t<<2}function $i(e){return 1|e}function zi(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const i=n[r],a=n[r+1];if(-1!==a){const n=e.data[a];gr(i),n.contentQueries(2,t[a],a)}}}function Ui(e,t,n){return Bn(t)?t.createElement(e,n):null===n?t.createElement(e):t.createElementNS(n,e)}function Hi(e,t,n,r,i,a,o,s,l,u){const c=t.blueprint.slice();return c[0]=i,c[2]=140|r,Zn(c),c[3]=c[15]=e,c[8]=n,c[10]=o||e&&e[10],c[11]=s||e&&e[11],c[12]=l||e&&e[12]||null,c[9]=u||e&&e[9]||null,c[6]=a,c[16]=2==t.type?e[16]:c,c}function Wi(e,t,n,r,i){const a=t+Sn,o=e.data[a]||function(e,t,n,r,i){const a=ir(),o=or(),s=e.data[t]=function(e,t,n,r,i,a){return{type:n,index:r,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,tagName:i,attrs:a,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?a:a&&a.parent,n,t,r,i);return null===e.firstChild&&(e.firstChild=s),null!==a&&(o&&null==a.child&&null!==s.parent?a.child=s:o||(a.next=s)),s}(e,a,n,r,i);return ar(o,!0),o}function Vi(e,t,n){yr(t);try{const r=e.viewQuery;null!==r&&wa(1,r,n);const i=e.template;null!==i&&Yi(e,t,i,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&zi(e,t),e.staticViewQueries&&wa(2,e.viewQuery,n);const a=e.components;null!==a&&function(e,t){for(let n=0;n<t.length;n++)ga(e,t[n])}(t,a)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0),r}finally{t[2]&=-5,kr()}}function qi(e,t,n,r){const i=t[2];if(256==(256&i))return;yr(t);const a=sr();try{Zn(t),Qn.lFrame.bindingIndex=e.bindingStartIndex,null!==n&&Yi(e,t,n,2,r);const o=3==(3&i);if(!a)if(o){const n=e.preOrderCheckHooks;null!==n&&Ir(t,n,null)}else{const n=e.preOrderHooks;null!==n&&Ar(t,n,0,null),Or(t,0)}if(function(e){for(let t=Oi(e);null!==t;t=Di(t)){if(!t[2])continue;const e=t[9];for(let t=0;t<e.length;t++){const n=e[t],r=n[3];0==(1024&n[2])&&Jn(r,1),n[2]|=1024}}}(t),function(e){for(let t=Oi(e);null!==t;t=Di(t))for(let e=Tn;e<t.length;e++){const n=t[e],r=n[1];Xn(n)&&qi(r,n,r.template,n[8])}}(t),null!==e.contentQueries&&zi(e,t),!a)if(o){const n=e.contentCheckHooks;null!==n&&Ir(t,n)}else{const n=e.contentHooks;null!==n&&Ar(t,n,1),Or(t,1)}!function(e,t){try{const n=e.expandoInstructions;if(null!==n){let r=e.expandoStartIndex,i=-1,a=-1;for(let e=0;e<n.length;e++){const o=n[e];"number"==typeof o?o<=0?(a=0-o,Sr(a),r+=9+n[++e],i=r):r+=o:(null!==o&&(fr(r,i),o(2,t[i])),i++)}}}finally{Sr(-1)}}(e,t);const s=e.components;null!==s&&function(e,t){for(let n=0;n<t.length;n++)ma(e,t[n])}(t,s);const l=e.viewQuery;if(null!==l&&wa(2,l,r),!a)if(o){const n=e.viewCheckHooks;null!==n&&Ir(t,n)}else{const n=e.viewHooks;null!==n&&Ar(t,n,2),Or(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),a||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,Jn(t[3],-1))}finally{kr()}}function Gi(e,t,n,r){const i=t[10],a=!sr(),o=Yn(t);try{a&&!o&&i.begin&&i.begin(),o&&Vi(e,t,r),qi(e,t,n,r)}finally{a&&!o&&i.end&&i.end()}}function Yi(e,t,n,r,i){const a=Er();try{Sr(-1),2&r&&t.length>Sn&&ji(e,t,0,sr()),n(r,i)}finally{Sr(a)}}function Xi(e,t,n){er()&&(function(e,t,n,r){const i=n.directiveStart,a=n.directiveEnd;e.firstCreatePass||Kr(n,t),gi(r,t);const o=n.initialInputs;for(let s=i;s<a;s++){const r=e.data[s],a=Mn(r);a&&da(t,n,r);const l=ai(t,e,s,n);gi(l,t),null!==o&&ha(0,s-i,l,r,0,o),a&&(qn(n.index,t)[8]=l)}}(e,t,n,Hn(n,t)),128==(128&n.flags)&&function(e,t,n){const r=n.directiveStart,i=n.directiveEnd,a=e.expandoInstructions,o=e.firstCreatePass,s=n.index-Sn,l=Qn.lFrame.currentDirectiveIndex;try{Sr(s);for(let n=r;n<i;n++){const r=e.data[n],i=t[n];pr(n),null!==r.hostBindings||0!==r.hostVars||null!==r.hostAttrs?aa(r,i):o&&a.push(null)}}finally{Sr(-1),pr(l)}}(e,t,n))}function Ki(e,t,n=Hn){const r=t.localNames;if(null!==r){let i=t.index+1;for(let a=0;a<r.length;a+=2){const o=r[a+1],s=-1===o?n(t,e):e[o];e[i++]=s}}}function Zi(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Ji(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function Ji(e,t,n,r,i,a,o,s,l,u){const c=Sn+r,d=c+i,h=function(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:Ii);return n}(c,d),f="function"==typeof u?u():u;return h[1]={type:e,blueprint:h,template:n,queries:null,viewQuery:s,declTNode:t,data:h.slice().fill(null,c),bindingStartIndex:c,expandoStartIndex:d,expandoInstructions:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof a?a():a,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:f,incompleteFirstPass:!1}}function Qi(e,t,n,r){const i=ka(t);i.push(n),e.firstCreatePass&&function(e){return e.cleanup||(e.cleanup=[])}(e).push(r,i.length-1)}function ea(e,t,n){for(let r in e)if(e.hasOwnProperty(r)){const i=e[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(t,i):n[r]=[t,i]}return n}function ta(e,t,n,r,i,a,o,s){const l=Hn(t,n);let u,c=t.inputs;var d;!s&&null!=c&&(u=c[r])?(Sa(e,n,u,r,i),On(t)&&function(e,t){const n=qn(t,e);16&n[2]||(n[2]|=64)}(n,t.index)):2===t.type&&(r="class"===(d=r)?"className":"for"===d?"htmlFor":"formaction"===d?"formAction":"innerHtml"===d?"innerHTML":"readonly"===d?"readOnly":"tabindex"===d?"tabIndex":d,i=null!=o?o(i,t.tagName||"",r):i,Bn(a)?a.setProperty(l,r,i):Pr(r)||(l.setProperty?l.setProperty(r,i):l[r]=i))}function na(e,t,n,r){let i=!1;if(er()){const a=function(e,t,n){const r=e.directiveRegistry;let i=null;if(r)for(let a=0;a<r.length;a++){const o=r[a];Si(n,o.selectors,!1)&&(i||(i=[]),ei(Kr(n,t),e,o.type),Mn(o)?(sa(e,n),i.unshift(o)):i.push(o))}return i}(e,t,n),o=null===r?null:{"":-1};if(null!==a){let r=0;i=!0,ua(n,e.data.length,a.length);for(let e=0;e<a.length;e++){const t=a[e];t.providersResolver&&t.providersResolver(t)}oa(e,n,a.length);let s=!1,l=!1;for(let i=0;i<a.length;i++){const u=a[i];n.mergedAttrs=Lr(n.mergedAttrs,u.hostAttrs),ca(e,t,u),la(e.data.length-1,u,o),null!==u.contentQueries&&(n.flags|=8),null===u.hostBindings&&null===u.hostAttrs&&0===u.hostVars||(n.flags|=128);const c=u.type.prototype;!s&&(c.ngOnChanges||c.ngOnInit||c.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index-Sn),s=!0),l||!c.ngOnChanges&&!c.ngDoCheck||((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index-Sn),l=!0),ra(e,u),r+=u.hostVars}!function(e,t){const n=t.directiveEnd,r=e.data,i=t.attrs,a=[];let o=null,s=null;for(let l=t.directiveStart;l<n;l++){const e=r[l],n=e.inputs,u=null===i||xi(t)?null:fa(n,i);a.push(u),o=ea(n,l,o),s=ea(e.outputs,l,s)}null!==o&&(o.hasOwnProperty("class")&&(t.flags|=16),o.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=a,t.inputs=o,t.outputs=s}(e,n),ia(e,t,r)}o&&function(e,t,n){if(t){const r=e.localNames=[];for(let e=0;e<t.length;e+=2){const i=n[t[e+1]];if(null==i)throw new Error(`Export of name '${t[e+1]}' not found!`);r.push(t[e],i)}}}(n,r,o)}return n.mergedAttrs=Lr(n.mergedAttrs,n.attrs),i}function ra(e,t){const n=e.expandoInstructions;n.push(t.hostBindings),0!==t.hostVars&&n.push(t.hostVars)}function ia(e,t,n){for(let r=0;r<n;r++)t.push(Ii),e.blueprint.push(Ii),e.data.push(null)}function aa(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function oa(e,t,n){const r=Sn-t.index,i=e.data.length-(1048575&t.providerIndexes);(e.expandoInstructions||(e.expandoInstructions=[])).push(r,i,n)}function sa(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function la(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;Mn(t)&&(n[""]=e)}}function ua(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function ca(e,t,n){e.data.push(n);const r=n.factory||(n.factory=kn(n.type)),i=new jr(r,Mn(n),null);e.blueprint.push(i),t.push(i)}function da(e,t,n){const r=Hn(t,e),i=Zi(n),a=e[10],o=va(e,Hi(e,i,null,n.onPush?64:16,r,t,a,a.createRenderer(r,n),null,null));e[t.index]=o}function ha(e,t,n,r,i,a){const o=a[t];if(null!==o){const e=r.setInput;for(let t=0;t<o.length;){const i=o[t++],a=o[t++],s=o[t++];null!==e?r.setInput(n,s,i,a):n[a]=s}}}function fa(e,t){let n=null,r=0;for(;r<t.length;){const i=t[r];if(0!==i)if(5!==i){if("number"==typeof i)break;e.hasOwnProperty(i)&&(null===n&&(n=[]),n.push(i,e[i],t[r+1])),r+=2}else r+=2;else r+=4}return n}function pa(e,t,n,r){return new Array(e,!0,!1,t,null,0,r,n,null,null)}function ma(e,t){const n=qn(t,e);if(Xn(n)){const e=n[1];80&n[2]?qi(e,n,e.template,n[8]):n[5]>0&&function e(t){for(let r=Oi(t);null!==r;r=Di(r))for(let t=Tn;t<r.length;t++){const n=r[t];if(1024&n[2]){const e=n[1];qi(e,n,e.template,n[8])}else n[5]>0&&e(n)}const n=t[1].components;if(null!==n)for(let r=0;r<n.length;r++){const i=qn(n[r],t);Xn(i)&&i[5]>0&&e(i)}}(n)}}function ga(e,t){const n=qn(t,e),r=n[1];!function(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])}(r,n),Vi(r,n,n[8])}function va(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function ya(e){for(;e;){e[2]|=64;const t=Ai(e);if(Nn(e)&&!t)return e;e=t}return null}function ba(e,t,n){const r=t[10];r.begin&&r.begin();try{qi(e,t,e.template,n)}catch(i){throw Ea(t,i),i}finally{r.end&&r.end()}}function xa(e){!function(e){for(let t=0;t<e.components.length;t++){const n=e.components[t],r=Gn(n),i=r[1];Gi(i,r,i.template,n)}}(e[8])}function wa(e,t,n){gr(0),t(e,n)}const _a=(()=>Promise.resolve(null))();function ka(e){return e[7]||(e[7]=[])}function Ea(e,t){const n=e[9],r=n?n.get(hi,null):null;r&&r.handleError(t)}function Sa(e,t,n,r,i){for(let a=0;a<n.length;){const o=n[a++],s=n[a++],l=t[o],u=e.data[o];null!==u.setInput?u.setInput(l,i,r,s):l[s]=i}}function Ta(e,t,n){const r=Un(t,e),i=e[11];Bn(i)?i.setValue(r,n):r.textContent=n}function Ca(e,t,n,r,i){if(null!=r){let a,o=!1;In(r)?a=r:Cn(r)&&(o=!0,r=r[0]);const s=zn(r);0===e&&null!==n?null==i?Na(t,n,s):Ma(t,n,s,i||null):1===e&&null!==n?Ma(t,n,s,i||null):2===e?function(e,t,n){const r=Fa(e,t);r&&function(e,t,n,r){Bn(e)?e.removeChild(t,n,r):t.removeChild(n)}(e,r,t,n)}(t,s,o):3===e&&t.destroyNode(s),null!=a&&function(e,t,n,r,i){const a=n[7];a!==zn(n)&&Ca(t,e,r,a,i);for(let o=Tn;o<n.length;o++){const i=n[o];La(i[1],i,e,t,r,a)}}(t,e,a,n,i)}}function Ia(e,t){const n=e[9],r=n.indexOf(t),i=t[3];1024&t[2]&&(t[2]&=-1025,Jn(i,-1)),n.splice(r,1)}function Aa(e,t){if(e.length<=Tn)return;const n=Tn+t,r=e[n];if(r){const a=r[17];null!==a&&a!==e&&Ia(a,r),t>0&&(e[n-1][4]=r[4]);const o=an(e,Tn+t);La(r[1],i=r,i[11],2,null,null),i[0]=null,i[6]=null;const s=o[19];null!==s&&s.detachView(o[1]),r[3]=null,r[4]=null,r[2]&=-129}var i;return r}function Oa(e,t){if(!(256&t[2])){const n=t[11];Bn(n)&&n.destroyNode&&La(e,t,n,3,null,null),function(e){let t=e[13];if(!t)return Da(e[1],e);for(;t;){let n=null;if(Cn(t))n=t[13];else{const e=t[10];e&&(n=e)}if(!n){for(;t&&!t[4]&&t!==e;)Cn(t)&&Da(t[1],t),t=t[3];null===t&&(t=e),Cn(t)&&Da(t[1],t),n=t&&t[4]}t=n}}(t)}}function Da(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const e=t[n[r]];if(!(e instanceof jr)){const t=n[r+1];if(Array.isArray(t))for(let n=0;n<t.length;n+=2)t[n+1].call(e[t[n]]);else t.call(e)}}}(e,t),function(e,t){const n=e.cleanup;if(null!==n){const e=t[7];for(let r=0;r<n.length-1;r+=2)if("string"==typeof n[r]){const i=n[r+1],a="function"==typeof i?i(t):zn(t[i]),o=e[n[r+2]],s=n[r+3];"boolean"==typeof s?a.removeEventListener(n[r],o,s):s>=0?e[s]():e[-s].unsubscribe(),r+=2}else n[r].call(e[n[r+1]]);t[7]=null}}(e,t),1===t[1].type&&Bn(t[11])&&t[11].destroy();const n=t[17];if(null!==n&&In(t[3])){n!==t[3]&&Ia(n,t);const r=t[19];null!==r&&r.detachView(e)}}}function Ma(e,t,n,r){Bn(e)?e.insertBefore(t,n,r):t.insertBefore(n,r,!0)}function Na(e,t,n){Bn(e)?e.appendChild(t,n):t.appendChild(n)}function ja(e,t,n,r){null!==r?Ma(e,t,n,r):Na(e,t,n)}function Fa(e,t){return Bn(e)?e.parentNode(t):t.parentNode}function Ra(e,t,n,r){const i=function(e,t,n){let r=t.parent;for(;null!=r&&(3===r.type||4===r.type);)r=(t=r).parent;if(null===r)return n[0];if(t&&4===t.type&&4&t.flags)return Hn(t,n).parentNode;if(2&r.flags){const t=e.data,n=t[t[r.index].directiveStart].encapsulation;if(n!==cn.ShadowDom&&n!==cn.Native)return null}return Hn(r,n)}(e,r,t);if(null!=i){const e=t[11],a=function(e,t){return 3===e.type||4===e.type?Hn(e,t):null}(r.parent||t[6],t);if(Array.isArray(n))for(let t=0;t<n.length;t++)ja(e,i,n[t],a);else ja(e,i,n,a)}}function Pa(e,t,n,r,i,a,o){for(;null!=n;){const s=r[n.index],l=n.type;o&&0===t&&(s&&gi(zn(s),r),n.flags|=4),64!=(64&n.flags)&&(3===l||4===l?(Pa(e,t,n.child,r,i,a,!1),Ca(t,e,i,s,a)):1===l?Ba(e,t,r,n,i,a):Ca(t,e,i,s,a)),n=o?n.projectionNext:n.next}}function La(e,t,n,r,i,a){Pa(n,r,e.firstChild,t,i,a,!1)}function Ba(e,t,n,r,i,a){const o=n[16],s=o[6].projection[r.projection];if(Array.isArray(s))for(let l=0;l<s.length;l++)Ca(t,e,i,s[l],a);else Pa(e,t,s,o[3],i,a,!0)}function $a(e,t,n){Bn(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function za(e,t,n){Bn(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}class Ua{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._viewContainerRef=null}get rootNodes(){const e=this._lView,t=e[1];return function e(t,n,r,i,a=!1){for(;null!==r;){const o=n[r.index];if(null!==o&&i.push(zn(o)),In(o))for(let t=Tn;t<o.length;t++){const n=o[t],r=n[1].firstChild;null!==r&&e(n[1],n,r,i)}const s=r.type;if(3===s||4===s)e(t,n,r.child,i);else if(1===s){const t=n[16],a=t[6].projection[r.projection];if(Array.isArray(a))i.push(...a);else{const n=Ai(t);e(n[1],n,a,i,!0)}}r=a?r.projectionNext:r.next}return i}(t,e,t.firstChild,[])}get context(){return this._lView[8]}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._viewContainerRef){const e=this._viewContainerRef.indexOf(this);e>-1&&this._viewContainerRef.detach(e),this._viewContainerRef=null}Oa(this._lView[1],this._lView)}onDestroy(e){Qi(this._lView[1],this._lView,null,e)}markForCheck(){ya(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){ba(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(e,t,n){lr(!0);try{ba(e,t,n)}finally{lr(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(e){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=e}detachFromAppRef(){var e;this._appRef=null,La(this._lView[1],e=this._lView,e[11],2,null,null)}attachToAppRef(e){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}class Ha extends Ua{constructor(e){super(e),this._view=e}detectChanges(){xa(this._view)}checkNoChanges(){!function(e){lr(!0);try{xa(e)}finally{lr(!1)}}(this._view)}get context(){return null}}let Wa,Va,qa;function Ga(e,t,n){return Wa||(Wa=class extends e{}),new Wa(Hn(t,n))}function Ya(e,t,n,r){return Va||(Va=class extends e{constructor(e,t,n){super(),this._declarationView=e,this._declarationTContainer=t,this.elementRef=n}createEmbeddedView(e){const t=this._declarationTContainer.tViews,n=Hi(this._declarationView,t,e,16,null,t.declTNode,null,null,null,null);n[17]=this._declarationView[this._declarationTContainer.index];const r=this._declarationView[19];return null!==r&&(n[19]=r.createEmbeddedView(t)),Vi(t,n,e),new Ua(n)}}),0===n.type?new Va(r,n,Ga(t,n,r)):null}function Xa(e,t,n,r){let i;qa||(qa=class extends e{constructor(e,t,n){super(),this._lContainer=e,this._hostTNode=t,this._hostView=n}get element(){return Ga(t,this._hostTNode,this._hostView)}get injector(){return new li(this._hostTNode,this._hostView)}get parentInjector(){const e=Qr(this._hostTNode,this._hostView);if($r(e)){const t=Ur(e,this._hostView),n=zr(e);return new li(t[1].data[n+8],t)}return new li(null,this._hostView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){return null!==this._lContainer[8]&&this._lContainer[8][e]||null}get length(){return this._lContainer.length-Tn}createEmbeddedView(e,t,n){const r=e.createEmbeddedView(t||{});return this.insert(r,n),r}createComponent(e,t,n,r,i){const a=n||this.parentInjector;if(!i&&null==e.ngModule&&a){const e=a.get(en,null);e&&(i=e)}const o=e.create(a,r,void 0,i);return this.insert(o.hostView,t),o}insert(e,t){const n=e._lView,r=n[1];if(e.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");if(this.allocateContainerIfNeeded(),In(n[3])){const t=this.indexOf(e);if(-1!==t)this.detach(t);else{const t=n[3],r=new qa(t,t[6],t[3]);r.detach(r.indexOf(e))}}const i=this._adjustIndex(t),a=this._lContainer;!function(e,t,n,r){const i=Tn+r,a=n.length;r>0&&(n[i-1][4]=t),r<a-Tn?(t[4]=n[i],rn(n,Tn+r,t)):(n.push(t),t[4]=null),t[3]=n;const o=t[17];null!==o&&n!==o&&function(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(o,t);const s=t[19];null!==s&&s.insertView(e),t[2]|=128}(r,n,a,i);const o=function e(t,n){const r=Tn+t+1;if(r<n.length){const t=n[r],i=t[1].firstChild;if(null!==i)return function t(n,r){if(null!==r){const i=r.type;if(2===i)return Hn(r,n);if(0===i)return e(-1,n[r.index]);if(3===i||4===i){const i=r.child;if(null!==i)return t(n,i);{const t=n[r.index];return In(t)?e(-1,t):zn(t)}}{const e=n[16],i=e[6],a=Ai(e),o=i.projection[r.projection];return null!=o?t(a,o):t(n,r.next)}}return null}(t,i)}return n[7]}(i,a),s=n[11],l=Fa(s,a[7]);return null!==l&&function(e,t,n,r,i,a){r[0]=i,r[6]=t,La(e,r,n,1,i,a)}(r,a[6],s,n,l,o),e.attachToViewContainerRef(this),rn(a[8],i,e),e}move(e,t){if(e.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");return this.insert(e,t)}indexOf(e){const t=this._lContainer[8];return null!==t?t.indexOf(e):-1}remove(e){this.allocateContainerIfNeeded();const t=this._adjustIndex(e,-1),n=Aa(this._lContainer,t);n&&(an(this._lContainer[8],t),Oa(n[1],n))}detach(e){this.allocateContainerIfNeeded();const t=this._adjustIndex(e,-1),n=Aa(this._lContainer,t);return n&&null!=an(this._lContainer[8],t)?new Ua(n):null}_adjustIndex(e,t=0){return null==e?this.length+t:e}allocateContainerIfNeeded(){null===this._lContainer[8]&&(this._lContainer[8]=[])}});const a=r[n.index];if(In(a))i=a;else{let e;if(3===n.type)e=zn(a);else if(e=r[11].createComment(""),Nn(r)){const t=r[11],i=Hn(n,r);Ma(t,Fa(t,i),e,function(e,t){return Bn(e)?e.nextSibling(t):t.nextSibling}(t,i))}else Ra(r[1],r,e,n);r[n.index]=i=pa(a,r,e,n),va(r,i)}return new qa(i,n,r)}let Ka=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>Za(),e})();const Za=function(e=!1){return function(e,t,n){if(!n&&On(e)){const n=qn(e.index,t);return new Ua(n,n)}return 2===e.type||0===e.type||3===e.type||4===e.type?new Ua(t[16],t):null}(ir(),tr(),e)},Ja=Function,Qa=new Bt("Set Injector scope."),eo={},to={},no=[];let ro=void 0;function io(){return void 0===ro&&(ro=new Qt),ro}function ao(e,t=null,n=null,r){return new oo(e,n,t||io(),r)}class oo{constructor(e,t,n,r=null){this.parent=n,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const i=[];t&&nn(t,n=>this.processProvider(n,e,t)),nn([e],e=>this.processInjectorType(e,[],i)),this.records.set($t,lo(void 0,this));const a=this.records.get(Qa);this.scope=null!=a?a.value:null,this.source=r||("object"==typeof e?null:_t(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=zt,n=ct.Default){this.assertNotDestroyed();const r=Gt(this);try{if(!(n&ct.SkipSelf)){let t=this.records.get(e);if(void 0===t){const n=("function"==typeof(i=e)||"object"==typeof i&&i instanceof Bt)&&pt(e);t=n&&this.injectableDefInScope(n)?lo(so(e),eo):null,this.records.set(e,t)}if(null!=t)return this.hydrate(e,t)}return(n&ct.Self?io():this.parent).get(e,t=n&ct.Optional&&t===zt?null:t)}catch(a){if("NullInjectorError"===a.name){if((a.ngTempTokenPath=a.ngTempTokenPath||[]).unshift(_t(e)),r)throw a;return function(e,t,n,r){const i=e.ngTempTokenPath;throw t[Ht]&&i.unshift(t[Ht]),e.message=function(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let i=_t(t);if(Array.isArray(t))i=t.map(_t).join(" -> ");else if("object"==typeof t){let e=[];for(let n in t)if(t.hasOwnProperty(n)){let r=t[n];e.push(n+":"+("string"==typeof r?JSON.stringify(r):_t(r)))}i=`{${e.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${e.replace(Ut,"\n  ")}`}("\n"+e.message,i,n,r),e.ngTokenPath=i,e.ngTempTokenPath=null,e}(a,e,"R3InjectorError",this.source)}throw a}finally{Gt(r)}var i}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((t,n)=>e.push(_t(n))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(e,t,n){if(!(e=Tt(e)))return!1;let r=gt(e);const i=null==r&&e.ngModule||void 0,a=void 0===i?e:i,o=-1!==n.indexOf(a);if(void 0!==i&&(r=gt(i)),null==r)return!1;if(null!=r.imports&&!o){let e;n.push(a);try{nn(r.imports,r=>{this.processInjectorType(r,t,n)&&(void 0===e&&(e=[]),e.push(r))})}finally{}if(void 0!==e)for(let t=0;t<e.length;t++){const{ngModule:n,providers:r}=e[t];nn(r,e=>this.processProvider(e,n,r||no))}}this.injectorDefTypes.add(a),this.records.set(a,lo(r.factory,eo));const s=r.providers;if(null!=s&&!o){const t=e;nn(s,e=>this.processProvider(e,t,s))}return void 0!==i&&void 0!==e.providers}processProvider(e,t,n){let r=co(e=Tt(e))?e:Tt(e&&e.provide);const i=function(e,t,n){return uo(e)?lo(void 0,e.useValue):lo(function(e,t,n){let r=void 0;if(co(e)){const t=Tt(e);return kn(t)||so(t)}if(uo(e))r=()=>Tt(e.useValue);else if((i=e)&&i.useFactory)r=()=>e.useFactory(...Jt(e.deps||[]));else if(function(e){return!(!e||!e.useExisting)}(e))r=()=>Kt(Tt(e.useExisting));else{const t=Tt(e&&(e.useClass||e.provide));if(!function(e){return!!e.deps}(e))return kn(t)||so(t);r=()=>new t(...Jt(e.deps))}var i;return r}(e),eo)}(e);if(co(e)||!0!==e.multi)this.records.get(r);else{let t=this.records.get(r);t||(t=lo(void 0,eo,!0),t.factory=()=>Jt(t.multi),this.records.set(r,t)),r=e,t.multi.push(e)}this.records.set(r,i)}hydrate(e,t){var n;return t.value===eo&&(t.value=to,t.value=t.factory()),"object"==typeof t.value&&t.value&&null!==(n=t.value)&&"object"==typeof n&&"function"==typeof n.ngOnDestroy&&this.onDestroy.add(t.value),t.value}injectableDefInScope(e){return!!e.providedIn&&("string"==typeof e.providedIn?"any"===e.providedIn||e.providedIn===this.scope:this.injectorDefTypes.has(e.providedIn))}}function so(e){const t=pt(e),n=null!==t?t.factory:kn(e);if(null!==n)return n;const r=gt(e);if(null!==r)return r.factory;if(e instanceof Bt)throw new Error(`Token ${_t(e)} is missing a \u0275prov definition.`);if(e instanceof Function)return function(e){const t=e.length;if(t>0){const n=function(e,t){const n=[];for(let r=0;r<e;r++)n.push("?");return n}(t);throw new Error(`Can't resolve all parameters for ${_t(e)}: (${n.join(", ")}).`)}const n=function(e){const t=e&&(e[vt]||e[xt]||e[bt]&&e[bt]());if(t){const n=function(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Error("unreachable")}function lo(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function uo(e){return null!==e&&"object"==typeof e&&Wt in e}function co(e){return"function"==typeof e}const ho=function(e,t,n){return function(e,t=null,n=null,r){const i=ao(e,t,n,r);return i._resolveInjectorDefTypes(),i}({name:n},t,e,n)};let fo=(()=>{class e{static create(e,t){return Array.isArray(e)?ho(e,t,""):ho(e.providers,e.parent,e.name||"")}}return e.THROW_IF_NOT_FOUND=zt,e.NULL=new Qt,e.\u0275prov=ht({token:e,providedIn:"any",factory:()=>Kt($t)}),e.__NG_ELEMENT_ID__=-1,e})();const po=new Bt("AnalyzeForEntryComponents");function mo(e,t,n){let r=n?e.styles:null,i=n?e.classes:null,a=0;if(null!==t)for(let o=0;o<t.length;o++){const e=t[o];"number"==typeof e?a=e:1==a?i=kt(i,e):2==a&&(r=kt(r,e+": "+t[++o]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=i:e.classesWithoutHost=i}function go(e,t){const n=Gn(e)[1],r=n.data.length-1;Cr(n,{directiveStart:r,directiveEnd:r+1})}let vo=null;function yo(){if(!vo){const e=Dt.Symbol;if(e&&e.iterator)vo=e.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const n=e[t];"entries"!==n&&"size"!==n&&Map.prototype[n]===Map.prototype.entries&&(vo=n)}}}return vo}class bo{constructor(e){this.wrapped=e}static wrap(e){return new bo(e)}static unwrap(e){return bo.isWrapped(e)?e.wrapped:e}static isWrapped(e){return e instanceof bo}}function xo(e){return!!wo(e)&&(Array.isArray(e)||!(e instanceof Map)&&yo()in e)}function wo(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function _o(e,t,n){return e[t]=n}function ko(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function Eo(e,t,n,r){return ko(e,dr(),n)?t+Hr(n)+r:Ii}function So(e,t,n,r,i,a,o,s){const l=tr(),u=nr(),c=e+Sn,d=u.firstCreatePass?function(e,t,n,r,i,a,o,s,l){const u=t.consts,c=Wi(t,e,0,o||null,Kn(u,s));na(t,n,c,Kn(u,l)),Cr(t,c);const d=c.tViews=Ji(2,c,r,i,a,t.directiveRegistry,t.pipeRegistry,null,t.schemas,u);return null!==t.queries&&(t.queries.template(t,c),d.queries=t.queries.embeddedTView(c)),c}(e,u,l,t,n,r,i,a,o):u.data[c];ar(d,!1);const h=l[11].createComment("");Ra(u,l,h,d),gi(h,l),va(l,l[c]=pa(h,l,h,d)),Dn(d)&&Xi(u,l,d),null!=o&&Ki(l,d,s)}function To(e){return Vn(Qn.lFrame.contextLView,e)}function Co(e,t=ct.Default){const n=tr();return null===n?Kt(e,t):ti(ir(),n,Tt(e),t)}function Io(e,t,n){const r=tr();return ko(r,dr(),t)&&ta(nr(),Tr(),r,e,t,r[11],n,!1),Io}function Ao(e,t,n,r,i){const a=i?"class":"style";Sa(e,n,t.inputs[a],a,r)}function Oo(e,t,n,r){const i=tr(),a=nr(),o=Sn+e,s=i[11],l=i[o]=Ui(t,s,Qn.lFrame.currentNamespace),u=a.firstCreatePass?function(e,t,n,r,i,a,o){const s=t.consts,l=Wi(t,e,2,i,Kn(s,a));return na(t,n,l,Kn(s,o)),null!==l.attrs&&mo(l,l.attrs,!1),null!==l.mergedAttrs&&mo(l,l.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,l),l}(e,a,i,0,t,n,r):a.data[o];ar(u,!0);const c=u.mergedAttrs;null!==c&&Fr(s,l,c);const d=u.classes;null!==d&&za(s,l,d);const h=u.styles;null!==h&&$a(s,l,h),Ra(a,i,l,u),0===Qn.lFrame.elementDepthCount&&gi(l,i),Qn.lFrame.elementDepthCount++,Dn(u)&&(Xi(a,i,u),function(e,t,n){if(An(t)){const r=t.directiveEnd;for(let i=t.directiveStart;i<r;i++){const t=e.data[i];t.contentQueries&&t.contentQueries(1,n[i],i)}}}(a,u,i)),null!==r&&Ki(i,u)}function Do(){let e=ir();or()?Qn.lFrame.isParent=!1:(e=e.parent,ar(e,!1));const t=e;Qn.lFrame.elementDepthCount--;const n=nr();n.firstCreatePass&&(Cr(n,e),An(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function(e){return 0!=(16&e.flags)}(t)&&Ao(n,t,tr(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function(e){return 0!=(32&e.flags)}(t)&&Ao(n,t,tr(),t.stylesWithoutHost,!1)}function Mo(e,t,n,r){Oo(e,t,n,r),Do()}function No(){return tr()}function jo(e){return!!e&&"function"==typeof e.then}function Fo(e,t,n=!1,r){const i=tr(),a=nr(),o=ir();return function(e,t,n,r,i,a,o=!1,s){const l=Dn(r),u=e.firstCreatePass&&(e.cleanup||(e.cleanup=[])),c=ka(t);let d=!0;if(2===r.type){const h=Hn(r,t),f=s?s(h):dn,p=f.target||h,m=c.length,g=s?e=>s(zn(e[r.index])).target:r.index;if(Bn(n)){let o=null;if(!s&&l&&(o=function(e,t,n,r){const i=e.cleanup;if(null!=i)for(let a=0;a<i.length-1;a+=2){const e=i[a];if(e===n&&i[a+1]===r){const e=t[7],n=i[a+2];return e.length>n?e[n]:null}"string"==typeof e&&(a+=2)}return null}(e,t,i,r.index)),null!==o)(o.__ngLastListenerFn__||o).__ngNextListenerFn__=a,o.__ngLastListenerFn__=a,d=!1;else{a=Po(r,t,a,!1);const e=n.listen(f.name||p,i,a);c.push(a,e),u&&u.push(i,g,m,m+1)}}else a=Po(r,t,a,!0),p.addEventListener(i,a,o),c.push(a),u&&u.push(i,g,m,o)}const h=r.outputs;let f;if(d&&null!==h&&(f=h[i])){const e=f.length;if(e)for(let n=0;n<e;n+=2){const e=t[f[n]][f[n+1]].subscribe(a),o=c.length;c.push(a,e),u&&u.push(i,r.index,o,-(o+1))}}}(a,i,i[11],o,e,t,n,r),Fo}function Ro(e,t,n){try{return!1!==t(n)}catch(r){return Ea(e,r),!1}}function Po(e,t,n,r){return function i(a){if(a===Function)return n;const o=2&e.flags?qn(e.index,t):t;0==(32&t[2])&&ya(o);let s=Ro(t,n,a),l=i.__ngNextListenerFn__;for(;l;)s=Ro(t,l,a)&&s,l=l.__ngNextListenerFn__;return r&&!1===s&&(a.preventDefault(),a.returnValue=!1),s}}function Lo(e=1){return function(e){return(Qn.lFrame.contextLView=function(e,t){for(;e>0;)t=t[15],e--;return t}(e,Qn.lFrame.contextLView))[8]}(e)}function Bo(e,t,n){return $o(e,"",t,"",n),Bo}function $o(e,t,n,r,i){const a=tr(),o=Eo(a,t,n,r);return o!==Ii&&ta(nr(),Tr(),a,e,o,a[11],i,!1),$o}const zo=[];function Uo(e,t,n,r,i){const a=e[n+1],o=null===t;let s=r?Ri(a):Li(a),l=!1;for(;0!==s&&(!1===l||o);){const n=e[s+1];Ho(e[s],t)&&(l=!0,e[s+1]=r?$i(n):Pi(n)),s=r?Ri(n):Li(n)}l&&(e[n+1]=r?Pi(a):$i(a))}function Ho(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&ln(e,t)>=0}function Wo(e,t,n){return function(e,t,n,r){const i=tr(),a=nr(),o=hr(2);a.firstUpdatePass&&function(e,t,n,r){const i=e.data;if(null===i[n+1]){const a=i[Er()+Sn],o=function(e,t){return t>=e.expandoStartIndex}(e,n);(function(e,t){return 0!=(32&e.flags)})(a)&&null===t&&!o&&(t=!1),t=function(e,t,n,r){const i=function(e){const t=Qn.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let a=t.residualStyles;if(null===i)0===t.styleBindings&&(n=qo(n=Vo(null,e,t,n,r),t.attrs,r),a=null);else{const o=t.directiveStylingLast;if(-1===o||e[o]!==i)if(n=Vo(i,e,t,n,r),null===a){let n=function(e,t,n){const r=t.styleBindings;if(0!==Li(r))return e[Ri(r)]}(e,t);void 0!==n&&Array.isArray(n)&&(n=Vo(null,e,t,n[1],r),n=qo(n,t.attrs,r),function(e,t,n,r){e[Ri(t.styleBindings)]=r}(e,t,0,n))}else a=function(e,t,n){let r=void 0;const i=t.directiveEnd;for(let a=1+t.directiveStylingLast;a<i;a++)r=qo(r,e[a].hostAttrs,false);return qo(r,t.attrs,false)}(e,t)}return void 0!==a&&(t.residualStyles=a),n}(i,a,t,r),function(e,t,n,r,i,a){let o=t.styleBindings,s=Ri(o),l=Li(o);e[r]=n;let u,c=!1;if(Array.isArray(n)){const e=n;u=e[1],(null===u||ln(e,u)>0)&&(c=!0)}else u=n;if(i)if(0!==l){const t=Ri(e[s+1]);e[r+1]=Fi(t,s),0!==t&&(e[t+1]=Bi(e[t+1],r)),e[s+1]=131071&e[s+1]|r<<17}else e[r+1]=Fi(s,0),0!==s&&(e[s+1]=Bi(e[s+1],r)),s=r;else e[r+1]=Fi(l,0),0===s?s=r:e[l+1]=Bi(e[l+1],r),l=r;c&&(e[r+1]=Pi(e[r+1])),Uo(e,u,r,!0),Uo(e,u,r,!1),function(e,t,n,r,i){const a=e.residualStyles;null!=a&&"string"==typeof t&&ln(a,t)>=0&&(n[r+1]=$i(n[r+1]))}(t,u,e,r),o=Fi(s,l),t.styleBindings=o}(i,a,t,n,o)}}(a,e,o,false),t!==Ii&&ko(i,o,t)&&function(e,t,n,r,i,a,o,s){if(2!==t.type)return;const l=e.data,u=l[s+1];Yo(1==(1&u)?Go(l,t,n,i,Li(u),o):void 0)||(Yo(a)||function(e){return 2==(2&e)}(u)&&(a=Go(l,null,n,i,s,o)),function(e,t,n,r,i){const a=Bn(e);{const t=-1==r.indexOf("-")?void 0:2;null==i?a?e.removeStyle(n,r,t):n.style.removeProperty(r):a?e.setStyle(n,r,i,t):n.style.setProperty(r,i)}}(r,0,Un(Er(),n),i,a))}(a,a.data[Er()+Sn],i,i[11],e,i[o+1]=function(e,t){return null==e||("string"==typeof t?e+=t:"object"==typeof e&&(e=_t(function(e){return e instanceof class{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return"SafeValue must use [property]=binding: "+this.changingThisBreaksApplicationSecurity+" (see http://g.co/ng/security#xss)"}}?e.changingThisBreaksApplicationSecurity:e}(e)))),e}(t,n),false,o)}(e,t,n),Wo}function Vo(e,t,n,r,i){let a=null;const o=n.directiveEnd;let s=n.directiveStylingLast;for(-1===s?s=n.directiveStart:s++;s<o&&(a=t[s],r=qo(r,a.hostAttrs,i),a!==e);)s++;return null!==e&&(n.directiveStylingLast=s),r}function qo(e,t,n){const r=n?1:2;let i=-1;if(null!==t)for(let a=0;a<t.length;a++){const o=t[a];"number"==typeof o?i=o:i===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),on(e,o,!!n||t[++a]))}return void 0===e?null:e}function Go(e,t,n,r,i,a){const o=null===t;let s=void 0;for(;i>0;){const t=e[i],a=Array.isArray(t),l=a?t[1]:t,u=null===l;let c=n[i+1];c===Ii&&(c=u?zo:void 0);let d=u?sn(c,r):l===r?c:void 0;if(a&&!Yo(d)&&(d=sn(t,r)),Yo(d)&&(s=d,o))return s;const h=e[i+1];i=o?Ri(h):Li(h)}if(null!==t){let e=a?t.residualClasses:t.residualStyles;null!=e&&(s=sn(e,r))}return s}function Yo(e){return void 0!==e}function Xo(e,t=""){const n=tr(),r=nr(),i=e+Sn,a=r.firstCreatePass?Wi(r,e,2,null,null):r.data[i],o=n[i]=function(e,t){return Bn(t)?t.createText(e):t.createTextNode(e)}(t,n[11]);Ra(r,n,o,a),ar(a,!1)}function Ko(e){return Zo("",e,""),Ko}function Zo(e,t,n){const r=tr(),i=Eo(r,e,t,n);return i!==Ii&&Ta(r,Er(),i),Zo}function Jo(e,t,n,r,i){const a=tr(),o=function(e,t,n,r,i,a){const o=function(e,t,n,r){const i=ko(e,t,n);return ko(e,t+1,r)||i}(e,cr(),n,i);return hr(2),o?t+Hr(n)+r+Hr(i)+a:Ii}(a,e,t,n,r,i);return o!==Ii&&Ta(a,Er(),o),Jo}class Qo{}class es{resolveComponentFactory(e){throw function(e){const t=Error(`No component factory found for ${_t(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(e)}}let ts=(()=>{class e{}return e.NULL=new es,e})(),ns=(()=>{class e{constructor(e){this.nativeElement=e}}return e.__NG_ELEMENT_ID__=()=>rs(e),e})();const rs=function(e){return Ga(e,ir(),tr())};class is{}var as=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}({});let os=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>ss(),e})();const ss=function(){const e=tr(),t=qn(ir().index,e);return function(e){const t=e[11];if(Bn(t))return t;throw new Error("Cannot inject Renderer2 when the application uses Renderer3!")}(Cn(t)?t:e)};let ls=(()=>{class e{}return e.\u0275prov=ht({token:e,providedIn:"root",factory:()=>null}),e})();class us{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const cs=new us("10.1.6");class ds{constructor(){}supports(e){return xo(e)}create(e){return new fs(e)}}const hs=(e,t)=>t;class fs{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||hs}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,n=this._removalsHead,r=0,i=null;for(;t||n;){const a=!n||t&&t.currentIndex<vs(n,r,i)?t:n,o=vs(a,r,i),s=a.currentIndex;if(a===n)r--,n=n._nextRemoved;else if(t=t._next,null==a.previousIndex)r++;else{i||(i=[]);const e=o-r,t=s-r;if(e!=t){for(let n=0;n<e;n++){const r=n<i.length?i[n]:i[n]=0,a=r+n;t<=a&&a<e&&(i[n]=r+1)}i[a.previousIndex]=t-e}}o!==s&&e(a,o,s)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!xo(e))throw new Error(`Error trying to diff '${_t(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t,n,r,i=this._itHead,a=!1;if(Array.isArray(e)){this.length=e.length;for(let t=0;t<this.length;t++)n=e[t],r=this._trackByFn(t,n),null!==i&&Object.is(i.trackById,r)?(a&&(i=this._verifyReinsertion(i,n,r,t)),Object.is(i.item,n)||this._addIdentityChange(i,n)):(i=this._mismatch(i,n,r,t),a=!0),i=i._next}else t=0,function(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[yo()]();let r;for(;!(r=n.next()).done;)t(r.value)}}(e,e=>{r=this._trackByFn(t,e),null!==i&&Object.is(i.trackById,r)?(a&&(i=this._verifyReinsertion(i,e,r,t)),Object.is(i.item,e)||this._addIdentityChange(i,e)):(i=this._mismatch(i,e,r,t),a=!0),i=i._next,t++}),this.length=t;return this._truncate(i),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,n,r){let i;return null===e?i=this._itTail:(i=e._prev,this._remove(e)),null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,i,r)):null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,i,r)):e=this._addAfter(new ps(t,n),i,r),e}_verifyReinsertion(e,t,n,r){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==i?e=this._reinsertAfter(i,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const r=e._prevRemoved,i=e._nextRemoved;return null===r?this._removalsHead=i:r._nextRemoved=i,null===i?this._removalsTail=r:i._prevRemoved=r,this._insertAfter(e,t,n),this._addToMoves(e,n),e}_moveAfter(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}_addAfter(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,n){const r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new gs),this._linkedRecords.put(e),e.currentIndex=n,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new gs),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class ps{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class ms{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}remove(e){const t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}class gs{constructor(){this.map=new Map}put(e){const t=e.trackById;let n=this.map.get(t);n||(n=new ms,this.map.set(t,n)),n.add(e)}get(e,t){const n=this.map.get(e);return n?n.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function vs(e,t,n){const r=e.previousIndex;if(null===r)return r;let i=0;return n&&r<n.length&&(i=n[r]),r+t+i}class ys{constructor(){}supports(e){return e instanceof Map||wo(e)}create(){return new bs}}class bs{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||wo(e)))throw new Error(`Error trying to diff '${_t(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(e,n)=>{if(t&&t.key===n)this._maybeAddToChanges(t,e),this._appendAfter=t,t=t._next;else{const r=this._getOrCreateRecordForKey(n,e);t=this._insertBeforeOrAppend(t,r)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let e=t;null!==e;e=e._nextRemoved)e===this._mapHead&&(this._mapHead=null),this._records.delete(e.key),e._nextRemoved=e._next,e.previousValue=e.currentValue,e.currentValue=null,e._prev=null,e._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const n=this._records.get(e);this._maybeAddToChanges(n,t);const r=n._prev,i=n._next;return r&&(r._next=i),i&&(i._prev=r),n._next=null,n._prev=null,n}const n=new xs(e);return this._records.set(e,n),n.currentValue=t,this._addToAdditions(n),n}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(n=>t(e[n],n))}}class xs{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}let ws=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(null!=n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>{if(!n)throw new Error("Cannot extend IterableDiffers without a parent injector");return e.create(t,n)},deps:[[e,new ut,new st]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(null!=t)return t;throw new Error(`Cannot find a differ supporting object '${e}' of type '${n=e,n.name||typeof n}'`);var n}}return e.\u0275prov=ht({token:e,providedIn:"root",factory:()=>new e([new ds])}),e})(),_s=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>{if(!n)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return e.create(t,n)},deps:[[e,new ut,new st]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(t)return t;throw new Error(`Cannot find a differ supporting object '${e}'`)}}return e.\u0275prov=ht({token:e,providedIn:"root",factory:()=>new e([new ys])}),e})();const ks=[new ys],Es=new ws([new ds]),Ss=new _s(ks);let Ts=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>Cs(e,ns),e})();const Cs=function(e,t){return Ya(e,t,ir(),tr())};let Is=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>As(e,ns),e})();const As=function(e,t){return Xa(e,t,ir(),tr())},Os={};class Ds extends ts{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=_n(e);return new js(t,this.ngModule)}}function Ms(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}const Ns=new Bt("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>Vr});class js extends Qo{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=e.selectors.map(Ci).join(","),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return Ms(this.componentDef.inputs)}get outputs(){return Ms(this.componentDef.outputs)}create(e,t,n,r){const i=(r=r||this.ngModule)?function(e,t){return{get:(n,r,i)=>{const a=e.get(n,Os,i);return a!==Os||r===Os?a:t.get(n,r,i)}}}(e,r.injector):e,a=i.get(is,$n),o=i.get(ls,null),s=a.createRenderer(null,this.componentDef),l=this.componentDef.selectors[0][0]||"div",u=n?function(e,t,n){if(Bn(e))return e.selectRootElement(t,n===cn.ShadowDom);let r="string"==typeof t?e.querySelector(t):t;return r.textContent="",r}(s,n,this.componentDef.encapsulation):Ui(l,a.createRenderer(null,this.componentDef),function(e){const t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(l)),c=this.componentDef.onPush?576:528,d={components:[],scheduler:Vr,clean:_a,playerHandler:null,flags:0},h=Ji(0,null,null,1,0,null,null,null,null,null),f=Hi(null,h,d,c,null,null,a,s,o,i);let p,m;yr(f);try{const e=function(e,t,n,r,i,a){const o=n[1];n[20]=e;const s=Wi(o,0,2,null,null),l=s.mergedAttrs=t.hostAttrs;null!==l&&(mo(s,l,!0),null!==e&&(Fr(i,e,l),null!==s.classes&&za(i,e,s.classes),null!==s.styles&&$a(i,e,s.styles)));const u=r.createRenderer(e,t),c=Hi(n,Zi(t),null,t.onPush?64:16,n[20],s,r,u,null,null);return o.firstCreatePass&&(ei(Kr(s,n),o,t.type),sa(o,s),ua(s,n.length,1)),va(n,c),n[20]=c}(u,this.componentDef,f,a,s);if(u)if(n)Fr(s,u,["ng-version",cs.full]);else{const{attrs:e,classes:t}=function(e){const t=[],n=[];let r=1,i=2;for(;r<e.length;){let a=e[r];if("string"==typeof a)2===i?""!==a&&t.push(a,e[++r]):8===i&&n.push(a);else{if(!ki(i))break;i=a}r++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);e&&Fr(s,u,e),t&&t.length>0&&za(s,u,t.join(" "))}if(m=Wn(h,0),void 0!==t){const e=m.projection=[];for(let n=0;n<this.ngContentSelectors.length;n++){const r=t[n];e.push(null!=r?Array.from(r):null)}}p=function(e,t,n,r,i){const a=n[1],o=function(e,t,n){const r=ir();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),oa(e,r,1),ca(e,t,n));const i=ai(t,e,t.length-1,r);gi(i,t);const a=Hn(r,t);return a&&gi(a,t),i}(a,n,t);r.components.push(o),e[8]=o,i&&i.forEach(e=>e(o,t)),t.contentQueries&&t.contentQueries(1,o,n.length-1);const s=ir();if(a.firstCreatePass&&(null!==t.hostBindings||null!==t.hostAttrs)){Sr(s.index-Sn);const e=n[1];ra(e,t),ia(e,n,t.hostVars),aa(t,o)}return o}(e,this.componentDef,f,d,[go]),Vi(h,f,null)}finally{kr()}return new Fs(this.componentType,p,Ga(ns,m,f),f,m)}}class Fs extends class{}{constructor(e,t,n,r,i){super(),this.location=n,this._rootLView=r,this._tNode=i,this.destroyCbs=[],this.instance=t,this.hostView=this.changeDetectorRef=new Ha(r),this.componentType=e}get injector(){return new li(this._tNode,this._rootLView)}destroy(){this.destroyCbs&&(this.destroyCbs.forEach(e=>e()),this.destroyCbs=null,!this.hostView.destroyed&&this.hostView.destroy())}onDestroy(e){this.destroyCbs&&this.destroyCbs.push(e)}}const Rs=void 0;var Ps=["en",[["a","p"],["AM","PM"],Rs],[["AM","PM"],Rs,Rs],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Rs,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Rs,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Rs,"{1} 'at' {0}",Rs],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(e){let t=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===n?1:5}];let Ls={};function Bs(e){return e in Ls||(Ls[e]=Dt.ng&&Dt.ng.common&&Dt.ng.common.locales&&Dt.ng.common.locales[e]),Ls[e]}var $s=function(e){return e[e.LocaleId=0]="LocaleId",e[e.DayPeriodsFormat=1]="DayPeriodsFormat",e[e.DayPeriodsStandalone=2]="DayPeriodsStandalone",e[e.DaysFormat=3]="DaysFormat",e[e.DaysStandalone=4]="DaysStandalone",e[e.MonthsFormat=5]="MonthsFormat",e[e.MonthsStandalone=6]="MonthsStandalone",e[e.Eras=7]="Eras",e[e.FirstDayOfWeek=8]="FirstDayOfWeek",e[e.WeekendRange=9]="WeekendRange",e[e.DateFormat=10]="DateFormat",e[e.TimeFormat=11]="TimeFormat",e[e.DateTimeFormat=12]="DateTimeFormat",e[e.NumberSymbols=13]="NumberSymbols",e[e.NumberFormats=14]="NumberFormats",e[e.CurrencyCode=15]="CurrencyCode",e[e.CurrencySymbol=16]="CurrencySymbol",e[e.CurrencyName=17]="CurrencyName",e[e.Currencies=18]="Currencies",e[e.Directionality=19]="Directionality",e[e.PluralCase=20]="PluralCase",e[e.ExtraData=21]="ExtraData",e}({});const zs="en-US";let Us=zs;function Hs(e){var t,n;n="Expected localeId to be defined",null==(t=e)&&function(e,t,n,r){throw new Error("ASSERTION ERROR: "+e+` [Expected=> null != ${t} <=Actual]`)}(n,t),"string"==typeof e&&(Us=e.toLowerCase().replace(/_/g,"-"))}const Ws=new Map;class Vs extends en{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Ds(this);const n=En(e),r=e[Rt]||null;r&&Hs(r),this._bootstrapComponents=qr(n.bootstrap),this._r3Injector=ao(e,t,[{provide:en,useValue:this},{provide:ts,useValue:this.componentFactoryResolver}],_t(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=fo.THROW_IF_NOT_FOUND,n=ct.Default){return e===fo||e===en||e===$t?this:this._r3Injector.get(e,t,n)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class qs extends tn{constructor(e){super(),this.moduleType=e,null!==En(e)&&function e(t){if(null!==t.\u0275mod.id){const e=t.\u0275mod.id;(function(e,t,n){if(t&&t!==n)throw new Error(`Duplicate module registered for ${e} - ${_t(t)} vs ${_t(t.name)}`)})(e,Ws.get(e),t),Ws.set(e,t)}let n=t.\u0275mod.imports;n instanceof Function&&(n=n()),n&&n.forEach(t=>e(t))}(e)}create(e){return new Vs(this.moduleType,e)}}function Gs(e,t,n,r){return Ys(tr(),ur(),e,t,n,r)}function Ys(e,t,n,r,i,a){const o=t+n;return ko(e,o,i)?_o(e,o+1,a?r.call(a,i):r(i)):function(e,t){const n=e[t];return n===Ii?void 0:n}(e,o+1)}function Xs(e,t){const n=nr();let r;const i=e+Sn;n.firstCreatePass?(r=function(e,t){if(t)for(let n=t.length-1;n>=0;n--){const r=t[n];if(e===r.name)return r}throw new Error(`The pipe '${e}' could not be found!`)}(t,n.pipeRegistry),n.data[i]=r,r.onDestroy&&(n.destroyHooks||(n.destroyHooks=[])).push(i,r.onDestroy)):r=n.data[i];const a=r.factory||(r.factory=kn(r.type)),o=Yt(Co);try{const t=Yr(!1),r=a();return Yr(t),function(e,t,n,r){const i=n+Sn;i>=e.data.length&&(e.data[i]=null,e.blueprint[i]=null),t[i]=r}(n,tr(),e,r),r}finally{Yt(o)}}function Ks(e,t,n){const r=tr(),i=Vn(r,e);return function(e,t){return bo.isWrapped(t)&&(t=bo.unwrap(t),e[cr()]=Ii),t}(r,function(e,t){return e[1].data[t+Sn].pure}(r,e)?Ys(r,ur(),t,i.transform,n,i):i.transform(n))}const Zs=class extends Ie{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,n){let r,i=e=>null,a=()=>null;e&&"object"==typeof e?(r=this.__isAsync?t=>{setTimeout(()=>e.next(t))}:t=>{e.next(t)},e.error&&(i=this.__isAsync?t=>{setTimeout(()=>e.error(t))}:t=>{e.error(t)}),e.complete&&(a=this.__isAsync?()=>{setTimeout(()=>e.complete())}:()=>{e.complete()})):(r=this.__isAsync?t=>{setTimeout(()=>e(t))}:t=>{e(t)},t&&(i=this.__isAsync?e=>{setTimeout(()=>t(e))}:e=>{t(e)}),n&&(a=this.__isAsync?()=>{setTimeout(()=>n())}:()=>{n()}));const o=super.subscribe(r,i,a);return e instanceof ge&&e.add(o),o}};function Js(){return this._results[yo()]()}class Qs{constructor(){this.dirty=!0,this._results=[],this.changes=new Zs,this.length=0;const e=yo(),t=Qs.prototype;t[e]||(t[e]=Js)}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e){this._results=function e(t,n){void 0===n&&(n=t);for(let r=0;r<t.length;r++){let i=t[r];Array.isArray(i)?(n===t&&(n=t.slice(0,r)),e(i,n)):n!==t&&n.push(i)}return n}(e),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]}notifyOnChanges(){this.changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}class el{constructor(e){this.queryList=e,this.matches=null}clone(){return new el(this.queryList)}setDirty(){this.queryList.setDirty()}}class tl{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const n=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let e=0;e<n;e++){const n=t.getByIndex(e);r.push(this.queries[n.indexInDeclarationView].clone())}return new tl(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==dl(e,t).matches&&this.queries[t].setDirty()}}class nl{constructor(e,t,n,r=null){this.predicate=e,this.descendants=t,this.isStatic=n,this.read=r}}class rl{constructor(e=[]){this.queries=e}elementStart(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let n=0;n<this.length;n++){const r=null!==t?t.length:0,i=this.getByIndex(n).embeddedTView(e,r);i&&(i.indexInDeclarationView=n,null!==t?t.push(i):t=[i])}return null!==t?new rl(t):null}template(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class il{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new il(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&!1===this.metadata.descendants){const t=this._declarationNodeIndex;let n=e.parent;for(;null!==n&&3===n.type&&n.index!==t;)n=n.parent;return t===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const n=this.metadata.predicate;if(Array.isArray(n))for(let r=0;r<n.length;r++){const i=n[r];this.matchTNodeWithReadOption(e,t,al(t,i)),this.matchTNodeWithReadOption(e,t,ii(t,e,i,!1,!1))}else n===Ts?0===t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,ii(t,e,n,!1,!1))}matchTNodeWithReadOption(e,t,n){if(null!==n){const r=this.metadata.read;if(null!==r)if(r===ns||r===Is||r===Ts&&0===t.type)this.addMatch(t.index,-2);else{const n=ii(t,e,r,!1,!1);null!==n&&this.addMatch(t.index,n)}else this.addMatch(t.index,n)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function al(e,t){const n=e.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function ol(e,t,n,r){return-1===n?function(e,t){return 2===e.type||3===e.type?Ga(ns,e,t):0===e.type?Ya(Ts,ns,e,t):null}(t,e):-2===n?function(e,t,n){return n===ns?Ga(ns,t,e):n===Ts?Ya(Ts,ns,t,e):n===Is?Xa(Is,ns,t,e):void 0}(e,t,r):ai(e,e[1],n,t)}function sl(e,t,n,r){const i=t[19].queries[r];if(null===i.matches){const r=e.data,a=n.matches,o=[];for(let e=0;e<a.length;e+=2){const i=a[e];o.push(i<0?null:ol(t,r[i],a[e+1],n.metadata.read))}i.matches=o}return i.matches}function ll(e){const t=tr(),n=nr(),r=mr();gr(r+1);const i=dl(n,r);if(e.dirty&&Yn(t)===i.metadata.isStatic){if(null===i.matches)e.reset([]);else{const a=i.crossesNgTemplate?function e(t,n,r,i){const a=t.queries.getByIndex(r),o=a.matches;if(null!==o){const s=sl(t,n,a,r);for(let t=0;t<o.length;t+=2){const r=o[t];if(r>0)i.push(s[t/2]);else{const a=o[t+1],s=n[-r];for(let t=Tn;t<s.length;t++){const n=s[t];n[17]===n[3]&&e(n[1],n,a,i)}if(null!==s[9]){const t=s[9];for(let n=0;n<t.length;n++){const r=t[n];e(r[1],r,a,i)}}}}}return i}(n,t,r,[]):sl(n,t,i,r);e.reset(a),e.notifyOnChanges()}return!0}return!1}function ul(e,t,n){!function(e,t,n,r,i,a){e.firstCreatePass&&function(e,t,n){null===e.queries&&(e.queries=new rl),e.queries.track(new il(t,-1))}(e,new nl(n,r,false,i)),function(e,t){const n=new Qs;Qi(e,t,n,n.destroy),null===t[19]&&(t[19]=new tl),t[19].queries.push(new el(n))}(e,t)}(nr(),tr(),e,t,n)}function cl(){return e=tr(),t=mr(),e[19].queries[t].queryList;var e,t}function dl(e,t){return e.queries.getByIndex(t)}const hl=new Bt("Application Initializer");let fl=(()=>{class e{constructor(e){this.appInits=e,this.initialized=!1,this.done=!1,this.donePromise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}runInitializers(){if(this.initialized)return;const e=[],t=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let n=0;n<this.appInits.length;n++){const t=this.appInits[n]();jo(t)&&e.push(t)}Promise.all(e).then(()=>{t()}).catch(e=>{this.reject(e)}),0===e.length&&t(),this.initialized=!0}}return e.\u0275fac=function(t){return new(t||e)(Kt(hl,8))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();const pl=new Bt("AppId"),ml={provide:pl,useFactory:function(){return`${gl()}${gl()}${gl()}`},deps:[]};function gl(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const vl=new Bt("Platform Initializer"),yl=new Bt("Platform ID"),bl=new Bt("appBootstrapListener");let xl=(()=>{class e{log(e){console.log(e)}warn(e){console.warn(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();const wl=new Bt("LocaleId"),_l=new Bt("DefaultCurrencyCode");class kl{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}const El=function(e){return new qs(e)},Sl=El,Tl=function(e){return Promise.resolve(El(e))},Cl=function(e){const t=El(e),n=qr(En(e).declarations).reduce((e,t)=>{const n=_n(t);return n&&e.push(new js(n)),e},[]);return new kl(t,n)},Il=Cl,Al=function(e){return Promise.resolve(Cl(e))};let Ol=(()=>{class e{constructor(){this.compileModuleSync=Sl,this.compileModuleAsync=Tl,this.compileModuleAndAllComponentsSync=Il,this.compileModuleAndAllComponentsAsync=Al}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();const Dl=(()=>Promise.resolve(0))();function Ml(e){"undefined"==typeof Zone?Dl.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class Nl{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Zs(!1),this.onMicrotaskEmpty=new Zs(!1),this.onStable=new Zs(!1),this.onError=new Zs(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const n=this;n._nesting=0,n._outer=n._inner=Zone.current,Zone.wtfZoneSpec&&(n._inner=n._inner.fork(Zone.wtfZoneSpec)),Zone.TaskTrackingZoneSpec&&(n._inner=n._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(n._inner=n._inner.fork(Zone.longStackTraceZoneSpec)),n.shouldCoalesceEventChangeDetection=t,n.lastRequestAnimationFrameId=-1,n.nativeRequestAnimationFrame=function(){let e=Dt.requestAnimationFrame,t=Dt.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function(e){const t=!!e.shouldCoalesceEventChangeDetection&&e.nativeRequestAnimationFrame&&(()=>{!function(e){-1===e.lastRequestAnimationFrameId&&(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Dt,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,Pl(e),Rl(e)},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),Pl(e))}(e)});e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0,maybeDelayChangeDetection:t},onInvokeTask:(n,r,i,a,o,s)=>{try{return Ll(e),n.invokeTask(i,a,o,s)}finally{t&&"eventTask"===a.type&&t(),Bl(e)}},onInvoke:(t,n,r,i,a,o,s)=>{try{return Ll(e),t.invoke(r,i,a,o,s)}finally{Bl(e)}},onHasTask:(t,n,r,i)=>{t.hasTask(r,i),n===r&&("microTask"==i.change?(e._hasPendingMicrotasks=i.microTask,Pl(e),Rl(e)):"macroTask"==i.change&&(e.hasPendingMacrotasks=i.macroTask))},onHandleError:(t,n,r,i)=>(t.handleError(r,i),e.runOutsideAngular(()=>e.onError.emit(i)),!1)})}(n)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Nl.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Nl.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,n){return this._inner.run(e,t,n)}runTask(e,t,n,r){const i=this._inner,a=i.scheduleEventTask("NgZoneEvent: "+r,e,Fl,jl,jl);try{return i.runTask(a,t,n)}finally{i.cancelTask(a)}}runGuarded(e,t,n){return this._inner.runGuarded(e,t,n)}runOutsideAngular(e){return this._outer.run(e)}}function jl(){}const Fl={};function Rl(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Pl(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||e.shouldCoalesceEventChangeDetection&&-1!==e.lastRequestAnimationFrameId)}function Ll(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function Bl(e){e._nesting--,Rl(e)}class $l{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Zs,this.onMicrotaskEmpty=new Zs,this.onStable=new Zs,this.onError=new Zs}run(e,t,n){return e.apply(t,n)}runGuarded(e,t,n){return e.apply(t,n)}runOutsideAngular(e){return e()}runTask(e,t,n,r){return e.apply(t,n)}}let zl=(()=>{class e{constructor(e){this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Nl.assertNotInAngularZone(),Ml(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Ml(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(t=>!t.updateCb||!t.updateCb(e)||(clearTimeout(t.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,t,n){let r=-1;t&&t>0&&(r=setTimeout(()=>{this._callbacks=this._callbacks.filter(e=>e.timeoutId!==r),e(this._didWork,this.getPendingTasks())},t)),this._callbacks.push({doneCb:e,timeoutId:r,updateCb:n})}whenStable(e,t,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(e,t,n),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(e,t,n){return[]}}return e.\u0275fac=function(t){return new(t||e)(Kt(Nl))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})(),Ul=(()=>{class e{constructor(){this._applications=new Map,Vl.addToWindow(this)}registerApplication(e,t){this._applications.set(e,t)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,t=!0){return Vl.findTestabilityInTree(this,e,t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();class Hl{addToWindow(e){}findTestabilityInTree(e,t,n){return null}}let Wl,Vl=new Hl;const ql=new Bt("AllowMultipleToken");class Gl{constructor(e,t){this.name=e,this.token=t}}function Yl(e,t,n=[]){const r="Platform: "+t,i=new Bt(r);return(t=[])=>{let a=Xl();if(!a||a.injector.get(ql,!1))if(e)e(n.concat(t).concat({provide:i,useValue:!0}));else{const e=n.concat(t).concat({provide:i,useValue:!0},{provide:Qa,useValue:"platform"});!function(e){if(Wl&&!Wl.destroyed&&!Wl.injector.get(ql,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Wl=e.get(Kl);const t=e.get(vl,null);t&&t.forEach(e=>e())}(fo.create({providers:e,name:r}))}return function(e){const t=Xl();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(i)}}function Xl(){return Wl&&!Wl.destroyed?Wl:null}let Kl=(()=>{class e{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,t){const n=function(e,t){let n;return n="noop"===e?new $l:("zone.js"===e?void 0:e)||new Nl({enableLongStackTrace:mi(),shouldCoalesceEventChangeDetection:t}),n}(t?t.ngZone:void 0,t&&t.ngZoneEventCoalescing||!1),r=[{provide:Nl,useValue:n}];return n.run(()=>{const t=fo.create({providers:r,parent:this.injector,name:e.moduleType.name}),i=e.create(t),a=i.injector.get(hi,null);if(!a)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return i.onDestroy(()=>Ql(this._modules,i)),n.runOutsideAngular(()=>n.onError.subscribe({next:e=>{a.handleError(e)}})),function(e,t,n){try{const r=n();return jo(r)?r.catch(n=>{throw t.runOutsideAngular(()=>e.handleError(n)),n}):r}catch(r){throw t.runOutsideAngular(()=>e.handleError(r)),r}}(a,n,()=>{const e=i.injector.get(fl);return e.runInitializers(),e.donePromise.then(()=>(Hs(i.injector.get(wl,zs)||zs),this._moduleDoBootstrap(i),i))})})}bootstrapModule(e,t=[]){const n=Zl({},t);return function(e,t,n){const r=new qs(n);return Promise.resolve(r)}(0,0,e).then(e=>this.bootstrapModuleFactory(e,n))}_moduleDoBootstrap(e){const t=e.injector.get(Jl);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(e=>t.bootstrap(e));else{if(!e.instance.ngDoBootstrap)throw new Error(`The module ${_t(e.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);e.instance.ngDoBootstrap(t)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(e=>e.destroy()),this._destroyListeners.forEach(e=>e()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(t){return new(t||e)(Kt(fo))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();function Zl(e,t){return Array.isArray(t)?t.reduce(Zl,e):Object.assign(Object.assign({},e),t)}let Jl=(()=>{class e{constructor(e,t,n,r,i,a){this._zone=e,this._console=t,this._injector=n,this._exceptionHandler=r,this._componentFactoryResolver=i,this._initStatus=a,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=mi(),this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const o=new ke(e=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{e.next(this._stable),e.complete()})}),s=new ke(e=>{let t;this._zone.runOutsideAngular(()=>{t=this._zone.onStable.subscribe(()=>{Nl.assertNotInAngularZone(),Ml(()=>{this._stable||this._zone.hasPendingMacrotasks||this._zone.hasPendingMicrotasks||(this._stable=!0,e.next(!0))})})});const n=this._zone.onUnstable.subscribe(()=>{Nl.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{e.next(!1)}))});return()=>{t.unsubscribe(),n.unsubscribe()}});this.isStable=function(...e){let t=Number.POSITIVE_INFINITY,n=null,r=e[e.length-1];return Oe(r)?(n=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(t=e.pop())):"number"==typeof r&&(t=e.pop()),null===n&&1===e.length&&e[0]instanceof ke?e[0]:Ye(t)(Xe(e,n))}(o,s.pipe(e=>{return Ke()((t=nt,function(e){let n;n="function"==typeof t?t:function(){return t};const r=Object.create(e,et);return r.source=e,r.subjectFactory=n,r})(e));var t}))}bootstrap(e,t){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let n;n=e instanceof Qo?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(n.componentType);const r=n.isBoundToModule?void 0:this._injector.get(en),i=n.create(fo.NULL,[],t||n.selector,r);i.onDestroy(()=>{this._unloadComponent(i)});const a=i.injector.get(zl,null);return a&&i.injector.get(Ul).registerApplication(i.location.nativeElement,a),this._loadComponent(i),mi()&&this._console.log("Angular is running in development mode. Call enableProdMode() to enable production mode."),i}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let e of this._views)e.detectChanges();if(this._enforceNoNewChanges)for(let e of this._views)e.checkNoChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const t=e;this._views.push(t),t.attachToAppRef(this)}detachView(e){const t=e;Ql(this._views,t),t.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(bl,[]).concat(this._bootstrapListeners).forEach(t=>t(e))}_unloadComponent(e){this.detachView(e.hostView),Ql(this.components,e)}ngOnDestroy(){this._views.slice().forEach(e=>e.destroy())}get viewCount(){return this._views.length}}return e.\u0275fac=function(t){return new(t||e)(Kt(Nl),Kt(xl),Kt(fo),Kt(hi),Kt(ts),Kt(fl))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();function Ql(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class eu{}class tu{}const nu={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let ru=(()=>{class e{constructor(e,t){this._compiler=e,this._config=t||nu}load(e){return this.loadAndCompile(e)}loadAndCompile(e){let[t,r]=e.split("#");return void 0===r&&(r="default"),n("zn8P")(t).then(e=>e[r]).then(e=>iu(e,t,r)).then(e=>this._compiler.compileModuleAsync(e))}loadFactory(e){let[t,r]=e.split("#"),i="NgFactory";return void 0===r&&(r="default",i=""),n("zn8P")(this._config.factoryPathPrefix+t+this._config.factoryPathSuffix).then(e=>e[r+i]).then(e=>iu(e,t,r))}}return e.\u0275fac=function(t){return new(t||e)(Kt(Ol),Kt(tu,8))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();function iu(e,t,n){if(!e)throw new Error(`Cannot find '${n}' in '${t}'`);return e}const au=Yl(null,"core",[{provide:yl,useValue:"unknown"},{provide:Kl,deps:[fo]},{provide:Ul,deps:[]},{provide:xl,deps:[]}]),ou=[{provide:Jl,useClass:Jl,deps:[Nl,xl,fo,hi,ts,fl]},{provide:Ns,deps:[Nl],useFactory:function(e){let t=[];return e.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(e){t.push(e)}}},{provide:fl,useClass:fl,deps:[[new st,hl]]},{provide:Ol,useClass:Ol,deps:[]},ml,{provide:ws,useFactory:function(){return Es},deps:[]},{provide:_s,useFactory:function(){return Ss},deps:[]},{provide:wl,useFactory:function(e){return Hs(e=e||"undefined"!=typeof $localize&&$localize.locale||zs),e},deps:[[new ot(wl),new st,new ut]]},{provide:_l,useValue:"USD"}];let su=(()=>{class e{constructor(e){}}return e.\u0275mod=yn({type:e}),e.\u0275inj=ft({factory:function(t){return new(t||e)(Kt(Jl))},providers:ou}),e})(),lu=null;function uu(){return lu}const cu=new Bt("DocumentToken");let du=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ht({factory:hu,token:e,providedIn:"platform"}),e})();function hu(){return Kt(pu)}const fu=new Bt("Location Initialized");let pu=(()=>{class e extends du{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=uu().getLocation(),this._history=uu().getHistory()}getBaseHrefFromDOM(){return uu().getBaseHref(this._doc)}onPopState(e){uu().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",e,!1)}onHashChange(e){uu().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",e,!1)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,t,n){mu()?this._history.pushState(e,t,n):this.location.hash=n}replaceState(e,t,n){mu()?this._history.replaceState(e,t,n):this.location.hash=n}forward(){this._history.forward()}back(){this._history.back()}getState(){return this._history.state}}return e.\u0275fac=function(t){return new(t||e)(Kt(cu))},e.\u0275prov=ht({factory:gu,token:e,providedIn:"platform"}),e})();function mu(){return!!window.history.pushState}function gu(){return new pu(Kt(cu))}function vu(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function yu(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function bu(e){return e&&"?"!==e[0]?"?"+e:e}let xu=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ht({factory:wu,token:e,providedIn:"root"}),e})();function wu(e){const t=Kt(cu).location;return new ku(Kt(du),t&&t.origin||"")}const _u=new Bt("appBaseHref");let ku=(()=>{class e extends xu{constructor(e,t){if(super(),this._platformLocation=e,null==t&&(t=this._platformLocation.getBaseHrefFromDOM()),null==t)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=t}onPopState(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return vu(this._baseHref,e)}path(e=!1){const t=this._platformLocation.pathname+bu(this._platformLocation.search),n=this._platformLocation.hash;return n&&e?`${t}${n}`:t}pushState(e,t,n,r){const i=this.prepareExternalUrl(n+bu(r));this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){const i=this.prepareExternalUrl(n+bu(r));this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}}return e.\u0275fac=function(t){return new(t||e)(Kt(du),Kt(_u,8))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})(),Eu=(()=>{class e extends xu{constructor(e,t){super(),this._platformLocation=e,this._baseHref="",null!=t&&(this._baseHref=t)}onPopState(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)}getBaseHref(){return this._baseHref}path(e=!1){let t=this._platformLocation.hash;return null==t&&(t="#"),t.length>0?t.substring(1):t}prepareExternalUrl(e){const t=vu(this._baseHref,e);return t.length>0?"#"+t:t}pushState(e,t,n,r){let i=this.prepareExternalUrl(n+bu(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){let i=this.prepareExternalUrl(n+bu(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}}return e.\u0275fac=function(t){return new(t||e)(Kt(du),Kt(_u,8))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})(),Su=(()=>{class e{constructor(e,t){this._subject=new Zs,this._urlChangeListeners=[],this._platformStrategy=e;const n=this._platformStrategy.getBaseHref();this._platformLocation=t,this._baseHref=yu(Cu(n)),this._platformStrategy.onPopState(e=>{this._subject.emit({url:this.path(!0),pop:!0,state:e.state,type:e.type})})}path(e=!1){return this.normalize(this._platformStrategy.path(e))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(e,t=""){return this.path()==this.normalize(e+bu(t))}normalize(t){return e.stripTrailingSlash(function(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,Cu(t)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}go(e,t="",n=null){this._platformStrategy.pushState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+bu(t)),n)}replaceState(e,t="",n=null){this._platformStrategy.replaceState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+bu(t)),n)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}onUrlChange(e){this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(e=>{this._notifyUrlChangeListeners(e.url,e.state)}))}_notifyUrlChangeListeners(e="",t){this._urlChangeListeners.forEach(n=>n(e,t))}subscribe(e,t,n){return this._subject.subscribe({next:e,error:t,complete:n})}}return e.\u0275fac=function(t){return new(t||e)(Kt(xu),Kt(du))},e.normalizeQueryParams=bu,e.joinWithSlash=vu,e.stripTrailingSlash=yu,e.\u0275prov=ht({factory:Tu,token:e,providedIn:"root"}),e})();function Tu(){return new Su(Kt(xu),Kt(du))}function Cu(e){return e.replace(/\/index.html$/,"")}var Iu=function(e){return e[e.Zero=0]="Zero",e[e.One=1]="One",e[e.Two=2]="Two",e[e.Few=3]="Few",e[e.Many=4]="Many",e[e.Other=5]="Other",e}({});class Au{}let Ou=(()=>{class e extends Au{constructor(e){super(),this.locale=e}getPluralCategory(e,t){switch(function(e){return function(e){const t=function(e){return e.toLowerCase().replace(/_/g,"-")}(e);let n=Bs(t);if(n)return n;const r=t.split("-")[0];if(n=Bs(r),n)return n;if("en"===r)return Ps;throw new Error(`Missing locale data for the locale "${e}".`)}(e)[$s.PluralCase]}(t||this.locale)(e)){case Iu.Zero:return"zero";case Iu.One:return"one";case Iu.Two:return"two";case Iu.Few:return"few";case Iu.Many:return"many";default:return"other"}}}return e.\u0275fac=function(t){return new(t||e)(Kt(wl))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})(),Du=(()=>{class e{constructor(e,t,n,r){this._iterableDiffers=e,this._keyValueDiffers=t,this._ngEl=n,this._renderer=r,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(xo(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachChangedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachRemovedItem(e=>{e.previousValue&&this._toggleClass(e.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(e=>{if("string"!=typeof e.item)throw new Error("NgClass can only toggle CSS classes expressed as strings, got "+_t(e.item));this._toggleClass(e.item,!0)}),e.forEachRemovedItem(e=>this._toggleClass(e.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!0)):Object.keys(e).forEach(t=>this._toggleClass(t,!!e[t])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!1)):Object.keys(e).forEach(e=>this._toggleClass(e,!1)))}_toggleClass(e,t){(e=e.trim())&&e.split(/\s+/g).forEach(e=>{t?this._renderer.addClass(this._ngEl.nativeElement,e):this._renderer.removeClass(this._ngEl.nativeElement,e)})}}return e.\u0275fac=function(t){return new(t||e)(Co(ws),Co(_s),Co(ns),Co(os))},e.\u0275dir=xn({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),e})();class Mu{constructor(e,t,n,r){this.$implicit=e,this.ngForOf=t,this.index=n,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Nu=(()=>{class e{constructor(e,t,n){this._viewContainer=e,this._template=t,this._differs=n,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){mi()&&null!=e&&"function"!=typeof e&&console&&console.warn&&console.warn(`trackBy must be a function, but received ${JSON.stringify(e)}. See https://angular.io/api/common/NgForOf#change-propagation for more information.`),this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;if(!this._differ&&n)try{this._differ=this._differs.find(n).create(this.ngForTrackBy)}catch(t){throw new Error(`Cannot find a differ supporting object '${n}' of type '${e=n,e.name||typeof e}'. NgFor only supports binding to Iterables such as Arrays.`)}}var e;if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const t=[];e.forEachOperation((e,n,r)=>{if(null==e.previousIndex){const n=this._viewContainer.createEmbeddedView(this._template,new Mu(null,this._ngForOf,-1,-1),null===r?void 0:r),i=new ju(e,n);t.push(i)}else if(null==r)this._viewContainer.remove(null===n?void 0:n);else if(null!==n){const i=this._viewContainer.get(n);this._viewContainer.move(i,r);const a=new ju(e,i);t.push(a)}});for(let n=0;n<t.length;n++)this._perViewChange(t[n].view,t[n].record);for(let n=0,r=this._viewContainer.length;n<r;n++){const e=this._viewContainer.get(n);e.context.index=n,e.context.count=r,e.context.ngForOf=this._ngForOf}e.forEachIdentityChange(e=>{this._viewContainer.get(e.currentIndex).context.$implicit=e.item})}_perViewChange(e,t){e.context.$implicit=t.item}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(Co(Is),Co(Ts),Co(ws))},e.\u0275dir=xn({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),e})();class ju{constructor(e,t){this.record=e,this.view=t}}let Fu=(()=>{class e{constructor(e,t){this._viewContainer=e,this._context=new Ru,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=t}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){Pu("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){Pu("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(Co(Is),Co(Ts))},e.\u0275dir=xn({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e})();class Ru{constructor(){this.$implicit=null,this.ngIf=null}}function Pu(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${_t(t)}'.`)}let Lu=(()=>{class e{constructor(e){this.differs=e,this.keyValues=[]}transform(e,t=Bu){if(!e||!(e instanceof Map)&&"object"!=typeof e)return null;this.differ||(this.differ=this.differs.find(e).create());const n=this.differ.diff(e);return n&&(this.keyValues=[],n.forEachItem(e=>{this.keyValues.push({key:e.key,value:e.currentValue})}),this.keyValues.sort(t)),this.keyValues}}return e.\u0275fac=function(t){return new(t||e)(Co(_s))},e.\u0275pipe=wn({name:"keyvalue",type:e,pure:!1}),e})();function Bu(e,t){const n=e.key,r=t.key;if(n===r)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(null===n)return 1;if(null===r)return-1;if("string"==typeof n&&"string"==typeof r)return n<r?-1:1;if("number"==typeof n&&"number"==typeof r)return n-r;if("boolean"==typeof n&&"boolean"==typeof r)return n<r?-1:1;const i=String(n),a=String(r);return i==a?0:i<a?-1:1}let $u=(()=>{class e{}return e.\u0275mod=yn({type:e}),e.\u0275inj=ft({factory:function(t){return new(t||e)},providers:[{provide:Au,useClass:Ou}]}),e})(),zu=(()=>{class e{}return e.\u0275prov=ht({token:e,providedIn:"root",factory:()=>new Uu(Kt(cu),window,Kt(hi))}),e})();class Uu{constructor(e,t,n){this.document=e,this.window=t,this.errorHandler=n,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.scrollX,this.window.scrollY]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(this.supportsScrolling()){const t=this.document.getElementById(e)||this.document.getElementsByName(e)[0];t&&this.scrollToElement(t)}}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),n=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(n-i[0],r-i[1])}supportScrollRestoration(){try{if(!this.window||!this.window.scrollTo)return!1;const e=Hu(this.window.history)||Hu(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}supportsScrolling(){try{return!!this.window.scrollTo}catch(e){return!1}}}function Hu(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class Wu extends class extends class{}{constructor(){super()}supportsDOMEvents(){return!0}}{static makeCurrent(){var e;e=new Wu,lu||(lu=e)}getProperty(e,t){return e[t]}log(e){window.console&&window.console.log&&window.console.log(e)}logGroup(e){window.console&&window.console.group&&window.console.group(e)}logGroupEnd(){window.console&&window.console.groupEnd&&window.console.groupEnd()}onAndCancel(e,t,n){return e.addEventListener(t,n,!1),()=>{e.removeEventListener(t,n,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){return e.parentNode&&e.parentNode.removeChild(e),e}getValue(e){return e.value}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getHistory(){return window.history}getLocation(){return window.location}getBaseHref(e){const t=qu||(qu=document.querySelector("base"),qu)?qu.getAttribute("href"):null;return null==t?null:(n=t,Vu||(Vu=document.createElement("a")),Vu.setAttribute("href",n),"/"===Vu.pathname.charAt(0)?Vu.pathname:"/"+Vu.pathname);var n}resetBaseElement(){qu=null}getUserAgent(){return window.navigator.userAgent}performanceNow(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}supportsCookies(){return!0}getCookie(e){return function(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const e=n.indexOf("="),[r,i]=-1==e?[n,""]:[n.slice(0,e),n.slice(e+1)];if(r.trim()===t)return decodeURIComponent(i)}return null}(document.cookie,e)}}let Vu,qu=null;const Gu=new Bt("TRANSITION_ID"),Yu=[{provide:hl,useFactory:function(e,t,n){return()=>{n.get(fl).donePromise.then(()=>{const n=uu();Array.prototype.slice.apply(t.querySelectorAll("style[ng-transition]")).filter(t=>t.getAttribute("ng-transition")===e).forEach(e=>n.remove(e))})}},deps:[Gu,cu,fo],multi:!0}];class Xu{static init(){!function(e){Vl=e}(new Xu)}addToWindow(e){Dt.getAngularTestability=(t,n=!0)=>{const r=e.findTestabilityInTree(t,n);if(null==r)throw new Error("Could not find testability for element.");return r},Dt.getAllAngularTestabilities=()=>e.getAllTestabilities(),Dt.getAllAngularRootElements=()=>e.getAllRootElements(),Dt.frameworkStabilizers||(Dt.frameworkStabilizers=[]),Dt.frameworkStabilizers.push(e=>{const t=Dt.getAllAngularTestabilities();let n=t.length,r=!1;const i=function(t){r=r||t,n--,0==n&&e(r)};t.forEach((function(e){e.whenStable(i)}))})}findTestabilityInTree(e,t,n){if(null==t)return null;const r=e.getTestability(t);return null!=r?r:n?uu().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}const Ku=new Bt("EventManagerPlugins");let Zu=(()=>{class e{constructor(e,t){this._zone=t,this._eventNameToPlugin=new Map,e.forEach(e=>e.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,t,n){return this._findPluginFor(t).addEventListener(e,t,n)}addGlobalEventListener(e,t,n){return this._findPluginFor(t).addGlobalEventListener(e,t,n)}getZone(){return this._zone}_findPluginFor(e){const t=this._eventNameToPlugin.get(e);if(t)return t;const n=this._plugins;for(let r=0;r<n.length;r++){const t=n[r];if(t.supports(e))return this._eventNameToPlugin.set(e,t),t}throw new Error("No event manager plugin found for event "+e)}}return e.\u0275fac=function(t){return new(t||e)(Kt(Ku),Kt(Nl))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();class Ju{constructor(e){this._doc=e}addGlobalEventListener(e,t,n){const r=uu().getGlobalEventTarget(this._doc,e);if(!r)throw new Error(`Unsupported event target ${r} for event ${t}`);return this.addEventListener(r,t,n)}}let Qu=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(e){const t=new Set;e.forEach(e=>{this._stylesSet.has(e)||(this._stylesSet.add(e),t.add(e))}),this.onStylesAdded(t)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})(),ec=(()=>{class e extends Qu{constructor(e){super(),this._doc=e,this._hostNodes=new Set,this._styleNodes=new Set,this._hostNodes.add(e.head)}_addStylesToHost(e,t){e.forEach(e=>{const n=this._doc.createElement("style");n.textContent=e,this._styleNodes.add(t.appendChild(n))})}addHost(e){this._addStylesToHost(this._stylesSet,e),this._hostNodes.add(e)}removeHost(e){this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach(t=>this._addStylesToHost(e,t))}ngOnDestroy(){this._styleNodes.forEach(e=>uu().remove(e))}}return e.\u0275fac=function(t){return new(t||e)(Kt(cu))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();const tc={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},nc=/%COMP%/g;function rc(e,t,n){for(let r=0;r<t.length;r++){let i=t[r];Array.isArray(i)?rc(e,i,n):(i=i.replace(nc,e),n.push(i))}return n}function ic(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let ac=(()=>{class e{constructor(e,t,n){this.eventManager=e,this.sharedStylesHost=t,this.appId=n,this.rendererByCompId=new Map,this.defaultRenderer=new oc(e)}createRenderer(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case cn.Emulated:{let n=this.rendererByCompId.get(t.id);return n||(n=new sc(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,n)),n.applyToHost(e),n}case cn.Native:case cn.ShadowDom:return new lc(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){const e=rc(t.id,t.styles,[]);this.sharedStylesHost.addStyles(e),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(t){return new(t||e)(Kt(Zu),Kt(ec),Kt(pl))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();class oc{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,t){return t?document.createElementNS(tc[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,n){e&&e.insertBefore(t,n)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error(`The selector "${e}" did not match any elements`);return t||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,n,r){if(r){t=r+":"+t;const i=tc[r];i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}removeAttribute(e,t,n){if(n){const r=tc[n];r?e.removeAttributeNS(r,t):e.removeAttribute(`${n}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,n,r){r&as.DashCase?e.style.setProperty(t,n,r&as.Important?"important":""):e.style[t]=n}removeStyle(e,t,n){n&as.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,n){e[t]=n}setValue(e,t){e.nodeValue=t}listen(e,t,n){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,ic(n)):this.eventManager.addEventListener(e,t,ic(n))}}class sc extends oc{constructor(e,t,n,r){super(e),this.component=n;const i=rc(r+"-"+n.id,n.styles,[]);t.addStyles(i),this.contentAttr="_ngcontent-%COMP%".replace(nc,r+"-"+n.id),this.hostAttr="_nghost-%COMP%".replace(nc,r+"-"+n.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const n=super.createElement(e,t);return super.setAttribute(n,this.contentAttr,""),n}}class lc extends oc{constructor(e,t,n,r){super(e),this.sharedStylesHost=t,this.hostEl=n,this.component=r,this.shadowRoot=r.encapsulation===cn.ShadowDom?n.attachShadow({mode:"open"}):n.createShadowRoot(),this.sharedStylesHost.addHost(this.shadowRoot);const i=rc(r.id,r.styles,[]);for(let a=0;a<i.length;a++){const e=document.createElement("style");e.textContent=i[a],this.shadowRoot.appendChild(e)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,n){return super.insertBefore(this.nodeOrShadowRoot(e),t,n)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let uc=(()=>{class e extends Ju{constructor(e){super(e)}supports(e){return!0}addEventListener(e,t,n){return e.addEventListener(t,n,!1),()=>this.removeEventListener(e,t,n)}removeEventListener(e,t,n){return e.removeEventListener(t,n)}}return e.\u0275fac=function(t){return new(t||e)(Kt(cu))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();const cc=["alt","control","meta","shift"],dc={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},hc={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},fc={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let pc=(()=>{class e extends Ju{constructor(e){super(e)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,n,r){const i=e.parseEventName(n),a=e.eventCallback(i.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>uu().onAndCancel(t,i.domEventName,a))}static parseEventName(t){const n=t.toLowerCase().split("."),r=n.shift();if(0===n.length||"keydown"!==r&&"keyup"!==r)return null;const i=e._normalizeKey(n.pop());let a="";if(cc.forEach(e=>{const t=n.indexOf(e);t>-1&&(n.splice(t,1),a+=e+".")}),a+=i,0!=n.length||0===i.length)return null;const o={};return o.domEventName=r,o.fullKey=a,o}static getEventFullKey(e){let t="",n=function(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&hc.hasOwnProperty(t)&&(t=hc[t]))}return dc[t]||t}(e);return n=n.toLowerCase()," "===n?n="space":"."===n&&(n="dot"),cc.forEach(r=>{r!=n&&(0,fc[r])(e)&&(t+=r+".")}),t+=n,t}static eventCallback(t,n,r){return i=>{e.getEventFullKey(i)===t&&r.runGuarded(()=>n(i))}}static _normalizeKey(e){switch(e){case"esc":return"escape";default:return e}}}return e.\u0275fac=function(t){return new(t||e)(Kt(cu))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();const mc=Yl(au,"browser",[{provide:yl,useValue:"browser"},{provide:vl,useValue:function(){Wu.makeCurrent(),Xu.init()},multi:!0},{provide:cu,useFactory:function(){return function(e){Ln=e}(document),document},deps:[]}]),gc=[[],{provide:Qa,useValue:"root"},{provide:hi,useFactory:function(){return new hi},deps:[]},{provide:Ku,useClass:uc,multi:!0,deps:[cu,Nl,yl]},{provide:Ku,useClass:pc,multi:!0,deps:[cu]},[],{provide:ac,useClass:ac,deps:[Zu,ec,pl]},{provide:is,useExisting:ac},{provide:Qu,useExisting:ec},{provide:ec,useClass:ec,deps:[cu]},{provide:zl,useClass:zl,deps:[Nl]},{provide:Zu,useClass:Zu,deps:[Ku,Nl]},[]];let vc=(()=>{class e{constructor(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:e,providers:[{provide:pl,useValue:t.appId},{provide:Gu,useExisting:pl},Yu]}}}return e.\u0275mod=yn({type:e}),e.\u0275inj=ft({factory:function(t){return new(t||e)(Kt(e,12))},providers:gc,imports:[$u,su]}),e})();function yc(...e){let t=e[e.length-1];return Oe(t)?(e.pop(),$e(e,t)):Xe(e)}"undefined"!=typeof window&&window;class bc extends Ie{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return t&&!t.closed&&e.next(this._value),t}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Se;return this._value}next(e){super.next(this._value=e)}}class xc extends be{notifyNext(e,t,n,r,i){this.destination.next(t)}notifyError(e,t){this.destination.error(e)}notifyComplete(e){this.destination.complete()}}class wc extends be{constructor(e,t,n){super(),this.parent=e,this.outerValue=t,this.outerIndex=n,this.index=0}_next(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}_error(e){this.parent.notifyError(e,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function _c(e,t,n,r,i=new wc(e,n,r)){if(!i.closed)return t instanceof ke?t.subscribe(i):Be(t)(i)}const kc={};class Ec{constructor(e){this.resultSelector=e}call(e,t){return t.subscribe(new Sc(e,this.resultSelector))}}class Sc extends xc{constructor(e,t){super(e),this.resultSelector=t,this.active=0,this.values=[],this.observables=[]}_next(e){this.values.push(kc),this.observables.push(e)}_complete(){const e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(let n=0;n<t;n++)this.add(_c(this,e[n],void 0,n))}}notifyComplete(e){0==(this.active-=1)&&this.destination.complete()}notifyNext(e,t,n){const r=this.values,i=this.toRespond?r[n]===kc?--this.toRespond:this.toRespond:0;r[n]=t,0===i&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))}_tryResultSelector(e){let t;try{t=this.resultSelector.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}const Tc=(()=>{function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e})(),Cc=new ke(e=>e.complete());function Ic(e){return e?function(e){return new ke(t=>e.schedule(()=>t.complete()))}(e):Cc}function Ac(e){return new ke(t=>{let n;try{n=e()}catch(r){return void t.error(r)}return(n?ze(n):Ic()).subscribe(t)})}function Oc(){return Ye(1)}function Dc(e,t){return function(n){return n.lift(new Mc(e,t))}}class Mc{constructor(e,t){this.predicate=e,this.thisArg=t}call(e,t){return t.subscribe(new Nc(e,this.predicate,this.thisArg))}}class Nc extends be{constructor(e,t,n){super(e),this.predicate=t,this.thisArg=n,this.count=0}_next(e){let t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}t&&this.destination.next(e)}}const jc=(()=>{function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e})();function Fc(e){return function(t){return 0===e?Ic():t.lift(new Rc(e))}}class Rc{constructor(e){if(this.total=e,this.total<0)throw new jc}call(e,t){return t.subscribe(new Pc(e,this.total))}}class Pc extends be{constructor(e,t){super(e),this.total=t,this.ring=new Array,this.count=0}_next(e){const t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e}_complete(){const e=this.destination;let t=this.count;if(t>0){const n=this.count>=this.total?this.total:this.count,r=this.ring;for(let i=0;i<n;i++){const i=t++%n;e.next(r[i])}}e.complete()}}function Lc(e=zc){return t=>t.lift(new Bc(e))}class Bc{constructor(e){this.errorFactory=e}call(e,t){return t.subscribe(new $c(e,this.errorFactory))}}class $c extends be{constructor(e,t){super(e),this.errorFactory=t,this.hasValue=!1}_next(e){this.hasValue=!0,this.destination.next(e)}_complete(){if(this.hasValue)return this.destination.complete();{let t;try{t=this.errorFactory()}catch(e){t=e}this.destination.error(t)}}}function zc(){return new Tc}function Uc(e=null){return t=>t.lift(new Hc(e))}class Hc{constructor(e){this.defaultValue=e}call(e,t){return t.subscribe(new Wc(e,this.defaultValue))}}class Wc extends be{constructor(e,t){super(e),this.defaultValue=t,this.isEmpty=!0}_next(e){this.isEmpty=!1,this.destination.next(e)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function Vc(e,t){return"function"==typeof t?n=>n.pipe(Vc((n,r)=>ze(e(n,r)).pipe(De((e,i)=>t(n,e,r,i))))):t=>t.lift(new qc(e))}class qc{constructor(e){this.project=e}call(e,t){return t.subscribe(new Gc(e,this.project))}}class Gc extends He{constructor(e,t){super(e),this.project=t,this.index=0}_next(e){let t;const n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this._innerSub(t)}_innerSub(e){const t=this.innerSubscription;t&&t.unsubscribe();const n=new Ue(this),r=this.destination;r.add(n),this.innerSubscription=We(e,n),this.innerSubscription!==n&&r.add(this.innerSubscription)}_complete(){const{innerSubscription:e}=this;e&&!e.closed||super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(e){this.destination.next(e)}}function Yc(e){return t=>0===e?Ic():t.lift(new Xc(e))}class Xc{constructor(e){if(this.total=e,this.total<0)throw new jc}call(e,t){return t.subscribe(new Kc(e,this.total))}}class Kc extends be{constructor(e,t){super(e),this.total=t,this.count=0}_next(e){const t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))}}function Zc(...e){return Oc()(yc(...e))}class Jc{constructor(e,t,n=!1){this.accumulator=e,this.seed=t,this.hasSeed=n}call(e,t){return t.subscribe(new Qc(e,this.accumulator,this.seed,this.hasSeed))}}class Qc extends be{constructor(e,t,n,r){super(e),this.accumulator=t,this._seed=n,this.hasSeed=r,this.index=0}get seed(){return this._seed}set seed(e){this.hasSeed=!0,this._seed=e}_next(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}_tryNext(e){const t=this.index++;let n;try{n=this.accumulator(this.seed,e,t)}catch(r){this.destination.error(r)}this.seed=n,this.destination.next(n)}}function ed(e){return function(t){const n=new td(e),r=t.lift(n);return n.caught=r}}class td{constructor(e){this.selector=e}call(e,t){return t.subscribe(new nd(e,this.selector,this.caught))}}class nd extends He{constructor(e,t,n){super(e),this.selector=t,this.caught=n}error(e){if(!this.isStopped){let n;try{n=this.selector(e,this.caught)}catch(t){return void super.error(t)}this._unsubscribeAndRecycle();const r=new Ue(this);this.add(r);const i=We(n,r);i!==r&&this.add(i)}}}function rd(e,t){return Ve(e,t,1)}function id(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Dc((t,n)=>e(t,n,r)):_e,Yc(1),n?Uc(t):Lc(()=>new Tc))}function ad(){}function od(e,t,n){return function(r){return r.lift(new sd(e,t,n))}}class sd{constructor(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}call(e,t){return t.subscribe(new ld(e,this.nextOrObserver,this.error,this.complete))}}class ld extends be{constructor(e,t,n,r){super(e),this._tapNext=ad,this._tapError=ad,this._tapComplete=ad,this._tapError=n||ad,this._tapComplete=r||ad,le(t)?(this._context=this,this._tapNext=t):t&&(this._context=t,this._tapNext=t.next||ad,this._tapError=t.error||ad,this._tapComplete=t.complete||ad)}_next(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)}_error(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)}_complete(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}class ud{constructor(e){this.callback=e}call(e,t){return t.subscribe(new cd(e,this.callback))}}class cd extends be{constructor(e,t){super(e),this.add(new ge(t))}}class dd{constructor(e,t){this.id=e,this.url=t}}class hd extends dd{constructor(e,t,n="imperative",r=null){super(e,t),this.navigationTrigger=n,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class fd extends dd{constructor(e,t,n){super(e,t),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class pd extends dd{constructor(e,t,n){super(e,t),this.reason=n}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class md extends dd{constructor(e,t,n){super(e,t),this.error=n}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class gd extends dd{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class vd extends dd{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class yd extends dd{constructor(e,t,n,r,i){super(e,t),this.urlAfterRedirects=n,this.state=r,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class bd extends dd{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class xd extends dd{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class wd{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class _d{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class kd{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ed{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Sd{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Td{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Cd{constructor(e,t,n){this.routerEvent=e,this.position=t,this.anchor=n}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Id="primary";class Ad{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Od(e){return new Ad(e)}function Dd(e){const t=Error("NavigationCancelingError: "+e);return t.ngNavigationCancelingError=!0,t}function Md(e,t,n){const r=n.path.split("/");if(r.length>e.length)return null;if("full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const i={};for(let a=0;a<r.length;a++){const t=r[a],n=e[a];if(t.startsWith(":"))i[t.substring(1)]=n;else if(t!==n.path)return null}return{consumed:e.slice(0,r.length),posParams:i}}function Nd(e,t){const n=Object.keys(e),r=Object.keys(t);if(!n||!r||n.length!=r.length)return!1;let i;for(let a=0;a<n.length;a++)if(i=n[a],!jd(e[i],t[i]))return!1;return!0}function jd(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((e,t)=>r[t]===e)}return e===t}function Fd(e){return Array.prototype.concat.apply([],e)}function Rd(e){return e.length>0?e[e.length-1]:null}function Pd(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function Ld(e){return(t=e)&&"function"==typeof t.subscribe?e:jo(e)?ze(Promise.resolve(e)):yc(e);var t}function Bd(e,t,n){return n?function(e,t){return Nd(e,t)}(e.queryParams,t.queryParams)&&function e(t,n){if(!Hd(t.segments,n.segments))return!1;if(t.numberOfChildren!==n.numberOfChildren)return!1;for(const r in n.children){if(!t.children[r])return!1;if(!e(t.children[r],n.children[r]))return!1}return!0}(e.root,t.root):function(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>jd(e[n],t[n]))}(e.queryParams,t.queryParams)&&function e(t,n){return function t(n,r,i){if(n.segments.length>i.length)return!!Hd(n.segments.slice(0,i.length),i)&&!r.hasChildren();if(n.segments.length===i.length){if(!Hd(n.segments,i))return!1;for(const t in r.children){if(!n.children[t])return!1;if(!e(n.children[t],r.children[t]))return!1}return!0}{const e=i.slice(0,n.segments.length),a=i.slice(n.segments.length);return!!Hd(n.segments,e)&&!!n.children.primary&&t(n.children.primary,r,a)}}(t,n,n.segments)}(e.root,t.root)}class $d{constructor(e,t,n){this.root=e,this.queryParams=t,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Od(this.queryParams)),this._queryParamMap}toString(){return Gd.serialize(this)}}class zd{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Pd(t,(e,t)=>e.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Yd(this)}}class Ud{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=Od(this.parameters)),this._parameterMap}toString(){return eh(this)}}function Hd(e,t){return e.length===t.length&&e.every((e,n)=>e.path===t[n].path)}function Wd(e,t){let n=[];return Pd(e.children,(e,r)=>{r===Id&&(n=n.concat(t(e,r)))}),Pd(e.children,(e,r)=>{r!==Id&&(n=n.concat(t(e,r)))}),n}class Vd{}class qd{parse(e){const t=new ah(e);return new $d(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){return`${"/"+function e(t,n){if(!t.hasChildren())return Yd(t);if(n){const n=t.children.primary?e(t.children.primary,!1):"",r=[];return Pd(t.children,(t,n)=>{n!==Id&&r.push(`${n}:${e(t,!1)}`)}),r.length>0?`${n}(${r.join("//")})`:n}{const n=Wd(t,(n,r)=>r===Id?[e(t.children.primary,!1)]:[`${r}:${e(n,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children.primary?`${Yd(t)}/${n[0]}`:`${Yd(t)}/(${n.join("//")})`}}(e.root,!0)}${function(e){const t=Object.keys(e).map(t=>{const n=e[t];return Array.isArray(n)?n.map(e=>`${Kd(t)}=${Kd(e)}`).join("&"):`${Kd(t)}=${Kd(n)}`});return t.length?"?"+t.join("&"):""}(e.queryParams)}${"string"==typeof e.fragment?"#"+encodeURI(e.fragment):""}`}}const Gd=new qd;function Yd(e){return e.segments.map(e=>eh(e)).join("/")}function Xd(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Kd(e){return Xd(e).replace(/%3B/gi,";")}function Zd(e){return Xd(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Jd(e){return decodeURIComponent(e)}function Qd(e){return Jd(e.replace(/\+/g,"%20"))}function eh(e){return`${Zd(e.path)}${t=e.parameters,Object.keys(t).map(e=>`;${Zd(e)}=${Zd(t[e])}`).join("")}`;var t}const th=/^[^\/()?;=#]+/;function nh(e){const t=e.match(th);return t?t[0]:""}const rh=/^[^=?&#]+/,ih=/^[^?&#]+/;class ah{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new zd([],{}):new zd([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n.primary=new zd(e,t)),n}parseSegment(){const e=nh(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new Ud(Jd(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=nh(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=nh(this.remaining);e&&(n=e,this.capture(n))}e[Jd(t)]=Jd(n)}parseQueryParam(e){const t=function(e){const t=e.match(rh);return t?t[0]:""}(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=function(e){const t=e.match(ih);return t?t[0]:""}(this.remaining);e&&(n=e,this.capture(n))}const r=Qd(t),i=Qd(n);if(e.hasOwnProperty(r)){let t=e[r];Array.isArray(t)||(t=[t],e[r]=t),t.push(i)}else e[r]=i}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=nh(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error(`Cannot parse url '${this.url}'`);let i=void 0;n.indexOf(":")>-1?(i=n.substr(0,n.indexOf(":")),this.capture(i),this.capture(":")):e&&(i=Id);const a=this.parseChildren();t[i]=1===Object.keys(a).length?a.primary:new zd([],a),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class oh{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=sh(e,this._root);return t?t.children.map(e=>e.value):[]}firstChild(e){const t=sh(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=lh(e,this._root);return t.length<2?[]:t[t.length-2].children.map(e=>e.value).filter(t=>t!==e)}pathFromRoot(e){return lh(e,this._root).map(e=>e.value)}}function sh(e,t){if(e===t.value)return t;for(const n of t.children){const t=sh(e,n);if(t)return t}return null}function lh(e,t){if(e===t.value)return[t];for(const n of t.children){const r=lh(e,n);if(r.length)return r.unshift(t),r}return[]}class uh{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function ch(e){const t={};return e&&e.children.forEach(e=>t[e.value.outlet]=e),t}class dh extends oh{constructor(e,t){super(e),this.snapshot=t,vh(this,e)}toString(){return this.snapshot.toString()}}function hh(e,t){const n=function(e,t){const n=new mh([],{},{},"",{},Id,t,null,e.root,-1,{});return new gh("",new uh(n,[]))}(e,t),r=new bc([new Ud("",{})]),i=new bc({}),a=new bc({}),o=new bc({}),s=new bc(""),l=new fh(r,i,o,s,a,Id,t,n.root);return l.snapshot=n.root,new dh(new uh(l,[]),n)}class fh{constructor(e,t,n,r,i,a,o,s){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=a,this.component=o,this._futureSnapshot=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(De(e=>Od(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(De(e=>Od(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function ph(e,t="emptyOnly"){const n=e.pathFromRoot;let r=0;if("always"!==t)for(r=n.length-1;r>=1;){const e=n[r],t=n[r-1];if(e.routeConfig&&""===e.routeConfig.path)r--;else{if(t.component)break;r--}}return function(e){return e.reduce((e,t)=>({params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(r))}class mh{constructor(e,t,n,r,i,a,o,s,l,u,c){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=a,this.component=o,this.routeConfig=s,this._urlSegment=l,this._lastPathIndex=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Od(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Od(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(e=>e.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class gh extends oh{constructor(e,t){super(t),this.url=e,vh(this,t)}toString(){return yh(this._root)}}function vh(e,t){t.value._routerState=e,t.children.forEach(t=>vh(e,t))}function yh(e){const t=e.children.length>0?` { ${e.children.map(yh).join(", ")} } `:"";return`${e.value}${t}`}function bh(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Nd(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),Nd(t.params,n.params)||e.params.next(n.params),function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Nd(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),Nd(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function xh(e,t){var n,r;return Nd(e.params,t.params)&&Hd(n=e.url,r=t.url)&&n.every((e,t)=>Nd(e.parameters,r[t].parameters))&&!(!e.parent!=!t.parent)&&(!e.parent||xh(e.parent,t.parent))}function wh(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function _h(e,t,n,r,i){let a={};return r&&Pd(r,(e,t)=>{a[t]=Array.isArray(e)?e.map(e=>""+e):""+e}),new $d(n.root===e?t:function e(t,n,r){const i={};return Pd(t.children,(t,a)=>{i[a]=t===n?r:e(t,n,r)}),new zd(t.segments,i)}(n.root,e,t),a,i)}class kh{constructor(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&wh(n[0]))throw new Error("Root segment cannot have matrix parameters");const r=n.find(e=>"object"==typeof e&&null!=e&&e.outlets);if(r&&r!==Rd(n))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Eh{constructor(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}}function Sh(e){return"object"==typeof e&&null!=e&&e.outlets?e.outlets.primary:""+e}function Th(e,t,n){if(e||(e=new zd([],{})),0===e.segments.length&&e.hasChildren())return Ch(e,t,n);const r=function(e,t,n){let r=0,i=t;const a={match:!1,pathIndex:0,commandIndex:0};for(;i<e.segments.length;){if(r>=n.length)return a;const t=e.segments[i],o=Sh(n[r]),s=r<n.length-1?n[r+1]:null;if(i>0&&void 0===o)break;if(o&&s&&"object"==typeof s&&void 0===s.outlets){if(!Dh(o,s,t))return a;r+=2}else{if(!Dh(o,{},t))return a;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(e,t,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const t=new zd(e.segments.slice(0,r.pathIndex),{});return t.children.primary=new zd(e.segments.slice(r.pathIndex),e.children),Ch(t,0,i)}return r.match&&0===i.length?new zd(e.segments,{}):r.match&&!e.hasChildren()?Ih(e,t,n):r.match?Ch(e,0,i):Ih(e,t,n)}function Ch(e,t,n){if(0===n.length)return new zd(e.segments,{});{const r=function(e){return"object"==typeof e[0]&&null!==e[0]&&e[0].outlets?e[0].outlets:{[Id]:e}}(n),i={};return Pd(r,(n,r)=>{null!==n&&(i[r]=Th(e.children[r],t,n))}),Pd(e.children,(e,t)=>{void 0===r[t]&&(i[t]=e)}),new zd(e.segments,i)}}function Ih(e,t,n){const r=e.segments.slice(0,t);let i=0;for(;i<n.length;){if("object"==typeof n[i]&&null!==n[i]&&void 0!==n[i].outlets){const e=Ah(n[i].outlets);return new zd(r,e)}if(0===i&&wh(n[0])){r.push(new Ud(e.segments[t].path,n[0])),i++;continue}const a=Sh(n[i]),o=i<n.length-1?n[i+1]:null;a&&o&&wh(o)?(r.push(new Ud(a,Oh(o))),i+=2):(r.push(new Ud(a,{})),i++)}return new zd(r,{})}function Ah(e){const t={};return Pd(e,(e,n)=>{null!==e&&(t[n]=Ih(new zd([],{}),0,e))}),t}function Oh(e){const t={};return Pd(e,(e,n)=>t[n]=""+e),t}function Dh(e,t,n){return e==n.path&&Nd(t,n.parameters)}class Mh{constructor(e,t,n,r){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=r}activate(e){const t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),bh(this.futureState.root),this.activateChildRoutes(t,n,e)}deactivateChildRoutes(e,t,n){const r=ch(t);e.children.forEach(e=>{const t=e.value.outlet;this.deactivateRoutes(e,r[t],n),delete r[t]}),Pd(r,(e,t)=>{this.deactivateRouteAndItsChildren(e,n)})}deactivateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(r===i)if(r.component){const i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(e,t,i.children)}else this.deactivateChildRoutes(e,t,n);else i&&this.deactivateRouteAndItsChildren(t,n)}deactivateRouteAndItsChildren(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const n=t.getContext(e.value.outlet);if(n&&n.outlet){const t=n.outlet.detach(),r=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:t,route:e,contexts:r})}}deactivateRouteAndOutlet(e,t){const n=t.getContext(e.value.outlet);if(n){const r=ch(e),i=e.value.component?n.children:t;Pd(r,(e,t)=>this.deactivateRouteAndItsChildren(e,i)),n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated())}}activateChildRoutes(e,t,n){const r=ch(t);e.children.forEach(e=>{this.activateRoutes(e,r[e.value.outlet],n),this.forwardEvent(new Td(e.value.snapshot))}),e.children.length&&this.forwardEvent(new Ed(e.value.snapshot))}activateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(bh(r),r===i)if(r.component){const i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,i.children)}else this.activateChildRoutes(e,t,n);else if(r.component){const t=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const e=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),t.children.onOutletReAttached(e.contexts),t.attachRef=e.componentRef,t.route=e.route.value,t.outlet&&t.outlet.attach(e.componentRef,e.route.value),Nh(e.route)}else{const n=function(e){for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig;if(e&&e.component)return null}return null}(r.snapshot),i=n?n.module.componentFactoryResolver:null;t.attachRef=null,t.route=r,t.resolver=i,t.outlet&&t.outlet.activateWith(r,i),this.activateChildRoutes(e,null,t.children)}}else this.activateChildRoutes(e,null,n)}}function Nh(e){bh(e.value),e.children.forEach(Nh)}class jh{constructor(e,t){this.routes=e,this.module=t}}function Fh(e){return"function"==typeof e}function Rh(e){return e instanceof $d}const Ph=Symbol("INITIAL_VALUE");function Lh(){return Vc(e=>function(...e){let t=void 0,n=void 0;return Oe(e[e.length-1])&&(n=e.pop()),"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&fe(e[0])&&(e=e[0]),Xe(e,n).lift(new Ec(t))}(...e.map(e=>e.pipe(Yc(1),function(...e){const t=e[e.length-1];return Oe(t)?(e.pop(),n=>Zc(e,n,t)):t=>Zc(e,t)}(Ph)))).pipe(function(e,t){let n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new Jc(e,t,n))}}((e,t)=>{let n=!1;return t.reduce((e,r,i)=>{if(e!==Ph)return e;if(r===Ph&&(n=!0),!n){if(!1===r)return r;if(i===t.length-1||Rh(r))return r}return e},e)},Ph),Dc(e=>e!==Ph),De(e=>Rh(e)?e:!0===e),Yc(1)))}class Bh{constructor(e){this.segmentGroup=e||null}}class $h{constructor(e){this.urlTree=e}}function zh(e){return new ke(t=>t.error(new Bh(e)))}function Uh(e){return new ke(t=>t.error(new $h(e)))}function Hh(e){return new ke(t=>t.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${e}'`)))}class Wh{constructor(e,t,n,r,i){this.configLoader=t,this.urlSerializer=n,this.urlTree=r,this.config=i,this.allowRedirects=!0,this.ngModule=e.get(en)}apply(){return this.expandSegmentGroup(this.ngModule,this.config,this.urlTree.root,Id).pipe(De(e=>this.createUrlTree(e,this.urlTree.queryParams,this.urlTree.fragment))).pipe(ed(e=>{if(e instanceof $h)return this.allowRedirects=!1,this.match(e.urlTree);if(e instanceof Bh)throw this.noMatchError(e);throw e}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,Id).pipe(De(t=>this.createUrlTree(t,e.queryParams,e.fragment))).pipe(ed(e=>{if(e instanceof Bh)throw this.noMatchError(e);throw e}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,n){const r=e.segments.length>0?new zd([],{[Id]:e}):e;return new $d(r,t,n)}expandSegmentGroup(e,t,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(e,t,n).pipe(De(e=>new zd([],e))):this.expandSegment(e,n,t,n.segments,r,!0)}expandChildren(e,t,n){return function(e,t){if(0===Object.keys(e).length)return yc({});const n=[],r=[],i={};return Pd(e,(e,a)=>{const o=t(a,e).pipe(De(e=>i[a]=e));a===Id?n.push(o):r.push(o)}),yc.apply(null,n.concat(r)).pipe(Oc(),function(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Dc((t,n)=>e(t,n,r)):_e,Fc(1),n?Uc(t):Lc(()=>new Tc))}(),De(()=>i))}(n.children,(n,r)=>this.expandSegmentGroup(e,t,r,n))}expandSegment(e,t,n,r,i,a){return yc(...n).pipe(rd(o=>this.expandSegmentAgainstRoute(e,t,n,o,r,i,a).pipe(ed(e=>{if(e instanceof Bh)return yc(null);throw e}))),id(e=>!!e),ed((e,n)=>{if(e instanceof Tc||"EmptyError"===e.name){if(this.noLeftoversInUrl(t,r,i))return yc(new zd([],{}));throw new Bh(t)}throw e}))}noLeftoversInUrl(e,t,n){return 0===t.length&&!e.children[n]}expandSegmentAgainstRoute(e,t,n,r,i,a,o){return Yh(r)!==a?zh(t):void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,i):o&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,a):zh(t)}expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,a){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,r,a):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,a)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,n,r){const i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?Uh(i):this.lineralizeSegments(n,i).pipe(Ve(n=>{const i=new zd(n,{});return this.expandSegment(e,i,t,n,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,a){const{matched:o,consumedSegments:s,lastChild:l,positionalParamSegments:u}=Vh(t,r,i);if(!o)return zh(t);const c=this.applyRedirectCommands(s,r.redirectTo,u);return r.redirectTo.startsWith("/")?Uh(c):this.lineralizeSegments(r,c).pipe(Ve(r=>this.expandSegment(e,t,n,r.concat(i.slice(l)),a,!1)))}matchSegmentAgainstRoute(e,t,n,r){if("**"===n.path)return n.loadChildren?this.configLoader.load(e.injector,n).pipe(De(e=>(n._loadedConfig=e,new zd(r,{})))):yc(new zd(r,{}));const{matched:i,consumedSegments:a,lastChild:o}=Vh(t,n,r);if(!i)return zh(t);const s=r.slice(o);return this.getChildConfig(e,n,r).pipe(Ve(e=>{const n=e.module,r=e.routes,{segmentGroup:i,slicedSegments:o}=function(e,t,n,r){return n.length>0&&function(e,t,n){return n.some(n=>Gh(e,t,n)&&Yh(n)!==Id)}(e,n,r)?{segmentGroup:qh(new zd(t,function(e,t){const n={};n.primary=t;for(const r of e)""===r.path&&Yh(r)!==Id&&(n[Yh(r)]=new zd([],{}));return n}(r,new zd(n,e.children)))),slicedSegments:[]}:0===n.length&&function(e,t,n){return n.some(n=>Gh(e,t,n))}(e,n,r)?{segmentGroup:qh(new zd(e.segments,function(e,t,n,r){const i={};for(const a of n)Gh(e,t,a)&&!r[Yh(a)]&&(i[Yh(a)]=new zd([],{}));return Object.assign(Object.assign({},r),i)}(e,n,r,e.children))),slicedSegments:n}:{segmentGroup:e,slicedSegments:n}}(t,a,s,r);return 0===o.length&&i.hasChildren()?this.expandChildren(n,r,i).pipe(De(e=>new zd(a,e))):0===r.length&&0===o.length?yc(new zd(a,{})):this.expandSegment(n,i,r,o,Id,!0).pipe(De(e=>new zd(a.concat(e.segments),e.children)))}))}getChildConfig(e,t,n){return t.children?yc(new jh(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?yc(t._loadedConfig):this.runCanLoadGuards(e.injector,t,n).pipe(Ve(n=>n?this.configLoader.load(e.injector,t).pipe(De(e=>(t._loadedConfig=e,e))):function(e){return new ke(t=>t.error(Dd(`Cannot load children because the guard of the route "path: '${e.path}'" returned false`)))}(t))):yc(new jh([],e))}runCanLoadGuards(e,t,n){const r=t.canLoad;return r&&0!==r.length?yc(r.map(r=>{const i=e.get(r);let a;if(function(e){return e&&Fh(e.canLoad)}(i))a=i.canLoad(t,n);else{if(!Fh(i))throw new Error("Invalid CanLoad guard");a=i(t,n)}return Ld(a)})).pipe(Lh(),od(e=>{if(!Rh(e))return;const t=Dd(`Redirecting to "${this.urlSerializer.serialize(e)}"`);throw t.url=e,t}),De(e=>!0===e)):yc(!0)}lineralizeSegments(e,t){let n=[],r=t.root;for(;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return yc(n);if(r.numberOfChildren>1||!r.children.primary)return Hh(e.redirectTo);r=r.children.primary}}applyRedirectCommands(e,t,n){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,n)}applyRedirectCreatreUrlTree(e,t,n,r){const i=this.createSegmentGroup(e,t.root,n,r);return new $d(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const n={};return Pd(e,(e,r)=>{if("string"==typeof e&&e.startsWith(":")){const i=e.substring(1);n[r]=t[i]}else n[r]=e}),n}createSegmentGroup(e,t,n,r){const i=this.createSegments(e,t.segments,n,r);let a={};return Pd(t.children,(t,i)=>{a[i]=this.createSegmentGroup(e,t,n,r)}),new zd(i,a)}createSegments(e,t,n,r){return t.map(t=>t.path.startsWith(":")?this.findPosParam(e,t,r):this.findOrReturn(t,n))}findPosParam(e,t,n){const r=n[t.path.substring(1)];if(!r)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return r}findOrReturn(e,t){let n=0;for(const r of t){if(r.path===e.path)return t.splice(n),r;n++}return e}}function Vh(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}:{matched:!0,consumedSegments:[],lastChild:0,positionalParamSegments:{}};const r=(t.matcher||Md)(n,e,t);return r?{matched:!0,consumedSegments:r.consumed,lastChild:r.consumed.length,positionalParamSegments:r.posParams}:{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}}function qh(e){if(1===e.numberOfChildren&&e.children.primary){const t=e.children.primary;return new zd(e.segments.concat(t.segments),t.children)}return e}function Gh(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0!==n.redirectTo}function Yh(e){return e.outlet||Id}class Xh{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class Kh{constructor(e,t){this.component=e,this.route=t}}function Zh(e,t,n){const r=e._root;return function e(t,n,r,i,a={canDeactivateChecks:[],canActivateChecks:[]}){const o=ch(n);return t.children.forEach(t=>{!function(t,n,r,i,a={canDeactivateChecks:[],canActivateChecks:[]}){const o=t.value,s=n?n.value:null,l=r?r.getContext(t.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){const u=function(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!Hd(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Hd(e.url,t.url)||!Nd(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!xh(e,t)||!Nd(e.queryParams,t.queryParams);case"paramsChange":default:return!xh(e,t)}}(s,o,o.routeConfig.runGuardsAndResolvers);u?a.canActivateChecks.push(new Xh(i)):(o.data=s.data,o._resolvedData=s._resolvedData),e(t,n,o.component?l?l.children:null:r,i,a),u&&l&&l.outlet&&l.outlet.isActivated&&a.canDeactivateChecks.push(new Kh(l.outlet.component,s))}else s&&Qh(n,l,a),a.canActivateChecks.push(new Xh(i)),e(t,null,o.component?l?l.children:null:r,i,a)}(t,o[t.value.outlet],r,i.concat([t.value]),a),delete o[t.value.outlet]}),Pd(o,(e,t)=>Qh(e,r.getContext(t),a)),a}(r,t?t._root:null,n,[r.value])}function Jh(e,t,n){const r=function(e){if(!e)return null;for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig}return null}(t);return(r?r.module.injector:n).get(e)}function Qh(e,t,n){const r=ch(e),i=e.value;Pd(r,(e,r)=>{Qh(e,i.component?t?t.children.getContext(r):null:t,n)}),n.canDeactivateChecks.push(new Kh(i.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,i))}function ef(e,t){return null!==e&&t&&t(new Sd(e)),yc(!0)}function tf(e,t){return null!==e&&t&&t(new kd(e)),yc(!0)}function nf(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;return r&&0!==r.length?yc(r.map(r=>Ac(()=>{const i=Jh(r,t,n);let a;if(function(e){return e&&Fh(e.canActivate)}(i))a=Ld(i.canActivate(t,e));else{if(!Fh(i))throw new Error("Invalid CanActivate guard");a=Ld(i(t,e))}return a.pipe(id())}))).pipe(Lh()):yc(!0)}function rf(e,t,n){const r=t[t.length-1],i=t.slice(0,t.length-1).reverse().map(e=>function(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(e)).filter(e=>null!==e).map(t=>Ac(()=>yc(t.guards.map(i=>{const a=Jh(i,t.node,n);let o;if(function(e){return e&&Fh(e.canActivateChild)}(a))o=Ld(a.canActivateChild(r,e));else{if(!Fh(a))throw new Error("Invalid CanActivateChild guard");o=Ld(a(r,e))}return o.pipe(id())})).pipe(Lh())));return yc(i).pipe(Lh())}class af{}class of{constructor(e,t,n,r,i,a){this.rootComponentType=e,this.config=t,this.urlTree=n,this.url=r,this.paramsInheritanceStrategy=i,this.relativeLinkResolution=a}recognize(){try{const e=uf(this.urlTree.root,[],[],this.config,this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,Id),n=new mh([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Id,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new uh(n,t),i=new gh(this.url,r);return this.inheritParamsAndData(i._root),yc(i)}catch(e){return new ke(t=>t.error(e))}}inheritParamsAndData(e){const t=e.value,n=ph(t,this.paramsInheritanceStrategy);t.params=Object.freeze(n.params),t.data=Object.freeze(n.data),e.children.forEach(e=>this.inheritParamsAndData(e))}processSegmentGroup(e,t,n){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,n)}processChildren(e,t){const n=Wd(t,(t,n)=>this.processSegmentGroup(e,t,n));return function(e){const t={};e.forEach(e=>{const n=t[e.value.outlet];if(n){const t=n.url.map(e=>e.toString()).join("/"),r=e.value.url.map(e=>e.toString()).join("/");throw new Error(`Two segments cannot have the same outlet name: '${t}' and '${r}'.`)}t[e.value.outlet]=e.value})}(n),n.sort((e,t)=>e.value.outlet===Id?-1:t.value.outlet===Id?1:e.value.outlet.localeCompare(t.value.outlet)),n}processSegment(e,t,n,r){for(const a of e)try{return this.processSegmentAgainstRoute(a,t,n,r)}catch(i){if(!(i instanceof af))throw i}if(this.noLeftoversInUrl(t,n,r))return[];throw new af}noLeftoversInUrl(e,t,n){return 0===t.length&&!e.children[n]}processSegmentAgainstRoute(e,t,n,r){if(e.redirectTo)throw new af;if((e.outlet||Id)!==r)throw new af;let i,a=[],o=[];if("**"===e.path){const a=n.length>0?Rd(n).parameters:{};i=new mh(n,a,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,hf(e),r,e.component,e,sf(t),lf(t)+n.length,ff(e))}else{const s=function(e,t,n){if(""===t.path){if("full"===t.pathMatch&&(e.hasChildren()||n.length>0))throw new af;return{consumedSegments:[],lastChild:0,parameters:{}}}const r=(t.matcher||Md)(n,e,t);if(!r)throw new af;const i={};Pd(r.posParams,(e,t)=>{i[t]=e.path});const a=r.consumed.length>0?Object.assign(Object.assign({},i),r.consumed[r.consumed.length-1].parameters):i;return{consumedSegments:r.consumed,lastChild:r.consumed.length,parameters:a}}(t,e,n);a=s.consumedSegments,o=n.slice(s.lastChild),i=new mh(a,s.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,hf(e),r,e.component,e,sf(t),lf(t)+a.length,ff(e))}const s=function(e){return e.children?e.children:e.loadChildren?e._loadedConfig.routes:[]}(e),{segmentGroup:l,slicedSegments:u}=uf(t,a,o,s,this.relativeLinkResolution);if(0===u.length&&l.hasChildren()){const e=this.processChildren(s,l);return[new uh(i,e)]}if(0===s.length&&0===u.length)return[new uh(i,[])];const c=this.processSegment(s,l,u,Id);return[new uh(i,c)]}}function sf(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function lf(e){let t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift?t._segmentIndexShift:0;return n-1}function uf(e,t,n,r,i){if(n.length>0&&function(e,t,n){return n.some(n=>cf(e,t,n)&&df(n)!==Id)}(e,n,r)){const i=new zd(t,function(e,t,n,r){const i={};i.primary=r,r._sourceSegment=e,r._segmentIndexShift=t.length;for(const a of n)if(""===a.path&&df(a)!==Id){const n=new zd([],{});n._sourceSegment=e,n._segmentIndexShift=t.length,i[df(a)]=n}return i}(e,t,r,new zd(n,e.children)));return i._sourceSegment=e,i._segmentIndexShift=t.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(e,t,n){return n.some(n=>cf(e,t,n))}(e,n,r)){const a=new zd(e.segments,function(e,t,n,r,i,a){const o={};for(const s of r)if(cf(e,n,s)&&!i[df(s)]){const n=new zd([],{});n._sourceSegment=e,n._segmentIndexShift="legacy"===a?e.segments.length:t.length,o[df(s)]=n}return Object.assign(Object.assign({},i),o)}(e,t,n,r,e.children,i));return a._sourceSegment=e,a._segmentIndexShift=t.length,{segmentGroup:a,slicedSegments:n}}const a=new zd(e.segments,e.children);return a._sourceSegment=e,a._segmentIndexShift=t.length,{segmentGroup:a,slicedSegments:n}}function cf(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0===n.redirectTo}function df(e){return e.outlet||Id}function hf(e){return e.data||{}}function ff(e){return e.resolve||{}}function pf(e){return function(t){return t.pipe(Vc(t=>{const n=e(t);return n?ze(n).pipe(De(()=>t)):ze([t])}))}}class mf extends class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}let gf=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=pn({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,t){1&e&&Mo(0,"router-outlet")},directives:function(){return[Of]},encapsulation:2}),e})();function vf(e,t=""){for(let n=0;n<e.length;n++){const r=e[n];yf(r,bf(t,r))}}function yf(e,t){if(!e)throw new Error(`\n      Invalid configuration of route '${t}': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    `);if(Array.isArray(e))throw new Error(`Invalid configuration of route '${t}': Array cannot be specified`);if(!e.component&&!e.children&&!e.loadChildren&&e.outlet&&e.outlet!==Id)throw new Error(`Invalid configuration of route '${t}': a componentless route without children or loadChildren cannot have a named outlet set`);if(e.redirectTo&&e.children)throw new Error(`Invalid configuration of route '${t}': redirectTo and children cannot be used together`);if(e.redirectTo&&e.loadChildren)throw new Error(`Invalid configuration of route '${t}': redirectTo and loadChildren cannot be used together`);if(e.children&&e.loadChildren)throw new Error(`Invalid configuration of route '${t}': children and loadChildren cannot be used together`);if(e.redirectTo&&e.component)throw new Error(`Invalid configuration of route '${t}': redirectTo and component cannot be used together`);if(e.path&&e.matcher)throw new Error(`Invalid configuration of route '${t}': path and matcher cannot be used together`);if(void 0===e.redirectTo&&!e.component&&!e.children&&!e.loadChildren)throw new Error(`Invalid configuration of route '${t}'. One of the following must be provided: component, redirectTo, children or loadChildren`);if(void 0===e.path&&void 0===e.matcher)throw new Error(`Invalid configuration of route '${t}': routes must have either a path or a matcher specified`);if("string"==typeof e.path&&"/"===e.path.charAt(0))throw new Error(`Invalid configuration of route '${t}': path cannot start with a slash`);if(""===e.path&&void 0!==e.redirectTo&&void 0===e.pathMatch)throw new Error(`Invalid configuration of route '{path: "${t}", redirectTo: "${e.redirectTo}"}': please provide 'pathMatch'. The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'.`);if(void 0!==e.pathMatch&&"full"!==e.pathMatch&&"prefix"!==e.pathMatch)throw new Error(`Invalid configuration of route '${t}': pathMatch can only be set to 'prefix' or 'full'`);e.children&&vf(e.children,t)}function bf(e,t){return t?e||t.path?e&&!t.path?e+"/":!e&&t.path?t.path:`${e}/${t.path}`:"":e}function xf(e){const t=e.children&&e.children.map(xf),n=t?Object.assign(Object.assign({},e),{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&n.outlet!==Id&&(n.component=gf),n}const wf=new Bt("ROUTES");class _f{constructor(e,t,n,r){this.loader=e,this.compiler=t,this.onLoadStartListener=n,this.onLoadEndListener=r}load(e,t){return this.onLoadStartListener&&this.onLoadStartListener(t),this.loadModuleFactory(t.loadChildren).pipe(De(n=>{this.onLoadEndListener&&this.onLoadEndListener(t);const r=n.create(e);return new jh(Fd(r.injector.get(wf)).map(xf),r)}))}loadModuleFactory(e){return"string"==typeof e?ze(this.loader.load(e)):Ld(e()).pipe(Ve(e=>e instanceof tn?yc(e):ze(this.compiler.compileModuleAsync(e))))}}class kf{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Ef,this.attachRef=null}}class Ef{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const n=this.getOrCreateContext(e);n.outlet=t,this.contexts.set(e,n)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new kf,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}class Sf{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function Tf(e){throw e}function Cf(e,t,n){return t.parse("/")}function If(e,t){return yc(null)}let Af=(()=>{class e{constructor(e,t,n,r,i,a,o,s){this.rootComponentType=e,this.urlSerializer=t,this.rootContexts=n,this.location=r,this.config=s,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.lastLocationChangeInfo=null,this.navigationId=0,this.isNgZoneEnabled=!1,this.events=new Ie,this.errorHandler=Tf,this.malformedUriErrorHandler=Cf,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:If,afterPreactivation:If},this.urlHandlingStrategy=new Sf,this.routeReuseStrategy=new mf,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="legacy",this.ngModule=i.get(en),this.console=i.get(xl);const l=i.get(Nl);this.isNgZoneEnabled=l instanceof Nl,this.resetConfig(s),this.currentUrlTree=new $d(new zd([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new _f(a,o,e=>this.triggerEvent(new wd(e)),e=>this.triggerEvent(new _d(e))),this.routerState=hh(this.currentUrlTree,this.rootComponentType),this.transitions=new bc({id:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}setupNavigations(e){const t=this.events;return e.pipe(Dc(e=>0!==e.id),De(e=>Object.assign(Object.assign({},e),{extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl)})),Vc(e=>{let n=!1,r=!1;return yc(e).pipe(od(e=>{this.currentNavigation={id:e.id,initialUrl:e.currentRawUrl,extractedUrl:e.extractedUrl,trigger:e.source,extras:e.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Vc(e=>{const n=!this.navigated||e.extractedUrl.toString()!==this.browserUrlTree.toString();if(("reload"===this.onSameUrlNavigation||n)&&this.urlHandlingStrategy.shouldProcessUrl(e.rawUrl))return yc(e).pipe(Vc(e=>{const n=this.transitions.getValue();return t.next(new hd(e.id,this.serializeUrl(e.extractedUrl),e.source,e.restoredState)),n!==this.transitions.getValue()?Cc:[e]}),Vc(e=>Promise.resolve(e)),(r=this.ngModule.injector,i=this.configLoader,a=this.urlSerializer,o=this.config,function(e){return e.pipe(Vc(e=>function(e,t,n,r,i){return new Wh(e,t,n,r,i).apply()}(r,i,a,e.extractedUrl,o).pipe(De(t=>Object.assign(Object.assign({},e),{urlAfterRedirects:t})))))}),od(e=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:e.urlAfterRedirects})}),function(e,t,n,r,i){return function(a){return a.pipe(Ve(a=>function(e,t,n,r,i="emptyOnly",a="legacy"){return new of(e,t,n,r,i,a).recognize()}(e,t,a.urlAfterRedirects,n(a.urlAfterRedirects),r,i).pipe(De(e=>Object.assign(Object.assign({},a),{targetSnapshot:e})))))}}(this.rootComponentType,this.config,e=>this.serializeUrl(e),this.paramsInheritanceStrategy,this.relativeLinkResolution),od(e=>{"eager"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(e.urlAfterRedirects,!!e.extras.replaceUrl,e.id,e.extras.state),this.browserUrlTree=e.urlAfterRedirects)}),od(e=>{const n=new gd(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.next(n)}));var r,i,a,o;if(n&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:n,extractedUrl:r,source:i,restoredState:a,extras:o}=e,s=new hd(n,this.serializeUrl(r),i,a);t.next(s);const l=hh(r,this.rootComponentType).snapshot;return yc(Object.assign(Object.assign({},e),{targetSnapshot:l,urlAfterRedirects:r,extras:Object.assign(Object.assign({},o),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=e.rawUrl,this.browserUrlTree=e.urlAfterRedirects,e.resolve(null),Cc}),pf(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:a,replaceUrl:o}}=e;return this.hooks.beforePreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!a,replaceUrl:!!o})}),od(e=>{const t=new vd(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),De(e=>Object.assign(Object.assign({},e),{guards:Zh(e.targetSnapshot,e.currentSnapshot,this.rootContexts)})),function(e,t){return function(n){return n.pipe(Ve(n=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:a,canDeactivateChecks:o}}=n;return 0===o.length&&0===a.length?yc(Object.assign(Object.assign({},n),{guardsResult:!0})):function(e,t,n,r){return ze(e).pipe(Ve(e=>function(e,t,n,r,i){const a=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return a&&0!==a.length?yc(a.map(a=>{const o=Jh(a,t,i);let s;if(function(e){return e&&Fh(e.canDeactivate)}(o))s=Ld(o.canDeactivate(e,t,n,r));else{if(!Fh(o))throw new Error("Invalid CanDeactivate guard");s=Ld(o(e,t,n,r))}return s.pipe(id())})).pipe(Lh()):yc(!0)}(e.component,e.route,n,t,r)),id(e=>!0!==e,!0))}(o,r,i,e).pipe(Ve(n=>n&&"boolean"==typeof n?function(e,t,n,r){return ze(t).pipe(rd(t=>ze([tf(t.route.parent,r),ef(t.route,r),rf(e,t.path,n),nf(e,t.route,n)]).pipe(Oc(),id(e=>!0!==e,!0))),id(e=>!0!==e,!0))}(r,a,e,t):yc(n)),De(e=>Object.assign(Object.assign({},n),{guardsResult:e})))}))}}(this.ngModule.injector,e=>this.triggerEvent(e)),od(e=>{if(Rh(e.guardsResult)){const t=Dd(`Redirecting to "${this.serializeUrl(e.guardsResult)}"`);throw t.url=e.guardsResult,t}}),od(e=>{const t=new yd(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot,!!e.guardsResult);this.triggerEvent(t)}),Dc(e=>{if(!e.guardsResult){this.resetUrlToCurrentUrlTree();const n=new pd(e.id,this.serializeUrl(e.extractedUrl),"");return t.next(n),e.resolve(!1),!1}return!0}),pf(e=>{if(e.guards.canActivateChecks.length)return yc(e).pipe(od(e=>{const t=new bd(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),Vc(e=>{let n=!1;return yc(e).pipe((r=this.paramsInheritanceStrategy,i=this.ngModule.injector,function(e){return e.pipe(Ve(e=>{const{targetSnapshot:t,guards:{canActivateChecks:n}}=e;if(!n.length)return yc(e);let a=0;return ze(n).pipe(rd(e=>function(e,t,n,r){return function(e,t,n,r){const i=Object.keys(e);if(0===i.length)return yc({});const a={};return ze(i).pipe(Ve(i=>function(e,t,n,r){const i=Jh(e,t,r);return Ld(i.resolve?i.resolve(t,n):i(t,n))}(e[i],t,n,r).pipe(od(e=>{a[i]=e}))),Fc(1),Ve(()=>Object.keys(a).length===i.length?yc(a):Cc))}(e._resolve,e,t,r).pipe(De(t=>(e._resolvedData=t,e.data=Object.assign(Object.assign({},e.data),ph(e,n).resolve),null)))}(e.route,t,r,i)),od(()=>a++),Fc(1),Ve(t=>a===n.length?yc(e):Cc))}))}),od({next:()=>n=!0,complete:()=>{if(!n){const n=new pd(e.id,this.serializeUrl(e.extractedUrl),"At least one route resolver didn't emit any value.");t.next(n),e.resolve(!1)}}}));var r,i}),od(e=>{const t=new xd(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}))}),pf(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:a,replaceUrl:o}}=e;return this.hooks.afterPreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!a,replaceUrl:!!o})}),De(e=>{const t=function(e,t,n){const r=function e(t,n,r){if(r&&t.shouldReuseRoute(n.value,r.value.snapshot)){const i=r.value;i._futureSnapshot=n.value;const a=function(t,n,r){return n.children.map(n=>{for(const i of r.children)if(t.shouldReuseRoute(i.value.snapshot,n.value))return e(t,n,i);return e(t,n)})}(t,n,r);return new uh(i,a)}{const r=t.retrieve(n.value);if(r){const e=r.route;return function e(t,n){if(t.value.routeConfig!==n.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(t.children.length!==n.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");n.value._futureSnapshot=t.value;for(let r=0;r<t.children.length;++r)e(t.children[r],n.children[r])}(n,e),e}{const r=new fh(new bc((i=n.value).url),new bc(i.params),new bc(i.queryParams),new bc(i.fragment),new bc(i.data),i.outlet,i.component,i),a=n.children.map(n=>e(t,n));return new uh(r,a)}}var i}(e,t._root,n?n._root:void 0);return new dh(r,t)}(this.routeReuseStrategy,e.targetSnapshot,e.currentRouterState);return Object.assign(Object.assign({},e),{targetRouterState:t})}),od(e=>{this.currentUrlTree=e.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl),this.routerState=e.targetRouterState,"deferred"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,!!e.extras.replaceUrl,e.id,e.extras.state),this.browserUrlTree=e.urlAfterRedirects)}),(a=this.rootContexts,o=this.routeReuseStrategy,s=e=>this.triggerEvent(e),De(e=>(new Mh(o,e.targetRouterState,e.currentRouterState,s).activate(a),e))),od({next(){n=!0},complete(){n=!0}}),(i=()=>{if(!n&&!r){this.resetUrlToCurrentUrlTree();const n=new pd(e.id,this.serializeUrl(e.extractedUrl),`Navigation ID ${e.id} is not equal to the current navigation id ${this.navigationId}`);t.next(n),e.resolve(!1)}this.currentNavigation=null},e=>e.lift(new ud(i))),ed(n=>{if(r=!0,(i=n)&&i.ngNavigationCancelingError){const r=Rh(n.url);r||(this.navigated=!0,this.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl));const i=new pd(e.id,this.serializeUrl(e.extractedUrl),n.message);t.next(i),r?setTimeout(()=>{const t=this.urlHandlingStrategy.merge(n.url,this.rawUrlTree);return this.scheduleNavigation(t,"imperative",null,{skipLocationChange:e.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy},{resolve:e.resolve,reject:e.reject,promise:e.promise})},0):e.resolve(!1)}else{this.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl);const r=new md(e.id,this.serializeUrl(e.extractedUrl),n);t.next(r);try{e.resolve(this.errorHandler(n))}catch(a){e.reject(a)}}var i;return Cc}));var i,a,o,s}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}getTransition(){const e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const t=this.extractLocationChangeInfoFromEvent(e);this.shouldScheduleNavigation(this.lastLocationChangeInfo,t)&&setTimeout(()=>{const{source:e,state:n,urlTree:r}=t,i={replaceUrl:!0};if(n){const e=Object.assign({},n);delete e.navigationId,0!==Object.keys(e).length&&(i.state=e)}this.scheduleNavigation(r,e,n,i)},0),this.lastLocationChangeInfo=t}))}extractLocationChangeInfoFromEvent(e){var t;return{source:"popstate"===e.type?"popstate":"hashchange",urlTree:this.parseUrl(e.url),state:(null===(t=e.state)||void 0===t?void 0:t.navigationId)?e.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(e,t){if(!e)return!0;const n=t.urlTree.toString()===e.urlTree.toString();return!(t.transitionId===e.transitionId&&n&&("hashchange"===t.source&&"popstate"===e.source||"popstate"===t.source&&"hashchange"===e.source))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){vf(e),this.config=e.map(xf),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0)}createUrlTree(e,t={}){const{relativeTo:n,queryParams:r,fragment:i,preserveQueryParams:a,queryParamsHandling:o,preserveFragment:s}=t;mi()&&a&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead.");const l=n||this.routerState.root,u=s?this.currentUrlTree.fragment:i;let c=null;if(o)switch(o){case"merge":c=Object.assign(Object.assign({},this.currentUrlTree.queryParams),r);break;case"preserve":c=this.currentUrlTree.queryParams;break;default:c=r||null}else c=a?this.currentUrlTree.queryParams:r||null;return null!==c&&(c=this.removeEmptyProps(c)),function(e,t,n,r,i){if(0===n.length)return _h(t.root,t.root,t,r,i);const a=function(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new kh(!0,0,e);let t=0,n=!1;const r=e.reduce((e,r,i)=>{if("object"==typeof r&&null!=r){if(r.outlets){const t={};return Pd(r.outlets,(e,n)=>{t[n]="string"==typeof e?e.split("/"):e}),[...e,{outlets:t}]}if(r.segmentPath)return[...e,r.segmentPath]}return"string"!=typeof r?[...e,r]:0===i?(r.split("/").forEach((r,i)=>{0==i&&"."===r||(0==i&&""===r?n=!0:".."===r?t++:""!=r&&e.push(r))}),e):[...e,r]},[]);return new kh(n,t,r)}(n);if(a.toRoot())return _h(t.root,new zd([],{}),t,r,i);const o=function(e,t,n){if(e.isAbsolute)return new Eh(t.root,!0,0);if(-1===n.snapshot._lastPathIndex){const e=n.snapshot._urlSegment;return new Eh(e,e===t.root,0)}const r=wh(e.commands[0])?0:1;return function(e,t,n){let r=e,i=t,a=n;for(;a>i;){if(a-=i,r=r.parent,!r)throw new Error("Invalid number of '../'");i=r.segments.length}return new Eh(r,!1,i-a)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+r,e.numberOfDoubleDots)}(a,t,e),s=o.processChildren?Ch(o.segmentGroup,o.index,a.commands):Th(o.segmentGroup,o.index,a.commands);return _h(o.segmentGroup,s,t,r,i)}(l,this.currentUrlTree,e,c,u)}navigateByUrl(e,t={skipLocationChange:!1}){mi()&&this.isNgZoneEnabled&&!Nl.isInAngularZone()&&this.console.warn("Navigation triggered outside Angular zone, did you forget to call 'ngZone.run()'?");const n=Rh(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,t)}navigate(e,t={skipLocationChange:!1}){return function(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${t}`)}}(e),this.navigateByUrl(this.createUrlTree(e,t),t)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let t;try{t=this.urlSerializer.parse(e)}catch(n){t=this.malformedUriErrorHandler(n,this.urlSerializer,e)}return t}isActive(e,t){if(Rh(e))return Bd(this.currentUrlTree,e,t);const n=this.parseUrl(e);return Bd(this.currentUrlTree,n,t)}removeEmptyProps(e){return Object.keys(e).reduce((t,n)=>{const r=e[n];return null!=r&&(t[n]=r),t},{})}processNavigations(){this.navigations.subscribe(e=>{this.navigated=!0,this.lastSuccessfulId=e.id,this.events.next(new fd(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.currentNavigation=null,e.resolve(!0)},e=>{this.console.warn("Unhandled Navigation Error: ")})}scheduleNavigation(e,t,n,r,i){const a=this.getTransition(),o="imperative"!==t&&"imperative"===(null==a?void 0:a.source),s=(this.lastSuccessfulId===a.id||this.currentNavigation?a.rawUrl:a.urlAfterRedirects).toString()===e.toString();if(o&&s)return Promise.resolve(!0);let l,u,c;i?(l=i.resolve,u=i.reject,c=i.promise):c=new Promise((e,t)=>{l=e,u=t});const d=++this.navigationId;return this.setTransition({id:d,source:t,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:r,resolve:l,reject:u,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(e=>Promise.reject(e))}setBrowserUrl(e,t,n,r){const i=this.urlSerializer.serialize(e);r=r||{},this.location.isCurrentPathEqualTo(i)||t?this.location.replaceState(i,"",Object.assign(Object.assign({},r),{navigationId:n})):this.location.go(i,"",Object.assign(Object.assign({},r),{navigationId:n}))}resetStateAndUrl(e,t,n){this.routerState=e,this.currentUrlTree=t,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n),this.resetUrlToCurrentUrlTree()}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",{navigationId:this.lastSuccessfulId})}}return e.\u0275fac=function(t){return new(t||e)(Kt(Ja),Kt(Vd),Kt(Ef),Kt(Su),Kt(fo),Kt(eu),Kt(Ol),Kt(void 0))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})(),Of=(()=>{class e{constructor(e,t,n,r,i){this.parentContexts=e,this.location=t,this.resolver=n,this.changeDetector=i,this.activated=null,this._activatedRoute=null,this.activateEvents=new Zs,this.deactivateEvents=new Zs,this.name=r||Id,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,e}attach(e,t){this.activated=e,this._activatedRoute=t,this.location.insert(e.hostView)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,t){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;const n=(t=t||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,i=new Df(e,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,i),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(t){return new(t||e)(Co(Ef),Co(Is),Co(ts),("name",function(e,t){const n=e.attrs;if(n){const e=n.length;let r=0;for(;r<e;){const i=n[r];if(Rr(i))break;if(0===i)r+=2;else if("number"==typeof i)for(r++;r<e&&"string"==typeof n[r];)r++;else{if(i===t)return n[r+1];r+=2}}}return null}(ir(),"name")),Co(Ka))},e.\u0275dir=xn({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),e})();class Df{constructor(e,t,n){this.route=e,this.childContexts=t,this.parent=n}get(e,t){return e===fh?this.route:e===Ef?this.childContexts:this.parent.get(e,t)}}class Mf{}class Nf{preload(e,t){return yc(null)}}let jf=(()=>{class e{constructor(e,t,n,r,i){this.router=e,this.injector=r,this.preloadingStrategy=i,this.loader=new _f(t,n,t=>e.triggerEvent(new wd(t)),t=>e.triggerEvent(new _d(t)))}setUpPreloading(){this.subscription=this.router.events.pipe(Dc(e=>e instanceof fd),rd(()=>this.preload())).subscribe(()=>{})}preload(){const e=this.injector.get(en);return this.processRoutes(e,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,t){const n=[];for(const r of t)if(r.loadChildren&&!r.canLoad&&r._loadedConfig){const e=r._loadedConfig;n.push(this.processRoutes(e.module,e.routes))}else r.loadChildren&&!r.canLoad?n.push(this.preloadConfig(e,r)):r.children&&n.push(this.processRoutes(e,r.children));return ze(n).pipe(Ye(),De(e=>{}))}preloadConfig(e,t){return this.preloadingStrategy.preload(t,()=>this.loader.load(e.injector,t).pipe(Ve(e=>(t._loadedConfig=e,this.processRoutes(e.module,e.routes)))))}}return e.\u0275fac=function(t){return new(t||e)(Kt(Af),Kt(eu),Kt(Ol),Kt(fo),Kt(Mf))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})(),Ff=(()=>{class e{constructor(e,t,n={}){this.router=e,this.viewportScroller=t,this.options=n,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},n.scrollPositionRestoration=n.scrollPositionRestoration||"disabled",n.anchorScrolling=n.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof hd?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof fd&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof Cd&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,t){this.router.triggerEvent(new Cd(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,t))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(Kt(Af),Kt(zu),Kt(void 0))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();const Rf=new Bt("ROUTER_CONFIGURATION"),Pf=new Bt("ROUTER_FORROOT_GUARD"),Lf=[Su,{provide:Vd,useClass:qd},{provide:Af,useFactory:function(e,t,n,r,i,a,o,s={},l,u){const c=new Af(null,e,t,n,r,i,a,Fd(o));if(l&&(c.urlHandlingStrategy=l),u&&(c.routeReuseStrategy=u),s.errorHandler&&(c.errorHandler=s.errorHandler),s.malformedUriErrorHandler&&(c.malformedUriErrorHandler=s.malformedUriErrorHandler),s.enableTracing){const e=uu();c.events.subscribe(t=>{e.logGroup("Router Event: "+t.constructor.name),e.log(t.toString()),e.log(t),e.logGroupEnd()})}return s.onSameUrlNavigation&&(c.onSameUrlNavigation=s.onSameUrlNavigation),s.paramsInheritanceStrategy&&(c.paramsInheritanceStrategy=s.paramsInheritanceStrategy),s.urlUpdateStrategy&&(c.urlUpdateStrategy=s.urlUpdateStrategy),s.relativeLinkResolution&&(c.relativeLinkResolution=s.relativeLinkResolution),c},deps:[Vd,Ef,Su,fo,eu,Ol,wf,Rf,[class{},new st],[class{},new st]]},Ef,{provide:fh,useFactory:function(e){return e.routerState.root},deps:[Af]},{provide:eu,useClass:ru},jf,Nf,class{preload(e,t){return t().pipe(ed(()=>yc(null)))}},{provide:Rf,useValue:{enableTracing:!1}}];function Bf(){return new Gl("Router",Af)}let $f=(()=>{class e{constructor(e,t){}static forRoot(t,n){return{ngModule:e,providers:[Lf,Wf(t),{provide:Pf,useFactory:Hf,deps:[[Af,new st,new ut]]},{provide:Rf,useValue:n||{}},{provide:xu,useFactory:Uf,deps:[du,[new ot(_u),new st],Rf]},{provide:Ff,useFactory:zf,deps:[Af,zu,Rf]},{provide:Mf,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:Nf},{provide:Gl,multi:!0,useFactory:Bf},[Vf,{provide:hl,multi:!0,useFactory:qf,deps:[Vf]},{provide:Yf,useFactory:Gf,deps:[Vf]},{provide:bl,multi:!0,useExisting:Yf}]]}}static forChild(t){return{ngModule:e,providers:[Wf(t)]}}}return e.\u0275mod=yn({type:e}),e.\u0275inj=ft({factory:function(t){return new(t||e)(Kt(Pf,8),Kt(Af,8))}}),e})();function zf(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new Ff(e,t,n)}function Uf(e,t,n={}){return n.useHash?new Eu(e,t):new ku(e,t)}function Hf(e){if(e)throw new Error("RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function Wf(e){return[{provide:po,multi:!0,useValue:e},{provide:wf,multi:!0,useValue:e}]}let Vf=(()=>{class e{constructor(e){this.injector=e,this.initNavigation=!1,this.resultOfPreactivationDone=new Ie}appInitializer(){return this.injector.get(fu,Promise.resolve(null)).then(()=>{let e=null;const t=new Promise(t=>e=t),n=this.injector.get(Af),r=this.injector.get(Rf);if(this.isLegacyDisabled(r)||this.isLegacyEnabled(r))e(!0);else if("disabled"===r.initialNavigation)n.setUpLocationChangeListener(),e(!0);else{if("enabled"!==r.initialNavigation)throw new Error(`Invalid initialNavigation options: '${r.initialNavigation}'`);n.hooks.afterPreactivation=()=>this.initNavigation?yc(null):(this.initNavigation=!0,e(!0),this.resultOfPreactivationDone),n.initialNavigation()}return t})}bootstrapListener(e){const t=this.injector.get(Rf),n=this.injector.get(jf),r=this.injector.get(Ff),i=this.injector.get(Af),a=this.injector.get(Jl);e===a.components[0]&&(this.isLegacyEnabled(t)?i.initialNavigation():this.isLegacyDisabled(t)&&i.setUpLocationChangeListener(),n.setUpPreloading(),r.init(),i.resetRootComponentType(a.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}isLegacyEnabled(e){return"legacy_enabled"===e.initialNavigation||!0===e.initialNavigation||void 0===e.initialNavigation}isLegacyDisabled(e){return"legacy_disabled"===e.initialNavigation||!1===e.initialNavigation}}return e.\u0275fac=function(t){return new(t||e)(Kt(fo))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();function qf(e){return e.appInitializer.bind(e)}function Gf(e){return e.bootstrapListener.bind(e)}const Yf=new Bt("Router Initializer"),Xf=[];let Kf=(()=>{class e{}return e.\u0275mod=yn({type:e}),e.\u0275inj=ft({factory:function(t){return new(t||e)},imports:[[$f.forRoot(Xf)],$f]}),e})();function Zf(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(t){a(t)}}function s(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((r=r.apply(e,t||[])).next())}))}var Jf=n("rNSh"),Qf=n("Nm83"),ep=n("gdl2"),tp=n("5q2q"),np=n("bkNj"),rp=n("W6+N"),ip=n("23LK"),ap=n("yLV6"),op=n.n(ap);const sp=e=>{const t=Math.ceil(e.reduce((e,t)=>Math.max(e,t.x),0)),n=Math.floor(e.reduce((e,t)=>Math.min(e,t.x),Number.MAX_VALUE)),r=t-n,i=Math.ceil(e.reduce((e,t)=>Math.max(e,t.y),0)),a=Math.floor(e.reduce((e,t)=>Math.min(e,t.y),Number.MAX_VALUE));return{top:a,bottom:i,left:n,right:t,width:r,height:i-a}},lp=(e,t)=>{const n=t({x:e.left,y:e.top}),r=t({x:e.right,y:e.bottom}),i=Math.floor(n.x),a=Math.ceil(r.x),o=Math.floor(n.y),s=Math.ceil(r.y);return{left:i,right:a,top:o,bottom:s,height:s-o,width:a-i}},up=(e,t)=>void 0!==e&&void 0!==t&&e.length===t.length&&t.every((t,n)=>{const r=e[n];return t.x===r.x&&t.y===r.y}),cp=tp,dp=ep,hp=Qf,fp=rp,pp=np,mp=ip;var gp=function(e){return e.Pan="Pan",e.FreehandRoi="FreehandRoi",e.Probe="Probe",e.Zoom="Zoom",e.Wwwc="Wwwc",e.StackScrollMouseWheel="StackScrollMouseWheel",e}({});const vp={[gp.Pan]:cp.PanTool,[gp.FreehandRoi]:cp.FreehandRoiTool,[gp.Probe]:cp.ProbeTool,[gp.Zoom]:cp.ZoomTool,[gp.Wwwc]:cp.WwwcTool,[gp.StackScrollMouseWheel]:cp.StackScrollMouseWheelTool},yp=e=>vp[e];window.getToolFromName=yp;let bp=(()=>{class e{constructor(){function e(e){const t=window.URL||window.webkitURL,n=new Blob([`importScripts('${e}')`],{type:"application/javascript"});return t.createObjectURL(n)}this.cornerstoneTools=tp,this.cornerstone=ep,this.cornerstoneMath=pp,this.pointInFreehand=cp.import("util/freehandUtils").pointInFreehand,this.pointInFreehand2=(e,t,n)=>{let r=!1;const i=null!=n?n:sp(e);if(t.x<i.left||t.x>i.right||t.y<i.top||t.y>i.bottom)return!1;for(let a=0,o=e.length-1;a<e.length;o=a++)e[a].y>t.y!=e[o].y>t.y&&t.x<(e[o].x-e[a].x)*(t.y-e[a].y)/(e[o].y-e[a].y)+e[a].x&&(r=!r);return r},this.pointInFreehandCached=(e,t)=>{let n=!1;const r=[];for(let i=0,a=e.length-1;i<e.length;a=i++)r.push((e[a].x-e[i].x)/(e[a].y-e[i].y)),e[i].y>t.y!=e[a].y>t.y&&t.x<(e[a].x-e[i].x)*(t.y-e[i].y)/(e[a].y-e[i].y)+e[i].x&&(n=!n);for(let i=0,a=e.length-1;i<e.length;a=i++)e[i].y>t.y!=e[a].y>t.y&&t.x<r[i]*(t.y-e[i].y)+e[i].x&&(n=!n);return n},this.lineInFreehand=(e,t,n)=>{const r=Array(t.length),i=Array(t.length),a=Array(n.length).map(e=>!1);for(let o=0,s=t.length-1;o<t.length;s=o++)r[o]=(t[s].x-t[o].x)*(e-t[o].y)/(t[s].y-t[o].y)+t[o].x,i[o]=t[o].y>e!=t[s].y>e;for(let o=0;o<t.length;o++){const e=i[o],t=r[o];n.forEach((n,r)=>{e&&n<t&&(a[r]=!a[r])})}return a},this.calculateScaleRatio=(e,t)=>{let n,r;return n=e instanceof HTMLElement?dp.getViewport(e):e,r=t instanceof HTMLElement?dp.getViewport(t):t,r.displayedArea.columnPixelSpacing/n.displayedArea.columnPixelSpacing},this.buildTranslatePoints=(e,t,n)=>{const r=dp.getViewport(e),i=dp.getViewport(t),a=this.calculateScaleRatio(r,i),o=n(e,t);return e=>({x:(e.x-o.dx-i.displayedArea.brhc.x/2)*a+r.displayedArea.brhc.x/2,y:(e.y-o.dy-i.displayedArea.brhc.y/2)*a+r.displayedArea.brhc.y/2})},this.panZoomSynchronizer=(e,t)=>(n,r,i)=>{if(i===r)return;const a=dp.getViewport(r),o=dp.getViewport(i),s=this.calculateScaleRatio(a,o),l=e.getElement().id===r.id,u=(a.translation.x-(l?e.dx:t.dx))/s+(l?t.dx:e.dx),c=(a.translation.y-(l?e.dy:t.dy))/s+(l?t.dy:e.dy);o.scale===a.scale*s&&o.translation.x===u&&o.translation.y===c||(o.scale=a.scale*s,o.translation.x=u,o.translation.y=c,n.setViewport(i,o))},this.freehandRoiSynchronizer=e=>(t,n,r,i)=>{n.focus(),this.syncronizeRois(e,n,r)},this.syncronizeRois=(e,t,n)=>{var r,i;if(t===n)return;const a=cp.getToolForElement(n,gp.FreehandRoi);if("disabled"===a.mode||"enabled"===a.mode)return;const o=null===(r=cp.getToolState(n,gp.FreehandRoi))||void 0===r?void 0:r.data,s=null===(i=cp.getToolState(t,gp.FreehandRoi))||void 0===i?void 0:i.data;if(!e.shouldSynchronize()){if(s)for(const n of s)(n.area>.1||n.canComplete)&&e.onUpdateCompleted(n,t);return}const l=this.buildTranslatePoints(n,t,e.getTranslation),u=e=>Object.assign(Object.assign({},e),l(e)),c=(t,n)=>{console.log("addData");const r=dp.getImage(t),i=e.getImageVisibility(t);for(const e of n){console.log(e,i);const n=Object.assign(Object.assign({},e),{visible:e.area<.1||i});n.handles=Object.assign({},n.handles),n.handles.points=n.handles.points.map(u),cp.addToolState(t,gp.FreehandRoi,n),(n.canComplete||e.area>.1)&&a.updateCachedStats(r,t,n)}dp.updateImage(t)};if(o||s){if(o)if(s){console.log("different");const r=e.getImageVisibility(n);for(const i of s)if(e.didChangeRoi(i,t)){const a=o.find(e=>e.uuid===i.uuid);void 0!==a&&cp.removeToolState(n,gp.FreehandRoi,a);const s=Object.assign(Object.assign({},i),{visible:i.area<.1||r});s.handles=Object.assign({},s.handles),s.handles.points=s.handles.points.map(u),cp.addToolState(n,gp.FreehandRoi,s),s.canComplete||i.area>.1?(e.onUpdateCompleted(s,n),e.onUpdateCompleted(i,t)):i.visible=!0;break}dp.updateImage(n)}else console.log("source more"),c(t,o);else console.log("target more"),c(n,s);cp.getToolForElement(n,gp.FreehandRoi)._configuration.mouseLocation.handles.start=Object.assign({},cp.getToolForElement(t,gp.FreehandRoi)),dp.updateImage(t),dp.updateImage(n)}},this.createRoiData=(e,t,n)=>({active:!1,area:10,canComplete:!1,handles:{invalidHandlePlacement:!1,points:t.map(e=>Object.assign({active:!1,highlight:!1,lines:[]},e)),textBox:{active:!1,allowedOutsideImage:!1,drawnIndependently:!0,hasMoved:!1,movesIndependently:!1}},highlight:!1,invalidated:!1,meanStdDev:{count:100,mean:300,stdDev:10,variance:20},unit:"",uuid:e,visible:n,polyBoundingBox:sp(t)}),this.stackImageIndexSynchronizer=(e,t,n,r)=>{if(n===t)return;const i=cp.getToolState(t,"stack").data[0],a=cp.getToolState(n,"stack").data[0];let o=i.currentImageIdIndex-r;if(console.log(r,o),o=Math.min(Math.max(o,0),a.imageIds.length-1),o===a.currentImageIdIndex)return;const s=cp.loadHandlerManager,l=s.getStartLoadHandler(n),u=s.getEndLoadHandler(n),c=s.getErrorLoadingHandler(n);let d;l&&l(n),d=!0===a.preventCache?dp.loadImage(a.imageIds[o]):dp.loadAndCacheImage(a.imageIds[o]),d.then(t=>{const r=dp.getViewport(n);a.currentImageIdIndex=o,e.displayImage(n,t,r),u&&u(n,t)},e=>{c&&c(n,a.imageIds[o],e)})},fp.external.cornerstone=dp,cp.external.cornerstone=dp,cp.external.cornerstoneMath=pp,cp.external.Hammer=op.a,cp.init(),hp.external.cornerstone=dp,hp.external.dicomParser=Jf,mp.external.cornerstone=dp,console.log(cp),console.log(dp),console.log(pp),window.cornerstone=dp,window.cornerstoneTools=cp,window.cornerstoneMath=pp,window.cornerstoneNIFTIImageLoader=fp,window.cornerstoneWADOImageLoader=hp,window.cornerstoneWebImageLoader=mp,e("https://unpkg.com/cornerstone-wado-image-loader@2.2.4/dist/cornerstoneWADOImageLoaderWebWorker.min.js"),e("https://unpkg.com/cornerstone-wado-image-loader@2.2.4/dist/cornerstoneWADOImageLoaderCodecs.js");const t={webWorkerPath:document.location.href+"assets/cornerstoneWADOImageLoaderWebWorker.min.js",taskConfiguration:{decodeTask:{codecsPath:document.location.href+"assets/cornerstoneWADOImageLoaderCodecs.js"}}};hp.webWorkerManager.initialize(t),mp.configure({beforeSend:()=>{}}),dp.registerUnknownImageLoader(mp.loadImage)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ht({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class xp{constructor(e,{isLeft:t}){this.loading=!1,this.loaded=!1,this.visible=!0,this.opacity=.7,this.angle=0,this.dx=0,this.dy=0,this.parsingResult=void 0,this.roiPointsByStack=[],this.currentStackIndex=()=>cp.getToolState(this.getElement(),"stack").data[0].currentImageIdIndex,this.translateOrRotate=e=>{var t,n,r,i,a;const o=this.getElement(),s=dp.getViewport(o);this.angle=null!==(t=e.angle)&&void 0!==t?t:s.rotation,this.dx=this.dx+(null!==(n=e.x)&&void 0!==n?n:0),this.dy=this.dy+(null!==(r=e.y)&&void 0!==r?r:0),s.rotation=this.angle,s.translation.x+=null!==(i=e.x)&&void 0!==i?i:0,s.translation.y+=null!==(a=e.y)&&void 0!==a?a:0,dp.setViewport(o,s),dp.updateImage(o)},this.currentStackPoints=e=>{if(void 0===e)try{e=this.currentStackIndex()}catch(t){return}return this.roiPointsByStack[e]},this.setPoints=(e,t)=>{let n=this.roiPointsByStack[e];n||(n={},this.roiPointsByStack[e]=n),n[t.uuid]={uuid:t.uuid,points:t.handles.points.map(e=>Object.assign({},e)),stats:Object.assign(Object.assign({},t.meanStdDev),{area:t.area})}},this.getRoiPixels=()=>{const e=this.currentStackPoints();return e?Object.entries(e).map(([e,{points:t}])=>{const n=sp(t);return{pixels:dp.getPixels(this.getElement(),n.left,n.top,n.width,n.height),bbox:n,points:t,uuid:e}}):[]},this.getData=(e,t)=>{let n;switch(e){case zqe.lastRoi:n=e=>e.uuid===t;break;case zqe.stackPosition:const e=this.currentStackPoints();n=t=>void 0!==e&&void 0!==e[t.uuid];break;case zqe.volume:n=e=>!0}return this.roiPointsByStack.flatMap(e=>Object.values(e)).filter(e=>void 0!==e.diffData&&n(e))},this.removeData=(e,t)=>{if(!this.loaded)return!1;let n=!1;switch(e){case zqe.lastRoi:if(void 0!==t)for(const r of this.roiPointsByStack)void 0!==r&&void 0!==r[t]&&(delete r[t],n=!0);break;case zqe.stackPosition:const e=this.currentStackIndex();n=void 0!==this.roiPointsByStack[e]&&Object.keys(this.roiPointsByStack[e]).length>0,this.roiPointsByStack[e]={};break;case zqe.volume:n=this.roiPointsByStack.length>0,this.roiPointsByStack=[]}return n&&(cp.clearToolState(this.getElement(),gp.FreehandRoi),dp.updateImage(this.getElement(),!0)),n},this.getElement=e,this.isLeft=t}}var wp,_p=function(e){return e.autumn="autumn",e.blues="blues",e.bone="bone",e.cool="cool",e.coolwarm="coolwarm",e.copper="copper",e.gray="gray",e.hot="hot",e.hotIron="hotIron",e.hotMetalBlue="hotMetalBlue",e.hsv="hsv",e.jet="jet",e.pet="pet",e.pet20Step="pet20Step",e.spectral="spectral",e.spring="spring",e.summer="summer",e.winter="winter",e}({}),kp=(wp=function(e,t){return(wp=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}wp(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Ep=Object.prototype.hasOwnProperty;function Sp(e,t){return Ep.call(e,t)}function Tp(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);for(var r in t=[],e)Sp(e,r)&&t.push(r);return t}function Cp(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Ip(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function Ap(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Op(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Dp(e,t){var n=[e];for(var r in t){var i="object"==typeof t[r]?JSON.stringify(t[r],null,2):t[r];void 0!==i&&n.push(r+": "+i)}return n.join("\n")}var Mp=function(e){function t(t,n,r,i,a){var o=this.constructor,s=e.call(this,Dp(t,{name:n,index:r,operation:i,tree:a}))||this;return s.name=n,s.index=r,s.operation=i,s.tree=a,Object.setPrototypeOf(s,o.prototype),s.message=Dp(t,{name:n,index:r,operation:i,tree:a}),s}return kp(t,e),t}(Error),Np=Mp,jp=Cp,Fp={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Pp(n,this.path);r&&(r=Cp(r));var i=Lp(n,{op:"remove",path:this.from}).removed;return Lp(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Pp(n,this.from);return Lp(n,{op:"add",path:this.path,value:Cp(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Hp(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},Rp={add:function(e,t,n){return Ip(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Fp.move,copy:Fp.copy,test:Fp.test,_get:Fp._get};function Pp(e,t){if(""==t)return e;var n={op:"_get",path:t};return Lp(e,n),n.value}function Lp(e,t,n,r,i,a){if(void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===i&&(i=!0),void 0===a&&(a=0),n&&("function"==typeof n?n(t,0,e,t.path):zp(t,0)),""===t.path){var o={newDocument:e};if("add"===t.op)return o.newDocument=t.value,o;if("replace"===t.op)return o.newDocument=t.value,o.removed=e,o;if("move"===t.op||"copy"===t.op)return o.newDocument=Pp(e,t.from),"move"===t.op&&(o.removed=e),o;if("test"===t.op){if(o.test=Hp(e,t.value),!1===o.test)throw new Np("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o.newDocument=e,o}if("remove"===t.op)return o.removed=e,o.newDocument=null,o;if("_get"===t.op)return t.value=e,o;if(n)throw new Np("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return o}r||(e=Cp(e));var s=(t.path||"").split("/"),l=e,u=1,c=s.length,d=void 0,h=void 0,f=void 0;for(f="function"==typeof n?n:zp;;){if(h=s[u],i&&"__proto__"==h)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===d&&(void 0===l[h]?d=s.slice(0,u).join("/"):u==c-1&&(d=t.path),void 0!==d&&f(t,0,e,d)),u++,Array.isArray(l)){if("-"===h)h=l.length;else{if(n&&!Ip(h))throw new Np("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);Ip(h)&&(h=~~h)}if(u>=c){if(n&&"add"===t.op&&h>l.length)throw new Np("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);if(!1===(o=Rp[t.op].call(t,l,h,e)).test)throw new Np("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}}else if(h&&-1!=h.indexOf("~")&&(h=Op(h)),u>=c){if(!1===(o=Fp[t.op].call(t,l,h,e)).test)throw new Np("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}l=l[h]}}function Bp(e,t,n,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=!0),n&&!Array.isArray(t))throw new Np("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Cp(e));for(var a=new Array(t.length),o=0,s=t.length;o<s;o++)a[o]=Lp(e,t[o],n,!0,i,o),e=a[o].newDocument;return a.newDocument=e,a}function $p(e,t,n){var r=Lp(e,t);if(!1===r.test)throw new Np("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function zp(e,t,n,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new Np("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!Fp[e.op])throw new Np("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new Np("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new Np('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new Np("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new Np("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&function e(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return!0}else if("object"==typeof t){var i=Tp(t),a=i.length;for(n=0;n<a;n++)if(e(t[i[n]]))return!0}return!1}(e.value))throw new Np("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var i=e.path.split("/").length,a=r.split("/").length;if(i!==a+1&&i!==a)throw new Np("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new Np("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var o=Up([{op:"_get",path:e.from,value:void 0}],n);if(o&&"OPERATION_PATH_UNRESOLVABLE"===o.name)throw new Np("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function Up(e,t,n){try{if(!Array.isArray(e))throw new Np("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Bp(Cp(t),Cp(e),n||!0);else{n=n||zp;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof Np)return i;throw i}}function Hp(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,i,a=Array.isArray(e),o=Array.isArray(t);if(a&&o){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!Hp(e[n],t[n]))return!1;return!0}if(a!=o)return!1;var s=Object.keys(e);if((r=s.length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!t.hasOwnProperty(s[n]))return!1;for(n=r;0!=n--;)if(!Hp(e[i=s[n]],t[i]))return!1;return!0}return e!=e&&t!=t}var Wp=new WeakMap,Vp=function(){return function(e){this.observers=new Map,this.obj=e}}(),qp=function(){return function(e,t){this.callback=e,this.observer=t}}();function Gp(e,t){t.unobserve()}function Yp(e,t){var n,r=function(e){return Wp.get(e)}(e);if(r){var i=function(e,t){return e.observers.get(t)}(r,t);n=i&&i.observer}else r=new Vp(e),Wp.set(e,r);if(n)return n;if(n={},r.value=Cp(e),t){n.callback=t,n.next=null;var a=function(){Xp(n)},o=function(){clearTimeout(n.next),n.next=setTimeout(a)};"undefined"!=typeof window&&(window.addEventListener("mouseup",o),window.addEventListener("keyup",o),window.addEventListener("mousedown",o),window.addEventListener("keydown",o),window.addEventListener("change",o))}return n.patches=[],n.object=e,n.unobserve=function(){Xp(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(r,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",o),window.removeEventListener("keyup",o),window.removeEventListener("mousedown",o),window.removeEventListener("keydown",o),window.removeEventListener("change",o))},r.observers.set(t,new qp(t,n)),n}function Xp(e,t){void 0===t&&(t=!1);var n=Wp.get(e.object);Kp(n.value,e.object,e.patches,"",t),e.patches.length&&Bp(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Kp(e,t,n,r,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=Tp(t),o=Tp(e),s=!1,l=o.length-1;l>=0;l--){var u=e[d=o[l]];if(!Sp(t,d)||void 0===t[d]&&void 0!==u&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+Ap(d),value:Cp(u)}),n.push({op:"remove",path:r+"/"+Ap(d)}),s=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var c=t[d];"object"==typeof u&&null!=u&&"object"==typeof c&&null!=c?Kp(u,c,n,r+"/"+Ap(d),i):u!==c&&(i&&n.push({op:"test",path:r+"/"+Ap(d),value:Cp(u)}),n.push({op:"replace",path:r+"/"+Ap(d),value:Cp(c)}))}}if(s||a.length!=o.length)for(l=0;l<a.length;l++){var d;Sp(e,d=a[l])||void 0===t[d]||n.push({op:"add",path:r+"/"+Ap(d),value:Cp(t[d])})}}}function Zp(e,t,n){void 0===n&&(n=!1);var r=[];return Kp(e,t,r,"",n),r}Object.assign({},r,i,{JsonPatchError:Mp,deepClone:Cp,escapePathComponent:Ap,unescapePathComponent:Op});var Jp=n("ZYJ9"),Qp=n.n(Jp),em=n("3cPs");function tm(e,t,n){return e.fields=t||[],e.fname=n,e}function nm(e){return null==e?null:e.fname}function rm(e){return null==e?null:e.fields}function im(e){return 1===e.length?am(e[0]):om(e)}const am=e=>function(t){return t[e]},om=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function sm(e){throw Error(e)}function lm(e){const t=[],n=e.length;let r,i,a,o=null,s=0,l="";function u(){t.push(l+e.substring(r,i)),l="",r=i+1}for(e+="",r=i=0;i<n;++i)if(a=e[i],"\\"===a)l+=e.substring(r,i),l+=e.substring(++i,++i),r=i;else if(a===o)u(),o=null,s=-1;else{if(o)continue;r===s&&'"'===a||r===s&&"'"===a?(r=i+1,o=a):"."!==a||s?"["===a?(i>r&&u(),s=r=i+1):"]"===a&&(s||sm("Access path missing open bracket: "+e),s>0&&u(),s=0,r=i+1):i>r?u():r=i+1}return s&&sm("Access path missing closing bracket: "+e),o&&sm("Access path missing closing quote: "+e),i>r&&(i++,u()),t}function um(e,t,n){const r=lm(e);return e=1===r.length?r[0]:e,tm((n&&n.get||im)(r),[e],t||e)}const cm=um("id"),dm=tm(e=>e,[],"identity"),hm=tm(()=>0,[],"zero"),fm=tm(()=>1,[],"one"),pm=tm(()=>!0,[],"true"),mm=tm(()=>!1,[],"false");function gm(e,t,n){const r=[t].concat([].slice.call(n));console[e].apply(console,r)}const vm=0,ym=1,bm=2,xm=3,wm=4;function _m(e,t){let n=e||vm;return{level(e){return arguments.length?(n=+e,this):n},error(){return n>=ym&&gm(t||"error","ERROR",arguments),this},warn(){return n>=bm&&gm(t||"warn","WARN",arguments),this},info(){return n>=xm&&gm(t||"log","INFO",arguments),this},debug(){return n>=wm&&gm(t||"log","DEBUG",arguments),this}}}var km=Array.isArray;function Em(e){return e===Object(e)}const Sm=e=>"__proto__"!==e;function Tm(...e){return e.reduce((e,t)=>{for(const n in t)"signals"===n?e.signals=Im(e.signals,t.signals):Cm(e,n,t[n],"legend"===n?{layout:1}:"style"===n||null);return e},{})}function Cm(e,t,n,r){if(!Sm(t))return;let i,a;if(Em(n)&&!km(n))for(i in a=Em(e[t])?e[t]:e[t]={},n)r&&(!0===r||r[i])?Cm(a,i,n[i]):Sm(i)&&(a[i]=n[i]);else e[t]=n}function Im(e,t){if(null==e)return t;const n={},r=[];function i(e){n[e.name]||(n[e.name]=1,r.push(e))}return t.forEach(i),e.forEach(i),r}function Am(e){return e[e.length-1]}function Om(e){return null==e||""===e?null:+e}const Dm=e=>t=>e*Math.exp(t),Mm=e=>t=>Math.log(e*t),Nm=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),jm=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,Fm=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function Rm(e,t,n,r){const i=n(e[0]),a=n(Am(e)),o=(a-i)*t;return[r(i-o),r(a-o)]}function Pm(e,t){return Rm(e,t,Om,dm)}function Lm(e,t){var n=Math.sign(e[0]);return Rm(e,t,Mm(n),Dm(n))}function Bm(e,t,n){return Rm(e,t,Fm(n),Fm(1/n))}function $m(e,t,n){return Rm(e,t,Nm(n),jm(n))}function zm(e,t,n,r,i){const a=r(e[0]),o=r(Am(e)),s=null!=t?r(t):(a+o)/2;return[i(s+(a-s)*n),i(s+(o-s)*n)]}function Um(e,t,n){return zm(e,t,n,Om,dm)}function Hm(e,t,n){const r=Math.sign(e[0]);return zm(e,t,n,Mm(r),Dm(r))}function Wm(e,t,n,r){return zm(e,t,n,Fm(r),Fm(1/r))}function Vm(e,t,n,r){return zm(e,t,n,Nm(r),jm(r))}function qm(e){return 1+~~(new Date(e).getMonth()/3)}function Gm(e){return 1+~~(new Date(e).getUTCMonth()/3)}function Ym(e){return null!=e?km(e)?e:[e]:[]}function Xm(e,t,n){let r,i=e[0],a=e[1];return a<i&&(r=a,a=i,i=r),r=a-i,r>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-r),i+r]}function Km(e){return"function"==typeof e}function Zm(e,t,n){n=n||{},t=Ym(t)||[];const r=[],i=[],a={},o=n.comparator||Qm;return Ym(e).forEach((e,o)=>{null!=e&&(r.push("descending"===t[o]?-1:1),i.push(e=Km(e)?e:um(e,null,n)),(rm(e)||[]).forEach(e=>a[e]=1))}),0===i.length?null:tm(o(i,r),Object.keys(a))}const Jm=(e,t)=>(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t==t?-1:t!=t&&e==e?1:0),Qm=(e,t)=>1===e.length?eg(e[0],t[0]):tg(e,t,e.length),eg=(e,t)=>function(n,r){return Jm(e(n),e(r))*t},tg=(e,t,n)=>(t.push(0),function(r,i){let a,o=0,s=-1;for(;0===o&&++s<n;)a=e[s],o=Jm(a(r),a(i));return o*t[s]});function ng(e){return Km(e)?e:()=>e}function rg(e,t){let n;return r=>{n&&clearTimeout(n),n=setTimeout(()=>(t(r),n=null),e)}}function ig(e){for(let t,n,r=1,i=arguments.length;r<i;++r)for(n in t=arguments[r],t)e[n]=t[n];return e}function ag(e,t){let n,r,i,a,o=0;if(e&&(n=e.length))if(null==t){for(r=e[o];o<n&&(null==r||r!=r);r=e[++o]);for(i=a=r;o<n;++o)r=e[o],null!=r&&(r<i&&(i=r),r>a&&(a=r))}else{for(r=t(e[o]);o<n&&(null==r||r!=r);r=t(e[++o]));for(i=a=r;o<n;++o)r=t(e[o]),null!=r&&(r<i&&(i=r),r>a&&(a=r))}return[i,a]}function og(e,t){const n=e.length;let r,i,a,o,s,l=-1;if(null==t){for(;++l<n;)if(i=e[l],null!=i&&i>=i){r=a=i;break}if(l===n)return[-1,-1];for(o=s=l;++l<n;)i=e[l],null!=i&&(r>i&&(r=i,o=l),a<i&&(a=i,s=l))}else{for(;++l<n;)if(i=t(e[l],l,e),null!=i&&i>=i){r=a=i;break}if(l===n)return[-1,-1];for(o=s=l;++l<n;)i=t(e[l],l,e),null!=i&&(r>i&&(r=i,o=l),a<i&&(a=i,s=l))}return[o,s]}const sg=Object.prototype.hasOwnProperty;function lg(e,t){return sg.call(e,t)}const ug={};function cg(e){let t,n={};function r(e){return lg(n,e)&&n[e]!==ug}const i={size:0,empty:0,object:n,has:r,get:e=>r(e)?n[e]:void 0,set(e,t){return r(e)||(++i.size,n[e]===ug&&--i.empty),n[e]=t,this},delete(e){return r(e)&&(--i.size,++i.empty,n[e]=ug),this},clear(){i.size=i.empty=0,i.object=n={}},test(e){return arguments.length?(t=e,i):t},clean(){const e={};let r=0;for(const i in n){const a=n[i];a===ug||t&&t(a)||(e[i]=a,++r)}i.size=r,i.empty=0,i.object=n=e}};return e&&Object.keys(e).forEach(t=>{i.set(t,e[t])}),i}function dg(e,t,n,r,i,a){if(!n&&0!==n)return a;const o=+n;let s,l=e[0],u=Am(e);u<l&&(s=l,l=u,u=s),s=Math.abs(t-l);const c=Math.abs(u-t);return s<c&&s<=o?r:c<=o?i:a}function hg(e,t,n){const r=e.prototype=Object.create(t.prototype);return r.constructor=e,ig(r,n)}function fg(e,t,n,r){let i,a=t[0],o=t[t.length-1];return a>o&&(i=a,a=o,o=i),r=void 0===r||r,((n=void 0===n||n)?a<=e:a<e)&&(r?e<=o:e<o)}function pg(e){return"boolean"==typeof e}function mg(e){return"[object Date]"===Object.prototype.toString.call(e)}function gg(e){return e&&Km(e[Symbol.iterator])}function vg(e){return"number"==typeof e}function yg(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function bg(e){return"string"==typeof e}function xg(e,t,n){e&&(e=t?Ym(e).map(e=>e.replace(/\\(.)/g,"$1")):Ym(e));const r=e&&e.length,i=n&&n.get||im,a=e=>i(t?[e]:lm(e));let o;if(r)if(1===r){const t=a(e[0]);o=function(e){return""+t(e)}}else{const t=e.map(a);o=function(e){let n=""+t[0](e),i=0;for(;++i<r;)n+="|"+t[i](e);return n}}else o=function(){return""};return tm(o,e,"key")}function wg(e,t){const n=e[0],r=Am(e),i=+t;return i?1===i?r:n+i*(r-n):n}function _g(e){let t,n,r;e=+e||1e4;const i=()=>{t={},n={},r=0},a=(i,a)=>(++r>e&&(n=t,t={},r=1),t[i]=a);return i(),{clear:i,has:e=>lg(t,e)||lg(n,e),get:e=>lg(t,e)?t[e]:lg(n,e)?a(e,n[e]):void 0,set:(e,n)=>lg(t,e)?t[e]=n:a(e,n)}}function kg(e,t,n,r){const i=t.length,a=n.length;if(!a)return t;if(!i)return n;const o=r||new t.constructor(i+a);let s=0,l=0,u=0;for(;s<i&&l<a;++u)o[u]=e(t[s],n[l])>0?n[l++]:t[s++];for(;s<i;++s,++u)o[u]=t[s];for(;l<a;++l,++u)o[u]=n[l];return o}function Eg(e,t){let n="";for(;--t>=0;)n+=e;return n}function Sg(e,t,n,r){const i=n||" ",a=e+"",o=t-a.length;return o<=0?a:"left"===r?Eg(i,o)+a:"center"===r?Eg(i,~~(o/2))+a+Eg(i,Math.ceil(o/2)):a+Eg(i,o)}function Tg(e){return e&&Am(e)-e[0]||0}function Cg(e){return km(e)?"["+e.map(Cg)+"]":Em(e)||bg(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function Ig(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e||!e)}const Ag=e=>vg(e)||mg(e)?e:Date.parse(e);function Og(e,t){return t=t||Ag,null==e||""===e?null:t(e)}function Dg(e){return null==e||""===e?null:e+""}function Mg(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function Ng(e,t,n,r){const i=null!=r?r:"\u2026",a=e+"",o=a.length,s=Math.max(0,t-i.length);return o<=t?a:"left"===n?i+a.slice(o-s):"center"===n?a.slice(0,Math.ceil(s/2))+i+a.slice(o-~~(s/2)):a.slice(0,s)+i}function jg(e,t,n){if(e)if(t){const r=e.length;for(let i=0;i<r;++i){const r=t(e[i]);r&&n(r,i,e)}}else e.forEach(n)}const Fg=/^([A-Za-z]+:)?\/\//,Rg=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,Pg=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,Lg="file://";async function Bg(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function $g(e,t){t=ig({},this.options,t);const n=this.fileAccess,r={href:null};let i,a,o;const s=Rg.test(e.replace(Pg,""));null!=e&&"string"==typeof e&&s||sm("Sanitize failure, invalid URI: "+Cg(e));const l=Fg.test(e);return(o=t.baseURL)&&!l&&(e.startsWith("/")||"/"===o[o.length-1]||(e="/"+e),e=o+e),a=(i=e.startsWith(Lg))||"file"===t.mode||"http"!==t.mode&&!l&&n,i?e=e.slice(Lg.length):e.startsWith("//")&&("file"===t.defaultProtocol?(e=e.slice(2),a=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!a}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),"image"===t.context&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function zg(e){return e?t=>new Promise((n,r)=>{e.readFile(t,(e,t)=>{e?r(e):n(t)})}):Ug}async function Ug(){sm("No file system access.")}function Hg(e){return e?async function(t,n){const r=ig({},this.options.http,n),i=n&&n.response,a=await e(t,r);return a.ok?Km(a[i])?a[i]():a.text():sm(a.status+""+a.statusText)}:Wg}async function Wg(){sm("No HTTP fetch method available.")}const Vg=e=>!(Number.isNaN(+e)||e instanceof Date),qg={boolean:Ig,integer:Om,number:Om,date:Og,string:Dg,unknown:dm},Gg=[e=>"true"===e||"false"===e||!0===e||!1===e,e=>Vg(e)&&Number.isInteger(+e),Vg,e=>!Number.isNaN(Date.parse(e))],Yg=["boolean","integer","number","date"];function Xg(e,t){if(!e||!e.length)return"unknown";const n=e.length,r=Gg.length,i=Gg.map((e,t)=>t+1);for(let o,s,l=0,u=0;l<n;++l)for(s=t?e[l][t]:e[l],o=0;o<r;++o)if(i[o]&&null!=(a=s)&&a==a&&!Gg[o](s)&&(i[o]=0,++u,u===Gg.length))return"string";var a;return Yg[i.reduce((e,t)=>0===e?t:e,0)-1]}function Kg(e,t){return t.reduce((t,n)=>(t[n]=Xg(e,n),t),{})}var Zg={},Jg={};function Qg(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function ev(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function tv(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function nv(e){const t=function(t,n){const r={delimiter:e};return rv(t,n?ig(n,r):r)};return t.responseType="text",t}function rv(e,t){return t.header&&(e=t.header.map(Cg).join(t.delimiter)+"\n"+e),function(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],a=e.length,o=0,s=0,l=a<=0,u=!1;function c(){if(l)return Jg;if(u)return u=!1,Zg;var t,r,i=o;if(34===e.charCodeAt(i)){for(;o++<a&&34!==e.charCodeAt(o)||34===e.charCodeAt(++o););return(t=o)>=a?l=!0:10===(r=e.charCodeAt(o++))?u=!0:13===r&&(u=!0,10===e.charCodeAt(o)&&++o),e.slice(i+1,t-1).replace(/""/g,'"')}for(;o<a;){if(10===(r=e.charCodeAt(t=o++)))u=!0;else if(13===r)u=!0,10===e.charCodeAt(o)&&++o;else if(r!==n)continue;return e.slice(i,t)}return l=!0,e.slice(i,a)}for(10===e.charCodeAt(a-1)&&--a,13===e.charCodeAt(a-1)&&--a;(r=c())!==Jg;){for(var d=[];r!==Zg&&r!==Jg;)d.push(r),r=c();t&&null==(d=t(d,s++))||i.push(d)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return o(t[e])})).join(e)}))}function a(t){return t.map(o).join(e)}function o(e){return null==e?"":e instanceof Date?(i=(n=e).getUTCHours(),a=n.getUTCMinutes(),o=n.getUTCSeconds(),s=n.getUTCMilliseconds(),isNaN(n)?"Invalid Date":((r=n.getUTCFullYear())<0?"-"+tv(-r,6):r>9999?"+"+tv(r,6):tv(r,4))+"-"+tv(n.getUTCMonth()+1,2)+"-"+tv(n.getUTCDate(),2)+(s?"T"+tv(i,2)+":"+tv(a,2)+":"+tv(o,2)+"."+tv(s,3)+"Z":o?"T"+tv(i,2)+":"+tv(a,2)+":"+tv(o,2)+"Z":a||i?"T"+tv(i,2)+":"+tv(a,2)+"Z":"")):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e;var n,r,i,a,o,s}return{parse:function(e,t){var n,i,a=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=Qg(e);return function(r,i){return t(n(r),i,e)}}(e,t):Qg(e)}));return a.columns=i||[],a},parseRows:r,format:function(t,n){return null==n&&(n=ev(t)),[n.map(o).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=ev(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(a).join("\n")},formatRow:a,formatValue:o}}(t.delimiter).parse(e+"")}function iv(e,t){const n=t&&t.property?um(t.property):dm;return!Em(e)||(r=e,"function"==typeof Buffer&&Km(Buffer.isBuffer)&&Buffer.isBuffer(r))?n(JSON.parse(e)):function(e,t){return!km(e)&&gg(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}(n(e),t);var r}rv.responseType="text",iv.responseType="json";var av=function(e){return e},ov=function(e,t){return"string"==typeof t&&(t=e.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return sv(e,t)}))}:sv(e,t)};function sv(e,t){var n=t.id,r=t.bbox,i=null==t.properties?{}:t.properties,a=lv(e,t);return null==n&&null==r?{type:"Feature",properties:i,geometry:a}:null==r?{type:"Feature",id:n,properties:i,geometry:a}:{type:"Feature",id:n,bbox:r,properties:i,geometry:a}}function lv(e,t){var n=function(e){if(null==e)return av;var t,n,r=e.scale[0],i=e.scale[1],a=e.translate[0],o=e.translate[1];return function(e,s){s||(t=n=0);var l=2,u=e.length,c=new Array(u);for(c[0]=(t+=e[0])*r+a,c[1]=(n+=e[1])*i+o;l<u;)c[l]=e[l],++l;return c}}(e.transform),r=e.arcs;function i(e,t){t.length&&t.pop();for(var i=r[e<0?~e:e],a=0,o=i.length;a<o;++a)t.push(n(i[a],a));e<0&&function(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n}(t,o)}function a(e){return n(e)}function o(e){for(var t=[],n=0,r=e.length;n<r;++n)i(e[n],t);return t.length<2&&t.push(t[0]),t}function s(e){for(var t=o(e);t.length<4;)t.push(t[0]);return t}function l(e){return e.map(s)}return function e(t){var n,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(e)};case"Point":n=a(t.coordinates);break;case"MultiPoint":n=t.coordinates.map(a);break;case"LineString":n=o(t.arcs);break;case"MultiLineString":n=t.arcs.map(o);break;case"Polygon":n=l(t.arcs);break;case"MultiPolygon":n=t.arcs.map(l);break;default:return null}return{type:r,coordinates:n}}(t)}var uv=function(e,t){var n={},r={},i={},a=[],o=-1;function s(e,t){for(var r in e){var i=e[r];delete t[i.start],delete i.start,delete i.end,i.forEach((function(e){n[e<0?~e:e]=1})),a.push(i)}}return t.forEach((function(n,r){var i,a=e.arcs[n<0?~n:n];a.length<3&&!a[1][0]&&!a[1][1]&&(i=t[++o],t[o]=n,t[r]=i)})),t.forEach((function(t){var n,a,o=function(t){var n,r=e.arcs[t<0?~t:t],i=r[0];return e.transform?(n=[0,0],r.forEach((function(e){n[0]+=e[0],n[1]+=e[1]}))):n=r[r.length-1],t<0?[n,i]:[i,n]}(t),s=o[0],l=o[1];if(n=i[s])if(delete i[n.end],n.push(t),n.end=l,a=r[l]){delete r[a.start];var u=a===n?n:n.concat(a);r[u.start=n.start]=i[u.end=a.end]=u}else r[n.start]=i[n.end]=n;else if(n=r[l])if(delete r[n.start],n.unshift(t),n.start=s,a=i[s]){delete i[a.end];var c=a===n?n:a.concat(n);r[c.start=a.start]=i[c.end=n.end]=c}else r[n.start]=i[n.end]=n;else r[(n=[t]).start=s]=i[n.end=l]=n})),s(i,r),s(r,i),t.forEach((function(e){n[e<0?~e:e]||a.push([e])})),a},cv=function(e){return lv(e,dv.apply(this,arguments))};function dv(e,t,n){var r,i,a;if(arguments.length>1)r=hv(0,t,n);else for(i=0,r=new Array(a=e.arcs.length);i<a;++i)r[i]=i;return{type:"MultiLineString",arcs:uv(e,r)}}function hv(e,t,n){var r,i=[],a=[];function o(e){var t=e<0?~e:e;(a[t]||(a[t]=[])).push({i:e,g:r})}function s(e){e.forEach(o)}function l(e){e.forEach(s)}return function e(t){switch(r=t,t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"LineString":s(t.arcs);break;case"MultiLineString":case"Polygon":l(t.arcs);break;case"MultiPolygon":!function(e){e.forEach(l)}(t.arcs)}}(t),a.forEach(null==n?function(e){i.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&i.push(e[0].i)}),i}const fv={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function pv(e,t){let n,r,i,a;return e=iv(e,t),t&&t.feature?(n=ov,i=t.feature):t&&t.mesh?(n=cv,i=t.mesh,a=fv[t.filter]):sm("Missing TopoJSON feature or mesh parameter."),r=(r=e.objects[i])?n(e,r,a):sm("Invalid TopoJSON object: "+i),r&&r.features||[r]}pv.responseType="json";const mv={dsv:rv,csv:nv(","),tsv:nv("\t"),json:iv,topojson:pv};function gv(e,t){return arguments.length>1?(mv[e]=t,this):lg(mv,e)?mv[e]:null}function vv(e){const t=gv(e);return t&&t.responseType||"text"}var yv=Math.sqrt(50),bv=Math.sqrt(10),xv=Math.sqrt(2),wv=function(e,t,n){var r,i,a,o,s=-1;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(o=_v(e,t,n))||!isFinite(o))return[];if(o>0)for(e=Math.ceil(e/o),t=Math.floor(t/o),a=new Array(i=Math.ceil(t-e+1));++s<i;)a[s]=(e+s)*o;else for(o=-o,e=Math.ceil(e*o),t=Math.floor(t*o),a=new Array(i=Math.ceil(t-e+1));++s<i;)a[s]=(e+s)/o;return r&&a.reverse(),a};function _v(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return i>=0?(a>=yv?10:a>=bv?5:a>=xv?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=yv?10:a>=bv?5:a>=xv?2:1)}function kv(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=yv?i*=10:a>=bv?i*=5:a>=xv&&(i*=2),t<e?-i:i}var Ev=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Sv(e){if(!(t=Ev.exec(e)))throw new Error("invalid format: "+e);var t;return new Tv({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function Tv(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function Cv(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}Sv.prototype=Tv.prototype,Tv.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Iv,Av,Ov,Dv,Mv=function(e){return(e=Cv(Math.abs(e)))?e[1]:NaN},Nv=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Mv(t)/3)))-Mv(Math.abs(e)))},jv=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Mv(t)-Mv(e))+1},Fv=function(e){return Math.max(0,-Mv(Math.abs(e)))},Rv=function(e,t){var n=Cv(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")},Pv={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Rv(100*e,t),r:Rv,s:function(e,t){var n=Cv(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(Iv=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+Cv(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)},Lv=function(e){return e},Bv=Array.prototype.map,$v=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"],zv=function(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?Lv:(t=Bv.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,a=[],o=0,s=t[0],l=0;i>0&&s>0&&(l+s+1>r&&(s=Math.max(1,r-l)),a.push(e.substring(i-=s,i+s)),!((l+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?Lv:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(Bv.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",u=void 0===e.minus?"\u2212":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function d(e){var t=(e=Sv(e)).fill,n=e.align,d=e.sign,h=e.symbol,f=e.zero,p=e.width,m=e.comma,g=e.precision,v=e.trim,y=e.type;"n"===y?(m=!0,y="g"):Pv[y]||(void 0===g&&(g=12),v=!0,y="g"),(f||"0"===t&&"="===n)&&(f=!0,t="0",n="=");var b="$"===h?i:"#"===h&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",x="$"===h?a:/[%p]/.test(y)?l:"",w=Pv[y],_=/[defgprs%]/.test(y);function k(e){var i,a,l,h=b,k=x;if("c"===y)k=w(e)+k,e="";else{var E=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:w(Math.abs(e),g),v&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),E&&0==+e&&"+"!==d&&(E=!1),h=(E?"("===d?d:u:"-"===d||"("===d?"":d)+h,k=("s"===y?$v[8+Iv/3]:"")+k+(E&&"("===d?")":""),_)for(i=-1,a=e.length;++i<a;)if(48>(l=e.charCodeAt(i))||l>57){k=(46===l?o+e.slice(i+1):e.slice(i))+k,e=e.slice(0,i);break}}m&&!f&&(e=r(e,1/0));var S=h.length+e.length+k.length,T=S<p?new Array(p-S+1).join(t):"";switch(m&&f&&(e=r(T+e,T.length?p-k.length:1/0),T=""),n){case"<":e=h+e+k+T;break;case"=":e=h+T+e+k;break;case"^":e=T.slice(0,S=T.length>>1)+h+e+k+T.slice(S);break;default:e=T+h+e+k}return s(e)}return g=void 0===g?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),k.toString=function(){return e+""},k}return{format:d,formatPrefix:function(e,t){var n=d(((e=Sv(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(Mv(t)/3))),i=Math.pow(10,-r),a=$v[8+r/3];return function(e){return n(i*e)+a}}}};Av=zv({thousands:",",grouping:[3],currency:["$",""]}),Ov=Av.format,Dv=Av.formatPrefix;var Uv=new Date,Hv=new Date;function Wv(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,a){var o,s=[];if(n=i.ceil(n),a=null==a?1:Math.floor(a),!(n<r&&a>0))return s;do{s.push(o=new Date(+n)),t(n,a),e(n)}while(o<n&&n<r);return s},i.filter=function(n){return Wv((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return Uv.setTime(+t),Hv.setTime(+r),e(Uv),e(Hv),Math.floor(n(Uv,Hv))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var Vv=1e3,qv=6e4,Gv=36e5,Yv=864e5,Xv=6048e5,Kv=Wv(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*qv)/Yv,e=>e.getDate()-1);function Zv(e){return Wv((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*qv)/Xv}))}var Jv=Zv(0),Qv=(Zv(1),Zv(2),Zv(3),Zv(4),Zv(5),Zv(6),Wv((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/Yv}),(function(e){return e.getUTCDate()-1})));function ey(e){return Wv((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/Xv}))}var ty=ey(0),ny=(ey(1),ey(2),ey(3),ey(4),ey(5),ey(6),Wv((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()})));ny.every=function(e){return isFinite(e=Math.floor(e))&&e>0?Wv((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var ry=ny,iy=Wv((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()})),ay=Wv((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Vv-e.getMinutes()*qv)}),(function(e,t){e.setTime(+e+t*Gv)}),(function(e,t){return(t-e)/Gv}),(function(e){return e.getHours()})),oy=Wv((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Vv)}),(function(e,t){e.setTime(+e+t*qv)}),(function(e,t){return(t-e)/qv}),(function(e){return e.getMinutes()})),sy=Wv((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*Vv)}),(function(e,t){return(t-e)/Vv}),(function(e){return e.getUTCSeconds()})),ly=Wv((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));ly.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?Wv((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):ly:null};var uy=ly,cy=Wv((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));cy.every=function(e){return isFinite(e=Math.floor(e))&&e>0?Wv((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};var dy=cy,hy=Wv((function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())}),(function(e){return e.getUTCMonth()})),fy=Wv((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+t*Gv)}),(function(e,t){return(t-e)/Gv}),(function(e){return e.getUTCHours()})),py=Wv((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+t*qv)}),(function(e,t){return(t-e)/qv}),(function(e){return e.getUTCMinutes()})),my=function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN},gy=function(e){let t=e,n=e;function r(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)<0?r=a+1:i=a}return r}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>my(e(t),n)}(e)),{left:r,center:function(e,n,i,a){null==i&&(i=0),null==a&&(a=e.length);const o=r(e,n,i,a-1);return o>i&&t(e[o-1],n)>-t(e[o],n)?o-1:o},right:function(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)>0?i=a:r=a+1}return r}}};const vy="year",yy="quarter",by="month",xy="week",wy="date",_y="day",ky="dayofyear",Ey="hours",Sy="minutes",Ty="seconds",Cy="milliseconds",Iy=[vy,yy,by,xy,wy,_y,ky,Ey,Sy,Ty,Cy],Ay=Iy.reduce((e,t,n)=>(e[t]=1+n,e),{});function Oy(e){const t=Ym(e).slice(),n={};return t.length||sm("Missing time unit."),t.forEach(e=>{lg(Ay,e)?n[e]=1:sm("Invalid time unit: ".concat(e,"."))}),(n[xy]||n[_y]?1:0)+(n[yy]||n[by]||n[wy]?1:0)+(n[ky]?1:0)>1&&sm("Incompatible time units: ".concat(e)),t.sort((e,t)=>Ay[e]-Ay[t]),t}const Dy={[vy]:"%Y ",[yy]:"Q%q ",[by]:"%b ",[wy]:"%d ",[xy]:"W%U ",[_y]:"%a ",[ky]:"%j ",[Ey]:"%H:00",[Sy]:"00:%M",[Ty]:":%S",[Cy]:".%L",["".concat(vy,"-").concat(by)]:"%Y-%m ",["".concat(vy,"-").concat(by,"-").concat(wy)]:"%Y-%m-%d ",["".concat(Ey,"-").concat(Sy)]:"%H:%M"};function My(e,t){const n=ig({},Dy,t),r=Oy(e),i=r.length;let a,o,s="",l=0;for(l=0;l<i;)for(a=r.length;a>l;--a)if(o=r.slice(l,a).join("-"),null!=n[o]){s+=n[o],l=a;break}return s.trim()}const Ny=new Date;function jy(e){return Ny.setFullYear(e),Ny.setMonth(0),Ny.setDate(1),Ny.setHours(0,0,0,0),Ny}function Fy(e){return Py(new Date(e))}function Ry(e){return Ly(new Date(e))}function Py(e){return Kv.count(jy(e.getFullYear())-1,e)}function Ly(e){return Jv.count(jy(e.getFullYear())-1,e)}function By(e){return jy(e).getDay()}function $y(e,t,n,r,i,a,o){if(0<=e&&e<100){const s=new Date(-1,t,n,r,i,a,o);return s.setFullYear(e),s}return new Date(e,t,n,r,i,a,o)}function zy(e){return Hy(new Date(e))}function Uy(e){return Wy(new Date(e))}function Hy(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Qv.count(t-1,e)}function Wy(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return ty.count(t-1,e)}function Vy(e){return Ny.setTime(Date.UTC(e,0,1)),Ny.getUTCDay()}function qy(e,t,n,r,i,a,o){if(0<=e&&e<100){const e=new Date(Date.UTC(-1,t,n,r,i,a,o));return e.setUTCFullYear(n.y),e}return new Date(Date.UTC(e,t,n,r,i,a,o))}function Gy(e,t,n,r,i){const a=t||1,o=Am(e),s=(e,t,i)=>function(e,t,n,r){const i=n<=1?e:r?(t,i)=>r+n*Math.floor((e(t,i)-r)/n):(t,r)=>n*Math.floor(e(t,r)/n);return t?(e,n)=>t(i(e,n),n):i}(n[i=i||e],r[i],e===o&&a,t),l=new Date,u=Mg(e),c=u[vy]?s(vy):ng(2012),d=u[by]?s(by):u[yy]?s(yy):hm,h=u[xy]&&u[_y]?s(_y,1,xy+_y):u[xy]?s(xy,1):u[_y]?s(_y,1):u[wy]?s(wy,1):u[ky]?s(ky,1):fm,f=u[Ey]?s(Ey):hm,p=u[Sy]?s(Sy):hm,m=u[Ty]?s(Ty):hm,g=u[Cy]?s(Cy):hm;return function(e){l.setTime(+e);const t=c(l);return i(t,d(l),h(l,t),f(l),p(l),m(l),g(l))}}function Yy(e,t,n){return t+7*e-(n+6)%7}const Xy={[vy]:e=>e.getFullYear(),[yy]:e=>Math.floor(e.getMonth()/3),[by]:e=>e.getMonth(),[wy]:e=>e.getDate(),[Ey]:e=>e.getHours(),[Sy]:e=>e.getMinutes(),[Ty]:e=>e.getSeconds(),[Cy]:e=>e.getMilliseconds(),[ky]:e=>Py(e),[xy]:e=>Ly(e),[xy+_y]:(e,t)=>Yy(Ly(e),e.getDay(),By(t)),[_y]:(e,t)=>Yy(1,e.getDay(),By(t))},Ky={[yy]:e=>3*e,[xy]:(e,t)=>Yy(e,0,By(t))};function Zy(e,t){return Gy(e,t||1,Xy,Ky,$y)}const Jy={[vy]:e=>e.getUTCFullYear(),[yy]:e=>Math.floor(e.getUTCMonth()/3),[by]:e=>e.getUTCMonth(),[wy]:e=>e.getUTCDate(),[Ey]:e=>e.getUTCHours(),[Sy]:e=>e.getUTCMinutes(),[Ty]:e=>e.getUTCSeconds(),[Cy]:e=>e.getUTCMilliseconds(),[ky]:e=>Hy(e),[xy]:e=>Wy(e),[_y]:(e,t)=>Yy(1,e.getUTCDay(),Vy(t)),[xy+_y]:(e,t)=>Yy(Wy(e),e.getUTCDay(),Vy(t))},Qy={[yy]:e=>3*e,[xy]:(e,t)=>Yy(e,0,Vy(t))};function eb(e,t){return Gy(e,t||1,Jy,Qy,qy)}const tb={[vy]:ry,[yy]:iy.every(3),[by]:iy,[xy]:Jv,[wy]:Kv,[_y]:Kv,[ky]:Kv,[Ey]:ay,[Sy]:oy,[Ty]:sy,[Cy]:uy},nb={[vy]:dy,[yy]:hy.every(3),[by]:hy,[xy]:ty,[wy]:Qv,[_y]:Qv,[ky]:Qv,[Ey]:fy,[Sy]:py,[Ty]:sy,[Cy]:uy};function rb(e){return tb[e]}function ib(e){return nb[e]}function ab(e,t,n){return e?e.offset(t,n):void 0}function ob(e,t,n){return ab(rb(e),t,n)}function sb(e,t,n){return ab(ib(e),t,n)}function lb(e,t,n,r){return e?e.range(t,n,r):void 0}function ub(e,t,n,r){return lb(rb(e),t,n,r)}function cb(e,t,n,r){return lb(ib(e),t,n,r)}const db=31536e6,hb=[vy,by,wy,Ey,Sy,Ty,Cy],fb=hb.slice(0,-1),pb=fb.slice(0,-1),mb=pb.slice(0,-1),gb=mb.slice(0,-1),vb=[vy,by],yb=[vy],bb=[[fb,1,1e3],[fb,5,5e3],[fb,15,15e3],[fb,30,3e4],[pb,1,6e4],[pb,5,3e5],[pb,15,9e5],[pb,30,18e5],[mb,1,36e5],[mb,3,108e5],[mb,6,216e5],[mb,12,432e5],[gb,1,864e5],[[vy,xy],1,6048e5],[vb,1,2592e6],[vb,3,7776e6],[yb,1,db]];function xb(e){const t=e.extent,n=e.maxbins||40,r=Math.abs(Tg(t))/n;let i,a,o=gy(e=>e[2]).right(bb,r);return o===bb.length?(i=yb,a=kv(t[0]/db,t[1]/db,n)):o?(o=bb[r/bb[o-1][2]<bb[o][2]/r?o-1:o],i=o[0],a=o[1]):(i=hb,a=Math.max(kv(t[0],t[1],n),1)),{units:i,step:a}}var wb=new Date,_b=new Date;function kb(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,a){var o,s=[];if(n=i.ceil(n),a=null==a?1:Math.floor(a),!(n<r&&a>0))return s;do{s.push(o=new Date(+n)),t(n,a),e(n)}while(o<n&&n<r);return s},i.filter=function(n){return kb((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return wb.setTime(+t),_b.setTime(+r),e(wb),e(_b),Math.floor(n(wb,_b))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var Eb=1e3,Sb=6e4,Tb=36e5,Cb=864e5,Ib=6048e5;function Ab(e){return kb((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/Ib}))}var Ob=Ab(0),Db=Ab(1),Mb=(Ab(2),Ab(3),Ab(4)),Nb=(Ab(5),Ab(6),kb((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/Cb}),(function(e){return e.getUTCDate()-1})));function jb(e){return kb((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Sb)/Ib}))}var Fb=jb(0),Rb=jb(1),Pb=(jb(2),jb(3),jb(4)),Lb=(jb(5),jb(6),kb((function(e){e.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Sb)/Cb}),(function(e){return e.getDate()-1}))),Bb=kb((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));Bb.every=function(e){return isFinite(e=Math.floor(e))&&e>0?kb((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var $b=Bb,zb=kb((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));zb.every=function(e){return isFinite(e=Math.floor(e))&&e>0?kb((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};var Ub=zb;function Hb(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Wb(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Vb(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function qb(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,u=ix(i),c=ax(i),d=ix(a),h=ax(a),f=ix(o),p=ax(o),m=ix(s),g=ax(s),v=ix(l),y=ax(l),b={a:function(e){return o[e.getDay()]},A:function(e){return a[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:Tx,e:Tx,f:Dx,g:Ux,G:Wx,H:Cx,I:Ix,j:Ax,L:Ox,m:Mx,M:Nx,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:fw,s:pw,S:jx,u:Fx,U:Rx,V:Lx,w:Bx,W:$x,x:null,X:null,y:zx,Y:Hx,Z:Vx,"%":hw},x={a:function(e){return o[e.getUTCDay()]},A:function(e){return a[e.getUTCDay()]},b:function(e){return l[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:qx,e:qx,f:Zx,g:lw,G:cw,H:Gx,I:Yx,j:Xx,L:Kx,m:Jx,M:Qx,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:fw,s:pw,S:ew,u:tw,U:nw,V:iw,w:aw,W:ow,x:null,X:null,y:sw,Y:uw,Z:dw,"%":hw},w={a:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=p.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(e,t,n){var r=d.exec(t.slice(n));return r?(e.w=h.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=y.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=g.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(e,n,r){return E(e,t,n,r)},d:gx,e:gx,f:_x,g:hx,G:dx,H:yx,I:yx,j:vx,L:wx,m:mx,M:bx,p:function(e,t,n){var r=u.exec(t.slice(n));return r?(e.p=c.get(r[0].toLowerCase()),n+r[0].length):-1},q:px,Q:Ex,s:Sx,S:xx,u:sx,U:lx,V:ux,w:ox,W:cx,x:function(e,t,r){return E(e,n,t,r)},X:function(e,t,n){return E(e,r,t,n)},y:hx,Y:dx,Z:fx,"%":kx};function _(e,t){return function(n){var r,i,a,o=[],s=-1,l=0,u=e.length;for(n instanceof Date||(n=new Date(+n));++s<u;)37===e.charCodeAt(s)&&(o.push(e.slice(l,s)),null!=(i=Jb[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(a=t[r])&&(r=a(n,i)),o.push(r),l=s+1);return o.push(e.slice(l,s)),o.join("")}}function k(e,t){return function(n){var r,i,a=Vb(1900,void 0,1);if(E(a,e,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(t&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(i=(r=Wb(Vb(a.y,0,1))).getUTCDay(),r=i>4||0===i?Db.ceil(r):Db(r),r=Nb.offset(r,7*(a.V-1)),a.y=r.getUTCFullYear(),a.m=r.getUTCMonth(),a.d=r.getUTCDate()+(a.w+6)%7):(i=(r=Hb(Vb(a.y,0,1))).getDay(),r=i>4||0===i?Rb.ceil(r):Rb(r),r=Lb.offset(r,7*(a.V-1)),a.y=r.getFullYear(),a.m=r.getMonth(),a.d=r.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),i="Z"in a?Wb(Vb(a.y,0,1)).getUTCDay():Hb(Vb(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(i+5)%7:a.w+7*a.U-(i+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,Wb(a)):Hb(a)}}function E(e,t,n,r){for(var i,a,o=0,s=t.length,l=n.length;o<s;){if(r>=l)return-1;if(37===(i=t.charCodeAt(o++))){if(i=t.charAt(o++),!(a=w[i in Jb?t.charAt(o++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return b.x=_(n,b),b.X=_(r,b),b.c=_(t,b),x.x=_(n,x),x.X=_(r,x),x.c=_(t,x),{format:function(e){var t=_(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=k(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=_(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=k(e+="",!0);return t.toString=function(){return e},t}}}var Gb,Yb,Xb,Kb,Zb,Jb={"-":"",_:" ",0:"0"},Qb=/^\s*\d+/,ex=/^%/,tx=/[\\^$*+?|[\]().{}]/g;function nx(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function rx(e){return e.replace(tx,"\\$&")}function ix(e){return new RegExp("^(?:"+e.map(rx).join("|")+")","i")}function ax(e){return new Map(e.map((e,t)=>[e.toLowerCase(),t]))}function ox(e,t,n){var r=Qb.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function sx(e,t,n){var r=Qb.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function lx(e,t,n){var r=Qb.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function ux(e,t,n){var r=Qb.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function cx(e,t,n){var r=Qb.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function dx(e,t,n){var r=Qb.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function hx(e,t,n){var r=Qb.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function fx(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function px(e,t,n){var r=Qb.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function mx(e,t,n){var r=Qb.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function gx(e,t,n){var r=Qb.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function vx(e,t,n){var r=Qb.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function yx(e,t,n){var r=Qb.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function bx(e,t,n){var r=Qb.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function xx(e,t,n){var r=Qb.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function wx(e,t,n){var r=Qb.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function _x(e,t,n){var r=Qb.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function kx(e,t,n){var r=ex.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function Ex(e,t,n){var r=Qb.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function Sx(e,t,n){var r=Qb.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function Tx(e,t){return nx(e.getDate(),t,2)}function Cx(e,t){return nx(e.getHours(),t,2)}function Ix(e,t){return nx(e.getHours()%12||12,t,2)}function Ax(e,t){return nx(1+Lb.count($b(e),e),t,3)}function Ox(e,t){return nx(e.getMilliseconds(),t,3)}function Dx(e,t){return Ox(e,t)+"000"}function Mx(e,t){return nx(e.getMonth()+1,t,2)}function Nx(e,t){return nx(e.getMinutes(),t,2)}function jx(e,t){return nx(e.getSeconds(),t,2)}function Fx(e){var t=e.getDay();return 0===t?7:t}function Rx(e,t){return nx(Fb.count($b(e)-1,e),t,2)}function Px(e){var t=e.getDay();return t>=4||0===t?Pb(e):Pb.ceil(e)}function Lx(e,t){return e=Px(e),nx(Pb.count($b(e),e)+(4===$b(e).getDay()),t,2)}function Bx(e){return e.getDay()}function $x(e,t){return nx(Rb.count($b(e)-1,e),t,2)}function zx(e,t){return nx(e.getFullYear()%100,t,2)}function Ux(e,t){return nx((e=Px(e)).getFullYear()%100,t,2)}function Hx(e,t){return nx(e.getFullYear()%1e4,t,4)}function Wx(e,t){var n=e.getDay();return nx((e=n>=4||0===n?Pb(e):Pb.ceil(e)).getFullYear()%1e4,t,4)}function Vx(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+nx(t/60|0,"0",2)+nx(t%60,"0",2)}function qx(e,t){return nx(e.getUTCDate(),t,2)}function Gx(e,t){return nx(e.getUTCHours(),t,2)}function Yx(e,t){return nx(e.getUTCHours()%12||12,t,2)}function Xx(e,t){return nx(1+Nb.count(Ub(e),e),t,3)}function Kx(e,t){return nx(e.getUTCMilliseconds(),t,3)}function Zx(e,t){return Kx(e,t)+"000"}function Jx(e,t){return nx(e.getUTCMonth()+1,t,2)}function Qx(e,t){return nx(e.getUTCMinutes(),t,2)}function ew(e,t){return nx(e.getUTCSeconds(),t,2)}function tw(e){var t=e.getUTCDay();return 0===t?7:t}function nw(e,t){return nx(Ob.count(Ub(e)-1,e),t,2)}function rw(e){var t=e.getUTCDay();return t>=4||0===t?Mb(e):Mb.ceil(e)}function iw(e,t){return e=rw(e),nx(Mb.count(Ub(e),e)+(4===Ub(e).getUTCDay()),t,2)}function aw(e){return e.getUTCDay()}function ow(e,t){return nx(Db.count(Ub(e)-1,e),t,2)}function sw(e,t){return nx(e.getUTCFullYear()%100,t,2)}function lw(e,t){return nx((e=rw(e)).getUTCFullYear()%100,t,2)}function uw(e,t){return nx(e.getUTCFullYear()%1e4,t,4)}function cw(e,t){var n=e.getUTCDay();return nx((e=n>=4||0===n?Mb(e):Mb.ceil(e)).getUTCFullYear()%1e4,t,4)}function dw(){return"+0000"}function hw(){return"%"}function fw(e){return+e}function pw(e){return Math.floor(+e/1e3)}function mw(e){const t={};return n=>t[n]||(t[n]=e(n))}function gw(e){const t=mw(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(e){const n=Sv(e||",");if(null==n.precision){switch(n.precision=12,n.type){case"%":n.precision-=2;break;case"e":n.precision-=1}return function(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let a=function(e,t){let n,r=e.lastIndexOf("e");if(r>0)return r;for(r=e.length;--r>t;)if(n=e.charCodeAt(r),n>=48&&n<=57)return r+1}(r,i);const o=a<r.length?r.slice(a):"";for(;--a>i;)if("0"!==r[a]){++a;break}return r.slice(0,a)+o}}(t(n),t(".1f")(1)[1])}return t(n)},formatSpan(e,r,i,a){a=Sv(null==a?",f":a);const o=kv(e,r,i),s=Math.max(Math.abs(e),Math.abs(r));let l;if(null==a.precision)switch(a.type){case"s":return isNaN(l=Nv(o,s))||(a.precision=l),n(a,s);case"":case"e":case"g":case"p":case"r":isNaN(l=jv(o,s))||(a.precision=l-("e"===a.type));break;case"f":case"%":isNaN(l=Fv(o))||(a.precision=l-2*("%"===a.type))}return t(a)}}}let vw,yw;function bw(){return vw=gw({format:Ov,formatPrefix:Dv})}function xw(e){return gw(zv(e))}function ww(e){return arguments.length?vw=xw(e):vw}function _w(e,t,n){Em(n=n||{})||sm("Invalid time multi-format specifier: ".concat(n));const r=t(Ty),i=t(Sy),a=t(Ey),o=t(wy),s=t(xy),l=t(by),u=t(yy),c=t(vy),d=e(n[Cy]||".%L"),h=e(n[Ty]||":%S"),f=e(n[Sy]||"%I:%M"),p=e(n[Ey]||"%I %p"),m=e(n[wy]||n[_y]||"%a %d"),g=e(n[xy]||"%b %d"),v=e(n[by]||"%B"),y=e(n[yy]||"%B"),b=e(n[vy]||"%Y");return e=>(r(e)<e?d:i(e)<e?h:a(e)<e?f:o(e)<e?p:l(e)<e?s(e)<e?m:g:c(e)<e?u(e)<e?v:y:b)(e)}function kw(e){const t=mw(e.format),n=mw(e.utcFormat);return{timeFormat:e=>bg(e)?t(e):_w(t,rb,e),utcFormat:e=>bg(e)?n(e):_w(n,ib,e),timeParse:mw(e.parse),utcParse:mw(e.utcParse)}}function Ew(){return yw=kw({format:Yb,parse:Xb,utcFormat:Kb,utcParse:Zb})}function Sw(e){return kw(qb(e))}function Tw(e){return arguments.length?yw=Sw(e):yw}Gb=qb({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),Yb=Gb.format,Xb=Gb.parse,Kb=Gb.utcFormat,Zb=Gb.utcParse,bw(),Ew();const Cw=(e,t)=>ig({},e,t);function Iw(e,t){const n=e?xw(e):ww(),r=t?Sw(t):Tw();return Cw(n,r)}function Aw(e,t){const n=arguments.length;return n&&2!==n&&sm("defaultLocale expects either zero or two arguments."),n?Cw(ww(e),Tw(t)):Cw(ww(),Tw())}function Ow(){return bw(),Ew(),Aw()}var Dw=function(e,t,n,r){const i=gv((t=t||{}).type||"json");return i||sm("Unknown data format type: "+t.type),e=i(e,t),t.parse&&function(e,t,n,r){if(!e.length)return;const i=Tw();n=n||i.timeParse,r=r||i.utcParse;let a,o,s,l,u,c,d=e.columns||Object.keys(e[0]);"auto"===t&&(t=Kg(e,d)),d=Object.keys(t);const h=d.map(e=>{const i=t[e];let a,o;if(i&&(i.startsWith("date:")||i.startsWith("utc:")))return a=i.split(/:(.+)?/,2),o=a[1],("'"===o[0]&&"'"===o[o.length-1]||'"'===o[0]&&'"'===o[o.length-1])&&(o=o.slice(1,-1)),("utc"===a[0]?r:n)(o);if(!qg[i])throw Error("Illegal format pattern: "+e+":"+i);return qg[i]});for(s=0,u=e.length,c=d.length;s<u;++s)for(a=e[s],l=0;l<c;++l)o=d[l],a[o]=h[l](a[o])}(e,t.parse,n,r),lg(e,"columns")&&delete e.columns,e};const Mw=function(e,t){return t=>({options:t||{},sanitize:$g,load:Bg,fileAccess:!1,file:zg(null),http:Hg(e)})}("undefined"!=typeof fetch&&fetch);function Nw(e){const t=e||dm,n=[],r={};return n.add=e=>{const i=t(e);return r[i]||(r[i]=1,n.push(e)),n},n.remove=e=>{const i=t(e);if(r[i]){r[i]=0;const t=n.indexOf(e);t>=0&&n.splice(t,1)}return n},n}async function jw(e,t){try{await t(e)}catch(n){e.error(n)}}const Fw=Symbol("vega_id");let Rw=1;function Pw(e){return!(!e||!Lw(e))}function Lw(e){return e[Fw]}function Bw(e,t){return e[Fw]=t,e}function $w(e){const t=e===Object(e)?e:{data:e};return Lw(t)?t:Bw(t,Rw++)}function zw(e){return Uw(e,$w({}))}function Uw(e,t){for(const n in e)t[n]=e[n];return t}function Hw(e,t){return Bw(t,Lw(e))}function Ww(e,t){return e?t?(n,r)=>e(n,r)||Lw(t(n))-Lw(t(r)):(t,n)=>e(t,n)||Lw(t)-Lw(n):null}function Vw(e){return e&&e.constructor===qw}function qw(){const e=[],t=[],n=[],r=[],i=[];let a=null,o=!1;return{constructor:qw,insert(t){const n=Ym(t),r=n.length;for(let i=0;i<r;++i)e.push(n[i]);return this},remove(e){const n=Km(e)?r:t,i=Ym(e),a=i.length;for(let t=0;t<a;++t)n.push(i[t]);return this},modify(e,t,r){const a={field:t,value:ng(r)};return Km(e)?(a.filter=e,i.push(a)):(a.tuple=e,n.push(a)),this},encode(e,t){return Km(e)?i.push({filter:e,field:t}):n.push({tuple:e,field:t}),this},clean(e){return a=e,this},reflow(){return o=!0,this},pulse(s,l){const u={},c={};let d,h,f,p,m,g;for(d=0,h=l.length;d<h;++d)u[Lw(l[d])]=1;for(d=0,h=t.length;d<h;++d)m=t[d],u[Lw(m)]=-1;for(d=0,h=r.length;d<h;++d)p=r[d],l.forEach(e=>{p(e)&&(u[Lw(e)]=-1)});for(d=0,h=e.length;d<h;++d)m=e[d],g=Lw(m),u[g]?u[g]=1:s.add.push($w(e[d]));for(d=0,h=l.length;d<h;++d)m=l[d],u[Lw(m)]<0&&s.rem.push(m);function v(e,t,n){n?e[t]=n(e):s.encode=t,o||(c[Lw(e)]=e)}for(d=0,h=n.length;d<h;++d)f=n[d],m=f.tuple,p=f.field,g=u[Lw(m)],g>0&&(v(m,p,f.value),s.modifies(p));for(d=0,h=i.length;d<h;++d)f=i[d],p=f.filter,l.forEach(e=>{p(e)&&u[Lw(e)]>0&&v(e,f.field,f.value)}),s.modifies(f.field);if(o)s.mod=t.length||r.length?l.filter(e=>u[Lw(e)]>0):l.slice();else for(g in c)s.mod.push(c[g]);return(a||null==a&&(t.length||r.length))&&s.clean(!0),s}}}const Gw="_:mod:_";function Yw(){Object.defineProperty(this,Gw,{writable:!0,value:{}})}Yw.prototype={set(e,t,n,r){const i=this,a=i[e],o=i[Gw];return null!=t&&t>=0?(a[t]!==n||r)&&(a[t]=n,o[t+":"+e]=-1,o[e]=-1):(a!==n||r)&&(i[e]=n,o[e]=km(n)?1+n.length:-1),i},modified(e,t){const n=this[Gw];if(!arguments.length){for(const e in n)if(n[e])return!0;return!1}if(km(e)){for(let t=0;t<e.length;++t)if(n[e[t]])return!0;return!1}return null!=t&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[Gw]={},this}};let Xw=0;const Kw=new Yw;function Zw(e,t,n,r){this.id=++Xw,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,r)}function Jw(e){return function(t){const n=this.flags;return 0===arguments.length?!!(n&e):(this.flags=t?n|e:n&~e,this)}}Zw.prototype={targets(){return this._targets||(this._targets=Nw(cm))},set(e){return this.value!==e?(this.value=e,1):0},skip:Jw(1),modified:Jw(2),parameters(e,t,n){t=!1!==t;const r=this._argval=this._argval||new Yw,i=this._argops=this._argops||[],a=[];let o,s,l,u;const c=(e,n,o)=>{o instanceof Zw?(o!==this&&(t&&o.targets().add(this),a.push(o)),i.push({op:o,name:e,index:n})):r.set(e,n,o)};for(o in e)if(s=e[o],"pulse"===o)Ym(s).forEach(e=>{e instanceof Zw?e!==this&&(e.targets().add(this),a.push(e)):sm("Pulse parameters must be operator instances.")}),this.source=s;else if(km(s))for(r.set(o,-1,Array(l=s.length)),u=0;u<l;++u)c(o,u,s[u]);else c(o,-1,s);return this.marshall().clear(),n&&(i.initonly=!0),a},marshall(e){const t=this._argval||Kw,n=this._argops;let r,i,a,o;if(n){const s=n.length;for(i=0;i<s;++i)r=n[i],a=r.op,o=a.modified()&&a.stamp===e,t.set(r.name,r.index,a.value,o);if(n.initonly){for(i=0;i<s;++i)r=n[i],r.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,r,i;if(e)for(t=0,n=e.length;t<n;++t)r=e[t],i=r.op,i._targets&&i._targets.remove(this)},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),r=t.call(this,n,e);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};let Qw=0;function e_(e,t,n){this.id=++Qw,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function t_(e,t,n){return new e_(e,t,n)}e_.prototype={_filter:pm,_apply:dm,targets(){return this._targets||(this._targets=Nw(cm))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,r=n?n.length:0;for(let e=0;e<r;++e)n[e].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=t_(e);return this.targets().add(t),t},apply(e){const t=t_(null,e);return this.targets().add(t),t},merge(){const e=t_();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const n=Date.now();return n-t>e?(t=n,1):0})},debounce(e){const t=t_();return this.targets().add(t_(null,null,rg(e,e=>{const n=e.dataflow;t.receive(e),n&&n.run&&n.run()}))),t},between(e,t){let n=!1;return e.targets().add(t_(null,null,()=>n=!0)),t.targets().add(t_(null,null,()=>n=!1)),this.filter(()=>n)},detach(){}};const n_={skip:!0};function r_(e,t,n,r,i,a){const o=ig({},a,n_);let s,l;Km(n)||(n=ng(n)),void 0===r?s=t=>e.touch(n(t)):Km(r)?(l=new Zw(null,r,i,!1),s=t=>{l.evaluate(t);const r=n(t),i=l.value;Vw(i)?e.pulse(r,i,a):e.update(r,i,o)}):s=t=>e.update(n(t),r,o),t.apply(s)}function i_(e,t,n,r,i,a){if(void 0===r)t.targets().add(n);else{const o=a||{},s=new Zw(null,function(e,t){return t=Km(t)?t:ng(t),e?function(n,r){const i=t(n,r);return e.skip()||(e.skip(i!==this.value).value=i),i}:t}(n,r),i,!1);s.modified(o.force),s.rank=t.rank,t.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),e.connect(n,[s]))}}const a_={};function o_(e,t,n){this.dataflow=e,this.stamp=null==t?-1:t,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function s_(e,t){const n=[];return jg(e,t,e=>n.push(e)),n}function l_(e,t){const n={};return e.visit(t,e=>{n[Lw(e)]=1}),e=>n[Lw(e)]?null:e}function u_(e,t){return e?(n,r)=>e(n,r)&&t(n,r):t}function c_(e,t,n,r){const i=this,a=n.length;let o=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=r||null,this.pulses=n;for(let s=0;s<a;++s){const e=n[s];if(e.stamp===t){if(e.fields){const t=i.fields||(i.fields={});for(const n in e.fields)t[n]=1}e.changed(i.ADD)&&(o|=i.ADD),e.changed(i.REM)&&(o|=i.REM),e.changed(i.MOD)&&(o|=i.MOD)}}this.changes=o}function d_(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}o_.prototype={StopPropagation:a_,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(e){return new o_(this.dataflow).init(this,e)},clone(){const e=this.fork(7);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(23)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new o_(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,!e.fields||64&t||(n.fields=e.fields),1&t?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),2&t?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),4&t?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),32&t?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||7;return 1&t&&this.add.length||2&t&&this.rem.length||4&t&&this.mod.length},reflow(e){if(e)return this.fork(7).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(4,l_(this,1))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return km(e)?e.forEach(e=>t[e]=!0):t[e]=!0,this},modified(e,t){const n=this.fields;return!(!t&&!this.mod.length||!n)&&(arguments.length?km(e)?e.some(e=>n[e]):n[e]:!!n)},filter(e,t){const n=this;return 1&e&&(n.addF=u_(n.addF,t)),2&e&&(n.remF=u_(n.remF,t)),4&e&&(n.modF=u_(n.modF,t)),16&e&&(n.srcF=u_(n.srcF,t)),n},materialize(e){const t=this;return 1&(e=e||7)&&t.addF&&(t.add=s_(t.add,t.addF),t.addF=null),2&e&&t.remF&&(t.rem=s_(t.rem,t.remF),t.remF=null),4&e&&t.modF&&(t.mod=s_(t.mod,t.modF),t.modF=null),16&e&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,r=t;if(16&e)return jg(n.source,n.srcF,r),n;1&e&&jg(n.add,n.addF,r),2&e&&jg(n.rem,n.remF,r),4&e&&jg(n.mod,n.modF,r);const i=n.source;if(8&e&&i){const e=n.add.length+n.mod.length;e===i.length||jg(i,e?l_(n,5):n.srcF,r)}return n}},hg(c_,o_,{fork(e){const t=new o_(this.dataflow).init(this,e&this.NO_FIELDS);return void 0!==e&&(e&t.ADD&&this.visit(t.ADD,e=>t.add.push(e)),e&t.REM&&this.visit(t.REM,e=>t.rem.push(e)),e&t.MOD&&this.visit(t.MOD,e=>t.mod.push(e))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?km(e)?e.some(e=>n[e]):n[e]:0},filter(){sm("MultiPulse does not support filtering.")},materialize(){sm("MultiPulse does not support materialization.")},visit(e,t){const n=this,r=n.pulses,i=r.length;let a=0;if(e&n.SOURCE)for(;a<i;++a)r[a].visit(e,t);else for(;a<i;++a)r[a].stamp===n.stamp&&r[a].visit(e,t);return n}});const h_={skip:!1,force:!1};function f_(e,t,n,r){let i,a;const o=e[n];for(;n>t&&(a=n-1>>1,i=e[a],r(o,i)<0);)e[n]=i,n=a;return e[n]=o}function p_(){this.logger(_m()),this.logLevel(ym),this._clock=0,this._rank=0,this._locale=Aw();try{this._loader=Mw()}catch(e){}this._touched=Nw(cm),this._input={},this._pulse=null,this._heap=function(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),f_(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let r;return t.length?(r=t[0],t[0]=n,function(e,t,n){const r=t,i=e.length,a=e[t];let o,s=1+(t<<1);for(;s<i;)o=s+1,o<i&&n(e[s],e[o])>=0&&(s=o),e[t]=e[s],s=1+((t=s)<<1);e[t]=a,f_(e,r,t,n)}(t,0,e)):r=n,r}}}((e,t)=>e.qrank-t.qrank),this._postrun=[]}function m_(e){return function(){return this._log[e].apply(this,arguments)}}function g_(e,t){Zw.call(this,e,null,t)}p_.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:m_("error"),warn:m_("warn"),info:m_("info"),debug:m_("debug"),logLevel:m_("level"),cleanThreshold:1e4,add:function(e,t,n,r){let i,a=1;return e instanceof Zw?i=e:e&&e.prototype instanceof Zw?i=new e:Km(e)?i=new Zw(null,e):(a=0,i=new Zw(e,t)),this.rank(i),a&&(r=n,n=t),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},connect:function(e,t){const n=e.rank,r=t.length;for(let i=0;i<r;++i)if(n<t[i].rank)return void this.rerank(e)},rank:function(e){e.rank=++this._rank},rerank:function(e){const t=[e];let n,r,i;for(;t.length;)if(this.rank(n=t.pop()),r=n._targets)for(i=r.length;--i>=0;)t.push(n=r[i]),n===e&&sm("Cycle detected in dataflow graph.")},pulse:function(e,t,n){this.touch(e,n||h_);const r=new o_(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];return r.target=e,this._input[e.id]=t.pulse(r,i),this},touch:function(e,t){const n=t||h_;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this},update:function(e,t,n){const r=n||h_;return(e.set(t)||r.force)&&this.touch(e,r),this},changeset:qw,ingest:function(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))},parse:function(e,t){const n=this.locale();return Dw(e,t,n.timeParse,n.utcParse)},preload:async function(e,t,n){const r=this,i=r._pending||function(e){let t;const n=new Promise(e=>t=e);return n.requests=0,n.done=()=>{0==--n.requests&&(e._pending=null,t(e))},e._pending=n}(r);i.requests+=1;const a=await r.request(t,n);return r.pulse(e,r.changeset().remove(pm).insert(a.data||[])),i.done(),a},request:async function(e,t){const n=this;let r,i=0;try{r=await n.loader().load(e,{context:"dataflow",response:vv(t&&t.type)});try{r=n.parse(r,t)}catch(a){i=-2,n.warn("Data ingestion failed",e,a)}}catch(a){i=-1,n.warn("Loading failed",e,a)}return{data:r,status:i}},events:function(e,t,n,r){const i=this,a=t_(n,r),o=function(e){e.dataflow=i;try{a.receive(e)}catch(t){i.error(t)}finally{i.run()}};let s;s="string"==typeof e&&"undefined"!=typeof document?document.querySelectorAll(e):Ym(e);const l=s.length;for(let u=0;u<l;++u)s[u].addEventListener(t,o);return a},on:function(e,t,n,r,i){return(e instanceof Zw?i_:r_)(this,e,t,n,r,i),this},evaluate:async function(e,t,n){const r=this,i=[];if(r._pulse)return d_(r);if(r._pending&&await r._pending,t&&await jw(r,t),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const a=++r._clock;r._pulse=new o_(r,a,e),r._touched.forEach(e=>r._enqueue(e,!0)),r._touched=Nw(cm);let o,s,l,u=0;try{for(;r._heap.size()>0;)o=r._heap.pop(),o.rank===o.qrank?(s=o.run(r._getPulse(o,e)),s.then?s=await s:s.async&&(i.push(s.async),s=a_),s!==a_&&o._targets&&o._targets.forEach(e=>r._enqueue(e)),++u):r._enqueue(o,!0)}catch(c){r._heap.clear(),l=c}if(r._input={},r._pulse=null,r.debug("Pulse ".concat(a,": ").concat(u," operators")),l&&(r._postrun=[],r.error(l)),r._postrun.length){const e=r._postrun.sort((e,t)=>t.priority-e.priority);r._postrun=[];for(let t=0;t<e.length;++t)await jw(r,e[t].callback)}return n&&await jw(r,n),i.length&&Promise.all(i).then(e=>r.runAsync(null,()=>{e.forEach(e=>{try{e(r)}catch(c){r.error(c)}})})),r},run:function(e,t,n){return this._pulse?d_(this):(this.evaluate(e,t,n),this)},runAsync:async function(e,t,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(r,r),this._running},runAfter:function(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(r){this.error(r)}},_enqueue:function(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))},_getPulse:function(e,t){const n=e.source,r=this._clock;return n&&km(n)?new c_(this,r,n.map(e=>e.pulse),t):this._input[e.id]||function(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==a_&&(e.source=t.source),e)}(this._pulse,n&&n.pulse)}},hg(g_,Zw,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(e=>this.pulse=e):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const v_={};function y_(e){const t=b_(e);return t&&t.Definition||null}function b_(e){return e=e&&e.toLowerCase(),lg(v_,e)?v_[e]:null}function x_(e,t){let n;if(void 0===t)for(const r of e)null!=r&&(n<r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function w_(e,t){let n;if(void 0===t)for(const r of e)null!=r&&(n>r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function __(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}var k_=function(e){return null===e?NaN:+e};function E_(e,t,n){if(r=(e=Float64Array.from(function*(e,t){if(void 0===t)for(let n of e)null!=n&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)null!=(r=t(r,++n,e))&&(r=+r)>=r&&(yield r)}}(e,n))).length){if((t=+t)<=0||r<2)return w_(e);if(t>=1)return x_(e);var r,i=(r-1)*t,a=Math.floor(i),o=x_(function e(t,n,r=0,i=t.length-1,a=my){for(;i>r;){if(i-r>600){const o=i-r+1,s=n-r+1,l=Math.log(o),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(o-u)/o)*(s-o/2<0?-1:1);e(t,n,Math.max(r,Math.floor(n-s*u/o+c)),Math.min(i,Math.floor(n+(o-s)*u/o+c)),a)}const o=t[n];let s=r,l=i;for(__(t,r,n),a(t[i],o)>0&&__(t,r,i);s<l;){for(__(t,s,l),++s,--l;a(t[s],o)<0;)++s;for(;a(t[l],o)>0;)--l}0===a(t[r],o)?__(t,r,l):(++l,__(t,l,i)),l<=n&&(r=l+1),n<=l&&(i=l-1)}return t}(e,a).subarray(0,a+1));return o+(w_(e.subarray(a+1))-o)*(i-a)}}function S_(e,t,n=k_){if(r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),o=+n(e[a],a,e);return o+(+n(e[a+1],a+1,e)-o)*(i-a)}}var T_=function(e,t){return E_(e,.5,t)};function*C_(e,t){if(null==t)for(let n of e)null!=n&&""!==n&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)r=t(r,++n,e),null!=r&&""!==r&&(r=+r)>=r&&(yield r)}}function I_(e,t,n){const r=Float64Array.from(C_(e,n));return r.sort(my),t.map(e=>S_(r,e))}function A_(e,t){return I_(e,[.25,.5,.75],t)}function O_(e,t){const n=e.length,r=function(e,t){const n=function(e,t){let n,r=0,i=0,a=0;if(void 0===t)for(let o of e)null!=o&&(o=+o)>=o&&(n=o-i,i+=n/++r,a+=n*(o-i));else{let o=-1;for(let s of e)null!=(s=t(s,++o,e))&&(s=+s)>=s&&(n=s-i,i+=n/++r,a+=n*(s-i))}if(r>1)return a/(r-1)}(e,t);return n?Math.sqrt(n):n}(e,t),i=A_(e,t);return 1.06*(Math.min(r,(i[2]-i[0])/1.34)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function D_(e){const t=e.maxbins||20,n=e.base||10,r=Math.log(n),i=e.divide||[5,2];let a,o,s,l,u,c,d=e.extent[0],h=e.extent[1];const f=e.span||h-d||Math.abs(d)||1;if(e.step)a=e.step;else if(e.steps){for(l=f/t,u=0,c=e.steps.length;u<c&&e.steps[u]<l;++u);a=e.steps[Math.max(0,u-1)]}else{for(o=Math.ceil(Math.log(t)/r),s=e.minstep||0,a=Math.max(s,Math.pow(n,Math.round(Math.log(f)/r)-o));Math.ceil(f/a)>t;)a*=n;for(u=0,c=i.length;u<c;++u)l=a/i[u],l>=s&&f/l<=t&&(a=l)}l=Math.log(a);const p=Math.pow(n,-(l>=0?0:1+~~(-l/r))-1);return(e.nice||void 0===e.nice)&&(l=Math.floor(d/a+p)*a,d=d<l?l-a:l,h=Math.ceil(h/a)*a),{start:d,stop:h===d?d+a:h,step:a}}var M_=Math.random;function N_(e){M_=e}function j_(e,t,n,r){if(!e.length)return[void 0,void 0];const i=Float64Array.from(C_(e,r)),a=i.length,o=t;let s,l,u,c;for(u=0,c=Array(o);u<o;++u){for(s=0,l=0;l<a;++l)s+=i[~~(M_()*a)];c[u]=s/a}return c.sort(my),[E_(c,n/2),E_(c,1-n/2)]}function F_(e,t,n,r){r=r||(e=>e);const i=e.length,a=new Float64Array(i);let o,s=0,l=1,u=r(e[0]),c=u,d=u+t;for(;l<i;++l){if(o=r(e[l]),o>=d){for(c=(u+c)/2;s<l;++s)a[s]=c;d=o+t,u=o}c=o}for(c=(u+c)/2;s<l;++s)a[s]=c;return n?function(e,t){const n=e.length;let r,i,a=0,o=1;for(;e[a]===e[o];)++o;for(;o<n;){for(r=o+1;e[o]===e[r];)++r;if(e[o]-e[o-1]<t){for(i=o+(a+r-o-o>>1);i<o;)e[i++]=e[o];for(;i>o;)e[i--]=e[a]}a=o,o=r}return e}(a,t+t/4):a}function R_(e){return function(){return(e=(1103515245*e+12345)%2147483647)/2147483647}}function P_(e,t){let n,r,i;null==t&&(t=e,e=0);const a={min(e){return arguments.length?(n=e||0,i=r-n,a):n},max(e){return arguments.length?(r=e||0,i=r-n,a):r},sample:()=>n+Math.floor(i*M_()),pdf:e=>e===Math.floor(e)&&e>=n&&e<r?1/i:0,cdf(e){const t=Math.floor(e);return t<n?0:t>=r?1:(t-n+1)/i},icdf:e=>e>=0&&e<=1?n-1+Math.floor(e*i):NaN};return a.min(e).max(t)}const L_=Math.sqrt(2*Math.PI),B_=Math.SQRT2;let $_=NaN;function z_(e,t){e=e||0,t=null==t?1:t;let n,r,i=0,a=0;if($_==$_)i=$_,$_=NaN;else{do{i=2*M_()-1,a=2*M_()-1,n=i*i+a*a}while(0===n||n>1);r=Math.sqrt(-2*Math.log(n)/n),i*=r,$_=a*r}return e+i*t}function U_(e,t,n){const r=(e-(t||0))/(n=null==n?1:n);return Math.exp(-.5*r*r)/(n*L_)}function H_(e,t,n){const r=(e-(t=t||0))/(n=null==n?1:n),i=Math.abs(r);let a;if(i>37)a=0;else{const e=Math.exp(-i*i/2);let t;i<7.07106781186547?(t=.0352624965998911*i+.700383064443688,t=t*i+6.37396220353165,t=t*i+33.912866078383,t=t*i+112.079291497871,t=t*i+221.213596169931,t=t*i+220.206867912376,a=e*t,t=.0883883476483184*i+1.75566716318264,t=t*i+16.064177579207,t=t*i+86.7807322029461,t=t*i+296.564248779674,t=t*i+637.333633378831,t=t*i+793.826512519948,t=t*i+440.413735824752,a/=t):(t=i+.65,t=i+4/t,t=i+3/t,t=i+2/t,t=i+1/t,a=e/t/2.506628274631)}return r>0?1-a:a}function W_(e,t,n){return e<0||e>1?NaN:(t||0)+(null==n?1:n)*B_*function(e){let t,n=-Math.log((1-e)*(1+e));return n<6.25?(n-=3.125,t=-364441206401782e-35,t=t*n-16850591381820166e-35,t=128584807152564e-32+t*n,t=11157877678025181e-33+t*n,t=t*n-1333171662854621e-31,t=20972767875968562e-33+t*n,t=6637638134358324e-30+t*n,t=t*n-4054566272975207e-29,t=t*n-8151934197605472e-29,t=26335093153082323e-28+t*n,t=t*n-12975133253453532e-27,t=t*n-5415412054294628e-26,t=1.0512122733215323e-9+t*n,t=t*n-4.112633980346984e-9,t=t*n-2.9070369957882005e-8,t=4.2347877827932404e-7+t*n,t=t*n-13654692000834679e-22,t=t*n-13882523362786469e-21,t=.00018673420803405714+t*n,t=t*n-.000740702534166267,t=t*n-.006033670871430149,t=.24015818242558962+t*n,t=1.6536545626831027+t*n):n<16?(n=Math.sqrt(n)-3.25,t=2.2137376921775787e-9,t=9.075656193888539e-8+t*n,t=t*n-2.7517406297064545e-7,t=1.8239629214389228e-8+t*n,t=15027403968909828e-22+t*n,t=t*n-4013867526981546e-21,t=29234449089955446e-22+t*n,t=12475304481671779e-21+t*n,t=t*n-47318229009055734e-21,t=6828485145957318e-20+t*n,t=24031110387097894e-21+t*n,t=t*n-.0003550375203628475,t=.0009532893797373805+t*n,t=t*n-.0016882755560235047,t=.002491442096107851+t*n,t=t*n-.003751208507569241,t=.005370914553590064+t*n,t=1.0052589676941592+t*n,t=3.0838856104922208+t*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,t=-27109920616438573e-27,t=t*n-2.555641816996525e-10,t=1.5076572693500548e-9+t*n,t=t*n-3.789465440126737e-9,t=7.61570120807834e-9+t*n,t=t*n-1.496002662714924e-8,t=2.914795345090108e-8+t*n,t=t*n-6.771199775845234e-8,t=2.2900482228026655e-7+t*n,t=t*n-9.9298272942317e-7,t=4526062597223154e-21+t*n,t=t*n-1968177810553167e-20,t=7599527703001776e-20+t*n,t=t*n-.00021503011930044477,t=t*n-.00013871931833623122,t=1.0103004648645344+t*n,t=4.849906401408584+t*n):t=1/0,t*e}(2*e-1)}function V_(e,t){let n,r;const i={mean(e){return arguments.length?(n=e||0,i):n},stdev(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>z_(n,r),pdf:e=>U_(e,n,r),cdf:e=>H_(e,n,r),icdf:e=>W_(e,n,r)};return i.mean(e).stdev(t)}function q_(e,t){const n=V_();let r=0;const i={data(n){return arguments.length?(e=n,r=n?n.length:0,i.bandwidth(t)):e},bandwidth(n){return arguments.length?(!(t=n)&&e&&(t=O_(e)),i):t},sample:()=>e[~~(M_()*r)]+t*n.sample(),pdf(i){let a=0,o=0;for(;o<r;++o)a+=n.pdf((i-e[o])/t);return a/t/r},cdf(i){let a=0,o=0;for(;o<r;++o)a+=n.cdf((i-e[o])/t);return a/r},icdf(){throw Error("KDE icdf not supported.")}};return i.data(e)}function G_(e,t){return e=e||0,t=null==t?1:t,Math.exp(e+z_()*t)}function Y_(e,t,n){if(e<=0)return 0;t=t||0,n=null==n?1:n;const r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*L_*e)}function X_(e,t,n){return H_(Math.log(e),t,n)}function K_(e,t,n){return Math.exp(W_(e,t,n))}function Z_(e,t){let n,r;const i={mean(e){return arguments.length?(n=e||0,i):n},stdev(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>G_(n,r),pdf:e=>Y_(e,n,r),cdf:e=>X_(e,n,r),icdf:e=>K_(e,n,r)};return i.mean(e).stdev(t)}function J_(e,t){let n,r=0;const i={weights(e){return arguments.length?(n=function(e){const t=[];let n,i=0;for(n=0;n<r;++n)i+=t[n]=null==e[n]?1:+e[n];for(n=0;n<r;++n)t[n]/=i;return t}(t=e||[]),i):t},distributions(n){return arguments.length?(n?(r=n.length,e=n):(r=0,e=[]),i.weights(t)):e},sample(){const t=M_();let i=e[r-1],a=n[0],o=0;for(;o<r-1;a+=n[++o])if(t<a){i=e[o];break}return i.sample()},pdf(t){let i=0,a=0;for(;a<r;++a)i+=n[a]*e[a].pdf(t);return i},cdf(t){let i=0,a=0;for(;a<r;++a)i+=n[a]*e[a].cdf(t);return i},icdf(){throw Error("Mixture icdf not supported.")}};return i.distributions(e).weights(t)}function Q_(e,t){return null==t&&(t=null==e?1:e,e=0),e+(t-e)*M_()}function ek(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=t&&e<=n?1/(n-t):0}function tk(e,t,n){return null==n&&(n=null==t?1:t,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function nk(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function rk(e,t){let n,r;const i={min(e){return arguments.length?(n=e||0,i):n},max(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>Q_(n,r),pdf:e=>ek(e,n,r),cdf:e=>tk(e,n,r),icdf:e=>nk(e,n,r)};return null==t&&(t=null==e?1:e,e=0),i.min(e).max(t)}function ik(e,t,n,r){const i=r-e*e,a=Math.abs(i)<1e-24?0:(n-e*t)/i;return[t-a*e,a]}function ak(e,t,n,r){e=e.filter(e=>{let r=t(e),i=n(e);return null!=r&&(r=+r)>=r&&null!=i&&(i=+i)>=i}),r&&e.sort((e,n)=>t(e)-t(n));const i=e.length,a=new Float64Array(i),o=new Float64Array(i);let s,l,u,c=0,d=0,h=0;for(u of e)a[c]=s=+t(u),o[c]=l=+n(u),++c,d+=(s-d)/c,h+=(l-h)/c;for(c=0;c<i;++c)a[c]-=d,o[c]-=h;return[a,o,d,h]}function ok(e,t,n,r){let i,a,o=-1;for(const s of e)i=t(s),a=n(s),null!=i&&(i=+i)>=i&&null!=a&&(a=+a)>=a&&r(i,a,++o)}function sk(e,t,n,r,i){let a=0,o=0;return ok(e,t,n,(e,t)=>{const n=t-i(e),s=t-r;a+=n*n,o+=s*s}),1-a/o}function lk(e,t,n){let r=0,i=0,a=0,o=0,s=0;ok(e,t,n,(e,t)=>{++s,r+=(e-r)/s,i+=(t-i)/s,a+=(e*t-a)/s,o+=(e*e-o)/s});const l=ik(r,i,a,o),u=e=>l[0]+l[1]*e;return{coef:l,predict:u,rSquared:sk(e,t,n,i,u)}}function uk(e,t,n){let r=0,i=0,a=0,o=0,s=0;ok(e,t,n,(e,t)=>{++s,e=Math.log(e),r+=(e-r)/s,i+=(t-i)/s,a+=(e*t-a)/s,o+=(e*e-o)/s});const l=ik(r,i,a,o),u=e=>l[0]+l[1]*Math.log(e);return{coef:l,predict:u,rSquared:sk(e,t,n,i,u)}}function ck(e,t,n){const[r,i,a,o]=ak(e,t,n);let s,l,u,c=0,d=0,h=0,f=0,p=0;ok(e,t,n,(e,t)=>{s=r[p++],l=Math.log(t),u=s*t,c+=(t*l-c)/p,d+=(u-d)/p,h+=(u*l-h)/p,f+=(s*u-f)/p});const[m,g]=ik(d/o,c/o,h/o,f/o),v=e=>Math.exp(m+g*(e-a));return{coef:[Math.exp(m-g*a),g],predict:v,rSquared:sk(e,t,n,o,v)}}function dk(e,t,n){let r=0,i=0,a=0,o=0,s=0,l=0;ok(e,t,n,(e,t)=>{const n=Math.log(e),u=Math.log(t);++l,r+=(n-r)/l,i+=(u-i)/l,a+=(n*u-a)/l,o+=(n*n-o)/l,s+=(t-s)/l});const u=ik(r,i,a,o),c=e=>u[0]*Math.pow(e,u[1]);return u[0]=Math.exp(u[0]),{coef:u,predict:c,rSquared:sk(e,t,n,s,c)}}function hk(e,t,n){const[r,i,a,o]=ak(e,t,n),s=r.length;let l,u,c,d,h=0,f=0,p=0,m=0,g=0;for(l=0;l<s;)u=r[l],c=i[l++],d=u*u,h+=(d-h)/l,f+=(d*u-f)/l,p+=(d*d-p)/l,m+=(u*c-m)/l,g+=(d*c-g)/l;const v=p-h*h,y=h*v-f*f,b=(g*h-m*f)/y,x=(m*v-g*f)/y,w=-b*h,_=e=>b*(e-=a)*e+x*e+w+o;return{coef:[w-x*a+b*a*a+o,x-2*b*a,b],predict:_,rSquared:sk(e,t,n,o,_)}}function fk(e,t,n,r){if(1===r)return lk(e,t,n);if(2===r)return hk(e,t,n);const[i,a,o,s]=ak(e,t,n),l=i.length,u=[],c=[],d=r+1;let h,f,p,m,g;for(h=0;h<d;++h){for(p=0,m=0;p<l;++p)m+=Math.pow(i[p],h)*a[p];for(u.push(m),g=new Float64Array(d),f=0;f<d;++f){for(p=0,m=0;p<l;++p)m+=Math.pow(i[p],h+f);g[f]=m}c.push(g)}c.push(u);const v=function(e){const t=e.length-1,n=[];let r,i,a,o,s;for(r=0;r<t;++r){for(o=r,i=r+1;i<t;++i)Math.abs(e[r][i])>Math.abs(e[r][o])&&(o=i);for(a=r;a<t+1;++a)s=e[a][r],e[a][r]=e[a][o],e[a][o]=s;for(i=r+1;i<t;++i)for(a=t;a>=r;a--)e[a][i]-=e[a][r]*e[r][i]/e[r][r]}for(i=t-1;i>=0;--i){for(s=0,a=i+1;a<t;++a)s+=e[a][i]*n[a];n[i]=(e[t][i]-s)/e[i][i]}return n}(c),y=e=>{let t=s+v[0]+v[1]*(e-=o)+v[2]*e*e;for(h=3;h<d;++h)t+=v[h]*Math.pow(e,h);return t};return{coef:pk(d,v,-o,s),predict:y,rSquared:sk(e,t,n,s,y)}}function pk(e,t,n,r){const i=Array(e);let a,o,s,l;for(a=0;a<e;++a)i[a]=0;for(a=e-1;a>=0;--a)for(s=t[a],l=1,i[a]+=s,o=1;o<=a;++o)l*=(a+1-o)/o,i[a-o]+=s*Math.pow(n,o)*l;return i[0]+=r,i}function mk(e,t,n,r){const[i,a,o,s]=ak(e,t,n,!0),l=i.length,u=Math.max(2,~~(r*l)),c=new Float64Array(l),d=new Float64Array(l),h=new Float64Array(l).fill(1);for(let f=-1;++f<=2;){const e=[0,u-1];for(let n=0;n<l;++n){const t=i[n],r=e[0],o=e[1];let s=0,l=0,u=0,f=0,p=0;const m=1/Math.abs(i[t-i[r]>i[o]-t?r:o]-t||1);for(let e=r;e<=o;++e){const n=i[e],r=a[e],o=gk(Math.abs(t-n)*m)*h[e],c=n*o;s+=o,l+=c,u+=r*o,f+=r*c,p+=n*c}const[g,v]=ik(l/s,u/s,f/s,p/s);c[n]=g+v*t,d[n]=Math.abs(a[n]-c[n]),vk(i,n+1,e)}if(2===f)break;const t=T_(d);if(Math.abs(t)<1e-12)break;for(let n,r,i=0;i<l;++i)n=d[i]/(6*t),h[i]=n>=1?1e-12:(r=1-n*n)*r}return function(e,t,n,r){const i=e.length,a=[];let o,s=0,l=0,u=[];for(;s<i;++s)o=e[s]+n,u[0]===o?u[1]+=(t[s]-u[1])/++l:(l=0,u[1]+=r,u=[o,t[s]],a.push(u));return u[1]+=r,a}(i,c,o,s)}function gk(e){return(e=1-e*e*e)*e*e}function vk(e,t,n){const r=e[t];let i=n[0],a=n[1]+1;if(!(a>=e.length))for(;t>i&&e[a]-r<=r-e[i];)n[0]=++i,n[1]=a,++a}const yk=.1*Math.PI/180;function bk(e,t,n,r){n=n||25,r=Math.max(n,r||200);const i=t=>[t,e(t)],a=t[0],o=t[1],s=o-a,l=s/r,u=[i(a)],c=[];if(n===r){for(let e=1;e<r;++e)u.push(i(a+e/n*s));return u.push(i(o)),u}c.push(i(o));for(let f=n;--f>0;)c.push(i(a+f/n*s));let d=u[0],h=c[c.length-1];for(;h;){const e=i((d[0]+h[0])/2);e[0]-d[0]>=l&&xk(d,e,h)>yk?c.push(e):(d=h,u.push(h),c.pop()),h=c[c.length-1]}return u}function xk(e,t,n){const r=Math.atan2(n[1]-e[1],n[0]-e[0]),i=Math.atan2(t[1]-e[1],t[0]-e[0]);return Math.abs(r-i)}var wk=function(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),a=new Array(i);++r<i;)a[r]=e+r*n;return a};function _k(e){return e&&e.length?1===e.length?e[0]:(t=e,e=>{const n=t.length;let r=1,i=String(t[0](e));for(;r<n;++r)i+="|"+t[r](e);return i}):function(){return""};var t}function kk(e,t,n){return n||e+(t?"_"+t:"")}const Ek=()=>{},Sk={init:Ek,add:Ek,rem:Ek,idx:0},Tk={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||void 0===e.min)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||void 0===e.max)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},Ck=Object.keys(Tk);function Ik(e,t){return Tk[e](t)}function Ak(e,t){return e.idx-t.idx}function Ok(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function Dk(e,t){null!=e&&""!==e?e==e&&(++this.valid,this._ops.forEach(n=>n.add(this,e,t))):++this.missing}function Mk(e,t){null!=e&&""!==e?e==e&&(--this.valid,this._ops.forEach(n=>n.rem(this,e,t))):--this.missing}function Nk(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function jk(e,t){const n=t||dm,r=function(e){const t={};e.forEach(e=>t[e.name]=e);const n=e=>{e.req&&e.req.forEach(e=>{t[e]||n(t[e]=Tk[e]())})};return e.forEach(n),Object.values(t).sort(Ak)}(e),i=e.slice().sort(Ak);function a(e){this._ops=r,this._out=i,this.cell=e,this.init()}return a.prototype.init=Ok,a.prototype.add=Dk,a.prototype.rem=Mk,a.prototype.set=Nk,a.prototype.get=n,a.fields=e.map(e=>e.out),a}function Fk(e){this._key=e?um(e):Lw,this.reset()}Ck.forEach(e=>{Tk[e]=function(e,t){return n=>ig({name:e,out:n||e},Sk,t)}(e,Tk[e])});const Rk=Fk.prototype;function Pk(e){g_.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}function Lk(e){g_.call(this,null,e)}function Bk(e,t,n){const r=e;let i=t||[],a=n||[],o={},s=0;return{add:e=>a.push(e),remove:e=>o[r(e)]=++s,size:()=>i.length,data:(e,t)=>(s&&(i=i.filter(e=>!o[r(e)]),o={},s=0),t&&e&&i.sort(e),a.length&&(i=e?kg(e,i,a.sort(e)):i.concat(a),a=[]),i)}}function $k(e){g_.call(this,[],e)}function zk(e){Zw.call(this,null,Uk,e)}function Uk(e){return this.value&&!e.modified()?this.value:Zm(e.fields,e.orders)}function Hk(e){g_.call(this,null,e)}function Wk(e){g_.call(this,null,e)}Rk.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},Rk.add=function(e){this._add.push(e)},Rk.rem=function(e){this._rem.push(e)},Rk.values=function(){if(this._get=null,0===this._rem.length)return this._add;const e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,a=Array(r-i),o={};let s,l,u;for(s=0;s<i;++s)o[n(t[s])]=1;for(s=0,l=0;s<r;++s)o[n(u=e[s])]?o[n(u)]=0:a[l++]=u;return this._rem=[],this._add=a},Rk.distinct=function(e){const t=this.values(),n={};let r,i=t.length,a=0;for(;--i>=0;)r=e(t[i])+"",lg(n,r)||(n[r]=1,++a);return a},Rk.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=og(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},Rk.argmin=function(e){return this.extent(e)[0]||{}},Rk.argmax=function(e){return this.extent(e)[1]||{}},Rk.min=function(e){const t=this.extent(e)[0];return null!=t?e(t):void 0},Rk.max=function(e){const t=this.extent(e)[1];return null!=t?e(t):void 0},Rk.quartile=function(e){return this._get===e&&this._q||(this._q=A_(this.values(),e),this._get=e),this._q},Rk.q1=function(e){return this.quartile(e)[0]},Rk.q2=function(e){return this.quartile(e)[1]},Rk.q3=function(e){return this.quartile(e)[2]},Rk.ci=function(e){return this._get===e&&this._ci||(this._ci=j_(this.values(),1e3,.05,e),this._get=e),this._ci},Rk.ci0=function(e){return this.ci(e)[0]},Rk.ci1=function(e){return this.ci(e)[1]},Pk.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Ck},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},hg(Pk,g_,{transform(e,t){const n=this,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.modified();return n.stamp=r.stamp,n.value&&(i||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(e):{},t.visit(t.SOURCE,e=>n.add(e))):(n.value=n.value||n.init(e),t.visit(t.REM,e=>n.rem(e)),t.visit(t.ADD,e=>n.add(e))),r.modifies(n._outputs),n._drop=!1!==e.drop,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&r.clean(!0).runAfter(()=>this.clean()),n.changes(r)},cross(){const e=this,t=e.value,n=e._dnames,r=n.map(()=>({})),i=n.length;function a(e){let t,a,o,s;for(t in e)for(o=e[t].tuple,a=0;a<i;++a)r[a][s=o[n[a]]]=s}a(e._prev),a(t),function a(o,s,l){const u=n[l],c=r[l++];for(const n in c){const r=o?o+"|"+n:n;s[u]=c[n],l<i?a(r,s,l):t[r]||e.cell(r,s)}}("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],r={};function i(e){const n=Ym(rm(e)),i=n.length;let a,o=0;for(;o<i;++o)r[a=n[o]]||(r[a]=1,t.push(a))}this._dims=Ym(e.groupby),this._dnames=this._dims.map(e=>{const t=nm(e);return i(e),n.push(t),t}),this.cellkey=e.key?e.key:_k(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const a=e.fields||[null],o=e.ops||["count"],s=e.as||[],l=a.length,u={};let c,d,h,f,p,m;for(l!==o.length&&sm("Unmatched number of fields and aggregate ops."),m=0;m<l;++m)c=a[m],d=o[m],null==c&&"count"!==d&&sm("Null aggregate field specified."),f=nm(c),p=kk(d,f,s[m]),n.push(p),"count"!==d?(h=u[f],h||(i(c),h=u[f]=[],h.field=c,this._measures.push(h)),"count"!==d&&(this._countOnly=!1),h.push(Ik(d,p))):this._counts.push(p);return this._measures=this._measures.map(e=>jk(e,e.field)),{}},cellkey:_k(),cell(e,t){let n=this.value[e];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const e=this._measures,t=e.length;n.agg=Array(t);for(let r=0;r<t;++r)n.agg[r]=new e[r](n)}return n.store&&(n.data=new Fk),n},newtuple(e,t){const n=this._dnames,r=this._dims,i=r.length,a={};for(let o=0;o<i;++o)a[n[o]]=r[o](e);return t?Hw(t.tuple,a):$w(a)},clean(){const e=this.value;for(const t in e)0===e[t].num&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const r=n.agg;for(let i=0,a=r.length;i<a;++i)r[i].add(r[i].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const r=n.agg;for(let i=0,a=r.length;i<a;++i)r[i].rem(r[i].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let r=0,i=n.length;r<i;++r)t[n[r]]=e.num;if(!this._countOnly){const n=e.agg;for(let e=0,r=n.length;e<r;++e)n[e].set(t)}return t},changes(e){const t=this._adds,n=this._mods,r=this._prev,i=this._drop,a=e.add,o=e.rem,s=e.mod;let l,u,c,d;if(r)for(u in r)l=r[u],i&&!l.num||o.push(l.tuple);for(c=0,d=this._alen;c<d;++c)a.push(this.celltuple(t[c])),t[c]=null;for(c=0,d=this._mlen;c<d;++c)l=n[c],(0===l.num&&i?o:s).push(this.celltuple(l)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}}),Lk.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},hg(Lk,g_,{transform(e,t){const n=!1!==e.interval,r=this._bins(e),i=r.start,a=r.step,o=e.as||["bin0","bin1"],s=o[0],l=o[1];let u;return u=e.modified()?(t=t.reflow(!0)).SOURCE:t.modified(rm(e.field))?t.ADD_MOD:t.ADD,t.visit(u,n?e=>{const t=r(e);e[s]=t,e[l]=null==t?null:i+a*(1+(t-i)/a)}:e=>e[s]=r(e)),t.modifies(n?o:s)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=D_(e),r=n.step;let i,a,o=n.start,s=o+Math.ceil((n.stop-o)/r)*r;null!=(i=e.anchor)&&(a=i-(o+r*Math.floor((i-o)/r)),o+=a,s+=a);const l=function(e){let n=Om(t(e));return null==n?null:n<o?-1/0:n>s?1/0:(n=Math.max(o,Math.min(n,s-r)),o+r*Math.floor(1e-14+(n-o)/r))};return l.start=o,l.stop=n.stop,l.step=r,this.value=tm(l,rm(t),e.name||"bin_"+nm(t))}}),$k.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},hg($k,g_,{transform(e,t){const n=t.fork(t.ALL),r=Bk(Lw,this.value,n.materialize(n.ADD).add),i=e.sort,a=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(a),this.value=n.source=r.data(Ww(i),a),t.source&&t.source.root&&(this.value.root=t.source.root),n}}),hg(zk,Zw),Hk.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},hg(Hk,g_,{transform(e,t){const n=t=>n=>{for(var r,i=function(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase()}return e.match(n)}(s(n),e.case,a)||[],l=0,u=i.length;l<u;++l)o.test(r=i[l])||t(r)},r=this._parameterCheck(e,t),i=this._counts,a=this._match,o=this._stop,s=e.field,l=e.as||["text","count"],u=n(e=>i[e]=1+(i[e]||0)),c=n(e=>i[e]-=1);return r?t.visit(t.SOURCE,u):(t.visit(t.ADD,u),t.visit(t.REM,c)),this._finish(t,l)},_parameterCheck(e,t){let n=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],a=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS);let s,l,u;for(s in n)l=r[s],u=n[s]||0,!l&&u?(r[s]=l=$w({}),l[i]=s,l[a]=u,o.add.push(l)):0===u?(l&&o.rem.push(l),n[s]=null,r[s]=null):l[a]!==u&&(l[a]=u,o.mod.push(l));return o.modifies(t)}}),Wk.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},hg(Wk,g_,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],a=r[1],o=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let s=this.value;return o?(s&&(n.rem=s),s=t.materialize(t.SOURCE).source,n.add=this.value=function(e,t,n,r){for(var i,a,o=[],s={},l=e.length,u=0;u<l;++u)for(s[t]=a=e[u],i=0;i<l;++i)s[n]=e[i],r(s)&&(o.push($w(s)),(s={})[t]=a);return o}(s,i,a,e.filter||pm)):n.mod=s,n.source=this.value,n.modifies(r)}});const Vk={kde:q_,mixture:J_,normal:V_,lognormal:Z_,uniform:rk};function qk(e){g_.call(this,null,e)}const Gk=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}];function Yk(e,t){return e?e.map((e,n)=>t[n]||nm(e)):null}function Xk(e,t,n){const r=[],i=e=>e(l);let a,o,s,l,u,c;if(null==t)r.push(e.map(n));else for(a={},o=0,s=e.length;o<s;++o)l=e[o],u=t.map(i),c=a[u],c||(a[u]=c=[],c.dims=u,r.push(c)),c.push(n(l));return r}function Kk(e){g_.call(this,null,e)}function Zk(e){Zw.call(this,null,Jk,e),this.modified(!0)}function Jk(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:tm(n=>t(n,e),rm(t),nm(t))}function Qk(e){g_.call(this,[void 0,void 0],e)}function eE(e,t){Zw.call(this,e),this.parent=t,this.count=0}function tE(e){g_.call(this,{},e),this._keys=cg();const t=this._targets=[];t.active=0,t.forEach=e=>{for(let n=0,r=t.active;n<r;++n)e(t[n],n,t)}}function nE(e){Zw.call(this,null,rE,e)}function rE(e){return this.value&&!e.modified()?this.value:km(e.name)?Ym(e.name).map(e=>um(e)):um(e.name,e.as)}function iE(e){g_.call(this,cg(),e)}function aE(e){g_.call(this,[],e)}function oE(e){g_.call(this,[],e)}function sE(e){g_.call(this,null,e)}function lE(e){g_.call(this,[],e)}qk.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:Gk.concat({key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:Gk},{name:"weights",type:"number",array:!0}]})},{name:"as",type:"string",array:!0,default:["value","density"]}]},hg(qk,g_,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=function e(t,n){const r=t.function;lg(Vk,r)||sm("Unknown distribution function: "+r);const i=Vk[r]();for(const a in t)"field"===a?i.data((t.from||n()).map(t[a])):"distributions"===a?i[a](t[a].map(t=>e(t,n))):"function"==typeof i[a]&&i[a](t[a]);return i}(e.distribution,function(e){return()=>e.materialize(e.SOURCE).source}(t)),i=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200;let o=e.method||"pdf";"pdf"!==o&&"cdf"!==o&&sm("Invalid density method: "+o),e.extent||r.data||sm("Missing density extent parameter."),o=r[o];const s=e.as||["value","density"],l=bk(o,e.extent||ag(r.data()),i,a).map(e=>{const t={};return t[s[0]]=e[0],t[s[1]]=e[1],$w(t)});this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}}),Kk.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]},hg(Kk,g_,{transform(e,t){if(this.value&&!e.modified()&&!t.changed())return t;const n=t.materialize(t.SOURCE).source,r=Xk(t.source,e.groupby,dm),i=e.smooth||!1,a=e.field,o=e.step||((e,t)=>Tg(ag(e,t))/30)(n,a),s=Ww((e,t)=>a(e)-a(t)),l=e.as||"bin",u=r.length;let c,d=1/0,h=-1/0,f=0;for(;f<u;++f){const e=r[f].sort(s);c=-1;for(const t of F_(e,o,i,a))t<d&&(d=t),t>h&&(h=t),e[++c][l]=t}return this.value={start:d,stop:h,step:o},t.reflow(!0).modifies(l)}}),hg(Zk,Zw),Qk.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},hg(Qk,g_,{transform(e,t){const n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field");let a=n[0],o=n[1];if((i||null==a)&&(a=1/0,o=-1/0),t.visit(i?t.SOURCE:t.ADD,e=>{const t=Om(r(e));null!=t&&(t<a&&(a=t),t>o&&(o=t))}),!Number.isFinite(a)||!Number.isFinite(o)){let e=nm(r);e&&(e=' for field "'.concat(e,'"')),t.dataflow.warn("Infinite extent".concat(e,": [").concat(a,", ").concat(o,"]")),a=o=void 0}this.value=[a,o]}}),hg(eE,Zw,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}}),hg(tE,g_,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,r){const i=this.value;let a,o,s=lg(i,e)&&i[e];return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(o=r||(o=this._group[e])&&o.tuple,a=n.dataflow,s=new eE(n.fork(n.NO_SOURCE),this),a.add(s).connect(t(a,e,o)),i[e]=s,this.activate(s)),s},clean(){const e=this.value;for(const t in e)if(0===e[t].count){const n=e[t].detachSubflow;n&&n(),delete e[t]}},initTargets(){const e=this._targets,t=e.length;for(let n=0;n<t&&null!=e[n];++n)e[n]=null;e.active=0},transform(e,t){const n=t.dataflow,r=e.key,i=e.subflow,a=this._keys,o=e.modified("key"),s=e=>this.subflow(e,i,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,e=>{const t=Lw(e),n=a.get(t);void 0!==n&&(a.delete(t),s(n).rem(e))}),t.visit(t.ADD,e=>{const t=r(e);a.set(Lw(e),t),s(t).add(e)}),o||t.modified(r.fields)?t.visit(t.MOD,e=>{const t=Lw(e),n=a.get(t),i=r(e);n===i?s(i).mod(e):(a.set(t,i),s(n).rem(e),s(i).add(e))}):t.changed(t.MOD)&&t.visit(t.MOD,e=>{s(a.get(Lw(e))).mod(e)}),o&&t.visit(t.REFLOW,e=>{const t=Lw(e),n=a.get(t),i=r(e);n!==i&&(a.set(t,i),s(n).rem(e),s(i).add(e))}),t.clean()?n.runAfter(()=>{this.clean(),a.clean()}):a.empty>n.cleanThreshold&&n.runAfter(a.clean),t}}),hg(nE,Zw),iE.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},hg(iE,g_,{transform(e,t){const n=t.dataflow,r=this.value,i=t.fork(),a=i.add,o=i.rem,s=i.mod,l=e.expr;let u=!0;function c(t){const n=Lw(t),i=l(t,e),c=r.get(n);i&&c?(r.delete(n),a.push(t)):i||c?u&&i&&!c&&s.push(t):(r.set(n,1),o.push(t))}return t.visit(t.REM,e=>{const t=Lw(e);r.has(t)?r.delete(t):o.push(e)}),t.visit(t.ADD,t=>{l(t,e)?a.push(t):r.set(Lw(t),1)}),t.visit(t.MOD,c),e.modified()&&(u=!1,t.visit(t.REFLOW,c)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}}),aE.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},hg(aE,g_,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=Yk(r,e.as||[]),a=e.index||null,o=i.length;return n.rem=this.value,t.visit(t.SOURCE,e=>{const t=r.map(t=>t(e)),s=t.reduce((e,t)=>Math.max(e,t.length),0);let l,u,c,d=0;for(;d<s;++d){for(u=zw(e),l=0;l<o;++l)u[i[l]]=null==(c=t[l][d])?null:c;a&&(u[a]=d),n.add.push(u)}}),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(i)}}),oE.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},hg(oE,g_,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(nm),a=e.as||["key","value"],o=a[0],s=a[1],l=r.length;return n.rem=this.value,t.visit(t.SOURCE,e=>{for(let t,a=0;a<l;++a)t=zw(e),t[o]=i[a],t[s]=r[a](e),n.add.push(t)}),this.value=n.source=n.add,n.modifies(a)}}),sE.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},hg(sE,g_,{transform(e,t){const n=e.expr,r=e.as,i=e.modified(),a=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;return i&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(r),t.visit(a,t=>t[r]=n(t,e))}}),hg(lE,g_,{transform(e,t){const n=t.fork(t.ALL),r=e.generator;let i,a,o,s=this.value,l=e.size-s.length;if(l>0){for(i=[];--l>=0;)i.push(o=$w(r(e))),s.push(o);n.add=n.add.length?n.materialize(n.ADD).add.concat(i):i}else a=s.slice(0,-l),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(a):a,s=s.slice(-l);return n.source=this.value=s,n}});const uE={value:"value",median:T_,mean:function(e,t){let n=0,r=0;if(void 0===t)for(let i of e)null!=i&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let a of e)null!=(a=t(a,++i,e))&&(a=+a)>=a&&(++n,r+=a)}if(n)return r/n},min:w_,max:x_},cE=[];function dE(e){g_.call(this,[],e)}function hE(e){Pk.call(this,e)}function fE(e){g_.call(this,null,e)}function pE(e){Zw.call(this,null,mE,e)}function mE(e){return this.value&&!e.modified()?this.value:xg(e.fields,e.flat)}function gE(e){g_.call(this,[],e),this._pending=null}function vE(e,t,n){n.forEach($w);const r=t.fork(t.NO_FIELDS&t.NO_SOURCE);return r.rem=e.value,e.value=r.source=r.add=n,e._pending=null,r.rem.length&&r.clean(!0),r}function yE(e){g_.call(this,{},e)}function bE(e){Zw.call(this,null,xE,e)}function xE(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let r,i,a=1/0,o=-1/0;for(r=0;r<n;++r)i=t[r],i[0]<a&&(a=i[0]),i[1]>o&&(o=i[1]);return[a,o]}function wE(e){Zw.call(this,null,_E,e)}function _E(e){return this.value&&!e.modified()?this.value:e.values.reduce((e,t)=>e.concat(t),[])}function kE(e){g_.call(this,null,e)}function EE(e){Pk.call(this,e)}function SE(e){tE.call(this,e)}function TE(e){g_.call(this,null,e)}function CE(e){g_.call(this,null,e)}function IE(e){g_.call(this,null,e)}function AE(e){g_.call(this,null,e)}function OE(e){g_.call(this,[],e),this.count=0}function DE(e){g_.call(this,null,e)}function ME(e){g_.call(this,null,e),this.modified(!0)}function NE(e){g_.call(this,null,e)}dE.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},hg(dE,g_,{transform(e,t){var n,r,i,a,o,s,l,u,c,d,h=t.fork(t.ALL),f=function(e){var t,n=e.method||uE.value;if(null!=uE[n])return n===uE.value?(t=void 0!==e.value?e.value:0,()=>t):uE[n];sm("Unrecognized imputation method: "+n)}(e),p=function(e){const t=e.field;return e=>e?t(e):NaN}(e),m=nm(e.field),g=nm(e.key),v=(e.groupby||[]).map(nm),y=function(e,t,n,r){var i,a,o,s,l,u,c,d,h=e=>e(d),f=[],p=r?r.slice():[],m={},g={};for(p.forEach((e,t)=>m[e]=t+1),s=0,c=e.length;s<c;++s)u=n(d=e[s]),l=m[u]||(m[u]=p.push(u)),(o=g[a=(i=t?t.map(h):cE)+""])||(o=g[a]=[],f.push(o),o.values=i),o[l-1]=d;return f.domain=p,f}(t.source,e.groupby,e.key,e.keyvals),b=[],x=this.value,w=y.domain.length;for(o=0,u=y.length;o<u;++o)for(i=(n=y[o]).values,r=NaN,l=0;l<w;++l)if(null==n[l]){for(a=y.domain[l],d={_impute:!0},s=0,c=i.length;s<c;++s)d[v[s]]=i[s];d[g]=a,d[m]=Number.isNaN(r)?r=f(n,p):r,b.push($w(d))}return b.length&&(h.add=h.materialize(h.ADD).add.concat(b)),x.length&&(h.rem=h.materialize(h.REM).rem.concat(x)),this.value=b,h}}),hE.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Ck},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},hg(hE,Pk,{transform(e,t){const n=this,r=e.modified();let i;return n.value&&(r||t.modified(n._inputs,!0))?(i=n.value=r?n.init(e):{},t.visit(t.SOURCE,e=>n.add(e))):(i=n.value=n.value||this.init(e),t.visit(t.REM,e=>n.rem(e)),t.visit(t.ADD,e=>n.add(e))),n.changes(),t.visit(t.SOURCE,e=>{ig(e,i[n.cellkey(e)].tuple)}),t.reflow(r).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(e[n]),e[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}}),fE.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},hg(fE,g_,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=Xk(r,e.groupby,e.field),a=(e.groupby||[]).map(nm),o=e.bandwidth,s=e.cumulative?"cdf":"pdf",l=e.as||["value","density"],u=[];let c=e.extent,d=e.steps||e.minsteps||25,h=e.steps||e.maxsteps||200;"pdf"!==s&&"cdf"!==s&&sm("Invalid density method: "+s),"shared"===e.resolve&&(c||(c=ag(r,e.field)),d=h=e.steps||h),i.forEach(t=>{const n=q_(t,o)[s],r=e.counts?t.length:1;bk(n,c||ag(t),d,h).forEach(e=>{const n={};for(let r=0;r<a.length;++r)n[a[r]]=t.dims[r];n[l[0]]=e[0],n[l[1]]=e[1]*r,u.push($w(n))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}}),hg(pE,Zw),hg(gE,g_,{transform(e,t){const n=t.dataflow;return this._pending?vE(this,t,this._pending):function(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}(e)?t.StopPropagation:e.values?vE(this,t,n.parse(e.values,e.format)):e.async?{async:n.request(e.url,e.format).then(e=>(this._pending=Ym(e.data),e=>e.touch(this)))}:n.request(e.url,e.format).then(e=>vE(this,t,Ym(e.data)))}}),yE.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},hg(yE,g_,{transform(e,t){const n=e.fields,r=e.index,i=e.values,a=null==e.default?null:e.default,o=e.modified(),s=n.length;let l,u,c,d=o?t.SOURCE:t.ADD,h=t,f=e.as;return i?(u=i.length,s>1&&!f&&sm('Multi-field lookup requires explicit "as" parameter.'),f&&f.length!==s*u&&sm('The "as" parameter has too few output field names.'),f=f||i.map(nm),l=function(e){for(var t,o,l=0,c=0;l<s;++l)if(null==(o=r.get(n[l](e))))for(t=0;t<u;++t,++c)e[f[c]]=a;else for(t=0;t<u;++t,++c)e[f[c]]=i[t](o)}):(f||sm("Missing output field names."),l=function(e){for(var t,i=0;i<s;++i)t=r.get(n[i](e)),e[f[i]]=null==t?a:t}),o?h=t.reflow(!0):(c=n.some(e=>t.modified(e.fields)),d|=c?t.MOD:0),t.visit(d,l),h.modifies(f)}}),hg(bE,Zw),hg(wE,Zw),hg(kE,g_,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),EE.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Ck,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},hg(EE,Pk,{_transform:Pk.prototype.transform,transform(e,t){return this._transform(function(e,t){const n=e.field,r=e.value,i=("count"===e.op?"__count__":e.op)||"sum",a=rm(n).concat(rm(r)),o=function(e,t,n){const r={},i=[];return n.visit(n.SOURCE,t=>{const n=e(t);r[n]||(r[n]=1,i.push(n))}),i.sort(Jm),t?i.slice(0,t):i}(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:o.map(()=>i),fields:o.map(e=>function(e,t,n,r){return tm(r=>t(r)===e?n(r):NaN,r,e+"")}(e,n,r,a)),as:o.map(e=>e+""),modified:e.modified.bind(e)}}(e,t),t)}}),hg(SE,tE,{transform(e,t){const n=e.subflow,r=e.field,i=e=>this.subflow(Lw(e),n,t,e);return(e.modified("field")||r&&t.modified(rm(r)))&&sm("PreFacet does not support field modification."),this.initTargets(),r?(t.visit(t.MOD,e=>{const t=i(e);r(e).forEach(e=>t.mod(e))}),t.visit(t.ADD,e=>{const t=i(e);r(e).forEach(e=>t.add($w(e)))}),t.visit(t.REM,e=>{const t=i(e);r(e).forEach(e=>t.rem(e))})):(t.visit(t.MOD,e=>i(e).mod(e)),t.visit(t.ADD,e=>i(e).add(e)),t.visit(t.REM,e=>i(e).rem(e))),t.clean()&&t.runAfter(()=>this.clean()),t}}),TE.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},hg(TE,g_,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=Yk(e.fields,e.as||[]),a=r?(e,t)=>function(e,t,n,r){for(let i=0,a=n.length;i<a;++i)t[r[i]]=n[i](e);return t}(e,t,r,i):Uw;let o;return this.value?o=this.value:(t=t.addAll(),o=this.value={}),t.visit(t.REM,e=>{const t=Lw(e);n.rem.push(o[t]),o[t]=null}),t.visit(t.ADD,e=>{const t=a(e,$w({}));o[Lw(e)]=t,n.add.push(t)}),t.visit(t.MOD,e=>{n.mod.push(a(e,o[Lw(e)]))}),n}}),hg(CE,g_,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}}),IE.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]},hg(IE,g_,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const i=Xk(t.materialize(t.SOURCE).source,e.groupby,e.field),a=(e.groupby||[]).map(nm),o=[],s=e.step||.01,l=e.probs||wk(s/2,1-1e-14,s),u=l.length;return i.forEach(e=>{const t=I_(e,l);for(let n=0;n<u;++n){const i={};for(let t=0;t<a.length;++t)i[a[t]]=e.dims[t];i[r[0]]=l[n],i[r[1]]=t[n],o.push($w(i))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=o,n}}),hg(AE,g_,{transform(e,t){let n,r;return this.value?r=this.value:(n=t=t.addAll(),r=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,e=>{const t=Lw(e);n.rem.push(r[t]),r[t]=null}),t.visit(t.ADD,e=>{const t=zw(e);r[Lw(e)]=t,n.add.push(t)}),t.visit(t.MOD,e=>{const t=r[Lw(e)];for(const r in e)t[r]=e[r],n.modifies(r);n.mod.push(t)})),n}}),OE.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},hg(OE,g_,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,a=this.value.reduce((e,t)=>(e[Lw(t)]=1,e),{});let o=this.value,s=this.count,l=0;function u(e){let t,r;o.length<i?o.push(e):(r=~~((s+1)*M_()),r<o.length&&r>=l&&(t=o[r],a[Lw(t)]&&n.rem.push(t),o[r]=e)),++s}if(t.rem.length&&(t.visit(t.REM,e=>{const t=Lw(e);a[t]&&(a[t]=-1,n.rem.push(e)),--s}),o=o.filter(e=>-1!==a[Lw(e)])),(t.rem.length||r)&&o.length<i&&t.source&&(l=s=o.length,t.visit(t.SOURCE,e=>{a[Lw(e)]||u(e)}),l=-1),r&&o.length>i){const e=o.length-i;for(let t=0;t<e;++t)a[Lw(o[t])]=-1,n.rem.push(o[t]);o=o.slice(e)}return t.mod.length&&t.visit(t.MOD,e=>{a[Lw(e)]&&n.mod.push(e)}),t.add.length&&t.visit(t.ADD,u),(t.add.length||l<0)&&(n.add=o.filter(e=>!a[Lw(e)])),this.count=s,this.value=n.source=o,n}}),DE.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},hg(DE,g_,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),r=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=wk(e.start,e.stop,e.step||1).map(e=>{const t={};return t[r]=e,$w(t)}),n.add=t.add.concat(this.value),n}}),hg(ME,g_,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});const jE=["unit0","unit1"];function FE(e){g_.call(this,cg(),e)}function RE(e){g_.call(this,null,e)}NE.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:Iy,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:jE}]},hg(NE,g_,{transform(e,t){const n=e.field,r=!1!==e.interval,i="utc"===e.timezone,a=this._floor(e,t),o=(i?ib:rb)(a.unit).offset,s=e.as||jE,l=s[0],u=s[1],c=a.step;let d=a.start||1/0,h=a.stop||-1/0,f=t.ADD;return(e.modified()||t.modified(rm(n)))&&(f=(t=t.reflow(!0)).SOURCE,d=1/0,h=-1/0),t.visit(f,e=>{const t=n(e);let i,s;null==t?(e[l]=null,r&&(e[u]=null)):(e[l]=i=s=a(t),r&&(e[u]=s=o(i,c)),i<d&&(d=i),s>h&&(h=s))}),a.start=d,a.stop=h,t.modifies(r?s:l)},_floor(e,t){const n="utc"===e.timezone,{units:r,step:i}=e.units?{units:e.units,step:e.step||1}:xb({extent:e.extent||ag(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),a=Oy(r),o=this.value||{},s=(n?eb:Zy)(a,i);return s.unit=Am(a),s.units=a,s.step=i,s.start=o.start,s.stop=o.stop,this.value=s}}),hg(FE,g_,{transform(e,t){const n=t.dataflow,r=e.field,i=this.value,a=e=>i.set(r(e),e);let o=!0;return e.modified("field")||t.modified(r.fields)?(i.clear(),t.visit(t.SOURCE,a)):t.changed()?(t.visit(t.REM,e=>i.delete(r(e))),t.visit(t.ADD,a)):o=!1,this.modified(o),i.empty>n.cleanThreshold&&n.runAfter(i.clean),t.fork()}}),hg(RE,g_,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(Ww(e.sort)):t.source).map(e.field))}});const PE={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){const e=PE.rank(),t=e.next;return{init:e.init,next:e=>(t(e)-1)/(e.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,r=t.compare;let i=t.index;if(e<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){(t=+t)>0||sm("ntile num must be greater than zero.");const n=PE.cume_dist(),r=n.next;return{init:n.init,next:e=>Math.ceil(t*r(e))}},lag:function(e,t){return t=+t||1,{next:n=>{const r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return(t=+t)>0||sm("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const r=e(n.data[n.index]);return null!=r?t=r:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:r=>{const i=r.data;return r.index<=n?t:(n=function(e,t,n){for(let r=t.length;n<r;++n)if(null!=e(t[n]))return n;return-1}(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}},LE=Object.keys(PE);function BE(e){const t=Ym(e.ops),n=Ym(e.fields),r=Ym(e.params),i=Ym(e.as),a=this.outputs=[],o=this.windows=[],s={},l={},u=[],c=[];let d=!0;function h(e){Ym(rm(e)).forEach(e=>s[e]=1)}h(e.sort),t.forEach((e,t)=>{const s=n[t],f=nm(s),p=kk(e,f,i[t]);if(h(s),a.push(p),lg(PE,e))o.push(function(e,t,n,r){const i=PE[e](t,n);return{init:i.init||hm,update:function(e,t){t[r]=i.next(e)}}}(e,n[t],r[t],p));else{if(null==s&&"count"!==e&&sm("Null aggregate field specified."),"count"===e)return void u.push(p);d=!1;let t=l[f];t||(t=l[f]=[],t.field=s,c.push(t)),t.push(Ik(e,p))}}),(u.length||c.length)&&(this.cell=function(e,t,n){e=e.map(e=>jk(e,e.field));const r={num:0,agg:null,store:!1,count:t};if(!n)for(var i=e.length,a=r.agg=Array(i),o=0;o<i;++o)a[o]=new e[o](r);if(r.store)var s=r.data=new Fk;return r.add=function(e){if(r.num+=1,!n){s&&s.add(e);for(let t=0;t<i;++t)a[t].add(a[t].get(e),e)}},r.rem=function(e){if(r.num-=1,!n){s&&s.rem(e);for(let t=0;t<i;++t)a[t].rem(a[t].get(e),e)}},r.set=function(e){let i,o;for(s&&s.values(),i=0,o=t.length;i<o;++i)e[t[i]]=r.num;if(!n)for(i=0,o=a.length;i<o;++i)a[i].set(e)},r.init=function(){r.num=0,s&&s.reset();for(let e=0;e<i;++e)a[e].init()},r}(c,u,d)),this.inputs=Object.keys(s)}const $E=BE.prototype;function zE(e){g_.call(this,{},e),this._mlen=0,this._mods=[]}function UE(e,t,n,r){const i=r.sort,a=i&&!r.ignorePeers,o=r.frame||[null,0],s=e.data(n),l=s.length,u=a?gy(i):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:i||ng(-1)};t.init();for(let d=0;d<l;++d)HE(c,o,d,l),a&&WE(c,u),t.update(c,s[d])}function HE(e,t,n,r){e.p0=e.i0,e.p1=e.i1,e.i0=null==t[0]?0:Math.max(0,n-Math.abs(t[0])),e.i1=null==t[1]?r:Math.min(r,n+Math.abs(t[1])+1),e.index=n}function WE(e,t){const n=e.i0,r=e.i1-1,i=e.compare,a=e.data,o=a.length-1;n>0&&!i(a[n],a[n-1])&&(e.i0=t.left(a,a[n])),r<o&&!i(a[r],a[r+1])&&(e.i1=t.right(a,a[r]))}function VE(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function qE(e){this._context=e}$E.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()},$E.update=function(e,t){const n=this.cell,r=this.windows,i=e.data,a=r&&r.length;let o;if(n){for(o=e.p0;o<e.i0;++o)n.rem(i[o]);for(o=e.p1;o<e.i1;++o)n.add(i[o]);n.set(t)}for(o=0;o<a;++o)r[o].update(e,t)},zE.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:LE.concat(Ck)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},hg(zE,g_,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),r=Ww(e.sort),i=_k(e.groupby),a=e=>this.group(i(e));let o=this.state;o&&!n||(o=this.state=new BE(e)),n||t.modified(o.inputs)?(this.value={},t.visit(t.SOURCE,e=>a(e).add(e))):(t.visit(t.REM,e=>a(e).remove(e)),t.visit(t.ADD,e=>a(e).add(e)));for(let s=0,l=this._mlen;s<l;++s)UE(this._mods[s],o,r,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(o.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=Bk(Lw),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}}),qE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:VE(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:VE(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};var GE=function(){};function YE(e){this._context=e}function XE(e){this._context=e}function KE(e,t){this._basis=new qE(e),this._beta=t}YE.prototype={areaStart:GE,areaEnd:GE,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:VE(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},XE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:VE(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},KE.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r,i=e[0],a=t[0],o=e[n]-i,s=t[n]-a,l=-1;++l<=n;)this._basis.point(this._beta*e[l]+(1-this._beta)*(i+(r=l/n)*o),this._beta*t[l]+(1-this._beta)*(a+r*s));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var ZE=function e(t){function n(e){return 1===t?new qE(e):new KE(e,t)}return n.beta=function(t){return e(+t)},n}(.85);function JE(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function QE(e,t){this._context=e,this._k=(1-t)/6}QE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:JE(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:JE(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var eS=function e(t){function n(e){return new QE(e,t)}return n.tension=function(t){return e(+t)},n}(0);function tS(e,t){this._context=e,this._k=(1-t)/6}tS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:JE(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var nS=function e(t){function n(e){return new tS(e,t)}return n.tension=function(t){return e(+t)},n}(0);function rS(e,t){this._context=e,this._k=(1-t)/6}rS.prototype={areaStart:GE,areaEnd:GE,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:JE(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var iS=function e(t){function n(e){return new rS(e,t)}return n.tension=function(t){return e(+t)},n}(0),aS=Math.abs,oS=Math.atan2,sS=Math.cos,lS=Math.max,uS=Math.min,cS=Math.sin,dS=Math.sqrt,hS=1e-12,fS=Math.PI,pS=fS/2,mS=2*fS;function gS(e){return e>1?0:e<-1?fS:Math.acos(e)}function vS(e){return e>=1?pS:e<=-1?-pS:Math.asin(e)}function yS(e,t,n){var r=e._x1,i=e._y1,a=e._x2,o=e._y2;if(e._l01_a>hS){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,l=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/l,i=(i*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/l}if(e._l23_a>hS){var u=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*u+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*u+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(r,i,a,o,e._x2,e._y2)}function bS(e,t){this._context=e,this._alpha=t}bS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:yS(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var xS=function e(t){function n(e){return t?new bS(e,t):new QE(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function wS(e,t){this._context=e,this._alpha=t}wS.prototype={areaStart:GE,areaEnd:GE,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:yS(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var _S=function e(t){function n(e){return t?new wS(e,t):new rS(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function kS(e,t){this._context=e,this._alpha=t}kS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:yS(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var ES=function e(t){function n(e){return t?new kS(e,t):new tS(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function SS(e){this._context=e}SS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};var TS=function(e){return new SS(e)};function CS(e){this._context=e}function IS(e){return e<0?-1:1}function AS(e,t,n){var r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),s=(a*i+o*r)/(r+i);return(IS(a)+IS(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function OS(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function DS(e,t,n){var r=e._x0,i=e._x1,a=e._y1,o=(i-r)/3;e._context.bezierCurveTo(r+o,e._y0+o*t,i-o,a-o*n,i,a)}function MS(e){this._context=e}function NS(e){this._context=new jS(e)}function jS(e){this._context=e}function FS(e){this._context=e}function RS(e){var t,n,r=e.length-1,i=new Array(r),a=new Array(r),o=new Array(r);for(i[0]=0,a[0]=2,o[0]=e[0]+2*e[1],t=1;t<r-1;++t)i[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[r-1]=2,a[r-1]=7,o[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)a[t]-=n=i[t]/a[t-1],o[t]-=n*o[t-1];for(i[r-1]=o[r-1]/a[r-1],t=r-2;t>=0;--t)i[t]=(o[t]-i[t+1])/a[t];for(a[r-1]=(e[r]+i[r-1])/2,t=0;t<r-1;++t)a[t]=2*e[t+1]-i[t+1];return[i,a]}function PS(e,t){this._context=e,this._t=t}CS.prototype={areaStart:GE,areaEnd:GE,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}},MS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:DS(this,this._t0,OS(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,DS(this,OS(this,n=AS(this,e,t)),n);break;default:DS(this,this._t0,n=AS(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(NS.prototype=Object.create(MS.prototype)).point=function(e,t){MS.prototype.point.call(this,t,e)},jS.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,a){this._context.bezierCurveTo(t,e,r,n,a,i)}},FS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===n)this._context.lineTo(e[1],t[1]);else for(var r=RS(e),i=RS(t),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],e[o],t[o]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}},PS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};const LS=Math.PI,BS=2*LS,$S=1e-6,zS=BS-$S;function US(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function HS(){return new US}US.prototype=HS.prototype={constructor:US,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(e,t,n,r,i){var a=this._x1,o=this._y1,s=(n=+n)-(e=+e),l=(r=+r)-(t=+t),u=a-e,c=o-t,d=u*u+c*c;if((i=+i)<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(d>$S)if(Math.abs(c*s-l*u)>$S&&i){var h=n-a,f=r-o,p=s*s+l*l,m=h*h+f*f,g=Math.sqrt(p),v=Math.sqrt(d),y=i*Math.tan((LS-Math.acos((p+d-m)/(2*g*v)))/2),b=y/v,x=y/g;Math.abs(b-1)>$S&&(this._+="L"+(e+b*u)+","+(t+b*c)),this._+="A"+i+","+i+",0,0,"+ +(c*h>u*f)+","+(this._x1=e+x*s)+","+(this._y1=t+x*l)}else this._+="L"+(this._x1=e)+","+(this._y1=t)},arc:function(e,t,n,r,i,a){e=+e,t=+t,a=!!a;var o=(n=+n)*Math.cos(r),s=n*Math.sin(r),l=e+o,u=t+s,c=1^a,d=a?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+l+","+u:(Math.abs(this._x1-l)>$S||Math.abs(this._y1-u)>$S)&&(this._+="L"+l+","+u),n&&(d<0&&(d=d%BS+BS),d>zS?this._+="A"+n+","+n+",0,1,"+c+","+(e-o)+","+(t-s)+"A"+n+","+n+",0,1,"+c+","+(this._x1=l)+","+(this._y1=u):d>$S&&(this._+="A"+n+","+n+",0,"+ +(d>=LS)+","+c+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var WS=HS,VS=function(e){return function(){return e}};function qS(e){return e.innerRadius}function GS(e){return e.outerRadius}function YS(e){return e.startAngle}function XS(e){return e.endAngle}function KS(e){return e&&e.padAngle}function ZS(e,t,n,r,i,a,o,s){var l=n-e,u=r-t,c=o-i,d=s-a,h=d*l-c*u;if(!(h*h<hS))return[e+(h=(c*(t-a)-d*(e-i))/h)*l,t+h*u]}function JS(e,t,n,r,i,a,o){var s=e-n,l=t-r,u=(o?a:-a)/dS(s*s+l*l),c=u*l,d=-u*s,h=e+c,f=t+d,p=n+c,m=r+d,g=(h+p)/2,v=(f+m)/2,y=p-h,b=m-f,x=y*y+b*b,w=i-a,_=h*m-p*f,k=(b<0?-1:1)*dS(lS(0,w*w*x-_*_)),E=(_*b-y*k)/x,S=(-_*y-b*k)/x,T=(_*b+y*k)/x,C=(-_*y+b*k)/x,I=E-g,A=S-v,O=T-g,D=C-v;return I*I+A*A>O*O+D*D&&(E=T,S=C),{cx:E,cy:S,x01:-c,y01:-d,x11:E*(i/w-1),y11:S*(i/w-1)}}var QS=function(e){return"object"==typeof e&&"length"in e?e:Array.from(e)};function eT(e){return e[0]}function tT(e){return e[1]}var nT=function(e,t){var n=VS(!0),r=null,i=TS,a=null;function o(o){var s,l,u,c=(o=QS(o)).length,d=!1;for(null==r&&(a=i(u=WS())),s=0;s<=c;++s)!(s<c&&n(l=o[s],s,o))===d&&((d=!d)?a.lineStart():a.lineEnd()),d&&a.point(+e(l,s,o),+t(l,s,o));if(u)return a=null,u+""||null}return e="function"==typeof e?e:void 0===e?eT:VS(e),t="function"==typeof t?t:void 0===t?tT:VS(t),o.x=function(t){return arguments.length?(e="function"==typeof t?t:VS(+t),o):e},o.y=function(e){return arguments.length?(t="function"==typeof e?e:VS(+e),o):t},o.defined=function(e){return arguments.length?(n="function"==typeof e?e:VS(!!e),o):n},o.curve=function(e){return arguments.length?(i=e,null!=r&&(a=i(r)),o):i},o.context=function(e){return arguments.length?(null==e?r=a=null:a=i(r=e),o):r},o},rT=function(e,t,n){var r=null,i=VS(!0),a=null,o=TS,s=null;function l(l){var u,c,d,h,f,p=(l=QS(l)).length,m=!1,g=new Array(p),v=new Array(p);for(null==a&&(s=o(f=WS())),u=0;u<=p;++u){if(!(u<p&&i(h=l[u],u,l))===m)if(m=!m)c=u,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),d=u-1;d>=c;--d)s.point(g[d],v[d]);s.lineEnd(),s.areaEnd()}m&&(g[u]=+e(h,u,l),v[u]=+t(h,u,l),s.point(r?+r(h,u,l):g[u],n?+n(h,u,l):v[u]))}if(f)return s=null,f+""||null}function u(){return nT().defined(i).curve(o).context(a)}return e="function"==typeof e?e:void 0===e?eT:VS(+e),t="function"==typeof t?t:VS(void 0===t?0:+t),n="function"==typeof n?n:void 0===n?tT:VS(+n),l.x=function(t){return arguments.length?(e="function"==typeof t?t:VS(+t),r=null,l):e},l.x0=function(t){return arguments.length?(e="function"==typeof t?t:VS(+t),l):e},l.x1=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:VS(+e),l):r},l.y=function(e){return arguments.length?(t="function"==typeof e?e:VS(+e),n=null,l):t},l.y0=function(e){return arguments.length?(t="function"==typeof e?e:VS(+e),l):t},l.y1=function(e){return arguments.length?(n=null==e?null:"function"==typeof e?e:VS(+e),l):n},l.lineX0=l.lineY0=function(){return u().x(e).y(t)},l.lineY1=function(){return u().x(e).y(n)},l.lineX1=function(){return u().x(r).y(t)},l.defined=function(e){return arguments.length?(i="function"==typeof e?e:VS(!!e),l):i},l.curve=function(e){return arguments.length?(o=e,null!=a&&(s=o(a)),l):o},l.context=function(e){return arguments.length?(null==e?a=s=null:s=o(a=e),l):a},l},iT={draw:function(e,t){var n=Math.sqrt(t/fS);e.moveTo(n,0),e.arc(0,0,n,0,mS)}};function aT(e,t){if("undefined"!=typeof document&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}Math.sqrt(1/3),Math.sin(fS/10),Math.sin(7*fS/10),Math.sin(mS/10),Math.cos(mS/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12);const oT=()=>"undefined"!=typeof Image?Image:null,sT=gy(my),lT=sT.right,uT=sT.left;gy(k_);var cT=lT;function dT(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function hT(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}const fT=Symbol("implicit");function pT(){var e=new Map,t=[],n=[],r=fT;function i(i){var a=i+"",o=e.get(a);if(!o){if(r!==fT)return r;e.set(a,o=t.push(i))}return n[(o-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=new Map;for(const r of n){const n=r+"";e.has(n)||e.set(n,t.push(r))}return i},i.range=function(e){return arguments.length?(n=Array.from(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return pT(t,n).unknown(r)},dT.apply(i,arguments),i}function mT(e,t,n,r){var i,a=kv(e,t,n);switch((r=Sv(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=Nv(a,o))||(r.precision=i),Dv(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=jv(a,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=Fv(a))||(r.precision=i-2*("%"===r.type))}return Ov(r)}var gT=function(e,t,n){e.prototype=t.prototype=n,n.constructor=e};function vT(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function yT(){}var bT=.7,xT=1/bT,wT="\\s*([+-]?\\d+)\\s*",_T="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",kT="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ET=/^#([0-9a-f]{3,8})$/,ST=new RegExp("^rgb\\("+[wT,wT,wT]+"\\)$"),TT=new RegExp("^rgb\\("+[kT,kT,kT]+"\\)$"),CT=new RegExp("^rgba\\("+[wT,wT,wT,_T]+"\\)$"),IT=new RegExp("^rgba\\("+[kT,kT,kT,_T]+"\\)$"),AT=new RegExp("^hsl\\("+[_T,kT,kT]+"\\)$"),OT=new RegExp("^hsla\\("+[_T,kT,kT,_T]+"\\)$"),DT={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function MT(){return this.rgb().formatHex()}function NT(){return this.rgb().formatRgb()}function jT(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=ET.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?FT(t):3===n?new BT(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?RT(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?RT(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=ST.exec(e))?new BT(t[1],t[2],t[3],1):(t=TT.exec(e))?new BT(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=CT.exec(e))?RT(t[1],t[2],t[3],t[4]):(t=IT.exec(e))?RT(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=AT.exec(e))?HT(t[1],t[2]/100,t[3]/100,1):(t=OT.exec(e))?HT(t[1],t[2]/100,t[3]/100,t[4]):DT.hasOwnProperty(e)?FT(DT[e]):"transparent"===e?new BT(NaN,NaN,NaN,0):null}function FT(e){return new BT(e>>16&255,e>>8&255,255&e,1)}function RT(e,t,n,r){return r<=0&&(e=t=n=NaN),new BT(e,t,n,r)}function PT(e){return e instanceof yT||(e=jT(e)),e?new BT((e=e.rgb()).r,e.g,e.b,e.opacity):new BT}function LT(e,t,n,r){return 1===arguments.length?PT(e):new BT(e,t,n,null==r?1:r)}function BT(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function $T(){return"#"+UT(this.r)+UT(this.g)+UT(this.b)}function zT(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function UT(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function HT(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new qT(e,t,n,r)}function WT(e){if(e instanceof qT)return new qT(e.h,e.s,e.l,e.opacity);if(e instanceof yT||(e=jT(e)),!e)return new qT;if(e instanceof qT)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new qT(o,s,l,e.opacity)}function VT(e,t,n,r){return 1===arguments.length?WT(e):new qT(e,t,n,null==r?1:r)}function qT(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function GT(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function YT(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}gT(yT,jT,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:MT,formatHex:MT,formatHsl:function(){return WT(this).formatHsl()},formatRgb:NT,toString:NT}),gT(BT,LT,vT(yT,{brighter:function(e){return e=null==e?xT:Math.pow(xT,e),new BT(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?bT:Math.pow(bT,e),new BT(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:$T,formatHex:$T,formatRgb:zT,toString:zT})),gT(qT,VT,vT(yT,{brighter:function(e){return e=null==e?xT:Math.pow(xT,e),new qT(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?bT:Math.pow(bT,e),new qT(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new BT(GT(e>=240?e-240:e+120,i,r),GT(e,i,r),GT(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));var XT=function(e){return function(){return e}};function KT(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):XT(isNaN(e)?t:e)}var ZT=function e(t){var n=function(e){return 1==(e=+e)?KT:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):XT(isNaN(t)?n:t)}}(t);function r(e,t){var r=n((e=LT(e)).r,(t=LT(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=KT(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function JT(e){return function(t){var n,r,i=t.length,a=new Array(i),o=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=LT(t[n]),a[n]=r.r||0,o[n]=r.g||0,s[n]=r.b||0;return a=e(a),o=e(o),s=e(s),r.opacity=1,function(e){return r.r=a(e),r.g=o(e),r.b=s(e),r+""}}}JT((function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1];return YT((n-r/t)*t,r>0?e[r-1]:2*i-a,i,a,r<t-1?e[r+2]:2*a-i)}})),JT((function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t);return YT((n-r/t)*t,e[(r+t-1)%t],e[r%t],e[(r+1)%t],e[(r+2)%t])}}));var QT=function(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}};function eC(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=sC(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}var tC=function(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}},nC=function(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}},rC=function(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=sC(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}},iC=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,aC=new RegExp(iC.source,"g"),oC=function(e,t){var n,r,i,a=iC.lastIndex=aC.lastIndex=0,o=-1,s=[],l=[];for(e+="",t+="";(n=iC.exec(e))&&(r=aC.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:nC(n,r)})),a=aC.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)s[(n=l[r]).i]=n.x(e);return s.join("")})},sC=function(e,t){var n,r,i=typeof t;return null==t||"boolean"===i?XT(t):("number"===i?nC:"string"===i?(n=jT(t))?(t=n,ZT):oC:t instanceof jT?ZT:t instanceof Date?tC:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?eC:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?rC:nC:QT))(e,t)},lC=function(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}};function uC(e){return+e}var cC=[0,1];function dC(e){return e}function hC(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function fC(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return i<r?(r=hC(i,r),a=n(o,a)):(r=hC(r,i),a=n(a,o)),function(e){return a(r(e))}}function pC(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=hC(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=cT(e,t,1,r)-1;return a[n](i[n](t))}}function mC(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function gC(){var e,t,n,r,i,a,o=cC,s=cC,l=sC,u=dC;function c(){var e,t,n,l=Math.min(o.length,s.length);return u!==dC&&((e=o[0])>(t=o[l-1])&&(n=e,e=t,t=n),u=function(n){return Math.max(e,Math.min(t,n))}),r=l>2?pC:fC,i=a=null,d}function d(t){return isNaN(t=+t)?n:(i||(i=r(o.map(e),s,l)))(e(u(t)))}return d.invert=function(n){return u(t((a||(a=r(s,o.map(e),nC)))(n)))},d.domain=function(e){return arguments.length?(o=Array.from(e,uC),c()):o.slice()},d.range=function(e){return arguments.length?(s=Array.from(e),c()):s.slice()},d.rangeRound=function(e){return s=Array.from(e),l=lC,c()},d.clamp=function(e){return arguments.length?(u=!!e||dC,c()):u!==dC},d.interpolate=function(e){return arguments.length?(l=e,c()):l},d.unknown=function(e){return arguments.length?(n=e,d):n},function(n,r){return e=n,t=r,c()}}function vC(){return gC()(dC,dC)}function yC(e){var t=e.domain;return e.ticks=function(e){var n=t();return wv(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return mT(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i,a=t(),o=0,s=a.length-1,l=a[o],u=a[s],c=10;for(u<l&&(i=l,l=u,u=i,i=o,o=s,s=i);c-- >0;){if((i=_v(l,u,n))===r)return a[o]=l,a[s]=u,t(a);if(i>0)l=Math.floor(l/i)*i,u=Math.ceil(u/i)*i;else{if(!(i<0))break;l=Math.ceil(l*i)/i,u=Math.floor(u*i)/i}r=i}return e},e}function bC(e,t){var n,r=0,i=(e=e.slice()).length-1,a=e[r],o=e[i];return o<a&&(n=r,r=i,i=n,n=a,a=o,o=n),e[r]=t.floor(a),e[i]=t.ceil(o),e}function xC(e){return Math.log(e)}function wC(e){return Math.exp(e)}function _C(e){return-Math.log(-e)}function kC(e){return-Math.exp(-e)}function EC(e){return isFinite(e)?+("1e"+e):e<0?0:e}function SC(e){return function(t){return-e(-t)}}function TC(e){var t,n,r=e(xC,wC),i=r.domain,a=10;function o(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(a),n=function(e){return 10===e?EC:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(a),i()[0]<0?(t=SC(t),n=SC(n),e(_C,kC)):e(xC,wC),r}return r.base=function(e){return arguments.length?(a=+e,o()):a},r.domain=function(e){return arguments.length?(i(e),o()):i()},r.ticks=function(e){var r,o=i(),s=o[0],l=o[o.length-1];(r=l<s)&&(h=s,s=l,l=h);var u,c,d,h=t(s),f=t(l),p=null==e?10:+e,m=[];if(!(a%1)&&f-h<p){if(h=Math.floor(h),f=Math.ceil(f),s>0){for(;h<=f;++h)for(c=1,u=n(h);c<a;++c)if(!((d=u*c)<s)){if(d>l)break;m.push(d)}}else for(;h<=f;++h)for(c=a-1,u=n(h);c>=1;--c)if(!((d=u*c)<s)){if(d>l)break;m.push(d)}2*m.length<p&&(m=wv(s,l,p))}else m=wv(h,f,Math.min(f-h,p)).map(n);return r?m.reverse():m},r.tickFormat=function(e,i){if(null==i&&(i=10===a?".0e":","),"function"!=typeof i&&(i=Ov(i)),e===1/0)return i;null==e&&(e=10);var o=Math.max(1,a*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*a<a-.5&&(r*=a),r<=o?i(e):""}},r.nice=function(){return i(bC(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function CC(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function IC(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function AC(e){return e<0?-e*e:e*e}function OC(e){var t=e(dC,dC),n=1;function r(){return 1===n?e(dC,dC):.5===n?e(IC,AC):e(CC(n),CC(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},yC(t)}function DC(){var e=OC(gC());return e.copy=function(){return mC(e,DC()).exponent(e.exponent())},dT.apply(e,arguments),e}function MC(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function NC(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function jC(e){var t=1,n=e(MC(t),NC(t));return n.constant=function(n){return arguments.length?e(MC(t=+n),NC(t)):t},yC(n)}var FC=kb((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()})),RC=kb((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Eb-e.getMinutes()*Sb)}),(function(e,t){e.setTime(+e+t*Tb)}),(function(e,t){return(t-e)/Tb}),(function(e){return e.getHours()})),PC=kb((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Eb)}),(function(e,t){e.setTime(+e+t*Sb)}),(function(e,t){return(t-e)/Sb}),(function(e){return e.getMinutes()})),LC=kb((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*Eb)}),(function(e,t){return(t-e)/Eb}),(function(e){return e.getUTCSeconds()})),BC=kb((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));BC.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?kb((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):BC:null};var $C=BC;function zC(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function UC(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function HC(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}var WC,VC,qC,GC={"-":"",_:" ",0:"0"},YC=/^\s*\d+/,XC=/^%/,KC=/[\\^$*+?|[\]().{}]/g;function ZC(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function JC(e){return e.replace(KC,"\\$&")}function QC(e){return new RegExp("^(?:"+e.map(JC).join("|")+")","i")}function eI(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function tI(e,t,n){var r=YC.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function nI(e,t,n){var r=YC.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function rI(e,t,n){var r=YC.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function iI(e,t,n){var r=YC.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function aI(e,t,n){var r=YC.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function oI(e,t,n){var r=YC.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function sI(e,t,n){var r=YC.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function lI(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function uI(e,t,n){var r=YC.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function cI(e,t,n){var r=YC.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function dI(e,t,n){var r=YC.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function hI(e,t,n){var r=YC.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function fI(e,t,n){var r=YC.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function pI(e,t,n){var r=YC.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function mI(e,t,n){var r=YC.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function gI(e,t,n){var r=YC.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function vI(e,t,n){var r=YC.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function yI(e,t,n){var r=XC.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function bI(e,t,n){var r=YC.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function xI(e,t,n){var r=YC.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function wI(e,t){return ZC(e.getDate(),t,2)}function _I(e,t){return ZC(e.getHours(),t,2)}function kI(e,t){return ZC(e.getHours()%12||12,t,2)}function EI(e,t){return ZC(1+Lb.count($b(e),e),t,3)}function SI(e,t){return ZC(e.getMilliseconds(),t,3)}function TI(e,t){return SI(e,t)+"000"}function CI(e,t){return ZC(e.getMonth()+1,t,2)}function II(e,t){return ZC(e.getMinutes(),t,2)}function AI(e,t){return ZC(e.getSeconds(),t,2)}function OI(e){var t=e.getDay();return 0===t?7:t}function DI(e,t){return ZC(Fb.count($b(e)-1,e),t,2)}function MI(e){var t=e.getDay();return t>=4||0===t?Pb(e):Pb.ceil(e)}function NI(e,t){return e=MI(e),ZC(Pb.count($b(e),e)+(4===$b(e).getDay()),t,2)}function jI(e){return e.getDay()}function FI(e,t){return ZC(Rb.count($b(e)-1,e),t,2)}function RI(e,t){return ZC(e.getFullYear()%100,t,2)}function PI(e,t){return ZC((e=MI(e)).getFullYear()%100,t,2)}function LI(e,t){return ZC(e.getFullYear()%1e4,t,4)}function BI(e,t){var n=e.getDay();return ZC((e=n>=4||0===n?Pb(e):Pb.ceil(e)).getFullYear()%1e4,t,4)}function $I(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+ZC(t/60|0,"0",2)+ZC(t%60,"0",2)}function zI(e,t){return ZC(e.getUTCDate(),t,2)}function UI(e,t){return ZC(e.getUTCHours(),t,2)}function HI(e,t){return ZC(e.getUTCHours()%12||12,t,2)}function WI(e,t){return ZC(1+Nb.count(Ub(e),e),t,3)}function VI(e,t){return ZC(e.getUTCMilliseconds(),t,3)}function qI(e,t){return VI(e,t)+"000"}function GI(e,t){return ZC(e.getUTCMonth()+1,t,2)}function YI(e,t){return ZC(e.getUTCMinutes(),t,2)}function XI(e,t){return ZC(e.getUTCSeconds(),t,2)}function KI(e){var t=e.getUTCDay();return 0===t?7:t}function ZI(e,t){return ZC(Ob.count(Ub(e)-1,e),t,2)}function JI(e){var t=e.getUTCDay();return t>=4||0===t?Mb(e):Mb.ceil(e)}function QI(e,t){return e=JI(e),ZC(Mb.count(Ub(e),e)+(4===Ub(e).getUTCDay()),t,2)}function eA(e){return e.getUTCDay()}function tA(e,t){return ZC(Db.count(Ub(e)-1,e),t,2)}function nA(e,t){return ZC(e.getUTCFullYear()%100,t,2)}function rA(e,t){return ZC((e=JI(e)).getUTCFullYear()%100,t,2)}function iA(e,t){return ZC(e.getUTCFullYear()%1e4,t,4)}function aA(e,t){var n=e.getUTCDay();return ZC((e=n>=4||0===n?Mb(e):Mb.ceil(e)).getUTCFullYear()%1e4,t,4)}function oA(){return"+0000"}function sA(){return"%"}function lA(e){return+e}function uA(e){return Math.floor(+e/1e3)}WC=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,u=QC(i),c=eI(i),d=QC(a),h=eI(a),f=QC(o),p=eI(o),m=QC(s),g=eI(s),v=QC(l),y=eI(l),b={a:function(e){return o[e.getDay()]},A:function(e){return a[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:wI,e:wI,f:TI,g:PI,G:BI,H:_I,I:kI,j:EI,L:SI,m:CI,M:II,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:lA,s:uA,S:AI,u:OI,U:DI,V:NI,w:jI,W:FI,x:null,X:null,y:RI,Y:LI,Z:$I,"%":sA},x={a:function(e){return o[e.getUTCDay()]},A:function(e){return a[e.getUTCDay()]},b:function(e){return l[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:zI,e:zI,f:qI,g:rA,G:aA,H:UI,I:HI,j:WI,L:VI,m:GI,M:YI,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:lA,s:uA,S:XI,u:KI,U:ZI,V:QI,w:eA,W:tA,x:null,X:null,y:nA,Y:iA,Z:oA,"%":sA},w={a:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=p[r[0].toLowerCase()],n+r[0].length):-1},A:function(e,t,n){var r=d.exec(t.slice(n));return r?(e.w=h[r[0].toLowerCase()],n+r[0].length):-1},b:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=g[r[0].toLowerCase()],n+r[0].length):-1},c:function(e,n,r){return E(e,t,n,r)},d:dI,e:dI,f:vI,g:sI,G:oI,H:fI,I:fI,j:hI,L:gI,m:cI,M:pI,p:function(e,t,n){var r=u.exec(t.slice(n));return r?(e.p=c[r[0].toLowerCase()],n+r[0].length):-1},q:uI,Q:bI,s:xI,S:mI,u:nI,U:rI,V:iI,w:tI,W:aI,x:function(e,t,r){return E(e,n,t,r)},X:function(e,t,n){return E(e,r,t,n)},y:sI,Y:oI,Z:lI,"%":yI};function _(e,t){return function(n){var r,i,a,o=[],s=-1,l=0,u=e.length;for(n instanceof Date||(n=new Date(+n));++s<u;)37===e.charCodeAt(s)&&(o.push(e.slice(l,s)),null!=(i=GC[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(a=t[r])&&(r=a(n,i)),o.push(r),l=s+1);return o.push(e.slice(l,s)),o.join("")}}function k(e,t){return function(n){var r,i,a=HC(1900,void 0,1);if(E(a,e,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(t&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(i=(r=UC(HC(a.y,0,1))).getUTCDay(),r=i>4||0===i?Db.ceil(r):Db(r),r=Nb.offset(r,7*(a.V-1)),a.y=r.getUTCFullYear(),a.m=r.getUTCMonth(),a.d=r.getUTCDate()+(a.w+6)%7):(i=(r=zC(HC(a.y,0,1))).getDay(),r=i>4||0===i?Rb.ceil(r):Rb(r),r=Lb.offset(r,7*(a.V-1)),a.y=r.getFullYear(),a.m=r.getMonth(),a.d=r.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),i="Z"in a?UC(HC(a.y,0,1)).getUTCDay():zC(HC(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(i+5)%7:a.w+7*a.U-(i+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,UC(a)):zC(a)}}function E(e,t,n,r){for(var i,a,o=0,s=t.length,l=n.length;o<s;){if(r>=l)return-1;if(37===(i=t.charCodeAt(o++))){if(i=t.charAt(o++),!(a=w[i in GC?t.charAt(o++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return b.x=_(n,b),b.X=_(r,b),b.c=_(t,b),x.x=_(n,x),x.X=_(r,x),x.c=_(t,x),{format:function(e){var t=_(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=k(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=_(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=k(e+="",!0);return t.toString=function(){return e},t}}}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),VC=WC.format,qC=WC.utcFormat;var cA=31536e6;function dA(e){return new Date(e)}function hA(e){return e instanceof Date?+e:+new Date(+e)}function fA(e,t,n,r,i,a,o,s,l){var u=vC(),c=u.invert,d=u.domain,h=l(".%L"),f=l(":%S"),p=l("%I:%M"),m=l("%I %p"),g=l("%a %d"),v=l("%b %d"),y=l("%B"),b=l("%Y"),x=[[o,1,1e3],[o,5,5e3],[o,15,15e3],[o,30,3e4],[a,1,6e4],[a,5,3e5],[a,15,9e5],[a,30,18e5],[i,1,36e5],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,864e5],[r,2,1728e5],[n,1,6048e5],[t,1,2592e6],[t,3,7776e6],[e,1,cA]];function w(s){return(o(s)<s?h:a(s)<s?f:i(s)<s?p:r(s)<s?m:t(s)<s?n(s)<s?g:v:e(s)<s?y:b)(s)}function _(t,n,r){if(null==t&&(t=10),"number"==typeof t){var i,a=Math.abs(r-n)/t,o=gy((function(e){return e[2]})).right(x,a);return o===x.length?(i=kv(n/cA,r/cA,t),t=e):o?(i=(o=x[a/x[o-1][2]<x[o][2]/a?o-1:o])[1],t=o[0]):(i=Math.max(kv(n,r,t),1),t=s),t.every(i)}return t}return u.invert=function(e){return new Date(c(e))},u.domain=function(e){return arguments.length?d(Array.from(e,hA)):d().map(dA)},u.ticks=function(e){var t,n=d(),r=n[0],i=n[n.length-1],a=i<r;return a&&(t=r,r=i,i=t),t=(t=_(e,r,i))?t.range(r,i+1):[],a?t.reverse():t},u.tickFormat=function(e,t){return null==t?w:l(t)},u.nice=function(e){var t=d();return(e=_(e,t[0],t[t.length-1]))?d(bC(t,e)):u},u.copy=function(){return mC(u,fA(e,t,n,r,i,a,o,s,l))},u}var pA=kb((function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())}),(function(e){return e.getUTCMonth()})),mA=kb((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+t*Tb)}),(function(e,t){return(t-e)/Tb}),(function(e){return e.getUTCHours()})),gA=kb((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+t*Sb)}),(function(e,t){return(t-e)/Sb}),(function(e){return e.getUTCMinutes()}));function vA(){var e,t,n,r,i,a=0,o=1,s=dC,l=!1;function u(t){return isNaN(t=+t)?i:s(0===n?.5:(t=(r(t)-e)*n,l?Math.max(0,Math.min(1,t)):t))}function c(e){return function(t){var n,r;return arguments.length?([n,r]=t,s=e(n,r),u):[s(0),s(1)]}}return u.domain=function(i){return arguments.length?([a,o]=i,e=r(a=+a),t=r(o=+o),n=e===t?0:1/(t-e),u):[a,o]},u.clamp=function(e){return arguments.length?(l=!!e,u):l},u.interpolator=function(e){return arguments.length?(s=e,u):s},u.range=c(sC),u.rangeRound=c(lC),u.unknown=function(e){return arguments.length?(i=e,u):i},function(i){return r=i,e=i(a),t=i(o),n=e===t?0:1/(t-e),u}}function yA(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function bA(){var e=yC(vA()(dC));return e.copy=function(){return yA(e,bA())},hT.apply(e,arguments)}function xA(){var e=OC(vA());return e.copy=function(){return yA(e,xA()).exponent(e.exponent())},hT.apply(e,arguments)}function wA(e,t){for(var n=0,r=t.length-1,i=t[0],a=new Array(r<0?0:r);n<r;)a[n]=e(i,i=t[++n]);return function(e){var t=Math.max(0,Math.min(r-1,Math.floor(e*=r)));return a[t](e-t)}}function _A(){var e,t,n,r,i,a,o,s=0,l=.5,u=1,c=1,d=dC,h=!1;function f(e){return isNaN(e=+e)?o:(e=.5+((e=+a(e))-t)*(c*e<c*t?r:i),d(h?Math.max(0,Math.min(1,e)):e))}function p(e){return function(t){var n,r,i;return arguments.length?([n,r,i]=t,d=wA(e,[n,r,i]),f):[d(0),d(.5),d(1)]}}return f.domain=function(o){return arguments.length?([s,l,u]=o,e=a(s=+s),t=a(l=+l),n=a(u=+u),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),c=t<e?-1:1,f):[s,l,u]},f.clamp=function(e){return arguments.length?(h=!!e,f):h},f.interpolator=function(e){return arguments.length?(d=e,f):d},f.range=p(sC),f.rangeRound=p(lC),f.unknown=function(e){return arguments.length?(o=e,f):o},function(o){return a=o,e=o(s),t=o(l),n=o(u),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),c=t<e?-1:1,f}}function kA(){var e=OC(_A());return e.copy=function(){return yA(e,kA()).exponent(e.exponent())},hT.apply(e,arguments)}function EA(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}var SA=function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1];return EA((n-r/t)*t,r>0?e[r-1]:2*i-a,i,a,r<t-1?e[r+2]:2*a-i)}},TA=function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t);return EA((n-r/t)*t,e[(r+t-1)%t],e[r%t],e[(r+1)%t],e[(r+2)%t])}},CA=e=>()=>e;function IA(e,t){return function(n){return e+n*t}}function AA(e,t){var n=t-e;return n?IA(e,n>180||n<-180?n-360*Math.round(n/360):n):CA(isNaN(e)?t:e)}function OA(e,t){var n=t-e;return n?IA(e,n):CA(isNaN(e)?t:e)}var DA=function e(t){var n=function(e){return 1==(e=+e)?OA:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):CA(isNaN(t)?n:t)}}(t);function r(e,t){var r=n((e=LT(e)).r,(t=LT(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=OA(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function MA(e){return function(t){var n,r,i=t.length,a=new Array(i),o=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=LT(t[n]),a[n]=r.r||0,o[n]=r.g||0,s[n]=r.b||0;return a=e(a),o=e(o),s=e(s),r.opacity=1,function(e){return r.r=a(e),r.g=o(e),r.b=s(e),r+""}}}var NA=MA(SA),jA=MA(TA),FA=function(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}};function RA(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}var PA=function(e,t){return(RA(t)?FA:LA)(e,t)};function LA(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=qA(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}var BA,$A=function(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}},zA=function(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}},UA=function(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=qA(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}},HA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,WA=new RegExp(HA.source,"g"),VA=function(e,t){var n,r,i,a=HA.lastIndex=WA.lastIndex=0,o=-1,s=[],l=[];for(e+="",t+="";(n=HA.exec(e))&&(r=WA.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:zA(n,r)})),a=WA.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)s[(n=l[r]).i]=n.x(e);return s.join("")})},qA=function(e,t){var n,r=typeof t;return null==t||"boolean"===r?CA(t):("number"===r?zA:"string"===r?(n=jT(t))?(t=n,DA):VA:t instanceof jT?DA:t instanceof Date?$A:RA(t)?FA:Array.isArray(t)?LA:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?UA:zA)(e,t)},GA=function(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}},YA=function(e,t){var n=AA(+e,+t);return function(e){var t=n(e);return t-360*Math.floor(t/360)}},XA=function(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}},KA=180/Math.PI,ZA={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},JA=function(e,t,n,r,i,a){var o,s,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,l/=s),e*r<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*KA,skewX:Math.atan(l)*KA,scaleX:o,scaleY:s}};function QA(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(a,o){var s=[],l=[];return a=e(a),o=e(o),function(e,r,i,a,o,s){if(e!==i||r!==a){var l=o.push("translate(",null,t,null,n);s.push({i:l-4,x:zA(e,i)},{i:l-2,x:zA(r,a)})}else(i||a)&&o.push("translate("+i+t+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,l),function(e,t,n,a){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:zA(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(a.rotate,o.rotate,s,l),function(e,t,n,a){e!==t?a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:zA(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(a.skewX,o.skewX,s,l),function(e,t,n,r,a,o){if(e!==n||t!==r){var s=a.push(i(a)+"scale(",null,",",null,")");o.push({i:s-4,x:zA(e,n)},{i:s-2,x:zA(t,r)})}else 1===n&&1===r||a.push(i(a)+"scale("+n+","+r+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,l),a=o=null,function(e){for(var t,n=-1,r=l.length;++n<r;)s[(t=l[n]).i]=t.x(e);return s.join("")}}}var eO=QA((function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?ZA:JA(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),tO=QA((function(e){return null==e?ZA:(BA||(BA=document.createElementNS("http://www.w3.org/2000/svg","g")),BA.setAttribute("transform",e),(e=BA.transform.baseVal.consolidate())?JA((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):ZA)}),", ",")",")");function nO(e){return((e=Math.exp(e))+1/e)/2}var rO=function e(t,n,r){function i(e,i){var a,o,s=e[0],l=e[1],u=e[2],c=i[2],d=i[0]-s,h=i[1]-l,f=d*d+h*h;if(f<1e-12)o=Math.log(c/u)/t,a=function(e){return[s+e*d,l+e*h,u*Math.exp(t*e*o)]};else{var p=Math.sqrt(f),m=(c*c-u*u+r*f)/(2*u*n*p),g=(c*c-u*u-r*f)/(2*c*n*p),v=Math.log(Math.sqrt(m*m+1)-m),y=Math.log(Math.sqrt(g*g+1)-g);o=(y-v)/t,a=function(e){var r,i=e*o,a=nO(v),c=u/(n*p)*(a*(r=t*i+v,((r=Math.exp(2*r))-1)/(r+1))-function(e){return((e=Math.exp(e))-1/e)/2}(v));return[s+c*d,l+c*h,u*a/nO(t*i+v)]}}return a.duration=1e3*o*t/Math.SQRT2,a}return i.rho=function(t){var n=Math.max(.001,+t),r=n*n;return e(n,r,r*r)},i}(Math.SQRT2,2,4);function iO(e){return function(t,n){var r=e((t=VT(t)).h,(n=VT(n)).h),i=OA(t.s,n.s),a=OA(t.l,n.l),o=OA(t.opacity,n.opacity);return function(e){return t.h=r(e),t.s=i(e),t.l=a(e),t.opacity=o(e),t+""}}}var aO=iO(AA),oO=iO(OA),sO=Math.PI/180,lO=180/Math.PI,uO=.96422,cO=.82521,dO=4/29,hO=6/29,fO=3*hO*hO;function pO(e){if(e instanceof gO)return new gO(e.l,e.a,e.b,e.opacity);if(e instanceof kO)return EO(e);e instanceof BT||(e=PT(e));var t,n,r=xO(e.r),i=xO(e.g),a=xO(e.b),o=vO((.2225045*r+.7168786*i+.0606169*a)/1);return r===i&&i===a?t=n=o:(t=vO((.4360747*r+.3850649*i+.1430804*a)/uO),n=vO((.0139322*r+.0971045*i+.7141733*a)/cO)),new gO(116*o-16,500*(t-o),200*(o-n),e.opacity)}function mO(e,t,n,r){return 1===arguments.length?pO(e):new gO(e,t,n,null==r?1:r)}function gO(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function vO(e){return e>.008856451679035631?Math.pow(e,1/3):e/fO+dO}function yO(e){return e>hO?e*e*e:fO*(e-dO)}function bO(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function xO(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function wO(e){if(e instanceof kO)return new kO(e.h,e.c,e.l,e.opacity);if(e instanceof gO||(e=pO(e)),0===e.a&&0===e.b)return new kO(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*lO;return new kO(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function _O(e,t,n,r){return 1===arguments.length?wO(e):new kO(e,t,n,null==r?1:r)}function kO(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function EO(e){if(isNaN(e.h))return new gO(e.l,0,0,e.opacity);var t=e.h*sO;return new gO(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}function SO(e,t){var n=OA((e=mO(e)).l,(t=mO(t)).l),r=OA(e.a,t.a),i=OA(e.b,t.b),a=OA(e.opacity,t.opacity);return function(t){return e.l=n(t),e.a=r(t),e.b=i(t),e.opacity=a(t),e+""}}function TO(e){return function(t,n){var r=e((t=_O(t)).h,(n=_O(n)).h),i=OA(t.c,n.c),a=OA(t.l,n.l),o=OA(t.opacity,n.opacity);return function(e){return t.h=r(e),t.c=i(e),t.l=a(e),t.opacity=o(e),t+""}}}gT(gO,mO,vT(yT,{brighter:function(e){return new gO(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new gO(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new BT(bO(3.1338561*(t=uO*yO(t))-1.6168667*(e=1*yO(e))-.4906146*(n=cO*yO(n))),bO(-.9787684*t+1.9161415*e+.033454*n),bO(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),gT(kO,_O,vT(yT,{brighter:function(e){return new kO(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new kO(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return EO(this).rgb()}}));var CO=TO(AA),IO=TO(OA),AO=-.29227,OO=-.90649,DO=1.97294,MO=-1.7884503806,NO=3.5172982438,jO=-.6557636667999999;function FO(e){if(e instanceof PO)return new PO(e.h,e.s,e.l,e.opacity);e instanceof BT||(e=PT(e));var t=e.g/255,n=e.b/255,r=(jO*n+MO*(e.r/255)-NO*t)/(jO+MO-NO),i=n-r,a=(DO*(t-r)-AO*i)/OO,o=Math.sqrt(a*a+i*i)/(DO*r*(1-r)),s=o?Math.atan2(a,i)*lO-120:NaN;return new PO(s<0?s+360:s,o,r,e.opacity)}function RO(e,t,n,r){return 1===arguments.length?FO(e):new PO(e,t,n,null==r?1:r)}function PO(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function LO(e){return function t(n){function r(t,r){var i=e((t=RO(t)).h,(r=RO(r)).h),a=OA(t.s,r.s),o=OA(t.l,r.l),s=OA(t.opacity,r.opacity);return function(e){return t.h=i(e),t.s=a(e),t.l=o(Math.pow(e,n)),t.opacity=s(e),t+""}}return n=+n,r.gamma=t,r}(1)}gT(PO,RO,vT(yT,{brighter:function(e){return e=null==e?xT:Math.pow(xT,e),new PO(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?bT:Math.pow(bT,e),new PO(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*sO,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new BT(255*(t+n*(-.14861*r+1.78277*i)),255*(t+n*(AO*r+OO*i)),255*(t+n*(DO*r)),this.opacity)}}));var BO=LO(AA),$O=LO(OA);function zO(e,t){void 0===t&&(t=e,e=qA);for(var n=0,r=t.length-1,i=t[0],a=new Array(r<0?0:r);n<r;)a[n]=e(i,i=t[++n]);return function(e){var t=Math.max(0,Math.min(r-1,Math.floor(e*=r)));return a[t](e-t)}}var UO=function(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n};function HO(e,t,n){const r=e-t+2*n;return e?r>0?r:1:0}const WO="linear",VO="log",qO="pow",GO="sqrt",YO="symlog",XO="time",KO="utc",ZO="sequential",JO="diverging",QO="quantile",eD="quantize",tD="threshold",nD="ordinal",rD="point",iD="band",aD="bin-ordinal",oD="continuous",sD="discrete",lD="discretizing",uD="interpolating",cD="temporal";function dD(){const e=pT().unknown(void 0),t=e.domain,n=e.range;let r,i,a=[0,1],o=!1,s=0,l=0,u=.5;function c(){const e=t().length,c=a[1]<a[0],d=a[1-c],h=HO(e,s,l);let f=a[c-0];r=(d-f)/(h||1),o&&(r=Math.floor(r)),f+=(d-f-r*(e-s))*u,i=r*(1-s),o&&(f=Math.round(f),i=Math.round(i));const p=wk(e).map(e=>f+r*e);return n(c?p.reverse():p)}return delete e.unknown,e.domain=function(e){return arguments.length?(t(e),c()):t()},e.range=function(e){return arguments.length?(a=[+e[0],+e[1]],c()):a.slice()},e.rangeRound=function(e){return a=[+e[0],+e[1]],o=!0,c()},e.bandwidth=function(){return i},e.step=function(){return r},e.round=function(e){return arguments.length?(o=!!e,c()):o},e.padding=function(e){return arguments.length?(l=Math.max(0,Math.min(1,e)),s=l,c()):s},e.paddingInner=function(e){return arguments.length?(s=Math.max(0,Math.min(1,e)),c()):s},e.paddingOuter=function(e){return arguments.length?(l=Math.max(0,Math.min(1,e)),c()):l},e.align=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),c()):u},e.invertRange=function(e){if(null==e[0]||null==e[1])return;const r=a[1]<a[0],o=r?n().reverse():n(),s=o.length-1;let l,u,c,d=+e[0],h=+e[1];return d!=d||h!=h||(h<d&&(c=d,d=h,h=c),h<o[0]||d>a[1-r])?void 0:(l=Math.max(0,lT(o,d)-1),u=d===h?l:lT(o,h)-1,d-o[l]>i+1e-10&&++l,r&&(c=l,l=s-u,u=s-c),l>u?void 0:t().slice(l,u+1))},e.invert=function(t){const n=e.invertRange([t,t]);return n?n[0]:n},e.copy=function(){return dD().domain(t()).range(a).round(o).paddingInner(s).paddingOuter(l).align(u)},c()}var hD=Array.prototype.map;function fD(e){return hD.call(e,Om)}const pD=Array.prototype.slice,mD={};function gD(e,t,n){const r=function(){const n=t();return n.invertRange||(n.invertRange=n.invert?(r=n,function(e){let t,n=e[0],i=e[1];return i<n&&(t=n,n=i,i=t),[r.invert(n),r.invert(i)]}):n.invertExtent?function(e){return function(t){const n=e.range();let r,i,a,o,s=t[0],l=t[1],u=-1;for(l<s&&(i=s,s=l,l=i),a=0,o=n.length;a<o;++a)n[a]>=s&&n[a]<=l&&(u<0&&(u=a),r=a);if(!(u<0))return s=e.invertExtent(n[u]),l=e.invertExtent(n[r]),[void 0===s[0]?s[1]:s[0],void 0===l[1]?l[0]:l[1]]}}(n):void 0),n.type=e,n;var r};return r.metadata=Mg(Ym(n)),r}function vD(e,t,n){return arguments.length>1?(mD[e]=gD(e,t,n),this):yD(e)?mD[e]:void 0}function yD(e){return lg(mD,e)}function bD(e,t){const n=mD[e];return n&&n.metadata[t]}function xD(e){return bD(e,oD)}function wD(e){return bD(e,sD)}function _D(e){return bD(e,lD)}function kD(e){return bD(e,VO)}function ED(e){return bD(e,uD)}function SD(e){return bD(e,QO)}vD("identity",(function e(t){var n;function r(e){return isNaN(e=+e)?n:e}return r.invert=r,r.domain=r.range=function(e){return arguments.length?(t=Array.from(e,uC),r):t.slice()},r.unknown=function(e){return arguments.length?(n=e,r):n},r.copy=function(){return e(t).unknown(n)},t=arguments.length?Array.from(t,uC):[0,1],yC(r)})),vD(WO,(function e(){var t=vC();return t.copy=function(){return mC(t,e())},dT.apply(t,arguments),yC(t)}),oD),vD(VO,(function e(){var t=TC(gC()).domain([1,10]);return t.copy=function(){return mC(t,e()).base(t.base())},dT.apply(t,arguments),t}),[oD,VO]),vD(qO,DC,oD),vD(GO,(function(){return DC.apply(null,arguments).exponent(.5)}),oD),vD(YO,(function e(){var t=jC(gC());return t.copy=function(){return mC(t,e()).constant(t.constant())},dT.apply(t,arguments)}),oD),vD(XO,(function(){return dT.apply(fA($b,FC,Fb,Lb,RC,PC,LC,$C,VC).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),[oD,cD]),vD(KO,(function(){return dT.apply(fA(Ub,pA,Ob,Nb,mA,gA,LC,$C,qC).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}),[oD,cD]),vD(ZO,bA,[oD,uD]),vD("".concat(ZO,"-").concat(WO),bA,[oD,uD]),vD("".concat(ZO,"-").concat(VO),(function e(){var t=TC(vA()).domain([1,10]);return t.copy=function(){return yA(t,e()).base(t.base())},hT.apply(t,arguments)}),[oD,uD,VO]),vD("".concat(ZO,"-").concat(qO),xA,[oD,uD]),vD("".concat(ZO,"-").concat(GO),(function(){return xA.apply(null,arguments).exponent(.5)}),[oD,uD]),vD("".concat(ZO,"-").concat(YO),(function e(){var t=jC(vA());return t.copy=function(){return yA(t,e()).constant(t.constant())},hT.apply(t,arguments)}),[oD,uD]),vD("".concat(JO,"-").concat(WO),(function e(){var t=yC(_A()(dC));return t.copy=function(){return yA(t,e())},hT.apply(t,arguments)}),[oD,uD]),vD("".concat(JO,"-").concat(VO),(function e(){var t=TC(_A()).domain([.1,1,10]);return t.copy=function(){return yA(t,e()).base(t.base())},hT.apply(t,arguments)}),[oD,uD,VO]),vD("".concat(JO,"-").concat(qO),kA,[oD,uD]),vD("".concat(JO,"-").concat(GO),(function(){return kA.apply(null,arguments).exponent(.5)}),[oD,uD]),vD("".concat(JO,"-").concat(YO),(function e(){var t=jC(_A());return t.copy=function(){return yA(t,e()).constant(t.constant())},hT.apply(t,arguments)}),[oD,uD]),vD(QO,(function e(){var t,n=[],r=[],i=[];function a(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=S_(n,e/t);return o}function o(e){return isNaN(e=+e)?t:r[cT(i,e)]}return o.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},o.domain=function(e){if(!arguments.length)return n.slice();n=[];for(let t of e)null==t||isNaN(t=+t)||n.push(t);return n.sort(my),a()},o.range=function(e){return arguments.length?(r=Array.from(e),a()):r.slice()},o.unknown=function(e){return arguments.length?(t=e,o):t},o.quantiles=function(){return i.slice()},o.copy=function(){return e().domain(n).range(r).unknown(t)},dT.apply(o,arguments)}),[lD,QO]),vD(eD,(function e(){var t,n=0,r=1,i=1,a=[.5],o=[0,1];function s(e){return e<=e?o[cT(a,e,0,i)]:t}function l(){var e=-1;for(a=new Array(i);++e<i;)a[e]=((e+1)*r-(e-i)*n)/(i+1);return s}return s.domain=function(e){return arguments.length?([n,r]=e,n=+n,r=+r,l()):[n,r]},s.range=function(e){return arguments.length?(i=(o=Array.from(e)).length-1,l()):o.slice()},s.invertExtent=function(e){var t=o.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,a[0]]:t>=i?[a[i-1],r]:[a[t-1],a[t]]},s.unknown=function(e){return arguments.length?(t=e,s):s},s.thresholds=function(){return a.slice()},s.copy=function(){return e().domain([n,r]).range(o).unknown(t)},dT.apply(yC(s),arguments)}),lD),vD(tD,(function e(){var t,n=[.5],r=[0,1],i=1;function a(e){return e<=e?r[cT(n,e,0,i)]:t}return a.domain=function(e){return arguments.length?(n=Array.from(e),i=Math.min(n.length,r.length-1),a):n.slice()},a.range=function(e){return arguments.length?(r=Array.from(e),i=Math.min(n.length,r.length-1),a):r.slice()},a.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},a.unknown=function(e){return arguments.length?(t=e,a):t},a.copy=function(){return e().domain(n).range(r).unknown(t)},dT.apply(a,arguments)}),lD),vD(aD,(function e(){let t=[],n=[];function r(e){return null==e||e!=e?void 0:n[(cT(t,e)-1)%n.length]}return r.domain=function(e){return arguments.length?(t=fD(e),r):t.slice()},r.range=function(e){return arguments.length?(n=pD.call(e),r):n.slice()},r.tickFormat=function(e,n){return mT(t[0],Am(t),null==e?10:e,n)},r.copy=function(){return e().domain(r.domain()).range(r.range())},r}),[sD,lD]),vD(nD,pT,sD),vD(iD,dD,sD),vD(rD,(function(){return function e(t){const n=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return e(n())},t}(dD().paddingInner(1))}),sD);const TD=["clamp","base","constant","exponent"];function CD(e,t){const n=t[0],r=Am(t)-n;return function(t){return e(n+t*r)}}function ID(e,t,n){return zO(DD(t||"rgb",n),e)}function AD(e,t){const n=new Array(t),r=t+1;for(let i=0;i<t;)n[i]=e(++i/r);return n}function OD(e,t,n){const r=n-t;let i,a,o;return r&&Number.isFinite(r)?(i=(a=e.type).indexOf("-"),a=i<0?a:a.slice(i+1),o=vD(a)().domain([t,n]).range([0,1]),TD.forEach(t=>e[t]?o[t](e[t]()):0),o):ng(.5)}function DD(e,t){const n=o[function(e){return"interpolate"+e.toLowerCase().split("-").map(e=>e[0].toUpperCase()+e.slice(1)).join("")}(e)];return null!=t&&n&&n.gamma?n.gamma(t):n}function MD(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}function ND(e,t){for(const n in e)FD(n,t(e[n]))}const jD={};function FD(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(jD[e]=t,this):jD[e]}ND({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},MD),ND({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},e=>ID(MD(e)));const RD="symbol",PD=e=>km(e)?e.map(e=>String(e)):String(e),LD=(e,t)=>e[1]-t[1],BD=(e,t)=>t[1]-e[1];function $D(e,t,n){let r;return vg(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),null!=n&&(t=Math.min(t,Math.floor(Tg(e.domain())/n||1)))),Em(t)&&(r=t.step,t=t.interval),bg(t)&&(t=e.type===XO?rb(t):e.type==KO?ib(t):sm("Only time and utc scales accept interval strings."),r&&(t=t.every(r))),t}function zD(e,t,n){let r=e.range(),i=r[0],a=Am(r),o=LD;if(i>a&&(r=a,a=i,i=r,o=BD),i=Math.floor(i),a=Math.ceil(a),t=t.map(t=>[t,e(t)]).filter(e=>i<=e[1]&&e[1]<=a).sort(o).map(e=>e[0]),n>0&&t.length>1){const e=[t[0],Am(t)];for(;t.length>n&&t.length>=3;)t=t.filter((e,t)=>!(t%2));t.length<3&&(t=e)}return t}function UD(e,t){return e.bins?zD(e,e.bins):e.ticks?e.ticks(t):e.domain()}function HD(e,t,n,r,i,a){const o=t.type;let s=PD;if(o===XO||i===XO)s=e.timeFormat(r);else if(o===KO||i===KO)s=e.utcFormat(r);else if(kD(o)){const i=e.formatFloat(r);if(a||t.bins)s=i;else{const e=WD(t,n,!1);s=t=>e(t)?i(t):""}}else if(t.tickFormat){const i=t.domain();s=e.formatSpan(i[0],i[i.length-1],n,r)}else r&&(s=e.format(r));return s}function WD(e,t,n){const r=UD(e,t),i=e.base(),a=Math.log(i),o=Math.max(1,i*t/r.length),s=e=>{let t=e/Math.pow(i,Math.round(Math.log(e)/a));return t*i<i-.5&&(t*=i),t<=o};return n?r.filter(s):s}const VD={[QO]:"quantiles",[eD]:"thresholds",[tD]:"domain"},qD={[QO]:"quantiles",[eD]:"domain"};function GD(e,t){return e.bins?function(e){const t=e.slice(0,-1);return t.max=Am(e),t}(e.bins):e.type===VO?WD(e,t,!0):VD[e.type]?function(e){const t=[-1/0].concat(e);return t.max=1/0,t}(e[VD[e.type]]()):UD(e,t)}function YD(e,t,n,r,i,a,o){const s=qD[t.type]&&a!==XO&&a!==KO?function(e,t,n){const r=t[qD[t.type]](),i=r.length;let a,o=i>1?r[1]-r[0]:r[0];for(a=1;a<i;++a)o=Math.min(o,r[a]-r[a-1]);return e.formatSpan(0,o,30,n)}(e,t,i):HD(e,t,n,i,a,o);return r===RD&&(e=>VD[e.type]||e.bins)(t)?XD(s):"discrete"===r?ZD(s):JD(s)}const XD=e=>(t,n,r)=>{const i=KD(r[n+1],KD(r.max,1/0)),a=QD(t,e),o=QD(i,e);return a&&o?a+" \u2013 "+o:o?"< "+o:"\u2265 "+a},KD=(e,t)=>null!=e?e:t,ZD=e=>(t,n)=>n?e(t):null,JD=e=>t=>e(t),QD=(e,t)=>Number.isFinite(e)?t(e):null;function eM(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=function(e,t,n,r){const i=r||t.type;return bg(n)&&bD(i,cD)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||i!==XO?n||i!==KO?YD(e,t,5,null,n,r,!0):e.utcFormat("%A, %d %B %Y, %X UTC"):e.timeFormat("%A, %d %B %Y, %X")}(e,t,n.format,n.formatType);if(_D(t.type)){const e=GD(t).slice(1).map(i),n=e.length;return"".concat(n," boundar").concat(1===n?"y":"ies",": ").concat(e.join(", "))}if(wD(t.type)){const e=t.domain(),n=e.length,a=n>r?e.slice(0,r-2).map(i).join(", ")+", ending with "+e.slice(-1).map(i):e.map(i).join(", ");return"".concat(n," value").concat(1===n?"":"s",": ").concat(a)}{const e=t.domain();return"values from ".concat(i(e[0])," to ").concat(i(Am(e)))}}let tM=0;const nM="p_";function rM(e){return e&&e.gradient}function iM(e,t,n){const r=e.gradient;let i=e.id,a="radial"===r?nM:"";return i||(i=e.id="gradient_"+tM++,"radial"===r?(e.x1=aM(e.x1,.5),e.y1=aM(e.y1,.5),e.r1=aM(e.r1,0),e.x2=aM(e.x2,.5),e.y2=aM(e.y2,.5),e.r2=aM(e.r2,.5),a=nM):(e.x1=aM(e.x1,0),e.y1=aM(e.y1,0),e.x2=aM(e.x2,1),e.y2=aM(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+a+i+")"}function aM(e,t){return null!=e?e:t}function oM(e,t){var n,r=[];return n={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:r,stop:function(e,t){return r.push({offset:e,color:t}),n}}}const sM={basis:{curve:function(e){return new qE(e)}},"basis-closed":{curve:function(e){return new YE(e)}},"basis-open":{curve:function(e){return new XE(e)}},bundle:{curve:ZE,tension:"beta",value:.85},cardinal:{curve:eS,tension:"tension",value:0},"cardinal-open":{curve:nS,tension:"tension",value:0},"cardinal-closed":{curve:iS,tension:"tension",value:0},"catmull-rom":{curve:xS,tension:"alpha",value:.5},"catmull-rom-closed":{curve:_S,tension:"alpha",value:.5},"catmull-rom-open":{curve:ES,tension:"alpha",value:.5},linear:{curve:TS},"linear-closed":{curve:function(e){return new CS(e)}},monotone:{horizontal:function(e){return new NS(e)},vertical:function(e){return new MS(e)}},natural:{curve:function(e){return new FS(e)}},step:{curve:function(e){return new PS(e,.5)}},"step-after":{curve:function(e){return new PS(e,1)}},"step-before":{curve:function(e){return new PS(e,0)}}};function lM(e,t,n){var r=lg(sM,e)&&sM[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&null!=n&&(i=i[r.tension](n))),i}const uM={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},cM=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function dM(e){const t=[];let n,r,i,a,o,s,l,u,c,d;const h=e.slice().replace(cM[0],"###$1").split(cM[1]).slice(1);for(l=0,c=h.length;l<c;++l){for(n=h[l],r=n.slice(1).trim().replace(cM[2],"$1###$2").replace(cM[3],"$1###$2").split(cM[4]),o=n.charAt(0),i=[o],u=0,d=r.length;u<d;++u)(a=+r[u])===a&&i.push(a);if(s=uM[o.toLowerCase()],i.length-1>s){const e=i.length;for(u=1,t.push([o].concat(i.slice(u,u+=s))),o="M"===o?"L":"m"===o?"l":o;u<e;u+=s)t.push([o].concat(i.slice(u,u+s)))}else t.push(i)}return t}const hM=Math.PI/180,fM=Math.PI/2,pM=2*Math.PI,mM=Math.sqrt(3)/2;var gM={},vM={},yM=[].join;function bM(e){const t=yM.call(e);if(vM[t])return vM[t];var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7];const c=u*o,d=-l*s,h=l*o,f=u*s,p=Math.cos(i),m=Math.sin(i),g=Math.cos(a),v=Math.sin(a),y=.5*(a-i),b=Math.sin(.5*y),x=8/3*b*b/Math.sin(y),w=n+p-x*m,_=r+m+x*p,k=n+g,E=r+v,S=k+x*v,T=E-x*g;return vM[t]=[c*w+d*_,h*w+f*_,c*S+d*T,h*S+f*T,c*k+d*E,h*k+f*E]}const xM=["l",0,0,0,0,0,0,0];function wM(e,t,n){const r=xM[0]=e[0];if("a"===r||"A"===r)xM[1]=t*e[1],xM[2]=n*e[2],xM[3]=e[3],xM[4]=e[4],xM[5]=e[5],xM[6]=t*e[6],xM[7]=n*e[7];else if("h"===r||"H"===r)xM[1]=t*e[1];else if("v"===r||"V"===r)xM[1]=n*e[1];else for(var i=1,a=e.length;i<a;++i)xM[i]=(i%2==1?t:n)*e[i];return xM}function _M(e,t,n,r,i,a){var o,s,l,u,c,d=null,h=0,f=0,p=0,m=0;null==n&&(n=0),null==r&&(r=0),null==i&&(i=1),null==a&&(a=i),e.beginPath&&e.beginPath();for(var g=0,v=t.length;g<v;++g){switch(o=t[g],1===i&&1===a||(o=wM(o,i,a)),o[0]){case"l":e.lineTo((h+=o[1])+n,(f+=o[2])+r);break;case"L":e.lineTo((h=o[1])+n,(f=o[2])+r);break;case"h":e.lineTo((h+=o[1])+n,f+r);break;case"H":e.lineTo((h=o[1])+n,f+r);break;case"v":e.lineTo(h+n,(f+=o[1])+r);break;case"V":e.lineTo(h+n,(f=o[1])+r);break;case"m":e.moveTo((h+=o[1])+n,(f+=o[2])+r);break;case"M":e.moveTo((h=o[1])+n,(f=o[2])+r);break;case"c":e.bezierCurveTo(h+o[1]+n,f+o[2]+r,(p=h+o[3])+n,(m=f+o[4])+r,(s=h+o[5])+n,(l=f+o[6])+r),h=s,f=l;break;case"C":e.bezierCurveTo(o[1]+n,o[2]+r,(p=o[3])+n,(m=o[4])+r,(h=o[5])+n,(f=o[6])+r);break;case"s":e.bezierCurveTo((p=2*h-p)+n,(m=2*f-m)+r,h+o[1]+n,f+o[2]+r,(s=h+o[3])+n,(l=f+o[4])+r),p=h+o[1],m=f+o[2],h=s,f=l;break;case"S":e.bezierCurveTo((p=2*h-p)+n,(m=2*f-m)+r,o[1]+n,o[2]+r,(s=o[3])+n,(l=o[4])+r),h=s,f=l,p=o[1],m=o[2];break;case"q":e.quadraticCurveTo((p=h+o[1])+n,(m=f+o[2])+r,(s=h+o[3])+n,(l=f+o[4])+r),h=s,f=l;break;case"Q":e.quadraticCurveTo(o[1]+n,o[2]+r,(s=o[3])+n,(l=o[4])+r),h=s,f=l,p=o[1],m=o[2];break;case"t":s=h+o[1],l=f+o[2],null===d[0].match(/[QqTt]/)?(p=h,m=f):"t"===d[0]?(p=2*h-u,m=2*f-c):"q"===d[0]&&(p=2*h-p,m=2*f-m),u=p,c=m,e.quadraticCurveTo(p+n,m+r,s+n,l+r),p=(h=s)+o[1],m=(f=l)+o[2];break;case"T":e.quadraticCurveTo((p=2*h-p)+n,(m=2*f-m)+r,(s=o[1])+n,(l=o[2])+r),h=s,f=l;break;case"a":kM(e,h+n,f+r,[o[1],o[2],o[3],o[4],o[5],o[6]+h+n,o[7]+f+r]),h+=o[6],f+=o[7];break;case"A":kM(e,h+n,f+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),h=o[6],f=o[7];break;case"z":case"Z":e.closePath()}d=o}}function kM(e,t,n,r){const i=function(e,t,n,r,i,a,o,s,l){const u=yM.call(arguments);if(gM[u])return gM[u];const c=o*hM,d=Math.sin(c),h=Math.cos(c),f=h*(s-e)*.5+d*(l-t)*.5,p=h*(l-t)*.5-d*(s-e)*.5;let m=f*f/((n=Math.abs(n))*n)+p*p/((r=Math.abs(r))*r);m>1&&(m=Math.sqrt(m),n*=m,r*=m);const g=h/n,v=d/n,y=-d/r,b=h/r,x=g*s+v*l,w=y*s+b*l,_=g*e+v*t,k=y*e+b*t;let E=1/((_-x)*(_-x)+(k-w)*(k-w))-.25;E<0&&(E=0);let S=Math.sqrt(E);a==i&&(S=-S);const T=.5*(x+_)-S*(k-w),C=.5*(w+k)+S*(_-x),I=Math.atan2(w-C,x-T);let A=Math.atan2(k-C,_-T)-I;A<0&&1===a?A+=pM:A>0&&0===a&&(A-=pM);const O=Math.ceil(Math.abs(A/(fM+.001))),D=[];for(let M=0;M<O;++M)D[M]=[T,C,I+M*A/O,I+(M+1)*A/O,n,r,d,h];return gM[u]=D}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let a=0;a<i.length;++a){const t=bM(i[a]);e.bezierCurveTo(t[0],t[1],t[2],t[3],t[4],t[5])}}const EM=.5773502691896257,SM={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,pM)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,a=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-a),e.lineTo(i,-a),e.lineTo(0,-n),e.lineTo(-i,-a),e.lineTo(-r,-a),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=mM*n,i=r-n*EM,a=n/4;e.moveTo(0,-r-i),e.lineTo(-a,r-i),e.lineTo(a,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=mM*n,i=r-n*EM;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=mM*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=mM*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=mM*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=mM*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function TM(e){return lg(SM,e)?SM[e]:function(e){if(!lg(CM,e)){const t=dM(e);CM[e]={draw:function(e,n){_M(e,t,0,0,Math.sqrt(n)/2)}}}return CM[e]}(e)}var CM={};const IM=.448084975506;function AM(e){return e.x}function OM(e){return e.y}function DM(e){return e.width}function MM(e){return e.height}function NM(e){return"function"==typeof e?e:()=>+e}function jM(e,t,n){return Math.max(t,Math.min(e,n))}function FM(){var e=AM,t=OM,n=DM,r=MM,i=NM(0),a=i,o=i,s=i,l=null;function u(u,c,d){var h,f=null!=c?c:+e.call(this,u),p=null!=d?d:+t.call(this,u),m=+n.call(this,u),g=+r.call(this,u),v=Math.min(m,g)/2,y=jM(+i.call(this,u),0,v),b=jM(+a.call(this,u),0,v),x=jM(+o.call(this,u),0,v),w=jM(+s.call(this,u),0,v);if(l||(l=h=WS()),y<=0&&b<=0&&x<=0&&w<=0)l.rect(f,p,m,g);else{var _=f+m,k=p+g;l.moveTo(f+y,p),l.lineTo(_-b,p),l.bezierCurveTo(_-IM*b,p,_,p+IM*b,_,p+b),l.lineTo(_,k-w),l.bezierCurveTo(_,k-IM*w,_-IM*w,k,_-w,k),l.lineTo(f+x,k),l.bezierCurveTo(f+IM*x,k,f,k-IM*x,f,k-x),l.lineTo(f,p+y),l.bezierCurveTo(f,p+IM*y,f+IM*y,p,f+y,p),l.closePath()}if(h)return l=null,h+""||null}return u.x=function(t){return arguments.length?(e=NM(t),u):e},u.y=function(e){return arguments.length?(t=NM(e),u):t},u.width=function(e){return arguments.length?(n=NM(e),u):n},u.height=function(e){return arguments.length?(r=NM(e),u):r},u.cornerRadius=function(e,t,n,r){return arguments.length?(i=NM(e),a=null!=t?NM(t):i,s=null!=n?NM(n):i,o=null!=r?NM(r):a,u):i},u.context=function(e){return arguments.length?(l=null==e?null:e,u):l},u}function RM(){var e,t,n,r,i,a,o,s,l=null;function u(e,t,n){const r=n/2;if(i){var u=o-t,c=e-a;if(u||c){var d=Math.sqrt(u*u+c*c),h=(u/=d)*s,f=(c/=d)*s,p=Math.atan2(c,u);l.moveTo(a-h,o-f),l.lineTo(e-u*r,t-c*r),l.arc(e,t,r,p-Math.PI,p),l.lineTo(a+h,o+f),l.arc(a,o,s,p,p+Math.PI)}else l.arc(e,t,r,0,pM);l.closePath()}else i=1;a=e,o=t,s=r}function c(a){var o,s,c,d=a.length,h=!1;for(null==l&&(l=c=WS()),o=0;o<=d;++o)!(o<d&&r(s=a[o],o,a))===h&&(h=!h)&&(i=0),h&&u(+e(s,o,a),+t(s,o,a),+n(s,o,a));if(c)return l=null,c+""||null}return c.x=function(t){return arguments.length?(e=t,c):e},c.y=function(e){return arguments.length?(t=e,c):t},c.size=function(e){return arguments.length?(n=e,c):n},c.defined=function(e){return arguments.length?(r=e,c):r},c.context=function(e){return arguments.length?(l=null==e?null:e,c):l},c}function PM(e,t){return null!=e?e:t}const LM=e=>e.x||0,BM=e=>e.y||0,$M=e=>!(!1===e.defined),zM=function(){var e=qS,t=GS,n=VS(0),r=null,i=YS,a=XS,o=KS,s=null;function l(){var l,u,c=+e.apply(this,arguments),d=+t.apply(this,arguments),h=i.apply(this,arguments)-pS,f=a.apply(this,arguments)-pS,p=aS(f-h),m=f>h;if(s||(s=l=WS()),d<c&&(u=d,d=c,c=u),d>hS)if(p>mS-hS)s.moveTo(d*sS(h),d*cS(h)),s.arc(0,0,d,h,f,!m),c>hS&&(s.moveTo(c*sS(f),c*cS(f)),s.arc(0,0,c,f,h,m));else{var g,v,y=h,b=f,x=h,w=f,_=p,k=p,E=o.apply(this,arguments)/2,S=E>hS&&(r?+r.apply(this,arguments):dS(c*c+d*d)),T=uS(aS(d-c)/2,+n.apply(this,arguments)),C=T,I=T;if(S>hS){var A=vS(S/c*cS(E)),O=vS(S/d*cS(E));(_-=2*A)>hS?(x+=A*=m?1:-1,w-=A):(_=0,x=w=(h+f)/2),(k-=2*O)>hS?(y+=O*=m?1:-1,b-=O):(k=0,y=b=(h+f)/2)}var D=d*sS(y),M=d*cS(y),N=c*sS(w),j=c*cS(w);if(T>hS){var F,R=d*sS(b),P=d*cS(b),L=c*sS(x),B=c*cS(x);if(p<fS&&(F=ZS(D,M,L,B,R,P,N,j))){var $=D-F[0],z=M-F[1],U=R-F[0],H=P-F[1],W=1/cS(gS(($*U+z*H)/(dS($*$+z*z)*dS(U*U+H*H)))/2),V=dS(F[0]*F[0]+F[1]*F[1]);C=uS(T,(c-V)/(W-1)),I=uS(T,(d-V)/(W+1))}}k>hS?I>hS?(g=JS(L,B,D,M,d,I,m),v=JS(R,P,N,j,d,I,m),s.moveTo(g.cx+g.x01,g.cy+g.y01),I<T?s.arc(g.cx,g.cy,I,oS(g.y01,g.x01),oS(v.y01,v.x01),!m):(s.arc(g.cx,g.cy,I,oS(g.y01,g.x01),oS(g.y11,g.x11),!m),s.arc(0,0,d,oS(g.cy+g.y11,g.cx+g.x11),oS(v.cy+v.y11,v.cx+v.x11),!m),s.arc(v.cx,v.cy,I,oS(v.y11,v.x11),oS(v.y01,v.x01),!m))):(s.moveTo(D,M),s.arc(0,0,d,y,b,!m)):s.moveTo(D,M),c>hS&&_>hS?C>hS?(g=JS(N,j,R,P,c,-C,m),v=JS(D,M,L,B,c,-C,m),s.lineTo(g.cx+g.x01,g.cy+g.y01),C<T?s.arc(g.cx,g.cy,C,oS(g.y01,g.x01),oS(v.y01,v.x01),!m):(s.arc(g.cx,g.cy,C,oS(g.y01,g.x01),oS(g.y11,g.x11),!m),s.arc(0,0,c,oS(g.cy+g.y11,g.cx+g.x11),oS(v.cy+v.y11,v.cx+v.x11),m),s.arc(v.cx,v.cy,C,oS(v.y11,v.x11),oS(v.y01,v.x01),!m))):s.arc(0,0,c,w,x,m):s.lineTo(N,j)}else s.moveTo(0,0);if(s.closePath(),l)return s=null,l+""||null}return l.centroid=function(){var n=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +a.apply(this,arguments))/2-fS/2;return[sS(r)*n,cS(r)*n]},l.innerRadius=function(t){return arguments.length?(e="function"==typeof t?t:VS(+t),l):e},l.outerRadius=function(e){return arguments.length?(t="function"==typeof e?e:VS(+e),l):t},l.cornerRadius=function(e){return arguments.length?(n="function"==typeof e?e:VS(+e),l):n},l.padRadius=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:VS(+e),l):r},l.startAngle=function(e){return arguments.length?(i="function"==typeof e?e:VS(+e),l):i},l.endAngle=function(e){return arguments.length?(a="function"==typeof e?e:VS(+e),l):a},l.padAngle=function(e){return arguments.length?(o="function"==typeof e?e:VS(+e),l):o},l.context=function(e){return arguments.length?(s=null==e?null:e,l):s},l}().startAngle(e=>e.startAngle||0).endAngle(e=>e.endAngle||0).padAngle(e=>e.padAngle||0).innerRadius(e=>e.innerRadius||0).outerRadius(e=>e.outerRadius||0).cornerRadius(e=>e.cornerRadius||0),UM=rT().x(LM).y1(BM).y0(e=>(e.y||0)+(e.height||0)).defined($M),HM=rT().y(BM).x1(LM).x0(e=>(e.x||0)+(e.width||0)).defined($M),WM=nT().x(LM).y(BM).defined($M),VM=FM().x(LM).y(BM).width(e=>e.width||0).height(e=>e.height||0).cornerRadius(e=>PM(e.cornerRadiusTopLeft,e.cornerRadius)||0,e=>PM(e.cornerRadiusTopRight,e.cornerRadius)||0,e=>PM(e.cornerRadiusBottomRight,e.cornerRadius)||0,e=>PM(e.cornerRadiusBottomLeft,e.cornerRadius)||0),qM=function(e,t){var n=null;function r(){var r;if(n||(n=r=WS()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),r)return n=null,r+""||null}return e="function"==typeof e?e:VS(e||iT),t="function"==typeof t?t:VS(void 0===t?64:+t),r.type=function(t){return arguments.length?(e="function"==typeof t?t:VS(t),r):e},r.size=function(e){return arguments.length?(t="function"==typeof e?e:VS(+e),r):t},r.context=function(e){return arguments.length?(n=null==e?null:e,r):n},r}().type(e=>TM(e.shape||"circle")).size(e=>PM(e.size,64)),GM=RM().x(LM).y(BM).defined($M).size(e=>e.size||1);function YM(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function XM(e,t,n,r){return VM.context(e)(t,n,r)}var KM=1;function ZM(){KM=1}function JM(e,t,n){var r=t.clip,i=e._defs,a=t.clip_id||(t.clip_id="clip"+KM++),o=i.clipping[a]||(i.clipping[a]={id:a});return Km(r)?o.path=r(null):YM(n)?o.path=XM(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+a+")"}function QM(e){this.clear(),e&&this.union(e)}function eN(e){this.mark=e,this.bounds=this.bounds||new QM}function tN(e){eN.call(this,e),this.items=this.items||[]}function nN(e){this._pending=0,this._loader=e||Mw()}function rN(e){e._pending+=1}function iN(e){e._pending-=1}function aN(e,t,n){if(t.stroke&&0!==t.opacity&&0!==t.strokeOpacity){const r=null!=t.strokeWidth?+t.strokeWidth:1;e.expand(r+(n?function(e,t){return e.strokeJoin&&"miter"!==e.strokeJoin?0:t}(t,r):0))}return e}QM.prototype={clone(){return new QM(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:a,y2:o}=this,s=Math.cos(e),l=Math.sin(e),u=t-t*s+n*l,c=n-t*l-n*s;return[s*r-l*i+u,l*r+s*i+c,s*r-l*o+u,l*r+s*o+c,s*a-l*i+u,l*a+s*i+c,s*a-l*o+u,l*a+s*o+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},hg(tN,eN),nN.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return rN(t),t._loader.sanitize(e,{context:"href"}).then(e=>(iN(t),e)).catch(()=>(iN(t),null))},loadImage(e){const t=this,n=oT();return rN(t),t._loader.sanitize(e,{context:"image"}).then(e=>{const r=e.href;if(!r||!n)throw{url:r};const i=new n,a=lg(e,"crossOrigin")?e.crossOrigin:"anonymous";return null!=a&&(i.crossOrigin=a),i.onload=()=>iN(t),i.onerror=()=>iN(t),i.src=r,i}).catch(e=>(iN(t),{complete:!1,width:0,height:0,src:e&&e.url||""}))},ready(){const e=this;return new Promise(t=>{!function n(r){e.pending()?setTimeout(()=>{n(!0)},10):t(r)}(!1)})}};const oN=pM-1e-8;let sN,lN,uN,cN,dN,hN,fN,pN;const mN=(e,t)=>sN.add(e,t),gN=(e,t)=>mN(lN=e,uN=t),vN=e=>mN(e,sN.y1),yN=e=>mN(sN.x1,e),bN=(e,t)=>dN*e+fN*t,xN=(e,t)=>hN*e+pN*t,wN=(e,t)=>mN(bN(e,t),xN(e,t)),_N=(e,t)=>gN(bN(e,t),xN(e,t));function kN(e,t){return sN=e,t?(cN=t*hM,dN=pN=Math.cos(cN),hN=Math.sin(cN),fN=-hN):(dN=pN=1,cN=hN=fN=0),EN}const EN={beginPath(){},closePath(){},moveTo:_N,lineTo:_N,rect(e,t,n,r){cN?(wN(e+n,t),wN(e+n,t+r),wN(e,t+r),_N(e,t)):(mN(e+n,t+r),gN(e,t))},quadraticCurveTo(e,t,n,r){const i=bN(e,t),a=xN(e,t),o=bN(n,r),s=xN(n,r);SN(lN,i,o,vN),SN(uN,a,s,yN),gN(o,s)},bezierCurveTo(e,t,n,r,i,a){const o=bN(e,t),s=xN(e,t),l=bN(n,r),u=xN(n,r),c=bN(i,a),d=xN(i,a);TN(lN,o,l,c,vN),TN(uN,s,u,d,yN),gN(c,d)},arc(e,t,n,r,i,a){if(r+=cN,i+=cN,lN=n*Math.cos(i)+e,uN=n*Math.sin(i)+t,Math.abs(i-r)>oN)mN(e-n,t-n),mN(e+n,t+n);else{const o=r=>mN(n*Math.cos(r)+e,n*Math.sin(r)+t);let s,l;if(o(r),o(i),i!==r)if((r%=pM)<0&&(r+=pM),(i%=pM)<0&&(i+=pM),i<r&&(a=!a,s=r,r=i,i=s),a)for(i-=pM,s=r-r%fM,l=0;l<4&&s>i;++l,s-=fM)o(s);else for(s=r-r%fM+fM,l=0;l<4&&s<i;++l,s+=fM)o(s)}}};function SN(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function TN(e,t,n,r,i){const a=r-e+3*t-3*n,o=e+n-2*t,s=e-t;let l,u=0,c=0;Math.abs(a)>1e-14?(l=o*o+s*a,l>=0&&(l=Math.sqrt(l),u=(-o+l)/a,c=(-o-l)/a)):u=.5*s/o,0<u&&u<1&&i(CN(u,e,t,n,r)),0<c&&c<1&&i(CN(c,e,t,n,r))}function CN(e,t,n,r,i){const a=1-e,o=a*a,s=e*e;return o*a*t+3*o*e*n+3*a*s*r+s*e*i}var IN=(IN=aT(1,1))?IN.getContext("2d"):null;const AN=new QM;function ON(e){return function(t,n){if(!IN)return!0;e(IN,t),AN.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:a,y2:o}=AN;for(let e=i;e<=o;++e)for(let t=r;t<=a;++t)if(IN.isPointInPath(t,e))return!0;return!1}}function DN(e,t){return t.contains(e.x||0,e.y||0)}function MN(e,t){const n=e.x||0,r=e.y||0;return t.intersects(AN.set(n,r,n+(e.width||0),r+(e.height||0)))}function NN(e,t){const n=e.x||0,r=e.y||0;return jN(t,n,r,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r)}function jN(e,t,n,r,i){const{x1:a,y1:o,x2:s,y2:l}=e,u=r-t,c=i-n;let d,h,f,p,m=0,g=1;for(p=0;p<4;++p){if(0===p&&(d=-u,h=-(a-t)),1===p&&(d=u,h=s-t),2===p&&(d=-c,h=-(o-n)),3===p&&(d=c,h=l-n),Math.abs(d)<1e-10&&h<0)return!1;if(f=h/d,d<0){if(f>g)return!1;f>m&&(m=f)}else if(d>0){if(f<m)return!1;f<g&&(g=f)}}return!0}function FN(e,t){e.globalCompositeOperation=t.blend||"source-over"}function RN(e,t){return null==e?t:e}function PN(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function LN(e,t,n){return rM(n)?function(e,t,n){const r=n.width(),i=n.height();let a;if("radial"===t.gradient)a=e.createRadialGradient(n.x1+RN(t.x1,.5)*r,n.y1+RN(t.y1,.5)*i,Math.max(r,i)*RN(t.r1,0),n.x1+RN(t.x2,.5)*r,n.y1+RN(t.y2,.5)*i,Math.max(r,i)*RN(t.r2,.5));else{const o=RN(t.x1,0),s=RN(t.y1,0),l=RN(t.x2,1),u=RN(t.y2,0);if(o!==l&&s!==u&&r!==i){const n=aT(Math.ceil(r),Math.ceil(i)),a=n.getContext("2d");return a.scale(r,i),a.fillStyle=PN(a.createLinearGradient(o,s,l,u),t.stops),a.fillRect(0,0,r,i),e.createPattern(n,"no-repeat")}a=e.createLinearGradient(n.x1+o*r,n.y1+s*i,n.x1+l*r,n.y1+u*i)}return PN(a,t.stops)}(e,n,t.bounds):n}function BN(e,t,n){return(n*=null==t.fillOpacity?1:t.fillOpacity)>0&&(e.globalAlpha=n,e.fillStyle=LN(e,t,t.fill),!0)}var $N=[];function zN(e,t,n){var r=null!=(r=t.strokeWidth)?r:1;return!(r<=0)&&(n*=null==t.strokeOpacity?1:t.strokeOpacity)>0&&(e.globalAlpha=n,e.strokeStyle=LN(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||$N),e.lineDashOffset=t.strokeDashOffset||0),!0)}function UN(e,t){return e.zindex-t.zindex||e.index-t.index}function HN(e){if(!e.zdirty)return e.zitems;var t,n,r,i=e.items,a=[];for(n=0,r=i.length;n<r;++n)(t=i[n]).index=n,t.zindex&&a.push(t);return e.zdirty=!1,e.zitems=a.sort(UN)}function WN(e,t){var n,r,i=e.items;if(!i||!i.length)return;const a=HN(e);if(a&&a.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||t(i[n]);i=a}for(n=0,r=i.length;n<r;++n)t(i[n])}function VN(e,t){var n,r,i=e.items;if(!i||!i.length)return null;const a=HN(e);for(a&&a.length&&(i=a),r=i.length;--r>=0;)if(n=t(i[r]))return n;if(i===a)for(r=(i=e.items).length;--r>=0;)if(!i[r].zindex&&(n=t(i[r])))return n;return null}function qN(e){return function(t,n,r){WN(n,n=>{r&&!r.intersects(n.bounds)||GN(e,t,n,n)})}}function GN(e,t,n,r){var i=null==n.opacity?1:n.opacity;0!==i&&(e(t,r)||(FN(t,n),n.fill&&BN(t,n,i)&&t.fill(),n.stroke&&zN(t,n,i)&&t.stroke()))}function YN(e){return e=e||pm,function(t,n,r,i,a,o){return r*=t.pixelRatio,i*=t.pixelRatio,VN(n,n=>{const s=n.bounds;if((!s||s.contains(a,o))&&s)return e(t,n,r,i,a,o)?n:void 0})}}function XN(e,t){return function(n,r,i,a){var o,s,l=Array.isArray(r)?r[0]:r,u=null==t?l.fill:t,c=l.stroke&&n.isPointInStroke;return c&&(s=l.strokeCap,n.lineWidth=null!=(o=l.strokeWidth)?o:1,n.lineCap=null!=s?s:"butt"),!e(n,r)&&(u&&n.isPointInPath(i,a)||c&&n.isPointInStroke(i,a))}}function KN(e){return YN(XN(e))}function ZN(e,t){return"translate("+e+","+t+")"}function JN(e){return"rotate("+e+")"}function QN(e){return ZN(e.x||0,e.y||0)}function ej(e,t,n){function r(e,n){var r=n.x||0,i=n.y||0,a=n.angle||0;e.translate(r,i),a&&e.rotate(a*=hM),e.beginPath(),t(e,n),a&&e.rotate(-a),e.translate(-r,-i)}return{type:e,tag:"path",nested:!1,attr:function(e,n){e("transform",function(e){return ZN(e.x||0,e.y||0)+(e.angle?" "+JN(e.angle):"")}(n)),e("d",t(null,n))},bound:function(e,n){return t(kN(e,n.angle),n),aN(e,n).translate(n.x||0,n.y||0)},draw:qN(r),pick:KN(r),isect:n||ON(r)}}var tj=ej("arc",(function(e,t){return zM.context(e)(t)}));function nj(e,t,n){function r(e,n){e.beginPath(),t(e,n)}const i=XN(r);return{type:e,tag:"path",nested:!0,attr:function(e,n){var r=n.mark.items;r.length&&e("d",t(null,r))},bound:function(e,n){var r=n.items;return 0===r.length?e:(t(kN(e),r),aN(e,r[0]))},draw:(a=r,function(e,t,n){!t.items.length||n&&!n.intersects(t.bounds)||GN(a,e,t.items[0],t.items)}),pick:function(e,t,n,r,a,o){var s=t.items,l=t.bounds;return!s||!s.length||l&&!l.contains(a,o)?null:i(e,s,n*=e.pixelRatio,r*=e.pixelRatio)?s[0]:null},isect:DN,tip:n};var a}var rj=nj("area",(function(e,t){const n=t[0];return("horizontal"===n.orient?HM:UM).curve(lM(n.interpolate||"linear",n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i="horizontal"===e[0].orient?t[1]:t[0],a="horizontal"===e[0].orient?"y":"x",o=e.length,s=1/0;--o>=0;)!1!==e[o].defined&&(r=Math.abs(e[o][a]-i))<s&&(s=r,n=e[o]);return n}));function ij(e,t){e.beginPath(),YM(t)?XM(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function aj(e){const t=RN(e.strokeWidth,1);return null!=e.strokeOffset?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function oj(e,t){const n=aj(t);e("d",XM(null,t,n,n))}function sj(e,t,n,r){const i=aj(t);e.beginPath(),XM(e,t,(n||0)+i,(r||0)+i)}const lj=XN(sj),uj=XN(sj,!1),cj=XN(sj,!0);var dj={type:"group",tag:"g",nested:!1,attr:function(e,t){e("transform",QN(t))},bound:function(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let t=0;t<r;++t)e.union(n[t].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),aN(e,t),e.translate(t.x||0,t.y||0)},draw:function(e,t,n){WN(t,t=>{const r=t.x||0,i=t.y||0,a=t.strokeForeground,o=null==t.opacity?1:t.opacity;(t.stroke||t.fill)&&o&&(sj(e,t,r,i),FN(e,t),t.fill&&BN(e,t,o)&&e.fill(),t.stroke&&!a&&zN(e,t,o)&&e.stroke()),e.save(),e.translate(r,i),t.clip&&ij(e,t),n&&n.translate(-r,-i),WN(t,t=>{this.draw(e,t,n)}),n&&n.translate(r,i),e.restore(),a&&t.stroke&&o&&(sj(e,t,r,i),FN(e,t),zN(e,t,o)&&e.stroke())})},pick:function(e,t,n,r,i,a){if(t.bounds&&!t.bounds.contains(i,a)||!t.items)return null;const o=n*e.pixelRatio,s=r*e.pixelRatio;return VN(t,l=>{let u,c,d;const h=l.bounds;if(h&&!h.contains(i,a))return;c=l.x||0,d=l.y||0;const f=l.clip;if(f&&(i<c||i>c+(l.width||0)||a<d||a>d+(l.height||0)))return;if(e.save(),e.translate(c,d),c=i-c,d=a-d,f&&YM(l)&&!cj(e,l,o,s))return e.restore(),null;const p=l.strokeForeground,m=!1!==t.interactive;return m&&p&&l.stroke&&uj(e,l,o,s)?(e.restore(),l):(u=VN(l,e=>function(e,t,n){return(!1!==e.interactive||"group"===e.marktype)&&e.bounds&&e.bounds.contains(t,n)}(e,c,d)?this.pick(e,n,r,c,d):null),!u&&m&&(l.fill||!p&&l.stroke)&&lj(e,l,o,s)&&(u=l),e.restore(),u||null)})},isect:MN,content:function(e,t,n){e("clip-path",t.clip?JM(n,t,t):null)},background:function(e,t){e("class","background"),e("aria-hidden",!0),oj(e,t)},foreground:function(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?oj(e,t):e("d","")}},hj={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function fj(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(t=>{e.image=t,e.image.url=e.url})),n}function pj(e,t){return null!=e.width?e.width:t&&t.width?!1!==e.aspect&&e.height?e.height*t.width/t.height:t.width:0}function mj(e,t){return null!=e.height?e.height:t&&t.height?!1!==e.aspect&&e.width?e.width*t.height/t.width:t.height:0}function gj(e,t){return"center"===e?t/2:"right"===e?t:0}function vj(e,t){return"middle"===e?t/2:"bottom"===e?t:0}var yj={type:"image",tag:"image",nested:!1,attr:function(e,t,n){const r=fj(t,n),i=pj(t,r),a=mj(t,r),o=(t.x||0)-gj(t.align,i),s=(t.y||0)-vj(t.baseline,a);e("href",!r.src&&r.toDataURL?r.toDataURL():r.src||"",hj["xmlns:xlink"],"xlink:href"),e("transform",ZN(o,s)),e("width",i),e("height",a),e("preserveAspectRatio",!1===t.aspect?"none":"xMidYMid")},bound:function(e,t){const n=t.image,r=pj(t,n),i=mj(t,n),a=(t.x||0)-gj(t.align,r),o=(t.y||0)-vj(t.baseline,i);return e.set(a,o,a+r,o+i)},draw:function(e,t,n){WN(t,t=>{if(n&&!n.intersects(t.bounds))return;const r=fj(t,this);let i,a,o,s,l=pj(t,r),u=mj(t,r),c=(t.x||0)-gj(t.align,l),d=(t.y||0)-vj(t.baseline,u);!1!==t.aspect&&(a=r.width/r.height,o=t.width/t.height,a==a&&o==o&&a!==o&&(o<a?(s=l/a,d+=(u-s)/2,u=s):(s=u*a,c+=(l-s)/2,l=s))),(r.complete||r.toDataURL)&&(FN(e,t),e.globalAlpha=null!=(i=t.opacity)?i:1,e.imageSmoothingEnabled=!1!==t.smooth,e.drawImage(r,c,d,l,u))})},pick:YN(),isect:pm,get:fj,xOffset:gj,yOffset:vj},bj=nj("line",(function(e,t){const n=t[0];return WM.curve(lM(n.interpolate||"linear",n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i=Math.pow(e[0].strokeWidth||1,2),a=e.length;--a>=0;)if(!1!==e[a].defined&&(n=e[a].x-t[0])*n+(r=e[a].y-t[1])*r<i)return e[a];return null}));function xj(e,t){var n=t.path;if(null==n)return!0;var r=t.x||0,i=t.y||0,a=t.scaleX||1,o=t.scaleY||1,s=(t.angle||0)*hM,l=t.pathCache;l&&l.path===n||((t.pathCache=l=dM(n)).path=n),s&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(s),_M(e,l,0,0,a,o),e.rotate(-s),e.translate(-r,-i)):_M(e,l,r,i,a,o)}var wj={type:"path",tag:"path",nested:!1,attr:function(e,t){1===(t.scaleX||1)&&1===(t.scaleY||1)||e("vector-effect","non-scaling-stroke"),e("transform",function(e){return ZN(e.x||0,e.y||0)+(e.angle?" "+JN(e.angle):"")+(e.scaleX||e.scaleY?" scale("+(e.scaleX||1)+","+(e.scaleY||1)+")":"")}(t)),e("d",t.path)},bound:function(e,t){return xj(kN(e,t.angle),t)?e.set(0,0,0,0):aN(e,t,!0)},draw:qN(xj),pick:KN(xj),isect:ON(xj)};function _j(e,t){e.beginPath(),XM(e,t)}var kj={type:"rect",tag:"path",nested:!1,attr:function(e,t){e("d",XM(null,t))},bound:function(e,t){var n,r;return aN(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)},draw:qN(_j),pick:KN(_j),isect:MN};function Ej(e,t,n){var r,i,a,o;return!(!t.stroke||!zN(e,t,n)||(r=t.x||0,i=t.y||0,a=null!=t.x2?t.x2:r,o=null!=t.y2?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(a,o),0))}var Sj={type:"rule",tag:"line",nested:!1,attr:function(e,t){e("transform",QN(t)),e("x2",null!=t.x2?t.x2-(t.x||0):0),e("y2",null!=t.y2?t.y2-(t.y||0):0)},bound:function(e,t){var n,r;return aN(e.set(n=t.x||0,r=t.y||0,null!=t.x2?t.x2:n,null!=t.y2?t.y2:r),t)},draw:function(e,t,n){WN(t,t=>{if(!n||n.intersects(t.bounds)){var r=null==t.opacity?1:t.opacity;r&&Ej(e,t,r)&&(FN(e,t),e.stroke())}})},pick:YN((function(e,t,n,r){return!!e.isPointInStroke&&Ej(e,t,1)&&e.isPointInStroke(n,r)})),isect:NN},Tj=ej("shape",(function(e,t){return(t.mark.shape||t.shape).context(e)(t)})),Cj=ej("symbol",(function(e,t){return qM.context(e)(t)}),DN);const Ij=_g();var Aj={height:Fj,measureWidth:Nj,estimateWidth:Dj,width:Dj,canvas:Oj};function Oj(e){Aj.width=e&&IN?Nj:Dj}function Dj(e,t){return Mj(Bj(e,t),Fj(e))}function Mj(e,t){return~~(.8*e.length*t)}function Nj(e,t){return Fj(e)<=0||!(t=Bj(e,t))?0:jj(t,zj(e))}function jj(e,t){const n="(".concat(t,") ").concat(e);let r=Ij.get(n);return void 0===r&&(IN.font=t,r=IN.measureText(e).width,Ij.set(n,r)),r}function Fj(e){return null!=e.fontSize?+e.fontSize||0:11}function Rj(e){return null!=e.lineHeight?e.lineHeight:Fj(e)+2}function Pj(e){return t=e.lineBreak&&e.text&&!km(e.text)?e.text.split(e.lineBreak):e.text,km(t)?t.length>1?t:t[0]:t;var t}function Lj(e){const t=Pj(e);return(km(t)?t.length-1:0)*Rj(e)}function Bj(e,t){const n=null==t?"":(t+"").trim();return e.limit>0&&n.length?function(e,t){var n=+e.limit,r=function(e){if(Aj.width===Nj){const t=zj(e);return e=>jj(e,t)}{const t=Fj(e);return e=>Mj(e,t)}}(e);if(r(t)<n)return t;var i,a=e.ellipsis||"\u2026",o="rtl"===e.dir,s=0,l=t.length;if(n-=r(a),o){for(;s<l;)r(t.slice(i=s+l>>>1))>n?s=i+1:l=i;return a+t.slice(s)}for(;s<l;)r(t.slice(0,i=1+(s+l>>>1)))<n?s=i:l=i-1;return t.slice(0,s)+a}(e,n):n}function $j(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function zj(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+Fj(e)+"px "+$j(e,t)}function Uj(e){var t=e.baseline,n=Fj(e);return Math.round("top"===t?.79*n:"middle"===t?.3*n:"bottom"===t?-.21*n:"line-top"===t?.29*n+.5*Rj(e):"line-bottom"===t?.29*n-.5*Rj(e):0)}Oj(!0);const Hj={left:"start",center:"middle",right:"end"},Wj=new QM;function Vj(e){var t,n=e.x||0,r=e.y||0,i=e.radius||0;return i&&(t=(e.theta||0)-fM,n+=i*Math.cos(t),r+=i*Math.sin(t)),Wj.x1=n,Wj.y1=r,Wj}function qj(e,t,n){var r,i=Aj.height(t),a=t.align,o=Vj(t),s=o.x1,l=o.y1,u=t.dx||0,c=(t.dy||0)+Uj(t)-Math.round(.8*i),d=Pj(t);if(km(d)?(i+=Rj(t)*(d.length-1),r=d.reduce((e,n)=>Math.max(e,Aj.width(t,n)),0)):r=Aj.width(t,d),"center"===a?u-=r/2:"right"===a&&(u-=r),e.set(u+=s,c+=l,u+r,c+i),t.angle&&!n)e.rotate(t.angle*hM,s,l);else if(2===n)return e.rotatedPoints(t.angle*hM,s,l);return e}var Gj={arc:tj,area:rj,group:dj,image:yj,line:bj,path:wj,rect:kj,rule:Sj,shape:Tj,symbol:Cj,text:{type:"text",tag:"text",nested:!1,attr:function(e,t){var n,r=t.dx||0,i=(t.dy||0)+Uj(t),a=Vj(t),o=a.x1,s=a.y1,l=t.angle||0;e("text-anchor",Hj[t.align]||"start"),l?(n=ZN(o,s)+" "+JN(l),(r||i)&&(n+=" "+ZN(r,i))):n=ZN(o+r,s+i),e("transform",n)},bound:qj,draw:function(e,t,n){WN(t,t=>{var r,i,a,o,s,l,u,c=null==t.opacity?1:t.opacity;if(!(n&&!n.intersects(t.bounds)||0===c||t.fontSize<=0||null==t.text||0===t.text.length)){if(e.font=zj(t),e.textAlign=t.align||"left",i=(r=Vj(t)).x1,a=r.y1,t.angle&&(e.save(),e.translate(i,a),e.rotate(t.angle*hM),i=a=0),i+=t.dx||0,a+=(t.dy||0)+Uj(t),l=Pj(t),FN(e,t),km(l))for(s=Rj(t),o=0;o<l.length;++o)u=Bj(t,l[o]),t.fill&&BN(e,t,c)&&e.fillText(u,i,a),t.stroke&&zN(e,t,c)&&e.strokeText(u,i,a),a+=s;else u=Bj(t,l),t.fill&&BN(e,t,c)&&e.fillText(u,i,a),t.stroke&&zN(e,t,c)&&e.strokeText(u,i,a);t.angle&&e.restore()}})},pick:YN((function(e,t,n,r,i,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=Vj(t),s=o.x1,l=o.y1,u=qj(Wj,t,1),c=-t.angle*hM,d=Math.cos(c),h=Math.sin(c);return u.contains(d*i-h*a+(s-d*s+h*l),h*i+d*a+(l-h*s-d*l))})),isect:function(e,t){const n=qj(Wj,e,2);return jN(t,n[0],n[1],n[2],n[3])||jN(t,n[0],n[1],n[4],n[5])||jN(t,n[4],n[5],n[6],n[7])||jN(t,n[2],n[3],n[6],n[7])}},trail:nj("trail",(function(e,t){return GM.context(e)(t)}),(function(e,t){for(var n,r,i=e.length;--i>=0;)if(!1!==e[i].defined&&(n=e[i].x-t[0])*n+(r=e[i].y-t[1])*r<(n=e[i].size||1)*n)return e[i];return null}))};function Yj(e,t,n){var r=Gj[e.mark.marktype];return r.nested&&(e=e.mark),(t||r.bound)(e.bounds||(e.bounds=new QM),e,n)}var Xj={mark:null};function Kj(e,t,n){var r,i,a,o,s=Gj[e.marktype],l=s.bound,u=e.items,c=u&&u.length;if(s.nested)return c?a=u[0]:(Xj.mark=e,a=Xj),o=Yj(a,l,n),t&&t.union(o)||o;if(t=t||e.bounds&&e.bounds.clear()||new QM,c)for(r=0,i=u.length;r<i;++r)t.union(Yj(u[r],l,n));return e.bounds=t}const Zj=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function Jj(e,t){return JSON.stringify(e,Zj,t)}function Qj(e){return function e(t){var n,r,i,a=t.marktype,o=t.items;if(o)for(r=0,i=o.length;r<i;++r)o[r][n=a?"mark":"group"]=t,o[r].zindex&&(o[r][n].zdirty=!0),"group"===(a||n)&&e(o[r]);return a&&Kj(t),t}("string"==typeof e?JSON.parse(e):e)}function eF(e){arguments.length?this.root=Qj(e):(this.root=tF({marktype:"group",name:"root",role:"frame"}),this.root.items=[new tN(this.root)])}function tF(e,t){const n={bounds:new QM,clip:!!e.clip,group:t,interactive:!1!==e.interactive,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return null!=e.aria&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function nF(e,t,n){return!e&&"undefined"!=typeof document&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function rF(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function iF(e,t,n,r){var i,a=e.childNodes[t];return a&&a.tagName.toLowerCase()===n.toLowerCase()||(i=a||null,a=nF(e.ownerDocument,n,r),e.insertBefore(a,i)),a}function aF(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function oF(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function sF(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function lF(e,t){this._active=null,this._handlers={},this._loader=e||Mw(),this._tooltip=t||uF}function uF(e,t,n,r){e.element().setAttribute("title",r||"")}function cF(e){this._el=null,this._bgcolor=null,this._loader=new nN(e)}eF.prototype={toJSON(e){return Jj(this.root,e||0)},mark(e,t,n){const r=tF(e,t=t||this.root.items[0]);return t.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}},lF.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const r in t)n.push(...t[r]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(t=>{const n=new MouseEvent(e.type,e),r=nF(null,"a");for(const e in t)r.setAttribute(e,t[e]);r.dispatchEvent(n)}).catch(()=>{})},handleTooltip(e,t,n){t&&null!=t.tooltip&&(t=function(e,t,n,r){var i,a,o=e&&e.mark;if(o&&(i=Gj[o.marktype]).tip){for((a=sF(t,n))[0]-=r[0],a[1]-=r[1];e=e.mark.group;)a[0]-=e.x||0,a[1]-=e.y||0;e=i.tip(o.items,a)}return e}(t,e,this.canvas(),this._origin),this._tooltip.call(this._obj,this,e,t,n&&t&&t.tooltip||null))},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,a=i.width(),o=i.height();let s=i.x1+r[0]+n.left,l=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)s+=e.x||0,l+=e.y||0;return{x:s,y:l,width:a,height:o,left:s,top:l,right:s+a,bottom:l+o}}},cF.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return 0===arguments.length?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then(()=>t):Promise.resolve(t)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const e=n._call;n._ready=n._loader.ready().then(t=>{t&&e(),n._ready=null})}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const dF="dragenter",hF="dragleave",fF="dragover",pF="mousedown",mF="mousemove",gF="mouseout",vF="mouseover",yF="click",bF="mousewheel",xF="touchstart",wF="touchmove",_F="touchend",kF=mF,EF=gF,SF=yF;function TF(e,t){lF.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}function CF(e,t){(e=>e===xF||e===wF||e===_F?[xF,wF,_F]:[e])(t).forEach(t=>function(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?n=>e[t](n):n=>e.fire(t,n)))}(e,t))}function IF(e,t,n){return function(r){const i=this._active,a=this.pickEvent(r);a===i||(i&&i.exit||this.fire(n,r),this._active=a,this.fire(t,r)),this.fire(e,r)}}function AF(e){return function(t){this.fire(e,t),this._active=null}}hg(TF,lF,{initialize(e,t,n){return this._canvas=e&&rF(e,"canvas"),[yF,pF,mF,gF,hF].forEach(e=>CF(this,e)),lF.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:["keydown","keypress","keyup",dF,hF,fF,pF,"mouseup",mF,gF,vF,yF,"dblclick","wheel",bF,xF,wF,_F],DOMMouseScroll(e){this.fire(bF,e)},mousemove:IF(mF,vF,gF),dragover:IF(fF,dF,hF),mouseout:AF(gF),dragleave:AF(hF),mousedown(e){this._down=this._active,this.fire(pF,e)},click(e){this._down===this._active&&(this.fire(yF,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(xF,e,!0)},touchmove(e){this.fire(wF,e,!0)},touchend(e){this.fire(_F,e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===SF&&r&&r.href?this.handleHref(t,r,r.href):e!==kF&&e!==EF||this.handleTooltip(t,r,e!==EF),i)for(let a=0,o=i.length;a<o;++a)i[a].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(CF(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=sF(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const a=this.context();return Gj[e.marktype].pick.call(this,a,e,t,n,r,i)}});var OF="undefined"!=typeof window&&window.devicePixelRatio||1;function DF(e){cF.call(this,e),this._options={},this._redraw=!1,this._dirty=new QM,this._tempb=new QM}const MF=cF.prototype;function NF(e,t){lF.call(this,e,t);const n=this;n._hrefHandler=jF(n,(e,t)=>{t&&t.href&&n.handleHref(e,t,t.href)}),n._tooltipHandler=jF(n,(e,t)=>{n.handleTooltip(e,t,e.type!==EF)})}hg(DF,cF,{initialize(e,t,n,r,i,a){return this._options=a||{},this._canvas=this._options.externalContext?null:aT(1,1),e&&this._canvas&&(aF(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),MF.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(MF.resize.call(this,e,t,n,r),this._canvas)!function(e,t,n,r,i,a){const o="undefined"!=typeof HTMLElement&&e instanceof HTMLElement&&null!=e.parentNode,s=e.getContext("2d"),l=o?OF:i;e.width=t*l,e.height=n*l;for(const u in a)s[u]=a[u];o&&1!==l&&(e.style.width=t+"px",e.style.height=n+"px"),s.pixelRatio=l,s.setTransform(l,0,0,l,l*r[0],l*r[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const e=this._options.externalContext;e||sm("CanvasRenderer is missing a valid canvas or context"),e.scale(this._scale,this._scale),e.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty,o=(s=n,l=r,u=i,(new QM).set(0,0,l,u).translate(-s[0],-s[1]));var s,l,u;t.save();const c=this._redraw||a.empty()?(this._redraw=!1,o.expand(1)):function(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-n[0]%1,-n[1]%1),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}(t,o.intersect(a),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,c),t.restore(),a.clear(),this},draw(e,t,n){const r=Gj[t.marktype];t.clip&&function(e,t){var n=t.clip;e.save(),Km(n)?(e.beginPath(),n(e),e.clip()):ij(e,t.group)}(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,a=this.context();"pdf"===i.type||i.externalContext||a.clearRect(e,t,n,r),null!=this._bgcolor&&(a.fillStyle=this._bgcolor,a.fillRect(e,t,n,r))}});const jF=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};hg(NF,lF,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(SF,this._hrefHandler),r.removeEventListener(kF,this._tooltipHandler),r.removeEventListener(EF,this._tooltipHandler)),this._svg=r=e&&rF(e,"svg"),r&&(r.addEventListener(SF,this._hrefHandler),r.addEventListener(kF,this._tooltipHandler),r.addEventListener(EF,this._tooltipHandler)),lF.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){const i={type:e,handler:t,listener:jF(this,t)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const FF="aria-hidden",RF="aria-label",PF="role",LF="aria-roledescription",BF="graphics-object",$F="graphics-symbol",zF=(e,t,n)=>({[PF]:e,[LF]:t,[RF]:n||void 0}),UF=Mg(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),HF={axis:{desc:"axis",caption:function(e){const t=e.datum,n=e.orient,r=t.title?YF(e):null,i=e.context,a=i.scales[t.scale].value,o=i.dataflow.locale(),s=a.type;return"".concat("left"===n||"right"===n?"Y":"X","-axis")+(r?" titled '".concat(r,"'"):"")+" for a ".concat(wD(s)?"discrete":s," scale")+" with ".concat(eM(o,a,e))}},legend:{desc:"legend",caption:function(e){const t=e.datum,n=t.title?YF(e):null,r="".concat(t.type||""," legend").trim(),i=t.scales,a=Object.keys(i),o=e.context,s=o.scales[i[a[0]]].value,l=o.dataflow.locale();return((u=r).length?u[0].toUpperCase()+u.slice(1):u)+(n?" titled '".concat(n,"'"):"")+" for ".concat(function(e){return(e=e.map(e=>e+("fill"===e||"stroke"===e?" color":""))).length<2?e[0]:e.slice(0,-1).join(", ")+" and "+Am(e)}(a))+" with ".concat(eM(l,s,e));var u}},"title-text":{desc:"title",caption:e=>"Title text '".concat(GF(e),"'")},"title-subtitle":{desc:"subtitle",caption:e=>"Subtitle text '".concat(GF(e),"'")}},WF={ariaRole:PF,ariaRoleDescription:LF,description:RF};function VF(e,t){const n=!1===t.aria;if(e(FF,n||void 0),n||null==t.description)for(const r in WF)e(WF[r],void 0);else{const n=t.mark.marktype;e(RF,t.description),e(PF,t.ariaRole||("group"===n?BF:$F)),e(LF,t.ariaRoleDescription||"".concat(n," mark"))}}function qF(e){return!1===e.aria?{[FF]:!0}:UF[e.role]?null:HF[e.role]?function(e,t){try{const n=e.items[0],r=t.caption||(()=>"");return zF(t.role||$F,t.desc,n.description||r(n))}catch(n){return null}}(e,HF[e.role]):function(e){const t=e.marktype,n="group"===t||"text"===t||e.items.some(e=>null!=e.description&&!1!==e.aria);return zF(n?BF:$F,"".concat(t," mark container"),e.description)}(e)}function GF(e){return Ym(e.text).join(" ")}function YF(e){try{return Ym(Am(e.items).items[0].text).join(" ")}catch(t){return null}}const XF=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function KF(){let e="",t="",n="";const r=[],i=()=>t=n="",a=(e,n)=>(null!=n&&(t+=" ".concat(e,'="').concat(XF(n).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;"),'"')),o),o={open(s,...l){(a=>{t&&(e+="".concat(t,">").concat(n),i()),r.push(a)})(s),t="<"+s;for(const e of l)for(const t in e)a(t,e[t]);return o},close(){const a=r.pop();return e+=t?t+(n?">".concat(n,"</").concat(a,">"):"/>"):"</".concat(a,">"),i(),o},attr:a,text:e=>(n+=XF(e),o),toString:()=>e};return o}const ZF=e=>function e(t,n){if(t.open(n.tagName),n.hasAttributes()){const e=n.attributes,r=e.length;for(let n=0;n<r;++n)t.attr(e[n].name,e[n].value)}if(n.hasChildNodes()){const r=n.childNodes,i=r.length;for(let n=0;n<i;n++){const i=r[n];3===i.nodeType?t.text(i.nodeValue):e(t,i)}}return t.close()}(KF(),e)+"",JF={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},QF={fill:"none","stroke-miterlimit":10},eR=hj.xmlns;function tR(e){cF.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const nR=cF.prototype;function rR(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function iR(e,t,n){let r,i,a;if("radial"===t.gradient){let r=iF(e,n++,"pattern",eR);hR(r,{id:nM+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),r=iF(r,0,"rect",eR),hR(r,{width:1,height:1,fill:"url(".concat(pR(),"#").concat(t.id,")")}),hR(e=iF(e,n++,"radialGradient",eR),{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else hR(e=iF(e,n++,"linearGradient",eR),{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)a=iF(e,r,"stop",eR),a.setAttribute("offset",t.stops[r].offset),a.setAttribute("stop-color",t.stops[r].color);return aF(e,r),n}function aR(e,t,n){let r;return(e=iF(e,n,"clipPath",eR)).setAttribute("id",t.id),t.path?(r=iF(e,0,"path",eR),r.setAttribute("d",t.path)):(r=iF(e,0,"rect",eR),hR(r,{x:0,y:0,width:t.width,height:t.height})),aF(e,1),n+1}function oR(e,t,n,r,i){let a,o=e._svg;if(!o&&(a=t.ownerDocument,o=nF(a,r,eR),e._svg=o,e.mark&&(o.__data__=e,o.__values__={fill:"default"},"g"===r))){const t=nF(a,"path",eR);o.appendChild(t),t.__data__=e;const n=nF(a,"g",eR);o.appendChild(n),n.__data__=e;const r=nF(a,"path",eR);o.appendChild(r),r.__data__=e,r.__values__={fill:"default"}}return(o.ownerSVGElement!==i||function(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}(o,n))&&t.insertBefore(o,n?n.nextSibling:t.firstChild),o}hg(tR,cF,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=iF(e,0,"svg",eR),hR(this._svg,hj),this._svg.setAttribute("class","marks"),aF(e,1),this._root=iF(this._svg,0,"g",eR),hR(this._root,QF),aF(this._svg,1)),this.background(this._bgcolor),nR.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),nR.background.apply(this,arguments)},resize(e,t,n,r){return nR.resize.call(this,e,t,n,r),this._svg&&(hR(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}),this._root.setAttribute("transform","translate(".concat(this._origin,")"))),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=iF(e,0,"rect",eR),hR(n,{width:this._width,height:this._height,fill:t}));const r=ZF(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),aF(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,a,o,s,l;for(o=0,s=e.length;o<s;++o)n=e[o],r=n.mark,r.marktype!==i&&(i=r.marktype,a=Gj[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,rR(n,t),r.items.forEach(e=>{e.dirty=t})),r.zdirty||(n.exit?(a.nested&&r.items.length?(l=r.items[0],l._svg&&this._update(a,l._svg,l)):n._svg&&(l=n._svg.parentNode,l&&l.removeChild(n._svg)),n._svg=null):(n=a.nested?r.items[0]:n,n._update!==t&&(n._svg&&n._svg.ownerSVGElement?this._update(a,n._svg,n):(this._dirtyAll=!1,rR(n,t)),n._update=t)));return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const r=this._svg,i=Gj[t.marktype],a=!1===t.interactive?"none":null,o="g"===i.tag;let s=null,l=0;const u=oR(t,e,n,"g",r);u.setAttribute("class",oF(t));const c=qF(t);for(const h in c)fR(u,h,c[h]);o||fR(u,"pointer-events",a),fR(u,"clip-path",t.clip?JM(this,t,t.group):null);const d=e=>{const t=this.isDirty(e),n=oR(e,u,s,i.tag,r);t&&(this._update(i,n,e),o&&function(e,t,n){t=t.lastChild.previousSibling;let r,i=0;WN(n,n=>{r=e.mark(t,n,r),++i}),aF(t,1+i)}(this,n,e)),s=n,++l};return i.nested?t.items.length&&d(t.items[0]):WN(t,d),aF(u,l),u},_update(e,t,n){sR=t,lR=t.__values__,VF(cR,n),e.attr(cR,n,this);const r=uR[e.type];r&&r.call(this,e,t,n),sR&&this.style(sR,n)},style(e,t){if(null!=t)for(const n in JF){let r="font"===n?$j(t):t[n];if(r===lR[n])continue;const i=JF[n];null==r?e.removeAttribute(i):(rM(r)&&(r=iM(r,this._defs.gradient,pR())),e.setAttribute(i,r+"")),lR[n]=r}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=iF(e,1,"defs",eR)),r=iR(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=iF(e,1,"defs",eR)),r=aR(n,t.clipping[i],r);n&&(0===r?(e.removeChild(n),t.el=null):aF(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});let sR=null,lR=null;const uR={group(e,t,n){const r=sR=t.childNodes[2];lR=r.__values__,e.foreground(cR,n,this),lR=t.__values__,sR=t.childNodes[1],e.content(cR,n,this);const i=sR=t.childNodes[0];e.background(cR,n,this);const a=!1===n.mark.interactive?"none":null;if(a!==lR.events&&(fR(r,"pointer-events",a),fR(i,"pointer-events",a),lR.events=a),n.strokeForeground&&n.stroke){const e=n.fill;fR(r,"display",null),this.style(i,n),fR(i,"stroke",null),e&&(n.fill=null),lR=r.__values__,this.style(r,n),e&&(n.fill=e),sR=null}else fR(r,"display","none")},image(e,t,n){!1===n.smooth?(dR(t,"image-rendering","optimizeSpeed"),dR(t,"image-rendering","pixelated")):dR(t,"image-rendering",null)},text(e,t,n){const r=Pj(n);let i,a,o,s;km(r)?(a=r.map(e=>Bj(n,e)),i=a.join("\n"),i!==lR.text&&(aF(t,0),o=t.ownerDocument,s=Rj(n),a.forEach((e,r)=>{const i=nF(o,"tspan",eR);i.__data__=n,i.textContent=e,r&&(i.setAttribute("x",0),i.setAttribute("dy",s)),t.appendChild(i)}),lR.text=i)):(a=Bj(n,r),a!==lR.text&&(t.textContent=a,lR.text=a)),fR(t,"font-family",$j(n)),fR(t,"font-size",Fj(n)+"px"),fR(t,"font-style",n.fontStyle),fR(t,"font-variant",n.fontVariant),fR(t,"font-weight",n.fontWeight)}};function cR(e,t,n){t!==lR[e]&&(n?function(e,t,n,r){null!=n?e.setAttributeNS(r,t,n):e.removeAttributeNS(r,t)}(sR,e,t,n):fR(sR,e,t),lR[e]=t)}function dR(e,t,n){n!==lR[t]&&(null==n?e.style.removeProperty(t):e.style.setProperty(t,n+""),lR[t]=n)}function hR(e,t){for(const n in t)fR(e,n,t[n])}function fR(e,t,n){null!=n?e.setAttribute(t,n):e.removeAttribute(t)}function pR(){let e;return"undefined"==typeof window?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function mR(e){cF.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}hg(mR,cF,{svg(){return this._text},_render(e){const t=KF();t.open("svg",ig({},hj,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}));const n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",QF,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=Gj[t.marktype],r=n.tag,i=[VF,n.attr];e.open("g",{class:oF(t),"clip-path":t.clip?JM(this,t,t.group):null},qF(t),{"pointer-events":"g"!==r&&!1===t.interactive?"none":null});const a=a=>{const o=this.href(a);if(o&&e.open("a",o),e.open(r,this.attr(t,a,i,"g"!==r?r:null)),"text"===r){const t=Pj(a);if(km(t)){const n={x:0,dy:Rj(a)};for(let r=0;r<t.length;++r)e.open("tspan",r?n:null).text(Bj(a,t[r])).close()}else e.text(Bj(a,t))}else if("g"===r){const r=a.strokeForeground,i=a.fill,o=a.stroke;r&&o&&(a.stroke=null),e.open("path",this.attr(t,a,n.background,"bgrect")).close(),e.open("g",this.attr(t,a,n.content)),WN(a,t=>this.mark(e,t)),e.close(),r&&o?(i&&(a.fill=null),a.stroke=o,e.open("path",this.attr(t,a,n.foreground,"bgrect")).close(),i&&(a.fill=i)):e.open("path",this.attr(t,a,n.foreground,"bgfore")).close()}e.close(),o&&e.close()};return n.nested?t.items&&t.items.length&&a(t.items[0]):WN(t,a),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(e=>{e["xlink:href"]=e.href,e.href=null,(this._hrefs||(this._hrefs={}))[t]=e})}return null},attr(e,t,n,r){const i={},a=(e,t,n,r)=>{i[r||e]=t};return Array.isArray(n)?n.forEach(e=>e(a,t,this)):n(a,t,this),r&&function(e,t,n,r,i){if(null==t)return e;if("bgrect"===r&&!1===n.interactive&&(e["pointer-events"]="none"),"bgfore"===r&&(!1===n.interactive&&(e["pointer-events"]="none"),e.display="none",null!==t.fill))return e;"image"===r&&!1===t.smooth&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),"text"===r&&(e["font-family"]=$j(t),e["font-size"]=Fj(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const a in JF){let n=t[a];const r=JF[a];("transparent"!==n||"fill"!==r&&"stroke"!==r)&&null!=n&&(rM(n)&&(n=iM(n,i.gradient,"")),e[r]=n)}}(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(0!==Object.keys(t).length+Object.keys(n).length){e.open("defs");for(const n in t){const r=t[n],i=r.stops;"radial"===r.gradient?(e.open("pattern",{id:nM+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+n+")"}).close(),e.close(),e.open("radialGradient",{id:n,fx:r.x1,fy:r.y1,fr:r.r1,cx:r.x2,cy:r.y2,r:r.r2})):e.open("linearGradient",{id:n,x1:r.x1,x2:r.x2,y1:r.y1,y2:r.y2});for(let t=0;t<i.length;++t)e.open("stop",{offset:i[t].offset,"stop-color":i[t].color}).close();e.close()}for(const t in n){const r=n[t];e.open("clipPath",{id:t}),r.path?e.open("path",{d:r.path}).close():e.open("rect",{x:0,y:0,width:r.width,height:r.height}).close(),e.close()}e.close()}}});const gR={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},vR={};function yR(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(vR[e]=t,this):vR[e]}function bR(e,t,n){const r=[],i=(new QM).union(t),a=e.marktype;return a?xR(e,i,n,r):"group"===a?wR(e,i,n,r):sm("Intersect scene must be mark node or group item.")}function xR(e,t,n,r){if(function(e,t,n){return e.bounds&&t.intersects(e.bounds)&&("group"===e.marktype||!1!==e.interactive&&(!n||n(e)))}(e,t,n)){const i=e.items,a=e.marktype,o=i.length;let s=0;if("group"===a)for(;s<o;++s)wR(i[s],t,n,r);else for(const e=Gj[a].isect;s<o;++s){const n=i[s];_R(n,t,e)&&r.push(n)}}return r}function wR(e,t,n,r){n&&n(e.mark)&&_R(e,t,Gj.group.isect)&&r.push(e);const i=e.items,a=i&&i.length;if(a){const o=e.x||0,s=e.y||0;t.translate(-o,-s);for(let e=0;e<a;++e)xR(i[e],t,n,r);t.translate(o,s)}return r}function _R(e,t,n){const r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}vR.canvas=vR.png={renderer:DF,headless:DF,handler:TF},vR.svg={renderer:tR,headless:mR,handler:NF},vR.none={};const kR=new QM;function ER(e){const t=e.clip;if(Km(t))t(kN(kR.clear()));else{if(!t)return;kR.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(kR)}function SR(e,t,n){return e===t||("path"===n?TR(e,t):e instanceof Date&&t instanceof Date?+e==+t:vg(e)&&vg(t)?Math.abs(e-t)<=1e-9:e&&t&&(Em(e)||Em(t))?function(e,t){var n,r,i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(i.sort(),a.sort(),r=i.length-1;r>=0;r--)if(i[r]!=a[r])return!1;for(r=i.length-1;r>=0;r--)if(!SR(e[n=i[r]],t[n],n))return!1;return typeof e==typeof t}(e,t):e==t)}function TR(e,t){return SR(dM(e),dM(t))}function CR(){ZM(),tM=0}const IR="top",AR="left",OR="right",DR="bottom",MR="start",NR="middle",jR="end",FR="group",RR="axis",PR="title",LR="legend",BR="row-header",$R="row-footer",zR="row-title",UR="column-header",HR="column-footer",WR="column-title",VR="none",qR="all",GR="each",YR="flush",XR="column",KR="row";function ZR(e){g_.call(this,null,e)}function JR(e,t,n){return t(e.bounds.clear(),e,n)}hg(ZR,g_,{transform(e,t){const n=t.dataflow,r=e.mark,i=r.marktype,a=Gj[i],o=a.bound;let s,l=r.bounds;if(a.nested)r.items.length&&n.dirty(r.items[0]),l=JR(r,o),r.items.forEach(e=>{e.bounds.clear().union(l)});else if(i===FR||e.modified())switch(t.visit(t.MOD,e=>n.dirty(e)),l.clear(),r.items.forEach(e=>l.union(JR(e,o))),r.role){case RR:case LR:case PR:t.reflow()}else s=t.changed(t.REM),t.visit(t.ADD,e=>{l.union(JR(e,o))}),t.visit(t.MOD,e=>{s=s||l.alignsWith(e.bounds),n.dirty(e),l.union(JR(e,o))}),s&&(l.clear(),r.items.forEach(e=>l.union(e.bounds)));return ER(r),t.modifies("bounds")}});const QR=":vega_identifier:";function eP(e){g_.call(this,0,e)}function tP(e){g_.call(this,null,e)}function nP(e){g_.call(this,null,e)}eP.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},hg(eP,g_,{transform(e,t){const n=(i=t.dataflow)._signals[QR]||(i._signals[QR]=i.add(0)),r=e.as;var i;let a=n.value;return t.visit(t.ADD,e=>e[r]=e[r]||++a),n.set(this.value=a),t}}),hg(tP,g_,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,function(e){const t=e.groups,n=e.parent;return t&&1===t.size?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const r=n.marktype===FR?tN:eN;return t.visit(t.ADD,e=>r.call(e,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});const rP={parity:e=>e.filter((e,t)=>t%2?e.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((e,r)=>r&&iP(n.bounds,e.bounds,t)?e.opacity=0:(n=e,1))}},iP=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),aP=(e,t)=>{for(var n,r=1,i=e.length,a=e[0].bounds;r<i;a=n,++r)if(iP(a,n=e[r].bounds,t))return!0},oP=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},sP=e=>(e.forEach(e=>e.opacity=1),e),lP=(e,t)=>e.reflow(t.modified()).modifies("opacity");function uP(e){g_.call(this,null,e)}hg(nP,g_,{transform(e,t){const n=rP[e.method]||rP.parity,r=e.separation||0;let i,a,o=t.materialize(t.SOURCE).source;if(!o||!o.length)return;if(!e.method)return e.modified("method")&&(sP(o),t=lP(t,e)),t;if(o=o.filter(oP),!o.length)return;if(e.sort&&(o=o.slice().sort(e.sort)),i=sP(o),t=lP(t,e),i.length>=3&&aP(i,r)){do{i=n(i,r)}while(i.length>=3&&aP(i,r));i.length<3&&!Am(o).opacity&&(i.length>1&&(Am(i).opacity=0),Am(o).opacity=1)}var s,l,u,c;e.boundScale&&e.boundTolerance>=0&&(s=e.boundOrient,l=+e.boundTolerance,u=e.boundScale.range(),c=new QM,s===IR||s===DR?c.set(u[0],-1/0,u[1],1/0):c.set(-1/0,u[0],1/0,u[1]),c.expand(l||1),a=e=>c.encloses(e.bounds),o.forEach(e=>{a(e)||(e.opacity=0)}));const d=i[0].mark.bounds.clear();return o.forEach(e=>{e.opacity&&d.union(e.bounds)}),t}}),hg(uP,g_,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,e=>n.dirty(e)),t.fields&&t.fields.zindex){const e=t.source&&t.source[0];e&&(e.mark.zdirty=!0)}}});const cP=new QM;function dP(e,t,n){return e[t]===n?0:(e[t]=n,1)}function hP(e){var t=e.items[0].orient;return t===AR||t===OR}function fP(e,t,n,r){var i,a,o=t.items[0],s=o.datum,l=null!=o.translate?o.translate:.5,u=o.orient,c=function(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}(s),d=o.range,h=o.offset,f=o.position,p=o.minExtent,m=o.maxExtent,g=s.title&&o.items[c[2]].items[0],v=o.titlePadding,y=o.bounds,b=g&&Lj(g),x=0,w=0;switch(cP.clear().union(y),y.clear(),(i=c[0])>-1&&y.union(o.items[i].bounds),(i=c[1])>-1&&y.union(o.items[i].bounds),u){case IR:x=f||0,w=-h,a=Math.max(p,Math.min(m,-y.y1)),y.add(0,-a).add(d,0),g&&pP(e,g,a,v,b,0,-1,y);break;case AR:x=-h,w=f||0,a=Math.max(p,Math.min(m,-y.x1)),y.add(-a,0).add(0,d),g&&pP(e,g,a,v,b,1,-1,y);break;case OR:x=n+h,w=f||0,a=Math.max(p,Math.min(m,y.x2)),y.add(0,0).add(a,d),g&&pP(e,g,a,v,b,1,1,y);break;case DR:x=f||0,w=r+h,a=Math.max(p,Math.min(m,y.y2)),y.add(0,0).add(d,a),g&&pP(e,g,a,v,0,0,1,y);break;default:x=o.x,w=o.y}return aN(y.translate(x,w),o),dP(o,"x",x+l)|dP(o,"y",w+l)&&(o.bounds=cP,e.dirty(o),o.bounds=y,e.dirty(o)),o.mark.bounds.clear().union(y)}function pP(e,t,n,r,i,a,o,s){const l=t.bounds;if(t.auto){const s=o*(n+i+r);let u=0,c=0;e.dirty(t),a?u=(t.x||0)-(t.x=s):c=(t.y||0)-(t.y=s),t.mark.bounds.clear().union(l.translate(-u,-c)),e.dirty(t)}s.union(l)}const mP=(e,t)=>Math.floor(Math.min(e,t)),gP=(e,t)=>Math.ceil(Math.max(e,t));function vP(e){return(new QM).set(0,0,e.width||0,e.height||0)}function yP(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function bP(e,t,n){const r=Em(e)?e[t]:e;return null!=r?r:void 0!==n?n:0}function xP(e){return e<0?Math.ceil(-e):0}function wP(e,t,n){var r,i,a,o,s,l,u,c,d,h,f,p=!n.nodirty,m=n.bounds===YR?vP:yP,g=cP.set(0,0,0,0),v=bP(n.align,XR),y=bP(n.align,KR),b=bP(n.padding,XR),x=bP(n.padding,KR),w=n.columns||t.length,_=w<=0?1:Math.ceil(t.length/w),k=t.length,E=Array(k),S=Array(w),T=0,C=Array(k),I=Array(_),A=0,O=Array(k),D=Array(k),M=Array(k);for(i=0;i<w;++i)S[i]=0;for(i=0;i<_;++i)I[i]=0;for(i=0;i<k;++i)s=M[i]=m(l=t[i]),l.x=l.x||0,O[i]=0,l.y=l.y||0,D[i]=0,a=i%w,o=~~(i/w),T=Math.max(T,u=Math.ceil(s.x2)),A=Math.max(A,c=Math.ceil(s.y2)),S[a]=Math.max(S[a],u),I[o]=Math.max(I[o],c),E[i]=b+xP(s.x1),C[i]=x+xP(s.y1),p&&e.dirty(t[i]);for(i=0;i<k;++i)i%w==0&&(E[i]=0),i<w&&(C[i]=0);if(v===GR)for(a=1;a<w;++a){for(f=0,i=a;i<k;i+=w)f<E[i]&&(f=E[i]);for(i=a;i<k;i+=w)E[i]=f+S[a-1]}else if(v===qR){for(f=0,i=0;i<k;++i)i%w&&f<E[i]&&(f=E[i]);for(i=0;i<k;++i)i%w&&(E[i]=f+T)}else for(v=!1,a=1;a<w;++a)for(i=a;i<k;i+=w)E[i]+=S[a-1];if(y===GR)for(o=1;o<_;++o){for(f=0,r=(i=o*w)+w;i<r;++i)f<C[i]&&(f=C[i]);for(i=o*w;i<r;++i)C[i]=f+I[o-1]}else if(y===qR){for(f=0,i=w;i<k;++i)f<C[i]&&(f=C[i]);for(i=w;i<k;++i)C[i]=f+A}else for(y=!1,o=1;o<_;++o)for(r=(i=o*w)+w;i<r;++i)C[i]+=I[o-1];for(d=0,i=0;i<k;++i)O[i]+=(d=E[i]+(i%w?d:0))-t[i].x;for(a=0;a<w;++a)for(h=0,i=a;i<k;i+=w)D[i]+=(h+=C[i])-t[i].y;if(v&&bP(n.center,XR)&&_>1)for(i=0;i<k;++i)(d=(s=v===qR?T:S[i%w])-M[i].x2-t[i].x-O[i])>0&&(O[i]+=d/2);if(y&&bP(n.center,KR)&&1!==w)for(i=0;i<k;++i)(h=(s=y===qR?A:I[~~(i/w)])-M[i].y2-t[i].y-D[i])>0&&(D[i]+=h/2);for(i=0;i<k;++i)g.union(M[i].translate(O[i],D[i]));switch(d=bP(n.anchor,"x"),h=bP(n.anchor,"y"),bP(n.anchor,XR)){case jR:d-=g.width();break;case NR:d-=g.width()/2}switch(bP(n.anchor,KR)){case jR:h-=g.height();break;case NR:h-=g.height()/2}for(d=Math.round(d),h=Math.round(h),g.clear(),i=0;i<k;++i)t[i].mark.bounds.clear();for(i=0;i<k;++i)(l=t[i]).x+=O[i]+=d,l.y+=D[i]+=h,g.union(l.mark.bounds.union(l.bounds.translate(O[i],D[i]))),p&&e.dirty(l);return g}function _P(e,t){return"x1"===t?e.x||0:"y1"===t?e.y||0:"x2"===t?(e.x||0)+(e.width||0):"y2"===t?(e.y||0)+(e.height||0):void 0}function kP(e,t){return e.bounds[t]}function EP(e,t,n,r,i,a,o,s,l,u,c,d,h,f){var p,m,g,v,y,b,x,w,_,k=n.length,E=0,S=0;if(!k)return E;for(p=c;p<k;p+=d)n[p]&&(E=o(E,l(n[p],u)));if(!t.length)return E;for(t.length>i&&(e.warn("Grid headers exceed limit: "+i),t=t.slice(0,i)),E+=a,m=0,v=t.length;m<v;++m)e.dirty(t[m]),t[m].mark.bounds.clear();for(p=c,m=0,v=t.length;m<v;++m,p+=d){for(y=(b=t[m]).mark.bounds,g=p;g>=0&&null==(x=n[g]);g-=h);s?(w=null==f?x.x:Math.round(x.bounds.x1+f*x.bounds.width()),_=E):(w=E,_=null==f?x.y:Math.round(x.bounds.y1+f*x.bounds.height())),y.union(b.bounds.translate(w-(b.x||0),_-(b.y||0))),b.x=w,b.y=_,e.dirty(b),S=o(S,y[u])}return S}function SP(e,t,n,r,i,a){if(t){e.dirty(t);var o=n,s=n;r?o=Math.round(i.x1+a*i.width()):s=Math.round(i.y1+a*i.height()),t.bounds.translate(o-(t.x||0),s-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=s,e.dirty(t)}}function TP(e,t,n,r,i,a,o){const s=function(e,t){const n=e[t]||{};return(t,r)=>null!=n[t]?n[t]:null!=e[t]?e[t]:r}(n,t),l=function(e,t){let n=-1/0;return e.forEach(e=>{null!=e.offset&&(n=Math.max(n,e.offset))}),n>-1/0?n:t}(e,s("offset",0)),u=s("anchor",MR),c=u===jR?1:u===NR?.5:0,d={align:GR,bounds:s("bounds",YR),columns:"vertical"===s("direction")?1:e.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(t){case AR:d.anchor={x:Math.floor(r.x1)-l,column:jR,y:c*(o||r.height()+2*r.y1),row:u};break;case OR:d.anchor={x:Math.ceil(r.x2)+l,y:c*(o||r.height()+2*r.y1),row:u};break;case IR:d.anchor={y:Math.floor(i.y1)-l,row:jR,x:c*(a||i.width()+2*i.x1),column:u};break;case DR:d.anchor={y:Math.ceil(i.y2)+l,x:c*(a||i.width()+2*i.x1),column:u};break;case"top-left":d.anchor={x:l,y:l};break;case"top-right":d.anchor={x:a-l,y:l,column:jR};break;case"bottom-left":d.anchor={x:l,y:o-l,row:jR};break;case"bottom-right":d.anchor={x:a-l,y:o-l,column:jR,row:jR}}return d}function CP(e,t){var n,r,i=t.items[0],a=i.datum,o=i.orient,s=i.bounds,l=i.x,u=i.y;return i._bounds?i._bounds.clear().union(s):i._bounds=s.clone(),s.clear(),function(e,t,n){var r=t.padding,i=r-n.x,a=r-n.y;if(t.datum.title){var o=t.items[1].items[0],s=o.anchor,l=t.titlePadding||0,u=r-o.x,c=r-o.y;switch(o.orient){case AR:i+=Math.ceil(o.bounds.width())+l;break;case OR:case DR:break;default:a+=o.bounds.height()+l}switch((i||a)&&AP(e,n,i,a),o.orient){case AR:c+=IP(t,n,o,s,1,1);break;case OR:u+=IP(t,n,o,jR,0,0)+l,c+=IP(t,n,o,s,1,1);break;case DR:u+=IP(t,n,o,s,0,0),c+=IP(t,n,o,jR,-1,0,1)+l;break;default:u+=IP(t,n,o,s,0,0)}(u||c)&&AP(e,o,u,c),(u=Math.round(o.bounds.x1-r))<0&&(AP(e,n,-u,0),AP(e,o,-u,0))}else(i||a)&&AP(e,n,i,a)}(e,i,i.items[0].items[0]),s=function(e,t){return e.items.forEach(e=>t.union(e.bounds)),t.x1=e.padding,t.y1=e.padding,t}(i,s),n=2*i.padding,r=2*i.padding,s.empty()||(n=Math.ceil(s.width()+n),r=Math.ceil(s.height()+r)),"symbol"===a.type&&function(e){const t=e.reduce((e,t)=>(e[t.column]=Math.max(t.bounds.x2-t.x,e[t.column]||0),e),{});e.forEach(e=>{e.width=t[e.column],e.height=e.bounds.y2-e.y})}(i.items[0].items[0].items[0].items),o!==VR&&(i.x=l=0,i.y=u=0),i.width=n,i.height=r,aN(s.set(l,u,l+n,u+r),i),i.mark.bounds.clear().union(s),i}function IP(e,t,n,r,i,a,o){const s=n.datum.vgrad,l=("symbol"===e.datum.type||!a&&s||o?t:t.items[0]).bounds[i?"y2":"x2"]-e.padding,u=s&&a?l:0,c=s&&a?0:l,d=i<=0?0:Lj(n);return Math.round(r===MR?u:r===jR?c-d:.5*(l-d))}function AP(e,t,n,r){t.x+=n,t.y+=r,t.bounds.translate(n,r),t.mark.bounds.translate(n,r),e.dirty(t)}function OP(e){g_.call(this,null,e)}function DP(e,t){let n=0;if(void 0===t)for(let r of e)(r=+r)&&(n+=r);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}function MP(e){g_.call(this,null,e)}function NP(e){g_.call(this,null,e)}function jP(){return $w({})}function FP(e){g_.call(this,null,e)}function RP(e){g_.call(this,[],e)}hg(OP,g_,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach(t=>{e.layout&&function(e,t,n){var r,i,a,o,s,l,u,c=function(e){var t,n,r=e.items,i=r.length,a=0;const o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;a<i;++a)if(n=(t=r[a]).items,t.marktype===FR)switch(t.role){case RR:case LR:case PR:break;case BR:o.rowheaders.push(...n);break;case $R:o.rowfooters.push(...n);break;case UR:o.colheaders.push(...n);break;case HR:o.colfooters.push(...n);break;case zR:o.rowtitle=n[0];break;case WR:o.coltitle=n[0];break;default:o.marks.push(...n)}return o}(t),d=c.marks,h=n.bounds===YR?_P:kP,f=n.offset,p=n.columns||d.length,m=p<=0?1:Math.ceil(d.length/p),g=m*p;const v=wP(e,d,n);v.empty()&&v.set(0,0,0,0),c.rowheaders&&(l=bP(n.headerBand,KR,null),r=EP(e,c.rowheaders,d,0,m,-bP(f,"rowHeader"),mP,0,h,"x1",0,p,1,l)),c.colheaders&&(l=bP(n.headerBand,XR,null),i=EP(e,c.colheaders,d,0,p,-bP(f,"columnHeader"),mP,1,h,"y1",0,1,p,l)),c.rowfooters&&(l=bP(n.footerBand,KR,null),a=EP(e,c.rowfooters,d,0,m,bP(f,"rowFooter"),gP,0,h,"x2",p-1,p,1,l)),c.colfooters&&(l=bP(n.footerBand,XR,null),o=EP(e,c.colfooters,d,0,p,bP(f,"columnFooter"),gP,1,h,"y2",g-p,1,p,l)),c.rowtitle&&(s=bP(n.titleAnchor,KR),u=bP(f,"rowTitle"),u=s===jR?a+u:r-u,l=bP(n.titleBand,KR,.5),SP(e,c.rowtitle,u,0,v,l)),c.coltitle&&(s=bP(n.titleAnchor,XR),u=bP(f,"columnTitle"),u=s===jR?o+u:i-u,l=bP(n.titleBand,XR,.5),SP(e,c.coltitle,u,1,v,l))}(n,t,e.layout),function(e,t,n){var r,i,a,o,s,l=t.items,u=Math.max(0,t.width||0),c=Math.max(0,t.height||0),d=(new QM).set(0,0,u,c),h=d.clone(),f=d.clone(),p=[];for(o=0,s=l.length;o<s;++o)switch((i=l[o]).role){case RR:(hP(i)?h:f).union(fP(e,i,u,c));break;case PR:r=i;break;case LR:p.push(CP(e,i));break;case"frame":case"scope":case BR:case $R:case zR:case UR:case HR:case WR:h.union(i.bounds),f.union(i.bounds);break;default:d.union(i.bounds)}if(p.length){const t={};p.forEach(e=>{(a=e.orient||OR)!==VR&&(t[a]||(t[a]=[])).push(e)});for(const r in t){const i=t[r];wP(e,i,TP(i,r,n.legends,h,f,u,c))}p.forEach(t=>{const r=t.bounds;if(r.equals(t._bounds)||(t.bounds=t._bounds,e.dirty(t),t.bounds=r,e.dirty(t)),n.autosize&&"fit"===n.autosize.type)switch(t.orient){case AR:case OR:d.add(r.x1,0).add(r.x2,0);break;case IR:case DR:d.add(0,r.y1).add(0,r.y2)}else d.union(r)})}d.union(h).union(f),r&&d.union(function(e,t,n,r,i){var a,o=t.items[0],s=o.orient,l=o.anchor,u=o.offset,c=o.padding,d=o.items[0].items[0],h=o.items[1]&&o.items[1].items[0],f=s===AR||s===OR?r:n,p=0,m=0,g=0,v=0,y=0;if(o.frame!==FR?s===AR?(p=i.y2,f=i.y1):s===OR?(p=i.y1,f=i.y2):(p=i.x1,f=i.x2):s===AR&&(p=r,f=0),a=l===MR?p:l===jR?f:(p+f)/2,h&&h.text){switch(s){case IR:case DR:y=d.bounds.height()+c;break;case AR:v=d.bounds.width()+c;break;case OR:v=-d.bounds.width()-c}cP.clear().union(h.bounds),cP.translate(v-(h.x||0),y-(h.y||0)),dP(h,"x",v)|dP(h,"y",y)&&(e.dirty(h),h.bounds.clear().union(cP),h.mark.bounds.clear().union(cP),e.dirty(h)),cP.clear().union(h.bounds)}else cP.clear();switch(cP.union(d.bounds),s){case IR:m=a,g=i.y1-cP.height()-u;break;case AR:m=i.x1-cP.width()-u,g=a;break;case OR:m=i.x2+cP.width()+u,g=a;break;case DR:m=a,g=i.y2+u;break;default:m=o.x,g=o.y}return dP(o,"x",m)|dP(o,"y",g)&&(cP.translate(m,g),e.dirty(o),o.bounds.clear().union(cP),t.bounds.clear().union(cP),e.dirty(o)),o.bounds}(e,r,u,c,d)),t.clip&&d.set(0,0,t.width||0,t.height||0),function(e,t,n,r){const i=r.autosize||{},a=i.type;if(e._autosize<1||!a)return;let o=e._width,s=e._height,l=Math.max(0,t.width||0),u=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),d=Math.max(0,Math.ceil(-n.y1));const h=Math.max(0,Math.ceil(n.x2-l)),f=Math.max(0,Math.ceil(n.y2-c));if("padding"===i.contains){const t=e.padding();o-=t.left+t.right,s-=t.top+t.bottom}a===VR?(u=0,d=0,l=o,c=s):"fit"===a?(l=Math.max(0,o-u-h),c=Math.max(0,s-d-f)):"fit-x"===a?(l=Math.max(0,o-u-h),s=c+d+f):"fit-y"===a?(o=l+u+h,c=Math.max(0,s-d-f)):"pad"===a&&(o=l+u+h,s=c+d+f),e._resizeView(o,s,l,c,[u,d],i.resize)}(e,t,d,n)}(n,t,e)}),(r=e.mark.group)&&"legend-entry"!==r.mark.role?t.reflow():t;var r}}),hg(MP,g_,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,a=e.scale,o=$D(a,null==e.count?e.values?e.values.length:10:e.count,e.minstep),s=e.format||HD(n,a,o,e.formatSpecifier,e.formatType,!!e.values),l=e.values?zD(a,e.values,o):UD(a,o);return i&&(r.rem=i),i=l.map((e,t)=>$w({index:t/(l.length-1||1),value:e,label:s(e)})),e.extra&&i.length&&i.push($w({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}}),hg(NP,g_,{transform(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||jP,a=e.key||Lw,o=this.value;return km(r.encode)&&(r.encode=null),o&&(e.modified("key")||t.modified(a))&&sm("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=function(e){const t=cg().test(e=>e.exit);return t.lookup=n=>t.get(e(n)),t}(a)),t.visit(t.ADD,e=>{const t=a(e);let n=o.get(t);n?n.exit?(o.empty--,r.add.push(n)):r.mod.push(n):(n=i(e),o.set(t,n),r.add.push(n)),n.datum=e,n.exit=!1}),t.visit(t.MOD,e=>{const t=a(e),n=o.get(t);n&&(n.datum=e,r.mod.push(n))}),t.visit(t.REM,e=>{const t=a(e),n=o.get(t);e!==n.datum||n.exit||(r.rem.push(n),n.exit=!0,++o.empty)}),t.changed(t.ADD_MOD)&&r.modifies("datum"),(t.clean()||e.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),r}}),hg(FP,g_,{transform(e,t){var n=t.fork(t.ADD_REM),r=e.mod||!1,i=e.encoders,a=t.encode;if(km(a)){if(!n.changed()&&!a.every(e=>i[e]))return t.StopPropagation;a=a[0],n.encode=null}var o="enter"===a,s=i.update||mm,l=i.enter||mm,u=i.exit||mm,c=(a&&!o?i[a]:s)||mm;if(t.changed(t.ADD)&&(t.visit(t.ADD,t=>{l(t,e),s(t,e)}),n.modifies(l.output),n.modifies(s.output),c!==mm&&c!==s&&(t.visit(t.ADD,t=>{c(t,e)}),n.modifies(c.output))),t.changed(t.REM)&&u!==mm&&(t.visit(t.REM,t=>{u(t,e)}),n.modifies(u.output)),o||c!==mm){const i=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(i,t=>{const i=l(t,e)||r;(c(t,e)||i)&&n.mod.push(t)}),n.mod.length&&n.modifies(l.output)):t.visit(i,t=>{(c(t,e)||r)&&n.mod.push(t)}),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}}),hg(RP,g_,{transform(e,t){if(null!=this.value&&!e.modified())return t.StopPropagation;var n,r,i,a,o,s=t.dataflow.locale(),l=t.fork(t.NO_SOURCE|t.NO_FIELDS),u=this.value,c=e.type||RD,d=e.scale,h=+e.limit,f=$D(d,null==e.count?5:e.count,e.minstep),p=e.format||YD(s,d,f,c,e.formatSpecifier,e.formatType,!!e.values||c===RD),m=e.values||GD(d,f);return u&&(l.rem=u),c===RD?(h&&m.length>h?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),u=m.slice(0,h-1),o=!0):u=m,Km(i=e.size)?(e.values||0!==d(u[0])||(u=u.slice(1)),a=u.reduce((t,n)=>Math.max(t,i(n,e)),0)):i=ng(a=i||8),u=u.map((t,n)=>$w({index:n,label:p(t,n,u),value:t,offset:a,size:i(t,e)})),o&&(o=m[u.length],u.push($w({index:u.length,label:"\u2026".concat(m.length-u.length," entries"),value:o,offset:a,size:i(o,e)})))):"gradient"===c?(n=d.domain(),r=OD(d,n[0],Am(n)),m.length<3&&!e.values&&n[0]!==Am(n)&&(m=[n[0],Am(n)]),u=m.map((e,t)=>$w({index:t,label:p(e,t,m),value:e,perc:r(e)}))):(i=m.length-1,r=function(e){const t=e.domain(),n=t.length-1;let r=+t[0],i=+Am(t),a=i-r;if(e.type===tD){const e=n?a/n:.1;r-=e,i+=e,a=i-r}return e=>(e-r)/a}(d),u=m.map((e,t)=>$w({index:t,label:p(e,t,m),value:e,perc:t?r(e):0,perc2:t===i?1:r(m[t+1])}))),l.source=u,l.add=u,this.value=u,l}});const PP=e=>e.source.x,LP=e=>e.source.y,BP=e=>e.target.x,$P=e=>e.target.y;function zP(e){g_.call(this,{},e)}zP.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},hg(zP,g_,{transform(e,t){var n=e.sourceX||PP,r=e.sourceY||LP,i=e.targetX||BP,a=e.targetY||$P,o=e.as||"path",s=e.shape||"line",l=VP.get(s+"-"+(e.orient||"vertical"))||VP.get(s);return l||sm("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,e=>{e[o]=l(n(e),r(e),i(e),a(e))}),t.reflow(e.modified()).modifies(o)}});const UP=(e,t,n,r)=>"M"+e+","+t+"L"+n+","+r,HP=(e,t,n,r)=>{var i=n-e,a=r-t,o=Math.sqrt(i*i+a*a)/2;return"M"+e+","+t+"A"+o+","+o+" "+180*Math.atan2(a,i)/Math.PI+" 0 1 "+n+","+r},WP=(e,t,n,r)=>{const i=n-e,a=r-t,o=.2*(i+a),s=.2*(a-i);return"M"+e+","+t+"C"+(e+o)+","+(t+s)+" "+(n+s)+","+(r-o)+" "+n+","+r},VP=cg({line:UP,"line-radial":(e,t,n,r)=>UP(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),arc:HP,"arc-radial":(e,t,n,r)=>HP(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),curve:WP,"curve-radial":(e,t,n,r)=>WP(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),"orthogonal-horizontal":(e,t,n,r)=>"M"+e+","+t+"V"+r+"H"+n,"orthogonal-vertical":(e,t,n,r)=>"M"+e+","+t+"H"+n+"V"+r,"orthogonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n);return"M"+t*i+","+t*a+"A"+t+","+t+" 0 0,"+((Math.abs(n-e)>Math.PI?n<=e:n>e)?1:0)+" "+t*o+","+t*s+"L"+r*o+","+r*s},"diagonal-horizontal":(e,t,n,r)=>{const i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},"diagonal-vertical":(e,t,n,r)=>{const i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),l=(t+r)/2;return"M"+t*i+","+t*a+"C"+l*i+","+l*a+" "+l*o+","+l*s+" "+r*o+","+r*s}});function qP(e){g_.call(this,null,e)}function GP(e){return xD(e)&&e!==ZO}qP.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},hg(qP,g_,{transform(e,t){var n,r,i,a=e.as||["startAngle","endAngle"],o=a[0],s=a[1],l=e.startAngle||0,u=null!=e.endAngle?e.endAngle:2*Math.PI,c=t.source,d=c.map(e.field||fm),h=d.length,f=l,p=(u-l)/DP(d),m=wk(h);for(e.sort&&m.sort((e,t)=>d[e]-d[t]),n=0;n<h;++n)i=d[m[n]],(r=c[m[n]])[o]=f,r[s]=f+=i*p;return this.value=d,t.reflow(e.modified()).modifies(a)}});const YP=Mg(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function XP(e){g_.call(this,null,e),this.modified(!0)}function KP(e,t,n){return kD(e)&&Math.abs(t.reduce((e,t)=>e+(t<0?-1:t>0?1:0),0))!==t.length&&n.warn("Log scale domain includes zero: "+Cg(t)),t}function ZP(e,t,n){return Km(e)&&(t||n)?CD(e,JP(t||[0,1],n)):e}function JP(e,t){return t?e.slice().reverse():e}function QP(e){g_.call(this,null,e)}hg(XP,g_,{transform(e,t){var n=t.dataflow,r=this.value,i=function(e){var t,n=e.type,r="";return n===ZO?"sequential-linear":(function(e){const t=e.type;return xD(t)&&t!==XO&&t!==KO&&(e.scheme||e.range&&e.range.length&&e.range.every(bg))}(e)&&(r=2===(t=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(null!=e.domainMid):0)?"sequential-":3===t?"diverging-":""),(r+n||WO).toLowerCase())}(e);for(i in r&&i===r.type||(this.value=r=vD(i)()),e)if(!YP[i]){if("padding"===i&&GP(r.type))continue;Km(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}return function(e,t,n){var r=e.type,i=t.round||!1,a=t.range;if(null!=t.rangeStep)a=function(e,t,n){return e!==iD&&e!==rD&&sm("Only band and point scales support rangeStep."),[0,t.rangeStep*HO(n,e===rD?1:(null!=t.paddingInner?t.paddingInner:t.padding)||0,(null!=t.paddingOuter?t.paddingOuter:t.padding)||0)]}(r,t,n);else if(t.scheme&&(a=function(e,t,n){var r,i=t.schemeExtent;return km(t.scheme)?r=ID(t.scheme,t.interpolate,t.interpolateGamma):(r=FD(t.scheme.toLowerCase()))||sm("Unrecognized scheme name: ".concat(t.scheme)),n=e===tD?n+1:e===aD?n-1:e===QO||e===eD?+t.schemeCount||5:n,ED(e)?ZP(r,i,t.reverse):Km(r)?AD(ZP(r,i),n):e===nD?r:r.slice(0,n)}(r,t,n),Km(a))){if(e.interpolator)return e.interpolator(a);sm("Scale type ".concat(r," does not support interpolating color schemes."))}if(a&&ED(r))return e.interpolator(ID(JP(a,t.reverse),t.interpolate,t.interpolateGamma));a&&t.interpolate&&e.interpolate?e.interpolate(DD(t.interpolate,t.interpolateGamma)):Km(e.round)?e.round(i):Km(e.rangeRound)&&e.interpolate(i?XA:qA),a&&e.range(JP(a,t.reverse))}(r,e,function(e,t,n){let r=t.bins;if(r&&!km(r)){const t=e.domain(),n=t[0],i=Am(t),a=r.step;let o=null==r.start?n:r.start,s=null==r.stop?i:r.stop;a||sm("Scale bins parameter missing step property."),o<n&&(o=a*Math.ceil(n/a)),s>i&&(s=a*Math.floor(i/a)),r=wk(o,s+a/2,a)}return r?e.bins=r:e.bins&&delete e.bins,e.type===aD&&(r?t.domain||t.domainRaw||(e.domain(r),n=r.length):e.bins=e.domain()),n}(r,e,function(e,t,n){const r=function(e,t,n){return t?(e.domain(KP(e.type,t,n)),t.length):-1}(e,t.domainRaw,n);if(r>-1)return r;var i,a,o=t.domain,s=e.type,l=t.zero||void 0===t.zero&&function(e){const t=e.type;return!e.bins&&(t===WO||t===qO||t===GO)}(e);if(!o)return 0;if(GP(s)&&t.padding&&o[0]!==Am(o)&&(o=function(e,t,n,r,i,a){var o=Math.abs(Am(n)-n[0]),s=o/(o-2*r),l=e===VO?Hm(t,null,s):e===GO?Wm(t,null,s,.5):e===qO?Wm(t,null,s,i||1):e===YO?Vm(t,null,s,a||1):Um(t,null,s);return(t=t.slice())[0]=l[0],t[t.length-1]=l[1],t}(s,o,t.range,t.padding,t.exponent,t.constant)),(l||null!=t.domainMin||null!=t.domainMax||null!=t.domainMid)&&(i=(o=o.slice()).length-1||1,l&&(o[0]>0&&(o[0]=0),o[i]<0&&(o[i]=0)),null!=t.domainMin&&(o[0]=t.domainMin),null!=t.domainMax&&(o[i]=t.domainMax),null!=t.domainMid)){const e=(a=t.domainMid)>o[i]?i+1:a<o[0]?0:i;e!==i&&n.warn("Scale domainMid exceeds domain min or max.",a),o.splice(e,0,a)}return e.domain(KP(s,o,n)),s===nD&&e.unknown(t.domainImplicit?fT:void 0),t.nice&&e.nice&&e.nice(!0!==t.nice&&$D(e,t.nice)||null),o.length}(r,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),hg(QP,g_,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(Ww(e.sort)),this.modified(n),t}});const eL="zero",tL="center",nL="normalize",rL=["y0","y1"];function iL(e){g_.call(this,null,e)}function aL(e,t,n,r,i){for(var a,o=(t-e.sum)/2,s=e.length,l=0;l<s;++l)(a=e[l])[r]=o,a[i]=o+=Math.abs(n(a))}function oL(e,t,n,r,i){for(var a,o=1/e.sum,s=0,l=e.length,u=0,c=0;u<l;++u)(a=e[u])[r]=s,a[i]=s=o*(c+=Math.abs(n(a)))}function sL(e,t,n,r,i){for(var a,o,s=0,l=0,u=e.length,c=0;c<u;++c)(a=+n(o=e[c]))<0?(o[r]=l,o[i]=l+=a):(o[r]=s,o[i]=s+=a)}iL.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:eL,values:[eL,tL,nL]},{name:"as",type:"string",array:!0,length:2,default:rL}]},hg(iL,g_,{transform(e,t){var n,r,i,a,o=e.as||rL,s=o[0],l=o[1],u=Ww(e.sort),c=e.field||fm,d=e.offset===tL?aL:e.offset===nL?oL:sL;for(n=function(e,t,n,r){var i,a,o,s,l,u,c,d,h,f=[],p=e=>e(l);if(null==t)f.push(e.slice());else for(i={},a=0,o=e.length;a<o;++a)l=e[a],(c=i[u=t.map(p)])||(i[u]=c=[],f.push(c)),c.push(l);for(u=0,h=0,s=f.length;u<s;++u){for(a=0,d=0,o=(c=f[u]).length;a<o;++a)d+=Math.abs(r(c[a]));c.sum=d,d>h&&(h=d),n&&c.sort(n)}return f.max=h,f}(t.source,e.groupby,u,c),r=0,i=n.length,a=n.max;r<i;++r)d(n[r],a,c,s,l);return t.reflow(e.modified()).modifies(o)}});var lL=e=>e;function uL(e,t){e&&dL.hasOwnProperty(e.type)&&dL[e.type](e,t)}var cL={Feature:function(e,t){uL(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)uL(n[r].geometry,t)}},dL={Sphere:function(e,t){t.sphere()},Point:function(e,t){t.point((e=e.coordinates)[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)t.point((e=n[r])[0],e[1],e[2])},LineString:function(e,t){hL(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)hL(n[r],t,0)},Polygon:function(e,t){fL(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)fL(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)uL(n[r],t)}};function hL(e,t,n){var r,i=-1,a=e.length-n;for(t.lineStart();++i<a;)t.point((r=e[i])[0],r[1],r[2]);t.lineEnd()}function fL(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)hL(e[n],t,1);t.polygonEnd()}var pL=function(e,t){e&&cL.hasOwnProperty(e.type)?cL[e.type](e,t):uL(e,t)};class mL{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=t[r],a=e+i,o=Math.abs(e)<Math.abs(i)?e-(a-i):i-(a-e);o&&(t[n++]=o),e=a}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t,n,r,i=this._n,a=0;if(i>0){for(a=e[--i];i>0&&(t=a,n=e[--i],a=t+n,r=n-(a-t),!r););i>0&&(r<0&&e[i-1]<0||r>0&&e[i-1]>0)&&(n=2*r,t=a+n,n==t-a&&(a=t))}return a}}var gL=1e-6,vL=1e-12,yL=Math.PI,bL=yL/2,xL=yL/4,wL=2*yL,_L=180/yL,kL=yL/180,EL=Math.abs,SL=Math.atan,TL=Math.atan2,CL=Math.cos,IL=Math.ceil,AL=Math.exp,OL=(Math,Math.hypot),DL=Math.log,ML=Math.pow,NL=Math.sin,jL=Math.sign||function(e){return e>0?1:e<0?-1:0},FL=Math.sqrt,RL=Math.tan;function PL(e){return e>1?0:e<-1?yL:Math.acos(e)}function LL(e){return e>1?bL:e<-1?-bL:Math.asin(e)}function BL(){}var $L,zL,UL,HL,WL=new mL,VL=new mL,qL={point:BL,lineStart:BL,lineEnd:BL,polygonStart:function(){qL.lineStart=GL,qL.lineEnd=KL},polygonEnd:function(){qL.lineStart=qL.lineEnd=qL.point=BL,WL.add(EL(VL)),VL=new mL},result:function(){var e=WL/2;return WL=new mL,e}};function GL(){qL.point=YL}function YL(e,t){qL.point=XL,$L=UL=e,zL=HL=t}function XL(e,t){VL.add(HL*e-UL*t),UL=e,HL=t}function KL(){XL($L,zL)}var ZL,JL,QL,eB,tB=qL,nB=1/0,rB=nB,iB=-nB,aB=iB,oB={point:function(e,t){e<nB&&(nB=e),e>iB&&(iB=e),t<rB&&(rB=t),t>aB&&(aB=t)},lineStart:BL,lineEnd:BL,polygonStart:BL,polygonEnd:BL,result:function(){var e=[[nB,rB],[iB,aB]];return iB=aB=-(rB=nB=1/0),e}},sB=0,lB=0,uB=0,cB=0,dB=0,hB=0,fB=0,pB=0,mB=0,gB={point:vB,lineStart:yB,lineEnd:wB,polygonStart:function(){gB.lineStart=_B,gB.lineEnd=kB},polygonEnd:function(){gB.point=vB,gB.lineStart=yB,gB.lineEnd=wB},result:function(){var e=mB?[fB/mB,pB/mB]:hB?[cB/hB,dB/hB]:uB?[sB/uB,lB/uB]:[NaN,NaN];return sB=lB=uB=cB=dB=hB=fB=pB=mB=0,e}};function vB(e,t){sB+=e,lB+=t,++uB}function yB(){gB.point=bB}function bB(e,t){gB.point=xB,vB(QL=e,eB=t)}function xB(e,t){var n=e-QL,r=t-eB,i=FL(n*n+r*r);cB+=i*(QL+e)/2,dB+=i*(eB+t)/2,hB+=i,vB(QL=e,eB=t)}function wB(){gB.point=vB}function _B(){gB.point=EB}function kB(){SB(ZL,JL)}function EB(e,t){gB.point=SB,vB(ZL=QL=e,JL=eB=t)}function SB(e,t){var n=e-QL,r=t-eB,i=FL(n*n+r*r);cB+=i*(QL+e)/2,dB+=i*(eB+t)/2,hB+=i,fB+=(i=eB*e-QL*t)*(QL+e),pB+=i*(eB+t),mB+=3*i,vB(QL=e,eB=t)}var TB=gB;function CB(e){this._context=e}CB.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,wL)}},result:BL};var IB,AB,OB,DB,MB,NB=new mL,jB={point:BL,lineStart:function(){jB.point=FB},lineEnd:function(){IB&&RB(AB,OB),jB.point=BL},polygonStart:function(){IB=!0},polygonEnd:function(){IB=null},result:function(){var e=+NB;return NB=new mL,e}};function FB(e,t){jB.point=RB,AB=DB=e,OB=MB=t}function RB(e,t){NB.add(FL((DB-=e)*DB+(MB-=t)*MB)),DB=e,MB=t}var PB=jB;function LB(){this._string=[]}function BB(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}LB.prototype={_radius:4.5,_circle:BB(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:null==this._circle&&(this._circle=BB(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}};var $B=function(e,t){var n,r,i=4.5;function a(e){return e&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),pL(e,n(r))),r.result()}return a.area=function(e){return pL(e,n(tB)),tB.result()},a.measure=function(e){return pL(e,n(PB)),PB.result()},a.bounds=function(e){return pL(e,n(oB)),oB.result()},a.centroid=function(e){return pL(e,n(TB)),TB.result()},a.projection=function(t){return arguments.length?(n=null==t?(e=null,lL):(e=t).stream,a):e},a.context=function(e){return arguments.length?(r=null==e?(t=null,new LB):new CB(t=e),"function"!=typeof i&&r.pointRadius(i),a):t},a.pointRadius=function(e){return arguments.length?(i="function"==typeof e?e:(r.pointRadius(+e),+e),a):i},a.projection(e).context(t)},zB=function(){var e,t=[];return{point:function(t,n,r){e.push([t,n,r])},lineStart:function(){t.push(e=[])},lineEnd:BL,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}},UB=function(e,t){return EL(e[0]-t[0])<gL&&EL(e[1]-t[1])<gL};function HB(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}var WB=function(e,t,n,r,i){var a,o,s=[],l=[];if(e.forEach((function(e){if(!((t=e.length-1)<=0)){var t,n,r=e[0],o=e[t];if(UB(r,o)){if(!r[2]&&!o[2]){for(i.lineStart(),a=0;a<t;++a)i.point((r=e[a])[0],r[1]);return void i.lineEnd()}o[0]+=2e-6}s.push(n=new HB(r,e,null,!0)),l.push(n.o=new HB(r,null,n,!1)),s.push(n=new HB(o,e,null,!1)),l.push(n.o=new HB(o,null,n,!0))}})),s.length){for(l.sort(t),VB(s),VB(l),a=0,o=l.length;a<o;++a)l[a].e=n=!n;for(var u,c,d=s[0];;){for(var h=d,f=!0;h.v;)if((h=h.n)===d)return;u=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(f)for(a=0,o=u.length;a<o;++a)i.point((c=u[a])[0],c[1]);else r(h.x,h.n.x,1,i);h=h.n}else{if(f)for(a=(u=h.p.z).length-1;a>=0;--a)i.point((c=u[a])[0],c[1]);else r(h.x,h.p.x,-1,i);h=h.p}u=(h=h.o).z,f=!f}while(!h.v);i.lineEnd()}}};function VB(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function qB(e){return[TL(e[1],e[0]),LL(e[2])]}function GB(e){var t=e[0],n=e[1],r=CL(n);return[r*CL(t),r*NL(t),NL(n)]}function YB(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function XB(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function KB(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function ZB(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function JB(e){var t=FL(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function QB(e){return EL(e[0])<=yL?e[0]:jL(e[0])*((EL(e[0])+yL)%wL-yL)}function e$(e){return Array.from(function*(e){for(const t of e)yield*t}(e))}var t$=function(e,t,n,r){return function(i){var a,o,s,l=t(i),u=zB(),c=t(u),d=!1,h={point:f,lineStart:m,lineEnd:g,polygonStart:function(){h.point=v,h.lineStart=y,h.lineEnd=b,o=[],a=[]},polygonEnd:function(){h.point=f,h.lineStart=m,h.lineEnd=g,o=e$(o);var e=function(e,t){var n=QB(t),r=t[1],i=NL(r),a=[NL(n),-CL(n),0],o=0,s=0,l=new mL;1===i?r=bL+gL:-1===i&&(r=-bL-gL);for(var u=0,c=e.length;u<c;++u)if(h=(d=e[u]).length)for(var d,h,f=d[h-1],p=QB(f),m=f[1]/2+xL,g=NL(m),v=CL(m),y=0;y<h;++y,p=x,g=_,v=k,f=b){var b=d[y],x=QB(b),w=b[1]/2+xL,_=NL(w),k=CL(w),E=x-p,S=E>=0?1:-1,T=S*E,C=T>yL,I=g*_;if(l.add(TL(I*S*NL(T),v*k+I*CL(T))),o+=C?E+S*wL:E,C^p>=n^x>=n){var A=XB(GB(f),GB(b));JB(A);var O=XB(a,A);JB(O);var D=(C^E>=0?-1:1)*LL(O[2]);(r>D||r===D&&(A[0]||A[1]))&&(s+=C^E>=0?1:-1)}}return(o<-1e-6||o<gL&&l<-1e-12)^1&s}(a,r);o.length?(d||(i.polygonStart(),d=!0),WB(o,r$,e,n,i)):e&&(d||(i.polygonStart(),d=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),d&&(i.polygonEnd(),d=!1),o=a=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function f(t,n){e(t,n)&&i.point(t,n)}function p(e,t){l.point(e,t)}function m(){h.point=p,l.lineStart()}function g(){h.point=f,l.lineEnd()}function v(e,t){s.push([e,t]),c.point(e,t)}function y(){c.lineStart(),s=[]}function b(){v(s[0][0],s[0][1]),c.lineEnd();var e,t,n,r,l=c.clean(),h=u.result(),f=h.length;if(s.pop(),a.push(s),s=null,f)if(1&l){if((t=(n=h[0]).length-1)>0){for(d||(i.polygonStart(),d=!0),i.lineStart(),e=0;e<t;++e)i.point((r=n[e])[0],r[1]);i.lineEnd()}}else f>1&&2&l&&h.push(h.pop().concat(h.shift())),o.push(h.filter(n$))}return h}};function n$(e){return e.length>1}function r$(e,t){return((e=e.x)[0]<0?e[1]-bL-gL:bL-e[1])-((t=t.x)[0]<0?t[1]-bL-gL:bL-t[1])}var i$=t$((function(){return!0}),(function(e){var t,n=NaN,r=NaN,i=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(a,o){var s=a>0?yL:-yL,l=EL(a-n);EL(l-yL)<gL?(e.point(n,r=(r+o)/2>0?bL:-bL),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),e.point(a,r),t=0):i!==s&&l>=yL&&(EL(n-i)<gL&&(n-=i*gL),EL(a-s)<gL&&(a-=s*gL),r=function(e,t,n,r){var i,a,o=NL(e-n);return EL(o)>gL?SL((NL(t)*(a=CL(r))*NL(n)-NL(r)*(i=CL(t))*NL(e))/(i*a*o)):(t+r)/2}(n,r,a,o),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),t=0),e.point(n=a,r=o),i=s},lineEnd:function(){e.lineEnd(),n=r=NaN},clean:function(){return 2-t}}}),(function(e,t,n,r){var i;if(null==e)r.point(-yL,i=n*bL),r.point(0,i),r.point(yL,i),r.point(yL,0),r.point(yL,-i),r.point(0,-i),r.point(-yL,-i),r.point(-yL,0),r.point(-yL,i);else if(EL(e[0]-t[0])>gL){var a=e[0]<t[0]?yL:-yL;r.point(-a,i=n*a/2),r.point(0,i),r.point(a,i)}else r.point(t[0],t[1])}),[-yL,-bL]),a$=function(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return(n=t.invert(n,r))&&e.invert(n[0],n[1])}),n};function o$(e,t){return[EL(e)>yL?e+Math.round(-e/wL)*wL:e,t]}function s$(e,t,n){return(e%=wL)?t||n?a$(u$(e),c$(t,n)):u$(e):t||n?c$(t,n):o$}function l$(e){return function(t,n){return[(t+=e)>yL?t-wL:t<-yL?t+wL:t,n]}}function u$(e){var t=l$(e);return t.invert=l$(-e),t}function c$(e,t){var n=CL(e),r=NL(e),i=CL(t),a=NL(t);function o(e,t){var o=CL(t),s=CL(e)*o,l=NL(e)*o,u=NL(t),c=u*n+s*r;return[TL(l*i-c*a,s*n-u*r),LL(c*i+l*a)]}return o.invert=function(e,t){var o=CL(t),s=CL(e)*o,l=NL(e)*o,u=NL(t),c=u*i-l*a;return[TL(l*i+u*a,s*n+c*r),LL(c*n-s*r)]},o}function d$(e,t){(t=GB(t))[0]-=e,JB(t);var n=PL(-t[1]);return((-t[2]<0?-n:n)+wL-gL)%wL}o$.invert=o$;var h$=function(e){var t=CL(e),n=6*kL,r=t>0,i=EL(t)>gL;function a(e,n){return CL(e)*CL(n)>t}function o(e,n,r){var i=[1,0,0],a=XB(GB(e),GB(n)),o=YB(a,a),s=a[0],l=o-s*s;if(!l)return!r&&e;var u=t*o/l,c=-t*s/l,d=XB(i,a),h=ZB(i,u);KB(h,ZB(a,c));var f=d,p=YB(h,f),m=YB(f,f),g=p*p-m*(YB(h,h)-1);if(!(g<0)){var v=FL(g),y=ZB(f,(-p-v)/m);if(KB(y,h),y=qB(y),!r)return y;var b,x=e[0],w=n[0],_=e[1],k=n[1];w<x&&(b=x,x=w,w=b);var E=w-x,S=EL(E-yL)<gL;if(!S&&k<_&&(b=_,_=k,k=b),S||E<gL?S?_+k>0^y[1]<(EL(y[0]-x)<gL?_:k):_<=y[1]&&y[1]<=k:E>yL^(x<=y[0]&&y[0]<=w)){var T=ZB(f,(-p+v)/m);return KB(T,h),[y,qB(T)]}}}function s(t,n){var i=r?e:yL-e,a=0;return t<-i?a|=1:t>i&&(a|=2),n<-i?a|=4:n>i&&(a|=8),a}return t$(a,(function(e){var t,n,l,u,c;return{lineStart:function(){u=l=!1,c=1},point:function(d,h){var f,p=[d,h],m=a(d,h),g=r?m?0:s(d,h):m?s(d+(d<0?yL:-yL),h):0;if(!t&&(u=l=m)&&e.lineStart(),m!==l&&(!(f=o(t,p))||UB(t,f)||UB(p,f))&&(p[2]=1),m!==l)c=0,m?(e.lineStart(),f=o(p,t),e.point(f[0],f[1])):(f=o(t,p),e.point(f[0],f[1],2),e.lineEnd()),t=f;else if(i&&t&&r^m){var v;g&n||!(v=o(p,t,!0))||(c=0,r?(e.lineStart(),e.point(v[0][0],v[0][1]),e.point(v[1][0],v[1][1]),e.lineEnd()):(e.point(v[1][0],v[1][1]),e.lineEnd(),e.lineStart(),e.point(v[0][0],v[0][1],3)))}!m||t&&UB(t,p)||e.point(p[0],p[1]),t=p,l=m,n=g},lineEnd:function(){l&&e.lineEnd(),t=null},clean:function(){return c|(u&&l)<<1}}}),(function(t,r,i,a){!function(e,t,n,r,i,a){if(n){var o=CL(t),s=NL(t),l=r*n;null==i?(i=t+r*wL,a=t-l/2):(i=d$(o,i),a=d$(o,a),(r>0?i<a:i>a)&&(i+=r*wL));for(var u,c=i;r>0?c>a:c<a;c-=l)u=qB([o,-s*CL(c),-s*NL(c)]),e.point(u[0],u[1])}}(a,e,n,i,t,r)}),r?[0,-e]:[-yL,e-yL])},f$=1e9,p$=-f$;function m$(e,t,n,r){function i(i,a){return e<=i&&i<=n&&t<=a&&a<=r}function a(i,a,s,u){var c=0,d=0;if(null==i||(c=o(i,s))!==(d=o(a,s))||l(i,a)<0^s>0)do{u.point(0===c||3===c?e:n,c>1?r:t)}while((c=(c+s+4)%4)!==d);else u.point(a[0],a[1])}function o(r,i){return EL(r[0]-e)<gL?i>0?0:3:EL(r[0]-n)<gL?i>0?2:1:EL(r[1]-t)<gL?i>0?1:0:i>0?3:2}function s(e,t){return l(e.x,t.x)}function l(e,t){var n=o(e,1),r=o(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(o){var l,u,c,d,h,f,p,m,g,v,y,b=o,x=zB(),w={point:_,lineStart:function(){w.point=k,u&&u.push(c=[]),v=!0,g=!1,p=m=NaN},lineEnd:function(){l&&(k(d,h),f&&g&&x.rejoin(),l.push(x.result())),w.point=_,g&&b.lineEnd()},polygonStart:function(){b=x,l=[],u=[],y=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,i=u.length;n<i;++n)for(var a,o,s=u[n],l=1,c=s.length,d=s[0],h=d[0],f=d[1];l<c;++l)a=h,o=f,h=(d=s[l])[0],f=d[1],o<=r?f>r&&(h-a)*(r-o)>(f-o)*(e-a)&&++t:f<=r&&(h-a)*(r-o)<(f-o)*(e-a)&&--t;return t}(),n=y&&t,i=(l=e$(l)).length;(n||i)&&(o.polygonStart(),n&&(o.lineStart(),a(null,null,1,o),o.lineEnd()),i&&WB(l,s,t,a,o),o.polygonEnd()),b=o,l=u=c=null}};function _(e,t){i(e,t)&&b.point(e,t)}function k(a,o){var s=i(a,o);if(u&&c.push([a,o]),v)d=a,h=o,f=s,v=!1,s&&(b.lineStart(),b.point(a,o));else if(s&&g)b.point(a,o);else{var l=[p=Math.max(p$,Math.min(f$,p)),m=Math.max(p$,Math.min(f$,m))],x=[a=Math.max(p$,Math.min(f$,a)),o=Math.max(p$,Math.min(f$,o))];!function(e,t,n,r,i,a){var o,s=e[0],l=e[1],u=0,c=1,d=t[0]-s,h=t[1]-l;if(o=n-s,d||!(o>0)){if(o/=d,d<0){if(o<u)return;o<c&&(c=o)}else if(d>0){if(o>c)return;o>u&&(u=o)}if(o=i-s,d||!(o<0)){if(o/=d,d<0){if(o>c)return;o>u&&(u=o)}else if(d>0){if(o<u)return;o<c&&(c=o)}if(o=r-l,h||!(o>0)){if(o/=h,h<0){if(o<u)return;o<c&&(c=o)}else if(h>0){if(o>c)return;o>u&&(u=o)}if(o=a-l,h||!(o<0)){if(o/=h,h<0){if(o>c)return;o>u&&(u=o)}else if(h>0){if(o<u)return;o<c&&(c=o)}return u>0&&(e[0]=s+u*d,e[1]=l+u*h),c<1&&(t[0]=s+c*d,t[1]=l+c*h),!0}}}}}(l,x,e,t,n,r)?s&&(b.lineStart(),b.point(a,o),y=!1):(g||(b.lineStart(),b.point(l[0],l[1])),b.point(x[0],x[1]),s||b.lineEnd(),y=!1)}p=a,m=o,g=s}return w}}function g$(e){return function(t){var n=new v$;for(var r in e)n[r]=e[r];return n.stream=t,n}}function v$(){}function y$(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=r&&e.clipExtent(null),pL(n,e.stream(oB)),t(oB.result()),null!=r&&e.clipExtent(r),e}function b$(e,t,n){return y$(e,(function(n){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],a=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),o=+t[0][0]+(r-a*(n[1][0]+n[0][0]))/2,s=+t[0][1]+(i-a*(n[1][1]+n[0][1]))/2;e.scale(150*a).translate([o,s])}),n)}function x$(e,t,n){return b$(e,[[0,0],t],n)}function w$(e,t,n){return y$(e,(function(n){var r=+t,i=r/(n[1][0]-n[0][0]),a=(r-i*(n[1][0]+n[0][0]))/2,o=-i*n[0][1];e.scale(150*i).translate([a,o])}),n)}function _$(e,t,n){return y$(e,(function(n){var r=+t,i=r/(n[1][1]-n[0][1]),a=-i*n[0][0],o=(r-i*(n[1][1]+n[0][1]))/2;e.scale(150*i).translate([a,o])}),n)}v$.prototype={constructor:v$,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var k$=CL(30*kL),E$=function(e,t){return+t?function(e,t){function n(r,i,a,o,s,l,u,c,d,h,f,p,m,g){var v=u-r,y=c-i,b=v*v+y*y;if(b>4*t&&m--){var x=o+h,w=s+f,_=l+p,k=FL(x*x+w*w+_*_),E=LL(_/=k),S=EL(EL(_)-1)<gL||EL(a-d)<gL?(a+d)/2:TL(w,x),T=e(S,E),C=T[0],I=T[1],A=C-r,O=I-i,D=y*A-v*O;(D*D/b>t||EL((v*A+y*O)/b-.5)>.3||o*h+s*f+l*p<k$)&&(n(r,i,a,o,s,l,C,I,S,x/=k,w/=k,_,m,g),g.point(C,I),n(C,I,S,x,w,_,u,c,d,h,f,p,m,g))}}return function(t){var r,i,a,o,s,l,u,c,d,h,f,p,m={point:g,lineStart:v,lineEnd:b,polygonStart:function(){t.polygonStart(),m.lineStart=x},polygonEnd:function(){t.polygonEnd(),m.lineStart=v}};function g(n,r){n=e(n,r),t.point(n[0],n[1])}function v(){c=NaN,m.point=y,t.lineStart()}function y(r,i){var a=GB([r,i]),o=e(r,i);n(c,d,u,h,f,p,c=o[0],d=o[1],u=r,h=a[0],f=a[1],p=a[2],16,t),t.point(c,d)}function b(){m.point=g,t.lineEnd()}function x(){v(),m.point=w,m.lineEnd=_}function w(e,t){y(r=e,t),i=c,a=d,o=h,s=f,l=p,m.point=y}function _(){n(c,d,u,h,f,p,i,a,r,o,s,l,16,t),m.lineEnd=b,b()}return m}}(e,t):function(e){return g$({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)},S$=g$({point:function(e,t){this.stream.point(e*kL,t*kL)}});function T$(e,t,n,r,i,a){if(!a)return function(e,t,n,r,i){function a(a,o){return[t+e*(a*=r),n-e*(o*=i)]}return a.invert=function(a,o){return[(a-t)/e*r,(n-o)/e*i]},a}(e,t,n,r,i);var o=CL(a),s=NL(a),l=o*e,u=s*e,c=o/e,d=s/e,h=(s*n-o*t)/e,f=(s*t+o*n)/e;function p(e,a){return[l*(e*=r)-u*(a*=i)+t,n-u*e-l*a]}return p.invert=function(e,t){return[r*(c*e-d*t+h),i*(f-d*e-c*t)]},p}function C$(e){return I$((function(){return e}))()}function I$(e){var t,n,r,i,a,o,s,l,u,c,d=150,h=480,f=250,p=0,m=0,g=0,v=0,y=0,b=0,x=1,w=1,_=null,k=i$,E=null,S=lL,T=.5;function C(e){return l(e[0]*kL,e[1]*kL)}function I(e){return(e=l.invert(e[0],e[1]))&&[e[0]*_L,e[1]*_L]}function A(){var e=T$(d,0,0,x,w,b).apply(null,t(p,m)),r=T$(d,h-e[0],f-e[1],x,w,b);return n=s$(g,v,y),s=a$(t,r),l=a$(n,s),o=E$(s,T),O()}function O(){return u=c=null,C}return C.stream=function(e){return u&&c===e?u:u=S$(function(e){return g$({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}(n)(k(o(S(c=e)))))},C.preclip=function(e){return arguments.length?(k=e,_=void 0,O()):k},C.postclip=function(e){return arguments.length?(S=e,E=r=i=a=null,O()):S},C.clipAngle=function(e){return arguments.length?(k=+e?h$(_=e*kL):(_=null,i$),O()):_*_L},C.clipExtent=function(e){return arguments.length?(S=null==e?(E=r=i=a=null,lL):m$(E=+e[0][0],r=+e[0][1],i=+e[1][0],a=+e[1][1]),O()):null==E?null:[[E,r],[i,a]]},C.scale=function(e){return arguments.length?(d=+e,A()):d},C.translate=function(e){return arguments.length?(h=+e[0],f=+e[1],A()):[h,f]},C.center=function(e){return arguments.length?(p=e[0]%360*kL,m=e[1]%360*kL,A()):[p*_L,m*_L]},C.rotate=function(e){return arguments.length?(g=e[0]%360*kL,v=e[1]%360*kL,y=e.length>2?e[2]%360*kL:0,A()):[g*_L,v*_L,y*_L]},C.angle=function(e){return arguments.length?(b=e%360*kL,A()):b*_L},C.reflectX=function(e){return arguments.length?(x=e?-1:1,A()):x<0},C.reflectY=function(e){return arguments.length?(w=e?-1:1,A()):w<0},C.precision=function(e){return arguments.length?(o=E$(s,T=e*e),O()):FL(T)},C.fitExtent=function(e,t){return b$(C,e,t)},C.fitSize=function(e,t){return x$(C,e,t)},C.fitWidth=function(e,t){return w$(C,e,t)},C.fitHeight=function(e,t){return _$(C,e,t)},function(){return t=e.apply(this,arguments),C.invert=t.invert&&I,A()}}function A$(e){var t=0,n=yL/3,r=I$(e),i=r(t,n);return i.parallels=function(e){return arguments.length?r(t=e[0]*kL,n=e[1]*kL):[t*_L,n*_L]},i}function O$(e,t){var n=NL(e),r=(n+NL(t))/2;if(EL(r)<gL)return function(e){var t=CL(e);function n(e,n){return[e*t,NL(n)/t]}return n.invert=function(e,n){return[e/t,LL(n*t)]},n}(e);var i=1+n*(2*r-n),a=FL(i)/r;function o(e,t){var n=FL(i-2*r*NL(t))/r;return[n*NL(e*=r),a-n*CL(e)]}return o.invert=function(e,t){var n=a-t,o=TL(e,EL(n))*jL(n);return n*r<0&&(o-=yL*jL(e)*jL(n)),[o/r,LL((i-(e*e+n*n)*r*r)/(2*r))]},o}var D$=function(){return A$(O$).scale(155.424).center([0,33.6442])},M$=function(){return D$().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])};function N$(e){return function(t,n){var r=CL(t),i=CL(n),a=e(r*i);return a===1/0?[2,0]:[a*i*NL(t),a*NL(n)]}}function j$(e){return function(t,n){var r=FL(t*t+n*n),i=e(r),a=NL(i),o=CL(i);return[TL(t*a,r*o),LL(r&&n*a/r)]}}var F$=N$((function(e){return FL(2/(1+e))}));F$.invert=j$((function(e){return 2*LL(e/2)}));var R$=N$((function(e){return(e=PL(e))&&e/NL(e)}));function P$(e,t){return[e,DL(RL((bL+t)/2))]}function L$(e){var t,n,r,i=C$(e),a=i.center,o=i.scale,s=i.translate,l=i.clipExtent,u=null;function c(){var a=yL*o(),s=i(function(e){function t(t){return(t=e(t[0]*kL,t[1]*kL))[0]*=_L,t[1]*=_L,t}return e=s$(e[0]*kL,e[1]*kL,e.length>2?e[2]*kL:0),t.invert=function(t){return(t=e.invert(t[0]*kL,t[1]*kL))[0]*=_L,t[1]*=_L,t},t}(i.rotate()).invert([0,0]));return l(null==u?[[s[0]-a,s[1]-a],[s[0]+a,s[1]+a]]:e===P$?[[Math.max(s[0]-a,u),t],[Math.min(s[0]+a,n),r]]:[[u,Math.max(s[1]-a,t)],[n,Math.min(s[1]+a,r)]])}return i.scale=function(e){return arguments.length?(o(e),c()):o()},i.translate=function(e){return arguments.length?(s(e),c()):s()},i.center=function(e){return arguments.length?(a(e),c()):a()},i.clipExtent=function(e){return arguments.length?(null==e?u=t=n=r=null:(u=+e[0][0],t=+e[0][1],n=+e[1][0],r=+e[1][1]),c()):null==u?null:[[u,t],[n,r]]},c()}function B$(e){return RL((bL+e)/2)}function $$(e,t){var n=CL(e),r=e===t?NL(e):DL(n/CL(t))/DL(B$(t)/B$(e)),i=n*ML(B$(e),r)/r;if(!r)return P$;function a(e,t){i>0?t<-bL+gL&&(t=-bL+gL):t>bL-gL&&(t=bL-gL);var n=i/ML(B$(t),r);return[n*NL(r*e),i-n*CL(r*e)]}return a.invert=function(e,t){var n=i-t,a=jL(r)*FL(e*e+n*n),o=TL(e,EL(n))*jL(n);return n*r<0&&(o-=yL*jL(e)*jL(n)),[o/r,2*SL(ML(i/a,1/r))-bL]},a}function z$(e,t){return[e,t]}function U$(e,t){var n=CL(e),r=e===t?NL(e):(n-CL(t))/(t-e),i=n/r+e;if(EL(r)<gL)return z$;function a(e,t){var n=i-t,a=r*e;return[n*NL(a),i-n*CL(a)]}return a.invert=function(e,t){var n=i-t,a=TL(e,EL(n))*jL(n);return n*r<0&&(a-=yL*jL(e)*jL(n)),[a/r,i-jL(r)*FL(e*e+n*n)]},a}R$.invert=j$((function(e){return e})),P$.invert=function(e,t){return[e,2*SL(AL(t))-bL]},z$.invert=z$;var H$=1.340264,W$=-.081106,V$=893e-6,q$=.003796,G$=FL(3)/2;function Y$(e,t){var n=LL(G$*NL(t)),r=n*n,i=r*r*r;return[e*CL(n)/(G$*(H$+3*W$*r+i*(7*V$+9*q$*r))),n*(H$+W$*r+i*(V$+q$*r))]}function X$(e,t){var n=CL(t),r=CL(e)*n;return[n*NL(e)/r,NL(t)/r]}function K$(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),t*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}function Z$(e,t){return[CL(t)*NL(e),NL(t)]}function J$(e,t){var n=CL(t),r=1+CL(e)*n;return[n*NL(e)/r,NL(t)/r]}function Q$(e,t){return[DL(RL((bL+t)/2)),-e]}Y$.invert=function(e,t){for(var n,r=t,i=r*r,a=i*i*i,o=0;o<12&&(a=(i=(r-=n=(r*(H$+W$*i+a*(V$+q$*i))-t)/(H$+3*W$*i+a*(7*V$+9*q$*i)))*r)*i*i,!(EL(n)<vL));++o);return[G$*e*(H$+3*W$*i+a*(7*V$+9*q$*i))/CL(r),LL(NL(r)/G$)]},X$.invert=j$(SL),K$.invert=function(e,t){var n,r=t,i=25;do{var a=r*r,o=a*a;r-=n=(r*(1.007226+a*(.015085+o*(.028874*a-.044475-.005916*o)))-t)/(1.007226+a*(.045255+o*(.259866*a-.311325-.005916*11*o)))}while(EL(n)>gL&&--i>0);return[e/(.8707+(a=r*r)*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979)),r]},Z$.invert=j$(LL),J$.invert=j$((function(e){return 2*SL(e)})),Q$.invert=function(e,t){return[-t,2*SL(AL(e))-bL]};var ez=Math.abs,tz=(Math,Math,Math,Math.cos),nz=(Math,Math,Math,Math,Math,Math,Math,Math,Math.sin),rz=(Math,Math.PI),iz=rz/2,az=(Math,sz(2));function oz(e){return e>1?iz:e<-1?-iz:Math.asin(e)}function sz(e){return e>0?Math.sqrt(e):0}function lz(e,t){var n,r=e*nz(t),i=30;do{t-=n=(t+nz(t)-r)/(1+tz(t))}while(ez(n)>1e-6&&--i>0);return t/2}sz(rz);var uz=function(e,t,n){function r(r,i){return[e*r*tz(i=lz(n,i)),t*nz(i)]}return r.invert=function(r,i){return i=oz(i/t),[r/(e*tz(i)),oz((2*i+nz(2*i))/n)]},r}(az/iz,az,rz);const cz=$B(),dz=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function hz(e,t){return function n(){const r=t();return r.type=e,r.path=$B().projection(r),r.copy=r.copy||function(){const e=n();return dz.forEach(t=>{r[t]&&e[t](r[t]())}),e.path.pointRadius(r.path.pointRadius()),e},r}}function fz(e,t){if(!e||"string"!=typeof e)throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(mz[e]=hz(e,t),this):mz[e]||null}function pz(e){return e&&e.path||cz}const mz={albers:M$,albersusa:function(){var e,t,n,r,i,a,o=M$(),s=D$().rotate([154,0]).center([-2,58.5]).parallels([55,65]),l=D$().rotate([157,0]).center([-3,19.9]).parallels([8,18]),u={point:function(e,t){a=[e,t]}};function c(e){var t=e[0],o=e[1];return a=null,n.point(t,o),a||(r.point(t,o),a)||(i.point(t,o),a)}function d(){return e=t=null,c}return c.invert=function(e){var t=o.scale(),n=o.translate(),r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?s:i>=.166&&i<.234&&r>=-.214&&r<-.115?l:o).invert(e)},c.stream=function(n){return e&&t===n?e:(r=[o.stream(t=n),s.stream(n),l.stream(n)],i=r.length,e={point:function(e,t){for(var n=-1;++n<i;)r[n].point(e,t)},sphere:function(){for(var e=-1;++e<i;)r[e].sphere()},lineStart:function(){for(var e=-1;++e<i;)r[e].lineStart()},lineEnd:function(){for(var e=-1;++e<i;)r[e].lineEnd()},polygonStart:function(){for(var e=-1;++e<i;)r[e].polygonStart()},polygonEnd:function(){for(var e=-1;++e<i;)r[e].polygonEnd()}});var r,i},c.precision=function(e){return arguments.length?(o.precision(e),s.precision(e),l.precision(e),d()):o.precision()},c.scale=function(e){return arguments.length?(o.scale(e),s.scale(.35*e),l.scale(e),c.translate(o.translate())):o.scale()},c.translate=function(e){if(!arguments.length)return o.translate();var t=o.scale(),a=+e[0],c=+e[1];return n=o.translate(e).clipExtent([[a-.455*t,c-.238*t],[a+.455*t,c+.238*t]]).stream(u),r=s.translate([a-.307*t,c+.201*t]).clipExtent([[a-.425*t+gL,c+.12*t+gL],[a-.214*t-gL,c+.234*t-gL]]).stream(u),i=l.translate([a-.205*t,c+.212*t]).clipExtent([[a-.214*t+gL,c+.166*t+gL],[a-.115*t-gL,c+.234*t-gL]]).stream(u),d()},c.fitExtent=function(e,t){return b$(c,e,t)},c.fitSize=function(e,t){return x$(c,e,t)},c.fitWidth=function(e,t){return w$(c,e,t)},c.fitHeight=function(e,t){return _$(c,e,t)},c.scale(1070)},azimuthalequalarea:function(){return C$(F$).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return C$(R$).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return A$($$).scale(109.5).parallels([30,30])},conicequalarea:D$,conicequidistant:function(){return A$(U$).scale(131.154).center([0,13.9389])},equalEarth:function(){return C$(Y$).scale(177.158)},equirectangular:function(){return C$(z$).scale(152.63)},gnomonic:function(){return C$(X$).scale(144.049).clipAngle(60)},identity:function(){var e,t,n,r,i,a,o,s=1,l=0,u=0,c=1,d=1,h=0,f=null,p=1,m=1,g=g$({point:function(e,t){var n=b([e,t]);this.stream.point(n[0],n[1])}}),v=lL;function y(){return p=s*c,m=s*d,a=o=null,b}function b(n){var r=n[0]*p,i=n[1]*m;if(h){var a=i*e-r*t;r=r*e+i*t,i=a}return[r+l,i+u]}return b.invert=function(n){var r=n[0]-l,i=n[1]-u;if(h){var a=i*e+r*t;r=r*e-i*t,i=a}return[r/p,i/m]},b.stream=function(e){return a&&o===e?a:a=g(v(o=e))},b.postclip=function(e){return arguments.length?(v=e,f=n=r=i=null,y()):v},b.clipExtent=function(e){return arguments.length?(v=null==e?(f=n=r=i=null,lL):m$(f=+e[0][0],n=+e[0][1],r=+e[1][0],i=+e[1][1]),y()):null==f?null:[[f,n],[r,i]]},b.scale=function(e){return arguments.length?(s=+e,y()):s},b.translate=function(e){return arguments.length?(l=+e[0],u=+e[1],y()):[l,u]},b.angle=function(n){return arguments.length?(t=NL(h=n%360*kL),e=CL(h),y()):h*_L},b.reflectX=function(e){return arguments.length?(c=e?-1:1,y()):c<0},b.reflectY=function(e){return arguments.length?(d=e?-1:1,y()):d<0},b.fitExtent=function(e,t){return b$(b,e,t)},b.fitSize=function(e,t){return x$(b,e,t)},b.fitWidth=function(e,t){return w$(b,e,t)},b.fitHeight=function(e,t){return _$(b,e,t)},b},mercator:function(){return L$(P$).scale(961/wL)},mollweide:function(){return C$(uz).scale(169.529)},naturalEarth1:function(){return C$(K$).scale(175.295)},orthographic:function(){return C$(Z$).scale(249.5).clipAngle(90.000001)},stereographic:function(){return C$(J$).scale(250).clipAngle(142)},transversemercator:function(){var e=L$(Q$),t=e.center,n=e.rotate;return e.center=function(e){return arguments.length?t([-e[1],e[0]]):[(e=t())[1],-e[0]]},e.rotate=function(e){return arguments.length?n([e[0],e[1],e.length>2?e[2]+90:90]):[(e=n())[0],e[1],e[2]-90]},n([0,0,90]).scale(159.155)}};for(const Gqe in mz)fz(Gqe,mz[Gqe]);function gz(e,t,n){var r=wk(e,t-gL,n).concat(t);return function(e){return r.map((function(t){return[e,t]}))}}function vz(e,t,n){var r=wk(e,t-gL,n).concat(t);return function(e){return r.map((function(t){return[t,e]}))}}var yz=function(e,t,n){e.prototype=t.prototype=n,n.constructor=e};function bz(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function xz(){}var wz=.7,_z=1/wz,kz="\\s*([+-]?\\d+)\\s*",Ez="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Sz="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Tz=/^#([0-9a-f]{3,8})$/,Cz=new RegExp("^rgb\\("+[kz,kz,kz]+"\\)$"),Iz=new RegExp("^rgb\\("+[Sz,Sz,Sz]+"\\)$"),Az=new RegExp("^rgba\\("+[kz,kz,kz,Ez]+"\\)$"),Oz=new RegExp("^rgba\\("+[Sz,Sz,Sz,Ez]+"\\)$"),Dz=new RegExp("^hsl\\("+[Ez,Sz,Sz]+"\\)$"),Mz=new RegExp("^hsla\\("+[Ez,Sz,Sz,Ez]+"\\)$"),Nz={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function jz(){return this.rgb().formatHex()}function Fz(){return this.rgb().formatRgb()}function Rz(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Tz.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Pz(t):3===n?new zz(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Lz(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Lz(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Cz.exec(e))?new zz(t[1],t[2],t[3],1):(t=Iz.exec(e))?new zz(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Az.exec(e))?Lz(t[1],t[2],t[3],t[4]):(t=Oz.exec(e))?Lz(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Dz.exec(e))?Vz(t[1],t[2]/100,t[3]/100,1):(t=Mz.exec(e))?Vz(t[1],t[2]/100,t[3]/100,t[4]):Nz.hasOwnProperty(e)?Pz(Nz[e]):"transparent"===e?new zz(NaN,NaN,NaN,0):null}function Pz(e){return new zz(e>>16&255,e>>8&255,255&e,1)}function Lz(e,t,n,r){return r<=0&&(e=t=n=NaN),new zz(e,t,n,r)}function Bz(e){return e instanceof xz||(e=Rz(e)),e?new zz((e=e.rgb()).r,e.g,e.b,e.opacity):new zz}function $z(e,t,n,r){return 1===arguments.length?Bz(e):new zz(e,t,n,null==r?1:r)}function zz(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Uz(){return"#"+Wz(this.r)+Wz(this.g)+Wz(this.b)}function Hz(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function Wz(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function Vz(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Yz(e,t,n,r)}function qz(e){if(e instanceof Yz)return new Yz(e.h,e.s,e.l,e.opacity);if(e instanceof xz||(e=Rz(e)),!e)return new Yz;if(e instanceof Yz)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new Yz(o,s,l,e.opacity)}function Gz(e,t,n,r){return 1===arguments.length?qz(e):new Yz(e,t,n,null==r?1:r)}function Yz(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Xz(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Kz(){}yz(xz,Rz,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:jz,formatHex:jz,formatHsl:function(){return qz(this).formatHsl()},formatRgb:Fz,toString:Fz}),yz(zz,$z,bz(xz,{brighter:function(e){return e=null==e?_z:Math.pow(_z,e),new zz(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?wz:Math.pow(wz,e),new zz(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Uz,formatHex:Uz,formatRgb:Hz,toString:Hz})),yz(Yz,Gz,bz(xz,{brighter:function(e){return e=null==e?_z:Math.pow(_z,e),new Yz(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?wz:Math.pow(wz,e),new Yz(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new zz(Xz(e>=240?e-240:e+120,i,r),Xz(e,i,r),Xz(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));const Zz=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function Jz(){var e=1,t=1,n=o;function r(e,t){return t.map(t=>i(e,t))}function i(r,i){var o=[],s=[];return function(n,r,i){var o,s,l,u,c,d=new Array,h=new Array;for(o=s=-1,Zz[(l=n[0]>=r)<<1].forEach(f);++o<e-1;)Zz[l|(l=n[o+1]>=r)<<1].forEach(f);for(Zz[l<<0].forEach(f);++s<t-1;){for(o=-1,Zz[(l=n[s*e+e]>=r)<<1|(u=n[s*e]>=r)<<2].forEach(f);++o<e-1;)c=u,Zz[l|(l=n[s*e+e+o+1]>=r)<<1|(u=n[s*e+o+1]>=r)<<2|c<<3].forEach(f);Zz[l|u<<3].forEach(f)}for(o=-1,Zz[(u=n[s*e]>=r)<<2].forEach(f);++o<e-1;)c=u,Zz[(u=n[s*e+o+1]>=r)<<2|c<<3].forEach(f);function f(e){var t,n,r=[e[0][0]+o,e[0][1]+s],l=[e[1][0]+o,e[1][1]+s],u=a(r),c=a(l);(t=h[u])?(n=d[c])?(delete h[t.end],delete d[n.start],t===n?(t.ring.push(l),i(t.ring)):d[t.start]=h[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete h[t.end],t.ring.push(l),h[t.end=c]=t):(t=d[c])?(n=h[u])?(delete d[t.start],delete h[n.end],t===n?(t.ring.push(l),i(t.ring)):d[n.start]=h[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete d[t.start],t.ring.unshift(r),d[t.start=u]=t):d[u]=h[c]={start:u,end:c,ring:[r,l]}}Zz[u<<3].forEach(f)}(r,i,e=>{n(e,r,i),function(e){for(var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}(e)>0?o.push([e]):s.push(e)}),s.forEach(e=>{for(var t,n=0,r=o.length;n<r;++n)if(-1!==Qz((t=o[n])[0],e))return void t.push(e)}),{type:"MultiPolygon",value:i,coordinates:o}}function a(t){return 2*t[0]+t[1]*(e+1)*4}function o(n,r,i){n.forEach(n=>{var a,o=n[0],s=n[1],l=0|o,u=0|s,c=r[u*e+l];o>0&&o<e&&l===o&&(n[0]=o+(i-(a=r[u*e+l-1]))/(c-a)-.5),s>0&&s<t&&u===s&&(n[1]=s+(i-(a=r[(u-1)*e+l]))/(c-a)-.5)})}return r.contour=i,r.size=function(n){if(!arguments.length)return[e,t];var i=Math.floor(n[0]),a=Math.floor(n[1]);return i>=0&&a>=0||sm("invalid size"),e=i,t=a,r},r.smooth=function(e){return arguments.length?(n=e?o:Kz,r):n===o},r}function Qz(e,t){for(var n,r=-1,i=t.length;++r<i;)if(n=eU(e,t[r]))return n;return 0}function eU(e,t){for(var n=t[0],r=t[1],i=-1,a=0,o=e.length,s=o-1;a<o;s=a++){var l=e[a],u=l[0],c=l[1],d=e[s],h=d[0],f=d[1];if(tU(l,d,t))return 0;c>r!=f>r&&n<(h-u)*(r-c)/(f-c)+u&&(i=-i)}return i}function tU(e,t,n){var r,i,a,o;return function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])}(e,t,n)&&(i=e[r=+(e[0]===t[0])],o=t[r],i<=(a=n[r])&&a<=o||o<=a&&a<=i)}function nU(e,t,n){return function(r){var i=ag(r),a=n?Math.min(i[0],0):i[0],o=i[1],s=o-a,l=t?kv(a,o,e):s/(e+1);return wk(a+l,o,l)}}function rU(e){g_.call(this,null,e)}function iU(e,t,n,r,i){const a=e.x1||0,o=e.y1||0,s=t*n<0;function l(e){e.forEach(u)}function u(e){s&&e.reverse(),e.forEach(c)}function c(e){e[0]=(e[0]-a)*t+r,e[1]=(e[1]-o)*n+i}return function(e){return e.coordinates.forEach(l),e}}function aU(e,t,n){const r=e>=0?e:O_(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function oU(e){return Km(e)?e:ng(+e)}function sU(){var e=e=>e[0],t=e=>e[1],n=fm,r=[-1,-1],i=960,a=500,o=2;function s(s,l){const u=aU(r[0],s,e)>>o,c=aU(r[1],s,t)>>o,d=u?u+2:0,h=c?c+2:0,f=2*d+(i>>o),p=2*h+(a>>o),m=new Float32Array(f*p),g=new Float32Array(f*p);let v=m;s.forEach(r=>{const i=d+(+e(r)>>o),a=h+(+t(r)>>o);i>=0&&i<f&&a>=0&&a<p&&(m[i+a*f]+=+n(r))}),u>0&&c>0?(lU(f,p,m,g,u),uU(f,p,g,m,c),lU(f,p,m,g,u),uU(f,p,g,m,c),lU(f,p,m,g,u),uU(f,p,g,m,c)):u>0?(lU(f,p,m,g,u),lU(f,p,g,m,u),lU(f,p,m,g,u),v=g):c>0&&(uU(f,p,m,g,c),uU(f,p,g,m,c),uU(f,p,m,g,c),v=g);const y=l?Math.pow(2,-2*o):1/DP(v);for(let e=0,t=f*p;e<t;++e)v[e]*=y;return{values:v,scale:1<<o,width:f,height:p,x1:d,y1:h,x2:d+(i>>o),y2:h+(a>>o)}}return s.x=function(t){return arguments.length?(e=oU(t),s):e},s.y=function(e){return arguments.length?(t=oU(e),s):t},s.weight=function(e){return arguments.length?(n=oU(e),s):n},s.size=function(e){if(!arguments.length)return[i,a];var t=+e[0],n=+e[1];return t>=0&&n>=0||sm("invalid size"),i=t,a=n,s},s.cellSize=function(e){return arguments.length?((e=+e)>=1||sm("invalid cell size"),o=Math.floor(Math.log(e)/Math.LN2),s):1<<o},s.bandwidth=function(e){return arguments.length?(1===(e=Ym(e)).length&&(e=[+e[0],+e[0]]),2!==e.length&&sm("invalid bandwidth"),r=e,s):r},s}function lU(e,t,n,r,i){const a=1+(i<<1);for(let o=0;o<t;++o)for(let t=0,s=0;t<e+i;++t)t<e&&(s+=n[t+o*e]),t>=i&&(t>=a&&(s-=n[t-a+o*e]),r[t-i+o*e]=s/Math.min(t+1,e-1+a-t,a))}function uU(e,t,n,r,i){const a=1+(i<<1);for(let o=0;o<e;++o)for(let s=0,l=0;s<t+i;++s)s<t&&(l+=n[o+s*e]),s>=i&&(s>=a&&(l-=n[o+(s-a)*e]),r[o+(s-i)*e]=l/Math.min(s+1,t-1+a-s,a))}function cU(e){g_.call(this,null,e)}rU.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},hg(rU,g_,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||dm,a=Jz().smooth(!1!==e.smooth),o=e.thresholds||function(e,t,n){const r=nU(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?r:r(e.map(e=>x_(t(e).values)))}(r,i,e),s=null===e.as?null:e.as||"contour",l=[];return r.forEach(t=>{const n=i(t),r=a.size([n.width,n.height])(n.values,km(o)?o:o(n.values));!function(e,t,n,r){let i=r.scale||t.scale,a=r.translate||t.translate;if(Km(i)&&(i=i(n,r)),Km(a)&&(a=a(n,r)),(1===i||null==i)&&!a)return;const o=(vg(i)?i:i[0])||1,s=(vg(i)?i:i[1])||1;e.forEach(iU(t,o,s,a&&a[0]||0,a&&a[1]||0))}(r,n,t,e),r.forEach(e=>{l.push(Uw(t,$w(null!=s?{[s]:e}:e)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n}}),cU.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const dU=["x","y","weight","size","cellSize","bandwidth"];function hU(e,t){return dU.forEach(n=>null!=t[n]?e[n](t[n]):0),e}function fU(e){g_.call(this,null,e)}hg(cU,g_,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=function(e,t){var n,r,i,a,o,s,l=[],u=e=>e(a);if(null==t)l.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(s=n[o=t.map(u)])||(n[o]=s=[],s.dims=o,l.push(s)),s.push(a);return l}(t.materialize(t.SOURCE).source,e.groupby),a=(e.groupby||[]).map(nm),o=hU(sU(),e),s=e.as||"grid";return n=i.map(t=>$w(function(e,t){for(let n=0;n<a.length;++n)e[a[n]]=t[n];return e}({[s]:o(t,e.counts)},t.dims))),this.value&&(r.rem=this.value),this.value=r.source=r.add=n,r}}),fU.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},hg(fU,g_,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=Jz().smooth(!1!==e.smooth),o=e.values,s=e.thresholds||nU(e.count||10,e.nice,!!o),l=e.size;return o||(o=t.materialize(t.SOURCE).source,r=iU(n=hU(sU(),e)(o,!0),n.scale||1,n.scale||1,0,0),l=[n.width,n.height],o=n.values),s=km(s)?s:s(o),o=a.size(l)(o,s),r&&o.forEach(r),this.value&&(i.rem=this.value),this.value=i.source=i.add=(o||[]).map($w),i}});const pU="Feature",mU="FeatureCollection";function gU(e){g_.call(this,null,e)}function vU(e){g_.call(this,null,e)}function yU(e){g_.call(this,null,e)}function bU(e){g_.call(this,null,e)}function xU(e){g_.call(this,[],e),this.generator=function(){var e,t,n,r,i,a,o,s,l,u,c,d,h=10,f=h,p=90,m=360,g=2.5;function v(){return{type:"MultiLineString",coordinates:y()}}function y(){return wk(IL(r/p)*p,n,p).map(c).concat(wk(IL(s/m)*m,o,m).map(d)).concat(wk(IL(t/h)*h,e,h).filter((function(e){return EL(e%p)>gL})).map(l)).concat(wk(IL(a/f)*f,i,f).filter((function(e){return EL(e%m)>gL})).map(u))}return v.lines=function(){return y().map((function(e){return{type:"LineString",coordinates:e}}))},v.outline=function(){return{type:"Polygon",coordinates:[c(r).concat(d(o).slice(1),c(n).reverse().slice(1),d(s).reverse().slice(1))]}},v.extent=function(e){return arguments.length?v.extentMajor(e).extentMinor(e):v.extentMinor()},v.extentMajor=function(e){return arguments.length?(s=+e[0][1],o=+e[1][1],(r=+e[0][0])>(n=+e[1][0])&&(e=r,r=n,n=e),s>o&&(e=s,s=o,o=e),v.precision(g)):[[r,s],[n,o]]},v.extentMinor=function(n){return arguments.length?(a=+n[0][1],i=+n[1][1],(t=+n[0][0])>(e=+n[1][0])&&(n=t,t=e,e=n),a>i&&(n=a,a=i,i=n),v.precision(g)):[[t,a],[e,i]]},v.step=function(e){return arguments.length?v.stepMajor(e).stepMinor(e):v.stepMinor()},v.stepMajor=function(e){return arguments.length?(p=+e[0],m=+e[1],v):[p,m]},v.stepMinor=function(e){return arguments.length?(h=+e[0],f=+e[1],v):[h,f]},v.precision=function(h){return arguments.length?(g=+h,l=gz(a,i,90),u=vz(t,e,g),c=gz(s,o,90),d=vz(r,n,g),v):g},v.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()}function wU(e){g_.call(this,null,e)}function _U(e){if(!Km(e))return!1;const t=Mg(rm(e));return t.$x||t.$y||t.$value||t.$max}function kU(e){g_.call(this,null,e),this.modified(!0)}function EU(e,t,n){Km(e[t])&&e[t](n)}function SU(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,a,o,s,l,u,c,d,h,f=e._root,p={data:r},m=e._x0,g=e._y0,v=e._x1,y=e._y1;if(!f)return e._root=p,e;for(;f.length;)if((u=t>=(a=(m+v)/2))?m=a:v=a,(c=n>=(o=(g+y)/2))?g=o:y=o,i=f,!(f=f[d=c<<1|u]))return i[d]=p,e;if(s=+e._x.call(null,f.data),l=+e._y.call(null,f.data),t===s&&n===l)return p.next=f,i?i[d]=p:e._root=p,e;do{i=i?i[d]=new Array(4):e._root=new Array(4),(u=t>=(a=(m+v)/2))?m=a:v=a,(c=n>=(o=(g+y)/2))?g=o:y=o}while((d=c<<1|u)==(h=(l>=o)<<1|s>=a));return i[h]=f,i[d]=p,e}gU.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},hg(gU,g_,{transform(e,t){var n,r=this._features,i=this._points,a=e.fields,o=a&&a[0],s=a&&a[1],l=e.geojson||!a&&dm,u=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(rm(l))||o&&t.modified(rm(o))||s&&t.modified(rm(s)),this.value&&!n||(u=t.SOURCE,this._features=r=[],this._points=i=[]),l&&t.visit(u,e=>r.push(l(e))),o&&s&&(t.visit(u,e=>{var t=o(e),n=s(e);null!=t&&null!=n&&(t=+t)===t&&(n=+n)===n&&i.push([t,n])}),r=r.concat({type:pU,geometry:{type:"MultiPoint",coordinates:i}})),this.value={type:mU,features:r}}}),vU.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},hg(vU,g_,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||dm,a=e.as||"path",o=n.SOURCE;!r||e.modified()?(this.value=r=pz(e.projection),n.materialize().reflow()):o=i===dm||t.modified(i.fields)?n.ADD_MOD:n.ADD;const s=function(e,t){const n=e.pointRadius();return e.context(null),null!=t&&e.pointRadius(t),n}(r,e.pointRadius);return n.visit(o,e=>e[a]=r(i(e))),r.pointRadius(s),n.modifies(a)}}),yU.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},hg(yU,g_,{transform(e,t){var n,r=e.projection,i=e.fields[0],a=e.fields[1],o=e.as||["x","y"],s=o[0],l=o[1];function u(e){const t=r([i(e),a(e)]);t?(e[s]=t[0],e[l]=t[1]):(e[s]=void 0,e[l]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,u):(n=t.modified(i.fields)||t.modified(a.fields),t.visit(n?t.ADD_MOD:t.ADD,u)),t.modifies(o)}}),bU.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},hg(bU,g_,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",a=n.ADD;return r&&!e.modified()||(this.value=r=function(e,t,n){const r=null==n?n=>e(t(n)):r=>{var i=e.pointRadius(),a=e.pointRadius(n)(t(r));return e.pointRadius(i),a};return r.context=t=>(e.context(t),r),r}(pz(e.projection),e.field||um("datum"),e.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,e=>e[i]=r),n.modifies(i)}}),xU.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},hg(xU,g_,{transform(e,t){var n,r=this.value,i=this.generator;if(!r.length||e.modified())for(const a in e)Km(i[a])&&i[a](e[a]);return n=i(),r.length?t.mod.push(Hw(r[0],n)):t.add.push($w(n)),r[0]=n,t}}),wU.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},hg(wU,g_,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,r="shared"===e.resolve,i=e.field||dm,a=function(e,t){let n;return Km(e)?(n=n=>e(n,t),n.dep=_U(e)):e?n=ng(e):(n=e=>e.$value/e.$max||0,n.dep=!0),n}(e.opacity,e),o=function(e,t){let n;return Km(e)?(n=n=>$z(e(n,t)),n.dep=_U(e)):n=ng($z(e||"#888")),n}(e.color,e),s=e.as||"image",l={$x:0,$y:0,$value:0,$max:r?x_(n.map(e=>x_(i(e).values))):0};return n.forEach(e=>{const t=i(e),n=ig({},e,l);r||(n.$max=x_(t.values||[])),e[s]=function(e,t,n,r){const i=e.width,a=e.x1||0,o=e.y1||0,s=e.x2||i,l=e.y2||e.height,u=e.values,c=u?e=>u[e]:hm,d=aT(s-a,l-o),h=d.getContext("2d"),f=h.getImageData(0,0,s-a,l-o),p=f.data;for(let m=o,g=0;m<l;++m){t.$y=m-o;for(let e=a,o=m*i;e<s;++e,g+=4){t.$x=e-a,t.$value=c(e+o);const i=n(t);p[g+0]=i.r,p[g+1]=i.g,p[g+2]=i.b,p[g+3]=~~(255*r(t))}}return h.putImageData(f,0,0),d}(t,n,o.dep?o:ng(o(n)),a.dep?a:ng(a(n)))}),t.reflow(!0).modifies(s)}}),hg(kU,g_,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=function(e){const t=fz((e||"mercator").toLowerCase());return t||sm("Unrecognized projection type: "+e),t()}(e.type),dz.forEach(t=>{null!=e[t]&&EU(n,t,e[t])})):dz.forEach(t=>{e.modified(t)&&EU(n,t,e[t])}),null!=e.pointRadius&&n.path.pointRadius(e.pointRadius),e.fit&&function(e,t){const n=function(e){return 1===(e=Ym(e)).length?e[0]:{type:mU,features:e.reduce((e,t)=>e.concat(function(e){return e.type===mU?e.features:Ym(e).filter(e=>null!=e).map(e=>e.type===pU?e:{type:pU,geometry:e})}(t)),[])}}(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});var TU=function(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i};function CU(e){return e[0]}function IU(e){return e[1]}function AU(e,t,n){var r=new OU(null==t?CU:t,null==n?IU:n,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}function OU(e,t,n,r,i,a){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=a,this._root=void 0}function DU(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var MU=AU.prototype=OU.prototype;MU.copy=function(){var e,t,n=new OU(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=DU(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var i=0;i<4;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(4)}):r.target[i]=DU(t));return n},MU.add=function(e){var t=+this._x.call(null,e),n=+this._y.call(null,e);return SU(this.cover(t,n),t,n,e)},MU.addAll=function(e){var t,n,r,i,a=e.length,o=new Array(a),s=new Array(a),l=1/0,u=1/0,c=-1/0,d=-1/0;for(n=0;n<a;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||(o[n]=r,s[n]=i,r<l&&(l=r),r>c&&(c=r),i<u&&(u=i),i>d&&(d=i));if(l>c||u>d)return this;for(this.cover(l,u).cover(c,d),n=0;n<a;++n)SU(this,o[n],s[n],e[n]);return this},MU.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,a=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,a=(r=Math.floor(t))+1;else{for(var o,s,l=i-n,u=this._root;n>e||e>=i||r>t||t>=a;)switch(s=(t<r)<<1|e<n,(o=new Array(4))[s]=u,u=o,l*=2,s){case 0:i=n+l,a=r+l;break;case 1:n=i-l,a=r+l;break;case 2:i=n+l,r=a-l;break;case 3:n=i-l,r=a-l}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=r,this._x1=i,this._y1=a,this},MU.data=function(){var e=[];return this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)})),e},MU.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},MU.find=function(e,t,n){var r,i,a,o,s,l,u,c=this._x0,d=this._y0,h=this._x1,f=this._y1,p=[],m=this._root;for(m&&p.push(new TU(m,c,d,h,f)),null==n?n=1/0:(c=e-n,d=t-n,h=e+n,f=t+n,n*=n);l=p.pop();)if(!(!(m=l.node)||(i=l.x0)>h||(a=l.y0)>f||(o=l.x1)<c||(s=l.y1)<d))if(m.length){var g=(i+o)/2,v=(a+s)/2;p.push(new TU(m[3],g,v,o,s),new TU(m[2],i,v,g,s),new TU(m[1],g,a,o,v),new TU(m[0],i,a,g,v)),(u=(t>=v)<<1|e>=g)&&(l=p[p.length-1],p[p.length-1]=p[p.length-1-u],p[p.length-1-u]=l)}else{var y=e-+this._x.call(null,m.data),b=t-+this._y.call(null,m.data),x=y*y+b*b;if(x<n){var w=Math.sqrt(n=x);c=e-w,d=t-w,h=e+w,f=t+w,r=m.data}}return r},MU.remove=function(e){if(isNaN(a=+this._x.call(null,e))||isNaN(o=+this._y.call(null,e)))return this;var t,n,r,i,a,o,s,l,u,c,d,h,f=this._root,p=this._x0,m=this._y0,g=this._x1,v=this._y1;if(!f)return this;if(f.length)for(;;){if((u=a>=(s=(p+g)/2))?p=s:g=s,(c=o>=(l=(m+v)/2))?m=l:v=l,t=f,!(f=f[d=c<<1|u]))return this;if(!f.length)break;(t[d+1&3]||t[d+2&3]||t[d+3&3])&&(n=t,h=d)}for(;f.data!==e;)if(r=f,!(f=f.next))return this;return(i=f.next)&&delete f.next,r?(i?r.next=i:delete r.next,this):t?(i?t[d]=i:delete t[d],(f=t[0]||t[1]||t[2]||t[3])&&f===(t[3]||t[2]||t[1]||t[0])&&!f.length&&(n?n[h]=f:this._root=f),this):(this._root=i,this)},MU.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},MU.root=function(){return this._root},MU.size=function(){var e=0;return this.visit((function(t){if(!t.length)do{++e}while(t=t.next)})),e},MU.visit=function(e){var t,n,r,i,a,o,s=[],l=this._root;for(l&&s.push(new TU(l,this._x0,this._y0,this._x1,this._y1));t=s.pop();)if(!e(l=t.node,r=t.x0,i=t.y0,a=t.x1,o=t.y1)&&l.length){var u=(r+a)/2,c=(i+o)/2;(n=l[3])&&s.push(new TU(n,u,c,a,o)),(n=l[2])&&s.push(new TU(n,r,c,u,o)),(n=l[1])&&s.push(new TU(n,u,i,a,c)),(n=l[0])&&s.push(new TU(n,r,i,u,c))}return this},MU.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new TU(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var a,o=t.x0,s=t.y0,l=t.x1,u=t.y1,c=(o+l)/2,d=(s+u)/2;(a=i[0])&&n.push(new TU(a,o,s,c,d)),(a=i[1])&&n.push(new TU(a,c,s,l,d)),(a=i[2])&&n.push(new TU(a,o,d,c,u)),(a=i[3])&&n.push(new TU(a,c,d,l,u))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},MU.x=function(e){return arguments.length?(this._x=e,this):this._x},MU.y=function(e){return arguments.length?(this._y=e,this):this._y};var NU=function(e){return function(){return e}},jU=function(e){return 1e-6*(e()-.5)};function FU(e){return e.x+e.vx}function RU(e){return e.y+e.vy}var PU={value:function(){}};function LU(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new BU(r)}function BU(e){this._=e}function $U(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function zU(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function UU(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=PU,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}BU.prototype=LU.prototype={constructor:BU,on:function(e,t){var n,r=this._,i=$U(e+"",r),a=-1,o=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<o;)if(n=(e=i[a]).type)r[n]=UU(r[n],e.name,t);else if(null==t)for(n in r)r[n]=UU(r[n],e.name,null);return this}for(;++a<o;)if((n=(e=i[a]).type)&&(n=zU(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new BU(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),a=0;a<n;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=0,n=(r=this._[e]).length;a<n;++a)r[a].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};var HU,WU,VU=LU,qU=0,GU=0,YU=0,XU=0,KU=0,ZU=0,JU="object"==typeof performance&&performance.now?performance:Date,QU="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function eH(){return KU||(QU(tH),KU=JU.now()+ZU)}function tH(){KU=0}function nH(){this._call=this._time=this._next=null}function rH(e,t,n){var r=new nH;return r.restart(e,t,n),r}function iH(){KU=(XU=JU.now())+ZU,qU=GU=0;try{!function(){eH(),++qU;for(var e,t=HU;t;)(e=KU-t._time)>=0&&t._call.call(null,e),t=t._next;--qU}()}finally{qU=0,function(){for(var e,t,n=HU,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:HU=t);WU=e,oH(r)}(),KU=0}}function aH(){var e=JU.now(),t=e-XU;t>1e3&&(ZU-=t,XU=e)}function oH(e){qU||(GU&&(GU=clearTimeout(GU)),e-KU>24?(e<1/0&&(GU=setTimeout(iH,e-JU.now()-ZU)),YU&&(YU=clearInterval(YU))):(YU||(XU=JU.now(),YU=setInterval(aH,1e3)),qU=1,QU(iH)))}nH.prototype=rH.prototype={constructor:nH,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?eH():+n)+(null==t?0:+t),this._next||WU===this||(WU?WU._next=this:HU=this,WU=this),this._call=e,this._time=n,oH()},stop:function(){this._call&&(this._call=null,this._time=1/0,oH())}};const sH=4294967296;function lH(e){return e.x}function uH(e){return e.y}var cH=Math.PI*(3-Math.sqrt(5));function dH(e){return e.index}function hH(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}const fH={center:function(e,t){var n,r=1;function i(){var i,a,o=n.length,s=0,l=0;for(i=0;i<o;++i)s+=(a=n[i]).x,l+=a.y;for(s=(s/o-e)*r,l=(l/o-t)*r,i=0;i<o;++i)(a=n[i]).x-=s,a.y-=l}return null==e&&(e=0),null==t&&(t=0),i.initialize=function(e){n=e},i.x=function(t){return arguments.length?(e=+t,i):e},i.y=function(e){return arguments.length?(t=+e,i):t},i.strength=function(e){return arguments.length?(r=+e,i):r},i},collide:function(e){var t,n,r,i=1,a=1;function o(){for(var e,o,l,u,c,d,h,f=t.length,p=0;p<a;++p)for(o=AU(t,FU,RU).visitAfter(s),e=0;e<f;++e)h=(d=n[(l=t[e]).index])*d,u=l.x+l.vx,c=l.y+l.vy,o.visit(m);function m(e,t,n,a,o){var s=e.data,f=e.r,p=d+f;if(!s)return t>u+p||a<u-p||n>c+p||o<c-p;if(s.index>l.index){var m=u-s.x-s.vx,g=c-s.y-s.vy,v=m*m+g*g;v<p*p&&(0===m&&(v+=(m=jU(r))*m),0===g&&(v+=(g=jU(r))*g),v=(p-(v=Math.sqrt(v)))/v*i,l.vx+=(m*=v)*(p=(f*=f)/(h+f)),l.vy+=(g*=v)*p,s.vx-=m*(p=1-p),s.vy-=g*p)}}}function s(e){if(e.data)return e.r=n[e.data.index];for(var t=e.r=0;t<4;++t)e[t]&&e[t].r>e.r&&(e.r=e[t].r)}function l(){if(t){var r,i,a=t.length;for(n=new Array(a),r=0;r<a;++r)n[(i=t[r]).index]=+e(i,r,t)}}return"function"!=typeof e&&(e=NU(null==e?1:+e)),o.initialize=function(e,n){t=e,r=n,l()},o.iterations=function(e){return arguments.length?(a=+e,o):a},o.strength=function(e){return arguments.length?(i=+e,o):i},o.radius=function(t){return arguments.length?(e="function"==typeof t?t:NU(+t),l(),o):e},o},nbody:function(){var e,t,n,r,i,a=NU(-30),o=1,s=1/0,l=.81;function u(n){var i,a=e.length,o=AU(e,lH,uH).visitAfter(d);for(r=n,i=0;i<a;++i)t=e[i],o.visit(h)}function c(){if(e){var t,n,r=e.length;for(i=new Array(r),t=0;t<r;++t)i[(n=e[t]).index]=+a(n,t,e)}}function d(e){var t,n,r,a,o,s=0,l=0;if(e.length){for(r=a=o=0;o<4;++o)(t=e[o])&&(n=Math.abs(t.value))&&(s+=t.value,l+=n,r+=n*t.x,a+=n*t.y);e.x=r/l,e.y=a/l}else{(t=e).x=t.data.x,t.y=t.data.y;do{s+=i[t.data.index]}while(t=t.next)}e.value=s}function h(e,a,u,c){if(!e.value)return!0;var d=e.x-t.x,h=e.y-t.y,f=c-a,p=d*d+h*h;if(f*f/l<p)return p<s&&(0===d&&(p+=(d=jU(n))*d),0===h&&(p+=(h=jU(n))*h),p<o&&(p=Math.sqrt(o*p)),t.vx+=d*e.value*r/p,t.vy+=h*e.value*r/p),!0;if(!(e.length||p>=s)){(e.data!==t||e.next)&&(0===d&&(p+=(d=jU(n))*d),0===h&&(p+=(h=jU(n))*h),p<o&&(p=Math.sqrt(o*p)));do{e.data!==t&&(t.vx+=d*(f=i[e.data.index]*r/p),t.vy+=h*f)}while(e=e.next)}}return u.initialize=function(t,r){e=t,n=r,c()},u.strength=function(e){return arguments.length?(a="function"==typeof e?e:NU(+e),c(),u):a},u.distanceMin=function(e){return arguments.length?(o=e*e,u):Math.sqrt(o)},u.distanceMax=function(e){return arguments.length?(s=e*e,u):Math.sqrt(s)},u.theta=function(e){return arguments.length?(l=e*e,u):Math.sqrt(l)},u},link:function(e){var t,n,r,i,a,o,s=dH,l=function(e){return 1/Math.min(i[e.source.index],i[e.target.index])},u=NU(30),c=1;function d(r){for(var i=0,s=e.length;i<c;++i)for(var l,u,d,h,f,p,m,g=0;g<s;++g)h=(d=(l=e[g]).target).x+d.vx-(u=l.source).x-u.vx||jU(o),f=d.y+d.vy-u.y-u.vy||jU(o),f*=p=((p=Math.sqrt(h*h+f*f))-n[g])/p*r*t[g],d.vx-=(h*=p)*(m=a[g]),d.vy-=f*m,u.vx+=h*(m=1-m),u.vy+=f*m}function h(){if(r){var o,l,u=r.length,c=e.length,d=new Map(r.map((e,t)=>[s(e,t,r),e]));for(o=0,i=new Array(u);o<c;++o)(l=e[o]).index=o,"object"!=typeof l.source&&(l.source=hH(d,l.source)),"object"!=typeof l.target&&(l.target=hH(d,l.target)),i[l.source.index]=(i[l.source.index]||0)+1,i[l.target.index]=(i[l.target.index]||0)+1;for(o=0,a=new Array(c);o<c;++o)a[o]=i[(l=e[o]).source.index]/(i[l.source.index]+i[l.target.index]);t=new Array(c),f(),n=new Array(c),p()}}function f(){if(r)for(var n=0,i=e.length;n<i;++n)t[n]=+l(e[n],n,e)}function p(){if(r)for(var t=0,i=e.length;t<i;++t)n[t]=+u(e[t],t,e)}return null==e&&(e=[]),d.initialize=function(e,t){r=e,o=t,h()},d.links=function(t){return arguments.length?(e=t,h(),d):e},d.id=function(e){return arguments.length?(s=e,d):s},d.iterations=function(e){return arguments.length?(c=+e,d):c},d.strength=function(e){return arguments.length?(l="function"==typeof e?e:NU(+e),f(),d):l},d.distance=function(e){return arguments.length?(u="function"==typeof e?e:NU(+e),p(),d):u},d},x:function(e){var t,n,r,i=NU(.1);function a(e){for(var i,a=0,o=t.length;a<o;++a)(i=t[a]).vx+=(r[a]-i.x)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=NU(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:NU(+e),o(),a):i},a.x=function(t){return arguments.length?(e="function"==typeof t?t:NU(+t),o(),a):e},a},y:function(e){var t,n,r,i=NU(.1);function a(e){for(var i,a=0,o=t.length;a<o;++a)(i=t[a]).vy+=(r[a]-i.y)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=NU(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:NU(+e),o(),a):i},a.y=function(t){return arguments.length?(e="function"==typeof t?t:NU(+t),o(),a):e},a}},pH="forces",mH=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],gH=["static","iterations"],vH=["x","y","vx","vy"];function yH(e){g_.call(this,null,e)}function bH(e,t,n,r){var i,a,o,s,l=Ym(t.forces);for(i=0,a=mH.length;i<a;++i)(o=mH[i])!==pH&&t.modified(o)&&e[o](t[o]);for(i=0,a=l.length;i<a;++i)s=pH+i,(o=n||t.modified(pH,i)?wH(l[i]):r&&xH(l[i],r)?e.force(s):null)&&e.force(s,o);for(a=e.numForces||0;i<a;++i)e.force(pH+i,null);return e.numForces=l.length,e}function xH(e,t){var n,r;for(n in e)if(Km(r=e[n])&&t.modified(rm(r)))return 1;return 0}function wH(e){var t,n;for(n in lg(fH,e.force)||sm("Unrecognized force: "+e.force),t=fH[e.force](),e)Km(t[n])&&_H(t[n],e[n],e);return t}function _H(e,t,n){e(Km(t)?e=>t(e,n):t)}function kH(e){var t=0,n=e.children,r=n&&n.length;if(r)for(;--r>=0;)t+=n[r].value;else t=1;e.value=t}function EH(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=TH)):void 0===t&&(t=SH);for(var n,r,i,a,o,s=new AH(e),l=[s];n=l.pop();)if((i=t(n.data))&&(o=(i=Array.from(i)).length))for(n.children=i,a=o-1;a>=0;--a)l.push(r=i[a]=new AH(i[a])),r.parent=n,r.depth=n.depth+1;return s.eachBefore(IH)}function SH(e){return e.children}function TH(e){return Array.isArray(e)?e[1]:null}function CH(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function IH(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function AH(e){this.data=e,this.depth=this.height=0,this.parent=null}function OH(e,t){var n,r;if(NH(t,e))return[t];for(n=0;n<e.length;++n)if(DH(t,e[n])&&NH(FH(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(r=n+1;r<e.length;++r)if(DH(FH(e[n],e[r]),t)&&DH(FH(e[n],t),e[r])&&DH(FH(e[r],t),e[n])&&NH(RH(e[n],e[r],t),e))return[e[n],e[r],t];throw new Error}function DH(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function MH(e,t){var n=e.r-t.r+1e-9*Math.max(e.r,t.r,1),r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function NH(e,t){for(var n=0;n<t.length;++n)if(!MH(e,t[n]))return!1;return!0}function jH(e){switch(e.length){case 1:return{x:(t=e[0]).x,y:t.y,r:t.r};case 2:return FH(e[0],e[1]);case 3:return RH(e[0],e[1],e[2])}var t}function FH(e,t){var n=e.x,r=e.y,i=e.r,a=t.x,o=t.y,s=t.r,l=a-n,u=o-r,c=s-i,d=Math.sqrt(l*l+u*u);return{x:(n+a+l/d*c)/2,y:(r+o+u/d*c)/2,r:(d+i+s)/2}}function RH(e,t,n){var r=e.x,i=e.y,a=e.r,o=t.x,s=t.y,l=t.r,u=n.x,c=n.y,d=n.r,h=r-o,f=r-u,p=i-s,m=i-c,g=l-a,v=d-a,y=r*r+i*i-a*a,b=y-o*o-s*s+l*l,x=y-u*u-c*c+d*d,w=f*p-h*m,_=(p*x-m*b)/(2*w)-r,k=(m*g-p*v)/w,E=(f*b-h*x)/(2*w)-i,S=(h*v-f*g)/w,T=k*k+S*S-1,C=2*(a+_*k+E*S),I=_*_+E*E-a*a,A=-(T?(C+Math.sqrt(C*C-4*T*I))/(2*T):I/C);return{x:r+_+k*A,y:i+E+S*A,r:A}}function PH(e,t,n){var r,i,a,o,s=e.x-t.x,l=e.y-t.y,u=s*s+l*l;u?(i=t.r+n.r,o=e.r+n.r,(i*=i)>(o*=o)?(r=(u+o-i)/(2*u),a=Math.sqrt(Math.max(0,o/u-r*r)),n.x=e.x-r*s-a*l,n.y=e.y-r*l+a*s):(r=(u+i-o)/(2*u),a=Math.sqrt(Math.max(0,i/u-r*r)),n.x=t.x+r*s-a*l,n.y=t.y+r*l+a*s)):(n.x=t.x+n.r,n.y=t.y)}function LH(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function BH(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,a=(t.y*n.r+n.y*t.r)/r;return i*i+a*a}function $H(e){this._=e,this.next=null,this.previous=null}function zH(e){return null==e?null:UH(e)}function UH(e){if("function"!=typeof e)throw new Error;return e}function HH(){return 0}yH.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:vH}]},hg(yH,g_,{transform(e,t){var n,r,i=this.value,a=t.changed(t.ADD_REM),o=e.modified(mH),s=e.iterations||300;if(i?(a&&(t.modifies("index"),i.nodes(t.source)),(o||t.changed(t.MOD))&&bH(i,e,0,t)):(this.value=i=function(e,t){const n=function(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),a=0,o=.6,s=new Map,l=rH(d),u=VU("tick","end"),c=function(){let e=1;return()=>(e=(1664525*e+1013904223)%sH)/sH}();function d(){h(),u.call("tick",t),n<r&&(l.stop(),u.call("end",t))}function h(r){var l,u,c=e.length;void 0===r&&(r=1);for(var d=0;d<r;++d)for(n+=(a-n)*i,s.forEach((function(e){e(n)})),l=0;l<c;++l)null==(u=e[l]).fx?u.x+=u.vx*=o:(u.x=u.fx,u.vx=0),null==u.fy?u.y+=u.vy*=o:(u.y=u.fy,u.vy=0);return t}function f(){for(var t,n=0,r=e.length;n<r;++n){if((t=e[n]).index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var i=10*Math.sqrt(.5+n),a=n*cH;t.x=i*Math.cos(a),t.y=i*Math.sin(a)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function p(t){return t.initialize&&t.initialize(e,c),t}return null==e&&(e=[]),f(),t={tick:h,restart:function(){return l.restart(d),t},stop:function(){return l.stop(),t},nodes:function(n){return arguments.length?(e=n,f(),s.forEach(p),t):e},alpha:function(e){return arguments.length?(n=+e,t):n},alphaMin:function(e){return arguments.length?(r=+e,t):r},alphaDecay:function(e){return arguments.length?(i=+e,t):+i},alphaTarget:function(e){return arguments.length?(a=+e,t):a},velocityDecay:function(e){return arguments.length?(o=1-e,t):1-o},randomSource:function(e){return arguments.length?(c=e,s.forEach(p),t):c},force:function(e,n){return arguments.length>1?(null==n?s.delete(e):s.set(e,p(n)),t):s.get(e)},find:function(t,n,r){var i,a,o,s,l,u=0,c=e.length;for(null==r?r=1/0:r*=r,u=0;u<c;++u)(o=(i=t-(s=e[u]).x)*i+(a=n-s.y)*a)<r&&(l=s,r=o);return l},on:function(e,n){return arguments.length>1?(u.on(e,n),t):u.on(e)}}}(e),r=n.stop,i=n.restart;let a=!1;return n.stopped=()=>a,n.restart=()=>(a=!1,i()),n.stop=()=>(a=!0,r()),bH(n,t,!0).on("end",()=>a=!0)}(t.source,e),i.on("tick",(n=t.dataflow,r=this,()=>n.touch(r).run())),e.static||(a=!0,i.tick()),t.modifies("index")),o||a||e.modified(gH)||t.changed()&&e.restart)if(i.alpha(Math.max(i.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(i.alphaMin(),1/s)),e.static)for(i.stop();--s>=0;)i.tick();else if(i.stopped()&&i.restart(),!a)return t.StopPropagation;return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let s,l=this._argops,u=0,c=l.length;u<c;++u)if(s=l[u],s.name===pH&&"link"===s.op._argval.force)for(var r,i=s.op._argops,a=0,o=i.length;a<o;++a)if("links"===i[a].name&&(r=i[a].op.source)){n.pulse(r,n.changeset().reflow());break}return t.reflow(e.modified()).modifies(vH)}}),AH.prototype=EH.prototype={constructor:AH,count:function(){return this.eachAfter(kH)},each:function(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this},eachAfter:function(e,t){for(var n,r,i,a=this,o=[a],s=[],l=-1;a=o.pop();)if(s.push(a),n=a.children)for(r=0,i=n.length;r<i;++r)o.push(n[r]);for(;a=s.pop();)e.call(t,a,++l,this);return this},eachBefore:function(e,t){for(var n,r,i=this,a=[i],o=-1;i=a.pop();)if(e.call(t,i,++o,this),n=i.children)for(r=n.length-1;r>=0;--r)a.push(n[r]);return this},find:function(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r},sum:function(e){return this.eachAfter((function(t){for(var n=+e(t.data)||0,r=t.children,i=r&&r.length;--i>=0;)n+=r[i].value;t.value=n}))},sort:function(e){return this.eachBefore((function(t){t.children&&t.children.sort(e)}))},path:function(e){for(var t=this,n=function(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),i=null;for(e=n.pop(),t=r.pop();e===t;)i=e,e=n.pop(),t=r.pop();return i}(t,e),r=[t];t!==n;)r.push(t=t.parent);for(var i=r.length;e!==n;)r.splice(i,0,e),e=e.parent;return r},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore((function(t){t.children||e.push(t)})),e},links:function(){var e=this,t=[];return e.each((function(n){n!==e&&t.push({source:n.parent,target:n})})),t},copy:function(){return EH(this).eachBefore(CH)},[Symbol.iterator]:function*(){var e,t,n,r,i=this,a=[i];do{for(e=a.reverse(),a=[];i=e.pop();)if(yield i,t=i.children)for(n=0,r=t.length;n<r;++n)a.push(t[n])}while(a.length)}};var WH=function(e){return function(){return e}};function VH(e){return Math.sqrt(e.value)}function qH(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function GH(e,t){return function(n){if(r=n.children){var r,i,a,o=r.length,s=e(n)*t||0;if(s)for(i=0;i<o;++i)r[i].r+=s;if(a=function(e){if(!(a=(t=e,e="object"==typeof t&&"length"in t?t:Array.from(t)).length))return 0;var t,n,r,i,a,o,s,l,u,c,d,h;if((n=e[0]).x=0,n.y=0,!(a>1))return n.r;if(n.x=-(r=e[1]).r,r.x=n.r,r.y=0,!(a>2))return n.r+r.r;PH(r,n,i=e[2]),n=new $H(n),r=new $H(r),i=new $H(i),n.next=i.previous=r,r.next=n.previous=i,i.next=r.previous=n;e:for(l=3;l<a;++l){PH(n._,r._,i=e[l]),i=new $H(i),u=r.next,c=n.previous,d=r._.r,h=n._.r;do{if(d<=h){if(LH(u._,i._)){n.next=r=u,r.previous=n,--l;continue e}d+=u._.r,u=u.next}else{if(LH(c._,i._)){(n=c).next=r,r.previous=n,--l;continue e}h+=c._.r,c=c.previous}}while(u!==c.next);for(i.previous=n,i.next=r,n.next=r.previous=r=i,o=BH(n);(i=i.next)!==r;)(s=BH(i))<o&&(n=i,o=s);r=n.next}for(n=[r._],i=r;(i=i.next)!==r;)n.push(i._);for(i=function(e){for(var t,n,r=0,i=(e=function(e){for(var t,n,r=e.length;r;)n=Math.random()*r--|0,t=e[r],e[r]=e[n],e[n]=t;return e}(Array.from(e))).length,a=[];r<i;)t=e[r],n&&MH(n,t)?++r:(n=jH(a=OH(a,t)),r=0);return n}(n),l=0;l<a;++l)(n=e[l]).x-=i.x,n.y-=i.y;return i.r}(r),s)for(i=0;i<o;++i)r[i].r-=s;n.r=a+s}}}function YH(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}var XH=function(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)},KH=function(e,t,n,r,i){for(var a,o=e.children,s=-1,l=o.length,u=e.value&&(r-t)/e.value;++s<l;)(a=o[s]).y0=n,a.y1=i,a.x0=t,a.x1=t+=a.value*u},ZH={depth:-1},JH={};function QH(e){return e.id}function eW(e){return e.parentId}var tW=function(){var e=QH,t=eW;function n(n){var r,i,a,o,s,l,u,c=Array.from(n),d=c.length,h=new Map;for(i=0;i<d;++i)s=c[i]=new AH(r=c[i]),null!=(l=e(r,i,n))&&(l+="")&&(u=s.id=l,h.set(u,h.has(u)?JH:s)),null!=(l=t(r,i,n))&&(l+="")&&(s.parent=l);for(i=0;i<d;++i)if(l=(s=c[i]).parent){if(!(o=h.get(l)))throw new Error("missing: "+l);if(o===JH)throw new Error("ambiguous: "+l);o.children?o.children.push(s):o.children=[s],s.parent=o}else{if(a)throw new Error("multiple roots");a=s}if(!a)throw new Error("no root");if(a.parent=ZH,a.eachBefore((function(e){e.depth=e.parent.depth+1,--d})).eachBefore(IH),a.parent=null,d>0)throw new Error("cycle");return a}return n.id=function(t){return arguments.length?(e=UH(t),n):e},n.parentId=function(e){return arguments.length?(t=UH(e),n):t},n};function nW(e,t){return e.parent===t.parent?1:2}function rW(e){var t=e.children;return t?t[0]:e.t}function iW(e){var t=e.children;return t?t[t.length-1]:e.t}function aW(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function oW(e,t,n){return e.a.parent===t.parent?e.a:n}function sW(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function lW(e,t){return e.parent===t.parent?1:2}function uW(e,t){return e+t.x}function cW(e,t){return Math.max(e,t.y)}sW.prototype=Object.create(AH.prototype);var dW=function(e,t,n,r,i){for(var a,o=e.children,s=-1,l=o.length,u=e.value&&(i-n)/e.value;++s<l;)(a=o[s]).x0=t,a.x1=r,a.y0=n,a.y1=n+=a.value*u},hW=(1+Math.sqrt(5))/2;function fW(e,t,n,r,i,a){for(var o,s,l,u,c,d,h,f,p,m,g,v=[],y=t.children,b=0,x=0,w=y.length,_=t.value;b<w;){l=i-n,u=a-r;do{c=y[x++].value}while(!c&&x<w);for(d=h=c,g=c*c*(m=Math.max(u/l,l/u)/(_*e)),p=Math.max(h/g,g/d);x<w;++x){if(c+=s=y[x].value,s<d&&(d=s),s>h&&(h=s),g=c*c*m,(f=Math.max(h/g,g/d))>p){c-=s;break}p=f}v.push(o={value:c,dice:l<u,children:y.slice(b,x)}),o.dice?KH(o,n,r,i,_?r+=u*c/_:a):dW(o,n,r,_?n+=l*c/_:i,a),_-=c,b=x}return v}var pW=function e(t){function n(e,n,r,i,a){fW(t,e,n,r,i,a)}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(hW),mW=function e(t){function n(e,n,r,i,a){if((o=e._squarify)&&o.ratio===t)for(var o,s,l,u,c,d=-1,h=o.length,f=e.value;++d<h;){for(l=(s=o[d]).children,u=s.value=0,c=l.length;u<c;++u)s.value+=l[u].value;s.dice?KH(s,n,r,i,f?r+=(a-r)*s.value/f:a):dW(s,n,r,f?n+=(i-n)*s.value/f:i,a),f-=s.value}else e._squarify=o=fW(t,e,n,r,i,a),o.ratio=t}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(hW);function gW(e,t,n){const r={};return e.each(e=>{const i=e.data;n(i)&&(r[t(i)]=e)}),e.lookup=r,e}function vW(e){g_.call(this,null,e)}vW.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const yW=e=>e.values;function bW(){const e=[],t={entries:t=>function t(n,r){if(++r>e.length)return n;const i=[];for(const e in n)i.push({key:e,values:t(n[e],r)});return i}(function t(n,r){if(r>=e.length)return n;const i=n.length,a=e[r++],o={},s={};let l,u,c,d=-1;for(;++d<i;)l=a(u=n[d])+"",(c=o[l])?c.push(u):o[l]=[u];for(l in o)s[l]=t(o[l],r);return s}(t,0),0),key:n=>(e.push(n),t)};return t}function xW(e){g_.call(this,null,e)}hg(vW,g_,{transform(e,t){t.source||sm("Nest transform requires an upstream data source.");var n=e.generate,r=e.modified(),i=t.clone(),a=this.value;return(!a||r||t.changed())&&(a&&a.each(e=>{e.children&&Pw(e.data)&&i.rem.push(e.data)}),this.value=a=EH({values:Ym(e.keys).reduce((e,t)=>(e.key(t),e),bW()).entries(i.source)},yW),n&&a.each(e=>{e.children&&(e=$w(e.data),i.add.push(e),i.source.push(e))}),gW(a,Lw,Lw)),i.source.root=a,i}});const wW=(e,t)=>e.parent===t.parent?1:2;hg(xW,g_,{transform(e,t){t.source&&t.source.root||sm(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),r=this.fields,i=t.source.root,a=e.as||r;e.field?i.sum(e.field):i.count(),e.sort&&i.sort(Ww(e.sort,e=>e.data)),function(e,t,n){for(let r,i=0,a=t.length;i<a;++i)r=t[i],r in n&&e[r](n[r])}(n,this.params,e),n.separation&&n.separation(!1!==e.separation?wW:fm);try{this.value=n(i)}catch(o){sm(o)}return i.each(e=>function(e,t,n){const r=e.data,i=t.length-1;for(let a=0;a<i;++a)r[n[a]]=e[t[a]];r[n[i]]=e.children?e.children.length:0}(e,r,a)),t.reflow(e.modified()).modifies(a).modifies("leaf")}});const _W=["x","y","r","depth","children"];function kW(e){xW.call(this,e)}kW.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:_W.length,default:_W}]},hg(kW,xW,{layout:function(){var e=null,t=1,n=1,r=HH;function i(i){return i.x=t/2,i.y=n/2,e?i.eachBefore(qH(e)).eachAfter(GH(r,.5)).eachBefore(YH(1)):i.eachBefore(qH(VH)).eachAfter(GH(HH,1)).eachAfter(GH(r,i.r/Math.min(t,n))).eachBefore(YH(Math.min(t,n)/(2*i.r))),i}return i.radius=function(t){return arguments.length?(e=zH(t),i):e},i.size=function(e){return arguments.length?(t=+e[0],n=+e[1],i):[t,n]},i.padding=function(e){return arguments.length?(r="function"==typeof e?e:WH(+e),i):r},i},params:["radius","size","padding"],fields:_W});const EW=["x0","y0","x1","y1","depth","children"];function SW(e){xW.call(this,e)}function TW(e){g_.call(this,null,e)}SW.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:EW.length,default:EW}]},hg(SW,xW,{layout:function(){var e=1,t=1,n=0,r=!1;function i(i){var a=i.height+1;return i.x0=i.y0=n,i.x1=e,i.y1=t/a,i.eachBefore(function(e,t){return function(r){r.children&&KH(r,r.x0,e*(r.depth+1)/t,r.x1,e*(r.depth+2)/t);var i=r.x0,a=r.y0,o=r.x1-n,s=r.y1-n;o<i&&(i=o=(i+o)/2),s<a&&(a=s=(a+s)/2),r.x0=i,r.y0=a,r.x1=o,r.y1=s}}(t,a)),r&&i.eachBefore(XH),i}return i.round=function(e){return arguments.length?(r=!!e,i):r},i.size=function(n){return arguments.length?(e=+n[0],t=+n[1],i):[e,t]},i.padding=function(e){return arguments.length?(n=+e,i):n},i},params:["size","round","padding"],fields:EW}),TW.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},hg(TW,g_,{transform(e,t){t.source||sm("Stratify transform requires an upstream data source.");let n=this.value;const r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),a=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return i.source=i.source.slice(),a&&(n=i.source.length?gW(tW().id(e.key).parentId(e.parentKey)(i.source),e.key,pm):gW(tW()([{}]),e.key,e.key)),i.source.root=this.value=n,i}});const CW={tidy:function(){var e=nW,t=1,n=1,r=null;function i(i){var l=function(e){for(var t,n,r,i,a,o=new sW(e,0),s=[o];t=s.pop();)if(r=t._.children)for(t.children=new Array(a=r.length),i=a-1;i>=0;--i)s.push(n=t.children[i]=new sW(r[i],i)),n.parent=t;return(o.parent=new sW(null,0)).children=[o],o}(i);if(l.eachAfter(a),l.parent.m=-l.z,l.eachBefore(o),r)i.eachBefore(s);else{var u=i,c=i,d=i;i.eachBefore((function(e){e.x<u.x&&(u=e),e.x>c.x&&(c=e),e.depth>d.depth&&(d=e)}));var h=u===c?1:e(u,c)/2,f=h-u.x,p=t/(c.x+h+f),m=n/(d.depth||1);i.eachBefore((function(e){e.x=(e.x+f)*p,e.y=e.depth*m}))}return i}function a(t){var n=t.children,r=t.parent.children,i=t.i?r[t.i-1]:null;if(n){!function(e){for(var t,n=0,r=0,i=e.children,a=i.length;--a>=0;)(t=i[a]).z+=n,t.m+=n,n+=t.s+(r+=t.c)}(t);var a=(n[0].z+n[n.length-1].z)/2;i?(t.z=i.z+e(t._,i._),t.m=t.z-a):t.z=a}else i&&(t.z=i.z+e(t._,i._));t.parent.A=function(t,n,r){if(n){for(var i,a=t,o=t,s=n,l=a.parent.children[0],u=a.m,c=o.m,d=s.m,h=l.m;s=iW(s),a=rW(a),s&&a;)l=rW(l),(o=iW(o)).a=t,(i=s.z+d-a.z-u+e(s._,a._))>0&&(aW(oW(s,t,r),t,i),u+=i,c+=i),d+=s.m,u+=a.m,h+=l.m,c+=o.m;s&&!iW(o)&&(o.t=s,o.m+=d-c),a&&!rW(l)&&(l.t=a,l.m+=u-h,r=t)}return r}(t,i,t.parent.A||r[0])}function o(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function s(e){e.x*=t,e.y=e.depth*n}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i},cluster:function(){var e=lW,t=1,n=1,r=!1;function i(i){var a,o=0;i.eachAfter((function(t){var n=t.children;n?(t.x=function(e){return e.reduce(uW,0)/e.length}(n),t.y=function(e){return 1+e.reduce(cW,0)}(n)):(t.x=a?o+=e(t,a):0,t.y=0,a=t)}));var s=function(e){for(var t;t=e.children;)e=t[0];return e}(i),l=function(e){for(var t;t=e.children;)e=t[t.length-1];return e}(i),u=s.x-e(s,l)/2,c=l.x+e(l,s)/2;return i.eachAfter(r?function(e){e.x=(e.x-i.x)*t,e.y=(i.y-e.y)*n}:function(e){e.x=(e.x-u)/(c-u)*t,e.y=(1-(i.y?e.y/i.y:1))*n})}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i}},IW=["x","y","depth","children"];function AW(e){xW.call(this,e)}function OW(e){g_.call(this,[],e)}AW.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:IW.length,default:IW}]},hg(AW,xW,{layout(e){const t=e||"tidy";if(lg(CW,t))return CW[t]();sm("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:IW}),OW.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},hg(OW,g_,{transform(e,t){const n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),a={};return r||sm("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(i.rem=n,t.visit(t.SOURCE,e=>a[Lw(e)]=1),r.each(e=>{const t=e.data,n=e.parent&&e.parent.data;n&&a[Lw(t)]&&a[Lw(n)]&&i.add.push($w({source:n,target:t}))}),this.value=i.add):t.changed(t.MOD)&&(t.visit(t.MOD,e=>a[Lw(e)]=1),n.forEach(e=>{(a[Lw(e.source)]||a[Lw(e.target)])&&i.mod.push(e)})),i}});const DW={binary:function(e,t,n,r,i){var a,o,s=e.children,l=s.length,u=new Array(l+1);for(u[0]=o=a=0;a<l;++a)u[a+1]=o+=s[a].value;!function e(t,n,r,i,a,o,l){if(t>=n-1){var c=s[t];return c.x0=i,c.y0=a,c.x1=o,void(c.y1=l)}for(var d=u[t],h=r/2+d,f=t+1,p=n-1;f<p;){var m=f+p>>>1;u[m]<h?f=m+1:p=m}h-u[f-1]<u[f]-h&&t+1<f&&--f;var g=u[f]-d,v=r-g;if(o-i>l-a){var y=r?(i*v+o*g)/r:o;e(t,f,g,i,a,y,l),e(f,n,v,y,a,o,l)}else{var b=r?(a*v+l*g)/r:l;e(t,f,g,i,a,o,b),e(f,n,v,i,b,o,l)}}(0,l,e.value,t,n,r,i)},dice:KH,slice:dW,slicedice:function(e,t,n,r,i){(1&e.depth?dW:KH)(e,t,n,r,i)},squarify:pW,resquarify:mW},MW=["x0","y0","x1","y1","depth","children"];function NW(e){xW.call(this,e)}function jW(e){const t=Uw(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=.0625,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}NW.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:MW.length,default:MW}]},hg(NW,xW,{layout(){const e=function(){var e=pW,t=!1,n=1,r=1,i=[0],a=HH,o=HH,s=HH,l=HH,u=HH;function c(e){return e.x0=e.y0=0,e.x1=n,e.y1=r,e.eachBefore(d),i=[0],t&&e.eachBefore(XH),e}function d(t){var n=i[t.depth],r=t.x0+n,c=t.y0+n,d=t.x1-n,h=t.y1-n;d<r&&(r=d=(r+d)/2),h<c&&(c=h=(c+h)/2),t.x0=r,t.y0=c,t.x1=d,t.y1=h,t.children&&(n=i[t.depth+1]=a(t)/2,r+=u(t)-n,c+=o(t)-n,(d-=s(t)-n)<r&&(r=d=(r+d)/2),(h-=l(t)-n)<c&&(c=h=(c+h)/2),e(t,r,c,d,h))}return c.round=function(e){return arguments.length?(t=!!e,c):t},c.size=function(e){return arguments.length?(n=+e[0],r=+e[1],c):[n,r]},c.tile=function(t){return arguments.length?(e=UH(t),c):e},c.padding=function(e){return arguments.length?c.paddingInner(e).paddingOuter(e):c.paddingInner()},c.paddingInner=function(e){return arguments.length?(a="function"==typeof e?e:WH(+e),c):a},c.paddingOuter=function(e){return arguments.length?c.paddingTop(e).paddingRight(e).paddingBottom(e).paddingLeft(e):c.paddingTop()},c.paddingTop=function(e){return arguments.length?(o="function"==typeof e?e:WH(+e),c):o},c.paddingRight=function(e){return arguments.length?(s="function"==typeof e?e:WH(+e),c):s},c.paddingBottom=function(e){return arguments.length?(l="function"==typeof e?e:WH(+e),c):l},c.paddingLeft=function(e){return arguments.length?(u="function"==typeof e?e:WH(+e),c):u},c}();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{lg(DW,t)?e.tile(DW[t]):sm("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:MW});const FW=31,RW=new Uint32Array(33),PW=new Uint32Array(33);PW[0]=0,RW[0]=~PW[0];for(let Gqe=1;Gqe<=32;++Gqe)PW[Gqe]=PW[Gqe-1]<<1|1,RW[Gqe]=~PW[Gqe];function LW(e,t,n,r,i,a){let o=n/2;return e-o<0||e+o>i||t-(o=r/2)<0||t+o>a}function BW(e,t,n,r,i,a,o,s){const l=i*a/(2*r),u=e(t-l),c=e(t+l),d=e(n-(a/=2)),h=e(n+a);return o.outOfBounds(u,d,c,h)||o.getRange(u,d,c,h)||s&&s.getRange(u,d,c,h)}const $W=[-1,-1,1,1],zW=[-1,1,-1,1],UW=["right","center","left"],HW=["bottom","middle","top"];function WW(e,t,n,r,i,a,o,s,l,u,c,d){return!(i.outOfBounds(e,n,t,r)||(d&&a?a.getRange(e,n,t,r)||!function(e,t,n,r,i){return i[0]<=e&&n<=i[2]&&i[3]<=t&&r<=i[5]}(o,l,s,u,c):i.getRange(e,n,t,r)))}const VW={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},qW={naive:function(e,t,n,r){const i=e.width,a=e.height;return function(e){const t=e.datum.datum.items[r].items,n=t.length,o=e.datum.fontSize,s=Aj.width(e.datum,e.datum.text);let l,u,c,d,h,f,p,m=0;for(let r=0;r<n;++r)l=t[r].x,c=t[r].y,u=void 0===t[r].x2?l:t[r].x2,d=void 0===t[r].y2?c:t[r].y2,h=(l+u)/2,f=(c+d)/2,p=Math.abs(u-l+d-c),p>=m&&(m=p,e.x=h,e.y=f);return h=s/2,f=o/2,l=e.x-h,u=e.x+h,c=e.y-f,d=e.y+f,e.align="center",l<0&&u<=i?e.align="left":0<=l&&i<u&&(e.align="right"),e.baseline="middle",c<0&&d<=a?e.baseline="top":0<=c&&a<d&&(e.baseline="bottom"),!0}},"reduced-search":function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1];function l(t,n,r,l,u){const c=e.invert(t),d=e.invert(n);let h,f=r,p=a;if(!LW(c,d,l,u,i,a)&&!BW(e,c,d,u,l,f,o,s)&&!BW(e,c,d,u,l,u,o,null)){for(;p-f>=1;)h=(f+p)/2,BW(e,c,d,u,l,h,o,s)?p=h:f=h;if(f>r)return[c,d,f,!0]}}return function(t){const s=t.datum.datum.items[r].items,u=s.length,c=t.datum.fontSize,d=Aj.width(t.datum,t.datum.text);let h,f,p,m,g,v,y,b,x,w,_,k,E,S,T,C,I,A=n?c:0,O=!1,D=!1,M=0;for(let r=0;r<u;++r){for(h=s[r].x,p=s[r].y,f=void 0===s[r].x2?h:s[r].x2,m=void 0===s[r].y2?p:s[r].y2,h>f&&(I=h,h=f,f=I),p>m&&(I=p,p=m,m=I),x=e(h),_=e(f),w=~~((x+_)/2),k=e(p),S=e(m),E=~~((k+S)/2),y=w;y>=x;--y)for(b=E;b>=k;--b)C=l(y,b,A,d,c),C&&([t.x,t.y,A,O]=C);for(y=w;y<=_;++y)for(b=E;b<=S;++b)C=l(y,b,A,d,c),C&&([t.x,t.y,A,O]=C);O||n||(T=Math.abs(f-h+m-p),g=(h+f)/2,v=(p+m)/2,T>=M&&!LW(g,v,d,c,i,a)&&!BW(e,g,v,c,d,c,o,null)&&(M=T,t.x=g,t.y=v,D=!0))}return!(!O&&!D||(g=d/2,v=c/2,o.setRange(e(t.x-g),e(t.y-v),e(t.x+g),e(t.y+v)),t.align="center",t.baseline="middle",0))}},floodfill:function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1],l=e.bitmap();return function(t){const u=t.datum.datum.items[r].items,c=u.length,d=t.datum.fontSize,h=Aj.width(t.datum,t.datum.text),f=[];let p,m,g,v,y,b,x,w,_,k,E,S,T=n?d:0,C=!1,I=!1,A=0;for(let r=0;r<c;++r){for(p=u[r].x,g=u[r].y,m=void 0===u[r].x2?p:u[r].x2,v=void 0===u[r].y2?g:u[r].y2,f.push([e((p+m)/2),e((g+v)/2)]);f.length;)if([x,w]=f.pop(),!(o.get(x,w)||s.get(x,w)||l.get(x,w))){l.set(x,w);for(let e=0;e<4;++e)y=x+$W[e],b=w+zW[e],l.outOfBounds(y,b,y,b)||f.push([y,b]);if(y=e.invert(x),b=e.invert(w),_=T,k=a,!LW(y,b,h,d,i,a)&&!BW(e,y,b,d,h,_,o,s)&&!BW(e,y,b,d,h,d,o,null)){for(;k-_>=1;)E=(_+k)/2,BW(e,y,b,d,h,E,o,s)?k=E:_=E;_>T&&(t.x=y,t.y=b,T=_,C=!0)}}C||n||(S=Math.abs(m-p+v-g),y=(p+m)/2,b=(g+v)/2,S>=A&&!LW(y,b,h,d,i,a)&&!BW(e,y,b,d,h,d,o,null)&&(A=S,t.x=y,t.y=b,I=!0))}return!(!C&&!I||(y=h/2,b=d/2,o.setRange(e(t.x-y),e(t.y-b),e(t.x+y),e(t.y+b)),t.align="center",t.baseline="middle",0))}}};const GW=["x","y","opacity","align","baseline"],YW=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function XW(e){g_.call(this,null,e)}function KW(e,t){var n,r,i,a,o,s,l=[],u=function(e){return e(a)};if(null==t)l.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(s=n[o=t.map(u)])||(n[o]=s=[],s.dims=o,l.push(s)),s.push(a);return l}function ZW(e){g_.call(this,null,e)}XW.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:YW},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:GW.length,default:GW}]},hg(XW,g_,{transform(e,t){const n=e.modified();if(!(n||t.changed(t.ADD_REM)||function(n){const r=e.sort;return Km(r)&&t.modified(r.fields)}()))return;e.size&&2===e.size.length||sm("Size parameter should be specified as a [width, height] array.");const r=e.as||GW;return function(e,t,n,r,i,a,o,s,l,u,c){if(!e.length)return e;const d=Math.max(r.length,i.length),h=function(e,t){const n=new Float64Array(t),r=e.length;for(let i=0;i<r;++i)n[i]=e[i]||0;for(let i=r;i<t;++i)n[i]=n[r-1];return n}(r,d),f=function(e,t){const n=new Int8Array(t),r=e.length;for(let i=0;i<r;++i)n[i]|=VW[e[i]];for(let i=r;i<t;++i)n[i]=n[r-1];return n}(i,d),p=(x=e[0].datum)&&x.mark&&x.mark.marktype,m="group"===p&&e[0].datum.items[l].marktype,g="area"===m,v=function(e,t,n,r){const i=e=>[e.x,e.x,e.x,e.y,e.y,e.y];return e?"line"===e||"area"===e?e=>i(e.datum):"line"===t?e=>{const t=e.datum.items[r].items;return i(t.length?t["start"===n?0:t.length-1]:{x:NaN,y:NaN})}:e=>{const t=e.datum.bounds;return[t.x1,(t.x1+t.x2)/2,t.x2,t.y1,(t.y1+t.y2)/2,t.y2]}:i}(p,m,s,l),y=function(e,t,n){const r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),a=~~((t+2*n+r)/r),o=e=>~~((e+n)/r);return o.invert=e=>e*r-n,o.bitmap=()=>function(e,t){const n=new Uint32Array(~~((e*t+32)/32));function r(e,t){n[e]|=t}function i(e,t){n[e]&=t}return{array:n,get:(t,r)=>{const i=r*e+t;return n[i>>>5]&1<<(i&FW)},set:(t,n)=>{const i=n*e+t;r(i>>>5,1<<(i&FW))},clear:(t,n)=>{const r=n*e+t;i(r>>>5,~(1<<(r&FW)))},getRange:(t,r,i,a)=>{let o,s,l,u,c=a;for(;c>=r;--c)if(o=c*e+t,s=c*e+i,l=o>>>5,u=s>>>5,l===u){if(n[l]&RW[o&FW]&PW[1+(s&FW)])return!0}else{if(n[l]&RW[o&FW])return!0;if(n[u]&PW[1+(s&FW)])return!0;for(let e=l+1;e<u;++e)if(n[e])return!0}return!1},setRange:(t,n,i,a)=>{let o,s,l,u,c;for(;n<=a;++n)if(o=n*e+t,s=n*e+i,l=o>>>5,u=s>>>5,l===u)r(l,RW[o&FW]&PW[1+(s&FW)]);else for(r(l,RW[o&FW]),r(u,PW[1+(s&FW)]),c=l+1;c<u;++c)r(c,4294967295)},clearRange:(t,n,r,a)=>{let o,s,l,u,c;for(;n<=a;++n)if(o=n*e+t,s=n*e+r,l=o>>>5,u=s>>>5,l===u)i(l,PW[o&FW]|RW[1+(s&FW)]);else for(i(l,PW[o&FW]),i(u,RW[1+(s&FW)]),c=l+1;c<u;++c)i(c,0)},outOfBounds:(n,r,i,a)=>n<0||r<0||a>=t||i>=e}}(i,a),o.ratio=r,o.padding=n,o.width=e,o.height=t,o}(t[0],t[1],u),b=g&&"naive"===c;var x;const w=e.map(e=>({datum:e,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:v(e)}));let _;if(!b){n&&w.sort((e,t)=>n(e.datum,t.datum));let t=!1;for(let e=0;e<f.length&&!t;++e)t=5===f[e]||h[e]<0;p&&(o||g)&&(a=[e.map(e=>e.datum)].concat(a)),_=a.length?function(e,t,n,r){const i=e.width,a=e.height,o=n||r,s=aT(i,a).getContext("2d");t.forEach(e=>function e(t,n,r){if(!n.length)return;const i=n[0].mark.marktype;"group"===i?n.forEach(n=>{n.items.forEach(n=>e(t,n.items,r))}):Gj[i].draw(t,{items:r?n.map(jW):n})}(s,e,o));const l=new Uint32Array(s.getImageData(0,0,i,a).data.buffer),u=e.bitmap(),c=o&&e.bitmap();let d,h,f,p,m;for(h=0;h<a;++h)for(d=0;d<i;++d)m=4278190080&l[h*i+d],m&&(f=e(d),p=e(h),r||u.set(f,p),o&&268435456^m&&c.set(f,p));return[u,c]}(y,a,t,g):function(e,t){const n=e.bitmap();return(t||[]).forEach(t=>n.set(e(t.boundary[0]),e(t.boundary[3]))),[n,void 0]}(y,o&&w)}const k=g?qW[c](y,_,o,l):function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1],l=r.length;return function(t){const u=t.boundary,c=t.datum.fontSize;if(u[2]<0||u[5]<0||u[0]>i||u[3]>a)return!1;let d,h,f,p,m,g,v,y,b,x,w,_,k,E,S,T=0;for(let i=0;i<l;++i){if(d=(3&n[i])-1,h=(n[i]>>>2&3)-1,f=0===d&&0===h||r[i]<0,p=d&&h?Math.SQRT1_2:1,m=r[i]<0?-1:1,g=u[1+d]+r[i]*d*p,w=u[4+h]+m*c*h/2+r[i]*h*p,y=w-c/2,b=w+c/2,_=e(g),E=e(y),S=e(b),!T){if(!WW(_,_,E,S,o,s,g,g,y,b,u,f))continue;T=Aj.width(t.datum,t.datum.text)}if(x=g+m*T*d/2,g=x-T/2,v=x+T/2,_=e(g),k=e(v),WW(_,k,E,S,o,s,g,v,y,b,u,f))return t.x=d?d*m<0?v:g:x,t.y=h?h*m<0?b:y:w,t.align=UW[d*m+1],t.baseline=HW[h*m+1],o.setRange(_,E,k,S),!0}return!1}}(y,_,f,h);return w.forEach(e=>e.opacity=+k(e)),w}(t.materialize(t.SOURCE).source,e.size,e.sort,Ym(e.offset||1),Ym(e.anchor||YW),e.avoidMarks||[],!1!==e.avoidBaseMark,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach(e=>{const t=e.datum;t[r[0]]=e.x,t[r[1]]=e.y,t[r[2]]=e.opacity,t[r[3]]=e.align,t[r[4]]=e.baseline}),t.reflow(n).modifies(r)}}),ZW.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},hg(ZW,g_,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=KW(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(nm),a=i.length,o=e.as||[nm(e.x),nm(e.y)],s=[];r.forEach(t=>{mk(t,e.x,e.y,e.bandwidth||.3).forEach(e=>{const n={};for(let r=0;r<a;++r)n[i[r]]=t.dims[r];n[o[0]]=e[0],n[o[1]]=e[1],s.push($w(n))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=s}return n}});const JW={linear:lk,log:uk,exp:ck,pow:dk,quad:hk,poly:fk};function QW(e){g_.call(this,null,e)}QW.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(JW)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},hg(QW,g_,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=KW(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(nm),a=e.method||"linear",o=e.order||3,s=((e,t)=>"poly"===e?t:"quad"===e?2:1)(a,o),l=e.as||[nm(e.x),nm(e.y)],u=JW[a],c=[];let d=e.extent;lg(JW,a)||sm("Invalid regression method: "+a),null!=d&&"log"===a&&d[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null),r.forEach(n=>{if(n.length<=s)return void t.dataflow.warn("Skipping regression with more parameters than data points.");const r=u(n,e.x,e.y,o);if(e.params)return void c.push($w({keys:n.dims,coef:r.coef,rSquared:r.rSquared}));const h=d||ag(n,e.x),f=e=>{const t={};for(let r=0;r<i.length;++r)t[i[r]]=n.dims[r];t[l[0]]=e[0],t[l[1]]=e[1],c.push($w(t))};"linear"===a?h.forEach(e=>f([e,r.predict(e)])):bk(r.predict,h,25,200).forEach(f)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}});const eV=Math.pow(2,-52),tV=new Uint32Array(512);class nV{static from(e,t=cV,n=dV){const r=e.length,i=new Float64Array(2*r);for(let a=0;a<r;a++){const r=e[a];i[2*a]=t(r),i[2*a+1]=n(r)}return new nV(i)}constructor(e){const t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:r,_hullHash:i}=this,a=e.length>>1;let o=1/0,s=1/0,l=-1/0,u=-1/0;for(let S=0;S<a;S++){const t=e[2*S],n=e[2*S+1];t<o&&(o=t),n<s&&(s=n),t>l&&(l=t),n>u&&(u=n),this._ids[S]=S}const c=(o+l)/2,d=(s+u)/2;let h,f,p,m=1/0;for(let S=0;S<a;S++){const t=rV(c,d,e[2*S],e[2*S+1]);t<m&&(h=S,m=t)}const g=e[2*h],v=e[2*h+1];m=1/0;for(let S=0;S<a;S++){if(S===h)continue;const t=rV(g,v,e[2*S],e[2*S+1]);t<m&&t>0&&(f=S,m=t)}let y=e[2*f],b=e[2*f+1],x=1/0;for(let S=0;S<a;S++){if(S===h||S===f)continue;const t=sV(g,v,y,b,e[2*S],e[2*S+1]);t<x&&(p=S,x=t)}let w=e[2*p],_=e[2*p+1];if(x===1/0){for(let r=0;r<a;r++)this._dists[r]=e[2*r]-e[0]||e[2*r+1]-e[1];lV(this._ids,this._dists,0,a-1);const t=new Uint32Array(a);let n=0;for(let e=0,r=-1/0;e<a;e++){const i=this._ids[e];this._dists[i]>r&&(t[n++]=i,r=this._dists[i])}return this.hull=t.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(aV(g,v,y,b,w,_)){const e=f,t=y,n=b;f=p,y=w,b=_,p=e,w=t,_=n}const k=function(e,t,n,r,i,a){const o=n-e,s=r-t,l=i-e,u=a-t,c=o*o+s*s,d=l*l+u*u,h=.5/(o*u-s*l);return{x:e+(u*c-s*d)*h,y:t+(o*d-l*c)*h}}(g,v,y,b,w,_);this._cx=k.x,this._cy=k.y;for(let S=0;S<a;S++)this._dists[S]=rV(e[2*S],e[2*S+1],k.x,k.y);lV(this._ids,this._dists,0,a-1),this._hullStart=h;let E=3;n[h]=t[p]=f,n[f]=t[h]=p,n[p]=t[f]=h,r[h]=0,r[f]=1,r[p]=2,i.fill(-1),i[this._hashKey(g,v)]=h,i[this._hashKey(y,b)]=f,i[this._hashKey(w,_)]=p,this.trianglesLen=0,this._addTriangle(h,f,p,-1,-1,-1);for(let S,T,C=0;C<this._ids.length;C++){const a=this._ids[C],o=e[2*a],s=e[2*a+1];if(C>0&&Math.abs(o-S)<=eV&&Math.abs(s-T)<=eV)continue;if(S=o,T=s,a===h||a===f||a===p)continue;let l=0;for(let e=0,t=this._hashKey(o,s);e<this._hashSize&&(l=i[(t+e)%this._hashSize],-1===l||l===n[l]);e++);l=t[l];let u,c=l;for(;u=n[c],!aV(o,s,e[2*c],e[2*c+1],e[2*u],e[2*u+1]);)if(c=u,c===l){c=-1;break}if(-1===c)continue;let d=this._addTriangle(c,a,n[c],-1,-1,r[c]);r[a]=this._legalize(d+2),r[c]=d,E++;let m=n[c];for(;u=n[m],aV(o,s,e[2*m],e[2*m+1],e[2*u],e[2*u+1]);)d=this._addTriangle(m,a,u,r[a],-1,r[m]),r[a]=this._legalize(d+2),n[m]=m,E--,m=u;if(c===l)for(;u=t[c],aV(o,s,e[2*u],e[2*u+1],e[2*c],e[2*c+1]);)d=this._addTriangle(u,a,c,-1,r[c],r[u]),this._legalize(d+2),r[u]=d,n[c]=c,E--,c=u;this._hullStart=t[a]=c,n[c]=t[m]=a,n[a]=m,i[this._hashKey(o,s)]=a,i[this._hashKey(e[2*c],e[2*c+1])]=c}this.hull=new Uint32Array(E);for(let S=0,T=this._hullStart;S<E;S++)this.hull[S]=T,T=n[T];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:r}=this;let i=0,a=0;for(;;){const o=n[e],s=e-e%3;if(a=s+(e+2)%3,-1===o){if(0===i)break;e=tV[--i];continue}const l=o-o%3,u=l+(o+2)%3,c=t[a],d=t[e],h=t[s+(e+1)%3],f=t[u];if(oV(r[2*c],r[2*c+1],r[2*d],r[2*d+1],r[2*h],r[2*h+1],r[2*f],r[2*f+1])){t[e]=f,t[o]=c;const r=n[u];if(-1===r){let t=this._hullStart;do{if(this._hullTri[t]===u){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,r),this._link(o,n[a]),this._link(a,u);const s=l+(o+1)%3;i<tV.length&&(tV[i++]=s)}else{if(0===i)break;e=tV[--i]}}return a}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,n,r,i,a){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,r),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o}}function rV(e,t,n,r){const i=e-n,a=t-r;return i*i+a*a}function iV(e,t,n,r,i,a){const o=(r-t)*(i-e),s=(n-e)*(a-t);return Math.abs(o-s)>=33306690738754716e-32*Math.abs(o+s)?o-s:0}function aV(e,t,n,r,i,a){return(iV(i,a,e,t,n,r)||iV(e,t,n,r,i,a)||iV(n,r,i,a,e,t))<0}function oV(e,t,n,r,i,a,o,s){const l=e-o,u=t-s,c=n-o,d=r-s,h=i-o,f=a-s,p=c*c+d*d,m=h*h+f*f;return l*(d*m-p*f)-u*(c*m-p*h)+(l*l+u*u)*(c*f-d*h)<0}function sV(e,t,n,r,i,a){const o=n-e,s=r-t,l=i-e,u=a-t,c=o*o+s*s,d=l*l+u*u,h=.5/(o*u-s*l),f=(u*c-s*d)*h,p=(o*d-l*c)*h;return f*f+p*p}function lV(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const r=e[i],a=t[r];let o=i-1;for(;o>=n&&t[e[o]]>a;)e[o+1]=e[o--];e[o+1]=r}else{let i=n+1,a=r;uV(e,n+r>>1,i),t[e[n]]>t[e[r]]&&uV(e,n,r),t[e[i]]>t[e[r]]&&uV(e,i,r),t[e[n]]>t[e[i]]&&uV(e,n,i);const o=e[i],s=t[o];for(;;){do{i++}while(t[e[i]]<s);do{a--}while(t[e[a]]>s);if(a<i)break;uV(e,i,a)}e[n+1]=e[a],e[a]=o,r-i+1>=a-n?(lV(e,t,i,r),lV(e,t,n,a-1)):(lV(e,t,n,a-1),lV(e,t,i,r))}}function uV(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function cV(e){return e[0]}function dV(e){return e[1]}const hV=1e-6;class fV{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){const r=(e=+e)+(n=+n),i=t=+t;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${r},${i}`:(Math.abs(this._x1-r)>hV||Math.abs(this._y1-i)>hV)&&(this._+="L"+r+","+i),n&&(this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=r},${this._y1=i}`)}rect(e,t,n,r){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+r}h${-n}Z`}value(){return this._||null}}class pV{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class mV{constructor(e,[t,n,r,i]=[0,0,960,500]){if(!((r=+r)>=(t=+t)&&(i=+i)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(2*e.points.length),this.vectors=new Float64Array(2*e.points.length),this.xmax=r,this.xmin=t,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:n},vectors:r}=this,i=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let h,f,p=0,m=0,g=n.length;p<g;p+=3,m+=2){const t=2*n[p],r=2*n[p+1],a=2*n[p+2],o=e[t],s=e[t+1],l=e[a],u=e[a+1],c=e[r]-o,d=e[r+1]-s,g=l-o,v=u-s,y=c*c+d*d,b=g*g+v*v,x=2*(c*v-d*g);if(x)if(Math.abs(x)<1e-8)h=(o+l)/2,f=(s+u)/2;else{const e=1/x;h=o+(v*y-d*b)*e,f=s+(c*b-g*y)*e}else h=(o+l)/2-1e8*v,f=(s+u)/2+1e8*g;i[m]=h,i[m+1]=f}let a,o,s,l=t[t.length-1],u=4*l,c=e[2*l],d=e[2*l+1];r.fill(0);for(let h=0;h<t.length;++h)l=t[h],a=u,o=c,s=d,u=4*l,c=e[2*l],d=e[2*l+1],r[a+2]=r[u]=s-d,r[a+3]=r[u+1]=c-o}render(e){const t=null==e?e=new fV:void 0,{delaunay:{halfedges:n,inedges:r,hull:i},circumcenters:a,vectors:o}=this;if(i.length<=1)return null;for(let u=0,c=n.length;u<c;++u){const t=n[u];if(t<u)continue;const r=2*Math.floor(u/3),i=2*Math.floor(t/3);this._renderSegment(a[r],a[r+1],a[i],a[i+1],e)}let s,l=i[i.length-1];for(let u=0;u<i.length;++u){s=l,l=i[u];const t=2*Math.floor(r[l]/3),n=a[t],c=a[t+1],d=4*s,h=this._project(n,c,o[d+2],o[d+3]);h&&this._renderSegment(n,c,h[0],h[1],e)}return t&&t.value()}renderBounds(e){const t=null==e?e=new fV:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const n=null==t?t=new fV:void 0,r=this._clip(e);if(null===r||!r.length)return;t.moveTo(r[0],r[1]);let i=r.length;for(;r[0]===r[i-2]&&r[1]===r[i-1]&&i>1;)i-=2;for(let a=2;a<i;a+=2)r[a]===r[a-2]&&r[a+1]===r[a-1]||t.lineTo(r[a],r[a+1]);return t.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){const e=this.cellPolygon(t);e&&(e.index=t,yield e)}}cellPolygon(e){const t=new pV;return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,r,i){let a;const o=this._regioncode(e,t),s=this._regioncode(n,r);0===o&&0===s?(i.moveTo(e,t),i.lineTo(n,r)):(a=this._clipSegment(e,t,n,r,o,s))&&(i.moveTo(a[0],a[1]),i.lineTo(a[2],a[3]))}contains(e,t,n){return(t=+t)==t&&(n=+n)==n&&this.delaunay._step(e,t,n)===e}*neighbors(e){const t=this._clip(e);if(t)for(const n of this.delaunay.neighbors(e)){const e=this._clip(n);if(e)e:for(let r=0,i=t.length;r<i;r+=2)for(let a=0,o=e.length;a<o;a+=2)if(t[r]==e[a]&&t[r+1]==e[a+1]&&t[(r+2)%i]==e[(a+o-2)%o]&&t[(r+3)%i]==e[(a+o-1)%o]){yield n;break e}}}_cell(e){const{circumcenters:t,delaunay:{inedges:n,halfedges:r,triangles:i}}=this,a=n[e];if(-1===a)return null;const o=[];let s=a;do{const n=Math.floor(s/3);if(o.push(t[2*n],t[2*n+1]),s=s%3==2?s-2:s+1,i[s]!==e)break;s=r[s]}while(s!==a&&-1!==s);return o}_clip(e){if(0===e&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(null===t)return null;const{vectors:n}=this,r=4*e;return n[r]||n[r+1]?this._clipInfinite(e,t,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(e,t)}_clipFinite(e,t){const n=t.length;let r,i,a,o,s,l=null,u=t[n-2],c=t[n-1],d=this._regioncode(u,c);for(let h=0;h<n;h+=2)if(r=u,i=c,u=t[h],c=t[h+1],a=d,d=this._regioncode(u,c),0===a&&0===d)o=s,s=0,l?l.push(u,c):l=[u,c];else{let t,n,h,f,p;if(0===a){if(null===(t=this._clipSegment(r,i,u,c,a,d)))continue;[n,h,f,p]=t}else{if(null===(t=this._clipSegment(u,c,r,i,d,a)))continue;[f,p,n,h]=t,o=s,s=this._edgecode(n,h),o&&s&&this._edge(e,o,s,l,l.length),l?l.push(n,h):l=[n,h]}o=s,s=this._edgecode(f,p),o&&s&&this._edge(e,o,s,l,l.length),l?l.push(f,p):l=[f,p]}if(l)o=s,s=this._edgecode(l[0],l[1]),o&&s&&this._edge(e,o,s,l,l.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return l}_clipSegment(e,t,n,r,i,a){for(;;){if(0===i&&0===a)return[e,t,n,r];if(i&a)return null;let o,s,l=i||a;8&l?(o=e+(n-e)*(this.ymax-t)/(r-t),s=this.ymax):4&l?(o=e+(n-e)*(this.ymin-t)/(r-t),s=this.ymin):2&l?(s=t+(r-t)*(this.xmax-e)/(n-e),o=this.xmax):(s=t+(r-t)*(this.xmin-e)/(n-e),o=this.xmin),i?i=this._regioncode(e=o,t=s):a=this._regioncode(n=o,r=s)}}_clipInfinite(e,t,n,r,i,a){let o,s=Array.from(t);if((o=this._project(s[0],s[1],n,r))&&s.unshift(o[0],o[1]),(o=this._project(s[s.length-2],s[s.length-1],i,a))&&s.push(o[0],o[1]),s=this._clipFinite(e,s))for(let l,u=0,c=s.length,d=this._edgecode(s[c-2],s[c-1]);u<c;u+=2)l=d,d=this._edgecode(s[u],s[u+1]),l&&d&&(u=this._edge(e,l,d,s,u),c=s.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(s=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return s}_edge(e,t,n,r,i){for(;t!==n;){let n,a;switch(t){case 5:t=4;continue;case 4:t=6,n=this.xmax,a=this.ymin;break;case 6:t=2;continue;case 2:t=10,n=this.xmax,a=this.ymax;break;case 10:t=8;continue;case 8:t=9,n=this.xmin,a=this.ymax;break;case 9:t=1;continue;case 1:t=5,n=this.xmin,a=this.ymin}r[i]===n&&r[i+1]===a||!this.contains(e,n,a)||(r.splice(i,0,n,a),i+=2)}if(r.length>4)for(let a=0;a<r.length;a+=2){const e=(a+2)%r.length,t=(a+4)%r.length;(r[a]===r[e]&&r[e]===r[t]||r[a+1]===r[e+1]&&r[e+1]===r[t+1])&&(r.splice(e,2),a-=2)}return i}_project(e,t,n,r){let i,a,o,s=1/0;if(r<0){if(t<=this.ymin)return null;(i=(this.ymin-t)/r)<s&&(o=this.ymin,a=e+(s=i)*n)}else if(r>0){if(t>=this.ymax)return null;(i=(this.ymax-t)/r)<s&&(o=this.ymax,a=e+(s=i)*n)}if(n>0){if(e>=this.xmax)return null;(i=(this.xmax-e)/n)<s&&(a=this.xmax,o=t+(s=i)*r)}else if(n<0){if(e<=this.xmin)return null;(i=(this.xmin-e)/n)<s&&(a=this.xmin,o=t+(s=i)*r)}return[a,o]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}}const gV=2*Math.PI,vV=Math.pow;function yV(e){return e[0]}function bV(e){return e[1]}function xV(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class wV{static from(e,t=yV,n=bV,r){return new wV("length"in e?function(e,t,n,r){const i=e.length,a=new Float64Array(2*i);for(let o=0;o<i;++o){const i=e[o];a[2*o]=t.call(r,i,o,e),a[2*o+1]=n.call(r,i,o,e)}return a}(e,t,n,r):Float64Array.from(function*(e,t,n,r){let i=0;for(const a of e)yield t.call(r,a,i,e),yield n.call(r,a,i,e),++i}(e,t,n,r)))}constructor(e){this._delaunator=new nV(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&function(e){const{triangles:t,coords:n}=e;for(let r=0;r<t.length;r+=3){const e=2*t[r],i=2*t[r+1],a=2*t[r+2];if((n[a]-n[e])*(n[i+1]-n[e+1])-(n[i]-n[e])*(n[a+1]-n[e+1])>1e-10)return!1}return!0}(e)){this.collinear=Int32Array.from({length:t.length/2},(e,t)=>t).sort((e,n)=>t[2*e]-t[2*n]||t[2*e+1]-t[2*n+1]);const e=this.collinear[0],n=this.collinear[this.collinear.length-1],r=[t[2*e],t[2*e+1],t[2*n],t[2*n+1]],i=1e-8*Math.hypot(r[3]-r[1],r[2]-r[0]);for(let a=0,o=t.length/2;a<o;++a){const e=xV(t[2*a],t[2*a+1],i);t[2*a]=e[0],t[2*a+1]=e[1]}this._delaunator=new nV(t)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let s=0,l=n.length;s<l;++s){const e=i[s%3==2?s-2:s+1];-1!==n[s]&&-1!==a[e]||(a[e]=s)}for(let s=0,l=r.length;s<l;++s)o[r[s]]=s;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],this.triangles[1]=r[1],this.triangles[2]=r[1],a[r[0]]=1,2===r.length&&(a[r[1]]=0))}voronoi(e){return new mV(this,e)}*neighbors(e){const{inedges:t,hull:n,_hullIndex:r,halfedges:i,triangles:a,collinear:o}=this;if(o){const t=o.indexOf(e);return t>0&&(yield o[t-1]),void(t<o.length-1&&(yield o[t+1]))}const s=t[e];if(-1===s)return;let l=s,u=-1;do{if(yield u=a[l],l=l%3==2?l-2:l+1,a[l]!==e)return;if(l=i[l],-1===l){const t=n[(r[e]+1)%n.length];return void(t!==u&&(yield t))}}while(l!==s)}find(e,t,n=0){if((e=+e)!=e||(t=+t)!=t)return-1;const r=n;let i;for(;(i=this._step(n,e,t))>=0&&i!==n&&i!==r;)n=i;return i}_step(e,t,n){const{inedges:r,hull:i,_hullIndex:a,halfedges:o,triangles:s,points:l}=this;if(-1===r[e]||!l.length)return(e+1)%(l.length>>1);let u=e,c=vV(t-l[2*e],2)+vV(n-l[2*e+1],2);const d=r[e];let h=d;do{let r=s[h];const d=vV(t-l[2*r],2)+vV(n-l[2*r+1],2);if(d<c&&(c=d,u=r),h=h%3==2?h-2:h+1,s[h]!==e)break;if(h=o[h],-1===h){if(h=i[(a[e]+1)%i.length],h!==r&&vV(t-l[2*h],2)+vV(n-l[2*h+1],2)<c)return h;break}}while(h!==d);return u}render(e){const t=null==e?e=new fV:void 0,{points:n,halfedges:r,triangles:i}=this;for(let a=0,o=r.length;a<o;++a){const t=r[a];if(t<a)continue;const o=2*i[a],s=2*i[t];e.moveTo(n[o],n[o+1]),e.lineTo(n[s],n[s+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t=2){const n=null==e?e=new fV:void 0,{points:r}=this;for(let i=0,a=r.length;i<a;i+=2){const n=r[i],a=r[i+1];e.moveTo(n+t,a),e.arc(n,a,t,0,gV)}return n&&n.value()}renderHull(e){const t=null==e?e=new fV:void 0,{hull:n,points:r}=this,i=2*n[0],a=n.length;e.moveTo(r[i],r[i+1]);for(let o=1;o<a;++o){const t=2*n[o];e.lineTo(r[t],r[t+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new pV;return this.renderHull(e),e.value()}renderTriangle(e,t){const n=null==t?t=new fV:void 0,{points:r,triangles:i}=this,a=2*i[e*=3],o=2*i[e+1],s=2*i[e+2];return t.moveTo(r[a],r[a+1]),t.lineTo(r[o],r[o+1]),t.lineTo(r[s],r[s+1]),t.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new pV;return this.renderTriangle(e,t),t.value()}}function _V(e){g_.call(this,null,e)}_V.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const kV=[-1e5,-1e5,1e5,1e5];function EV(e){const t=e[0][0],n=e[0][1];let r=e.length-1;for(;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}hg(_V,g_,{transform(e,t){const n=e.as||"path",r=t.source;if(!r||!r.length)return t;let i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:kV;const a=this.value=wV.from(r,e.x,e.y).voronoi(i);for(let o=0,s=r.length;o<s;++o){const e=a.cellPolygon(o);r[o][n]=e?EV(e):null}return t.reflow(e.modified()).modifies(n)}});var SV=Math.PI/180,TV=2048;function CV(e,t,n,r){if(!t.sprite){var i=e.context,a=e.ratio;i.clearRect(0,0,2048/a,TV/a);var o,s,l,u,c,d=0,h=0,f=0,p=n.length;for(--r;++r<p;){if(t=n[r],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font,o=i.measureText(t.text+"m").width*a,l=t.size<<1,t.rotate){var m=Math.sin(t.rotate*SV),g=Math.cos(t.rotate*SV),v=o*g,y=o*m,b=l*g,x=l*m;o=Math.max(Math.abs(v+x),Math.abs(v-x))+31>>5<<5,l=~~Math.max(Math.abs(y+b),Math.abs(y-b))}else o=o+31>>5<<5;if(l>f&&(f=l),d+o>=2048&&(d=0,h+=f,f=0),h+l>=TV)break;i.translate((d+(o>>1))/a,(h+(l>>1))/a),t.rotate&&i.rotate(t.rotate*SV),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=o,t.height=l,t.xoff=d,t.yoff=h,t.x1=o>>1,t.y1=l>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,d+=o}for(var w=i.getImageData(0,0,2048/a,TV/a).data,_=[];--r>=0;)if((t=n[r]).hasText){for(s=(o=t.width)>>5,l=t.y1-t.y0,u=0;u<l*s;u++)_[u]=0;if(null==(d=t.xoff))return;h=t.yoff;var k=0,E=-1;for(c=0;c<l;c++){for(u=0;u<o;u++){var S=w[2048*(h+c)+(d+u)<<2]?1<<31-u%32:0;_[s*c+(u>>5)]|=S,k|=S}k?E=c:(t.y0++,l--,c--,h++)}t.y1=t.y0+E,t.sprite=_.slice(0,(t.y1-t.y0)*s)}}}function IV(e,t,n){for(var r,i=e.sprite,a=e.width>>5,o=e.x-(a<<4),s=127&o,l=32-s,u=e.y1-e.y0,c=(e.y+e.y0)*(n>>=5)+(o>>5),d=0;d<u;d++){r=0;for(var h=0;h<=a;h++)if((r<<l|(h<a?(r=i[d*a+h])>>>s:0))&t[c+h])return!0;c+=n}return!1}function AV(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function OV(e){var t=e[0]/e[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function DV(e){return"function"==typeof e?e:function(){return e}}var MV={archimedean:OV,rectangular:function(e){var t=4*e[0]/e[1],n=0,r=0;return function(e){var i=e<0?-1:1;switch(Math.sqrt(1+4*i*e)-i&3){case 0:n+=t;break;case 1:r+=4;break;case 2:n-=t;break;default:r-=4}return[n,r]}}};const NV=["x","y","font","fontSize","fontStyle","fontWeight","angle"],jV=["text","font","rotate","fontSize","fontStyle","fontWeight"];function FV(e){g_.call(this,function(){var e,t,n,r,i,a,o,s=[256,256],l=OV,u=[],c=Math.random,d={};function h(e,t,n){for(var r,i,a,o,u,d=t.x,h=t.y,f=Math.sqrt(s[0]*s[0]+s[1]*s[1]),p=l(s),m=c()<.5?1:-1,g=-m;(r=p(g+=m))&&(i=~~r[0],a=~~r[1],!(Math.min(Math.abs(i),Math.abs(a))>=f));)if(t.x=d+i,t.y=h+a,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>s[0]||t.y+t.y1>s[1]||n&&IV(t,e,s[0])||n&&!((o=t).x+o.x1>(u=n)[0].x&&o.x+o.x0<u[1].x&&o.y+o.y1>u[0].y&&o.y+o.y0<u[1].y))){for(var v,y=t.sprite,b=t.width>>5,x=s[0]>>5,w=t.x-(b<<4),_=127&w,k=32-_,E=t.y1-t.y0,S=(t.y+t.y0)*x+(w>>5),T=0;T<E;T++){v=0;for(var C=0;C<=b;C++)e[S+C]|=v<<k|(C<b?(v=y[T*b+C])>>>_:0);S+=x}return t.sprite=null,!0}return!1}return d.layout=function(){for(var l=function(e){e.width=e.height=1;var t=Math.sqrt(e.getContext("2d").getImageData(0,0,1,1).data.length>>2);e.width=2048/t,e.height=TV/t;var n=e.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:t}}(aT()),d=function(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}((s[0]>>5)*s[1]),f=null,p=u.length,m=-1,g=[],v=u.map(s=>({text:e(s),font:t(s),style:r(s),weight:i(s),rotate:a(s),size:~~(n(s)+1e-14),padding:o(s),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:s})).sort((e,t)=>t.size-e.size);++m<p;){var y=v[m];y.x=s[0]*(c()+.5)>>1,y.y=s[1]*(c()+.5)>>1,CV(l,y,v,m),y.hasText&&h(d,y,f)&&(g.push(y),f?AV(f,y):f=[{x:y.x+y.x0,y:y.y+y.y0},{x:y.x+y.x1,y:y.y+y.y1}],y.x-=s[0]>>1,y.y-=s[1]>>1)}return g},d.words=function(e){return arguments.length?(u=e,d):u},d.size=function(e){return arguments.length?(s=[+e[0],+e[1]],d):s},d.font=function(e){return arguments.length?(t=DV(e),d):t},d.fontStyle=function(e){return arguments.length?(r=DV(e),d):r},d.fontWeight=function(e){return arguments.length?(i=DV(e),d):i},d.rotate=function(e){return arguments.length?(a=DV(e),d):a},d.text=function(t){return arguments.length?(e=DV(t),d):e},d.spiral=function(e){return arguments.length?(l=MV[e]||e,d):l},d.fontSize=function(e){return arguments.length?(n=DV(e),d):n},d.padding=function(e){return arguments.length?(o=DV(e),d):o},d.random=function(e){return arguments.length?(c=e,d):c},d}(),e)}FV.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:NV}]},hg(FV,g_,{transform(e,t){!e.size||e.size[0]&&e.size[1]||sm("Wordcloud size dimensions must be non-zero.");const n=e.modified();if(!(n||t.changed(t.ADD_REM)||jV.some((function(n){const r=e[n];return Km(r)&&t.modified(r.fields)}))))return;const r=t.materialize(t.SOURCE).source,i=this.value,a=e.as||NV;let o,s=e.fontSize||14;if(Km(s)?o=e.fontSizeRange:s=ng(s),o){const e=s,t=vD("sqrt")().domain(ag(r,e)).range(o);s=n=>t(e(n))}r.forEach(e=>{e[a[0]]=NaN,e[a[1]]=NaN,e[a[3]]=0});const l=i.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(s).random(M_).layout(),u=i.size(),c=u[0]>>1,d=u[1]>>1,h=l.length;for(let f,p,m=0;m<h;++m)f=l[m],p=f.datum,p[a[0]]=f.x+c,p[a[1]]=f.y+d,p[a[2]]=f.font,p[a[3]]=f.size,p[a[4]]=f.style,p[a[5]]=f.weight,p[a[6]]=f.rotate;return t.reflow(n).modifies(a)}});const RV=e=>new Uint8Array(e),PV=e=>new Uint16Array(e),LV=e=>new Uint32Array(e);function BV(e,t,n){const r=(t<257?RV:t<65537?PV:LV)(e);return n&&r.set(n),r}function $V(e,t,n){const r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(e,t){const n=this,i=n.bisect(n.range,e.value),a=e.index,o=i[0],s=i[1],l=a.length;let u;for(u=0;u<o;++u)t[a[u]]|=r;for(u=s;u<l;++u)t[a[u]]|=r;return n}}}function zV(){let e=LV(0),t=[],n=0;return{insert:function(r,i,a){if(!i.length)return[];const o=n,s=i.length,l=LV(s);let u,c,d,h=Array(s);for(d=0;d<s;++d)h[d]=r(i[d]),l[d]=d;if(h=function(e,t){return e.sort.call(t,(t,n)=>{const r=e[t],i=e[n];return r<i?-1:r>i?1:0}),n=e,Array.from(t,e=>n[e]);var n}(h,l),o)u=t,c=e,t=Array(o+s),e=LV(o+s),function(e,t,n,r,i,a,o,s,l){let u,c=0,d=0;for(u=0;c<r&&d<o;++u)t[c]<i[d]?(s[u]=t[c],l[u]=n[c++]):(s[u]=i[d],l[u]=a[d++]+e);for(;c<r;++c,++u)s[u]=t[c],l[u]=n[c];for(;d<o;++d,++u)s[u]=i[d],l[u]=a[d]+e}(a,u,c,o,h,l,s,t,e);else{if(a>0)for(d=0;d<s;++d)l[d]+=a;t=h,e=l}return n=o+s,{index:l,value:h}},remove:function(r,i){const a=n;let o,s,l;for(s=0;!i[e[s]]&&s<a;++s);for(l=s;s<a;++s)i[o=e[s]]||(e[l]=o,t[l]=t[s],++l);n=a-r},bisect:function(e,r){let i;return r?i=r.length:(r=t,i=n),[uT(r,e[0],0,i),lT(r,e[1],0,i)]},reindex:function(t){for(let r=0,i=n;r<i;++r)e[r]=t[e[r]]},index:()=>e,size:()=>n}}function UV(e){g_.call(this,function(){let e=8,t=[],n=LV(0),r=BV(0,e),i=BV(0,e);return{data:()=>t,seen:()=>{return n=(e=n).length>=(r=t.length)?e:((i=i||new e.constructor(r)).set(e),i);var e,r,i},add(e){for(let n,r=0,i=t.length,a=e.length;r<a;++r)n=e[r],n._index=i++,t.push(n)},remove(e,n){const a=t.length,o=Array(a-e),s=t;let l,u,c;for(u=0;!n[u]&&u<a;++u)o[u]=t[u],s[u]=u;for(c=u;u<a;++u)l=t[u],n[u]?s[u]=-1:(s[u]=c,r[c]=r[u],i[c]=i[u],o[c]=l,l._index=c++),r[u]=0;return t=o,s},size:()=>t.length,curr:()=>r,prev:()=>i,reset:e=>i[e]=r[e],all:()=>e<257?255:e<65537?65535:4294967295,set(e,t){r[e]|=t},clear(e,t){r[e]&=~t},resize(t,n){(t>r.length||n>e)&&(e=Math.max(n,e),r=BV(t,e,r),i=BV(t,e))}}}(),e),this._indices=null,this._dims=null}function HV(e){g_.call(this,null,e)}UV.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},hg(UV,g_,{transform(e,t){return this._dims?e.modified("fields")||e.fields.some(e=>t.modified(e.fields))?this.reinit(e,t):this.eval(e,t):this.init(e,t)},init(e,t){const n=e.fields,r=e.query,i=this._indices={},a=this._dims=[],o=r.length;let s,l,u=0;for(;u<o;++u)s=n[u].fname,l=i[s]||(i[s]=zV()),a.push($V(l,u,r[u]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),r=e.fields,i=e.query,a=this._indices,o=this._dims,s=this.value,l=s.curr(),u=s.prev(),c=s.all(),d=n.rem=n.add,h=n.mod,f=i.length,p={};let m,g,v,y,b,x,w,_,k;if(u.set(l),t.rem.length&&(b=this.remove(e,t,n)),t.add.length&&s.add(t.add),t.mod.length)for(x={},y=t.mod,w=0,_=y.length;w<_;++w)x[y[w]._index]=1;for(w=0;w<f;++w)k=r[w],(!o[w]||e.modified("fields",w)||t.modified(k.fields))&&(v=k.fname,(m=p[v])||(a[v]=g=zV(),p[v]=m=g.insert(k,t.source,0)),o[w]=$V(g,w,i[w]).onAdd(m,l));for(w=0,_=s.data().length;w<_;++w)b[w]||(u[w]!==l[w]?d.push(w):x[w]&&l[w]!==c&&h.push(w));return s.mask=(1<<f)-1,n},eval(e,t){const n=t.materialize().fork(),r=this._dims.length;let i=0;return t.rem.length&&(this.remove(e,t,n),i|=(1<<r)-1),e.modified("query")&&!e.modified("fields")&&(i|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),i|=(1<<r)-1),t.mod.length&&(this.modify(t,n),i|=(1<<r)-1),this.value.mask=i,n},insert(e,t,n){const r=t.add,i=this.value,a=this._dims,o=this._indices,s=e.fields,l={},u=n.add,c=i.size()+r.length,d=a.length;let h,f,p,m=i.size();i.resize(c,d),i.add(r);const g=i.curr(),v=i.prev(),y=i.all();for(h=0;h<d;++h)f=s[h].fname,p=l[f]||(l[f]=o[f].insert(s[h],r,m)),a[h].onAdd(p,g);for(;m<c;++m)v[m]=y,g[m]!==y&&u.push(m)},modify(e,t){const n=t.mod,r=this.value,i=r.curr(),a=r.all(),o=e.mod;let s,l,u;for(s=0,l=o.length;s<l;++s)u=o[s]._index,i[u]!==a&&n.push(u)},remove(e,t,n){const r=this._indices,i=this.value,a=i.curr(),o=i.prev(),s=i.all(),l={},u=n.rem,c=t.rem;let d,h,f,p;for(d=0,h=c.length;d<h;++d)f=c[d]._index,l[f]=1,o[f]=p=a[f],a[f]=s,p!==s&&u.push(f);for(f in r)r[f].remove(h,l);return this.reindex(t,h,l),l},reindex(e,t,n){const r=this._indices,i=this.value;e.runAfter(()=>{const e=i.remove(t,n);for(const t in r)r[t].reindex(e)})},update(e,t,n){const r=this._dims,i=e.query,a=t.stamp,o=r.length;let s,l,u=0;for(n.filters=0,l=0;l<o;++l)e.modified("query",l)&&(s=l,++u);if(1===u)u=r[s].one,this.incrementOne(r[s],i[s],n.add,n.rem);else for(l=0,u=0;l<o;++l)e.modified("query",l)&&(u|=r[l].one,this.incrementAll(r[l],i[l],a,n.add),n.rem=n.add);return u},incrementAll(e,t,n,r){const i=this.value,a=i.seen(),o=i.curr(),s=i.prev(),l=e.index(),u=e.bisect(e.range),c=e.bisect(t),d=c[0],h=c[1],f=u[0],p=u[1],m=e.one;let g,v,y;if(d<f)for(g=d,v=Math.min(f,h);g<v;++g)y=l[g],a[y]!==n&&(s[y]=o[y],a[y]=n,r.push(y)),o[y]^=m;else if(d>f)for(g=f,v=Math.min(d,p);g<v;++g)y=l[g],a[y]!==n&&(s[y]=o[y],a[y]=n,r.push(y)),o[y]^=m;if(h>p)for(g=Math.max(d,p),v=h;g<v;++g)y=l[g],a[y]!==n&&(s[y]=o[y],a[y]=n,r.push(y)),o[y]^=m;else if(h<p)for(g=Math.max(f,h),v=p;g<v;++g)y=l[g],a[y]!==n&&(s[y]=o[y],a[y]=n,r.push(y)),o[y]^=m;e.range=t.slice()},incrementOne(e,t,n,r){const i=this.value.curr(),a=e.index(),o=e.bisect(e.range),s=e.bisect(t),l=s[0],u=s[1],c=o[0],d=o[1],h=e.one;let f,p,m;if(l<c)for(f=l,p=Math.min(c,u);f<p;++f)m=a[f],i[m]^=h,n.push(m);else if(l>c)for(f=c,p=Math.min(l,d);f<p;++f)m=a[f],i[m]^=h,r.push(m);if(u>d)for(f=Math.max(l,d),p=u;f<p;++f)m=a[f],i[m]^=h,n.push(m);else if(u<d)for(f=Math.max(c,u),p=d;f<p;++f)m=a[f],i[m]^=h,r.push(m);e.range=t.slice()}}),HV.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},hg(HV,g_,{transform(e,t){const n=~(e.ignore||0),r=e.filter,i=r.mask;if(0==(i&n))return t.StopPropagation;const a=t.fork(t.ALL),o=r.data(),s=r.curr(),l=r.prev(),u=e=>s[e]&n?null:o[e];return a.filter(a.MOD,u),i&i-1?(a.filter(a.ADD,e=>{const t=s[e]&n;return!t&&t^l[e]&n?o[e]:null}),a.filter(a.REM,e=>{const t=s[e]&n;return!t||t^t^l[e]&n?null:o[e]})):(a.filter(a.ADD,u),a.filter(a.REM,e=>(s[e]&n)===i?o[e]:null)),a.filter(a.SOURCE,e=>u(e._index))}});const WV="Literal",VV="CallExpression";function qV(e){this.type=e}var GV,YV,XV,KV,ZV;qV.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case VV:return[e.callee].concat(e.arguments);case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];case"Identifier":case WV:case"RawCode":default:return[]}}(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1},(GV={})[1]="Boolean",GV[2]="<end>",GV[3]="Identifier",GV[4]="Keyword",GV[5]="Null",GV[6]="Numeric",GV[7]="Punctuator",GV[8]="String",GV[9]="RegularExpression";var JV="Identifier",QV="Unexpected token %0",eq="Invalid regular expression",tq="Invalid regular expression: missing /",nq="Octal literals are not allowed in strict mode.",rq="ILLEGAL",iq="Disabled.",aq=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),oq=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function sq(e,t){if(!e)throw new Error("ASSERT: "+t)}function lq(e){return e>=48&&e<=57}function uq(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function cq(e){return"01234567".indexOf(e)>=0}function dq(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function hq(e){return 10===e||13===e||8232===e||8233===e}function fq(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&aq.test(String.fromCharCode(e))}function pq(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&oq.test(String.fromCharCode(e))}const mq={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function gq(){for(;XV<KV;){const e=YV.charCodeAt(XV);if(!dq(e)&&!hq(e))break;++XV}}function vq(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)XV<KV&&uq(YV[XV])?(r=YV[XV++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):Dq({},QV,rq);return String.fromCharCode(i)}function yq(){var e,t;for(t=0,"}"===(e=YV[XV])&&Dq({},QV,rq);XV<KV&&uq(e=YV[XV++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&Dq({},QV,rq),t<=65535?String.fromCharCode(t):String.fromCharCode(55296+(t-65536>>10),56320+(t-65536&1023))}function bq(){var e,t;for(e=YV.charCodeAt(XV++),t=String.fromCharCode(e),92===e&&(117!==YV.charCodeAt(XV)&&Dq({},QV,rq),++XV,(e=vq("u"))&&"\\"!==e&&fq(e.charCodeAt(0))||Dq({},QV,rq),t=e);XV<KV&&pq(e=YV.charCodeAt(XV));)++XV,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==YV.charCodeAt(XV)&&Dq({},QV,rq),++XV,(e=vq("u"))&&"\\"!==e&&pq(e.charCodeAt(0))||Dq({},QV,rq),t+=e);return t}function xq(){var e,t,n,r,i=XV,a=YV.charCodeAt(XV),o=YV[XV];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++XV,{type:7,value:String.fromCharCode(a),start:i,end:XV};default:if(61===(e=YV.charCodeAt(XV+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return XV+=2,{type:7,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:XV};case 33:case 61:return 61===YV.charCodeAt(XV+=2)&&++XV,{type:7,value:YV.slice(i,XV),start:i,end:XV}}}return">>>="===(r=YV.substr(XV,4))?{type:7,value:r,start:i,end:XV+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:XV+=3}:o===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===t?{type:7,value:t,start:i,end:XV+=2}:("//"===t&&Dq({},QV,rq),"<>=!+-*%&|^/".indexOf(o)>=0?{type:7,value:o,start:i,end:++XV}:void Dq({},QV,rq))}function wq(){var e,t,n;if(sq(lq((n=YV[XV]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=XV,e="","."!==n){if(e=YV[XV++],n=YV[XV],"0"===e){if("x"===n||"X"===n)return++XV,function(e){let t="";for(;XV<KV&&uq(YV[XV]);)t+=YV[XV++];return 0===t.length&&Dq({},QV,rq),fq(YV.charCodeAt(XV))&&Dq({},QV,rq),{type:6,value:parseInt("0x"+t,16),start:e,end:XV}}(t);if(cq(n))return function(e){let t="0"+YV[XV++];for(;XV<KV&&cq(YV[XV]);)t+=YV[XV++];return(fq(YV.charCodeAt(XV))||lq(YV.charCodeAt(XV)))&&Dq({},QV,rq),{type:6,value:parseInt(t,8),octal:!0,start:e,end:XV}}(t);n&&lq(n.charCodeAt(0))&&Dq({},QV,rq)}for(;lq(YV.charCodeAt(XV));)e+=YV[XV++];n=YV[XV]}if("."===n){for(e+=YV[XV++];lq(YV.charCodeAt(XV));)e+=YV[XV++];n=YV[XV]}if("e"===n||"E"===n)if(e+=YV[XV++],"+"!==(n=YV[XV])&&"-"!==n||(e+=YV[XV++]),lq(YV.charCodeAt(XV)))for(;lq(YV.charCodeAt(XV));)e+=YV[XV++];else Dq({},QV,rq);return fq(YV.charCodeAt(XV))&&Dq({},QV,rq),{type:6,value:parseFloat(e),start:t,end:XV}}function _q(){if(gq(),XV>=KV)return{type:2,start:XV,end:XV};const e=YV.charCodeAt(XV);return fq(e)?(t=XV,{type:1===(n=92===YV.charCodeAt(XV)?bq():function(){var e,t;for(e=XV++;XV<KV;){if(92===(t=YV.charCodeAt(XV)))return XV=e,bq();if(!pq(t))break;++XV}return YV.slice(e,XV)}()).length?3:mq.hasOwnProperty(n)?4:"null"===n?5:"true"===n||"false"===n?1:3,value:n,start:t,end:XV}):40===e||41===e||59===e?xq():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for(sq("'"===(e=YV[XV])||'"'===e,"String literal must starts with a quote"),t=XV,++XV;XV<KV;){if((n=YV[XV++])===e){e="";break}if("\\"===n)if((n=YV[XV++])&&hq(n.charCodeAt(0)))"\r"===n&&"\n"===YV[XV]&&++XV;else switch(n){case"u":case"x":"{"===YV[XV]?(++XV,i+=yq()):i+=vq(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:cq(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),XV<KV&&cq(YV[XV])&&(a=!0,r=8*r+"01234567".indexOf(YV[XV++]),"0123".indexOf(n)>=0&&XV<KV&&cq(YV[XV])&&(r=8*r+"01234567".indexOf(YV[XV++]))),i+=String.fromCharCode(r)):i+=n}else{if(hq(n.charCodeAt(0)))break;i+=n}}return""!==e&&Dq({},QV,rq),{type:8,value:i,octal:a,start:t,end:XV}}():46===e?lq(YV.charCodeAt(XV+1))?wq():xq():lq(e)?wq():xq();var t,n}function kq(){const e=ZV;return XV=e.end,ZV=_q(),XV=e.end,e}function Eq(){const e=XV;ZV=_q(),XV=e}function Sq(e,t,n){const r=new qV("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return r.operator=e,r.left=t,r.right=n,r}function Tq(e,t){const n=new qV("CallExpression");return n.callee=e,n.arguments=t,n}function Cq(e){const t=new qV(JV);return t.name=e,t}function Iq(e){const t=new qV("Literal");return t.value=e.value,t.raw=YV.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function Aq(e,t,n){const r=new qV("MemberExpression");return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function Oq(e,t,n){const r=new qV("Property");return r.key=t,r.value=n,r.kind=e,r}function Dq(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(e,t)=>(sq(t<r.length,"Message reference must be in range"),r[t]));throw(n=new Error(i)).index=XV,n.description=i,n}function Mq(e){2===e.type&&Dq(e,"Unexpected end of input"),6===e.type&&Dq(e,"Unexpected number"),8===e.type&&Dq(e,"Unexpected string"),3===e.type&&Dq(e,"Unexpected identifier"),4===e.type&&Dq(e,"Unexpected reserved word"),Dq(e,QV,e.value)}function Nq(e){const t=kq();7===t.type&&t.value===e||Mq(t)}function jq(e){return 7===ZV.type&&ZV.value===e}function Fq(e){return 4===ZV.type&&ZV.value===e}function Rq(){XV=ZV.start;const e=kq();return 8===e.type||6===e.type?(e.octal&&Dq(e,nq),Iq(e)):Cq(e.value)}function Pq(){var e,t,n;return XV=ZV.start,3===(e=ZV).type?(n=Rq(),Nq(":"),Oq("init",n,Wq())):2!==e.type&&7!==e.type?(t=Rq(),Nq(":"),Oq("init",t,Wq())):void Mq(e)}const Lq={if:1};function Bq(){const e=[];if(Nq("("),!jq(")"))for(;XV<KV&&(e.push(Wq()),!jq(")"));)Nq(",");return Nq(")"),e}function $q(){Nq("[");const e=Vq();return Nq("]"),e}function zq(){const e=function(){var e;for(e=function(){var e,t,n,r,i,a,o;if(jq("("))return function(){Nq("(");const e=Vq();return Nq(")"),e}();if(jq("["))return function(){const e=[];for(XV=ZV.start,Nq("[");!jq("]");)jq(",")?(kq(),e.push(null)):(e.push(Wq()),jq("]")||Nq(","));return kq(),function(e){const t=new qV("ArrayExpression");return t.elements=e,t}(e)}();if(jq("{"))return function(){var e,t,n=[],r={},i=String;for(XV=ZV.start,Nq("{");!jq("}");)t="$"+((e=Pq()).key.type===JV?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?Dq({},"Duplicate data property in object literal not allowed in strict mode"):r[t]=!0,n.push(e),jq("}")||Nq(",");return Nq("}"),function(e){const t=new qV("ObjectExpression");return t.properties=e,t}(n)}();if(XV=ZV.start,3===(e=ZV.type)||Lq[ZV.value])n=Cq(kq().value);else if(8===e||6===e)ZV.octal&&Dq(ZV,nq),n=Iq(kq());else{if(4===e)throw new Error(iq);1===e?((t=kq()).value="true"===t.value,n=Iq(t)):5===e?((t=kq()).value=null,n=Iq(t)):jq("/")||jq("/=")?(n=Iq((ZV=null,gq(),r=XV,i=function(){var e,t,n,r;for(sq("/"===(e=YV[XV]),"Regular expression literal must start with a slash"),t=YV[XV++],n=!1,r=!1;XV<KV;)if(t+=e=YV[XV++],"\\"===e)hq((e=YV[XV++]).charCodeAt(0))&&Dq({},tq),t+=e;else if(hq(e.charCodeAt(0)))Dq({},tq);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||Dq({},tq),{value:t.substr(1,t.length-2),literal:t}}(),a=function(){var e,t,n;for(t="",n="";XV<KV&&pq((e=YV[XV]).charCodeAt(0));)++XV,"\\"===e&&XV<KV?Dq({},QV,rq):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&Dq({},eq,n),{value:n,literal:t}}(),o=function(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(e,t)=>{if(parseInt(t,16)<=1114111)return"x";Dq({},eq)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(r){Dq({},eq)}try{return new RegExp(e,t)}catch(i){return null}}(i.value,a.value),{literal:i.literal+a.literal,value:o,regex:{pattern:i.value,flags:a.value},start:r,end:XV})),Eq()):Mq(kq())}return n}();;)if(jq("."))e=Aq(".",e,(Nq("."),function(){XV=ZV.start;const e=kq();return function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e)||Mq(e),Cq(e.value)}()));else if(jq("("))e=Tq(e,Bq());else{if(!jq("["))break;e=Aq("[",e,$q())}return e}();if(7===ZV.type&&(jq("++")||jq("--")))throw new Error(iq);return e}function Uq(){var e,t;if(7!==ZV.type&&4!==ZV.type)t=zq();else{if(jq("++")||jq("--"))throw new Error(iq);if(jq("+")||jq("-")||jq("~")||jq("!"))e=kq(),t=Uq(),t=function(e,t){const n=new qV("UnaryExpression");return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(Fq("delete")||Fq("void")||Fq("typeof"))throw new Error(iq);t=zq()}}return t}function Hq(e){let t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function Wq(){var e,t;return e=function(){var e,t,n,r,i,a,o,s,l,u;if(e=ZV,l=Uq(),0===(i=Hq(r=ZV)))return l;for(r.prec=i,kq(),t=[e,ZV],a=[l,r,o=Uq()];(i=Hq(ZV))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,l=a.pop(),t.pop(),n=Sq(s,l,o),a.push(n);(r=kq()).prec=i,a.push(r),t.push(ZV),n=Uq(),a.push(n)}for(n=a[u=a.length-1],t.pop();u>1;)t.pop(),n=Sq(a[u-1].value,a[u-2],n),u-=2;return n}(),jq("?")&&(kq(),t=Wq(),Nq(":"),e=function(e,t,n){const r=new qV("ConditionalExpression");return r.test=e,r.consequent=t,r.alternate=n,r}(e,t,Wq())),e}function Vq(){const e=Wq();if(jq(","))throw new Error(iq);return e}var qq={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function Gq(e){function t(t,n,r){return i=>function(t,n,r,i){let a=e(n[0]);return r&&(a=r+"("+a+")",0===r.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+t+(i<0?"":0===i?"()":"("+n.slice(1).map(e).join(",")+")")}(t,i,n,r)}const n="new Date",r="String",i="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){t.length<3&&sm("Missing arguments to clamp function."),t.length>3&&sm("Too many arguments to clamp function.");const n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase",r,0),lower:t("toLowerCase",r,0),substring:t("substring",r),split:t("split",r),trim:t("trim",r,0),regexp:i,test:t("test",i),if:function(t){t.length<3&&sm("Missing arguments to if function."),t.length>3&&sm("Too many arguments to if function.");const n=t.map(e);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}var Yq,Xq,Kq,Zq,Jq,Qq=new mL,eG=new mL,tG={point:BL,lineStart:BL,lineEnd:BL,polygonStart:function(){Qq=new mL,tG.lineStart=nG,tG.lineEnd=rG},polygonEnd:function(){var e=+Qq;eG.add(e<0?wL+e:e),this.lineStart=this.lineEnd=this.point=BL},sphere:function(){eG.add(wL)}};function nG(){tG.point=iG}function rG(){aG(Yq,Xq)}function iG(e,t){tG.point=aG,Yq=e,Xq=t,Kq=e*=kL,Zq=CL(t=(t*=kL)/2+xL),Jq=NL(t)}function aG(e,t){var n=(e*=kL)-Kq,r=n>=0?1:-1,i=r*n,a=CL(t=(t*=kL)/2+xL),o=NL(t),s=Jq*o,l=Zq*a+s*CL(i),u=s*r*NL(i);Qq.add(TL(u,l)),Kq=e,Zq=a,Jq=o}var oG,sG,lG,uG,cG,dG,hG,fG,pG,mG,gG,vG={point:yG,lineStart:xG,lineEnd:wG,polygonStart:function(){vG.point=_G,vG.lineStart=kG,vG.lineEnd=EG,pG=new mL,tG.polygonStart()},polygonEnd:function(){tG.polygonEnd(),vG.point=yG,vG.lineStart=xG,vG.lineEnd=wG,Qq<0?(oG=-(lG=180),sG=-(uG=90)):pG>gL?uG=90:pG<-1e-6&&(sG=-90),gG[0]=oG,gG[1]=lG},sphere:function(){oG=-(lG=180),sG=-(uG=90)}};function yG(e,t){mG.push(gG=[oG=e,lG=e]),t<sG&&(sG=t),t>uG&&(uG=t)}function bG(e,t){var n=GB([e*kL,t*kL]);if(fG){var r=XB(fG,n),i=XB([r[1],-r[0],0],r);JB(i),i=qB(i);var a,o=e-cG,s=o>0?1:-1,l=i[0]*_L*s,u=EL(o)>180;u^(s*cG<l&&l<s*e)?(a=i[1]*_L)>uG&&(uG=a):u^(s*cG<(l=(l+360)%360-180)&&l<s*e)?(a=-i[1]*_L)<sG&&(sG=a):(t<sG&&(sG=t),t>uG&&(uG=t)),u?e<cG?SG(oG,e)>SG(oG,lG)&&(lG=e):SG(e,lG)>SG(oG,lG)&&(oG=e):lG>=oG?(e<oG&&(oG=e),e>lG&&(lG=e)):e>cG?SG(oG,e)>SG(oG,lG)&&(lG=e):SG(e,lG)>SG(oG,lG)&&(oG=e)}else mG.push(gG=[oG=e,lG=e]);t<sG&&(sG=t),t>uG&&(uG=t),fG=n,cG=e}function xG(){vG.point=bG}function wG(){gG[0]=oG,gG[1]=lG,vG.point=yG,fG=null}function _G(e,t){if(fG){var n=e-cG;pG.add(EL(n)>180?n+(n>0?360:-360):n)}else dG=e,hG=t;tG.point(e,t),bG(e,t)}function kG(){tG.lineStart()}function EG(){_G(dG,hG),tG.lineEnd(),EL(pG)>gL&&(oG=-(lG=180)),gG[0]=oG,gG[1]=lG,fG=null}function SG(e,t){return(t-=e)<0?t+360:t}function TG(e,t){return e[0]-t[0]}function CG(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var IG,AG,OG,DG,MG,NG,jG,FG,RG,PG,LG,BG,$G,zG,UG,HG,WG={sphere:BL,point:VG,lineStart:GG,lineEnd:KG,polygonStart:function(){WG.lineStart=ZG,WG.lineEnd=JG},polygonEnd:function(){WG.lineStart=GG,WG.lineEnd=KG}};function VG(e,t){e*=kL;var n=CL(t*=kL);qG(n*CL(e),n*NL(e),NL(t))}function qG(e,t,n){++IG,OG+=(e-OG)/IG,DG+=(t-DG)/IG,MG+=(n-MG)/IG}function GG(){WG.point=YG}function YG(e,t){e*=kL;var n=CL(t*=kL);zG=n*CL(e),UG=n*NL(e),HG=NL(t),WG.point=XG,qG(zG,UG,HG)}function XG(e,t){e*=kL;var n=CL(t*=kL),r=n*CL(e),i=n*NL(e),a=NL(t),o=TL(FL((o=UG*a-HG*i)*o+(o=HG*r-zG*a)*o+(o=zG*i-UG*r)*o),zG*r+UG*i+HG*a);AG+=o,NG+=o*(zG+(zG=r)),jG+=o*(UG+(UG=i)),FG+=o*(HG+(HG=a)),qG(zG,UG,HG)}function KG(){WG.point=VG}function ZG(){WG.point=QG}function JG(){eY(BG,$G),WG.point=VG}function QG(e,t){BG=e,$G=t,e*=kL,t*=kL,WG.point=eY;var n=CL(t);zG=n*CL(e),UG=n*NL(e),HG=NL(t),qG(zG,UG,HG)}function eY(e,t){e*=kL;var n=CL(t*=kL),r=n*CL(e),i=n*NL(e),a=NL(t),o=UG*a-HG*i,s=HG*r-zG*a,l=zG*i-UG*r,u=OL(o,s,l),c=LL(u),d=u&&-c/u;RG.add(d*o),PG.add(d*s),LG.add(d*l),AG+=c,NG+=c*(zG+(zG=r)),jG+=c*(UG+(UG=i)),FG+=c*(HG+(HG=a)),qG(zG,UG,HG)}const tY=Math.PI/180,nY=180/Math.PI,rY=.96422,iY=.82521,aY=4/29,oY=.12841854934601665;function sY(e){if(e instanceof uY)return new uY(e.l,e.a,e.b,e.opacity);if(e instanceof gY)return vY(e);e instanceof zz||(e=Bz(e));var t,n,r=fY(e.r),i=fY(e.g),a=fY(e.b),o=cY((.2225045*r+.7168786*i+.0606169*a)/1);return r===i&&i===a?t=n=o:(t=cY((.4360747*r+.3850649*i+.1430804*a)/rY),n=cY((.0139322*r+.0971045*i+.7141733*a)/iY)),new uY(116*o-16,500*(t-o),200*(o-n),e.opacity)}function lY(e,t,n,r){return 1===arguments.length?sY(e):new uY(e,t,n,null==r?1:r)}function uY(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function cY(e){return e>.008856451679035631?Math.pow(e,1/3):e/oY+aY}function dY(e){return e>.20689655172413793?e*e*e:oY*(e-aY)}function hY(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function fY(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function pY(e){if(e instanceof gY)return new gY(e.h,e.c,e.l,e.opacity);if(e instanceof uY||(e=sY(e)),0===e.a&&0===e.b)return new gY(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*nY;return new gY(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function mY(e,t,n,r){return 1===arguments.length?pY(e):new gY(e,t,n,null==r?1:r)}function gY(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function vY(e){if(isNaN(e.h))return new uY(e.l,0,0,e.opacity);var t=e.h*tY;return new uY(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}yz(uY,lY,bz(xz,{brighter:function(e){return new uY(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new uY(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new zz(hY(3.1338561*(t=rY*dY(t))-1.6168667*(e=1*dY(e))-.4906146*(n=iY*dY(n))),hY(-.9787684*t+1.9161415*e+.033454*n),hY(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),yz(gY,mY,bz(xz,{brighter:function(e){return new gY(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new gY(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return vY(this).rgb()}}));const yY="intersect",bY="union";var xY="index:unit";function wY(e,t){for(var n,r,i=t.fields,a=t.values,o=i.length,s=0;s<o;++s)if((r=i[s]).getter=um.getter||um(r.field),mg(n=r.getter(e))&&(n=Om(n)),mg(a[s])&&(a[s]=Om(a[s])),mg(a[s][0])&&(a[s]=a[s].map(Om)),"E"===r.type){if(km(a[s])?a[s].indexOf(n)<0:n!==a[s])return!1}else if("R"===r.type){if(!fg(n,a[s]))return!1}else if("R-RE"===r.type){if(!fg(n,a[s],!0,!1))return!1}else if("R-E"===r.type){if(!fg(n,a[s],!1,!1))return!1}else if("R-LE"===r.type&&!fg(n,a[s],!1,!0))return!1;return!0}var _Y={E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(e=>t.indexOf(e)>=0):t},R_union:function(e,t){var n=Om(t[0]),r=Om(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=Om(t[0]),r=Om(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};function kY(e,t,n,r){t[0].type!==WV&&sm("First argument to selection functions must be a string literal.");const i=t[0].value,a=":"+i;(t.length>=2&&Am(t).value)!==yY||lg(r,"@unit")||(r["@unit"]=n.getData(i).indataRef(n,"unit")),lg(r,a)||(r[a]=n.getData(i).tuplesRef())}function EY(e){const t=this.context.data[e];return t?t.values.value:[]}const SY=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},TY=SY("format"),CY=SY("timeFormat"),IY=SY("utcFormat"),AY=SY("timeParse"),OY=SY("utcParse"),DY=new Date(2e3,0,1);function MY(e,t,n){return Number.isInteger(e)&&Number.isInteger(t)?(DY.setYear(2e3),DY.setMonth(e),DY.setDate(t),CY.call(this,DY,n)):""}function NY(e,t,n,r){t[0].type!==WV&&sm("First argument to data functions must be a string literal.");const i=t[0].value,a=":"+i;if(!lg(a,r))try{r[a]=n.getData(i).tuplesRef()}catch(o){}}function jY(e,t,n,r){if(t[0].type===WV)FY(n,r,t[0].value);else for(e in n.scales)FY(n,r,e)}function FY(e,t,n){const r="%"+n;if(!lg(t,r))try{t[r]=e.scaleRef(n)}catch(i){}}function RY(e,t){let n;return Km(e)?e:bg(e)?(n=t.scales[e])&&n.value:void 0}function PY(e,t){return function(n,r,i){if(n){const t=RY(n,(i||this).context);return t&&t.path[e](r)}return t(r)}}const LY=PY("area",(function(e){return eG=new mL,pL(e,tG),2*eG})),BY=PY("bounds",(function(e){var t,n,r,i,a,o,s;if(uG=lG=-(oG=sG=1/0),mG=[],pL(e,vG),n=mG.length){for(mG.sort(TG),t=1,a=[r=mG[0]];t<n;++t)CG(r,(i=mG[t])[0])||CG(r,i[1])?(SG(r[0],i[1])>SG(r[0],r[1])&&(r[1]=i[1]),SG(i[0],r[1])>SG(r[0],r[1])&&(r[0]=i[0])):a.push(r=i);for(o=-1/0,t=0,r=a[n=a.length-1];t<=n;r=i,++t)(s=SG(r[1],(i=a[t])[0]))>o&&(o=s,oG=i[0],lG=r[1])}return mG=gG=null,oG===1/0||sG===1/0?[[NaN,NaN],[NaN,NaN]]:[[oG,sG],[lG,uG]]})),$Y=PY("centroid",(function(e){IG=AG=OG=DG=MG=NG=jG=FG=0,RG=new mL,PG=new mL,LG=new mL,pL(e,WG);var t=+RG,n=+PG,r=+LG,i=OL(t,n,r);return i<vL&&(t=NG,n=jG,r=FG,AG<gL&&(t=OG,n=DG,r=MG),(i=OL(t,n,r))<vL)?[NaN,NaN]:[TL(n,t)*_L,LL(r/i)*_L]}));function zY(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(r){e.warn(r)}return n[n.length-1]}function UY(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function HY(e){const t=$z(e);return.2126*UY(t.r)+.7152*UY(t.g)+.0722*UY(t.b)}function WY(e,t){return e===t||e!=e&&t!=t||(km(e)?!(!km(t)||e.length!==t.length)&&function(e,t){for(let n=0,r=e.length;n<r;++n)if(!WY(e[n],t[n]))return!1;return!0}(e,t):!(!Em(e)||!Em(t))&&VY(e,t))}function VY(e,t){for(const n in e)if(!WY(e[n],t[n]))return!1;return!0}function qY(e){return t=>VY(e,t)}function GY(e){return km(e)||ArrayBuffer.isView(e)?e:null}function YY(e){return GY(e)||(bg(e)?e:null)}const XY=e=>e.data;function KY(e,t){const n=EY.call(t,e);return n.root&&n.root.lookup||{}}const ZY=()=>"undefined"!=typeof window&&window||null,JY={random:()=>M_(),cumulativeNormal:H_,cumulativeLogNormal:X_,cumulativeUniform:tk,densityNormal:U_,densityLogNormal:Y_,densityUniform:ek,quantileNormal:W_,quantileLogNormal:K_,quantileUniform:nk,sampleNormal:z_,sampleLogNormal:G_,sampleUniform:Q_,isArray:km,isBoolean:pg,isDate:mg,isDefined:e=>void 0!==e,isNumber:vg,isObject:Em,isRegExp:yg,isString:bg,isTuple:Pw,isValid:e=>null!=e&&e==e,toBoolean:Ig,toDate:Og,toNumber:Om,toString:Dg,indexof:function(e,...t){return YY(e).indexOf(...t)},join:function(e,...t){return GY(e).join(...t)},lastindexof:function(e,...t){return YY(e).lastIndexOf(...t)},replace:function(e,t,n){return Km(n)&&sm("Function argument passed to replace."),String(e).replace(t,n)},reverse:function(e){return GY(e).slice().reverse()},slice:function(e,...t){return YY(e).slice(...t)},flush:dg,lerp:wg,merge:function(){const e=[].slice.call(arguments);return e.unshift({}),ig(...e)},pad:Sg,peek:Am,span:Tg,inrange:fg,truncate:Ng,rgb:$z,lab:lY,hcl:mY,hsl:Gz,luminance:HY,contrast:function(e,t){const n=HY(e),r=HY(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},sequence:wk,format:TY,utcFormat:IY,utcParse:OY,utcOffset:sb,utcSequence:cb,timeFormat:CY,timeParse:AY,timeOffset:ob,timeSequence:ub,timeUnitSpecifier:My,monthFormat:function(e){return MY.call(this,e,1,"%B")},monthAbbrevFormat:function(e){return MY.call(this,e,1,"%b")},dayFormat:function(e){return MY.call(this,0,2+e,"%A")},dayAbbrevFormat:function(e){return MY.call(this,0,2+e,"%a")},quarter:qm,utcquarter:Gm,week:Ry,utcweek:Uy,dayofyear:Fy,utcdayofyear:zy,warn:function(){return zY(this.context.dataflow,"warn",arguments)},info:function(){return zY(this.context.dataflow,"info",arguments)},debug:function(){return zY(this.context.dataflow,"debug",arguments)},extent:ag,inScope:function(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},intersect:function(e,t,n){if(!e)return[];const[r,i]=e,a=(new QM).set(r[0],r[1],i[0],i[1]);return bR(n||this.context.dataflow.scenegraph().root,a,function(e){let t=null;if(e){const n=Ym(e.marktype),r=Ym(e.markname);t=e=>(!n.length||n.some(t=>e.marktype===t))&&(!r.length||r.some(t=>e.name===t))}return t}(t))},clampRange:Xm,pinchDistance:function(e){const t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){const e=ZY();return e?e.screen:{}},containerSize:function(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){const e=ZY();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]},bandspace:function(e,t,n){return HO(e||0,t||0,n||0)},setdata:function(e,t){const n=this.context.dataflow;return n.pulse(this.context.data[e].input,n.changeset().remove(pm).insert(t)),1},pathShape:function(e){let t=null;return function(n){return n?_M(n,t=t||dM(e)):e}},panLinear:Pm,panLog:Lm,panPow:Bm,panSymlog:$m,zoomLinear:Um,zoomLog:Hm,zoomPow:Wm,zoomSymlog:Vm,encode:function(e,t,n){if(e){const n=this.context.dataflow;n.pulse(e.mark.source,n.changeset().encode(e,t))}return void 0!==n?n:e},modify:function(e,t,n,r,i,a){const o=this.context.dataflow,s=this.context.data[e],l=s.input,u=o.stamp();let c,d,h=s.changes;if(!1===o._trigger||!(l.value.length||t||r))return 0;if((!h||h.stamp<u)&&(s.changes=h=o.changeset(),h.stamp=u,o.runAfter(()=>{s.modified=!0,o.pulse(l,h).run()},!0,1)),n&&(c=!0===n?pm:km(n)||Pw(n)?n:qY(n),h.remove(c)),t&&h.insert(t),r&&(c=qY(r),l.value.some(c)?h.remove(c):h.insert(r)),i)for(d in a)h.modify(i,d,a[d]);return 1}},QY=["view","item","group","xy","x","y"],eX="this.",tX={},nX={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>"_[".concat(Cg("$"+e),"]"),functions:function(e){const t=Gq(e);QY.forEach(e=>t[e]="event.vega."+e);for(const n in JY)t[n]=eX+n;return ig(t,function(e,t,n){t.__bandwidth=e=>e&&e.bandwidth?e.bandwidth():0,n._bandwidth=jY,n._range=jY,n._scale=jY;const r=t=>"_["+(t.type===WV?Cg("%"+t.value):Cg("%")+"+"+e(t))+"]";return{_bandwidth:e=>"this.__bandwidth(".concat(r(e[0]),")"),_range:e=>"".concat(r(e[0]),".range()"),_scale:t=>"".concat(r(t[0]),"(").concat(e(t[1]),")")}}(e,JY,tX)),t},constants:qq,visitors:tX},rX=function(e){const t=(e=e||{}).allowed?Mg(e.allowed):{},n=e.forbidden?Mg(e.forbidden):{},r=e.constants||qq,i=(e.functions||Gq)(d),a=e.globalvar,o=e.fieldvar,s=Km(a)?a:e=>"".concat(a,'["').concat(e,'"]');let l={},u={},c=0;function d(e){if(bg(e))return e;const t=h[e.type];return null==t&&sm("Unsupported type: "+e.type),t(e)}const h={Literal:e=>e.raw,Identifier:e=>{const i=e.name;return c>0?i:lg(n,i)?sm("Illegal identifier: "+i):lg(r,i)?r[i]:lg(t,i)?i:(l[i]=1,s(i))},MemberExpression:e=>{const t=!e.computed,n=d(e.object);t&&(c+=1);const r=d(e.property);return n===o&&(u[function(e){const t=e&&e.length-1;return t&&('"'===e[0]&&'"'===e[t]||"'"===e[0]&&"'"===e[t])?e.slice(1,-1):e}(r)]=1),t&&(c-=1),n+(t?"."+r:"["+r+"]")},CallExpression:e=>{"Identifier"!==e.callee.type&&sm("Illegal callee type: "+e.callee.type);const t=e.callee.name,n=e.arguments,r=lg(i,t)&&i[t];return r||sm("Unrecognized function: "+t),Km(r)?r(n):r+"("+n.map(d).join(",")+")"},ArrayExpression:e=>"["+e.elements.map(d).join(",")+"]",BinaryExpression:e=>"("+d(e.left)+" "+e.operator+" "+d(e.right)+")",UnaryExpression:e=>"("+e.operator+d(e.argument)+")",ConditionalExpression:e=>"("+d(e.test)+"?"+d(e.consequent)+":"+d(e.alternate)+")",LogicalExpression:e=>"("+d(e.left)+e.operator+d(e.right)+")",ObjectExpression:e=>"{"+e.properties.map(d).join(",")+"}",Property:e=>{c+=1;const t=d(e.key);return c-=1,t+":"+d(e.value)}};function f(e){const t={code:d(e),globals:Object.keys(l),fields:Object.keys(u)};return l={},u={},t}return f.functions=i,f.constants=r,f}(nX);function iX(e,t,n){return 1===arguments.length?JY[e]:(JY[e]=t,n&&(tX[e]=n),rX&&(rX.functions[e]=eX+e),this)}function aX(e,t){const n={};let r;try{r=function(e){XV=0,KV=(YV=e).length,ZV=null,Eq();const t=Vq();if(2!==ZV.type)throw new Error("Unexpect token after expression.");return t}(e=bg(e)?e:Cg(e)+"")}catch(a){sm("Expression parse error: "+e)}r.visit(e=>{if(e.type!==VV)return;const r=e.callee.name,i=nX.visitors[r];i&&i(r,e.arguments,t,n)});const i=rX(r);return i.globals.forEach(e=>{const r="$"+e;!lg(n,r)&&t.getSignal(e)&&(n[r]=t.signalRef(e))}),{$expr:ig({code:i.code},t.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}iX("bandwidth",(function(e,t){const n=RY(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}),jY),iX("copy",(function(e,t){const n=RY(e,(t||this).context);return n?n.copy():void 0}),jY),iX("domain",(function(e,t){const n=RY(e,(t||this).context);return n?n.domain():[]}),jY),iX("range",(function(e,t){const n=RY(e,(t||this).context);return n&&n.range?n.range():[]}),jY),iX("invert",(function(e,t,n){const r=RY(e,(n||this).context);return r?km(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0}),jY),iX("scale",(function(e,t,n){const r=RY(e,(n||this).context);return r?r(t):void 0}),jY),iX("gradient",(function(e,t,n,r,i){e=RY(e,(i||this).context);const a=oM(t,n);let o=e.domain(),s=o[0],l=Am(o),u=dm;return l-s?u=OD(e,s,l):e=(e.interpolator?vD("sequential")().interpolator(e.interpolator()):vD("linear")().interpolate(e.interpolate()).range(e.range())).domain([s=0,l=1]),e.ticks&&(o=e.ticks(+r||15),s!==o[0]&&o.unshift(s),l!==Am(o)&&o.push(l)),o.forEach(t=>a.stop(u(t),e(t))),a}),jY),iX("geoArea",LY,jY),iX("geoBounds",BY,jY),iX("geoCentroid",$Y,jY),iX("geoShape",(function(e,t,n){const r=RY(e,(n||this).context);return function(e){return r?r.path.context(e)(t):""}}),jY),iX("indata",(function(e,t,n){const r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i?i.count:i}),(function(e,t,n,r){t[0].type!==WV&&sm("First argument to indata must be a string literal."),t[1].type!==WV&&sm("Second argument to indata must be a string literal.");const i=t[0].value,a=t[1].value,o="@"+a;lg(o,r)||(r[o]=n.getData(i).indataRef(n,a))})),iX("data",EY,NY),iX("treePath",(function(e,t,n){const r=KY(e,this),i=r[t],a=r[n];return i&&a?i.path(a).map(XY):void 0}),NY),iX("treeAncestors",(function(e,t){const n=KY(e,this)[t];return n?n.ancestors().map(XY):void 0}),NY),iX("vlSelectionTest",(function(e,t,n){for(var r,i,a,o,s,l=this.context.data[e],u=l?l.values.value:[],c=l?l[xY]&&l[xY].value:void 0,d=n===yY,h=u.length,f=0;f<h;++f)if(r=u[f],c&&d){if(-1===(a=(i=i||{})[o=r.unit]||0))continue;if(s=wY(t,r),i[o]=s?-1:++a,s&&1===c.size)return!0;if(!s&&a===c.get(o).count)return!1}else if(d^(s=wY(t,r)))return s;return h&&d}),kY),iX("vlSelectionResolve",(function(e,t,n){for(var r,i,a,o,s,l,u,c,d,h,f=this.context.data[e],p=f?f.values.value:[],m={},g={},v={},y=p.length,b=0;b<y;++b){for(o=(r=p[b]).unit,a=r.values,d=0,h=(i=r.fields).length;d<h;++d)u=(l=m[(s=i[d]).field]||(m[s.field]={}))[o]||(l[o]=[]),v[s.field]=c=s.type.charAt(0),l[o]=(0,_Y[c+"_union"])(u,Ym(a[d]));n&&(u=g[o]||(g[o]=[])).push(Ym(a).reduce((e,t,n)=>(e[i[n].field]=t,e),{}))}return t=t||bY,Object.keys(m).forEach(e=>{m[e]=Object.keys(m[e]).map(t=>m[e][t]).reduce((n,r)=>void 0===n?r:_Y[v[e]+"_"+t](n,r))}),p=Object.keys(g),n&&p.length&&(m.vlMulti=t===bY?{or:p.reduce((e,t)=>(e.push(...g[t]),e),[])}:{and:p.map(e=>({or:g[e]}))}),m}),kY);const oX=Mg(["rule"]),sX=Mg(["group","image","rect"]);function lX(e){return(e+"").toLowerCase()}function uX(e,t,n){";"!==n[n.length-1]&&(n="return("+n+");");const r=Function(...t.concat(n));return e&&e.functions?r.bind(e.functions):r}var cX={operator:(e,t)=>uX(e,["_"],t.code),parameter:(e,t)=>uX(e,["datum","_"],t.code),event:(e,t)=>uX(e,["event"],t.code),handler:(e,t)=>uX(e,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(t.code,";")),encode:(e,t)=>{const{marktype:n,channels:r}=t;let i="var o=item,datum=o.datum,m=0,$;";for(const a in r){const e="o["+Cg(a)+"]";i+="$=".concat(r[a].code,";if(").concat(e,"!==$)").concat(e,"=$,m=1;")}return i+=function(e,t){let n="";return oX[t]||(e.x2&&(e.x?(sX[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(sX[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(r,n),i+="return m;",uX(e,["item","_"],i)},codegen:{get(e){const t="[".concat(e.map(Cg).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const r=Function("a","b","var u, v; return "+e.map((e,r)=>{const i=t[r];let a,o;return e.path?(a="a".concat(e.path),o="b".concat(e.path)):((n=n||{})["f"+r]=e,a="this.f".concat(r,"(a)"),o="this.f".concat(r,"(b)")),function(e,t,n,r){return"((u = ".concat(e,") < (v = ").concat(t,") || u == null) && v != null ? ").concat(n,"\n  : (u > v || v == null) && u != null ? ").concat(r,"\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ").concat(n,"\n  : v !== v && u === u ? ").concat(r," : ")}(a,o,-i,i)}).join("")+"0;");return n?r.bind(n):r}}};function dX(e,t,n){if(!e||!Em(e))return e;for(let r,i=0,a=hX.length;i<a;++i)if(r=hX[i],lg(e,r.key))return r.parse(e,t,n);return e}var hX=[{key:"$ref",parse:function(e,t){return t.get(e.$ref)||sm("Operator not defined: "+e.$ref)}},{key:"$key",parse:function(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=xg(e.$key,e.$flat,t.expr.codegen))}},{key:"$expr",parse:function(e,t,n){e.$params&&t.parseParameters(e.$params,n);const r="e:"+e.$expr.code+"_"+e.$name;return t.fn[r]||(t.fn[r]=tm(t.parameterExpression(e.$expr),e.$fields,e.$name))}},{key:"$field",parse:function(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=um(e.$field,e.$name,t.expr.codegen))}},{key:"$encode",parse:function(e,t){const n=e.$encode,r={};for(const i in n){const e=n[i];r[i]=tm(t.encodeExpression(e.$expr),e.$fields),r[i].output=e.$output}return r}},{key:"$compare",parse:function(e,t){const n="c:"+e.$compare+"_"+e.$order,r=Ym(e.$compare).map(e=>e&&e.$tupleid?Lw:e);return t.fn[n]||(t.fn[n]=Zm(r,e.$order,t.expr.codegen))}},{key:"$context",parse:function(e,t){return t}},{key:"$subflow",parse:function(e,t){const n=e.$subflow;return function(e,r,i){const a=t.fork().parse(n),o=a.get(n.operators[0].id),s=a.signals.parent;return s&&s.set(i),o.detachSubflow=()=>t.detach(a),o}}},{key:"$tupleid",parse:function(){return Lw}}];const fX={skip:!0};function pX(e,t,n,r){return new mX(e,t,n,r)}function mX(e,t,n,r){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=r||cX,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function gX(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}mX.prototype=gX.prototype={fork(){const e=new gX(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(t=>t!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,r=n.dataflow,i=e.value;if(n.set(e.id,t),"collect"===lX(e.type)&&i&&(i.$ingest?r.ingest(t,i.$ingest,i.$format):i.$request?r.preload(t,i.$request,i.$format):r.pulse(t,r.changeset().insert(i))),e.root&&(n.root=t),e.parent){let i=n.get(e.parent.$ref);i?(r.connect(i,[t]),t.targets().add(i)):(n.unresolved=n.unresolved||[]).push(()=>{i=n.get(e.parent.$ref),r.connect(i,[t]),t.targets().add(i)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const a in e.data){const r=n.data[a]||(n.data[a]={});e.data[a].forEach(e=>r[e]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[lX(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:function(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(e=>t.parseOperator(e)),n.forEach(e=>t.parseOperatorParameters(e)),(e.streams||[]).forEach(e=>t.parseStream(e)),(e.updates||[]).forEach(e=>t.parseUpdate(e)),t.resolve()},parseOperator:function(e){const t=this;"operator"!==lX(e.type)&&e.type?t.transform(e,e.type):t.operator(e,e.update?t.operatorExpression(e.update):null)},parseOperatorParameters:function(e){const t=this;if(e.params){const n=t.get(e.id);n||sm("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}},parseParameters:function(e,t){t=t||{};const n=this;for(const r in e){const i=e[r];t[r]=km(i)?i.map(e=>dX(e,n,t)):dX(i,n,t)}return t},parseStream:function(e){var t,n=this,r=null!=e.filter?n.eventExpression(e.filter):void 0,i=null!=e.stream?n.get(e.stream):void 0;e.source?i=n.events(e.source,e.type,r):e.merge&&(i=(t=e.merge.map(e=>n.get(e)))[0].merge.apply(t[0],t.slice(1))),e.between&&(t=e.between.map(e=>n.get(e)),i=i.between(t[0],t[1])),e.filter&&(i=i.filter(r)),null!=e.throttle&&(i=i.throttle(+e.throttle)),null!=e.debounce&&(i=i.debounce(+e.debounce)),null==i&&sm("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),n.stream(e,i)},parseUpdate:function(e){var t,n=this,r=Em(r=e.source)?r.$ref:r,i=n.get(r),a=e.update,o=void 0;i||sm("Source not defined: "+e.source),t=e.target&&e.target.$expr?n.eventExpression(e.target.$expr):n.get(e.target),a&&a.$expr&&(a.$params&&(o=n.parseParameters(a.$params)),a=n.handlerExpression(a.$expr)),n.update(e,i,t,a,o)},getState:function(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach(n=>{const i=t.signals[n];e.signals(n,i)&&(r[n]=i.value)})}if(e.data){var i=n.data={};Object.keys(t.data).forEach(n=>{const r=t.data[n];e.data(n,r)&&(i[n]=r.input.value)})}return t.subcontext&&!1!==e.recurse&&(n.subcontext=t.subcontext.map(t=>t.getState(e))),n},setState:function(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach(e=>{n.update(t.signals[e],i[e],fX)}),Object.keys(r||{}).forEach(e=>{n.pulse(t.data[e].input,n.changeset().remove(pm).insert(r[e]))}),(e.subcontext||[]).forEach((e,n)=>{const r=t.subcontext[n];r&&r.setState(e)})}};var vX,yX,bX=0,xX=0,wX=0,_X=0,kX=0,EX=0,SX="object"==typeof performance&&performance.now?performance:Date,TX="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function CX(){return kX||(TX(IX),kX=SX.now()+EX)}function IX(){kX=0}function AX(){this._call=this._time=this._next=null}function OX(){kX=(_X=SX.now())+EX,bX=xX=0;try{!function(){CX(),++bX;for(var e,t=vX;t;)(e=kX-t._time)>=0&&t._call.call(null,e),t=t._next;--bX}()}finally{bX=0,function(){for(var e,t,n=vX,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:vX=t);yX=e,MX(r)}(),kX=0}}function DX(){var e=SX.now(),t=e-_X;t>1e3&&(EX-=t,_X=e)}function MX(e){bX||(xX&&(xX=clearTimeout(xX)),e-kX>24?(e<1/0&&(xX=setTimeout(OX,e-SX.now()-EX)),wX&&(wX=clearInterval(wX))):(wX||(_X=SX.now(),wX=setInterval(DX,1e3)),bX=1,TX(OX)))}function NX(e,t){e&&(null==t?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}AX.prototype=(function(e,t,n){var r=new AX;return r.restart(e,t,n),r}).prototype={constructor:AX,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?CX():+n)+(null==t?0:+t),this._next||yX===this||(yX?yX._next=this:vX=this,yX=this),this._call=e,this._time=n,MX()},stop:function(){this._call&&(this._call=null,this._time=1/0,MX())}};const jX="default";function FX(e,t){const n=e.globalCursor()?"undefined"!=typeof document&&document.body:e.container();if(n)return null==t?n.style.removeProperty("cursor"):n.style.cursor=t}function RX(e,t){var n=e._runtime.data;return lg(n,t)||sm("Unrecognized data set: "+t),n[t]}function PX(e,t){Vw(t)||sm("Second argument to changes must be a changeset.");const n=RX(this,e);return n.modified=!0,this.pulse(n.input,t)}function LX(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function BX(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function $X(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}const zX="view",UX={trap:!1};function HX(e,t,n){const r=e._eventConfig&&e._eventConfig[t];return!(!1===r||Em(r)&&!r[n])||(e.warn("Blocked ".concat(t," ").concat(n," event listener.")),!1)}function WX(e){return e.item}function VX(e){return e.item.mark.source}function qX(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function GX(e,t,n){const r=document.createElement(e);for(const i in t)r.setAttribute(i,t[i]);return null!=n&&(r.textContent=n),r}function YX(e,t,n,r){const i=GX("input");for(const a in n)"signal"!==a&&"element"!==a&&i.setAttribute("input"===a?"type":a,n[a]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",()=>e.update(i.value)),e.elements=[i],e.set=e=>i.value=e}function XX(e,t,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const a=GX("input",i);t.appendChild(a),a.addEventListener("change",()=>e.update(a.checked)),e.elements=[a],e.set=e=>a.checked=!!e||null}function KX(e,t,n,r){const i=GX("select",{name:n.signal}),a=n.labels||[];n.options.forEach((e,t)=>{const n={value:e};QX(e,r)&&(n.selected=!0),i.appendChild(GX("option",n,(a[t]||e)+""))}),t.appendChild(i),i.addEventListener("change",()=>{e.update(n.options[i.selectedIndex])}),e.elements=[i],e.set=e=>{for(let t=0,r=n.options.length;t<r;++t)if(QX(n.options[t],e))return void(i.selectedIndex=t)}}function ZX(e,t,n,r){const i=GX("span",{class:"vega-bind-radio"}),a=n.labels||[];t.appendChild(i),e.elements=n.options.map((t,o)=>{const s={type:"radio",name:n.signal,value:t};QX(t,r)&&(s.checked=!0);const l=GX("input",s);l.addEventListener("change",()=>e.update(t));const u=GX("label",{},(a[o]||t)+"");return u.prepend(l),i.appendChild(u),l}),e.set=t=>{const n=e.elements,r=n.length;for(let e=0;e<r;++e)QX(n[e].value,t)&&(n[e].checked=!0)}}function JX(e,t,n,r){r=void 0!==r?r:(+n.max+ +n.min)/2;const i=null!=n.max?n.max:Math.max(100,+r)||100,a=n.min||Math.min(0,i,+r)||0,o=n.step||kv(a,i,100),s=GX("input",{type:"range",name:n.signal,min:a,max:i,step:o});s.value=r;const l=GX("span",{},+r);t.appendChild(s),t.appendChild(l);const u=()=>{l.textContent=s.value,e.update(+s.value)};s.addEventListener("input",u),s.addEventListener("change",u),e.elements=[s],e.set=e=>{s.value=e,l.textContent=e}}function QX(e,t){return e===t||e+""==t+""}function eK(e,t,n,r,i,a){return(t=t||new r(e.loader())).initialize(n,LX(e),BX(e),$X(e),i,a).background(e.background())}function tK(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function nK(e,t){if("string"==typeof t){if("undefined"==typeof document)return e.error("DOM document instance not found."),null;if(!(t=document.querySelector(t)))return e.error("Signal bind element not found: "+t),null}if(t)try{t.innerHTML=""}catch(n){t=null,e.error(n)}return t}const rK=e=>+e||0;function iK(e){return Em(e)?{top:rK(e.top),bottom:rK(e.bottom),left:rK(e.left),right:rK(e.right)}:(e=>({top:e,bottom:e,left:e,right:e}))(rK(e))}async function aK(e,t,n,r){const i=yR(t),a=i&&i.headless;return a||sm("Unrecognized renderer type: "+t),await e.runAsync(),eK(e,null,null,a,n,r).renderAsync(e._scenegraph.root)}var oK="padding",sK={skip:!0};function lK(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===oK?r.left+r.right:0)}function uK(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===oK?r.top+r.bottom:0)}function cK(e,t){return t.modified&&km(t.input.value)&&e.indexOf("_:vega:_")}function dK(e,t){return!("parent"===e||t instanceof v_.proxy)}function hK(e,t,n,r){const i=e.element();i&&i.setAttribute("title",function(e){return null==e?"":km(e)?fK(e):Em(e)&&!mg(e)?(t=e,Object.keys(t).map(e=>{const n=t[e];return e+": "+(km(n)?fK(n):pK(n))}).join("\n")):e+"";var t}(r))}function fK(e){return"["+e.map(pK).join(", ")+"]"}function pK(e){return km(e)?"[\u2026]":Em(e)&&!mg(e)?"{\u2026}":e}function mK(e,t){const n=this;if(t=t||{},p_.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),null!=t.logLevel&&n.logLevel(t.logLevel),t.locale||e.locale){const r=ig({},e.locale,t.locale);n.locale(Iw(r.number,r.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||gR.Canvas,n._scenegraph=new eF;const r=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||hK,n._redraw=!0,n._handler=(new TF).scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(e){const t=ig({defaults:{}},e),n=(e,t)=>{t.forEach(t=>{km(e[t])&&(e[t]=Mg(e[t]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=function(e,t,n){return pX(e,v_,JY,n).parse(t)}(n,e,t.expr);n._runtime=i,n._signals=i.signals,n._bind=(e.bindings||[]).map(e=>({state:null,param:ig({},e)})),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=lK(n,n._width),n._viewHeight=uK(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(e){var t=e._signals,n=t.width,r=t.height,i=t.padding;function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,t=>{e._width=t.size,e._viewWidth=lK(e,t.size),a()},{size:n}),e._resizeHeight=e.add(null,t=>{e._height=t.size,e._viewHeight=uK(e,t.size),a()},{size:r});const o=e.add(null,a,{pad:i});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=r.rank+1,o.rank=i.rank+1}(n),function(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}(n),function(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:jX,item:null}));e.on(e.events("view","mousemove"),t,(e,n)=>{const r=t.value,i=r?bg(r)?r:r.user:jX,a=n.item&&n.item.cursor||null;return r&&i===r.user&&a==r.item?r:{user:i,item:a}}),e.add(null,(function(t){let n=t.cursor,r=this.value;return bg(n)||(r=n.item,n=n.user),FX(e,n&&n!==jX?n:r||n),r}),{cursor:t})}(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function gK(e,t){return lg(e._signals,t)?e._signals[t]:sm("Unrecognized signal name: "+Cg(t))}function vK(e,t){const n=(e._targets||[]).filter(e=>e._update&&e._update.handler===t);return n.length?n[0]:null}function yK(e,t,n,r){let i=vK(n,r);return i||(i=tK(e,()=>r(t,n.value)),i.handler=r,e.on(n,null,i)),e}function bK(e,t,n){const r=vK(t,n);return r&&t._targets.remove(r),e}hg(mK,p_,{async evaluate(e,t,n){if(await p_.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,i=$X(r=this),a=LX(r),o=BX(r),r._renderer.background(r.background()),r._renderer.resize(a,o,i),r._handler.origin(i),r._resizeListeners.forEach(e=>{try{e(a,o)}catch(t){r.error(t)}})),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(s){this.error(s)}var r,i,a,o;return n&&jw(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=null!=e?e+"":null;return t!==this._desc&&NX(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const r=gK(this,e);return 1===arguments.length?r.value:this.update(r,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",iK(e)):iK(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(yR(e)||sm("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(p_.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(gK(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(e,t,n,r,i,a){this.runAfter(o=>{let s=0;o._autosize=0,o.width()!==n&&(s=1,o.signal("width",n,sK),o._resizeWidth.skip(!0)),o.height()!==r&&(s=1,o.signal("height",r,sK),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),o._origin[0]===i[0]&&o._origin[1]===i[1]||(o._resize=1,o._origin=i),s&&o.run("enter"),a&&o.runAfter(e=>e.resize())},!1,1)},addEventListener(e,t,n){let r=t;return n&&!1===n.trap||(r=tK(this,t),r.raw=t),this._handler.on(e,r),this},removeEventListener(e,t){for(var n,r,i=this._handler.handlers(e),a=i.length;--a>=0;)if(n=i[a].handler,e===(r=i[a].type)&&(t===n||t===n.raw)){this._handler.off(r,n);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return yK(this,e,gK(this,e),t)},removeSignalListener(e,t){return bK(this,gK(this,e),t)},addDataListener(e,t){return yK(this,e,RX(this,e).values,t)},removeDataListener(e,t){return bK(this,RX(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=FX(this,null);this._globalCursor=!!e,t&&FX(this,t)}return this}return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:function(e,t){this._timers.push(function(e,t,n){var r=new AX,i=t;return null==t?(r.restart(e,t,n),r):(r._restart=r.restart,r.restart=function(e,t,n){t=+t,n=null==n?CX():+n,r._restart((function a(o){o+=i,r._restart(a,i+=t,n),e(o)}),t,n)},r.restart(e,t,n),r)}((function(t){e({timestamp:Date.now(),elapsed:t})}),t))},events:function(e,t,n){var r,i=this,a=new e_(n),o=function(n,r){i.runAsync(null,()=>{e===zX&&function(e,t){var n=e._eventConfig.defaults,r=n.prevent,i=n.allow;return!1!==r&&!0!==i&&(!0===r||!1===i||(r?r[t]:i?!i[t]:e.preventDefault()))}(i,t)&&n.preventDefault(),a.receive(function(e,t,n){var r,i,a=e._renderer,o=a&&a.canvas();return o&&(i=$X(e),(r=sF(t.changedTouches?t.changedTouches[0]:t,o))[0]-=i[0],r[1]-=i[1]),t.dataflow=e,t.item=n,t.vega=function(e,t,n){const r=t?"group"===t.mark.marktype?t:t.mark.group:null;function i(e){var n,i=r;if(e)for(n=t;n;n=n.mark.group)if(n.mark.name===e){i=n;break}return i&&i.mark&&i.mark.interactive?i:{}}function a(e){if(!e)return n;bg(e)&&(e=i(e));const t=n.slice();for(;e;)t[0]-=e.x||0,t[1]-=e.y||0,e=e.mark&&e.mark.group;return t}return{view:ng(e),item:ng(t||{}),group:i,xy:a,x:e=>a(e)[0],y:e=>a(e)[1]}}(e,n,r),t}(i,n,r))})};if("timer"===e)HX(i,"timer",t)&&i.timer(o,t);else if(e===zX)HX(i,"view",t)&&i.addEventListener(t,o,UX);else if("window"===e?HX(i,"window",t)&&"undefined"!=typeof window&&(r=[window]):"undefined"!=typeof document&&HX(i,"selector",t)&&(r=document.querySelectorAll(e)),r){for(var s=0,l=r.length;s<l;++s)r[s].addEventListener(t,o);i._eventListeners.push({type:t,sources:r,handler:o})}else i.warn("Can not resolve event source: "+e);return a},finalize:function(){var e,t,n,r=this._tooltip,i=this._timers,a=this._eventListeners;for(e=i.length;--e>=0;)i[e].stop();for(e=a.length;--e>=0;)for(t=(n=a[e]).sources.length;--t>=0;)n.sources[t].removeEventListener(n.type,n.handler);return r&&r.call(this,this._handler,null,null,null),this},hover:function(e,t){return t=[t||"update",(e=[e||"hover"])[0]],this.on(this.events("view","mouseover",WX),VX,qX(e)),this.on(this.events("view","mouseout",WX),VX,qX(t)),this},data:function(e,t){return arguments.length<2?RX(this,e).values.value:PX.call(this,e,qw().remove(pm).insert(t))},change:PX,insert:function(e,t){return PX.call(this,e,qw().insert(t))},remove:function(e,t){return PX.call(this,e,qw().remove(t))},scale:function(e){var t=this._runtime.scales;return lg(t,e)||sm("Unrecognized scale or projection: "+e),t[e].value},initialize:function(e,t){const n=this,r=n._renderType,i=n._eventConfig.bind,a=yR(r);e=n._el=e?nK(n,e):null,function(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),NX(t,e.description()))}(n),a||n.error("Unrecognized renderer type: "+r);const o=a.handler||TF,s=e?a.renderer:a.headless;return n._renderer=s?eK(n,n._renderer,e,s):null,n._handler=function(e,t,n,r){const i=new r(e.loader(),tK(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,$X(e),e);return t&&t.handlers().forEach(e=>{i.on(e.type,e.handler)}),i}(n,n._handler,e,o),n._redraw=!0,e&&"none"!==i&&(t=t?n._elBind=nK(n,t):e.appendChild(GX("form",{class:"vega-bindings"})),n._bind.forEach(e=>{e.param.element&&"container"!==i&&(e.element=nK(n,e.param.element))}),n._bind.forEach(e=>{!function(e,t,n){if(!t)return;const r=n.param;let i=n.state;i||(i=n.state={elements:null,active:!1,set:null,update:t=>{t!==e.signal(r.signal)&&e.runAsync(null,()=>{i.source=!0,e.signal(r.signal,t)})}},r.debounce&&(i.update=rg(r.debounce,i.update))),function(e,t,n,r){const i=GX("div",{class:"vega-bind"}),a="radio"===n.input?i:i.appendChild(GX("label"));a.appendChild(GX("span",{class:"vega-bind-name"},n.name||n.signal)),t.appendChild(i);let o=YX;switch(n.input){case"checkbox":o=XX;break;case"select":o=KX;break;case"radio":o=ZX;break;case"range":o=JX}o(e,a,n,r)}(i,t,r,e.signal(r.signal)),i.active||(e.on(e._signals[r.signal],null,()=>{i.source?i.source=!1:i.set(e.signal(r.signal))}),i.active=!0)}(n,e.element||t,e)})),n},toImageURL:async function(e,t){e!==gR.Canvas&&e!==gR.SVG&&e!==gR.PNG&&sm("Unrecognized image type: "+e);const n=await aK(this,e,t);return e===gR.SVG?function(e,t){const n=new Blob([e],{type:"image/svg+xml"});return window.URL.createObjectURL(n)}(n.svg()):n.canvas().toDataURL("image/png")},toCanvas:async function(e,t){return(await aK(this,gR.Canvas,e,t)).canvas()},toSVG:async function(e){return(await aK(this,gR.SVG,e)).svg()},getState:function(e){return this._runtime.getState(e||{data:cK,signals:dK,recurse:!0})},setState:function(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},e=>{e._trigger=!0}),this}});const xK=/[[\]{}]/,wK={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let _K,kK;function EK(e,t,n){return _K=t||"view",kK=n||wK,TK(e.trim()).map(CK)}function SK(e,t,n,r,i){const a=e.length;let o,s=0;for(;t<a;++t){if(o=e[t],!s&&o===n)return t;i&&i.indexOf(o)>=0?--s:r&&r.indexOf(o)>=0&&++s}return t}function TK(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=SK(e,i,",","[{","]}"),t.push(e.substring(r,i).trim()),r=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function CK(e){return"["===e[0]?function(e){const t=e.length;let n,r=1;if(r=SK(e,r,"]","[","]"),r===t)throw"Empty between selector: "+e;if(n=TK(e.substring(1,r)),2!==n.length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(r+1).trim())[0])throw"Expected '>' after between selector: "+e;n=n.map(CK);const i=CK(e.slice(1).trim());return i.between?{between:n,stream:i}:(i.between=n,i)}(e):function(e){const t={source:_K},n=[];let r,i,a=[0,0],o=0,s=0,l=e.length,u=0;if("}"===e[l-1]){if(u=e.lastIndexOf("{"),!(u>=0))throw"Unmatched right brace: "+e;try{a=function(e){const t=e.split(",");if(!e.length||t.length>2)throw e;return t.map(t=>{const n=+t;if(n!=n)throw e;return n})}(e.substring(u+1,l-1))}catch(c){throw"Invalid throttle specification: "+e}l=(e=e.slice(0,u).trim()).length,u=0}if(!l)throw e;if("@"===e[0]&&(o=++u),r=SK(e,u,":"),r<l&&(n.push(e.substring(s,r).trim()),s=u=++r),u=SK(e,u,"["),u===l)n.push(e.substring(s,l).trim());else if(n.push(e.substring(s,u).trim()),i=[],s=++u,s===l)throw"Unmatched left bracket: "+e;for(;u<l;){if(u=SK(e,u,"]"),u===l)throw"Unmatched left bracket: "+e;if(i.push(e.substring(s,u).trim()),u<l-1&&"["!==e[++u])throw"Expected left bracket: "+e;s=++u}if(!(l=n.length)||xK.test(n[l-1]))throw"Invalid event selector: "+e;return l>1?(t.type=n[1],o?t.markname=n[0].slice(1):kK[n[0]]?t.marktype=n[0]:t.source=n[0]):t.type=n[0],"!"===t.type.slice(-1)&&(t.consume=!0,t.type=t.type.slice(0,-1)),null!=i&&(t.filter=i),a[0]&&(t.throttle=a[0]),a[1]&&(t.debounce=a[1]),t}(e)}function IK(e){return Em(e)?e:{type:e||"pad"}}const AK=e=>+e||0;function OK(e){return Em(e)?e.signal?e:{top:AK(e.top),bottom:AK(e.bottom),left:AK(e.left),right:AK(e.right)}:{top:t=AK(e),bottom:t,left:t,right:t};var t}const DK=e=>Em(e)&&!km(e)?ig({},e):{value:e};function MK(e,t,n,r){return null!=n?(Em(n)&&!km(n)||km(n)&&n.length&&Em(n[0])?e.update[t]=n:e[r||"enter"][t]={value:n},1):0}function NK(e,t,n){for(const r in t)MK(e,r,t[r]);for(const r in n)MK(e,r,n[r],"update")}function jK(e,t,n){for(const r in t)n&&lg(n,r)||(e[r]=ig(e[r]||{},t[r]));return e}function FK(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const RK="mark",PK="frame",LK="scope",BK="legend-label";function $K(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const zK=e=>bg(e)?Cg(e):e.signal?"(".concat(e.signal,")"):VK(e);function UK(e){if(null!=e.gradient)return function(e){const t=[e.start,e.stop,e.count].map(e=>null==e?null:Cg(e));for(;t.length&&null==Am(t);)t.pop();return t.unshift(zK(e.gradient)),"gradient(".concat(t.join(","),")")}(e);let t=e.signal?"(".concat(e.signal,")"):e.color?function(e){return e.c?HK("hcl",e.h,e.c,e.l):e.h||e.s?HK("hsl",e.h,e.s,e.l):e.l||e.a?HK("lab",e.l,e.a,e.b):e.r||e.g||e.b?HK("rgb",e.r,e.g,e.b):null}(e.color):null!=e.field?VK(e.field):void 0!==e.value?Cg(e.value):void 0;return null!=e.scale&&(t=function(e,t){const n=zK(e.scale);return null!=e.range?t="lerp(_range(".concat(n,"), ").concat(+e.range,")"):(void 0!==t&&(t="_scale(".concat(n,", ").concat(t,")")),e.band&&(t=(t?t+"+":"")+"_bandwidth(".concat(n,")")+(1==+e.band?"":"*"+WK(e.band)),e.extra&&(t="(datum.extra ? _scale(".concat(n,", datum.extra.value) : ").concat(t,")"))),null==t&&(t="0")),t}(e,t)),void 0===t&&(t=null),null!=e.exponent&&(t="pow(".concat(t,",").concat(WK(e.exponent),")")),null!=e.mult&&(t+="*".concat(WK(e.mult))),null!=e.offset&&(t+="+".concat(WK(e.offset))),e.round&&(t="round(".concat(t,")")),t}const HK=(e,t,n,r)=>"(".concat(e,"(").concat([t,n,r].map(UK).join(","),")+'')");function WK(e){return Em(e)?"("+UK(e)+")":e}function VK(e){return function e(t){let n,r,i;if(t.signal)n="datum",i=t.signal;else if(t.group||t.parent){for(r=Math.max(1,t.level||1),n="item";r-- >0;)n+=".mark.group";t.parent?(i=t.parent,n+=".datum"):i=t.group}else t.datum?(n="datum",i=t.datum):sm("Invalid field reference: "+Cg(t));return t.signal||(i=bg(i)?lm(i).map(Cg).join("]["):e(i)),n+"["+i+"]"}(Em(e)?e:{datum:e})}function qK(e,t,n,r,i,a){const o={};(a=a||{}).encoders={$encode:o},e=function(e,t,n,r,i){const a={},o={};let s,l,u,c;for(l in l="lineBreak","text"!==t||null==i[l]||FK(l,e)||$K(a,l,i[l]),("legend"==n||String(n).startsWith("axis"))&&(n=null),c=n===PK?i.group:n===RK?ig({},i.mark,i[t]):null,c)u=FK(l,e)||("fill"===l||"stroke"===l)&&(FK("fill",e)||FK("stroke",e)),u||$K(a,l,c[l]);for(l in Ym(r).forEach(t=>{const n=i.style&&i.style[t];for(const r in n)FK(r,e)||$K(a,r,n[r])}),e=ig({},e),a)c=a[l],c.signal?(s=s||{})[l]=c:o[l]=c;return e.enter=ig(o,e.enter),s&&(e.update=ig(s,e.update)),e}(e,t,n,r,i.config);for(const s in e)o[s]=GK(e[s],t,a,i);return a}function GK(e,t,n,r){const i={},a={};for(const s in e)null!=e[s]&&(i[s]=YK(km(o=e[s])?function(e){let t="";return e.forEach(e=>{const n=UK(e);t+=e.test?"(".concat(e.test,")?").concat(n,":"):n}),":"===Am(t)&&(t+="null"),t}(o):UK(o),r,n,a));var o;return{$expr:{marktype:t,channels:i},$fields:Object.keys(a),$output:Object.keys(e)}}function YK(e,t,n,r){const i=aX(e,t);return i.$fields.forEach(e=>r[e]=1),ig(n,i.$params),i.$expr}const XK=["value","update","init","react","bind"];function KK(e,t){sm(e+' for "outer" push: '+Cg(t))}function ZK(e,t){const n=e.name;if("outer"===e.push)t.signals[n]||KK("No prior signal definition",n),XK.forEach(t=>{void 0!==e[t]&&KK("Invalid property ",t)});else{const r=t.addSignal(n,e.value);!1===e.react&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}}function JK(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function QK(e,t,n,r){return new JK(e,t,n,r)}function eZ(e,t){return QK("operator",e,t)}function tZ(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function nZ(e,t){return t?{$field:e,$name:t}:{$field:e}}const rZ=nZ("key");function iZ(e,t){return{$compare:e,$order:t}}function aZ(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const oZ="scope",sZ="view";function lZ(e){return e&&e.signal}function uZ(e){if(lZ(e))return!0;if(Em(e))for(const t in e)if(uZ(e[t]))return!0;return!1}function cZ(e,t){return null!=e?e:t}function dZ(e){return e&&e.signal||e}const hZ="timer";function fZ(e,t){return(e.merge?pZ:e.stream?mZ:e.type?gZ:sm("Invalid stream specification: "+Cg(e)))(e,t)}function pZ(e,t){const n=vZ({merge:e.merge.map(e=>fZ(e,t))},e,t);return t.addStream(n).id}function mZ(e,t){const n=vZ({stream:fZ(e.stream,t)},e,t);return t.addStream(n).id}function gZ(e,t){let n;var r;e.type===hZ?(n=t.event(hZ,e.throttle),e={between:e.between,filter:e.filter}):n=t.event((r=e.source)===oZ?sZ:r||sZ,e.type);const i=vZ({stream:n},e,t);return 1===Object.keys(i).length?n:t.addStream(i).id}function vZ(e,t,n){let r=t.between;return r&&(2!==r.length&&sm('Stream "between" parameter must have 2 entries: '+Cg(t)),e.between=[fZ(r[0],n),fZ(r[1],n)]),r=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&r.push(function(e,t,n){const r="event.item";return r+(e&&"*"!==e?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}(t.marktype,t.markname,t.markrole)),t.source===oZ&&r.push("inScope(event.item)"),r.length&&(e.filter=aX("("+r.join(")&&(")+")",n).$expr),null!=(r=t.throttle)&&(e.throttle=+r),null!=(r=t.debounce)&&(e.debounce=+r),t.consume&&(e.consume=!0),e}const yZ={code:"_.$value",ast:{type:"Identifier",value:"value"}};function bZ(e){return{signal:"["+e.map(e=>e.scale?'scale("'+e.scale+'")':e.signal)+"]"}}const xZ=e=>(t,n,r)=>QK(e,n,t||void 0,r),wZ=xZ("aggregate"),_Z=xZ("axisticks"),kZ=xZ("bound"),EZ=xZ("collect"),SZ=xZ("compare"),TZ=xZ("datajoin"),CZ=xZ("encode"),IZ=xZ("expression"),AZ=xZ("facet"),OZ=xZ("field"),DZ=xZ("key"),MZ=xZ("legendentries"),NZ=xZ("load"),jZ=xZ("mark"),FZ=xZ("multiextent"),RZ=xZ("multivalues"),PZ=xZ("overlap"),LZ=xZ("params"),BZ=xZ("prefacet"),$Z=xZ("projection"),zZ=xZ("proxy"),UZ=xZ("relay"),HZ=xZ("render"),WZ=xZ("scale"),VZ=xZ("sieve"),qZ=xZ("sortitems"),GZ=xZ("viewlayout"),YZ=xZ("values");let XZ=0;const KZ={min:"min",max:"max",count:"sum"};function ZZ(e,t){return Em(e)?e.signal?t.signalRef(e.signal):sm("Unsupported object: "+Cg(e)):e}function JZ(e,t){return e.signal?t.signalRef(e.signal):e.map(e=>ZZ(e,t))}function QZ(e){sm("Can not find data set: "+Cg(e))}function eJ(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(km(e)?tJ:e.fields?rJ:nJ)(e,t,n);null==t.domainMin&&null==t.domainMax||sm("No scale domain defined for domainMin/domainMax to override.")}function tJ(e,t,n){return e.map(e=>ZZ(e,n))}function nJ(e,t,n){const r=n.getData(e.data);return r||QZ(e.data),wD(t.type)?r.valuesRef(n,e.field,aJ(e.sort,!1)):SD(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function rJ(e,t,n){const r=e.data,i=e.fields.reduce((e,t)=>(t=bg(t)?{data:r,field:t}:km(t)||t.signal?function(e,t){const n="_:vega:_"+XZ++,r=EZ({});if(km(e))r.value={$ingest:e};else if(e.signal){const i="setdata("+Cg(n)+","+e.signal+")";r.params.input=t.signalRef(i)}return t.addDataPipeline(n,[r,VZ({})]),{data:n,field:"data"}}(t,n):t,e.push(t),e),[]);return(wD(t.type)?iJ:SD(t.type)?oJ:sJ)(e,n,i)}function iJ(e,t,n){const r=aJ(e.sort,!0);let i,a;const o=n.map(e=>{const n=t.getData(e.data);return n||QZ(e.data),n.countsRef(t,e.field,r)}),s={groupby:rZ,pulse:o};r&&(i=r.op||"count",a=r.field?aZ(i,r.field):"count",s.ops=[KZ[i]],s.fields=[t.fieldRef(a)],s.as=[a]),i=t.add(wZ(s));const l=t.add(EZ({pulse:tZ(i)}));return a=t.add(YZ({field:rZ,sort:t.sortRef(r),pulse:tZ(l)})),tZ(a)}function aJ(e,t){return e&&(e.field||e.op?e.field||"count"===e.op?t&&e.field&&e.op&&!KZ[e.op]&&sm("Multiple domain scales can not be sorted using "+e.op):sm("No field provided for sort aggregate op: "+e.op):Em(e)?e.field="key":e={field:"key"}),e}function oJ(e,t,n){const r=n.map(e=>{const n=t.getData(e.data);return n||QZ(e.data),n.domainRef(t,e.field)});return tZ(t.add(RZ({values:r})))}function sJ(e,t,n){const r=n.map(e=>{const n=t.getData(e.data);return n||QZ(e.data),n.extentRef(t,e.field)});return tZ(t.add(FZ({extents:r})))}function lJ(e,t,n){return km(e)?e.map(e=>lJ(e,t,n)):Em(e)?e.signal?n.signalRef(e.signal):"fit"===t?e:sm("Unsupported parameter object: "+Cg(e)):e}const uJ="top",cJ="left",dJ="right",hJ="bottom",fJ="center",pJ="index",mJ="label",gJ="perc",vJ="value",yJ="guide-label",bJ="guide-title",xJ="symbol",wJ="gradient",_J="discrete",kJ="size",EJ=[kJ,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],SJ={name:1,style:1,interactive:1},TJ={value:0},CJ={value:1},IJ="group",AJ="rect",OJ="rule",DJ="text";function MJ(e){return e.type=IJ,e.interactive=e.interactive||!1,e}function NJ(e,t){const n=(n,r)=>cZ(e[n],cZ(t[n],r));return n.isVertical=n=>"vertical"===cZ(e.direction,t.direction||(n?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>cZ(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>cZ(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>cZ(e.columns,cZ(t.columns,+n.isVertical(!0))),n}function jJ(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function FJ(e,t,n){return"item.anchor === '".concat("start","' ? ").concat(e," : item.anchor === '").concat("end","' ? ").concat(t," : ").concat(n)}const RJ=FJ(Cg(cJ),Cg(dJ),Cg(fJ));function PJ(e,t){return t?e?Em(e)?Object.assign({},e,{offset:PJ(e.offset,t)}):{value:e,offset:t}:t:e}function LJ(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=jK(e.encode,t,SJ)):e.interactive=!1,e}function BJ(e,t,n,r){const i=NJ(e,n),a=i.isVertical(),o=i.gradientThickness(),s=i.gradientLength();let l,u,c,d,h;a?(u=[0,1],c=[0,0],d=o,h=s):(u=[0,0],c=[1,0],d=s,h=o);const f={enter:l={opacity:TJ,x:TJ,y:TJ,width:DK(d),height:DK(h)},update:ig({},l,{opacity:CJ,fill:{gradient:t,start:u,stop:c}}),exit:{opacity:TJ}};return NK(f,{stroke:i("gradientStrokeColor"),strokeWidth:i("gradientStrokeWidth")},{opacity:i("gradientOpacity")}),LJ({type:AJ,role:"legend-gradient",encode:f},r)}function $J(e,t,n,r,i){const a=NJ(e,n),o=a.isVertical(),s=a.gradientThickness(),l=a.gradientLength();let u,c,d,h,f="";o?(u="y",d="y2",c="x",h="width",f="1-"):(u="x",d="x2",c="y",h="height");const p={opacity:TJ,fill:{scale:t,field:vJ}};p[u]={signal:f+"datum."+gJ,mult:l},p[c]=TJ,p[d]={signal:f+"datum.perc2",mult:l},p[h]=DK(s);const m={enter:p,update:ig({},p,{opacity:CJ}),exit:{opacity:TJ}};return NK(m,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),LJ({type:AJ,role:"legend-band",key:vJ,from:i,encode:m},r)}const zJ="datum.".concat(gJ,'<=0?"').concat(cJ,'":datum.').concat(gJ,'>=1?"').concat(dJ,'":"').concat(fJ,'"'),UJ="datum.".concat(gJ,'<=0?"').concat(hJ,'":datum.').concat(gJ,'>=1?"').concat(uJ,'":"').concat("middle",'"');function HJ(e,t,n,r){const i=NJ(e,t),a=i.isVertical(),o=DK(i.gradientThickness()),s=i.gradientLength();let l,u,c,d,h=i("labelOverlap"),f="";const p={enter:l={opacity:TJ},update:u={opacity:CJ,text:{field:mJ}},exit:{opacity:TJ}};return NK(p,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:cZ(e.labelLimit,t.gradientLabelLimit)}),a?(l.align={value:"left"},l.baseline=u.baseline={signal:UJ},c="y",d="x",f="1-"):(l.align=u.align={signal:zJ},l.baseline={value:"top"},c="x",d="y"),l[c]=u[c]={signal:f+"datum."+gJ,mult:s},l[d]=u[d]=o,o.offset=cZ(e.labelOffset,t.gradientLabelOffset)||0,h=h?{separation:i("labelSeparation"),method:h,order:"datum.index"}:void 0,LJ({type:DJ,role:BK,style:yJ,key:vJ,from:r,encode:p,overlap:h},n)}function WJ(e,t,n,r,i){const a=NJ(e,t),o=n.entries,s=!(!o||!o.interactive),l=o?o.name:void 0,u=a("clipHeight"),c=a("symbolOffset"),d={data:"value"},h="(".concat(i,") ? datum.").concat("offset"," : datum.").concat(kJ),f=u?DK(u):{field:kJ},p="datum.".concat(pJ),m="max(1, ".concat(i,")");let g,v,y,b,x;f.mult=.5,g={enter:v={opacity:TJ,x:{signal:h,mult:.5,offset:c},y:f},update:y={opacity:CJ,x:v.x,y:v.y},exit:{opacity:TJ}};let w=null,_=null;e.fill||(w=t.symbolBaseFillColor,_=t.symbolBaseStrokeColor),NK(g,{fill:a("symbolFillColor",w),shape:a("symbolType"),size:a("symbolSize"),stroke:a("symbolStrokeColor",_),strokeDash:a("symbolDash"),strokeDashOffset:a("symbolDashOffset"),strokeWidth:a("symbolStrokeWidth")},{opacity:a("symbolOpacity")}),EJ.forEach(t=>{e[t]&&(y[t]=v[t]={scale:e[t],field:vJ})});const k=LJ({type:"symbol",role:"legend-symbol",key:vJ,from:d,clip:!!u||void 0,encode:g},n.symbols),E=DK(c);E.offset=a("labelOffset"),g={enter:v={opacity:TJ,x:{signal:h,offset:E},y:f},update:y={opacity:CJ,text:{field:mJ},x:v.x,y:v.y},exit:{opacity:TJ}},NK(g,{align:a("labelAlign"),baseline:a("labelBaseline"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:a("labelLimit")});const S=LJ({type:DJ,role:BK,style:yJ,key:vJ,from:d,encode:g},n.labels);return g={enter:{noBound:{value:!u},width:TJ,height:u?DK(u):TJ,opacity:TJ},exit:{opacity:TJ},update:y={opacity:CJ,row:{signal:null},column:{signal:null}}},a.isVertical(!0)?(b="ceil(item.mark.items.length / ".concat(m,")"),y.row.signal="".concat(p,"%").concat(b),y.column.signal="floor(".concat(p," / ").concat(b,")"),x={field:["row",p]}):(y.row.signal="floor(".concat(p," / ").concat(m,")"),y.column.signal="".concat(p," % ").concat(m),x={field:p}),y.column.signal="(".concat(i,")?").concat(y.column.signal,":").concat(p),MJ({role:LK,from:r={facet:{data:r,name:"value",groupby:pJ}},encode:jK(g,o,SJ),marks:[k,S],name:l,interactive:s,sort:x})}const VJ='item.orient === "left"',qJ='item.orient === "right"',GJ="(".concat(VJ," || ").concat(qJ,")"),YJ="datum.vgrad && ".concat(GJ),XJ=FJ('"top"','"bottom"','"middle"'),KJ=FJ('"right"','"left"','"center"'),ZJ="datum.vgrad && ".concat(qJ," ? (").concat(KJ,") : (").concat(GJ," && !(datum.vgrad && ").concat(VJ,')) ? "left" : ').concat(RJ),JJ="item._anchor || (".concat(GJ,' ? "middle" : "start")'),QJ="".concat(YJ," ? (").concat(VJ," ? -90 : 90) : 0"),eQ="".concat(GJ," ? (datum.vgrad ? (").concat(qJ,' ? "bottom" : "top") : ').concat(XJ,') : "top"');function tQ(e,t){let n;return Em(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+nQ(e.path)+")":e.sphere&&(n="geoShape("+nQ(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function nQ(e){return Em(e)&&e.signal?e.signal:Cg(e)}function rQ(e){const t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?e.type===IJ?LK:t||RK:t}function iQ(e){return{marktype:e.type,name:e.name||void 0,role:e.role||rQ(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function aQ(e,t){return e&&e.signal?t.signalRef(e.signal):!1!==e}function oQ(e,t){const n=y_(e.type);n||sm("Unrecognized transform type: "+Cg(e.type));const r=QK(n.type.toLowerCase(),null,sQ(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function sQ(e,t,n){const r={},i=e.params.length;for(let a=0;a<i;++a){const i=e.params[a];r[i.name]=lQ(i,t,n)}return r}function lQ(e,t,n){const r=e.type,i=t[e.name];return"index"===r?function(e,t,n){return bg(t.from)||sm('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}(0,t,n):void 0!==i?"param"===r?function(e,t,n){const r=t[e.name];return e.array?(km(r)||sm("Expected an array of sub-parameters. Instead: "+Cg(r)),r.map(t=>cQ(e,t,n))):cQ(e,r,n)}(e,t,n):"projection"===r?n.projectionRef(t[e.name]):e.array&&!lZ(i)?i.map(t=>uQ(e,t,n)):uQ(e,i,n):void(e.required&&sm("Missing required "+Cg(t.type)+" parameter: "+Cg(e.name)))}function uQ(e,t,n){const r=e.type;if(lZ(t))return pQ(r)?sm("Expression references can not be signals."):mQ(r)?n.fieldRef(t):gQ(r)?n.compareRef(t):n.signalRef(t.signal);{const i=e.expr||mQ(r);return i&&dQ(t)?n.exprRef(t.expr,t.as):i&&hQ(t)?nZ(t.field,t.as):pQ(r)?aX(t,n):fQ(r)?tZ(n.getData(t).values):mQ(r)?nZ(t):gQ(r)?n.compareRef(t):t}}function cQ(e,t,n){const r=e.params.length;let i;for(let o=0;o<r;++o){i=e.params[o];for(const e in i.key)if(i.key[e]!==t[e]){i=null;break}if(i)break}i||sm("Unsupported parameter: "+Cg(t));const a=ig(sQ(i,t,n),i.key);return tZ(n.add(LZ(a)))}const dQ=e=>e&&e.expr,hQ=e=>e&&e.field,fQ=e=>"data"===e,pQ=e=>"expr"===e,mQ=e=>"field"===e,gQ=e=>"compare"===e;function vQ(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:tZ(t.getData(e.data).output)}function yQ(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}function bQ(e){return bg(e)?e:null}function xQ(e,t,n){const r=aZ(n.op,n.field);let i;if(t.ops){for(let a=0,o=t.as.length;a<o;++a)if(t.as[a]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function wQ(e,t,n,r,i,a,o){const s=t[n]||(t[n]={}),l=function(e){return Em(e)?("descending"===e.order?"-":"+")+aZ(e.op,e.field):""}(a);let u,c,d=bQ(i);if(null!=d&&(e=t.scope,d+=l?"|"+l:"",u=s[d]),!u){const n=a?{field:rZ,pulse:t.countsRef(e,i,a)}:{field:e.fieldRef(i),pulse:tZ(t.output)};l&&(n.sort=e.sortRef(a)),c=e.add(QK(r,void 0,n)),o&&(t.index[i]=c),u=tZ(c),null!=d&&(s[d]=u)}return u}function _Q(e,t,n){const r=e.remove,i=e.insert,a=e.toggle,o=e.modify,s=e.values,l=t.add(eZ()),u=aX("if("+e.trigger+',modify("'+n+'",'+[i,r,a,o,s].map(e=>null==e?"null":e).join(",")+"),0)",t);l.update=u.$expr,l.params=u.$params}function kQ(e,t){const n=rQ(e),r=e.type===IJ,i=e.from&&e.from.facet,a=e.overlap;let o,s,l,u,c,d,h,f=e.layout||n===LK||n===PK;const p=n===RK||f||i,m=function(e,t,n){let r,i,a,o,s;return e?(r=e.facet)&&(t||sm("Only group marks can be faceted."),null!=r.field?o=s=vQ(r,n):(e.data?s=tZ(n.getData(e.data).aggregate):(a=oQ(ig({type:"aggregate",groupby:Ym(r.groupby)},r.aggregate),n),a.params.key=n.keyRef(r.groupby),a.params.pulse=vQ(r,n),o=s=tZ(n.add(a))),i=n.keyRef(r.groupby,!0))):o=tZ(n.add(EZ(null,[{}]))),o||(o=vQ(e,n)),{key:i,pulse:o,parent:s}}(e.from,r,t);s=t.add(TZ({key:m.key||(e.key?nZ(e.key):void 0),pulse:m.pulse,clean:!r}));const g=tZ(s);s=l=t.add(EZ({pulse:g})),s=t.add(jZ({markdef:iQ(e),interactive:aQ(e.interactive,t),clip:tQ(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:tZ(s)}));const v=tZ(s);s=u=t.add(CZ(qK(e.encode,e.type,n,e.style,t,{mod:!1,pulse:v}))),s.params.parent=t.encode(),e.transform&&e.transform.forEach(e=>{const n=oQ(e,t),r=n.metadata;(r.generates||r.changes)&&sm("Mark transforms should not generate new data."),r.nomod||(u.params.mod=!0),n.params.pulse=tZ(s),t.add(s=n)}),e.sort&&(s=t.add(qZ({sort:t.compareRef(e.sort),pulse:tZ(s)})));const y=tZ(s);(i||f)&&(f=t.add(GZ({layout:t.objectProperty(e.layout),legends:t.legends,mark:v,pulse:y})),d=tZ(f));const b=t.add(kZ({mark:v,pulse:d||y}));h=tZ(b),r&&(p&&(o=t.operators,o.pop(),f&&o.pop()),t.pushState(y,d||h,g),i?function(e,t,n){const r=e.from.facet,i=r.name,a=vQ(r,t);let o;r.name||sm("Facet must have a name: "+Cg(r)),r.data||sm("Facet must reference a data set: "+Cg(r)),r.field?o=t.add(BZ({field:t.fieldRef(r.field),pulse:a})):r.groupby?o=t.add(AZ({key:t.keyRef(r.groupby),group:tZ(t.proxy(n.parent)),pulse:a})):sm("Facet must specify groupby or field: "+Cg(r));const s=t.fork(),l=s.add(EZ()),u=s.add(VZ({pulse:tZ(l)}));s.addData(i,new yQ(s,l,l,u)),s.addSignal("parent",null),o.params.subflow={$subflow:s.parse(e).toRuntime()}}(e,t,m):p?function(e,t,n){const r=t.add(BZ({pulse:n.pulse})),i=t.fork();i.add(VZ()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(e).toRuntime()}}(e,t,m):t.parse(e),t.popState(),p&&(f&&o.push(f),o.push(b))),a&&(h=function(e,t,n){const r=e.method,i=e.bound,a=e.separation,o={separation:lZ(a)?n.signalRef(a.signal):a,method:lZ(r)?n.signalRef(r.signal):r,pulse:t};if(e.order&&(o.sort=n.compareRef({field:e.order})),i){const e=i.tolerance;o.boundTolerance=lZ(e)?n.signalRef(e.signal):+e,o.boundScale=n.scaleRef(i.scale),o.boundOrient=i.orient}return tZ(n.add(PZ(o)))}(a,h,t));const x=t.add(HZ({pulse:h})),w=t.add(VZ({pulse:tZ(x)},void 0,t.parent()));null!=e.name&&(c=e.name,t.addData(c,new yQ(t,l,x,w)),e.on&&e.on.forEach(e=>{(e.insert||e.remove||e.toggle)&&sm("Marks only support modify triggers."),_Q(e,t,c)}))}function EQ(e,t,n){const r={enter:{},update:{}};return NK(r,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),r}function SQ(e,t,n){return t[e]?'scale("'.concat(t[e],'",datum)'):jJ(e,n[0].encode)}yQ.fromEntries=function(e,t){const n=t.length,r=t[n-1],i=t[n-2];let a=t[0],o=null,s=1;for(a&&"load"===a.type&&(a=t[1]),e.add(t[0]);s<n;++s)t[s].params.pulse=tZ(t[s-1]),e.add(t[s]),"aggregate"===t[s].type&&(o=t[s]);return new yQ(e,a,i,r,o)},yQ.prototype={countsRef(e,t,n){const r=this,i=r.counts||(r.counts={}),a=bQ(t);let o,s,l;return null!=a&&(e=r.scope,o=i[a]),o?n&&n.field&&xQ(e,o.agg.params,n):(l={groupby:e.fieldRef(t,"key"),pulse:tZ(r.output)},n&&n.field&&xQ(e,l,n),s=e.add(wZ(l)),o=e.add(EZ({pulse:tZ(s)})),o={agg:s,ref:tZ(o)},null!=a&&(i[a]=o)),o.ref},tuplesRef(){return tZ(this.values)},extentRef(e,t){return wQ(e,this,"extent","extent",t,!1)},domainRef(e,t){return wQ(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return wQ(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return wQ(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return wQ(e,this,"indata","tupleindex",t,!0,!0)}};const TQ='item.orient==="'.concat(cJ,'"?-90:item.orient==="').concat(dJ,'"?90:0');function CQ(e,t){const n={enter:{},update:{}};return NK(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:RJ},angle:{signal:TQ},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),jK(n,t,SJ)}function IQ(e){const t=EZ({},e);return t.metadata={source:!0},t}function AQ(e,t){return NZ({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const OQ=e=>e===hJ||e===uJ,DQ=(e,t,n)=>lZ(e)?PQ(e.signal,t,n):e===cJ||e===uJ?t:n,MQ=(e,t,n)=>lZ(e)?FQ(e.signal,t,n):OQ(e)?t:n,NQ=(e,t,n)=>lZ(e)?RQ(e.signal,t,n):OQ(e)?n:t,jQ=(e,t,n)=>lZ(e)?LQ(e.signal,t,n):e===uJ?{value:t}:{value:n},FQ=(e,t,n)=>BQ("".concat(e," === '").concat(uJ,"' || ").concat(e," === '").concat(hJ,"'"),t,n),RQ=(e,t,n)=>BQ("".concat(e," !== '").concat(uJ,"' && ").concat(e," !== '").concat(hJ,"'"),t,n),PQ=(e,t,n)=>zQ("".concat(e," === '").concat(cJ,"' || ").concat(e," === '").concat(uJ,"'"),t,n),LQ=(e,t,n)=>zQ("".concat(e," === '").concat(uJ,"'"),t,n),BQ=(e,t,n)=>(t=null!=t?DK(t):t,n=null!=n?DK(n):n,$Q(t)&&$Q(n)?(t=t?t.signal||Cg(t.value):null,n=n?n.signal||Cg(n.value):null,{signal:"".concat(e," ? (").concat(t,") : (").concat(n,")")}):[ig({test:e},t)].concat(n||[])),$Q=e=>null==e||1===Object.keys(e).length,zQ=(e,t,n)=>({signal:"".concat(e," ? (").concat(UQ(t),") : (").concat(UQ(n),")")}),UQ=e=>lZ(e)?e.signal:null==e?null:Cg(e),HQ=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function WQ(e,t,n,r){let i;if(t&&lg(t,e))return t[e];if(lg(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r["guide-title"][i]}if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r["guide-label"][i]}return null}function VQ(e){const t={};for(const n of e)if(n)for(const e in n)t[e]=1;return Object.keys(t)}function qQ(e,t){return{scale:e.scale,range:t}}function GQ(e,t,n,r,i){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function YQ(e,t){const n=function(e,t){var n,r,i,a,o,s,l,u,c=t.config,d=c.style,h=c.axis,f="band"===t.scaleType(e.scale)&&c.axisBand,p=e.orient;if(lZ(p)){const e=VQ([c.axisX,c.axisY]),t=VQ([c.axisTop,c.axisBottom,c.axisLeft,c.axisRight]);for(i of(n={},e))n[i]=MQ(p,WQ(i,c.axisX,h,d),WQ(i,c.axisY,h,d));for(i of(r={},t))r[i]=(a=p.signal,o=WQ(i,c.axisTop,h,d),s=WQ(i,c.axisBottom,h,d),l=WQ(i,c.axisLeft,h,d),u=WQ(i,c.axisRight,h,d),{signal:(null!=l?"".concat(a," === '").concat(cJ,"' ? (").concat(UQ(l),") : "):"")+(null!=s?"".concat(a," === '").concat(hJ,"' ? (").concat(UQ(s),") : "):"")+(null!=u?"".concat(a," === '").concat(dJ,"' ? (").concat(UQ(u),") : "):"")+(null!=o?"".concat(a," === '").concat(uJ,"' ? (").concat(UQ(o),") : "):"")+"(null)"})}else n=p===uJ||p===hJ?c.axisX:c.axisY,r=c["axis"+p[0].toUpperCase()+p.slice(1)];return n||r||f?ig({},h,n,r,f):h}(e,t),r=e.encode||{},i=r.axis||{},a=i.name||void 0,o=i.interactive,s=i.style,l=NJ(e,n),u=function(e){const t=e("tickBand");let n,r,i=e("tickOffset");return t?t.signal?(n={signal:"(".concat(t.signal,") === 'extent' ? 1 : 0.5")},r={signal:"(".concat(t.signal,") === 'extent'")},Em(i)||(i={signal:"(".concat(t.signal,") === 'extent' ? 0 : ").concat(i)})):"extent"===t?(n=1,r=!0,i=0):(n=.5,r=!1):(n=e("bandPosition"),r=e("tickExtra")),{extra:r,band:n,offset:i}}(l),c={scale:e.scale,ticks:!!l("ticks"),labels:!!l("labels"),grid:!!l("grid"),domain:!!l("domain"),title:null!=e.title},d=tZ(t.add(EZ({},[c]))),h=tZ(t.add(_Z({scale:t.scaleRef(e.scale),extra:t.property(u.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),f=[];let p;return c.grid&&f.push(function(e,t,n,r,i){const a=NJ(e,t),o=e.orient,s=e.gridScale,l=DQ(o,1,-1),u=function(e,t){if(1===t);else if(Em(e)){let n=e=ig({},e);for(;null!=n.mult;){if(!Em(n.mult))return n.mult=lZ(t)?{signal:"(".concat(n.mult,") * (").concat(t.signal,")")}:n.mult*t,e;n=n.mult=ig({},n.mult)}n.mult=t}else e=lZ(t)?{signal:"(".concat(t.signal,") * (").concat(e||0,")")}:t*(e||0);return e}(e.offset,l);let c,d,h;const f={enter:c={opacity:TJ},update:h={opacity:CJ},exit:d={opacity:TJ}};NK(f,{stroke:a("gridColor"),strokeCap:a("gridCap"),strokeDash:a("gridDash"),strokeDashOffset:a("gridDashOffset"),strokeOpacity:a("gridOpacity"),strokeWidth:a("gridWidth")});const p={scale:e.scale,field:vJ,band:i.band,extra:i.extra,offset:i.offset,round:a("tickRound")},m=MQ(o,{signal:"height"},{signal:"width"}),g=s?{scale:s,range:0,mult:l,offset:u}:{value:0,offset:u},v=s?{scale:s,range:1,mult:l,offset:u}:ig(m,{mult:l,offset:u});return c.x=h.x=MQ(o,p,g),c.y=h.y=NQ(o,p,g),c.x2=h.x2=NQ(o,v),c.y2=h.y2=MQ(o,v),d.x=MQ(o,p),d.y=NQ(o,p),LJ({type:OJ,role:"axis-grid",key:vJ,from:r,encode:f},n)}(e,n,r.grid,h,u)),c.ticks&&(p=l("tickSize"),f.push(function(e,t,n,r,i,a){const o=NJ(e,t),s=e.orient,l=DQ(s,-1,1);let u,c,d;const h={enter:u={opacity:TJ},update:d={opacity:CJ},exit:c={opacity:TJ}};NK(h,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const f=DK(i);f.mult=l;const p={scale:e.scale,field:vJ,band:a.band,extra:a.extra,offset:a.offset,round:o("tickRound")};return d.y=u.y=MQ(s,TJ,p),d.y2=u.y2=MQ(s,f),c.x=MQ(s,p),d.x=u.x=NQ(s,TJ,p),d.x2=u.x2=NQ(s,f),c.y=NQ(s,p),LJ({type:OJ,role:"axis-tick",key:vJ,from:r,encode:h},n)}(e,n,r.ticks,h,p,u))),c.labels&&(p=c.ticks?p:0,f.push(function(e,t,n,r,i,a){const o=NJ(e,t),s=e.orient,l=e.scale,u=DQ(s,-1,1),c=dZ(o("labelFlush")),d=dZ(o("labelFlushOffset")),h=o("labelAlign"),f=o("labelBaseline");let p,m=0===c||!!c;const g=DK(i);g.mult=u,g.offset=DK(o("labelPadding")||0),g.offset.mult=u;const v={scale:l,field:vJ,band:.5,offset:PJ(a.offset,o("labelOffset"))},y=MQ(s,m?GQ(l,c,'"left"','"right"','"center"'):{value:"center"},((e,t,n)=>lZ(e)?zQ("".concat(e.signal," === '").concat(dJ,"'"),"left","right"):e===dJ?{value:t}:{value:n})(s,"left","right")),b=MQ(s,jQ(s,"bottom","top"),m?GQ(l,c,'"top"','"bottom"','"middle"'):{value:"middle"}),x=GQ(l,c,"-(".concat(d,")"),d,0);m=m&&d;const w={opacity:TJ,x:MQ(s,v,g),y:NQ(s,v,g)},_={enter:w,update:p={opacity:CJ,text:{field:mJ},x:w.x,y:w.y,align:y,baseline:b},exit:{opacity:TJ,x:w.x,y:w.y}};NK(_,{dx:!h&&m?MQ(s,x):null,dy:!f&&m?NQ(s,x):null}),NK(_,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:h,baseline:f});const k=o("labelBound");let E=o("labelOverlap");return E=E||k?{separation:o("labelSeparation"),method:E,order:"datum.index",bound:k?{scale:l,orient:s,tolerance:k}:null}:void 0,p.align!==y&&(p.align=HQ(p.align,y)),p.baseline!==b&&(p.baseline=HQ(p.baseline,b)),LJ({type:DJ,role:"axis-label",style:yJ,key:vJ,from:r,encode:_,overlap:E},n)}(e,n,r.labels,h,p,u))),c.domain&&f.push(function(e,t,n,r){const i=NJ(e,t),a=e.orient;let o,s;const l={enter:o={opacity:TJ},update:s={opacity:CJ},exit:{opacity:TJ}};NK(l,{stroke:i("domainColor"),strokeCap:i("domainCap"),strokeDash:i("domainDash"),strokeDashOffset:i("domainDashOffset"),strokeWidth:i("domainWidth"),strokeOpacity:i("domainOpacity")});const u=qQ(e,0),c=qQ(e,1);return o.x=s.x=MQ(a,u,TJ),o.x2=s.x2=MQ(a,c),o.y=s.y=NQ(a,u,TJ),o.y2=s.y2=NQ(a,c),LJ({type:OJ,role:"axis-domain",from:r,encode:l},n)}(e,n,r.domain,d)),c.title&&f.push(function(e,t,n,r){const i=NJ(e,t),a=e.orient,o=DQ(a,-1,1);let s,l;const u={enter:s={opacity:TJ,anchor:DK(i("titleAnchor",null)),align:{signal:RJ}},update:l=ig({},s,{opacity:CJ,text:DK(e.title)}),exit:{opacity:TJ}},c={signal:'lerp(range("'.concat(e.scale,'"), ').concat(FJ(0,1,.5),")")};return l.x=MQ(a,c),l.y=NQ(a,c),s.angle=MQ(a,TJ,((e,t)=>lZ(e)?{signal:"(".concat(e.signal,") * ").concat(90)}:{value:90*e})(o)),s.baseline=MQ(a,jQ(a,hJ,uJ),{value:hJ}),l.angle=s.angle,l.baseline=s.baseline,NK(u,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),function(e,t,n,r){const i=(e,t)=>null!=e?(n.update[t]=HQ(DK(e),n.update[t]),!1):!FK(t,r),a=i(e("titleX"),"x"),o=i(e("titleY"),"y");n.enter.auto=o===a?DK(o):MQ(t,DK(o),DK(a))}(i,a,u,n),u.update.align=HQ(u.update.align,s.align),u.update.angle=HQ(u.update.angle,s.angle),u.update.baseline=HQ(u.update.baseline,s.baseline),LJ({type:DJ,role:"axis-title",style:bJ,from:r,encode:u},n)}(e,n,r.title,d)),kQ(MJ({role:"axis",from:d,encode:jK(XQ(l,e),i,SJ),marks:f,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:a,interactive:o,style:s}),t)}function XQ(e,t){const n={enter:{},update:{}};return NK(n,{orient:e("orient"),offset:e("offset")||0,position:cZ(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:'abs(span(range("'.concat(t.scale,'")))')},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function KQ(e,t,n){const r=Ym(e.signals),i=Ym(e.scales);return n||r.forEach(e=>ZK(e,t)),Ym(e.projections).forEach(e=>function(e,t){const n=t.config.projection||{},r={};for(const i in e)"name"!==i&&(r[i]=lJ(e[i],i,t));for(const i in n)null==r[i]&&(r[i]=lJ(n[i],i,t));t.addProjection(e.name,r)}(e,t)),i.forEach(e=>function(e,t){const n=e.type||"linear";yD(n)||sm("Unrecognized scale type: "+Cg(n)),t.addScale(e.name,{type:n,domain:void 0})}(e,t)),Ym(e.data).forEach(e=>function(e,t){const n=[];e.transform&&e.transform.forEach(e=>{n.push(oQ(e,t))}),e.on&&e.on.forEach(n=>{_Q(n,t,e.name)}),t.addDataPipeline(e.name,function(e,t,n){const r=[];let i,a,o,s,l,u=null,c=!1,d=!1;for(e.values?uZ(e.values)||uZ(e.format)?(r.push(AQ(t,e)),r.push(u=IQ())):r.push(u=IQ({$ingest:e.values,$format:e.format})):e.url?uZ(e.url)||uZ(e.format)?(r.push(AQ(t,e)),r.push(u=IQ())):r.push(u=IQ({$request:e.url,$format:e.format})):e.source&&(u=i=Ym(e.source).map(e=>tZ(t.getData(e).output)),r.push(null)),a=0,o=n.length;a<o;++a)s=n[a],l=s.metadata,u||l.source||r.push(u=IQ()),r.push(s),l.generates&&(d=!0),l.modifies&&!d&&(c=!0),l.source?u=s:l.changes&&(u=null);return i&&(o=i.length-1,r[0]=UZ({derive:c,pulse:o?i:i[0]}),(c||o)&&r.splice(1,0,IQ())),u||r.push(IQ()),r.push(VZ({})),r}(e,t,n))}(e,t)),i.forEach(e=>function(e,t){const n=t.getScale(e.name).params;let r;var i;for(r in n.domain=eJ(e.domain,e,t),null!=e.range&&(n.range=function e(t,n,r){const i=n.config.range;let a=t.range;if(a.signal)return n.signalRef(a.signal);if(bg(a)){if(i&&lg(i,a))return e(t=ig({},t,{range:i[a]}),n,r);"width"===a?a=[0,{signal:"width"}]:"height"===a?a=wD(t.type)?[0,{signal:"height"}]:[{signal:"height"},0]:sm("Unrecognized scale range value: "+Cg(a))}else{if(a.scheme)return r.scheme=km(a.scheme)?JZ(a.scheme,n):ZZ(a.scheme,n),a.extent&&(r.schemeExtent=JZ(a.extent,n)),void(a.count&&(r.schemeCount=ZZ(a.count,n)));if(a.step)return void(r.rangeStep=ZZ(a.step,n));if(wD(t.type)&&!km(a))return eJ(a,t,n);km(a)||sm("Unsupported range type: "+Cg(a))}return a.map(e=>(km(e)?JZ:ZZ)(e,n))}(e,t,n)),null!=e.interpolate&&function(e,t){t.interpolate=ZZ(e.type||e),null!=e.gamma&&(t.interpolateGamma=ZZ(e.gamma))}(e.interpolate,n),null!=e.nice&&(n.nice=Em(i=e.nice)?{interval:ZZ(i.interval),step:ZZ(i.step)}:ZZ(i)),null!=e.bins&&(n.bins=function(e,t){return e.signal||km(e)?JZ(e,t):t.objectProperty(e)}(e.bins,t)),e)lg(n,r)||"name"===r||(n[r]=ZZ(e[r],t))}(e,t)),(n||r).forEach(e=>function(e,t){const n=t.getSignal(e.name);let r=e.update;e.init&&(r?sm("Signals can not include both init and update expressions."):(r=e.init,n.initonly=!0)),r&&(r=aX(r,t),n.update=r.$expr,n.params=r.$params),e.on&&e.on.forEach(e=>function(e,t,n){const r=e.encode,i={target:n};let a=e.events,o=e.update,s=[];a||sm("Signal update missing events specification."),bg(a)&&(a=EK(a,t.isSubscope()?oZ:sZ)),a=Ym(a).filter(e=>e.signal||e.scale?(s.push(e),0):1),s.length>1&&(s=[bZ(s)]),a.length&&s.push(a.length>1?{merge:a}:a[0]),null!=r&&(o&&sm("Signal encode and update are mutually exclusive."),o="encode(item(),"+Cg(r)+")"),i.update=bg(o)?aX(o,t):null!=o.expr?aX(o.expr,t):null!=o.value?o.value:null!=o.signal?{$expr:yZ,$params:{$value:t.signalRef(o.signal)}}:sm("Invalid signal update specification."),e.force&&(i.options={force:!0}),s.forEach(e=>t.addUpdate(ig(function(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):fZ(e,t)}}(e,t),i)))}(e,t,n.id))}(e,t)),Ym(e.axes).forEach(e=>YQ(e,t)),Ym(e.marks).forEach(e=>kQ(e,t)),Ym(e.legends).forEach(e=>function(e,t){const n=t.config.legend,r=e.encode||{},i=NJ(e,n),a=r.legend||{},o=a.name||void 0,s=a.interactive,l=a.style,u={};let c,d,h,f=0;EJ.forEach(t=>e[t]?(u[t]=e[t],f=f||e[t]):0),f||sm("Missing valid scale for legend.");const p=function(e,t){let n=e.type||xJ;return e.type||1!==function(e){return EJ.reduce((t,n)=>t+(e[n]?1:0),0)}(e)||!e.fill&&!e.stroke||(n=xD(t)?wJ:_D(t)?_J:xJ),n!==wJ?n:_D(t)?_J:wJ}(e,t.scaleType(f)),m={title:null!=e.title,scales:u,type:p,vgrad:"symbol"!==p&&i.isVertical()},g=tZ(t.add(EZ(null,[m]))),v=tZ(t.add(MZ(d={type:p,scale:t.scaleRef(f),count:t.objectProperty(i("tickCount")),limit:t.property(i("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return p===wJ?(h=[BJ(e,f,n,r.gradient),HJ(e,n,r.labels,v)],d.count=d.count||t.signalRef("max(2,2*floor((".concat(dZ(i.gradientLength()),")/100))"))):p===_J?h=[$J(e,f,n,r.gradient,v),HJ(e,n,r.labels,v)]:(c=function(e,t){const n=NJ(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(e,n),h=[WJ(e,n,r,v,dZ(c.columns))],d.size=function(e,t,n){const r=dZ(SQ("size",e,n)),i=dZ(SQ("strokeWidth",e,n)),a=dZ(function(e,t,n){return jJ("fontSize",e)||function(e,t,n){const r=t.config.style["guide-label"];return r&&r.fontSize}(0,t)}(n[1].encode,t));return aX("max(ceil(sqrt(".concat(r,")+").concat(i,"),").concat(a,")"),t)}(e,t,h[0].marks)),h=[MJ({role:"legend-entry",from:g,encode:{enter:{x:{value:0},y:{value:0}}},marks:h,layout:c,interactive:s})],m.title&&h.push(function(e,t,n,r){const i=NJ(e,t),a={enter:{opacity:TJ},update:{opacity:CJ,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:TJ}};return NK(a,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:JJ},angle:{signal:QJ},align:{signal:ZJ},baseline:{signal:eQ},text:e.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")}),LJ({type:DJ,role:"legend-title",style:bJ,from:r,encode:a},n)}(e,n,r.title,g)),kQ(MJ({role:"legend",from:g,encode:jK(EQ(i,e,n),a,SJ),marks:h,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:o,interactive:s,style:l}),t)}(e,t)),e.title&&function(e,t){const n=NJ(e=bg(e)?{text:e}:e,t.config.title),r=e.encode||{},i=r.group||{},a=i.name||void 0,o=i.interactive,s=i.style,l=[],u=tZ(t.add(EZ(null,[{}])));l.push(function(e,t,n,r){const i={value:0},a={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return NK(a,{text:e.text,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),LJ({type:DJ,role:"title-text",style:"group-title",from:r,encode:a},n)}(e,n,function(e){const t=e.encode;return t&&t.title||ig({name:e.name,interactive:e.interactive,style:e.style},t)}(e),u)),e.subtitle&&l.push(function(e,t,n,r){const i={value:0},a={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return NK(a,{text:e.subtitle,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),LJ({type:DJ,role:"title-subtitle",style:"group-subtitle",from:r,encode:a},n)}(e,n,r.subtitle,u)),kQ(MJ({role:"title",from:u,encode:CQ(n,i),marks:l,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:o,style:s}),t)}(e.title,t),t.parseLambdas(),t}function ZQ(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function JQ(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function QQ(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function e0(e){return(km(e)?t0:n0)(e)}function t0(e){const t=e.length;let n="[";for(let r=0;r<t;++r){const t=e[r];n+=(r>0?",":"")+(Em(t)?t.signal||e0(t):Cg(t))}return n+"]"}function n0(e){let t,n,r="{",i=0;for(t in e)n=e[t],r+=(++i>1?",":"")+Cg(t)+":"+(Em(n)?n.signal||e0(n):Cg(n));return r+"}"}function r0(e,t,n){return Em(e)||sm("Input Vega specification must be an object."),function(e,t){const n=t.config,r=tZ(t.root=t.add(eZ())),i=function(e,t){const n=n=>cZ(e[n],t[n]),r=[ZQ("background",n("background")),ZQ("autosize",IK(n("autosize"))),ZQ("padding",OK(n("padding"))),ZQ("width",n("width")||0),ZQ("height",n("height")||0)],i=r.reduce((e,t)=>(e[t.name]=t,e),{}),a={};return Ym(e.signals).forEach(e=>{lg(i,e.name)?e=ig(i[e.name],e):r.push(e),a[e.name]=e}),Ym(t.signals).forEach(e=>{lg(a,e.name)||lg(i,e.name)||r.push(e)}),r}(e,n);i.forEach(e=>ZK(e,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const a=t.add(EZ()),o=t.add(CZ(qK((e=>jK({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e))(e.encode),IJ,PK,e.style,t,{pulse:tZ(a)}))),s=t.add(GZ({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:tZ(o)}));t.operators.pop(),t.pushState(tZ(o),tZ(s),null),KQ(e,t,i),t.operators.push(s);let l=t.add(kZ({mark:r,pulse:tZ(s)}));return l=t.add(HZ({pulse:tZ(l)})),l=t.add(VZ({pulse:tZ(l)})),t.addData("root",new yQ(t,a,a,l)),t}(e,new JQ(t=Tm(function(){const e="sans-serif",t="#4c78a8",n="#000",r="#888",i="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:t},area:{fill:t},image:null,line:{stroke:t,strokeWidth:2},path:{stroke:t},rect:{fill:t},rule:{stroke:n},shape:{stroke:t},symbol:{fill:t,size:64},text:{fill:n,font:e,fontSize:11},trail:{fill:t,size:2},style:{"guide-label":{fill:n,font:e,fontSize:10},"guide-title":{fill:n,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:n,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:n,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:i}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:r,grid:!1,gridWidth:1,gridColor:i,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:r,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:i,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:r,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}(),t,e.config),n)).toRuntime()}JQ.prototype=QQ.prototype={parse(e){return KQ(e,this)},fork(){return new QQ(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof JK?tZ(e):e;return this.add(zZ({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(e,t,n){let r,i;e&&(r=e.data||(e.data={}),i=r[t]||(r[t]=[]),i.push(n))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const r in t.index)n(t.index[r],e,"index:"+r)}return this},pushState(e,t,n){this._encode.push(tZ(this.add(VZ({pulse:e})))),this._parent.push(t),this._lookup.push(n?tZ(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return Am(this._parent)},encode(){return Am(this._encode)},lookup(){return Am(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(bg(e))return nZ(e,t);e.signal||sm("Unsupported field reference: "+Cg(e));const n=e.signal;let r=this.field[n];if(!r){const e={name:this.signalRef(n)};t&&(e.as=t),this.field[n]=r=tZ(this.add(OZ(e)))}return r},compareRef(e){let t=!1;const n=e=>lZ(e)?(t=!0,this.signalRef(e.signal)):function(e){return e&&e.expr}(e)?(t=!0,this.exprRef(e.expr)):e,r=Ym(e.field).map(n),i=Ym(e.order).map(n);return t?tZ(this.add(SZ({fields:r,orders:i}))):iZ(r,i)},keyRef(e,t){let n=!1;const r=this.signals;return e=Ym(e).map(e=>lZ(e)?(n=!0,tZ(r[e.signal])):e),n?tZ(this.add(DZ({fields:e,flat:t}))):function(e,t){const n={$key:e};return t&&(n.$flat=!0),n}(e,t)},sortRef(e){if(!e)return e;const t=aZ(e.op,e.field),n=e.order||"ascending";return n.signal?tZ(this.add(SZ({fields:t,orders:this.signalRef(n.signal)}))):iZ(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},hasOwnSignal(e){return lg(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&sm("Duplicate signal name: "+Cg(e));const n=t instanceof JK?t:this.add(eZ(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||sm("Unrecognized signal name: "+Cg(e)),this.signals[e]},signalRef(e){return this.signals[e]?tZ(this.signals[e]):(lg(this.lambdas,e)||(this.lambdas[e]=this.add(eZ(null))),tZ(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const n=e[t],r=aX(n,this),i=this.lambdas[n];i.params=r.$params,i.update=r.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&Em(e)?this.signalRef(e.signal||e0(e)):e},exprRef(e,t){const n={expr:aX(e,this)};return t&&(n.expr.$name=t),tZ(this.add(IZ(n)))},addBinding(e,t){this.bindings||sm("Nested signals do not support binding: "+Cg(e)),this.bindings.push(ig({signal:e},t))},addScaleProj(e,t){lg(this.scales,e)&&sm("Duplicate scale or projection name: "+Cg(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,WZ(t))},addProjection(e,t){this.addScaleProj(e,$Z(t))},getScale(e){return this.scales[e]||sm("Unrecognized scale name: "+Cg(e)),this.scales[e]},scaleRef(e){return tZ(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return lg(this.data,e)&&sm("Duplicate data set name: "+Cg(e)),this.data[e]=t},getData(e){return this.data[e]||sm("Undefined data set name: "+Cg(e)),this.data[e]},addDataPipeline(e,t){return lg(this.data,e)&&sm("Duplicate data set name: "+Cg(e)),this.addData(e,yQ.fromEntries(this,t))}};var i0="5.17.3";ig(v_,a,s,l,u,c,h,d,f,p,m,g);var a0=n("qHvB");Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var o0=n("JBAE"),s0=n.n(o0),l0=n("aUsF"),u0=n.n(l0),c0=n("9x6x"),d0=n.n(c0);function h0(e){return!!e.or}function f0(e){return!!e.and}function p0(e){return!!e.not}function m0(e,t){return p0(e)?{not:m0(e.not,t)}:f0(e)?{and:e.and.map(e=>m0(e,t))}:h0(e)?{or:e.or.map(e=>m0(e,t))}:t(e)}const g0=u0.a,v0=s0.a;function y0(e,t){const n={};for(const r of t)lg(e,r)&&(n[r]=e[r]);return n}function b0(e,t){const n=Object.assign({},e);for(const r of t)delete n[r];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>d0()(e)).join(",")})`};const x0=d0.a;function w0(e){if(vg(e))return e;const t=bg(e)?e:d0()(e);if(t.length<250)return t;let n=0;for(let r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r),n&=n;return n}function _0(e){return!1===e||null===e}function k0(e,t){return e.indexOf(t)>-1}function E0(e,t){let n=0;for(const[r,i]of e.entries())if(t(i,r,n++))return!0;return!1}function S0(e,t){let n=0;for(const[r,i]of e.entries())if(!t(i,r,n++))return!1;return!0}function T0(e,...t){for(const n of t)C0(e,null!=n?n:{});return e}function C0(e,t){for(const n of F0(t))Cm(e,n,t[n],!0)}function I0(e,t){const n=[],r={};let i;for(const a of e)i=t(a),i in r||(r[i]=1,n.push(a));return n}function A0(e,t){const n=F0(e),r=F0(t);if(n.length!==r.length)return!1;for(const i of n)if(e[i]!==t[i])return!1;return!0}function O0(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function D0(e,t){for(const n of e)if(t.has(n))return!0;return!1}function M0(e){const t=new Set;for(const n of e){const e=lm(n).map((e,t)=>0===t?e:`[${e}]`),r=e.map((t,n)=>e.slice(0,n+1).join(""));for(const n of r)t.add(n)}return t}function N0(e,t){return void 0===e||void 0===t||D0(M0(e),M0(t))}function j0(e){return 0===F0(e).length}const F0=Object.keys,R0=Object.values,P0=Object.entries;function L0(e){return!0===e||!1===e}function B0(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function $0(e,t){return p0(e)?"!("+$0(e.not,t)+")":f0(e)?"("+e.and.map(e=>$0(e,t)).join(") && (")+")":h0(e)?"("+e.or.map(e=>$0(e,t)).join(") || (")+")":t(e)}function z0(e,t){if(0===t.length)return!0;const n=t.shift();return n in e&&z0(e[n],t)&&delete e[n],j0(e)}function U0(e){return e.charAt(0).toUpperCase()+e.substr(1)}function H0(e,t="datum"){const n=lm(e),r=[];for(let i=1;i<=n.length;i++){const e=`[${n.slice(0,i).map(Cg).join("][")}]`;r.push(`${t}${e}`)}return r.join(" && ")}function W0(e,t="datum"){return`${t}[${Cg(lm(e).join("."))}]`}function V0(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function q0(e){return""+lm(e).map(V0).join("\\.")}function G0(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function Y0(e){return""+lm(e).join(".")}function X0(e){return e?lm(e).length:0}function K0(...e){for(const t of e)if(void 0!==t)return t}let Z0=42;function J0(e){const t=++Z0;return e?String(e)+t:t}function Q0(){Z0=42}function e1(e){return t1(e)?e:"__"+e}function t1(e){return 0===e.indexOf("__")}function n1(e){if(void 0!==e)return(e%360+360)%360}function r1(e){return!!vg(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const i1={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function a1(e){return e&&e.condition}const o1=["domain","grid","labels","ticks","title"],s1={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},l1={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},u1=Object.assign(Object.assign({},l1),{style:1,labelExpr:1,encoding:1});function c1(e){return!!u1[e]}F0(u1);const d1=F0({axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1}),h1={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},f1={count:1,min:1,max:1};function p1(e){return!!e&&!!e.argmin}function m1(e){return!!e&&!!e.argmax}function g1(e){return bg(e)&&!!h1[e]}F0(h1);const v1=["count","valid","missing","distinct"];function y1(e){return bg(e)&&k0(v1,e)}const b1=["count","sum","distinct","valid","missing"],x1=Mg(["mean","average","median","q1","q3","min","max"]);var w1=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const _1="row",k1="column",E1="facet",S1="x",T1="y",C1="x2",I1="y2",A1="radius",O1="radius2",D1="theta",M1="theta2",N1="latitude",j1="longitude",F1="latitude2",R1="longitude2",P1="color",L1="fill",B1="stroke",$1="shape",z1="size",U1="angle",H1="opacity",W1="fillOpacity",V1="strokeOpacity",q1="strokeWidth",G1="strokeDash",Y1="text",X1="order",K1="detail",Z1="key",J1="tooltip",Q1="href",e2="url",t2="description",n2={theta:1,theta2:1,radius:1,radius2:1};function r2(e){return e in n2}const i2={longitude:1,longitude2:1,latitude:1,latitude2:1},a2=F0(i2),o2=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),n2),i2),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function s2(e){return e===P1||e===L1||e===B1}const l2={row:1,column:1,facet:1},u2=F0(l2),c2=Object.assign(Object.assign({},o2),l2),d2=F0(c2),h2=w1(c2,["order","detail","tooltip"]),f2=w1(h2,["row","column","facet"]);function p2(e){return!!c2[e]}F0(h2),F0(f2);const m2=[C1,I1,F1,R1,M1,O1];function g2(e){return v2(e)!==e}function v2(e){switch(e){case C1:return S1;case I1:return T1;case F1:return N1;case R1:return j1;case M1:return D1;case O1:return A1}return e}function y2(e){if(r2(e))switch(e){case D1:return"startAngle";case M1:return"endAngle";case A1:return"outerRadius";case O1:return"innerRadius"}return e}function b2(e){switch(e){case S1:return C1;case T1:return I1;case N1:return F1;case j1:return R1;case D1:return M1;case A1:return O1}}function x2(e){switch(e){case S1:case C1:return"width";case T1:case I1:return"height"}}F0(o2);const w2=w1(o2,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),_2=F0(w2),k2={x:1,y:1},E2=F0(k2);function S2(e){return e in k2}const T2={theta:1,radius:1},C2=F0(T2);function I2(e){return"width"===e?S1:T1}const A2=w1(w2,["text","tooltip","href","url","description","detail","key","order"]),O2=F0(A2),D2=Object.assign(Object.assign(Object.assign({},k2),T2),A2),M2=F0(D2);function N2(e){return!!D2[e]}const j2={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},F2=w1(j2,["geoshape"]);function R2(e){switch(e){case S1:case T1:case D1:case A1:case z1:case U1:case q1:case H1:case W1:case V1:case C1:case I1:case M1:case O1:return;case E1:case _1:case k1:case $1:case G1:case Y1:case J1:case Q1:case e2:case t2:return"discrete";case P1:case L1:case B1:return"flexible";case N1:case j1:case F1:case R1:case K1:case Z1:case X1:return}}function P2(e){return pg(e)&&(e=a8(e,void 0)),"bin"+F0(e).map(t=>z2(e[t])?B0(`_${t}_${P0(e[t])}`):B0(`_${t}_${e[t]}`)).join("")}function L2(e){return!0===e||$2(e)&&!e.binned}function B2(e){return"binned"===e||$2(e)&&!0===e.binned}function $2(e){return Em(e)}function z2(e){return null==e?void 0:e.selection}function U2(e){switch(e){case _1:case k1:case z1:case P1:case L1:case B1:case q1:case H1:case W1:case V1:case $1:return 6;case G1:return 4;default:return 10}}function H2(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const W2='Autosize "fit" only works for single views and layered views.';function V2(e){return("width"==e?"Width":"Height")+' "container" only works for single views and layered views.'}function q2(e){return`${"width"==e?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${"width"==e?"x":"y"}".`}function G2(e){return e?`Dropping "fit-${e}" because spec has discrete ${x2(e)}.`:'Dropping "fit" because spec has discrete size.'}function Y2(e){return`Unknown field for ${e}. Cannot calculate view size.`}function X2(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function K2(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function Z2(e){return`The "nearest" transform is not supported for ${e} marks.`}function J2(e){return`Selection not supported for ${e} yet.`}function Q2(e){return`Cannot find a selection named "${e}".`}const e5="Scale bindings are currently only supported for scales with unbinned, continuous domains.",t5="Legend bindings are only supported for selections over an individual field or encoding channel.";function n5(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}const r5="The same selection must be used to override scale domains in a layered view.",i5='Interval selections should be initialized using "x" and/or "y" keys.';function a5(e){return`Unknown repeated value "${e}".`}function o5(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const s5="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function l5(e){return`Unrecognized parse "${e}".`}function u5(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}const c5="Attempt to add the same child twice.";function d5(e){return`Ignoring an invalid transform: ${x0(e)}.`}const h5='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function f5(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function p5(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${x0(t)} is overridden by a child projection ${x0(n)}.`}const m5="Arc marks uses theta channel rather than angle, replacing angle with theta.";function g5(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${x0(n)}}.`}function v5(e){return`Invalid field type "${e}".`}function y5(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function b5(e){return`Invalid aggregation operator "${e}".`}function x5(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}function w5(e,t){const{fill:n,stroke:r}=t;return`Dropping color ${e} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function _5(e,t){return`Dropping ${x0(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}function k5(e,t,n){return`${e}-encoding with type ${t} is deprecated. Replacing with ${n}-encoding.`}const E5="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function S5(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?" when "+n:""}.`}function T5(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function C5(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}function I5(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function A5(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${"ordinal"===t?"order":"magnitude"}.`}function O5(e){return`The ${e} for range marks cannot be an expression`}function D5(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function M5(e,t){return`Specified orient "${e}" overridden with "${t}".`}const N5="Custom domain scale cannot be unioned with default field-based domain.",j5='Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.';function F5(e){return`Cannot use the scale property "${e}" with non-color channel.`}function R5(e){return`Using unaggregated domain with raw field has no effect (${x0(e)}).`}function P5(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function L5(e){return`Unaggregated domain is currently unsupported for log scale (${x0(e)}).`}function B5(e){return`Cannot apply size to non-oriented mark "${e}".`}function $5(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function z5(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function U5(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function H5(e,t){return`Scale type "${t}" does not work with mark "${e}".`}function W5(e){return`The step for "${e}" is dropped because the ${"width"===e?"x":"y"} is continuous.`}function V5(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${x0(n)} and ${x0(r)}). Using ${x0(n)}.`}function q5(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${x0(n)} and ${x0(r)}). Using the union of the two domains.`}function G5(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function Y5(e){return`Dropping sort property ${x0(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const X5="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",K5="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",Z5="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",J5="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.",Q5="Invalid channel for axis.";function e3(e){return`Cannot stack "${e}" if there is already "${e}2".`}function t3(e){return`Cannot stack non-linear scale (${e}).`}function n3(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function r3(e,t){return`Invalid ${e}: ${x0(t)}.`}function i3(e){return`Dropping day from datetime ${x0(e)} as day cannot be combined with other units.`}function a3(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function o3(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function s3(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function l3(e){return`1D error band does not support ${e}.`}function u3(e){return`Channel ${e} is required for "binned" bin.`}function c3(e){return`Channel ${e} should not be used with "binned" bin.`}function d3(e){return`Domain for ${e} is required for threshold scale.`}const h3=_m(bm);let f3=h3;function p3(...e){f3.warn(...e)}function m3(e){if(e&&Em(e))for(const t of k3)if(t in e)return!0;return!1}new WeakMap;const g3=["january","february","march","april","may","june","july","august","september","october","november","december"],v3=g3.map(e=>e.substr(0,3)),y3=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],b3=y3.map(e=>e.substr(0,3));function x3(e,t){const n=[];if(t&&void 0!==e.day&&F0(e).length>1&&(p3(y.droppedDay(e)),delete(e=v0(e)).day),n.push(void 0!==e.year?e.year:2012),void 0!==e.month){const r=t?function(e){if(r1(e)&&(e=+e),vg(e))return e-1;{const t=e.toLowerCase(),n=g3.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=v3.indexOf(r);if(-1!==i)return i;throw new Error(y.invalidTimeUnit("month",e))}}(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){const r=t?function(e){if(r1(e)&&(e=+e),vg(e))return e>4&&p3(y.invalidTimeUnit("quarter",e)),e-1;throw new Error(y.invalidTimeUnit("quarter",e))}(e.quarter):e.quarter;n.push(vg(r)?3*r:r+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){const r=t?function(e){if(r1(e)&&(e=+e),vg(e))return e%7;{const t=e.toLowerCase(),n=y3.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=b3.indexOf(r);if(-1!==i)return i;throw new Error(y.invalidTimeUnit("day",e))}}(e.day):e.day;n.push(vg(r)?r+1:r+"+1")}else n.push(1);for(const r of["hours","minutes","seconds","milliseconds"]){const t=e[r];n.push(void 0===t?0:t)}return n}function w3(e){const t=x3(e,!0).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}const _3={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},k3=F0(_3);function E3(e){return e.startsWith("utc")}const S3={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function T3(e){const t=[];for(const n of k3)C3(e,n)&&t.push(n);return t}function C3(e,t){const n=e.indexOf(t);return!(n<0||n>0&&"seconds"===t&&"i"===e.charAt(n-1)||e.length>n+3&&"day"===t&&"o"===e.charAt(n+3)||n>0&&"year"===t&&"f"===e.charAt(n-1))}function I3(e){if(!e)return;const t=T3(e);return`timeUnitSpecifier(${d0()(t)}, ${d0()(S3)})`}function A3(e){if(!e)return;let t;return bg(e)?t={unit:e}:Em(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),E3(t.unit)&&(t.utc=!0,t.unit=t.unit.substr(3)),t}function O3(e){return e&&!!e.signal}function D3(e){return!!e.step}function M3(e){return!km(e)&&"field"in e&&"data"in e}const N3=F0({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1}),j3={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},F3=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function R3(e){return e&&!!e.field&&void 0!==e.equal}function P3(e){return e&&!!e.field&&void 0!==e.lt}function L3(e){return e&&!!e.field&&void 0!==e.lte}function B3(e){return e&&!!e.field&&void 0!==e.gt}function $3(e){return e&&!!e.field&&void 0!==e.gte}function z3(e){if(e&&e.field){if(km(e.range)&&2===e.range.length)return!0;if(O3(e.range))return!0}return!1}function U3(e){return e&&!!e.field&&(km(e.oneOf)||km(e.in))}function H3(e){return U3(e)||R3(e)||z3(e)||P3(e)||B3(e)||L3(e)||$3(e)}function W3(e,t){return l8(e,{timeUnit:t,wrapTime:!0})}function V3(e,t=!0){var n;const{field:r}=e,i=null===(n=A3(e.timeUnit))||void 0===n?void 0:n.unit,a=i?"time("+function(e,t,{end:n}={end:!1}){const r=H0(t),i=E3(e)?"utc":"";let a;const o={};for(const l of k3)C3(e,l)&&(o[l]="quarter"===(s=l)?`(${i}quarter(${r})-1)`:`${i}${s}(${r})`,a=l);var s;return n&&(o[a]+="+1"),function(e){const t=x3(e,!1).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}(o)}(i,r)+")":W6(e,{expr:"datum"});if(R3(e))return a+"==="+W3(e.equal,i);if(P3(e))return`${a}<${W3(e.lt,i)}`;if(B3(e))return`${a}>${W3(e.gt,i)}`;if(L3(e))return`${a}<=${W3(e.lte,i)}`;if($3(e))return`${a}>=${W3(e.gte,i)}`;if(U3(e))return`indexof([${function(e,t){return e.map(e=>W3(e,t))}(e.oneOf,i).join(",")}], ${a}) !== -1`;if(function(e){return e&&!!e.field&&void 0!==e.valid}(e))return q3(a,e.valid);if(z3(e)){const{range:n}=e,r=O3(n)?{signal:n.signal+"[0]"}:n[0],o=O3(n)?{signal:n.signal+"[1]"}:n[1];if(null!==r&&null!==o&&t)return"inrange("+a+", ["+W3(r,i)+", "+W3(o,i)+"])";const s=[];return null!==r&&s.push(`${a} >= ${W3(r,i)}`),null!==o&&s.push(`${a} <= ${W3(o,i)}`),s.length>0?s.join(" && "):"true"}throw new Error("Invalid field predicate: "+JSON.stringify(e))}function q3(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function G3(e){var t;return H3(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:null===(t=A3(e.timeUnit))||void 0===t?void 0:t.unit}):e}const Y3={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},X3=Y3.quantitative,K3=Y3.ordinal,Z3=Y3.temporal,J3=Y3.nominal,Q3=Y3.geojson;F0(Y3);const e4="linear",t4="time",n4="utc",r4="point",i4={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function a4(e,t){const n=i4[e],r=i4[t];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n}F0(i4);const o4={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function s4(e){return o4[e]}const l4=["linear","log","pow","sqrt","symlog","time","utc"],u4=Mg(l4),c4=Mg(["linear","log","pow","sqrt","symlog"]),d4=Mg(["quantile","quantize","threshold"]),h4=Mg(l4.concat(["quantile","quantize","threshold","sequential","identity"])),f4=Mg(["ordinal","bin-ordinal","point","band"]);function p4(e){return e in f4}function m4(e){return e in h4}function g4(e){return e in u4}function v4(e){return e in d4}function y4(e){return null==e?void 0:e.selection}const b4={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},x4=(F0(b4),function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(b4,["type","domain","range","rangeMax","rangeMin","scheme"])),w4=F0(x4);function _4(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!k0(["point","band","identity"],e);case"bins":return!k0(["point","band","identity","ordinal"],e);case"round":return g4(e)||"band"===e||"point"===e;case"padding":case"rangeMin":case"rangeMax":return g4(e)||k0(["point","band"],e);case"paddingOuter":case"align":return k0(["point","band"],e);case"paddingInner":return"band"===e;case"domainMax":case"domainMid":case"domainMin":case"clamp":return g4(e);case"nice":return g4(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return m4(e)&&!k0(["log","time","utc","threshold","quantile"],e)}}function k4(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return s2(e)?void 0:y.cannotUseScalePropertyWithNonColor(e);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function E4(e){return e&&!!e.expr}function S4(e){const t=F0(e||{}),n={};for(const r of t)n[r]=m8(e[r]);return n}const T4={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},C4=T4.arc,I4=T4.area,A4=T4.bar,O4=T4.image,D4=T4.line,M4=T4.point,N4=T4.rect,j4=T4.rule,F4=T4.text,R4=T4.tick,P4=T4.trail,L4=T4.circle,B4=T4.square,$4=T4.geoshape;function z4(e){return k0(["line","area","trail"],e)}function U4(e){return k0(["rect","bar","image","arc"],e)}const H4=F0(T4);function W4(e){return e.type}Mg(H4);const V4=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],q4=F0({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),G4=F0({mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1}),Y4={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]};function X4(e){const{channel:t,channelDef:n,markDef:r,scale:i,config:a}=e,o=t6(e);return D6(n)&&!y1(n.aggregate)&&i&&g4(i.get("type"))&&!1===i.get("zero")?K4({fieldDef:n,channel:t,markDef:r,ref:o,config:a}):o}function K4({fieldDef:e,channel:t,markDef:n,ref:r,config:i}){return z4(n.type)||null===w8("invalid",n,i)?r:[Z4(e,t),r]}function Z4(e,t){const n=J4(e,!0),r=v2(t);return Object.assign({test:n},"y"===r?{field:{group:"height"}}:{value:0})}function J4(e,t=!0){return q3(bg(e)?e:W6(e,{expr:"datum"}),!t)}function Q4(e,t,n,r){const i={};if(t&&(i.scale=t),N6(e)){const{datum:t}=e;m3(t)?i.signal=w3(t):O3(t)?i.signal=t.signal:E4(t)?i.signal=t.expr:i.value=t}else i.field=W6(e,n);if(r){const{offset:e,band:t}=r;e&&(i.offset=e),t&&(i.band=t)}return i}function e6({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:r,startSuffix:i,band:a=.5}){const o=0<a&&a<1?"datum":void 0,s=W6(t,{expr:o,suffix:i}),l=void 0!==n?W6(n,{expr:o}):W6(t,{suffix:"end",expr:o}),u={};return 0===a||1===a?(u.scale=e,u.field=0===a?s:l):u.signal=`scale("${e}", ${a} * ${s} + ${1-a} * ${l})`,r&&(u.offset=r),u}function t6({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u,band:c}){var d;if(t){if(R6(t)){if(P6(t)){c=null!=c?c:T6({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:s,config:i,isMidPoint:!0});const{bin:o,timeUnit:u,type:d}=t;if(L2(o)||c&&u&&d===Z3)return s&&s.impute?Q4(t,a,{binSuffix:"mid"},{offset:l}):c?e6({scaleName:a,fieldOrDatumDef:t,band:c,offset:l}):Q4(t,a,c8(t,e)?{binSuffix:"range"}:{},{offset:l});if(B2(o)){if(D6(n))return e6({scaleName:a,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:l});p3(y.channelRequiredForBinned(e===S1?C1:I1))}}const u=null==o?void 0:o.get("type");return Q4(t,a,p4(u)?{binSuffix:"range"}:{},{offset:l,band:"band"===u?null!==(d=null!=c?c:t.band)&&void 0!==d?d:.5:void 0})}if(L6(t)){const n=l?{offset:l}:{};return Object.assign(Object.assign({},n6(e,t.value)),n)}}return Km(u)&&(u=u()),u?Object.assign(Object.assign({},u),l?{offset:l}:{}):u}function n6(e,t){return k0(["x","x2"],e)&&"width"===t?{field:{group:"width"}}:k0(["y","y2"],e)&&"height"===t?{field:{group:"height"}}:v8(t)}function r6(e){return e&&"number"!==e&&"time"!==e}function i6(e,t,n){return`${e}(${t}${n?", "+JSON.stringify(n):""})`}function a6({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a}){var o,s;if(r6(n))return s6({fieldOrDatumDef:e,format:t,formatType:n,expr:r,config:a});const l=o6(e,r,i);if(s8(e)){const n=function(e,t,n,r,i){return!t||n?`${i?"utc":"time"}Format(${e}, '${n=bg(n)?n:r}')`:function(e,t,n){if(!e)return;const r=I3(e);return`${n||E3(e)?"utc":"time"}Format(${t}, ${r})`}(t,e,i)}(l,D6(e)?null===(o=A3(e.timeUnit))||void 0===o?void 0:o.unit:void 0,t,a.timeFormat,B6(e)&&(null===(s=e.scale)||void 0===s?void 0:s.type)===n4);return n?{signal:n}:void 0}return t=c6(M6(e),t,a),D6(e)&&L2(e.bin)?{signal:f6(l,W6(e,{expr:r,binSuffix:"end"}),t,n,a)}:t||"quantitative"===M6(e)?{signal:""+d6(l,t)}:{signal:`isValid(${l}) ? ${l} : ""+${l}`}}function o6(e,t,n){return D6(e)?n?`${W6(e,{expr:t,suffix:"end"})}-${W6(e,{expr:t,suffix:"start"})}`:W6(e,{expr:t}):function(e){const{datum:t}=e;return m3(t)?w3(t):""+JSON.stringify(t)}(e)}function s6({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a,field:o}){return o=null!=o?o:o6(e,r,i),D6(e)&&L2(e.bin)?{signal:f6(o,W6(e,{expr:r,binSuffix:"end"}),t,n,a)}:{signal:i6(n,o,t)}}function l6(e,t,n,r,i,a){var o;if(!r6(r))return s8(e)?function(e,t,n,r){return e||(t?{signal:I3(t)}:r?void 0:n.timeFormat)}(n,D6(e)?null===(o=A3(e.timeUnit))||void 0===o?void 0:o.unit:void 0,i,a):c6(t,n,i)}function u6(e,t,n){return e&&(O3(e)||"number"===e||"time"===e)?e:s8(t)&&"time"!==n&&"utc"!==n?"time":void 0}function c6(e,t,n){return bg(t)?t:e===X3?n.numberFormat:void 0}function d6(e,t){return`format(${e}, "${t||""}")`}function h6(e,t,n,r){var i;return r6(n)?i6(n,e,t):d6(e,null!==(i=bg(t)?t:void 0)&&void 0!==i?i:r.numberFormat)}function f6(e,t,n,r,i){const a=h6(e,n,r,i),o=h6(t,n,r,i);return`${q3(e,!1)} ? "null" : ${a} + " \u2013 " + ${o}`}const p6="min",m6={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function g6(e){return e in m6}function v6(e){return!!e&&!!e.encoding}function y6(e){return!(!e||"count"!==e.op&&!e.field)}function b6(e){return!!e&&km(e)}function x6(e){return"row"in e||"column"in e}function w6(e){return!!e&&"header"in e}function _6(e){return"facet"in e}var k6=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function E6(e){const{field:t,timeUnit:n,bin:r,aggregate:i}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})}function S6(e){return"sort"in e}function T6({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:i,config:a,isMidPoint:o}){if(R6(t)&&void 0!==t.band)return t.band;if(D6(t)){const{timeUnit:e,bin:i}=t;if(e&&!n)return o?_8("timeUnitBandPosition",r,a):U4(r.type)?_8("timeUnitBand",r,a):0;if(L2(i))return U4(r.type)&&!o?1:.5}return(null==i?void 0:i.fieldChannel)===e&&o?.5:void 0}function C6(e,t,n,r,i,a){return!!(L2(t.bin)||t.timeUnit&&P6(t)&&"temporal"===t.type)&&!!T6({channel:e,fieldDef:t,fieldDef2:n,stack:r,markDef:i,config:a})}function I6(e){return!!e&&"condition"in e}function A6(e){const t=e&&e.condition;return!!t&&!km(t)&&D6(t)}function O6(e){const t=e&&e.condition;return!!t&&!km(t)&&R6(t)}function D6(e){return!(!e||!e.field&&"count"!==e.aggregate)}function M6(e){return e&&e.type}function N6(e){return!!e&&"datum"in e}function j6(e){return P6(e)&&q6(e)||F6(e)}function F6(e){return N6(e)&&vg(e.datum)}function R6(e){return D6(e)||N6(e)}function P6(e){return!!e&&("field"in e||"count"===e.aggregate)&&"type"in e}function L6(e){return e&&"value"in e&&"value"in e}function B6(e){return!!e&&("scale"in e||"sort"in e)}function $6(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function z6(e){return!!e&&"legend"in e}function U6(e){return!!e&&("format"in e||"formatType"in e)}function H6(e){return b0(e,["legend","axis","header","scale"])}function W6(e,t={}){var n,r,i;let a=e.field;const o=t.prefix;let s=t.suffix,l="";if(function(e){return"count"===e.aggregate}(e))a=e1("count");else{let o;if(!t.nofn)if(function(e){return"op"in e}(e))o=e.op;else{const{bin:u,aggregate:c,timeUnit:d}=e;L2(u)?(o=P2(u),s=(null!==(n=t.binSuffix)&&void 0!==n?n:"")+(null!==(r=t.suffix)&&void 0!==r?r:"")):c?m1(c)?(l=`["${a}"]`,a="argmax_"+c.argmax):p1(c)?(l=`["${a}"]`,a="argmin_"+c.argmin):o=String(c):d&&(o=function(e){const t=A3(e),{utc:n}=t,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(t,["utc"]);return r.unit?(n?"utc":"")+F0(r).map(e=>B0(`${"unit"===e?"":`_${e}_`}${r[e]}`)).join(""):(n?"utc":"")+"timeunit"+F0(r).map(e=>B0(`_${e}_${r[e]}`)).join("")}(d),s=(!k0(["range","mid"],t.binSuffix)&&t.binSuffix||"")+(null!==(i=t.suffix)&&void 0!==i?i:""))}o&&(a=a?`${o}_${a}`:o)}return s&&(a=`${a}_${s}`),o&&(a=`${o}_${a}`),t.forAs?Y0(a):t.expr?W0(a,t.expr)+l:q0(a)+l}function V6(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return D6(e)&&!!e.bin;case"temporal":return!1}throw new Error(y.invalidFieldType(e.type))}function q6(e){return!V6(e)}const G6=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(e){const{aggregate:t,bin:n,timeUnit:r,field:i}=e;if(m1(t))return`${i} for argmax(${t.argmax})`;if(p1(t))return`${i} for argmin(${t.argmin})`;const a=A3(r),o=t||(null==a?void 0:a.unit)||(null==a?void 0:a.maxbins)&&"timeunit"||L2(n)&&"bin";return o?o.toUpperCase()+"("+i+")":i}(e);default:return function(e,t){var n;const{field:r,bin:i,timeUnit:a,aggregate:o}=e;if("count"===o)return t.countTitle;if(L2(i))return r+" (binned)";if(a){const e=null===(n=A3(a))||void 0===n?void 0:n.unit;if(e)return`${r} (${T3(e).join("-")})`}else if(o)return m1(o)?`${r} for max ${o.argmax}`:p1(o)?`${r} for min ${o.argmin}`:`${U0(o)} of ${r}`;return r}(e,t)}};let Y6=G6;function X6(e){Y6=e}function K6(e,t,{allowDisabling:n,includeDefault:r=!0}){var i,a;const o=null===(i=Z6(e))||void 0===i?void 0:i.title;if(!D6(e))return o;const s=e,l=r?J6(s,t):void 0;return n?K0(o,s.title,l):null!==(a=null!=o?o:s.title)&&void 0!==a?a:l}function Z6(e){return $6(e)&&e.axis?e.axis:z6(e)&&e.legend?e.legend:w6(e)&&e.header?e.header:void 0}function J6(e,t){return Y6(e,t)}function Q6(e){var t;if(U6(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}{const n=null!==(t=Z6(e))&&void 0!==t?t:{},{format:r,formatType:i}=n;return{format:r,formatType:i}}}function e8(e){return D6(e)?e:A6(e)?e.condition:void 0}function t8(e){return R6(e)?e:O6(e)?e.condition:void 0}function n8(e,t,n,r={}){if(bg(e)||vg(e)||pg(e)){const n=bg(e)?"string":vg(e)?"number":"boolean";return p3(y.primitiveChannelDef(t,n,e)),{value:e}}return R6(e)?r8(e,t,n,r):O6(e)?Object.assign(Object.assign({},e),{condition:r8(e.condition,t,n,r)}):e}function r8(e,t,n,r){if(U6(e)){const{formatType:i}=e,a=k6(e,["format","formatType"]);if(r6(i)&&!n.customFormatTypes)return p3(y.customFormatTypeNotAllowed(t)),r8(a,t,n,r)}else{const i=$6(e)?"axis":z6(e)?"legend":w6(e)?"header":null;if(i&&e[i]){const a=e[i],{formatType:o}=a,s=k6(a,["format","formatType"]);if(r6(o)&&!n.customFormatTypes)return p3(y.customFormatTypeNotAllowed(t)),r8(Object.assign(Object.assign({},e),{[i]:s}),t,n,r)}}return D6(e)?i8(e,t,r):function(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=vg(n)?"quantitative":bg(n)?"nominal":m3(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}(e)}function i8(e,t,{compositeMark:n=!1}={}){const{aggregate:r,timeUnit:i,bin:a,field:o}=e,s=Object.assign({},e);if(n||!r||g1(r)||m1(r)||p1(r)||(p3(y.invalidAggregate(r)),delete s.aggregate),i&&(s.timeUnit=A3(i)),o&&(s.field=""+o),L2(a)&&(s.bin=a8(a,t)),B2(a)&&!S2(t)&&p3(y.channelShouldNotBeUsedForBinned(t)),P6(s)){const{type:e}=s,t=function(e){if(e)switch(e=e.toLowerCase()){case"q":case X3:return"quantitative";case"t":case Z3:return"temporal";case"o":case K3:return"ordinal";case"n":case J3:return"nominal";case Q3:return"geojson"}}(e);e!==t&&(s.type=t),"quantitative"!==e&&y1(r)&&(p3(y.invalidFieldTypeForCountAggregate(e,r)),s.type="quantitative")}else if(!g2(t)){const e=function(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(S6(e)&&km(e.sort))return"ordinal";const{aggregate:r,bin:i,timeUnit:a}=e;if(a)return"temporal";if(i||r&&!m1(r)&&!p1(r))return"quantitative";if(B6(e)&&(null===(n=e.scale)||void 0===n?void 0:n.type))switch(i4[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}(s,t);s.type=e}if(P6(s)){const{compatible:e,warning:n}=function(e,t){const n=e.type;if("geojson"===n&&"shape"!==t)return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case _1:case k1:case E1:return q6(e)?{compatible:!1,warning:y.facetChannelShouldBeDiscrete(t)}:o8;case S1:case T1:case P1:case L1:case B1:case Y1:case K1:case Z1:case J1:case Q1:case e2:case U1:case D1:case A1:case t2:return o8;case j1:case R1:case N1:case F1:return n!==X3?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:o8;case H1:case W1:case V1:case q1:case z1:case M1:case O1:case C1:case I1:return"nominal"!==n||e.sort?o8:{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`};case G1:return k0(["ordinal","nominal"],e.type)?o8:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case $1:return k0(["ordinal","nominal","geojson"],e.type)?o8:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case X1:return"nominal"!==e.type||"sort"in e?o8:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(s,t)||{};!1===e&&p3(n)}if(S6(s)&&bg(s.sort)){const{sort:e}=s;if(g6(e))return Object.assign(Object.assign({},s),{sort:{encoding:e}});const t=e.substr(1);if("-"===e.charAt(0)&&g6(t))return Object.assign(Object.assign({},s),{sort:{encoding:t,order:"descending"}})}if(w6(s)){const{header:e}=s,{orient:t}=e,n=k6(e,["orient"]);if(t)return Object.assign(Object.assign({},s),{header:Object.assign(Object.assign({},n),{labelOrient:e.labelOrient||t,titleOrient:e.titleOrient||t})})}return s}function a8(e,t){return pg(e)?{maxbins:U2(t)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:U2(t)})}const o8={compatible:!0};function s8(e){const{formatType:t}=Q6(e);return"time"===t||!t&&(n=e)&&("temporal"===n.type||D6(n)&&!!n.timeUnit);var n}function l8(e,{timeUnit:t,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var a;const o=t&&(null===(a=A3(t))||void 0===a?void 0:a.unit);let s,l=o||"temporal"===n;return E4(e)?s=e.expr:O3(e)?s=e.signal:m3(e)?(l=!0,s=w3(e)):(bg(e)||vg(e))&&l&&(s=`datetime(${JSON.stringify(e)})`,function(e){return!!_3[e]}(o)&&(vg(e)&&e<1e4||bg(e)&&isNaN(Date.parse(e)))&&(s=w3({[o]:e}))),s?r&&l?`time(${s})`:s:i?void 0:JSON.stringify(e)}function u8(e,t){const{type:n}=e;return t.map(t=>{const r=l8(t,{timeUnit:D6(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==r?{signal:r}:t})}function c8(e,t){return L2(e.bin)?N2(t)&&k0(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function d8(e){const{anchor:t,frame:n,offset:r,orient:i,color:a,subtitleColor:o,subtitleFont:s,subtitleFontSize:l,subtitleFontStyle:u,subtitleFontWeight:c,subtitleLineHeight:d,subtitlePadding:h}=e,f=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},f),a?{fill:a}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),s?{subtitleFont:s}:{}),l?{subtitleFontSize:l}:{}),u?{subtitleFontStyle:u}:{}),c?{subtitleFontWeight:c}:{}),d?{subtitleLineHeight:d}:{}),h?{subtitlePadding:h}:{});return{titleMarkConfig:p,subtitleMarkConfig:y0(p,["align","baseline","dx","dy","limit"]),nonMark:m,subtitle:g}}function h8(e){return bg(e)||km(e)&&bg(e[0])}var f8=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function p8(e){const t=km(e.condition)?e.condition.map(g8):g8(e.condition);return Object.assign(Object.assign({},m8(e)),{condition:t})}function m8(e){if(E4(e)){const{expr:t}=e,n=f8(e,["expr"]);return Object.assign({signal:t},n)}return e}function g8(e){if(E4(e)){const{expr:t}=e,n=f8(e,["expr"]);return Object.assign({signal:t},n)}return e}function v8(e){if(E4(e)){const{expr:t}=e,n=f8(e,["expr"]);return Object.assign({signal:t},n)}return O3(e)?e:void 0!==e?{value:e}:void 0}function y8(e){return O3(e)?e.signal:Cg(e.value)}function b8(e){return O3(e)?e.signal:null==e?null:Cg(e)}function x8(e){var t;return[].concat(e.type,null!==(t=e.style)&&void 0!==t?t:[])}function w8(e,t,n,r={}){const{vgChannel:i,ignoreVgConfig:a}=r;return i&&void 0!==t[i]?t[i]:void 0!==t[e]?t[e]:!a||i&&i!==e?_8(e,t,n,r):void 0}function _8(e,t,n,{vgChannel:r}={}){return K0(r?k8(e,t,n.style):void 0,k8(e,t,n.style),r?n[t.type][r]:void 0,n[t.type][e],r?n.mark[r]:n.mark[e])}function k8(e,t,n){return E8(e,x8(t),n)}function E8(e,t,n){let r;t=Ym(t);for(const i of t){const t=n[i];t&&void 0!==t[e]&&(r=t[e])}return r}function S8(e,t){return Ym(e).reduce((e,n)=>{var r;return e.field.push(W6(n,t)),e.order.push(null!==(r=n.sort)&&void 0!==r?r:"ascending"),e},{field:[],order:[]})}function T8(e,t){const n=[...e];return t.forEach(e=>{for(const t of n)if(g0(t,e))return;n.push(e)}),n}function C8(e,t){return g0(e,t)||!t?e:e?[...Ym(e),...Ym(t)].join(", "):t}function I8(e,t){const n=e.value,r=t.value;if(null==n||null===r)return{explicit:e.explicit,value:null};if((h8(n)||O3(n))&&(h8(r)||O3(r)))return{explicit:e.explicit,value:C8(n,r)};if(h8(n)||O3(n))return{explicit:e.explicit,value:n};if(h8(r)||O3(r))return{explicit:e.explicit,value:r};if(!(h8(n)||O3(n)||h8(r)||O3(r)))return{explicit:e.explicit,value:T8(n,r)};throw new Error("It should never reach here")}function A8(e){return"mark"in e}class O8{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return!!A8(e)&&(W4(t=e.mark)?t.type:t)===this.name;var t}}function D8(e,t){const n=e&&e[t];return!!n&&(km(n)?E0(n,e=>!!e.field):D6(n)||A6(n))}function M8(e){return E0(d2,t=>{if(D8(e,t)){const n=e[t];if(km(n))return E0(n,e=>!!e.aggregate);{const e=e8(n);return e&&!!e.aggregate}}return!1})}function N8(e,t){const n=[],r=[],i=[],a=[],o={};return F8(e,(s,l)=>{if(D6(s)){const{field:u,aggregate:c,bin:d,timeUnit:h}=s,f=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(s,["field","aggregate","bin","timeUnit"]);if(c||h||d){const e=Z6(s),p=e&&e.title;let m=W6(s,{forAs:!0});const g=Object.assign(Object.assign(Object.assign({},p?[]:{title:K6(s,t,{allowDisabling:!0})}),f),{field:m});if(c){let e;if(m1(c)?(e="argmax",m=W6({op:"argmax",field:c.argmax},{forAs:!0}),g.field=`${m}.${u}`):p1(c)?(e="argmin",m=W6({op:"argmin",field:c.argmin},{forAs:!0}),g.field=`${m}.${u}`):"boxplot"!==c&&"errorbar"!==c&&"errorband"!==c&&(e=c),e){const t={op:e,as:m};u&&(t.field=u),a.push(t)}}else if(n.push(m),P6(s)&&L2(d))r.push({bin:d,field:u,as:m}),n.push(W6(s,{binSuffix:"end"})),c8(s,l)&&n.push(W6(s,{binSuffix:"range"})),S2(l)&&(o[l+"2"]={field:m+"_end"}),g.bin="binned",g2(l)||(g.type=X3);else if(h){i.push({timeUnit:h,field:u,as:m});const e=P6(s)&&s.type!==Z3&&"time";e&&(l===Y1||l===J1?g.formatType=e:function(e){return!!w2[e]}(l)?g.legend=Object.assign({formatType:e},g.legend):S2(l)&&(g.axis=Object.assign({formatType:e},g.axis)))}o[l]=g}else n.push(u),o[l]=e[l]}else o[l]=e[l]}),{bins:r,timeUnits:i,aggregate:a,groupby:n,encoding:o}}function j8(e,t){const n={};for(const r of F0(e)){const i=n8(e[r],r,t,{compositeMark:!0});n[r]=i}return n}function F8(e,t,n){if(e)for(const r of F0(e)){const i=e[r];if(km(i))for(const e of i)t.call(n,e,r);else t.call(n,i,r)}}function R8(e,t){return F0(t).reduce((n,r)=>{switch(r){case S1:case T1:case Q1:case t2:case e2:case C1:case I1:case D1:case M1:case A1:case O1:case N1:case j1:case F1:case R1:case Y1:case $1:case U1:case J1:return n;case X1:if("line"===e||"trail"===e)return n;case K1:case Z1:{const e=t[r];if(km(e)||D6(e))for(const t of Ym(e))t.aggregate||n.push(W6(t,{}));return n}case z1:if("trail"===e)return n;case P1:case L1:case B1:case H1:case W1:case V1:case G1:case q1:{const e=e8(t[r]);return e&&!e.aggregate&&n.push(W6(e,{})),n}}},[])}var P8=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function L8(e,t,n,r=!0){return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[...e.map(({fieldPrefix:e,titlePrefix:n})=>{const i=r?" of "+B8(t):"";return{field:e+t.field,type:t.type,title:O3(n)?{signal:n+`"${escape(i)}"`}:n+i}}),...I0(function(e){const t=[];for(const n of F0(e))if(D8(e,n)){const r=Ym(e[n]);for(const e of r)D6(e)?t.push(e):A6(e)&&t.push(e.condition)}return t}(n).map(H6),w0)]}}function B8(e){const{title:t,field:n}=e;return K0(t,n)}function $8(e,t,n,r,i){const{scale:a,axis:o}=n;return({partName:s,mark:l,positionPrefix:u,endPositionPrefix:c,extraEncoding:d={}})=>{const h=B8(n);return z8(e,s,i,{mark:l,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:u+"_"+n.field,type:n.type},void 0!==h?{title:h}:{}),void 0!==a?{scale:a}:{}),void 0!==o?{axis:o}:{})},bg(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),r),d)})}}function z8(e,t,n,r){const{clip:i,color:a,opacity:o}=e,s=e.type;return e[t]||void 0===e[t]&&n[t]?[Object.assign(Object.assign({},r),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),i?{clip:i}:{}),a?{color:a}:{}),o?{opacity:o}:{}),W4(r.mark)?r.mark:{type:r.mark}),{style:`${s}-${t}`}),pg(e[t])?{}:e[t])})]:[]}function U8(e,t,n){const{encoding:r}=e,i="vertical"===t?"y":"x",a=r[i+"2"],o=r[i+"Error"],s=r[i+"Error2"];return{continuousAxisChannelDef:H8(r[i],n),continuousAxisChannelDef2:H8(a,n),continuousAxisChannelDefError:H8(o,n),continuousAxisChannelDefError2:H8(s,n),continuousAxis:i}}function H8(e,t){if(e&&e.aggregate){const{aggregate:n}=e,r=P8(e,["aggregate"]);return n!==t&&p3(y.errorBarContinuousAxisHasCustomizedAggregate(n,t)),r}return e}function W8(e,t){const{mark:n,encoding:r}=e,{x:i,y:a}=r;if(W4(n)&&n.orient)return n.orient;if(j6(i)){if(j6(a)){const e=D6(i)&&i.aggregate,n=D6(a)&&a.aggregate;if(e||n!==t){if(n||e!==t){if(e===t&&n===t)throw new Error("Both x and y cannot have aggregate");return s8(a)&&!s8(i)?"horizontal":"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(j6(a))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}var V8=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const q8="boxplot",G8=new O8(q8,X8);function Y8(e){return vg(e)?"tukey":e}function X8(e,{config:t}){var n,r;e=Object.assign(Object.assign({},e),{encoding:j8(e.encoding,t)});const{mark:i,selection:a}=e,o=V8(e,["mark","encoding","selection","projection"]),s=W4(i)?i:{type:i};a&&p3(y.selectionNotSupported("boxplot"));const l=null!==(n=s.extent)&&void 0!==n?n:t.boxplot.extent,u=w8("size",s,t),c=Y8(l),{bins:d,timeUnits:h,transform:f,continuousAxisChannelDef:p,continuousAxis:m,groupby:g,aggregate:v,encodingWithoutContinuousAxis:b,ticksOrient:x,boxOrient:w,customTooltipWithoutAggregatedField:_}=function(e,t,n){const r=W8(e,q8),{continuousAxisChannelDef:i,continuousAxis:a}=U8(e,r,q8),o=i.field,s=Y8(t),l=[...K8(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:("min-max"===s?"lower_whisker_":"min_")+o},{op:"max",field:o,as:("min-max"===s?"upper_whisker_":"max_")+o}],u="min-max"===s||"tukey"===s?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],c=V8(e.encoding,["symbol"==typeof a?a:a+""]),{customTooltipWithoutAggregatedField:d,filteredEncoding:h}=function(e){const{tooltip:t}=e,n=P8(e,["tooltip"]);if(!t)return{filteredEncoding:n};let r,i;if(km(t)){for(const e of t)e.aggregate?(r||(r=[]),r.push(e)):(i||(i=[]),i.push(e));r&&(n.tooltip=r)}else t.aggregate?n.tooltip=t:i=t;return km(i)&&1===i.length&&(i=i[0]),{customTooltipWithoutAggregatedField:i,filteredEncoding:n}}(c),{bins:f,timeUnits:p,aggregate:m,groupby:g,encoding:v}=N8(h,n),y="vertical"===r?"horizontal":"vertical",b=r;return{bins:f,timeUnits:p,transform:[...f,...p,{aggregate:[...m,...l],groupby:g},...u],groupby:g,aggregate:m,continuousAxisChannelDef:i,continuousAxis:a,encodingWithoutContinuousAxis:v,ticksOrient:y,boxOrient:b,customTooltipWithoutAggregatedField:d}}(e,l,t),{color:k,size:E}=b,S=V8(b,["color","size"]),T=e=>$8(s,m,p,e,t.boxplot),C=T(S),I=T(b),A=T(Object.assign(Object.assign({},S),E?{size:E}:{})),O=L8([{fieldPrefix:"min-max"===c?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===c?"lower_whisker_":"min_",titlePrefix:"Min"}],p,b),D={type:"tick",color:"black",opacity:1,orient:x,invalid:null,aria:!1},M="min-max"===c?O:L8([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,b),N=[...C({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:M}),...C({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:M}),...C({partName:"ticks",mark:D,positionPrefix:"lower_whisker",extraEncoding:M}),...C({partName:"ticks",mark:D,positionPrefix:"upper_whisker",extraEncoding:M})],j=[..."tukey"!==c?N:[],...I({partName:"box",mark:Object.assign(Object.assign({type:"bar"},u?{size:u}:{}),{orient:w,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:O}),...A({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},Em(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),u?{size:u}:{}),{orient:x,aria:!1}),positionPrefix:"mid_box",extraEncoding:O})];if("min-max"===c)return Object.assign(Object.assign({},o),{transform:(null!==(r=o.transform)&&void 0!==r?r:[]).concat(f),layer:j});const F=`datum["lower_box_${p.field}"]`,R=`datum["upper_box_${p.field}"]`,P=`(${R} - ${F})`,L=`${F} - ${l} * ${P}`,B=`${R} + ${l} * ${P}`,$=`datum["${p.field}"]`,z={joinaggregate:K8(p.field),groupby:g},U={transform:[{filter:`(${L} <= ${$}) && (${$} <= ${B})`},{aggregate:[{op:"min",field:p.field,as:"lower_whisker_"+p.field},{op:"max",field:p.field,as:"upper_whisker_"+p.field},{op:"min",field:"lower_box_"+p.field,as:"lower_box_"+p.field},{op:"max",field:"upper_box_"+p.field,as:"upper_box_"+p.field},...v],groupby:g}],layer:N},H=V8(S,["tooltip"]),{scale:W,axis:V}=p,q=B8(p),G=b0(V,["title"]),Y=z8(s,"outliers",t.boxplot,{transform:[{filter:`(${$} < ${L}) || (${$} > ${B})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[m]:Object.assign(Object.assign(Object.assign({field:p.field,type:p.type},void 0!==q?{title:q}:{}),void 0!==W?{scale:W}:{}),j0(G)?{}:{axis:G})},H),k?{color:k}:{}),_?{tooltip:_}:{})})[0];let X;const K=[...d,...h,z];return Y?X={transform:K,layer:[Y,U]}:(X=U,X.transform.unshift(...K)),Object.assign(Object.assign({},o),{layer:[X,{transform:f,layer:j}]})}function K8(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}var Z8=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const J8="errorbar",Q8=new O8(J8,e7);function e7(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:j8(e.encoding,t)});const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,ticksOrient:o,markDef:s,outerSpec:l,tooltipEncoding:u}=t7(e,J8,t);delete a.size;const c=$8(s,i,r,a,t.errorbar),d=s.thickness,h=s.size,f=Object.assign(Object.assign({type:"tick",orient:o,aria:!1},void 0!==d?{thickness:d}:{}),void 0!==h?{size:h}:{}),p=[...c({partName:"ticks",mark:f,positionPrefix:"lower",extraEncoding:u}),...c({partName:"ticks",mark:f,positionPrefix:"upper",extraEncoding:u}),...c({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},void 0!==d?{size:d}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u})];return Object.assign(Object.assign(Object.assign({},l),{transform:n}),p.length>1?{layer:p}:Object.assign({},p[0]))}function t7(e,t,n){var r;const{mark:i,encoding:a,selection:o}=e,s=Z8(e,["mark","encoding","selection","projection"]),l=W4(i)?i:{type:i};o&&p3(y.selectionNotSupported(t));const{orient:u,inputType:c}=function(e,t){const{encoding:n}=e;if(function(e){return(R6(e.x)||R6(e.y))&&!R6(e.x2)&&!R6(e.y2)&&!R6(e.xError)&&!R6(e.xError2)&&!R6(e.yError)&&!R6(e.yError2)}(n))return{orient:W8(e,t),inputType:"raw"};const r=function(e){return R6(e.x2)||R6(e.y2)}(n),i=function(e){return R6(e.xError)||R6(e.xError2)||R6(e.yError)||R6(e.yError2)}(n),a=n.x,o=n.y;if(r){if(i)throw new Error(t+" cannot be both type aggregated-upper-lower and aggregated-error");const e=n.x2,r=n.y2;if(R6(e)&&R6(r))throw new Error(t+" cannot have both x2 and y2");if(R6(e)){if(j6(a))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error("Both x and x2 have to be quantitative in "+t)}if(R6(r)){if(j6(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error("Both y and y2 have to be quantitative in "+t)}throw new Error("No ranged axis")}{const e=n.xError,r=n.yError,i=n.yError2;if(R6(n.xError2)&&!R6(e))throw new Error(t+" cannot have xError2 without xError");if(R6(i)&&!R6(r))throw new Error(t+" cannot have yError2 without yError");if(R6(e)&&R6(r))throw new Error(t+" cannot have both xError and yError with both are quantiative");if(R6(e)){if(j6(a))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(R6(r)){if(j6(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:h,continuousAxisChannelDefError:f,continuousAxisChannelDefError2:p,continuousAxis:m}=U8(e,u,t),{errorBarSpecificAggregate:g,postAggregateCalculates:v,tooltipSummary:b,tooltipTitleWithFieldName:x}=function(e,t,n,r,i,a,o,s){let l=[],u=[];const c=t.field;let d,h=!1;if("raw"===a){const t=e.center?e.center:e.extent?"iqr"===e.extent?"median":"mean":s.errorbar.center,n=e.extent?e.extent:"mean"===t?"stderr":"iqr";if("median"===t!=("iqr"===n)&&p3(y.errorBarCenterIsUsedWithWrongExtent(t,n,o)),"stderr"===n||"stdev"===n)l=[{op:n,field:c,as:"extent_"+c},{op:t,field:c,as:"center_"+c}],u=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],d=[{fieldPrefix:"center_",titlePrefix:U0(t)},{fieldPrefix:"upper_",titlePrefix:n7(t,n,"+")},{fieldPrefix:"lower_",titlePrefix:n7(t,n,"-")}],h=!0;else{let e,t,r;"ci"===n?(e="mean",t="ci0",r="ci1"):(e="median",t="q1",r="q3"),l=[{op:t,field:c,as:"lower_"+c},{op:r,field:c,as:"upper_"+c},{op:e,field:c,as:"center_"+c}],d=[{fieldPrefix:"upper_",titlePrefix:K6({field:c,aggregate:r,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:K6({field:c,aggregate:t,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:K6({field:c,aggregate:e,type:"quantitative"},s,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&p3(y.errorBarCenterAndExtentAreNotNeeded(e.center,e.extent)),"aggregated-upper-lower"===a?(d=[],u=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):"aggregated-error"===a&&(d=[{fieldPrefix:"",titlePrefix:c}],u=[{calculate:`datum["${c}"] + datum["${r.field}"]`,as:"upper_"+c}],u.push(i?{calculate:`datum["${c}"] + datum["${i.field}"]`,as:"lower_"+c}:{calculate:`datum["${c}"] - datum["${r.field}"]`,as:"lower_"+c}));for(const e of u)d.push({fieldPrefix:e.as.substring(0,6),titlePrefix:G0(G0(e.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:u,errorBarSpecificAggregate:l,tooltipSummary:d,tooltipTitleWithFieldName:h}}(l,d,h,f,p,c,t,n),w="x"===m?"x2":"y2",_="x"===m?"xError":"yError",k="x"===m?"xError2":"yError2",E=Z8(a,["symbol"==typeof m?m:m+"","symbol"==typeof w?w:w+"","symbol"==typeof _?_:_+"","symbol"==typeof k?k:k+""]),{bins:S,timeUnits:T,aggregate:C,groupby:I,encoding:A}=N8(E,n),O=[...C,...g],D="raw"!==c?[]:I,M=L8(b,d,A,x);return{transform:[...null!==(r=s.transform)&&void 0!==r?r:[],...S,...T,...0===O.length?[]:[{aggregate:O,groupby:D}],...v],groupby:D,continuousAxisChannelDef:d,continuousAxis:m,encodingWithoutContinuousAxis:A,ticksOrient:"vertical"===u?"horizontal":"vertical",markDef:l,outerSpec:s,tooltipEncoding:M}}function n7(e,t,n){return U0(e)+" "+n+" "+t}const r7="errorband",i7=new O8(r7,a7);function a7(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:j8(e.encoding,t)});const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,markDef:o,outerSpec:s,tooltipEncoding:l}=t7(e,r7,t),u=o,c=$8(u,i,r,a,t.errorband),d=void 0!==e.encoding.x&&void 0!==e.encoding.y;let h={type:d?"area":"rect"},f={type:d?"line":"rule"};const p=Object.assign(Object.assign({},u.interpolate?{interpolate:u.interpolate}:{}),u.tension&&u.interpolate?{tension:u.tension}:{});return d?(h=Object.assign(Object.assign(Object.assign({},h),p),{ariaRoleDescription:"errorband"}),f=Object.assign(Object.assign(Object.assign({},f),p),{aria:!1})):u.interpolate?p3(y.errorBand1DNotSupport("interpolate")):u.tension&&p3(y.errorBand1DNotSupport("tension")),Object.assign(Object.assign({},s),{transform:n,layer:[...c({partName:"band",mark:h,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l}),...c({partName:"borders",mark:f,positionPrefix:"lower",extraEncoding:l}),...c({partName:"borders",mark:f,positionPrefix:"upper",extraEncoding:l})]})}const o7={};function s7(e,t,n){const r=new O8(e,t);o7[e]={normalizer:r,parts:n}}s7(q8,X8,["box","median","outliers","rule","ticks"]),s7(J8,e7,["ticks","rule"]),s7(r7,a7,["band","borders"]);const l7=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],u7={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},c7={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},d7=F0(u7),h7=F0(c7),f7=F0({header:1,headerRow:1,headerColumn:1,headerFacet:1}),p7=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],m7={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1};F0(m7);var g7=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function v7(e){const t=[];for(const n of e||[]){const{expr:e,bind:r}=n,i=g7(n,["expr","bind"]);if(r&&e){const n=Object.assign(Object.assign({},i),{bind:r,init:e});t.push(n)}else{const n=Object.assign(Object.assign(Object.assign({},i),e?{update:e}:{}),r?{bind:r}:{});t.push(n)}}return t}const y7="_vgsid_",b7={single:{on:"click",fields:[y7],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[y7],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function x7(e){return!(!e||"legend"!==e&&!e.legend)}function w7(e){return x7(e)&&Em(e)}function _7(e){return"concat"in e}function k7(e){return"vconcat"in e}function E7(e){return"hconcat"in e}function S7(e){return Em(e)&&void 0!==e.step}function T7(e){return e.view||e.width||e.height}const C7=F0({align:1,bounds:1,center:1,columns:1,spacing:1});function I7(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e["width"===t?"continuousWidth":"continuousHeight"]}function A7(e,t){const n=O7(e,t);return S7(n)?n.step:D7}function O7(e,t){var n;return K0(null!==(n=e[t])&&void 0!==n?n:e["width"===t?"discreteWidth":"discreteHeight"],{step:e.step})}const D7=20,M7={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:D7},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:{binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},circle:{},geoshape:{},image:{},line:{},point:{},rect:{binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5},rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:b7,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},N7=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],j7={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},F7={blue:N7[0],orange:N7[1],red:N7[2],teal:N7[3],green:N7[4],yellow:N7[5],purple:N7[6],pink:N7[7],brown:N7[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function R7(e){const t=F0(e||{}),n={};for(const r of t){const t=e[r];n[r]=a1(t)?p8(t):m8(t)}return n}const P7=[...G4,...d1,...f7,"background","padding","legend","lineBreak","scale","style","title","view"];function L7(e={}){const{color:t,font:n,fontSize:r}=e,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["color","font","fontSize"]),a=Tm({},M7,n?function(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}(n):{},t?function(e={}){return{signals:[{name:"color",value:Em(e)?Object.assign(Object.assign({},F7),e):F7}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(t):{},r?function(e){return{signals:[{name:"fontSize",value:Em(e)?Object.assign(Object.assign({},j7),e):j7}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(r):{},i||{}),o=b0(a,P7);for(const s of["background","lineBreak","padding"])a[s]&&(o[s]=m8(a[s]));for(const s of G4)a[s]&&(o[s]=S4(a[s]));for(const s of d1)a[s]&&(o[s]=R7(a[s]));for(const s of f7)a[s]&&(o[s]=S4(a[s]));return a.legend&&(o.legend=S4(a.legend)),a.scale&&(o.scale=S4(a.scale)),a.style&&(o.style=function(e){const t=F0(e),n={};for(const r of t)n[r]=R7(e[r]);return n}(a.style)),a.title&&(o.title=S4(a.title)),a.view&&(o.view=S4(a.view)),o}const B7=["view",...H4],$7=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],z7=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function U7(e,t,n,r){"view"===t&&(n="cell");const i=Object.assign(Object.assign({},r?e[t][r]:e[t]),e.style[null!=n?n:t]);j0(i)||(e.style[null!=n?n:t]=i),r||delete e[t]}function H7(e){return"layer"in e}const W7={zero:1,center:1,normalize:1},V7=new Set([C4,A4,I4,j4,M4,L4,B4,D4,F4,R4]),q7=new Set([A4,I4,C4]);function G7(e,t){var n,r;const i="x"===t?"y":"radius",a=e[t],o=e[i];if(D6(a)&&D6(o))if("quantitative"===M6(a)&&"quantitative"===M6(o)){if(a.stack)return t;if(o.stack)return i;const e=D6(a)&&!!a.aggregate;if(e!==(D6(o)&&!!o.aggregate))return e?t:i;{const e=null===(n=a.scale)||void 0===n?void 0:n.type,s=null===(r=o.scale)||void 0===r?void 0:r.type;if(e&&"linear"!==e)return i;if(s&&"linear"!==s)return t}}else{if("quantitative"===M6(a))return t;if("quantitative"===M6(o))return i}else{if("quantitative"===M6(a))return t;if("quantitative"===M6(o))return i}}function Y7(e,t,n={}){const r=W4(e)?e.type:e;if(!V7.has(r))return null;const i=G7(t,"x")||G7(t,"theta");if(!i)return null;const a=t[i],o=D6(a)?W6(a,{}):void 0;let s=function(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(i),l=t[s],u=D6(l)?W6(l,{}):void 0;u===o&&(u=void 0,l=void 0,s=void 0);const c=_2.reduce((e,n)=>{if("tooltip"!==n&&D8(t,n)){const r=t[n];for(const t of Ym(r)){const r=e8(t);if(r.aggregate)continue;const i=W6(r,{});i&&i===u||e.push({channel:n,fieldDef:r})}}return e},[]);let d;if(void 0!==a.stack?d=pg(a.stack)?a.stack?"zero":null:a.stack:c.length>0&&q7.has(r)&&(d="zero"),!d||!(d in W7))return null;if(M8(t)&&0===c.length)return null;if(a.scale&&a.scale.type&&a.scale.type!==e4){if(n.disallowNonLinearStack)return null;p3(y.cannotStackNonLinearScale(a.scale.type))}return R6(t[b2(i)])?(void 0!==a.stack&&p3(y.cannotStackRangedMark(i)),null):(D6(a)&&a.aggregate&&!k0(b1,a.aggregate)&&p3(y.stackNonSummativeAggregate(a.aggregate)),{groupbyChannel:l?s:void 0,groupbyField:u,fieldChannel:i,impute:null!==a.impute&&z4(r),stackBy:c,offset:d})}var X7=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function K7(e){const t=X7(e,["point","line"]);return F0(t).length>1?t:t.type}function Z7(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:b0(e[t],["point","line"])}));return e}function J7(e,t={},n){return"transparent"===e.point?{opacity:0}:e.point?Em(e.point)?e.point:{}:void 0!==e.point?null:t.point||n.shape?Em(t.point)?t.point:{}:void 0}function Q7(e,t={}){return e.line?!0===e.line?{}:e.line:void 0!==e.line?null:t.line?!0===t.line?{}:t.line:void 0}class e9{constructor(){this.name="path-overlay"}hasMatchingType(e,t){if(A8(e)){const{mark:n,encoding:r}=e,i=W4(n)?n:{type:n};switch(i.type){case"line":case"rule":case"trail":return!!J7(i,t[i.type],r);case"area":return!!J7(i,t[i.type],r)||!!Q7(i,t[i.type])}}return!1}run(e,t,n){const{config:r}=t,{selection:i,projection:a,mark:o,encoding:s}=e,l=X7(e,["selection","projection","mark","encoding"]),u=j8(s,r),c=W4(o)?o:{type:o},d=J7(c,r[c.type],u),h="area"===c.type&&Q7(c,r[c.type]),f=[Object.assign(Object.assign({},i?{selection:i}:{}),{mark:K7(Object.assign(Object.assign({},"area"===c.type&&void 0===c.opacity&&void 0===c.fillOpacity?{opacity:.7}:{}),c)),encoding:b0(u,["shape"])})],p=Y7(c,u);let m=u;if(p){const{fieldChannel:e,offset:t}=p;m=Object.assign(Object.assign({},u),{[e]:Object.assign(Object.assign({},u[e]),t?{stack:t}:{})})}return h&&f.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"line"},y0(c,["clip","interpolate","tension","tooltip"])),h),encoding:m})),d&&f.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},y0(c,["clip","tooltip"])),d),encoding:m})),n(Object.assign(Object.assign({},l),{layer:f}),Object.assign(Object.assign({},t),{config:Z7(r)}))}}var t9=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class n9{constructor(){this.name="RangeStep"}hasMatchingType(e){var t;if(A8(e)&&e.encoding)for(const n of E2){const r=e.encoding[n];if(r&&R6(r)&&(null===(t=null==r?void 0:r.scale)||void 0===t?void 0:t.rangeStep))return!0}return!1}run(e){var t;const n={};let r=Object.assign({},e.encoding);for(const i of E2){const e=x2(i),a=r[i];if(a&&R6(a)&&(null===(t=null==a?void 0:a.scale)||void 0===t?void 0:t.rangeStep)){const{scale:t}=a,o=t9(a,["scale"]),s=t9(t,["rangeStep"]);n[e]={step:t.rangeStep},p3(y.RANGE_STEP_DEPRECATED),r=Object.assign(Object.assign({},r),{[i]:Object.assign(Object.assign({},o),j0(s)?{}:{scale:s})})}}return Object.assign(Object.assign(Object.assign({},n),e),{encoding:r})}}function r9(e,t){return t?x6(e)?u9(e,t):o9(e,t):e}function i9(e,t){return t?u9(e,t):e}function a9(e,t,n){const r=t[e];return(i=r)&&!bg(i)&&"repeat"in i?r.repeat in n?Object.assign(Object.assign({},t),{[e]:n[r.repeat]}):void p3(y.noSuchRepeatedValue(r.repeat)):t;var i}function o9(e,t){if(void 0!==(e=a9("field",e,t))){if(null===e)return null;if(S6(e)&&y6(e.sort)){const n=a9("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function s9(e,t){if(D6(e))return o9(e,t);{const n=a9("datum",e,t);return n===e||n.type||(n.type="nominal"),n}}function l9(e,t){if(!R6(e)){if(O6(e)){const n=s9(e.condition,t);return n?Object.assign(Object.assign({},e),{condition:n}):function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["condition"])}return e}{const n=s9(e,t);if(n)return n;if(I6(e))return{condition:e.condition}}}function u9(e,t){const n={};for(const r in e)if(lg(e,r)){const i=e[r];if(km(i))n[r]=i.map(e=>l9(e,t)).filter(e=>e);else{const e=l9(i,t);void 0!==e&&(n[r]=e)}}return n}class c9{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(A8(e)){const{encoding:t,mark:n}=e;if("line"===n)for(const e of m2){const n=t[v2(e)];if(t[e]&&(D6(n)&&!B2(n.bin)||N6(n)))return!0}}return!1}run(e,t,n){const{encoding:r}=e;return p3(y.lineWithRange(!!r.x2,!!r.y2)),n(Object.assign(Object.assign({},e),{mark:"rule"}),t)}}var d9=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function h9({parentEncoding:e,encoding:t={},layer:n}){let r={};if(e){const i=new Set([...F0(e),...F0(t)]);for(const a of i){const i=t[a],o=e[a];if(R6(i)){const e=Object.assign(Object.assign({},o),i);r[a]=e}else O6(i)?r[a]=Object.assign(Object.assign({},i),{condition:Object.assign(Object.assign({},o),i.condition)}):i||null===i?r[a]=i:(n||L6(o)||O3(o)||R6(o)||km(o))&&(r[a]=o)}}else r=t;return!r||j0(r)?void 0:r}function f9(e){const{parentProjection:t,projection:n}=e;return t&&n&&p3(y.projectionOverridden({parentProjection:t,projection:n})),null!=n?n:t}function p9(e,t){void 0===t&&(t=L7(e.config));const n=function(e,t={}){return m9.map(e,{config:t})}(e,t),{width:r,height:i}=e,a=function(e,t,n){let{width:r,height:i}=t;const a=A8(e)||H7(e),o={};a?"container"==r&&"container"==i?(o.type="fit",o.contains="padding"):"container"==r?(o.type="fit-x",o.contains="padding"):"container"==i&&(o.type="fit-y",o.contains="padding"):("container"==r&&(p3(y.containerSizeNonSingle("width")),r=void 0),"container"==i&&(p3(y.containerSizeNonSingle("height")),i=void 0));const s=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?g9(n.autosize):{}),g9(e.autosize));if("fit"!==s.type||a||(p3(y.FIT_NON_SINGLE),s.type="pad"),"container"==r&&"fit"!=s.type&&"fit-x"!=s.type&&p3(y.containerSizeNotCompatibleWithAutosize("width")),"container"==i&&"fit"!=s.type&&"fit-y"!=s.type&&p3(y.containerSizeNotCompatibleWithAutosize("height")),!g0(s,{type:"pad"}))return s}(n,{width:r,height:i,autosize:e.autosize},t);return Object.assign(Object.assign({},n),a?{autosize:a}:{})}const m9=new class extends class{map(e,t){return _6(e)?this.mapFacet(e,t):function(e){return"repeat"in e}(e)?this.mapRepeat(e,t):E7(e)?this.mapHConcat(e,t):k7(e)?this.mapVConcat(e,t):_7(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if(H7(e))return this.mapLayer(e,t);if(A8(e))return this.mapUnit(e,t);throw new Error(y.invalidSpec(e))}mapLayer(e,t){return Object.assign(Object.assign({},e),{layer:e.layer.map(e=>this.mapLayerOrUnit(e,t))})}mapHConcat(e,t){return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map(e=>this.map(e,t))})}mapVConcat(e,t){return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map(e=>this.map(e,t))})}mapConcat(e,t){const{concat:n}=e,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["concat"]);return Object.assign(Object.assign({},r),{concat:n.map(e=>this.map(e,t))})}mapFacet(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}mapRepeat(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}}{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[G8,Q8,i7,new e9,new c9,new n9]}map(e,t){if(A8(e)){const n=D8(e.encoding,_1),r=D8(e.encoding,k1),i=D8(e.encoding,E1);if(n||r||i)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:r}=t,i=i9(e.encoding,t.repeater),a=Object.assign(Object.assign({},e),i?{encoding:i}:{});if(n||r)return this.mapUnitWithParentEncodingOrProjection(a,t);const o=this.mapLayerOrUnit.bind(this);for(const s of this.nonFacetUnitNormalizers)if(s.hasMatchingType(a,t.config))return s.run(a,t,o);return a}mapRepeat(e,t){return function(e){return!km(e.repeat)&&e.repeat.layer}(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:r}=e,i=d9(e,["repeat","spec"]),{row:a,column:o,layer:s}=n,{repeater:l={},repeaterPrefix:u=""}=t;return a||o?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},a?{row:a}:{}),o?{column:o}:{}),spec:{repeat:{layer:s},spec:r}}),t):Object.assign(Object.assign({},i),{layer:s.map(e=>{const n=Object.assign(Object.assign({},l),{layer:e}),i=(r.name||"")+u+"child__layer_"+B0(e),a=this.mapLayerOrUnit(r,Object.assign(Object.assign({},t),{repeater:n,repeaterPrefix:i}));return a.name=i,a})})}mapNonLayerRepeat(e,t){var n;const{repeat:r,spec:i,data:a}=e,o=d9(e,["repeat","spec","data"]);!km(r)&&e.columns&&(e=b0(e,["columns"]),p3(y.columnsNotSupportByRowCol("repeat")));const s=[],{repeater:l={},repeaterPrefix:u=""}=t,c=!km(r)&&r.row||[l?l.row:null],d=!km(r)&&r.column||[l?l.column:null],h=km(r)&&r||[l?l.repeat:null];for(const p of h)for(const e of c)for(const n of d){const a={repeat:p,row:e,column:n,layer:l.layer},o=(i.name||"")+u+"child__"+(km(r)?""+B0(p):(r.row?"row_"+B0(e):"")+(r.column?"column_"+B0(n):"")),c=this.map(i,Object.assign(Object.assign({},t),{repeater:a,repeaterPrefix:o}));c.name=o,s.push(b0(c,["data"]))}const f=km(r)?e.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:null!==(n=i.data)&&void 0!==n?n:a,align:"all"},o),{columns:f,concat:s})}mapFacet(e,t){const{facet:n}=e;return x6(n)&&e.columns&&(e=b0(e,["columns"]),p3(y.columnsNotSupportByRowCol("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:r}=e,{parentEncoding:i,parentProjection:a,config:o}=t,s=f9({parentProjection:a,projection:r}),l=h9({parentEncoding:i,encoding:i9(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),s?{projection:s}:{}),l?{encoding:l}:{}),{config:o})}mapFacetedUnit(e,t){const n=e.encoding,{row:r,column:i,facet:a}=n,o=d9(n,["row","column","facet"]),{mark:s,width:l,projection:u,height:c,view:d,selection:h}=e,f=d9(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:p,layout:m}=this.getFacetMappingAndLayout({row:r,column:i,facet:a},t),g=i9(o,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},f),m),{facet:p,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),c?{height:c}:{}),d?{view:d}:{}),u?{projection:u}:{}),{mark:s,encoding:g}),h?{selection:h}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:r,column:i,facet:a}=e;if(r||i){a&&p3(y.facetChannelDropped([...r?[_1]:[],...i?[k1]:[]]));const t={},o={};for(const r of[_1,k1]){const i=e[r];if(i){const e=d9(i,["align","center","spacing","columns"]);t[r]=e;for(const t of["align","center","spacing"])void 0!==i[t]&&(o[t]=null!==(n=o[t])&&void 0!==n?n:{},o[t][r]=i[t])}}return{facetMapping:t,layout:o}}{const{align:e,center:n,spacing:r,columns:i}=a;return{facetMapping:r9(d9(a,["align","center","spacing","columns"]),t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},e?{align:e}:{}),n?{center:n}:{}),r?{spacing:r}:{}),i?{columns:i}:{})}}}mapLayer(e,t){var{parentEncoding:n,parentProjection:r}=t,i=d9(t,["parentEncoding","parentProjection"]);const{encoding:a,projection:o}=e,s=d9(e,["encoding","projection"]),l=Object.assign(Object.assign({},i),{parentEncoding:h9({parentEncoding:n,encoding:a,layer:!0}),parentProjection:f9({parentProjection:r,projection:o})});return super.mapLayer(s,l)}};function g9(e){return bg(e)?{type:e}:null!=e?e:{}}const v9=["background","padding"];function y9(e,t){const n={};for(const r of v9)e&&void 0!==e[r]&&(n[r]=m8(e[r]));return t&&(n.params=e.params),n}class b9{constructor(e={},t={}){this.explicit=e,this.implicit=t}clone(){return new b9(v0(this.explicit),v0(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(e){return K0(this.explicit[e],this.implicit[e])}getWithExplicit(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)}copyKeyFromObject(e,t){void 0!==t[e]&&this.set(e,t[e],!0)}copyAll(e){for(const t of F0(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function x9(e){return{explicit:!0,value:e}}function w9(e){return{explicit:!1,value:e}}function _9(e){return(t,n,r,i)=>{const a=e(t.value,n.value);return a>0?t:a<0?n:k9(t,n,r,i)}}function k9(e,t,n,r){return e.explicit&&t.explicit&&p3(y.mergeConflictingProperty(n,r,e.value,t.value)),e}function E9(e,t,n,r,i=k9){return void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:g0(e.value,t.value)?e:i(e,t,n,r)}class S9 extends b9{constructor(e={},t={},n=!1){super(e,t),this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function T9(e){return"url"in e}function C9(e){return"values"in e}function I9(e){return"name"in e&&!T9(e)&&!C9(e)&&!A9(e)}function A9(e){return e&&(O9(e)||D9(e)||M9(e))}function O9(e){return"sequence"in e}function D9(e){return"sphere"in e}function M9(e){return"graticule"in e}var N9;function j9(e){return"filter"in e}function F9(e){return"lookup"in e}function R9(e){return"pivot"in e}function P9(e){return"density"in e}function L9(e){return"quantile"in e}function B9(e){return"regression"in e}function $9(e){return"loess"in e}function z9(e){return"sample"in e}function U9(e){return"window"in e}function H9(e){return"joinaggregate"in e}function W9(e){return"flatten"in e}function V9(e){return"calculate"in e}function q9(e){return"bin"in e}function G9(e){return"impute"in e}function Y9(e){return"timeUnit"in e}function X9(e){return"aggregate"in e}function K9(e){return"stack"in e}function Z9(e){return"fold"in e}function J9(e,t,n,r){const i=I6(t)&&t.condition,a=r(t);return i?{[n]:[...Ym(i).map(t=>{const n=r(t),i=function(e){return e.selection}(t)?mne(e,t.selection):vne(e,t.test);return Object.assign({test:i},n)}),...void 0!==a?[a]:[]]}:void 0!==a?{[n]:a}:{}}function Q9(e,t="text"){return J9(e,e.encoding[t],t,t=>eee(t,e.config))}function eee(e,t,n="datum"){if(e){if(L6(e))return v8(e.value);if(R6(e)){const{format:r,formatType:i}=Q6(e);return a6({fieldOrDatumDef:e,format:r,formatType:i,expr:n,config:t})}}}function tee(e,t={}){const{encoding:n,markDef:r,config:i,stack:a}=e,o=n.tooltip;if(km(o))return{tooltip:ree({tooltip:o},a,i,t)};{const s=t.reactiveGeom?"datum.datum":"datum";return J9(e,o,"tooltip",e=>{const o=eee(e,i,s);if(o)return o;if(null===e)return;let l=w8("tooltip",r,i);return!0===l&&(l={content:"encoding"}),bg(l)?{value:l}:Em(l)?O3(l)?l:"encoding"===l.content?ree(n,a,i,t):{signal:s}:void 0})}}function nee(e,t,n,{reactiveGeom:r}={}){const i={},a=r?"datum.datum":"datum",o=[];function s(r,s){const l=v2(s),u=P6(r)?r:Object.assign(Object.assign({},r),{type:e[l].type}),c=Ym(u.title||J6(u,n)).join(", ");let d;if(S2(s)){const r="x"===s?"x2":"y2",o=e8(e[r]);if(B2(u.bin)&&o){const e=W6(u,{expr:a}),t=W6(o,{expr:a}),{format:s,formatType:l}=Q6(u);d=f6(e,t,s,l,n),i[r]=!0}else if(t&&t.fieldChannel===s&&"normalize"===t.offset){const{format:e,formatType:t}=Q6(u);d=a6({fieldOrDatumDef:u,format:e,formatType:t,expr:a,config:n,normalizeStack:!0}).signal}}d=null!=d?d:eee(u,n,a).signal,o.push({channel:s,key:c,value:d})}F8(e,(e,t)=>{D6(e)?s(e,t):A6(e)&&s(e.condition,t)});const l={};for(const{channel:u,key:c,value:d}of o)i[u]||l[c]||(l[c]=d);return l}function ree(e,t,n,{reactiveGeom:r}={}){const i=nee(e,t,n,{reactiveGeom:r}),a=P0(i).map(([e,t])=>`"${e}": ${t}`);return a.length>0?{signal:`{${a.join(", ")}}`}:void 0}function iee(e,t,n={}){const{markDef:r,encoding:i,config:a}=t,{vgChannel:o}=n;let{defaultRef:s,defaultValue:l}=n;return void 0===s&&(l=null!=l?l:w8(e,r,a,{vgChannel:o,ignoreVgConfig:!0}),void 0!==l&&(s=v8(l))),J9(t,i[e],null!=o?o:e,n=>t6({channel:e,channelDef:n,markDef:r,config:a,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:s}))}function aee(e,t={filled:void 0}){var n,r,i,a;const{markDef:o,encoding:s,config:l}=e,{type:u}=o,c=null!==(n=t.filled)&&void 0!==n?n:w8("filled",o,l),d=k0(["bar","point","circle","square","geoshape"],u)?"transparent":void 0,h=null!==(i=null!==(r=w8(!0===c?"color":void 0,o,l,{vgChannel:"fill"}))&&void 0!==r?r:l.mark[!0===c&&"color"])&&void 0!==i?i:d,f=null!==(a=w8(!1===c?"color":void 0,o,l,{vgChannel:"stroke"}))&&void 0!==a?a:l.mark[!1===c&&"color"],p=c?"fill":"stroke",m=Object.assign(Object.assign({},h?{fill:v8(h)}:{}),f?{stroke:v8(f)}:{});return o.color&&(c?o.fill:o.stroke)&&p3(y.droppingColor("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},m),iee("color",e,{vgChannel:p,defaultValue:c?h:f})),iee("fill",e,{defaultValue:s.fill?h:void 0})),iee("stroke",e,{defaultValue:s.stroke?f:void 0}))}function oee(e,t){const n=t[function(e){switch(e){case S1:return"xOffset";case T1:return"yOffset";case C1:return"x2Offset";case I1:return"y2Offset";case D1:return"thetaOffset";case A1:return"radiusOffset";case M1:return"theta2Offset";case O1:return"radius2Offset"}}(e)];if(n)return n}function see(e,t,{defaultPos:n,vgChannel:r,isMidPoint:i}){const{encoding:a,markDef:o,config:s,stack:l}=t,u=a[e],c=a[b2(e)],d=t.scaleName(e),h=t.getScaleComponent(e),f=oee(e,o),p=lee({model:t,defaultPos:n,channel:e,scaleName:d,scale:h}),m=!u&&S2(e)&&(a.latitude||a.longitude)?{field:t.getName(e)}:function(e){const{channel:t,channelDef:n,isMidPoint:r,scaleName:i,stack:a,offset:o,markDef:s,config:l}=e;if(R6(n)&&a&&t===a.fieldChannel){if(D6(n)){const e=T6({channel:t,fieldDef:n,isMidPoint:r,markDef:s,stack:a,config:l});if(void 0!==e)return e6({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",band:e,offset:o})}return Q4(n,i,{suffix:"end"},{offset:o})}return X4(e)}({channel:e,channelDef:u,channel2Def:c,markDef:o,config:s,isMidPoint:i,scaleName:d,scale:h,stack:l,offset:f,defaultRef:p});return m?{[r||e]:m}:void 0}function lee({model:e,defaultPos:t,channel:n,scaleName:r,scale:i}){const{markDef:a,config:o}=e;return()=>{const s=v2(n),l=y2(n),u=w8(n,a,o,{vgChannel:l});if(void 0!==u)return n6(n,u);switch(t){case"zeroOrMin":case"zeroOrMax":if(r){const e=i.get("type");if(k0(["log",t4,n4],e));else if(i.domainDefinitelyIncludesZero())return{scale:r,value:0}}if("zeroOrMin"===t)return"y"===s?{field:{group:"height"}}:{value:0};switch(s){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const t=e[x2(n)];return Object.assign(Object.assign({},t),{mult:.5})}}}}!function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"}(N9||(N9={}));const uee={left:"x",center:"xc",right:"x2"},cee={top:"y",middle:"yc",bottom:"y2"};function dee(e,t,n,r="middle"){if("radius"===e||"theta"===e)return y2(e);const i="x"===e?"align":"baseline",a=w8(i,t,n);let o;return O3(a)?(p3(y.rangeMarkAlignmentCannotBeExpression(i)),o=void 0):o=a,"x"===e?uee[o||("top"===r?"left":"center")]:cee[o||r]}function hee(e,t,{defaultPos:n,defaultPos2:r,range:i}){return i?fee(e,t,{defaultPos:n,defaultPos2:r}):see(e,t,{defaultPos:n})}function fee(e,t,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:a}=t,o=b2(e),s=x2(e),l=function(e,t,n){const{encoding:r,mark:i,markDef:a,stack:o,config:s}=e,l=v2(n),u=x2(n),c=y2(n),d=r[l],h=e.scaleName(l),f=e.getScaleComponent(l),p=oee(n in r||n in a?n:l,e.markDef);if(!d&&("x2"===n||"y2"===n)&&(r.latitude||r.longitude))return{[c]:{field:e.getName(n)}};const m=function({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u}){return R6(t)&&s&&e.charAt(0)===s.fieldChannel.charAt(0)?Q4(t,a,{suffix:"start"},{offset:l}):X4({channel:e,channelDef:n,scaleName:a,scale:o,stack:s,markDef:r,config:i,offset:l,defaultRef:u})}({channel:n,channelDef:d,channel2Def:r[n],markDef:a,config:s,scaleName:h,scale:f,stack:o,offset:p,defaultRef:void 0});return void 0!==m?{[c]:m}:pee(n,a)||pee(n,{[n]:k8(n,a,s.style),[u]:k8(u,a,s.style)})||pee(n,s[i])||pee(n,s.mark)||{[c]:lee({model:e,defaultPos:t,channel:n,scaleName:h,scale:f})()}}(t,r,o),u=l[s]?dee(e,i,a):y2(e);return Object.assign(Object.assign({},see(e,t,{defaultPos:n,vgChannel:u})),l)}function pee(e,t){const n=x2(e),r=y2(e);return void 0!==t[r]?{[r]:n6(e,t[r])}:void 0!==t[e]?{[r]:n6(e,t[e])}:t[n]?{[n]:n6(e,t[n])}:void 0}function mee(e,t,n){var r,i,a,o;const{config:s,encoding:l,markDef:u,stack:c}=e,d=b2(t),h=x2(t),f=l[t],p=l[d],m=e.getScaleComponent(t),g=m?m.get("type"):void 0,v=e.scaleName(t),b=u.orient,x=null!==(i=null!==(r=l[h])&&void 0!==r?r:l.size)&&void 0!==i?i:w8("size",u,s,{vgChannel:h}),w="bar"===n&&("x"===t?"vertical"===b:"horizontal"===b);if(D6(f)&&(L2(f.bin)||B2(f.bin)||f.timeUnit&&!p)&&!x&&!p4(g)){const n=T6({channel:t,fieldDef:f,stack:c,markDef:u,config:s}),r=null===(a=e.component.axes[t])||void 0===a?void 0:a[0];return function({fieldDef:e,fieldDef2:t,channel:n,band:r,scaleName:i,markDef:a,spacing:o=0,axisTranslate:s,reverse:l,config:u}){const c=b2(n),d=y2(n),h=y2(c),f=oee(n,a);if(L2(e.bin)||e.timeUnit)return{[h]:yee({channel:n,fieldDef:e,scaleName:i,markDef:a,band:(1-r)/2,offset:vee(c,o,l,s,f),config:u}),[d]:yee({channel:n,fieldDef:e,scaleName:i,markDef:a,band:1-(1-r)/2,offset:vee(n,o,l,s,f),config:u})};if(B2(e.bin)){const r=Q4(e,i,{},{offset:vee(c,o,l,s,f)});if(D6(t))return{[h]:r,[d]:Q4(t,i,{},{offset:vee(n,o,l,s,f)})};if($2(e.bin)&&e.bin.step)return{[h]:r,[d]:{signal:`scale("${i}", ${W6(e,{expr:"datum"})} + ${e.bin.step})`,offset:vee(n,o,l,s,f)}}}p3(y.channelRequiredForBinned(c))}({fieldDef:f,fieldDef2:p,channel:t,markDef:u,scaleName:v,band:n,axisTranslate:null!==(o=null==r?void 0:r.get("translate"))&&void 0!==o?o:.5,spacing:S2(t)?w8("binSpacing",u,s):void 0,reverse:m.get("reverse"),config:s})}return(R6(f)&&p4(g)||w)&&!p?function(e,t,n,r){var i;const{markDef:a,encoding:o,config:s,stack:l}=r,u=a.orient,c=r.scaleName(n),d=r.getScaleComponent(n),h=x2(n),f=b2(n),p="horizontal"===u&&"y"===n||"vertical"===u&&"x"===n,m=w8(p?"size":h,a,s,{vgChannel:h});let g;(o.size||void 0!==m)&&(p?g=iee("size",r,{vgChannel:h,defaultValue:m}):p3(y.cannotApplySizeToNonOrientedMark(a.type)));const v=null!==(i=R6(t)?T6({channel:n,fieldDef:t,markDef:a,stack:l,config:s}):void 0)&&void 0!==i?i:1;g=g||{[h]:gee(e,h,c,d,s,v)};const b="band"!==(null==d?void 0:d.get("type"))||!("band"in g[h]),x=dee(n,a,s,b?"middle":"top"),w=oee(n,a),_=X4({channel:n,channelDef:t,markDef:a,config:s,scaleName:c,scale:d,stack:l,offset:w,defaultRef:lee({model:r,defaultPos:"mid",channel:n,scaleName:c,scale:d}),band:b?.5:(1-v)/2});if(h)return Object.assign({[x]:_},g);{const e=y2(f),t=g[h],n=w?Object.assign(Object.assign({},t),{offset:w}):t;return{[x]:_,[e]:km(_)?[_[0],Object.assign(Object.assign({},_[1]),{offset:n})]:Object.assign(Object.assign({},_),{offset:n})}}}(n,f,t,e):fee(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function gee(e,t,n,r,i,a){if(r){const t=r.get("type");if("point"===t||"band"===t){if(void 0!==i[e].discreteBandSize)return{value:i[e].discreteBandSize};if(t===r4){const e=r.get("range");return D3(e)&&vg(e.step)?{value:e.step-2}:{value:D7-2}}return{scale:n,band:a}}return{value:i[e].continuousBandSize}}const o=A7(i.view,t),s=K0(i[e].discreteBandSize,o-2);return void 0!==s?{value:s}:void 0}function vee(e,t,n,r,i){if(r2(e))return 0;const a="x"===e||"y2"===e?-t/2:t/2;if(O3(n)||O3(i)||O3(r)){const e=b8(n),t=b8(i),o=b8(r);return{signal:(o?o+" + ":"")+(e?`(${e} ? -1 : 1) * `:"")+(t?`(${t} + ${a})`:a)}}return i=i||0,r+(n?-i-a:+i+a)}function yee({channel:e,fieldDef:t,scaleName:n,markDef:r,band:i,offset:a,config:o}){return K4({fieldDef:t,channel:e,markDef:r,ref:e6({scaleName:n,fieldOrDatumDef:t,band:i,offset:a}),config:o})}const bee=new Set(["aria"]);function xee(e,t){const{fill:n,stroke:r}="include"===t.color?aee(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(e,t){return N3.reduce((n,r)=>(bee.has(r)||void 0===e[r]||"ignore"===t[r]||(n[r]=v8(e[r])),n),{})}(e.markDef,t)),wee(e,"fill",n)),wee(e,"stroke",r)),iee("opacity",e)),iee("fillOpacity",e)),iee("strokeOpacity",e)),iee("strokeWidth",e)),iee("strokeDash",e)),function(e){const{encoding:t,mark:n}=e,r=t.order;return!z4(n)&&L6(r)?J9(e,r,"zindex",e=>v8(e.value)):{}}(e)),tee(e)),Q9(e,"href")),function(e){const{markDef:t,config:n}=e,r=w8("aria",t,n);return!1===r?{}:Object.assign(Object.assign(Object.assign({},r?{aria:r}:{}),function(e){const{mark:t,markDef:n,config:r}=e;if(!1===r.aria)return{};const i=w8("ariaRoleDescription",n,r);return null!=i?{ariaRoleDescription:{value:i}}:t in j3?{}:{ariaRoleDescription:{value:t}}}(e)),function(e){const{encoding:t,markDef:n,config:r,stack:i}=e,a=t.description;if(a)return J9(e,a,"description",t=>eee(t,e.config));const o=w8("description",n,r);if(null!=o)return{description:v8(o)};if(!1===r.aria)return{};const s=nee(t,i,r);return j0(s)?void 0:{description:{signal:P0(s).map(([e,t],n)=>`"${n>0?"; ":""}${e}: " + (${t})`).join(" + ")}}}(e))}(e))}function wee(e,t,n){const{config:r,mark:i,markDef:a}=e;if("hide"===w8("invalid",a,r)&&n&&!z4(i)){const r=function(e,{invalid:t=!1,channels:n}){const r=n.reduce((t,n)=>{const r=e.getScaleComponent(n);if(r){const i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&m4(i)&&(t[a]=!0)}return t},{}),i=F0(r);if(i.length>0){const e=t?"||":"&&";return i.map(e=>J4(e,t)).join(` ${e} `)}}(e,{invalid:!0,channels:M2});if(r)return{[t]:[{test:r,value:null},...Ym(n)]}}return n?{[t]:n}:{}}function _ee(e){const{config:t,markDef:n}=e;if(w8("invalid",n,t)){const t=function(e,{invalid:t=!1,channels:n}){const r=n.reduce((t,n)=>{const r=e.getScaleComponent(n);if(r){const i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&m4(i)&&(t[a]=!0)}return t},{}),i=F0(r);if(i.length>0){const e=t?"||":"&&";return i.map(e=>J4(e,t)).join(` ${e} `)}}(e,{channels:E2});if(t)return{defined:{signal:t}}}return{}}function kee(e,t){if(void 0!==t)return{[e]:v8(t)}}const Eee="voronoi";var See={has:e=>"interval"!==e.type&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(Eee)},marks:(e,t,n)=>{const{x:r,y:i}=t.project.hasChannel,a=e.mark;if(z4(a))return p3(y.nearestNotSupportForContinuous(a)),n;const o={name:e.getName(Eee),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},tee(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let s=0,l=!1;return n.forEach((t,n)=>{var r;const i=null!==(r=t.name)&&void 0!==r?r:"";i===e.component.mark[0].name?s=n:i.indexOf(Eee)>=0&&(l=!0)}),l||n.splice(s+1,0,o),n}};class Tee{constructor(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){this._children.indexOf(e)>-1?p3(y.ADD_SAME_CHILD_TWICE):void 0!==t?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const n of this._children)n.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class Cee extends Tee{constructor(e,t,n,r){super(e,t),this.type=n,this.refCounts=r,this._source=this._name=t,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash="Output "+J0()),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}var Iee=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class Aee extends Tee{constructor(e,t){super(e),this.formula=t}clone(){return new Aee(null,v0(this.formula))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((e,n,r)=>{const{field:i,timeUnit:a}=n,o=Iie(t)?t.encoding[b2(r)]:void 0,s=Iie(t)&&C6(r,n,o,t.stack,t.markDef,t.config);if(a){const t=W6(n,{forAs:!0});e[w0({as:t,field:i,timeUnit:a})]=Object.assign({as:t,field:i,timeUnit:a},s?{band:!0}:{})}return e},{});return j0(n)?null:new Aee(e,n)}static makeFromTransform(e,t){const n=Object.assign({},t),{timeUnit:r}=n,i=Iee(n,["timeUnit"]),a=A3(r),o=Object.assign(Object.assign({},i),{timeUnit:a});return new Aee(e,{[w0(o)]:o})}merge(e){this.formula=Object.assign({},this.formula);for(const t in e.formula)this.formula[t]&&!e.formula[t].band||(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}removeFormulas(e){const t={};for(const[n,r]of P0(this.formula))e.has(r.as)||(t[n]=r);this.formula=t}producedFields(){return new Set(R0(this.formula).map(e=>e.as))}dependentFields(){return new Set(R0(this.formula).map(e=>e.field))}hash(){return"TimeUnit "+w0(this.formula)}assemble(){const e=[];for(const t of R0(this.formula)){const{field:n,as:r,timeUnit:i}=t,a=A3(i),{unit:o,utc:s}=a,l=Iee(a,["unit","utc"]);e.push(Object.assign(Object.assign(Object.assign(Object.assign({field:q0(n),type:"timeunit"},o?{units:T3(o)}:{}),s?{timezone:"utc"}:{}),l),{as:[r,r+"_end"]}))}return e}}const Oee="_tuple_fields";class Dee{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}var Mee={has:e=>"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind&&!x7(e.bind),parse:(e,t,n,r)=>{r.on||delete t.events,r.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const r=t.name,i=t.project,a=t.bind,o=t.init&&t.init[0],s=See.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach((e,i)=>{var l,u;const c=B0(`${r}_${e.field}`);n.filter(e=>e.name===c).length||n.unshift(Object.assign(Object.assign({name:c},o?{init:Xee(o[i])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${s}[${Cg(e.field)}] : null`}]:[],bind:null!==(u=null!==(l=a[e.field])&&void 0!==l?l:a[e.channel])&&void 0!==u?u:a}))}),n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.filter(e=>e.name===r+ote)[0],o=r+Oee,s=i.items.map(e=>B0(`${r}_${e.field}`)),l=s.map(e=>e+" !== null").join(" && ");return s.length&&(a.update=`${l} ? {fields: ${o}, values: [${s.join(", ")}]} : null`),delete a.value,delete a.on,n}};const Nee="_toggle";var jee={has:e=>"multi"===e.type&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+Nee,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+ote,r=t.name+Nee;return`${r} ? null : ${n}, `+("global"===t.resolve?r+" ? null : true, ":`${r} ? null : {unit: ${cte(e)}}, `)+`${r} ? ${n} : null`}};const Fee={has:e=>void 0!==e.clear&&!1!==e.clear,parse:(e,t,n)=>{n.clear&&(t.clear=bg(n.clear)?EK(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(Mee.has(t))for(const r of t.project.items){const e=n.findIndex(e=>e.name===B0(`${t.name}_${r.field}`));-1!==e&&n[e].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function r(e,r){-1!==e&&n[e].on&&n[e].on.push({events:t.clear,update:r})}if("interval"===t.type)for(const i of t.project.items){const e=n.findIndex(e=>e.name===i.signals.visual);r(e,"[0, 0]"),-1===e&&r(n.findIndex(e=>e.name===i.signals.data),"null")}else{let e=n.findIndex(e=>e.name===t.name+ote);r(e,"null"),jee.has(t)&&(e=n.findIndex(e=>e.name===t.name+Nee),r(e,"false"))}return n}};var Ree={has:e=>"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind,parse:(e,t)=>{const n=t.scales=[];for(const r of t.project.items){const i=r.channel;if(!N2(i))continue;const a=e.getScaleComponent(i),o=a?a.get("type"):void 0;a&&m4(o)?(a.set("selectionExtent",{selection:t.name,field:r.field},!0),n.push(r)):p3(y.SCALE_BINDINGS_CONTINUOUS)}},topLevelSignals:(e,t,n)=>{const r=t.scales.filter(e=>0===n.filter(t=>t.name===e.signals.data).length);if(!e.parent||Lee(e)||0===r.length)return n;const i=n.filter(e=>e.name===t.name)[0];let a=i.update;if(a.indexOf(ste)>=0)i.update=`{${r.map(e=>`${Cg(e.field)}: ${e.signals.data}`).join(", ")}}`;else{for(const e of r){const t=`${Cg(e.field)}: ${e.signals.data}`;a.indexOf(t)<0&&(a=`${a.substring(0,a.length-1)}, ${t}}`)}i.update=a}return n.concat(r.map(e=>({name:e.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!Lee(e))for(const r of t.scales){const e=n.filter(e=>e.name===r.signals.data)[0];e.push="outer",delete e.value,delete e.update}return n}};function Pee(e,t){return`domain(${Cg(e.scaleName(t))})`}function Lee(e){var t;return e.parent&&Die(e.parent)&&(null!==(t=!e.parent.parent)&&void 0!==t?t:Lee(e.parent.parent))}const Bee={has:e=>{const t="global"===e.resolve&&e.bind&&x7(e.bind),n=1===e.project.items.length&&e.project.items[0].field!==y7;return t&&!n&&p3(y.LEGEND_BINDINGS_MUST_HAVE_PROJECTION),t&&n},parse:(e,t,n,r)=>{var i;if(r.on||delete t.events,r.clear||delete t.clear,r.on||r.clear){const e='event.item && indexof(event.item.mark.role, "legend") < 0';for(const n of t.events)n.filter=Ym(null!==(i=n.filter)&&void 0!==i?i:[]),n.filter.indexOf(e)<0&&n.filter.push(e)}const a=w7(t.bind)?t.bind.legend:"click",o=bg(a)?EK(a,"view"):Ym(a);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const r=t.name,i=w7(t.bind)&&t.bind.legend,a=e=>t=>{const n=v0(t);return n.markname=e,n};for(const o of t.project.items){if(!o.hasLegend)continue;const e=B0(o.field)+"_legend",s=`${r}_${e}`;if(0===n.filter(e=>e.name===s).length){const r=i.merge.map(a(e+"_symbols")).concat(i.merge.map(a(e+"_labels"))).concat(i.merge.map(a(e+"_entries")));n.unshift(Object.assign(Object.assign({name:s},t.init?{}:{value:null}),{on:[{events:r,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:"!event.item || !datum ? null : "+s,force:!0}]}))}}return n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.find(e=>e.name===r+ote),o=r+Oee,s=i.items.filter(e=>e.hasLegend).map(e=>B0(`${r}_${B0(e.field)}_legend`)),l=`${s.map(e=>e+" !== null").join(" && ")} ? {fields: ${o}, values: [${s.join(", ")}]} : null`;t.events&&s.length>0?a.on.push({events:s.map(e=>({signal:e})),update:l}):s.length>0&&(a.update=l,delete a.value,delete a.on);const u=n.find(e=>e.name===r+Nee),c=w7(t.bind)&&t.bind.legend;return u&&(t.events?u.on.push(Object.assign(Object.assign({},u.on[0]),{events:c})):u.on[0].events=c),n}},$ee="_translate_anchor",zee="_translate_delta",Uee={has:e=>"interval"===e.type&&e.translate,signals:(e,t,n)=>{const r=t.name,i=Ree.has(t),a=r+$ee,{x:o,y:s}=t.project.hasChannel;let l=EK(t.translate,"scope");return i||(l=l.map(e=>(e.between[0].markname=r+Jee,e))),n.push({name:a,value:{},on:[{events:l.map(e=>e.between[0]),update:"{x: x(unit), y: y(unit)"+(void 0!==o?", extent_x: "+(i?Pee(e,S1):`slice(${o.signals.visual})`):"")+(void 0!==s?", extent_y: "+(i?Pee(e,T1):`slice(${s.signals.visual})`):"")+"}"}]},{name:r+zee,value:{},on:[{events:l,update:`{x: ${a}.x - x(unit), y: ${a}.y - y(unit)}`}]}),void 0!==o&&Hee(e,t,o,"width",n),void 0!==s&&Hee(e,t,s,"height",n),n}};function Hee(e,t,n,r,i){var a;const o=t.name,s=o+$ee,l=o+zee,u=n.channel,c=Ree.has(t),d=i.filter(e=>e.name===n.signals[c?"data":"visual"])[0],h=e.getSizeSignalRef(r).signal,f=e.getScaleComponent(u),p=f.get("type"),m=`${s}.extent_${u}`,g=`${c?"log"===p?"panLog":"pow"===p?"panPow":"panLinear":"panLinear"}(${m}, ${`${c&&u===S1?"-":""}${l}.${u} / `+(c?""+h:`span(${m})`)}`+(c&&"pow"===p?", "+(null!==(a=f.get("exponent"))&&void 0!==a?a:1):"")+")";d.on.push({events:{signal:l},update:c?g:`clampRange(${g}, 0, ${h})`})}const Wee="_zoom_delta",Vee={has:e=>"interval"===e.type&&e.zoom,signals:(e,t,n)=>{const r=t.name,i=Ree.has(t),a=r+Wee,{x:o,y:s}=t.project.hasChannel,l=Cg(e.scaleName(S1)),u=Cg(e.scaleName(T1));let c=EK(t.zoom,"scope");return i||(c=c.map(e=>(e.markname=r+Jee,e))),n.push({name:r+"_zoom_anchor",on:[{events:c,update:i?"{"+[l?`x: invert(${l}, x(unit))`:"",u?`y: invert(${u}, y(unit))`:""].filter(e=>!!e).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==o&&qee(e,t,o,"width",n),void 0!==s&&qee(e,t,s,"height",n),n}};function qee(e,t,n,r,i){var a;const o=t.name,s=n.channel,l=Ree.has(t),u=i.filter(e=>e.name===n.signals[l?"data":"visual"])[0],c=e.getSizeSignalRef(r).signal,d=e.getScaleComponent(s),h=d.get("type"),f=l?Pee(e,s):u.name,p=o+Wee,m=`${l?"log"===h?"zoomLog":"pow"===h?"zoomPow":"zoomLinear":"zoomLinear"}(${f}, ${o}_zoom_anchor.${s}, ${p}`+(l&&"pow"===h?", "+(null!==(a=d.get("exponent"))&&void 0!==a?a:1):"")+")";u.on.push({events:{signal:p},update:l?m:`clampRange(${m}, 0, ${c})`})}const Gee=[{has:()=>!0,parse:(e,t,n)=>{var r,i,a;const o=t.name,s=null!==(r=t.project)&&void 0!==r?r:t.project=new Dee,l={},u={},c=new Set,d=(e,t)=>{const n="visual"===t?e.channel:e.field;let r=B0(`${o}_${n}`);for(let i=1;c.has(r);i++)r=B0(`${o}_${n}_${i}`);return c.add(r),{[t]:r}};if(!n.fields&&!n.encodings){const t=e.config.selection[n.type];if(n.init)for(const e of Ym(n.init))for(const r of F0(e))f2[r]?(n.encodings||(n.encodings=[])).push(r):"interval"===n.type?(p3(y.INTERVAL_INITIALIZED_WITH_X_Y),n.encodings=t.encodings):(n.fields||(n.fields=[])).push(r);else n.encodings=t.encodings,n.fields=t.fields}for(const h of null!==(i=n.fields)&&void 0!==i?i:[]){const e={type:"E",field:h};e.signals=Object.assign({},d(e,"data")),s.items.push(e),s.hasField[h]=e}for(const h of null!==(a=n.encodings)&&void 0!==a?a:[]){const n=e.fieldDef(h);if(n){let r=n.field;if(n.aggregate){p3(y.cannotProjectAggregate(h,n.aggregate));continue}if(!r){p3(y.cannotProjectOnChannelWithoutField(h));continue}if(n.timeUnit){r=e.vgField(h);const t={timeUnit:n.timeUnit,as:r,field:n.field};u[w0(t)]=t}if(!l[r]){let i="E";"interval"===t.type?m4(e.getScaleComponent(h).get("type"))&&(i="R"):n.bin&&(i="R-RE");const a={field:r,channel:h,type:i};a.signals=Object.assign(Object.assign({},d(a,"data")),d(a,"visual")),s.items.push(l[r]=a),s.hasField[r]=s.hasChannel[h]=l[r]}}else p3(y.cannotProjectOnChannelWithoutField(h))}if(n.init){const e=e=>s.items.map(t=>void 0!==e[t.channel]?e[t.channel]:e[t.field]);if("interval"===n.type)t.init=e(n.init);else{const r=Ym(n.init);t.init=r.map(e)}}j0(u)||(s.timeUnit=new Aee(null,u))},signals:(e,t,n)=>{const r=t.name+Oee;return n.filter(e=>e.name===r).length>0?n:n.concat({name:r,value:t.project.items.map(e=>{const t=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["signals","hasLegend"]);return t.field=q0(t.field),t})})}},jee,Ree,Bee,Uee,Vee,Mee,See,Fee];function Yee(e,t){for(const n of Gee)n.has(e)&&t(n)}function Xee(e,t=!0,n=dm){if(km(e)){const r=e.map(e=>Xee(e,t,n));return t?`[${r.join(", ")}]`:r}return m3(e)?n(t?w3(e):function(e){const t=x3(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}(e)):t?n(JSON.stringify(e)):e}function Kee(e,t){return ute(e,(n,r)=>{t=r.marks?r.marks(e,n,t):t,Yee(n,r=>{r.marks&&(t=r.marks(e,n,t))})}),t}function Zee(e){return e.map(e=>(e.on&&!e.on.length&&delete e.on,e))}const Jee="_brush",Qee="_scale_trigger",ete={signals:(e,t)=>{const n=t.name,r=n+Oee,i=Ree.has(t),a=[],o=[],s=[];if(t.translate&&!i){const e="!event.item || event.item.mark.name !== "+Cg(n+Jee);tte(t,(t,n)=>{var r;const i=Ym(null!==(r=n.between[0].filter)&&void 0!==r?r:n.between[0].filter=[]);return i.indexOf(e)<0&&i.push(e),t})}t.project.items.forEach((n,r)=>{const i=n.channel;if(i!==S1&&i!==T1)return void p3("Interval selections only support x and y encoding channels.");const l=function(e,t,n,r){const i=n.channel,a=n.signals.visual,o=n.signals.data,s=Ree.has(t),l=Cg(e.scaleName(i)),u=e.getScaleComponent(i),c=u?u.get("type"):void 0,d=e=>`scale(${l}, ${e})`,h=e.getSizeSignalRef(i===S1?"width":"height").signal,f=i+"(unit)",p=tte(t,(e,t)=>[...e,{events:t.between[0],update:`[${f}, ${f}]`},{events:t,update:`[${a}[0], clamp(${f}, 0, ${h})]`}]);return p.push({events:{signal:t.name+Qee},update:m4(c)?`[${d(o+"[0]")}, ${d(o+"[1]")}]`:"[0, 0]"}),s?[{name:o,on:[]}]:[Object.assign(Object.assign({name:a},r?{init:Xee(r,!0,d)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},r?{init:Xee(r)}:{}),{on:[{events:{signal:a},update:`${a}[0] === ${a}[1] ? null : invert(${l}, ${a})`}]})]}(e,t,n,t.init?t.init[r]:null),u=n.signals.data,c=n.signals.visual,d=Cg(e.scaleName(i)),h=m4(e.getScaleComponent(i).get("type"))?"+":"";a.push(...l),o.push(u),s.push({scaleName:e.scaleName(i),expr:`(!isArray(${u}) || (${h}invert(${d}, ${c})[0] === ${h}${u}[0] && ${h}invert(${d}, ${c})[1] === ${h}${u}[1]))`})}),i||a.push({name:n+Qee,value:{},on:[{events:s.map(e=>({scale:e.scaleName})),update:s.map(e=>e.expr).join(" && ")+` ? ${n+Qee} : {}`}]});const l=t.init,u=`unit: ${cte(e)}, fields: ${r}, values`;return a.concat(Object.assign(Object.assign({name:n+ote},l?{init:`{${u}: ${Xee(l)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${u}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>t.name+ote+", "+("global"===t.resolve?"true":`{unit: ${cte(e)}}`),marks:(e,t,n)=>{const r=t.name,{x:i,y:a}=t.project.hasChannel,o=i&&i.signals.visual,s=a&&a.signals.visual,l=`data(${Cg(t.name+ate)})`;if(Ree.has(t))return n;const u={x:void 0!==i?{signal:o+"[0]"}:{value:0},y:void 0!==a?{signal:s+"[0]"}:{value:0},x2:void 0!==i?{signal:o+"[1]"}:{field:{group:"width"}},y2:void 0!==a?{signal:s+"[1]"}:{field:{group:"height"}}};if("global"===t.resolve)for(const g of F0(u))u[g]=[Object.assign({test:`${l}.length && ${l}[0].unit === ${cte(e)}`},u[g]),{value:0}];const c=t.mark,{fill:d,fillOpacity:h,cursor:f}=c,p=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(c,["fill","fillOpacity","cursor"]),m=F0(p).reduce((e,t)=>(e[t]=[{test:[void 0!==i&&`${o}[0] !== ${o}[1]`,void 0!==a&&`${s}[0] !== ${s}[1]`].filter(e=>e).join(" && "),value:p[t]},{value:null}],e),{});return[{name:r+Jee+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:d},fillOpacity:{value:h}},update:u}},...n,{name:r+Jee,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},f?{cursor:{value:f}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},u),m)}}]}};function tte(e,t){return e.events.reduce((e,n)=>n.between?t(e,n):(p3(n+" is not an ordered event stream for interval selections."),e),[])}function nte(e,t){const n=t.name,r=n+Oee,i="(item().isVoronoi ? datum.datum : datum)",a=t.project.items.map(t=>{const n=e.fieldDef(t.channel);return n&&n.bin?`[${i}[${Cg(e.vgField(t.channel,{}))}], ${i}[${Cg(e.vgField(t.channel,{binSuffix:"end"}))}]]`:`${i}[${Cg(t.field)}]`}).join(", "),o=`unit: ${cte(e)}, fields: ${r}, values`,s=t.events;return[{name:n+ote,on:s?[{events:s,update:`datum && item().mark.marktype !== 'group' ? {${o}: [${a}]} : null`,force:!0}]:[]}]}const rte={signals:nte,modifyExpr:(e,t)=>t.name+ote+", "+("global"===t.resolve?"null":`{unit: ${cte(e)}}`)},ite={signals:nte,modifyExpr:(e,t)=>t.name+ote+", "+("global"===t.resolve?"true":`{unit: ${cte(e)}}`)},ate="_store",ote="_tuple",ste="vlSelectionResolve",lte={single:ite,multi:rte,interval:ete};function ute(e,t){const n=e.component.selection;if(n)for(const r of R0(n))if(!0===t(r,lte[r.type]))break}function cte(e,{escape:t}={escape:!0}){let n=t?Cg(e.name):e.name;const r=function(e){let t=e.parent;for(;t&&!Aie(t);)t=t.parent;return t}(e);if(r){const{facet:e}=r;for(const t of u2)e[t]&&(n+=` + '__facet_${t}_' + (facet[${Cg(r.vgField(t))}])`)}return n}function dte(e){let t=!1;return ute(e,e=>{t=t||e.project.items.some(e=>e.field===y7)}),t}function hte(e){this.type=e}var fte,pte,mte,gte,vte;hte.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case"CallExpression":return[e.callee].concat(e.arguments);case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1},(fte={})[1]="Boolean",fte[2]="<end>",fte[3]="Identifier",fte[4]="Keyword",fte[5]="Null",fte[6]="Numeric",fte[7]="Punctuator",fte[8]="String",fte[9]="RegularExpression";var yte="Identifier",bte="Unexpected token %0",xte="Invalid regular expression",wte="Invalid regular expression: missing /",_te="Octal literals are not allowed in strict mode.",kte="ILLEGAL",Ete="Disabled.",Ste=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),Tte=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function Cte(e,t){if(!e)throw new Error("ASSERT: "+t)}function Ite(e){return e>=48&&e<=57}function Ate(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Ote(e){return"01234567".indexOf(e)>=0}function Dte(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Mte(e){return 10===e||13===e||8232===e||8233===e}function Nte(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&Ste.test(String.fromCharCode(e))}function jte(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&Tte.test(String.fromCharCode(e))}const Fte={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Rte(){for(;mte<gte;){const e=pte.charCodeAt(mte);if(!Dte(e)&&!Mte(e))break;++mte}}function Pte(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)mte<gte&&Ate(pte[mte])?(r=pte[mte++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):Zte({},bte,kte);return String.fromCharCode(i)}function Lte(){var e,t;for(t=0,"}"===(e=pte[mte])&&Zte({},bte,kte);mte<gte&&Ate(e=pte[mte++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&Zte({},bte,kte),t<=65535?String.fromCharCode(t):String.fromCharCode(55296+(t-65536>>10),56320+(t-65536&1023))}function Bte(){var e,t;for(e=pte.charCodeAt(mte++),t=String.fromCharCode(e),92===e&&(117!==pte.charCodeAt(mte)&&Zte({},bte,kte),++mte,(e=Pte("u"))&&"\\"!==e&&Nte(e.charCodeAt(0))||Zte({},bte,kte),t=e);mte<gte&&jte(e=pte.charCodeAt(mte));)++mte,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==pte.charCodeAt(mte)&&Zte({},bte,kte),++mte,(e=Pte("u"))&&"\\"!==e&&jte(e.charCodeAt(0))||Zte({},bte,kte),t+=e);return t}function $te(){var e,t,n,r,i=mte,a=pte.charCodeAt(mte),o=pte[mte];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++mte,{type:7,value:String.fromCharCode(a),start:i,end:mte};default:if(61===(e=pte.charCodeAt(mte+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return mte+=2,{type:7,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:mte};case 33:case 61:return 61===pte.charCodeAt(mte+=2)&&++mte,{type:7,value:pte.slice(i,mte),start:i,end:mte}}}return">>>="===(r=pte.substr(mte,4))?{type:7,value:r,start:i,end:mte+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:mte+=3}:o===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===t?{type:7,value:t,start:i,end:mte+=2}:("//"===t&&Zte({},bte,kte),"<>=!+-*%&|^/".indexOf(o)>=0?{type:7,value:o,start:i,end:++mte}:void Zte({},bte,kte))}function zte(){var e,t,n;if(Cte(Ite((n=pte[mte]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=mte,e="","."!==n){if(e=pte[mte++],n=pte[mte],"0"===e){if("x"===n||"X"===n)return++mte,function(e){let t="";for(;mte<gte&&Ate(pte[mte]);)t+=pte[mte++];return 0===t.length&&Zte({},bte,kte),Nte(pte.charCodeAt(mte))&&Zte({},bte,kte),{type:6,value:parseInt("0x"+t,16),start:e,end:mte}}(t);if(Ote(n))return function(e){let t="0"+pte[mte++];for(;mte<gte&&Ote(pte[mte]);)t+=pte[mte++];return(Nte(pte.charCodeAt(mte))||Ite(pte.charCodeAt(mte)))&&Zte({},bte,kte),{type:6,value:parseInt(t,8),octal:!0,start:e,end:mte}}(t);n&&Ite(n.charCodeAt(0))&&Zte({},bte,kte)}for(;Ite(pte.charCodeAt(mte));)e+=pte[mte++];n=pte[mte]}if("."===n){for(e+=pte[mte++];Ite(pte.charCodeAt(mte));)e+=pte[mte++];n=pte[mte]}if("e"===n||"E"===n)if(e+=pte[mte++],"+"!==(n=pte[mte])&&"-"!==n||(e+=pte[mte++]),Ite(pte.charCodeAt(mte)))for(;Ite(pte.charCodeAt(mte));)e+=pte[mte++];else Zte({},bte,kte);return Nte(pte.charCodeAt(mte))&&Zte({},bte,kte),{type:6,value:parseFloat(e),start:t,end:mte}}function Ute(){if(Rte(),mte>=gte)return{type:2,start:mte,end:mte};const e=pte.charCodeAt(mte);return Nte(e)?(t=mte,{type:1===(n=92===pte.charCodeAt(mte)?Bte():function(){var e,t;for(e=mte++;mte<gte;){if(92===(t=pte.charCodeAt(mte)))return mte=e,Bte();if(!jte(t))break;++mte}return pte.slice(e,mte)}()).length?3:Fte.hasOwnProperty(n)?4:"null"===n?5:"true"===n||"false"===n?1:3,value:n,start:t,end:mte}):40===e||41===e||59===e?$te():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for(Cte("'"===(e=pte[mte])||'"'===e,"String literal must starts with a quote"),t=mte,++mte;mte<gte;){if((n=pte[mte++])===e){e="";break}if("\\"===n)if((n=pte[mte++])&&Mte(n.charCodeAt(0)))"\r"===n&&"\n"===pte[mte]&&++mte;else switch(n){case"u":case"x":"{"===pte[mte]?(++mte,i+=Lte()):i+=Pte(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:Ote(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),mte<gte&&Ote(pte[mte])&&(a=!0,r=8*r+"01234567".indexOf(pte[mte++]),"0123".indexOf(n)>=0&&mte<gte&&Ote(pte[mte])&&(r=8*r+"01234567".indexOf(pte[mte++]))),i+=String.fromCharCode(r)):i+=n}else{if(Mte(n.charCodeAt(0)))break;i+=n}}return""!==e&&Zte({},bte,kte),{type:8,value:i,octal:a,start:t,end:mte}}():46===e?Ite(pte.charCodeAt(mte+1))?zte():$te():Ite(e)?zte():$te();var t,n}function Hte(){const e=vte;return mte=e.end,vte=Ute(),mte=e.end,e}function Wte(){const e=mte;vte=Ute(),mte=e}function Vte(e,t,n){const r=new hte("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return r.operator=e,r.left=t,r.right=n,r}function qte(e,t){const n=new hte("CallExpression");return n.callee=e,n.arguments=t,n}function Gte(e){const t=new hte(yte);return t.name=e,t}function Yte(e){const t=new hte("Literal");return t.value=e.value,t.raw=pte.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function Xte(e,t,n){const r=new hte("MemberExpression");return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function Kte(e,t,n){const r=new hte("Property");return r.key=t,r.value=n,r.kind=e,r}function Zte(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(e,t)=>(Cte(t<r.length,"Message reference must be in range"),r[t]));throw(n=new Error(i)).index=mte,n.description=i,n}function Jte(e){2===e.type&&Zte(e,"Unexpected end of input"),6===e.type&&Zte(e,"Unexpected number"),8===e.type&&Zte(e,"Unexpected string"),3===e.type&&Zte(e,"Unexpected identifier"),4===e.type&&Zte(e,"Unexpected reserved word"),Zte(e,bte,e.value)}function Qte(e){const t=Hte();7===t.type&&t.value===e||Jte(t)}function ene(e){return 7===vte.type&&vte.value===e}function tne(e){return 4===vte.type&&vte.value===e}function nne(){mte=vte.start;const e=Hte();return 8===e.type||6===e.type?(e.octal&&Zte(e,_te),Yte(e)):Gte(e.value)}function rne(){var e,t,n;return mte=vte.start,3===(e=vte).type?(n=nne(),Qte(":"),Kte("init",n,cne())):2!==e.type&&7!==e.type?(t=nne(),Qte(":"),Kte("init",t,cne())):void Jte(e)}const ine={if:1};function ane(){const e=[];if(Qte("("),!ene(")"))for(;mte<gte&&(e.push(cne()),!ene(")"));)Qte(",");return Qte(")"),e}function one(){Qte("[");const e=dne();return Qte("]"),e}function sne(){const e=function(){var e;for(e=function(){var e,t,n,r,i,a,o;if(ene("("))return function(){Qte("(");const e=dne();return Qte(")"),e}();if(ene("["))return function(){const e=[];for(mte=vte.start,Qte("[");!ene("]");)ene(",")?(Hte(),e.push(null)):(e.push(cne()),ene("]")||Qte(","));return Hte(),function(e){const t=new hte("ArrayExpression");return t.elements=e,t}(e)}();if(ene("{"))return function(){var e,t,n=[],r={},i=String;for(mte=vte.start,Qte("{");!ene("}");)t="$"+((e=rne()).key.type===yte?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?Zte({},"Duplicate data property in object literal not allowed in strict mode"):r[t]=!0,n.push(e),ene("}")||Qte(",");return Qte("}"),function(e){const t=new hte("ObjectExpression");return t.properties=e,t}(n)}();if(mte=vte.start,3===(e=vte.type)||ine[vte.value])n=Gte(Hte().value);else if(8===e||6===e)vte.octal&&Zte(vte,_te),n=Yte(Hte());else{if(4===e)throw new Error(Ete);1===e?((t=Hte()).value="true"===t.value,n=Yte(t)):5===e?((t=Hte()).value=null,n=Yte(t)):ene("/")||ene("/=")?(n=Yte((vte=null,Rte(),r=mte,i=function(){var e,t,n,r;for(Cte("/"===(e=pte[mte]),"Regular expression literal must start with a slash"),t=pte[mte++],n=!1,r=!1;mte<gte;)if(t+=e=pte[mte++],"\\"===e)Mte((e=pte[mte++]).charCodeAt(0))&&Zte({},wte),t+=e;else if(Mte(e.charCodeAt(0)))Zte({},wte);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||Zte({},wte),{value:t.substr(1,t.length-2),literal:t}}(),a=function(){var e,t,n;for(t="",n="";mte<gte&&jte((e=pte[mte]).charCodeAt(0));)++mte,"\\"===e&&mte<gte?Zte({},bte,kte):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&Zte({},xte,n),{value:n,literal:t}}(),o=function(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(e,t)=>{if(parseInt(t,16)<=1114111)return"x";Zte({},xte)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(r){Zte({},xte)}try{return new RegExp(e,t)}catch(i){return null}}(i.value,a.value),{literal:i.literal+a.literal,value:o,regex:{pattern:i.value,flags:a.value},start:r,end:mte})),Wte()):Jte(Hte())}return n}();;)if(ene("."))e=Xte(".",e,(Qte("."),function(){mte=vte.start;const e=Hte();return function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e)||Jte(e),Gte(e.value)}()));else if(ene("("))e=qte(e,ane());else{if(!ene("["))break;e=Xte("[",e,one())}return e}();if(7===vte.type&&(ene("++")||ene("--")))throw new Error(Ete);return e}function lne(){var e,t;if(7!==vte.type&&4!==vte.type)t=sne();else{if(ene("++")||ene("--"))throw new Error(Ete);if(ene("+")||ene("-")||ene("~")||ene("!"))e=Hte(),t=lne(),t=function(e,t){const n=new hte("UnaryExpression");return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(tne("delete")||tne("void")||tne("typeof"))throw new Error(Ete);t=sne()}}return t}function une(e){let t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function cne(){var e,t;return e=function(){var e,t,n,r,i,a,o,s,l,u;if(e=vte,l=lne(),0===(i=une(r=vte)))return l;for(r.prec=i,Hte(),t=[e,vte],a=[l,r,o=lne()];(i=une(vte))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,l=a.pop(),t.pop(),n=Vte(s,l,o),a.push(n);(r=Hte()).prec=i,a.push(r),t.push(vte),n=lne(),a.push(n)}for(n=a[u=a.length-1],t.pop();u>1;)t.pop(),n=Vte(a[u-1].value,a[u-2],n),u-=2;return n}(),ene("?")&&(Hte(),t=cne(),Qte(":"),e=function(e,t,n){const r=new hte("ConditionalExpression");return r.test=e,r.consequent=t,r.alternate=n,r}(e,t,cne())),e}function dne(){const e=cne();if(ene(","))throw new Error(Ete);return e}function hne(e){const t=function(e){mte=0,gte=(pte=e).length,vte=null,Wte();const t=dne();if(2!==vte.type)throw new Error("Unexpect token after expression.");return t}(e),n=new Set;return t.visit(e=>{"MemberExpression"===e.type&&function e(t){return"MemberExpression"===t.object.type?e(t.object):"datum"===t.object.name}(e)&&n.add(function e(t){const n=[];return"Identifier"===t.type?[t.name]:"Literal"===t.type?[t.value]:("MemberExpression"===t.type&&(n.push(...e(t.object)),n.push(...e(t.property))),n)}(e).slice(1).join("."))}),n}class fne extends Tee{constructor(e,t,n){super(e),this.model=t,this.filter=n,this.expr=vne(this.model,this.filter,this),this._dependentFields=hne(this.expr)}clone(){return new fne(null,this.model,v0(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return"Filter "+this.expr}}var pne=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function mne(e,t,n,r="datum"){const i=[],a=$0(t,(function(t){const a=B0(t),o=e.getSelectionComponent(a,t),s=Cg(a+ate);if(o.project.timeUnit){const t=null!=n?n:e.component.data.raw,r=o.project.timeUnit.clone();t.parent?r.insertAsParentOf(t):t.parent=r}return"none"!==o.empty&&i.push(s),`vlSelectionTest(${s}, ${r}`+("global"===o.resolve?")":`, ${Cg(o.resolve)})`)}));return(i.length?"!("+i.map(e=>`length(data(${e}))`).join(" || ")+") || ":"")+`(${a})`}function gne(e,t){const n=t.encoding;let r=t.field;if(n||r){if(n&&!r){const i=e.project.items.filter(e=>e.channel===n);!i.length||i.length>1?(r=e.project.items[0].field,p3((i.length?"Multiple ":"No ")+`matching ${Cg(n)} encoding found for selection ${Cg(t.selection)}. `+`Using "field": ${Cg(r)}.`)):r=i[0].field}}else r=e.project.items[0].field,e.project.items.length>1&&p3(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${Cg(r)}.`);return`${e.name}[${Cg(r)}]`}function vne(e,t,n){return $0(t,t=>bg(t)?t:function(e){return null==e?void 0:e.selection}(t)?mne(e,t.selection,n):V3(t))}var yne=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function bne(e,t,n,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update[n]=r}function xne(e,t,n,r={header:!1}){var i,a;const o=e.combine(),{disable:s,orient:l,scale:u,labelExpr:c,title:d,zindex:h}=o,f=yne(o,["disable","orient","scale","labelExpr","title","zindex"]);if(!s){for(const e in f){const n=s1[e],r=f[e];if(n&&n!==t&&"both"!==n)delete f[e];else if(a1(r)){const{condition:t}=r,n=yne(r,["condition"]),i=Ym(t),a=i1[e];if(a){const{vgProp:t,part:r}=a;bne(f,r,t,[...i.map(e=>{const{test:t}=e,n=yne(e,["test"]);return Object.assign({test:vne(null,t)},n)}),n]),delete f[e]}else if(null===a){const t={signal:i.map(e=>{const{test:t}=e,n=yne(e,["test"]);return`${vne(null,t)} ? ${y8(n)} : `}).join("")+y8(n)};f[e]=t}}else if(O3(r)){const t=i1[e];if(t){const{vgProp:n,part:i}=t;bne(f,i,n,r),delete f[e]}}}if("grid"===t){if(!f.grid)return;if(f.encode){const{grid:e}=f.encode;f.encode=Object.assign({},e?{grid:e}:{}),j0(f.encode)&&delete f.encode}return Object.assign(Object.assign({scale:u,orient:l},f),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:K0(h,0)})}{if(!r.header&&e.mainExtracted)return;if(void 0!==c){let e=c;(null===(a=null===(i=f.encode)||void 0===i?void 0:i.labels)||void 0===a?void 0:a.update)&&O3(f.encode.labels.update.text)&&(e=G0(c,"datum.label",f.encode.labels.update.text.signal)),bne(f,"labels","text",{signal:e})}if(null===f.labelAlign&&delete f.labelAlign,f.encode){for(const t of o1)e.hasAxisPart(t)||delete f.encode[t];j0(f.encode)&&delete f.encode}const t=function(e,t){if(e)return km(e)&&!h8(e)?e.map(e=>J6(e,t)).join(", "):e}(d,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:u,orient:l,grid:!1},t?{title:t}:{}),f),!1===n.aria?{aria:!1}:{}),{zindex:K0(h,0)})}}}function wne(e){const{axes:t}=e.component,n=[];for(const r of E2)if(t[r])for(const i of t[r])if(!i.get("disable")&&!i.get("gridScale")){const t="x"===r?"height":"width",i=e.getSizeSignalRef(t).signal;t!==i&&n.push({name:t,update:i})}return n}function _ne(e,t,n,r){return Object.assign.apply(null,[{},...e.map(e=>{if("axisOrient"===e){const e="x"===n?"bottom":"left",i=t["x"===n?"axisBottom":"axisLeft"]||{},a=t["x"===n?"axisTop":"axisRight"]||{},o=new Set([...F0(i),...F0(a)]),s={};for(const t of o.values())s[t]={signal:`${r.signal} === "${e}" ? ${b8(i[t])} : ${b8(a[t])}`};return s}return t[e]})])}function kne(e,t){var n;const r=[{}];for(const i of e){let e=null===(n=t[i])||void 0===n?void 0:n.style;if(e){e=Ym(e);for(const n of e)r.push(t.style[n])}}return Object.assign.apply(null,r)}function Ene(e,t,n,r={}){var i;const a=E8(e,n,t);if(void 0!==a)return{configFrom:"style",configValue:a};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(void 0!==(null===(i=r[o])||void 0===i?void 0:i[e]))return{configFrom:o,configValue:r[o][e]};return{}}const Sne={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:r,formatType:i}=n;return l6(e,e.type,r,i,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return u6(r,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var r;return(!D6(e)||!B2(e.bin))&&(null!==(r=t.grid)&&void 0!==r?r:function(e,t){return!p4(e)&&D6(t)&&!L2(null==t?void 0:t.bin)}(n,e))},gridScale:({model:e,channel:t})=>function(e,t){const n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelAlign||Ine(t,n,r),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelBaseline||Cne(t,n,r),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var r;return null!==(r=e.labelFlush)&&void 0!==r?r:function(e,t){if("x"===t&&k0(["quantitative","temporal"],e))return!0}(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var r;return null!==(r=e.labelOverlap)&&void 0!==r?r:function(e,t,n,r){if(n&&!Em(r)||"nominal"!==e&&"ordinal"!==e)return"log"!==t&&"symlog"!==t||"greedy"}(t.type,n,D6(t)&&!!t.timeUnit,D6(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:r,scaleType:i})=>{var a;const o="x"===e?"width":"y"===e?"height":void 0,s=o?t.getSizeSignalRef(o):void 0;return null!==(a=n.tickCount)&&void 0!==a?a:function({fieldOrDatumDef:e,scaleType:t,size:n,values:r}){var i;if(!r&&!p4(t)&&"log"!==t){if(D6(e)){if(L2(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&k0(["month","hours","day","quarter"],null===(i=A3(e.timeUnit))||void 0===i?void 0:i.unit))return}return{signal:`ceil(${n.signal}/40)`}}}({fieldOrDatumDef:r,scaleType:i,size:s,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(void 0!==e.title)return e.title;const r=Ane(t,n);if(void 0!==r)return r;const i=t.typedFieldDef(n),a=t.fieldDef("x"===n?"x2":"y2");return T8(i?[E6(i)]:[],D6(a)?[E6(a)]:[])},values:({axis:e,fieldOrDatumDef:t})=>function(e,t){const n=e.values;return km(n)?u8(t,n):O3(n)?n:void 0}(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var r;return null!==(r=e.zindex)&&void 0!==r?r:function(e,t){return"rect"===e&&V6(t)?1:0}(n,t)}};function Tne(e){return`(((${e.signal} % 360) + 360) % 360)`}function Cne(e,t,n,r){if(void 0!==e){if("x"===n){if(O3(e)){const n=Tne(e);return{signal:`(45 < ${n} && ${n} < 135) || (225 < ${n} && ${n} < 315) ? "middle" :(${n} <= 45 || 315 <= ${n}) === ${O3(t)?`(${t.signal} === "top")`:"top"===t} ? "bottom" : "top"`}}return 45<e&&e<135||225<e&&e<315?"middle":O3(t)?{signal:`${t.signal} ${e<=45||315<=e?"===":"!=="} "top" ? "bottom" : "top"`}:(e<=45||315<=e)==("top"===t)?"bottom":"top"}if(O3(e)){const n=Tne(e);return{signal:`${n} <= 45 || 315 <= ${n} || (135 <= ${n} && ${n} <= 225) ? ${r?'"middle"':"null"} : (45 <= ${n} && ${n} <= 135) === ${O3(t)?`(${t.signal} === "left")`:"left"===t} ? "top" : "bottom"`}}return e<=45||315<=e||135<=e&&e<=225?r?"middle":null:O3(t)?{signal:`${t.signal} ${45<=e&&e<=135?"===":"!=="} "left" ? "top" : "bottom"`}:(45<=e&&e<=135)==("left"===t)?"top":"bottom"}}function Ine(e,t,n){if(void 0===e)return;const r="x"===n,i=r?0:90,a=r?"bottom":"left";if(O3(e)){const n=Tne(e);return{signal:`(${i?"("+n+" + 90)":n} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${n} && ${n} < ${180+i}) === ${O3(t)?`(${t.signal} === "${a}")`:t===a} ? "left" : "right"`}}return(e+i)%180==0?r?null:"center":O3(t)?{signal:`${t.signal} ${i<e&&e<180+i?"===":"!=="} "${a}" ? "left" : "right"`}:(i<e&&e<180+i)==(t===a)?"left":"right"}function Ane(e,t){const n="x"===t?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),a=r?r.title:void 0,o=i?i.title:void 0;return a&&o?C8(a,o):a||o||(void 0!==a?a:void 0!==o?o:void 0)}class One extends Tee{constructor(e,t){super(e),this.transform=t,this._dependentFields=hne(this.transform.calculate)}clone(){return new One(null,v0(this.transform))}static parseAllForSortIndex(e,t){return t.forEachFieldDef((t,n)=>{if(B6(t)&&b6(t.sort)){const{field:r,timeUnit:i}=t,a=t.sort,o=a.map((e,t)=>`${V3({field:r,timeUnit:i,equal:e})} ? ${t} : `).join("")+a.length;e=new One(e,{calculate:o,as:Dne(t,n,{forAs:!0})})}}),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return"Calculate "+w0(this.transform)}}function Dne(e,t,n){return W6(e,Object.assign({prefix:t,suffix:"sort_index"},null!=n?n:{}))}function Mne(e,t){return k0(["top","bottom"],t)?"column":k0(["left","right"],t)||"row"===e?"row":"column"}function Nne(e,t,n,r){return K0((t||{})[e],("row"===r?n.headerRow:"column"===r?n.headerColumn:n.headerFacet)[e],n.header[e])}function jne(e,t,n,r){const i={};for(const a of e){const e=Nne(a,t||{},n,r);void 0!==e&&(i[a]=e)}return i}const Fne=["row","column"],Rne=["header","footer"];function Pne(e,t){const n=e.component.layoutHeaders[t].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:a,titleAngle:o,titleOrient:s}=jne(["titleAnchor","titleAngle","titleOrient"],i.header,r,t),l=Mne(t,s),u=n1(o);return{name:t+"-title",type:"group",role:l+"-title",title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},"row"===t?{orient:"left"}:{}),{style:"guide-title"}),Bne(u,l)),Lne(l,u,a)),qne(r,i,t,d7,u7))}}function Lne(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=Ine(t,"row"===e?"left":"top","row"===e?"y":"x");return r?{align:r}:{}}function Bne(e,t){const n=Cne(e,"row"===t?"left":"top","row"===t?"y":"x",!0);return n?{baseline:n}:{}}function $ne(e,t){const n=e.component.layoutHeaders[t],r=[];for(const i of Rne)if(n[i])for(const a of n[i]){const o=Hne(e,t,i,n,a);null!=o&&r.push(o)}return r}function zne(e,t){var n;const{sort:r}=e;return y6(r)?{field:W6(r,{expr:"datum"}),order:null!==(n=r.order)&&void 0!==n?n:"ascending"}:km(r)?{field:Dne(e,t,{expr:"datum"}),order:"ascending"}:{field:W6(e,{expr:"datum"}),order:null!=r?r:"ascending"}}function Une(e,t,n){const{format:r,formatType:i,labelAngle:a,labelAnchor:o,labelOrient:s,labelExpr:l}=jne(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),u=a6({fieldOrDatumDef:e,format:r,formatType:i,expr:"parent",config:n}).signal,c=Mne(t,s);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:l?G0(G0(l,"datum.label",u),"datum.value",W6(e,{expr:"parent"})):u}},"row"===t?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),Bne(a,c)),Lne(c,a,o)),qne(n,e,t,h7,c7))}function Hne(e,t,n,r,i){if(i){let a=null;const{facetFieldDef:o}=r,s=e.config?e.config:void 0;if(o&&i.labels){const{labelOrient:e}=jne(["labelOrient"],o.header,s,t);("row"===t&&!k0(["top","bottom"],e)||"column"===t&&!k0(["left","right"],e))&&(a=Une(o,t,s))}const l=Aie(e)&&!x6(e.facet),u=i.axes,c=(null==u?void 0:u.length)>0;if(a||c){const s="row"===t?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:zne(o,t)}:{}),c&&l?{from:{data:e.getName("facet_domain_"+t)}}:{}),a?{title:a}:{}),i.sizeSignal?{encode:{update:{[s]:i.sizeSignal}}}:{}),c?{axes:u}:{})}}return null}const Wne={column:{start:0,end:1},row:{start:1,end:0}};function Vne(e,t){return Wne[t][e]}function qne(e,t,n,r,i){const a={};for(const o of r){if(!i[o])continue;const r=Nne(o,null==t?void 0:t.header,e,n);void 0!==r&&(a[i[o]]=r)}return a}function Gne(e){return[...Yne(e,"width"),...Yne(e,"height"),...Yne(e,"childWidth"),...Yne(e,"childHeight")]}function Yne(e,t){const n="width"===t?"x":"y",r=e.component.layoutSize.get(t);if(!r||"merged"===r)return[];const i=e.getSizeSignalRef(t).signal;if("step"===r){const t=e.getScaleComponent(n);if(t){const r=t.get("type"),a=t.get("range");if(p4(r)&&D3(a)){const r=e.scaleName(n);return Aie(e.parent)&&"independent"===e.parent.component.resolve.scale[n]?[Xne(r,a)]:[Xne(r,a),{name:i,update:Kne(r,t,`domain('${r}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==r){const t=i.endsWith("width"),n=t?"containerSize()[0]":"containerSize()[1]",r=`isFinite(${n}) ? ${n} : ${I7(e.config.view,t?"width":"height")}`;return[{name:i,init:r,on:[{update:r,events:"window:resize"}]}]}return[{name:i,value:r}]}function Xne(e,t){return{name:e+"_step",value:t.step}}function Kne(e,t,n){const r=t.get("type"),i=t.get("padding"),a=K0(t.get("paddingOuter"),i);let o=t.get("paddingInner");return o="band"===r?void 0!==o?o:i:1,`bandspace(${n}, ${b8(o)}, ${b8(a)}) * ${e}_step`}function Zne(e){return"childWidth"===e?"width":"childHeight"===e?"height":e}function Jne(e,t){return F0(e).reduce((n,r)=>{const i=e[r];return Object.assign(Object.assign({},n),J9(t,i,r,e=>v8(e.value)))},{})}function Qne(e,t){if(Die(t)||Aie(t))return"shared";if(Oie(t))return S2(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function ere(e,t){const n=e.scale[t],r=S2(t)?"axis":"legend";return"independent"===n?("shared"===e[r][t]&&p3(y.independentScaleMeansIndependentGuide(t)),"independent"):e[r][t]||"shared"}const tre=Object.assign(Object.assign({},m7),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),nre=F0(tre);class rre extends b9{}const ire={symbols:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i,legendType:a}){var o,s,l,u,c,d,h,f;if("symbol"!==a)return;const{markDef:p,encoding:m,config:g,mark:v}=n,y=p.filled&&"trail"!==v;let b=Object.assign(Object.assign({},function(e,t,n){for(const r of n){const n=_8(r,t.markDef,t.config);void 0!==n&&(e[r]=v8(n))}return e}({},n,V4)),aee(n,{filled:y}));const x=null!==(o=i.get("symbolOpacity"))&&void 0!==o?o:g.legend.symbolOpacity,w=null!==(s=i.get("symbolFillColor"))&&void 0!==s?s:g.legend.symbolFillColor,_=null!==(l=i.get("symbolStrokeColor"))&&void 0!==l?l:g.legend.symbolStrokeColor,k=void 0===x?null!==(u=are(m.opacity))&&void 0!==u?u:p.opacity:void 0;if(b.fill)if("fill"===r||y&&r===P1)delete b.fill;else if(b.fill.field)w?delete b.fill:(b.fill=v8(null!==(c=g.legend.symbolBaseFillColor)&&void 0!==c?c:"black"),b.fillOpacity=v8(null!=k?k:1));else if(km(b.fill)){const e=null!==(f=null!==(h=ore(null!==(d=m.fill)&&void 0!==d?d:m.color))&&void 0!==h?h:p.fill)&&void 0!==f?f:y&&p.color;e&&(b.fill=v8(e))}if(b.stroke)if("stroke"===r||!y&&r===P1)delete b.stroke;else if(b.stroke.field||_)delete b.stroke;else if(km(b.stroke)){const e=K0(ore(m.stroke||m.color),p.stroke,y?p.color:void 0);e&&(b.stroke={value:e})}if(r!==H1){const e=D6(t)&&lre(0,i,t);e?b.opacity=[Object.assign({test:e},v8(null!=k?k:1)),v8(g.legend.unselectedOpacity)]:k&&(b.opacity=v8(k))}return b=Object.assign(Object.assign({},b),e),j0(b)?void 0:b},gradient:function(e,{model:t,legendType:n,legendCmpt:r}){var i;if("gradient"!==n)return;const{config:a,markDef:o,encoding:s}=t;let l={};const u=void 0===(null!==(i=r.get("gradientOpacity"))&&void 0!==i?i:a.legend.gradientOpacity)?are(s.opacity)||o.opacity:void 0;return u&&(l.opacity=v8(u)),l=Object.assign(Object.assign({},l),e),j0(l)?void 0:l},labels:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i}){const a=n.legend(r)||{},o=n.config,s=D6(t)?lre(0,i,t):void 0,l=s?[{test:s,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:u,formatType:c}=a,d=r6(c)?s6({fieldOrDatumDef:t,field:"datum.value",format:u,formatType:c,config:o}):void 0,h=Object.assign(Object.assign(Object.assign({},l?{opacity:l}:{}),d?{text:d}:{}),e);return j0(h)?void 0:h},entries:function(e,{legendCmpt:t}){const n=t.get("selections");return(null==n?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}};function are(e){return sre(e,(e,t)=>Math.max(e,t.value))}function ore(e){return sre(e,(e,t)=>K0(e,t.value))}function sre(e,t){return function(e){const t=e&&e.condition;return!!t&&(km(t)||L6(t))}(e)?Ym(e.condition).reduce(t,e.value):L6(e)?e.value:void 0}function lre(e,t,n){const r=t.get("selections");if(!(null==r?void 0:r.length))return;const i=Cg(n.field);return r.map(e=>`(!length(data(${Cg(B0(e)+ate)})) || (${e}[${i}] && indexof(${e}[${i}], datum.value) >= 0))`).join(" || ")}const ure={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:r,formatType:i}=t;return l6(e,e.type,r,i,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return u6(r,t,n)},gradientLength:e=>{var t,n;const{legend:r,legendConfig:i}=e;return null!==(n=null!==(t=r.gradientLength)&&void 0!==t?t:i.gradientLength)&&void 0!==n?n:function({legendConfig:e,model:t,direction:n,orient:r,scaleType:i}){const{gradientHorizontalMaxLength:a,gradientHorizontalMinLength:o,gradientVerticalMaxLength:s,gradientVerticalMinLength:l}=e;if(g4(i))return"horizontal"===n?"top"===r||"bottom"===r?dre(t,"width",o,a):o:dre(t,"height",l,s)}(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var r,i;return null!==(i=null!==(r=e.labelOverlap)&&void 0!==r?r:t.labelOverlap)&&void 0!==i?i:function(e){if(k0(["quantile","threshold","log","symlog"],e))return"greedy"}(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:r})=>{var i;return null!==(i=e.symbolType)&&void 0!==i?i:function(e,t,n,r){var i;if("shape"!==t){const e=null!==(i=ore(n))&&void 0!==i?i:r;if(e)return e}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(t.type,n,r.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>K6(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(s2(n)&&g4(t)){if("gradient"===e)return}else if("symbol"===e)return;return e},values:({fieldOrDatumDef:e,legend:t})=>function(e,t){const n=e.values;return km(n)?u8(t,n):O3(n)?n:void 0}(t,e)};function cre({legendConfig:e,legendType:t,orient:n,legend:r}){var i,a;return null!==(a=null!==(i=r.direction)&&void 0!==i?i:e[t?"gradientDirection":"symbolDirection"])&&void 0!==a?a:function(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===t?"horizontal":void 0}}(n,t)}function dre(e,t,n,r){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${r})`}}function hre(e,t,n,r){switch(t){case"disable":return void 0!==n;case"values":return!!(null==n?void 0:n.values);case"title":if("title"===t&&e===(null==r?void 0:r.title))return!0}return e===(n||{})[t]}function fre(e,t){var n,r,i;let a=e.legend(t);const{markDef:o,encoding:s,config:l}=e,u=l.legend,c=new rre({},function(e,t){const n=e.scaleName(t);if("trail"===e.mark){if("color"===t)return{stroke:n};if("size"===t)return{strokeWidth:n}}return"color"===t?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}(e,t));!function(e,t,n){var r;const i=null===(r=e.fieldDef(t))||void 0===r?void 0:r.field;ute(e,e=>{var r,a;const o=null!==(r=e.project.hasField[i])&&void 0!==r?r:e.project.hasChannel[t];if(o&&Bee.has(e)){const t=null!==(a=n.get("selections"))&&void 0!==a?a:[];t.push(e.name),n.set("selections",t,!1),o.hasLegend=!0}})}(e,t,c);const d=void 0!==a?!a:u.disable;if(c.set("disable",d,void 0!==a),d)return c;a=a||{};const h=e.getScaleComponent(t).get("type"),f=t8(s[t]),p=D6(f)?null===(n=A3(f.timeUnit))||void 0===n?void 0:n.unit:void 0,m=a.orient||l.legend.orient||"right",g=function(e){const{legend:t}=e;return K0(t.type,function({channel:e,timeUnit:t,scaleType:n}){if(s2(e)){if(k0(["quarter","month","day"],t))return"symbol";if(g4(n))return"gradient"}return"symbol"}(e))}({legend:a,channel:t,timeUnit:p,scaleType:h}),v={legend:a,channel:t,model:e,markDef:o,encoding:s,fieldOrDatumDef:f,legendConfig:u,config:l,scaleType:h,orient:m,legendType:g,direction:cre({legend:a,legendType:g,orient:m,legendConfig:u})};for(const _ of nre){if("gradient"===g&&_.startsWith("symbol")||"symbol"===g&&_.startsWith("gradient"))continue;const n=_ in ure?ure[_](v):a[_];if(void 0!==n){const r=hre(n,_,a,e.fieldDef(t));(r||void 0===l.legend[_])&&c.set(_,n,r)}}const y=null!==(r=null==a?void 0:a.encoding)&&void 0!==r?r:{},b=c.get("selections"),x={},w={fieldOrDatumDef:f,model:e,channel:t,legendCmpt:c,legendType:g};for(const _ of["labels","legend","title","symbols","gradient","entries"]){const t=Jne(null!==(i=y[_])&&void 0!==i?i:{},e),n=_ in ire?ire[_](t,w):t;void 0===n||j0(n)||(x[_]=Object.assign(Object.assign(Object.assign({},(null==b?void 0:b.length)&&D6(f)?{name:`${B0(f.field)}_legend_${_}`}:{}),(null==b?void 0:b.length)?{interactive:!!b}:{}),{update:n}))}return j0(x)||c.set("encode",x,!!(null==a?void 0:a.encoding)),c}function pre(e,t){var n,r,i,a;if(!e)return t.clone();const o=e.getWithExplicit("orient"),s=t.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value)return;let l=!1;for(const u of nre){const n=E9(e.getWithExplicit(u),t.getWithExplicit(u),u,"legend",(e,t)=>{switch(u){case"symbolType":return"circle"===(n=t).value?n:e;case"title":return I8(e,t);case"type":return l=!0,w9("symbol")}var n;return k9(e,t,u,"legend")});e.setWithExplicit(u,n)}return l&&((null===(r=null===(n=e.implicit)||void 0===n?void 0:n.encode)||void 0===r?void 0:r.gradient)&&z0(e.implicit,["encode","gradient"]),(null===(a=null===(i=e.explicit)||void 0===i?void 0:i.encode)||void 0===a?void 0:a.gradient)&&z0(e.explicit,["encode","gradient"])),e}function mre(e){const t=e.component.legends,n={};for(const r of F0(t)){const i=e.getScaleComponent(r),a=x0(i.get("domains"));if(n[a])for(const e of n[a])pre(e,t[r])||n[a].push(t[r]);else n[a]=[t[r].clone()]}return R0(n).flat().map(t=>function(e,t){var n,r,i;const a=e.combine(),{disable:o,labelExpr:s}=a,l=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(a,["disable","labelExpr","selections"]);if(!o){if(!1===t.aria&&null==l.aria&&(l.aria=!1),null===(n=l.encode)||void 0===n?void 0:n.symbols){const e=l.encode.symbols.update;!e.fill||"transparent"===e.fill.value||e.stroke||l.stroke||(e.stroke={value:"transparent"});for(const t of p7)l[t]&&delete e[t]}if(l.title||delete l.title,void 0!==s){let e=s;(null===(i=null===(r=l.encode)||void 0===r?void 0:r.labels)||void 0===i?void 0:i.update)&&O3(l.encode.labels.update.text)&&(e=G0(s,"datum.label",l.encode.labels.update.text.signal)),function(e,t,n,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update.text=r}(l,"labels",0,{signal:e})}return l}}(t,e.config)).filter(e=>void 0!==e)}function gre(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:r}=n;if(t.data){const i={signal:`[${t.size.map(e=>e.signal).join(", ")}]`},a=t.data.reduce((t,n)=>{const r=O3(n)?n.signal:`data('${e.lookupDataSource(n)}')`;return k0(t,r)||t.push(r),t},[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:r,size:i,fit:{signal:a.length>1?`[${a.join(", ")}]`:a[0]}},n)]}return[Object.assign(Object.assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const vre=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class yre extends b9{constructor(e,t,n,r){super(Object.assign({},t),{name:e}),this.specifiedProjection=t,this.size=n,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function bre(e,t){return`${P2(e)}_${t}`}function xre(e,t,n){var r;const i=bre(null!==(r=a8(n,void 0))&&void 0!==r?r:{},t);return e.getName(i+"_bins")}function wre(e,t,n){let r,i;r=function(e){return"as"in e}(e)?bg(e.as)?[e.as,e.as+"_end"]:[e.as[0],e.as[1]]:[W6(e,{forAs:!0}),W6(e,{binSuffix:"end",forAs:!0})];const a=Object.assign({},a8(t,void 0)),o=bre(a,e.field),{signal:s,extentSignal:l}=function(e,t){return{signal:e.getName(t+"_bins"),extentSignal:e.getName(t+"_extent")}}(n,o);if(z2(a.extent)){const e=a.extent,t=e.selection;i=gne(n.getSelectionComponent(B0(t),t),e),delete a.extent}return{key:o,binComponent:Object.assign(Object.assign(Object.assign({bin:a,field:e.field,as:[r]},s?{signal:s}:{}),l?{extentSignal:l}:{}),i?{span:i}:{})}}class _re extends Tee{constructor(e,t){super(e),this.bins=t}clone(){return new _re(null,v0(this.bins))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((e,n,r)=>{if(P6(n)&&L2(n.bin)){const{key:i,binComponent:a}=wre(n,n.bin,t);e[i]=Object.assign(Object.assign(Object.assign({},a),e[i]),function(e,t,n,r){var i,a;if(c8(t,n)){const o=Iie(e)&&null!==(a=null!==(i=e.axis(n))&&void 0!==i?i:e.legend(n))&&void 0!==a?a:{},s=W6(t,{expr:"datum"}),l=W6(t,{expr:"datum",binSuffix:"end"});return{formulaAs:W6(t,{binSuffix:"range",forAs:!0}),formula:f6(s,l,o.format,o.formatType,r)}}return{}}(t,n,r,t.config))}return e},{});return j0(n)?null:new _re(e,n)}static makeFromTransform(e,t,n){const{key:r,binComponent:i}=wre(t,t.bin,n);return new _re(e,{[r]:i})}merge(e,t){for(const n of F0(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=I0([...this.bins[n].as,...e.bins[n].as],w0)):this.bins[n]=e.bins[n];for(const n of e.children)e.removeChild(n),n.parent=this;e.remove()}producedFields(){return new Set(R0(this.bins).map(e=>e.as).flat(2))}dependentFields(){return new Set(R0(this.bins).map(e=>e.field))}hash(){return"Bin "+w0(this.bins)}assemble(){return R0(this.bins).flatMap(e=>{const t=[],[n,...r]=e.as,i=e.bin,{extent:a}=i,o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(i,["extent"]),s=Object.assign(Object.assign(Object.assign({type:"bin",field:q0(e.field),as:n,signal:e.signal},z2(a)?{extent:null}:{extent:a}),e.span?{span:{signal:`span(${e.span})`}}:{}),o);!a&&e.extentSignal&&(t.push({type:"extent",field:q0(e.field),signal:e.extentSignal}),s.extent={signal:e.extentSignal}),t.push(s);for(const l of r)for(let e=0;e<2;e++)t.push({type:"formula",expr:W6({field:n[e]},{expr:"datum"}),as:l[e]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t})}}class kre extends Tee{constructor(e,t,n){super(e),this.dimensions=t,this.measures=n}clone(){return new kre(null,new Set(this.dimensions),v0(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef(e=>{e.aggregate&&(n=!0)});const r={},i=new Set;return n?(t.forEachFieldDef((e,n)=>{var a,o,s,l;const{aggregate:u,field:c}=e;if(u)if("count"===u)r["*"]=null!==(a=r["*"])&&void 0!==a?a:{},r["*"].count=new Set([W6(e,{forAs:!0})]);else{if(p1(u)||m1(u)){const e=p1(u)?"argmin":"argmax",t=u[e];r[t]=null!==(o=r[t])&&void 0!==o?o:{},r[t][e]=new Set([W6({op:e,field:t},{forAs:!0})])}else r[c]=null!==(s=r[c])&&void 0!==s?s:{},r[c][u]=new Set([W6(e,{forAs:!0})]);N2(n)&&"unaggregated"===t.scaleDomain(n)&&(r[c]=null!==(l=r[c])&&void 0!==l?l:{},r[c].min=new Set([W6({field:c,aggregate:"min"},{forAs:!0})]),r[c].max=new Set([W6({field:c,aggregate:"max"},{forAs:!0})]))}else!function(e,t,n,r){const i=Iie(r)?r.encoding[b2(t)]:void 0;if(P6(n)&&Iie(r)&&C6(t,n,i,r.stack,r.markDef,r.config))e.add(W6(n,{})),e.add(W6(n,{suffix:"end"})),n.bin&&c8(n,t)&&e.add(W6(n,{binSuffix:"range"}));else if(t in i2){const n=function(e){switch(e){case N1:return"y";case F1:return"y2";case j1:return"x";case R1:return"x2"}}(t);e.add(r.getName(n))}else e.add(W6(n))}(i,n,e,t)}),i.size+F0(r).length===0?null:new kre(e,i,r)):null}static makeFromTransform(e,t){var n,r,i;const a=new Set,o={};for(const s of t.aggregate){const{op:e,field:t,as:i}=s;e&&("count"===e?(o["*"]=null!==(n=o["*"])&&void 0!==n?n:{},o["*"].count=new Set([i||W6(s,{forAs:!0})])):(o[t]=null!==(r=o[t])&&void 0!==r?r:{},o[t][e]=new Set([i||W6(s,{forAs:!0})])))}for(const s of null!==(i=t.groupby)&&void 0!==i?i:[])a.add(s);return a.size+F0(o).length===0?null:new kre(e,a,o)}merge(e){return O0(this.dimensions,e.dimensions)?(function(e,t){var n;for(const r of F0(t)){const i=t[r];for(const t of F0(i))r in e?e[r][t]=new Set([...null!==(n=e[r][t])&&void 0!==n?n:[],...i[t]]):e[r]={[t]:i[t]}}}(this.measures,e.measures),!0):(f3.debug("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...F0(this.measures)])}producedFields(){const e=new Set;for(const t of F0(this.measures))for(const n of F0(this.measures[t])){const r=this.measures[t][n];0===r.size?e.add(`${n}_${t}`):r.forEach(e.add,e)}return e}hash(){return"Aggregate "+w0({dimensions:this.dimensions,measures:this.measures})}assemble(){const e=[],t=[],n=[];for(const r of F0(this.measures))for(const i of F0(this.measures[r]))for(const a of this.measures[r][i])n.push(a),e.push(i),t.push("*"===r?null:q0(r));return{type:"aggregate",groupby:[...this.dimensions].map(q0),ops:e,fields:t,as:n}}}class Ere extends Tee{constructor(e,t,n,r){super(e),this.model=t,this.name=n,this.data=r;for(const i of u2){const e=t.facet[i];if(e){const{bin:n,sort:r}=e;this[i]=Object.assign({name:t.getName(i+"_domain"),fields:[W6(e),...L2(n)?[W6(e,{binSuffix:"end"})]:[]]},y6(r)?{sortField:r}:km(r)?{sortIndexField:Dne(e,i)}:{})}}this.childModel=t.child}hash(){let e="Facet";for(const t of u2)this[t]&&(e+=` ${t.charAt(0)}:${w0(this[t])}`);return e}get fields(){var e;const t=[];for(const n of u2)(null===(e=this[n])||void 0===e?void 0:e.fields)&&t.push(...this[n].fields);return t}dependentFields(){const e=new Set(this.fields);for(const t of u2)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of E2){const n=this.childModel.component.scales[t];if(n&&!n.merged){const r=n.get("type"),i=n.get("range");if(p4(r)&&D3(i)){const n=die(hie(this.childModel,t));n?e[t]=n:p3(y.unknownField(t))}}}return e}assembleRowColumnHeaderData(e,t,n){const r={row:"y",column:"x"}[e],i=[],a=[],o=[];n&&n[r]&&(t?(i.push("distinct_"+n[r]),a.push("max")):(i.push(n[r]),a.push("distinct")),o.push("distinct_"+n[r]));const{sortField:s,sortIndexField:l}=this[e];if(s){const{op:e=p6,field:t}=s;i.push(t),a.push(e),o.push(W6(s,{forAs:!0}))}else l&&(i.push(l),a.push("max"),o.push(l));return{name:this[e].name,source:null!=t?t:this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},i.length?{fields:i,ops:a,as:o}:{})]}}assembleFacetHeaderData(e){var t,n;const{columns:r}=this.model.layout,{layoutHeaders:i}=this.model.component,a=[],o={};for(const u of Fne){for(const e of Rne){const r=null!==(t=i[u]&&i[u][e])&&void 0!==t?t:[];for(const e of r)if((null===(n=e.axes)||void 0===n?void 0:n.length)>0){o[u]=!0;break}}if(o[u]){const e=`length(data("${this.facet.name}"))`;a.push({name:`${this.facet.name}_${u}`,transform:[{type:"sequence",start:0,stop:"row"===u?r?{signal:`ceil(${e} / ${r})`}:1:r?{signal:`min(${e}, ${r})`}:{signal:e}}]})}}const{row:s,column:l}=o;return(s||l)&&a.unshift(this.assembleRowColumnHeaderData("facet",null,e)),a}assemble(){var e,t;const n=[];let r=null;const i=this.getChildIndependentFieldsWithStep(),{column:a,row:o,facet:s}=this;if(a&&o&&(i.x||i.y)){r=`cross_${this.column.name}_${this.row.name}`;const a=[].concat(null!==(e=i.x)&&void 0!==e?e:[],null!==(t=i.y)&&void 0!==t?t:[]),o=a.map(()=>"distinct");n.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:a,ops:o}]})}for(const l of[k1,_1])this[l]&&n.push(this.assembleRowColumnHeaderData(l,r,i));if(s){const e=this.assembleFacetHeaderData(i);e&&n.push(...e)}return n}}function Sre(e){return"'"===e[0]&&"'"===e[e.length-1]||'"'===e[0]&&'"'===e[e.length-1]?e.slice(1,-1):e}function Tre(e){const t={};return function e(t,n){if(p0(t))e(t.not,n);else if(f0(t))for(const r of t.and)e(r,n);else if(h0(t))for(const r of t.or)e(r,n);else n(t)}(e.filter,e=>{var n;if(H3(e)){let r=null;R3(e)?r=m8(e.equal):L3(e)?r=m8(e.lte):P3(e)?r=m8(e.lt):B3(e)?r=m8(e.gt):$3(e)?r=m8(e.gte):z3(e)?r=e.range[0]:U3(e)&&(r=(null!==(n=e.oneOf)&&void 0!==n?n:e.in)[0]),r&&(m3(r)?t[e.field]="date":vg(r)?t[e.field]="number":bg(r)&&(t[e.field]="string")),e.timeUnit&&(t[e.field]="date")}}),t}class Cre extends Tee{constructor(e,t){super(e),this._parse=t}clone(){return new Cre(null,v0(this._parse))}hash(){return"Parse "+w0(this._parse)}static makeExplicit(e,t,n){let r={};const i=t.data;return!A9(i)&&i&&i.format&&i.format.parse&&(r=i.format.parse),this.makeWithAncestors(e,r,{},n)}static makeWithAncestors(e,t,n,r){for(const o of F0(n)){const e=r.getWithExplicit(o);void 0!==e.value&&(e.explicit||e.value===n[o]||"derived"===e.value||"flatten"===n[o]?delete n[o]:p3(y.differentParse(o,n[o],e.value)))}for(const o of F0(t)){const e=r.get(o);void 0!==e&&(e===t[o]?delete t[o]:p3(y.differentParse(o,t[o],e)))}const i=new b9(t,n);r.copyAll(i);const a={};for(const o of F0(i.combine())){const e=i.get(o);null!==e&&(a[o]=e)}return 0===F0(a).length||r.parseNothing?null:new Cre(e,a)}get parse(){return this._parse}merge(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}assembleFormatParse(){const e={};for(const t of F0(this._parse)){const n=this._parse[t];1===X0(t)&&(e[t]=n)}return e}producedFields(){return new Set(F0(this._parse))}dependentFields(){return new Set(F0(this._parse))}assembleTransforms(e=!1){return F0(this._parse).filter(t=>!e||X0(t)>1).map(e=>{const t=function(e,t){const n=H0(e);return"number"===t?`toNumber(${n})`:"boolean"===t?`toBoolean(${n})`:"string"===t?`toString(${n})`:"date"===t?`toDate(${n})`:"flatten"===t?n:0===t.indexOf("date:")?`timeParse(${n},'${Sre(t.slice(5,t.length))}')`:0===t.indexOf("utc:")?`utcParse(${n},'${Sre(t.slice(4,t.length))}')`:(p3(y.unrecognizedParse(t)),null)}(e,this._parse[e]);return t?{type:"formula",expr:t,as:Y0(e)}:null}).filter(e=>null!==e)}}class Ire extends Tee{clone(){return new Ire(null)}constructor(e){super(e)}dependentFields(){return new Set}producedFields(){return new Set([y7])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:y7}}}class Are extends Tee{constructor(e,t){super(e),this.params=t}clone(){return new Are(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return"Graticule "+w0(this.params)}assemble(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)}}class Ore extends Tee{constructor(e,t){super(e),this.params=t}clone(){return new Ore(null,this.params)}dependentFields(){return new Set}producedFields(){var e;return new Set([null!==(e=this.params.as)&&void 0!==e?e:"data"])}hash(){return"Hash "+w0(this.params)}assemble(){return Object.assign({type:"sequence"},this.params)}}class Dre extends Tee{constructor(e){let t;if(super(null),A9(e=null!=e?e:{name:"source"})||(t=e.format?Object.assign({},b0(e.format,["parse"])):{}),C9(e))this._data={values:e.values};else if(T9(e)){if(this._data={url:e.url},!t.type){let n=/(?:\.([^.]+))?$/.exec(e.url)[1];k0(["json","csv","tsv","dsv","topojson"],n)||(n="json"),t.type=n}}else D9(e)?this._data={values:[{type:"Sphere"}]}:(I9(e)||A9(e))&&(this._data={});this._generator=A9(e),e.name&&(this._name=e.name),t&&!j0(t)&&(this._data.format=t)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var Mre,Nre=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n};function jre(e){return e instanceof Dre||e instanceof Are||e instanceof Ore}class Fre{constructor(){Mre.set(this,void 0),Nre(this,Mre,!1)}setModified(){Nre(this,Mre,!0)}get modifiedFlag(){return function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}(this,Mre)}}Mre=new WeakMap;class Rre extends Fre{getNodeDepths(e,t,n){n.set(e,t);for(const r of e.children)this.getNodeDepths(r,t+1,n);return n}optimize(e){const t=[...this.getNodeDepths(e,0,new Map).entries()].sort((e,t)=>t[1]-e[1]);for(const n of t)this.run(n[0]);return this.modifiedFlag}}class Pre extends Fre{optimize(e){this.run(e);for(const t of e.children)this.optimize(t);return this.modifiedFlag}}class Lre extends Pre{mergeNodes(e,t){const n=t.shift();for(const r of t)e.removeChild(r),r.parent=n,r.remove()}run(e){const t=e.children.map(e=>e.hash()),n={};for(let r=0;r<t.length;r++)void 0===n[t[r]]?n[t[r]]=[e.children[r]]:n[t[r]].push(e.children[r]);for(const r of F0(n))n[r].length>1&&(this.setModified(),this.mergeNodes(e,n[r]))}}class Bre extends Pre{constructor(e){super(),this.requiresSelectionId=e&&dte(e)}run(e){e instanceof Ire&&(this.requiresSelectionId&&(jre(e.parent)||e.parent instanceof kre||e.parent instanceof Cre)||(this.setModified(),e.remove()))}}class $re extends Fre{optimize(e){return this.run(e,new Set),this.modifiedFlag}run(e,t){let n=new Set;e instanceof Aee&&(n=e.producedFields(),D0(n,t)&&(this.setModified(),e.removeFormulas(t),0===e.producedFields.length&&e.remove()));for(const r of e.children)this.run(r,new Set([...t,...n]))}}class zre extends Pre{constructor(){super()}run(e){e instanceof Cee&&!e.isRequired()&&(this.setModified(),e.remove())}}class Ure extends Rre{run(e){if(!(jre(e)||e.numChildren()>1))for(const t of e.children)if(t instanceof Cre)if(e instanceof Cre)this.setModified(),e.merge(t);else{if(N0(e.producedFields(),t.dependentFields()))continue;this.setModified(),t.swapWithParent()}}}class Hre extends Rre{run(e){const t=[...e.children],n=e.children.filter(e=>e instanceof Cre);if(e.numChildren()>1&&n.length>=1){const r={},i=new Set;for(const e of n){const t=e.parse;for(const e of F0(t))e in r?r[e]!==t[e]&&i.add(e):r[e]=t[e]}for(const e of i)delete r[e];if(!j0(r)){this.setModified();const n=new Cre(e,r);for(const i of t){if(i instanceof Cre)for(const e of F0(r))delete i.parse[e];e.removeChild(i),i.parent=n,i instanceof Cre&&0===F0(i.parse).length&&i.remove()}}}}}class Wre extends Rre{run(e){e instanceof Cee||e.numChildren()>0||e instanceof Ere||e instanceof Dre||(this.setModified(),e.remove())}}class Vre extends Rre{run(e){const t=e.children.filter(e=>e instanceof Aee),n=t.pop();for(const r of t)this.setModified(),n.merge(r)}}class qre extends Rre{run(e){const t=e.children.filter(e=>e instanceof kre),n={};for(const r of t){const e=w0(r.groupBy);e in n||(n[e]=[]),n[e].push(r)}for(const r of F0(n)){const t=n[r];if(t.length>1){const n=t.pop();for(const r of t)n.merge(r)&&(e.removeChild(r),r.parent=n,r.remove(),this.setModified())}}}}class Gre extends Rre{constructor(e){super(),this.model=e}run(e){const t=!(jre(e)||e instanceof fne||e instanceof Cre||e instanceof Ire),n=[],r=[];for(const i of e.children)i instanceof _re&&(t&&!N0(e.producedFields(),i.dependentFields())?n.push(i):r.push(i));if(n.length>0){const t=n.pop();for(const e of n)t.merge(e,this.model.renameSignal.bind(this.model));this.setModified(),e instanceof _re?e.merge(t,this.model.renameSignal.bind(this.model)):t.swapWithParent()}if(r.length>1){const e=r.pop();for(const t of r)e.merge(t,this.model.renameSignal.bind(this.model));this.setModified()}}}class Yre extends Rre{run(e){const t=[...e.children];if(!E0(t,e=>e instanceof Cee)||e.numChildren()<=1)return;const n=[];let r;for(const i of t)if(i instanceof Cee){let t=i;for(;1===t.numChildren();){const[e]=t.children;if(!(e instanceof Cee))break;t=e}n.push(...t.children),r?(e.removeChild(i),i.parent=r.parent,r.parent.removeChild(r),r.parent=t,this.setModified()):r=t}else n.push(i);if(n.length){this.setModified();for(const e of n)e.parent.removeChild(e),e.parent=r}}}class Xre extends Tee{constructor(e,t){super(e),this.transform=t}clone(){return new Xre(null,v0(this.transform))}addDimensions(e){this.transform.groupby=I0(this.transform.groupby.concat(e),e=>e)}dependentFields(){const e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map(e=>e.field).filter(e=>void 0!==e).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:W6(e)}hash(){return"JoinAggregateTransform "+w0(this.transform)}assemble(){const e=[],t=[],n=[];for(const i of this.transform.joinaggregate)t.push(i.op),n.push(this.getDefaultName(i)),e.push(void 0===i.field?null:i.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:t,fields:e},void 0!==r?{groupby:r}:{})}}class Kre extends Tee{constructor(e,t){super(e),this._stack=t}clone(){return new Kre(null,v0(this._stack))}static makeFromTransform(e,t){const{stack:n,groupby:r,as:i,offset:a="zero"}=t,o=[],s=[];if(void 0!==t.sort)for(const c of t.sort)o.push(c.field),s.push(K0(c.order,"ascending"));const l={field:o,order:s};let u;return u=function(e){return km(e)&&e.every(e=>bg(e))&&e.length>1}(i)?i:bg(i)?[i,i+"_end"]:[t.stack+"_start",t.stack+"_end"],new Kre(e,{stackField:n,groupby:r,offset:a,sort:l,facetby:[],as:u})}static makeFromEncoding(e,t){const n=t.stack,{encoding:r}=t;if(!n)return null;const{groupbyChannel:i,fieldChannel:a,offset:o,impute:s}=n;let l;i&&(l=e8(r[i]));const u=function(e){return e.stack.stackBy.reduce((e,t)=>{const n=W6(t.fieldDef);return n&&e.push(n),e},[])}(t),c=t.encoding.order;let d;return d=km(c)||D6(c)?S8(c):u.reduce((e,t)=>(e.field.push(t),e.order.push("y"===a?"descending":"ascending"),e),{field:[],order:[]}),new Kre(e,{dimensionFieldDef:l,stackField:t.vgField(a),facetby:[],stackby:u,sort:d,offset:o,impute:s,as:[t.vgField(a,{suffix:"start",forAs:!0}),t.vgField(a,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return"Stack "+w0(this._stack)}getGroupbyFields(){const{dimensionFieldDef:e,impute:t,groupby:n}=this._stack;return e?e.bin?t?[W6(e,{binSuffix:"mid"})]:[W6(e,{}),W6(e,{binSuffix:"end"})]:[W6(e)]:null!=n?n:[]}assemble(){const e=[],{facetby:t,dimensionFieldDef:n,stackField:r,stackby:i,sort:a,offset:o,impute:s,as:l}=this._stack;if(s&&n){const{band:a=.5,bin:o}=n;o&&e.push({type:"formula",expr:a+"*"+W6(n,{expr:"datum"})+`+${1-a}*`+W6(n,{expr:"datum",binSuffix:"end"}),as:W6(n,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:r,groupby:[...i,...t],key:W6(n,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:r,sort:a,as:l,offset:o}),e}}class Zre extends Tee{constructor(e,t){super(e),this.transform=t}clone(){return new Zre(null,v0(this.transform))}addDimensions(e){this.transform.groupby=I0(this.transform.groupby.concat(e),e=>e)}dependentFields(){var e,t;const n=new Set;return(null!==(e=this.transform.groupby)&&void 0!==e?e:[]).forEach(n.add,n),(null!==(t=this.transform.sort)&&void 0!==t?t:[]).forEach(e=>n.add(e.field)),this.transform.window.map(e=>e.field).filter(e=>void 0!==e).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:W6(e)}hash(){return"WindowTransform "+w0(this.transform)}assemble(){var e;const t=[],n=[],r=[],i=[];for(const c of this.transform.window)n.push(c.op),r.push(this.getDefaultName(c)),i.push(void 0===c.param?null:c.param),t.push(void 0===c.field?null:c.field);const a=this.transform.frame,o=this.transform.groupby;if(a&&null===a[0]&&null===a[1]&&n.every(e=>g1(e)))return Object.assign({type:"joinaggregate",as:r,ops:n,fields:t},void 0!==o?{groupby:o}:{});const s=[],l=[];if(void 0!==this.transform.sort)for(const c of this.transform.sort)s.push(c.field),l.push(null!==(e=c.order)&&void 0!==e?e:"ascending");const u=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:i,as:r,ops:n,fields:t,sort:{field:s,order:l}},void 0!==u?{ignorePeers:u}:{}),void 0!==o?{groupby:o}:{}),void 0!==a?{frame:a}:{})}}function Jre(e){if(e instanceof Ere)if(1!==e.numChildren()||e.children[0]instanceof Cee){const n=e.model.component.data.main;!function e(t){if(t instanceof Cee&&t.type===N9.Main&&1===t.numChildren()){const n=t.children[0];n instanceof Ere||(n.swapWithParent(),e(t))}}(n);const r=(t=e,function e(n){if(!(n instanceof Ere)){const r=n.clone();if(r instanceof Cee){const e=Qre+r.getSource();r.setSource(e),t.model.component.data.outputNodes[e]=r}else(r instanceof kre||r instanceof Kre||r instanceof Zre||r instanceof Xre)&&r.addDimensions(t.fields);for(const t of n.children.flatMap(e))t.parent=r;return[r]}return n.children.flatMap(e)}),i=e.children.map(r).flat();for(const e of i)e.parent=n}else{const t=e.children[0];(t instanceof kre||t instanceof Kre||t instanceof Zre||t instanceof Xre)&&t.addDimensions(e.fields),t.swapWithParent(),Jre(e)}else e.children.map(Jre);var t}const Qre="scale_";function eie(e){for(const t of e){for(const e of t.children)if(e.parent!==t)return!1;if(!eie(t.children))return!1}return!0}function tie(e,t){let n=!1;for(const r of t)n=e.optimize(r)||n;return n}function nie(e,t,n){let r=e.sources,i=!1;return i=tie(new zre,r)||i,i=tie(new Bre(t),r)||i,r=r.filter(e=>e.numChildren()>0),i=tie(new Wre,r)||i,r=r.filter(e=>e.numChildren()>0),n||(i=tie(new Ure,r)||i,i=tie(new Gre(t),r)||i,i=tie(new $re,r)||i,i=tie(new Hre,r)||i,i=tie(new qre,r)||i,i=tie(new Vre,r)||i,i=tie(new Lre,r)||i,i=tie(new Yre,r)||i),e.sources=r,i}class rie{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new rie(()=>e(t))}}function iie(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:r}=e,i=function(e,t,n,r){if("unaggregated"===e){const{valid:e,reason:r}=uie(t,n);if(!e)return void p3(r)}else if(void 0===e&&r.useUnaggregatedDomain){const{valid:e}=uie(t,n);if(e)return"unaggregated"}return e}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:i})),"x"===t&&t8(r.x2)?t8(r.x)?E9(oie(n,i,e,"x"),oie(n,i,e,"x2"),"domain","scale",cie):oie(n,i,e,"x2"):"y"===t&&t8(r.y2)?t8(r.y)?E9(oie(n,i,e,"y"),oie(n,i,e,"y2"),"domain","scale",cie):oie(n,i,e,"y2"):oie(n,i,e,t)}function aie(e,t,n){var r;const i=null===(r=A3(n))||void 0===r?void 0:r.unit;return"temporal"===t||i?function(e,t,n){return e.map(e=>({signal:`{data: ${l8(e,{timeUnit:n,type:t})}}`}))}(e,t,i):[e]}function oie(e,t,n,r){const{encoding:i}=n,a=t8(i[r]),{type:o}=a,s=a.timeUnit;if(function(e){return e&&e.unionWith}(t)){const i=oie(e,void 0,n,r),a=aie(t.unionWith,o,s);return x9([...i.value,...a])}if(O3(t))return x9([t]);if(t&&"unaggregated"!==t&&!y4(t))return x9(aie(t,o,s));const l=n.stack;if(l&&r===l.fieldChannel){if("normalize"===l.offset)return w9([[0,1]]);const e=n.requestDataName(N9.Main);return w9([{data:e,field:n.vgField(r,{suffix:"start"})},{data:e,field:n.vgField(r,{suffix:"end"})}])}const u=N2(r)&&D6(a)?function(e,t,n){if(!p4(n))return;const r=e.fieldDef(t),i=r.sort;if(b6(i))return{op:"min",field:Dne(r,t),order:"ascending"};const{stack:a}=e,o=a?[...a.groupbyField?[a.groupbyField]:[],...a.stackBy.map(e=>e.fieldDef.field)]:void 0;if(y6(i))return sie(i,a&&!k0(o,i.field));if(v6(i)){const{encoding:t,order:n}=i,r=e.fieldDef(t),{aggregate:s,field:l}=r,u=a&&!k0(o,l);if(p1(s)||m1(s))return sie({field:W6(r),order:n},u);if(g1(s)||!s)return sie({op:s,field:l,order:n},u)}else{if("descending"===i)return{op:"min",field:e.vgField(t),order:"descending"};if(k0(["ascending",void 0],i))return!0}}(n,r,e):void 0;if(N6(a))return w9(aie([a.datum],o,s));const c=a;if("unaggregated"===t){const e=n.requestDataName(N9.Main),{field:t}=a;return w9([{data:e,field:W6({field:t,aggregate:"min"})},{data:e,field:W6({field:t,aggregate:"max"})}])}if(L2(c.bin)){if(p4(e))return w9("bin-ordinal"===e?[]:[{data:L0(u)?n.requestDataName(N9.Main):n.requestDataName(N9.Raw),field:n.vgField(r,c8(c,r)?{binSuffix:"range"}:{}),sort:!0!==u&&Em(u)?u:{field:n.vgField(r,{}),op:"min"}}]);{const{bin:e}=c;if(L2(e)){const t=xre(n,c.field,e);return w9([new rie(()=>{const e=n.getSignalName(t);return`[${e}.start, ${e}.stop]`})])}return w9([{data:n.requestDataName(N9.Main),field:n.vgField(r,{})}])}}if(c.timeUnit&&k0(["time","utc"],e)&&C6(r,c,Iie(n)?n.encoding[b2(r)]:void 0,n.stack,n.markDef,n.config)){const e=n.requestDataName(N9.Main);return w9([{data:e,field:n.vgField(r)},{data:e,field:n.vgField(r,{suffix:"end"})}])}return w9(u?[{data:L0(u)?n.requestDataName(N9.Main):n.requestDataName(N9.Raw),field:n.vgField(r),sort:u}]:[{data:n.requestDataName(N9.Main),field:n.vgField(r)}])}function sie(e,t){const{op:n,field:r,order:i}=e;return Object.assign(Object.assign({op:null!=n?n:t?"sum":p6},r?{field:q0(r)}:{}),i?{order:i}:{})}function lie(e,t){var n;const r=e.component.scales[t],i=e.specifiedScales[t].domain,a=null===(n=e.fieldDef(t))||void 0===n?void 0:n.bin,o=y4(i)&&i,s=$2(a)&&z2(a.extent)&&a.extent;(o||s)&&r.set("selectionExtent",null!=o?o:s,!0)}function uie(e,t){const{aggregate:n,type:r}=e;return n?bg(n)&&!x1[n]?{valid:!1,reason:y.unaggregateDomainWithNonSharedDomainOp(n)}:"quantitative"===r&&"log"===t?{valid:!1,reason:y.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:y.unaggregateDomainHasNoEffectForRawField(e)}}function cie(e,t,n,r){return e.explicit&&t.explicit&&p3(y.mergeConflictingDomainProperty(n,r,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function die(e){if(M3(e)&&bg(e.field))return e.field;if(function(e){return!km(e)&&"fields"in e&&!("data"in e)}(e)){let t;for(const n of e.fields)if(M3(n)&&bg(n.field))if(t){if(t!==n.field)return p3(y.FACETED_INDEPENDENT_DIFFERENT_SOURCES),t}else t=n.field;return p3(y.FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES),t}if(function(e){return!km(e)&&"fields"in e&&"data"in e}(e)){p3(y.FACETED_INDEPENDENT_SAME_SOURCE);const t=e.fields[0];return bg(t)?t:void 0}}function hie(e,t){return function(e){const t=I0(e.map(e=>M3(e)?function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["sort"]):e),w0),n=I0(e.map(e=>{if(M3(e)){const t=e.sort;return void 0===t||L0(t)||("op"in t&&"count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}}).filter(e=>void 0!==e),w0);if(0===t.length)return;if(1===t.length){const t=e[0];if(M3(t)&&n.length>0){let e=n[0];return n.length>1?(p3(y.MORE_THAN_ONE_SORT),e=!0):Em(e)&&"field"in e&&t.field===e.field&&(e=!e.order||{order:e.order}),Object.assign(Object.assign({},t),{sort:e})}return t}const r=I0(n.map(e=>L0(e)||!("op"in e)||bg(e.op)&&e.op in f1?e:(p3(y.domainSortDropped(e)),!0)),w0);let i;1===r.length?i=r[0]:r.length>1&&(p3(y.MORE_THAN_ONE_SORT),i=!0);const a=I0(e.map(e=>M3(e)?e.data:null),e=>e);return Object.assign(1===a.length&&null!==a[0]?{data:a[0],fields:t.map(e=>e.field)}:{fields:t},i?{sort:i}:{})}(e.component.scales[t].get("domains").map(t=>(M3(t)&&(t.data=e.lookupDataSource(t.data)),t)))}function fie(e){return F0(e.component.scales).reduce((t,n)=>{const r=e.component.scales[n];if(r.merged)return t;const i=r.combine(),{name:a,type:o,selectionExtent:s,reverse:l}=i,u=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(i,["name","type","selectionExtent","domains","range","reverse"]),c=function(e,t,n,r){if(S2(n)){if(D3(e))return{step:{signal:t+"_step"}}}else if(Em(e)&&M3(e))return Object.assign(Object.assign({},e),{data:r.lookupDataSource(e.data)});return e}(i.range,a,n,e);let d;s&&(d=function(e,t){const n=t.selection;return{signal:gne(e.getSelectionComponent(n,B0(n)),t)}}(e,s));const h=hie(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:a,type:o},h?{domain:h}:{}),d?{domainRaw:d}:{}),{range:c}),void 0!==l?{reverse:l}:{}),u)),t},[])}class pie extends b9{constructor(e,t){super({},{name:e}),this.merged=!1,this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||E0(this.get("domains"),e=>km(e)&&2===e.length&&e[0]<=0&&e[1]>=0)}}const mie=["range","scheme"];function gie(e){return"x"===e?"width":"y"===e?"height":void 0}function vie(e,t){const n=e.fieldDef(t);if(n&&n.bin&&L2(n.bin)){const r=xre(e,n.field,n.bin),i=gie(t),a=e.getName(i);return new rie(()=>{const t=e.getSignalName(r),n=`(${t}.stop - ${t}.start) / ${t}.step`;return`${e.getSignalName(a)} / (${n})`})}}function yie(e,t){const n=t.specifiedScales[e],{size:r}=t,i=t.getScaleComponent(e).get("type");for(const u of mie)if(void 0!==n[u]){const r=_4(i,u),o=k4(e,u);if(r)if(o)p3(o);else switch(u){case"range":{const r=n.range;if(km(r)){if(S2(e))return x9(r.map(e=>{if("width"===e||"height"===e){const n=t.getName(e),r=t.getSignalName.bind(t);return rie.fromName(r,n)}return e}))}else if(Em(r))return x9({data:t.requestDataName(N9.Main),field:r.field,sort:{op:"min",field:t.vgField(e)}});return x9(r)}case"scheme":return x9(function(e){return!bg(e)&&!!e.name}(a=n[u])?Object.assign({scheme:a.name},b0(a,["name"])):{scheme:a})}else p3(y.scalePropertyNotWorkWithScaleType(i,u,e))}var a;if(e===S1||e===T1){const t=e===S1?"width":"height",n=r[t];if(S7(n)){if(p4(i))return x9({step:n.step});p3(y.stepDropped(t))}}const{rangeMin:o,rangeMax:s}=n,l=function(e,t){const{size:n,config:r,mark:i,encoding:a}=t,o=t.getSignalName.bind(t),{type:s}=t8(a[e]),l=t.getScaleComponent(e).get("type"),{domain:u,domainMid:c}=t.specifiedScales[e];switch(e){case S1:case T1:{if(k0(["point","band"],l))if(e!==S1||n.width){if(e===T1&&!n.height){const e=O7(r.view,"height");if(S7(e))return e}}else{const e=O7(r.view,"width");if(S7(e))return e}const i=gie(e),a=t.getName(i);return e===T1&&m4(l)?[rie.fromName(o,a),0]:[0,rie.fromName(o,a)]}case z1:{const a=function e(t,n,r){if(n)return O3(n)?{signal:`${n.signal} ? 0 : ${e(t,!1,r)}`}:0;switch(t){case"bar":case"tick":return r.scale.minBandSize;case"line":case"trail":case"rule":return r.scale.minStrokeWidth;case"text":return r.scale.minFontSize;case"point":case"square":case"circle":return r.scale.minSize}throw new Error(y.incompatibleChannel("size",t))}(i,t.component.scales[e].get("zero"),r),o=function(e,t,n,r){const i={x:vie(n,"x"),y:vie(n,"y")};switch(e){case"bar":case"tick":{if(void 0!==r.scale.maxBandSize)return r.scale.maxBandSize;const e=xie(t,i,r.view);return vg(e)?e-1:new rie(()=>e.signal+" - 1")}case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":{if(r.scale.maxSize)return r.scale.maxSize;const e=xie(t,i,r.view);return vg(e)?Math.pow(bie*e,2):new rie(()=>`pow(0.95 * ${e.signal}, 2)`)}}throw new Error(y.incompatibleChannel("size",e))}(i,n,t,r);return v4(l)?function(e,t,n){const r=()=>{const r=b8(t),i=b8(e),a=`(${r} - ${i}) / (${n} - 1)`;return`sequence(${i}, ${r} + ${a}, ${a})`};return O3(t)?new rie(r):{signal:r()}}(a,o,function(e,t,n,r){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return void 0!==n&&km(n)?n.length+1:(p3(y.domainRequiredForThresholdScale(r)),3)}}(l,r,u,e)):[a,o]}case D1:return[0,2*Math.PI];case U1:return[0,360];case A1:return[0,new rie(()=>`min(${t.getSignalName("width")},${t.getSignalName("height")})/2`)];case q1:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case G1:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case $1:return"symbol";case P1:case L1:case B1:return"ordinal"===l?"nominal"===s?"category":"ordinal":void 0!==c?"diverging":"rect"===i||"geoshape"===i?"heatmap":"ramp";case H1:case W1:case V1:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error("Scale range undefined for channel "+e)}(e,t);return(void 0!==o||void 0!==s)&&_4(i,"rangeMin")&&km(l)&&2===l.length?x9([null!=o?o:l[0],null!=s?s:l[1]]):w9(l)}const bie=.95;function xie(e,t,n){const r=S7(e.width)?e.width.step:A7(n,"width"),i=S7(e.height)?e.height.step:A7(n,"height");return t.x||t.y?new rie(()=>`min(${[t.x?t.x.signal:r,t.y?t.y.signal:i].join(", ")})`):Math.min(r,i)}function wie(e,t){Iie(e)?function(e,t){const n=e.component.scales,{config:r,encoding:i,markDef:a,specifiedScales:o}=e;for(const s of F0(n)){const l=o[s],u=n[s],c=e.getScaleComponent(s),d=t8(i[s]),h=l[t],f=c.get("type"),p=c.get("padding"),m=c.get("paddingInner"),g=_4(f,t),v=k4(s,t);if(void 0!==h&&(g?v&&p3(v):p3(y.scalePropertyNotWorkWithScaleType(f,t,s))),g&&void 0===v)if(void 0!==h){const e=d.timeUnit,n=d.type;switch(t){case"domainMax":case"domainMin":m3(l[t])||"temporal"===n||e?u.set(t,{signal:l8(l[t],{type:n,timeUnit:e})},!0):u.set(t,l[t],!0);break;default:u.copyKeyFromObject(t,l)}}else{const n=t in _ie?_ie[t]({model:e,channel:s,fieldOrDatumDef:d,scaleType:f,scalePadding:p,scalePaddingInner:m,domain:l.domain,markDef:a,config:r}):r.scale[t];void 0!==n&&u.set(t,n,!1)}}}(e,t):Eie(e,t)}const _ie={bins:({model:e,fieldOrDatumDef:t})=>D6(t)?function(e,t){const n=t.bin;if(L2(n)){const r=xre(e,t.field,n);return new rie(()=>e.getSignalName(r))}if(B2(n)&&$2(n)&&void 0!==n.step)return{step:n.step}}(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>function(e,t){if(k0([P1,L1,B1],e)&&"nominal"!==t)return"hcl"}(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>function(e,t,n){var r;if(!(null===(r=e8(n))||void 0===r?void 0:r.bin)&&!k0([t4,n4],e))return t in k2||void 0}(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:r,config:i})=>function(e,t,n,r,i,a){if(e in k2){if(g4(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;const{type:t,orient:o}=i;if("bar"===t&&(!D6(r)||!r.bin&&!r.timeUnit)&&("vertical"===o&&"x"===e||"horizontal"===o&&"y"===e))return a.continuousBandSize}if(t===r4)return n.pointPadding}}(e,t,i.scale,n,r,i.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:r})=>function(e,t,n,r){if(void 0===e&&t in k2){const{bandPaddingInner:e,barBandPaddingInner:t,rectBandPaddingInner:i}=r;return K0(e,"bar"===n?t:i)}}(e,t,n.type,r.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,scalePaddingInner:r,config:i})=>function(e,t,n,r,i,a){if(void 0===e&&t in k2&&"band"===n){const{bandPaddingOuter:e}=a;return K0(e,O3(i)?{signal:i.signal+"/2"}:i/2)}}(e,t,n,0,r,i.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:r})=>function(e,t,n,r){return"x"===n&&void 0!==r.xReverse?m4(e)&&"descending"===t?O3(r.xReverse)?{signal:"!"+r.xReverse.signal}:!r.xReverse:r.xReverse:!(!m4(e)||"descending"!==t)||void 0}(t,D6(e)?e.sort:void 0,n,r.scale),zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:r,scaleType:i})=>function(e,t,n,r,i){if(n&&"unaggregated"!==n&&m4(i)){if(km(n)){const e=n[n.length-1];if(n[0]<=0&&e>=0)return!0}return!1}if("size"===e&&"quantitative"===t.type&&!v4(i))return!0;if((!D6(t)||!t.bin)&&k0([...E2,...C2],e)){const{orient:t,type:n}=r;return!k0(["bar","area","line","trail"],n)||!("horizontal"===t&&"y"===e||"vertical"===t&&"x"===e)}return!1}(e,t,n,r,i)};function kie(e){Iie(e)?function(e){const t=e.component.scales;for(const n of M2){const r=t[n];if(!r)continue;const i=yie(n,e);r.setWithExplicit("range",i)}}(e):Eie(e,"range")}function Eie(e,t){const n=e.component.scales;for(const r of e.children)"range"===t?kie(r):wie(r,t);for(const r of F0(n)){let i;for(const n of e.children){const e=n.component.scales[r];e&&(i=E9(i,e.getWithExplicit(t),t,"scale",_9((e,n)=>{switch(t){case"range":return e.step&&n.step?e.step-n.step:0}return 0})))}n[r].setWithExplicit(t,i)}}const Sie=_9((e,t)=>s4(e)-s4(t));var Tie=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class Cie{constructor(){this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return void 0!==this.nameMap[e]}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function Iie(e){return"unit"===(null==e?void 0:e.type)}function Aie(e){return"facet"===(null==e?void 0:e.type)}function Oie(e){return"concat"===(null==e?void 0:e.type)}function Die(e){return"layer"===(null==e?void 0:e.type)}class Mie{constructor(e,t,n,r,i,a,o){var s,l;this.type=t,this.parent=n,this.config=i,this.children=[],this.correctDataNames=e=>(e.from&&e.from.data&&(e.from.data=this.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=this.lookupDataSource(e.from.facet.data)),e),this.parent=n,this.config=i,this.view=S4(o),this.name=null!==(s=e.name)&&void 0!==s?s:r,this.title=h8(e.title)?{text:e.title}:e.title?this.initTitle(e.title):void 0,this.scaleNameMap=n?n.scaleNameMap:new Cie,this.projectionNameMap=n?n.projectionNameMap:new Cie,this.signalNameMap=n?n.signalNameMap:new Cie,this.data=e.data,this.description=e.description,this.transforms=(null!==(l=e.transform)&&void 0!==l?l:[]).map(e=>j9(e)?{filter:m0(e.filter,G3)}:e),this.layout="layer"===t||"unit"===t?{}:function(e,t,n){var r,i;const a=n[t],o={},{spacing:s,columns:l}=a;void 0!==s&&(o.spacing=s),void 0!==l&&(_6(e)&&!x6(e.facet)||_7(e))&&(o.columns=l),k7(e)&&(o.columns=1);for(const u of C7)if(void 0!==e[u])if("spacing"===u){const t=e[u];o[u]=vg(t)?t:{row:null!==(r=t.row)&&void 0!==r?r:s,column:null!==(i=t.column)&&void 0!==i?i:s}}else o[u]=e[u];return o}(e,t,i),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:_6(e)||n&&n.component.data.isFaceted&&void 0===e.data},layoutSize:new b9,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},a?v0(a):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}initTitle(e){const t=F0(e),n={text:m8(e.text)};for(const r of t)n[r]=m8(e[r]);return n}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(e,{ignoreRange:t}={}){(function e(t){t.component.scales=Iie(t)?function(e){const{encoding:t,mark:n}=e;return M2.reduce((r,i)=>{const a=t8(t[i]);if(a&&n===$4&&i===$1&&a.type===Q3)return r;let o=a&&a.scale;if(a&&null!==o&&!1!==o){o=null!=o?o:{};const t=function(e,t,n,r){const i=function(e,t,n){var r;switch(t.type){case"nominal":case"ordinal":if(s2(e)||"discrete"===R2(e))return"shape"===e&&"ordinal"===t.type&&p3(y.discreteChannelCannotEncode(e,"ordinal")),"ordinal";if(e in k2){if(k0(["rect","bar","image","rule"],n))return"band"}else if("arc"===n&&e in T2)return"band";return void 0!==t.band||$6(t)&&(null===(r=t.axis)||void 0===r?void 0:r.tickBand)?"band":"point";case"temporal":return s2(e)?"time":"discrete"===R2(e)?(p3(y.discreteChannelCannotEncode(e,"temporal")),"ordinal"):D6(t)&&t.timeUnit&&A3(t.timeUnit).utc?"utc":"time";case"quantitative":return s2(e)?D6(t)&&L2(t.bin)?"bin-ordinal":"linear":"discrete"===R2(e)?(p3(y.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(y.invalidFieldType(t.type))}(t,n,r),{type:a}=e;return N2(t)?void 0!==a?function(e,t){if(!N2(e))return!1;switch(e){case S1:case T1:case D1:case A1:return g4(t)||k0(["band","point"],t);case z1:case q1:case H1:case W1:case V1:case U1:return g4(t)||v4(t)||k0(["band","point","ordinal"],t);case P1:case L1:case B1:return"band"!==t;case G1:return"ordinal"===t||v4(t);case $1:return"ordinal"===t}}(t,a)?D6(n)&&(o=a,!(k0([K3,J3],s=n.type)?void 0===o||p4(o):s===Z3?k0([t4,n4,void 0],o):s!==X3||k0(["log","pow","sqrt","symlog","quantile","quantize","threshold",e4,void 0],o)))?(p3(y.scaleTypeNotWorkWithFieldDef(a,i)),i):a:(p3(y.scaleTypeNotWorkWithChannel(t,a,i)),i):i:null;var o,s}(o,i,a,n);r[i]=new pie(e.scaleName(i+"",!0),{value:t,explicit:o.type===t})}return r},{})}(t):function(t){var n;const r=t.component.scales={},i={},a=t.component.resolve;for(const o of t.children){e(o);for(const e of F0(o.component.scales))if(a.scale[e]=null!==(n=a.scale[e])&&void 0!==n?n:Qne(e,t),"shared"===a.scale[e]){const t=i[e],n=o.component.scales[e].getWithExplicit("type");t?a4(t.value,n.value)?i[e]=E9(t,n,"type","scale",Sie):(a.scale[e]="independent",delete i[e]):i[e]=n}}for(const e of F0(i)){const n=t.scaleName(e,!0);r[e]=new pie(n,i[e]);for(const r of t.children){const t=r.component.scales[e];t&&(r.renameScale(t.get("name"),n),t.merged=!0)}}return r}(t)})(e),function e(t){Iie(t)?function(e){const t=e.component.scales;for(const n of F0(t)){const r=iie(e,n);if(t[n].setWithExplicit("domains",r),lie(e,n),e.component.data.isFaceted){let t=e;for(;!Aie(t)&&t.parent;)t=t.parent;if("shared"===t.component.resolve.scale[n])for(const e of r.value)M3(e)&&(e.data=Qre+e.data.replace(Qre,""))}}}(t):function(t){for(const r of t.children)e(r);const n=t.component.scales;for(const e of F0(n)){let r,i=null;for(const n of t.children){const t=n.component.scales[e];if(t){r=void 0===r?t.getWithExplicit("domains"):E9(r,t.getWithExplicit("domains"),"domains","scale",cie);const e=t.get("selectionExtent");i&&e&&i.selection!==e.selection&&p3(y.NEEDS_SAME_SELECTION),i=e}}n[e].setWithExplicit("domains",r),i&&n[e].set("selectionExtent",i,!0)}}(t)}(e);for(const n of w4)wie(e,n);t||kie(e)}(this)}parseProjection(){!function e(t){t.component.projection=Iie(t)?function(e){var t;if(e.hasProjection){const n=e.specifiedProjection,r=!(n&&(null!=n.scale||null!=n.translate)),i=r?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,a=r?function(e){const t=[],{encoding:n}=e;for(const r of[[j1,N1],[R1,F1]])(t8(n[r[0]])||t8(n[r[1]]))&&t.push({signal:e.getName("geojson_"+t.length)});return e.channelHasField($1)&&e.typedFieldDef($1).type===Q3&&t.push({signal:e.getName("geojson_"+t.length)}),0===t.length&&t.push(e.requestDataName(N9.Main)),t}(e):void 0;return new yre(e.projectionName(!0),Object.assign(Object.assign({},null!==(t=e.config.projection)&&void 0!==t?t:{}),null!=n?n:{}),i,a)}}(t):function(t){if(0===t.children.length)return;let n;for(const i of t.children)e(i);const r=S0(t.children,e=>{const t=e.component.projection;if(t){if(n){const e=function(e,t){const n=S0(vre,n=>!lg(e.explicit,n)&&!lg(t.explicit,n)||!(!lg(e.explicit,n)||!lg(t.explicit,n)||x0(e.get(n))!==x0(t.get(n))));if(x0(e.size)===x0(t.size)){if(n)return e;if(x0(e.explicit)===x0({}))return t;if(x0(t.explicit)===x0({}))return e}return null}(n,t);return e&&(n=e),!!e}return n=t,!0}return!0});if(n&&r){const e=t.projectionName(!0),r=new yre(e,n.specifiedProjection,n.size,v0(n.data));for(const n of t.children){const t=n.component.projection;t&&(t.isFit&&r.data.push(...n.component.projection.data),n.renameProjection(t.get("name"),e),t.merged=!0)}return r}}(t)}(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){!function e(t){const n=Iie(t)?function(e){const{encoding:t}=e,n={};for(const r of[P1,...p7]){const i=t8(t[r]);i&&e.getScaleComponent(r)&&(r===$1&&D6(i)&&i.type===Q3||(n[r]=fre(e,r)))}return n}(t):function(t){const{legends:n,resolve:r}=t.component;for(const i of t.children){e(i);for(const e of F0(i.component.legends))r.legend[e]=ere(t.component.resolve,e),"shared"===r.legend[e]&&(n[e]=pre(n[e],i.component.legends[e]),n[e]||(r.legend[e]="independent",delete n[e]))}for(const e of F0(n))for(const n of t.children)n.component.legends[e]&&"shared"===r.legend[e]&&delete n.component.legends[e];return n}(t);return t.component.legends=n,n}(this)}assembleGroupStyle(){var e,t;if("unit"===this.type||"layer"===this.type)return null!==(t=null===(e=this.view)||void 0===e?void 0:e.style)&&void 0!==t?t:"cell"}assembleEncodeFromView(e){const t=Tie(e,["style"]),n={};for(const r of F0(t)){const e=t[r];void 0!==e&&(n[r]=v8(e))}return n}assembleGroupEncodeEntry(e){let t={};return this.view&&(t=this.assembleEncodeFromView(this.view)),e||(this.description&&(t.description=v8(this.description)),"unit"!==this.type&&"layer"!==this.type)?j0(t)?void 0:t:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!=t?t:{})}assembleLayout(){if(!this.layout)return;const e=this.layout,{spacing:t}=e,n=Tie(e,["spacing"]),{component:r,config:i}=this,a=function(e,t){const n={};for(const r of u2){const i=e[r];if(null==i?void 0:i.facetFieldDef){const{titleAnchor:e,titleOrient:a}=jne(["titleAnchor","titleOrient"],i.facetFieldDef.header,t,r),o=Mne(r,a),s=Vne(e,o);void 0!==s&&(n[o]=s)}}return j0(n)?void 0:n}(r.layoutHeaders,i);return Object.assign(Object.assign(Object.assign({padding:t},this.assembleDefaultLayout()),n),a?{titleBand:a}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of u2)e[n].title&&t.push(Pne(this,n));for(const n of Fne)t=t.concat($ne(this,n));return t}assembleAxes(){return function(e,t){const{x:n=[],y:r=[]}=e;return[...n.map(e=>xne(e,"grid",t)),...r.map(e=>xne(e,"grid",t)),...n.map(e=>xne(e,"main",t)),...r.map(e=>xne(e,"main",t))].filter(e=>e)}(this.component.axes,this.config)}assembleLegends(){return mre(this)}assembleProjections(){return Die(e=this)||Oie(e)?function(e){return e.children.reduce((e,t)=>e.concat(t.assembleProjections()),gre(e))}(e):gre(e);var e}assembleTitle(){var e,t,n;const r=null!==(e=this.title)&&void 0!==e?e:{},{encoding:i}=r,a=Tie(r,["encoding"]),o=Object.assign(Object.assign(Object.assign({},d8(this.config.title).nonMark),a),i?{encode:{update:i}}:{});if(o.text)return k0(["unit","layer"],this.type)?k0(["middle",void 0],o.anchor)&&(o.frame=null!==(t=o.frame)&&void 0!==t?t:"group"):o.anchor=null!==(n=o.anchor)&&void 0!==n?n:"start",j0(o)?void 0:o}assembleGroup(e=[]){const t={};(e=e.concat(this.assembleSignals())).length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||Aie(this.parent)?function e(t){return Die(t)||Oie(t)?t.children.reduce((t,n)=>t.concat(e(n)),fie(t)):fie(t)}(this):[];r.length>0&&(t.scales=r);const i=this.assembleAxes();i.length>0&&(t.axes=i);const a=this.assembleLegends();return a.length>0&&(t.legends=a),t}getName(e){return B0((this.name?this.name+"_":"")+e)}getDataName(e){return this.getName(N9[e].toLowerCase())}requestDataName(e){const t=this.getDataName(e),n=this.component.data.outputNodeRefCounts;return n[t]=(n[t]||0)+1,t}getSizeSignalRef(e){if(Aie(this.parent)){const t=I2(Zne(e)),n=this.component.scales[t];if(n&&!n.merged){const e=n.get("type"),r=n.get("range");if(p4(e)&&D3(r)){const e=n.get("name"),r=die(hie(this,t));return r?{signal:Kne(e,n,W6({aggregate:"distinct",field:r},{expr:"datum"}))}:(p3(y.unknownField(t)),null)}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):p2(e)&&N2(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(y.selectionNotFound(t));return n}hasAxisOrientSignalRef(){var e,t;return(null===(e=this.component.axes.x)||void 0===e?void 0:e.some(e=>e.hasOrientSignalRef()))||(null===(t=this.component.axes.y)||void 0===t?void 0:t.some(e=>e.hasOrientSignalRef()))}}class Nie extends Mie{vgField(e,t={}){const n=this.fieldDef(e);if(n)return W6(n,t)}reduceFieldDef(e,t){return function(e,t,n,r){return e?F0(e).reduce((n,i)=>{const a=e[i];return km(a)?a.reduce((e,n)=>t.call(r,e,n,i),n):t.call(r,n,a,i)},n):n}(this.getMapping(),(t,n,r)=>{const i=e8(n);return i?e(t,i,r):t},t)}forEachFieldDef(e,t){F8(this.getMapping(),(t,n)=>{const r=e8(t);r&&e(r,n)},t)}}class jie extends Tee{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=v0(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"value",null!==(i=a[1])&&void 0!==i?i:"density"]}clone(){return new jie(null,v0(this.transform))}dependentFields(){var e;return new Set([this.transform.density,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"DensityTransform "+w0(this.transform)}assemble(){const e=this.transform,{density:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["density"]);return Object.assign({type:"kde",field:t},n)}}class Fie extends Tee{constructor(e,t){super(e),this.filter=t}clone(){return new Fie(null,Object.assign({},this.filter))}static make(e,t){const{config:n,mark:r,markDef:i}=t;if("filter"!==w8("invalid",i,n))return null;const a=t.reduceFieldDef((e,n,i)=>{const a=N2(i)&&t.getScaleComponent(i);return a&&m4(a.get("type"))&&"count"!==n.aggregate&&!z4(r)&&(e[n.field]=n),e},{});return F0(a).length?new Fie(e,a):null}dependentFields(){return new Set(F0(this.filter))}producedFields(){return new Set}hash(){return"FilterInvalid "+w0(this.filter)}assemble(){const e=F0(this.filter).reduce((e,t)=>{const n=this.filter[t],r=W6(n,{expr:"datum"});return null!==n&&("temporal"===n.type?e.push(`(isDate(${r}) || (isValid(${r}) && isFinite(+${r})))`):"quantitative"===n.type&&(e.push(`isValid(${r})`),e.push(`isFinite(+${r})`))),e},[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class Rie extends Tee{constructor(e,t){super(e),this.transform=t,this.transform=v0(t);const{flatten:n,as:r=[]}=this.transform;this.transform.as=n.map((e,t)=>{var n;return null!==(n=r[t])&&void 0!==n?n:e})}clone(){return new Rie(this.parent,v0(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return"FlattenTransform "+w0(this.transform)}assemble(){const{flatten:e,as:t}=this.transform;return{type:"flatten",fields:e,as:t}}}class Pie extends Tee{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=v0(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"key",null!==(i=a[1])&&void 0!==i?i:"value"]}clone(){return new Pie(null,v0(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return"FoldTransform "+w0(this.transform)}assemble(){const{fold:e,as:t}=this.transform;return{type:"fold",fields:e,as:t}}}class Lie extends Tee{constructor(e,t,n,r){super(e),this.fields=t,this.geojson=n,this.signal=r}clone(){return new Lie(null,v0(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const r of[[j1,N1],[R1,F1]]){const i=r.map(e=>{const n=t8(t.encoding[e]);return D6(n)?n.field:N6(n)?{expr:""+n.datum}:L6(n)?{expr:""+n.value}:void 0});(i[0]||i[1])&&(e=new Lie(e,i,null,t.getName("geojson_"+n++)))}if(t.channelHasField($1)){const r=t.typedFieldDef($1);r.type===Q3&&(e=new Lie(e,null,r.field,t.getName("geojson_"+n++)))}return e}dependentFields(){var e;const t=(null!==(e=this.fields)&&void 0!==e?e:[]).filter(bg);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${w0(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class Bie extends Tee{constructor(e,t,n,r){super(e),this.projection=t,this.fields=n,this.as=r}clone(){return new Bie(null,this.projection,v0(this.fields),v0(this.as))}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[[j1,N1],[R1,F1]]){const r=n.map(e=>{const n=t8(t.encoding[e]);return D6(n)?n.field:N6(n)?{expr:""+n.datum}:L6(n)?{expr:""+n.value}:void 0}),i=n[0]===R1?"2":"";(r[0]||r[1])&&(e=new Bie(e,t.projectionName(),r,[t.getName("x"+i),t.getName("y"+i)]))}return e}dependentFields(){return new Set(this.fields.filter(bg))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${w0(this.fields)} ${w0(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class $ie extends Tee{constructor(e,t){super(e),this.transform=t}clone(){return new $ie(null,v0(this.transform))}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:r}=e;return{signal:`sequence(${[t,n,...r?[r]:[]].join(",")})`}}static makeFromTransform(e,t){return new $ie(e,t)}static makeFromEncoding(e,t){const n=t.encoding,r=n.x,i=n.y;if(D6(r)&&D6(i)){const a=r.impute?r:i.impute?i:void 0;if(void 0===a)return;const o=r.impute?i:i.impute?r:void 0,{method:s,value:l,frame:u,keyvals:c}=a.impute,d=R8(t.mark,n);return new $ie(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:a.field,key:o.field},s?{method:s}:{}),void 0!==l?{value:l}:{}),u?{frame:u}:{}),void 0!==c?{keyvals:c}:{}),d.length?{groupby:d}:{}))}return null}hash(){return"Impute "+w0(this.transform)}assemble(){const{impute:e,key:t,keyvals:n,method:r,groupby:i,value:a,frame:o=[null,null]}=this.transform,s=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:e,key:t},n?{keyvals:(l=n,void 0!==(null==l?void 0:l.stop)?this.processSequence(n):n)}:{}),{method:"value"}),i?{groupby:i}:{}),{value:r&&"value"!==r?null:a});var l;return r&&"value"!==r?[s,Object.assign({type:"window",as:[`imputed_${e}_value`],ops:[r],fields:[e],frame:o,ignorePeers:!1},i?{groupby:i}:{}),{type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e}]:[s]}}class zie extends Tee{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=v0(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:t.on,null!==(i=a[1])&&void 0!==i?i:t.loess]}clone(){return new zie(null,v0(this.transform))}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"LoessTransform "+w0(this.transform)}assemble(){const e=this.transform,{loess:t,on:n}=e,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["loess","on"]);return Object.assign({type:"loess",x:n,y:t},r)}}class Uie extends Tee{constructor(e,t,n){super(e),this.transform=t,this.secondary=n}clone(){return new Uie(null,v0(this.transform),this.secondary)}static make(e,t,n,r){const i=t.component.data.sources,{from:a}=n;let o=null;if(function(e){return"data"in e}(a)){let e=nae(a.data,i);e||(e=new Dre(a.data),i.push(e));const n=t.getName("lookup_"+r);o=new Cee(e,n,N9.Lookup,t.component.data.outputNodeRefCounts),t.component.data.outputNodes[n]=o}else if(function(e){return"selection"in e}(a)){const e=a.selection;if(n=Object.assign({as:e},n),o=t.getSelectionComponent(B0(e),e).materialized,!o)throw new Error(y.noSameUnitLookup(e))}return new Uie(e,n,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?Ym(this.transform.as):this.transform.from.fields)}hash(){return"Lookup "+w0({transform:this.transform,secondary:this.secondary})}assemble(){let e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:Ym(this.transform.as)}:{});else{let t=this.transform.as;bg(t)||(p3(y.NO_FIELDS_NEEDS_AS),t="_lookup"),e={as:[t]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}class Hie extends Tee{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=v0(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"prob",null!==(i=a[1])&&void 0!==i?i:"value"]}clone(){return new Hie(null,v0(this.transform))}dependentFields(){var e;return new Set([this.transform.quantile,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"QuantileTransform "+w0(this.transform)}assemble(){const e=this.transform,{quantile:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["quantile"]);return Object.assign({type:"quantile",field:t},n)}}class Wie extends Tee{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=v0(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:t.on,null!==(i=a[1])&&void 0!==i?i:t.regression]}clone(){return new Wie(null,v0(this.transform))}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"RegressionTransform "+w0(this.transform)}assemble(){const e=this.transform,{regression:t,on:n}=e,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["regression","on"]);return Object.assign({type:"regression",x:n,y:t},r)}}class Vie extends Tee{constructor(e,t){super(e),this.transform=t}clone(){return new Vie(null,v0(this.transform))}addDimensions(e){var t;this.transform.groupby=I0((null!==(t=this.transform.groupby)&&void 0!==t?t:[]).concat(e),e=>e)}producedFields(){}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}hash(){return"PivotTransform "+w0(this.transform)}assemble(){const{pivot:e,value:t,groupby:n,limit:r,op:i}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:e,value:t},void 0!==r?{limit:r}:{}),void 0!==i?{op:i}:{}),void 0!==n?{groupby:n}:{})}}class qie extends Tee{constructor(e,t){super(e),this.transform=t}clone(){return new qie(null,v0(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return"SampleTransform "+w0(this.transform)}assemble(){return{type:"sample",size:this.transform.sample}}}function Gie(e){let t=0;return function n(r,i){var a;if(r instanceof Dre&&!r.isGenerator&&!T9(r.data)&&(e.push(i),i={name:null,source:i.name,transform:[]}),r instanceof Cre&&(r.parent instanceof Dre&&!i.source?(i.format=Object.assign(Object.assign({},null!==(a=i.format)&&void 0!==a?a:{}),{parse:r.assembleFormatParse()}),i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof Ere){i.name||(i.name="data_"+t++),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source;for(const t of r.assemble())e.push(t)}else switch((r instanceof Are||r instanceof Ore||r instanceof Fie||r instanceof fne||r instanceof One||r instanceof Bie||r instanceof Lie||r instanceof kre||r instanceof Uie||r instanceof Zre||r instanceof Xre||r instanceof Pie||r instanceof Rie||r instanceof jie||r instanceof zie||r instanceof Hie||r instanceof Wie||r instanceof Ire||r instanceof qie||r instanceof Vie)&&i.transform.push(r.assemble()),(r instanceof _re||r instanceof Aee||r instanceof $ie||r instanceof Kre)&&i.transform.push(...r.assemble()),r instanceof Cee&&(i.source&&0===i.transform.length?r.setSource(i.source):r.parent instanceof Cee?r.setSource(i.name):(i.name||(i.name="data_"+t++),r.setSource(i.name),1===r.numChildren()&&(e.push(i),i={name:null,source:i.name,transform:[]}))),r.numChildren()){case 0:r instanceof Cee&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name="data_"+t++);let a=i.name;!i.source||i.transform.length>0?e.push(i):a=i.source;for(const e of r.children)n(e,{name:null,source:a,transform:[]});break}}}}function Yie(e,t){var n;const{facet:r,config:i,child:a,component:o}=e;if(e.channelHasField(t)){const s=r[t],l=Nne("title",null,i,t);let u=K6(s,i,{allowDisabling:!0,includeDefault:void 0===l||!!l});a.component.layoutHeaders[t].title&&(u=km(u)?u.join(", "):u,u+=" / "+a.component.layoutHeaders[t].title,a.component.layoutHeaders[t].title=null);const c=Nne("labelOrient",s,i,t),d=K0((null!==(n=s.header)&&void 0!==n?n:{}).labels,i.header.labels,!0),h=k0(["bottom","right"],c)?"footer":"header";o.layoutHeaders[t]={title:u,facetFieldDef:s,[h]:"facet"===t?[]:[Xie(e,t,d)]}}}function Xie(e,t,n){const r="row"===t?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):void 0,axes:[]}}function Kie(e,t){var n;const{child:r}=e;if(r.component.axes[t]){const{layoutHeaders:a,resolve:o}=e.component;if(o.axis[t]=ere(o,t),"shared"===o.axis[t]){const o="x"===t?"column":"row",s=a[o];for(const a of r.component.axes[t]){const t="top"===(i=a.get("orient"))||"left"===i||O3(i)?"header":"footer";s[t]=null!==(n=s[t])&&void 0!==n?n:[Xie(e,o,!1)];const r=xne(a,"main",e.config,{header:!0});r&&s[t][0].axes.push(r),a.mainExtracted=!0}}}var i}function Zie(e){for(const t of e.children)t.parseLayoutSize()}function Jie(e,t){const n=Zne(t),r=I2(n),i=e.component.resolve,a=e.component.layoutSize;let o;for(const s of e.children){const e=s.component.layoutSize.getWithExplicit(n),t=i.scale[r];if("independent"===t&&"step"===e.value){o=void 0;break}if(o){if("independent"===t&&o.value!==e.value){o=void 0;break}o=E9(o,e,n,"")}else o=e}if(o){for(const r of e.children)e.renameSignal(r.getName(n),e.getName(t)),r.component.layoutSize.set(n,"merged",!1);a.setWithExplicit(t,o)}else a.setWithExplicit(t,{explicit:!1,value:void 0})}function Qie(e,t){const n=e.config,r=e.getScaleComponent("width"===t?"x":"y");if(r){const e=r.get("type"),i=r.get("range");if(p4(e)){const e=O7(n.view,t);return D3(i)||S7(e)?"step":e}return I7(n.view,t)}if(e.hasProjection||"arc"===e.mark)return I7(n.view,t);{const e=O7(n.view,t);return S7(e)?e.step:e}}function eae(e,t,n){return W6(t,Object.assign({suffix:"by_"+W6(e)},null!=n?n:{}))}class tae extends Nie{constructor(e,t,n,r){super(e,"facet",t,n,r,e.resolve),this.child=_ae(e.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(e.facet)}initFacet(e){if(!x6(e))return{facet:this.initFacetFieldDef(e,"facet")};const t=F0(e),n={};for(const r of t){if(!k0([_1,k1],r)){p3(y.incompatibleChannel(r,"facet"));break}const t=e[r];if(void 0===t.field){p3(y.emptyFieldDef(t,r));break}n[r]=this.initFacetFieldDef(t,r)}return n}initFacetFieldDef(e,t){const{header:n}=e,r=i8(function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["header"]),t);return n&&(r.header=S4(n)),r}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=rae(this),this.child.parseData()}parseLayoutSize(){Zie(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(e){for(const t of u2)Yie(e,t);Kie(e,"x"),Kie(e,"y")}(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){var e,t,n;const r={};for(const i of u2)for(const a of Rne){const o=this.component.layoutHeaders[i],s=o[a],{facetFieldDef:l}=o;if(l){const t=Nne("titleOrient",l.header,this.config,i);if(k0(["right","bottom"],t)){const n=Mne(i,t);r.titleAnchor=null!==(e=r.titleAnchor)&&void 0!==e?e:{},r.titleAnchor[n]="end"}}if(null==s?void 0:s[0]){const e="row"===i?"height":"width",s="header"===a?"headerBand":"footerBand";"facet"===i||this.child.component.layoutSize.get(e)||(r[s]=null!==(t=r[s])&&void 0!==t?t:{},r[s][i]=.5),o.title&&(r.offset=null!==(n=r.offset)&&void 0!==n?n:{},r.offset["row"===i?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let r="all";return(t||"independent"!==this.component.resolve.scale.x)&&(e||"independent"!==this.component.resolve.scale.y)||(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof tae))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(e){return this.parent&&this.parent instanceof tae?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:W6(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(e)):super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof tae){if(this.child.channelHasField("column")){const r=W6(this.child.facet.column);e.push(r),t.push("distinct"),n.push("distinct_"+r)}}else for(const r of E2){const i=this.child.component.scales[r];if(i&&!i.merged){const a=i.get("type"),o=i.get("range");if(p4(a)&&D3(o)){const i=die(hie(this.child,r));i?(e.push(i),t.push("distinct"),n.push("distinct_"+i)):p3(y.unknownField(r))}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:t}=this.component.data.facetRoot,{row:n,column:r}=this.facet,{fields:i,ops:a,as:o}=this.getCardinalityAggregateForChild(),s=[];for(const u of u2){const e=this.facet[u];if(e){s.push(W6(e));const{bin:t,sort:l}=e;if(L2(t)&&s.push(W6(e,{binSuffix:"end"})),y6(l)){const{field:t,op:s=p6}=l,u=eae(e,l);n&&r?(i.push(u),a.push("max"),o.push(u)):(i.push(t),a.push(s),o.push(u))}else if(km(l)){const t=Dne(e,u);i.push(t),a.push("max"),o.push(t)}}}const l=!!n&&!!r;return Object.assign({name:e,data:t,groupby:s},l||i.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),i.length?{fields:i,ops:a,as:o}:{})}:{})}facetSortFields(e){const{facet:t}=this,n=t[e];return n?y6(n.sort)?[eae(n,n.sort,{expr:"datum"})]:km(n.sort)?[Dne(n,e,{expr:"datum"})]:[W6(n,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:t}=this,n=t[e];if(n){const{sort:e}=n;return[(y6(e)?e.order:!km(e)&&e)||"ascending"]}return[]}assembleLabelTitle(){var e;const{facet:t,config:n}=this;if(t.facet)return Une(t.facet,"facet",n);const r={row:["top","bottom"],column:["left","right"]};for(const i of Fne)if(t[i]){const a=Nne("labelOrient",null===(e=t[i])||void 0===e?void 0:e.header,n,i);if(k0(r[i],a))return Une(t[i],i,n)}}assembleMarks(){const{child:e}=this,t=function(e){const t=[],n=Gie(t);for(const r of e.children)n(r,{source:e.name,name:null,transform:[]});return t}(this.component.data.facetRoot),n=e.assembleGroupEncodeEntry(!1),r=this.assembleLabelTitle()||e.assembleTitle(),i=e.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},r?{title:r}:{}),i?{style:i}:{}),{from:{facet:this.assembleFacet()},sort:{field:u2.map(e=>this.facetSortFields(e)).flat(),order:u2.map(e=>this.facetSortOrder(e)).flat()}}),t.length>0?{data:t}:{}),n?{encode:{update:n}}:{}),e.assembleGroup(function(e,t){if(e.component.selection&&F0(e.component.selection).length){const n=Cg(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:EK("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return Zee(t)}(this,[])))]}getMapping(){return this.facet}}function nae(e,t){var n,r,i,a;for(const o of t){const t=o.data;if(e.name&&o.hasName()&&e.name!==o.dataName)continue;const s=null===(n=e.format)||void 0===n?void 0:n.mesh,l=null===(r=t.format)||void 0===r?void 0:r.feature;if(s&&l)continue;const u=null===(i=e.format)||void 0===i?void 0:i.feature;if((u||l)&&u!==l)continue;const c=null===(a=t.format)||void 0===a?void 0:a.mesh;if(!s&&!c||s===c)if(C9(e)&&C9(t)){if(g0(e.values,t.values))return o}else if(T9(e)&&T9(t)){if(e.url===t.url)return o}else if(I9(e)&&e.name===o.dataName)return o}return null}function rae(e){var t,n,r,i,a,o,s,l,u,c;let d=function(e,t){if(e.data||!e.parent){if(null===e.data){const e=new Dre({values:[]});return t.push(e),e}const n=nae(e.data,t);if(n)return A9(e.data)||(n.data.format=T0({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const n=new Dre(e.data);return t.push(n),n}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}(e,e.component.data.sources);const{outputNodes:h,outputNodeRefCounts:f}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new S9,m=e.data;A9(m)?(O9(m)?d=new Ore(d,m.sequence):M9(m)&&(d=new Are(d,m.graticule)),p.parseNothing=!0):null===(null===(t=null==m?void 0:m.format)||void 0===t?void 0:t.parse)&&(p.parseNothing=!0),d=null!==(n=Cre.makeExplicit(d,e,p))&&void 0!==n?n:d,d=new Ire(d);const g=e.parent&&Die(e.parent);(Iie(e)||Aie(e))&&g&&(d=null!==(r=_re.makeFromEncoding(d,e))&&void 0!==r?r:d),e.transforms.length>0&&(d=function(e,t,n){var r,i;let a=0;for(const o of t.transforms){let s,l=void 0;if(V9(o))s=e=new One(e,o),l="derived";else if(j9(o)){const i=Tre(o);s=e=null!==(r=Cre.makeWithAncestors(e,{},i,n))&&void 0!==r?r:e,e=new fne(e,t,o.filter)}else if(q9(o))s=e=_re.makeFromTransform(e,o,t),l="number";else if(Y9(o))l="date",void 0===n.getWithExplicit(o.field).value&&(e=new Cre(e,{[o.field]:l}),n.set(o.field,l,!1)),s=e=Aee.makeFromTransform(e,o);else if(X9(o))s=e=kre.makeFromTransform(e,o),l="number",dte(t)&&(e=new Ire(e));else if(F9(o))s=e=Uie.make(e,t,o,a++),l="derived";else if(U9(o))s=e=new Zre(e,o),l="number";else if(H9(o))s=e=new Xre(e,o),l="number";else if(K9(o))s=e=Kre.makeFromTransform(e,o),l="derived";else if(Z9(o))s=e=new Pie(e,o),l="derived";else if(W9(o))s=e=new Rie(e,o),l="derived";else if(R9(o))s=e=new Vie(e,o),l="derived";else if(z9(o))e=new qie(e,o);else if(G9(o))s=e=$ie.makeFromTransform(e,o),l="derived";else if(P9(o))s=e=new jie(e,o),l="derived";else if(L9(o))s=e=new Hie(e,o),l="derived";else if(B9(o))s=e=new Wie(e,o),l="derived";else{if(!$9(o)){p3(y.invalidTransformIgnored(o));continue}s=e=new zie(e,o),l="derived"}if(s&&void 0!==l)for(const e of null!==(i=s.producedFields())&&void 0!==i?i:[])n.set(e,l,!1)}return e}(d,e,p));const v=function(e){const t={};if(Iie(e)&&e.component.selection)for(const n of F0(e.component.selection)){const r=e.component.selection[n];for(const e of r.project.items)!e.channel&&X0(e.field)>1&&(t[e.field]="flatten")}return t}(e),b=function(e){const t={};function n(e){var n;s8(e)?t[e.field]="date":"quantitative"===e.type&&bg(n=e.aggregate)&&k0(["min","max"],n)?t[e.field]="number":X0(e.field)>1?e.field in t||(t[e.field]="flatten"):B6(e)&&y6(e.sort)&&X0(e.sort.field)>1&&(e.sort.field in t||(t[e.sort.field]="flatten"))}if((Iie(e)||Aie(e))&&e.forEachFieldDef((t,r)=>{if(P6(t))n(t);else{const i=v2(r),a=e.fieldDef(i);n(Object.assign(Object.assign({},t),{type:a.type}))}}),Iie(e)){const{mark:n,markDef:r,encoding:i}=e;if(z4(n)&&!e.encoding.order){const e=i["horizontal"===r.orient?"y":"x"];D6(e)&&"quantitative"===e.type&&!(e.field in t)&&(t[e.field]="number")}}return t}(e);d=null!==(i=Cre.makeWithAncestors(d,{},Object.assign(Object.assign({},v),b),p))&&void 0!==i?i:d,Iie(e)&&(d=Lie.parseAll(d,e),d=Bie.parseAll(d,e)),(Iie(e)||Aie(e))&&(g||(d=null!==(a=_re.makeFromEncoding(d,e))&&void 0!==a?a:d),d=null!==(o=Aee.makeFromEncoding(d,e))&&void 0!==o?o:d,d=One.parseAllForSortIndex(d,e));const x=e.getDataName(N9.Raw),w=new Cee(d,x,N9.Raw,f);if(h[x]=w,d=w,Iie(e)){const t=kre.makeFromEncoding(d,e);t&&(d=t,dte(e)&&(d=new Ire(d))),d=null!==(s=$ie.makeFromEncoding(d,e))&&void 0!==s?s:d,d=null!==(l=Kre.makeFromEncoding(d,e))&&void 0!==l?l:d}Iie(e)&&(d=null!==(u=Fie.make(d,e))&&void 0!==u?u:d);const _=e.getDataName(N9.Main),k=new Cee(d,_,N9.Main,f);h[_]=k,d=k,Iie(e)&&function(e,t){ute(e,n=>{const r=n.name,i=e.getName("lookup_"+r);e.component.data.outputNodes[i]=n.materialized=new Cee(new fne(t,e,{selection:r}),i,N9.Lookup,e.component.data.outputNodeRefCounts)})}(e,k);let E=null;if(Aie(e)){const t=e.getName("facet");d=null!==(c=function(e,t){const{row:n,column:r}=t;if(n&&r){let t=null;for(const i of[n,r])if(y6(i.sort)){const{field:n,op:r=p6}=i.sort;e=t=new Xre(e,{joinaggregate:[{op:r,field:n,as:eae(i,i.sort,{forAs:!0})}],groupby:[W6(i)]})}return t}return null}(d,e.facet))&&void 0!==c?c:d,E=new Ere(d,e,t,k.getSource()),h[t]=E}return Object.assign(Object.assign({},e.component.data),{outputNodes:h,outputNodeRefCounts:f,raw:w,main:k,facetRoot:E,ancestorParse:p})}class iae extends Mie{constructor(e,t,n,r){var i,a,o,s;super(e,"concat",t,n,r,e.resolve),"shared"!==(null===(a=null===(i=e.resolve)||void 0===i?void 0:i.axis)||void 0===a?void 0:a.x)&&"shared"!==(null===(s=null===(o=e.resolve)||void 0===o?void 0:o.axis)||void 0===s?void 0:s.y)||p3(y.CONCAT_CANNOT_SHARE_AXIS),this.children=this.getChildren(e).map((e,t)=>_ae(e,this,this.getName("concat_"+t),void 0,r))}parseData(){this.component.data=rae(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of F0(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return k7(e)?e.vconcat:E7(e)?e.hconcat:e.concat}parseLayoutSize(){!function(e){Zie(e);const t=void 0===e.layout.columns?"height":"childHeight";Jie(e,1===e.layout.columns?"width":"childWidth"),Jie(e,t)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce((e,t)=>t.assembleSelectionTopLevelSignals(e),e)}assembleSignals(){return this.children.forEach(e=>e.assembleSignals()),[]}assembleLayoutSignals(){const e=Gne(this);for(const t of this.children)e.push(...t.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce((e,t)=>t.assembleSelectionData(e),e)}assembleMarks(){return this.children.map(e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),r=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),r?{encode:{update:r}}:{}),e.assembleGroup())})}assembleDefaultLayout(){const e=this.layout.columns;return Object.assign(Object.assign({},null!=e?{columns:e}:{}),{bounds:"full",align:"each"})}}const aae=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},l1),{labelExpr:1,encode:1}),oae=F0(aae);class sae extends b9{constructor(e={},t={},n=!1){super(),this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new sae(v0(this.explicit),v0(this.implicit),this.mainExtracted)}hasAxisPart(e){return!("axis"!==e&&("grid"===e||"title"===e?!this.get(e):!1===(t=this.get(e))||null===t));var t}hasOrientSignalRef(){return O3(this.explicit.orient)}}const lae={bottom:"top",top:"bottom",left:"right",right:"left"};function uae(e,t){if(!e)return t.map(e=>e.clone());{if(e.length!==t.length)return;const n=e.length;for(let r=0;r<n;r++){const n=e[r],i=t[r];if(!!n!=!!i)return;if(n&&i){const t=n.getWithExplicit("orient"),a=i.getWithExplicit("orient");if(t.explicit&&a.explicit&&t.value!==a.value)return;e[r]=cae(n,i)}}}return e}function cae(e,t){for(const n of oae){const r=E9(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(e,t)=>{switch(n){case"title":return I8(e,t);case"gridScale":return{explicit:e.explicit,value:K0(e.value,t.value)}}return k9(e,t,n,"axis")});e.setWithExplicit(n,r)}return e}function dae(e,t,n,r,i){if("disable"===t)return void 0!==n;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(O3(n.labelAngle)?n.labelAngle:n1(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===Ane(r,i))return!0}return e===n[t]}const hae=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function fae(e,t){var n,r,i;let a=t.axis(e);const o=new sae,s=t8(t.encoding[e]),{mark:l,config:u}=t,c=(null==a?void 0:a.orient)||(null===(n=u["x"===e?"axisX":"axisY"])||void 0===n?void 0:n.orient)||(null===(r=u.axis)||void 0===r?void 0:r.orient)||function(e){return"x"===e?"bottom":"left"}(e),d=t.getScaleComponent(e).get("type"),h=function(e,t,n,r){const i="band"===t?["axisDiscrete","axisBand"]:"point"===t?["axisDiscrete","axisPoint"]:t in c4?["axisQuantitative"]:"time"===t||"utc"===t?["axisTemporal"]:[],a="x"===e?"axisX":"axisY",o=O3(n)?"axisOrient":"axis"+U0(n),s=[...i,...i.map(e=>a+e.substr(4))],l=["axis",o,a];return{vlOnlyAxisConfig:_ne(s,r,e,n),vgAxisConfig:_ne(l,r,e,n),axisConfigStyle:kne([...l,...s],r)}}(e,d,c,t.config),f=void 0!==a?!a:Ene("disable",u.style,null==a?void 0:a.style,h).configValue;if(o.set("disable",f,void 0!==a),f)return o;a=a||{};const p=function(e,t,n,r,i){const a=null==t?void 0:t.labelAngle;if(void 0!==a)return O3(a)?a:n1(a);{const{configValue:a}=Ene("labelAngle",r,null==t?void 0:t.style,i);return void 0!==a?n1(a):n!==S1||!k0([J3,K3],e.type)||D6(e)&&e.timeUnit?void 0:270}}(s,a,e,u.style,h),m={fieldOrDatumDef:s,axis:a,channel:e,model:t,scaleType:d,orient:c,labelAngle:p,mark:l,config:u};for(const y of oae){const n=y in Sne?Sne[y](m):c1(y)?a[y]:void 0,r=void 0!==n,i=dae(n,y,a,t,e);if(r&&i)o.set(y,n,i);else{const{configValue:e,configFrom:t}=c1(y)&&"values"!==y?Ene(y,u.style,a.style,h):{},s=void 0!==e;r&&!s?o.set(y,n,i):("vgAxisConfig"!==t||hae.has(y)&&s||a1(e)||O3(e))&&o.set(y,e,!1)}}const g=null!==(i=a.encoding)&&void 0!==i?i:{},v=o1.reduce((n,r)=>{var i;if(!o.hasAxisPart(r))return n;const a=Jne(null!==(i=g[r])&&void 0!==i?i:{},t),s="labels"===r?function(e,t,n){var r;const{encoding:i,config:a}=e,o=null!==(r=t8(i[t]))&&void 0!==r?r:t8(i[b2(t)]),s=e.axis(t)||{},{format:l,formatType:u}=s;return r6(u)?Object.assign({text:s6({fieldOrDatumDef:o,field:"datum.value",format:l,formatType:u,config:a})},n):n}(t,e,a):a;return void 0===s||j0(s)||(n[r]={update:s}),n},{});return j0(v)||o.set("encode",v,!!a.encoding||void 0!==a.labelAngle),o}function pae(e,t){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},xee(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),see("x",e,{defaultPos:"mid"})),see("y",e,{defaultPos:"mid"})),iee("size",e)),iee("angle",e)),function(e,t,n){return n?{shape:{value:n}}:iee("shape",e)}(e,0,t))}function mae(e){var t;const{config:n,markDef:r}=e,{orient:i}=r,a="horizontal"===i?"width":"height",o=e.getScaleComponent("horizontal"===i?"x":"y"),s=null!==(t=w8("size",r,n,{vgChannel:a}))&&void 0!==t?t:n.tick.bandSize;if(void 0!==s)return s;{const e=o?o.get("range"):void 0;return e&&D3(e)&&vg(e.step)?3*e.step/4:3*A7(n.view,a)/4}}const gae={arc:{vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},xee(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),see("x",e,{defaultPos:"mid"})),see("y",e,{defaultPos:"mid"})),mee(e,"radius","arc")),mee(e,"theta","arc"))},area:{vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},xee(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),hee("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===e.markDef.orient})),hee("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===e.markDef.orient})),_ee(e))},bar:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},xee(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),mee(e,"x","bar")),mee(e,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:e=>pae(e,"circle")},geoshape:{vgMark:"shape",encodeEntry:e=>Object.assign({},xee(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&D6(n)&&n.type===Q3?{field:W6(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},xee(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),mee(e,"x","image")),mee(e,"y","image")),Q9(e,"url"))},line:{vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},xee(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),see("x",e,{defaultPos:"mid"})),see("y",e,{defaultPos:"mid"})),iee("size",e,{vgChannel:"strokeWidth"})),_ee(e))},point:{vgMark:"symbol",encodeEntry:e=>pae(e)},rect:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},xee(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),mee(e,"x","rect")),mee(e,"y","rect"))},rule:{vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},xee(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),hee("x",e,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n})),hee("y",e,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n})),iee("size",e,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:e=>pae(e,"square")},text:{vgMark:"text",encodeEntry:e=>{const{config:t}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},xee(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),see("x",e,{defaultPos:"mid"})),see("y",e,{defaultPos:"mid"})),Q9(e)),iee("size",e,{vgChannel:"fontSize"})),iee("angle",e)),kee("align",function(e,t,n){if(void 0===w8("align",e,n))return"center"}(e.markDef,0,t))),kee("baseline",function(e,t,n){if(void 0===w8("baseline",e,n))return"middle"}(e.markDef,0,t))),see("radius",e,{defaultPos:null,isMidPoint:!0})),see("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,r=n.orient,i="horizontal"===r?"width":"height",a="horizontal"===r?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},xee(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),see("x",e,{defaultPos:"mid",vgChannel:"xc"})),see("y",e,{defaultPos:"mid",vgChannel:"yc"})),iee("size",e,{defaultValue:mae(e),vgChannel:i})),{[a]:v8(w8("thickness",n,t))})}},trail:{vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},xee(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),see("x",e,{defaultPos:"mid"})),see("y",e,{defaultPos:"mid"})),iee("size",e)),_ee(e))}},vae="faceted_path_",yae="stack_group_";function bae(e,t={fromPrefix:""}){const{mark:n,markDef:r,encoding:i,config:a}=e,o=K0(r.clip,function(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return!!(t&&t.get("selectionExtent")||n&&n.get("selectionExtent"))||void 0}(e),function(e){const t=e.component.projection;return!(!t||t.isFit)||void 0}(e)),s=x8(r),l=i.key,u=function(e){const{encoding:t,stack:n,mark:r,markDef:i,config:a}=e,o=t.order;if(!(!km(o)&&L6(o)&&_0(o.value)||!o&&_0(w8("order",i,a)))){if((km(o)||D6(o))&&!n)return S8(o,{expr:"datum"});if(z4(r)){const n="horizontal"===i.orient?"y":"x",r=t[n];if(D6(r)){const t=r.sort;return km(t)?{field:W6(r,{prefix:n,suffix:"sort_index",expr:"datum"})}:y6(t)?{field:W6({aggregate:M8(e.encoding)?t.op:void 0,field:t.field},{expr:"datum"})}:v6(t)?{field:W6(e.fieldDef(t.encoding),{expr:"datum"}),order:t.order}:null===t?void 0:{field:W6(r,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}}}}(e),c=function(e){if(!e.component.selection)return null;const t=F0(e.component.selection).length;let n=t,r=e.parent;for(;r&&0===n;)n=F0(r.component.selection).length,r=r.parent;return n?{interactive:t>0||!!e.encoding.tooltip}:null}(e),d=w8("aria",r,a),h=gae[n].postEncodingTransform?gae[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:gae[n].vgMark},o?{clip:!0}:{}),s?{style:s}:{}),l?{key:l.field}:{}),u?{sort:u}:{}),c||{}),!1===d?{aria:d}:{}),{from:{data:t.fromPrefix+e.requestDataName(N9.Main)},encode:{update:gae[n].encodeEntry(e)}}),h?{transform:h}:{})]}class xae extends Nie{constructor(e,t,n,r={},i){super(e,"unit",t,n,i,void 0,T7(e)?e.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const a=W4(e.mark)?Object.assign({},e.mark):{type:e.mark},o=a.type;void 0===a.filled&&(a.filled=function(e,t,{graticule:n}){if(n)return!1;const r=_8("filled",e,t),i=e.type;return K0(r,i!==M4&&i!==D4&&i!==j4)}(a,i,{graticule:e.data&&M9(e.data)}));const s=this.encoding=function(e,t,n,r){return F0(e).reduce((i,a)=>{if(!p2(a))return p3(y.invalidEncodingChannel(a)),i;const o=e[a];if("angle"!==a||"arc"!==t||e.theta||(p3(y.REPLACE_ANGLE_WITH_THETA),a=D1),!function(e,t,n){const r=function(e,t){return function(e){switch(e){case P1:case L1:case B1:case t2:case K1:case Z1:case J1:case Q1:case X1:case H1:case W1:case V1:case q1:case E1:case _1:case k1:return j2;case S1:case T1:case N1:case j1:return F2;case C1:case I1:case F1:case R1:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case z1:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case G1:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case $1:return{point:"always",geoshape:"always"};case Y1:return{text:"always"};case U1:return{point:"always",square:"always",text:"always"};case e2:return{image:"always"};case D1:case A1:return{text:"always",arc:"always"};case M1:case O1:return{arc:"always"}}}(e)[t]}(t,n);if(!r)return!1;if("binned"===r){const n=e[t===C1?S1:T1];return!!(D6(n)&&D6(e[t])&&B2(n.bin))}return!0}(e,a,t))return p3(y.incompatibleChannel(a,t)),i;if(a===z1&&"line"===t){const t=e8(e[a]);if(null==t?void 0:t.aggregate)return p3(y.LINE_WITH_VARYING_SIZE),i}if(a===P1&&(n?"fill"in e:"stroke"in e))return p3(y.droppingColor("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;if(a===K1||a===X1&&!km(o)&&!L6(o)||a===J1&&km(o))o&&(i[a]=Ym(o).reduce((e,t)=>(D6(t)?e.push(i8(t,a)):p3(y.emptyFieldDef(t,a)),e),[]));else{if(a===J1&&null===o)i[a]=null;else if(!(D6(o)||N6(o)||L6(o)||I6(o)||O3(o)))return p3(y.emptyFieldDef(o,a)),i;i[a]=n8(o,a,r)}return i},{})}(e.encoding||{},o,a.filled,i);this.markDef=function(e,t,n){const r=S4(e),i=w8("orient",r,n);if(r.orient=function(e,t,n){switch(e){case M4:case L4:case B4:case F4:case N4:case O4:return}const{x:r,y:i,x2:a,y2:o}=t;switch(e){case A4:if(D6(r)&&(B2(r.bin)||D6(i)&&i.aggregate&&!r.aggregate))return"vertical";if(D6(i)&&(B2(i.bin)||D6(r)&&r.aggregate&&!i.aggregate))return"horizontal";if(o||a){if(n)return n;if(!a&&(D6(r)&&r.type===X3&&!L2(r.bin)||F6(r)))return"horizontal";if(!o&&(D6(i)&&i.type===X3&&!L2(i.bin)||F6(i)))return"vertical"}case j4:if(a&&(!D6(r)||!B2(r.bin))&&o&&(!D6(i)||!B2(i.bin)))return;case I4:if(o)return D6(i)&&B2(i.bin)?"horizontal":"vertical";if(a)return D6(r)&&B2(r.bin)?"vertical":"horizontal";if(e===j4){if(r&&!i)return"vertical";if(i&&!r)return"horizontal"}case D4:case R4:{const t=j6(r),a=j6(i);if(t&&!a)return"tick"!==e?"horizontal":"vertical";if(!t&&a)return"tick"!==e?"vertical":"horizontal";if(t&&a){const t=r,a=i,o=t.type===Z3,s=a.type===Z3;return o&&!s?"tick"!==e?"vertical":"horizontal":!o&&s?"tick"!==e?"horizontal":"vertical":!t.aggregate&&a.aggregate?"tick"!==e?"vertical":"horizontal":t.aggregate&&!a.aggregate?"tick"!==e?"horizontal":"vertical":n||"vertical"}return n||void 0}}return"vertical"}(r.type,t,i),void 0!==i&&i!==r.orient&&p3(y.orientOverridden(r.orient,i)),"bar"===r.type&&r.orient){const e=w8("cornerRadiusEnd",r,n);if(void 0!==e){const n="horizontal"===r.orient&&t.x2||"vertical"===r.orient&&t.y2?["cornerRadius"]:Y4[r.orient];for(const t of n)r[t]=e;void 0!==r.cornerRadiusEnd&&delete r.cornerRadiusEnd}}return void 0===w8("opacity",r,n)&&(r.opacity=function(e,t){if(k0([M4,R4,L4,B4],e)&&!M8(t))return.7}(r.type,t)),void 0===w8("cursor",r,n)&&(r.cursor=function(e,t,n){return t.href||e.href||w8("href",e,n)?"pointer":e.cursor}(r,t,n)),r}(a,s,i),this.size=function({encoding:e,size:t}){for(const n of E2){const r=x2(n);S7(t[r])&&j6(e[n])&&(delete t[r],p3(y.stepDropped(r)))}return t}({encoding:s,size:T7(e)?Object.assign(Object.assign(Object.assign({},r),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):r}),this.stack=Y7(o,s),this.specifiedScales=this.initScales(o,s),this.specifiedAxes=this.initAxes(s),this.specifiedLegends=this.initLegends(s),this.specifiedProjection=e.projection,this.selection=e.selection}get hasProjection(){const{encoding:e}=this,t=this.mark===$4,n=e&&a2.some(t=>R6(e[t]));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return M2.reduce((e,n)=>{var r;const i=t8(t[n]);return i&&(e[n]=this.initScale(null!==(r=i.scale)&&void 0!==r?r:{})),e},{})}initScale(e){const{domain:t,range:n}=e,r=S4(e);return km(t)&&(r.domain=t.map(m8)),km(n)&&(r.range=n.map(m8)),r}initAxes(e){return E2.reduce((t,n)=>{const r=e[n];if(R6(r)||n===S1&&R6(e.x2)||n===T1&&R6(e.y2)){const e=R6(r)?r.axis:void 0;t[n]=e?this.initAxis(Object.assign({},e)):e}return t},{})}initAxis(e){const t=F0(e),n={};for(const r of t){const t=e[r];n[r]=a1(t)?p8(t):m8(t)}return n}initLegends(e){return O2.reduce((t,n)=>{const r=t8(e[n]);if(r&&function(e){switch(e){case P1:case L1:case B1:case z1:case $1:case H1:case q1:case G1:return!0;case W1:case V1:case U1:return!1}}(n)){const e=r.legend;t[n]=e?S4(e):e}return t},{})}parseData(){this.component.data=rae(this)}parseLayoutSize(){!function(e){const{size:t,component:n}=e;for(const r of E2){const i=x2(r);if(t[i]){const e=t[i];n.layoutSize.set(i,S7(e)?"step":e,!0)}else{const t=Qie(e,i);n.layoutSize.set(i,t,!1)}}}(this)}parseSelections(){this.component.selection=function(e,t){var n;const r={},i=e.config.selection;for(const a of F0(null!=t?t:{})){const o=v0(t[a]),s=pne(i[o.type],["fields","encodings"]);for(const e in s)"encodings"===e&&o.fields||"fields"===e&&o.encodings||("mark"===e&&(o[e]=Object.assign(Object.assign({},s[e]),o[e])),void 0!==o[e]&&!0!==o[e]||(o[e]=null!==(n=s[e])&&void 0!==n?n:o[e]));const l=B0(a),u=r[l]=Object.assign(Object.assign({},o),{name:l,events:bg(o.on)?EK(o.on,"scope"):v0(o.on)});Yee(u,n=>{n.has(u)&&n.parse&&n.parse(e,u,o,t[a])})}return r}(this,this.selection)}parseMarkGroup(){this.component.mark=function(e){if(k0([D4,I4,P4],e.mark)){const t=R8(e.mark,e.encoding);if(t.length>0)return function(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:vae+e.requestDataName(N9.Main),data:e.requestDataName(N9.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:bae(e,{fromPrefix:vae})}]}(e,t)}else if(k0([A4],e.mark)){const t=F3.some(t=>w8(t,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return function(e){const[t]=bae(e,{fromPrefix:yae}),n=e.scaleName(e.stack.fieldChannel),r=(t={})=>e.vgField(e.stack.fieldChannel,t),i=(e,t)=>`${e}(${[r({prefix:"min",suffix:"start",expr:t}),r({prefix:"max",suffix:"start",expr:t}),r({prefix:"min",suffix:"end",expr:t}),r({prefix:"max",suffix:"end",expr:t})].map(e=>`scale('${n}',${e})`).join(",")})`;let a,o;"x"===e.stack.fieldChannel?(a=Object.assign(Object.assign({},y0(t.encode.update,["y","yc","y2","height",...F3])),{x:{signal:i("min","datum")},x2:{signal:i("max","datum")},clip:{value:!0}}),o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},b0(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(a=Object.assign(Object.assign({},y0(t.encode.update,["x","xc","x2","width"])),{y:{signal:i("min","datum")},y2:{signal:i("max","datum")},clip:{value:!0}}),o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},b0(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const u of F3){const n=_8(u,e.markDef,e.config);t.encode.update[u]?(a[u]=t.encode.update[u],delete t.encode.update[u]):n&&(a[u]=v8(n)),n&&(t.encode.update[u]={value:0})}const s=e.fieldDef(e.stack.groupbyChannel),l=W6(s)?[W6(s)]:[];return((null==s?void 0:s.bin)||(null==s?void 0:s.timeUnit))&&l.push(W6(s,{binSuffix:"end"})),a=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((n,r)=>{if(t.encode.update[r])return Object.assign(Object.assign({},n),{[r]:t.encode.update[r]});{const t=_8(r,e.markDef,e.config);return void 0!==t?Object.assign(Object.assign({},n),{[r]:v8(t)}):n}},a),a.stroke&&(a.strokeForeground={value:!0},a.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(N9.Main),name:yae+e.requestDataName(N9.Main),groupby:l,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:a},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}(e)}return bae(e)}(this)}parseAxesAndHeaders(){var e;this.component.axes=(e=this,E2.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[fae(n,e)]),t),{}))}assembleSelectionTopLevelSignals(e){return function(e,t){let n=!1;return ute(e,(r,i)=>{const a=r.name,o=Cg(a+ate);if(0===t.filter(e=>e.name===a).length){const e="multi"===r.type?", true)":")";t.push({name:r.name,update:`${ste}(${o}, ${Cg("global"===r.resolve?"union":r.resolve)}${e}`})}n=!0,i.topLevelSignals&&(t=i.topLevelSignals(e,r,t)),Yee(r,n=>{n.topLevelSignals&&(t=n.topLevelSignals(e,r,t))})}),n&&0===t.filter(e=>"unit"===e.name).length&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),Zee(t)}(this,e)}assembleSignals(){return[...wne(this),...(e=this,t=[],ute(e,(n,r)=>{const i=n.name;let a=r.modifyExpr(e,n);t.push(...r.signals(e,n)),Yee(n,r=>{r.signals&&(t=r.signals(e,n,t)),r.modifyExpr&&(a=r.modifyExpr(e,n,a))}),t.push({name:i+"_modify",on:[{events:{signal:n.name+ote},update:`modify(${Cg(n.name+ate)}, ${a})`}]})}),Zee(t))];var e,t}assembleSelectionData(e){return function(e,t){const n=[...t];return ute(e,t=>{const r={name:t.name+ate};if(t.init){const n=t.project.items.map(e=>function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["signals"])),i=t.init.map(e=>Xee(e,!1));r.values="interval"===t.type?[{unit:cte(e,{escape:!1}),fields:n,values:i}]:i.map(t=>({unit:cte(e,{escape:!1}),fields:n,values:t}))}n.filter(e=>e.name===t.name+ate).length||n.push(r)}),n}(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return Gne(this)}assembleMarks(){var e;let t=null!==(e=this.component.mark)&&void 0!==e?e:[];return this.parent&&Die(this.parent)||(t=Kee(this,t)),t.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return D8(this.encoding,e)}fieldDef(e){return e8(this.encoding[e])}typedFieldDef(e){const t=this.fieldDef(e);return P6(t)?t:null}}class wae extends Mie{constructor(e,t,n,r,i){super(e,"layer",t,n,i,e.resolve,e.view);const a=Object.assign(Object.assign(Object.assign({},r),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});this.children=e.layer.map((e,t)=>{if(H7(e))return new wae(e,this,this.getName("layer_"+t),a,i);if(A8(e))return new xae(e,this,this.getName("layer_"+t),a,i);throw new Error(y.invalidSpec(e))})}parseData(){this.component.data=rae(this);for(const e of this.children)e.parseData()}parseLayoutSize(){Zie(this),Jie(this,"width"),Jie(this,"height")}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of F0(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){!function(e){var t;const{axes:n,resolve:r}=e.component,i={top:0,bottom:0,right:0,left:0};for(const a of e.children){a.parseAxesAndHeaders();for(const t of F0(a.component.axes))r.axis[t]=ere(e.component.resolve,t),"shared"===r.axis[t]&&(n[t]=uae(n[t],a.component.axes[t]),n[t]||(r.axis[t]="independent",delete n[t]))}for(const a of E2){for(const o of e.children)if(o.component.axes[a]){if("independent"===r.axis[a]){n[a]=(null!==(t=n[a])&&void 0!==t?t:[]).concat(o.component.axes[a]);for(const e of o.component.axes[a]){const{value:t,explicit:n}=e.getWithExplicit("orient");if(!O3(t)){if(i[t]>0&&!n){const n=lae[t];i[t]>i[n]&&e.set("orient",n,!1)}i[t]++}}}delete o.component.axes[a]}if("independent"===r.axis[a]&&n[a]&&n[a].length>1)for(const e of n[a])e.get("grid")&&!e.explicit.grid&&(e.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce((e,t)=>t.assembleSelectionTopLevelSignals(e),e)}assembleSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleSignals()),wne(this))}assembleLayoutSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleLayoutSignals()),Gne(this))}assembleSelectionData(e){return this.children.reduce((e,t)=>t.assembleSelectionData(e),e)}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e}assembleLayout(){return null}assembleMarks(){return function(e,t){for(const n of e.children)Iie(n)&&(t=Kee(n,t));return t}(this,this.children.flatMap(e=>e.assembleMarks()))}assembleLegends(){return this.children.reduce((e,t)=>e.concat(t.assembleLegends()),mre(this))}}function _ae(e,t,n,r,i){if(_6(e))return new tae(e,t,n,i);if(H7(e))return new wae(e,t,n,r,i);if(A8(e))return new xae(e,t,n,r,i);if(function(e){return k7(e)||E7(e)||_7(e)}(e))return new iae(e,t,n,i);throw new Error(y.invalidSpec(e))}function kae(e,t={}){t.logger&&(f3=t.logger),t.fieldTitle&&X6(t.fieldTitle);try{const n=L7(Tm(t.config,e.config)),r=p9(e,n),i=_ae(r,null,"",void 0,n);return i.parse(),function(e,t){eie(e.sources);let n=0,r=0;for(let i=0;i<5&&nie(e,t,!0);i++)n++;e.sources.map(Jre);for(let i=0;i<5&&nie(e,t,!1);i++)r++;eie(e.sources),5===Math.max(n,r)&&p3("Maximum optimization runs(5) reached.")}(i.component.data,i),{spec:function(e,t,n={},r){const i=e.config?function(e){e=v0(e);for(const t of $7)delete e[t];if(e.axis)for(const t in e.axis)a1(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of l7)delete e.legend[t];if(e.mark){for(const t of q4)delete e.mark[t];e.mark.tooltip&&Em(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(v7(e.params)),delete e.params);for(const t of B7){for(const r of q4)delete e[t][r];const n=z7[t];if(n)for(const r of n)delete e[t][r];U7(e,t)}for(const t of F0(o7))delete e[t];!function(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:r}=d8(e.title);j0(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),j0(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),j0(r)?delete e.title:e.title=r}(e);for(const t in e)Em(e[t])&&j0(e[t])&&delete e[t];return j0(e)?void 0:e}(e.config):void 0,a=[].concat(e.assembleSelectionData([]),function(e,t){var n,r;const i=[],a=Gie(i);let o=0;for(const l of e.sources){l.hasName()||(l.dataName="source_"+o++);const e=l.assemble();a(l,e)}for(const l of i)0===l.transform.length&&delete l.transform;let s=0;for(const[l,u]of i.entries())0!==(null!==(n=u.transform)&&void 0!==n?n:[]).length||u.source||i.splice(s++,0,i.splice(l,1)[0]);for(const l of i)for(const t of null!==(r=l.transform)&&void 0!==r?r:[])"lookup"===t.type&&(t.from=e.outputNodes[t.from].getSource());for(const l of i)l.name in t&&(l.values=t[l.name]);return i}(e.component.data,n)),o=e.assembleProjections(),s=e.assembleTitle(),l=e.assembleGroupStyle(),u=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();c=c.filter(e=>"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1));const{params:d}=t,h=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(t,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),h),s?{title:s}:{}),l?{style:l}:{}),u?{encode:{update:u}}:{}),{data:a}),o.length>0?{projections:o}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([]),...v7(d)])),i?{config:i}:{}),r?{usermeta:r}:{})}(i,function(e,t,n,r){const i=r.component.layoutSize.get("width"),a=r.component.layoutSize.get("height");if(void 0===t?(t={type:"pad"},r.hasAxisOrientSignalRef()&&(t.resize=!0)):bg(t)&&(t={type:t}),i&&a&&("fit"===(o=t.type)||"fit-x"===o||"fit-y"===o))if("step"===i&&"step"===a)p3(y.droppingFit()),t.type="pad";else if("step"===i||"step"===a){const e="step"===i?"width":"height";p3(y.droppingFit(I2(e))),t.type=function(e){return e?"fit-"+I2(e):"fit"}("width"===e?"height":"width")}var o;return Object.assign(Object.assign(Object.assign({},1===F0(t).length&&t.type?"pad"===t.type?{}:{autosize:t.type}:{autosize:t}),y9(n,!1)),y9(e,!0))}(e,r.autosize,n,i),e.datasets,e.usermeta),normalized:r}}finally{t.logger&&(f3=h3),t.fieldTitle&&X6(G6)}}var Eae=function(e){const[t,n]=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}};const Sae="#fff",Tae={background:"#333",title:{color:Sae},style:{"guide-label":{fill:Sae},"guide-title":{fill:Sae}},axis:{domainColor:Sae,gridColor:"#888",tickColor:Sae}},Cae="#4572a7",Iae={background:"#fff",arc:{fill:Cae},area:{fill:Cae},line:{stroke:Cae,strokeWidth:2},path:{stroke:Cae},rect:{fill:Cae},shape:{stroke:Cae},symbol:{fill:Cae,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},Aae="#30a2da",Oae="#cbcbcb",Dae="#f0f0f0",Mae="#333",Nae={arc:{fill:Aae},area:{fill:Aae},axis:{domainColor:Oae,grid:!0,gridColor:Oae,gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:Oae,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:Dae,group:{fill:Dae},legend:{labelColor:Mae,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:Mae,titleFontSize:14,titlePadding:10},line:{stroke:Aae,strokeWidth:2},path:{stroke:Aae,strokeWidth:.5},rect:{fill:Aae},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:Aae},bar:{binSpacing:2,fill:Aae,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},jae="#000",Fae={group:{fill:"#e5e5e5"},arc:{fill:jae},area:{fill:jae},line:{stroke:jae},path:{stroke:jae},rect:{fill:jae},shape:{stroke:jae},symbol:{fill:jae,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},Rae="Benton Gothic, sans-serif",Pae="#82c6df",Lae="Benton Gothic Bold, sans-serif",Bae="normal",$ae={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},zae={background:"#ffffff",title:{anchor:"start",color:"#000000",font:Lae,fontSize:22,fontWeight:"normal"},arc:{fill:Pae},area:{fill:Pae},line:{stroke:Pae,strokeWidth:2},path:{stroke:Pae},rect:{fill:Pae},shape:{stroke:Pae},symbol:{fill:Pae,size:30},axis:{labelFont:Rae,labelFontSize:11.5,labelFontWeight:"normal",titleFont:Lae,titleFontSize:13,titleFontWeight:Bae},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:Rae,labelFontSize:11.5,symbolType:"square",titleFont:Lae,titleFontSize:13,titleFontWeight:Bae},range:{category:$ae["category-6"],diverging:$ae["fireandice-6"],heatmap:$ae["fire-7"],ordinal:$ae["fire-7"],ramp:$ae["fire-7"]}},Uae="#ab5787",Hae="#979797",Wae={background:"#f9f9f9",arc:{fill:Uae},area:{fill:Uae},line:{stroke:Uae},path:{stroke:Uae},rect:{fill:Uae},shape:{stroke:Uae},symbol:{fill:Uae,size:30},axis:{domainColor:Hae,domainWidth:.5,gridWidth:.2,labelColor:Hae,tickColor:Hae,tickWidth:.2,titleColor:Hae},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},Vae="#3e5c69",qae={background:"#fff",arc:{fill:Vae},area:{fill:Vae},line:{stroke:Vae},path:{stroke:Vae},rect:{fill:Vae},shape:{stroke:Vae},symbol:{fill:Vae},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},Gae="#1696d2",Yae="#000000",Xae="Lato",Kae="Lato",Zae={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},Jae={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:Xae},axisX:{domain:!0,domainColor:Yae,domainWidth:1,grid:!1,labelFontSize:12,labelFont:Kae,labelAngle:0,tickColor:Yae,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:Xae},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:Kae,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:Xae,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:Kae,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:Xae,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:Zae["six-groups-cat-1"],diverging:Zae["diverging-colors"],heatmap:Zae["diverging-colors"],ordinal:Zae["six-groups-seq"],ramp:Zae["shades-blue"]},area:{fill:Gae},rect:{fill:Gae},line:{color:Gae,stroke:Gae,strokeWidth:5},trail:{color:Gae,stroke:Gae,strokeWidth:0,size:1},path:{stroke:Gae,strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:Gae,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:Gae,stroke:null}},arc:{fill:Gae},shape:{stroke:Gae},symbol:{fill:Gae,size:30}},Qae="#3366CC",eoe="#ccc",toe="Arial, sans-serif",noe={arc:{fill:Qae},area:{fill:Qae},path:{stroke:Qae},rect:{fill:Qae},shape:{stroke:Qae},symbol:{stroke:Qae},circle:{fill:Qae},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:toe,fontSize:12},"guide-title":{font:toe,fontSize:12},"group-title":{font:toe,fontSize:12}},title:{font:toe,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:eoe,tickColor:eoe,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},roe="2.9.1",ioe="vg-tooltip-element",aoe={offsetX:10,offsetY:10,id:ioe,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function ooe(e,t){return JSON.stringify(e,function(e){const t=[];return function(n,r){if("object"!=typeof r||null===r)return r;const i=t.indexOf(this)+1;return t.length=i,t.length>e?"[Object]":t.indexOf(r)>=0?"[Circular]":(t.push(r),r)}}(t))}class soe{constructor(e){this.options=Object.assign(Object.assign({},aoe),e);const t=this.options.id;if(this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const e=document.createElement("style");e.setAttribute("id",this.options.styleId),e.innerHTML=function(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return"#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n".toString().replace(ioe,e)}(t);const n=document.head;n.childNodes.length>0?n.insertBefore(e,n.childNodes[0]):n.appendChild(e)}this.el=document.getElementById(t),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",t),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el))}tooltipHandler(e,t,n,r){if(null==r||""===r)return void this.el.classList.remove("visible",this.options.theme+"-theme");this.el.innerHTML=function(e,t,n){if(km(e))return`[${e.map(e=>t(bg(e)?e:ooe(e,n))).join(", ")}]`;if(Em(e)){let r="";const i=e,{title:a,image:o}=i,s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(i,["title","image"]);a&&(r+=`<h2>${t(a)}</h2>`),o&&(r+=`<img src="${t(o)}">`);const l=Object.keys(s);if(l.length>0){r+="<table>";for(const e of l){let i=s[e];void 0!==i&&(Em(i)&&(i=ooe(i,n)),r+=`<tr><td class="key">${t(e)}:</td><td class="value">${t(i)}</td></tr>`)}r+="</table>"}return r||"{}"}return t(e)}(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",this.options.theme+"-theme");const{x:i,y:a}=function(e,t,n,r){let i=e.clientX+n;i+t.width>window.innerWidth&&(i=+e.clientX-n-t.width);let a=e.clientY+r;return a+t.height>window.innerHeight&&(a=+e.clientY-r-t.height),{x:i,y:a}}(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${i}px`)}}function loe(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(t){a(t)}}function s(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((r=r.apply(e,t||[])).next())}))}var uoe;function coe(e,...t){for(const n of t)doe(e,n);return e}function doe(e,t){for(const n of Object.keys(t))Cm(e,n,t[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});const hoe=v;let foe=b;const poe="undefined"!=typeof window?window:void 0;void 0===foe&&(null===(uoe=null==poe?void 0:poe.vl)||void 0===uoe?void 0:uoe.compile)&&(foe=poe.vl);const moe={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},goe={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},voe={vega:"Vega","vega-lite":"Vega-Lite"},yoe={vega:hoe.version,"vega-lite":foe?foe.version:"not available"},boe={vega:e=>e,"vega-lite":(e,t)=>foe.compile(e,{config:t}).spec};function xoe(e,t,n,r){const i=`<html><head>${t}</head><body><pre><code class="json">`,a=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(i+e+a),o.document.title=voe[r]+" JSON Source"}function woe(e,t){var n;return loe(this,void 0,void 0,(function*(){const r=bg(e.config)?JSON.parse(yield t.load(e.config)):null!==(n=e.config)&&void 0!==n?n:{},i=bg(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),i?{patch:i}:{}),r?{config:r}:{})}))}var _oe=function(e,t,n={}){var r,i,a;return loe(this,void 0,void 0,(function*(){const o=(s=n.loader)&&"load"in s?n.loader:hoe.loader(n.loader);var s;const l=bg(t)?JSON.parse(yield o.load(t)):t,u=yield woe(null!==(r=l.usermeta&&l.usermeta.embedOptions)&&void 0!==r?r:{},o),c=yield woe(n,o),d=Object.assign(Object.assign({},coe(c,u)),{config:Tm(null!==(i=c.config)&&void 0!==i?i:{},null!==(a=u.config)&&void 0!==a?a:{})});return yield function(e,t,n={},r){var i,a,o,s,l,u;return loe(this,void 0,void 0,(function*(){const c=n.theme?Tm(x[n.theme],null!==(i=n.config)&&void 0!==i?i:{}):n.config,d=pg(n.actions)?n.actions:coe({},moe,null!==(a=n.actions)&&void 0!==a?a:{}),h=Object.assign(Object.assign({},goe),n.i18n),f=null!==(o=n.renderer)&&void 0!==o?o:"canvas",p=null!==(s=n.logLevel)&&void 0!==s?s:hoe.Warn,m=null!==(l=n.downloadFileName)&&void 0!==l?l:"visualization",g="string"==typeof e?document.querySelector(e):e;if(!g)throw new Error(e+" does not exist");if(!1!==n.defaultStyle){const e="vega-embed-style",{root:t,rootContainer:r}=function(e){var t;const n=e.getRootNode?e.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:null!==(t=document.head)&&void 0!==t?t:document.body}}(g);if(!t.getElementById(e)){const t=document.createElement("style");t.id=e,t.innerText=void 0===n.defaultStyle||!0===n.defaultStyle?'.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box; }\n  .vega-embed.has-actions {\n    padding-right: 38px; }\n  .vega-embed details:not([open]) > :not(summary) {\n    display: none !important; }\n  .vega-embed summary {\n    list-style: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    padding: 6px;\n    z-index: 1000;\n    background: white;\n    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n    color: #1b1e23;\n    border: 1px solid #aaa;\n    border-radius: 999px;\n    opacity: 0.2;\n    transition: opacity 0.4s ease-in;\n    outline: none;\n    cursor: pointer;\n    line-height: 0px; }\n    .vega-embed summary::-webkit-details-marker {\n      display: none; }\n    .vega-embed summary:active {\n      box-shadow: #aaa 0px 0px 0px 1px inset; }\n    .vega-embed summary svg {\n      width: 14px;\n      height: 14px; }\n  .vega-embed details[open] summary {\n    opacity: 0.7; }\n  .vega-embed:hover summary,\n  .vega-embed:focus summary {\n    opacity: 1 !important;\n    transition: opacity 0.2s ease; }\n  .vega-embed .vega-actions {\n    position: absolute;\n    z-index: 1001;\n    top: 35px;\n    right: -9px;\n    display: flex;\n    flex-direction: column;\n    padding-bottom: 8px;\n    padding-top: 8px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n    border: 1px solid #d9d9d9;\n    background: white;\n    animation-duration: 0.15s;\n    animation-name: scale-in;\n    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n    text-align: left; }\n    .vega-embed .vega-actions a {\n      padding: 8px 16px;\n      font-family: sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      color: #434a56;\n      text-decoration: none; }\n      .vega-embed .vega-actions a:hover {\n        background-color: #f7f7f9;\n        color: black; }\n    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n      content: "";\n      display: inline-block;\n      position: absolute; }\n    .vega-embed .vega-actions::before {\n      left: auto;\n      right: 14px;\n      top: -16px;\n      border: 8px solid #0000;\n      border-bottom-color: #d9d9d9; }\n    .vega-embed .vega-actions::after {\n      left: auto;\n      right: 15px;\n      top: -14px;\n      border: 7px solid #0000;\n      border-bottom-color: #fff; }\n  .vega-embed .chart-wrapper {\n    width: 100%;\n    height: 100%; }\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px; }\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6); }\n  to {\n    opacity: 1;\n    transform: scale(1); } }\n'.toString():n.defaultStyle,r.appendChild(t)}}const v=function(e,t){var n;if(e.$schema){const r=Eae(e.$schema);t&&t!==r.library&&console.warn(`The given visualization spec is written in ${voe[r.library]}, but mode argument sets ${null!==(n=voe[t])&&void 0!==n?n:t}.`);const i=r.library;return Object(em.satisfies)(yoe[i],"^"+r.version.slice(1))||console.warn(`The input spec uses ${voe[i]} ${r.version}, but the current version of ${voe[i]} is v${yoe[i]}.`),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":null!=t?t:"vega"}(t,n.mode);let y=boe[v](t,c);if("vega-lite"===v&&y.$schema){const e=Eae(y.$schema);Object(em.satisfies)(yoe.vega,"^"+e.version.slice(1))||console.warn(`The compiled spec uses Vega ${e.version}, but current version is v${yoe.vega}.`)}g.classList.add("vega-embed"),d&&g.classList.add("has-actions"),g.innerHTML="";let b=g;if(d){const e=document.createElement("div");e.classList.add("chart-wrapper"),g.appendChild(e),b=e}const w=n.patch;w&&(y=w instanceof Function?w(y):Bp(y,w,!0,!1).newDocument),n.formatLocale&&hoe.formatLocale(n.formatLocale),n.timeFormatLocale&&hoe.timeFormatLocale(n.timeFormatLocale);const{ast:_}=n,k=hoe.parse(y,"vega-lite"===v?{}:c,{ast:_}),E=new hoe.View(k,Object.assign({loader:r,logLevel:p,renderer:f},_?{expr:hoe.expressionInterpreter}:{}));if(!1!==n.tooltip){let e;e="function"==typeof n.tooltip?n.tooltip:new soe(!0===n.tooltip?{}:n.tooltip).call,E.tooltip(e)}let S,{hover:T}=n;if(void 0===T&&(T="vega"===v),T){const{hoverSet:e,updateSet:t}="boolean"==typeof T?{}:T;E.hover(e,t)}if(n&&(null!=n.width&&E.width(n.width),null!=n.height&&E.height(n.height),null!=n.padding&&E.padding(n.padding)),yield E.initialize(b,n.bind).runAsync(),!1!==d){let e=g;if(!1!==n.defaultStyle){const t=document.createElement("details");t.title=h.CLICK_TO_VIEW_ACTIONS,g.append(t),e=t;const n=document.createElement("summary");n.innerHTML='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>',t.append(n),S=e=>{t.contains(e.target)||t.removeAttribute("open")},document.addEventListener("click",S)}const r=document.createElement("div");if(e.append(r),r.classList.add("vega-actions"),!0===d||!1!==d.export)for(const t of["svg","png"])if(!0===d||!0===d.export||d.export[t]){const e=h[t.toUpperCase()+"_ACTION"],i=document.createElement("a");i.text=e,i.href="#",i.target="_blank",i.download=`${m}.${t}`,i.addEventListener("mousedown",(function(e){return loe(this,void 0,void 0,(function*(){e.preventDefault();const r=yield E.toImageURL(t,n.scaleFactor);this.href=r}))})),r.append(i)}if(!0===d||!1!==d.source){const e=document.createElement("a");e.text=h.SOURCE_ACTION,e.href="#",e.addEventListener("click",(function(e){var r,i;xoe(Qp()(t),null!==(r=n.sourceHeader)&&void 0!==r?r:"",null!==(i=n.sourceFooter)&&void 0!==i?i:"",v),e.preventDefault()})),r.append(e)}if("vega-lite"===v&&(!0===d||!1!==d.compiled)){const e=document.createElement("a");e.text=h.COMPILED_ACTION,e.href="#",e.addEventListener("click",(function(e){var t,r;xoe(Qp()(y),null!==(t=n.sourceHeader)&&void 0!==t?t:"",null!==(r=n.sourceFooter)&&void 0!==r?r:"","vega"),e.preventDefault()})),r.append(e)}if(!0===d||!1!==d.editor){const e=null!==(u=n.editorUrl)&&void 0!==u?u:"https://vega.github.io/editor/",i=document.createElement("a");i.text=h.EDITOR_ACTION,i.href="#",i.addEventListener("click",(function(n){!function(e,t,n){const r=e.open(t),{origin:i}=new URL(t);let a=40;e.addEventListener("message",(function t(n){n.source===r&&(a=0,e.removeEventListener("message",t,!1))}),!1),setTimeout((function e(){a<=0||(r.postMessage(n,i),setTimeout(e,250),a-=1)}),250)}(window,e,{config:c,mode:v,renderer:f,spec:Qp()(t)}),n.preventDefault()})),r.append(i)}}return{view:E,spec:t,vgSpec:y,finalize:function(){S&&document.removeEventListener("click",S),E.finalize()}}}))}(e,l,d,o)}))};class koe{constructor(e){this.HistogramRegion=zqe,this.selectedHistogramRegion=zqe.lastRoi,this.setSelectedSide=e=>{this.selectedSide=e},this.updateVolumeStats=e=>{const t=this.imageDataLeft.getData(this.selectedHistogramRegion,e),n=this.imageDataRight.getData(this.selectedHistogramRegion,e);if(0===t.length&&0===n.length)return;let r,i=null;this.selectedHistogramRegion===zqe.lastRoi?this.selectedSide.isLeft?(r=t.flatMap(e=>e.diffData.array),i="left"):(r=n.flatMap(e=>e.diffData.array),i="right"):r=t.flatMap(e=>e.diffData.array).concat(n.flatMap(e=>e.diffData.array));const a=[...r.reduce((e,t)=>(e.set(`${t.x}_${t.y}`,t),e),new Map).values()];this.drawHistogram(a);const o=a.reduce((e,t)=>(e.sumLeft+=t.left,e.sumRight+=t.right,e.sumDiff+=t.diff,e.minLeft=Math.min(e.minLeft,t.left),e.maxLeft=Math.max(e.maxLeft,t.left),e.minRight=Math.min(e.minRight,t.right),e.maxRight=Math.max(e.maxRight,t.right),e.minDiff=Math.min(e.minDiff,t.diff),e.maxDiff=Math.max(e.maxDiff,t.diff),e),{sumDiff:0,sumLeft:0,sumRight:0,minLeft:Number.MAX_VALUE,maxLeft:Number.MIN_VALUE,minRight:Number.MAX_VALUE,maxRight:Number.MIN_VALUE,minDiff:Number.MAX_VALUE,maxDiff:Number.MIN_VALUE}),s=o.sumDiff/a.length,l=o.sumLeft/a.length,u=o.sumRight/a.length,c=a.reduce((e,t)=>(e.diff+=Math.pow(t.diff-s,2),e.left+=Math.pow(t.left-l,2),e.right+=Math.pow(t.right-u,2),e),{left:0,right:0,diff:0}),d=t=>t.getData(this.selectedHistogramRegion,e).reduce((e,{stats:t})=>(e.sum+=t.mean*t.count,e.count+=t.count,e.varianceSum+=t.variance*t.count,e.area+=t.area,e),{count:0,sum:0,varianceSum:0,area:0}),h=d(this.imageDataLeft),f=d(this.imageDataRight),p=e=>Number.parseFloat(e.toFixed(1));a.length>0&&(this.volumeStats=Object.assign(Object.assign({},o),{count:a.length,max:o.maxDiff,min:o.minDiff,sum:o.sumDiff,mean:p(s),std:p(Math.sqrt(c.diff/a.length)),meanLeft:p(l),stdLeft:p(Math.sqrt(c.left/a.length)),meanRight:p(u),stdRight:p(Math.sqrt(c.right/a.length)),areaLeft:p("right"===i?f.area:h.area),areaRight:p("left"===i?h.area:f.area),meanLeftOwn:p(h.sum/h.count),stdLeftOwn:p(Math.sqrt(h.varianceSum/h.count)),meanRightOwn:p(f.sum/f.count),stdRightOwn:p(Math.sqrt(f.varianceSum/f.count))}))},this.drawHistogram=e=>{const t=[...e.map(e=>({intensity:e.left,type:"Left"})),...e.map(e=>({intensity:e.right,type:"Right"}))];_oe("#distChart",{width:600,height:180,data:{values:t},mark:"bar",transform:[{bin:!0,field:"intensity",as:"Binned",groupby:["type"]},{aggregate:[{op:"count",field:"Binned",as:"Count"}],groupby:["type","Binned","Binned_end"]},{joinaggregate:[{op:"sum",field:"Count",as:"TotalCount"}],groupby:["type"]},{calculate:"datum.Count/datum.TotalCount",as:"RelativeCount",groupby:["type"]}],encoding:{x:{bin:{binned:!0},field:"Binned",type:"quantitative",axis:{title:"Intensity"}},x2:{field:"Binned_end"},y:{field:"RelativeCount",type:"quantitative",axis:{title:"Percentage"}},color:{field:"type",scale:{range:["#675193","#ca8861"]},legend:{orient:"bottom"}},opacity:{value:.6}}});const n={width:600,height:180,data:{values:e.map(e=>({delta:e.diff}))},mark:"bar",encoding:{x:{field:"delta",bin:!0,axis:{title:"Intensity Difference (Left - Right)"}},y:{aggregate:"count",stack:null,axis:{title:"Pixel Count"}},color:{field:"delta",type:"quantitative",bin:!0,legend:null}}};_oe("#diffChart",n)},this.imageDataLeft=e.left,this.imageDataRight=e.right}updateHistogramRegion(e,t){this.selectedHistogramRegion=e,this.updateVolumeStats(t)}}class Eoe{constructor(e){this.registerMethod="4",this.isLoadingRegistration=!1,this.selectRegisterMethod=e=>{this.registerMethod=e},this.registerImages=()=>Zf(this,void 0,void 0,(function*(){const e=this.imageDataRight.currentStackIndex();this.isLoadingRegistration=!0;try{const t=yield this.imageRegistration(this.imageDataLeft.getElement(),this.imageDataRight.getElement(),{method:this.registerMethod});if("imageId"in t.data){const n=this.imageDataRight.getElement();cp.getToolState(n,"stack").data[0].imageIds[e]=t.data.imageId,dp.updateImage(n,!0)}else if(t.data){const e=t.data;this.imageDataRight.translateOrRotate(e.scale<1.5?{x:-this.imageDataRight.dx-e.deltax,y:-this.imageDataRight.dy-e.deltay,angle:-180*e.angle/Math.PI}:{x:e.centerx-e.deltax-this.imageDataRight.dx,y:e.centery-e.deltay-this.imageDataRight.dy,angle:-180*e.angle/Math.PI})}}catch(t){console.log(t)}finally{this.isLoadingRegistration=!1}})),this.imageRegistration=(e,t,n)=>Zf(this,void 0,void 0,(function*(){const r=e=>new Promise(t=>{e.toBlob(t)}),i=dp.getImage(e),a=dp.getImage(t),o=(yield Promise.all([r(e.querySelector("canvas")),r(t.querySelector("canvas"))]),new FormData);o.append("cut1",new Blob([i.getPixelData().buffer],{type:"application/octet-stream"})),o.append("cut2",new Blob([a.getPixelData().buffer],{type:"application/octet-stream"}));const s=`?lw=${i.width}&lh=${i.height}&rw=${a.width}&rh=${a.height}&method=${n.method}`,l=yield fetch("http://127.0.0.1:5000/files/registration"+s,{method:"POST",body:o});let u;if(l.ok){if(console.log(l),console.log(l.headers.get("Content-Type")),"application/json"===l.headers.get("Content-Type"))u=yield l.json();else{const e=yield l.blob(),t=window.URL.createObjectURL(e);u=yield mp.loadImage(t).promise}console.log(u)}return{response:l,data:u}})),this.imageDataLeft=e.left,this.imageDataRight=e.right}}class Soe{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class Toe{time(e){return Coe("time")}read(e){return Coe("read")}readSync(e){return Coe("readSync")}numDataIds(){return Coe("numDataIds")}disposeData(e){return Coe("disposeData")}write(e,t,n){return Coe("write")}move(e,t,n,r){return Coe("move")}memory(){return Coe("memory")}floatPrecision(){return Coe("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}batchMatMul(e,t,n,r){return Coe("batchMatMul")}fusedBatchMatMul({}){return Coe("fusedBatchMatMul")}slice(e,t,n){return Coe("slice")}stridedSlice(e,t,n,r){return Coe("stridedSlice")}unstack(e,t){return Coe("unstack")}reverse(e,t){return Coe("reverse")}concat(e,t){return Coe("concat")}neg(e){return Coe("neg")}add(e,t){return Coe("add")}addN(e){return Coe("addN")}subtract(e,t){return Coe("subtract")}multiply(e,t){return Coe("multiply")}realDivide(e,t){return Coe("realDivide")}floorDiv(e,t){return Coe("floorDiv")}sum(e,t){return Coe("sum")}prod(e,t){return Coe("prod")}unsortedSegmentSum(e,t,n){return Coe("unsortedSegmentSum")}argMin(e,t){return Coe("argMin")}argMax(e,t){return Coe("argMax")}equal(e,t){return Coe("equal")}notEqual(e,t){return Coe("notEqual")}less(e,t){return Coe("less")}lessEqual(e,t){return Coe("lessEqual")}greater(e,t){return Coe("greater")}greaterEqual(e,t){return Coe("greaterEqual")}logicalNot(e){return Coe("logicalNot")}logicalAnd(e,t){return Coe("logicalAnd")}logicalOr(e,t){return Coe("logicalOr")}where(e){return Coe("where")}select(e,t,n){return Coe("select")}topk(e,t,n){return Coe("topk")}min(e,t){return Coe("min")}minimum(e,t){return Coe("minimum")}mod(e,t){return Coe("mod")}max(e,t){return Coe("max")}maximum(e,t){return Coe("maximum")}all(e,t){return Coe("all")}any(e,t){return Coe("any")}squaredDifference(e,t){return Coe("squaredDifference")}ceil(e){return Coe("ceil")}floor(e){return Coe("floor")}round(e){return Coe("round")}sign(e){return Coe("sign")}isNaN(e){return Coe("isNaN")}isInf(e){return Coe("isInf")}isFinite(e){return Coe("isFinite")}pow(e,t){return Coe("pow")}exp(e){return Coe("exp")}expm1(e){return Coe("expm1")}softmax(e,t){return Coe("softmax")}log(e){return Coe("log")}log1p(e){return Coe("log1p")}sqrt(e){return Coe("sqrt")}rsqrt(e){return Coe("rsqrt")}square(e){return Coe("square")}reciprocal(e){return Coe("reciprocal")}relu(e){return Coe("relu")}relu6(e){return Coe("relu6")}prelu(e,t){return Coe("prelu")}elu(e){return Coe("elu")}eluDer(e,t){return Coe("eluDer")}selu(e){return Coe("selu")}int(e){return Coe("int")}clip(e,t,n){return Coe("clip")}abs(e){return Coe("abs")}complexAbs(e){return Coe("complexAbs")}sigmoid(e){return Coe("sigmoid")}softplus(e){return Coe("softplus")}sin(e){return Coe("sin")}cos(e){return Coe("cos")}tan(e){return Coe("tan")}asin(e){return Coe("asin")}acos(e){return Coe("acos")}atan(e){return Coe("atan")}atan2(e,t){return Coe("atan2")}sinh(e){return Coe("sinh")}cosh(e){return Coe("cosh")}tanh(e){return Coe("tanh")}asinh(e){return Coe("asinh")}acosh(e){return Coe("acosh")}atanh(e){return Coe("atanh")}erf(e){return Coe("erf")}step(e,t){return Coe("step")}fusedConv2d({}){return Coe("fusedConv2d")}conv2d(e,t,n){return Coe("conv2d")}conv2dDerInput(e,t,n){return Coe("conv2dDerInput")}conv2dDerFilter(e,t,n){return Coe("conv2dDerFilter")}fusedDepthwiseConv2D({}){return Coe("fusedDepthwiseConv2D")}depthwiseConv2D(e,t,n){return Coe("depthwiseConv2D")}depthwiseConv2DDerInput(e,t,n){return Coe("depthwiseConv2DDerInput")}depthwiseConv2DDerFilter(e,t,n){return Coe("depthwiseConv2DDerFilter")}conv3d(e,t,n){return Coe("conv3d")}conv3dDerInput(e,t,n){return Coe("conv3dDerInput")}conv3dDerFilter(e,t,n){return Coe("conv3dDerFilter")}maxPool(e,t){return Coe("maxPool")}maxPoolBackprop(e,t,n,r){return Coe("maxPoolBackprop")}avgPool(e,t){return Coe("avgPool")}avgPoolBackprop(e,t,n){return Coe("avgPoolBackprop")}avgPool3d(e,t){return Coe("avgPool3d")}avgPool3dBackprop(e,t,n){return Coe("avgPool3dBackprop")}maxPool3d(e,t){return Coe("maxPool3d")}maxPool3dBackprop(e,t,n,r){return Coe("maxPool3dBackprop")}reshape(e,t){return Coe("reshape")}cast(e,t){return Coe("cast")}tile(e,t){return Coe("tile")}pad(e,t,n){return Coe("pad")}transpose(e,t){return Coe("transpose")}gather(e,t,n,r=0){return Coe("gather")}gatherND(e,t){return Coe("gatherND")}scatterND(e,t,n){return Coe("scatterND")}batchToSpaceND(e,t,n){return Coe("batchToSpaceND")}spaceToBatchND(e,t,n){return Coe("spaceToBatchND")}resizeBilinear(e,t,n,r,i){return Coe("resizeBilinear")}resizeBilinearBackprop(e,t,n){return Coe("resizeBilinearBackprop")}resizeNearestNeighbor(e,t,n,r,i){return Coe("resizeNearestNeighbor")}resizeNearestNeighborBackprop(e,t,n){return Coe("resizeNearestNeighborBackprop")}batchNorm(e,t,n,r,i,a){return Coe("batchNorm")}localResponseNormalization4D(e,t,n,r,i){return Coe("localResponseNormalization4D")}LRNGrad(e,t,n,r,i,a,o){return Coe("LRNGrad")}multinomial(e,t,n,r){return Coe("multinomial")}oneHot(e,t,n,r){return Coe("oneHot")}cumsum(e,t,n,r){return Coe("cumsum")}nonMaxSuppression(e,t,n,r,i){return Coe("nonMaxSuppression")}fft(e){return Coe("fft")}ifft(e){return Coe("ifft")}complex(e,t){return Coe("complex")}real(e){return Coe("real")}imag(e){return Coe("imag")}cropAndResize(e,t,n,r,i,a){return Coe("cropAndResize")}depthToSpace(e,t,n){return Coe("depthToSpace")}split(e,t,n){return Coe("split")}sparseToDense(e,t,n,r){return Coe("sparseToDense")}diag(e){return Coe("diag")}fill(e,t,n){return Coe("fill")}onesLike(e){return Coe("onesLike")}zerosLike(e){return Coe("zerosLike")}linspace(e,t,n){return Coe("linspace")}dispose(){return Coe("dispose")}}function Coe(e){throw new Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function Ioe(e){let t=e.length,n=0,r=0;for(;t>0;)r=Math.random()*t|0,t--,n=e[t],e[t]=e[r],e[r]=n}function Aoe(e,t,n){return Math.max(e,Math.min(t,n))}function Ooe(e){return e%2==0?e:e+1}function Doe(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}function Moe(e,t){const n=Math.random();return t*n+(1-n)*e}function Noe(e,t){let n=0;for(let r=0;r<e.length;r++){const i=Number(e[r])-Number(t[r]);n+=i*i}return n}function joe(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function Foe(e,t,n=""){joe($oe(e,t),()=>n+` Shapes ${e} and ${t} must match`)}function Roe(e){joe(null!=e,()=>"The input to the tensor constructor must be a non-null value.")}function Poe(e,t=[],n=!1){if(null==t&&(t=[]),Array.isArray(e)||tse(e)&&!n)for(let r=0;r<e.length;++r)Poe(e[r],t,n);else t.push(e);return t}function Loe(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function Boe(e){return 0===e.length}function $oe(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function zoe(e){return e%1==0}function Uoe(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;{const t=Math.exp(2*e);return(t-1)/(t+1)}}function Hoe(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Woe(e){const t=new Uint32Array(e);for(let n=0;n<e;++n)t[n]=n;return Ioe(t),t}function Voe(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function qoe(e,t=(e=>0),n){return new Promise((r,i)=>{let a=0;const o=()=>{if(e())return void r();a++;const s=t(a);null!=n&&a>=n?i():setTimeout(o,s)};o()})}function Goe(e,t){let n=1,r=-1;for(let a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${a}`);r=a}else if(e[a]<0)throw Error(`Shapes can not be < 0. Found ${e[a]} at dim ${a}`);if(-1===r){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(0===n)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);const i=e.slice();return i[r]=t/n,i}function Yoe(e,t){const n=t.length;return joe((e=null==e?t.map((e,t)=>t):[].concat(e)).every(e=>e>=-n&&e<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis `+e),joe(e.every(e=>zoe(e)),()=>"All values in axis param must be integers but got axis "+e),e.map(e=>e<0?n+e:e)}function Xoe(e,t){const n=[],r=[],i=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||i?null:Yoe(t,e).sort();let o=0;for(let s=0;s<e.length;++s){if(null!=a){if(a[o]===s&&1!==e[s])throw new Error(`Can't squeeze axis ${s} since its dim '${e[s]}' is not 1`);(null==a[o]||a[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),a[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Koe(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function Zoe(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function Joe(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}function Qoe(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function ese(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function tse(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function nse(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function rse(e){if(null==e)return 0;let t=0;return e.forEach(e=>t+=e.length),t}function ise(e){return"string"==typeof e||e instanceof String}function ase(e){return"boolean"==typeof e}function ose(e){return"number"==typeof e}function sse(e){return Array.isArray(e)?sse(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":ose(e)?"float32":ise(e)?"string":ase(e)?"bool":"float32"}function lse(e){return!!(e&&e.constructor&&e.call&&e.apply)}function use(e,t){for(let n=t;n<e;++n)if(e%n==0)return n;return e}function cse(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function dse(e,t){if(0===e.length)return t[0];const n=e.reduce((e,t)=>e*t);if(0===n)return[];if(n!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}.`);return function e(t,n,r){const i=new Array;if(1===n.length){const e=n[0];for(let n=0;n<e;n++)i[n]=r[t+n]}else{const a=n[0],o=n.slice(1),s=o.reduce((e,t)=>e*t);for(let n=0;n<a;n++)i[n]=e(t+n*s,o,r)}return i}(0,e,t)}function hse(e,t){const n=fse(e,t);for(let r=0;r<n.length;r++)n[r]=1;return n}function fse(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function pse(e,t){const n=e.reduce((e,t)=>e*t,1);if(null==t||"float32"===t)return dse(e,new Float32Array(n));if("int32"===t)return dse(e,new Int32Array(n));if("bool"===t)return dse(e,new Uint8Array(n));throw new Error("Unknown data type "+t)}function mse(e){e.forEach(t=>{joe(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`)})}function gse(e,t,n){if(0===t)return 0;if(1===t)return e[0];let r=e[e.length-1];for(let i=0;i<e.length-1;++i)r+=n[i]*e[i];return r}function vse(e,t,n){if(0===t)return[];if(1===t)return[e];const r=new Array(t);for(let i=0;i<r.length-1;++i)r[i]=Math.floor(e/n[i]),e-=r[i]*n[i];return r[r.length-1]=e,r}function yse(e){return e&&e.then&&"function"==typeof e.then}class bse{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}setPlatform(e,t){null!=this.platform&&console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){const t=this.urlFlags[e];console.warn(`Setting feature override from URL ${e}: ${t}.`),this.set(e,t)}}async getAsync(e){return e in this.flags||(this.flags[e]=await this.evaluateFlag(e)),this.flags[e]}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(yse(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(null==this.flagRegistry[e])throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const e=function(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...n)=>(function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,n[0],n[1]),n.join("="))),t}(this.global.location.search);"tfjsflags"in e&&e.tfjsflags.split(",").forEach(e=>{const[t,n]=e.split(":");this.urlFlags[t]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error(`Could not parse value flag value ${t} for flag ${e}.`)}(t,n)})}}function xse(){return _se}let wse,_se=null;function kse(){if(null==wse){let e;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof global)e=global;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}wse=e}return wse}function Ese(e,t){const n=function(){const e=kse();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);{const r=t();return n.set(e,r),n.get(e)}}const Sse="Abs",Tse="Acos",Cse="Acosh",Ise="Add",Ase="AddN",Ose="All",Dse="Any",Mse="ArgMax",Nse="ArgMin",jse="Asin",Fse="Asinh",Rse="Atan",Pse="Atanh",Lse="Atan2",Bse="AvgPool",$se="AvgPoolGrad",zse="AvgPool3D",Use="AvgPool3DGrad",Hse="BatchMatMul",Wse="BatchToSpaceND",Vse="Bincount",qse="BroadcastTo",Gse="Cast",Yse="Ceil",Xse="ClipByValue",Kse="Complex",Zse="ComplexAbs",Jse="Concat",Qse="Conv2D",ele="Conv2DBackpropFilter",tle="Conv2DBackpropInput",nle="Conv3D",rle="Conv3DBackpropFilterV2",ile="Conv3DBackpropInputV2",ale="Cos",ole="Cosh",sle="Cumsum",lle="CropAndResize",ule="DenseBincount",cle="DepthToSpace",dle="DepthwiseConv2dNative",hle="DepthwiseConv2dNativeBackpropFilter",fle="DepthwiseConv2dNativeBackpropInput",ple="Diag",mle="Dilation2D",gle="Dilation2DBackpropInput",vle="Dilation2DBackpropFilter",yle="RealDiv",ble="Elu",xle="EluGrad",wle="Erf",_le="Equal",kle="Exp",Ele="ExpandDims",Sle="Expm1",Tle="FFT",Cle="Fill",Ile="FlipLeftRight",Ale="Floor",Ole="FloorDiv",Dle="FusedBatchNorm",Mle="GatherV2",Nle="GatherNd",jle="Greater",Fle="GreaterEqual",Rle="Identity",Ple="IFFT",Lle="Imag",Ble="IsFinite",$le="IsInf",zle="IsNan",Ule="LeakyRelu",Hle="Less",Wle="LessEqual",Vle="LinSpace",qle="Log",Gle="Log1p",Yle="LogicalAnd",Xle="LogicalNot",Kle="LogicalOr",Zle="LogSoftmax",Jle="LRN",Qle="LRNGrad",eue="Max",tue="Maximum",nue="MaxPool",rue="MaxPoolGrad",iue="MaxPool3D",aue="MaxPool3DGrad",oue="MaxPoolWithArgmax",sue="Mean",lue="Min",uue="Minimum",cue="MirrorPad",due="Mod",hue="Multinomial",fue="Multiply",pue="Neg",mue="NotEqual",gue="NonMaxSuppressionV3",vue="NonMaxSuppressionV4",yue="NonMaxSuppressionV5",bue="OnesLike",xue="OneHot",wue="Pack",_ue="PadV2",kue="Pool",Eue="Pow",Sue="Prelu",Tue="Prod",Cue="Range",Iue="Real",Aue="Reciprocal",Oue="Relu",Due="Reshape",Mue="ResizeNearestNeighbor",Nue="ResizeNearestNeighborGrad",jue="ResizeBilinear",Fue="ResizeBilinearGrad",Rue="Relu6",Pue="Reverse",Lue="Round",Bue="Rsqrt",$ue="ScatterNd",zue="Select",Uue="Selu",Hue="Slice",Wue="Sin",Vue="Sinh",que="Sign",Gue="Sigmoid",Yue="Softplus",Xue="Sqrt",Kue="Sum",Zue="SpaceToBatchND",Jue="SplitV",Que="Softmax",ece="SquaredDifference",tce="Square",nce="Sub",rce="SparseToDense",ice="StridedSlice",ace="Tan",oce="Tanh",sce="Tile",lce="TopK",uce="Transpose",cce="Unique",dce="Unpack",hce="UnsortedSegmentSum",fce="ZerosLike",pce="Step",mce="FromPixels",gce="RotateWithOffset",vce="_FusedMatMul",yce="FusedConv2D",bce="FusedDepthwiseConv2D",xce=Ese("kernelRegistry",()=>new Map),wce=Ese("gradRegistry",()=>new Map);function _ce(e,t){const n=Oce(e,t);return xce.get(n)}function kce(e){return wce.get(e)}function Ece(e){const t=xce.entries(),n=[];for(;;){const{done:r,value:i}=t.next();if(r)break;const[a,o]=i,[s]=a.split("_");s===e&&n.push(o)}return n}function Sce(e){const{kernelName:t,backendName:n}=e,r=Oce(t,n);xce.has(r)&&console.warn(`The kernel '${t}' for backend '${n}' is already registered`),xce.set(r,e)}function Tce(e){const{kernelName:t}=e;wce.has(t)&&xse().getBool("DEBUG")&&console.warn(`Overriding the gradient for '${t}'`),wce.set(t,e)}function Cce(e,t){const n=Oce(e,t);if(!xce.has(n))throw new Error(`The kernel '${e}' for backend '${t}' is not registered`);xce.delete(n)}function Ice(e){if(!wce.has(e))throw new Error(`The gradient '${e}' for backend is not registered`);wce.delete(e)}function Ace(e,t){Ece(e).forEach(e=>{Sce(Object.assign({},e,{backendName:t}))})}function Oce(e,t){return`${t}_${e}`}class Dce{constructor(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new Nce)}profileKernel(e,t,n){let r;const i=this.backendTimer.time(()=>{r=n()});if(xse().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let a=0;a<r.length;a++){const t=r[a];t.data().then(n=>{Mce(n,t.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:i.then(e=>e.kernelMs),extraInfo:i.then(e=>null!=e.getExtraProfileInfo?e.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:n,timeMs:r,inputs:i,extraInfo:a}=e;n.forEach(e=>{Promise.all([e.data(),r,a]).then(n=>{this.logger.logKernelProfile(t,e,n[0],n[1],i,n[2])})})}}function Mce(e,t,n){if("float32"!==t)return!1;for(let r=0;r<e.length;r++){const t=e[r];if(isNaN(t)||!isFinite(t))return console.warn(`Found ${t} in the result of '${n}'`),!0}return!1}class Nce{logKernelProfile(e,t,n,r,i,a){const o="number"==typeof r?Voe(r+"ms",9):r.error,s=Voe(e,25),l=t.rank,u=t.size,c=Voe(t.shape.toString(),14);let d="";for(const h in i){const e=i[h];if(null!=e){const n=e.shape||t.shape,r=n.length;d+=`${h}: ${r}D ${r>0?n:""} `}}console.log(`%c${s}\t%c${o}\t%c${l}D ${c}\t%c${u}\t%c${d}\t%c${a}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}function jce(e,t,n){let r;return r=Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":ise(e)?`'${e}'`:"bool"===n?Fce(e):parseFloat(e.toFixed(7)).toString(),Voe(r,t)}function Fce(e){return 0===e?"false":"true"}function Rce(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}function Pce(e,t){return"string"===t?zce(e):Lce([e],t)}function Lce(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Poe(e)),xse().getBool("DEBUG")&&Joe(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){const t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)0!==Math.round(e[n])&&(t[n]=1);return t}throw new Error("Unknown data type "+t)}function Bce(){return xse().platform.now()}function $ce(e,t){return xse().platform.fetch(e,t)}function zce(e,t="utf-8"){return t=t||"utf-8",xse().platform.encode(e,t)}function Uce(e,t="utf-8"){return t=t||"utf-8",xse().platform.decode(e,t)}class Hce{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=Loe(e),null!=n){const e=n.length;joe(e===this.size,()=>`Length of values '${e}' does not match the size inferred by the shape '${this.size}'.`)}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Zoe(t,this.size),this.strides=cse(e)}set(e,...t){0===t.length&&(t=[0]),joe(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const n=this.locToIndex(t);this.values[n]=e}get(...e){0===e.length&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t])throw new Error(`Requested out of range element at ${e}.   Buffer shape=`+this.shape);t++}let n=e[e.length-1];for(let r=0;r<e.length-1;++r)n+=this.strides[r]*e[r];return this.values[n]}locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];const t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Wce().makeTensor(this.values,this.shape,this.dtype)}}let Wce=null,Vce=null,qce=null;class Gce{constructor(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Loe(e),this.strides=cse(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Vce.buffer(this.shape,this.dtype,e)}bufferSync(){return Vce.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return dse(this.shape,e)}arraySync(){return dse(this.shape,this.dataSync())}async data(){this.throwIfDisposed();const e=Wce().read(this.dataId);if("string"===this.dtype){const n=await e;try{return n.map(e=>Uce(e))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataSync(){this.throwIfDisposed();const e=Wce().readSync(this.dataId);if("string"===this.dtype)try{return e.map(e=>Uce(e))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Wce().read(this.dataId);return"string"===this.dtype?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(Wce().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Vce.print(this,e)}clone(){return this.throwIfDisposed(),Vce.clone(this)}toString(e=!1){return function(e,t,n,r){const i=cse(t),a=function(e,t,n,r){const i=Loe(t),a=r[r.length-1],o=new Array(a).fill(0),s=t.length,l="complex64"===n?Rce(e):e;if(s>1)for(let u=0;u<i/a;u++){const e=u*a;for(let t=0;t<a;t++)o[t]=Math.max(o[t],jce(l[e+t],0,n).length)}return o}(e,t,n,i),o=t.length,s=function e(t,n,r,i,a,o=!0){const s="complex64"===r?2:1,l=n[0],u=n.length;if(0===u)return"complex64"===r?[jce(Rce(t)[0],0,r)]:"bool"===r?[Fce(t[0])]:[t[0].toString()];if(1===u){if(l>20){let e=Array.from(t.slice(0,3*s)),n=Array.from(t.slice((l-3)*s,l*s));return"complex64"===r&&(e=Rce(e),n=Rce(n)),["["+e.map((e,t)=>jce(e,a[t],r)).join(", ")+", ..., "+n.map((e,t)=>jce(e,a[l-3+t],r)).join(", ")+"]"]}return["["+("complex64"===r?Rce(t):Array.from(t)).map((e,t)=>jce(e,a[t],r)).join(", ")+"]"]}const c=n.slice(1),d=i.slice(1),h=i[0]*s,f=[];if(l>20){for(let n=0;n<3;n++){const i=n*h;f.push(...e(t.slice(i,i+h),c,r,d,a,!1))}f.push("...");for(let n=l-3;n<l;n++){const i=n*h;f.push(...e(t.slice(i,i+h),c,r,d,a,n===l-1))}}else for(let g=0;g<l;g++){const n=g*h;f.push(...e(t.slice(n,n+h),c,r,d,a,g===l-1))}const p=2===u?",":"";f[0]="["+f[0]+p;for(let g=1;g<f.length-1;g++)f[g]=" "+f[g]+p;let m=",\n";for(let g=2;g<u;g++)m+="\n";return f[f.length-1]=" "+f[f.length-1]+"]"+(o?"":m),f}(e,t,n,i,a),l=["Tensor"];return r&&(l.push("  dtype: "+n),l.push("  rank: "+o),l.push(`  shape: [${t}]`),l.push("  values:")),l.push(s.map(e=>"    "+e).join("\n")),l.join("\n")}(this.dataSync(),this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Vce.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),Wce().makeVariable(this,e,t,n)}}Object.defineProperty(Gce,Symbol.hasInstance,{value:e=>!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed});class Yce extends Gce{constructor(e,t,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!$oe(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Wce().disposeTensor(this),this.dataId=e.dataId,Wce().incRef(this,null)}dispose(){Wce().disposeVariable(this),this.isDisposedInternal=!0}}var Xce,Kce,Zce,Jce,Qce;Object.defineProperty(Yce,Symbol.hasInstance,{value:e=>e instanceof Gce&&null!=e.assign&&e.assign instanceof Function}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Xce||(Xce={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Kce||(Kce={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Zce||(Zce={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Jce||(Jce={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Qce||(Qce={}));const ede={float32:Jce,int32:Kce,bool:Zce,complex64:Qce};function tde(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error(`Can not upcast ${e} with ${t}`)}return ede[e][t]}function nde(e){return tde(e,"int32")}function rde(e,t){if(e.dtype===t.dtype)return[e,t];const n=tde(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function ide(e,t){joe(e.dtype===t.dtype,()=>`The dtypes of the first(${e.dtype}) and second(${t.dtype}) input must match`)}function ade(e,t){return t.some(t=>t.id===e.id)}function ode(e){const t=[];return function e(t,n,r){if(null==t)return;if(t instanceof Gce)return void n.push(t);if(i=t,!Array.isArray(i)&&"object"!=typeof i)return;var i;const a=t;for(const o in a){const t=a[o];r.has(t)||(r.add(t),e(t,n,r))}}(e,t,new Set),t}class sde{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class lde{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new sde}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then(()=>{});if(null!=this.backendInstance)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t];if(await this.initializeBackend(n).success)return void(await this.setBackend(n))}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;{const{asyncInit:t}=this.initializeBackend(e);if(t)return null}}return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,n=1){return e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(null==this.registryFactory[e])throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,null==this.registry[e]){this.backendInstance=null;const{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Dce(this.backendInstance),!0}setupRegisteredKernels(){Ece(this.backendName).forEach(e=>{null!=e.setupFunc&&e.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){Ece(e).forEach(t=>{null!=t.disposeFunc&&t.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(null==t)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const n=t.factory();if(!n||n instanceof Toe||"function"!=typeof n.then)return this.registry[e]=n,{success:!0,asyncInit:!1};{const t=++this.pendingBackendInitId,r=n.then(n=>!(t<this.pendingBackendInitId||(this.registry[e]=n,this.pendingBackendInit=null,0))).catch(n=>(t<this.pendingBackendInitId||(this.pendingBackendInit=null,console.warn(`Initialization of backend ${e} failed`),console.warn(n.stack||n.message)),!1));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(n){return console.warn(`Initialization of backend ${e} failed`),console.warn(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t],{success:r,asyncInit:i}=this.initializeBackend(n);if(i||r)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const n=this.state.tensorInfo.get(t),r=n.backend,i=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n,r=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}return this.scopedRun(()=>this.startScope(r),()=>this.endScope(n),()=>(n=t(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n))}scopedRun(e,t,n){e();try{const e=n();return t(),e}catch(r){throw t(),r}}nextTensorId(){return lde.nextTensorId++}nextVariableId(){return lde.nextVariableId++}clone(e){const t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype);return this.addTapeNode(this.state.activeScope.name,{x:e},[t],e=>({x:()=>{const t="float32";return cde.runKernelFunc(n=>n.cast(e,t),{x:e},null,Gse,{dtype:t})}}),[],{}),t}runKernel(e,t,n,r,i){return this.runKernelFunc(null,t,null,e,n,r,i)}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){const r=this.backend.numDataIds();let i=0;n.forEach(e=>{i+="complex64"===e.dtype?3:1});const a=r-t-i-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e,t,n,r,i,a,o){let s,l=[];const u=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");const c=this.state.numBytes,d=this.state.numTensors;let h;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);const f=_ce(r,this.backendName);let p,m;if(null!=f)h=()=>{const e=this.backend.numDataIds();p=f.kernelFunc({inputs:t,attrs:i,backend:this.backend});const n=Array.isArray(p)?p:[p];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(r,e,n);const s=n.map(e=>{if(null!=e.rank)return e;const{dataId:t,shape:n,dtype:r}=e;return this.makeTensorFromDataId(t,n,r)});if(u){let e=this.getTensorsForGradient(r,t,s);if(null==e){null==o&&(o=[]);const t=s.filter((e,t)=>o[t]);e=(a||[]).slice().concat(t)}l=this.saveTensorsForBackwardMode(e)}return s};else{if(null==e)throw new Error(`Error running ${r}: Neither modular kernel nor forward func passed`);const t=e=>{u&&(l=e.map(e=>this.keep(this.clone(e))))};h=()=>{const n=this.backend.numDataIds();p=this.tidy(()=>e(this.backend,t));const i=Array.isArray(p)?p:[p];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(r,n,i),i}}return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(m=this.profiler.profileKernel(r,t,()=>h()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),s=m.outputs):s=h()}),u&&this.addTapeNode(r,t,s,n,l,i),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-c,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-d,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(e=>null!=t[e]?t[e].shape:null),outputShapes:s.map(e=>e.shape),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(p)?s:s[0]}saveTensorsForBackwardMode(e){return e.map(e=>this.keep(this.clone(e)))}getTensorsForGradient(e,t,n){const r=kce(e);if(null!=r){const e=r.inputsToSave||[],i=r.outputsToSave||[];let a;r.saveAllInputs?(joe(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(e=>t[e])):a=e.map(e=>t[e]);const o=n.filter((e,t)=>i[t]);return a.concat(o)}return null}makeTensor(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");r=r||this.backend;let i=e;"string"===(n=n||"float32")&&ise(e[0])&&(i=e.map(e=>zce(e)));const a=r.write(i,t,n),o=new Gce(t,n,a,this.nextTensorId());if(this.incRef(o,r),"string"===n){const e=this.state.tensorInfo.get(a),t=rse(i);this.state.numBytes+=t-e.bytes,e.bytes=t}return o}makeTensorFromDataId(e,t,n,r){const i=new Gce(t,n=n||"float32",e,this.nextTensorId());return this.incRef(i,r),i}makeVariable(e,t=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));const i=new Yce(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}incRef(e,t){const n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;let n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*nse(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n,refCount:0}),this.state.numBytes+=n}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Yce||this.track(e)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;const t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}disposeVariables(){for(const e in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[e])}disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(e=>e.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(e,t,n,r,i,a){const o={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},s=kce(e);null!=s&&(r=s.gradFunc),null!=r&&(o.gradient=e=>(e=e.map((e,t)=>{if(null==e){const e=n[t],r=fse(e.size,e.dtype);return this.makeTensor(r,e.shape,e.dtype)}return e}),r(e.length>1?e:e[0],i,a))),this.state.activeTape.push(o)}keep(e){return e.kept=!0,e}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=ode(e),n=new Set(t.map(e=>e.id));for(let i=0;i<this.state.activeScope.track.length;i++){const e=this.state.activeScope.track[i];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(e=>{e.kept||e.scopeId!==r.id||this.track(e)})}gradients(e,t,n,r=!1){if(joe(t.length>0,()=>"gradients() received an empty list of xs."),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));joe(i instanceof Gce,()=>"The result y returned by f() must be a tensor.");const a=function(e,t,n){const r={},i={};for(let l=0;l<t.length;l++)r[t[l].id]=!0;for(let l=0;l<e.length;l++){const n=e[l],a=n.inputs;for(const e in a){const o=a[e];let s=!1;for(let e=0;e<t.length;e++)if(r[o.id]){n.outputs.forEach(e=>r[e.id]=!0),s=!0,i[n.id]=!0;break}if(s)break}}const a={};a[n.id]=!0;const o={};for(let l=e.length-1;l>=0;l--){const t=e[l],n=t.inputs;for(let e=0;e<t.outputs.length;e++)if(a[t.outputs[e].id]){for(const e in n)a[n[e].id]=!0,o[t.id]=!0;break}}const s=[];for(let l=0;l<e.length;l++){const t=e[l];if(i[t.id]&&o[t.id]){const e={};for(const i in t.inputs){const n=t.inputs[i];r[n.id]&&(e[i]=n)}const n=Object.assign({},t);n.inputs=e,n.outputs=t.outputs,s.push(n)}}return s}(this.state.activeTape,t,i);if(!r&&0===a.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const e={};e[i.id]=null==n?function(e){const t=hse(Loe(e),"float32");return cde.makeTensor(t,e,"float32")}(i.shape):n,function(e,t,n,r){for(let i=t.length-1;i>=0;i--){const a=t[i],o=[];if(a.outputs.forEach(t=>{const n=e[t.id];o.push(null!=n?n:null)}),null==a.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${a.kernelName}.`);const s=a.gradient(o);for(const t in a.inputs){if(!(t in s))throw new Error(`Cannot backprop through input ${t}. Available gradients found: ${Object.keys(s)}.`);const i=n(()=>s[t]());if("float32"!==i.dtype)throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input ${t} must have 'float32' dtype, but has '${i.dtype}'`);const o=a.inputs[t];if(!$oe(i.shape,o.shape))throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input '${t}' has shape '${i.shape}', which does not match the shape of the input '${o.shape}'`);if(null==e[o.id])e[o.id]=i;else{const t=e[o.id];e[o.id]=r(t,i),t.dispose()}}}}(e,a,e=>this.tidy(e),dde);const r=t.map(t=>e[t.id]);return 0===this.state.gradientDepth&&(this.state.activeTape.forEach(e=>{for(const t of e.saved)t.dispose()}),this.state.activeTape=null),{value:i,grads:r}})}customGrad(e){return joe(lse(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{let n;joe(t.every(e=>e instanceof Gce),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");const r={};return t.forEach((e,t)=>{r[t]=e}),this.runKernelFunc((r,i)=>(n=e(...t,i),joe(n.value instanceof Gce,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),joe(lse(n.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n.value),r,(e,r)=>{const i=n.gradFunc(e,r),a=Array.isArray(i)?i:[i];joe(a.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),joe(a.every(e=>e instanceof Gce),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const o={};return a.forEach((e,t)=>{o[t]=()=>e}),o})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}async time(e){const t=Bce(),n=await this.backend.time(e);return n.wallMs=Bce()-t,n}track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new sde;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function ude(){const e=kse();if(null==e._tfengine){const t=new bse(e);e._tfengine=new lde(t)}return _se=e._tfengine.ENV,Wce=()=>e._tfengine,e._tfengine}lde.nextTensorId=0,lde.nextVariableId=0;const cde=ude();function dde(e,t){return cde.runKernel(Ise,{a:e,b:t})}function hde(){if("undefined"!=typeof navigator&&null!=navigator){const e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function fde(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}const pde=xse();function mde(e,t){let n=e;if(tse(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];const r=[];for(;Array.isArray(n)||tse(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&xse().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],!Array.isArray(t)&&!tse(t))return void joe(0===n.length,()=>`Element arr[${r.join("][")}] is a primitive, but should be an array/TypedArray of ${n[0]} elements`);joe(n.length>0,()=>`Element arr[${r.join("][")}] should be a primitive, but is an array of ${t.length} elements`),joe(t.length===n[0],()=>`Element arr[${r.join("][")}] should have ${n[0]} elements, but has ${t.length} elements`);const i=n.slice(1);for(let a=0;a<t.length;++a)e(t[a],i,r.concat(a))}(e,r,[]),r}function gde(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error(`Argument '${n}' passed to '${r}' must be ${e} tensor, but got ${t} tensor`)}}function vde(e,t,n,r="numeric"){if(e instanceof Gce)return gde(r,e.dtype,t,n),e;let i=sse(e);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),gde(r,i,t,n),null==e||!tse(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${null==e?"null":e.constructor.name}'`);const a=mde(e,i);tse(e)||Array.isArray(e)||(e=[e]);const o="string"!==i?Lce(e,i):Poe(e,[],!0);return cde.makeTensor(o,a,i)}function yde(e,t,n,r="numeric"){if(!Array.isArray(e))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map((e,i)=>vde(e,`${t}[${i}]`,n,r))}pde.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),pde.registerFlag("IS_BROWSER",()=>fde()),pde.registerFlag("IS_NODE",()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node),pde.registerFlag("IS_CHROME",()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),pde.registerFlag("PROD",()=>!1),pde.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>pde.getBool("DEBUG")),pde.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),pde.registerFlag("IS_TEST",()=>!1),pde.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);const bde="__op";function xde(e){const t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");let n=t[0];const r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=bde;const i=(...e)=>{cde.startScope(n);try{const t=r(...e);return yse(t)&&console.error("Cannot return a Promise inside of tidy."),cde.endScope(t),t}catch(t){throw cde.endScope(null),t}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}const wde=xde({complex_:function(e,t){const n=vde(e,"real","complex"),r=vde(t,"imag","complex");return Foe(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`),cde.runKernel(Kse,{real:n,imag:r})}});function _de(e,t,n,r){if(null==r&&(r=sse(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!tse(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){mse(t);const e=Loe(t),r=Loe(n);joe(e===r,()=>`Based on the provided shape, [${t}], the tensor should have ${e} values but has ${r}`);for(let i=0;i<n.length;++i){const e=n[i],r=i!==n.length-1||e!==Loe(t.slice(i));joe(n[i]===t[i]||!r,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `)}}return tse(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?Lce(e,r):Poe(e,[],!0),cde.makeTensor(e,t,r)}function kde(e,t,n){return _de(e,t,mde(e,n),n)}const Ede={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};async function Sde(e,t){const n=[],r=[],i=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);for(let a=0;a<i.length;++a){const o=i[a],s=Array.isArray(e)?e[a].tensor:e[o];if("float32"!==s.dtype&&"int32"!==s.dtype&&"bool"!==s.dtype&&"string"!==s.dtype&&"complex64"!==s.dtype)throw new Error(`Unsupported dtype in weight '${o}': ${s.dtype}`);const l={name:o,shape:s.shape,dtype:s.dtype};if("string"===s.dtype){const e=new Promise(async e=>{const t=await s.bytes(),n=t.reduce((e,t)=>e+t.length,0)+4*t.length,r=new Uint8Array(n);let i=0;for(let a=0;a<t.length;a++){const e=t[a],n=new Uint8Array(new Uint32Array([e.length]).buffer);r.set(n,i),i+=4,r.set(e,i),i+=e.length}e(r)});r.push(e)}else r.push(s.data());null!=t&&(l.group=t),n.push(l)}return{data:Cde(await Promise.all(r)),specs:n}}function Tde(e,t){const n={};let r,i=0;for(const a of t){const t=a.name,o=a.dtype,s=a.shape,l=Loe(s);let u;if("quantization"in a){const n=a.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${a.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${a.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==o)throw new Error(`Weight ${a.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${o}.`)}const s=Ede[n.dtype],c=e.slice(i,i+l*s),d="uint8"===n.dtype?new Uint8Array(c):new Uint16Array(c);if("float32"===o)if("uint8"===n.dtype||"uint16"===n.dtype){u=new Float32Array(d.length);for(let e=0;e<d.length;e++)u[e]=d[e]*n.scale+n.min}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=Nde()),u=r(d)}else{if("int32"!==o)throw new Error(`Unsupported dtype in weight '${t}': ${o}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);u=new Int32Array(d.length);for(let e=0;e<d.length;e++)u[e]=Math.round(d[e]*n.scale+n.min)}i+=l*s}else if("string"===o){const t=Loe(a.shape);u=[];for(let n=0;n<t;n++){const t=new Uint32Array(e.slice(i,i+4))[0];i+=4;const n=new Uint8Array(e.slice(i,i+t));u.push(n),i+=t}}else{const r=Ede[o],a=e.slice(i,i+l*r);if("float32"===o)u=new Float32Array(a);else if("int32"===o)u=new Int32Array(a);else if("bool"===o)u=new Uint8Array(a);else{if("complex64"!==o)throw new Error(`Unsupported dtype in weight '${t}': ${o}`);{u=new Float32Array(a);const e=new Float32Array(u.length/2),r=new Float32Array(u.length/2);for(let t=0;t<e.length;t++)e[t]=u[2*t],r[t]=u[2*t+1];const i=kde(e,s,"float32"),o=kde(r,s,"float32");n[t]=wde(i,o),i.dispose(),o.dispose()}}i+=l*r}"complex64"!==o&&(n[t]=kde(u,s,o))}return n}function Cde(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));let t=0;const n=[];e.forEach(e=>{if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)});const r=new Uint8Array(t);let i=0;return n.forEach(e=>{r.set(new Uint8Array(e.buffer),i),i+=e.byteLength}),r.buffer}const Ide="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function Ade(e){return Ide?Buffer.byteLength(e):new Blob([e]).size}function Ode(e){if(1===e.length)return e[0];let t=0;e.forEach(e=>{t+=e.byteLength});const n=new Uint8Array(t);let r=0;return e.forEach(e=>{n.set(new Uint8Array(e),r),r+=e.byteLength}),n.buffer}function Dde(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);const t=e.split("/");return t[t.length-1]}function Mde(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:Ade(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:Ade(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function Nde(){const e=function(){const e=e=>{let t=e<<13,n=0;for(;0==(8388608&t);)n-=8388608,t<<=1;return t&=-8388609,n+=947912704,t|n},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let n=1024;n<2048;n++)t[n]=939524096+(n-1024<<13);return t}(),t=function(){const e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}(),n=function(){const e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return r=>{const i=new ArrayBuffer(4*r.length),a=new Uint32Array(i);for(let o=0;o<r.length;o++){const i=r[o];a[o]=e[n[i>>10]+(1023&i)]+t[i>>10]}return new Float32Array(i)}}class jde{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==jde.instance&&(jde.instance=new jde),jde.instance}static registerSaveRouter(e){jde.getInstance().saveRouters.push(e)}static registerLoadRouter(e){jde.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return jde.getHandlers(e,"save")}static getLoadHandlers(e,t){return jde.getHandlers(e,"load",t)}static getHandlers(e,t,n){const r=[];return("load"===t?jde.getInstance().loadRouters:jde.getInstance().saveRouters).forEach(t=>{const i=t(e,n);null!==i&&r.push(i)}),r}}const Fde=e=>jde.registerSaveRouter(e),Rde=e=>jde.registerLoadRouter(e),Pde=e=>jde.getSaveHandlers(e),Lde=(e,t)=>jde.getLoadHandlers(e,t),Bde="tensorflowjs",$de="models_store",zde="model_info_store";function Ude(){if(!xse().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Hde(e){const t=e.result;t.createObjectStore($de,{keyPath:"modelPath"}),t.createObjectStore(zde,{keyPath:"modelPath"})}class Wde{constructor(e){if(this.indexedDB=Ude(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((e,n)=>{const r=this.indexedDB.open(Bde,1);r.onupgradeneeded=()=>Hde(r),r.onsuccess=()=>{const i=r.result;if(null==t){const t=i.transaction($de,"readonly"),r=t.objectStore($de).get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return i.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));e(r.result.modelArtifacts)},r.onerror=e=>(i.close(),n(r.error)),t.oncomplete=()=>i.close()}else{const r=Mde(t),a=i.transaction(zde,"readwrite");let o=a.objectStore(zde);const s=o.put({modelPath:this.modelPath,modelArtifactsInfo:r});let l;s.onsuccess=()=>{l=i.transaction($de,"readwrite");const s=l.objectStore($de).put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:r});s.onsuccess=()=>e({modelArtifactsInfo:r}),s.onerror=e=>{o=a.objectStore(zde);const t=o.delete(this.modelPath);t.onsuccess=()=>(i.close(),n(s.error)),t.onerror=e=>(i.close(),n(s.error))}},s.onerror=e=>(i.close(),n(s.error)),a.oncomplete=()=>{null==l?i.close():l.oncomplete=()=>i.close()}}},r.onerror=e=>n(r.error)})}}Wde.URL_SCHEME="indexeddb://";const Vde=e=>{return xse().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Wde.URL_SCHEME)?(t=e.slice(Wde.URL_SCHEME.length),new Wde(t)):null;var t};jde.registerSaveRouter(Vde),jde.registerLoadRouter(Vde);class qde{constructor(){this.indexedDB=Ude()}async listModels(){return new Promise((e,t)=>{const n=this.indexedDB.open(Bde,1);n.onupgradeneeded=()=>Hde(n),n.onsuccess=()=>{const r=n.result,i=r.transaction(zde,"readonly"),a=i.objectStore(zde).getAll();a.onsuccess=()=>{const t={};for(const e of a.result)t[e.modelPath]=e.modelArtifactsInfo;e(t)},a.onerror=e=>(r.close(),t(a.error)),i.oncomplete=()=>r.close()},n.onerror=e=>t(n.error)})}async removeModel(e){var t;return e=(t=e).startsWith(Wde.URL_SCHEME)?t.slice(Wde.URL_SCHEME.length):t,new Promise((t,n)=>{const r=this.indexedDB.open(Bde,1);r.onupgradeneeded=()=>Hde(r),r.onsuccess=()=>{const i=r.result,a=i.transaction(zde,"readwrite"),o=a.objectStore(zde),s=o.get(e);let l;s.onsuccess=()=>{if(null==s.result)return i.close(),n(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const r=o.delete(e),a=()=>{l=i.transaction($de,"readwrite");const r=l.objectStore($de).delete(e);r.onsuccess=()=>t(s.result.modelArtifactsInfo),r.onerror=e=>n(s.error)};r.onsuccess=a,r.onerror=e=>(a(),i.close(),n(s.error))}},s.onerror=e=>(i.close(),n(s.error)),a.oncomplete=()=>{null==l?i.close():l.oncomplete=()=>i.close()}},r.onerror=e=>n(r.error)})}}const Gde="/",Yde="tensorflowjs_models",Xde="info",Kde="model_topology",Zde="weight_specs",Jde="weight_data",Qde="model_metadata";function ehe(e){return{info:[Yde,e,Xde].join(Gde),topology:[Yde,e,Kde].join(Gde),weightSpecs:[Yde,e,Zde].join(Gde),weightData:[Yde,e,Jde].join(Gde),modelMetadata:[Yde,e,Qde].join(Gde)}}function the(e){const t=e.split(Gde);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(Gde)}class nhe{constructor(e){if(!xse().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=ehe(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=Mde(e);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(e){if(Ide)return Buffer.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let r=0,i=t.length;r<i;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData));const t={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};return null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer),this.LS.setItem(this.keys.modelMetadata,JSON.stringify(t)),{modelArtifactsInfo:i}}catch(t){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(null==e)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(null!=i){const e=JSON.parse(i);t.format=e.format,t.generatedBy=e.generatedBy,t.convertedBy=e.convertedBy,null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer)}const a=this.LS.getItem(this.keys.weightData);if(null==a)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=function(e){if(Ide){const t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;++r)n.set([t.charCodeAt(r)],r);return n.buffer}(a),t}}nhe.URL_SCHEME="localstorage://";const rhe=e=>{return xse().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(nhe.URL_SCHEME)?(t=e.slice(nhe.URL_SCHEME.length),new nhe(t)):null;var t};jde.registerSaveRouter(rhe),jde.registerLoadRouter(rhe);class ihe{constructor(){joe(xse().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),joe("undefined"==typeof window||void 0!==window.localStorage,()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Yde+Gde,n=Gde+Xde;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);i.startsWith(t)&&i.endsWith(n)&&(e[the(i)]=JSON.parse(this.LS.getItem(i)))}return e}async removeModel(e){var t;const n=ehe(e=(t=e).startsWith(nhe.URL_SCHEME)?t.slice(nhe.URL_SCHEME.length):t);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${e}'`);const r=JSON.parse(this.LS.getItem(n.info));return this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),r}}const ahe="://";class ohe{constructor(){this.managers={}}static getInstance(){return null==ohe.instance&&(ohe.instance=new ohe),ohe.instance}static registerManager(e,t){joe(null!=e,()=>"scheme must not be undefined or null."),e.endsWith(ahe)&&(e=e.slice(0,e.indexOf(ahe))),joe(e.length>0,()=>"scheme must not be an empty string.");const n=ohe.getInstance();joe(null==n.managers[e],()=>`A model store manager is already registered for scheme '${e}'.`),n.managers[e]=t}static getManager(e){const t=this.getInstance().managers[e];if(null==t)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(this.getInstance().managers)}}function she(e){if(-1===e.indexOf(ahe))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+ohe.getSchemes().join(","));return{scheme:e.split(ahe)[0],path:e.split(ahe)[1]}}async function lhe(e,t,n=!1){joe(e!==t,()=>`Old path and new path are the same: '${e}'`);const r=jde.getLoadHandlers(e);joe(r.length>0,()=>`Copying failed because no load handler is found for source URL ${e}.`),joe(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${e}.`);const i=r[0],a=jde.getSaveHandlers(t);joe(a.length>0,()=>`Copying failed because no save handler is found for destination URL ${t}.`),joe(a.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${t}.`);const o=a[0],s=she(e).scheme,l=she(e).path,u=s===she(e).scheme,c=await i.load();n&&u&&await ohe.getManager(s).removeModel(l);const d=await o.save(c);return n&&!u&&await ohe.getManager(s).removeModel(l),d.modelArtifactsInfo}async function uhe(){const e=ohe.getSchemes(),t={};for(const n of e){const e=await ohe.getManager(n).listModels();for(const r in e)t[n+ahe+r]=e[r]}return t}async function che(e){const t=she(e);return ohe.getManager(t.scheme).removeModel(t.path)}async function dhe(e,t){return lhe(e,t,!1)}async function hhe(e,t){return lhe(e,t,!0)}class fhe{fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}}if(xse().get("IS_BROWSER")){xse().setPlatform("browser",new fhe);try{ohe.registerManager(nhe.URL_SCHEME,new ihe)}catch(qqe){}try{ohe.registerManager(Wde.URL_SCHEME,new qde)}catch(qqe){}}let phe;function mhe(e,t="float32",n){return t=t||"float32",mse(e),new Hce(e,t,n)}xse().get("IS_NODE")&&xse().setPlatform("node",new class{constructor(){this.util=n(2),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return null!=xse().global.fetch?xse().global.fetch(e,t):(null==phe&&(phe=n(1)),phe(e,t))}now(){const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)}decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}});const ghe=xde({cast_:function(e,t){const n=vde(e,"x","cast");if(!Qoe(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");return cde.runKernel(Gse,{x:n},{dtype:t})}}),vhe=xde({clone_:function(e){const t=vde(e,"x","clone","string_or_numeric");return cde.runKernel(Rle,{x:t})}});function yhe(e,t=!1){console.log(e.toString(t))}function bhe(e){return new Promise(e=>setTimeout(e)).then(e)}ude(),Vce={buffer:mhe,cast:ghe,clone:vhe,print:yhe};class xhe{constructor(e){if(!xse().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(xhe.URL_SCHEME)&&(e=e.slice(xhe.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelTopologyFileName=e+".json",this.weightDataFileName=e+".weights.bin"}async save(e){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]};null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer);const r=window.URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"})),i=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor;if(i.download=this.modelTopologyFileName,i.href=r,await bhe(()=>i.dispatchEvent(new MouseEvent("click"))),null!=e.weightData){const e=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;e.download=this.weightDataFileName,e.href=t,await bhe(()=>e.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Mde(e)}}}}xhe.URL_SCHEME="downloads://";class whe{constructor(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}async load(){const e=this.files[0],t=this.files.slice(1);return new Promise((n,r)=>{const i=new FileReader;i.onload=i=>{const a=JSON.parse(i.target.result),o=a.modelTopology;if(null==o)return void r(new Error("modelTopology field is missing from file "+e.name));0===t.length&&n({modelTopology:o});const s=a.weightsManifest;if(null==s)return void r(new Error("weightManifest field is missing from file "+e.name));let l;try{l=this.checkManifestAndWeightFiles(s,t)}catch(qqe){return void r(qqe)}const u=[],c=[],d=[];s.forEach(e=>{e.paths.forEach(e=>{c.push(e),d.push(null)}),u.push(...e.weights)}),s.forEach(e=>{e.paths.forEach(e=>{const t=new FileReader;t.onload=t=>{const r=t.target.result,i=c.indexOf(e);if(d[i]=r,-1===d.indexOf(null)){const e={modelTopology:o,weightSpecs:u,weightData:Ode(d),format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy};null!=a.signature&&(e.signature=a.signature),null!=a.userDefinedMetadata&&(e.userDefinedMetadata=a.userDefinedMetadata),null!=a.modelInitializer&&(e.modelInitializer=a.modelInitializer),n(e)}},t.onerror=t=>r(`Failed to weights data from file of path '${e}'.`),t.readAsArrayBuffer(l[e])})})},i.onerror=t=>r(`Failed to read model topology and weights manifest JSON from file '${e.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),i.readAsText(e)})}checkManifestAndWeightFiles(e,t){const n=[],r=t.map(e=>Dde(e.name)),i={};for(const a of e)a.paths.forEach(e=>{const a=Dde(e);if(-1!==n.indexOf(a))throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(n.push(a),-1===r.indexOf(a))throw new Error(`Weight file with basename '${a}' is not provided.`);i[e]=t[r.indexOf(a)]});if(n.length!==t.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${t.length}).`);return i}}function _he(e){return new whe(e)}function khe(e,t,n,r){!function(e){joe(null!=e&&Array.isArray(e)&&e.length>0,()=>"promises must be a none empty array")}(e),function(e,t){joe(e>=0&&e<=1,()=>"Progress fraction must be in range [0, 1], but got startFraction "+e),joe(t>=0&&t<=1,()=>"Progress fraction must be in range [0, 1], but got endFraction "+t),joe(t>=e,()=>`startFraction must be no more than endFraction, but got startFraction ${e} and endFraction `+t)}(n=null==n?0:n,r=null==r?1:r);let i=0;return Promise.all(e.map(a=>(a.then(a=>{const o=n+ ++i/e.length*(r-n);return t(o),a}),a)))}async function Ehe(e,t){null==t&&(t={});const n=null==t.fetchFunc?xse().platform.fetch:t.fetchFunc,r=e.map(e=>n(e,t.requestInit,{isBinary:!0})),i=(null==t.onProgress?await Promise.all(r):await khe(r,t.onProgress,0,.5)).map(e=>e.arrayBuffer());return null==t.onProgress?await Promise.all(i):await khe(i,t.onProgress,.5,1)}async function She(e,t="",n,r){return The(e=>Ehe(e,{requestInit:r}))(e,t,n)}function The(e){return async(t,n="",r)=>{const i=t.map(()=>!1),a={},o=null!=r?r.map(()=>!1):[],s=[];if(t.forEach((e,t)=>{let n=0;e.weights.forEach(e=>{const l=Ede["quantization"in e?e.quantization.dtype:e.dtype]*Loe(e.shape),u=()=>{i[t]=!0,null==a[t]&&(a[t]=[]),a[t].push({manifestEntry:e,groupOffset:n,sizeBytes:l})};null!=r?r.forEach((t,n)=>{t===e.name&&(u(),o[n]=!0)}):u(),s.push(e.name),n+=l})}),!o.every(e=>e)){const e=r.filter((e,t)=>!o[t]);throw new Error("Could not find weights in manifest with names: "+e.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".")}const l=i.reduce((e,t,n)=>(t&&e.push(n),e),[]),u=[];l.forEach(e=>{t[e].paths.forEach(e=>{const t=n+(n.endsWith("/")?"":"/")+e;u.push(t)})});const c=await e(u),d={};let h=0;return l.forEach(e=>{const n=t[e].paths.length;let r=0;for(let t=0;t<n;t++)r+=c[h+t].byteLength;const i=new ArrayBuffer(r),o=new Uint8Array(i);let s=0;for(let t=0;t<n;t++){const e=new Uint8Array(c[h+t]);o.set(e,s),s+=e.byteLength}a[e].forEach(e=>{const t=Tde(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(const n in t)d[n]=t[n]}),h+=n}),d}}jde.registerSaveRouter(e=>xse().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(xhe.URL_SCHEME)?function(e="model"){return new xhe(e)}(e.slice(xhe.URL_SCHEME.length)):null);class Che{constructor(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?(joe("function"==typeof t.fetchFunc,()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=xse().platform.fetch,joe(null!=e&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&joe(2===e.length,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:[{paths:["./model.weights.bin"],weights:e.weightSpecs}]};null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),t.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,t);if(r.ok)return{modelArtifactsInfo:Mde(e),responses:[r]};throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+r.status+".")}async load(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code `+e.status+". Please verify this URL points to the model JSON of the model to load.");let t;try{t=await e.json()}catch(f){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=t.modelTopology,r=t.weightsManifest,i=t.generatedBy,a=t.convertedBy,o=t.format,s=t.signature,l=t.userDefinedMetadata;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);let u,c;if(null!=r){const e=await this.loadWeights(r);[u,c]=e}const d={modelTopology:n,weightSpecs:u,weightData:c,generatedBy:i,convertedBy:a,format:o};null!=s&&(d.signature=s),null!=l&&(d.userDefinedMetadata=l);const h=t.modelInitializer;return h&&(d.modelInitializer=h),d}async loadWeights(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),i=this.weightPathPrefix||n,a=[];for(const l of e)a.push(...l.weights);const o=[],s=[];for(const l of e)for(const e of l.paths)null!=this.weightUrlConverter?s.push(this.weightUrlConverter(e)):o.push(i+e+r);return this.weightUrlConverter&&o.push(...await Promise.all(s)),[a,Ode(await Ehe(o,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress}))]}}function Ihe(e){return null!=e.match(Che.URL_SCHEME_REGEX)}Che.URL_SCHEME_REGEX=/^https?:\/\//;const Ahe=(e,t)=>{if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;{let n=!0;if(n=Array.isArray(e)?e.every(e=>Ihe(e)):Ihe(e),n)return Ohe(e,t)}return null};function Ohe(e,t){return new Che(e,t)}function Dhe(e,t){return Ohe(e,t)}jde.registerSaveRouter(Ahe),jde.registerLoadRouter(Ahe);class Mhe{constructor(e){this.modelArtifacts=e}async load(){return this.modelArtifacts}}class Nhe{constructor(e){this.saveHandler=e}async save(e){return this.saveHandler(e)}}function jhe(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new Mhe(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Mhe({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Mhe({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function Fhe(e){return new Nhe(e)}const Rhe=xde({matMul_:function(e,t,n=!1,r=!1){let i=vde(e,"a","matMul"),a=vde(t,"b","matMul");return[i,a]=rde(i,a),cde.runKernel(Hse,{a:i,b:a},{transposeA:n,transposeB:r})}}),Phe=xde({oneHot_:function(e,t,n=1,r=0){if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);const i=vde(e,"indices","oneHot","int32");return cde.runKernel(xue,{indices:i},{depth:t,onValue:n,offValue:r})}}),Lhe=xde({transpose_:function(e,t){const n=vde(e,"x","transpose");return null==t&&(t=n.shape.map((e,t)=>t).reverse()),joe(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${t}.`),t.forEach(e=>{joe(e>=0&&e<n.rank,()=>"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t)}),n.rank<=1?n.clone():cde.runKernel(uce,{x:n},{perm:t})}}),Bhe=xde({confusionMatrix_:function(e,t,n){const r=vde(e,"labels","confusionMatrix"),i=vde(t,"predictions","confusionMatrix");joe(null==n||n>0&&Number.isInteger(n),()=>"If provided, numClasses must be a positive integer, but got "+n),joe(1===r.rank,()=>"Expected the rank of labels to be 1, but got "+r.rank),joe(1===i.rank,()=>"Expected the rank of predictions to be 1, but got "+i.rank),joe(r.shape[0]===i.shape[0],()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${i.shape[0]}. Labels and predictions should have the same number of elements.`),joe(n>0&&Number.isInteger(n),()=>"numClasses is required to be a positive integer, but got "+n);const a=Phe(ghe(r,"int32"),n),o=Phe(ghe(i,"int32"),n),s=Lhe(a),l=Rhe(s,o);return ghe(l,"int32")}});function $he(e,t,n){if(Roe(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");const r=mde(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return _de(e,t,r,n)}let zhe;async function Uhe(e,t){let n=vde(e,"img","toPixels");if(!(e instanceof Gce)){const e=n;n=ghe(e,"int32"),e.dispose()}if(2!==n.rank&&3!==n.rank)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[r,i]=n.shape.slice(0,2),a=2===n.rank?1:n.shape[2];if(a>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);if("float32"!==n.dtype&&"int32"!==n.dtype)throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);const o=await n.data(),s="float32"===n.dtype?255:1,l=new Uint8ClampedArray(i*r*4);for(let u=0;u<r*i;++u){const e=[0,0,0,255];for(let r=0;r<a;r++){const t=o[u*a+r];if("float32"===n.dtype){if(t<0||t>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${t}.`)}else if("int32"===n.dtype&&(t<0||t>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${t}.`);1===a?(e[0]=t*s,e[1]=t*s,e[2]=t*s):e[r]=t*s}const t=4*u;l[t+0]=Math.round(e[0]),l[t+1]=Math.round(e[1]),l[t+2]=Math.round(e[2]),l[t+3]=Math.round(e[3])}if(null!=t){t.width=i,t.height=r;const e=t.getContext("2d"),n=new ImageData(l,i,r);e.putImageData(n,0,0)}return n!==e&&n.dispose(),l}const Hhe=xde({fromPixels_:function(e,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,i=!1,a=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);o=!0}if(i){const t=2;if(i&&e.readyState<t)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=_ce(mce,cde.backendName))return cde.runKernel(mce,{pixels:e},{numChannels:t});const[s,l]=i?[e.videoWidth,e.videoHeight]:[e.width,e.height];let u,c;if(o?u=e.getContext("2d").getImageData(0,0,s,l).data:r||n?u=e.data:(a||i)&&(null==zhe&&(zhe=document.createElement("canvas").getContext("2d")),zhe.canvas.width=s,zhe.canvas.height=l,zhe.drawImage(e,0,0,s,l),u=zhe.getImageData(0,0,s,l).data),4===t)c=new Int32Array(u);else{const e=s*l;c=new Int32Array(e*t);for(let n=0;n<e;n++)for(let e=0;e<t;++e)c[n*t+e]=u[4*n+e]}return $he(c,[l,s,t],"int32")}});function Whe(e,t){const n=e.shape.length,r=t.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==t.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[r-1]} vs. ${n}`);if(0===Loe(e.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);const i=t.shape,a=i[i.length-1];let o=1;for(let d=0;d<i.length-1;++d)o*=i[d];const s=e.shape,l=i.slice();l.pop();let u=1;for(let d=a;d<n;++d)u*=s[d],l.push(s[d]);const c=[...cse(e.shape).map(e=>e/u),1].slice(0,a);return[l,o,u,c]}function Vhe(e,t,n){const r=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+`, indices.shape: ${t.shape}, shape: ${e}`+`, sliceDim: ${r}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(a+` update.rank < ${i}. `);if(e.length<r+(n.rank-i))throw new Error(a+" Output shape length < "+(r+(n.rank-i)));if(n.rank!==i+e.length-r)throw new Error(a+" update.rank != "+(i+e.length-r));for(let o=0;o<i;++o)if(n.shape[o]!==t.shape[o])throw new Error(a+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${t.shape[o]}).`);for(let o=0;o<n.rank-i;++o)if(n.shape[o+i]!==e[o+r])throw new Error(a+` updates.shape[${o+i}] (${n.shape[o+i]}) != shape[${o+i}] (${e[o+i]})`)}function qhe(e,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}Vhe(n,t,e)}function Ghe(e,t,n){const r=t.shape.length,i=r>1?t.shape[r-1]:1,a=n.length;let o=1;for(let l=i;l<a;++l)o*=n[l];const s=i<1?1:i;return{sliceRank:i,numUpdates:Loe(t.shape)/s,sliceSize:o,strides:[...cse(n.slice(0,i)),1],outputSize:Loe(n)}}function Yhe(e,t,n){const r=e.shape.length;joe(r===t.length,()=>`Error in slice${r}D: Length of begin ${t} must match the rank of the array (${r}).`),joe(r===n.length,()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`);for(let i=0;i<r;++i)joe(t[i]+n[i]<=e.shape[i],()=>`Error in slice${r}D: begin[${i}] + size[${i}] (${t[i]+n[i]}) would overflow input.shape[${i}] (${e.shape[i]})`)}function Xhe(e){const t=[];let n=0;for(;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Khe(e,t,n){const r=[];for(let i=0;i<e.length;i++)r[i]=Math.ceil((t[i]-e[i])/n[i]);return r}function Zhe(e,t,n,r){const i=[...e];for(let a=i.length;a<r.length;a++)i.push(1);for(let a=0;a<n;a++)0===a?i[t]=1:(i.splice(t,0,1),i.pop());return i}function Jhe(e,t,n){return n<=e?n:n-(t-1)}function Qhe(e,t){const n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function efe(e,t,n,r,i,a,o,s,l){const u=e.length;let c=new Array(u),d=new Array(u),h=new Array(u);if(t.length&&n>0){const l=t[0],u=n+1;c=tfe(o,l,u,r,e),d=nfe(s,l,u,i,e),h=Zhe(a,l,u,e)}else for(let f=0;f<u;f++)c[f]=ife(o,r,a,e,f,l),d[f]=afe(s,i,a,e,f,l),h[f]=rfe(a,f,l);return{begin:c,end:d,strides:h}}function tfe(e,t,n,r,i){const a=[...i],o=Qhe(n,t);for(let s=0;s<a.length;s++)if(o.indexOf(s)>-1)a[s]=0;else{const i=Jhe(t,n,s);let o=r[i];e&1<<i&&(o=0),a[s]=o}return a}function nfe(e,t,n,r,i){const a=[...i],o=Qhe(n,t);for(let s=0;s<a.length;s++)if(o.indexOf(s)>-1)a[s]=Number.MAX_SAFE_INTEGER;else{const i=Jhe(t,n,s);let o=r[i];e&1<<i&&(o=Number.MAX_SAFE_INTEGER),a[s]=o}for(let s=0;s<a.length;s++){const e=i[s];a[s]<0&&(a[s]+=e),a[s]=Aoe(0,a[s],i[s])}return a}function rfe(e,t,n){let r=e[t];return(n&1<<t||null==r)&&(r=1),r}function ife(e,t,n,r,i,a){let o=t[i];(e&1<<i||a&1<<i||null==o)&&(o=(n[i]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const s=r[i];return o<0&&(o+=s),o=Aoe(0,o,s-1),o}function afe(e,t,n,r,i,a){let o=t[i];const s=n[i]||1;(e&1<<i||a&1<<i||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const l=r[i];return o<0&&(o+=l),o=s>0?Aoe(0,o,l):Aoe(-1,o,l-1),o}function ofe(e,t,n){let r=n.length;for(let i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(let i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function sfe(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function lfe(e,t,n){let r;const i=e.shape.length;let a;return r="number"==typeof t?[t,...new Array(i-1).fill(0)]:t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice(),r.forEach(e=>{joe(-1!==e,()=>"slice() does not support negative begin indexing.")}),a=null==n?new Array(i).fill(-1):"number"==typeof n?[n,...new Array(i-1).fill(-1)]:n.length<i?n.concat(new Array(i-n.length).fill(-1)):n,a=a.map((t,n)=>t>=0?t:(joe(-1===t,()=>`Negative size values should be exactly -1 but got ${t} for the slice() size at index ${n}.`),e.shape[n]-r[n])),[r,a]}function ufe(e,t,n,r,i,a,o,s,l){let u=t.slice(),c=n.slice(),d=r;null==r&&(d=new Array(u.length));const h=Xhe(o);if(h.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==o&&0!==s)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==o&&0!==l)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");const f=e.length-u.length,p=Xhe(s),m=e.slice();p.forEach(e=>{u[e]=0,c[e]=1,m.splice(e,0,1)});const{begin:g,end:v,strides:y}=efe(m,h,f,u,c,d,i,a,o);u=g,c=v,d=y;const b=Xhe(l);b.forEach(e=>{c[e]=u[e]+1,d[e]=1});const x=Khe(u,c,d),w=x.filter((e,t)=>-1===b.indexOf(t));return{nonStrided:d.every(e=>1===e),$begin:u,$end:c,$strides:d,size:x,newShape:m,outShape:w}}class cfe{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class dfe{constructor(){this.classNameMap={}}static getMap(){return null==dfe.instance&&(dfe.instance=new dfe),dfe.instance}static register(e){dfe.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function hfe(e){joe(null!=e.className,()=>"Class being registered does not have the static className property defined."),joe("string"==typeof e.className,()=>"className is required to be a string, but got type "+typeof e.className),joe(e.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),dfe.register(e)}const ffe=.1;function pfe(e,t,n){return null==n&&(n=mfe()),gfe(e,t,(e,t)=>xfe(e,t,n))}function mfe(){return 32===cde.backend.floatPrecision()?.001:ffe}function gfe(e,t,n){let r=!0;if((tse(e)||tse(t))&&(r=!1),tse(e)&&tse(t)&&(r=!0),r){const n=e.constructor.name,r=t.constructor.name;if(n!==r)throw new Error(`Arrays are of different type. Actual: ${n}. Expected: `+r)}if(Array.isArray(e)&&Array.isArray(t)){const n=mde(e),r=mde(t);if(!$oe(n,r))throw new Error(`Arrays have different shapes. Actual: [${n}]. Expected: [${r}]`)}const i=tse(e)?e:Poe(e),a=tse(t)?t:Poe(t);if(i.length!==a.length)throw new Error(`Arrays have different lengths actual: ${i.length} vs expected: ${a.length}.\nActual:   ${i}.\nExpected: ${a}.`);for(let o=0;o<a.length;++o){const e=i[o],t=a[o];if(!n(e,t))throw new Error(`Arrays differ: actual[${o}] = ${e}, expected[${o}] = ${t}.\nActual:   ${i}.\nExpected: ${a}.`)}}function vfe(e,t){e().then(()=>t.fail(),()=>t())}function yfe(e,t){const n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return ise(e)||ise(e[0])||ise(t)||ise(t[0])?gfe(e,n,(e,t)=>e==t):gfe(e,t,(e,t)=>xfe(e,t,0))}function bfe(e,t,n){if(null==n&&(n=mfe()),!xfe(e,t,n))throw new Error(`Numbers differ: actual === ${e}, expected === ${t}`)}function xfe(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function wfe(e,t,n){for(let r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error(`Value out of range:${e[r]} low: ${t}, high: ${n}`)}function _fe(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}function kfe(e){for(let t=0;t<e.length;t++){const n=e[t];Array.isArray(n)?kfe(n):e[t]=zce(n)}return e}const Efe="2.8.2";function Sfe(){xse().set("PROD",!0)}function Tfe(){xse().set("DEBUG",!0)}function Cfe(){xse().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Ife(e){xse().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Afe(){cde.disposeVariables()}function Ofe(){return cde}function Dfe(){return cde.memory()}function Mfe(e){return cde.profile(e)}function Nfe(e,t){return cde.tidy(e,t)}function jfe(e){ode(e).forEach(e=>e.dispose())}function Ffe(e){return cde.keep(e)}function Rfe(e){return cde.time(e)}function Pfe(e){return cde.setBackend(e)}function Lfe(){return cde.ready()}function Bfe(){return cde.backendName}function $fe(e){cde.removeBackend(e)}function zfe(e){return cde.findBackend(e)}function Ufe(e){return cde.findBackendFactory(e)}function Hfe(e,t,n=1){return cde.registerBackend(e,t,n)}function Wfe(){return cde.backend}function Vfe(e,t){xse().setPlatform(e,t)}qce=Ife;const qfe=xde({add_:function(e,t){let n=vde(e,"a","add"),r=vde(t,"b","add");return[n,r]=rde(n,r),cde.runKernel(Ise,{a:n,b:r})}}),Gfe=xde({floorDiv_:function(e,t){let n=vde(e,"a","floorDiv"),r=vde(t,"b","floorDiv");return[n,r]=rde(n,r),cde.runKernel(Ole,{a:n,b:r})}}),Yfe=xde({div_:function(e,t){let n=vde(e,"a","div"),r=vde(t,"b","div");return[n,r]=rde(n,r),"int32"===n.dtype&&"int32"===r.dtype?Gfe(n,r):cde.runKernel(yle,{a:n,b:r},{})}}),Xfe=xde({mul_:function(e,t){let n=vde(e,"a","mul"),r=vde(t,"b","mul");return[n,r]=rde(n,r),cde.runKernel(fue,{a:n,b:r})}}),Kfe=xde({sqrt_:function(e){const t=vde(e,"x","sqrt");return cde.runKernel(Xue,{x:t})}}),Zfe=xde({square_:function(e){const t=vde(e,"x","square");return cde.runKernel("Square",{x:t},{})}}),Jfe=xde({zerosLike_:function(e){const t=vde(e,"x","zerosLike");return cde.runKernel(fce,{x:t})}});function Qfe(e){return joe(lse(e),()=>"The f passed in grad(f) must be a function"),(t,n)=>{const r=vde(t,"x","tf.grad","string_or_numeric"),i=null!=n?vde(n,"dy","tf.grad"):null;return cde.tidy(()=>{const{value:t,grads:n}=cde.gradients(()=>e(r),[r],i);return null!=i&&Foe(t.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),ape(n),n[0]})}}function epe(e){return joe(lse(e),()=>"The f passed in grads(f) must be a function"),(t,n)=>{joe(Array.isArray(t),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const r=yde(t,"args","tf.grads","string_or_numeric"),i=null!=n?vde(n,"dy","tf.grads"):null;return cde.tidy(()=>{const{value:t,grads:n}=cde.gradients(()=>e(...r),r,i);return null!=i&&Foe(t.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),ape(n),n})}}function tpe(e){return joe(lse(e),()=>"The f passed in valueAndGrad(f) must be a function"),(t,n)=>{joe(t instanceof Gce,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),joe(null==n||n instanceof Gce,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:r,value:i}=cde.gradients(()=>e(t),[t],n);return ape(r),{grad:r[0],value:i}}}function npe(e){return joe(lse(e),()=>"The f passed in valueAndGrads(f) must be a function"),(t,n)=>{joe(Array.isArray(t)&&t.every(e=>e instanceof Gce),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),joe(null==n||n instanceof Gce,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const r=cde.gradients(()=>e(...t),t,n);return null!=n&&Foe(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),ape(r.grads),r}}function rpe(e,t){joe(lse(e),()=>"The f passed in variableGrads(f) must be a function"),joe(null==t||Array.isArray(t)&&t.every(e=>e instanceof Yce),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=null!=t;if(!n){t=[];for(const e in cde.registeredVariables)t.push(cde.registeredVariables[e])}const r=n?t.filter(e=>!e.trainable):null,i=t.length;joe((t=t.filter(e=>e.trainable)).length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`);const{value:a,grads:o}=cde.gradients(e,t,null,!0);joe(o.some(e=>null!=e),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),joe(0===a.rank,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${a.rank} tensor`);const s={};return t.forEach((e,t)=>{null!=o[t]&&(s[e.name]=o[t])}),null!=r&&r.forEach(e=>s[e.name]=null),{value:a,grads:s}}function ipe(e){return cde.customGrad(e)}function ape(e){if(e.filter(e=>null==e).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}function ope(e,t){if((tse(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&tse(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return _de(e,[],[],t)}class spe extends cfe{minimize(e,t=!1,n){const{value:r,grads:i}=this.computeGradients(e,n);if(null!=n){const e=n.map(e=>({name:e.name,tensor:i[e.name]}));this.applyGradients(e)}else this.applyGradients(i);return jfe(i),t?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return rpe(e,t)}dispose(){null!=this.iterations_&&jfe(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:ope(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(spe,Symbol.hasInstance,{value:e=>null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients});class lpe extends spe{constructor(e,t,n=null){super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=cde.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=cde.registeredVariables[t];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:t+"/accum_grad",variable:Nfe(()=>Jfe(r).variable(!1))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:t+"/accum_var",variable:Nfe(()=>Jfe(r).variable(!1))});const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const a=this.accumulatedGrads[n].variable,o=this.accumulatedUpdates[n].variable;Nfe(()=>{const e=qfe(Xfe(a,this.rho),Xfe(Zfe(i),1-this.rho)),t=Xfe(Yfe(Kfe(qfe(o,this.epsilon)),Kfe(qfe(a,this.epsilon))),i),n=qfe(Xfe(o,this.rho),Xfe(Zfe(t),1-this.rho));a.assign(e),o.assign(n);const s=qfe(Xfe(t,-this.learningRate),r);r.assign(s)})}),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(jfe(this.accumulatedGrads.map(e=>e.variable)),jfe(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){const t=(e=await this.extractIterations(e)).length/2;this.accumulatedGrads=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(!1)})),this.accumulatedUpdates=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(!1)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}function upe(e,t,n){return cde.runKernel(Cle,{},{shape:e,value:t,dtype:n})}lpe.className="Adadelta",hfe(lpe);class cpe extends spe{constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=cde.registeredVariables[t];if(null==this.accumulatedGrads[n]){const e=!1;this.accumulatedGrads[n]={originalName:t+"/accumulator",variable:Nfe(()=>upe(r.shape,this.initialAccumulatorValue).variable(e))}}const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const a=this.accumulatedGrads[n].variable;Nfe(()=>{const e=qfe(a,Zfe(i));a.assign(e);const t=qfe(Xfe(Yfe(i,Kfe(qfe(e,cde.backend.epsilon()))),-this.learningRate),r);r.assign(t)})}),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&jfe(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e),this.accumulatedGrads=e.map(e=>({originalName:e.name,variable:e.tensor.variable(!1)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}cpe.className="Adagrad",hfe(cpe);const dpe=xde({pow_:function(e,t){let n=vde(e,"base","pow"),r=vde(t,"exp","pow");return[n,r]=rde(n,r),cde.runKernel(Eue,{a:n,b:r})}}),hpe=xde({sub_:function(e,t){let n=vde(e,"a","sub"),r=vde(t,"b","sub");return[n,r]=rde(n,r),cde.runKernel(nce,{a:n,b:r})}});class fpe extends spe{constructor(e,t,n,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Nfe(()=>{this.accBeta1=ope(t).variable(),this.accBeta2=ope(n).variable()}),null==r&&(this.epsilon=cde.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);Nfe(()=>{const n=hpe(1,this.accBeta1),r=hpe(1,this.accBeta2);t.forEach((t,i)=>{const a=cde.registeredVariables[t];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:t+"/m",variable:Nfe(()=>Jfe(a).variable(!1))}),null==this.accumulatedSecondMoment[i]&&(this.accumulatedSecondMoment[i]={originalName:t+"/v",variable:Nfe(()=>Jfe(a).variable(!1))});const o=Array.isArray(e)?e[i].tensor:e[t];if(null==o)return;const s=this.accumulatedFirstMoment[i].variable,l=this.accumulatedSecondMoment[i].variable,u=qfe(Xfe(s,this.beta1),Xfe(o,1-this.beta1)),c=qfe(Xfe(l,this.beta2),Xfe(Zfe(o),1-this.beta2)),d=Yfe(u,n),h=Yfe(c,r);s.assign(u),l.assign(c);const f=qfe(Xfe(Yfe(d,qfe(Kfe(h),this.epsilon)),-this.learningRate),a);a.assign(f)}),this.accBeta1.assign(Xfe(this.accBeta1,this.beta1)),this.accBeta2.assign(Xfe(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&jfe(this.accumulatedFirstMoment.map(e=>e.variable)),null!=this.accumulatedSecondMoment&&jfe(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e),Nfe(()=>{this.accBeta1.assign(dpe(this.beta1,this.iterations_+1)),this.accBeta2.assign(dpe(this.beta2,this.iterations_+1))});const t=e.length/2;this.accumulatedFirstMoment=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(!1)})),this.accumulatedSecondMoment=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(!1)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}fpe.className="Adam",hfe(fpe);const ppe=xde({abs_:function(e){const t=vde(e,"x","abs");return cde.runKernel("complex64"===t.dtype?Zse:Sse,{x:t})}});function mpe(e,t){const n=e.length,r=[];for(let i=0;i<n;i++){const a=n-1-i,o=e[a]||1;(t[t.length-1-i]||1)>1&&1===o&&r.unshift(a)}return r}function gpe(e,t){const n=[];for(let r=0;r<t.length;r++){const i=e[e.length-r-1],a=t.length-r-1,o=t[a];(null==i||1===i&&o>1)&&n.unshift(a)}return n}function vpe(e,t){const n=[],r=Math.max(e.length,t.length);for(let i=0;i<r;i++){let r=e[e.length-i-1];null==r&&(r=1);let a=t[t.length-i-1];if(null==a&&(a=1),1===r)n.unshift(a);else if(1===a)n.unshift(r);else{if(r!==a)throw Error(`Operands could not be broadcast together with shapes ${e} and ${t}.`);n.unshift(r)}}return n}const ype=xde({maximum_:function(e,t){let n=vde(e,"a","maximum"),r=vde(t,"b","maximum");return[n,r]=rde(n,r),"bool"===n.dtype&&(n=ghe(n,"int32"),r=ghe(r,"int32")),vpe(n.shape,r.shape),cde.runKernel(tue,{a:n,b:r})}});class bpe extends spe{constructor(e,t,n,r=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Nfe(()=>{this.iteration=ope(0).variable(),this.accBeta1=ope(t).variable()}),null==r&&(this.epsilon=cde.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);Nfe(()=>{const n=hpe(1,this.accBeta1),r=Yfe(-this.learningRate,qfe(Xfe(this.iteration,this.decay),1));t.forEach((t,i)=>{const a=cde.registeredVariables[t];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:t+"/m",variable:Jfe(a).variable(!1)}),null==this.accumulatedWeightedInfNorm[i]&&(this.accumulatedWeightedInfNorm[i]={originalName:t+"/v",variable:Jfe(a).variable(!1)});const o=Array.isArray(e)?e[i].tensor:e[t];if(null==o)return;const s=this.accumulatedFirstMoment[i].variable,l=this.accumulatedWeightedInfNorm[i].variable,u=qfe(Xfe(s,this.beta1),Xfe(o,1-this.beta1)),c=Xfe(l,this.beta2),d=ppe(o),h=ype(c,d);s.assign(u),l.assign(h);const f=qfe(Xfe(Yfe(r,n),Yfe(u,qfe(h,this.epsilon))),a);a.assign(f)}),this.iteration.assign(qfe(this.iteration,1)),this.accBeta1.assign(Xfe(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&jfe(this.accumulatedFirstMoment.map(e=>e.variable)),null!=this.accumulatedWeightedInfNorm&&jfe(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}bpe.className="Adamax",hfe(bpe);class xpe extends spe{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=Array.isArray(e)?e[n].tensor:e[t];if(null==r)return;const i=cde.registeredVariables[t];Nfe(()=>{const e=qfe(Xfe(this.c,r),i);i.assign(e)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=Ffe(ope(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(0!==(e=await this.extractIterations(e)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}xpe.className="SGD",hfe(xpe);class wpe extends xpe{constructor(e,t,n=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=ope(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=cde.registeredVariables[t];if(null==this.accumulations[n]){const e=!1;this.accumulations[n]={originalName:t+"/momentum",variable:Nfe(()=>Jfe(r).variable(e))}}const i=this.accumulations[n].variable,a=Array.isArray(e)?e[n].tensor:e[t];null!=a&&Nfe(()=>{let e;const t=qfe(Xfe(this.m,i),a);e=qfe(Xfe(this.c,this.useNesterov?qfe(a,Xfe(t,this.m)):t),r),i.assign(t),r.assign(e)})}),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&jfe(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e),this.accumulations=e.map(e=>({originalName:e.name,variable:e.tensor.variable(!1)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}wpe.className="Momentum",hfe(wpe);class _pe extends spe{constructor(e,t=.9,n=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,null==r&&(this.epsilon=cde.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=cde.registeredVariables[t],i=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:t+"/rms",variable:Nfe(()=>Jfe(r).variable(i))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:t+"/momentum",variable:Nfe(()=>Jfe(r).variable(i))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:t+"/mg",variable:Nfe(()=>Jfe(r).variable(i))});const a=Array.isArray(e)?e[n].tensor:e[t];if(null==a)return;const o=this.accumulatedMeanSquares[n].variable,s=this.accumulatedMoments[n].variable;Nfe(()=>{const e=qfe(Xfe(o,this.decay),Xfe(Zfe(a),1-this.decay));if(this.centered){const t=this.accumulatedMeanGrads[n].variable,i=qfe(Xfe(t,this.decay),Xfe(a,1-this.decay)),l=Yfe(Xfe(a,this.learningRate),Kfe(hpe(e,qfe(Zfe(i),this.epsilon)))),u=qfe(Xfe(s,this.momentum),l);o.assign(e),t.assign(i),s.assign(u);const c=hpe(r,u);r.assign(c)}else{const e=qfe(Xfe(o,this.decay),Xfe(Zfe(a),1-this.decay)),t=qfe(Xfe(s,this.momentum),Yfe(Xfe(a,this.learningRate),Kfe(qfe(e,this.epsilon))));o.assign(e),s.assign(t);const n=hpe(r,t);r.assign(n)}})}),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&jfe(this.accumulatedMeanSquares.map(e=>e.variable)),null!=this.accumulatedMeanGrads&&this.centered&&jfe(this.accumulatedMeanGrads.map(e=>e.variable)),null!=this.accumulatedMoments&&jfe(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedMoments=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}_pe.className="RMSProp",hfe(_pe);const kpe=xde({acos_:function(e){const t=vde(e,"x","acos");return cde.runKernel(Tse,{x:t})}}),Epe=xde({acosh_:function(e){const t=vde(e,"x","acosh");return cde.runKernel(Cse,{x:t})}}),Spe=xde({addN_:function(e){joe(Array.isArray(e),()=>"The argument passed to tf.addN() must be a list of tensors"),joe(e.length>=1,()=>"Must pass at least one tensor to tf.addN(), but got "+e.length);const t=e.map((e,t)=>vde(e,"tensors"+t,"addN")),n=t[0];return t.forEach(e=>{if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(e=>{if(!$oe(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),cde.runKernel(Ase,t)}}),Tpe=xde({all_:function(e,t=null,n=!1){const r=vde(e,"x","all","bool");return cde.runKernel(Ose,{x:r},{axis:t,keepDims:n})}}),Cpe=xde({any_:function(e,t=null,n=!1){const r=vde(e,"x","any","bool");return cde.runKernel(Dse,{x:r},{axis:t,keepDims:n})}}),Ipe=xde({argMax_:function(e,t=0){const n=vde(e,"x","argMax");return cde.runKernel(Mse,{x:n},{axis:t})}}),Ape=xde({argMin_:function(e,t=0){const n=vde(e,"x","argMin");return cde.runKernel(Nse,{x:n},{axis:t})}}),Ope=xde({asin_:function(e){const t=vde(e,"x","asin");return cde.runKernel(jse,{x:t})}}),Dpe=xde({asinh_:function(e){const t=vde(e,"x","asinh");return cde.runKernel(Fse,{x:t})}}),Mpe=xde({atan_:function(e){const t=vde(e,"x","atan");return cde.runKernel(Rse,{x:t})}}),Npe=xde({atan2_:function(e,t){let n=vde(e,"a","atan2"),r=vde(t,"b","atan2");return[n,r]=rde(n,r),cde.runKernel(Lse,{a:n,b:r})}}),jpe=xde({atanh_:function(e){const t=vde(e,"x","atanh");return cde.runKernel(Pse,{x:t})}});function Fpe(e,t,n,r,i="NHWC",a){return Lpe(e,[...t,e[3]],n,a,r,null,null,Gpe(i))}function Rpe(e,t,n,r,i,a,o="channelsLast"){const[s,l]=zpe(t);let u;if("channelsLast"===o)u=[s,l,e[3],e[3]];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);u=[s,l,e[1],e[1]]}return Lpe(e,u,n,r,i,a,!1,o)}function Ppe(e,t,n,r,i,a,o="NDHWC"){const[s,l,u]=Upe(t);let c,d;if("NDHWC"===o)d="channelsLast",c=[s,l,u,e[4],e[4]];else{if("NCDHW"!==o)throw new Error("Unknown dataFormat "+o);d="channelsFirst",c=[s,l,u,e[1],e[1]]}return Bpe(e,c,n,r,i,!1,d,a)}function Lpe(e,t,n,r,i,a,o=!1,s="channelsLast"){let[l,u,c,d]=[-1,-1,-1,-1];if("channelsLast"===s)[l,u,c,d]=e;else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);[l,d,u,c]=e}const[h,f,,p]=t,[m,g]=zpe(n),[v,y]=zpe(r),b=Hpe(h,v),x=Hpe(f,y),{padInfo:w,outHeight:_,outWidth:k}=function(e,t,n,r,i,a,o,s,l){let u,c,d;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};const i=function(e,t,n,r,i){null==r&&(r=$pe(e,t,n));const a=e[1];return[Wpe((e[0]-t+2*r)/n+1,i),Wpe((a-t+2*r)/n+1,i)]}([t,n],a,r,e,s);c=i[0],d=i[1]}else if("same"===e){c=Math.ceil(t/r),d=Math.ceil(n/i);const e=Math.max(0,(c-1)*r+a-t),s=Math.max(0,(d-1)*i+o-n),l=Math.floor(e/2),h=e-l,f=Math.floor(s/2);u={top:l,bottom:h,left:f,right:s-f,type:"SAME"}}else if("valid"===e)u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-a+1)/r),d=Math.ceil((n-o+1)/i);else{if("object"!=typeof e)throw Error("Unknown padding parameter: "+e);{const h="channelsLast"===l?e[1][0]:e[2][0],f="channelsLast"===l?e[1][1]:e[2][1],p="channelsLast"===l?e[2][0]:e[3][0],m="channelsLast"===l?e[2][1]:e[3][1];u={top:h,bottom:f,left:p,right:m,type:0===h&&0===f&&0===p&&0===m?"VALID":"EXPLICIT"},c=Wpe((t-a+h+f)/r+1,s),d=Wpe((n-o+p+m)/i+1,s)}}return{padInfo:u,outHeight:c,outWidth:d}}(i,u,c,m,g,b,x,a,s),E=o?p*d:p;let S;return"channelsFirst"===s?S=[l,E,_,k]:"channelsLast"===s&&(S=[l,_,k,E]),{batchSize:l,dataFormat:s,inHeight:u,inWidth:c,inChannels:d,outHeight:_,outWidth:k,outChannels:E,padInfo:w,strideHeight:m,strideWidth:g,filterHeight:h,filterWidth:f,effectiveFilterHeight:b,effectiveFilterWidth:x,dilationHeight:v,dilationWidth:y,inShape:e,outShape:S,filterShape:t}}function Bpe(e,t,n,r,i,a=!1,o="channelsLast",s){let[l,u,c,d,h]=[-1,-1,-1,-1,-1];if("channelsLast"===o)[l,u,c,d,h]=e;else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);[l,h,u,c,d]=e}const[f,p,m,,g]=t,[v,y,b]=Upe(n),[x,w,_]=Upe(r),k=Hpe(f,x),E=Hpe(p,w),S=Hpe(m,_),{padInfo:T,outDepth:C,outHeight:I,outWidth:A}=function(e,t,n,r,i,a,o,s,l,u,c){let d,h,f,p;if("number"==typeof e){d={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};const a=function(e,t,n,r,i,a){null==i&&(i=$pe(e,t,r));const o=e[1],s=e[2];return[Wpe((e[0]-t+2*i)/r+1,a),Wpe((o-t+2*i)/r+1,a),Wpe((s-t+2*i)/r+1,a),1]}([t,n,r,1],s,0,i,e,c);h=a[0],f=a[1],p=a[2]}else if("same"===e){h=Math.ceil(t/i),f=Math.ceil(n/a),p=Math.ceil(r/o);const e=(h-1)*i+s-t,c=(f-1)*a+l-n,m=(p-1)*o+u-r,g=Math.floor(e/2),v=e-g,y=Math.floor(c/2),b=c-y,x=Math.floor(m/2);d={top:y,bottom:b,left:x,right:m-x,front:g,back:v,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);d={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((t-s+1)/i),f=Math.ceil((n-l+1)/a),p=Math.ceil((r-u+1)/o)}return{padInfo:d,outDepth:h,outHeight:f,outWidth:p}}(i,u,c,d,v,y,b,k,E,S,s),O=a?g*h:g;let D;return"channelsFirst"===o?D=[l,O,C,I,A]:"channelsLast"===o&&(D=[l,C,I,A,O]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:c,inWidth:d,inChannels:h,outDepth:C,outHeight:I,outWidth:A,outChannels:O,padInfo:T,strideDepth:v,strideHeight:y,strideWidth:b,filterDepth:f,filterHeight:p,filterWidth:m,effectiveFilterDepth:k,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationDepth:x,dilationHeight:w,dilationWidth:_,inShape:e,outShape:D,filterShape:t}}function $pe(e,t,n,r=1){const i=Hpe(t,r);return Math.floor((e[0]*(n-1)-n+i)/2)}function zpe(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Upe(e){return"number"==typeof e?[e,e,e]:e}function Hpe(e,t){return t<=1?e:e+(e-1)*(t-1)}function Wpe(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function Vpe(e){const[t,n,r]=zpe(e);return 1===t&&1===n&&1===r}function qpe(e,t){return Vpe(e)||Vpe(t)}function Gpe(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}const Ype=xde({reshape_:function(e,t){const n=vde(e,"x","reshape","string_or_numeric");return cde.runKernel(Due,{x:n},{shape:t})}}),Xpe=xde({avgPool_:function(e,t,n,r,i){const a=vde(e,"x","avgPool","float32");joe(qpe(n,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`);let o=a,s=!1;3===a.rank&&(s=!0,o=Ype(a,[1,a.shape[0],a.shape[1],a.shape[2]])),joe(4===o.rank,()=>`Error in avgPool: x must be rank 4 but got rank ${o.rank}.`),null!=i&&joe(zoe(r),()=>`Error in avgPool: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`);let l=cde.runKernel(Bse,{x:o},{filterSize:t,strides:n,pad:r,dimRoundingMode:i});return l=ghe(l,a.dtype),s?Ype(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),Kpe=xde({avgPool3d_:function(e,t,n,r,i,a="NDHWC",o){null==o?o=[1,1,1]:Ife("dilations is deprecated, this field will be gone in v3.0.0.");const s=vde(e,"x","avgPool3d","float32");let l=s,u=!1;4===s.rank&&(u=!0,l=Ype(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),joe(5===l.rank,()=>`Error in avgPool3d: x must be rank 5 but got rank ${l.rank}.`),joe("NDHWC"===a,()=>"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a),joe(qpe(n,o),()=>`Error in avgPool3d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),null!=i&&joe(zoe(r),()=>`Error in avgPool3d: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`);let c=cde.runKernel(zse,{x:l},{filterSize:t,strides:n,pad:r,dimRoundingMode:i,dataFormat:a,dilations:o});return c=ghe(c,l.dtype),u?Ype(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}}),Zpe=xde({concat_:function(e,t=0){joe(e.length>=1,()=>"Pass at least one tensor to concat");const n=yde(e,"tensors","concat","string_or_numeric");return"complex64"===n[0].dtype&&n.forEach(e=>{if("complex64"!==e.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${e.dtype}. `)}),1===n.length?vhe(n[0]):cde.runKernel(Jse,n,{axis:t})}}),Jpe=xde({sigmoid_:function(e){const t=vde(e,"x","sigmoid");return cde.runKernel(Gue,{x:t})}}),Qpe=xde({slice_:function(e,t,n){const r=vde(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");return cde.runKernel(Hue,{x:r},{begin:t,size:n})}}),eme=xde({tanh_:function(e){const t=vde(e,"x","tanh");return cde.runKernel(oce,{x:t})}}),tme=xde({basicLSTMCell_:function(e,t,n,r,i,a){const o=vde(e,"forgetBias","basicLSTMCell"),s=vde(t,"lstmKernel","basicLSTMCell"),l=vde(n,"lstmBias","basicLSTMCell"),u=vde(r,"data","basicLSTMCell"),c=vde(i,"c","basicLSTMCell"),d=vde(a,"h","basicLSTMCell"),h=Zpe([u,d],1),f=Rhe(h,s),p=qfe(f,l),m=p.shape[1]/4,g=[p.shape[0],m],v=Qpe(p,[0,0],g),y=Qpe(p,[0,m],g),b=Qpe(p,[0,2*m],g),x=Qpe(p,[0,3*m],g),w=qfe(Xfe(Jpe(v),eme(y)),Xfe(c,Jpe(qfe(o,b))));return[w,Xfe(eme(w),Jpe(x))]}}),nme=xde({batchToSpaceND_:function(e,t,n){const r=vde(e,"x","batchToSpaceND"),i=t.reduce((e,t)=>e*t);return joe(r.rank>=1+t.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${t.length}`),joe(n.length===t.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`),joe(r.shape[0]%i==0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${i}`),cde.runKernel(Wse,{x:r},{blockShape:t,crops:n})}}),rme=xde({batchNorm_:function(e,t,n,r,i,a){null==a&&(a=.001);const o=vde(e,"x","batchNorm"),s=vde(t,"mean","batchNorm"),l=vde(n,"variance","batchNorm");let u,c;null!=i&&(u=vde(i,"scale","batchNorm")),null!=r&&(c=vde(r,"offset","batchNorm")),joe(s.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),joe(null==c||s.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),joe(null==u||s.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const d=function(e){let t;return t=0===e.rank||1===e.rank?Ype(e,[1,1,1,e.size]):2===e.rank?Ype(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?Ype(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e,t}(o),h=cde.runKernel(Dle,{x:d,scale:u,offset:c,mean:s,variance:l},{varianceEpsilon:a});return Ype(h,o.shape)}}),ime=xde({batchNorm2d_:function(e,t,n,r,i,a){const o=vde(e,"x","batchNorm"),s=vde(t,"mean","batchNorm"),l=vde(n,"variance","batchNorm");let u,c;return null!=i&&(u=vde(i,"scale","batchNorm")),null!=r&&(c=vde(r,"offset","batchNorm")),joe(2===o.rank,()=>"Error in batchNorm2D: x must be rank 2 but got rank "+o.rank+"."),joe(2===s.rank||1===s.rank,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${s.rank}.`),joe(2===l.rank||1===l.rank,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),null!=u&&joe(2===u.rank||1===u.rank,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),null!=c&&joe(2===c.rank||1===c.rank,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),rme(o,s,l,c,u,a)}}),ame=xde({batchNorm3d_:function(e,t,n,r,i,a){const o=vde(e,"x","batchNorm"),s=vde(t,"mean","batchNorm"),l=vde(n,"variance","batchNorm");let u,c;return null!=i&&(u=vde(i,"scale","batchNorm")),null!=r&&(c=vde(r,"offset","batchNorm")),joe(3===o.rank,()=>"Error in batchNorm3D: x must be rank 3 but got rank "+o.rank+"."),joe(3===s.rank||1===s.rank,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${s.rank}.`),joe(3===l.rank||1===l.rank,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),null!=u&&joe(3===u.rank||1===u.rank,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),null!=c&&joe(3===c.rank||1===c.rank,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),rme(o,s,l,c,u,a)}}),ome=xde({batchNorm4d_:function(e,t,n,r,i,a){const o=vde(e,"x","batchNorm"),s=vde(t,"mean","batchNorm"),l=vde(n,"variance","batchNorm");let u,c;return null!=i&&(u=vde(i,"scale","batchNorm")),null!=r&&(c=vde(r,"offset","batchNorm")),joe(4===o.rank,()=>"Error in batchNorm4D: x must be rank 4 but got rank "+o.rank+"."),joe(4===s.rank||1===s.rank,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${s.rank}.`),joe(4===l.rank||1===l.rank,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),null!=u&&joe(4===u.rank||1===u.rank,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),null!=c&&joe(4===c.rank||1===c.rank,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),rme(o,s,l,c,u,a)}}),sme=xde({bincount_:function(e,t,n){const r=vde(e,"x","bincount"),i=vde(t,"weights","bincount");return joe("int32"===r.dtype,()=>"Error in bincount: input dtype must be int32, but got "+r.dtype),joe(n>=0,()=>`size must be non-negative, but got ${n}.`),joe(i.size===r.size||0===i.size,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: `+i.shape+"."),cde.runKernel(Vse,{x:r,weights:i},{size:n})}}),lme=xde({broadcastTo_:function(e,t){let n=vde(e,"broadcastTo","x");const r=n.shape;if(t.some(e=>!(e>0)||e%1!=0))throw new Error(`broadcastTo(): Invalid broadcast shape [${t}].`);if(t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){const e=n.shape.slice();for(;e.length<t.length;)e.unshift(1);n=Ype(n,e)}const i=n.shape,a=Array.from(t);for(let o=t.length-1;o>=0;o--)if(i[o]===t[o])a[o]=1;else if(1!==n.shape[o])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${t}].`);return 0===a.map((e,t)=>e>1?t:-1).filter(e=>e>=0).length?vhe(n):cde.runKernel(sce,{x:n},{reps:a})}}),ume=xde({ceil_:function(e){const t=vde(e,"x","ceil");return cde.runKernel(Yse,{x:t})}}),cme=xde({clipByValue_:function(e,t,n){const r=vde(e,"x","clipByValue");return joe(t<=n,()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`),cde.runKernel(Xse,{x:r},{clipValueMin:t,clipValueMax:n})}}),dme=xde({concat1d_:function(e){return Zpe(e,0)}}),hme=xde({concat2d_:function(e,t){return Zpe(e,t)}}),fme=xde({concat3d_:function(e,t){return Zpe(e,t)}}),pme=xde({concat4d_:function(e,t){return Zpe(e,t)}}),mme=xde({conv2d_:function(e,t,n,r,i="NHWC",a=[1,1],o){const s=vde(e,"x","conv2d"),l=vde(t,"filter","conv2d");let u=s,c=!1;3===s.rank&&(c=!0,u=Ype(s,[1,s.shape[0],s.shape[1],s.shape[2]])),joe(4===u.rank,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),joe(4===l.rank,()=>"Error in conv2d: filter must be rank 4, but got rank "+l.rank+"."),null!=o&&joe(zoe(r),()=>`Error in conv2d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);const d="NHWC"===i?u.shape[3]:u.shape[1];joe(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),joe(qpe(n,a),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`);const h=cde.runKernel(Qse,{x:u,filter:l},{strides:n,pad:r,dataFormat:i,dilations:a,dimRoundingMode:o});return c?Ype(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),gme=xde({conv1d_:function(e,t,n,r,i="NWC",a=1,o){const s=vde(e,"x","conv1d"),l=vde(t,"filter","conv1d");let u=s,c=!1;2===s.rank&&(c=!0,u=Ype(s,[1,s.shape[0],s.shape[1]])),joe(3===u.rank,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),joe(3===l.rank,()=>"Error in conv1d: filter must be rank 3, but got rank "+l.rank+"."),null!=o&&joe(zoe(r),()=>`Error in conv1d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`),joe(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),joe(qpe(n,a),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${a}'`),joe("NWC"===i,()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`);const d=Ype(l,[1,l.shape[0],l.shape[1],l.shape[2]]),h=Ype(u,[u.shape[0],1,u.shape[1],u.shape[2]]),f=mme(h,d,[1,n],r,"NHWC",[1,a],o);return Ype(f,c?[f.shape[2],f.shape[3]]:[f.shape[0],f.shape[2],f.shape[3]])}}),vme=xde({conv2DBackpropInput_:function(e,t,n,r,i,a="NHWC",o){joe(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let s=e,l=t,u=!1;3===t.rank&&(u=!0,l=Ype(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),joe(4===s.length,()=>"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."),joe(4===l.rank,()=>"Error in conv2dDerInput: dy must be rank 4, but got rank "+l.rank),joe(4===n.rank,()=>"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank);const c="NHWC"===a?s[3]:s[1],d="NHWC"===a?l.shape[3]:l.shape[1];joe(c===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`),joe(d===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[3]}.`),null!=o&&joe(zoe(i),()=>`Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ${o} but got pad ${i}.`);const h=cde.runKernel(tle,{dy:l,filter:n},{strides:r,pad:i,dataFormat:a,dimRoundingMode:o,inputShape:s});return u?Ype(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),yme=xde({conv2dTranspose_:function(e,t,n,r,i,a){const o=vde(e,"x","conv2dTranspose"),s=vde(t,"filter","conv2dTranspose");return vme(n,o,s,r,i,"NHWC",a)}}),bme=xde({conv3d_:function(e,t,n,r,i="NDHWC",a=[1,1,1]){const o=vde(e,"x","conv3d"),s=vde(t,"filter","conv3d");let l=o,u=!1;4===o.rank&&(u=!0,l=Ype(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),joe(5===l.rank,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),joe(5===s.rank,()=>"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."),joe(l.shape[4]===s.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${s.shape[3]}.`),joe(qpe(n,a),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`),joe("NDHWC"===i,()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`);const c=cde.runKernel(nle,{x:l,filter:s},{strides:n,pad:r,dataFormat:i,dilations:a});return u?Ype(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}}),xme=xde({conv3DBackpropInput_:function(e,t,n,r,i){joe(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let a=e,o=t,s=!1;4===t.rank&&(s=!0,o=Ype(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),a=[1,e[0],e[1],e[2],e[3]]);const l=a[4],u=o.shape[4];joe(5===a.length,()=>"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."),joe(5===o.rank,()=>"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank),joe(5===n.rank,()=>"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank),joe(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),joe(u===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${n.shape[4]}.`);const c=cde.runKernel(ile,{dy:o,filter:n},{pad:i,strides:r,inputShape:a});return s?Ype(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}}),wme=xde({conv3dTranspose_:function(e,t,n,r,i){const a=vde(e,"x","conv3dTranspose"),o=vde(t,"filter","conv3dTranspose");return xme(n,a,o,r,i)}}),_me=xde({cos_:function(e){const t=vde(e,"x","cos");return cde.runKernel(ale,{x:t})}}),kme=xde({cosh_:function(e){const t=vde(e,"x","cosh");return cde.runKernel(ole,{x:t})}}),Eme=xde({cumsum_:function(e,t=0,n=!1,r=!1){const i=vde(e,"x","cumsum");return cde.runKernel(sle,{x:i},{axis:t,exclusive:n,reverse:r})}}),Sme=xde({denseBincount_:function(e,t,n,r=!1){const i=vde(e,"x","denseBincount"),a=vde(t,"weights","denseBincount");return joe("int32"===i.dtype,()=>"Error in denseBincount: input dtype must be int32, but got "+i.dtype),joe(i.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`),joe(n>=0,()=>`size must be non-negative, but got ${n}.`),joe(a.size===i.size||0===a.size,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: `+a.shape+"."),cde.runKernel(ule,{x:i,weights:a},{size:n,binaryOutput:r})}}),Tme=xde({depthToSpace_:function(e,t,n="NHWC"){const r=vde(e,"x","depthToSpace"),i="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return joe(i*t>=0,()=>`Negative dimension size caused by overflow when multiplying\n    ${i} and ${t}  for depthToSpace with input shape\n    ${r.shape}`),joe(a*t>=0,()=>`Negative dimension size caused by overflow when multiplying\n    ${a} and ${t} for depthToSpace with input shape\n        ${r.shape}`),joe(o%(t*t)==0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${o} for depthToSpace with input shape ${r.shape}`),cde.runKernel(cle,{x:r},{blockSize:t,dataFormat:n})}}),Cme=xde({depthwiseConv2d_:function(e,t,n,r,i="NHWC",a=[1,1],o){const s=vde(e,"x","depthwiseConv2d"),l=vde(t,"filter","depthwiseConv2d");let u=s,c=!1;3===s.rank&&(c=!0,u=Ype(s,[1,s.shape[0],s.shape[1],s.shape[2]])),joe(4===u.rank,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),joe(4===l.rank,()=>"Error in depthwiseConv2d: filter must be rank 4, but got rank "+l.rank+"."),joe(u.shape[3]===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),null!=o&&joe(zoe(r),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);const d=cde.runKernel(dle,{x:u,filter:l},{strides:n,pad:r,dataFormat:i,dilations:a,dimRoundingMode:o});return c?Ype(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),Ime=xde({diag_:function(e){const t=vde(e,"x","diag");return cde.runKernel(ple,{x:t})}}),Ame=xde({dilation2d_:function(e,t,n,r,i=[1,1],a="NHWC"){const o=vde(e,"x","dilation2d"),s=vde(t,"filter","dilation2d");joe(3===o.rank||4===o.rank,()=>"Error in dilation2d: input must be rank 3 or 4, but got rank "+o.rank+"."),joe(3===s.rank,()=>"Error in dilation2d: filter must be rank 3, but got rank "+s.rank+"."),joe("NHWC"===a,()=>"Error in dilation2d: Only NHWC is currently supported, but got dataFormat of "+a);let l=o,u=!1;3===o.rank&&(l=Ype(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0);const c=cde.runKernel(mle,{x:l,filter:s},{strides:n,pad:r,dilations:i});return u?Ype(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),Ome=xde({equal_:function(e,t){let n=vde(e,"a","equal"),r=vde(t,"b","equal");return[n,r]=rde(n,r),vpe(n.shape,r.shape),cde.runKernel(_le,{a:n,b:r})}}),Dme=xde({where_:function(e,t,n){const r=vde(t,"a","where"),i=vde(n,"b","where"),a=vde(e,"condition","where","bool"),o=vpe(r.shape,i.shape),s=lme(r,o),l=lme(i,o);return 1===a.rank&&joe(a.shape[0]===r.shape[0],()=>"The first dimension of `a` must match the size of `condition`."),1!==a.rank&&Foe(a.shape,l.shape,"Error in where: "),cde.runKernel(zue,{condition:a,t:s,e:l})}}),Mme=xde({divNoNan_:function(e,t){let n=vde(e,"a","div"),r=vde(t,"b","div");[n,r]=rde(n,r);const i=Yfe(n,r),a=Jfe(i),o=Ome(r,a);return Dme(o,a,i)}}),Nme=xde({dot_:function(e,t){const n=vde(e,"t1","dot"),r=vde(t,"t2","dot");joe(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`);const i=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];if(joe(i===a,()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${a}.`),1===n.rank&&1===r.rank){const e=Ype(n,[1,-1]),t=Ype(r,[-1,1]),i=Rhe(e,t);return Ype(i,[])}if(1===n.rank&&2===r.rank){const e=Ype(n,[1,-1]),t=Ype(r,[r.shape[0],r.shape[1]]),i=Rhe(e,t);return Ype(i,[i.size])}if(2===n.rank&&1===r.rank){const e=Ype(r,[-1,1]),t=Rhe(n,e);return Ype(t,[t.size])}{const e=Ype(r,[r.shape[0],r.shape[1]]);return Rhe(n,e)}}}),jme=xde({elu_:function(e){const t=vde(e,"x","elu");return cde.runKernel(ble,{x:t})}}),Fme=xde({erf_:function(e){let t=vde(e,"x","erf");return joe("int32"===t.dtype||"float32"===t.dtype,()=>"Input dtype must be `int32` or `float32`."),"int32"===t.dtype&&(t=ghe(t,"float32")),cde.runKernel(wle,{x:t})}}),Rme=xde({exp_:function(e){const t=vde(e,"x","exp");return cde.runKernel(kle,{x:t})}}),Pme=xde({expandDims_:function(e,t=0){const n=vde(e,"x","expandDims","string_or_numeric");return joe(t<=n.rank,()=>"Axis must be <= rank of the tensor"),cde.runKernel(Ele,{input:n},{dim:t})}}),Lme=xde({expm1_:function(e){const t=vde(e,"x","expm1");return cde.runKernel(Sle,{x:t})}}),Bme=xde({tile_:function(e,t){const n=vde(e,"x","tile","string_or_numeric");return joe(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`),cde.runKernel(sce,{x:n},{reps:t})}}),$me=xde({eye_:function(e,t,n,r="float32"){null==t&&(t=e);const i=mhe([e,t],r),a=e<=t?e:t;for(let s=0;s<a;++s)i.set(1,s,s);const o=Ype(i.toTensor(),[e,t]);if(null==n)return o;if(1===n.length)return Bme(Pme(o,0),[n[0],1,1]);if(2===n.length)return Bme(Pme(Pme(o,0),0),[n[0],n[1],1,1]);if(3===n.length)return Bme(Pme(Pme(Pme(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}}),zme=xde({floor_:function(e){const t=vde(e,"x","floor");return cde.runKernel(Ale,{x:t})}}),Ume=xde({gather_:function(e,t,n=0,r=0){const i=vde(e,"x","gather"),a=vde(t,"indices","gather","int32");return cde.runKernel(Mle,{x:i,indices:a},{axis:n,batchDims:r})}}),Hme=xde({greater_:function(e,t){let n=vde(e,"a","greater"),r=vde(t,"b","greater");return[n,r]=rde(n,r),vpe(n.shape,r.shape),cde.runKernel(jle,{a:n,b:r})}}),Wme=xde({greaterEqual_:function(e,t){let n=vde(e,"a","greaterEqual"),r=vde(t,"b","greaterEqual");return[n,r]=rde(n,r),vpe(n.shape,r.shape),cde.runKernel(Fle,{a:n,b:r})}}),Vme=xde({imag_:function(e){const t=vde(e,"input","imag");return cde.runKernel(Lle,{input:t})}}),qme=xde({isFinite_:function(e){const t=vde(e,"x","isFinite");return cde.runKernel(Ble,{x:t})}}),Gme=xde({isInf_:function(e){const t=vde(e,"x","isInf");return cde.runKernel($le,{x:t})}}),Yme=xde({isNaN_:function(e){const t=vde(e,"x","isNaN");return cde.runKernel(zle,{x:t})}}),Xme=xde({leakyRelu_:function(e,t=.2){const n=vde(e,"x","leakyRelu");return cde.runKernel(Ule,{x:n},{alpha:t})}}),Kme=xde({less_:function(e,t){let n=vde(e,"a","less"),r=vde(t,"b","less");return[n,r]=rde(n,r),vpe(n.shape,r.shape),cde.runKernel(Hle,{a:n,b:r})}}),Zme=xde({lessEqual_:function(e,t){let n=vde(e,"a","lessEqual"),r=vde(t,"b","lessEqual");return[n,r]=rde(n,r),vpe(n.shape,r.shape),cde.runKernel(Wle,{a:n,b:r})}});function Jme(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return cde.runKernel(Vle,{},{start:e,stop:t,num:n})}const Qme=xde({localResponseNormalization_:function(e,t=5,n=1,r=1,i=.5){const a=vde(e,"x","localResponseNormalization");joe(4===a.rank||3===a.rank,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${a.rank}.`),joe(zoe(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let o=a,s=!1;3===a.rank&&(s=!0,o=Ype(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const l=cde.runKernel(Jle,{x:o},{depthRadius:t,bias:n,alpha:r,beta:i});return s?Ype(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),ege=xde({log_:function(e){const t=vde(e,"x","log");return cde.runKernel(qle,{x:t})}}),tge=xde({log1p_:function(e){const t=vde(e,"x","log1p");return cde.runKernel(Gle,{x:t})}}),nge=xde({neg_:function(e){const t=vde(e,"x","neg");return cde.runKernel(pue,{x:t})}}),rge=xde({softplus_:function(e){const t=vde(e,"x","softplus");return cde.runKernel(Yue,{x:t})}}),ige=xde({logSigmoid_:function(e){const t=vde(e,"x","logSigmoid");return ipe(e=>({value:nge(rge(nge(e))),gradFunc:t=>Xfe(t,Jpe(nge(e)))}))(t)}}),age=xde({max_:function(e,t=null,n=!1){const r=vde(e,"x","max");return cde.runKernel(eue,{x:r},{reductionIndices:t,keepDims:n})}}),oge=xde({sum_:function(e,t=null,n=!1){let r=vde(e,"x","sum");return"bool"===r.dtype&&(r=ghe(r,"int32")),cde.runKernel(Kue,{x:r},{axis:t,keepDims:n})}}),sge=xde({logSoftmax_:function(e,t=-1){const n=vde(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);return ipe((e,n)=>{const r=age(e,t,!0),i=hpe(e,r),a=hpe(ghe(i,"float32"),ege(oge(Rme(i),t,!0)));return n([a]),{value:a,gradFunc:(e,n)=>{const[r]=n,i=Rme(r);return hpe(e,Xfe(oge(e,t,!0),i))}}})(n)}});function lge(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function uge(e,t,n){const r=e.length+t.length,i=[];let a=0,o=0;for(let s=0;s<r;s++)-1===n.indexOf(s)?i.push(e[a++]):i.push(t[o++]);return i}function cge(e,t){const n=[],r=e.length;for(let i=0;i<r;i++)-1===t.indexOf(i)&&n.push(e[i]);return[n,t.map(t=>e[t])]}function dge(e,t){return uge(e,t.map(e=>1),t)}function hge(e,t,n){joe(lge(t,n),()=>e+" supports only inner-most axes for now. "+`Got axes ${t} and rank-${n} input.`)}function fge(e,t){if(lge(e,t))return null;const n=[];for(let r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(e=>n.push(e)),n}function pge(e){return e.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function mge(e,t){const n=[];for(let r=t-e;r<t;++r)n.push(r);return n}const gge=xde({logSumExp_:function(e,t=null,n=!1){const r=vde(e,"x","logSumExp"),i=Yoe(t,r.shape),a=age(r,i,!0),o=hpe(r,a),s=Rme(o),l=oge(s,i),u=ege(l),c=qfe(Ype(a,u.shape),u);if(n){const e=dge(c.shape,i);return Ype(c,e)}return c}}),vge=xde({logicalAnd_:function(e,t){const n=vde(e,"a","logicalAnd","bool"),r=vde(t,"b","logicalAnd","bool");return vpe(n.shape,r.shape),cde.runKernel(Yle,{a:n,b:r})}}),yge=xde({logicalNot_:function(e){const t=vde(e,"x","logicalNot","bool");return cde.runKernel(Xle,{x:t})}}),bge=xde({logicalOr_:function(e,t){const n=vde(e,"a","logicalOr","bool"),r=vde(t,"b","logicalOr","bool");return vpe(n.shape,r.shape),cde.runKernel(Kle,{a:n,b:r})}}),xge=xde({logicalXor_:function(e,t){const n=vde(e,"a","logicalXor","bool"),r=vde(t,"b","logicalXor","bool");return vpe(n.shape,r.shape),vge(bge(e,t),yge(vge(e,t)))}}),wge=xde({maxPool_:function(e,t,n,r,i){const a=vde(e,"x","maxPool");let o=a,s=!1;3===a.rank&&(s=!0,o=Ype(a,[1,a.shape[0],a.shape[1],a.shape[2]])),joe(4===o.rank,()=>`Error in maxPool: input must be rank 4 but got rank ${o.rank}.`),joe(qpe(n,1),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`),null!=i&&joe(zoe(r),()=>`Error in maxPool: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`);const l=cde.runKernel(nue,{x:o},{filterSize:t,strides:n,pad:r,dimRoundingMode:i});return s?Ype(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),_ge=xde({maxPool3d_:function(e,t=[1,1,1],n,r,i,a="NDHWC",o){null==o?o=[1,1,1]:Ife("dilations is deprecated, this field will be gone in v3.0.0.");const s=vde(e,"x","maxPool3d");let l=s,u=!1;4===s.rank&&(u=!0,l=Ype(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),joe(5===l.rank,()=>`Error in maxPool3d: x must be rank 5 but got rank ${l.rank}.`),joe("NDHWC"===a,()=>"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a),joe(qpe(n,o),()=>`Error in maxPool3d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),null!=i&&joe(zoe(r),()=>`Error in maxPool3d: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`);const c=cde.runKernel(iue,{x:l},{filterSize:t,strides:n,pad:r,dimRoundingMode:i,dataFormat:a,dilations:o});return u?Ype(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}}),kge=xde({maxPoolWithArgmax_:function(e,t,n,r,i=!1){const a=vde(e,"x","maxPoolWithArgmax"),o=cde.runKernel(oue,{x:a},{filterSize:t,strides:n,pad:r,includeBatchInIndex:i});return{result:o[0],indexes:o[1]}}}),Ege=xde({mean_:function(e,t=null,n=!1){const r=vde(e,"x","mean");return cde.runKernel(sue,{x:r},{axis:t,keepDims:n})}}),Sge=xde({min_:function(e,t=null,n=!1){const r=vde(e,"x","min");return cde.runKernel(lue,{x:r},{axis:t,keepDims:n})}}),Tge=xde({minimum_:function(e,t){let n=vde(e,"a","minimum"),r=vde(t,"b","minimum");return[n,r]=rde(n,r),"bool"===n.dtype&&(n=ghe(n,"int32"),r=ghe(r,"int32")),vpe(n.shape,r.shape),cde.runKernel(uue,{a:n,b:r})}}),Cge=xde({mirrorPad_:function(e,t,n){joe("reflect"===n||"symmetric"===n,()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const r=vde(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");joe(t.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${t.length}.`);const i="reflect"===n?1:0;for(let a=0;a<r.rank;a++)joe(2===t[a].length,()=>"Invalid number of paddings. Must be length of 2 each."),joe(t[a][0]>=0&&t[a][0]<=r.shape[a]-i&&t[a][1]>=0&&t[a][1]<=r.shape[a]-i,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-i} or less than 0 for input of shape `+r.shape);return cde.runKernel(cue,{x:r},{paddings:t,mode:n})}}),Ige=xde({mod_:function(e,t){let n=vde(e,"a","mod"),r=vde(t,"b","mod");return[n,r]=rde(n,r),cde.runKernel(due,{a:n,b:r})}}),Age=xde({moments_:function(e,t=null,n=!1){const r=Yoe(t,(e=vde(e,"x","moments")).shape),i=Ege(e,r,n);let a=i.shape;n||(a=dge(i.shape,r));const o=Zfe(hpe(ghe(e,"float32"),Ype(i,a)));return{mean:i,variance:Ege(o,r,n)}}}),Oge=xde({multiRNNCell_:function(e,t,n,r){const i=vde(t,"data","multiRNNCell"),a=yde(n,"c","multiRNNCell"),o=yde(r,"h","multiRNNCell");let s=i;const l=[];for(let d=0;d<e.length;d++){const t=e[d](s,a[d],o[d]);l.push(t[0]),l.push(t[1]),s=t[1]}const u=[],c=[];for(let d=0;d<l.length;d+=2)u.push(l[d]),c.push(l[d+1]);return[u,c]}}),Dge=xde({multinomial_:function(e,t,n,r=!1){const i=vde(e,"logits","multinomial"),a=i.size,o=i.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);n=n||Math.random();const s=1===o?Ype(i,[1,-1]):i,l=cde.runKernel(hue,{logits:s},{numSamples:t,seed:n,normalized:r});return 1===o?Ype(l,[l.size]):l}}),Mge=xde({notEqual_:function(e,t){let n=vde(e,"a","notEqual"),r=vde(t,"b","notEqual");return[n,r]=rde(n,r),vpe(n.shape,r.shape),cde.runKernel(mue,{a:n,b:r})}});function Nge(e,t="float32"){if("complex64"===t){const t=Nge(e,"float32"),n=Nge(e,"float32");return wde(t,n)}const n=fse(Loe(e),t);return cde.makeTensor(n,e,t)}function jge(e,t="float32"){if("complex64"===t){const t=jge(e,"float32"),n=Nge(e,"float32");return wde(t,n)}const n=hse(Loe(e),t);return cde.makeTensor(n,e,t)}const Fge=xde({onesLike_:function(e){const t=vde(e,"x","onesLike");return cde.runKernel(bue,{x:t})}}),Rge=xde({outerProduct_:function(e,t){const n=vde(e,"v1","outerProduct"),r=vde(t,"v2","outerProduct");joe(1===n.rank&&1===r.rank,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`);const i=Ype(n,[-1,1]),a=Ype(r,[1,-1]);return Rhe(i,a)}}),Pge=xde({pad_:function(e,t,n=0){const r=vde(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return cde.runKernel(_ue,{x:r},{paddings:t,constantValue:n})}}),Lge=xde({pad1d_:function(e,t,n=0){return joe(2===t.length,()=>"Invalid number of paddings. Must be length of 2."),Pge(e,[t],n)}}),Bge=xde({pad2d_:function(e,t,n=0){return joe(2===t.length&&2===t[0].length&&2===t[1].length,()=>"Invalid number of paddings. Must be length of 2 each."),Pge(e,t,n)}}),$ge=xde({pad3d_:function(e,t,n=0){return joe(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,()=>"Invalid number of paddings. Must be length of 2 each."),Pge(e,t,n)}}),zge=xde({pad4d_:function(e,t,n=0){return joe(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,()=>"Invalid number of paddings. Must be length of 2 each."),Pge(e,t,n)}}),Uge=xde({spaceToBatchND_:function(e,t,n){const r=vde(e,"x","spaceToBatchND");return joe(r.rank>=1+t.length,()=>`input rank ${r.rank} should be > than [blockShape] ${t.length}`),joe(n.length===t.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`),joe(r.shape.reduce((e,r,i)=>i>0&&i<=t.length?e&&(r+n[i-1][0]+n[i-1][1])%t[i-1]==0:e,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`),cde.runKernel(Zue,{x:r},{blockShape:t,paddings:n})}}),Hge=xde({pool_:function(e,t,n,r,i,a){null==i&&(i=[1,1]),null==a&&(a=1),0===r&&(r="valid");const o=vde(e,"x","maxPool");let s=o,l=!1;3===o.rank&&(l=!0,s=Ype(o,[1,o.shape[0],o.shape[1],o.shape[2]])),joe(qpe(a,i),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${a} and dilations '${i}'`);const u=Rpe(s.shape,t,a,i,r),c=[u.dilationHeight,u.dilationWidth];let d;d="same"===r?function(e,t){const n=e.map((e,n)=>e+(e-1)*(t[n]-1)).map(e=>e-1),r=n.map(e=>Math.floor(e/2)),i=n.map((e,t)=>e-r[t]);return n.map((e,t)=>[r[t],i[t]])}([u.filterHeight,u.filterWidth],c):[[0,0],[0,0]];const h=1===c[0]&&1===c[1],[f,p]=function(e,t,n){const r=n.map(e=>e[0]),i=n.map(e=>e[1]),a=e.concat(r,i),o=t.map((e,t)=>(e-a[t]%e)%e),s=i.map((e,t)=>e+o[t]);return[t.map((e,t)=>[r[t],s[t]]),t.map((e,t)=>[0,o[t]])]}([u.inHeight,u.inWidth],c,d),m=h?r:"valid",g=h?s:Uge(s,c,f),v=("avg"===n?()=>Xpe(g,t,a,m):()=>wge(g,t,a,m))(),y=h?v:nme(v,c,p);return l?Ype(y,[y.shape[1],y.shape[2],y.shape[3]]):y}}),Wge=xde({prelu_:function(e,t){const n=vde(e,"x","prelu"),r=vde(t,"alpha","prelu");return cde.runKernel(Sue,{x:n,alpha:r})}}),Vge=xde({prod_:function(e,t=null,n=!1){let r=vde(e,"x","prod");return"bool"===r.dtype&&(r=ghe(r,"int32")),cde.runKernel(Tue,{x:r},{axis:t,keepDims:n})}}),qge=xde({rand_:function(e,t,n){const r=Loe(e);let i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(let a=0;a<r;a++)i[a]=t();return cde.makeTensor(i,e,n)}});var Gge=n("YSVl");class Yge{constructor(e,t,n,r,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const a=i||Math.random();this.random=Gge.alea(a.toString())}nextValue(){if(!isNaN(this.nextVal)){const e=this.nextVal;return this.nextVal=NaN,e}let e,t,n=!1;for(;!n;){let r,i,a;do{r=2*this.random()-1,i=2*this.random()-1,a=r*r+i*i}while(a>=1||0===a);const o=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*r*o,t=this.mean+this.stdDev*i*o,this.truncated&&!this.isValidTruncated(e)||(n=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class Xge{constructor(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;const i=r||Math.random();this.randu=Gge.alea(i.toString()),this.randn=new Yge(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,n,r,i,a;for(;;){do{r=this.randn.nextValue(),a=1+this.c*r}while(a<=0);if(a*=a*a,e=r*r,t=1-.331*e*e,n=.5*e+this.d*(1-a+Math.log(a)),i=this.randu(),i<t||Math.log(i)<n)break}return a*=1/this.beta*this.d,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)}convertValue(e){return"float32"===this.dtype?e:Math.round(e)}}class Kge{constructor(e=0,t=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=Gge.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}const Zge=xde({randomGamma_:function(e,t,n=1,r="float32",i){if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);const a=new Xge(t,n,r,i),o=mhe(e,r);for(let s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),Jge=xde({randomNormal_:function(e,t=0,n=1,r,i){if(null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);const a=new Yge(t,n,r,!1,i),o=mhe(e,r);for(let s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),Qge=xde({randomUniform_:function(e,t=0,n=1,r="float32",i){const a=mhe(e,r),o=new Kge(t,n,null,i);for(let s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}});function eve(e,t,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");return cde.runKernel(Cue,{},{start:e,stop:t,step:n,dtype:r})}const tve=xde({real_:function(e){const t=vde(e,"input","real");return cde.runKernel(Iue,{input:t})}}),nve=xde({reciprocal_:function(e){const t=vde(e,"x","reciprocal");return cde.runKernel(Aue,{x:t})}}),rve=xde({relu_:function(e){const t=vde(e,"x","relu");return cde.runKernel(Oue,{x:t})}}),ive=xde({relu6_:function(e){const t=vde(e,"x","relu6");return cde.runKernel(Rue,{x:t})}}),ave=xde({reverse_:function(e,t){const n=vde(e,"x","reverse");return cde.runKernel(Pue,{x:n},{dims:t})}}),ove=xde({reverse1d_:function(e){const t=vde(e,"x","reverse");return joe(1===t.rank,()=>`Error in reverse1D: x must be rank 1 but got rank ${t.rank}.`),ave(t,0)}}),sve=xde({reverse2d_:function(e,t){const n=vde(e,"x","reverse");return joe(2===n.rank,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),ave(n,t)}}),lve=xde({reverse3d_:function(e,t){const n=vde(e,"x","reverse");return joe(3===n.rank,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),ave(n,t)}}),uve=xde({reverse4d_:function(e,t){const n=vde(e,"x","reverse");return joe(4===n.rank,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),ave(n,t)}}),cve=xde({round_:function(e){const t=vde(e,"x","round");return cde.runKernel(Lue,{x:t})}}),dve=xde({rsqrt_:function(e){const t=vde(e,"x","rsqrt");return cde.runKernel(Bue,{x:t})}}),hve=xde({selu_:function(e){const t=vde(e,"x","selu");return cde.runKernel(Uue,{x:t})}}),fve=xde({separableConv2d_:function(e,t,n,r,i,a=[1,1],o="NHWC"){const s=vde(e,"x","separableConv2d"),l=vde(t,"depthwiseFilter","separableConv2d"),u=vde(n,"pointwiseFilter","separableConv2d");let c=s,d=!1;if(3===s.rank&&(d=!0,c=Ype(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");joe(4===c.rank,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),joe(4===l.rank,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),joe(4===u.rank,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),joe(1===u.shape[0],()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),joe(1===u.shape[1],()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const h=l.shape[2],f=l.shape[3];joe(u.shape[2]===h*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*f}, but got ${u.shape[2]}.`);const p=Cme(c,l,r,i,o,a),m=mme(p,u,1,"valid",o);return d?Ype(m,[m.shape[1],m.shape[2],m.shape[3]]):m}}),pve=async function(e,t){const n=vde(e,"x","setdiff1d"),r=vde(t,"y","setdiff1d");joe(n.dtype===r.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`),joe(1===n.rank,()=>`x should be 1D tensor, but got x (${n.shape}).`),joe(1===r.rank,()=>`y should be 1D tensor, but got y (${r.shape}).`);const i=await n.data(),a=await r.data(),o=new Set(a);let s=0;for(let c=0;c<i.length;c++)o.has(i[c])||s++;const l=new Hce([s],n.dtype),u=new Hce([s],"int32");for(let c=0,d=0;c<i.length;c++)o.has(i[c])||(l.values[d]=i[c],u.values[d]=c,d++);return[l.toTensor(),u.toTensor()]},mve=xde({sign_:function(e){const t=vde(e,"x","sign");return cde.runKernel(que,{x:t})}}),gve=xde({sin_:function(e){const t=vde(e,"x","sin");return cde.runKernel(Wue,{x:t})}}),vve=xde({sinh_:function(e){const t=vde(e,"x","sinh");return cde.runKernel(Vue,{x:t})}}),yve=xde({slice1d_:function(e,t,n){const r=vde(e,"x","slice1d");return joe(1===r.rank,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),Qpe(r,[t],[n])}}),bve=xde({slice2d_:function(e,t,n){const r=vde(e,"x","slice2d");return joe(2===r.rank,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),Qpe(r,t,n)}}),xve=xde({slice3d_:function(e,t,n){const r=vde(e,"x","slice3d");return joe(3===r.rank,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),Qpe(r,t,n)}}),wve=xde({slice4d_:function(e,t,n){const r=vde(e,"x","slice4d");return joe(4===r.rank,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),Qpe(r,t,n)}}),_ve=xde({softmax_:function(e,t=-1){const n=vde(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);return cde.runKernel(Que,{logits:n},{dim:t})}}),kve=xde({fft_:function(e){return joe("complex64"===e.dtype,()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`),cde.runKernel(Tle,{input:e})}}),Eve=xde({ifft_:function(e){return joe("complex64"===e.dtype,()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`),cde.runKernel(Ple,{input:e})}}),Sve=xde({irfft_:function(e){const t=e.shape[e.shape.length-1],n=e.size/t;let r;if(t<=2){const i=Ype(e,[n,t]);r=Eve(i)}else{const i=[n,2*(t-1)],a=Ype(tve(e),[n,t]),o=Ype(Vme(e),[n,t]),s=ave(Qpe(a,[0,1],[n,t-2]),1),l=Xfe(ave(Qpe(o,[0,1],[n,t-2]),1),ope(-1)),u=Zpe([a,s],1),c=Zpe([o,l],1),d=Ype(wde(u,c),[i[0],i[1]]);r=Eve(d)}if(r=tve(r),3===e.rank&&0!==e.shape[0]){const t=r,n=e.shape[0];r=Ype(r,[n,r.shape[0]/n,r.shape[1]]),t.dispose()}return r}}),Tve=xde({split_:function(e,t,n=0){const r=vde(e,"x","split");return cde.runKernel(Jue,{x:r},{numOrSizeSplits:t,axis:n})}}),Cve=xde({rfft_:function(e,t){joe("float32"===e.dtype,()=>"The dtype for rfft() must be real value but got "+e.dtype);let n=e.shape[e.shape.length-1];const r=e.size/n;let i;if(null!=t&&t<n){const r=e.shape.map(e=>0),a=e.shape.map(e=>e);a[e.shape.length-1]=t,i=Qpe(e,r,a),n=t}else if(null!=t&&t>n){const r=e.shape.map(e=>e);r[e.shape.length-1]=t-n,i=Zpe([e,Nge(r)],e.shape.length-1),n=t}else i=e;const a=Jfe(i),o=Ype(wde(i,a),[r,n]),s=kve(o),l=Math.floor(n/2)+1,u=tve(s),c=Vme(s),d=Tve(u,[l,n-l],u.shape.length-1),h=Tve(c,[l,n-l],c.shape.length-1),f=i.shape.slice();return f[i.shape.length-1]=l,Ype(wde(d[0],h[0]),f)}}),Ive=xde({squaredDifference_:function(e,t){let n=vde(e,"a","squaredDifference"),r=vde(t,"b","squaredDifference");return[n,r]=rde(n,r),vpe(n.shape,r.shape),cde.runKernel(ece,{a:n,b:r},{})}}),Ave=xde({squeeze_:function(e,t){const n=vde(e,"x","squeeze");return Ype(n,Xoe(n.shape,t).newShape)}}),Ove=xde({stack_:function(e,t=0){const n=yde(e,"tensors","stack","string_or_numeric");return joe(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&joe(t<=n[0].rank,()=>"Axis must be <= rank of the tensor"),cde.runKernel(wue,n,{axis:t})}}),Dve=xde({step_:function(e,t=0){const n=vde(e,"x","step");return cde.runKernel(pce,{x:n},{alpha:t})}}),Mve=xde({stridedSlice_:function(e,t,n,r,i=0,a=0,o=0,s=0,l=0){const u=vde(e,"x","stridedSlice");return cde.runKernel(ice,{x:u},{begin:t,end:n,strides:r,beginMask:i,endMask:a,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:l})}}),Nve=xde({tan_:function(e){const t=vde(e,"x","tan");return cde.runKernel(ace,{x:t})}});function jve(e,t){Roe(e);const n=mde(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return _de(e,null,n,t)}function Fve(e,t,n){if(Roe(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");const r=mde(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return _de(e,t,r,n)}function Rve(e,t,n){if(Roe(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");const r=mde(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return _de(e,t,r,n)}function Pve(e,t,n){if(Roe(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");const r=mde(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return _de(e,t,r,n)}function Lve(e,t,n){if(Roe(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");const r=mde(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return _de(e,t=t||r,r,n)}const Bve=xde({topk_:function(e,t=1,n=!0){const r=vde(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const i=r.shape[r.shape.length-1];if(t>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got `+t);const a={x:r},o={k:t,sorted:n},[s,l]=cde.runKernel(lce,a,o);return{values:s,indices:l}}}),$ve=xde({truncatedNormal_:function(e,t=0,n=1,r,i){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const a=new Yge(t,n,r,!0,i),o=mhe(e,r);for(let s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),zve=xde({unique_:function(e,t=0){const n=vde(e,"x","unique","string_or_numeric");joe(n.rank>0,()=>"The input tensor must be at least 1D");const r={x:n},i={axis:t},[a,o]=cde.runKernel(cce,r,i);return{values:a,indices:o}}}),Uve=xde({unsortedSegmentSum_:function(e,t,n){const r=vde(e,"x","unsortedSegmentSum"),i=vde(t,"segmentIds","unsortedSegmentSum","int32");return joe(zoe(n),()=>"numSegments must be of dtype int"),cde.runKernel(hce,{x:r,segmentIds:i},{numSegments:n})}}),Hve=xde({unstack_:function(e,t=0){const n=vde(e,"x","unstack","string_or_numeric");return joe(t>=-n.shape.length&&t<n.shape.length,()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`),cde.runKernel(dce,{value:n},{axis:t})}});function Wve(e,t=!0,n,r){return cde.makeVariable(e,t,n,r)}function Vve(e,t){const n=[];for(let a=0;a<t.length;a++)t[a]&&n.push(a);const r=mhe(e,"int32"),i=mhe([n.length,e.length],"int32");for(let a=0;a<n.length;a++){const t=r.indexToLoc(n[a]);i.values.set(t,a*e.length)}return i.toTensor()}const qve=async function(e){const t=vde(e,"condition","whereAsync","bool"),n=await t.data(),r=Vve(t.shape,n);return e!==t&&t.dispose(),r},Gve=async function(e,t,n){const r=vde(e,"tensor","boolMask"),i=vde(t,"mask","boolMask","bool"),a=null==n?0:n,o=i.rank,s=r.shape;joe(o>0,()=>"mask cannot be scalar"),Foe(s.slice(a,a+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let m=a;m<a+o;m++)l*=s[m];const u=s.slice(0,a).concat([l],s.slice(a+o)),c=Ype(r,u),d=Ype(i,[-1]),h=await qve(d),f=Ave(h,[1]),p=Ume(c,f,a);return e!==r&&r.dispose(),t!==i&&i.dispose(),f.dispose(),c.dispose(),d.dispose(),h.dispose(),p},Yve=xde({equalStrict_:function(e,t){Ife("strict variants of ops have been deprecated and will be removed in future");const n=vde(e,"a","equalStrict"),r=vde(t,"b","equalStrict");return Foe(n.shape,r.shape,"Error in equalStrict: "),Ome(n,r)}}),Xve=xde({greaterEqualStrict_:function(e,t){Ife("strict variants of ops have been deprecated and will be removed in future");const n=vde(e,"a","greaterEqualStrict"),r=vde(t,"b","greaterEqualStrict");return Foe(n.shape,r.shape,"Error in greaterEqualStrict: "),Wme(n,r)}}),Kve=xde({greaterStrict_:function(e,t){Ife("strict variants of ops have been deprecated and will be removed in future");const n=vde(e,"a","greaterStrict"),r=vde(t,"b","greaterStrict");return Foe(n.shape,r.shape,"Error in greaterStrict: "),Hme(n,r)}}),Zve=xde({lessEqualStrict_:function(e,t){Ife("strict variants of ops have been deprecated and will be removed in future");const n=vde(e,"a","lessEqualStrict"),r=vde(t,"b","lessEqualStrict");return Foe(n.shape,r.shape,"Error in lessEqualStrict: "),Zme(n,r)}}),Jve=xde({lessStrict_:function(e,t){Ife("strict variants of ops have been deprecated and will be removed in future");const n=vde(e,"a","lessStrict"),r=vde(t,"b","lessStrict");return Foe(n.shape,r.shape,"Error in lessStrict: "),Kme(n,r)}}),Qve=xde({notEqualStrict_:function(e,t){Ife("strict variants of ops have been deprecated and will be removed in future");const n=vde(e,"a","notEqualStrict"),r=vde(t,"b","notEqualStrict");return Foe(n.shape,r.shape,"Error in notEqualStrict: "),Mge(n,r)}}),eye=xde({addStrict_:function(e,t){Ife("strict variants of ops have been deprecated and will be removed in future");const n=vde(e,"a","addStrict"),r=vde(t,"b","addStrict");return Foe(n.shape,r.shape,"Error in addStrict: "),qfe(n,r)}}),tye=xde({divStrict_:function(e,t){Ife("strict variants of ops have been deprecated and will be removed in future");const n=vde(e,"a","div"),r=vde(t,"b","div");return Foe(n.shape,r.shape,"Error in divideStrict: "),Yfe(n,r)}}),nye=xde({maximumStrict_:function(e,t){Ife("strict variants of ops have been deprecated and will be removed in future");const n=vde(e,"a","maximumStrict"),r=vde(t,"b","maximumStrict");return Foe(n.shape,r.shape,"Error in maximumStrict: "),ype(n,r)}}),rye=xde({minimumStrict_:function(e,t){Ife("strict variants of ops have been deprecated and will be removed in future");const n=vde(e,"a","minimumStrict"),r=vde(t,"b","minimumStrict");return Foe(n.shape,r.shape,"Error in minimumStrict: "),Tge(n,r)}}),iye=xde({modStrict_:function(e,t){Ife("strict variants of ops have been deprecated and will be removed in future");const n=vde(e,"a","modStrict"),r=vde(t,"b","modStrict");return Foe(n.shape,r.shape,"Error in modStrict: "),Ige(n,r)}}),aye=xde({mulStrict_:function(e,t){Ife("strict variants of ops have been deprecated and will be removed in future");const n=vde(e,"a","mul"),r=vde(t,"b","mul");return Foe(n.shape,r.shape,"Error in multiplyStrict: "),Xfe(n,r)}}),oye=xde({powStrict_:function(e,t){return Ife("strict variants of ops have been deprecated and will be removed in future"),Foe(e.shape,t.shape,"Error in powStrict: "),dpe(e,t)}}),sye=xde({squaredDifferenceStrict_:function(e,t){Ife("strict variants of ops have been deprecated and will be removed in future");const n=vde(e,"a","squaredDifferenceStrict"),r=vde(t,"b","squaredDifferenceStrict");return Foe(n.shape,r.shape,"Error in squaredDifferenceStrict: "),Ive(n,r)}}),lye=xde({subStrict_:function(e,t){Ife("strict variants of ops have been deprecated and will be removed in future");const n=vde(e,"a","subStrict"),r=vde(t,"b","subStrict");return Foe(n.shape,r.shape,"Error in subStrict: "),hpe(n,r)}}),uye=xde({norm_:function(e,t="euclidean",n=null,r=!1){const i=function e(t,n,r=null){if(0===t.rank)return ppe(t);if(1!==t.rank&&null===r)return e(Ype(t,[-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return oge(ppe(t),r);if(n===1/0)return age(ppe(t),r);if(n===-1/0)return Sge(ppe(t),r);if("euclidean"===n||2===n)return Kfe(oge(dpe(ppe(t),ope(2,"int32")),r));throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return age(oge(ppe(t),r[0]),r[1]-1);if(n===1/0)return age(oge(ppe(t),r[1]),r[0]);if(n===-1/0)return Sge(oge(ppe(t),r[1]),r[0]);if("fro"===n||"euclidean"===n)return Kfe(oge(Zfe(t),r));throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=vde(e,"x","norm"),t,n);let a=i.shape;if(r){const t=Yoe(n,e.shape);a=dge(i.shape,t)}return Ype(i,a)}}),cye=xde({movingAverage_:function(e,t,n,r,i=!0){const a=vde(e,"v","movingAverage"),o=vde(t,"x","movingAverage"),s=vde(n,"decay","movingAverage");ide(a,o),joe($oe(a.shape,o.shape),()=>"Shape mismatch in v and x");const l=ope(1),u=hpe(l,s);let c=Xfe(hpe(o,a),u);if(i){joe(null!=r,()=>"When using zeroDebias: true, step is required.");const e=vde(r,"step","movingAverage");c=Yfe(c,hpe(l,dpe(s,e)))}return qfe(a,c)}}),dye=xde({scatterND_:function(e,t,n){const r=vde(e,"indices","scatterND","int32"),i=vde(t,"updates","scatterND");return qhe(i,r,n),cde.runKernel($ue,{indices:r,updates:i},{shape:n})}}),hye=xde({sparseToDense_:function(e,t,n,r=0){const i=vde(e,"sparseIndices","sparseToDense","int32"),a=vde(t,"sparseValues","sparseToDense"),o=vde(r,"defaultValue","sparseToDense",a.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${e.shape}.`);const i=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${a}.`);if(0!==t.rank&&(1!==t.rank||t.size!==i))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${i}]`);if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,a,n,o),cde.runKernel(rce,{sparseIndices:i,sparseValues:a,defaultValue:o},{outputShape:n})}}),fye=xde({gatherND_:function(e,t){const n=vde(t,"indices","gatherND","int32"),r=vde(e,"x","gatherND");return cde.runKernel(Nle,{params:r,indices:n})}}),pye=xde({dropout_:function(e,t,n,r){const i=vde(e,"x","dropout");if(joe("float32"===i.dtype,()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`),joe(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),0===t)return e instanceof Gce?i.clone():i;const a=function(e,t){if(null==t)return e.shape.slice();if($oe(e.shape,t))return t;if(e.shape.length===t.length){const n=[];for(let r=0;r<e.shape.length;r++)n.push(null==t[r]&&null!=e.shape[r]?e.shape[r]:t[r]);return n}return t}(i,n),o=1-t,s=Yfe(zme(qfe(Qge(a,0,1,"float32",r),o)),o);return Xfe(i,s)}});function mye(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function gye(e,t,n){const r=1-e%2,i=new Float32Array(e);for(let a=0;a<e;++a){const o=2*Math.PI*a/(e+r-1);i[a]=t-n*Math.cos(o)}return jve(i,"float32")}const vye=async function(e,t,n=1){const r=vde(e,"predictions","inTopK"),i=vde(t,"targets","inTopK");joe(r.rank>1,()=>"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank),joe(r.rank-1===i.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${i.rank}`),Foe(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const a=r.shape[r.shape.length-1];joe(n>0&&n<=a,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${a}), but got ${n}`);const o=await r.data(),s=await i.data(),[l,u]=[o.length/a,a],c=Koe("bool",l);for(let d=0;d<l;d++){const e=d*u,t=o.subarray(e,e+u),r=[];for(let n=0;n<t.length;n++)r.push({value:t[n],index:n});r.sort((e,t)=>t.value-e.value),c[d]=0;for(let i=0;i<n;i++)if(r[i].index===s[d]){c[d]=1;break}}return e!==r&&r.dispose(),t!==i&&i.dispose(),kde(c,i.shape,"bool")},yye=xde({conv2DBackpropFilter_:function(e,t,n,r,i,a="NHWC",o){let s=e;3===e.rank&&(s=Ype(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=Ype(t,[1,t.shape[0],t.shape[1],t.shape[2]])),joe(4===s.rank,()=>"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."),joe(4===l.rank,()=>"Error in conv2dDerFilter: dy must be rank 4, but got shape "+l.shape+"."),joe(4===n.length,()=>"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+".");const u="NHWC"===a?s.shape[3]:s.shape[1],c="NHWC"===a?l.shape[3]:l.shape[1];return joe(u===n[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${n[2]}.`),joe(c===n[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`),null!=o&&joe(zoe(i),()=>`Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ${o} but got pad ${i}.`),cde.runKernel(ele,{x:s,dy:l},{strides:r,pad:i,dataFormat:a,dimRoundingMode:o,filterShape:n})}});function bye(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return Xfe(e,Dve(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function xye(e,t){let n=t;const r=gpe(e.shape,t.shape);return r.length>0&&(n=oge(n,r)),Ype(n,e.shape)}function wye(e,t,n,r){if("linear"===t)return e;if("relu"===t)return rve(e);if("elu"===t)return jme(e);if("relu6"===t)return ive(e);if("prelu"===t)return Wge(e,n);if("leakyrelu"===t)return Xme(e,r);throw new Error(`Unknown fused activation ${t}.`)}const _ye=(e,t)=>!(e>0)||"linear"===t,kye=xde({fusedConv2d_:function({x:e,filter:t,strides:n,pad:r,dataFormat:i="NHWC",dilations:a=[1,1],dimRoundingMode:o,bias:s,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(!1===_ye(cde.state.gradientDepth,l=l||"linear")){let d=mme(e,t,n,r,i,a,o);return null!=s&&(d=qfe(d,s)),wye(d,l,u,c)}const d=vde(e,"x","conv2d"),h=vde(t,"filter","conv2d");let f=d,p=!1;3===d.rank&&(p=!0,f=Ype(d,[1,d.shape[0],d.shape[1],d.shape[2]])),joe(4===f.rank,()=>"Error in fused conv2d: input must be rank 4, but got rank "+f.rank+"."),joe(4===h.rank,()=>"Error in fused conv2d: filter must be rank 4, but got rank "+h.rank+"."),null!=o&&joe(zoe(r),()=>`Error in fused conv2d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`),joe(f.shape[3]===h.shape[2],()=>`Error in conv2d: depth of input (${f.shape[3]}) must match input depth for filter ${h.shape[2]}.`),joe(qpe(n,a),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`),joe("NHWC"===i,()=>`Error in conv2d: got dataFormat of ${i} but only NHWC is currently supported.`);const m=Lpe(f.shape,h.shape,n,a,r,o);let g,v;null!=s&&(g=vde(s,"bias","fused conv2d"),[g]=rde(g,d),vpe(m.outShape,g.shape)),null!=u&&(v=vde(u,"prelu weights","fused conv2d"));const y=(e,t)=>{const[i,o,s,u]=t,c=bye(e,s,l);joe(Vpe(a),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${a}'`);const d=[vme(o.shape,c,i,n,r),yye(o,c,i.shape,n,r)];if(null!=u){const e=xye(u,c);d.push(e)}return d},b={x:f,filter:h,bias:g,preluActivationWeights:v},x={strides:n,pad:r,dataFormat:i,dilations:a,dimRoundingMode:o,activation:l,leakyreluAlpha:c};return null==s?ipe((e,t,n)=>{let r=cde.runKernel(yce,b,x);return n([t,e,r]),p&&(r=Ype(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:y}})(f,h):ipe((e,t,n,r)=>{let i=cde.runKernel(yce,b,x);return r([t,e,i,n]),p&&(i=Ype(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:y}})(f,h,g)}}),Eye=xde({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,i,a=[1,1],o){let s=e;3===e.rank&&(s=Ype(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;return 3===l.rank&&(l=Ype(t,[1,t.shape[0],t.shape[1],t.shape[2]])),cde.runKernel(hle,{x:s,dy:l},{strides:r,pad:i,dimRoundingMode:o,dilations:a,filterShape:n})}}),Sye=xde({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,i,a=[1,1],o){let s=t,l=!1;3===t.rank&&(l=!0,s=Ype(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const u=cde.runKernel(fle,{dy:s,filter:n},{strides:r,pad:i,dimRoundingMode:o,dilations:a,inputShape:e});return l?Ype(u,[u.shape[1],u.shape[2],u.shape[3]]):u}}),Tye=xde({fusedDepthwiseConv2d_:function({x:e,filter:t,strides:n,pad:r,dataFormat:i="NHWC",dilations:a=[1,1],dimRoundingMode:o,bias:s,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(!1===_ye(cde.state.gradientDepth,l)){let d=Cme(e,t,n,r,i,a,o);return null!=s&&(d=qfe(d,s)),wye(d,l,u,c)}const d=vde(e,"x","depthwiseConv2d"),h=vde(t,"filter","depthwiseConv2d");let f=d,p=!1;3===d.rank&&(p=!0,f=Ype(d,[1,d.shape[0],d.shape[1],d.shape[2]])),joe(4===f.rank,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${f.rank}.`),joe(4===h.rank,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`),joe(f.shape[3]===h.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${f.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`),null==a&&(a=[1,1]),joe(qpe(n,a),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`),null!=o&&joe(zoe(r),()=>`Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode ${o} but got pad ${r}.`);const m=Lpe(f.shape,h.shape,n,a,r,o,!0);let g,v;null!=s&&(g=vde(s,"bias","fused conv2d"),[g]=rde(g,d),vpe(m.outShape,g.shape)),null!=u&&(v=vde(u,"prelu weights","fused depthwiseConv2d"));const y=(e,t)=>{joe(Vpe(a),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[i,s,u,c]=t,d=bye(e,u,l),h=Sye(s.shape,d,i,n,r,a,o),f=Eye(s,d,i.shape,n,r,a,o);return null!=c?[h,f,xye(g,d)]:[h,f]},b={x:f,filter:h,bias:g,preluActivationWeights:v},x={strides:n,pad:r,dataFormat:i,dilations:a,dimRoundingMode:o,activation:l,leakyreluAlpha:c};return null==s?ipe((e,t,n)=>{let r=cde.runKernel(bce,b,x);return n([t,e,r]),p&&(r=Ype(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:y}})(f,h):ipe((e,t,n,r)=>{let i=cde.runKernel(bce,b,x);return r([t,e,i,n]),p&&(i=Ype(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:y}})(f,h,g)}}),Cye=xde({fusedMatMul_:function({a:e,b:t,transposeA:n=!1,transposeB:r=!1,bias:i,activation:a="linear",preluActivationWeights:o,leakyreluAlpha:s}){if(!1===_ye(cde.state.gradientDepth,a)){let l=Rhe(e,t,n,r);return null!=i&&(l=qfe(l,i)),wye(l,a,o,s)}let l=vde(e,"a","fused matMul"),u=vde(t,"b","fused matMul");[l,u]=rde(l,u);const c=n?l.shape[l.rank-2]:l.shape[l.rank-1],d=r?u.shape[u.rank-1]:u.shape[u.rank-2],h=n?l.shape[l.rank-1]:l.shape[l.rank-2],f=r?u.shape[u.rank-2]:u.shape[u.rank-1],p=l.shape.slice(0,-2),m=u.shape.slice(0,-2),g=Loe(p),v=Loe(m);joe(l.rank>=2&&u.rank>=2&&l.rank===u.rank,()=>`Error in fused matMul: inputs must have the same rank of at least 2, got ranks ${l.rank} and ${u.rank}.`),joe($oe(p,m),()=>`Error in fused matMul: outer dimensions (${p}) and (${m}) of Tensors with shapes ${l.shape} and `+u.shape+" must match."),joe(c===d,()=>`Error in fused matMul: inner shapes (${c}) and (${d}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${n} and transposeB=${r} must match.`);const y=l.shape.slice(0,-2).concat([h,f]),b=Ype(l,n?[g,c,h]:[g,h,c]),x=Ype(u,r?[v,f,d]:[v,d,f]);let w,_;null!=i&&(w=vde(i,"bias","fused matMul"),[w]=rde(w,l),vpe(y,w.shape)),null!=o&&(_=vde(o,"prelu weights","fused matMul"));const k=(e,t)=>{const[o,s,l,u]=t,c=bye(Ype(e,l.shape),l,a);let d,h;return n||r?!n&&r?(d=Rhe(c,s,!1,!1),h=Rhe(c,o,!0,!1)):n&&!r?(d=Rhe(s,c,!1,!0),h=Rhe(o,c,!1,!1)):(d=Rhe(s,c,!0,!0),h=Rhe(c,o,!0,!0)):(d=Rhe(c,s,!1,!0),h=Rhe(o,c,!0,!1)),null!=i?[d,h,xye(u,c)]:[d,h]},E={a:b,b:x,bias:w,preluActivationWeights:_},S={transposeA:n,transposeB:r,activation:a,leakyreluAlpha:s};return null==i?ipe((e,t,n)=>{const r=cde.runKernel(vce,E,S);return n([e,t,r]),{value:Ype(r,y),gradFunc:k}})(b,x):ipe((e,t,n,r)=>{const i=cde.runKernel(vce,E,S);return r([e,t,i,n]),{value:Ype(i,y),gradFunc:k}})(b,x,w)}}),Iye=xde({hammingWindow_:function(e){return gye(e,.54,.46)}}),Aye=xde({hannWindow_:function(e){return gye(e,.5,.5)}}),Oye=xde({frame_:function(e,t,n,r=!1,i=0){let a=0;const o=[];for(;a+t<=e.size;)o.push(Qpe(e,a,t)),a+=n;if(r)for(;a<e.size;){const r=a+t-e.size,s=Zpe([Qpe(e,a,t-r),upe([r],i)]);o.push(s),a+=n}return 0===o.length?Fve([],[0,t]):Ype(Zpe(o),[o.length,t])}}),Dye=xde({stft_:function(e,t,n,r,i=Aye){null==r&&(r=mye(t));const a=Oye(e,t,n),o=Xfe(a,i(t)),s=[];for(let l=0;l<a.shape[0];l++)s.push(Cve(Qpe(o,[l,0],[1,t]),r));return Zpe(s)}}),Mye=xde({cropAndResize_:function(e,t,n,r,i="bilinear",a=0){const o=vde(e,"image","cropAndResize"),s=vde(t,"boxes","cropAndResize","float32"),l=vde(n,"boxInd","cropAndResize","int32"),u=s.shape[0];return joe(4===o.rank,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),joe(2===s.rank&&4===s.shape[1],()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${s.shape}.`),joe(1===l.rank&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${s.shape}.`),joe(2===r.length,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),joe(r[0]>=1&&r[1]>=1,()=>"cropSize must be atleast [1,1], but was "+r),joe("bilinear"===i||"nearest"===i,()=>"method must be bilinear or nearest, but was "+i),cde.runKernel(lle,{image:o,boxes:s,boxInd:l},{method:i,extrapolationValue:a,cropSize:r})}}),Nye=xde({flipLeftRight_:function(e){const t=vde(e,"image","flipLeftRight","float32");return joe(4===t.rank,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`),cde.runKernel(Ile,{image:t},{})}}),jye=xde({rotateWithOffset_:function(e,t,n=0,r=.5){const i=vde(e,"image","rotateWithOffset","float32");return joe(4===i.rank,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`),cde.runKernel(gce,{image:i},{radians:t,fillValue:n,center:r})}});function Fye(e,t,n,r,i,a){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==a&&(a=0);const o=e.shape[0];return n=Math.min(n,o),joe(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),joe(2===e.rank,()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`),joe(4===e.shape[1],()=>"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]),joe(1===t.rank,()=>"scores must be a 1D tensor"),joe(t.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was `+t.shape[0]),joe(0<=a&&a<=1,()=>`softNmsSigma must be in [0, 1], but was '${a}'`),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:a}}const Rye=xde({nonMaxSuppression_:function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY){const a=vde(e,"boxes","nonMaxSuppression"),o=vde(t,"scores","nonMaxSuppression"),s=Fye(a,o,n,r,i);return cde.runKernel(gue,{boxes:a,scores:o},{maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:i=s.scoreThreshold})}});function Pye(e,t,n){const r=function(e,t,n){return function(e,t,n){let r=0,i=e.length,a=0,o=!1;for(;r<i;){a=r+(i-r>>>1);const s=n(t,e[a]);s>0?r=a+1:(i=a,o=!s)}return o?r:-r-1}(e,t,n||Lye)}(e,t,n);e.splice(r<0?-(r+1):r,0,t)}function Lye(e,t){return e>t?1:e<t?-1:0}function Bye(e,t,n,r,i){return Uye(e,t,n,r,i,0)}function $ye(e,t,n,r,i,a){return Uye(e,t,n,r,i,0,!1,a,!0)}function zye(e,t,n,r,i,a){return Uye(e,t,n,r,i,a,!0)}function Uye(e,t,n,r,i,a,o=!1,s=!1,l=!1){const u=[];for(let g=0;g<t.length;g++)t[g]>i&&u.push({score:t[g],boxIndex:g,suppressBeginIndex:0});u.sort(Vye);const c=a>0?-.5/a:0,d=[],h=[];for(;d.length<n&&u.length>0;){const t=u.pop(),{score:n,boxIndex:a,suppressBeginIndex:o}=t;if(n<i)break;let s=!1;for(let l=d.length-1;l>=o;--l){const n=Hye(e,a,d[l]);if(n>=r){s=!0;break}if(t.score=t.score*Wye(r,c,n),t.score<=i)break}t.suppressBeginIndex=d.length,s||(t.score===n?(d.push(a),h.push(t.score)):t.score>i&&Pye(u,t,Vye))}const f=d.length,p=n-f;s&&p>0&&(d.push(...new Array(p).fill(0)),h.push(...new Array(p).fill(0)));const m={selectedIndices:d};return o&&(m.selectedScores=h),l&&(m.validOutputs=f),m}function Hye(e,t,n){const r=e.subarray(4*t,4*t+4),i=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),u=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),d=Math.max(i[0],i[2]),h=Math.max(i[1],i[3]),f=(s-a)*(l-o),p=(d-u)*(h-c);if(f<=0||p<=0)return 0;const m=Math.max(a,u),g=Math.max(o,c),v=Math.min(s,d),y=Math.min(l,h),b=Math.max(v-m,0)*Math.max(y-g,0);return b/(f+p-b)}function Wye(e,t,n){const r=Math.exp(t*n*n);return n<=e?r:0}function Vye(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}const qye=xde({nonMaxSuppressionWithScore_:function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,a=0){const o=vde(e,"boxes","nonMaxSuppression"),s=vde(t,"scores","nonMaxSuppression"),l=Fye(o,s,n,r,i,a),u=cde.runKernel(yue,{boxes:o,scores:s},{maxOutputSize:n=l.maxOutputSize,iouThreshold:r=l.iouThreshold,scoreThreshold:i=l.scoreThreshold,softNmsSigma:a=l.softNmsSigma});return{selectedIndices:u[0],selectedScores:u[1]}}}),Gye=xde({nonMaxSuppressionPadded_:function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,a=!1){const o=vde(e,"boxes","nonMaxSuppression"),s=vde(t,"scores","nonMaxSuppression"),l=Fye(o,s,n,r,i,null),u=cde.runKernel(vue,{boxes:o,scores:s},{maxOutputSize:l.maxOutputSize,iouThreshold:l.iouThreshold,scoreThreshold:l.scoreThreshold,padToMaxOutputSize:a});return{selectedIndices:u[0],validOutputs:u[1]}}}),Yye=xde({resizeBilinear_:function(e,t,n=!1,r=!1){const i=vde(e,"images","resizeBilinear");joe(3===i.rank||4===i.rank,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`),joe(2===t.length,()=>"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."),joe(!1===r||!1===n,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let a=i,o=!1;3===i.rank&&(o=!0,a=Ype(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const[]=t,s=cde.runKernel(jue,{images:a},{alignCorners:n,halfPixelCenters:r,size:t});return o?Ype(s,[s.shape[1],s.shape[2],s.shape[3]]):s}}),Xye=xde({resizeNearestNeighbor_:function(e,t,n=!1,r=!1){const i=vde(e,"images","resizeNearestNeighbor");joe(3===i.rank||4===i.rank,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`),joe(2===t.length,()=>"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."),joe("float32"===i.dtype||"int32"===i.dtype,()=>"`images` must have `int32` or `float32` as dtype"),joe(!1===r||!1===n,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let a=i,o=!1;3===i.rank&&(o=!0,a=Ype(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const[]=t,s=cde.runKernel(Mue,{images:a},{alignCorners:n,halfPixelCenters:r,size:t});return o?Ype(s,[s.shape[1],s.shape[2],s.shape[3]]):s}}),Kye=xde({bandPart_:function(e,t,n){joe(t%1==0,()=>`bandPart(): numLower must be an integer, got ${t}.`),joe(n%1==0,()=>`bandPart(): numUpper must be an integer, got ${n}.`);const r=vde(e,"a","bandPart");joe(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const i=r.shape,[a,o]=r.shape.slice(-2);if(!(t<=a))throw new Error(`bandPart(): numLower (${t}) must not be greater than the number of rows (${a}).`);if(!(n<=o))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`);t<0&&(t=a),n<0&&(n=o);const s=Ype(eve(0,a,1,"int32"),[-1,1]),l=eve(0,o,1,"int32"),u=hpe(s,l),c=vge(Zme(u,ope(+t,"int32")),Wme(u,ope(-n,"int32"))),d=Nge([a,o],r.dtype);return Ype(Ove(Hve(Ype(r,[-1,a,o])).map(e=>Dme(c,e,d))),i)}}),Zye=xde({gramSchmidt_:function(e){let t;if(Array.isArray(e)){t=!1,joe(null!=e&&e.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const n=e[0].shape[0];for(let t=1;t<e.length;++t)joe(e[t].shape[0]===n,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${e[t].shape[0]} vs. ${n})`)}else t=!0,e=Tve(e,e.shape[0],0).map(e=>Ave(e,[0]));joe(e.length<=e[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${e.length}) exceeds number of dimensions (${e[0].shape[0]}).`);const n=[],r=e;for(let i=0;i<e.length;++i)n.push(cde.tidy(()=>{let e=r[i];if(i>0)for(let t=0;t<i;++t){const r=Xfe(oge(Xfe(n[t],e)),n[t]);e=hpe(e,r)}return Yfe(e,uye(e,"euclidean"))}));return t?Ove(n,0):n}});function Jye(e,t=!1){return cde.tidy(()=>{joe(2===e.shape.length,()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`);const n=e.shape[0],r=e.shape[1];let i=$me(n),a=vhe(e);const o=Fve([[1]],[1,1]);let s=vhe(o);const l=n>=r?r:n;for(let e=0;e<l;++e){const t=a,l=s,u=i;[s,a,i]=cde.tidy(()=>{const t=Qpe(a,[e,e],[n-e,1]),l=uye(t),u=Qpe(a,[e,e],[1,1]),c=Dme(Hme(u,0),Fve([[-1]]),Fve([[1]])),d=hpe(u,Xfe(c,l)),h=Yfe(t,d);s=1===h.shape[0]?vhe(o):Zpe([o,Qpe(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);const f=nge(Yfe(Rhe(c,d),l)),p=Qpe(a,[e,0],[n-e,r]),m=Xfe(f,s),g=Lhe(s);if(0===e)a=hpe(p,Rhe(m,Rhe(g,p)));else{const t=hpe(p,Rhe(m,Rhe(g,p)));a=Zpe([Qpe(a,[0,0],[e,r]),t],0)}const v=Lhe(m),y=Qpe(i,[0,e],[n,i.shape[1]-e]);if(0===e)i=hpe(y,Rhe(Rhe(y,s),v));else{const t=hpe(y,Rhe(Rhe(y,s),v));i=Zpe([Qpe(i,[0,0],[n,e]),t],1)}return[s,a,i]}),jfe([t,l,u])}return!t&&n>r&&(i=Qpe(i,[0,0],[n,r]),a=Qpe(a,[0,0],[r,r])),[i,a]})}const Qye=xde({qr_:function(e,t=!1){if(joe(e.rank>=2,()=>"qr() requires input tensor to have a rank >= 2, but got rank "+e.rank),2===e.rank)return Jye(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce((e,t)=>e*t),r=Hve(Ype(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],a=[];return r.forEach(e=>{const[n,r]=Jye(e,t);i.push(n),a.push(r)}),[Ype(Ove(i,0),e.shape),Ype(Ove(a,0),e.shape)]}}});var ebe;!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(ebe||(ebe={}));const tbe=xde({computeWeightedLoss_:function(e,t,n=ebe.SUM_BY_NONZERO_WEIGHTS){const r=vde(e,"losses","computeWeightedLoss");let i=null;null!=t&&(i=vde(t,"weights","computeWeightedLoss"));const a=null==i?r:Xfe(r,i);if(n===ebe.NONE)return a;if(n===ebe.SUM)return oge(a);if(n===ebe.MEAN){if(null==i)return Ege(a);{const e=r.size/i.size,t=Yfe(oge(a),oge(i));return e>1?Yfe(t,ope(e)):t}}if(n===ebe.SUM_BY_NONZERO_WEIGHTS){if(null==i)return Yfe(oge(a),ope(r.size));{const e=Xfe(i,jge(r.shape)),t=ghe(oge(Mge(e,ope(0))),"float32");return Yfe(oge(a),t)}}throw Error("Unknown reduction: "+n)}}),nbe=xde({absoluteDifference_:function(e,t,n,r=ebe.SUM_BY_NONZERO_WEIGHTS){const i=vde(e,"labels","absoluteDifference"),a=vde(t,"predictions","absoluteDifference");let o=null;null!=n&&(o=vde(n,"weights","absoluteDifference")),Foe(i.shape,a.shape,"Error in absoluteDifference: ");const s=ppe(hpe(i,a));return tbe(s,o,r)}}),rbe=xde({cosineDistance_:function(e,t,n,r,i=ebe.SUM_BY_NONZERO_WEIGHTS){const a=vde(e,"labels","cosineDistance"),o=vde(t,"predictions","cosineDistance");let s=null;null!=r&&(s=vde(r,"weights","cosineDistance")),Foe(a.shape,o.shape,"Error in cosineDistance: ");const l=ope(1),u=hpe(l,oge(Xfe(a,o),n,!0));return tbe(u,s,i)}}),ibe=xde({hingeLoss_:function(e,t,n,r=ebe.SUM_BY_NONZERO_WEIGHTS){let i=vde(e,"labels","hingeLoss");const a=vde(t,"predictions","hingeLoss");let o=null;null!=n&&(o=vde(n,"weights","hingeLoss")),Foe(i.shape,a.shape,"Error in hingeLoss: ");const s=ope(1);i=hpe(Xfe(ope(2),i),s);const l=rve(hpe(s,Xfe(i,a)));return tbe(l,o,r)}}),abe=xde({huberLoss_:function(e,t,n,r=1,i=ebe.SUM_BY_NONZERO_WEIGHTS){const a=vde(e,"labels","huberLoss"),o=vde(t,"predictions","huberLoss");let s=null;null!=n&&(s=vde(n,"weights","huberLoss")),Foe(a.shape,o.shape,"Error in huberLoss: ");const l=ope(r),u=ppe(hpe(o,a)),c=Tge(u,l),d=hpe(u,c),h=qfe(Xfe(ope(.5),Zfe(c)),Xfe(l,d));return tbe(h,s,i)}}),obe=xde({logLoss_:function(e,t,n,r=1e-7,i=ebe.SUM_BY_NONZERO_WEIGHTS){const a=vde(e,"labels","logLoss"),o=vde(t,"predictions","logLoss");let s=null;null!=n&&(s=vde(n,"weights","logLoss")),Foe(a.shape,o.shape,"Error in logLoss: ");const l=ope(1),u=ope(r),c=nge(Xfe(a,ege(qfe(o,u)))),d=Xfe(hpe(l,a),ege(qfe(hpe(l,o),u))),h=hpe(c,d);return tbe(h,s,i)}}),sbe=xde({meanSquaredError_:function(e,t,n,r=ebe.SUM_BY_NONZERO_WEIGHTS){const i=vde(e,"labels","meanSquaredError"),a=vde(t,"predictions","meanSquaredError");let o=null;null!=n&&(o=vde(n,"weights","meanSquaredError")),Foe(i.shape,a.shape,"Error in meanSquaredError: ");const s=Ive(i,a);return tbe(s,o,r)}}),lbe=xde({sigmoidCrossEntropy_:function(e,t,n,r=0,i=ebe.SUM_BY_NONZERO_WEIGHTS){let a=vde(e,"multiClassLabels","sigmoidCrossEntropy");const o=vde(t,"logits","sigmoidCrossEntropy");let s=null;if(null!=n&&(s=vde(n,"weights","sigmoidCrossEntropy")),Foe(a.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){const e=ope(r),t=ope(1),n=ope(.5);a=qfe(Xfe(a,hpe(t,e)),Xfe(n,e))}const l=function(e,t){const n=vde(e,"labels","sigmoidCrossEntropyWithLogits"),r=vde(t,"logits","sigmoidCrossEntropyWithLogits");Foe(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const i=rve(r),a=Xfe(r,n),o=tge(Rme(nge(ppe(r))));return qfe(hpe(i,a),o)}(a,o);return tbe(l,s,i)}}),ube=xde({softmaxCrossEntropy_:function(e,t,n,r=0,i=ebe.SUM_BY_NONZERO_WEIGHTS){let a=vde(e,"onehotLabels","softmaxCrossEntropy");const o=vde(t,"logits","softmaxCrossEntropy");let s=null;if(null!=n&&(s=vde(n,"weights","softmaxCrossEntropy")),Foe(a.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){const e=ope(r),t=ope(1),n=ope(a.shape[1]);a=qfe(Xfe(a,hpe(t,e)),Yfe(e,n))}const l=function(e,t,n=-1){if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was `+n);return ipe((e,t,r)=>{const i=gge(t,[n],!0),a=hpe(ghe(t,"float32"),i);r([e,a]);const o=nge(Xfe(a,e));return{value:oge(o,[n]),gradFunc:(e,t)=>{const[r,i]=t,a=dge(e.shape,[n]);return[Xfe(Ype(e,a),hpe(ghe(r,"float32"),Rme(i))),Xfe(Ype(e,a),hpe(Rme(i),ghe(r,"float32")))]}}})(e,t)}(a,o);return tbe(l,s,i)}}),cbe={fft:kve,ifft:Eve,rfft:Cve,irfft:Sve},dbe={hammingWindow:Iye,hannWindow:Aye,frame:Oye,stft:Dye},hbe={flipLeftRight:Nye,resizeNearestNeighbor:Xye,resizeBilinear:Yye,rotateWithOffset:jye,cropAndResize:Mye,nonMaxSuppression:Rye,nonMaxSuppressionAsync:async function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY){const a=vde(e,"boxes","nonMaxSuppressionAsync"),o=vde(t,"scores","nonMaxSuppressionAsync"),s=Fye(a,o,n,r,i);n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold;const l=await Promise.all([a.data(),o.data()]),u=l[0],c=l[1],{selectedIndices:d}=Bye(u,c,n,r,i);return a!==e&&a.dispose(),o!==t&&o.dispose(),jve(d,"int32")},nonMaxSuppressionWithScore:qye,nonMaxSuppressionWithScoreAsync:async function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,a=0){const o=vde(e,"boxes","nonMaxSuppressionAsync"),s=vde(t,"scores","nonMaxSuppressionAsync"),l=Fye(o,s,n,r,i,a);n=l.maxOutputSize,r=l.iouThreshold,i=l.scoreThreshold,a=l.softNmsSigma;const u=await Promise.all([o.data(),s.data()]),c=u[0],d=u[1],{selectedIndices:h,selectedScores:f}=zye(c,d,n,r,i,a);return o!==e&&o.dispose(),s!==t&&s.dispose(),{selectedIndices:jve(h,"int32"),selectedScores:jve(f)}},nonMaxSuppressionPadded:Gye,nonMaxSuppressionPaddedAsync:async function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,a=!1){const o=vde(e,"boxes","nonMaxSuppressionAsync"),s=vde(t,"scores","nonMaxSuppressionAsync"),l=Fye(o,s,n,r,i,null),u=l.maxOutputSize,c=l.iouThreshold,d=l.scoreThreshold,[h,f]=await Promise.all([o.data(),s.data()]),{selectedIndices:p,validOutputs:m}=$ye(h,f,u,c,d,a);return o!==e&&o.dispose(),s!==t&&s.dispose(),{selectedIndices:jve(p,"int32"),validOutputs:ope(m,"int32")}}},fbe={bandPart:Kye,gramSchmidt:Zye,qr:Qye},pbe={absoluteDifference:nbe,computeWeightedLoss:tbe,cosineDistance:rbe,hingeLoss:ibe,huberLoss:abe,logLoss:obe,meanSquaredError:sbe,sigmoidCrossEntropy:lbe,softmaxCrossEntropy:ube};class mbe{static sgd(e){return new xpe(e)}static momentum(e,t,n=!1){return new wpe(e,t,n)}static rmsprop(e,t=.9,n=0,r=null,i=!1){return new _pe(e,t,n,r,i)}static adam(e=.001,t=.9,n=.999,r=null){return new fpe(e,t,n,r)}static adadelta(e=.001,t=.95,n=null){return new lpe(e,t,n)}static adamax(e=.002,t=.9,n=.999,r=null,i=0){return new bpe(e,t,n,r,i)}static adagrad(e,t=.1){return new cpe(e,t)}}const gbe={sgd:mbe.sgd,momentum:mbe.momentum,adadelta:mbe.adadelta,adagrad:mbe.adagrad,rmsprop:mbe.rmsprop,adamax:mbe.adamax,adam:mbe.adam},vbe="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:e=>e();function ybe(){return new Promise(e=>vbe(()=>e()))}function bbe(e,t){const n=e[0].length;e.forEach((e,t)=>{joe(e.length===n,()=>`Error in concat${n}D: rank of tensors[${t}] must be the same as the rank of the rest (${n})`)}),joe(t>=0&&t<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const r=e[0];e.forEach((e,i)=>{for(let a=0;a<n;a++)joe(a===t||e[a]===r[a],()=>`Error in concat${n}D: Shape of tensors[${i}] (${e}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`)})}function xbe(e,t){const n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}const wbe=30;function _be(e){return e<=wbe?e:use(e,Math.floor(Math.sqrt(e)))}function kbe(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function Ebe(e,t,n,r=!0){let i=[];if(r)i=i.concat(t.slice(0)),i.push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);const n=t.length;for(let r=0;r<n;++r)i=i.concat([e[r+1]/t[r],t[r]]);i=i.concat(e.slice(n+1))}return i}function Sbe(e,t,n=!0){const r=[];if(n){r.push(t);for(let n=t+1;n<e;++n)n<=2*t?(r.push(n),r.push(n-(t+1))):r.push(n)}else{const n=[],i=[];for(let r=1;r<e;++r)r>=2*t+1||r%2==1?i.push(r):n.push(r);r.push(...n),r.push(0),r.push(...i)}return r}function Tbe(e,t,n,r=!0){const i=[];i.push(r?e[0]/n:e[0]*n);for(let a=1;a<e.length;++a)i.push(a<=t.length?r?t[a-1]*e[a]:e[a]/t[a-1]:e[a]);return i}function Cbe(e,t){const n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function Ibe(e,t,n){const r=e.slice(0,1);for(let i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}const Abe=1.7580993408473768,Obe=1.0507009873554805,Dbe=.3275911,Mbe=.254829592,Nbe=-.284496736,jbe=1.421413741,Fbe=-1.453152027,Rbe=1.061405429;function Pbe(...e){xse().getBool("IS_TEST")||console.warn(...e)}function Lbe(...e){xse().getBool("IS_TEST")||console.log(...e)}function Bbe(e,t){if(e.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);const n=new Float32Array(2*e.length);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function $be(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function zbe(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let i=0;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}function Ube(e){const t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let i=2;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}function Hbe(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Wbe(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Vbe(e,t){const n=new Float32Array(e/2),r=new Float32Array(e/2);for(let i=0;i<Math.ceil(e/2);i++){const a=(t?2:-2)*Math.PI*(i/e);n[i]=Math.cos(a),r[i]=Math.sin(a)}return{real:n,imag:r}}function qbe(e,t,n){const r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Gbe(e,t,n=0){let r=[];if("number"==typeof t)joe(e.shape[n]%t==0,()=>"Number of splits must evenly divide the axis."),r=new Array(t).fill(e.shape[n]/t);else{joe(t.reduce((e,t)=>(-1===t&&(e+=1),e),0)<=1,()=>"There should be only one negative value in split array.");const i=t.indexOf(-1);if(-1!==i){const r=t.reduce((e,t)=>t>0?e+t:e);t[i]=e.shape[n]-r}joe(e.shape[n]===t.reduce((e,t)=>e+t),()=>"The sum of sizes must match the size of the axis dimension."),r=t}return r}function Ybe(e,t){let n,r=!1;for(e<=wbe?(n=e,r=!0):n=use(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=use(e,n+1);return n}function Xbe(e,t,n){const r=[],i=e.length;for(let a=0;a<i;a++)r.push(a!==t?e[a]:n);return r}function Kbe(e,t,n,r){const i=t.shape.length,a=e.shape.length;if(0!==r&&(r<-i||r>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${r}`);if(r<0&&(r+=i),r>a)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${a}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let d=0;d<r;++d)if(e.shape[d]!==t.shape[d])throw new Error(`x.shape[${d}]: ${e.shape[d]} should be equal to indices.shape[${d}]: ${t.shape[d]}.`);const o=e.shape[n],s=[];let l=1,u=1,c=1;for(let d=0;d<r;++d)s.push(e.shape[d]),l*=e.shape[d];for(let d=r;d<n;d++)s.push(e.shape[d]),u*=e.shape[d];for(let d=r;d<i;d++)s.push(t.shape[d]);for(let d=n+1;d<a;d++)s.push(e.shape[d]),c*=e.shape[d];return{batchSize:l,sliceSize:c,outerSize:u,dimSize:o,outputShape:s}}function Zbe(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();const t=Nge(e.shape),r=ghe(e,"float32"),i=n.complex(r,t);return t.dispose(),r.dispose(),i}if(!ese(e.dtype,t))return cde.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){const r=n.real(e),i=ghe(r,t);return r.dispose(),i}if("int32"===t)return n.int(e);if("bool"===t){const t=ope(0,e.dtype),r=n.notEqual(e,t);return t.dispose(),r}throw new Error(`Error in Cast: failed to cast ${e.dtype} to ${t}`)}function Jbe(e,t){return cde.makeTensorFromDataId(e.dataId,t,e.dtype)}function Qbe(e){try{return e.map(e=>Uce(e))}catch(qqe){throw new Error("Failed to decode encoded string bytes into utf-8, error: "+qqe)}}function exe(e){return e.map(e=>zce(e))}const txe={kernelName:Sse,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Xfe(e,Dve(ghe(n,"float32"),-1))}}},nxe={kernelName:Tse,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=Zfe(ghe(n,"float32")),r=Kfe(hpe(ope(1),t));return nge(Yfe(e,r))}}}},rxe={kernelName:Cse,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=Kfe(hpe(Zfe(ghe(n,"float32")),1));return Yfe(e,t)}}}},ixe={kernelName:Ise,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=vpe(n.shape,r.shape);return{a:()=>{let t=e;const r=gpe(n.shape,i);return r.length>0&&(t=oge(t,r)),Ype(t,n.shape)},b:()=>{let t=e;const n=gpe(r.shape,i);return n.length>0&&(t=oge(t,n)),Ype(t,r.shape)}}}},axe={kernelName:Ase,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach((t,r)=>{n[r]=()=>e.clone()}),n}},oxe={kernelName:Mse,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Jfe(n)}}},sxe={kernelName:Nse,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Jfe(n)}}},lxe={kernelName:jse,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Yfe(e,Kfe(hpe(ope(1),Zfe(ghe(n,"float32")))))}}},uxe={kernelName:Fse,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=Kfe(qfe(ope(1),Zfe(ghe(n,"float32"))));return Yfe(e,t)}}}},cxe={kernelName:Lse,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=vpe(n.shape,r.shape);return{a:()=>{const t=qfe(Zfe(n),Zfe(r));let a=Xfe(e,Yfe(r,t));const o=gpe(n.shape,i);return o.length>0&&(a=oge(a,o)),Ype(a,n.shape)},b:()=>{const t=qfe(Zfe(n),Zfe(r));let a=nge(Xfe(e,Yfe(n,t)));const o=gpe(r.shape,i);return o.length>0&&(a=oge(a,o)),Ype(a,r.shape)}}}},dxe={kernelName:Rse,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Yfe(e,qfe(Zfe(ghe(n,"float32")),1))}}},hxe={kernelName:Pse,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Yfe(e,hpe(ope(1),Zfe(ghe(n,"float32"))))}}},fxe=xde({avgPool3dGrad_:function(e,t,n,r,i=[1,1,1],a,o){const s=vde(e,"dy","avgPool3dGrad"),l=vde(t,"input","avgPool3dGrad");let u=s,c=l,d=!1;4===l.rank&&(d=!0,u=Ype(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),c=Ype(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),joe(5===u.rank,()=>"Error in avgPool3dGrad: dy must be rank 5 but got rank "+u.rank+"."),joe(5===c.rank,()=>"Error in avgPool3dGrad: input must be rank 5 but got rank "+c.rank+"."),joe(qpe(r,i),()=>`Error in avgPool3dGrad: Either strides or dilations must be 1. Got strides ${r} and dilations '${i}'`),null!=o&&joe(zoe(a),()=>`Error in avgPool3dGrad: pad must be an integer when using, dimRoundingMode ${o} but got pad ${a}.`);const h=cde.runKernel(Use,{dy:u,input:c},{filterSize:n,strides:r,dilations:i,pad:a,dimRoundingMode:o});return d?Ype(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),pxe={kernelName:zse,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:i,strides:a,dilations:o,pad:s,dimRoundingMode:l}=n,u=null==o?[1,1,1]:o;return{x:()=>fxe(e,r,i,a,u,s,l)}}},mxe=xde({avgPoolGrad_:function(e,t,n,r,i){const a=vde(e,"dy","avgPoolGrad"),o=vde(t,"input","avgPoolGrad");joe(o.rank===a.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${a.rank})`);let s=o,l=a,u=!1;3===o.rank&&(u=!0,s=Ype(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=Ype(a,[1,a.shape[0],a.shape[1],a.shape[2]])),joe(4===l.rank,()=>"Error in avgPoolGrad: dy must be rank 4 but got rank "+l.rank+"."),joe(4===s.rank,()=>"Error in avgPoolGrad: input must be rank 4 but got rank "+s.rank+".");const c=cde.runKernel($se,{dy:l,input:s},{filterSize:n,strides:r,pad:i});return u?Ype(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),gxe={kernelName:Bse,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:i,strides:a,pad:o}=n;return{x:()=>mxe(e,r,i,a,o)}}},vxe={kernelName:Hse,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[r,i]=t,{transposeA:a,transposeB:o}=n;return a||o?!a&&o?{a:()=>Rhe(e,i,!1,!1),b:()=>Rhe(e,r,!0,!1)}:a&&!o?{a:()=>Rhe(i,e,!1,!0),b:()=>Rhe(r,e,!1,!1)}:{a:()=>Rhe(i,e,!0,!0),b:()=>Rhe(e,r,!0,!0)}:{a:()=>Rhe(e,i,!1,!0),b:()=>Rhe(r,e,!0,!1)}}},yxe={kernelName:Wse,gradFunc:(e,t,n)=>{const{blockShape:r,crops:i}=n;return{x:()=>Uge(e,r,i)}}},bxe={kernelName:qse,gradFunc:(e,t,n)=>{const r=n.inputShape,i=n.shape,a=Array.from(i);for(let s=r.length-1;s>=0;s--)if(r[s]===i[s])a[s]=1;else if(1!==r[s])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const o=[];for(let s=0;s<a.length;s++)a[s]>1&&o.push(s);return{x:()=>oge(e,o,!0)}}},xxe={kernelName:Gse,gradFunc:e=>({x:()=>e.clone()})},wxe={kernelName:Yse,gradFunc:e=>({x:()=>Jfe(e)})},_xe={kernelName:Xse,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{clipValueMin:i,clipValueMax:a}=n;return{x:()=>Dme(vge(Wme(r,i),Zme(r,a)),e,Jfe(e))}}},kxe={kernelName:Zse,inputsToSave:["x"],gradFunc:txe.gradFunc},Exe={kernelName:Jse,saveAllInputs:!0,gradFunc:(e,t,n)=>{const r=t.map(e=>e.shape),{axis:i}=n,a=Yoe(i,t[0].shape)[0],o=r.map(e=>e[a]);return Tve(e,o,a).map(e=>()=>e)}},Sxe={kernelName:Qse,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,{dilations:a,strides:o,pad:s,dataFormat:l}=n;return joe(Vpe(a),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${a}'`),{x:()=>vme(r.shape,e,i,o,s,l),filter:()=>yye(r,e,i.shape,o,s,l)}}},Txe={kernelName:tle,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,{strides:a,pad:o,dataFormat:s,dimRoundingMode:l}=n;return{dy:()=>mme(e,i,a,o,s,1,l),filter:()=>yye(e,r,i.shape,a,o,s,l)}}},Cxe=xde({conv3DBackpropFilter_:function(e,t,n,r,i){let a=e;4===e.rank&&(a=Ype(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let o=t;return 4===o.rank&&(o=Ype(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),joe(5===a.rank,()=>"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."),joe(5===o.rank,()=>"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."),joe(5===n.length,()=>"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."),joe(a.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${a.shape[4]}) must match input depth in filter (${n[3]}.`),joe(o.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`),cde.runKernel(rle,{x:a,dy:o},{strides:r,pad:i,filterShape:n})}}),Ixe={kernelName:nle,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:i,pad:a}=n;joe(Vpe(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const[o,s]=t;return{x:()=>xme(o.shape,e,s,i,a),filter:()=>Cxe(o,e,s.shape,i,a)}}},Axe={kernelName:ale,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Xfe(nge(gve(ghe(n,"float32"))),e)}}},Oxe={kernelName:ole,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Xfe(vve(ghe(n,"float32")),e)}}},Dxe={kernelName:sle,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:i,exclusive:a,reverse:o}=n;return{x:()=>{const t=fge([i],r.rank);let n=Eme(e,i,a,!o);return null!=t&&(n=Lhe(n,t)),n}}}},Mxe={kernelName:dle,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:i,pad:a,dimRoundingMode:o}=n,s=null==r?[1,1]:r;joe(Vpe(s),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);const[l,u]=t;return joe(4===l.rank,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),joe(4===u.rank,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),joe(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),joe(qpe(i,s),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${s}'.`),null!=o&&joe(zoe(a),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${a}.`),{x:()=>Sye(l.shape,e,u,i,a,r,o),filter:()=>Eye(l,e,u.shape,i,a,r,o)}}},Nxe={kernelName:mle,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,a={x:r,filter:i,dy:e},o={x:r,filter:i,dy:e};return{x:()=>cde.runKernel(gle,a,n),filter:()=>cde.runKernel(vle,o,n)}}},jxe={kernelName:ble,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,r={dy:e,y:n};return{x:()=>cde.runKernel(xle,r)}}},Fxe={kernelName:wle,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=Xfe(Rme(nge(Zfe(n))),2/Math.sqrt(Math.PI));return{x:()=>Xfe(e,r)}}},Rxe={kernelName:kle,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Xfe(e,n)}}},Pxe={kernelName:Ele,inputsToSave:["input"],gradFunc:(e,t)=>{const[n]=t;return{input:()=>Ype(e,n.shape)}}},Lxe={kernelName:Sle,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Xfe(e,Rme(n))}}},Bxe={kernelName:Ale,gradFunc:e=>({x:()=>Jfe(e)})},$xe={kernelName:Ole,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=vpe(n.shape,r.shape);return{a:()=>{const t=Yfe(e,ghe(r,"float32")),a=gpe(n.shape,i);return a.length>0?Ype(oge(t,a),n.shape):t},b:()=>{let t=Xfe(e,ghe(n,"float32"));const a=gpe(r.shape,i);a.length>0&&(t=Ype(oge(t,a),r.shape));const o=Zfe(r);return nge(Yfe(t,ghe(o,"float32")))}}}},zxe={kernelName:Dle,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:r}=n,[i,a,o,s]=t,l=null==s?ope(1):s,u=gpe(a.shape,i.shape),c=[];if(1===a.rank){for(let e=0;e<i.shape.length-1;++e)c.push(i.shape[e]);c.push(1)}const d=hpe(i,a),h=Xfe(e,l),f=dve(qfe(o,ope(r))),p=Xfe(Xfe(Xfe(f,f),f),ope(-.5));return{x:()=>Ype(Xfe(Xfe(e,1===a.rank?Bme(Ype(f,[1,1,1,a.shape[0]]),c):f),l),i.shape),mean:()=>{let e=Xfe(Xfe(f,ope(-1)),h);return 1===a.rank&&(e=oge(e,u)),Ype(e,a.shape)},variance:()=>{let e=Xfe(Xfe(p,d),h);return 1===a.rank&&(e=oge(e,u)),Ype(e,a.shape)},scale:()=>{const t=Xfe(d,f);let n=Xfe(e,t);return 1===a.rank&&(n=oge(n,u)),Ype(n,a.shape)},offset:()=>{let t=e;return 1===a.rank&&(t=oge(t,u)),Ype(t,a.shape)}}}},Uxe={kernelName:Mle,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[r,i]=t,{axis:a}=n,o=Yoe(a,r.shape)[0];return{x:()=>{const t=r.shape,n=i.size,s=t.slice(0,o),l=s.length,u=t.slice(a,t.length).slice(1),c=u.length,d=Hxe(0,l),h=Hxe(l+1,l+1+c),f=Wxe([s,[n],u]),p=Ype(e,f),m=Ype(i,[n]),g=Wxe([[l],d,h]),v=Lhe(p,g);let y=Uve(v,m,r.shape[o]);const b=pge(g);return y=Lhe(y,b),y},indices:()=>i}}};function Hxe(e,t){const n=[];for(let r=e;r<t;++r)n.push(r);return n}function Wxe(e){const t=[];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)t.push(e[n][r]);return t}const Vxe={kernelName:Fle,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>Jfe(n),b:()=>Jfe(r)}}},qxe={kernelName:Rle,gradFunc:e=>({x:()=>ghe(e,"float32")})},Gxe={kernelName:Ble,gradFunc:e=>({x:()=>Jfe(e)})},Yxe={kernelName:$le,gradFunc:e=>({x:()=>Jfe(e)})},Xxe={kernelName:zle,gradFunc:e=>({x:()=>Jfe(e)})},Kxe={kernelName:Ule,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{alpha:i}=n,a=Hme(r,0);return{x:()=>Dme(a,e,Xfe(e,i))}}},Zxe={kernelName:Gle,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Yfe(e,qfe(n,1))}}},Jxe={kernelName:qle,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Yfe(e,ghe(n,"float32"))}}},Qxe={kernelName:Zle,inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{axis:i}=n;return{logits:()=>{const t=Rme(r);return hpe(e,Xfe(oge(e,i,!0),t))}}}},ewe=xde({localResponseNormalizationBackprop_:function(e,t,n,r=5,i=1,a=1,o=.5){return cde.runKernel(Qle,{x:e,y:t,dy:n},{depthRadius:r,bias:i,alpha:a,beta:o})}}),twe={kernelName:Jle,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{depthRadius:a,bias:o,alpha:s,beta:l}=n;return{x:()=>ewe(r,i,e,a,o,s,l)}}};function nwe(e,t,n,r){return t.rank<n.rank&&(t=Ype(t,dge(t.shape,r))),e.rank<n.rank&&(e=Ype(e,dge(e.shape,r))),{x:()=>Xfe(e,ghe(Ome(n,t),e.dtype))}}const rwe={kernelName:eue,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{reductionIndices:i}=r,a=t[0],o=nwe(e,t[1],a,Yoe(i,a.shape));return{x:()=>o.x()}}},iwe={kernelName:tue,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>Xfe(e,ghe(Wme(n,r),"float32")),b:()=>Xfe(e,ghe(Kme(n,r),"float32"))}}},awe=xde({maxPool3dGrad_:function(e,t,n,r,i,a=[1,1,1],o,s){const l=vde(e,"dy","maxPool3dGrad"),u=vde(t,"input","maxPool3dGrad"),c=vde(n,"output","maxPool3dGrad");let d=l,h=u,f=c,p=!1;4===u.rank&&(p=!0,d=Ype(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),h=Ype(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),f=Ype(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),joe(5===d.rank,()=>"Error in maxPool3dGrad: dy must be rank 5 but got rank "+d.rank+"."),joe(5===h.rank,()=>"Error in maxPool3dGrad: input must be rank 5 but got rank "+h.rank+"."),joe(5===f.rank,()=>"Error in maxPool3dGrad: output must be rank 5 but got rank "+f.rank+"."),joe(qpe(i,a),()=>`Error in maxPool3dGrad: Either strides or dilations must be 1. Got strides ${i} and dilations '${a}'`),null!=s&&joe(zoe(o),()=>`Error in maxPool3dGrad: pad must be an integer when using, dimRoundingMode ${s} but got pad ${o}.`);const m=cde.runKernel(aue,{dy:d,input:h,output:f},{filterSize:r,strides:i,dilations:a,pad:o,dimRoundingMode:s});return p?Ype(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}}),owe={kernelName:iue,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{filterSize:a,strides:o,dilations:s,pad:l,dimRoundingMode:u}=n,c=null==s?[1,1,1]:s;return{x:()=>awe(e,r,i,a,o,c,l,u)}}},swe=xde({maxPoolGrad_:function(e,t,n,r,i,a,o){const s=vde(e,"dy","maxPoolGrad"),l=vde(t,"input","maxPoolGrad"),u=vde(n,"output","maxPoolGrad");return joe(l.rank===s.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${s.rank})`),joe(4===s.rank,()=>"Error in maxPoolGrad: dy must be rank 4 but got rank "+s.rank+"."),joe(4===l.rank,()=>"Error in maxPoolGrad: input must be rank 4 but got rank "+l.rank+"."),null!=o&&joe(zoe(a),()=>`Error in maxPoolGrad: pad must be an integer when using, dimRoundingMode ${o} but got pad ${a}.`),cde.runKernel(rue,{dy:s,input:l,output:u},{filterSize:r,strides:i,pad:a,dimRoundingMode:o})}}),lwe={kernelName:_ue,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:i}=n,a=i.map(e=>e[0]);return{x:()=>Qpe(e,a,r.shape)}}},uwe={kernelName:Zue,gradFunc:(e,t,n)=>{const{blockShape:r,paddings:i}=n;return{x:()=>nme(e,r,i)}}},cwe={kernelName:Jue,gradFunc:(e,t,n)=>{const{axis:r}=n;return{x:()=>Zpe(e,r)}}},dwe=[txe,nxe,rxe,ixe,axe,oxe,sxe,lxe,uxe,cxe,dxe,hxe,pxe,gxe,vxe,yxe,bxe,xxe,wxe,_xe,kxe,Exe,Txe,Sxe,Ixe,Axe,Oxe,Dxe,Mxe,Nxe,{kernelName:yle,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=vpe(n.shape,r.shape);return{a:()=>{const t=Yfe(e,ghe(r,"float32")),a=gpe(n.shape,i);return a.length>0?Ype(oge(t,a),n.shape):t},b:()=>{let t=Xfe(e,ghe(n,"float32"));const a=gpe(r.shape,i);a.length>0&&(t=Ype(oge(t,a),r.shape));const o=Zfe(r);return nge(Yfe(t,ghe(o,"float32")))}}}},jxe,Fxe,Rxe,Pxe,Lxe,$xe,Bxe,zxe,Uxe,Vxe,qxe,Gxe,Yxe,Xxe,Kxe,Zxe,Jxe,Qxe,twe,rwe,rwe,iwe,owe,{kernelName:nue,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{filterSize:a,strides:o,pad:s}=n;return{x:()=>swe(e,r,i,a,o,s)}}},{kernelName:sue,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:i}=n,a=Yoe(i,r.shape),o=Loe(cge(r.shape,a)[1]);return{x:()=>{const t=r.shape.slice();a.forEach(e=>{t[e]=1});const n=Ype(e,t);return Yfe(Xfe(n,jge(r.shape,"float32")),o)}}}},{kernelName:lue,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{axis:i}=r,[a,o]=t,s=nwe(e,o,a,Yoe(i,a.shape));return{x:()=>s.x()}}},{kernelName:uue,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>Xfe(e,ghe(Zme(n,r),"float32")),b:()=>Xfe(e,ghe(Hme(n,r),"float32"))}}},{kernelName:cue,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:i}=n,a=i.map(e=>e[0]);return{x:()=>Qpe(e,a,r.shape)}}},{kernelName:due,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=vpe(n.shape,r.shape);return{a:()=>{const t=gpe(n.shape,i);return t.length>0?Ype(oge(e,t),n.shape):e},b:()=>{const t=Xfe(e,nge(zme(Yfe(n,r)))),a=gpe(r.shape,i);return a.length>0?Ype(oge(t,a),r.shape):t}}}},{kernelName:fue,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=vpe(n.shape,r.shape);return{a:()=>{const t=Xfe(e,ghe(r,"float32")),a=gpe(n.shape,i);return a.length>0?Ype(oge(t,a),n.shape):t},b:()=>{const t=Xfe(e,ghe(n,"float32")),a=gpe(r.shape,i);return a.length>0?Ype(oge(t,a),r.shape):t}}}},{kernelName:pue,gradFunc:e=>({x:()=>nge(e)})},{kernelName:xue,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>Nge(n.shape,"float32")}}},{kernelName:bue,gradFunc:e=>({x:()=>Jfe(e)})},{kernelName:wue,saveAllInputs:!0,gradFunc:(e,t,n)=>{const{axis:r}=n;return Hve(e,r).map(e=>()=>e)}},lwe,lwe,{kernelName:Eue,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,r,i]=t,a=n,o=r,s=vpe(a.shape,o.shape);return{a:()=>{const t=ghe(o,"float32");let n=Xfe(e,Xfe(t,dpe(a,hpe(t,ope(1)))));const r=gpe(a.shape,s);return r.length>0&&(n=oge(n,r)),Ype(n,a.shape)},b:()=>{const t=Hme(a,0),n=Dme(t,ege(a),Jfe(a));let r=Xfe(e,Xfe(i,n));const l=gpe(o.shape,s);return l.length>0&&(r=oge(r,l)),Ype(r,o.shape)}}}},{kernelName:Sue,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,r]=t,i=Hme(n,0);return{x:()=>Dme(i,e,Xfe(e,r)),alpha:()=>{let t=Dme(i,Jfe(e),Xfe(e,n));const a=gpe(r.shape,e.shape);return a.length>0&&(t=oge(t,a)),Ype(t,r.shape)}}}},{kernelName:Aue,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Yfe(e,nge(Zfe(n)))}}},{kernelName:Rue,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=Xfe(Zme(n,6),Dve(n));return{x:()=>Xfe(e,ghe(r,"float32"))}}},{kernelName:Oue,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Xfe(e,ghe(Dve(n),"float32"))}}},{kernelName:Due,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Ype(e,n.shape)}}},{kernelName:jue,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,i={dy:e,images:r};return{images:()=>cde.runKernel(Fue,i,n)}}},{kernelName:Mue,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,i={dy:e,images:r};return{images:()=>cde.runKernel(Nue,i,n)}}},{kernelName:Pue,gradFunc:(e,t,n)=>{const{dims:r}=n,i=Yoe(r,e.shape);return{x:()=>ave(e,i)}}},{kernelName:Lue,gradFunc:e=>({x:()=>Jfe(e)})},{kernelName:Bue,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>nge(Yfe(e,Xfe(dpe(n,1.5),2)))}}},{kernelName:zue,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>ghe(Jfe(n),"float32"),t:()=>Xfe(e,ghe(n,e.dtype)),e:()=>Xfe(e,ghe(yge(n),e.dtype))}}},{kernelName:Uue,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=Hme(n,ope(0)),r=ope(Abe),i=ope(Obe),a=Xfe(e,i),o=Xfe(Xfe(e,r),Rme(ghe(n,"float32")));return Dme(t,a,o)}}}},{kernelName:Gue,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Xfe(e,Xfe(n,hpe(ope(1),n)))}}},{kernelName:que,gradFunc:e=>({x:()=>Jfe(e)})},{kernelName:Wue,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Xfe(_me(ghe(n,"float32")),e)}}},{kernelName:Vue,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Xfe(kme(ghe(n,"float32")),e)}}},{kernelName:Hue,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{begin:i,size:a}=n,o=r.shape,[s,l]=lfe(r,i,a),u=[];for(let c=0;c<e.rank;c++)u.push([s[c],o[c]-s[c]-l[c]]);return{x:()=>Pge(e,u)}}},{kernelName:Que,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{dim:i}=n,a=Xfe(e,r);return{logits:()=>hpe(a,Xfe(oge(a,[i],!0),r))}}},{kernelName:Yue,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Xfe(e,Jpe(n))}}},uwe,uwe,cwe,cwe,{kernelName:Xue,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Yfe(e,Xfe(Kfe(ghe(n,"float32")),2))}}},{kernelName:ece,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=ope(2);return{a:()=>Xfe(e,Xfe(i,hpe(n,r))),b:()=>Xfe(e,Xfe(i,hpe(r,n)))}}},{kernelName:tce,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Xfe(e,Xfe(ghe(n,"float32"),2))}}},{kernelName:pce,gradFunc:e=>({x:()=>Jfe(e)})},{kernelName:nce,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=vpe(n.shape,r.shape);return{a:()=>{let t=e;const r=gpe(n.shape,i);return r.length>0&&(t=oge(t,r)),Ype(t,n.shape)},b:()=>{let t=e;const n=gpe(r.shape,i);return n.length>0&&(t=oge(t,n)),Ype(nge(t),r.shape)}}}},{kernelName:Kue,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,i=r.shape.slice(),{axis:a}=n;Yoe(a,r.shape).forEach(e=>{i[e]=1});const o=Ype(e,i),s=Xfe(o,jge(r.shape,"float32"));return{x:()=>s}}},{kernelName:ace,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Yfe(e,Zfe(_me(n)))}}},{kernelName:oce,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Xfe(hpe(ope(1),Zfe(n)),e)}}},{kernelName:sce,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{reps:i}=n;return{x:()=>{let t=Jfe(r);if(1===r.rank)for(let n=0;n<i[0];++n)t=qfe(t,Qpe(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(let n=0;n<i[0];++n)for(let a=0;a<i[1];++a)t=qfe(t,Qpe(e,[n*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(let n=0;n<i[0];++n)for(let a=0;a<i[1];++a)for(let o=0;o<i[2];++o)t=qfe(t,Qpe(e,[n*r.shape[0],a*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(let n=0;n<i[0];++n)for(let a=0;a<i[1];++a)for(let o=0;o<i[2];++o)for(let s=0;s<i[3];++s)t=qfe(t,Qpe(e,[n*r.shape[0],a*r.shape[1],o*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},{kernelName:uce,gradFunc:(e,t,n)=>{const r=n,{perm:i}=r,a=pge(i);return{x:()=>Lhe(e,a)}}},{kernelName:dce,gradFunc:(e,t,n)=>{const r=n,{axis:i}=r;return{value:()=>Ove(e,i)}}},{kernelName:hce,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>function(e,t){const n=ype(t,Jfe(t)),r=Ume(e,n);let i=Wme(t,ope(0,"int32"));const a=r.rank-i.rank;for(let s=0;s<a;++s)i=Pme(i,s+1);i=vge(i,jge(r.shape,"bool"));const o=Jfe(r);return Dme(i,r,o)}(e,n)}}},{kernelName:fce,gradFunc:e=>({x:()=>Jfe(e)})}];for(const Gqe of dwe)Tce(Gqe);let hwe;function fwe(){return null==hwe&&(hwe=Wfe().epsilon()),hwe}Gce.prototype.abs=function(){return this.throwIfDisposed(),ppe(this)},Gce.prototype.acos=function(){return this.throwIfDisposed(),kpe(this)},Gce.prototype.acosh=function(){return this.throwIfDisposed(),Epe(this)},Gce.prototype.addStrict=function(e){return this.throwIfDisposed(),eye(this,e)},Gce.prototype.add=function(e){return this.throwIfDisposed(),qfe(this,e)},Gce.prototype.all=function(e,t){return this.throwIfDisposed(),Tpe(this,e,t)},Gce.prototype.any=function(e,t){return this.throwIfDisposed(),Cpe(this,e,t)},Gce.prototype.argMax=function(e){return this.throwIfDisposed(),Ipe(this,e)},Gce.prototype.argMin=function(e){return this.throwIfDisposed(),Ape(this,e)},Gce.prototype.asScalar=function(){return this.throwIfDisposed(),joe(1===this.size,()=>"The array must have only 1 element."),Ype(this,[])},Gce.prototype.asType=function(e){return this.throwIfDisposed(),ghe(this,e)},Gce.prototype.as1D=function(){return this.throwIfDisposed(),Ype(this,[this.size])},Gce.prototype.as2D=function(e,t){return this.throwIfDisposed(),Ype(this,[e,t])},Gce.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),Ype(this,[e,t,n])},Gce.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),Ype(this,[e,t,n,r])},Gce.prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),Ype(this,[e,t,n,r,i])},Gce.prototype.asin=function(){return this.throwIfDisposed(),Ope(this)},Gce.prototype.asinh=function(){return this.throwIfDisposed(),Dpe(this)},Gce.prototype.atan=function(){return this.throwIfDisposed(),Mpe(this)},Gce.prototype.atan2=function(e){return this.throwIfDisposed(),Npe(this,e)},Gce.prototype.atanh=function(){return this.throwIfDisposed(),jpe(this)},Gce.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),Xpe(this,e,t,n,r)},Gce.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),nme(this,e,t)},Gce.prototype.batchNorm=function(e,t,n,r,i){return this.throwIfDisposed(),rme(this,e,t,n,r,i)},Gce.prototype.broadcastTo=function(e){return this.throwIfDisposed(),lme(this,e)},Gce.prototype.cast=function(e){return this.throwIfDisposed(),ghe(this,e)},Gce.prototype.ceil=function(){return this.throwIfDisposed(),ume(this)},Gce.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),cme(this,e,t)},Gce.prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof Gce&&(e=[e]),Zpe([this,...e],t)},Gce.prototype.conv1d=function(e,t,n,r,i,a){return this.throwIfDisposed(),gme(this,e,t,n,r,i,a)},Gce.prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),yme(this,e,t,n,r,i)},Gce.prototype.conv2d=function(e,t,n,r,i,a){return this.throwIfDisposed(),mme(this,e,t,n,r,i,a)},Gce.prototype.cos=function(){return this.throwIfDisposed(),_me(this)},Gce.prototype.cosh=function(){return this.throwIfDisposed(),kme(this)},Gce.prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),Eme(this,e,t,n)},Gce.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Tme(this,e,t)},Gce.prototype.depthwiseConv2D=function(e,t,n,r,i,a){return Ife("depthwiseConv2D is deprecated, use depthwiseConv2d instead"),this.throwIfDisposed(),Cme(this,e,t,n,r,i,a)},Gce.prototype.depthwiseConv2d=function(e,t,n,r,i,a){return this.throwIfDisposed(),Cme(this,e,t,n,r,i,a)},Gce.prototype.dilation2d=function(e,t,n,r,i){return this.throwIfDisposed(),Ame(this,e,t,n,r,i)},Gce.prototype.divNoNan=function(e){return this.throwIfDisposed(),Mme(this,e)},Gce.prototype.divStrict=function(e){return this.throwIfDisposed(),tye(this,e)},Gce.prototype.div=function(e){return this.throwIfDisposed(),Yfe(this,e)},Gce.prototype.dot=function(e){return this.throwIfDisposed(),Nme(this,e)},Gce.prototype.elu=function(){return this.throwIfDisposed(),jme(this)},Gce.prototype.equalStrict=function(e){return this.throwIfDisposed(),Yve(this,e)},Gce.prototype.equal=function(e){return this.throwIfDisposed(),Ome(this,e)},Gce.prototype.erf=function(){return this.throwIfDisposed(),Fme(this)},Gce.prototype.exp=function(){return this.throwIfDisposed(),Rme(this)},Gce.prototype.expandDims=function(e){return this.throwIfDisposed(),Pme(this,e)},Gce.prototype.expm1=function(){return this.throwIfDisposed(),Lme(this)},Gce.prototype.fft=function(){return this.throwIfDisposed(),kve(this)},Gce.prototype.flatten=function(){return this.throwIfDisposed(),Ype(this,[this.size])},Gce.prototype.floor=function(){return this.throwIfDisposed(),zme(this)},Gce.prototype.floorDiv=function(e){return this.throwIfDisposed(),Gfe(this,e)},Gce.prototype.gather=function(e,t){return this.throwIfDisposed(),Ume(this,e,t)},Gce.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),Xve(this,e)},Gce.prototype.greaterEqual=function(e){return this.throwIfDisposed(),Wme(this,e)},Gce.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Kve(this,e)},Gce.prototype.greater=function(e){return this.throwIfDisposed(),Hme(this,e)},Gce.prototype.ifft=function(){return this.throwIfDisposed(),Eve(this)},Gce.prototype.irfft=function(){return this.throwIfDisposed(),Sve(this)},Gce.prototype.isFinite=function(){return this.throwIfDisposed(),qme(this)},Gce.prototype.isInf=function(){return this.throwIfDisposed(),Gme(this)},Gce.prototype.isNaN=function(){return this.throwIfDisposed(),Yme(this)},Gce.prototype.leakyRelu=function(e){return this.throwIfDisposed(),Xme(this,e)},Gce.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),Zve(this,e)},Gce.prototype.lessEqual=function(e){return this.throwIfDisposed(),Zme(this,e)},Gce.prototype.lessStrict=function(e){return this.throwIfDisposed(),Jve(this,e)},Gce.prototype.less=function(e){return this.throwIfDisposed(),Kme(this,e)},Gce.prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),Qme(this,e,t,n,r)},Gce.prototype.logSigmoid=function(){return this.throwIfDisposed(),ige(this)},Gce.prototype.logSoftmax=function(e){return this.throwIfDisposed(),sge(this,e)},Gce.prototype.logSumExp=function(e,t){return this.throwIfDisposed(),gge(this,e,t)},Gce.prototype.log=function(){return this.throwIfDisposed(),ege(this)},Gce.prototype.log1p=function(){return this.throwIfDisposed(),tge(this)},Gce.prototype.logicalAnd=function(e){return this.throwIfDisposed(),vge(this,e)},Gce.prototype.logicalNot=function(){return this.throwIfDisposed(),yge(this)},Gce.prototype.logicalOr=function(e){return this.throwIfDisposed(),bge(this,e)},Gce.prototype.logicalXor=function(e){return this.throwIfDisposed(),xge(this,e)},Gce.prototype.matMul=function(e,t,n){return this.throwIfDisposed(),Rhe(this,e,t,n)},Gce.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),wge(this,e,t,n,r)},Gce.prototype.max=function(e,t){return this.throwIfDisposed(),age(this,e,t)},Gce.prototype.maximumStrict=function(e){return this.throwIfDisposed(),nye(this,e)},Gce.prototype.maximum=function(e){return this.throwIfDisposed(),ype(this,e)},Gce.prototype.mean=function(e,t){return this.throwIfDisposed(),Ege(this,e,t)},Gce.prototype.min=function(e,t){return this.throwIfDisposed(),Sge(this,e,t)},Gce.prototype.minimumStrict=function(e){return this.throwIfDisposed(),rye(this,e)},Gce.prototype.minimum=function(e){return this.throwIfDisposed(),Tge(this,e)},Gce.prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),Cge(this,e,t)},Gce.prototype.modStrict=function(e){return this.throwIfDisposed(),iye(this,e)},Gce.prototype.mod=function(e){return this.throwIfDisposed(),Ige(this,e)},Gce.prototype.mulStrict=function(e){return this.throwIfDisposed(),aye(this,e)},Gce.prototype.mul=function(e){return this.throwIfDisposed(),Xfe(this,e)},Gce.prototype.neg=function(){return this.throwIfDisposed(),nge(this)},Gce.prototype.norm=function(e,t,n){return this.throwIfDisposed(),uye(this,e,t,n)},Gce.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),Qve(this,e)},Gce.prototype.notEqual=function(e){return this.throwIfDisposed(),Mge(this,e)},Gce.prototype.oneHot=function(e,t=1,n=0){return this.throwIfDisposed(),Phe(this,e,t,n)},Gce.prototype.onesLike=function(){return this.throwIfDisposed(),Fge(this)},Gce.prototype.pad=function(e,t){return this.throwIfDisposed(),Pge(this,e,t)},Gce.prototype.pool=function(e,t,n,r,i){return this.throwIfDisposed(),Hge(this,e,t,n,r,i)},Gce.prototype.powStrict=function(e){return this.throwIfDisposed(),oye(this,e)},Gce.prototype.pow=function(e){return this.throwIfDisposed(),dpe(this,e)},Gce.prototype.prelu=function(e){return this.throwIfDisposed(),Wge(this,e)},Gce.prototype.prod=function(e,t){return this.throwIfDisposed(),Vge(this,e,t)},Gce.prototype.reciprocal=function(){return this.throwIfDisposed(),nve(this)},Gce.prototype.relu=function(){return this.throwIfDisposed(),rve(this)},Gce.prototype.relu6=function(){return this.throwIfDisposed(),ive(this)},Gce.prototype.reshapeAs=function(e){return this.throwIfDisposed(),Ype(this,e.shape)},Gce.prototype.reshape=function(e){return this.throwIfDisposed(),Ype(this,e)},Gce.prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),Yye(this,e,t,n)},Gce.prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),Xye(this,e,t,n)},Gce.prototype.reverse=function(e){return this.throwIfDisposed(),ave(this,e)},Gce.prototype.rfft=function(){return this.throwIfDisposed(),Cve(this)},Gce.prototype.round=function(){return this.throwIfDisposed(),cve(this)},Gce.prototype.rsqrt=function(){return this.throwIfDisposed(),dve(this)},Gce.prototype.selu=function(){return this.throwIfDisposed(),hve(this)},Gce.prototype.separableConv2d=function(e,t,n,r,i,a){return this.throwIfDisposed(),fve(this,e,t,n,r,i,a)},Gce.prototype.sigmoid=function(){return this.throwIfDisposed(),Jpe(this)},Gce.prototype.sign=function(){return this.throwIfDisposed(),mve(this)},Gce.prototype.sin=function(){return this.throwIfDisposed(),gve(this)},Gce.prototype.sinh=function(){return this.throwIfDisposed(),vve(this)},Gce.prototype.slice=function(e,t){return this.throwIfDisposed(),Qpe(this,e,t)},Gce.prototype.softmax=function(e){return this.throwIfDisposed(),_ve(this,e)},Gce.prototype.softplus=function(){return this.throwIfDisposed(),rge(this)},Gce.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Uge(this,e,t)},Gce.prototype.split=function(e,t){return this.throwIfDisposed(),Tve(this,e,t)},Gce.prototype.sqrt=function(){return this.throwIfDisposed(),Kfe(this)},Gce.prototype.square=function(){return this.throwIfDisposed(),Zfe(this)},Gce.prototype.squaredDifference=function(e){return this.throwIfDisposed(),Ive(this,e)},Gce.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),sye(this,e)},Gce.prototype.squeeze=function(e){return this.throwIfDisposed(),Ave(this,e)},Gce.prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof Gce?[this,e]:[this,...e];return Ove(n,t)},Gce.prototype.step=function(e){return this.throwIfDisposed(),Dve(this,e)},Gce.prototype.stridedSlice=function(e,t,n,r,i,a,o,s){return this.throwIfDisposed(),Mve(this,e,t,n,r,i,a,o,s)},Gce.prototype.subStrict=function(e){return this.throwIfDisposed(),lye(this,e)},Gce.prototype.sub=function(e){return this.throwIfDisposed(),hpe(this,e)},Gce.prototype.sum=function(e,t){return this.throwIfDisposed(),oge(this,e,t)},Gce.prototype.tan=function(){return this.throwIfDisposed(),Nve(this)},Gce.prototype.tanh=function(){return this.throwIfDisposed(),eme(this)},Gce.prototype.tile=function(e){return this.throwIfDisposed(),Bme(this,e)},Gce.prototype.toBool=function(){return this.throwIfDisposed(),ghe(this,"bool")},Gce.prototype.toFloat=function(){return this.throwIfDisposed(),ghe(this,"float32")},Gce.prototype.toInt=function(){return this.throwIfDisposed(),ghe(this,"int32")},Gce.prototype.topk=function(e,t){return this.throwIfDisposed(),Bve(this,e,t)},Gce.prototype.transpose=function(e){return this.throwIfDisposed(),Lhe(this,e)},Gce.prototype.unique=function(e){return this.throwIfDisposed(),zve(this,e)},Gce.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Uve(this,e,t)},Gce.prototype.unstack=function(e){return this.throwIfDisposed(),Hve(this,e)},Gce.prototype.where=function(e,t){return this.throwIfDisposed(),Dme(e,this,t)},Gce.prototype.zerosLike=function(){return this.throwIfDisposed(),Jfe(this)};class pwe extends Error{constructor(e){super(e),Object.setPrototypeOf(this,pwe.prototype)}}class mwe extends Error{constructor(e){super(e),Object.setPrototypeOf(this,mwe.prototype)}}class gwe extends Error{constructor(e){super(e),Object.setPrototypeOf(this,gwe.prototype)}}class vwe extends Error{constructor(e){super(e),Object.setPrototypeOf(this,vwe.prototype)}}class ywe extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ywe.prototype)}}function bwe(e,t){if(Array.isArray(e)){let n=[];for(let r=0;r<t;r++)n=n.concat(e);return n}{const n=new Array(t);return n.fill(e),n}}function xwe(e,t){if(!e)throw new ywe(t)}function wwe(e,t){let n=0;for(const r of e)r===t&&n++;return n}function _we(e){return 1===e.length?e[0]:e}function kwe(e){return Array.isArray(e)?e:[e]}function Ewe(e){const t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function Swe(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}Error;let Twe={};function Cwe(e){if(null==e)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function Iwe(e,t={},n={},r="object",i=!1){if("string"==typeof e){const i=e;let a;if(i in n)a=n[i];else if(i in Twe)a=Twe[i];else if(a=t[i],null==a)throw new gwe(`Unknown ${r}: ${e}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return a}{const a=e;if(null==a.className||null==a.config)throw new gwe(r+": Improper config format: "+JSON.stringify(a)+".\n'className' and 'config' must set.");const o=a.className;let s,l;if(o in n?[s,l]=n[o]:o in Twe?[s,l]=Twe.className:o in t&&([s,l]=t[o]),null==s)throw new gwe(`Unknown ${r}: ${o}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(null!=l){const e={};for(const n of Object.keys(Twe))e[n]=Twe[n];for(const i of Object.keys(n))e[i]=n[i];a.config.customObjects=e;const t=Object.assign({},Twe);for(const i of Object.keys(n))Twe[i]=n[i];!function e(t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))t.forEach(t=>e(t));else{const n=Object.keys(t);for(const r of n){const n=t[r];null!=n&&"object"==typeof n&&(Array.isArray(n)||"ndarray"!==n.type||"number"!=typeof n.value?e(n):t[r]=n.value)}}}(a.config);const r=l(s,a.config,n,i);return Twe=Object.assign({},t),r}{const e=Object.assign({},Twe);for(const r of Object.keys(n))Twe[r]=n[r];const t=new s(a.config);return Twe=Object.assign({},e),t}}}function Awe(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function Owe(e){if(null==e)return e;const t=[];for(const n of e)-1===t.indexOf(n)&&t.push(n);return t}function Dwe(e){if(null==e)throw new gwe("Invalid value in obj: "+JSON.stringify(e));for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function Mwe(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new gwe(`${n} is not a valid ${t}.  Valid values are ${e} or null/undefined.`)}function Nwe(e,t,n=0,r=1/0){return xwe(n>=0),xwe(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every(e=>typeof e===t)}function jwe(e,t){Array.isArray(e)?(w.assert(e.length>0,()=>t+" is unexpectedly an empty array."),e.forEach((e,n)=>jwe(e,`element ${n+1} of ${t}`))):w.assert(Number.isInteger(e)&&e>0,()=>`Expected ${t} to be a positive integer, but got `+function e(t){return null===t?"null":Array.isArray(t)?"["+t.map(t=>e(t)).join(",")+"]":"string"==typeof t?`"${t}"`:""+t}(e)+".")}function Fwe(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}function Rwe(e,t){return Nfe(()=>Kfe(oge(Xfe(e,e),t,!0)))}class Pwe extends O.Serializable{getConfig(){return{}}}class Lwe extends Pwe{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return Nfe(()=>{const t=Rwe(e,this.axis),n=cme(t,0,this.maxValue);return Xfe(e,Yfe(n,qfe(fwe(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}Lwe.className="MaxNorm",O.registerClass(Lwe);class Bwe extends Pwe{constructor(e){super(),this.defaultAxis=0,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return Nfe(()=>Yfe(e,qfe(fwe(),Rwe(e,this.axis))))}getConfig(){return{axis:this.axis}}}Bwe.className="UnitNorm",O.registerClass(Bwe);class $we extends Pwe{apply(e){return rve(e)}}$we.className="NonNeg",O.registerClass($we);class zwe extends Pwe{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=e.minValue?e.minValue:this.defaultMinValue,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.rate=null!=e.rate?e.rate:this.defaultRate,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return Nfe(()=>{const t=Rwe(e,this.axis),n=qfe(Xfe(this.rate,cme(t,this.minValue,this.maxValue)),Xfe(1-this.rate,t));return Xfe(e,Yfe(n,qfe(fwe(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}zwe.className="MinMaxNorm",O.registerClass(zwe);const Uwe={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Hwe(e){return Cwe(e)}function Wwe(e,t={}){return Iwe(e,O.SerializationMap.getMap().classNameMap,t,"constraint")}function Vwe(e){return null==e?null:"string"==typeof e?Wwe({className:e in Uwe?Uwe[e]:e,config:{}}):e instanceof Pwe?e:Wwe(e)}function qwe(e){return new Lwe(e)}function Gwe(e){return new Bwe(e)}function Ywe(){return new $we}function Xwe(e){return new zwe(e)}const Kwe=["channelsFirst","channelsLast"],Zwe=["nearest","bilinear"],Jwe=["valid","same","causal"],Qwe=["max","avg"],e_e=["sum","mul","concat","ave"],t_e=new Map;function n_e(e){Mwe(Kwe,"DataFormat",e)}function r_e(e){Mwe(Jwe,"PaddingMode",e)}function i_e(e){Mwe(Qwe,"PoolMode",e)}const a_e=[];function o_e(e,t){a_e.push(e);try{const e=t();return a_e.pop(),e}catch(n){throw a_e.pop(),n}}function s_e(e){if(!c_e(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===a_e.length?"":a_e.join("/")+"/")+e}function l_e(e){if(!c_e(e))throw new Error("Not a valid tensor name: '"+e+"'");t_e.has(e)||t_e.set(e,0);const t=t_e.get(e);if(t_e.set(e,t_e.get(e)+1),t>0){const n=`${e}_${t}`;return t_e.set(n,1),n}return e}const u_e=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function c_e(e){return!!e.match(u_e)}function d_e(e,t,n){null==t&&(t=0),null==n&&(n=e.length);let r=1;for(let i=t;i<n;++i)r*=e[i];return r}function h_e(e){return jve(e=Array.isArray(e)?new Float32Array(e):e)}function f_e(e){return Sge(h_e(e)).dataSync()[0]}function p_e(e){return age(h_e(e)).dataSync()[0]}function m_e(e,t){if(t<e)throw new gwe(`end (${t}) < begin (${e}) is forbidden.`);const n=[];for(let r=e;r<t;++r)n.push(r);return n}function g_e(e,t){return e.asType(t)}function v_e(e,t=-1){const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),e.reshape(n)}function y_e(e,t,n){return Nfe(()=>{switch(e.rank){case 1:return yve(e,t,n);case 2:return bve(e,[t,0],[n,e.shape[1]]);case 3:return xve(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return wve(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return Qpe(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return Qpe(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new gwe("sliceAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}})}function b_e(e,t,n){return Nfe(()=>{switch(e.rank){case 1:return yve(e,t,n);case 2:return bve(e,[0,t],[e.shape[0],n]);case 3:return xve(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return wve(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new gwe("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}})}function x_e(e,t,n,r){return Nfe(()=>{switch(e.rank){case 1:return yve(e,t,n);case 2:switch(r){case 1:return y_e(e,t,n);case 2:return b_e(e,t,n);default:throw new gwe("The axis is not within the rank of the tensor "+r)}case 3:switch(r){case 1:return y_e(e,t,n);case 2:return xve(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return b_e(e,t,n);default:throw new gwe("The axis is not within the rank of the tensor "+r)}case 4:switch(r){case 1:return y_e(e,t,n);case 2:return wve(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return wve(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return b_e(e,t,n);default:throw new gwe("The axis is not within the rank of the tensor "+r)}default:throw new gwe("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}})}function w_e(e,t=-1){let n;return t<0&&(n=e[0].rank,t=0!==n?n:0),t===e[0].rank&&(t=-1),Zpe(e,t)}function __e(e,t){switch(e.rank){case 1:return dme([e,t]);case 2:return hme([e,t],0);case 3:return fme([e,t],0);case 4:return pme([e,t],0);default:throw new gwe("concatAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}}function k_e(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new gwe(`The length of input n (${t.length}) does not match the number of dimensions in input x (${e.rank})`);return Bme(e,t)}function E_e(e,t=0,n=1,r,i){return Jge(e,t,n,r,i)}function S_e(e,t,n,r){if(e.rank<2||t.rank<2)throw new vwe(`dot requires both inputs to be rank >= 2 but got x shape = ${e.shape} and y shape = ${t.shape}`);if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new vwe(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${e.shape} and  y shape = `+t.shape);if(2===e.rank&&2===t.rank)return M.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?I_e(e.rank,r,"channelsLast"):null,activation:n});{const i=e.shape.slice(),a=i.pop();e=e.reshape([-1,a]);const o=t.shape.slice(),s=o.pop(),l=o.pop(),u=[...o,s],c=Array.from({length:t.rank},(e,n)=>0===n?t.rank-2:n<=t.rank-2?n-1:n);t=t.transpose(c).reshape([l,-1]);const d=[...i,...u];return M.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?I_e(e.rank,r,"channelsLast"):null,activation:n}).reshape(d)}}function T_e(e,t,n){return Nfe(()=>(t=Array.isArray(t)?jve(t,"int32"):t.toInt(),Ume(e,t,n)))}function C_e(e){return Xfe(e,e)}function I_e(e,t,n){const r=t.shape;if(1!==t.rank&&t.rank!==e)throw new gwe("Unexpected bias dimensions: "+t.rank+"; expected it to be 1 or "+e);if(5===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1,1,1]:[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,1,1,r[0]]:[1].concat(r))}else if(4===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1,1]:[1,r[2],r[0],r[1]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,1,r[0]]:[1].concat(r))}else if(3===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1]:[1,r[1],r[0]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,r[0]]:[1].concat(r))}else if(e<3)return t;throw new gwe("Unsupported input rank by biasAdd: "+t.rank)}function A_e(e,t,n){return Nfe(()=>(null==n&&(n="channelsLast"),n_e(n),e.add(I_e(e.rank,t,n))))}function O_e(e,t,n,r){return Nfe(()=>pye(e,t,n,r))}function D_e(e,t,n=!1){return n?e():t()}const M_e=["fanIn","fanOut","fanAvg"],N_e=["normal","uniform","truncatedNormal"];class j_e extends O.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class F_e extends j_e{apply(e,t){return Nge(e,t)}}F_e.className="Zeros",O.registerClass(F_e);class R_e extends j_e{apply(e,t){return jge(e,t)}}R_e.className="Ones",O.registerClass(R_e);class P_e extends j_e{constructor(e){if(super(),"object"!=typeof e)throw new gwe("Expected argument of type ConstantConfig but got "+e);if(void 0===e.value)throw new gwe("config must have value set but got "+e);this.value=e.value}apply(e,t){return Nfe(()=>Xfe(ope(this.value),jge(e,t)))}getConfig(){return{value:this.value}}}P_e.className="Constant",O.registerClass(P_e);class L_e extends j_e{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return Qge(e,this.minval,this.maxval,t)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}L_e.className="RandomUniform",O.registerClass(L_e);class B_e extends j_e{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new vwe(`randomNormal does not support dType ${t}.`);return E_e(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}B_e.className="RandomNormal",O.registerClass(B_e);class $_e extends j_e{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new vwe(`truncatedNormal does not support dType ${t}.`);return $ve(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}$_e.className="TruncatedNormal",O.registerClass($_e);class z_e extends j_e{constructor(e){super(),this.gain=null!=e.gain?e.gain:1}apply(e,t){return Nfe(()=>{if(2!==e.length||e[0]!==e[1])throw new gwe("Identity matrix initializer can only be used for 2D square matrices.");return Xfe(this.gain,$me(e[0]))})}getConfig(){return{gain:this.gain}}}z_e.className="Identity",O.registerClass(z_e);class U_e extends j_e{constructor(e){if(super(),e.scale<0)throw new gwe("scale must be a positive float. Got: "+e.scale);this.scale=null==e.scale?1:e.scale,this.mode=null==e.mode?"fanIn":e.mode,Mwe(M_e,"FanMode",this.mode),this.distribution=null==e.distribution?"normal":e.distribution,Mwe(N_e,"Distribution",this.distribution),this.seed=e.seed}apply(e,t){const n=function(e,t="channelsLast"){let n,r;if(n_e(t),2===e.length)n=e[0],r=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===t){const t=d_e(e,2);n=e[1]*t,r=e[0]*t}else if("channelsLast"===t){const t=d_e(e,0,e.length-2);n=e[e.length-2]*t,r=e[e.length-1]*t}}else{const t=d_e(e);n=Math.sqrt(t),r=Math.sqrt(t)}return[n,r]}(e),r=n[0],i=n[1];let a=this.scale;if(a/="fanIn"===this.mode?Math.max(1,r):"fanOut"===this.mode?Math.max(1,i):Math.max(1,(r+i)/2),"normal"===this.distribution){const n=Math.sqrt(a);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new vwe(`${this.getClassName()} does not support dType ${t}.`);return $ve(e,0,n,t,this.seed)}{const n=Math.sqrt(3*a);return Qge(e,-n,n,t)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}U_e.className="VarianceScaling",O.registerClass(U_e);class H_e extends U_e{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return U_e.className}}H_e.className="GlorotUniform",O.registerClass(H_e);class W_e extends U_e{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return U_e.className}}W_e.className="GlorotNormal",O.registerClass(W_e);class V_e extends U_e{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return U_e.className}}V_e.className="HeNormal",O.registerClass(V_e);class q_e extends U_e{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return U_e.className}}q_e.className="HeUniform",O.registerClass(q_e);class G_e extends U_e{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return U_e.className}}G_e.className="LeCunNormal",O.registerClass(G_e);class Y_e extends U_e{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return U_e.className}}Y_e.className="LeCunNormal",O.registerClass(Y_e);class X_e extends j_e{constructor(e){if(super(),this.DEFAULT_GAIN=1,this.gain=null==e.gain?this.DEFAULT_GAIN:e.gain,this.seed=e.seed,null!=this.seed)throw new vwe("Random seed is not implemented for Orthogonal Initializer yet.")}apply(e,t){return Nfe(()=>{if(e.length<2)throw new vwe("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${e[0]*e[1]}) elements: Slowness may result.`);const t=E_e(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32");let n=fbe.gramSchmidt(t);return e[0]>e[1]&&(n=n.transpose()),Xfe(this.gain,n)})}getConfig(){return{gain:this.gain,seed:this.seed}}}X_e.className="Orthogonal",O.registerClass(X_e);const K_e={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Z_e(e,t={}){return Iwe(e,O.SerializationMap.getMap().classNameMap,t,"initializer")}function J_e(e){return Cwe(e)}function Q_e(e){if("string"==typeof e){const t=e in K_e?K_e[e]:e;if("GlorotNormal"===t)return new W_e;if("GlorotUniform"===t)return new H_e;if("HeNormal"===t)return new V_e;if("HeUniform"===t)return new q_e;if("LeCunNormal"===t)return new G_e;if("LeCunUniform"===t)return new Y_e;{const e={};return e.className=t,e.config={},Z_e(e)}}return e instanceof j_e?e:Z_e(e)}function eke(){return new F_e}function tke(){return new R_e}function nke(e){return new P_e(e)}function rke(e){return new L_e(e)}function ike(e){return new B_e(e)}function ake(e){return new $_e(e)}function oke(e){return new z_e(e)}function ske(e){return new U_e(e)}function lke(e){return new H_e(e)}function uke(e){return new W_e(e)}function cke(e){return new V_e(e)}function dke(e){return new q_e(e)}function hke(e){return new G_e(e)}function fke(e){return new Y_e(e)}function pke(e){return new X_e(e)}let mke=0;function gke(){return mke++}const vke={};function yke(e=""){return e in vke||(vke[e]=0),vke[e]+=1,e+vke[e].toString()}function bke(e){return Array.isArray(e)&&Array.isArray(e[0])}function xke(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function wke(e){let t;if(Array.isArray(e)){if(1!==e.length)throw new gwe("Expected Tensor length to be 1; got "+e.length);t=e[0]}else t=e;return t}function _ke(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return(e=e)[0];throw new gwe("Expected exactly 1 Shape; got "+e.length)}return e}function kke(e){let t=0;for(const n of e)t+=0===n.shape.length?1:n.shape.reduce((e,t)=>e*t);return t}class Eke{constructor(e,t="float32",n="Variable",r=!0,i=null){this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=gke(),this.originalName=s_e(n=null==n?"Variable":n),this.name=l_e(this.originalName),this.trainable_=r,this.constraint=i,this.val=Wve(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function Ske(e){return e.map(e=>e.read())}function Tke(e){e.forEach(e=>{e[0].write(e[1])})}class Cke{constructor(e){this.dtype=e.dtype,this.shape=e.shape,this.ndim=null!=e.shape?e.shape.length:e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Ike{constructor(e,t,n,r,i,a,o){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=o,this.id=gke(),null!=a&&(this.originalName=s_e(a),this.name=l_e(this.originalName)),this.rank=t.length}}let Ake=0;class Oke{constructor(e,t){this.callArgs=t,this.id=Ake++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const n of e.inboundLayers)null!=n&&n.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)e.push(null!=t?t.name:null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let Dke=0;class Mke extends O.Serializable{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Dke++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const e=this.getClassName();t=Ewe(e)+"_"+yke(e)}if(this.name=t,this.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){let t;if(null!=e.batchInputShape)t=e.batchInputShape;else if(null!=e.inputShape){let n=null;null!=e.batchSize&&(n=e.batchSize),t=[n].concat(e.inputShape)}this.batchInputShape=t;let n=e.dtype;null==n&&(n=e.inputDType),null==n&&(n="float32"),this.dtype=n}this.initialWeights=null!=e.weights?e.weights:null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(0===this.inboundNodes.length)throw new mwe(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new gwe(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return _we(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return _we(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new pwe("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new pwe("Layer "+this.name+" is not connected, no input to return.");return _we(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new pwe("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new pwe("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return _we(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){if(e=kwe(e),null==this.inputSpec||0===this.inputSpec.length)return;const t=kwe(this.inputSpec);if(e.length!==t.length)throw new gwe(`Layer ${this.name} expects ${t.length} inputs, but it received ${e.length} input tensors. Input received: `+e);for(let n=0;n<e.length;n++){const r=e[n],i=t[n];if(null==i)continue;const a=r.rank;if(null!=i.ndim&&a!==i.ndim)throw new gwe(`Input ${n} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(null!=i.maxNDim&&a>i.maxNDim)throw new gwe(`Input ${n} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(null!=i.minNDim&&a<i.minNDim)throw new gwe(`Input ${n} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(null!=i.dtype&&r.dtype!==i.dtype)throw new gwe(`Input ${n} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${r.dtype}.`);if(i.axes){const e=r.shape;for(const t in i.axes){const r=Number(t),a=i.axes[t],o=r>=0?e[r]:e[e.length+r];if(null!=a&&-1===[a,null].indexOf(o))throw new gwe(`Input ${n} is incompatible with layer ${this.name}: expected axis ${r} of input shape to have value ${a} but got shape ${e}.`)}}if(null!=i.shape)for(let e=0;e<i.shape.length;++e){const t=i.shape[e],a=r.shape[e];if(null!=t&&null!=a&&t!==a)throw new gwe(`Input ${n} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${r.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){null!=this._callHook&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const n=kwe(e);let r=!0;for(const a of n)if(!(a instanceof Ike)){r=!1;break}let i=!0;for(const a of n)if(a instanceof Ike){i=!1;break}if(r===i)throw new gwe("Arguments to apply() must be all SymbolicTensors or all Tensors");return o_e(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const t=[];for(const n of kwe(e))t.push(n.shape);this.build(_we(t)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let r=this.call(e,t);const i=kwe(r),a=[];for(let e of i)-1!==n.indexOf(e)&&(e=e.clone()),a.push(e);if(r=_we(a),null!=this.activityRegularizer)throw new vwe("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}{const n=function(e){e=kwe(e);const t=[];for(const n of e)t.push(n.shape);return _we(t)}(e),r=this.computeOutputShape(n);let i;const a="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(e)?n[0]:n),i=null!=r&&r.length>0&&Array.isArray(r[0])?r.map((n,r)=>new Ike(a,n,this,kwe(e),t,this.name,r)):new Ike(a,r,this,kwe(e),t,this.name),this.addInboundNode(e,i,null,null,n,r,t),this._refCount++,null!=this.activityRegularizer)throw new vwe("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}})}warnOnIncompatibleInputShape(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(e)+") does not match that of the "+`batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer `+this.name);else{let t=!1;this.batchInputShape.forEach((n,r)=>{null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: `+JSON.stringify(this.batchInputShape))}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new pwe(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const n=JSON.stringify(t.outputShapes);-1===e.indexOf(n)&&e.push(n)}if(1===e.length){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&1===e.length?e[0]:e}throw new pwe(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new mwe(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return kke(this.weights)}build(e){this.built=!0}getWeights(e=!1){return Ske(e?this.trainableWeights:this.weights)}setWeights(e){Nfe(()=>{const t=this.weights;if(t.length!==e.length)throw new gwe(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(0===t.length)return;const n=[],r=Ske(t);for(let i=0;i<r.length;++i){const a=r[i],o=t[i],s=e[i];if(!w.arraysEqual(a.shape,s.shape))throw new gwe(`Layer weight shape ${a.shape} not compatible with provided weight shape `+s.shape);n.push([o,s])}Tke(n)})}addWeight(e,t,n,r,i,a,o){if(-1!==this._addedWeightNames.indexOf(e))throw new gwe(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=Q_e("zeros"));const s=r.apply(t,n),l=new Eke(s,n,e,a,o);return s.dispose(),null!=i&&this.addLoss(()=>i.apply(l.read())),null==a&&(a=!0),a?this._trainableWeights.push(l):this._nonTrainableWeights.push(l),l}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){null==e||Array.isArray(e)&&0===e.length||(e=kwe(e),null!=this._losses&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);t.forEach(e=>{if(null!=e)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)})}return null}return t}addInboundNode(e,t,n,r,i,a,o=null){const s=kwe(e);t=kwe(t),n=kwe(n),r=kwe(r),i=xke(i),a=xke(a);const l=[],u=[],c=[];for(const d of s)l.push(d.sourceLayer),u.push(d.nodeIndex),c.push(d.tensorIndex);new Oke({outboundLayer:this,inboundLayers:l,nodeIndices:u,tensorIndices:c,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:a},o);for(let d=0;d<t.length;d++)t[d].sourceLayer=this,t[d].nodeIndex=this.inboundNodes.length-1,t[d].tensorIndex=d}getConfig(){const e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(null===this._refCount)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return 0==--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}class Nke extends Mke{constructor(e){if(super({dtype:e.dtype,name:null!=e.name?e.name:yke("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new gwe("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(null==t){if(null==e.inputShape)throw new gwe("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new gwe("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=e.dtype||"float32";this.batchInputShape=t,this.dtype=n,this.inputSpec=[{shape:t}];const r=new Ike(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Oke({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new gwe("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}function jke(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new gwe("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));let n=e.dtype;return null==n&&(n="float32"),new Nke({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}async function Fke(e){if(null==e)return;const t=[],n=[],r=[];for(const i in e){const a=e[i];if("number"!=typeof a){const e=a;t.push(e.data()),n.push(i),r.push(e)}}if(t.length>0){const i=await Promise.all(t);for(let t=0;t<i.length;++t)e[n[t]]=i[t][0];jfe(r)}}function Rke(e){if(null!=e)for(const t in e){const n=e[t];"number"!=typeof n&&n.dispose()}}var Pke;Nke.className="InputLayer",O.registerClass(Nke),function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(Pke||(Pke={}));class Lke{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class Bke{constructor(e,t=10){null==e&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochBegin(e,t)}async onEpochEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochEnd(e,t)}async onBatchBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchBegin(e,t)}async onBatchEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchEnd(e,t)}async onTrainBegin(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class $ke extends Lke{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){null==t&&(t={});const n=null==t.size?0:t.size;this.seen+=n;for(const r in t){const e=t[r];if("number"==typeof e)this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+e*n;else{let t;r in this.totals?t=this.totals[r]:this.totals[r]=0;const i=Nfe(()=>qfe(this.totals[r],Xfe(e,n)));this.totals[r]=i,null!=t&&t.dispose()}}}async onEpochEnd(e,t){if(null!=t)for(const n of this.params.metrics)null!=this.totals[n]&&("number"==typeof this.totals[n]?t[n]=this.totals[n]/this.seen:Nfe(()=>{const e=Xfe(Yfe(1,this.seen),this.totals[n]);t[n]=e,this.totals[n].dispose(),Ffe(t[n])}))}}class zke extends Lke{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){null==t&&(t={}),this.epoch.push(e);for(const n in t)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(t[n])}async syncData(){const e=[],t=[],n=[];for(const i in this.history){const r=this.history[i];for(let a=0;a<r.length;++a)"number"!=typeof r[a]&&(e.push(r[a].data()),t.push(i),n.push(a))}const r=await Promise.all(e);for(let i=0;i<r.length;++i)this.history[t[i]][n[i]].dispose(),this.history[t[i]][n[i]]=r[i][0]}}class Uke extends Lke{constructor(e,t){if(super(),this.currentEpoch=0,this.yieldEvery=t||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");w.isNumber(this.yieldEvery)&&(this.maybeWait=function(e,t){let n,r=w.now();return(...i)=>{const a=w.now();return a-r<t||(r=a,n=e(...i)),n}}(this.maybeWait.bind(this),this.yieldEvery)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,n){const r=[];null!=this.yield&&(await Fke(n),r.push(this.yield(e,t,n))),r.push(ybe()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,null!=this.epochBegin&&(await Fke(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const n=[];null!=this.epochEnd&&(await Fke(t),n.push(this.epochEnd(e,t))),"epoch"===this.yieldEvery&&n.push(ybe()),await Promise.all(n)}async onBatchBegin(e,t){null!=this.batchBegin&&(await Fke(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const n=[];null!=this.batchEnd&&(await Fke(t),n.push(this.batchEnd(e,t))),"batch"===this.yieldEvery?n.push(ybe()):w.isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(n)}async onTrainBegin(e){null!=this.trainBegin&&(await Fke(e),await this.trainBegin(e))}async onTrainEnd(e){null!=this.trainEnd&&(await Fke(e),await this.trainEnd(e))}}function Hke(e,t){return null==e&&(e={}),e instanceof Lke?[e]:Array.isArray(e)&&e[0]instanceof Lke?e:kwe(e).map(e=>new Uke(e,t))}class Wke{constructor(){}static registerCallbackConstructor(e,t){w.assert(e>=0&&Number.isInteger(e),()=>"Verbosity level is expected to be an integer >= 0, but got "+e),Wke.checkForDuplicate(t),null==Wke.constructors[e]&&(Wke.constructors[e]=[]),Wke.constructors[e].push(t)}static checkForDuplicate(e){for(const t in Wke.constructors)Wke.constructors[+t].forEach(t=>{if(t===e)throw new gwe("Duplicate callback constructor.")})}static clear(){Wke.constructors={}}static createCallbacks(e){const t=[];for(const n in Wke.constructors){const r=+n;e>=r&&t.push(...Wke.constructors[r])}return t.map(e=>new e)}}function Vke(e,t,n,r,i,a,o,s,l){const u=new zke,c=[new $ke,...Wke.createCallbacks(t)];null!=e&&c.push(...e),c.push(u);const d=new Bke(c);return d.setParams({epochs:n,initialEpoch:r,samples:i,steps:a,batchSize:o,verbose:t,doValidation:s,metrics:l}),{callbackList:d,history:u}}function qke(e,t={},n=!1){return Iwe(e,O.SerializationMap.getMap().classNameMap,t,"layer",n)}function Gke(e,t){return Nfe(()=>{"float32"!==e.dtype&&(e=e.asType("float32"));const n=oge(C_e(e),t,!0),r=upe(n.shape,fwe()),i=Kfe(ype(n,r));return Yfe(e,i)})}function Yke(e,t){return Nfe(()=>Ege(C_e(hpe(t,e)),-1))}function Xke(e,t){return Nfe(()=>Ege(ppe(hpe(t,e)),-1))}function Kke(e,t){return Nfe(()=>{const n=hpe(e,t),r=cme(ppe(e),fwe(),Number.MAX_VALUE),i=ppe(Yfe(n,r));return Xfe(100,Ege(i,-1))})}function Zke(e,t,n=!1){return Nfe(()=>{if(n)t=_ve(t);else{const e=oge(t,t.shape.length-1,!0);t=Yfe(t,e)}return t=cme(t,fwe(),1-fwe()),nge(oge(Xfe(e.toFloat(),ege(t)),t.shape.length-1))})}function Jke(e,t,n=!1){return Nfe(()=>{const r=zme(function(e){const t=[d_e(e.shape)];return e.reshape(t)}(e)).toInt(),i=(t=cme(t,fwe(),1-fwe())).shape;return Zke(Phe(r,i[i.length-1]).reshape(i),t,n)})}function Qke(e,t){return Nfe(()=>{let n;return n=cme(t,fwe(),1-fwe()),n=ege(Yfe(n,hpe(1,n))),Ege(function(e,t){if(!w.arraysEqual(e.shape,t.shape))throw new gwe(`logits and labels must have the same shape, but got shapes ${JSON.stringify(e.shape)} and ${JSON.stringify(t.shape)}`);return Nfe(()=>{const n=t.relu(),r=t.abs().neg();return n.sub(t.mul(e)).add(r.exp().log1p())})}(e,n),-1)})}function eEe(e,t){return Nfe(()=>{const n=Gke(e,-1),r=Gke(t,-1),i=Xfe(n,r);return nge(oge(i,-1))})}Wke.constructors={};const tEe={meanSquaredError:Yke,meanAbsoluteError:Xke,meanAbsolutePercentageError:Kke,meanSquaredLogarithmicError:function(e,t){return Nfe(()=>{const n=cme(t,fwe(),Number.MAX_VALUE),r=ege(qfe(1,n)),i=cme(e,fwe(),Number.MAX_VALUE),a=ege(qfe(1,i));return Ege(C_e(hpe(r,a)),-1)})},squaredHinge:function(e,t){return Nfe(()=>{const n=ype(0,hpe(1,Xfe(e,t)));return Ege(C_e(n),-1)})},hinge:function(e,t){return Nfe(()=>{const n=ype(0,hpe(1,Xfe(e,t)));return Ege(n,-1)})},categoricalHinge:function(e,t){return Nfe(()=>{const n=oge(Xfe(e,t),-1),r=age(Xfe(hpe(1,e),t),-1);return ype(0,qfe(1,hpe(r,n)))})},logcosh:function(e,t){return Nfe(()=>{const n=Math.log(2),r=hpe(t,e),i=hpe(qfe(r,rge(Xfe(-2,r))),n);return Ege(i,-1)})},categoricalCrossentropy:Zke,sparseCategoricalCrossentropy:Jke,binaryCrossentropy:Qke,kullbackLeiblerDivergence:function(e,t){return Nfe(()=>{const n=cme(e,fwe(),1),r=cme(t,fwe(),1);return oge(Xfe(e,ege(Yfe(n,r))),-1)})},poisson:function(e,t){return Nfe(()=>{const n=ege(qfe(fwe(),t));return Ege(hpe(t,Xfe(e,n)),-1)})},cosineProximity:eEe};function nEe(e){if("string"==typeof e){if(e in tEe)return tEe[e];let t="Unknown loss "+e;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${e}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new gwe(t)}return e}function rEe(e,t){return Nfe(()=>{const n=Xfe(.5,Fge(t)),r=g_e(Hme(t,n),e.dtype);return Ege(Ome(e,r),-1)})}function iEe(e,t){return Nfe(()=>g_e(Ome(Ipe(e,-1),Ipe(t,-1)),"float32"))}function aEe(e,t){return Nfe(()=>vge(e.equal(1),t.equal(1)).sum().cast("float32"))}function oEe(e,t){return Nfe(()=>{const n=aEe(e,t),r=function(e,t){return Nfe(()=>vge(e.equal(0),t.equal(1)).sum().cast("float32"))}(e,t),i=n.add(r);return Dme(Hme(i,0),n.div(i),0).cast("float32")})}function sEe(e,t){return Qke(e,t)}function lEe(e,t){return e.rank===t.rank&&(e=e.squeeze([e.rank-1])),(t=t.argMax(-1)).dtype!==e.dtype&&(t=t.asType(e.dtype)),Ome(e,t).asType("float32")}const uEe=Zke,cEe=Jke,dEe={binaryAccuracy:rEe,categoricalAccuracy:iEe,precision:oEe,categoricalCrossentropy:uEe,sparseCategoricalCrossentropy:cEe,mse:Yke,MSE:Yke,mae:Xke,MAE:Xke,mape:Kke,MAPE:Kke,cosine:eEe};function hEe(e){if("string"==typeof e&&e in dEe)return dEe[e];if("string"!=typeof e&&null!=e)return e;throw new gwe("Unknown metric "+e)}function fEe(e){if(xwe(null!==e,"Unknown LossOrMetricFn "+e),"string"==typeof e)return e;{let t;for(const n of Object.keys(tEe))if(tEe[n]===e){t=n;break}if(void 0!==t)return t;for(const n of Object.keys(dEe))if(dEe[n]===e){t=n;break}return void 0!==t?t:e.name}}function pEe(e,t,n=!1){if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!function e(t){if(null===t)return!0;if("object"==typeof t){if(Object.getPrototypeOf(t)===Object.prototype){const n=Object.keys(t);for(const r of n){if("string"!=typeof r)return!1;if(!e(t[r]))return!1}return!0}if(Array.isArray(t)){for(const n of t)if(!e(n))return!1;return!0}return!1}{const e=typeof t;return"string"===e||"number"===e||"boolean"===e}}(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(e);n.length>1048576&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function mEe(e,t,n=console.log){let r="";for(let i=0;i<e.length;++i)i>0&&(r=r.slice(0,r.length-1)+" "),r+=e[i],r=r.slice(0,t[i]),r+=" ".repeat(t[i]-r.length);n(r)}function gEe(e,t,n){let r;try{r=JSON.stringify(e.outputShape)}catch(qqe){r="multiple"}mEe([`${e.name} (${e.getClassName()})`,r,e.countParams().toString()],t,n)}function vEe(e,t,n,r){let i;try{i=JSON.stringify(e.outputShape)}catch(qqe){i="multiple"}const a=[];for(const u of e.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(let e=0;e<u.inboundLayers.length;++e)a.push(`${u.inboundLayers[e].name}[${u.nodeIndices[e]}][${u.tensorIndices[e]}]`);const o=e.name,s=e.getClassName(),l=0===a.length?"":a[0];mEe([`${o} (${s})`,i,e.countParams().toString(),l],t,r);for(let u=1;u<a.length;++u)mEe(["","","",a[u]],t,r)}function yEe(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function bEe(e,t){if(null===e)return null;if("string"==typeof e)return Swe(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){const n=[],r=e.length;for(let i=0;i<r;++i){const r=e[i];yEe(t,i,r)?n.push(r):n.push(bEe(r,t))}return n}{const t={};for(const n of Object.keys(e)){const r=e[n];if("name"===n&&"string"==typeof r)t[n]=r;else{const e=Swe(n);t[e]=bEe(r,e)}}return t}}const xEe="2.8.2";class wEe{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof wEe)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(null==e)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,n){if(null!=this.id2Value[e.id])throw new gwe(`Duplicate key: name=${e.name}, id=${e.id}`);return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return ghe(t,e.dtype)}catch(qqe){throw new gwe(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${e.name}' (${e.dtype}).`)}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return null!=this.id2Value[e.id]}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Ike){if(null==this.id2Value[e.id])throw new gwe("Nonexistent key: "+e.name);return this.id2Value[e.id]}{const t=this.name2Id[e];if(null==t)throw new gwe("Feed dict has no SymbolicTensor name: "+e);return this.id2Value[t]}}getMask(e){if(e instanceof Ike){if(null==this.id2Value[e.id])throw new gwe("Nonexistent key: "+e.name);return this.id2Mask[e.id]}{const t=this.name2Id[e];if(null==t)throw new gwe("Feed dict has no SymbolicTensor name: "+e);return this.id2Mask[t]}}disposeMasks(){null!=this.id2Mask&&jfe(this.id2Mask)}}const _Ee={},kEe={};function EEe(e,t,n,r){const i=null!=n&&n.training,a=Array.isArray(e),o=a?e:[e],s=o.map(e=>e.name),l=[],u=t.names();for(const p of s)-1!==u.indexOf(p)?l.push(t.getValue(p)):l.push(null);null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const c=s.join(",")+"|"+t.names().join(",");let d,h;if(null==_Ee[c]){const e=function(e,t){w.assert(null!=e&&e.length>0,()=>"Expected at least one fetch, got none");let n=[],r={};if(1===e.length){const i=TEe(e[0],t);n=i.sorted,r=i.recipientMap}else{const i=new Set;for(const a of e){const{sorted:e,recipientMap:o}=TEe(a,t);for(const t of e)i.has(t.name)||(n.push(t),i.add(t.name));for(const t in o)null==r[t]&&(r[t]=new Set),o[t].forEach(e=>r[t].add(e))}}return{sorted:n,recipientCounts:SEe(r)}}(o,t);d=e.sorted,h=e.recipientCounts,_Ee[c]=d,kEe[c]=h}d=_Ee[c],h={},i||Object.assign(h,kEe[c]);const f=new wEe(t);for(let p=0;p<d.length;++p){if(null!=r){const e=Dfe().numTensors;e>r.maxNumTensors&&(r.maxNumTensors=e),e<r.minNumTensors&&(r.minNumTensors=e)}const e=d[p],a=e.sourceLayer;if(a instanceof Nke)continue;const o=[],u=[],c=[];let m=!1;for(const n of e.inputs){const e=f.getValue(n),r=f.getMask(n);o.push(e),u.push(r),null!=r&&(m=!0),i||(h[n.name]--,0!==h[n.name]||t.hasKey(n)||-1!==s.indexOf(n.name)||e.isDisposed||!0===n.sourceLayer.stateful||c.push(e))}m&&((n=n||{}).mask=u[0]);const g=kwe(a.apply(o,n));let v=null;a.supportsMasking&&(v=a.computeMask(o,u));const y=CEe(e),b=Array.isArray(y)?y:[y];for(let t=0;t<b.length;++t){f.hasKey(b[t])||f.add(b[t],g[t],Array.isArray(v)?v[0]:v);const e=s.indexOf(b[t].name);-1!==e&&(l[e]=g[t])}i||jfe(c)}return f.disposeMasks(),a?l:l[0]}function SEe(e){const t={};for(const n in e)t[n]=e[n].size;return t}function TEe(e,t){const n=new Set,r=[],i={};for(const s of t.names())n.add(s);const a=[],o=[];for(a.push(e);a.length>0;){const e=a[a.length-1];if(n.has(e.name)){a.pop();continue}const t=o[o.length-1]===a.length-1;if(0===e.inputs.length||t)a.pop(),r.push(e),n.add(e.name),t&&o.pop();else{o.push(a.length-1);for(const t of e.inputs)null==i[t.name]&&(i[t.name]=new Set),i[t.name].add(e.name),n.has(t.name)||a.push(t)}}return{sorted:r,recipientMap:i}}function CEe(e){let t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{let n=null;for(let t=0;t<e.sourceLayer.inboundNodes.length;++t)for(const r of e.sourceLayer.inboundNodes[t].outputTensors)if(r.id===e.id){n=t;break}t=e.sourceLayer.getOutputAt(n)}return t}class IEe extends Mke{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,null==this.name){const e=this.getClassName().toLowerCase();this.name=yke(e)}if(this.supportsMasking=!1,this.trainable_=!0,this.inputs=Array.isArray(e.inputs)?e.inputs.slice():[e.inputs],this.outputs=Array.isArray(e.outputs)?e.outputs.slice():[e.outputs],Owe(this.inputs).length!==this.inputs.length)throw new gwe("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+this.inputs.map(e=>e.name));Owe(this.outputs).length!==this.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+this.outputs.map(e=>e.name)),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const v of this.outputs){const e=v.nodeIndex,t=v.tensorIndex;this.outputLayers.push(v.sourceLayer),this.outputLayersNodeIndices.push(e),this.outputLayersTensorIndices.push(t)}for(const v of this.inputs){const e=v.sourceLayer,t=v.nodeIndex,n=v.tensorIndex;xwe(0===t,"input layer has >1 nodes"),xwe(0===n,"input layer has >1 tensors"),this.inputLayers.push(e),this.inputLayersNodeIndices.push(t),this.inputLayersTensorIndices.push(n)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let v=0;v<this.inputLayers.length;v++){const t=this.inputLayers[v];if(!(t instanceof Nke))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${v} (0-based) originates from layer type ${t.getClassName()}.`);this.inputNames.push(t.name),this.feedInputShapes.push(t.batchInputShape),this.feedInputNames.push(t.name)}for(const v of this.outputLayers)this.outputNames.push(v.name);this.internalInputShapes=this.inputs.map(e=>e.shape),this.internalOutputShapes=this.outputs.map(e=>e.shape);const t={},n={},r={},i={},a={},o=[],s=(e,t,n,r,i,l)=>{null!=r&&null!=i&&null!=l||(r=e.sourceLayer,i=e.nodeIndex,l=e.tensorIndex);const u=r.inboundNodes[i];if(-1!==n.indexOf(u))throw new mwe(`The tensor ${e.name} at layer "${r.name}" is part of a cycle.`);if(-1!==t.indexOf(u))return;this.containerNodes.add(IEe.nodeKey(r,i)),r.id in a||(a[r.id]=Object.keys(a).length),-1===n.indexOf(u)&&n.push(u);const c=u.inboundLayers.length;for(let a=0;a<c;a++)s(u.inputTensors[a],t,n,u.inboundLayers[a],u.nodeIndices[a],u.tensorIndices[a]);for(t.push(u);n.indexOf(u)>=0;)n.splice(n.indexOf(u),1);o.push(u)},l=[],u=[];for(const v of this.outputs)s(v,l,u);const c=o.slice().reverse();for(const v of c){n[v.id]=v,v.id in t||(t[v.id]=0);let e=t[v.id];e=Math.max(e,null==r[v.outboundLayer.id]?0:r[v.outboundLayer.id]),r[v.outboundLayer.id]=e,i[v.outboundLayer.id]=v.outboundLayer,t[v.id]=e;for(let r=0;r<v.inboundLayers.length;r++){const i=v.inboundLayers[r].inboundNodes[v.nodeIndices[r]];t[i.id]=Math.max(e+1,null==t[i.id]?0:t[i.id]),n[i.id]=i}}const d={};for(const v in t){const e=t[v];e in d||(d[e]=[]),d[e].push(n[v])}const h={};for(const v in r){const e=r[v];e in h||(h[e]=[]),h[e].push(i[v])}let f=Object.keys(h).map(e=>parseInt(e,10)).sort(Awe);this.layers=[];for(const v of f){const e=h[v];e.sort((e,t)=>{const n=a[e.id],r=a[t.id];return n<r?-1:n>r?1:0});for(const t of e)t instanceof IEe&&this.internalContainerRefs.push(t),this.layers.push(t)}this.layersByDepth=h,f=Object.keys(d).map(e=>parseInt(e,10)).sort(Awe);const p=this.inputs.slice(),m=[];for(const v of f)for(const e of d[v]){const t=e.outboundLayer;if(null!=t){for(const n of e.inputTensors)if(-1===p.indexOf(n))throw new mwe("Graph disconnected: cannot obtain value for tensor "+n+` at layer "${t.name}". The following previous layers were accessed without issue: `+m);for(const t of e.outputTensors)p.push(t);m.push(t.name)}}this.nodesByDepth=d;const g=this.layers.map(e=>e.name);for(const v of g){const e=g.filter(e=>e===v).length;if(1!==e)throw new mwe(`The name "${v}" is used ${e} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(g))}this.outboundNodes=[],this.inboundNodes=[],new Oke({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(e=>null),outputMasks:this.outputs.map(e=>null),inputShapes:this.inputs.map(e=>e.shape),outputShapes:this.outputs.map(e=>e.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(t=>t.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new gwe("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.layers)t.push(...e.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const n={};let r=0;for(const a of this.layers)for(const e of a.weights){if(null!=n[e.originalName])throw new gwe("Duplicate weight name: "+e.originalName);n[e.originalName]=e,r++}const i=[];for(const a in e){let r=a;if(null==n[a]){const e=a.split("/");r=e.slice(0,-2).concat([e[e.length-1]]).join("/")}if(null!=n[r])i.push([n[r],e[a]]);else if(t)throw new gwe("Provided weight data has no target variable: "+a);delete n[r]}if(t){const e=[];for(const t in n)e.push(t);if(e.length>0)throw new gwe(`${e.length} of ${r} weights are not set: `+e)}Tke(i)}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers "+xEe,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const n=function e(t,n){if(null==t)return null;if("string"==typeof t)return Ewe(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){const r=[],i=t.length;for(let a=0;a<i;++a){const i=t[a];yEe(n,a,i)?r.push(i):r.push(e(i,n))}return r}{const n={};for(const r of Object.keys(t)){const i=t[r];n[Ewe(r)]="name"!==r&&"className"!==r||"string"!=typeof i?e(i,r):i}return n}}(this.updatedConfig());return t?JSON.stringify(n):n}call(e,t){return Nfe(()=>{e=kwe(e);const n=new wEe;for(let t=0;t<this.inputs.length;++t)n.add(this.inputs[t],e[t]);return EEe(this.outputs,n,t)})}computeMask(e,t){return Nfe(()=>{let n;return e=kwe(e),n=null==t?bwe(null,e.length):kwe(t),this.runInternalGraph(e,n)[1]})}computeOutputShape(e){const t=xke(e);if(t.length!==this.inputLayers.length)throw new gwe(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const n={};for(let o=0;o<t.length;o++)n[this.inputLayers[o].name+"_0_0"]=t[o];const r=Object.keys(this.nodesByDepth).map(e=>parseInt(e,10)).sort(Awe);if(r.length>1)for(const o of r){const e=this.nodesByDepth[o];for(const t of e){const e=t.outboundLayer;if(-1!==this.inputLayers.map(e=>e.id).indexOf(e.id))continue;const r=[];for(let o=0;o<t.inboundLayers.length;o++)r.push(n[`${t.inboundLayers[o].name}_${t.nodeIndices[o]}_${t.tensorIndices[o]}`]);const i=xke(e.computeOutputShape(_we(r))),a=e.inboundNodes.indexOf(t);for(let t=0;t<i.length;t++)n[`${e.name}_${a}_${t}`]=i[t]}}const i=[],a=[];for(let o=0;o<this.outputLayers.length;o++)a.push(`${this.outputLayers[o].name}_${this.outputLayersNodeIndices[o]}_${this.outputLayersTensorIndices[o]}`);for(let o=0;o<a.length;o++){const e=a[o];xwe(e in n),i.push(n[e])}return _we(i)}runInternalGraph(e,t){null==t&&(t=bwe(null,e.length));const n={};for(let s=0;s<this.inputs.length;++s)n[this.inputs[s].id]=[e[s],t[s]];const r=Object.keys(this.nodesByDepth).map(e=>parseInt(e,10)).sort(Awe);for(const s of r){const e=this.nodesByDepth[s];for(const t of e){const e=t.outboundLayer,r=t.inputTensors,i=t.outputTensors,a=new Array;for(const t of r)t.id in n&&a.push(n[t.id]);if(a.length===r.length){let r,o,s,l,u={};if(null!=t.callArgs&&(u=t.callArgs),1===a.length){const[t,n]=a[0];null==u.mask&&(u.mask=n),s=kwe(e.call(t,u)),l=kwe(e.computeMask(t,n)),r=[t],o=[n]}else r=a.map(e=>e[0]),o=a.map(e=>e[1]),null==u.mask&&(u.mask=o),s=kwe(e.call(r,u)),l=kwe(e.computeMask(r,o));if(e.activityRegularizer)throw new vwe("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let e=0;e<i.length;++e)n[i[e].id]=[s[e],l[e]]}}}const i=[],a=[],o=[];for(const s of this.outputs){xwe(s.id in n,`Could not compute output ${s.name} : ${s.id}`);const[e,t]=n[s.id];o.push(e.shape),i.push(e),a.push(t)}return[i,a,o]}buildNodeConversionMap(e){const t={};let n;for(const r of this.layers){n=r instanceof IEe?1:0;for(let e=0;e<r.inboundNodes.length;e++){const i=IEe.nodeKey(r,e);this.containerNodes.has(i)&&(t[i]=n,n+=1)}}return t}getLayer(e,t){if(null!=t){if(this.layers.length<=t)throw new gwe(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}if(null==e)throw new gwe("Provide either a layer name or layer index");for(const n of this.layers)if(n.name===e)return n;throw new gwe("No such layer: "+e)}calculateLosses(){return Nfe(()=>{const e=[];for(const t of this.layers)for(let n=0;n<t.inboundNodes.length;++n){const r=IEe.nodeKey(t,n);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[];for(const a of this.layers){const e=a.getClassName(),r=a.getConfig(),i=[];for(let n=0;n<a.inboundNodes.length;n++){const e=a.inboundNodes[n],r=IEe.nodeKey(a,n);let o={};if(this.containerNodes.has(r)){if(e.callArgs)try{JSON.stringify(e.callArgs),o=e.callArgs}catch(qqe){console.warn(`Layer ${a.name} was passed non-serializable keyword arguments: `+e.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),o={}}if(e.inboundLayers.length>0){const n=[];for(let r=0;r<e.inboundLayers.length;r++){const i=e.inboundLayers[r],a=e.tensorIndices[r];let s=t[IEe.nodeKey(i,e.nodeIndices[r])];null==s&&(s=0),n.push([i.name,s,a,o])}i.push(n)}}}const o={};o.name=a.name,o.className=e,o.config=r,o.inboundNodes=i,n.push(o)}e.layers=n;const r=[];for(let a=0;a<this.inputLayers.length;a++){const e=this.inputLayers[a],n=IEe.nodeKey(e,this.inputLayersNodeIndices[a]);if(!this.containerNodes.has(n))continue;let i=t[n];null==i&&(i=0),r.push([e.name,i,this.inputLayersTensorIndices[a]])}e.inputLayers=r;const i=[];for(let a=0;a<this.outputLayers.length;a++){const e=this.outputLayers[a],n=IEe.nodeKey(e,this.outputLayersNodeIndices[a]);if(!this.containerNodes.has(n))continue;let r=t[n];null==r&&(r=0),i.push([e.name,r,this.outputLayersTensorIndices[a]])}return e.outputLayers=i,e}static fromConfig(e,t,n={},r=!1){const i={},a={};function o(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function s(e,t){const n=[];let r;for(const a of t){const s=a[0],l=a[1],u=a[2];if(r=null==a[3]?{}:a[3],!(s in i))return void o(e,t);const c=i[s];if(c.inboundNodes.length<=l)return void o(e,t);n.push(c.inboundNodes[l].outputTensors[u])}n.length>0&&e.apply(_we(n),r)}function l(e){const n=e.name,a=qke(e,null!=t.customObjects?t.customObjects:{});a.setFastWeightInitDuringBuild(r),i[n]=a,e.inboundNodes.forEach(e=>{if(!(e instanceof Array))throw new gwe("Corrupted configuration, expected array for nodeData: "+e);o(a,e)})}const u=t.name,c=t.layers;for(const m of c)l(m);for(;!Dwe(a);)for(const e of c){const t=i[e.name];if(t.name in a){const e=a[t.name];delete a[t.name];for(const n of e)s(t,n)}}const d=[],h=[],f=t.inputLayers;for(const m of f){const e=m[0],t=m[1],n=m[2];xwe(e in i),d.push(i[e].inboundNodes[t].outputTensors[n])}const p=t.outputLayers;for(const m of p){const e=m[0],t=m[1],n=m[2];xwe(e in i),h.push(i[e].inboundNodes[t].outputTensors[n])}return new e({inputs:d,outputs:h,name:u})}get stateful(){if(this._stateful)throw new gwe("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){Nfe(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}function AEe(e,t){return function(e,t,n){const r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map(e=>null);if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error(`Provided classWeight is an array of ${e.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){const n=[];return t.forEach(t=>{n.push(t in e?e[t]:null)}),n}throw new Error(`The model has multiple (${r}) outputs, so classWeight must be either an array with ${r} elements or an object with ${t} keys. Provided classWeight not understood: ${JSON.stringify(e)}`)}(e,t)}async function OEe(e,t,n,r){if(null!=t||null!=r)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const t=Nfe(()=>{if(1===e.shape.length)return e.clone();if(2===e.shape.length){if(e.shape[1]>1)return e.argMax(1);if(1===e.shape[1])return e.reshape([e.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${e.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}throw new Error(`Unexpected rank of target (y) tensor (${e.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),r=Array.from(await t.data());jfe(t);const i=[];return r.forEach(e=>{if(null==n[e])throw new Error(`classWeight must contain all classes in the training data. The class ${e} exists in the data but not in classWeight`);i.push(n[e])}),jve(i,"float32")}return null}function DEe(e,t){return Xfe(e,t)}function MEe(e,t){let n,r;n=t.xs,r=t.ys,w.assert(null!=n&&null!=r,()=>"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+t);const i=NEe("input",e.inputNames,n),a=NEe("output",e.outputNames,r),o=i[0].shape[0];w.assert(i.length===e.inputs.length,()=>`LayersModel has ${e.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: `+JSON.stringify(e.inputNames)+")"),w.assert(a.length===e.outputs.length,()=>`LayersModel has ${e.outputs.length} outputs, but the dataset provides ${a.length} outputs.  (Expected output keys: `+JSON.stringify(e.outputNames)+")");for(let s=0;s<i.length;s++)w.assert(i[s].shape[0]===o,()=>`Batch size mismatch: input ${e.inputNames[s]} has ${i[s].shape[0]}; expected  ${o} based on input ${e.inputNames[0]}.`);for(let s=0;s<a.length;s++)w.assert(a[s].shape[0]===o,()=>`Batch size mismatch: output ${e.outputNames[s]} has ${a[s].shape[0]}; expected  ${o} based on input ${e.inputNames[0]}.`);return{xs:i,ys:a}}function NEe(e,t,n){if(n instanceof Gce)return[n];if(Array.isArray(n))return w.assert(n.length===t.length,()=>`Received an array of ${n.length} Tensors, but expected ${t.length} to match the ${e} keys ${t}.`),n;{const r=[];for(const i of t){if(null==n[i])throw new gwe(`The feature data generated by the dataset lacks the required ${e} key '${i}'.`);r.push(n[i])}return r}}function jEe(e){return"function"==typeof e.iterator}function FEe(e){w.assert(e>0&&Number.isInteger(e),()=>"batchSize is required to be a positive integer, but got "+e)}function REe(e,t,n){return null==e?[null]:Array.isArray(e)?e.map(e=>y_e(e,t,n-t)):y_e(e,t,n-t)}function PEe(e,t){return Nfe(()=>null==e?null:Array.isArray(e)?e.map(e=>PEe(e,t)):T_e(e,"int32"===t.dtype?t:t.toInt()))}function LEe(e,t){const n=[];let r=0,i=null;for(;r<e;)i=r+t,i>=e&&(i=e),n.push([r,i]),r=i;return n}function BEe(e){const t=[];e instanceof Gce&&(e=[e]);for(let n=0;n<e.length;++n){const r=e[n];if(1===r.rank)t.push(v_e(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function $Ee(e,t){if(null==e)return;const n=[];if(t instanceof Gce)n.push(t.id);else if(Array.isArray(t))t.forEach(e=>n.push(e.id));else if(null!=t)for(const i in t)n.push(t[i].id);const r=[];if(e instanceof Gce)-1===n.indexOf(e.id)&&r.push(e);else if(Array.isArray(e))e.forEach(e=>{-1===n.indexOf(e.id)&&r.push(e)});else if(null!=e)for(const i in e){const t=e[i];-1===n.indexOf(t.id)&&r.push(t)}r.forEach(e=>{e.isDisposed||e.dispose()})}function zEe(e){return Array.isArray(e)}function UEe(e){return!function(e){return e instanceof Gce}(e)&&!zEe(e)}function HEe(e,t,n,r=!0,i=""){if(null==t||0===t.length){if(null!=e){let t=!1;if(zEe(e)&&e.length>0)t=!0;else if(UEe(e)){for(const n in e)if(e.hasOwnProperty(n)){t=!0;break}}else t=!0;if(t)throw new gwe(`Error when checking model ${i} expected no data, but got `+e)}return[]}if(null==e)return t.map(e=>null);let a;if(UEe(e)){e=e,a=[];for(const n of t){if(null==e[n])throw new gwe(`No data provided for "${n}". Need data for each key in: `+t);a.push(e[n])}}else if(zEe(e)){if((e=e).length!==t.length)throw new gwe(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): `+e);a=e}else{if(e=e,t.length>1)throw new gwe(`The model ${i} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape `+e.shape);a=[e]}if(a=BEe(a),null!=n)for(let o=0;o<t.length;++o){if(null==n[o])continue;const e=a[o];if(e.shape.length!==n[o].length)throw new gwe(`Error when checking ${i}: expected ${t[o]} to have ${n[o].length} dimension(s). but got array with shape `+e.shape);for(let a=0;a<n[o].length;++a){if(0===a&&!r)continue;const s=e.shape[a],l=n[o][a];if(null!=l&&l>=0&&s!==l)throw new gwe(`Error when checking ${i}: expected ${t[o]} to have shape [${n[o]}], but got array with shape [${e.shape}].`)}}return a}function WEe(e,t,n,r=!0,i=""){let a;if(Array.isArray(e)){if(e.length!==t.length)throw new gwe(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${e.length} Tensors(s).`);a=e}else{if(t.length>1)throw new gwe(`The model expects ${t.length} ${i} Tensors, but only received one Tensor. Found: array with shape `+JSON.stringify(e.shape)+".");a=[e]}if(null!=n)for(let o=0;o<t.length;++o){if(null==n[o])continue;const e=a[o];if(e.shape.length!==n[o].length)throw new gwe(`Error when checking ${i}: expected ${t[o]} to have ${n[o].length} dimension(s), but got array with shape `+JSON.stringify(e.shape));for(let a=0;a<n[o].length;++a){if(0===a&&!r)continue;const s=e.shape[a],l=n[o][a];if(null!=l&&l!==s)throw new gwe(`Error when checking ${i}: expected ${t[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(e.shape)}.`)}}}class VEe extends IEe{constructor(e){super(e),this.isTraining=!1}summary(e,t,n=console.log){if(!this.built)throw new gwe("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");!function(e,t,n,r=console.log){const i=function(e){let t=!0;const n=[],r=[];for(const i in e.nodesByDepth)n.push(e.nodesByDepth[i]);for(const i of n){if(i.length>1||1===i.length&&i[0].inboundLayers.length>1){t=!1;break}r.push(...i)}if(t)for(const i of e.layers){let e=!1;for(const n of i.inboundNodes)if(-1!==r.indexOf(n)){if(e){t=!1;break}e=!0}if(!t)break}return t}(e),a=["Layer (type)","Output shape","Param #"];let o;if(i?(t=t||65,n=n||[.45,.85,1]):(t=t||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map(e=>Math.floor(t*e))),!i){a.push("Receives inputs"),o=[];for(const t in e.nodesByDepth)o.push(...e.nodesByDepth[t])}r("_".repeat(t)),mEe(a,n,r),r("=".repeat(t));const s=e.layers;for(let c=0;c<s.length;++c)i?gEe(s[c],n,r):vEe(s[c],n,o,r),r((c===s.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const l=function(e){let t;return t=kke(null!=e.collectedTrainableWeights?e.collectedTrainableWeights:e.trainableWeights),t}(e),u=kke(e.nonTrainableWeights);r("Total params: "+(l+u)),r("Trainable params: "+l),r("Non-trainable params: "+u),r("_".repeat(t))}(this,e,t,n)}compile(e){if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){const t={Adagrad:()=>gbe.adagrad(.01),Adadelta:()=>gbe.adadelta(1,.95,fwe()),Adam:()=>gbe.adam(.001,.9,.999,fwe()),Adamax:()=>gbe.adamax(.002,.9,.999,fwe(),0),RMSProp:()=>gbe.rmsprop(.001,.9,0,fwe()),SGD:()=>gbe.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new gwe("Unknown Optimizer "+e)}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof spe))throw new gwe("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new gwe(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(e=>nEe(e))}else{const n=nEe(e.loss);this.outputs.forEach(e=>{t.push(n)})}else{e.loss=e.loss;for(const t in e.loss)if(-1===this.outputNames.indexOf(t))throw new gwe(`Unknown entry in loss dictionary: "${t}". Only expected the following keys: `+this.outputNames);for(const n of this.outputNames)null==e.loss[n]&&console.warn(`Output "${n}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${n} during training`),t.push(nEe(e.loss[n]))}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let a=0;a<this.outputs.length;++a){const e=this.internalOutputShapes[a];this.feedOutputNames.push(this.outputNames[a]),this.feedOutputShapes.push(e),this.feedLossFns.push(this.lossFunctions[a])}const n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],o_e("loss",()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;const t=this.lossFunctions[e];this.outputs.length>1&&(this.metricsTensors.push([t,e]),this.metricsNames.push(this.outputNames[e]+"_loss"))}});const r=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map(e=>[]);let n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+e);n=e}if(Array.isArray(n))return t.map(e=>n);{const e=[];for(const r of t){let t=n.hasOwnProperty(r)?n[r]:[];Array.isArray(t)||(t=[t]),e.push(t)}return e}}(e.metrics,this.outputNames),i=(e,t,n)=>{this.outputNames.length>1&&(t=this.outputNames[e]+"_"+t),this.metricsNames.push(t),this.metricsTensors.push([n,e])};o_e("metric",()=>{for(let e=0;e<this.outputs.length;++e)-1===n.indexOf(e)&&(t=>{let n,r,a;for(const o of t){if("string"==typeof o&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(o)){const t=this.internalOutputShapes[e];let i;1===t[t.length-1]||this.lossFunctions[e]===Qke?-1!==["accuracy","acc"].indexOf(o)?r=rEe:-1!==["crossentropy","ce"].indexOf(o)&&(r=sEe):this.lossFunctions[e]===Jke?-1!==["accuracy","acc"].indexOf(o)?r=lEe:-1!==["crossentropy","ce"].indexOf(o)&&(r=cEe):-1!==["accuracy","acc"].indexOf(o)?r=iEe:-1!==["crossentropy","ce"].indexOf(o)&&(r=uEe),-1!==["accuracy","acc"].indexOf(o)?i="acc":-1!==["crossentropy","ce"].indexOf(o)&&(i="ce"),a=r,n=""+i}else{const e=hEe(o);a=e,n=""+fEe(o)}let t;o_e(n,()=>{t=a}),i(e,n,t)}})(r[e])}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,n={}){const r=null==n.batchSize?32:n.batchSize;FEe(r);const i=this.standardizeUserDataXY(e,t,!0,r);try{const a=i[0].concat(i[1]);return this.makeTestFunction(),_we(this.testLoop(this.testFunction,a,r,n.verbose,n.steps))}finally{$Ee(i[0],e),$Ee(i[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),async function(e,t,n){const r=null!=(n=n||{}).batches,i=e.testFunction;let a=[];if(n.verbose>0)throw new vwe("Verbose mode is not implemented yet.");w.assert(!r||n.batches>0&&Number.isInteger(n.batches),()=>"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(n.batches));const o="function"==typeof t.next?t:await t.iterator();let s=0,l=0;for(;!r||l<n.batches;){const t=await o.next();if(a=Nfe(()=>{if(t.value){const{xs:n,ys:r}=MEe(e,t.value),o=n.concat(r),u=Nfe(()=>i(o));if(jfe(o),0===l)for(let e=0;e<u.length;++e)a.push(ope(0));const c=o[0].shape[0];for(let e=0;e<u.length;++e){const t=u[e],n=a[e];a[e]=Nfe(()=>qfe(a[e],Xfe(c,t))),l>0&&jfe(n)}jfe(u),s+=c,++l}return a}),t.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<a.length;++u){const e=a[u];a[u]=Yfe(a[u],s),jfe(e)}return _we(a)}(this,e,t)}checkNumSamples(e,t,n,r="steps"){let i;if(null!=n){if(i=null,null!=t)throw new gwe(`If ${r} is set, batchSize must be null or undefined.Got batchSize = `+t)}else{if(null==e)throw new gwe("Either the input data should have a defined shape, or "+r+" shoud be specified.");i=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return i}execute(e,t){if(Array.isArray(t)&&0===t.length)throw new gwe("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(t),r=this.retrieveSymbolicTensors(n?t:[t]),i=new wEe;if(e instanceof Gce&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new gwe(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let t=0;t<this.inputs.length;++t)i.add(this.inputs[t],e[t])}else for(const o of this.inputs){const t=e[o.name];if(null==t)throw new gwe("No value is provided for the model's input "+o.name);i.add(o,t)}const a=EEe(r,i);return n?a:a[0]}retrieveSymbolicTensors(e){const t=bwe(null,e.length);let n=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],a=i.map(e=>e.name);for(let r=0;r<e.length;++r){const o=a.indexOf(e[r]);if(-1!==o&&(t[r]=i[o],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw t.forEach((t,r)=>{null==t&&n.push(e[r])}),new gwe("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(n))}return t}predictLoop(e,t=32,n=!1){return Nfe(()=>{const r=this.checkNumSamples(e);if(n)throw new vwe("Verbose predictLoop() is not implemented yet.");const i=LEe(r,t),a=this.outputs.map(e=>[]);for(let t=0;t<i.length;++t)Nfe(()=>{const n=REe(e,i[t][0],i[t][1]),r=[];if(Array.isArray(n))for(let e=0;e<n.length;++e)r.push({key:this.inputs[e],value:n[e]});else r.push({key:this.inputs[0],value:n});const a=new wEe(r);return EEe(this.outputs,a)}).forEach((e,t)=>a[t].push(e));return _we(a.map(e=>Zpe(e,0)))})}predict(e,t={}){const n=BEe(e);WEe(n,this.inputNames,this.feedInputShapes,!1);try{const r=null==t.batchSize?32:t.batchSize;return FEe(r),this.predictLoop(n,r)}finally{$Ee(n,e)}}predictOnBatch(e){WEe(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,n=!0,r){if(null==this.optimizer_)throw new mwe("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let a=0;a<this.feedOutputShapes.length;++a){const e=this.feedOutputShapes[a];i.push(this.feedLossFns[a]===Jke?e.slice(0,e.length-1).concat([1]):e)}if(function(e,t,n){const r=Owe(e.map(e=>e.shape[0]));r.sort();const i=Owe(t.map(e=>e.shape[0]));if(i.sort(),r.length>1)throw new gwe("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map(e=>e.shape)));if(i.length>1)throw new gwe("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map(e=>e.shape)));if(r.length>0&&i.length>0&&!w.arraysEqual(r,i))throw new gwe(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${i[0]} target sample(s).`)}(e=HEe(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=HEe(t,this.feedOutputNames,i,!1,"target")),function(e,t,n){const r=[Yke,Qke,Zke];for(let i=0;i<e.length;++i){const a=e[i],o=t[i],s=n[i];if(null!=o){if(o===Zke&&1===a.shape[a.shape.length-1])throw new gwe(`You are passing a target array of shape ${a.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(-1!==r.indexOf(o)){const e=a.shape.slice(1),t=s.slice(1);for(let n=0;n<e.length;++n){const r=e[n],i=t[n];if(null!=i&&r!==i)throw new gwe(`A target Tensor with shape ${a.shape} was passed for an output of shape ${s}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=r&&r>0&&e[0].shape[0]%r!=0)throw new gwe(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,n,r,i=!0,a){const[o,s]=this.standardizeUserDataXY(e,t,i,a);if(null!=n)throw new Error("sample weight is not supported yet.");let l=null;if(null!=r){const e=AEe(r,this.outputNames);l=[];for(let t=0;t<e.length;++t)l.push(await OEe(s[t],null,e[t]))}return[o,s,l]}testLoop(e,t,n,r=0,i){return Nfe(()=>{const a=this.checkNumSamples(t,n,i,"steps"),o=[];if(r>0)throw new vwe("Verbose mode is not implemented yet.");if(null!=i)throw new vwe("steps mode in testLoop() is not implemented yet");{const r=LEe(a,n),i=jve(m_e(0,a));for(let n=0;n<r.length;++n){const a=r[n][0],s=r[n][1],l=y_e(i,a,s-a),u=PEe(t,l),c=e(u);if(0===n)for(let e=0;e<c.length;++e)o.push(ope(0));for(let e=0;e<c.length;++e)o[e]=qfe(o[e],Xfe(s-a,c[e]))}for(let e=0;e<o.length;++e)o[e]=Yfe(o[e],a)}return o})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let n=0;n<e.length;++n){const r=e[n];let i=r;wwe(e,r)>1&&(i+="_"+wwe(e.slice(0,n),r)),t.push(i)}return t}makeTrainFunction(){return e=>{const t=[],n=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),a=[],o=this.collectedTrainableWeights.map(e=>e.read());return[this.optimizer_.minimize(()=>{const e=[];for(let t=0;t<this.inputs.length;++t)e.push({key:this.inputs[t],value:n[t]});const o=new wEe(e),s=EEe(this.outputs,o,{training:!0});let l;for(let n=0;n<this.lossFunctions.length;++n){let e=(0,this.lossFunctions[n])(r[n],s[n]);null!=i[n]&&(e=DEe(e,i[n]));const a=Ege(e);t.push(a),l=0===n?e:qfe(l,e)}for(let n=0;n<this.metricsTensors.length;++n){let e;if(this.outputs.length>1&&n<this.outputs.length)e=t[n];else{const t=this.metricsTensors[n][1];e=Ege((0,this.metricsTensors[n][0])(r[t],s[t]))}Ffe(e),a.push(e)}return l=Ege(l),this.calculateLosses().forEach(e=>{l=qfe(l,e)}),l},!0,o)].concat(a)}}makeTestFunction(){this.testFunction=e=>Nfe(()=>{const t=[];let n;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let e=0;e<this.inputs.length;++e)a.push({key:this.inputs[e],value:r[e]});const o=new wEe(a),s=EEe(this.outputs,o);for(let e=0;e<this.lossFunctions.length;++e){const r=Ege((0,this.lossFunctions[e])(i[e],s[e]));n=0===e?r:qfe(n,r),t.push(n)}for(let e=0;e<this.metricsTensors.length;++e){const n=this.metricsTensors[e][1],r=Ege((0,this.metricsTensors[e][0])(i[n],s[n]));t.push(r)}return t})}async fit(e,t,n={}){return async function(e,t,n,r={}){if(e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");let i,a,o,s,l,u,c;e.isTraining=!0;try{const d=null==r.batchSize?32:r.batchSize;FEe(d);const h=!1,f=await e.standardizeUserData(t,n,r.sampleWeight,r.classWeight,h,d);i=f[0],a=f[1],c=f[2];let p,m=!1;if(null!=r.validationData&&r.validationData.length>0){if(m=!0,2!==r.validationData.length)throw 3===r.validationData.length?new vwe("validationData including sample weights is not supported yet."):new gwe("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+r.validationData+" is invalid.");o=r.validationData[0],s=r.validationData[1];const t=!0,n=await e.standardizeUserData(o,s,null,null,t,d);l=n[0],u=n[1],p=l.concat(u)}else if(null!=r.validationSplit&&r.validationSplit>0&&r.validationSplit<1){m=!0;const e=Math.floor(i[0].shape[0]*(1-r.validationSplit)),t=i[0].shape[0];l=REe(i,e,t),i=REe(i,0,e),u=REe(a,e,t),a=REe(a,0,e),p=l.concat(u)}else null!=r.validationSteps&&(m=!0);const g=i.concat(a).concat(c);e.checkTrainableWeightsConsistency();const v=e.makeTrainFunction(),y=e.getDedupedMetricsNames();let b,x;m?(e.makeTestFunction(),b=e.testFunction,x=y.slice().concat(y.map(e=>"val_"+e))):(b=null,p=[],x=y.slice());const _=Hke(r.callbacks,r.yieldEvery);return await async function(e,t,n,r,i,a,o,s,l,u,c,d,h,f,p){null==i&&(i=32),null==a&&(a=1),null==c&&(c=!0),null==h&&(h=0);let m=!1;null!=l&&null!=u&&(m=!0);const g=e.checkNumSamples(n,i,null,"steps_per_epoch");let v;null!=g&&(v=m_e(0,g)),null==o&&(o=1);const{callbackList:y,history:b}=Vke(s,o,a,h,g,null,i,m,d);y.setModel(e),e.history=b,await y.onTrainBegin(),e.stopTraining_=!1;for(let x=h;x<a;++x){await y.onEpochBegin(x);const a={};{if("batch"===c)throw new vwe("batch shuffling is not implemneted yet");c&&w.shuffle(v);const o=jve(v),s=LEe(g,i);for(let c=0;c<s.length;++c){const d={};if(await y.onBatchBegin(c,d),Nfe(()=>{const h=s[c][0],f=s[c][1],p=y_e(o,h,f-h);d.batch=c,d.size=f-h;const g=PEe(n,p),v=t(g);for(let e=0;e<r.length;++e){const t=v[e];d[r[e]]=t,Ffe(t)}if(c===s.length-1&&m){const t=e.testLoop(l,u,i);for(let e=0;e<r.length;++e){const n=r[e],i=t[e];Ffe(i),a["val_"+n]=i}}}),await y.onBatchEnd(c,d),Rke(d),e.stopTraining_)break}o.dispose()}if(await y.onEpochEnd(x,a),e.stopTraining_)break}return await y.onTrainEnd(),await e.history.syncData(),e.history}(e,v,g,y,d,r.epochs,r.verbose,_,b,p,r.shuffle,x,r.initialEpoch)}finally{e.isTraining=!1,$Ee(i,t),$Ee(a,n),$Ee(l,o),$Ee(u,s),null!=c&&jfe(c)}}(this,e,t,n)}async fitDataset(e,t){return async function(e,t,n){const r=null!=n.batchesPerEpoch;if(w.assert(null!=e.optimizer,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),w.assert(null!=n,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),w.assert(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),()=>"For fitDataset(), config.epochs is expected to be a positive integer, but got "+n.epochs),w.assert(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+n.batchesPerEpoch),w.assert(null==n.validationSplit,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const i=null!=n.validationData;let a,o;if(i)if(jEe(n.validationData))w.assert(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+n.validationBatches);else{const e=function(e){if(3===e.length)throw new vwe("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(n.validationData);a=e.xs,o=e.ys}const s=e.makeTrainFunction(),l=e.getDedupedMetricsNames();let u;u=i?l.slice().concat(l.map(e=>"val_"+e)):l.slice();const c=Hke(n.callbacks,n.yieldEvery),d=null==n.verbose?1:n.verbose,{callbackList:h,history:f}=Vke(c,d,n.epochs,null,null,function(e,t){let n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}(t,n),null,i,u);h.setModel(e),e.history=f,await h.onTrainBegin(),e.stopTraining_=!1;let p=null==n.initialEpoch?0:n.initialEpoch,m=await t.iterator();for(;p<n.epochs;){const u={};await h.onEpochBegin(p);let c=0,d=0;for(r||(m=await t.iterator());!r||c<n.batchesPerEpoch;){const t=await m.next();if(r&&t.done){console.warn("You provided `batchesPerEpoch` as "+n.batchesPerEpoch+", but your dataset iterator ran out of data after "+c+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+n.batchesPerEpoch*n.epochs+" batches). You may need to use the repeat() function when building your dataset.");break}if(null!=t.value){const{xs:r,ys:i}=MEe(e,t.value),a={};a.batch=d,a.size=r[0].shape[0],await h.onBatchBegin(d,a);const o=[];if(null!=n.classWeight){const t=AEe(n.classWeight,e.outputNames);for(let e=0;e<t.length;++e)o.push(await OEe(i[e],null,t[e]))}const u=r.concat(i).concat(o),f=s(u);jfe(u);for(let e=0;e<l.length;++e){const t=f[e];a[l[e]]=t,Ffe(t)}await h.onBatchEnd(d,a),Rke(a),d++,c++}if(r?c>=n.batchesPerEpoch:t.done){if(i){let t;t=jEe(n.validationData)?kwe(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):kwe(e.evaluate(a,o,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<e.metricsNames.length;++n)u["val_"+e.metricsNames[n]]=t[n]}break}if(e.stopTraining_)break}if(await h.onEpochEnd(p,u),p++,e.stopTraining_)break}return await h.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}(this,e,t)}async trainOnBatch(e,t){const n=await this.standardizeUserData(e,t),r=n[0],i=n[1],a=this.makeTrainFunction()(r.concat(i)),o=[];for(const s of a){const e=await s.data();o.push(e[0])}return jfe(a),_we(o)}getNamedWeights(e){const t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n);for(let a=0;a<r.length;++a)n&&!r[a].trainable||t.push({name:r[a].originalName,tensor:i[a]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const t=Dfe().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-Dfe().numTensors}return e}getLossIdentifiers(){let e;if("string"==typeof this.loss)e=Ewe(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if("string"!=typeof e)throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(e=>Ewe(e))}else{const t=Object.keys(this.loss);e={};const n=this.loss;for(const r of t){if("string"!=typeof n[r])throw new Error("Serialization of non-string loss is not supported.");e[r]=Ewe(n[r])}}return e}getMetricIdentifiers(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[Ewe(fEe(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Ewe(fEe(e)));{const e={};for(const t in this.metrics)e[t]=Ewe(fEe(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const t=qke(bEe(e.optimizer_config));let n,r;if("string"==typeof e.loss)n=Swe(e.loss);else if(Array.isArray(e.loss))n=e.loss.map(e=>Swe(e));else if(null!=e.loss){n={};for(const t in e.loss)n[t]=Swe(e.loss[t])}if(Array.isArray(e.metrics))r=e.metrics.map(e=>Swe(e));else if(null!=e.metrics){r={};for(const t in e.metrics)r[t]=Swe(e.metrics[t])}this.compile({loss:n,metrics:r,optimizer:t})}async save(e,t){if("string"==typeof e){const t=E.getSaveHandlers(e);if(0===t.length)throw new gwe(`Cannot find any save handlers for URL '${e}'`);if(t.length>1)throw new gwe(`Found more than one (${t.length}) save handlers for URL '${e}'`);e=t[0]}if(null==e.save)throw new gwe("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await E.encodeWeights(this.getNamedWeights(t)),r={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v"+xEe,convertedBy:null};if(null!=t&&t.includeOptimizer&&null!=this.optimizer){r.trainingConfig=this.getTrainingConfig();const e="optimizer",{data:t,specs:i}=await E.encodeWeights(await this.optimizer.getWeights(),e);n.specs.push(...i),n.data=E.concatenateArrayBuffers([n.data,t])}return null!=this.userDefinedMetadata&&(pEe(this.userDefinedMetadata,this.name,!0),r.userDefinedMetadata=this.userDefinedMetadata),r.weightData=n.data,r.weightSpecs=n.specs,e.save(r)}setUserDefinedMetadata(e){pEe(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}VEe.className="Model",O.registerClass(VEe);class qEe extends VEe{}async function GEe(e,t){"modelTopology"in e||(e={modelTopology:e});let n=(e=e).modelTopology;null!=n.model_config&&(n=n.model_config);const r=qke(bEe(n),t);if(null!=e.weightsManifest){const t=await E.loadWeights(e.weightsManifest,e.pathPrefix,r.weights.map(e=>e.originalName)),n={};for(const e of r.weights)n[e.originalName]=t[e.originalName];r.loadWeights(n),jfe(t)}return r}qEe.className="Functional",O.registerClass(qEe);class YEe extends VEe{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=null!=e.name?e.name:yke("sequential_"),null!=e.layers)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(e=>e<0))throw new gwe("Negative dimension size caused by adding layer "+e.name+" with input shape ["+e.inboundNodes[0].inputTensors[0].shape+"]")}add(e){const t=e instanceof YEe||e instanceof VEe;let n;if(t){if(n=e,1!==n.outputs.length)throw new gwe("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new gwe("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new gwe("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const t=jke({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(t)}if(t)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==e.inboundNodes.length)throw new gwe(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(1!==e.inboundNodes[0].outputTensors.length)throw new gwe("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=function e(t,n,r){if((null==n||null!=r&&r>0)&&(n=t.sourceLayer,r=t.nodeIndex),0===n.inboundNodes.length)return[t];{const t=n.inboundNodes[r];if(0===t.inboundLayers.length)return t.inputTensors;{const n=[];for(let r=0;r<t.inboundLayers.length;r++){const i=e(t.inputTensors[r],t.inboundLayers[r],t.nodeIndices[r]);for(const e of i)-1===n.indexOf(e)&&n.push(e)}return n}}}(this.outputs[0])}this.inboundNodes=[],new Oke({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:bwe(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(e=>e.shape),outputShapes:this.outputs[0].shape})}else{const t=e.apply(this.outputs[0]);if(Array.isArray(t))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[t],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return null==this.model&&this.build(),this.model.call(e,t)}build(e){if(_ke(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new VEe({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,n=console.log){this.built||this.build(),super.summary(e,t,n)}setWeights(e){null==this.model&&this.build(),this.model.setWeights(e)}evaluate(e,t,n={}){if(!this.built)throw new mwe("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}async evaluateDataset(e,t){if(!this.built)throw new mwe("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return null==this.model&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,n={}){if(!this.built)throw new mwe("The model needs to be compiled before being used.");return this.model.fit(e,t,n)}async fitDataset(e,t){if(!this.built)throw new mwe("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,n={},r=!1){let i,a={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new gwe("Legacy serialization format not supported yet.");i=t}else w.assert(null!=t.layers,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=t.layers,delete t.layers,a=t;const o=new e(a);if(!(o instanceof YEe))throw new vwe("Sequential.fromConfig called on non-Sequential input: "+o);for(const s of i){const e=qke(s,void 0,r);r&&e.setFastWeightInitDuringBuild(!0),o.add(e)}return o}set stopTraining(e){if(null==this.model)throw new gwe("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(null==this.model)throw new gwe("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const n={};n.className=t.getClassName(),n.config=t.getConfig(),e.push(n)}return{name:this.name,layers:e}}}function XEe(e){return new VEe(e)}function KEe(e){return new YEe(e)}function ZEe(e,t){return null==t&&(t={}),async function(e,t){if(null==t&&(t={}),"string"==typeof e){const n=E.getLoadHandlers(e,t);if(0===n.length)n.push(E.browserHTTPRequest(e,t));else if(n.length>1)throw new gwe(`Found more than one (${n.length}) load handlers for URL '${e}'`);e=n[0]}return async function(e,t,n){if(null==n&&(n={}),null==e.load)throw new gwe("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const r=await e.load();let i=r.modelTopology;null!=i.model_config&&(i=i.model_config);const a=null==n.strict||n.strict,o=null!=r.weightData&&null!=r.weightSpecs&&a,s=qke(bEe(i),void 0,o),l=r.trainingConfig;if(null!=l&&s.loadTrainingConfig(l),null!=r.userDefinedMetadata&&s.setUserDefinedMetadata(r.userDefinedMetadata),null!=r.weightData){if(null==r.weightSpecs)throw new gwe("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:e,optimizerWeights:t}=function(e,t){const n=E.decodeWeights(e,t),r={},i=[];return t.forEach(e=>{"optimizer"===e.group?i.push({name:e.name,tensor:n[e.name]}):r[e.name]=n[e.name]}),{modelWeights:r,optimizerWeights:i}}(r.weightData,r.weightSpecs);s.loadWeights(e,a),null!=s.optimizer&&t.length>0&&await s.optimizer.setWeights(t),jfe(e),jfe(t.map(e=>e.tensor))}return s}(e,0,t)}(e,t)}function JEe(e){return jke(e)}function QEe(e,t){Wke.registerCallbackConstructor(e,t)}YEe.className="Sequential",O.registerClass(YEe);class eSe extends O.Serializable{getConfig(){return{}}}class tSe extends eSe{apply(e,t=1){return function(e,t=1){if(1!==t)throw new vwe(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return jme(e)}(e,t)}}tSe.className="elu",O.registerClass(tSe);class nSe extends eSe{apply(e){return hve(e)}}nSe.className="selu",O.registerClass(nSe);class rSe extends eSe{apply(e){return rve(e)}}rSe.className="relu",O.registerClass(rSe);class iSe extends eSe{apply(e){return Nfe(()=>Tge(6,rve(e)))}}iSe.className="relu6",O.registerClass(iSe);class aSe extends eSe{apply(e){return e}}aSe.className="linear",O.registerClass(aSe);class oSe extends eSe{apply(e){return Jpe(e)}}oSe.className="sigmoid",O.registerClass(oSe);class sSe extends eSe{apply(e){return function(e){return Nfe(()=>{const t=qfe(.5,Xfe(.2,e));return cme(t,0,1)})}(e)}}sSe.className="hardSigmoid",O.registerClass(sSe);class lSe extends eSe{apply(e){return rge(e)}}lSe.className="softplus",O.registerClass(lSe);class uSe extends eSe{apply(e){return function(e){return Nfe(()=>Yfe(e,ppe(e).add(1)))}(e)}}uSe.className="softsign",O.registerClass(uSe);class cSe extends eSe{apply(e){return eme(e)}}cSe.className="tanh",O.registerClass(cSe);class dSe extends eSe{apply(e,t=-1){return _ve(e,t)}}dSe.className="softmax",O.registerClass(dSe);class hSe extends eSe{apply(e,t=-1){return sge(e,t)}}hSe.className="logSoftmax",O.registerClass(hSe);class fSe extends eSe{apply(e,t=1){return Nfe(()=>Jpe(e.mul(t)).mul(e))}}function pSe(e){return e.getClassName()}function mSe(e,t={}){return Iwe(e,O.SerializationMap.getMap().classNameMap,t,"activation")}function gSe(e){if(null==e)return mSe({className:"linear",config:{}});if("string"==typeof e){const t={};return t.className=e,t.config={},mSe(t)}return e instanceof eSe?e:mSe(e)}function vSe(e){if(null!=e&&"object"!=typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: "+e)}fSe.className="swish",O.registerClass(fSe);class ySe extends O.Serializable{}class bSe extends ySe{constructor(e){super(),vSe(e),this.l1=null==e||null==e.l1?.01:e.l1,this.l2=null==e||null==e.l2?.01:e.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(e){return Nfe(()=>{let t=Nge([1]);return this.hasL1&&(t=qfe(t,oge(Xfe(this.l1,ppe(e))))),this.hasL2&&(t=qfe(t,oge(Xfe(this.l2,C_e(e))))),t.asScalar()})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}bSe.className="L1L2",O.registerClass(bSe);const xSe={l1l2:"L1L2"};function wSe(e){return Cwe(e)}function _Se(e,t={}){return Iwe(e,O.SerializationMap.getMap().classNameMap,t,"regularizer")}function kSe(e){return null==e?null:"string"==typeof e?_Se({className:e in xSe?xSe[e]:e,config:{}}):e instanceof ySe?e:_Se(e)}class ESe extends Mke{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,null!=e&&(this.maxValue=e.maxValue)}call(e,t){e=wke(e);let n=rve(e);return null!=this.maxValue&&(n=cme(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}ESe.className="ReLU",O.registerClass(ESe);class SSe extends Mke{constructor(e){super(null==e?{}:e),this.DEFAULT_ALPHA=.3,null==e&&(e={}),this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=wke(e);return Xme(n,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}SSe.className="LeakyReLU",O.registerClass(SSe);class TSe extends Mke{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Q_e(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=kSe(e.alphaRegularizer),this.alphaConstraint=Vwe(e.alphaConstraint),null==e.sharedAxes)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new gwe("Expected sharedAxes to be a number or an array of numbers, but got "+e.sharedAxes);this.sharedAxes=[e.sharedAxes]}}build(e){const t=(e=_ke(e)).slice(1);if(null!=this.sharedAxes)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let r=1;r<e.length;++r)n[r]=e[r];this.inputSpec=[new Cke({ndim:e.length,axes:n})],this.built=!0}call(e,t){return e=wke(e),Wge(e,this.alpha.read())}getConfig(){const e={alphaInitializer:J_e(this.alphaInitializer),alphaRegularizer:wSe(this.alphaRegularizer),alphaConstraint:Hwe(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}TSe.className="PReLU",O.registerClass(TSe);class CSe extends Mke{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==this.DEFAULT_ALPHA)throw new vwe(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=wke(e);return jme(n)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}CSe.className="ELU",O.registerClass(CSe);class ISe extends Mke{constructor(e){super(null==e?{}:e),this.DEFAULT_THETA=1,null==e&&(e={}),this.theta=null==e.theta?this.DEFAULT_THETA:e.theta}call(e,t){const n=wke(e);return n.mul(g_e(n.greater(this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}ISe.className="ThresholdedReLU",O.registerClass(ISe);class ASe extends Mke{constructor(e){super(null==e?{}:e),this.DEFAULT_AXIS=1,null==e&&(e={}),this.softmax=(new dSe).apply,this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis}call(e,t){const n=wke(e);return this.softmax(n,this.axis)}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function OSe(e,t,n){if("number"==typeof e)return bwe(e,t);if(e.length!==t)throw new gwe(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${e.length} elements.`);for(let i=0;i<t;++i){const a=e[i];if((r=a)!==parseInt(r.toString(),10))throw new gwe(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(e)} including a non-integer number `+a)}return e;var r}function DSe(e,t,n,r,i=1){if(null==e)return e;let a;return a="same"===n?e:e-(t+(t-1)*(i-1))+1,Math.floor((a+r-1)/r)}function MSe(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+p_e([n-t,0]);else{if("same"!==r)throw new gwe(`Unsupport padding mode: ${r}.`);e*=t}return e}function NSe(e,t){return Nfe(()=>(n_e(t),"channelsFirst"===t?Lhe(e,[0,2,3,1]):e))}function jSe(e,t){return Nfe(()=>(n_e(t),"channelsFirst"===t?Lhe(e,[0,2,3,4,1]):e))}function FSe(e,t,n,r=[1,1],i="valid",a,o,s=null){return Nfe(()=>{if(null==a&&(a="channelsLast"),n_e(a),3!==e.rank&&4!==e.rank)throw new gwe(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${e.rank}.`);if(3!==t.rank&&4!==t.rank)throw new gwe(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${e.rank}.`);let l=NSe(e,a);if("causal"===i)throw new vwe("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=M.conv2d({x:l,filter:t,strides:r,pad:"same"===i?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===a&&(l=Lhe(l,[0,3,1,2])),l})}ASe.className="Softmax",O.registerClass(ASe);class RSe extends Mke{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",RSe.verifyArgs(t),this.rank=e,jwe(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new vwe(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=OSe(t.kernelSize,e,"kernelSize"),this.strides=OSe(null==t.strides?1:t.strides,e,"strides"),this.padding=null==t.padding?"valid":t.padding,r_e(this.padding),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,n_e(this.dataFormat),this.activation=gSe(t.activation),this.useBias=null==t.useBias||t.useBias,this.biasInitializer=Q_e(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Vwe(t.biasConstraint),this.biasRegularizer=kSe(t.biasRegularizer),this.activityRegularizer=kSe(t.activityRegularizer),this.dilationRate=OSe(null==t.dilationRate?1:t.dilationRate,e,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new gwe("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(this.dilationRate));if(2===this.rank){if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new gwe("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(this.dilationRate))}else if(3===this.rank)if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new gwe("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(this.dilationRate))}static verifyArgs(e){if(xwe("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!Nwe(e.kernelSize,"number",1,3))throw new gwe(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:pSe(this.activation),useBias:this.useBias,biasInitializer:J_e(this.biasInitializer),biasRegularizer:wSe(this.biasRegularizer),activityRegularizer:wSe(this.activityRegularizer),biasConstraint:Hwe(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class PSe extends RSe{constructor(e,t){super(e,t),this.kernel=null,PSe.verifyArgs(t),this.filters=t.filters,jwe(this.filters,"filters"),this.kernelInitializer=Q_e(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Vwe(t.kernelConstraint),this.kernelRegularizer=kSe(t.kernelRegularizer)}build(e){e=_ke(e);const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new gwe("The channel dimension of the input should be defined. Found "+e[t]);const n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:n}}],this.built=!0}call(e,t){return Nfe(()=>{let t;e=wke(e);const n=null==this.bias?null:this.bias.read(),r=Fwe(this.activation.getClassName());if(null!=r&&2===this.rank)t=FSe(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(1===this.rank)t=function(e,t,n,r=1,i="valid",a,o=1){return Nfe(()=>{if(null==a&&(a="channelsLast"),n_e(a),3!==e.shape.length)throw new gwe("The input of a conv1dWithBias operation should be 3, but is "+e.shape.length+" instead.");if(3!==t.shape.length)throw new gwe("The kernel for a conv1dWithBias operation should be 3, but is "+t.shape.length+" instead");if(null!=n&&1!==n.shape.length)throw new gwe("The bias for a conv1dWithBias operation should be 1, but is "+t.shape.length+" instead");if("channelsFirst"===a&&(e=Lhe(e,[0,2,1])),"causal"===i)throw new vwe("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let s=gme(e,t,r,"same"===i?"same":"valid","NWC",o);return null!=n&&(s=A_e(s,n)),s})}(e,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)t=FSe(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new vwe("convolutions greater than 3D are not implemented yet.");t=function(e,t,n,r=[1,1,1],i="valid",a,o){return Nfe(()=>{if(null==a&&(a="channelsLast"),n_e(a),4!==e.rank&&5!==e.rank)throw new gwe("conv3dWithBias expects input to be of rank 4 or 5, but received "+e.rank+".");if(4!==t.rank&&5!==t.rank)throw new gwe("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+e.rank+".");let s=jSe(e,a);if("causal"===i)throw new vwe("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=bme(s,t,r,"same"===i?"same":"valid","NDHWC",o),null!=n&&(s=A_e(s,n)),"channelsFirst"===a&&(s=Lhe(s,[0,4,1,2,3])),s})}(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(t=this.activation.apply(t))}return t})}computeOutputShape(e){e=_ke(e);const t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<n.length;++i){const e=DSe(n[i],this.kernelSize[i],this.padding,this.strides[i],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[i]);t.push(e)}let r=[e[0]];return"channelsLast"===this.dataFormat?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:J_e(this.kernelInitializer),kernelRegularizer:wSe(this.kernelRegularizer),kernelConstraint:Hwe(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new gwe("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(e.filters))}}class LSe extends PSe{constructor(e){super(2,e),LSe.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&!Nwe(e.kernelSize,"number",1,2))throw new gwe(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}LSe.className="Conv2D",O.registerClass(LSe);class BSe extends PSe{constructor(e){super(3,e),BSe.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new gwe(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}BSe.className="Conv3D",O.registerClass(BSe);class $Se extends LSe{constructor(e){if(super(e),this.inputSpec=[new Cke({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new gwe("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+this.padding)}build(e){if(4!==(e=_ke(e)).length)throw new gwe("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new gwe("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Cke({ndim:4,axes:{[t]:n}})],this.built=!0}call(e,t){return Nfe(()=>{let t=wke(e);if(4!==t.shape.length)throw new gwe("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+t.shape.length);const n=t.shape;let r,i;"channelsFirst"===this.dataFormat?(r=2,i=3):(r=1,i=2);const a=n[i],o=this.kernelSize[1],s=this.strides[1],l=[n[0],MSe(n[r],this.strides[0],this.kernelSize[0],this.padding),MSe(a,s,o,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=Lhe(t,[0,2,3,1]));let u=yme(t,this.kernel.read(),l,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(u=Lhe(u,[0,3,1,2])),null!=this.bias&&(u=A_e(u,this.bias.read(),this.dataFormat)),null!=this.activation&&(u=this.activation.apply(u)),u})}computeOutputShape(e){const t=(e=_ke(e)).slice();let n,r,i;"channelsFirst"===this.dataFormat?(n=1,r=2,i=3):(n=3,r=1,i=2);const a=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],l=this.strides[1];return t[n]=this.filters,t[r]=MSe(t[r],s,a,this.padding),t[i]=MSe(t[i],l,o,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}$Se.className="Conv2DTranspose",O.registerClass($Se);class zSe extends PSe{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==t.filters)throw new gwe("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=t.kernelInitializer||null!=t.kernelRegularizer||null!=t.kernelConstraint)throw new gwe("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=t.padding&&"same"!==t.padding&&"valid"!==t.padding)throw new gwe(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received `+JSON.stringify(t.padding));this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=Q_e(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=kSe(t.depthwiseRegularizer),this.depthwiseConstraint=Vwe(t.depthwiseConstraint),this.pointwiseInitializer=Q_e(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=kSe(t.pointwiseRegularizer),this.pointwiseConstraint=Vwe(t.pointwiseConstraint)}build(e){if((e=_ke(e)).length<this.rank+2)throw new gwe(`Inputs to SeparableConv${this.rank}D should have rank `+(this.rank+2)+", but received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new gwe("The channel dimension of the inputs should be defined, but found "+JSON.stringify(e[t]));const n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),i=[];for(let o=0;o<this.rank;++o)i.push(1);i.push(n*this.depthMultiplier,this.filters);const a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):null,this.inputSpec=[new Cke({ndim:this.rank+2,axes:{[t]:n}})],this.built=!0}call(e,t){return Nfe(()=>{let t;if(e=wke(e),1===this.rank)throw new vwe("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(e=Lhe(e,[0,2,3,1])),t=fve(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(t=A_e(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),"channelsFirst"===this.dataFormat&&(t=Lhe(t,[0,3,1,2])),t})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=J_e(this.depthwiseInitializer),e.pointwiseInitializer=J_e(this.pointwiseInitializer),e.depthwiseRegularizer=wSe(this.depthwiseRegularizer),e.pointwiseRegularizer=wSe(this.pointwiseRegularizer),e.depthwiseConstraint=Hwe(this.depthwiseConstraint),e.pointwiseConstraint=Hwe(this.pointwiseConstraint),e}}zSe.className="SeparableConv";class USe extends zSe{constructor(e){super(2,e)}}USe.className="SeparableConv2D",O.registerClass(USe);class HSe extends PSe{constructor(e){super(1,e),HSe.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&!Nwe(e.kernelSize,"number",1,1))throw new gwe(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}HSe.className="Conv1D",O.registerClass(HSe);class WSe extends Mke{constructor(e){super(e),this.cropping="number"==typeof e.cropping?[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:e.cropping,this.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return Nfe(()=>{if(e=wke(e),"channelsLast"===this.dataFormat){const t=x_e(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return x_e(t,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const t=x_e(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return x_e(t,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}WSe.className="Cropping2D",O.registerClass(WSe);class VSe extends Mke{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==e.size?this.DEFAULT_SIZE:e.size,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,n_e(this.dataFormat),this.interpolation=null==e.interpolation?"nearest":e.interpolation,Mwe(Zwe,"InterpolationFormat",this.interpolation)}computeOutputShape(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],null==e[2]?null:this.size[0]*e[2],null==e[3]?null:this.size[1]*e[3]]:[e[0],null==e[1]?null:this.size[0]*e[1],null==e[2]?null:this.size[1]*e[2],e[3]]}call(e,t){return Nfe(()=>{let t=wke(e);const n=t.shape;if("channelsFirst"===this.dataFormat){t=Lhe(t,[0,2,3,1]);const e=this.size[0]*n[2],r=this.size[1]*n[3],i="nearest"===this.interpolation?t.resizeNearestNeighbor([e,r]):t.resizeBilinear([e,r]);return Lhe(i,[0,3,1,2])}{const e=this.size[0]*n[1],r=this.size[1]*n[2];return"nearest"===this.interpolation?t.resizeNearestNeighbor([e,r]):t.resizeBilinear([e,r])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}VSe.className="UpSampling2D",O.registerClass(VSe);class qSe extends RSe{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=Q_e(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Vwe(e.depthwiseConstraint),this.depthwiseRegularizer=kSe(e.depthwiseRegularizer)}build(e){if((e=_ke(e)).length<4)throw new gwe(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new gwe(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const n=e[t];this.depthwiseKernel=this.addWeight("depthwise_kernel",[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier],null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}call(e,t){return Nfe(()=>{let t=function(e,t,n=[1,1],r="valid",i,a){return Nfe(()=>{null==i&&(i="channelsLast"),n_e(i);let o=NSe(e,i);if(4!==e.rank)throw new gwe("Input for depthwiseConv2d is required to be 4-D, but is instead "+e.rank+"-D");if(4!==t.rank)throw new gwe("depthwiseKernel is required to be 4-D, but is instead "+t.rank+"-D");return o=Cme(o,t,n,"same"===r?"same":"valid","NHWC",a),"channelsFirst"===i&&(o=Lhe(o,[0,3,1,2])),o})}(e=wke(e),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(t=A_e(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),t})}computeOutputShape(e){e=_ke(e);const t="channelsFirst"===this.dataFormat?e[3]:e[2],n="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,r=DSe("channelsFirst"===this.dataFormat?e[2]:e[1],this.kernelSize[0],this.padding,this.strides[0]),i=DSe(t,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],n,r,i]:[e[0],r,i,n]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=J_e(this.depthwiseInitializer),e.depthwiseRegularizer=wSe(this.depthwiseRegularizer),e.depthwiseConstraint=Hwe(this.depthwiseRegularizer),e}}function GSe(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new gwe("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function i(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=i(t),constants:n=i(n)}}function YSe(e,t,n,r=!1,i,a,o=!1,s=!1){return Nfe(()=>{const l=t.shape.length;if(l<3)throw new gwe(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(m_e(2,l));if(t=Lhe(t,u),null!=a)throw new vwe("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=i&&((i=i.asType("bool").asType("float32")).rank===l-1&&(i=Pme(i,-1)),i=Lhe(i,u)),r&&(t=ave(t,0),null!=i&&(i=ave(i,0)));const c=[];let d,h=n;const f=t.shape[0],p=Hve(t);let m,g;null!=i&&(m=Hve(i));for(let t=0;t<f;++t){const n=p[t],r=Nfe(()=>e(n,h));if(null==i)d=r[0],h=r[1];else{const e=Nfe(()=>{const e=m[t],n=Fge(e).sub(e);return{output:r[0].mul(e).add(h[0].mul(n)),newStates:h.map((t,i)=>r[1][i].mul(e).add(t.mul(n)))}});d=e.output,h=e.newStates}s&&c.push(d)}return s&&(g=Ove(c,1)),[d,g,h]})}qSe.className="DepthwiseConv2D",O.registerClass(qSe);class XSe extends Mke{constructor(e){let t;if(super(e),null==e.cell)throw new gwe("cell property is missing for the constructor of RNN.");if(t=Array.isArray(e.cell)?new rTe({cells:e.cell}):e.cell,null==t.stateSize)throw new gwe("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=null!=e.returnSequences&&e.returnSequences,this.returnState=null!=e.returnState&&e.returnState,this.goBackwards=null!=e.goBackwards&&e.goBackwards,this._stateful=null!=e.stateful&&e.stateful,this.unroll=null!=e.unroll&&e.unroll,this.supportsMasking=!0,this.inputSpec=[new Cke({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){return null==this.states_?m_e(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(e=>null):this.states_}setStates(e){this.states_=e}computeOutputShape(e){bke(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const n=t[0];let r;if(r=this.returnSequences?[e[0],e[1],n]:[e[0],n],this.returnState){const n=[];for(const r of t)n.push([e[0],r]);return[r].concat(n)}return r}computeMask(e,t){return Nfe(()=>{Array.isArray(t)&&(t=t[0]);const e=this.returnSequences?t:null;if(this.returnState){const t=this.states.map(e=>null);return[e].concat(t)}return e})}get states(){if(null==this.states_){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let n=0;n<e;++n)t.push(null);return t}return this.states_}set states(e){this.states_=e}build(e){if(null!=this.numConstants)throw new vwe("Constants support is not implemented in RNN yet.");bke(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new Cke({shape:[t,null,...n]});const r=[e[0]].concat(e.slice(2));let i;if(this.cell.build(r),i=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!w.arraysEqual(this.stateSpec.map(e=>e.shape[e.shape.length-1]),i))throw new gwe(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is `+this.cell.stateSize)}else this.stateSpec=i.map(e=>new Cke({shape:[null,e]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){Nfe(()=>{if(!this.stateful)throw new pwe("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new gwe("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)this.states_=Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(e=>Nge([n,e])):[Nge([n,this.cell.stateSize])];else if(null==e)jfe(this.states_),null!=this.keptStates&&(jfe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(e=>Nge([n,e])):this.states_[0]=Nge([n,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new gwe(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: `+e);!0===t?this.keptStates.push(this.states_.slice()):jfe(this.states_);for(let t=0;t<this.states_.length;++t){const r=e[t],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[t]:this.cell.stateSize,a=[n,i];if(!w.arraysEqual(r.shape,a))throw new gwe(`State ${t} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${r.shape}`);this.states_[t]=r}}this.states_=this.states_.map(e=>Ffe(e.clone()))})}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const i=GSe(e,n,r,this.numConstants);e=i.inputs,n=i.initialState,r=i.constants;let a=[],o=[];if(null!=n){t.initialState=n,a=a.concat(n),this.stateSpec=[];for(const e of n)this.stateSpec.push(new Cke({shape:e.shape}));o=o.concat(this.stateSpec)}if(null!=r&&(t.constants=r,a=a.concat(r),this.numConstants=r.length),a[0]instanceof Ike){const n=[e].concat(a),r=this.inputSpec.concat(o),i=this.inputSpec;this.inputSpec=r;const s=super.apply(n,t);return this.inputSpec=i,s}return super.apply(e,t)}call(e,t){return Nfe(()=>{const n=null==t?null:t.mask,r=null==t?null:t.training;let i=null==t?null:t.initialState;e=wke(e),null==i&&(i=this.stateful?this.states_:this.getInitialState(e));const a=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==a)throw new gwe(`RNN Layer has ${a} state(s) but was passed `+i.length+" initial state(s).");this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const o={training:r},s=YSe((e,t)=>{const n=this.cell.call([e].concat(t),o);return[n[0],n.slice(1)]},e,i,this.goBackwards,n,null,this.unroll,this.returnSequences),l=s[0],u=s[1],c=s[2];this.stateful&&this.resetStates(c,r);const d=this.returnSequences?u:l;return this.returnState?[d].concat(c):d})}getInitialState(e){return Nfe(()=>{let t=Nge(e.shape);return t=oge(t,[1,2]),t=v_e(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(e=>e>1?k_e(t,[1,e]):t):this.cell.stateSize>1?[k_e(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===XSe.className&&(t.cell={className:this.cell.getClassName(),config:n}),Object.assign({},n,e,t)}static fromConfig(e,t,n={}){const r=qke(t.cell,n);return new e(Object.assign(t,{cell:r}))}}XSe.className="RNN",O.registerClass(XSe);class KSe extends Mke{}class ZSe extends KSe{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,jwe(this.units,"units"),this.activation=gSe(null==e.activation?this.DEFAULT_ACTIVATION:e.activation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=Q_e(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Q_e(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Q_e(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=kSe(e.kernelRegularizer),this.recurrentRegularizer=kSe(e.recurrentRegularizer),this.biasRegularizer=kSe(e.biasRegularizer),this.kernelConstraint=Vwe(e.kernelConstraint),this.recurrentConstraint=Vwe(e.recurrentConstraint),this.biasConstraint=Vwe(e.biasConstraint),this.dropout=f_e([1,p_e([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=f_e([1,p_e([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=_ke(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}call(e,t){return Nfe(()=>{if(2!==(e=e).length)throw new gwe(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let n=e[1];e=e[0];const r=null!=t.training&&t.training;let i;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=iTe({ones:()=>Fge(e),rate:this.dropout,training:r})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=iTe({ones:()=>Fge(n),rate:this.recurrentDropout,training:r}));const a=this.dropoutMask,o=this.recurrentDropoutMask;i=S_e(null!=a?Xfe(e,a):e,this.kernel.read()),null!=this.bias&&(i=A_e(i,this.bias.read())),null!=o&&(n=Xfe(n,o));let s=qfe(i,S_e(n,this.recurrentKernel.read()));return null!=this.activation&&(s=this.activation.apply(s)),[s,s]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:pSe(this.activation),useBias:this.useBias,kernelInitializer:J_e(this.kernelInitializer),recurrentInitializer:J_e(this.recurrentInitializer),biasInitializer:J_e(this.biasInitializer),kernelRegularizer:wSe(this.kernelRegularizer),recurrentRegularizer:wSe(this.recurrentRegularizer),biasRegularizer:wSe(this.biasRegularizer),activityRegularizer:wSe(this.activityRegularizer),kernelConstraint:Hwe(this.kernelConstraint),recurrentConstraint:Hwe(this.recurrentConstraint),biasConstraint:Hwe(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}ZSe.className="SimpleRNNCell",O.registerClass(ZSe);class JSe extends XSe{constructor(e){e.cell=new ZSe(e),super(e)}call(e,t){return Nfe(()=>(null!=this.cell.dropoutMask&&(jfe(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(jfe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),super.call(e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})))}static fromConfig(e,t){return new e(t)}}JSe.className="SimpleRNN",O.registerClass(JSe);class QSe extends KSe{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new gwe("GRUCell does not support reset_after parameter set to true.");this.units=e.units,jwe(this.units,"units"),this.activation=gSe(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=gSe(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=Q_e(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Q_e(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Q_e(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=kSe(e.kernelRegularizer),this.recurrentRegularizer=kSe(e.recurrentRegularizer),this.biasRegularizer=kSe(e.biasRegularizer),this.kernelConstraint=Vwe(e.kernelConstraint),this.recurrentConstraint=Vwe(e.recurrentConstraint),this.biasConstraint=Vwe(e.biasConstraint),this.dropout=f_e([1,p_e([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=f_e([1,p_e([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=_ke(e),this.kernel=this.addWeight("kernel",[e[e.length-1],3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}call(e,t){return Nfe(()=>{if(2!==(e=e).length)throw new gwe("GRUCell expects 2 input Tensors (inputs, h, c), got "+e.length+".");const n=null!=t.training&&t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=iTe({ones:()=>Fge(e),rate:this.dropout,training:n,count:3})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=iTe({ones:()=>Fge(r),rate:this.recurrentDropout,training:n,count:3}));const i=this.recurrentDropoutMask;let a,o,s;0<this.dropout&&this.dropout<1&&(e=Xfe(e,this.dropoutMask[0]));let l=S_e(e,this.kernel.read());this.useBias&&(l=A_e(l,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Xfe(r,i[0]));const u=this.recurrentKernel.read(),[c,d]=Tve(u,[2*this.units,this.units],u.rank-1),h=S_e(r,c),[f,p,m]=Tve(l,3,l.rank-1),[g,v]=Tve(h,2,h.rank-1);a=this.recurrentActivation.apply(qfe(f,g)),o=this.recurrentActivation.apply(qfe(p,v));const y=S_e(Xfe(o,r),d);s=this.activation.apply(qfe(m,y));const b=qfe(Xfe(a,r),Xfe(qfe(1,nge(a)),s));return[b,b]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:pSe(this.activation),recurrentActivation:pSe(this.recurrentActivation),useBias:this.useBias,kernelInitializer:J_e(this.kernelInitializer),recurrentInitializer:J_e(this.recurrentInitializer),biasInitializer:J_e(this.biasInitializer),kernelRegularizer:wSe(this.kernelRegularizer),recurrentRegularizer:wSe(this.recurrentRegularizer),biasRegularizer:wSe(this.biasRegularizer),activityRegularizer:wSe(this.activityRegularizer),kernelConstraint:Hwe(this.kernelConstraint),recurrentConstraint:Hwe(this.recurrentConstraint),biasConstraint:Hwe(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}QSe.className="GRUCell",O.registerClass(QSe);class eTe extends XSe{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new QSe(e),super(e)}call(e,t){return Nfe(()=>(null!=this.cell.dropoutMask&&(jfe(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(jfe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),super.call(e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})))}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}eTe.className="GRU",O.registerClass(eTe);class tTe extends KSe{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,jwe(this.units,"units"),this.activation=gSe(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=gSe(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=Q_e(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Q_e(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Q_e(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=kSe(e.kernelRegularizer),this.recurrentRegularizer=kSe(e.recurrentRegularizer),this.biasRegularizer=kSe(e.biasRegularizer),this.kernelConstraint=Vwe(e.kernelConstraint),this.recurrentConstraint=Vwe(e.recurrentConstraint),this.biasConstraint=Vwe(e.biasConstraint),this.dropout=f_e([1,p_e([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=f_e([1,p_e([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;let n;if(e=_ke(e),this.kernel=this.addWeight("kernel",[e[e.length-1],4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const e=this.biasInitializer,r=this.units;n=new((t=class extends j_e{apply(t,n){const i=e.apply([r]),a=(new R_e).apply([r]),o=e.apply([2*r]);return __e(__e(i,a),o)}}).className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return Nfe(()=>{const n=null!=t.training&&t.training;if(3!==(e=e).length)throw new gwe("LSTMCell expects 3 input Tensors (inputs, h, c), got "+e.length+".");let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=iTe({ones:()=>Fge(e),rate:this.dropout,training:n,count:4})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=iTe({ones:()=>Fge(r),rate:this.recurrentDropout,training:n,count:4}));const a=this.recurrentDropoutMask;let o,s,l,u;0<this.dropout&&this.dropout<1&&(e=Xfe(e,this.dropoutMask[0]));let c=S_e(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Xfe(r,a[0])),c=qfe(c,S_e(r,this.recurrentKernel.read())),this.useBias&&(c=A_e(c,this.bias.read()));const[d,h,f,p]=Tve(c,4,c.rank-1);o=this.recurrentActivation.apply(d),s=this.recurrentActivation.apply(h),l=qfe(Xfe(s,i),Xfe(o,this.activation.apply(f))),u=this.recurrentActivation.apply(p);const m=Xfe(u,this.activation.apply(l));return[m,m,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:pSe(this.activation),recurrentActivation:pSe(this.recurrentActivation),useBias:this.useBias,kernelInitializer:J_e(this.kernelInitializer),recurrentInitializer:J_e(this.recurrentInitializer),biasInitializer:J_e(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:wSe(this.kernelRegularizer),recurrentRegularizer:wSe(this.recurrentRegularizer),biasRegularizer:wSe(this.biasRegularizer),activityRegularizer:wSe(this.activityRegularizer),kernelConstraint:Hwe(this.kernelConstraint),recurrentConstraint:Hwe(this.recurrentConstraint),biasConstraint:Hwe(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}tTe.className="LSTMCell",O.registerClass(tTe);class nTe extends XSe{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new tTe(e),super(e)}call(e,t){return Nfe(()=>(null!=this.cell.dropoutMask&&(jfe(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(jfe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),super.call(e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})))}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}nTe.className="LSTM",O.registerClass(nTe);class rTe extends KSe{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return Nfe(()=>{let n=(e=e).slice(1);const r=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?r.push(n.splice(0,e.stateSize.length)):r.push(n.splice(0,1));r.reverse();const i=[];let a;for(let o=0;o<this.cells.length;++o){const s=this.cells[o];n=r[o],a=0===o?[e[0]].concat(n):[a[0]].concat(n),a=s.call(a,t),i.push(a.slice(1))}n=[];for(const e of i.slice().reverse())n.push(...e);return[a[0]].concat(n)})}build(e){let t;bke(e)&&(e=e[0]),e=e,this.cells.forEach((n,r)=>{o_e("RNNCell_"+r,()=>{n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=this.cells.map(e=>({className:e.getClassName(),config:e.getConfig()}));return Object.assign({},e,{cells:t})}static fromConfig(e,t,n={}){const r=[];for(const i of t.cells)r.push(qke(i,n));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return Ske(e)}setWeights(e){const t=[];for(const n of this.cells){const r=e.splice(n.weights.length);for(let e=0;e<n.weights.length;++e)t.push([n.weights[e],r[e]])}Tke(t)}}function iTe(e){const{ones:t,rate:n,training:r=!1,count:i=1}=e,a=()=>O_e(t(),n),o=()=>D_e(a,t,r);return!i||i<=1?Ffe(o().clone()):Array(i).fill(void 0).map(o).map(e=>Ffe(e.clone()))}rTe.className="StackedRNNCells",O.registerClass(rTe);class aTe extends XSe{constructor(e){if(e.unroll)throw new vwe("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new vwe("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Cke({ndim:5})]}call(e,t){return Nfe(()=>{if(null!=this.cell.dropoutMask&&(jfe(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(jfe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new gwe("ConvRNN2D cell does not support constants");return super.call(e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return Nfe(()=>{const{stateSize:t}=this.cell,n=this.computeSingleOutputShape(e.shape),r=Nge([n[0],...n.slice(2)]);return Array.isArray(t)?Array(t.length).fill(r):[r]})}resetStates(e,t=!1){Nfe(()=>{if(!this.stateful)throw new pwe("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),i=[r[0],...r.slice(2)];if(null==n[0])throw new gwe("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())this.states_=Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(()=>Nge(i)):[Nge(i)];else if(null==e)jfe(this.states_),null!=this.keptStates&&(jfe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Nge(i)):this.states_[0]=Nge(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new gwe(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: `+e);t?this.keptStates.push(this.states_.slice()):jfe(this.states_);for(let t=0;t<this.states_.length;++t){const n=e[t],r=i;if(!w.arraysEqual(n.shape,r))throw new gwe(`State ${t} is incompatible with layer ${this.name}: expected shape=${r}, received shape=${n.shape}`);this.states_[t]=n}}this.states_=this.states_.map(e=>Ffe(e.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:n,kernelSize:r,padding:i,strides:a,dilationRate:o}=this.cell,s="channelsFirst"===t,l=e[s?4:3],u=DSe(e[s?3:2],r[0],i,a[0],o[0]),c=DSe(l,r[1],i,a[1],o[1]);return[...e.slice(0,2),...s?[n,u,c]:[u,c,n]]}}aTe.className="ConvRNN2D";class oTe extends tTe{constructor(e){const{filters:t,kernelSize:n,strides:r,padding:i,dataFormat:a,dilationRate:o}=e;super(Object.assign({},e,{units:t})),this.filters=t,jwe(this.filters,"filters"),this.kernelSize=OSe(n,2,"kernelSize"),this.kernelSize.forEach(e=>jwe(e,"kernelSize")),this.strides=OSe(r||1,2,"strides"),this.strides.forEach(e=>jwe(e,"strides")),this.padding=i||"valid",r_e(this.padding),this.dataFormat=a||"channelsLast",n_e(this.dataFormat),this.dilationRate=OSe(o||1,2,"dilationRate"),this.dilationRate.forEach(e=>jwe(e,"dilationRate"))}build(e){var t;e=_ke(e);const n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new gwe("The channel dimension of the input should be defined. Found "+e[n]);const r=this.kernelSize.concat([e[n],4*this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let e;if(this.unitForgetBias){const n=this.biasInitializer,r=this.filters;e=new((t=class extends j_e{apply(e,t){return w_e([n.apply([r]),jge([r]),n.apply([2*r])])}}).className="CustomInit",t)}else e=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,e,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return Nfe(()=>{if(3!==e.length)throw new gwe("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+e.length+".");const n=t.training||!1,r=e[0],i=e[1],a=e[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=iTe({ones:()=>Fge(r),rate:this.dropout,training:n,count:4}));const o=this.dropoutMask,s=(e,t,n)=>t&&t[n]?Xfe(t[n],e):e;let l=s(r,o,0),u=s(r,o,1),c=s(r,o,2),d=s(r,o,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=iTe({ones:()=>Fge(i),rate:this.recurrentDropout,training:n,count:4}));const h=this.recurrentDropoutMask;let f=s(i,h,0),p=s(i,h,1),m=s(i,h,2),g=s(i,h,3);const[v,y,b,x]=Tve(this.kernel.read(),4,3),[w,_,k,E]=this.useBias?Tve(this.bias.read(),4):[null,null,null,null];l=this.inputConv(l,v,w,this.padding),u=this.inputConv(u,y,_,this.padding),c=this.inputConv(c,b,k,this.padding),d=this.inputConv(d,x,E,this.padding);const[S,T,C,I]=Tve(this.recurrentKernel.read(),4,3);f=this.recurrentConv(f,S),p=this.recurrentConv(p,T),m=this.recurrentConv(m,C),g=this.recurrentConv(g,I);const A=this.recurrentActivation.apply(qfe(l,f)),O=this.recurrentActivation.apply(qfe(u,p)),D=qfe(Xfe(O,a),Xfe(A,this.activation.apply(qfe(c,m)))),M=Xfe(this.recurrentActivation.apply(qfe(d,g)),this.activation.apply(D));return[M,M,D]})}getConfig(){const e=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(super.getConfig(),["units"]);return Object.assign({},e,{filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides})}inputConv(e,t,n,r){const i=mme(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?A_e(i,n,this.dataFormat):i}recurrentConv(e,t){return mme(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}oTe.className="ConvLSTM2DCell",O.registerClass(oTe);class sTe extends aTe{constructor(e){const t=new oTe(e);super(Object.assign({},e,{cell:t}))}static fromConfig(e,t){return new e(t)}}sTe.className="ConvLSTM2D",O.registerClass(sTe);class lTe extends Mke{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(null==this.noiseShape)return this.noiseShape;const t=e.shape,n=[];for(let r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}call(e,t){return Nfe(()=>{this.invokeCallHook(e,t);const n=wke(e);if(0<this.rate&&this.rate<1){const e=null!=t.training&&t.training,r=this.getNoiseShape(n);return D_e(()=>O_e(n,this.rate,r,this.seed),()=>n,e)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}lTe.className="Dropout",O.registerClass(lTe);class uTe extends lTe{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}uTe.className="SpatialDropout1D",O.registerClass(uTe);class cTe extends Mke{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){let t=null;null!=e.batchSize&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,jwe(this.units,"units"),this.activation=gSe(e.activation),null!=e.useBias&&(this.useBias=e.useBias),this.kernelInitializer=Q_e(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Q_e(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Vwe(e.kernelConstraint),this.biasConstraint=Vwe(e.biasConstraint),this.kernelRegularizer=kSe(e.kernelRegularizer),this.biasRegularizer=kSe(e.biasRegularizer),this.activityRegularizer=kSe(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){const t=(e=_ke(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){const t=(e=_ke(e)).slice();return t[t.length-1]=this.units,t}call(e,t){return Nfe(()=>{this.invokeCallHook(e,t);const n=wke(e),r=Fwe(this.activation.getClassName());let i;return null!=r?i=S_e(n,this.kernel.read(),r,this.bias?this.bias.read():null):(i=S_e(n,this.kernel.read()),null!=this.bias&&(i=A_e(i,this.bias.read())),null!=this.activation&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:pSe(this.activation),useBias:this.useBias,kernelInitializer:J_e(this.kernelInitializer),biasInitializer:J_e(this.biasInitializer),kernelRegularizer:wSe(this.kernelRegularizer),biasRegularizer:wSe(this.biasRegularizer),activityRegularizer:wSe(this.activityRegularizer),kernelConstraint:Hwe(this.kernelConstraint),biasConstraint:Hwe(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}cTe.className="Dense",O.registerClass(cTe);class dTe extends Mke{constructor(e){super(e=e||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=_ke(e);for(const t of e.slice(1))if(null==t)throw new gwe(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],d_e(e,1)]}call(e,t){return Nfe(()=>{this.invokeCallHook(e,t);let n=wke(e);if("channelsFirst"===this.dataFormat&&n.rank>1){const e=[0];for(let t=2;t<n.rank;++t)e.push(t);e.push(1),n=n.transpose(e)}return function(e){if(e.rank<=1)throw new gwe(`batchFlatten requires a minimum rank of 2. Got rank: ${e.rank}.`);const t=[e.shape[0],d_e(e.shape,1)];return e.reshape(t)}(n)})}getConfig(){const e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}dTe.className="Flatten",O.registerClass(dTe);class hTe extends Mke{constructor(e){super(e),this.supportsMasking=!0,this.activation=gSe(e.activation)}call(e,t){return Nfe(()=>{this.invokeCallHook(e,t);const n=wke(e);return this.activation.apply(n)})}getConfig(){const e={activation:pSe(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}hTe.className="Activation",O.registerClass(hTe);class fTe extends Mke{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return Nfe(()=>{return e=wke(e),t=e,n=this.n,Nfe(()=>{if(2!==t.shape.length)throw new gwe(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);return k_e(v_e(t,1),[1,n,1])});var t,n})}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}fTe.className="RepeatVector",O.registerClass(fTe);class pTe extends Mke{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||null==e}fixUnknownDimension(e,t){const n="Total size of new array must be unchanged.",r=t.slice();let i=1,a=null;for(let s=0;s<r.length;++s){const e=r[s];if(this.isUnknown(e)){if(null!==a)throw new gwe("Can only specifiy one unknown dimension.");a=s}else i*=e}const o=d_e(e);if(null!==a){if(0===i||o%i!=0)throw new gwe(n);r[a]=o/i}else if(o!==i)throw new gwe(n);return r}computeOutputShape(e){let t=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return Nfe(()=>{this.invokeCallHook(e,t);const n=wke(e),r=n.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return n.reshape(i)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}pTe.className="Reshape",O.registerClass(pTe);class mTe extends Mke{constructor(e){if(super(e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+e.dims+" instead.");const t=m_e(1,e.dims.length+1);if(!w.arraysEqual(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Cke({ndim:this.dims.length+1})]}computeOutputShape(e){const t=(e=_ke(e)).slice();return this.dims.forEach((n,r)=>{t[r+1]=e[n]}),t}call(e,t){return Lhe(wke(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}mTe.className="Permute",O.registerClass(mTe);class gTe extends Mke{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,this.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const n=wke(e);return Cpe(Mge(n,this.maskValue),-1)}call(e,t){return Nfe(()=>{this.invokeCallHook(e,t);const n=wke(e),r=Cpe(Mge(n,this.maskValue),-1,!0);return n.mul(r.asType(n.dtype))})}}gTe.className="Masking",O.registerClass(gTe);class vTe extends Mke{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){let t=null;null!=e.batchSize&&(t=e.batchSize),this.batchInputShape=null==e.inputLength?[t,null]:[t].concat(kwe(e.inputLength))}this.inputDim=e.inputDim,jwe(this.inputDim,"inputDim"),this.outputDim=e.outputDim,jwe(this.outputDim,"outputDim"),this.embeddingsInitializer=Q_e(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=kSe(e.embeddingsRegularizer),this.activityRegularizer=kSe(e.activityRegularizer),this.embeddingsConstraint=Vwe(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return Nfe(()=>this.maskZero?(e=wke(e),Mge(e,Jfe(e))):null)}computeOutputShape(e){if(e=_ke(e),null==this.inputLength)return[...e,this.outputDim];const t=kwe(this.inputLength);if(t.length!==e.length-1)throw new gwe(`"inputLength" is ${this.inputLength}, but received input shape has shape `+e);{let n=0;for(let r=0;r<t.length;++r){const i=t[r],a=e[r+1];if(null!=i&&null!=a&&i!==a)throw new gwe(`"inputLength" is ${this.inputLength}, but received input shape has shape `+e);null==i&&(t[n]=a),n++}}return[e[0],...t,this.outputDim]}call(e,t){return Nfe(()=>{this.invokeCallHook(e,t);let n=wke(e);return"int32"!==n.dtype&&(n=g_e(n,"int32")),T_e(this.embeddings.read(),n.as1D()).reshape(_ke(this.computeOutputShape(n.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:J_e(this.embeddingsInitializer),embeddingsRegularizer:wSe(this.embeddingsRegularizer),activityRegularizer:wSe(this.activityRegularizer),embeddingsConstraint:Hwe(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}vTe.className="Embedding",O.registerClass(vTe);class yTe extends Mke{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new vwe}computeElementwiseOpOutputShape(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;const n=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const i=e[e.length-t.length+r],a=t[r];if(null==i||null==a||i<0||a<0)n.push(null);else if(1===i)n.push(a);else if(1===a)n.push(i);else{if(i!==a)throw new gwe("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(i)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[_ke(e)]),(e=e).length<2)throw new gwe(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const i of e)null!=i&&null!==i[0]&&t.push(i[0]);if(t=Owe(t),t.length>1)throw new gwe(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let n=null==e[0]?null:e[0].slice(1);for(let i=1;i<e.length;++i){const t=null==e[i]?null:e[i].slice(1);n=this.computeElementwiseOpOutputShape(n,t)}const r=e.map(e=>e.length);this.reshapeRequired=-1!==e.indexOf(null)||1!==Owe(r).length}call(e,t){return Nfe(()=>{if(e=e,this.reshapeRequired){const t=[],n=e.map(e=>e.rank);if(-1===n.indexOf(null)){const r=p_e(n);for(let n of e){const e=n.rank;for(let t=0;t<r-e;++t)n=v_e(n,1);t.push(n)}return this.mergeFunction(t)}{let n=!1;for(const a of e){const e=a.rank;if(null==e){const e=a.shape,r=e[0],i=e.slice(1).concat([r]);let o=a.reshape([r].concat(d_e(e.slice(1))));o=Lhe(o,[1,0]),o=o.reshape(i),t.push(o),n=!0}else if(e>1){const r=m_e(1,e).concat([0]);t.push(Lhe(a,r)),n=!0}else t.push(a)}let r=this.mergeFunction(t);const i=r.rank;if(n)if(null==i){const e=r.shape,t=e[e.length-1],n=[t].concat(e.slice(0,e.length-1));r=Lhe(r.reshape([-1,t]),[1,0]).reshape(n)}else if(i>1){const e=[i-1].concat(m_e(0,i-1));r=Lhe(r,e)}return r}}return this.mergeFunction(e)})}computeOutputShape(e){let t;t=null==(e=e)[0]?null:e[0].slice(1);for(let r=1;r<e.length;++r){const n=null==e[r]?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,n)}let n=[];for(const r of e)null!=r&&null!==r[0]&&n.push(r[0]);return n=Owe(n),t=1===n.length?n.concat(t):[null].concat(t),t}computeMask(e,t){return Nfe(()=>{if(null==t)return null;if(!Array.isArray(t))throw new gwe("`mask` should be an Array");if(!Array.isArray(e))throw new gwe("`inputs` should be an Array");if(t.length!==e.length)throw new gwe(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(e=>null==e))return null;let n=(t=t.map(e=>null==e?e:Pme(e,0)))[0];for(let e=1;e<t.length-1;++e)n=vge(n,t[e]);return n})}}class bTe extends yTe{constructor(e){super(e)}mergeFunction(e){return Nfe(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=qfe(t,e[n]);return t})}}bTe.className="Add",O.registerClass(bTe);class xTe extends yTe{constructor(e){super(e)}mergeFunction(e){return Nfe(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=Xfe(t,e[n]);return t})}}xTe.className="Multiply",O.registerClass(xTe);class wTe extends yTe{constructor(e){super(e)}mergeFunction(e){return Nfe(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=qfe(t,e[n]);return Xfe(1/e.length,t)})}}wTe.className="Average",O.registerClass(wTe);class _Te extends yTe{constructor(e){super(e)}mergeFunction(e){return Nfe(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=ype(t,e[n]);return t})}}_Te.className="Maximum",O.registerClass(_Te);class kTe extends yTe{constructor(e){super(e)}mergeFunction(e){return Nfe(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=Tge(t,e[n]);return t})}}kTe.className="Minimum",O.registerClass(kTe);class ETe extends yTe{constructor(e){super(e),this.DEFAULT_AXIS=-1,null==e&&(e={}),this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new gwe("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(null!=r){t=!1;break}if(t)return;const n=[];for(let r=0;r<e.length;++r){const t=e[r].slice();t.splice(this.axis,1);let i=!1;for(const e of n)if(w.arraysEqual(e,t)){i=!0;break}i||n.push(t)}if(n.length>1)throw new gwe("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return Nfe(()=>w_e(e,this.axis))}computeOutputShape(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new gwe("A `Concatenate` layer should be called on a list of inputs.");const t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(const i of t.slice(1)){if(null==n[r]||null==i[r]){n[r]=null;break}n[r]+=i[r]}return n}computeMask(e,t){if(null==t)return null;if(!Array.isArray(t))throw new gwe("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new gwe("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new gwe(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return Nfe(()=>{let n=!0;if(t.forEach(e=>{null==e||(n=!1)}),n)return null;const r=[];for(let a=0;a<e.length;++a)r.push(null==t[a]?Fge(e[a]).asType("bool"):t[a].rank<e[a].rank?Pme(t[a],-1):t[a]);const i=Zpe(r,this.axis);return Tpe(i,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function STe(e,t){for(;e<0;)e+=t;return e}ETe.className="Concatenate",O.registerClass(ETe);class TTe extends yTe{constructor(e){super(e),this.axes=e.axes,this.normalize=null!=e.normalize&&e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){w.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],n=e[1];if(t.length>3||n.length>3)throw new vwe("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new gwe(`Dimension incompatibility: ${t[r[0]]} !== ${n[r[1]]}`)}mergeFunction(e){if(2!==e.length)throw new gwe(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((t,n)=>STe(t,e[n].shape.length)):[STe(this.axes,n.shape.length),STe(this.axes,r.shape.length)],this.normalize&&(n=Gke(n,t[0]),r=Gke(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new vwe("batchDot is not implemented for tensors of 4D or higher rank yet");if(w.assert(e.shape.length>=2,()=>"batchDot requires the rank of x to be >= 2, but got "+e.shape.length),w.assert(e.shape.length>=2,()=>"batchDot requires the rank of y to be >= 2, but got "+t.shape.length),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new vwe("batchDot is not implemented for complex64-type Tensors yet.");const r=e.shape.length,i=t.shape.length;null==n&&(n=[r-1,i-2]);const a=n;return Nfe(()=>{let n,o;if(r>i){n=r-i;const e=[];for(let t=0;t<n;++t)e.push(1);t=t.reshape(t.shape.concat(e))}else if(i>r){n=i-r;const t=[];for(let e=0;e<n;++e)t.push(1);e=e.reshape(e.shape.concat(t))}else n=0;if(o=2===e.shape.length&&2===t.shape.length?a[0]===a[1]?e.mul(t).sum(a[0]):e.transpose([1,0]).mul(t).sum(a[1]):e.matMul(t,a[0]!==e.shape.length-1,a[1]===t.shape.length-1),n>0){let e;e=r>i?r+i-3:r-1;const t=[];for(let r=e;r<e+n;++r)t.push(r);o=o.squeeze(t)}return 1===o.shape.length&&(o=o.expandDims(1)),o})}(n,r,t)}interpretAxes(e,t){let n;return n=Array.isArray(this.axes)?this.axes:[STe(this.axes,e.length),STe(this.axes,t.length)],n}computeOutputShape(e){w.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new vwe("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);const i=t.concat(n);return 1===i.length&&i.push(1),i}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}TTe.className="Dot",O.registerClass(TTe);class CTe extends Mke{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return Nfe(()=>{this.invokeCallHook(e,t);const n=wke(e);return D_e(()=>E_e(n.shape,0,this.stddev).add(n),()=>n,t.training||!1)})}}CTe.className="GaussianNoise",O.registerClass(CTe);class ITe extends Mke{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return Nfe(()=>{this.invokeCallHook(e,t);const n=wke(e);return this.rate>0&&this.rate<1?D_e(()=>{const e=Math.sqrt(this.rate/(1-this.rate));return n.mul(E_e(n.shape,1,e))},()=>n,t.training||!1):n})}}ITe.className="GaussianDropout",O.registerClass(ITe);class ATe extends Mke{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||wke(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return Nfe(()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(e);return D_e(()=>{const t=wke(e),r=-1.7580993408473766;let i=Wme(Qge(n),this.rate);i=g_e(i,"float32");const a=((1-this.rate)*(1+this.rate*r**2))**-.5,o=-a*r*this.rate;return t.mul(i).add(i.add(-1).mul(r)).mul(a).add(o)},()=>wke(e),t.training||!1)}return e})}}function OTe(e,t,n,r,i,a=.001){let o;if(2===e.rank)o=ime(e,t,n,r,i,a);else if(3===e.rank)o=ame(e,t,n,r,i,a);else{if(4!==e.rank)throw new vwe(`batchNormalization is not implemented for array of rank ${e.rank} yet`);o=ome(e,t,n,r,i,a)}return o}ATe.className="AlphaDropout",O.registerClass(ATe);class DTe extends Mke{constructor(e){null==e&&(e={}),super(e),this.supportsMasking=!0,this.axis=null==e.axis?-1:e.axis,this.momentum=null==e.momentum?.99:e.momentum,this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=Q_e(e.betaInitializer||"zeros"),this.gammaInitializer=Q_e(e.gammaInitializer||"ones"),this.movingMeanInitializer=Q_e(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Q_e(e.movingVarianceInitializer||"ones"),this.betaConstraint=Vwe(e.betaConstraint),this.gammaConstraint=Vwe(e.gammaConstraint),this.betaRegularizer=kSe(e.betaRegularizer),this.gammaRegularizer=kSe(e.gammaRegularizer)}build(e){e=_ke(e);const t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new gwe(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape `+JSON.stringify(e)+".");this.inputSpec=[new Cke({ndim:e.length,axes:{[t]:n}})];const r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return Nfe(()=>{const n=null!=t.training&&t.training,r=wke(e),i=r.shape,a=i.length,o=m_e(0,a),s=this.axis>=0?this.axis:this.axis+a;o.splice(s,1);const l=bwe(1,a);l[s]=i[s];const u=o.slice();u.sort();const c=!w.arraysEqual(u,m_e(0,a).slice(0,a-1));if(!n)return(()=>{if(c){const e=this.movingMean.read().reshape(l),t=this.movingVariance.read().reshape(l),n=this.center?this.beta.read().reshape(l):null,i=this.scale?this.gamma.read().reshape(l):null;return OTe(r,e,t,n,i,this.epsilon)}return OTe(r,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[d,h,f]=function(e,t,n,r,i=.001){return w.arraysEqual(r.slice().sort(),m_e(0,e.rank-1))?function(e,t,n,r,i=.001){return Nfe(()=>{const a=Age(e,r),o=a.mean,s=a.variance;return[OTe(e,o,s,n,t,i),o,s]})}(e,t,n,r,i):function(e,t,n,r,i=.001){return Nfe(()=>{const a=Age(e,r),o=a.mean,s=a.variance,l=[];for(const t of m_e(0,e.rank))-1!==r.indexOf(t)?l.push(1):l.push(e.shape[t]);const u=o.reshape(l),c=s.reshape(l),d=null==t?null:t.reshape(l),h=null==n?null:n.reshape(l);return[OTe(e,u,c,h,d,i),o,s]})}(e,t,n,r,i)}(r,this.gamma.read(),this.beta.read(),o,this.epsilon),p=(e,t,n)=>{Nfe(()=>{const r=1-n,i=e.read(),a=i.sub(t).mul(r);e.write(i.sub(a))})};return(()=>{p(this.movingMean,h,this.momentum),p(this.movingVariance,f,this.momentum)})(),d})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:J_e(this.betaInitializer),gammaInitializer:J_e(this.gammaInitializer),movingMeanInitializer:J_e(this.movingMeanInitializer),movingVarianceInitializer:J_e(this.movingVarianceInitializer),betaRegularizer:wSe(this.betaRegularizer),gammaRegularizer:wSe(this.gammaRegularizer),betaConstraint:Hwe(this.betaConstraint),gammaConstraint:Hwe(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}DTe.className="BatchNormalization",O.registerClass(DTe);class MTe extends Mke{constructor(e){if(null==e&&(e={}),super(e),this.axis=null==e.axis?-1:e.axis,"number"==typeof this.axis){if(!Number.isInteger(this.axis))throw new Error("Expected axis to be an integer, but received "+this.axis)}else{if(!Array.isArray(this.axis))throw new Error("Expected axis to be an integer or an array of integers, but received "+JSON.stringify(this.axis));for(const e of this.axis)if(!Number.isInteger(e))throw new Error("Expected axis to be an array of integers, but received "+JSON.stringify(this.axis))}this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=Q_e(e.betaInitializer||"zeros"),this.gammaInitializer=Q_e(e.gammaInitializer||"ones"),this.betaRegularizer=kSe(e.betaRegularizer),this.gammaRegularizer=kSe(e.gammaRegularizer),this.supportsMasking=!0}build(e){const t=(e=_ke(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(let r=0;r<this.axis.length;++r)this.axis[r]<0&&(this.axis[r]+=t);for(const r of this.axis)if(r<0||r>=t)throw new Error("Invalid axis: "+r);if(this.axis.length!==Owe(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);const n=this.axis.map(t=>e[t]);this.gamma=this.scale?this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,!0):null,this.beta=this.center?this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,!0):null,this.built=!0}call(e,t){const n=wke(e),r=n.shape,i=r.length;return Nfe(()=>{let{mean:e,variance:t}=Age(n,this.axis,!0);const a=bwe(1,i);for(const n of this.axis)a[n]=r[n];const o=e=>null!=e&&e.shape.length!==i&&this.axis!==[i-1]?e.reshape(a):e;let s=o(this.gamma.read()),l=o(this.beta.read());const u=[],c=[];for(let n=0;n<i;++n)-1!==this.axis.indexOf(n)?(u.push(r[n]),c.push(1)):(u.push(1),c.push(r[n]));return e=e.tile(u),t=t.tile(u),s=s.tile(c),l=l.tile(c),OTe(n,e,t,l,s,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:J_e(this.betaInitializer),gammaInitializer:J_e(this.gammaInitializer),betaRegularizer:wSe(this.betaRegularizer),gammaRegularizer:wSe(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}MTe.className="LayerNormalization",O.registerClass(MTe);class NTe extends Mke{constructor(e){if(null==e&&(e={}),super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)this.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new gwe(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,n;if("number"==typeof e.padding[0])t=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new gwe(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],2!==e.padding[1].length)throw new gwe(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);n=e.padding[1]}this.padding=[t,n]}this.inputSpec=[new Cke({ndim:4})]}computeOutputShape(e){let t,n;return e=_ke(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}call(e,t){return Nfe(()=>{return t=wke(e),n=this.padding,r=this.dataFormat,Nfe(()=>{if(4!==t.rank)throw new gwe("temporalPadding expects input tensor to be 4-D, but received a "+t.rank+"-D tensor.");if(null==n&&(n=[[1,1],[1,1]]),2!==n.length||2!==n[0].length||2!==n[1].length)throw new gwe("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==r&&(r="channelsLast"),"channelsLast"!==r&&"channelsFirst"!==r)throw new gwe(`Unknown data format: ${r}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let e;return e="channelsFirst"===r?[[0,0],[0,0],n[0],n[1]]:[[0,0],n[0],n[1],[0,0]],Pge(t,e)});var t,n,r})}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}function jTe(e,t,n,r,i,a){return Nfe(()=>{let o;n_e(i),i_e(a),r_e(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==a&&(a="max"),e=NSe(e,i);const s="same"===r?"same":"valid";return o="max"===a?wge(e,t,n,s):Xpe(e,t,n,s),"channelsFirst"===i&&(o=Lhe(o,[0,3,1,2])),o})}function FTe(e,t,n,r,i,a){return Nfe(()=>{let o;n_e(i),i_e(a),r_e(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==a&&(a="max"),e=jSe(e,i);const s="same"===r?"same":"valid";return o="max"===a?_ge(e,t,n,s):Kpe(e,t,n,s),"channelsFirst"===i&&(o=Lhe(o,[0,4,1,2,3])),o})}NTe.className="ZeroPadding2D",O.registerClass(NTe);class RTe extends Mke{constructor(e){if(null==e.poolSize&&(e.poolSize=2),super(e),"number"==typeof e.poolSize)this.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new gwe("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.poolSize));this.poolSize=e.poolSize}if(jwe(this.poolSize,"poolSize"),null==e.strides)this.strides=this.poolSize;else if("number"==typeof e.strides)this.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new gwe("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.strides));this.strides=e.strides}jwe(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,r_e(this.padding),this.inputSpec=[new Cke({ndim:3})]}computeOutputShape(e){const t=DSe((e=_ke(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return Nfe(()=>{this.invokeCallHook(e,t),e=v_e(wke(e),2);const n=this.poolingFunction(wke(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Ave(n,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class PTe extends RTe{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return n_e(i),r_e(r),jTe(e,t,n,r,i,"max")}}PTe.className="MaxPooling1D",O.registerClass(PTe);class LTe extends RTe{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return n_e(i),r_e(r),jTe(e,t,n,r,i,"avg")}}LTe.className="AveragePooling1D",O.registerClass(LTe);class BTe extends Mke{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new gwe("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+e.strides.length+".");this.strides=e.strides}else this.strides=[e.strides,e.strides];jwe(this.poolSize,"poolSize"),jwe(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,n_e(this.dataFormat),r_e(this.padding),this.inputSpec=[new Cke({ndim:4})]}computeOutputShape(e){e=_ke(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=DSe(t,this.poolSize[0],this.padding,this.strides[0]),n=DSe(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return Nfe(()=>(this.invokeCallHook(e,t),this.poolingFunction(wke(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class $Te extends BTe{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return n_e(i),r_e(r),jTe(e,t,n,r,i,"max")}}$Te.className="MaxPooling2D",O.registerClass($Te);class zTe extends BTe{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return n_e(i),r_e(r),jTe(e,t,n,r,i,"avg")}}zTe.className="AveragePooling2D",O.registerClass(zTe);class UTe extends Mke{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new gwe("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+e.strides.length+".");this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];jwe(this.poolSize,"poolSize"),jwe(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,n_e(this.dataFormat),r_e(this.padding),this.inputSpec=[new Cke({ndim:5})]}computeOutputShape(e){e=_ke(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=DSe(t,this.poolSize[0],this.padding,this.strides[0]),n=DSe(n,this.poolSize[1],this.padding,this.strides[1]),r=DSe(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}call(e,t){return Nfe(()=>(this.invokeCallHook(e,t),this.poolingFunction(wke(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class HTe extends UTe{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return n_e(i),r_e(r),FTe(e,t,n,r,i,"max")}}HTe.className="MaxPooling3D",O.registerClass(HTe);class WTe extends UTe{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return n_e(i),r_e(r),FTe(e,t,n,r,i,"avg")}}WTe.className="AveragePooling3D",O.registerClass(WTe);class VTe extends Mke{constructor(e){super(e),this.inputSpec=[new Cke({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new vwe}}class qTe extends VTe{constructor(e){super(e||{})}call(e,t){return Nfe(()=>{const t=wke(e);return Ege(t,1)})}}qTe.className="GlobalAveragePooling1D",O.registerClass(qTe);class GTe extends VTe{constructor(e){super(e||{})}call(e,t){return Nfe(()=>{const t=wke(e);return age(t,1)})}}GTe.className="GlobalMaxPooling1D",O.registerClass(GTe);class YTe extends Mke{constructor(e){super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,n_e(this.dataFormat),this.inputSpec=[new Cke({ndim:4})]}computeOutputShape(e){return e=e,"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new vwe}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class XTe extends YTe{call(e,t){return Nfe(()=>{const t=wke(e);return Ege(t,"channelsLast"===this.dataFormat?[1,2]:[2,3])})}}XTe.className="GlobalAveragePooling2D",O.registerClass(XTe);class KTe extends YTe{call(e,t){return Nfe(()=>{const t=wke(e);return age(t,"channelsLast"===this.dataFormat?[1,2]:[2,3])})}}KTe.className="GlobalMaxPooling2D",O.registerClass(KTe);class ZTe extends Mke{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(e){null!=this.layer&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,n={}){const r=qke(t.layer,n);delete t.layer;const i={layer:r};return Object.assign(i,t),new e(i)}}class JTe extends ZTe{constructor(e){super(e),this.supportsMasking=!0}build(e){if((e=_ke(e)).length<3)throw new gwe("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(e));this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){const t=[(e=_ke(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t);return[n[0],e[1]].concat(n.slice(1))}call(e,t){return Nfe(()=>YSe((e,n)=>[wke(this.layer.call(e,t)),[]],e=wke(e),[],!1,null,null,!1,!0)[1])}}JTe.className="TimeDistributed",O.registerClass(JTe);class QTe extends ZTe{constructor(e){super(e);const t=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=t,this.forwardLayer=qke(n),t.goBackwards=!0!==t.goBackwards;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=qke(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,Mwe(e_e,"BidirectionalMergeMode",this.mergeMode),e.weights)throw new vwe("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=Math.floor(e.length/2);this.forwardLayer.setWeights(e.slice(0,t)),this.backwardLayer.setWeights(e.slice(t))}computeOutputShape(e){let t,n,r,i=this.forwardLayer.computeOutputShape(e);return Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),i=i,this.returnState?(r=i.slice(1),t=i[0]):t=i[0],t=t,"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):_we(n)}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const i=GSe(e,n,r,this.numConstants);if(e=i.inputs,n=i.initialState,r=i.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(null==n||0===n.length)&&null==r)return super.apply(e,t);const a=[],o=[];if(null!=n){const e=n.length;if(e%2>0)throw new gwe("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,a.push(...n);const r=n.map(e=>new Cke({shape:e.shape}));this.forwardLayer.stateSpec=r.slice(0,e/2),this.backwardLayer.stateSpec=r.slice(e/2),o.push(...r)}if(null!=r)throw new vwe("Support for constants in Bidirectional layers is not implemented yet.");const s=a[0]instanceof Ike;for(const l of a)if(l instanceof Ike!==s)throw new gwe("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(s){const n=[e].concat(a),r=this.inputSpec.concat(o),i=this.inputSpec;this.inputSpec=r;const s=super.apply(n,t);return this.inputSpec=i,s}return super.apply(e,t)}call(e,t){return Nfe(()=>{const n=t.initialState;let r,i,a,o;if(null==n)r=this.forwardLayer.call(e,t),i=this.backwardLayer.call(e,t);else{const a=n.slice(0,n.length/2),o=n.slice(n.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:a})),i=this.backwardLayer.call(e,Object.assign(t,{initialState:o}))}return this.returnState&&(Array.isArray(r)&&(a=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=ave(i,1)),"concat"===this.mergeMode?o=w_e([r,i]):"sum"===this.mergeMode?o=qfe(r,i):"ave"===this.mergeMode?o=Xfe(.5,qfe(r,i)):"mul"===this.mergeMode?o=Xfe(r,i):null==this.mergeMode&&(o=[r,i]),this.returnState?null==this.mergeMode?o.concat(a):[o].concat(a):o})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){o_e(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),o_e(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){let n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){const e=this.forwardLayer.states.map(e=>null);return Array.isArray(n)?n.concat(e).concat(e):[n].concat(e).concat(e)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const n=qke(t.layer);if(delete t.layer,null!=t.numConstants)throw new vwe("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=n,new e(r)}}function eCe(e){return new Nke(e)}function tCe(e){return new CSe(e)}function nCe(e){return new ESe(e)}function rCe(e){return new SSe(e)}function iCe(e){return new TSe(e)}function aCe(e){return new ASe(e)}function oCe(e){return new ISe(e)}function sCe(e){return new HSe(e)}function lCe(e){return new LSe(e)}function uCe(e){return new $Se(e)}function cCe(e){return new BSe(e)}function dCe(e){return new USe(e)}function hCe(e){return new WSe(e)}function fCe(e){return new VSe(e)}function pCe(e){return new qSe(e)}function mCe(e){return new hTe(e)}function gCe(e){return new cTe(e)}function vCe(e){return new lTe(e)}function yCe(e){return new uTe(e)}function bCe(e){return new dTe(e)}function xCe(e){return new fTe(e)}function wCe(e){return new pTe(e)}function _Ce(e){return new mTe(e)}function kCe(e){return new vTe(e)}function ECe(e){return new bTe(e)}function SCe(e){return new wTe(e)}function TCe(e){return new ETe(e)}function CCe(e){return new _Te(e)}function ICe(e){return new kTe(e)}function ACe(e){return new xTe(e)}function OCe(e){return new TTe(e)}function DCe(e){return new DTe(e)}function MCe(e){return new MTe(e)}function NCe(e){return new NTe(e)}function jCe(e){return new LTe(e)}function FCe(e){return jCe(e)}function RCe(e){return jCe(e)}function PCe(e){return new zTe(e)}function LCe(e){return PCe(e)}function BCe(e){return PCe(e)}function $Ce(e){return new WTe(e)}function zCe(e){return $Ce(e)}function UCe(e){return $Ce(e)}function HCe(e){return new qTe(e)}function WCe(e){return new XTe(e)}function VCe(e){return new GTe(e)}function qCe(e){return new KTe(e)}function GCe(e){return new PTe(e)}function YCe(e){return new $Te(e)}function XCe(e){return new HTe(e)}function KCe(e){return new eTe(e)}function ZCe(e){return new QSe(e)}function JCe(e){return new nTe(e)}function QCe(e){return new tTe(e)}function eIe(e){return new JSe(e)}function tIe(e){return new ZSe(e)}function nIe(e){return new sTe(e)}function rIe(e){return new oTe(e)}function iIe(e){return new XSe(e)}function aIe(e){return new rTe(e)}function oIe(e){return new QTe(e)}function sIe(e){return new JTe(e)}QTe.className="Bidirectional",O.registerClass(QTe);const lIe=VCe,uIe=qCe,cIe=GCe,dIe=YCe;function hIe(e){return new CTe(e)}function fIe(e){return new ITe(e)}function pIe(e){return new ATe(e)}function mIe(e){return new gTe(e)}function gIe(e,t){return rEe(e,t)}function vIe(e,t){return sEe(e,t)}function yIe(e,t){return lEe(e,t)}function bIe(e,t){return iEe(e,t)}function xIe(e,t){return uEe(e,t)}function wIe(e,t){return oEe(e,t)}function _Ie(e,t){return function(e,t){return Nfe(()=>{const n=aEe(e,t),r=function(e,t){return Nfe(()=>vge(e.equal(1),t.equal(0)).sum().cast("float32"))}(e,t),i=n.add(r);return Dme(Hme(i,0),n.div(i),0).cast("float32")})}(e,t)}function kIe(e,t){return eEe(e,t)}function EIe(e,t){return Xke(e,t)}function SIe(e,t){return Kke(e,t)}function TIe(e,t){return Kke(e,t)}function CIe(e,t){return Kke(e,t)}function IIe(e,t){return Yke(e,t)}function AIe(e,t){return Yke(e,t)}function OIe(e,t){return Yke(e,t)}function DIe(e){return new bSe(e)}function MIe(e){return vSe(t=e),new bSe({l1:null!=t?t.l1:null,l2:0});var t}function NIe(e){return vSe(t=e),new bSe({l2:null!=t?t.l2:null,l1:0});var t}class jIe extends Lke{constructor(){super(...arguments),this.model=null}setModel(e){if(!(e instanceof VEe))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}function FIe(e,t){return e<t}function RIe(e,t){return e>t}class PIe extends jIe{constructor(e){if(super(),null==e&&(e={}),e.restoreBestWeights)throw new vwe("restoreBestWeights = True is not implemented in EarlyStopping yet.");this.monitor=e.monitor||"val_loss",this.minDelta=Math.abs(e.minDelta||0),this.patience=e.patience||0,this.verbose=e.verbose||0,this.mode=e.mode||"auto",this.baseline=e.baseline,-1===["auto","min","max"].indexOf(this.mode)&&(console.warn(`EarlyStopping mode '${this.mode}' is invalid. Falling back to mode 'auto'.`),this.mode="auto"),this.monitorFunc="min"===this.mode?FIe:"max"===this.mode||-1!==this.monitor.indexOf("acc")?RIe:FIe,this.monitorFunc===FIe&&(this.minDelta*=-1)}async onTrainBegin(e){this.wait=0,this.stoppedEpoch=0,this.best=null!=this.baseline?this.baseline:this.monitorFunc===FIe?1/0:-1/0}async onEpochEnd(e,t){await Fke(t);const n=this.getMonitorValue(t);null!=n&&(this.monitorFunc(n-this.minDelta,this.best)?(this.best=n,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=e,this.model.stopTraining=!0)))}async onTrainEnd(e){this.stoppedEpoch>0&&this.verbose&&console.log(`Epoch ${this.stoppedEpoch}: early stopping.`)}getMonitorValue(e){null==e&&(e={});const t=e[this.monitor];return null==t&&console.warn(`Metric for EarlyStopping ${this.monitor} is not available. Available metrics are: `+Object.keys(e)),t}}const LIe={earlyStopping:function(e){return new PIe(e)}};var BIe,$Ie;!function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(BIe||(BIe={})),function(e){let t;!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}($Ie||($Ie={}));const zIe={};function UIe(e,t){zIe[e]={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t}}function HIe(e){return zIe[e]}function WIe(e){delete zIe[e]}function VIe(e,t,n,r,i){const a=t.inputParams[e];if(a&&void 0!==a.inputIndexStart){const e=a.inputIndexStart,o=0===a.inputIndexEnd?void 0:void 0===a.inputIndexEnd?e+1:a.inputIndexEnd;if("tensor"===a.type)return qIe(t.inputNames[a.inputIndexStart],n,r,i);if("tensors"===a.type)return t.inputNames.slice(e,o).map(e=>qIe(e,n,r,i));const s=qIe(t.inputNames.slice(e)[0],n,r,i),l=s.dataSync();return"number"===a.type?l[0]:w.toNestedArray(s.shape,l)}const o=t.attrParams[e];return o&&o.value}function qIe(e,t,n,r){const[i,a]=XIe(e);if(null!=r){const e=r.getHashTableHandleByName(i);if(null!=e)return e}const o=n.currentContextIds.find(e=>!!t[YIe(i,e)]);return void 0!==o?t[YIe(i,o)][a]:void 0}function GIe(e,t){const[n,r]=XIe(e);return[YIe(n,t&&t.currentContextId),r]}function YIe(e,t){return t?`${e}-${t}`:e}function XIe(e){const t=e.split(":");return 1===t.length?[e,0]:[t[0],Number(t[t.length-1])]}function KIe(e,t,n){let r=VIe("pad",e,t,n);if("explicit"===r){r=VIe("explicitPaddings",e,t,n);const i=[[0,0],[0,0],[0,0],[0,0]];for(let e=0;e<4;e++)i[e][0]=r[2*e],i[e][1]=r[2*e+1];return i}return r}function ZIe(e){return e.kept?e:vhe(e)}const JIe=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],QIe=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],eAe=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]}],tAe=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],nAe=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],rAe=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],iAe=[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],aAe=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],oAe=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]}],sAe=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}],lAe=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],uAe=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],cAe=[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],dAe=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],hAe=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],fAe=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],pAe=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]}];class mAe{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[].concat(...[U,H,W,V,q,G,Y,J,Z,X,Q,ee,te,ne,re,ie,K].map(e=>e.json));this.opMappers=e.reduce((e,t)=>(e[t.tfOpName]=t,e),{})}transformGraph(e,t={}){const n=[],r=[],i=[],a=e.node.reduce((e,t)=>(e[t.name]=this.mapNode(t),t.op.startsWith("Placeholder")?n.push(e[t.name]):"Const"===t.op?r.push(e[t.name]):null!=t.input&&0!==t.input.length||i.push(e[t.name]),e),{});let o=[];const s=[];let l={},u={};null!=t&&(l=this.mapSignatureEntries(t.inputs),u=this.mapSignatureEntries(t.outputs));const c=Object.keys(a);c.forEach(e=>{const t=a[e];t.inputNames.forEach(e=>{const[n]=GIe(e);t.inputs.push(a[n]),a[n].children.push(t)})}),0===Object.keys(u).length?c.forEach(e=>{const t=a[e];0===t.children.length&&s.push(t)}):Object.keys(u).forEach(e=>{const[t]=GIe(e),n=a[t];null!=n&&(n.signatureKey=u[e],s.push(n))}),Object.keys(l).length>0?Object.keys(l).forEach(e=>{const[t]=GIe(e),n=a[t];n&&(n.signatureKey=l[e],o.push(n))}):o=n;let d={};null!=e.library&&null!=e.library.function&&(d=e.library.function.reduce((e,t)=>(e[t.signature.name]=this.mapFunction(t),e),{}));const h={nodes:a,inputs:o,outputs:s,weights:r,placeholders:n,signature:t,functions:d};return i.length>0&&(h.initNodes=i),h}mapSignatureEntries(e){return Object.keys(e||{}).reduce((t,n)=>(t[e[n].name]=n,t),{})}mapNode(e){const t=HIe(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});const n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(e=>e.startsWith("^")?e.substr(1):e),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((e,t)=>(e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((t,n)=>{const r=n.type;let i=void 0;switch(n.type){case"string":i=vAe(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=vAe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":i=CAe(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=CAe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":i=bAe(e.attr,n.tfName,n.defaultValue||0),void 0===i&&n.tfDeprecatedName&&(i=bAe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":i=TAe(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=TAe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":i=yAe(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=yAe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":i=AAe(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=AAe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":i=SAe(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=SAe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":i=IAe(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=IAe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":i=_Ae(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=_Ae(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":i=kAe(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=kAe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":i=wAe(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=wAe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${e.op}`)}return t[n.name]={value:i,type:r},t},{})),n}mapFunction(e){const t=e.nodeDef,n=[];let r={};null!=t&&(r=t.reduce((e,t)=>(e[t.name]=this.mapNode(t),"Const"===t.op&&n.push(e[t.name]),e),{}));const i=[],a=[];e.signature.inputArg.forEach(e=>{const[t]=GIe(e.name),n={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:xAe(e.type),type:"dtype"}},children:[]};n.signatureKey=e.name,i.push(n),r[t]=n}),Object.keys(r).forEach(e=>{const t=r[e];t.inputNames.forEach(e=>{const[n]=GIe(e);t.inputs.push(r[n]),r[n].children.push(t)})});const o=e.ret;e.signature.outputArg.forEach(e=>{const[t,n]=GIe(o[e.name]),i=r[t];null!=i&&(i.defaultOutput=n,a.push(i))});const s=this.mapArgsToSignature(e);return{nodes:r,inputs:i,outputs:a,weights:n,placeholders:[],signature:s}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((e,t)=>(e[t.name]=this.mapArgToTensorInfo(t),e),{}),outputs:e.signature.outputArg.reduce((t,n)=>(t[n.name]=this.mapArgToTensorInfo(n,e.ret),t),{})}}mapArgToTensorInfo(e,t){let n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}function gAe(e,t){const n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){const t=xse().global;if(void 0!==t.atob)return t.atob(e);if("undefined"!=typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function vAe(e,t,n,r=!1){const i=e[t];return null!=i?gAe(i.s,r):n}function yAe(e,t,n){const r=e[t];return r?r.b:n}function bAe(e,t,n){const r=e[t]||{},i=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof i?i:parseInt(i,10)}function xAe(e){switch("string"==typeof e&&(e=BIe[e]),e){case BIe.DT_FLOAT:return"float32";case BIe.DT_INT32:case BIe.DT_INT64:case BIe.DT_INT8:case BIe.DT_UINT8:return"int32";case BIe.DT_BOOL:return"bool";case BIe.DT_DOUBLE:return"float32";case BIe.DT_STRING:return"string";default:return null}}function wAe(e,t,n){const r=e[t];return r&&r.func?r.func.name:n}function _Ae(e,t,n){const r=e[t];return r&&r.type?xAe(r.type):n}function kAe(e,t,n){const r=e[t];return r&&r.list&&r.list.type?r.list.type.map(e=>xAe(e)):n}function EAe(e){if(!e.unknownRank)return null!=e.dim?e.dim.map(e=>"number"==typeof e.size?e.size:parseInt(e.size,10)):[]}function SAe(e,t,n){const r=e[t];return r&&r.shape?EAe(r.shape):n}function TAe(e,t,n){const r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(e=>"number"==typeof e?e:parseInt(e,10)):n}function CAe(e,t,n,r=!1){const i=e[t];return i&&i.list&&i.list.s?i.list.s.map(e=>gAe(e,r)):n}function IAe(e,t,n){const r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map(e=>EAe(e)):n}function AAe(e,t,n){const r=e[t];return r&&r.list&&r.list.b?r.list.b:n}class OAe{constructor(e,t,n){this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(e=>this.getInput(e)),null!=e.rawAttrs&&(this.attrs=Object.keys(e.rawAttrs).reduce((e,t)=>(e[t]=this.getAttr(t),e),{}))}getInput(e){return qIe(e,this.tensorMap,this.context)}getAttr(e,t){const n=this.node.rawAttrs[e];if(null!=n.tensor)return qIe(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return bAe(this.node.rawAttrs,e,t);if(null!=n.s)return vAe(this.node.rawAttrs,e,t);if(null!=n.b)return yAe(this.node.rawAttrs,e,t);if(null!=n.shape)return SAe(this.node.rawAttrs,e,t);if(null!=n.type)return _Ae(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return TAe(this.node.rawAttrs,e,t);if(null!=n.list.s)return CAe(this.node.rawAttrs,e,t);if(null!=n.list.shape)return IAe(this.node.rawAttrs,e,t);if(null!=n.list.b)return AAe(this.node.rawAttrs,e,t);if(null!=n.list.type)return kAe(this.node.rawAttrs,e,t)}return t}}function DAe(e,t,n=""){w.assert(function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(-1!==e[n]&&-1!==t[n]&&e[n]!==t[n])return!1;return!0}(e,t),()=>n+` Shapes ${e} and ${t} must match`)}class MAe{constructor(e,t,n,r,i,a,o){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=i,this.dynamicSize=a,this.clearAfterRead=o,this.tensors=[],this.closed_=!1,this.idTensor=ope(0),Ffe(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(t=>{null!=e&&e.has(t.tensor.id)||t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const t=this.tensors[e];if(t.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map(e=>this.read(e))}write(e,t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},\n          because the value dtype is ${t.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),DAe(this.elementShape,t.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);n.tensor=t,Ffe(t),n.written=!0,this.tensors[e]=n}writeMany(e,t){if(e.length!==t.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${t.length}.`);e.forEach((e,n)=>this.write(e,t[n]))}gather(e,t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${t}`);if(e)e=e.slice(0,this.size());else{e=[];for(let t=0;t<this.size();t++)e.push(t)}if(0===e.length)return kde([],[0].concat(this.elementShape));const n=this.readMany(e);return DAe(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),Ove(n,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(0===this.size())return kde([],[0].concat(this.elementShape));const t=[];for(let r=0;r<this.size();r++)t.push(r);const n=this.readMany(t);return DAe(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),Zpe(n,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const n=Math.max(...e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(e,Hve(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);let n=0;const r=e.map(e=>(n+=e,n));if(n!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${t.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const i=0===n?0:t.size/n,a=[];Nfe(()=>{t=Ype(t,[1,n,i]);for(let n=0;n<e.length;++n)a[n]=Ype(Qpe(t,[0,0===n?0:r[n-1],0],[1,e[n],i]),this.elementShape);return a});const o=[];for(let s=0;s<e.length;s++)o[s]=s;this.writeMany(o,a)}}class NAe{constructor(e,t,n,r=-1){this.tensors=e,this.elementShape=t,this.elementDtype=n,null!=e&&e.forEach(e=>{if(n!==e.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${e.dtype}`);DAe(t,e.shape,"TensorList shape mismatch: "),Ffe(e)}),this.idTensor=ope(0),this.maxNumElements=r,Ffe(this.idTensor)}get id(){return this.idTensor.id}copy(){return new NAe([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(t=>{null!=e&&e.has(t.id)||t.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t,n=-1){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);return DAe(e,this.elementShape,"TensorList shape mismatch: "),Nfe(()=>{const t=this.tensors.map(t=>Ype(t,e));return Ove(t,0)})}popBack(e,t){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=this.tensors.pop();return DAe(n.shape,e,"TensorList shape mismatch: "),Ype(n,e)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(DAe(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Ffe(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: "+e);if(-1!==this.maxNumElements&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);this.tensors.length=e}getItem(e,t,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[e])throw new Error(`element at index ${e} is null.`);return DAe(this.tensors[e].shape,t,"TensorList shape mismatch: "),this.tensors[e]}setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);DAe(this.elementShape,t.shape,"TensorList shape mismatch: "),Ffe(t),this.tensors[e]=t}gather(e,t,n){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);return DAe(this.elementShape,n,"TensorList shape mismatch: "),0===(e=e.slice(0,this.size())).length?kde([],[0].concat(this.elementShape)):Nfe(()=>{const t=e.map(e=>Ype(this.tensors[e],n));return Ove(t,0)})}concat(e,t){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);return DAe(this.elementShape,t,"TensorList shape mismatch: "),0===this.size()?kde([],[0].concat(this.elementShape)):Nfe(()=>{const e=this.tensors.map(e=>Ype(e,t));return Zpe(e,0)})}}function jAe(e,t,n){const[r,i]=VIe("fusedOps",e,t,n),a="biasadd"===r,o="prelu"===i,s="fusedbatchnorm"===r,l=VIe("numArgs",e,t,n);if(a){if(o&&2!==l)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&1!==l)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(s)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");const u=VIe("strides",e,t,n),c=KIe(e,t,n),d=VIe("dataFormat",e,t,n).toUpperCase(),h=VIe("dilations",e,t,n),[f,p]=VIe("args",e,t,n);return{stride:u,pad:c,dataFormat:d,dilations:h,biasArg:f,preluArg:p,activationFunc:i,leakyreluAlpha:VIe("leakyreluAlpha",e,t,n)}}function FAe(e,t,n){return{boxes:VIe("boxes",e,t,n),scores:VIe("scores",e,t,n),maxOutputSize:VIe("maxOutputSize",e,t,n),iouThreshold:VIe("iouThreshold",e,t,n),scoreThreshold:VIe("scoreThreshold",e,t,n),softNmsSigma:VIe("softNmsSigma",e,t,n)}}class RAe{constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=ope(0),this.tensorMap=new Map,Ffe(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}async import(e,t){this.checkKeyAndValueTensor(e,t);const n=await e.data();return this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),Nfe(()=>{const e=Hve(t),r=n.length,i=e.length;w.assert(r===i,()=>`The number of elements doesn't match, keys has ${r} elements, the values has ${i} elements.`);for(let t=0;t<r;t++){const r=n[t],i=e[t];Ffe(i),this.tensorMap.set(r,i)}return this.handle})}async find(e,t){this.checkKeyAndValueTensor(e,t);const n=await e.data();return Nfe(()=>{const e=[];for(let r=0;r<n.length;r++){const i=this.findWithDefault(n[r],t);e.push(i)}return Ove(e)})}findWithDefault(e,t){const n=this.tensorMap.get(e);return null!=n?n:t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got `+e.dtype);if(t.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got `+t.dtype)}}function PAe(e,t,n,r){const i=((e,t,n)=>{switch(e.category){case"arithmetic":return Nfe(()=>((e,t,n)=>{switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[qfe(VIe("a",e,t,n),VIe("b",e,t,n))];case"AddN":return[Spe(VIe("tensors",e,t,n))];case"FloorMod":case"Mod":return[Ige(VIe("a",e,t,n),VIe("b",e,t,n))];case"Mul":return[Xfe(VIe("a",e,t,n),VIe("b",e,t,n))];case"RealDiv":case"Div":return[Yfe(VIe("a",e,t,n),VIe("b",e,t,n))];case"DivNoNan":return[Mme(VIe("a",e,t,n),VIe("b",e,t,n))];case"FloorDiv":return[Gfe(VIe("a",e,t,n),VIe("b",e,t,n))];case"Sub":return[hpe(VIe("a",e,t,n),VIe("b",e,t,n))];case"Minimum":return[Tge(VIe("a",e,t,n),VIe("b",e,t,n))];case"Maximum":return[ype(VIe("a",e,t,n),VIe("b",e,t,n))];case"Pow":return[dpe(VIe("a",e,t,n),VIe("b",e,t,n))];case"SquaredDifference":return[Ive(VIe("a",e,t,n),VIe("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"basic_math":return Nfe(()=>((e,t,n)=>{switch(e.op){case"Abs":case"ComplexAbs":return[ppe(VIe("x",e,t,n))];case"Acos":return[kpe(VIe("x",e,t,n))];case"Acosh":return[Epe(VIe("x",e,t,n))];case"Asin":return[Ope(VIe("x",e,t,n))];case"Asinh":return[Dpe(VIe("x",e,t,n))];case"Atan":return[Mpe(VIe("x",e,t,n))];case"Atan2":return[Npe(VIe("x",e,t,n),VIe("y",e,t,n))];case"Atanh":return[jpe(VIe("x",e,t,n))];case"Ceil":return[ume(VIe("x",e,t,n))];case"Complex":return[wde(VIe("real",e,t,n),VIe("imag",e,t,n))];case"Cos":return[_me(VIe("x",e,t,n))];case"Cosh":return[kme(VIe("x",e,t,n))];case"Elu":return[jme(VIe("x",e,t,n))];case"Erf":return[Fme(VIe("x",e,t,n))];case"Exp":return[Rme(VIe("x",e,t,n))];case"Expm1":return[Lme(VIe("x",e,t,n))];case"Floor":return[zme(VIe("x",e,t,n))];case"Log":return[ege(VIe("x",e,t,n))];case"Log1p":return[tge(VIe("x",e,t,n))];case"Imag":return[Vme(VIe("x",e,t,n))];case"Neg":return[nge(VIe("x",e,t,n))];case"Reciprocal":return[nve(VIe("x",e,t,n))];case"Real":return[tve(VIe("x",e,t,n))];case"Relu":return[rve(VIe("x",e,t,n))];case"Round":return[cve(VIe("x",e,t,n))];case"Selu":return[hve(VIe("x",e,t,n))];case"Sigmoid":return[Jpe(VIe("x",e,t,n))];case"Sin":return[gve(VIe("x",e,t,n))];case"Sign":return[mve(VIe("x",e,t,n))];case"Sinh":return[vve(VIe("x",e,t,n))];case"Softplus":return[rge(VIe("x",e,t,n))];case"Sqrt":return[Kfe(VIe("x",e,t,n))];case"Square":return[Zfe(VIe("x",e,t,n))];case"Tanh":return[eme(VIe("x",e,t,n))];case"Tan":return[Nve(VIe("x",e,t,n))];case"ClipByValue":return[cme(VIe("x",e,t,n),VIe("clipValueMin",e,t,n),VIe("clipValueMax",e,t,n))];case"Relu6":return[ive(VIe("x",e,t,n))];case"Rsqrt":return[dve(qIe(e.inputNames[0],t,n))];case"Prod":return[Vge(VIe("x",e,t,n),VIe("axes",e,t,n))];case"LeakyRelu":return[Xme(VIe("x",e,t,n),VIe("alpha",e,t,n))];case"Prelu":return[Wge(VIe("x",e,t,n),VIe("alpha",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"control":return(async(e,t,n)=>{switch(e.op){case"If":case"StatelessIf":{const r=VIe("thenBranch",e,t,n),i=VIe("elseBranch",e,t,n),a=VIe("cond",e,t,n),o=VIe("args",e,t,n);return(await a.data())[0]?n.functionMap[r].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap):n.functionMap[i].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=VIe("body",e,t,n),i=VIe("cond",e,t,n),a=VIe("args",e,t,n),o=await n.functionMap[i].executeFunctionAsync(a,n.tensorArrayMap,n.tensorListMap),s=a.map(e=>e.id);let l=await o[0].data();o.forEach(e=>{e.kept||-1!==s.indexOf(e.id)||e.dispose()});let u=a;for(;l[0];){const e=u;u=await n.functionMap[r].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);const t=u.map(e=>e.id);e.forEach(e=>{e.kept||-1!==s.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()});const a=await n.functionMap[i].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);l=await a[0].data(),a.forEach(e=>{e.kept||-1!==s.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()})}return u}case"LoopCond":return[ZIe(VIe("pred",e,t,n))];case"Switch":{const r=VIe("pred",e,t,n);let i=VIe("data",e,t,n);return i.kept||(i=ZIe(i)),(await r.data())[0]?[void 0,i]:[i,void 0]}case"Merge":{const r=e.inputNames.find(e=>void 0!==qIe(e,t,n));return r?[ZIe(qIe(r,t,n))]:void 0}case"Enter":{const r=VIe("frameName",e,t,n),i=VIe("tensor",e,t,n);return n.enterFrame(r),[ZIe(i)]}case"Exit":{const r=VIe("tensor",e,t,n);return n.exitFrame(),[ZIe(r)]}case"NextIteration":{const r=VIe("tensor",e,t,n);return n.nextIteration(),[ZIe(r)]}case"TensorArrayV3":{const r=VIe("size",e,t,n),i=VIe("dtype",e,t,n),a=VIe("elementShape",e,t,n),o=VIe("dynamicSize",e,t,n),s=VIe("clearAfterRead",e,t,n),l=VIe("identicalElementShapes",e,t,n),u=VIe("name",e,t,n),c=new MAe(u,i,r,a,l,o,s);return n.addTensorArray(c),[c.idTensor,ope(1)]}case"TensorArrayWriteV3":{const r=VIe("tensorArrayId",e,t,n),i=VIe("index",e,t,n),a=VIe("tensor",e,t,n),o=n.getTensorArray(r.id);return o.write(i,a),[o.idTensor]}case"TensorArrayReadV3":{const r=VIe("tensorArrayId",e,t,n),i=VIe("index",e,t,n);return[n.getTensorArray(r.id).read(i)]}case"TensorArrayGatherV3":{const r=VIe("tensorArrayId",e,t,n),i=VIe("indices",e,t,n),a=VIe("dtype",e,t,n);return[n.getTensorArray(r.id).gather(i,a)]}case"TensorArrayScatterV3":{const r=VIe("tensorArrayId",e,t,n),i=VIe("indices",e,t,n),a=VIe("tensor",e,t,n),o=n.getTensorArray(r.id);return o.scatter(i,a),[o.idTensor]}case"TensorArrayConcatV3":{const r=VIe("tensorArrayId",e,t,n),i=n.getTensorArray(r.id),a=VIe("dtype",e,t,n);return[i.concat(a)]}case"TensorArraySplitV3":{const r=VIe("tensorArrayId",e,t,n),i=VIe("tensor",e,t,n),a=VIe("lengths",e,t,n),o=n.getTensorArray(r.id);return o.split(a,i),[o.idTensor]}case"TensorArraySizeV3":{const r=VIe("tensorArrayId",e,t,n);return[ope(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=VIe("tensorArrayId",e,t,n),i=n.getTensorArray(r.id);return i.clearAndClose(),[i.idTensor]}case"TensorListSetItem":{const r=VIe("tensorListId",e,t,n),i=VIe("index",e,t,n),a=VIe("tensor",e,t,n),o=n.getTensorList(r.id);return o.setItem(i,a),[o.idTensor]}case"TensorListGetItem":{const r=VIe("tensorListId",e,t,n),i=VIe("index",e,t,n),a=VIe("elementShape",e,t,n),o=VIe("elementDType",e,t,n);return[n.getTensorList(r.id).getItem(i,a,o)]}case"TensorListScatterV2":case"TensorListScatter":{const r=VIe("indices",e,t,n),i=function(e,t,n,r){if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const i=Math.max(...t);if(null!=r&&-1!==r&&i>=r)throw new Error(`Max index must be < array size (${i}  vs. ${r})`);const a=new NAe([],n,e.dtype,r),o=Hve(e,0);return t.forEach((e,t)=>{a.setItem(e,o[t])}),a}(VIe("tensor",e,t,n),r,VIe("elementShape",e,t,n),VIe("numElements",e,t,n));return n.addTensorList(i),[i.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=VIe("elementShape",e,t,n),i=VIe("elementDType",e,t,n);let a;a="TensorListReserve"===e.op?"numElements":"maxNumElements";const o=function(e,t,n){return new NAe([],e,t,n)}(r,i,VIe(a,e,t,n));return n.addTensorList(o),[o.idTensor]}case"TensorListGather":{const r=VIe("tensorListId",e,t,n),i=VIe("indices",e,t,n),a=VIe("elementShape",e,t,n),o=VIe("elementDType",e,t,n);return[n.getTensorList(r.id).gather(i,o,a)]}case"TensorListStack":{const r=VIe("tensorListId",e,t,n),i=VIe("elementShape",e,t,n),a=VIe("elementDType",e,t,n),o=VIe("numElements",e,t,n);return[n.getTensorList(r.id).stack(i,a,o)]}case"TensorListFromTensor":{const r=function(e,t,n){const r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: "+e.shape);if(e.dtype!==n)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${n}`);DAe(e.shape.slice(1),t,"TensorList shape mismatch: ");const i=Hve(e);return new NAe(i,t,r)}(VIe("tensor",e,t,n),VIe("elementShape",e,t,n),VIe("elementDType",e,t,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":{const r=VIe("tensorListId",e,t,n),i=n.getTensorList(r.id),a=VIe("dtype",e,t,n),o=VIe("elementShape",e,t,n);return[i.concat(a,o)]}case"TensorListPushBack":{const r=VIe("tensorListId",e,t,n),i=VIe("tensor",e,t,n),a=n.getTensorList(r.id);return a.pushBack(i),[a.idTensor]}case"TensorListPopBack":{const r=VIe("tensorListId",e,t,n),i=VIe("elementShape",e,t,n),a=VIe("elementDType",e,t,n);return[n.getTensorList(r.id).popBack(i,a)]}case"TensorListSplit":{const r=VIe("tensor",e,t,n),i=VIe("elementShape",e,t,n),a=function(e,t,n){let r=0;const i=t.map(e=>(r+=e,r));if(r!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${e.shape}`);const a=0===r?0:e.size/r,o=Nfe(()=>{const o=[];e=Ype(e,[1,r,a]);for(let r=0;r<t.length;++r)o[r]=Ype(Qpe(e,[0,0===r?0:i[r-1],0],[1,t[r],a]),n);return e.dispose(),o}),s=new NAe([],n,e.dtype,t.length);for(let l=0;l<o.length;l++)s.setItem(l,o[l]);return s}(r,VIe("lengths",e,t,n),i);return n.addTensorList(a),[a.idTensor]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n);case"convolution":return Nfe(()=>((e,t,n)=>{switch(e.op){case"Conv1D":{const r=VIe("stride",e,t,n),i=VIe("pad",e,t,n),a=VIe("dataFormat",e,t,n).toUpperCase(),o=VIe("dilation",e,t,n);return[gme(VIe("x",e,t,n),VIe("filter",e,t,n),r,i,a,o)]}case"Conv2D":{const r=VIe("strides",e,t,n),i=KIe(e,t,n),a=VIe("dataFormat",e,t,n).toUpperCase(),o=VIe("dilations",e,t,n);return[mme(VIe("x",e,t,n),VIe("filter",e,t,n),[r[1],r[2]],i,a,[o[1],o[2]])]}case"_FusedConv2D":{const{stride:r,pad:i,dataFormat:a,dilations:o,biasArg:s,preluArg:l,activationFunc:u,leakyreluAlpha:c}=jAe(e,t,n);return[M.conv2d({x:VIe("x",e,t,n),filter:VIe("filter",e,t,n),strides:[r[1],r[2]],pad:i,dataFormat:a,dilations:[o[1],o[2]],bias:s,activation:u,preluActivationWeights:l,leakyreluAlpha:c})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:i,dataFormat:a,dilations:o,biasArg:s,preluArg:l,activationFunc:u,leakyreluAlpha:c}=jAe(e,t,n);return[M.depthwiseConv2d({x:VIe("x",e,t,n),filter:VIe("filter",e,t,n),strides:[r[1],r[2]],pad:i,dataFormat:a,dilations:[o[1],o[2]],bias:s,activation:u,preluActivationWeights:l,leakyreluAlpha:c})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=VIe("outputShape",e,t,n),i=VIe("strides",e,t,n),a=KIe(e,t,n);return[yme(VIe("x",e,t,n),VIe("filter",e,t,n),r,[i[1],i[2]],a)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=VIe("strides",e,t,n),i=KIe(e,t,n),a=VIe("dilations",e,t,n),o=VIe("dataFormat",e,t,n).toUpperCase();return[Cme(VIe("input",e,t,n),VIe("filter",e,t,n),[r[1],r[2]],i,o,[a[1],a[2]])]}case"Conv3D":{const r=VIe("strides",e,t,n),i=VIe("pad",e,t,n),a=VIe("dataFormat",e,t,n).toUpperCase(),o=VIe("dilations",e,t,n);return[bme(VIe("x",e,t,n),VIe("filter",e,t,n),[r[1],r[2],r[3]],i,a,[o[1],o[2],o[3]])]}case"AvgPool":{const r=VIe("strides",e,t,n),i=VIe("pad",e,t,n),a=VIe("kernelSize",e,t,n);return[Xpe(VIe("x",e,t,n),[a[1],a[2]],[r[1],r[2]],i)]}case"MaxPool":{const r=VIe("strides",e,t,n),i=VIe("pad",e,t,n),a=VIe("kernelSize",e,t,n);return[wge(VIe("x",e,t,n),[a[1],a[2]],[r[1],r[2]],i)]}case"MaxPoolWithArgmax":{const r=VIe("strides",e,t,n),i=VIe("pad",e,t,n),a=VIe("kernelSize",e,t,n),o=VIe("includeBatchInIndex",e,t,n),{result:s,indexes:l}=kge(VIe("x",e,t,n),[a[1],a[2]],[r[1],r[2]],i,o);return[s,l]}case"AvgPool3D":{const r=VIe("strides",e,t,n),i=VIe("pad",e,t,n),a=VIe("kernelSize",e,t,n);return[Kpe(VIe("x",e,t,n),[a[1],a[2],a[3]],[r[1],r[2],r[3]],i)]}case"MaxPool3D":{const r=VIe("strides",e,t,n),i=VIe("pad",e,t,n),a=VIe("kernelSize",e,t,n);return[_ge(VIe("x",e,t,n),[a[1],a[2],a[3]],[r[1],r[2],r[3]],i)]}case"Dilation2D":{const r=VIe("strides",e,t,n),i=VIe("pad",e,t,n),a=VIe("dilations",e,t,n),o=r[1],s=r[2],l=a[1],u=a[2];return[Ame(VIe("x",e,t,n),VIe("filter",e,t,n),[o,s],i,[l,u],"NHWC")]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"creation":return Nfe(()=>((e,t,n)=>{switch(e.op){case"Fill":{const r=VIe("shape",e,t,n),i=VIe("dtype",e,t,n);return[upe(r,VIe("value",e,t,n),i)]}case"LinSpace":return[Jme(VIe("start",e,t,n),VIe("stop",e,t,n),VIe("num",e,t,n))];case"Multinomial":{const r=VIe("logits",e,t,n),i=VIe("numSamples",e,t,n),a=VIe("seed",e,t,n);return[Dge(r,i,a)]}case"OneHot":{const r=VIe("indices",e,t,n),i=VIe("depth",e,t,n),a=VIe("onValue",e,t,n),o=VIe("offValue",e,t,n);return[Phe(r,i,a,o)]}case"Ones":return[jge(VIe("shape",e,t,n),VIe("dtype",e,t,n))];case"OnesLike":return[Fge(VIe("x",e,t,n))];case"RandomUniform":return[Qge(VIe("shape",e,t,n),VIe("minval",e,t,n),VIe("maxval",e,t,n),VIe("dtype",e,t,n))];case"Range":return[eve(VIe("start",e,t,n),VIe("stop",e,t,n),VIe("step",e,t,n),VIe("dtype",e,t,n))];case"TruncatedNormal":{const r=VIe("shape",e,t,n),i=VIe("mean",e,t,n),a=VIe("stdDev",e,t,n),o=VIe("seed",e,t,n);return[$ve(r,i,a,VIe("dtype",e,t,n),o)]}case"Zeros":return[Nge(VIe("shape",e,t,n),VIe("dtype",e,t,n))];case"ZerosLike":return[Jfe(VIe("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"dynamic":return(async(e,t,n)=>{switch(e.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:i,maxOutputSize:a,iouThreshold:o,scoreThreshold:s,softNmsSigma:l}=FAe(e,t,n),u=await hbe.nonMaxSuppressionWithScoreAsync(r,i,a,o,s,l);return[u.selectedIndices,u.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:i,maxOutputSize:a,iouThreshold:o,scoreThreshold:s}=FAe(e,t,n),l=VIe("padToMaxOutputSize",e,t,n),u=await hbe.nonMaxSuppressionPaddedAsync(r,i,a,o,s,l);return[u.selectedIndices,u.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:i,maxOutputSize:a,iouThreshold:o,scoreThreshold:s}=FAe(e,t,n);return[await hbe.nonMaxSuppressionAsync(r,i,a,o,s)]}case"Where":{const r=ghe(VIe("condition",e,t,n),"bool"),i=[await qve(r)];return r.dispose(),i}case"ListDiff":return pve(VIe("x",e,t,n),VIe("y",e,t,n));default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n);case"evaluation":return Nfe(()=>((e,t,n)=>{switch(e.op){case"TopKV2":{const r=VIe("x",e,t,n),i=VIe("k",e,t,n),a=VIe("sorted",e,t,n),o=Bve(r,i,a);return[o.values,o.indices]}case"Unique":{const r=VIe("x",e,t,n),i=zve(r);return[i.values,i.indices]}case"UniqueV2":{const r=VIe("x",e,t,n),i=VIe("axis",e,t,n),a=zve(r,i);return[a.values,a.indices]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"image":return Nfe(()=>((e,t,n)=>{switch(e.op){case"ResizeBilinear":{const r=VIe("images",e,t,n),i=VIe("size",e,t,n),a=VIe("alignCorners",e,t,n),o=VIe("halfPixelCenters",e,t,n);return[hbe.resizeBilinear(r,[i[0],i[1]],a,o)]}case"ResizeNearestNeighbor":{const r=VIe("images",e,t,n),i=VIe("size",e,t,n),a=VIe("alignCorners",e,t,n),o=VIe("halfPixelCenters",e,t,n);return[hbe.resizeNearestNeighbor(r,[i[0],i[1]],a,o)]}case"CropAndResize":{const r=VIe("image",e,t,n),i=VIe("boxes",e,t,n),a=VIe("boxInd",e,t,n),o=VIe("cropSize",e,t,n),s=VIe("method",e,t,n),l=VIe("extrapolationValue",e,t,n);return[hbe.cropAndResize(r,i,a,o,s,l)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"graph":return Nfe(()=>((e,t,n)=>{switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":const r=VIe("default",e,t,n);return[qIe(e.name,t,n)||r];case"Placeholder":return[qIe(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[ZIe(VIe("x",e,t,n))];case"IdentityN":return VIe("x",e,t,n).map(e=>ZIe(e));case"Snapshot":return[ZIe(VIe("x",e,t,n))];case"Shape":return[jve(VIe("x",e,t,n).shape,"int32")];case"ShapeN":return VIe("x",e,t,n).map(e=>jve(e.shape));case"Size":return[ope(VIe("x",e,t,n).size,"int32")];case"Rank":return[ope(VIe("x",e,t,n).rank,"int32")];case"NoOp":return[ope(1)];case"Print":const i=VIe("x",e,t,n),a=VIe("data",e,t,n),o=VIe("message",e,t,n),s=VIe("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(o);for(let e=0;e<a.length;e++)console.log(Array.prototype.slice.call(a[e].dataSync()).slice(0,s));return[i];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"logical":return Nfe(()=>((e,t,n)=>{switch(e.op){case"Equal":return[Ome(VIe("a",e,t,n),VIe("b",e,t,n))];case"NotEqual":return[Mge(VIe("a",e,t,n),VIe("b",e,t,n))];case"Greater":return[Hme(VIe("a",e,t,n),VIe("b",e,t,n))];case"GreaterEqual":return[Wme(VIe("a",e,t,n),VIe("b",e,t,n))];case"Less":return[Kme(VIe("a",e,t,n),VIe("b",e,t,n))];case"LessEqual":return[Zme(VIe("a",e,t,n),VIe("b",e,t,n))];case"LogicalAnd":return[vge(VIe("a",e,t,n),VIe("b",e,t,n))];case"LogicalNot":return[yge(VIe("a",e,t,n))];case"LogicalOr":return[bge(VIe("a",e,t,n),VIe("b",e,t,n))];case"Select":case"SelectV2":return[Dme(VIe("condition",e,t,n),VIe("a",e,t,n),VIe("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"matrices":return Nfe(()=>((e,t,n)=>{switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[Rhe(VIe("a",e,t,n),VIe("b",e,t,n),VIe("transposeA",e,t,n),VIe("transposeB",e,t,n))];case"Transpose":return[Lhe(VIe("x",e,t,n),VIe("perm",e,t,n))];case"_FusedMatMul":const[r,i]=VIe("fusedOps",e,t,n),a="biasadd"===r,o="prelu"===i,s=VIe("numArgs",e,t,n),l=VIe("leakyreluAlpha",e,t,n);if(a){if(o&&2!==s)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&1!==s)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[u,c]=VIe("args",e,t,n);return[M.matMul({a:VIe("a",e,t,n),b:VIe("b",e,t,n),transposeA:VIe("transposeA",e,t,n),transposeB:VIe("transposeB",e,t,n),bias:u,activation:i,preluActivationWeights:c,leakyreluAlpha:l})];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"normalization":return Nfe(()=>((e,t,n)=>{switch(e.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[rme(VIe("x",e,t,n),VIe("mean",e,t,n),VIe("variance",e,t,n),VIe("offset",e,t,n),VIe("scale",e,t,n),VIe("epsilon",e,t,n))];case"LRN":return[Qme(VIe("x",e,t,n),VIe("radius",e,t,n),VIe("bias",e,t,n),VIe("alpha",e,t,n),VIe("beta",e,t,n))];case"Softmax":return[_ve(VIe("x",e,t,n))];case"LogSoftmax":return[sge(VIe("x",e,t,n))];case"SparseToDense":return[hye(VIe("sparseIndices",e,t,n),VIe("outputShape",e,t,n),VIe("sparseValues",e,t,n),VIe("defaultValue",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"reduction":return Nfe(()=>((e,t,n)=>{switch(e.op){case"Max":{const r=VIe("axis",e,t,n),i=VIe("keepDims",e,t,n);return[age(VIe("x",e,t,n),r,i)]}case"Mean":{const r=VIe("axis",e,t,n),i=VIe("keepDims",e,t,n);return[Ege(VIe("x",e,t,n),r,i)]}case"Min":{const r=VIe("axis",e,t,n),i=VIe("keepDims",e,t,n);return[Sge(VIe("x",e,t,n),r,i)]}case"Sum":{const r=VIe("axis",e,t,n),i=VIe("keepDims",e,t,n);return[oge(VIe("x",e,t,n),r,i)]}case"All":{const r=VIe("axis",e,t,n),i=VIe("keepDims",e,t,n);return[Tpe(VIe("x",e,t,n),r,i)]}case"Any":{const r=VIe("axis",e,t,n),i=VIe("keepDims",e,t,n);return[Cpe(VIe("x",e,t,n),r,i)]}case"ArgMax":{const r=VIe("axis",e,t,n);return[Ipe(VIe("x",e,t,n),r)]}case"ArgMin":{const r=VIe("axis",e,t,n);return[Ape(VIe("x",e,t,n),r)]}case"Prod":{const r=VIe("axis",e,t,n),i=VIe("keepDims",e,t,n);return[Vge(VIe("x",e,t,n),r,i)]}case"Cumsum":{const r=VIe("axis",e,t,n),i=VIe("exclusive",e,t,n),a=VIe("reverse",e,t,n);return[Eme(VIe("x",e,t,n),r,i,a)]}case"Bincount":const r=VIe("x",e,t,n),i=VIe("weights",e,t,n),a=VIe("size",e,t,n);return[sme(r,i,a)];case"DenseBincount":{const r=VIe("x",e,t,n),i=VIe("weights",e,t,n),a=VIe("size",e,t,n),o=VIe("binaryOutput",e,t,n);return[Sme(r,i,a,o)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"slice_join":return Nfe(()=>((e,t,n)=>{switch(e.op){case"ConcatV2":case"Concat":{const r=VIe("n",e,t,n),i=VIe("axis",e,t,n);let a=VIe("tensors",e,t,n);return a=a.slice(0,r),[Zpe(a,i)]}case"Gather":{const r=VIe("x",e,t,n),i=VIe("indices",e,t,n);return[Ume(r,ghe(i,"int32"),0)]}case"GatherV2":{const r=VIe("axis",e,t,n),i=VIe("batchDims",e,t,n),a=VIe("x",e,t,n),o=VIe("indices",e,t,n);return[Ume(a,ghe(o,"int32"),r,i)]}case"Reverse":{const r=VIe("dims",e,t,n),i=[];for(let e=0;e<r.length;e++)r[e]&&i.push(e);const a=VIe("x",e,t,n);return[ave(a,i)]}case"ReverseV2":{const r=VIe("axis",e,t,n),i=VIe("x",e,t,n);return[ave(i,r)]}case"Slice":{const r=VIe("begin",e,t,n),i=VIe("size",e,t,n);return[Qpe(VIe("x",e,t,n),r,i)]}case"StridedSlice":{const r=VIe("begin",e,t,n),i=VIe("end",e,t,n),a=VIe("strides",e,t,n),o=VIe("beginMask",e,t,n),s=VIe("endMask",e,t,n),l=VIe("ellipsisMask",e,t,n),u=VIe("newAxisMask",e,t,n),c=VIe("shrinkAxisMask",e,t,n),d=VIe("x",e,t,n);return[Mve(d,r,i,a,o,s,l,u,c)]}case"Pack":return Nfe(()=>{const r=VIe("axis",e,t,n),i=VIe("tensors",e,t,n),a=i[0].shape,o=Ave(i[0]).shape,s=i.map(e=>{const t=w.arraysEqual(e.shape,a);if(!t&&!w.arraysEqual(Ave(e).shape,o))throw new Error("the input tensors shape does not match");return t?e:Ype(e,a)});return[Ove(s,r)]});case"Unpack":{const r=VIe("axis",e,t,n),i=VIe("tensor",e,t,n);return Hve(i,r)}case"Tile":{const r=VIe("reps",e,t,n);return[Bme(VIe("x",e,t,n),r)]}case"Split":case"SplitV":{const r=VIe("axis",e,t,n),i=VIe("numOrSizeSplits",e,t,n),a=VIe("x",e,t,n);return Tve(a,i,r)}case"ScatterNd":{const r=VIe("indices",e,t,n),i=VIe("values",e,t,n),a=VIe("shape",e,t,n);return[dye(r,i,a)]}case"GatherNd":{const r=VIe("x",e,t,n),i=VIe("indices",e,t,n);return[fye(r,i)]}case"SparseToDense":{const r=VIe("sparseIndices",e,t,n),i=VIe("outputShape",e,t,n),a=VIe("sparseValues",e,t,n),o=VIe("defaultValue",e,t,n);return[hye(r,a,i,a.dtype===o.dtype?o:ghe(o,a.dtype))]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"spectral":return Nfe(()=>((e,t,n)=>{switch(e.op){case"FFT":return[kve(VIe("x",e,t,n))];case"IFFT":return[Eve(VIe("x",e,t,n))];case"RFFT":return[Cve(VIe("x",e,t,n))];case"IRFFT":return[Sve(VIe("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"transformation":return Nfe(()=>((e,t,n)=>{switch(e.op){case"Cast":return[ghe(VIe("x",e,t,n),VIe("dtype",e,t,n))];case"ExpandDims":{const r=VIe("axis",e,t,n);return[Pme(VIe("x",e,t,n),r)]}case"Squeeze":{const r=VIe("axis",e,t,n);return[Ave(VIe("x",e,t,n),r)]}case"Reshape":return[Ype(VIe("x",e,t,n),VIe("shape",e,t,n))];case"MirrorPad":return[Cge(VIe("x",e,t,n),VIe("padding",e,t,n),VIe("mode",e,t,n))];case"PadV2":case"Pad":return[Pge(VIe("x",e,t,n),VIe("padding",e,t,n),VIe("constantValue",e,t,n))];case"SpaceToBatchND":{const r=VIe("blockShape",e,t,n),i=VIe("paddings",e,t,n);return[Uge(VIe("x",e,t,n),r,i)]}case"BatchToSpaceND":{const r=VIe("blockShape",e,t,n),i=VIe("crops",e,t,n);return[nme(VIe("x",e,t,n),r,i)]}case"DepthToSpace":{const r=VIe("blockSize",e,t,n),i=VIe("dataFormat",e,t,n).toUpperCase();return[Tme(VIe("x",e,t,n),r,i)]}case"BroadcastTo":return[lme(VIe("x",e,t,n),VIe("shape",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"hash_table":return(async(e,t,n,r)=>{switch(e.op){case"HashTable":case"HashTableV2":{const i=VIe("keyDType",e,t,n),a=VIe("valueDType",e,t,n),o=new RAe(i,a);return r.addHashTable(e.name,o),[o.handle]}case"LookupTableImport":case"LookupTableImportV2":{const i=VIe("tableHandle",e,t,n,r),a=VIe("keys",e,t,n),o=VIe("values",e,t,n),s=r.getHashTableById(i.id);return[await s.import(a,o)]}case"LookupTableFind":case"LookupTableFindV2":{const i=VIe("tableHandle",e,t,n,r),a=VIe("keys",e,t,n),o=VIe("defaultValue",e,t,n),s=r.getHashTableById(i.id);return[await s.find(a,o)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n,r);case"custom":const i=HIe(e.op);if(i&&i.customExecutor)return i.customExecutor(new OAe(e,t,n));throw TypeError(`Custom op ${e.op} is not registered.`);default:throw TypeError(`Unknown op '${e.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(e,t,n);return w.isPromise(i)?i.then(e=>[].concat(e)):[].concat(i)}class LAe{constructor(e={},t={},n={},r={}){this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let t=0;t<this.contexts.length-1;t++){const n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(e=>0===e.id&&0===e.iterationId?"":`${e.frameName}-${e.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(const t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}}function BAe(e,t,n,r){const i=new Set,a=[];let o=null,s=null;const l=new Set,u=Object.keys(e).map(e=>XIe(e)[0]);let c=[];null!=r&&(c=r.map(e=>XIe(e.name)[0]));const d=[...t];for(;d.length>0;){const e=d.pop();(HAe(e)||WAe(e)||VAe(e))&&null==o&&(o=e,s=o.children.map(e=>e.name).filter(e=>i.has(e))),i.add(e.name),null==n[e.name]&&-1===u.indexOf(e.name)&&-1===c.indexOf(e.name)&&(0!==e.inputs.length?e.inputs.forEach(e=>{l.has(e.name)||(l.add(e.name),d.push(e))}):a.push(e.name))}return{inputs:e,outputs:t,usedNodes:i,missingInputs:a,dynamicNode:o,syncInputs:s}}const $Ae=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],zAe=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],UAe=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2"];function HAe(e){return $Ae.indexOf(e.op)>=0}function WAe(e){return zAe.indexOf(e.op)>=0}function VAe(e){return UAe.indexOf(e.op)>=0}class qAe{constructor(e,t){this.graph=e,this.parent=t,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,null!=e.functions&&Object.keys(e.functions).forEach(t=>{this._functionExecutorMap[t]=new qAe(e.functions[t],this)})}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const t=Object.keys(e).map(t=>e[t].map(e=>e.id));this._weightIds=[].concat(...t),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const t=e.signatureKey||e.name;return e.defaultOutput?`${t}:${e.defaultOutput}`:t})}get functions(){return Object.keys(this._functions).reduce((e,t)=>(e[t]=this._functions[t].signature,e),{})}getCompilationKey(e,t){const n=e.map(e=>e.name).sort(),r=t.map(e=>e.name).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}compile(e,t){const n=BAe(e,t,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:i,syncInputs:a}=n;if(null!=i)throw new Error(`This execution contains the node '${i.name}', which has the dynamic op '${i.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${a}]`);if(r.length>0){const n=t.map(e=>e.name),i=Object.keys(e);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${i}]. Missing the following inputs: [${r}]`)}return function(e,t,n){const{usedNodes:r,inputs:i}=n,a=[],o=Object.keys(i).map(e=>XIe(e)[0]).map(t=>e.nodes[t]),s=e.initNodes;o.forEach(e=>{r.has(e.name)&&a.push(e)}),e.weights.forEach(e=>{r.has(e.name)&&a.push(e)}),null!=s&&s.forEach(e=>{r.has(e.name)&&a.push(e)});const l=new Set,u=[];for(;a.length>0;){const e=a.pop();l.add(e.name),t[e.name]||u.push(e),e.children.forEach(e=>{!l.has(e.name)&&r.has(e.name)&&e.inputs.every(e=>l.has(e.name))&&a.push(e)})}return u}(this.graph,this.weightMap,n)}execute(e,t){e=this.mapInputs(e);const n=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);const r=n.map(e=>this.graph.nodes[XIe(e)[0]]),i=t.map(e=>XIe(e)[0]);let a=i.map(e=>this.graph.nodes[e]);0===a.length&&(a=this._outputs);const o=this.getCompilationKey(r,a);let s=this.compiledMap.get(o);null==s&&(s=this.compile(e,a),this.compiledMap.set(o,s));const l={},u={};return Nfe(()=>{const n=new LAe(this.weightMap,l,u,this.functionExecutorMap),r=Object.assign({},this.weightMap);Object.keys(e).forEach(t=>{const[n,i]=XIe(t),a=[];a[i]=e[t],r[n]=a});const a=this.getFrozenTensorIds(r),o={};for(let e=0;e<s.length;e++){const t=s[e];if(!r[t.name]){const e=PAe(t,r,n,this._resourceManager);if(w.isPromise(e))throw new Error(`The execution of the op '${t.op}' returned a promise. Please use model.executeAsync() instead.`);r[t.name]=e,this.checkTensorForDisposal(t.name,t,r,n,a,i,o)}}return null==this.parent&&n.dispose(a),t.map(e=>qIe(e,r,n))})}getFrozenTensorIds(e){const t=[].concat.apply([],Object.keys(e).map(t=>e[t]).map(e=>e.map(e=>e.id)));return new Set(t)}checkTensorForDisposal(e,t,n,r,i,a,o){"control"!==t.category&&-1===a.indexOf(e)&&(n[e].forEach(e=>{null!=e&&(o[e.id]=(o[e.id]||0)+t.children.length)}),t.inputs.forEach(e=>{if("control"!==e.category){const t=function(e,t,n){return t[YIe(e,n.currentContextId)]}(e.name,n,r);null!=t&&t.forEach(e=>{if(e&&!i.has(e.id)){const t=o[e.id];1===t?(e.dispose(),delete o[e.id]):null!=t&&o[e.id]--}})}}))}async executeAsync(e,t){return this._executeAsync(e,t)}async _executeAsync(e,t,n=!1,r={},i={}){n||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));const a=new LAe(this.weightMap,r,i,this.functionExecutorMap),o=await this.executeWithControlFlow(e,a,t,n),s=t.map(e=>qIe(e,o,a)),l=s.map(e=>e.id),u=Object.keys(e).map(t=>e[t].id),c=new Set([...l,...u,...this.weightIds]);return Object.keys(o).forEach(e=>{o[e].forEach(e=>{!e||e.isDisposed||c.has(e.id)||e.dispose()})}),null==this.parent&&a.dispose(c),s}async executeFunctionAsync(e,t,n){const r=e.reduce((e,t,n)=>(e[this.inputs[n].name]=t,e),{});return this._executeAsync(r,this.outputNodes,!0,t,n)}async executeWithControlFlow(e,t,n,r){const i=Object.keys(e),a=i.map(e=>this.graph.nodes[XIe(e)[0]]),o=n.map(e=>XIe(e)[0]);let s=o.map(e=>this.graph.nodes[e]);0===s.length&&(s=this._outputs);const{usedNodes:l,missingInputs:u,dynamicNode:c,syncInputs:d}=BAe(e,s,this.weightMap,this._initNodes),h=[...a,...this.graph.weights,...this._initNodes||[]].map(e=>({node:e,contexts:t.currentContext})),f=Object.assign({},this.weightMap);Object.keys(e).forEach(t=>{const[n,r]=XIe(t),i=[];i[r]=e[t],f[n]=i});const p={},m=this.getFrozenTensorIds(f),g={};for(;h.length>0;){const e=this.processStack(a,h,t,f,g,m,o,p,l);await Promise.all(e)}null!=c||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const v=s.filter(e=>!HAe(e)&&!qIe(e.name,f,t)).map(e=>e.name);if(v.length>0){let e="";throw null!=c&&(e=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${d}]`),new Error(`Cannot compute the outputs [${v}] from the provided inputs [${i}]. Consider providing the following inputs: [${u}]. ${e}`)}return f}processStack(e,t,n,r,i,a,o,s,l){const u=[];for(;t.length>0;){const e=t.pop();n.currentContext=e.contexts;let c="";if("Enter"===e.node.op&&VIe("isConstant",e.node,r,n)&&([c]=GIe(e.node.name,n)),null==r[e.node.name]){const d=PAe(e.node,r,n,this._resourceManager);c||([c]=GIe(e.node.name,n));const h=n.currentContext;w.isPromise(d)?u.push(d.then(u=>(r[c]=u,n.currentContext=h,this.checkTensorForDisposal(c,e.node,r,n,a,o,s),this.processChildNodes(e.node,t,n,r,i,l),u))):(r[c]=d,this.checkTensorForDisposal(c,e.node,r,n,a,o,s),this.processChildNodes(e.node,t,n,r,i,l))}else this.processChildNodes(e.node,t,n,r,i,l)}return u}processChildNodes(e,t,n,r,i,a){e.children.forEach(e=>{const[o]=GIe(e.name,n);!i[o]&&a.has(e.name)&&("Merge"===e.op?e.inputNames.some(e=>!!qIe(e,r,n))&&(i[o]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every(e=>!!qIe(e,r,n))&&(i[o]=!0,t.push({contexts:n.currentContext,node:e})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(e=>e.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(t=>{const n=e[t],[r]=XIe(t),i=this.graph.nodes[r];if(i.attrParams.shape&&i.attrParams.shape.value){const e=i.attrParams.shape.value,t=e.length===n.shape.length&&n.shape.every((t,n)=>-1===e[n]||e[n]===t);w.assert(t,()=>`The shape of dict['${i.name}'] provided in model.execute(dict) must be [${e}], but was [${n.shape}]`)}i.attrParams.dtype&&i.attrParams.dtype.value&&w.assert(n.dtype===i.attrParams.dtype.value,()=>`The dtype of dict['${i.name}'] provided in model.execute(dict) must be ${i.attrParams.dtype.value}, but was ${n.dtype}`)})}mapInputs(e){const t={};for(const n in e)null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]?t[this._signature.inputs[n].name]=e[n]:t[n]=e[n];return t}checkInputs(e){const t=Object.keys(e).filter(e=>{const[t]=XIe(e);return null==this.graph.nodes[t]});if(t.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${t}] that are not part of graph`)}mapOutputs(e){return e.map(e=>null!=this._signature&&null!=this._signature.outputs&&null!=this._signature.outputs[e]?this._signature.outputs[e].name:e,{})}checkOutputs(e){e.forEach(e=>{const[t]=XIe(e);if(!this.graph.nodes[t])throw new Error(`The output '${e}' is not found in the graph`)})}}class GAe{constructor(e={},t={}){this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}class YAe{constructor(e,t={}){this.modelUrl=e,this.loadOptions=t,this.version="n/a",null==t&&(this.loadOptions={}),this.resourceManager=new GAe}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}findIOHandler(){const e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=E.browserHTTPRequest(e,this.loadOptions);else{const t=E.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(E.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error(`Found more than one (${t.length}) load handlers for URL '${[e]}'`);this.handler=t[0]}}async load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=await this.handler.load();return this.loadSync(e)}loadSync(e){this.artifacts=e;const t=this.artifacts.modelTopology;let n;n=null!=this.artifacts.userDefinedMetadata&&null!=this.artifacts.userDefinedMetadata.signature?this.artifacts.userDefinedMetadata.signature:this.artifacts.signature,this.signature=n,this.version=`${t.versions.producer}.${t.versions.minConsumer}`;const r=E.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new qAe(mAe.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){const t=mAe.Instance.transformGraph(e.modelInitializer);this.initializer=new qAe(t),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(e,t){if("string"==typeof e){const t=E.getSaveHandlers(e);if(0===t.length)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(t.length>1)throw new Error(`Found more than one (${t.length}) save handlers for URL '${e}'`);e=t[0]}if(null==e.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}predict(e,t){return this.execute(e,this.outputNodes)}normalizeInputs(e){if(!(e instanceof Gce||Array.isArray(e)))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${e.length} input tensors.`);return this.inputNodes.reduce((t,n,r)=>(t[n]=e[r],t),{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}execute(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const n=this.executor.execute(e,t);return n.length>1?n:n[0]}async executeAsync(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const n=await this.executor.executeAsync(e,t);return n.length>1?n:n[0]}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((t,n)=>(t[n]=[e[n]],t),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}async function XAe(e,t={}){if(null==e)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==t&&(t={}),t.fromTFHub&&null==e.load&&(e.endsWith("/")||(e+="/"),e+="model.json?tfjs-format=file");const n=new YAe(e,t);return await n.load(),n}const KAe="2.8.2";function ZAe(e,t,n=new Map,r=new Set){if(null==e)return null;if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);const i=t(e);if(i.recurse&&null!==i.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(i.recurse){if(eOe(e)){const i=Array.isArray(e)?[]:{};r.add(e);for(const a in e){const o=ZAe(e[a],t,n,r);i[a]=o}return r.delete(e),i}throw new Error("Can't recurse into non-iterable type: "+e)}return n.set(e,i.value),i.value}function JAe(e){return null===e?null:eOe(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}async function QAe(e,t){const n=new Map;ZAe(e,t,n);for(const r of Array.from(n.keys())){const e=n.get(r);if(w.isPromise(e)){const t=await e;n.set(r,t)}}return ZAe(e,t,n)}function eOe(e){return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof Gce))}function tOe(e){return e instanceof Gce?{value:e.clone(),recurse:!1}:eOe(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}class nOe{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,null==e)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(const t of e)this.push(t)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}class rOe extends nOe{constructor(){super(rOe.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){const e=2*this.capacity,t=new Array(e),n=this.length();for(let r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}function iOe(e){return new sOe(e)}function aOe(e){return new lOe(e)}rOe.INITIAL_CAPACITY=32;class oOe{async toArray(){const e=[];let t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){const e=this.prefetch(100),t=[];let n=await e.next();for(;!n.done;)t.push(n.value),n=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),n=e(t.value);for(;!t.done&&n;)t=await this.next(),n=e(t.value)}handleErrors(e){return new mOe(this,e)}filter(e){return new fOe(this,e)}map(e){return new pOe(this,e)}mapAsync(e){return new gOe(this,e)}serialMapAsync(e){return new gOe(this,e).serial()}flatmap(e){return new yOe(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(e=>!0===e)}rowMajorBatch(e,t=!0){return new hOe(this,e,t)}columnMajorBatch(e,t=!0,n=JAe){return this.rowMajorBatch(e,t).map(e=>function(e,t=JAe){return function e(t,n,r=new Set){const i=t[0];if(r.has(i))throw new Error("Circular references are not supported.");const a=n(t);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(eOe(i)){const a=Array.isArray(i)?[]:{};r.add(i);for(const o in i){const i=e(t.map(e=>e[o]),n,r);a[o]=i}return r.delete(i),a}throw new Error("Can't recurse into non-iterable type: "+i)}return a.value}(e,t)}(e,n))}concatenate(e,t){return new bOe(iOe([this,e]),t)}take(e){return e<0||null==e?this:new dOe(this,e)}skip(e){return e<0||null==e?this:new cOe(this,e)}prefetch(e){return new _Oe(this,e)}shuffle(e,t){return new kOe(this,e,t)}serial(){return new uOe(this)}}class sOe extends oOe{constructor(e){super(),this.items=e,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const e=this.items[this.trav];return this.trav++,{value:(t=e,ZAe(t,tOe)),done:!1};var t}}class lOe extends oOe{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message="Error thrown while iterating through a dataset: "+e.message,e}}}class uOe extends oOe{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return this.upstream.summary()+" -> Serial"}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}}class cOe extends oOe{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return this.upstream.summary()+" -> Skip"}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const e=await this.upstream.next();if(e.done)return e;jfe(e.value)}return this.upstream.next()}}class dOe extends oOe{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return this.upstream.summary()+" -> Take"}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class hOe extends oOe{constructor(e,t,n=!0){super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return this.upstream.summary()+" -> RowMajorBatch"}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){const e=[];for(;e.length<this.batchSize;){const t=await this.upstream.next();if(t.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(t.value)}return{value:e,done:!1}}}class fOe extends oOe{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return this.upstream.summary()+" -> Filter"}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){const e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;jfe(e.value)}}}class pOe extends oOe{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return this.upstream.summary()+" -> Map"}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=_.getTensorsInContainer(e.value),n=this.transform(e.value),r=_.getTensorsInContainer(n);for(const i of t)_.isTensorInList(i,r)||i.dispose();return{value:n,done:!1}}}class mOe extends oOe{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return this.upstream.summary()+" -> handleErrors"}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}}class gOe extends oOe{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return this.upstream.summary()+" -> AsyncMap"}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=_.getTensorsInContainer(e.value),n=await this.transform(e.value),r=_.getTensorsInContainer(n);for(const i of t)_.isTensorInList(i,r)||i.dispose();return{value:n,done:!1}}}class vOe extends oOe{constructor(){super(),this.outputQueue=new rOe,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;0===this.outputQueue.length();)if(!(await this.pump()))return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class yOe extends vOe{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return this.upstream.summary()+" -> Flatmap"}async pump(){const e=await this.upstream.next();if(e.done)return!1;const t=_.getTensorsInContainer(e.value),n=this.transform(e.value),r=_.getTensorsInContainer(n);this.outputQueue.pushAll(n);for(const i of t)_.isTensorInList(i,r)||i.dispose();return!0}}class bOe extends oOe{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,null==this.iterator){const e=await this.moreIterators.next();if(e.done)return{value:null,done:!0};this.iterator=e.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}}var xOe;!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(xOe||(xOe={}));class wOe extends oOe{constructor(e,t=xOe.FAIL){super(),this.iterators=e,this.mismatchMode=t,this.count=0,this.currentPromise=null}summary(){return"{TODO: fill in upstream of zip summaries} -> Zip"}async nextState(e){await e;let t=0,n=0;const r=await QAe(this.iterators,(function(e){return e instanceof oOe?{value:e.next().then(e=>(t++,e.done&&n++,e.value)),recurse:!1}:{value:null,recurse:!0}}));if(t===n)return{value:null,done:!0};if(n>0)switch(this.mismatchMode){case xOe.FAIL:throw new Error(`Zipped streams should have the same length. Mismatched at element ${this.count}.`);case xOe.SHORTEST:return{value:null,done:!0}}return this.count++,{value:r,done:!1}}async next(){return this.currentPromise=this.nextState(this.currentPromise),this.currentPromise}}class _Oe extends oOe{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new nOe(t)}summary(){return this.upstream.summary()+" -> Prefetch"}refill(){for(;!this.buffer.isFull();){const e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class kOe extends _Oe{constructor(e,t,n){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=Gge.alea(n||w.now().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(!t.done)return this.refill(),t;this.upstreamExhausted=!0}return{value:null,done:!0}}}class EOe{constructor(){this.size=null}batch(e,t=!0){const n=this;let r;return w.assert(e>0,()=>"batchSize needs to be positive, but it is\n      "+e),r=this.size===1/0||null==this.size?this.size:t?Math.ceil(this.size/e):Math.floor(this.size/e),SOe(async()=>(await n.iterator()).columnMajorBatch(e,t,IOe),r)}concatenate(e){const t=this;let n;return n=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,SOe(async()=>(await t.iterator()).concatenate(await e.iterator()),n)}filter(e){const t=this;let n;return n=this.size===1/0?1/0:null,SOe(async()=>(await t.iterator()).filter(t=>Nfe(()=>e(t))),n)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){const t=this;return SOe(async()=>(await t.iterator()).map(t=>Nfe(()=>e(t))),this.size)}mapAsync(e){const t=this;return SOe(async()=>(await t.iterator()).mapAsync(e),this.size)}prefetch(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const t=this;return SOe(async()=>(await t.iterator()).prefetch(e),this.size)}repeat(e){const t=this;let n;return n=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,SOe(async()=>{return n=aOe(async()=>({value:await t.iterator(),done:!1})).take(e),new bOe(n,undefined);var n},n)}skip(e){const t=this;let n;return n=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,SOe(async()=>(await t.iterator()).skip(e),n)}shuffle(e,t,n=!0){if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);const r=this,i=Gge.alea(t||w.now().toString());return SOe(async()=>{let t=i.int32();return n&&(t+=i.int32()),(await r.iterator()).shuffle(e,t.toString())},this.size)}take(e){const t=this;let n;return n=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,SOe(async()=>(await t.iterator()).take(e),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function SOe(e,t=null){return new class extends EOe{constructor(){super(...arguments),this.size=t}async iterator(){return e()}}}function TOe(e){return SOe(async()=>iOe(e),e.length)}function COe(e){if(!eOe(e))throw new Error("The argument to zip() must be an object or array.");let t;if(Array.isArray(e))for(let n=0;n<e.length;n++)t=null==t?e[n].size:Math.min(t,e[n].size);else if(e instanceof Object)for(const n in e)t=null==t?e[n].size:Math.min(t,e[n].size);return SOe(async()=>function(e,t=xOe.FAIL){return new wOe(e,t)}(await QAe(e,e=>{if(e instanceof EOe)return{value:e.iterator(),recurse:!1};if(eOe(e))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")}),xOe.SHORTEST),t)}function IOe(e){return null===e?null:null==(t=e[0])||null===(n=t)||"object"!=typeof n&&"function"!=typeof n||Array.isArray(t)||"object"==typeof t&&t instanceof Gce||w.isTypedArray(t)?{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof Gce?Ove(e):kde(e)}(e),recurse:!1}:{value:null,recurse:!0};var t,n}EOe.MAX_BUFFER_SIZE=1e4;class AOe extends EOe{constructor(e){super(),this.input=e}async iterator(){return(await this.input.iterator()).decodeUTF8().split("\n").map(e=>(e.endsWith("\r")&&(e=e.slice(0,-1)),e))}}const OOe='"',DOe=Symbol("out"),MOe=Symbol("field"),NOe=Symbol("quote"),jOe=Symbol("quoteafterquote"),FOe=Symbol("quoteinquote");class ROe extends EOe{constructor(e,t){super(),this.input=e,this.hasHeader=!0,this.fullColumnNames=null,this.columnNamesValidated=!1,this.columnConfigs=null,this.configuredColumnsOnly=!1,this.delimiter=",",this.delimWhitespace=!1,this.base=new AOe(e),t||(t={}),this.hasHeader=!1!==t.hasHeader,this.fullColumnNames=t.columnNames,this.columnConfigs=t.columnConfigs,this.configuredColumnsOnly=t.configuredColumnsOnly,t.delimWhitespace?(w.assert(null==t.delimiter,()=>"Delimiter should not be provided when delimWhitespace is true."),this.delimWhitespace=!0,this.delimiter=" "):this.delimiter=t.delimiter?t.delimiter:","}async columnNames(){return this.columnNamesValidated||await this.setColumnNames(),this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames}async setColumnNames(){const e=await this.maybeReadHeaderLine();if(!this.fullColumnNames&&!e)throw new Error("Column names must be provided if there is no header line.");this.fullColumnNames&&e&&w.assert(e.length===this.fullColumnNames.length,()=>"The length of provided columnNames ("+this.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+e.length.toString()+")."),this.fullColumnNames||(this.fullColumnNames=e);const t=this.fullColumnNames.reduce((e,t)=>(e[t]=e[t]+1||1,e),{}),n=Object.keys(t).filter(e=>t[e]>1);if(w.assert(0===n.length,()=>"Duplicate column names found: "+n.toString()),this.columnConfigs)for(const r of Object.keys(this.columnConfigs))if(-1===this.fullColumnNames.indexOf(r))throw new Error('The key "'+r+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");this.columnNamesValidated=!0}async maybeReadHeaderLine(){if(this.hasHeader){const e=await this.base.iterator(),t=await e.next();if(t.done)throw new Error("No data was found for CSV parsing.");return this.parseRow(t.value,!1)}return null}async iterator(){this.columnNamesValidated||await this.setColumnNames();let e=await this.base.iterator();return this.hasHeader&&(e=e.skip(1)),e.map(e=>this.makeDataElement(e))}makeDataElement(e){const t=this.parseRow(e),n={},r={};for(let i=0;i<this.fullColumnNames.length;i++){const a=this.fullColumnNames[i],o=this.columnConfigs?this.columnConfigs[a]:null;if(!this.configuredColumnsOnly||o){const s=t[i];let l=null;if(""===s)if(o&&void 0!==o.default)l=o.default;else{if(o&&(o.required||o.isLabel))throw new Error(`Required column ${a} is empty in this line: ${e}`);l=void 0}else{const e=Number(s);if(isNaN(e))l=o&&"bool"===o.dtype?this.getBoolean(s):s;else if(o&&o.dtype)switch(o.dtype){case"float32":l=e;break;case"int32":l=Math.floor(e);break;case"bool":l=this.getBoolean(s);break;default:l=e}else l=e}o&&o.isLabel?r[a]=l:n[a]=l}}return 0===Object.keys(r).length?n:{xs:n,ys:r}}getBoolean(e){return"1"===e||"true"===e.toLowerCase()?1:0}parseRow(e,t=!0){const n=[];let r=0;const i=e.length;let a=DOe;for(let o=0;o<i;o++)switch(a){case DOe:switch(e.charAt(o)){case OOe:r=o+1,a=NOe;break;case this.delimiter:if(r=o+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),a=DOe;break;default:a=MOe,r=o}break;case MOe:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o)),a=DOe,r=o+1}break;case NOe:switch(e.charAt(o)){case OOe:a=jOe}break;case jOe:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o-1)),a=DOe,r=o+1;break;case OOe:a=NOe;break;default:a=FOe}break;case FOe:switch(e.charAt(o)){case OOe:a=NOe}}if(n.push(a===jOe?e.substring(r,i-1):e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error(`Invalid row in csv file. Should have ${this.fullColumnNames.length} elements in a row, but got ${n}`);return n}}class POe extends oOe{constructor(e){super(),this.microphoneConfig=e,this.isClosed=!1,this.fftSize=e.fftSize||1024;const t=Math.log2(this.fftSize);if(this.fftSize<0||t<4||t>14||!Number.isInteger(t))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got "+this.fftSize);if(this.numFrames=e.numFramesPerSpectrogram||43,this.sampleRateHz=e.sampleRateHz,this.columnTruncateLength=e.columnTruncateLength||this.fftSize,this.audioTrackConstraints=e.audioTrackConstraints,this.smoothingTimeConstant=e.smoothingTimeConstant||0,this.includeSpectrogram=!1!==e.includeSpectrogram,this.includeWaveform=!0===e.includeWaveform,!this.includeSpectrogram&&!this.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.")}summary(){return"microphone"}static async create(e={}){if(xse().get("IS_NODE"))throw new Error("microphone API is only supported in browser environment.");const t=new POe(e);return await t.start(),t}async start(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1})}catch(n){throw new Error("Error thrown while initializing video stream: "+n.message)}if(!this.stream)throw new Error("Could not obtain audio from microphone.");const e=window.AudioContext||window.webkitAudioContext;if(this.audioContext=new e,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error(`Mismatch in sampling rate: Expected: ${this.sampleRateHz}; Actual: `+this.audioContext.sampleRate)}else this.sampleRateHz=this.audioContext.sampleRate;const t=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,t.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize)}async next(){if(this.isClosed)return{value:null,done:!0};let e,t;const n=await this.getAudioData();if(this.includeSpectrogram){const t=this.flattenQueue(n.freqDataQueue);e=this.getTensorFromAudioDataArray(t,[this.numFrames,this.columnTruncateLength,1])}if(this.includeWaveform){const e=this.flattenQueue(n.timeDataQueue);t=this.getTensorFromAudioDataArray(e,[this.numFrames*this.fftSize,1])}return{value:{spectrogram:e,waveform:t},done:!1}}async capture(){return(await this.next()).value}async getAudioData(){const e=[],t=[];let n=0;return new Promise(r=>{const i=setInterval(()=>{this.includeSpectrogram&&(this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0&&r({freqDataQueue:e,timeDataQueue:t}),e.push(this.freqData.slice(0,this.columnTruncateLength))),this.includeWaveform&&(this.analyser.getFloatTimeDomainData(this.timeData),t.push(this.timeData.slice())),++n===this.numFrames&&(clearInterval(i),r({freqDataQueue:e,timeDataQueue:t}))},this.fftSize/this.sampleRateHz*1e3)})}stop(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}toArray(){throw new Error("Can not convert infinite audio stream to array.")}getSampleRate(){return this.sampleRateHz}flattenQueue(e){const t=e[0].length,n=new Float32Array(e.length*t);return e.forEach((e,r)=>n.set(e,r*t)),n}getTensorFromAudioDataArray(e,t){const n=new Float32Array(w.sizeFromShape(t));return n.set(e,n.length-e.length),kde(n,t)}}class LOe extends oOe{constructor(e,t){if(super(),this.webcamVideoElement=e,this.webcamConfig=t,this.isClosed=!0,this.resize=!1,this.needToResize())if(this.resize=!0,this.cropSize=[this.webcamConfig.resizeHeight,this.webcamConfig.resizeWidth],this.cropBoxInd=jve([0],"int32"),this.webcamConfig.centerCrop){const e=1*this.webcamConfig.resizeWidth/this.webcamVideoElement.width,t=1*this.webcamConfig.resizeHeight/this.webcamVideoElement.height,n=(1-e)/2,r=(1-t)/2;this.cropBox=Fve([r,n,t+r,n+e],[1,4])}else this.cropBox=Fve([0,0,1,1],[1,4])}summary(){return"webcam"}static async create(e,t={}){if(xse().get("IS_NODE"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!e){if(e=document.createElement("video"),!t.resizeWidth||!t.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");e.width=t.resizeWidth,e.height=t.resizeHeight}const n=new LOe(e,t);return await n.start(),n}async start(){this.webcamConfig.facingMode&&w.assert("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,()=>`Invalid webcam facing mode: ${this.webcamConfig.facingMode}. Please provide 'user' or 'environment'`);try{this.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})}catch(e){throw e.message="Error thrown while initializing video stream: "+e.message,e}if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(t){console.log(t),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,new Promise(e=>{this.webcamVideoElement.onloadedmetadata=()=>{e()}})}async next(){if(this.isClosed)return{value:null,done:!0};let e;try{e=T.fromPixels(this.webcamVideoElement)}catch(t){throw new Error("Error thrown converting video to pixels: "+JSON.stringify(t))}if(!this.resize)return{value:e,done:!1};try{return{value:this.cropAndResizeFrame(e),done:!1}}catch(t){throw new Error("Error thrown cropping the video: "+t.message)}finally{e.dispose()}}needToResize(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)}cropAndResizeFrame(e){return Nfe(()=>{const t=e.toFloat().expandDims(0);let n;return n=hbe.cropAndResize(t,this.cropBox,this.cropBoxInd,this.cropSize,"bilinear"),n.reshape(n.shape.slice(1))})}async capture(){return(await this.next()).value}stop(){this.stream.getTracks().forEach(e=>e.stop());try{this.webcamVideoElement.srcObject=null}catch(e){console.log(e),this.webcamVideoElement.src=null}this.isClosed=!0}toArray(){throw new Error("Can not convert infinite video stream to array.")}}class BOe{}class $Oe extends oOe{split(e){return new zOe(this,e)}}class zOe extends $Oe{constructor(e,t){super(),this.upstream=e,this.impl=new UOe(e,t)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class UOe extends vOe{constructor(e,t){super(),this.upstream=e,this.separator=t,this.carryover=""}summary(){return`${this.upstream.summary()} -> Split('${this.separator}')`}async pump(){const e=await this.upstream.next();if(e.done)return""!==this.carryover&&(this.outputQueue.push(this.carryover),this.carryover="",!0);const t=e.value.split(this.separator);t[0]=this.carryover+t[0];for(const n of t.slice(0,-1))this.outputQueue.push(n);return this.carryover=t[t.length-1],!0}}class HOe extends oOe{decodeUTF8(){return new WOe(this)}}class WOe extends $Oe{constructor(e){super(),this.upstream=e,this.impl=new VOe(e)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class VOe extends vOe{constructor(e){if(super(),this.upstream=e,xse().get("IS_BROWSER"))this.decoder=new TextDecoder("utf-8");else{const{StringDecoder:e}=n(4);this.decoder=new e("utf8")}}summary(){return this.upstream.summary()+" -> Utf8"}async pump(){const e=await this.upstream.next();let t,n;return!e.done&&(t=e.value,n=xse().get("IS_BROWSER")?this.decoder.decode(t,{stream:!0}):this.decoder.write(Buffer.from(t.buffer)),this.outputQueue.push(n),!0)}}class qOe extends HOe{constructor(e,t={}){super(),this.file=e,this.options=t,w.assert(e instanceof Uint8Array||!!xse().get("IS_BROWSER")&&(e instanceof File||e instanceof Blob),()=>"FileChunkIterator only supports File, Blob and Uint8Array right now."),this.offset=t.offset||0,this.chunkSize=t.chunkSize||1048576}summary(){return"FileChunks "+this.file}async next(){if(this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size))return{value:null,done:!0};const e=new Promise((e,t)=>{const n=this.offset+this.chunkSize;if(this.file instanceof Uint8Array)e(new Uint8Array(this.file.slice(this.offset,n)));else{const r=new FileReader;r.onload=n=>{let i=r.result;if(i instanceof ArrayBuffer&&(i=new Uint8Array(i)),!(i instanceof Uint8Array))return t(new TypeError("FileReader returned unknown type."));e(i)},r.onabort=e=>t(new Error("Aborted")),r.onerror=e=>t(new Error(e.type));const i=this.file.slice(this.offset,n);r.readAsArrayBuffer(i)}this.offset=n});return{value:await e,done:!1}}}function GOe(e){return"string"==typeof e&&"file://"===e.substr(0,7)}class YOe extends BOe{constructor(e,t={}){super(),this.input=e,this.options=t}async iterator(){if(GOe(this.input)&&xse().get("IS_NODE")){const e=n(5);this.input=e.readFileSync(this.input.substr(7))}return new qOe(this.input,this.options)}}class XOe extends BOe{constructor(e,t={}){super(),this.url=e,this.fileOptions=t}async iterator(){return GOe(this.url)?new YOe(this.url,this.fileOptions).iterator():async function(e,t={}){let n,r;var i;"string"==typeof e?n=e:(n=e.url,r={method:(i=e).method,headers:i.headers,body:i.body,mode:i.mode,credentials:i.credentials,cache:i.cache,redirect:i.redirect,referrer:i.referrer,integrity:i.integrity});const a=await w.fetch(n,r);if(a.ok){const e=new Uint8Array(await a.arrayBuffer());return new qOe(e,t)}throw new Error(a.statusText)}(this.url,this.fileOptions)}}function KOe(e,t={}){return new ROe(new XOe(e),t)}function ZOe(e){const t=aOe(e);return SOe(async()=>t)}function JOe(e){return SOe(async()=>{const t=await e();return aOe(()=>t.next())})}async function QOe(e,t){return LOe.create(e,t)}async function eDe(e){return POe.create(e)}const tDe="2.8.2";function nDe(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{null!=e&&w.assert("complex64"!==e.dtype,()=>t+" does not support complex64 tensors in the CPU backend.")})}const rDe=F.whereImpl;class iDe extends Toe{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new Soe(this,Ofe())}write(e,t,n){this.firstUse&&(this.firstUse=!1,xse().get("IS_NODE")&&j.warn("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));const r={};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&w.isString(n[0])){const i=n.map(e=>w.encodeString(e));r=this.write(i,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}incRef(e){this.data.get(e).refCount++}decRef(e){this.data.has(e)&&this.data.get(e).refCount--}move(e,t,n,r){this.data.set(e,{values:t,dtype:r,refCount:1})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:n}=this.data.get(e);if("complex64"===t){const e=this.readSync(n.real.dataId),t=this.readSync(n.imag.dataId);return j.mergeRealAndImagArrays(e,t)}return this.data.get(e).values}bufferSync(e){const t=this.readSync(e.dataId);let n=t;if("string"===e.dtype)try{n=t.map(e=>w.decodeString(e))}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return mhe(e.shape,e.dtype,n)}makeOutput(e,t,n){const r=this.write(e,t,n);return Ofe().makeTensorFromDataId(r,t,n,this)}disposeData(e){if(this.data.has(e)){const{complexTensorInfos:t}=this.data.get(e);null!=t&&(this.disposeData(t.real.dataId),this.disposeData(t.imag.dataId)),this.data.delete(e)}}disposeIntermediateTensorInfo(e){const t=e.dataId;if(this.data.has(t)){const e=this.data.get(t);e.refCount--,e.refCount<1&&this.disposeData(t)}}async time(e){const t=w.now();return e(),{kernelMs:w.now()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){nDe([e],"where");const t=this.readSync(e.dataId);return rDe(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}function aDe(e,t,n){return({inputs:r,attrs:i,backend:a})=>{const{x:o}=r;if(nDe(o,e),"string"===o.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const s=a,l=s.data.get(o.dataId).values,u=w.sizeFromShape(o.shape),c=n||o.dtype,d=w.getArrayFromDType(c,u);for(let e=0;e<u;++e)d[e]=t(l[e],i);return s.makeTensorInfo(o.shape,c,d)}}function oDe(e,t,n){return({inputs:r,attrs:i,backend:a})=>{const{x:o}=r;if(nDe(o,e),"string"===o.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const s=a,l=s.data.get(o.dataId).values,u=n||o.dtype,c=t(l,u,i);return s.makeTensorInfo(o.shape,u,c)}}Hfe("cpu",()=>new iDe,1);const sDe=aDe(ble,e=>e>=0?e:Math.exp(e)-1),lDe={kernelName:ble,backendName:"cpu",kernelFunc:sDe};function uDe(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const cDe={kernelName:Rle,backendName:"cpu",kernelFunc:uDe};function dDe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{alpha:a}=r;nDe([i],"leakyRelu");const o=w.sizeFromShape(i.shape),s=n.data.get(i.dataId).values,l=w.getTypedArrayFromDType("float32",o);for(let u=0;u<s.length;u++)l[u]=s[u]<0?a*s[u]:s[u];return n.makeTensorInfo(i.shape,"float32",l)}const hDe={kernelName:Ule,backendName:"cpu",kernelFunc:dDe};function fDe(e){return(t,n,r,i,a)=>{const o=j.assertAndGetBroadcastShape(t,n),s=o.length,l=w.computeStrides(o),u=w.sizeFromShape(o),c=w.getTypedArrayFromDType(a,u),d=t.length,h=n.length,f=w.computeStrides(t),p=w.computeStrides(n),m=j.getBroadcastDims(t,o),g=j.getBroadcastDims(n,o);if(m.length+g.length===0)for(let v=0;v<c.length;++v)c[v]=e(r[v%r.length],i[v%i.length]);else for(let v=0;v<c.length;++v){const t=w.indexToLoc(v,s,l),n=t.slice(-d);m.forEach(e=>n[e]=0);const a=w.locToIndex(n,d,f),o=t.slice(-h);g.forEach(e=>o[e]=0);const u=w.locToIndex(o,h,p);c[v]=e(r[a],i[u])}return[c,o]}}const pDe=fDe((e,t)=>e<0?t*e:e);function mDe(e){const{inputs:t,backend:n}=e,{x:r,alpha:i}=t;nDe([r,i],"prelu");const a=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,[s,l]=pDe(r.shape,i.shape,a,o,r.dtype);return n.makeTensorInfo(l,r.dtype,s)}const gDe={kernelName:Sue,backendName:"cpu",kernelFunc:mDe},vDe=aDe(Oue,e=>Math.max(0,e)),yDe={kernelName:Oue,backendName:"cpu",kernelFunc:vDe},bDe=aDe(Rue,e=>Math.min(Math.max(0,e),6)),xDe={kernelName:Rue,backendName:"cpu",kernelFunc:bDe};function wDe(e,t,n,r,i){if("linear"===n)return uDe({inputs:{x:t},backend:e});if("relu"===n)return vDe({inputs:{x:t},backend:e});if("elu"===n)return sDe({inputs:{x:t},backend:e});if("relu6"===n)return bDe({inputs:{x:t},backend:e});if("prelu"===n)return mDe({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return dDe({inputs:{x:t},backend:e,attrs:{alpha:i}});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}function _De(e){const{inputs:t,backend:n}=e,{real:r,imag:i}=t,a=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",a),imag:n.makeTensorInfo(i.shape,"float32",o)},s}const kDe={kernelName:Kse,backendName:"cpu",kernelFunc:_De};function EDe(e,t,n="float32"){if("complex64"===n)return _De({inputs:{real:EDe(e,t,"float32"),imag:EDe(e,t,"float32")},backend:e});const r=w.makeZerosTypedArray(w.sizeFromShape(t),n);return e.makeTensorInfo(t,n,r)}function SDe(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.data.get(r.dataId).complexTensorInfos.real,a=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,a)}const TDe={kernelName:Iue,backendName:"cpu",kernelFunc:SDe};function CDe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dtype:a}=r;if("complex64"===a){if("complex64"===i.dtype)return uDe({inputs:{x:i},backend:n});const e=EDe(n,i.shape,i.dtype),t=CDe({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),r=_De({inputs:{real:t,imag:e},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),r}if("complex64"===i.dtype){const e=SDe({inputs:{input:i},backend:n}),t=CDe({inputs:{x:e},backend:n,attrs:{dtype:a}});return n.disposeIntermediateTensorInfo(e),t}if(!w.hasEncodingLoss(i.dtype,a)){const e=uDe({inputs:{x:i},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:a}}if("int32"===a){const e=n.data.get(i.dataId).values,t=Int32Array.from(e);return n.makeTensorInfo(i.shape,"int32",t)}if("bool"===a){const e=n.data.get(i.dataId).values,t=w.toTypedArray([0],i.dtype),[r,a]=fDe((e,t)=>e!==t?1:0)(i.shape,[],e,t,"bool");return n.makeTensorInfo(a,"bool",r)}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${a}`)}const IDe={kernelName:Gse,backendName:"cpu",kernelFunc:CDe};function ADe(e,t,n,r){return null==n?({inputs:n,backend:i})=>{const{a:a,b:o}=n,s=i;nDe([a,o],e);const l=s.data.get(a.dataId).values,u=s.data.get(o.dataId).values,c=r||a.dtype,[d,h]=t(a.shape,o.shape,l,u,c);return s.makeTensorInfo(h,c,d)}:({inputs:e,backend:i})=>{const{a:a,b:o}=e,s=i;if("complex64"===a.dtype||"complex64"===o.dtype){const e=CDe({inputs:{x:a},backend:s,attrs:{dtype:"complex64"}}),t=s.data.get(e.dataId),r=t.complexTensorInfos.imag,i=s.data.get(t.complexTensorInfos.real.dataId).values,l=s.data.get(r.dataId).values,u=CDe({inputs:{x:o},backend:s,attrs:{dtype:"complex64"}}),c=s.data.get(u.dataId),d=c.complexTensorInfos.imag,h=s.data.get(c.complexTensorInfos.real.dataId).values,f=s.data.get(d.dataId).values,[p,m,g]=n(a.shape,o.shape,i,l,h,f),v=s.makeTensorInfo(g,"float32",p),y=s.makeTensorInfo(g,"float32",m),b=_De({inputs:{real:v,imag:y},backend:s});return s.disposeIntermediateTensorInfo(e),s.disposeIntermediateTensorInfo(u),s.disposeIntermediateTensorInfo(v),s.disposeIntermediateTensorInfo(y),b}{const e=s.data.get(a.dataId).values,n=s.data.get(o.dataId).values,i=r||a.dtype,[l,u]=t(a.shape,o.shape,e,n,i);return s.makeTensorInfo(u,i,l)}}}function ODe(e){return(t,n,r,i,a,o)=>{const s=j.assertAndGetBroadcastShape(t,n),l=w.sizeFromShape(s),u=s.length,c=w.computeStrides(s),d=w.getTypedArrayFromDType("float32",l),h=w.getTypedArrayFromDType("float32",l),f=j.getBroadcastDims(t,s),p=j.getBroadcastDims(n,s),m=j.mergeRealAndImagArrays(r,i),g=j.mergeRealAndImagArrays(a,o),v=t.length,y=w.computeStrides(t),b=n.length,x=w.computeStrides(n);if(f.length+p.length===0)for(let w=0;w<d.length;w++){const t=w%m.length,n=w%g.length,r=e(m[2*t],m[2*t+1],g[2*n],g[2*n+1]);d[w]=r.real,h[w]=r.imag}else for(let _=0;_<d.length;_++){const t=w.indexToLoc(_,u,c),n=t.slice(-v);f.forEach(e=>n[e]=0);const r=w.locToIndex(n,v,y),i=t.slice(-b);p.forEach(e=>i[e]=0);const a=w.locToIndex(i,b,x),o=e(m[2*r],m[2*r+1],g[2*a],g[2*a+1]);d[_]=o.real,h[_]=o.imag}return[d,h,s]}}const DDe=fDe((e,t)=>e+t),MDe=ODe((e,t,n,r)=>({real:e+n,imag:t+r})),NDe=ADe(Ise,DDe,MDe),jDe={kernelName:Ise,backendName:"cpu",kernelFunc:NDe};function FDe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{shape:a}=r,o=w.sizeFromShape(i.shape),s=w.inferFromImplicitShape(a,o),l=w.sizeFromShape(s);w.assert(o===l,()=>`The new shape (${s}) has ${l} elements and the old shape (${i.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),n.incRef(i.dataId);const u=n.data.get(i.dataId);if(null!=u.complexTensorInfos){const e=u.complexTensorInfos.imag;u.complexTensorInfos.real.shape=s,e.shape=s}return{dataId:i.dataId,shape:s,dtype:i.dtype}}const RDe={kernelName:Due,backendName:"cpu",kernelFunc:FDe};function PDe(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:a}=t,{transposeA:o,transposeB:s}=r;nDe([i,a],"matMul");const l=i.shape.length,u=a.shape.length,c=o?i.shape[l-2]:i.shape[l-1],d=s?a.shape[u-1]:a.shape[u-2],h=o?i.shape[l-1]:i.shape[l-2],f=s?a.shape[u-2]:a.shape[u-1],p=i.shape.slice(0,-2),m=a.shape.slice(0,-2),g=w.sizeFromShape(p),v=w.sizeFromShape(m);w.assert(l>=2&&u>=2&&(g===v||1===g||1===v),()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${p}) and (${m}).`);const y=(g>v?i.shape.slice(0,-2):a.shape.slice(0,-2)).concat([h,f]);w.assert(c===d,()=>`Error in matMul: inner shapes (${c}) and (${d}) of Tensors with shapes ${i.shape} and ${a.shape} and transposeA=${o} and transposeB=${s} must match.`);const b=s?[v,f,d]:[v,d,f],x=FDe({inputs:{x:i},backend:n,attrs:{shape:o?[g,c,h]:[g,h,c]}}),_=FDe({inputs:{x:a},backend:n,attrs:{shape:b}}),k=o?x.shape[1]:x.shape[2],E=o?x.shape[2]:x.shape[1],S=s?_.shape[1]:_.shape[2],T=Math.max(g,v),C=n.data.get(x.dataId).values,I=n.data.get(_.dataId).values,A=w.computeStrides(x.shape),O=w.computeStrides(_.shape),[D,M,N]=o?[A[0],1,A[1]]:[A[0],A[1],1],[j,F,R]=s?[1,O[1],O[0]]:[O[1],1,O[0]],P=E*S,L=mhe([T,E,S],x.dtype),B=L.values,$=n.blockSize;for(let w=0;w<T;w++)for(let e=0;e<E;e+=$)for(let t=0;t<S;t+=$)for(let n=0;n<k;n+=$){const r=Math.min(e+$,E),i=Math.min(t+$,S),a=Math.min(n+$,k);for(let o=e;o<r;o++)for(let e=t;e<i;e++){let t=0;for(let r=n;r<a;r++){const n=Math.min(w,g-1)*D,i=Math.min(w,v-1)*R;t+=C[n+o*M+r*N]*I[r*j+e*F+i]}B[w*P+(o*S+e)]+=t}}return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(_),n.makeTensorInfo(y,L.dtype,L.values)}const LDe={kernelName:Hse,backendName:"cpu",kernelFunc:PDe},BDe={kernelName:vce,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:a,bias:o,preluActivationWeights:s}=t,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:d}=r;let h,f,p;const m=[];h=PDe({inputs:{a:i,b:a},attrs:{transposeA:l,transposeB:u},backend:n}),o&&(f=NDe({inputs:{a:h,b:o},backend:n}),m.push(h),h=f),c&&(p=wDe(n,h,c,s,d),m.push(h),h=p);for(const g of m)n.disposeIntermediateTensorInfo(g);return h}};function $De(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}const zDe={kernelName:Sse,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend;nDe(t,"abs");let r=new Float32Array(w.sizeFromShape(t.shape));return r=$De(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,"float32")}},UDe=aDe(Tse,e=>Math.acos(e)),HDe={kernelName:Tse,backendName:"cpu",kernelFunc:UDe},WDe=aDe(Cse,e=>Math.acosh(e)),VDe={kernelName:Cse,backendName:"cpu",kernelFunc:WDe},qDe={kernelName:Ase,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,r=t;nDe(t,"addN");const i=r.map(e=>n.data.get(e.dataId).values),a=mhe(r[0].shape,r[0].dtype),o=a.values;for(let s=0;s<r.length;s++){const e=i[s];for(let t=0;t<o.length;t++)o[t]+=e[t]}return n.makeTensorInfo(a.shape,a.dtype,a.values)}};function GDe(e,t,n,r,i){const a=t.length,o=w.sizeFromShape(t),s=w.computeStrides(t),l=w.computeStrides(i),u=w.getTypedArrayFromDType(n,w.sizeFromShape(i));for(let c=0;c<o;++c){const t=w.indexToLoc(c,a,s),n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t[r[e]];u[w.locToIndex(n,a,l)]=e[c]}return u}function YDe(e){const{inputs:t,attrs:n,backend:r}=e,{x:i}=t,{perm:a}=n;nDe(i,"transpose");const o=new Array(i.shape.length);for(let l=0;l<o.length;l++)o[l]=i.shape[a[l]];const s=GDe(r.data.get(i.dataId).values,i.shape,i.dtype,a,o);return{dataId:r.write(s,o,i.dtype),shape:o,dtype:i.dtype}}const XDe={kernelName:uce,backendName:"cpu",kernelFunc:YDe},KDe={kernelName:Ose,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:o}=r;nDe(i,"all");const s=w.parseAxisParam(a,i.shape);let l=s;const u=j.getAxesPermutation(l,i.shape.length);let c=i;null!=u&&(c=YDe({inputs:{x:i},backend:n,attrs:{perm:u}}),l=j.getInnerMostAxes(l.length,i.shape.length)),j.assertAxesAreInnerMostDims("all",l,c.shape.length);const[d,h]=j.computeOutAndReduceShapes(c.shape,l),f=w.sizeFromShape(h),p=w.makeZerosTypedArray(w.sizeFromShape(d),c.dtype),m=n.data.get(c.dataId).values;for(let v=0;v<p.length;++v){const e=v*f;let t=m[e];for(let n=0;n<f;++n){const r=m[e+n];t=t&&r}p[v]=t}null!=u&&n.disposeIntermediateTensorInfo(c);const g=n.makeTensorInfo(d,c.dtype,p);if(o){const e=FDe({inputs:{x:g},backend:n,attrs:{shape:j.expandShapeToKeepDim(d,s)}});return n.disposeIntermediateTensorInfo(g),e}return g}},ZDe={kernelName:Dse,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:o}=r;nDe(i,"any");const s=w.parseAxisParam(a,i.shape);let l=s;const u=j.getAxesPermutation(l,i.shape.length);let c=i;null!=u&&(c=YDe({inputs:{x:i},backend:n,attrs:{perm:u}}),l=j.getInnerMostAxes(l.length,i.shape.length)),j.assertAxesAreInnerMostDims("any",l,c.shape.length);const[d,h]=j.computeOutAndReduceShapes(c.shape,l),f=w.sizeFromShape(h),p=w.makeZerosTypedArray(w.sizeFromShape(d),c.dtype),m=n.data.get(c.dataId).values;for(let v=0;v<p.length;++v){const e=v*f;let t=m[e];for(let n=0;n<f;++n){const r=m[e+n];t=t||r}p[v]=t}null!=u&&n.disposeIntermediateTensorInfo(c);const g=n.makeTensorInfo(d,c.dtype,p);if(o){const e=FDe({inputs:{x:g},backend:n,attrs:{shape:j.expandShapeToKeepDim(d,s)}});return n.disposeIntermediateTensorInfo(g),e}return g}},JDe={kernelName:Mse,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a}=r;nDe(i,"argMax");let o=w.parseAxisParam(a,i.shape);const s=j.getAxesPermutation(o,i.shape.length);let l=i;const u=[];null!=s&&(l=YDe({inputs:{x:i},backend:n,attrs:{perm:s}}),u.push(l),o=j.getInnerMostAxes(o.length,l.shape.length)),o=[o[0]],j.assertAxesAreInnerMostDims("argMax",o,l.shape.length);const[c,d]=j.computeOutAndReduceShapes(l.shape,o),h=w.sizeFromShape(c),f=w.makeZerosTypedArray(h,"int32"),p=w.sizeFromShape(d),m=n.data.get(l.dataId).values;for(let g=0;g<f.length;++g){const e=g*p;let t=m[e],n=0;for(let r=0;r<p;++r){const i=m[e+r];i>t&&(t=i,n=r)}f[g]=n}return u.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(c,"int32",f)}},QDe={kernelName:Nse,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a}=r;nDe(i,"argMin");let o=w.parseAxisParam(a,i.shape);const s=j.getAxesPermutation(o,i.shape.length);let l=i;const u=[];null!=s&&(l=YDe({inputs:{x:i},backend:n,attrs:{perm:s}}),u.push(l),o=j.getInnerMostAxes(o.length,l.shape.length)),o=[o[0]],j.assertAxesAreInnerMostDims("argMin",o,l.shape.length);const[c,d]=j.computeOutAndReduceShapes(l.shape,o),h=w.sizeFromShape(c),f=w.makeZerosTypedArray(h,"int32"),p=w.sizeFromShape(d),m=n.data.get(l.dataId).values;for(let g=0;g<f.length;++g){const e=g*p;let t=m[e],n=0;for(let r=0;r<p;++r){const i=m[e+r];i<t&&(t=i,n=r)}f[g]=n}return u.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(c,"int32",f)}},eMe=aDe(jse,e=>Math.asin(e)),tMe={kernelName:jse,backendName:"cpu",kernelFunc:eMe},nMe=aDe(Fse,e=>Math.asinh(e)),rMe={kernelName:Fse,backendName:"cpu",kernelFunc:nMe},iMe=aDe(Rse,e=>Math.atan(e)),aMe={kernelName:Rse,backendName:"cpu",kernelFunc:iMe},oMe=fDe((e,t)=>Math.atan2(e,t)),sMe=ADe(Lse,oMe),lMe={kernelName:Lse,backendName:"cpu",kernelFunc:sMe},uMe=aDe(Pse,e=>Math.atanh(e)),cMe={kernelName:Pse,backendName:"cpu",kernelFunc:uMe};function dMe(e,t,n,r,i,a){const o=i.strideHeight,s=i.strideWidth,l=i.dilationHeight,u=i.dilationWidth,c=i.effectiveFilterHeight,d=i.effectiveFilterWidth,h=i.padInfo.top,f=i.padInfo.left,p="max"===a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=mhe(i.outShape,n),g=m.values,v=i.outShape[1]*i.outShape[2]*i.outShape[3],y=i.outShape[2]*i.outShape[3],b=i.outShape[3];for(let x=0;x<i.batchSize;++x){const t=x*v,n=x*r[0];for(let m=0;m<i.inChannels;++m)for(let v=0;v<i.outHeight;++v){const x=v*o-h,w=Math.max(0,x),_=Math.min(i.inHeight,c+x),k=t+v*y;for(let t=0;t<i.outWidth;++t){const o=t*s-f,c=Math.max(0,o),h=Math.min(i.inWidth,d+o);let v=p,y=0,x=0;for(let t=w;t<_;t+=l){const i=n+t*r[1];for(let t=c;t<h;t+=u){const n=e[i+t*r[2]+m];"max"===a&&n>v?v=n:"avg"===a&&(y+=n,x++)}if(isNaN(v))break}g[k+t*b+m]="avg"===a?y/x:v}}}return m}function hMe(e,t,n,r,i=!1,a=!1){const o=mhe(r.outShape,"int32"),s=r.strideHeight,l=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,f=r.padInfo.top,p=r.padInfo.left,m=mhe(t,n,e);for(let g=0;g<r.batchSize;++g)for(let e=0;e<r.inChannels;++e)for(let t=0;t<r.outHeight;++t){const n=t*s-f;let v=n;for(;v<0;)v+=u;const y=Math.min(r.inHeight,d+n);for(let s=0;s<r.outWidth;++s){const d=s*l-p;let f=d;for(;f<0;)f+=c;const b=Math.min(r.inWidth,h+d);let x=Number.NEGATIVE_INFINITY,w=-1;for(let t=v;t<y;t+=u){const o=t-n;for(let n=f;n<b;n+=c){const s=n-d,l=m.get(g,t,n,e);l>x&&(x=l,w=i?a?((g*r.inHeight+t)*r.inWidth+n)*r.inChannels+e:(t*r.inWidth+n)*r.inChannels+e:o*h+s)}}o.set(w,g,t,s,e)}}return o}function fMe(e,t,n,r,i,a){const o=i.strideDepth,s=i.strideHeight,l=i.strideWidth,u=i.dilationDepth,c=i.dilationHeight,d=i.dilationWidth,h=i.effectiveFilterDepth,f=i.effectiveFilterHeight,p=i.effectiveFilterWidth,m=i.padInfo.front,g=i.padInfo.top,v=i.padInfo.left,y="max"===a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=mhe(i.outShape,n),x=b.values,w=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],_=i.outShape[2]*i.outShape[3]*i.outShape[4],k=i.outShape[3]*i.outShape[4],E=i.outShape[4];for(let S=0;S<i.batchSize;++S){const t=S*w,n=S*r[0];for(let b=0;b<i.inChannels;++b)for(let w=0;w<i.outDepth;++w){const S=w*o-m;let T=S;for(;T<0;)T+=u;const C=Math.min(i.inDepth,h+S),I=t+w*_;for(let t=0;t<i.outHeight;++t){const o=t*s-g;let h=o;for(;h<0;)h+=c;const m=Math.min(i.inHeight,f+o),w=I+t*k;for(let t=0;t<i.outWidth;++t){const o=t*l-v;let s=o;for(;s<0;)s+=d;const f=Math.min(i.inWidth,p+o),g=w+t*E;let _=y,k=0,S=0;for(let t=T;t<C;t+=u){const i=n+t*r[1];for(let t=h;t<m;t+=c){const n=i+t*r[2];for(let t=s;t<f;t+=d){const i=e[n+t*r[3]+b];if("max"===a&&i>_?_=i:"avg"===a&&(k+=i,S++),isNaN(_))break}if(isNaN(_))break}if(isNaN(_))break}x[g+b]="avg"===a?k/S:_}}}}return b}const pMe={kernelName:Bse,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;nDe(i,"avgPool");const{filterSize:a,strides:o,pad:s,dimRoundingMode:l}=r;w.assert(j.eitherStridesOrDilationsAreOne(o,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`);const u=j.computePool2DInfo(i.shape,a,o,1,s,l);let c;if(1===u.filterWidth&&1===u.filterHeight&&w.arraysEqual(u.inShape,u.outShape))c=uDe({inputs:{x:i},backend:n});else{const e=n.data.get(i.dataId).values,t=w.computeStrides(i.shape),r=dMe(e,0,i.dtype,t,u,"avg");c=n.makeTensorInfo(u.outShape,i.dtype,r.values)}return c}},mMe={kernelName:zse,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:a,strides:o,pad:s,dimRoundingMode:l,dataFormat:u,dilations:c}=r;nDe(i,"avgPool3d");let d=c;null==d&&(d=[1,1,1]);const h=j.computePool3DInfo(i.shape,a,o,d,s,l,u),f=fMe(n.data.get(i.dataId).values,0,i.dtype,w.computeStrides(i.shape),h,"avg");return n.makeTensorInfo(f.shape,"float32",f.values)}},gMe={kernelName:Use,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,{filterSize:o,strides:s,pad:l,dilations:u,dimRoundingMode:c}=r;nDe([i,a],"avgPool3DGrad");const d=j.computePool3DInfo(a.shape,o,s,u,l,c),h=d.strideDepth,f=d.strideHeight,p=d.strideWidth,m=d.filterDepth,g=d.filterHeight,v=d.filterWidth,y=d.dilationDepth,b=d.dilationHeight,x=d.dilationWidth,w=d.effectiveFilterDepth,_=d.effectiveFilterHeight,k=d.effectiveFilterWidth,E=w-1-d.padInfo.front,S=k-1-d.padInfo.left,T=_-1-d.padInfo.top,C=mhe(a.shape,"float32"),I=1/(m*g*v),A=n.bufferSync(i);for(let O=0;O<d.batchSize;++O)for(let e=0;e<d.inChannels;++e)for(let t=0;t<d.inDepth;++t)for(let n=0;n<d.inHeight;++n)for(let r=0;r<d.inWidth;++r){const i=t-E,a=n-T,o=r-S;let s=0;for(let t=0;t<w;t+=y){const n=(i+t)/h;if(!(n<0||n>=d.outDepth||Math.floor(n)!==n))for(let t=0;t<_;t+=b){const r=(a+t)/f;if(!(r<0||r>=d.outHeight||Math.floor(r)!==r))for(let t=0;t<k;t+=x){const i=(o+t)/p;i<0||i>=d.outWidth||Math.floor(i)!==i||(s+=A.get(O,n,r,i,e))}}}C.set(s*I,O,t,n,r,e)}return n.makeTensorInfo(C.shape,C.dtype,C.values)}},vMe={kernelName:$se,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,o=a;nDe([i,a],"avgPoolGrad");const{filterSize:s,strides:l,pad:u}=r,c=j.computePool2DInfo(o.shape,s,l,1,u),d=c.strideHeight,h=c.strideWidth,f=c.filterHeight,p=c.filterWidth,m=c.dilationHeight,g=c.dilationWidth,v=c.effectiveFilterHeight,y=c.effectiveFilterWidth,b=y-1-c.padInfo.left,x=v-1-c.padInfo.top,w=mhe(o.shape,"float32"),_=1/(f*p),k=n.data.get(i.dataId).values,E=mhe(i.shape,"float32",k);for(let S=0;S<c.batchSize;++S)for(let e=0;e<c.inChannels;++e)for(let t=0;t<c.inHeight;++t)for(let n=0;n<c.inWidth;++n){const r=t-x,i=n-b;let a=0;for(let t=0;t<v;t+=m){const n=(r+t)/d;if(!(n<0||n>=c.outHeight||Math.floor(n)!==n))for(let t=0;t<y;t+=g){const r=(i+t)/h;r<0||r>=c.outWidth||Math.floor(r)!==r||(a+=E.get(S,n,r,e))}}w.set(a*_,S,t,n,e)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}},yMe={kernelName:Dle,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,scale:a,offset:o,mean:s,variance:l}=t;w.assert(s.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),w.assert(null==o||s.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),w.assert(null==a||s.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),nDe([i,s,l,a,o],"batchNorm");let{varianceEpsilon:u}=r;null==u&&(u=.001);const c=n.data.get(i.dataId).values,d=n.data.get(s.dataId).values,h=n.data.get(l.dataId).values,f=a?n.data.get(a.dataId).values:new Float32Array([1]),p=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(c.length),g=p.length,v=f.length,y=h.length,b=d.length;let x=0,_=0,k=0,E=0;for(let w=0;w<c.length;++w)m[w]=p[x++]+(c[w]-d[_++])*f[k++]/Math.sqrt(h[E++]+u),x>=g&&(x=0),_>=b&&(_=0),k>=v&&(k=0),E>=y&&(E=0);return n.makeTensorInfo(i.shape,i.dtype,m)}};function bMe(e,t,n,r,i){const a=A.isSliceContinous(r,t,n),o=w.sizeFromShape(n),s=w.computeStrides(r);if(a){const n=A.computeFlatOffset(t,s);return"string"===i?e.slice(n,n+o):e.subarray(n,n+o)}const l=mhe(r,i,"string"===i?j.fromUint8ToStringArray(e):e),u=mhe(n,i);for(let c=0;c<u.size;++c){const e=u.indexToLoc(c),n=e.map((e,n)=>e+t[n]);u.set(l.get(...n),...e)}return"string"===i?j.fromStringArrayToUint8(u.values):u.values}function xMe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:a,size:o}=r;nDe(i,"slice");const[s,l]=A.parseSliceParams(i,a,o);A.assertParamsValid(i,s,l);const u=bMe(n.data.get(i.dataId).values,s,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,u)}const wMe={kernelName:Hue,backendName:"cpu",kernelFunc:xMe},_Me={kernelName:Wse,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:a,crops:o}=r;nDe([i],"batchToSpaceND");const s=a.reduce((e,t)=>e*t),l=j.getReshaped(i.shape,a,s),u=j.getPermuted(l.length,a.length),c=j.getReshapedPermuted(i.shape,a,s),d=j.getSliceBeginCoords(o,a.length),h=j.getSliceSize(c,o,a.length),f=FDe({inputs:{x:i},backend:n,attrs:{shape:l}}),p=YDe({inputs:{x:f},backend:n,attrs:{perm:u}}),m=FDe({inputs:{x:p},backend:n,attrs:{shape:c}}),g=xMe({inputs:{x:m},backend:n,attrs:{begin:d,size:h}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}};function kMe(e,t,n,r,i){const a=w.sizeFromShape(r),o=w.makeZerosTypedArray(i,n);for(let s=0;s<e.length;s++){const n=e[s];if(n<0)throw new Error("Input x must be non-negative!");n>=i||(o[n]+=a>0?t[s]:1)}return o}function EMe(e,t,n,r=!1){const i=e.shape[0],a=e.shape[1],o=mhe([i,n],t.dtype);for(let s=0;s<i;s++)for(let i=0;i<a;i++){const a=e.get(s,i);if(a<0)throw new Error("Input x must be non-negative!");a>=n||o.set(r?1:t.size>0?o.get(s,a)+t.get(s,i):o.get(s,a)+1,s,a)}return o}const SMe={kernelName:Vse,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:a}=t,{size:o}=r,s=kMe(n.data.get(i.dataId).values,n.data.get(a.dataId).values,a.dtype,a.shape,o);return n.makeTensorInfo([o],a.dtype,s)}};function TMe(e){return(t,n,r)=>{const i=w.getTypedArrayFromDType(n,t.length);for(let a=0;a<t.length;++a)i[a]=e(t[a],r);return i}}const CMe=TMe(e=>Math.ceil(e)),IMe=oDe(Yse,CMe),AMe={kernelName:Yse,backendName:"cpu",kernelFunc:IMe},OMe=aDe(Xse,(e,t)=>e>t.clipValueMax?t.clipValueMax:e<t.clipValueMin?t.clipValueMin:e),DMe={kernelName:Xse,backendName:"cpu",kernelFunc:OMe},MMe={kernelName:Zse,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend,r=new Float32Array(w.sizeFromShape(t.shape)),i=n.data.get(t.dataId),a=i.complexTensorInfos.imag,o=n.data.get(i.complexTensorInfos.real.dataId).values,s=n.data.get(a.dataId).values;for(let l=0;l<o.length;l++)r[l]=Math.hypot(o[l],s[l]);return n.makeOutput(r,t.shape,"float32")}};function NMe(e,t,n,r){const i=w.getArrayFromDType(n,w.sizeFromShape(t));if(r&&"string"!==n){let t=0;e.forEach(e=>{const n=w.sizeFromShape(e.shape);i.set(e.vals,t),t+=n})}else{let r=0;e.forEach(e=>{const a="string"===n?j.fromUint8ToStringArray(e.vals):e.vals;let o=0;for(let n=0;n<e.shape[0];++n){const s=n*t[1]+r;for(let t=0;t<e.shape[1];++t)i[s+t]=a[o++]}r+=e.shape[1]})}return i}function jMe(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.data.get(r.dataId).complexTensorInfos.imag,a=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,a)}const FMe={kernelName:Lle,backendName:"cpu",kernelFunc:jMe};function RMe(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r,a=w.parseAxisParam(i,t[0].shape)[0];let o=j.computeOutShape(t.map(e=>e.shape),a);if(0===w.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);const s=t.filter(e=>w.sizeFromShape(e.shape)>0);if(1===s.length)return uDe({inputs:{x:s[0]},backend:n});const l=s.map(e=>e.shape);if(j.assertParamsConsistent(l,a),"complex64"===s[0].dtype){const e=s.map(e=>SDe({inputs:{input:e},backend:n})),t=s.map(e=>jMe({inputs:{input:e},backend:n})),r=RMe({inputs:e,backend:n,attrs:{axis:a}}),i=RMe({inputs:t,backend:n,attrs:{axis:a}}),o=_De({inputs:{real:r,imag:i},backend:n});return e.forEach(e=>n.disposeIntermediateTensorInfo(e)),t.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),o}const u=s.map(e=>{const t=w.sizeFromShape(e.shape.slice(a));return FDe({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})}),c=u.map(e=>({vals:n.data.get(e.dataId).values,shape:e.shape}));o=j.computeOutShape(u.map(e=>e.shape),1);const d=NMe(c,o,t[0].dtype,1===u[0].shape[0]),h=j.computeOutShape(s.map(e=>e.shape),a),f=n.makeTensorInfo(h,t[0].dtype,d);return u.forEach(e=>n.disposeIntermediateTensorInfo(e)),f}const PMe={kernelName:Jse,backendName:"cpu",kernelFunc:RMe};function LMe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:o,pad:s,dataFormat:l,dilations:u,dimRoundingMode:c}=r;nDe([i,a],"conv2d");const d=j.convertConv2DDataFormat(l),h=j.computeConv2DInfo(i.shape,a.shape,o,u,s,c,!1,d),f=h.filterHeight,p=h.filterWidth,m=h.dilationHeight,g=h.dilationWidth,v=h.padInfo.left,y=h.padInfo.top,b="channelsLast"===h.dataFormat,x=new Hce(h.outShape,i.dtype),_=w.computeStrides(i.shape),k=w.computeStrides(a.shape),E=_[0],S=b?_[1]:_[2],T=b?_[2]:1,C=b?1:_[1],I=x.strides[0],A=b?x.strides[1]:x.strides[2],O=b?x.strides[2]:1,D=b?1:x.strides[1],M=n.data.get(i.dataId).values,N=n.data.get(a.dataId).values,F=x.values;for(let w=0;w<h.batchSize;++w){const e=w*E,t=w*I;for(let n=0;n<h.outHeight;++n){const r=t+n*A,i=n*h.strideHeight-y;for(let t=0;t<f;++t){const n=i+t*m;if(n<0||n>=h.inHeight)continue;const a=t*k[0],o=e+n*S;for(let e=0;e<h.outWidth;++e){const t=r+e*O,n=e*h.strideWidth-v;for(let e=0;e<p;++e){const r=n+e*g;if(r<0||r>=h.inWidth)continue;const i=o+r*T;let s=a+e*k[1];for(let e=0;e<h.inChannels;++e){const n=M[i+e*C];for(let e=0;e<h.outChannels;++e)F[t+e*D]+=n*N[s+e];s+=h.outChannels}}}}}}return n.makeTensorInfo(x.shape,x.dtype,F)}const BMe={kernelName:Qse,backendName:"cpu",kernelFunc:LMe},$Me={kernelName:ele,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:o,pad:s,dataFormat:l,dimRoundingMode:u,filterShape:c}=r;nDe([i,a],"conv2dBackpropFilter");const d=j.convertConv2DDataFormat(l),h=j.computeConv2DInfo(i.shape,c,o,1,s,u,!1,d),{strideHeight:f,strideWidth:p,filterHeight:m,filterWidth:g}=h,v="channelsLast"===h.dataFormat,y=new Hce(h.filterShape,"float32"),b=h.padInfo.left,x=h.padInfo.top,w=n.data.get(i.dataId).values,_=n.data.get(a.dataId).values,k=new Hce(i.shape,i.dtype,w),E=new Hce(a.shape,a.dtype,_);for(let S=0;S<m;++S){const e=Math.max(0,Math.ceil((x-S)/f)),t=Math.min(h.outHeight,(h.inHeight+x-S)/f);for(let n=0;n<g;++n){const r=Math.max(0,Math.ceil((b-n)/p)),i=Math.min(h.outWidth,(h.inWidth+b-n)/p);for(let a=0;a<h.inChannels;++a)for(let o=0;o<h.outChannels;++o){let s=0;for(let l=0;l<h.batchSize;++l)for(let u=e;u<t;++u){const e=S+u*f-x;for(let t=r;t<i;++t){const r=n+t*p-b;s+=v?k.get(l,e,r,a)*E.get(l,u,t,o):k.get(l,a,e,r)*E.get(l,o,u,t)}}y.set(s,S,n,a,o)}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}},zMe={kernelName:tle,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{inputShape:o,strides:s,pad:l,dataFormat:u,dimRoundingMode:c}=r;nDe([i,a],"conv2dBackpropInput");const d=w.computeStrides(a.shape),h=w.computeStrides(i.shape);let f=j.convertConv2DDataFormat(u);const p=j.computeConv2DInfo(o,a.shape,s,1,l,c,!1,f),m=new Hce(p.inShape,"float32"),g=m.values,v=n.data.get(i.dataId).values,y=n.data.get(a.dataId).values,[b,x,_]=d,{batchSize:k,filterHeight:E,filterWidth:S,inChannels:T,inHeight:C,inWidth:I,outChannels:A,outHeight:O,outWidth:D,strideHeight:M,strideWidth:N}=p;f=p.dataFormat;const F=E-1-p.padInfo.top,R=S-1-p.padInfo.left,P="channelsLast"===f,L=m.strides[0],B=P?m.strides[1]:m.strides[2],$=P?m.strides[2]:1,z=P?1:m.strides[1],U=h[0],H=P?h[1]:h[2],W=P?h[2]:1,V=P?1:h[1];for(let w=0;w<k;++w)for(let e=0;e<T;++e)for(let t=0;t<C;++t){const n=t-F,r=Math.max(0,Math.ceil(n/M)),i=Math.min(O,(E+n)/M);for(let a=0;a<I;++a){const o=a-R,s=Math.max(0,Math.ceil(o/N)),l=Math.min(D,(S+o)/N);let u=0;for(let t=r;t<i;++t){const r=t*M-n;for(let n=s;n<l;++n){const i=U*w+H*t+W*n,a=b*(E-1-r)+x*(S-1-(n*N-o))+_*e;for(let e=0;e<A;++e)u+=v[i+V*e]*y[a+e]}}g[L*w+B*t+$*a+z*e]=u}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}},UMe={kernelName:nle,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:o,pad:s,dilations:l}=r;nDe([i,a],"conv3d");const u=j.computeConv3DInfo(i.shape,a.shape,o,l,s),{filterDepth:c,filterHeight:d,filterWidth:h,dilationDepth:f,dilationHeight:p,dilationWidth:m,padInfo:g}=u,v=g.front,y=g.left,b=g.top,x=new Hce(u.outShape,i.dtype),_=n.data.get(i.dataId).values,k=n.data.get(a.dataId).values,E=x.values,S=w.computeStrides(i.shape),T=w.computeStrides(a.shape);for(let w=0;w<u.batchSize;++w){const e=w*S[0],t=w*x.strides[0];for(let n=0;n<u.outDepth;++n){const r=t+n*x.strides[1],i=n*u.strideDepth-v;for(let t=0;t<c;++t){const n=i+t*f;if(n<0||n>=u.inDepth)continue;const a=t*T[0],o=e+n*S[1];for(let e=0;e<u.outHeight;++e){const t=r+e*x.strides[2],n=e*u.strideHeight-b;for(let e=0;e<d;++e){const r=n+e*p;if(r<0||r>=u.inHeight)continue;const i=a+e*T[1],s=o+r*S[2];for(let e=0;e<u.outWidth;++e){const n=t+e*u.outChannels,r=e*u.strideWidth-y;for(let e=0;e<h;++e){const t=r+e*m;if(t<0||t>=u.inWidth)continue;const a=s+t*u.inChannels;let o=i+e*T[2];for(let e=0;e<u.inChannels;++e){const t=_[a+e];for(let e=0;e<u.outChannels;++e)E[n+e]+=t*k[o+e];o+=u.outChannels}}}}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}},HMe={kernelName:rle,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:o,pad:s,filterShape:l}=r;nDe([i,a],"conv3dBackpropFilterV2");const u=w.computeStrides(i.shape),c=w.computeStrides(a.shape),d=j.computeConv3DInfo(i.shape,l,o,1,s),h=d.strideDepth,f=d.strideHeight,p=d.strideWidth,m=d.filterDepth,g=d.filterHeight,v=d.filterWidth,y=new Hce(d.filterShape,"float32"),b=y.values,[x,_,k,E]=y.strides,S=n.data.get(a.dataId).values,[T,C,I,A]=c,O=n.data.get(i.dataId).values,[D,M,N,F]=u,R=d.padInfo.front,P=d.padInfo.left,L=d.padInfo.top;for(let w=0;w<m;++w){const e=Math.max(0,Math.ceil((R-w)/h)),t=Math.min(d.outDepth,(d.inDepth+R-w)/h),n=w*x;for(let r=0;r<g;++r){const i=Math.max(0,Math.ceil((L-r)/f)),a=Math.min(d.outHeight,(d.inHeight+L-r)/f),o=r*_+n;for(let n=0;n<v;++n){const s=Math.max(0,Math.ceil((P-n)/p)),l=Math.min(d.outWidth,(d.inWidth+P-n)/p),u=n*k+o;for(let o=0;o<d.inChannels;++o){const c=o*E+u;for(let u=0;u<d.outChannels;++u){let m=0;for(let c=0;c<d.batchSize;++c){const d=c*D,g=c*T;for(let c=e;c<t;++c){const e=(w+c*h-R)*M+d,t=c*C+g;for(let c=i;c<a;++c){const i=(r+c*f-L)*N+e,a=c*I+t;for(let e=s;e<l;++e)m+=O[(n+e*p-P)*F+i+o]*S[e*A+a+u]}}}b[c+u]=m}}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}},WMe={kernelName:ile,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{pad:o,strides:s,inputShape:l}=r;nDe([i],"conv3dBackpropInputV2");const u=w.computeStrides(i.shape),c=w.computeStrides(a.shape),d=j.computeConv3DInfo(l,a.shape,s,1,o),h=new Hce(d.inShape,"float32"),f=h.values,[p,m,g,v]=h.strides,y=n.data.get(i.dataId).values,[b,x,_,k]=u,E=n.data.get(a.dataId).values,[S,T,C,I]=c,{batchSize:A,filterDepth:O,filterHeight:D,filterWidth:M,inChannels:N,inDepth:F,inHeight:R,inWidth:P,outChannels:L,outDepth:B,outHeight:$,outWidth:z,strideDepth:U,strideHeight:H,strideWidth:W}=d,V=O-1-d.padInfo.front,q=D-1-d.padInfo.top,G=M-1-d.padInfo.left;for(let w=0;w<A;++w)for(let e=0;e<N;++e)for(let t=0;t<F;++t){const n=t-V,r=Math.max(0,Math.ceil(n/U)),i=Math.min(B,(O+n)/U);for(let a=0;a<R;++a){const o=a-q,s=Math.max(0,Math.ceil(o/H)),l=Math.min($,(D+o)/H);for(let u=0;u<P;++u){const c=u-G,d=Math.max(0,Math.ceil(c/W)),h=Math.min(z,(M+c)/W);let A=0;for(let t=r;t<i;++t){const r=t*U-n;for(let n=s;n<l;++n){const i=n*H-o;for(let a=d;a<h;++a){const o=b*w+x*t+_*n+k*a,s=S*(O-1-r)+T*(D-1-i)+C*(M-1-(a*W-c))+I*e;for(let e=0;e<L;++e)A+=y[o+e]*E[s+e]}}}f[p*w+m*t+g*a+v*u+e]=A}}}return n.makeTensorInfo(h.shape,h.dtype,h.values)}},VMe=aDe(ale,e=>Math.cos(e)),qMe={kernelName:ale,backendName:"cpu",kernelFunc:VMe},GMe=aDe(ole,e=>Math.cosh(e)),YMe={kernelName:ole,backendName:"cpu",kernelFunc:GMe},XMe={kernelName:lle,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:i,boxes:a,boxInd:o}=t,{cropSize:s,method:l,extrapolationValue:u}=r,[c,d,h,f]=i.shape,p=a.shape[0],[m,g]=s,v=mhe([p,m,g,f],"float32"),y=n.data.get(a.dataId).values,b=n.data.get(o.dataId).values,x=n.data.get(i.dataId).values,_=w.computeStrides(i.shape),k=w.computeStrides(v.shape);for(let w=0;w<p;w++){const e=4*w,t=y[e],n=y[e+1],r=y[e+2],i=y[e+3],a=b[w];if(a>=c)continue;const o=m>1?(r-t)*(d-1)/(m-1):0,s=g>1?(i-n)*(h-1)/(g-1):0;for(let c=0;c<m;c++){const e=m>1?t*(d-1)+c*o:.5*(t+r)*(d-1);if(e<0||e>d-1)for(let t=0;t<g;t++)for(let e=0;e<f;e++)v.values[e+t*k[2]+c*k[1]+w*k[0]]=u;else if("bilinear"===l){const t=Math.floor(e),r=Math.ceil(e),o=e-t;for(let e=0;e<g;e++){const l=g>1?n*(h-1)+e*s:.5*(n+i)*(h-1);if(l<0||l>h-1){for(let t=0;t<f;t++)v.values[t+e*k[2]+c*k[1]+w*k[0]]=u;continue}const d=Math.floor(l),p=Math.ceil(l),m=l-d;for(let n=0;n<f;n++){let i=n+d*_[2]+t*_[1]+a*_[0];const s=x[i];i=n+p*_[2]+t*_[1]+a*_[0];const l=x[i];i=n+d*_[2]+r*_[1]+a*_[0];const u=x[i];i=n+p*_[2]+r*_[1]+a*_[0];const h=x[i],f=s+(l-s)*m;i=n+e*k[2]+c*k[1]+w*k[0],v.values[i]=f+(u+(h-u)*m-f)*o}}}else for(let t=0;t<g;++t){const r=g>1?n*(h-1)+t*s:.5*(n+i)*(h-1);if(r<0||r>h-1){for(let e=0;e<f;e++)v.values[e+t*k[2]+c*k[1]+w*k[0]]=u;continue}const o=Math.round(r),l=Math.round(e);for(let e=0;e<f;e++)v.values[e+t*k[2]+c*k[1]+w*k[0]]=x[e+o*_[2]+l*_[1]+a*_[0]]}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}},KMe={kernelName:sle,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,exclusive:o,reverse:s}=r;nDe(i,"cumsum");const l=j.getAxesPermutation([a],i.shape.length);let u=i;null!=l&&(u=YDe({inputs:{x:i},backend:n,attrs:{perm:l}}));const c=j.getInnerMostAxes(1,i.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const d=tde(u.dtype,"int32"),h=w.makeZerosTypedArray(w.sizeFromShape(u.shape),d),f=n.data.get(u.dataId).values,p=u.shape[u.shape.length-1],m=s?(e,t)=>e+p-t-1:(e,t)=>e+t;for(let v=0;v<f.length;v+=p)for(let e=0;e<p;e++){const t=m(v,e);if(0===e)h[t]=o?0:f[t];else{const n=m(v,e-1);h[t]=o?f[n]+h[n]:f[t]+h[n]}}const g=n.makeTensorInfo(u.shape,d,h);if(null!=l){const e=YDe({inputs:{x:g},backend:n,attrs:{perm:j.getUndoAxesPermutation(l)}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(u),e}return g}},ZMe={kernelName:ule,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:a}=t,{size:o,binaryOutput:s}=r;if(1===i.shape.length){const e=kMe(n.data.get(i.dataId).values,n.data.get(a.dataId).values,a.dtype,a.shape,o);return n.makeTensorInfo([o],a.dtype,e)}if(2===i.shape.length){const e=EMe(n.bufferSync(i),n.bufferSync(a),o,s);return n.makeTensorInfo(e.shape,a.dtype,e.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+i.shape.length+".")}},JMe={kernelName:cle,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockSize:a,dataFormat:o}=r;w.assert("NHWC"===o,()=>"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o),w.assert(a>1,()=>"blockSize should be > 1 for depthToSpace, but was: "+a);const s=i.shape[0],l=i.shape[1],u=i.shape[2],c=i.shape[3],d=l*a,h=u*a,f=c/(a*a),p=n.data.get(i.dataId).values,m=new Float32Array(s*d*h*f);let g=0;for(let v=0;v<s;++v)for(let e=0;e<d;++e){const t=Math.floor(e/a),n=e%a;for(let e=0;e<h;++e){const r=Math.floor(e/a),i=(n*a+e%a)*f;for(let e=0;e<f;++e)m[g++]=p[e+i+c*(r+u*(t+l*v))]}}return n.makeTensorInfo([s,d,h,f],i.dtype,m)}};function QMe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:o,pad:s,dilations:l,dimRoundingMode:u}=r;nDe([i,a],"depthwiseConv2DNative");const c=w.computeStrides(i.shape),d=w.computeStrides(a.shape);let h=l;null==h&&(h=[1,1]),w.assert(j.eitherStridesOrDilationsAreOne(o,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`);const f=j.computeConv2DInfo(i.shape,a.shape,o,h,s,u,!0),{filterHeight:p,filterWidth:m,dilationHeight:g,dilationWidth:v,padInfo:y}=f,b=y.left,x=y.top,_=f.outChannels/f.inChannels,k=new Hce(f.outShape,i.dtype),E=n.data.get(i.dataId).values,S=n.data.get(a.dataId).values,T=k.values;for(let w=0;w<f.batchSize;++w){const e=w*c[0],t=w*k.strides[0];for(let n=0;n<f.outHeight;++n){const r=t+n*k.strides[1],i=n*f.strideHeight-b;for(let t=0;t<p;++t){const n=i+t*g;if(n<0||n>=f.inHeight)continue;const a=t*d[0],o=e+n*c[1];for(let e=0;e<f.outWidth;++e){const t=r+e*k.strides[2],n=e*f.strideWidth-x;for(let e=0;e<m;++e){const r=n+e*v;if(r<0||r>=f.inWidth)continue;const i=o+r*f.inChannels;let s=t,l=a+e*d[1];for(let e=0;e<f.inChannels;++e){const t=E[i+e];for(let e=0;e<_;++e)T[s+e]+=t*S[l+e];s+=_,l+=_}}}}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const eNe={kernelName:dle,backendName:"cpu",kernelFunc:QMe},tNe={kernelName:hle,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:o,dilations:s,pad:l,dimRoundingMode:u,filterShape:c}=r;nDe([i,a],"depthwiseConv2dNativeBackpropFilter");const d=j.computeConv2DInfo(i.shape,c,o,s,l,u,!0),{strideHeight:h,strideWidth:f,filterHeight:p,filterWidth:m}=d,g=new Hce(d.filterShape,"float32"),v=d.padInfo.left,y=d.padInfo.top,b=d.outChannels/d.inChannels,x=n.data.get(i.dataId).values,w=new Hce(i.shape,i.dtype,x),_=n.data.get(a.dataId).values,k=new Hce(a.shape,a.dtype,_);for(let E=0;E<p;++E){const e=Math.max(0,Math.ceil((y-E)/h)),t=Math.min(d.outHeight,(d.inHeight+y-E)/h);for(let n=0;n<m;++n){const r=Math.max(0,Math.ceil((v-n)/f)),i=Math.min(d.outWidth,(d.inWidth+v-n)/f);for(let a=0;a<d.outChannels;++a){const o=Math.trunc(a/b),s=a%b;let l=0;for(let u=0;u<d.batchSize;++u)for(let s=e;s<t;++s){const e=E+s*h-y;for(let t=r;t<i;++t)l+=w.get(u,e,n+t*f-v,o)*k.get(u,s,t,a)}g.set(l,E,n,o,s)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}},nNe={kernelName:fle,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{strides:o,dilations:s,pad:l,dimRoundingMode:u,inputShape:c}=r;nDe([i,a],"depthwiseConv2DNativeBackpropInput");const d=w.computeStrides(i.shape),h=w.computeStrides(a.shape),f=j.computeConv2DInfo(c,a.shape,o,s,l,u,!0),p=new Hce(f.inShape,"float32"),m=p.values,[g,v,y]=p.strides,b=n.data.get(i.dataId).values,[x,_,k]=d,E=n.data.get(a.dataId).values,[S,T,C]=h,{batchSize:I,filterHeight:A,filterWidth:O,inChannels:D,inHeight:M,inWidth:N,outChannels:F,outHeight:R,outWidth:P,strideHeight:L,strideWidth:B}=f,$=A-1-f.padInfo.top,z=O-1-f.padInfo.left,U=F/D;for(let w=0;w<I;++w)for(let e=0;e<D;++e)for(let t=0;t<M;++t){const n=t-$,r=Math.max(0,Math.ceil(n/L)),i=Math.min(R,(A+n)/L);for(let a=0;a<N;++a){const o=a-z,s=Math.max(0,Math.ceil(o/B)),l=Math.min(P,(O+o)/B);let u=0;for(let t=r;t<i;++t){const r=t*L-n;for(let n=s;n<l;++n){const i=x*w+_*t+k*n,a=S*(A-1-r)+T*(O-1-(n*B-o))+C*e;for(let t=0;t<U;++t)u+=b[i+(e*U+t)]*E[a+t]}}m[g*w+v*t+y*a+e]=u}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}},rNe={kernelName:ple,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,i=w.sizeFromShape(r.shape),a=n.data.get(r.dataId).values,o=mhe([i,i],r.dtype),s=o.values;for(let u=0;u<a.length;u++)s[u*i+u]=a[u];const l=[...r.shape,...r.shape];return n.makeTensorInfo(l,o.dtype,o.values)}},iNe={kernelName:mle,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:i}=e,{strides:a,pad:o,dilations:s}=n,l=t,u=l.data.get(r.dataId).values,c=r.shape.length,d=l.data.get(i.dataId).values,h=i.shape.length,{batchSize:f,inHeight:p,inWidth:m,inChannels:g,outHeight:v,outWidth:y,padInfo:b,strideHeight:x,strideWidth:_,filterHeight:k,filterWidth:E,dilationHeight:S,dilationWidth:T,outShape:C}=j.computeDilation2DInfo(r.shape,i.shape,a,o,"NHWC",s),I=w.sizeFromShape(C),A=C.length,O=w.getArrayFromDType(r.dtype,I);for(let D=0;D<f;++D)for(let e=0;e<v;++e){const t=e*x-b.top;for(let n=0;n<y;++n){const a=n*_-b.left;for(let o=0;o<g;++o){let s=Number.MIN_SAFE_INTEGER;for(let e=0;e<k;++e){const n=t+e*S;if(n>=0&&n<p)for(let t=0;t<E;++t){const l=a+t*T;if(l>=0&&l<m){const a=w.locToIndex([D,n,l,o],c,w.computeStrides(r.shape)),f=w.locToIndex([e,t,o],h,w.computeStrides(i.shape)),p=u[a]+d[f];p>s&&(s=p)}}}O[w.locToIndex([D,e,n,o],A,w.computeStrides(C))]=s}}}return{dataId:l.write(w.toTypedArray(O,r.dtype),C,r.dtype),shape:C,dtype:r.dtype}}},aNe={kernelName:vle,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:i,dy:a}=e,{strides:o,pad:s,dilations:l}=n,u=t,c=w.toNestedArray(r.shape,u.data.get(r.dataId).values),d=w.toNestedArray(i.shape,u.data.get(i.dataId).values),{batchSize:h,inHeight:f,inWidth:p,inChannels:m,outHeight:g,outWidth:v,padInfo:y,strideHeight:b,strideWidth:x,filterHeight:_,filterWidth:k,dilationHeight:E,dilationWidth:S,outShape:T}=j.computeDilation2DInfo(r.shape,i.shape,o,s,"NHWC",l);w.assert(a.rank===T.length,()=>`Error in ${vle}, dy must have the same rank as output ${T.length}, but got `+a.rank);const C=w.toNestedArray(T,u.data.get(a.dataId).values),I=w.makeZerosNestedTypedArray(i.shape,i.dtype);for(let w=0;w<h;++w)for(let e=0;e<g;++e){const t=e*b-y.top;for(let n=0;n<v;++n){const r=n*x-y.left;for(let i=0;i<m;++i){let a=Number.MIN_SAFE_INTEGER,o=0,s=0;for(let e=0;e<_;++e){const n=t+e*E;if(n>=0&&n<f)for(let t=0;t<k;++t){const l=r+t*S;if(l>=0&&l<p){const r=c[w][n][l][i]+d[e][t][i];r>a&&(a=r,o=e,s=t)}}}I[o][s][i]+=C[w][e][n][i]}}}return{dataId:u.write(w.toTypedArray(I,r.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},oNe={kernelName:gle,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:i,dy:a}=e,{strides:o,pad:s,dilations:l}=n,u=t,c=w.toNestedArray(r.shape,u.data.get(r.dataId).values),d=w.toNestedArray(i.shape,u.data.get(i.dataId).values),{batchSize:h,inHeight:f,inWidth:p,inChannels:m,outHeight:g,outWidth:v,padInfo:y,strideHeight:b,strideWidth:x,filterHeight:_,filterWidth:k,dilationHeight:E,dilationWidth:S,outShape:T}=j.computeDilation2DInfo(r.shape,i.shape,o,s,"NHWC",l);w.assert(a.rank===T.length,()=>`Error in ${gle}, dy must have the same rank as output ${T.length}, but got `+a.rank);const C=w.toNestedArray(T,u.data.get(a.dataId).values),I=w.makeZerosNestedTypedArray(r.shape,r.dtype);for(let w=0;w<h;++w)for(let e=0;e<g;++e){const t=e*b-y.top;for(let n=0;n<v;++n){const r=n*x-y.left;for(let i=0;i<m;++i){let a=Number.MIN_SAFE_INTEGER,o=t<0?0:t,s=r<0?0:r;for(let e=0;e<_;++e){const n=t+e*E;if(n>=0&&n<f)for(let t=0;t<k;++t){const l=r+t*S;if(l>=0&&l<p){const r=c[w][n][l][i]+d[e][t][i];r>a&&(a=r,o=n,s=l)}}}I[w][o][s][i]+=C[w][e][n][i]}}}return{dataId:u.write(w.toTypedArray(I,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},sNe={kernelName:xle,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{dy:r,y:i}=t;nDe([r,i],"eluGrad");const a=new Float32Array(w.sizeFromShape(i.shape)),o=n.data.get(i.dataId).values,s=n.data.get(r.dataId).values;for(let l=0;l<o.length;++l){const e=o[l];a[l]=e>=1?s[l]:s[l]*(e+1)}return n.makeTensorInfo(i.shape,"float32",a)}},lNe=fDe((e,t)=>e===t?1:0),uNe=ADe(_le,lNe,null,"bool"),cNe={kernelName:_le,backendName:"cpu",kernelFunc:uNe},dNe=j.ERF_P,hNe=j.ERF_A1,fNe=j.ERF_A2,pNe=j.ERF_A3,mNe=j.ERF_A4,gNe=j.ERF_A5,vNe=aDe(wle,e=>{const t=Math.sign(e),n=Math.abs(e),r=1/(1+dNe*n);return t*(1-((((gNe*r+mNe)*r+pNe)*r+fNe)*r+hNe)*r*Math.exp(-n*n))}),yNe={kernelName:wle,backendName:"cpu",kernelFunc:vNe},bNe=TMe(e=>Math.exp(e)),xNe=oDe(kle,bNe),wNe={kernelName:kle,backendName:"cpu",kernelFunc:xNe};function _Ne(e){const{inputs:t,backend:n,attrs:r}=e,{input:i}=t,{dim:a}=r,o=i.shape.length,s=i.shape.slice();let l=a;return a<0&&(w.assert(-(o+1)<=a,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+a+1),s.splice(l,0,1),FDe({inputs:{x:i},backend:n,attrs:{shape:s}})}const kNe={kernelName:Ele,backendName:"cpu",kernelFunc:_Ne},ENe=TMe(e=>Math.expm1(e)),SNe=oDe(Sle,ENe),TNe={kernelName:Sle,backendName:"cpu",kernelFunc:SNe},CNe=fDe((e,t)=>e*t),INe=ODe((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n})),ANe=ADe(fue,CNe,INe),ONe={kernelName:fue,backendName:"cpu",kernelFunc:ANe},DNe=fDe((e,t)=>e/t),MNe=ADe(yle,DNe),NNe={kernelName:yle,backendName:"cpu",kernelFunc:MNe},jNe=fDe((e,t)=>e-t),FNe=ODe((e,t,n,r)=>({real:e-n,imag:t-r})),RNe=ADe(nce,jNe,FNe),PNe={kernelName:nce,backendName:"cpu",kernelFunc:RNe};function LNe(e,t,n){const r=e.shape,i=r[0],a=r[1],o=n.data.get(e.dataId),s=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,u=[i,a],c=w.sizeFromShape(u),d=w.getTypedArrayFromDType("float32",c),h=w.getTypedArrayFromDType("float32",c);for(let g=0;g<i;g++){const e=xMe({inputs:{x:s},backend:n,attrs:{begin:[g,0],size:[1,a]}}),r=xMe({inputs:{x:l},backend:n,attrs:{begin:[g,0],size:[1,a]}}),i=_De({inputs:{real:e,imag:r},backend:n}),{real:o,imag:u}=BNe(i,t,n),c=j.mergeRealAndImagArrays(o,u);for(let t=0;t<a;t++){const e=j.getComplexWithIndex(c,t);d[g*a+t]=e.real,h[g*a+t]=e.imag}n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i)}const f=n.makeTensorInfo(u,"float32",d),p=n.makeTensorInfo(u,"float32",h),m=_De({inputs:{real:f,imag:p},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),m}function BNe(e,t,n){const r=w.sizeFromShape(e.shape),i=n.data.get(e.dataId),a=n.data.get(i.complexTensorInfos.real.dataId).values,o=n.data.get(i.complexTensorInfos.imag.dataId).values;if(0==((s=r)&s-1)){const i=function e(t,n,r,i,a){if(1===r)return{real:t,imag:n};const o=j.mergeRealAndImagArrays(t,n),s=r/2,l=j.complexWithEvenIndex(o),u=l.real,c=l.imag,d=[u.length],h=a.makeTensorInfo(d,"float32",u),f=a.makeTensorInfo(d,"float32",c),p=_De({inputs:{real:h,imag:f},backend:a}),m=j.complexWithOddIndex(o),g=m.real,v=m.imag,y=[g.length],b=a.makeTensorInfo(y,"float32",g),x=a.makeTensorInfo(y,"float32",v),w=_De({inputs:{real:b,imag:x},backend:a}),_=e(u,c,s,i,a),k=_.real,E=_.imag,S=[k.length],T=a.makeTensorInfo(S,"float32",k),C=a.makeTensorInfo(S,"float32",E),I=_De({inputs:{real:T,imag:C},backend:a}),A=e(g,v,s,i,a),O=A.real,D=A.imag,M=[O.length],N=a.makeTensorInfo(M,"float32",O),F=a.makeTensorInfo(M,"float32",D),R=_De({inputs:{real:N,imag:F},backend:a}),P=j.exponents(r,i),L=[P.real.length],B=a.makeTensorInfo(L,"float32",P.real),$=a.makeTensorInfo(L,"float32",P.imag),z=_De({inputs:{real:B,imag:$},backend:a}),U=ANe({inputs:{a:z,b:R},backend:a}),H=NDe({inputs:{a:I,b:U},backend:a}),W=RNe({inputs:{a:I,b:U},backend:a}),V=SDe({inputs:{input:H},backend:a}),q=SDe({inputs:{input:W},backend:a}),G=jMe({inputs:{input:H},backend:a}),Y=jMe({inputs:{input:W},backend:a}),X=RMe({inputs:[V,q],backend:a,attrs:{axis:0}}),K=RMe({inputs:[G,Y],backend:a,attrs:{axis:0}}),Z=a.data.get(X.dataId).values,J=a.data.get(K.dataId).values;return a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(w),a.disposeIntermediateTensorInfo(T),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(I),a.disposeIntermediateTensorInfo(N),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(R),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo($),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(Y),a.disposeIntermediateTensorInfo(X),a.disposeIntermediateTensorInfo(K),{real:Z,imag:J}}(a,o,r,t,n),s=[e.shape[0],e.shape[1]];if(t){const e=n.makeTensorInfo(s,"float32",i.real),t=n.makeTensorInfo(s,"float32",i.imag),a=n.makeTensorInfo([],"float32",w.createScalarValue(r,"float32")),o=uDe({inputs:{x:a},backend:n}),l=NNe.kernelFunc({inputs:{a:e,b:a},backend:n}),u=NNe.kernelFunc({inputs:{a:t,b:o},backend:n}),c=n.data.get(l.dataId).values,d=n.data.get(u.dataId).values;return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),{real:c,imag:d}}return i}{const e=function(e,t,n){const r=new Float32Array(2*t);for(let i=0;i<t;i++){let a=0,o=0;for(let r=0;r<t;r++){const s=j.exponent(i*r,t,n),l=j.getComplexWithIndex(e,r);a+=l.real*s.real-l.imag*s.imag,o+=l.real*s.imag+l.imag*s.real}n&&(a/=t,o/=t),j.assignToTypedArray(r,a,o,i)}return r}(j.mergeRealAndImagArrays(a,o),r,t);return j.splitRealAndImagArrays(e)}var s}const $Ne={kernelName:Tle,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t,i=w.sizeFromShape(r.shape),a=r.shape[r.shape.length-1],o=FDe({inputs:{x:r},backend:n,attrs:{shape:[i/a,a]}}),s=LNe(o,!1,n),l=FDe({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),l}};function zNe(e){const{backend:t,attrs:n}=e,{shape:r,value:i,dtype:a}=n,o=a||w.inferDtype(i),s=w.getArrayFromDType(o,w.sizeFromShape(r));return function(e,t,n){e.fill(t)}(s,i),t.makeTensorInfo(r,o,s)}const UNe={kernelName:Cle,backendName:"cpu",kernelFunc:zNe},HNe={kernelName:Ile,backendName:"cpu",kernelFunc:({inputs:e,backend:t})=>{const{image:n}=e,r=t,i=w.getTypedArrayFromDType(n.dtype,w.sizeFromShape(n.shape)),[a,o,s,l]=n.shape,u=r.data.get(n.dataId).values;for(let c=0;c<a;c++){const e=c*s*o*l;for(let t=0;t<o;t++){const n=t*(s*l);for(let r=0;r<s;r++){const o=r*l;for(let c=0;c<l;c++){const d=Math.round(s-[a,t,r,c][2]),h=e+n+o+c;let f=u[h];d>=0&&d<s&&(f=u[e+n+d*l+c]),i[h]=f}}}}return{dataId:r.write(i,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},WNe=TMe(e=>Math.floor(e)),VNe=oDe(Ale,WNe),qNe={kernelName:Ale,backendName:"cpu",kernelFunc:VNe},GNe=fDe((e,t)=>Math.floor(e/t)),YNe=ADe(Ole,GNe,null,"int32"),XNe={kernelName:Ole,backendName:"cpu",kernelFunc:YNe},KNe={kernelName:yce,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a,bias:o,preluActivationWeights:s}=t,{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=r;let m=LMe({inputs:{x:i,filter:a},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h}});if(o){const e=m;m=NDe({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(e)}if(f){const e=m;m=wDe(n,m,f,s,p),n.disposeIntermediateTensorInfo(e)}return m}},ZNe={kernelName:bce,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a,bias:o,preluActivationWeights:s}=t,{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=r;let m=QMe({inputs:{x:i,filter:a},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h}});if(o){const e=m;m=NDe({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(e)}if(f){const e=m;m=wDe(n,m,f,s,p),n.disposeIntermediateTensorInfo(e)}return m}},JNe={kernelName:Nle,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:r,indices:i}=t,a=w.sizeFromShape(r.shape),o=i.shape,s=o[o.length-1],[l,u,c,d]=j.prepareAndValidate(r,i);if(0===u)return n.makeTensorInfo(l,r.dtype,[]);const h=mhe([u,c],r.dtype),f=n.data.get(i.dataId).values,p=n.data.get(r.dataId).values;for(let m=0;m<u;m++){const e=[];let t=0;for(let n=0;n<s;n++){const r=f[m*s+n];t+=r*d[n],e.push(r)}if(t<0||t>=a/c)throw new Error(`Invalid indices: ${e} does not index into ${r.shape}`);for(let n=0;n<c;n++)h.values[m*c+n]=p[t*c+n]}return n.makeTensorInfo(l,h.dtype,h.values)}};function QNe(e,t,n){const r=mhe(n,e.dtype);for(let i=0;i<r.size;++i){const n=r.indexToLoc(i).slice(),a=t.locToIndex([n[0],n[2]]);n[2]=t.values[a];const o=e.locToIndex(n);r.values[i]=e.values[o]}return r}const eje={kernelName:Mle,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,indices:a}=t,{axis:o,batchDims:s}=r;nDe([i,a],"gatherV2");let l=s;null==s&&(l=0);const u=w.sizeFromShape(a.shape),c=w.parseAxisParam(o,i.shape)[0],d=j.segment_util.collectGatherOpShapeInfo(i,a,c,l),h=FDe({inputs:{x:i},backend:n,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),f=FDe({inputs:{x:a},backend:n,attrs:{shape:[d.batchSize,u/d.batchSize]}}),p=[d.batchSize,d.outerSize,u/d.batchSize,d.sliceSize],m=n.bufferSync(f),g=QNe(n.bufferSync(h),m,p);return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.makeTensorInfo(d.outputShape,g.dtype,g.values)}},tje=fDe((e,t)=>e>t?1:0),nje=ADe(jle,tje,null,"bool"),rje={kernelName:jle,backendName:"cpu",kernelFunc:nje},ije=fDe((e,t)=>e>=t?1:0),aje=ADe(Fle,ije,null,"bool"),oje={kernelName:Fle,backendName:"cpu",kernelFunc:aje},sje={kernelName:Ple,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t,i=w.sizeFromShape(r.shape),a=r.shape[r.shape.length-1],o=FDe({inputs:{x:r},backend:n,attrs:{shape:[i/a,a]}}),s=LNe(o,!0,n),l=FDe({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),l}},lje=aDe(Ble,e=>Number.isFinite(e)?1:0,"bool"),uje={kernelName:Ble,backendName:"cpu",kernelFunc:lje},cje=aDe($le,e=>Math.abs(e)===1/0?1:0,"bool"),dje={kernelName:$le,backendName:"cpu",kernelFunc:cje},hje=aDe(zle,e=>Number.isNaN(e)?1:0,"bool"),fje={kernelName:zle,backendName:"cpu",kernelFunc:hje},pje=fDe((e,t)=>e<t?1:0),mje=ADe(Hle,pje,null,"bool"),gje={kernelName:Hle,backendName:"cpu",kernelFunc:mje},vje=fDe((e,t)=>e<=t?1:0),yje=ADe(Wle,vje,null,"bool"),bje={kernelName:Wle,backendName:"cpu",kernelFunc:yje};function xje(e,t,n){const r=(t-e)/(n-1),i=w.makeZerosTypedArray(n,"float32");i[0]=e;for(let a=1;a<i.length;a++)i[a]=i[a-1]+r;return i}const wje={kernelName:Vle,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:i,num:a}=n,o=xje(r,i,a);return t.makeTensorInfo([o.length],"float32",o)}},_je=TMe(e=>Math.log(e)),kje=oDe(qle,_je),Eje={kernelName:qle,backendName:"cpu",kernelFunc:kje},Sje=aDe(Gle,e=>Math.log1p(e)),Tje={kernelName:Gle,backendName:"cpu",kernelFunc:Sje},Cje=fDe((e,t)=>e&&t),Ije=ADe(Yle,Cje,null,"bool"),Aje={kernelName:Yle,backendName:"cpu",kernelFunc:Ije},Oje=aDe(Xle,e=>e?0:1,"bool"),Dje={kernelName:Xle,backendName:"cpu",kernelFunc:Oje},Mje=fDe((e,t)=>e||t),Nje=ADe(Kle,Mje,null,"bool"),jje={kernelName:Kle,backendName:"cpu",kernelFunc:Nje},Fje={kernelName:Jle,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{depthRadius:a,bias:o,alpha:s,beta:l}=r;nDe(i,"LRN");const u=i.shape[3],c=u-1,d=n.data.get(i.dataId).values,h=w.sizeFromShape(i.shape),f=new Float32Array(h);function p(e){const t=e%u;let n=e-t+Math.max(0,t-a);const r=e-t+Math.min(t+a,c);let i=0;for(;n<=r;n++){const e=d[n];i+=e*e}return i}for(let m=0;m<h;m++){const e=p(m),t=d[m]*Math.pow(o+s*e,-l);f[m]=t}return n.makeTensorInfo(i.shape,i.dtype,f)}},Rje={kernelName:Qle,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,y:a,dy:o}=t,{depthRadius:s,bias:l,alpha:u,beta:c}=r;nDe(o,"LRNGrad");const d=w.sizeFromShape(o.shape),h=o.shape[3],f=n.data.get(o.dataId).values,p=n.data.get(i.dataId).values,m=n.data.get(a.dataId).values,g=new Float32Array(d),v=d;for(let y=0;y<v;y++){const e=y%h,t=y-e+Math.max(0,e-s),n=y-e+Math.min(h,e+s+1);let r=0;for(let i=t;i<n;i++)r+=Math.pow(p[i],2);r=u*r+l;for(let i=t;i<n;i++){let e=-2*u*c*p[i]*m[y]/r;y===i&&(e+=Math.pow(r,-c)),e*=f[y],g[i]+=e}}return n.makeTensorInfo(o.shape,i.dtype,g)}};function Pje(e,t,n,r){const i=w.getTypedArrayFromDType(r,w.sizeFromShape(n));for(let a=0;a<i.length;++a){const n=a*t;let r=e[n];for(let i=0;i<t;++i){const t=e[n+i];t>r&&(r=t)}i[a]=r}return i}function Lje(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reductionIndices:a,keepDims:o}=r,s=n;let l=i.shape;const u=l.length,c=w.parseAxisParam(a,l);let d=c;const h=j.getAxesPermutation(d,u);let f=s.data.get(i.dataId).values;if(null!=h){const e=new Array(u);for(let t=0;t<e.length;t++)e[t]=l[h[t]];f=GDe(f,l,i.dtype,h,e),d=j.getInnerMostAxes(d.length,u),l=e}nDe(i,"max"),j.assertAxesAreInnerMostDims("max",d,u);const[p,m]=j.computeOutAndReduceShapes(l,d),g=Pje(f,w.sizeFromShape(m),p,i.dtype),v=s.write(g,p,i.dtype);let y=p;return o&&(y=j.expandShapeToKeepDim(p,c)),{dataId:v,shape:y,dtype:i.dtype}}const Bje={kernelName:eue,backendName:"cpu",kernelFunc:Lje},$je=fDe((e,t)=>Math.max(e,t)),zje=ADe(tue,$je),Uje={kernelName:tue,backendName:"cpu",kernelFunc:zje},Hje={kernelName:nue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;nDe(i,"maxPool");const{filterSize:a,strides:o,pad:s,dimRoundingMode:l}=r;w.assert(j.eitherStridesOrDilationsAreOne(o,1),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`);const u=j.computePool2DInfo(i.shape,a,o,1,s,l);let c;if(1===u.filterWidth&&1===u.filterHeight&&w.arraysEqual(u.inShape,u.outShape))c=uDe({inputs:{x:i},backend:n});else{const e=n.data.get(i.dataId).values,t=w.computeStrides(i.shape),r=dMe(e,0,i.dtype,t,u,"max");c=n.makeTensorInfo(u.outShape,i.dtype,r.values)}return c}},Wje={kernelName:iue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:a,strides:o,pad:s,dimRoundingMode:l,dataFormat:u,dilations:c}=r;nDe(i,"maxPool3d");let d=c;null==d&&(d=[1,1,1]);const h=j.computePool3DInfo(i.shape,a,o,d,s,l,u),f=fMe(n.data.get(i.dataId).values,0,i.dtype,w.computeStrides(i.shape),h,"max");return n.makeTensorInfo(f.shape,"float32",f.values)}},Vje={kernelName:aue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,{filterSize:o,strides:s,pad:l,dilations:u,dimRoundingMode:c}=r;nDe([i,a],"maxPool3DGrad");const d=j.computePool3DInfo(a.shape,o,s,u,l,c),h=function(e,t){const n=mhe(t.outShape,"int32"),r=t.strideDepth,i=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,l=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,d=t.effectiveFilterWidth,h=t.padInfo.front,f=t.padInfo.top,p=t.padInfo.left;for(let m=0;m<t.batchSize;++m)for(let g=0;g<t.inChannels;++g)for(let v=0;v<t.outDepth;++v){const y=v*r-h;let b=y;for(;b<0;)b+=o;const x=Math.min(t.inDepth,u+y);for(let r=0;r<t.outHeight;++r){const u=r*i-f;let h=u;for(;h<0;)h+=s;const w=Math.min(t.inHeight,c+u);for(let i=0;i<t.outWidth;++i){const f=i*a-p;let _=f;for(;_<0;)_+=l;const k=Math.min(t.inWidth,d+f);let E=Number.NEGATIVE_INFINITY,S=-1;for(let t=b;t<x;t+=o){const n=t-y;for(let r=h;r<w;r+=s){const i=r-u;for(let a=_;a<k;a+=l){const o=a-f,s=e.get(m,t,r,a,g);s>=E&&(E=s,S=n*c*d+i*c+o)}}}n.set(S,m,v,r,i,g)}}}return n}(n.bufferSync(a),d),f=d.strideDepth,p=d.strideHeight,m=d.strideWidth,g=d.dilationDepth,v=d.dilationHeight,y=d.dilationWidth,b=d.effectiveFilterDepth,x=d.effectiveFilterHeight,w=d.effectiveFilterWidth,_=b-1-d.padInfo.front,k=w-1-d.padInfo.left,E=x-1-d.padInfo.top,S=mhe(a.shape,"float32"),T=n.bufferSync(i);for(let C=0;C<d.batchSize;++C)for(let e=0;e<d.inChannels;++e)for(let t=0;t<d.inDepth;++t)for(let n=0;n<d.inHeight;++n)for(let r=0;r<d.inWidth;++r){const i=t-_,a=n-E,o=r-k;let s=0;for(let t=0;t<b;t+=g){const n=(i+t)/f;if(!(n<0||n>=d.outDepth||Math.floor(n)!==n))for(let r=0;r<x;r+=v){const i=(a+r)/p;if(!(i<0||i>=d.outHeight||Math.floor(i)!==i))for(let a=0;a<w;a+=y){const l=(o+a)/m;if(l<0||l>=d.outWidth||Math.floor(l)!==l)continue;const u=b*x*w-1-h.get(C,n,i,l,e)===t*x*w+r*w+a?1:0;0!==u&&(s+=T.get(C,n,i,l,e)*u)}}}S.set(s,C,t,n,r,e)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}},qje={kernelName:rue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a,output:o}=t,s=a;nDe([a,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:d}=r,h=j.computePool2DInfo(s.shape,l,u,1,c,d),f=n.data.get(s.dataId).values,p=mhe(h.outShape,s.dtype,hMe(f,s.shape,s.dtype,h).values),m=h.strideHeight,g=h.strideWidth,v=h.dilationHeight,y=h.dilationWidth,b=h.effectiveFilterHeight,x=h.effectiveFilterWidth,w=x-1-h.padInfo.left,_=b-1-h.padInfo.top,k=mhe(s.shape,"float32"),E=n.data.get(i.dataId).values,S=mhe(i.shape,"float32",E);for(let T=0;T<h.batchSize;++T)for(let e=0;e<h.inChannels;++e)for(let t=0;t<h.inHeight;++t)for(let n=0;n<h.inWidth;++n){const r=t-_,i=n-w;let a=0;for(let t=0;t<b;t+=v){const n=(r+t)/m;if(!(n<0||n>=h.outHeight||Math.floor(n)!==n))for(let r=0;r<x;r+=y){const o=(i+r)/g;if(o<0||o>=h.outWidth||Math.floor(o)!==o)continue;const s=b*x-1-p.get(T,n,o,e)===t*x+r?1:0;0!==s&&(a+=S.get(T,n,o,e)*s)}}k.set(a,T,t,n,e)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}},Gje={kernelName:oue,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{filterSize:i,strides:a,pad:o,includeBatchInIndex:s}=t,l=n;nDe(r,"MaxPoolWithArgmax");const u=l.data.get(r.dataId).values,c=j.computePool2DInfo(r.shape,i,a,[1,1],o),[d,h]=function(e,t,n,r,i){const a=dMe(e,0,n,w.computeStrides(t),i,"max"),o=hMe(e,t,n,i,!0,r);return[a.values,o.values]}(u,r.shape,r.dtype,s,c),f=l.write(d,c.outShape,r.dtype),p=l.write(h,c.outShape,r.dtype);return[{dataId:f,shape:c.outShape,dtype:r.dtype},{dataId:p,shape:c.outShape,dtype:"int32"}]}};function Yje(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:o}=r;let s;nDe(i,"sum"),s="bool"===i.dtype?CDe({inputs:{x:i},backend:n,attrs:{dtype:"int32"}}):uDe({inputs:{x:i},backend:n});const l=s.shape.length,u=w.parseAxisParam(a,s.shape),c=j.getAxesPermutation(u,l);let d=u,h=s;null!=c&&(h=YDe({inputs:{x:s},backend:n,attrs:{perm:c}}),d=j.getInnerMostAxes(d.length,l)),j.assertAxesAreInnerMostDims("sum",d,h.shape.length);const[f,p]=j.computeOutAndReduceShapes(h.shape,d);let m=EDe(n,f,j.upcastType(h.dtype,"int32"));const g=w.sizeFromShape(p),v=n.data.get(m.dataId).values,y=n.data.get(h.dataId).values;for(let b=0;b<v.length;++b){const e=b*g;let t=0;for(let n=0;n<g;++n)t+=y[e+n];v[b]=t}if(o){const e=m;m=FDe({inputs:{x:m},backend:n,attrs:{shape:j.expandShapeToKeepDim(m.shape,u)}}),n.disposeIntermediateTensorInfo(e)}return n.disposeIntermediateTensorInfo(s),null!=c&&n.disposeIntermediateTensorInfo(h),m}const Xje={kernelName:Kue,backendName:"cpu",kernelFunc:Yje},Kje={kernelName:sue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:o}=r,s=w.parseAxisParam(a,i.shape),l=j.computeOutAndReduceShapes(i.shape,s),u=w.sizeFromShape(l[1]),c=[],d=n.makeTensorInfo([],"float32",new Float32Array([u]));c.push(d);const h=CDe({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});c.push(h);const f=MNe({inputs:{a:h,b:d},backend:n});c.push(f);const p=Yje({inputs:{x:f},backend:n,attrs:{axis:a,keepDims:o}});return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),p}},Zje={kernelName:lue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:o}=r;nDe(i,"min");const s=w.parseAxisParam(a,i.shape);let l=s;const u=j.getAxesPermutation(l,i.shape.length);let c=i;null!=u&&(c=YDe({inputs:{x:i},backend:n,attrs:{perm:u}}),l=j.getInnerMostAxes(l.length,i.shape.length)),j.assertAxesAreInnerMostDims("min",l,c.shape.length);const[d,h]=j.computeOutAndReduceShapes(c.shape,l),f=w.sizeFromShape(h),p=w.makeZerosTypedArray(w.sizeFromShape(d),c.dtype),m=n.data.get(c.dataId).values;for(let v=0;v<p.length;++v){const e=v*f;let t=m[e];for(let n=0;n<f;++n){const r=m[e+n];r<t&&(t=r)}p[v]=t}null!=u&&n.disposeIntermediateTensorInfo(c);const g=n.makeTensorInfo(d,c.dtype,p);if(o){const e=FDe({inputs:{x:g},backend:n,attrs:{shape:j.expandShapeToKeepDim(d,s)}});return n.disposeIntermediateTensorInfo(g),e}return g}},Jje=fDe((e,t)=>Math.min(e,t)),Qje=ADe(uue,Jje),eFe={kernelName:uue,backendName:"cpu",kernelFunc:Qje},tFe={kernelName:cue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:a,mode:o}=r;nDe(i,"mirrorPad");const s=a.map((e,t)=>e[0]+i.shape[t]+e[1]),l=a.map(e=>e[0]),u=a.map((e,t)=>e[0]+i.shape[t]),c="reflect"===o?0:1,d=n.data.get(i.dataId).values,h=i.shape.length,f=w.computeStrides(i.shape),p=w.sizeFromShape(s),m=s.length,g=w.computeStrides(s),v=w.getTypedArrayFromDType(i.dtype,p);for(let y=0;y<p;y++){let e=w.indexToLoc(y,m,g);for(let n=0;n<m;n++)e[n]<l[n]?e[n]=2*l[n]-e[n]-c:e[n]>=u[n]&&(e[n]=2*(u[n]-1)-e[n]+c);e=e.map((e,t)=>e-l[t]);const t=w.locToIndex(e,h,f);v[y]=d[t]}return{dataId:n.write(v,s,i.dtype),shape:s,dtype:i.dtype}}},nFe=fDe((e,t)=>{const n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}),rFe=ADe(due,nFe),iFe={kernelName:due,backendName:"cpu",kernelFunc:rFe};function aFe(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{dim:a}=r,o=i.shape.length;let s=a;if(-1===s&&(s=o-1),s!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${s}`);const l=w.parseAxisParam([s],i.shape),u=Lje({inputs:{x:i},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),c=j.expandShapeToKeepDim(u.shape,l),d=FDe({inputs:{x:u},backend:n,attrs:{shape:c}}),h=RNe({inputs:{a:i,b:d},backend:n}),f=xNe({inputs:{x:h},backend:n}),p=Yje({inputs:{x:f},backend:n,attrs:{axis:l,keepDims:!1}}),m=FDe({inputs:{x:p},backend:n,attrs:{shape:c}}),g=MNe({inputs:{a:f,b:m},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}const oFe={kernelName:Que,backendName:"cpu",kernelFunc:aFe},sFe={kernelName:hue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{numSamples:a,seed:o,normalized:s}=r;nDe(i,"multinomial");const l=s?i:aFe({inputs:{logits:i},backend:n,attrs:{dim:-1}}),u=l.shape[0],c=l.shape[1],d=n.data.get(l.dataId).values,h=[u,a],f=w.makeZerosTypedArray(w.sizeFromShape(h),"int32");for(let p=0;p<u;++p){const e=p*c,t=new Float32Array(c-1);t[0]=d[e];for(let i=1;i<t.length;++i)t[i]=t[i-1]+d[e+i];const n=Gge.alea(o.toString()),r=p*a;for(let i=0;i<a;++i){const e=n();f[r+i]=t.length;for(let n=0;n<t.length;n++)if(e<t[n]){f[r+i]=n;break}}}return s||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(h,"int32",f)}};function lFe(e,t,n){const r=w.createScalarValue(-1,n);return CNe([],t,r,e,n)}const uFe={kernelName:pue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;nDe(r,"neg");const i=n.data.get(r.dataId).values,[a,o]=lFe(i,r.shape,r.dtype);return n.makeTensorInfo(o,r.dtype,a)}},cFe=F.nonMaxSuppressionV3Impl,dFe={kernelName:gue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:l}=r;nDe(i,"NonMaxSuppression");const u=n.data.get(i.dataId).values,c=n.data.get(a.dataId).values,{selectedIndices:d}=cFe(u,c,o,s,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}},hFe=F.nonMaxSuppressionV4Impl,fFe={kernelName:vue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:l,padToMaxOutputSize:u}=r;nDe(i,"NonMaxSuppressionPadded");const c=n.data.get(i.dataId).values,d=n.data.get(a.dataId).values,{selectedIndices:h,validOutputs:f}=hFe(c,d,o,s,l,u);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},pFe=F.nonMaxSuppressionV5Impl,mFe={kernelName:yue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:l,softNmsSigma:u}=r;nDe(i,"NonMaxSuppressionWithScore");const c=n.data.get(i.dataId).values,d=n.data.get(a.dataId).values,h=o,f=s,p=l,m=u,{selectedIndices:g,selectedScores:v}=pFe(c,d,h,f,p,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([v.length],"float32",new Float32Array(v))]}},gFe=fDe((e,t)=>e!==t?1:0),vFe=ADe(mue,gFe,null,"bool"),yFe={kernelName:mue,backendName:"cpu",kernelFunc:vFe},bFe={kernelName:xue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i}=t,{depth:a,onValue:o,offValue:s}=r;nDe(i,"oneHot");const l=w.sizeFromShape(i.shape),u=new Float32Array(l*a);u.fill(s);const c=n.data.get(i.dataId).values;for(let d=0;d<l;++d)c[d]>=0&&c[d]<a&&(u[d*a+c[d]]=o);return n.makeTensorInfo([...i.shape,a],"int32",u)}};function xFe(e){const{inputs:t,backend:n}=e,{x:r}=t;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){const e=SDe({inputs:{input:r},backend:n}),t=xFe({inputs:{x:e},backend:n}),i=jMe({inputs:{input:r},backend:n}),a=xFe({inputs:{x:i},backend:n}),o=_De({inputs:{real:t,imag:a},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),o}return zNe({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const wFe={kernelName:fce,backendName:"cpu",kernelFunc:xFe},_Fe={kernelName:bue,backendName:"cpu",kernelFunc:function e(t){const{inputs:n,backend:r}=t,{x:i}=n;if("string"===i.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===i.dtype){const t=SDe({inputs:{input:i},backend:r}),n=e({inputs:{x:t},backend:r}),a=jMe({inputs:{input:i},backend:r}),o=xFe({inputs:{x:a},backend:r}),s=_De({inputs:{real:n,imag:o},backend:r});return r.disposeIntermediateTensorInfo(t),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(o),s}return zNe({backend:r,attrs:{shape:i.shape,value:1,dtype:i.dtype}})}};function kFe(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r;if(1===t.length)return _Ne({inputs:{input:t[0]},backend:n,attrs:{dim:i}});const a=t[0].shape,o=t[0].dtype;t.forEach(e=>{w.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),w.assert(o===e.dtype,()=>"All tensors passed to stack must have matching dtypes")});const s=[],l=RMe({inputs:t.map(e=>{const t=_Ne({inputs:{input:e},backend:n,attrs:{dim:i}});return s.push(t),t}),backend:n,attrs:{axis:i}});return s.forEach(e=>n.disposeIntermediateTensorInfo(e)),l}const EFe={kernelName:wue,backendName:"cpu",kernelFunc:kFe},SFe={kernelName:_ue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:a,constantValue:o}=r;nDe(i,"pad");const s=a.map((e,t)=>e[0]+i.shape[t]+e[1]),l=a.map(e=>e[0]),u=n.data.get(i.dataId).values,c=w.sizeFromShape(i.shape),d=i.shape.length,h=w.computeStrides(i.shape),f=w.sizeFromShape(s),p=s.length,m=w.computeStrides(s),g=w.getTypedArrayFromDType(i.dtype,f);0!==o&&g.fill(o);for(let v=0;v<c;v++){const e=w.indexToLoc(v,d,h).map((e,t)=>e+l[t]);g[w.locToIndex(e,p,m)]=u[v]}return{dataId:n.write(g,s,i.dtype),shape:s,dtype:i.dtype}}},TFe=fDe((e,t)=>Math.pow(e,t)),CFe=ADe(Eue,TFe),IFe={kernelName:Eue,backendName:"cpu",kernelFunc:CFe};function AFe(e,t,n,r){const[i,a]=j.computeOutAndReduceShapes(e,r),o=tde(t,"int32"),s=w.makeZerosTypedArray(w.sizeFromShape(i),o),l=w.sizeFromShape(a);for(let u=0;u<s.length;++u){const e=u*l;let t=1;for(let r=0;r<l;++r)t*=n[e+r];s[u]=t}return{outVals:s,outShape:i,outDtype:o}}const OFe={kernelName:Tue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:o}=r;nDe(i,"prod");const s=i.shape.length,l=w.parseAxisParam(a,i.shape),u=j.getAxesPermutation(l,s);let c=l,d=i;const h=[];null!=u&&(d=YDe({inputs:{x:i},backend:n,attrs:{perm:u}}),h.push(d),c=j.getInnerMostAxes(c.length,s));const f=n.data.get(d.dataId).values,{outVals:p,outShape:m,outDtype:g}=AFe(d.shape,d.dtype,f,c);let v=m;return o&&(v=j.expandShapeToKeepDim(m,l)),h.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(v,g,p)}};function DFe(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return w.makeZerosTypedArray(0,r);const i=Math.abs(Math.ceil((t-e)/n)),a=w.makeZerosTypedArray(i,r);t<e&&1===n&&(n=-1),a[0]=e;for(let o=1;o<a.length;o++)a[o]=a[o-1]+n;return a}const MFe={kernelName:Cue,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:i,dtype:a,step:o}=n,s=DFe(r,i,o,a);return t.makeTensorInfo([s.length],a,s)}},NFe=aDe(Aue,e=>1/e),jFe={kernelName:Aue,backendName:"cpu",kernelFunc:NFe},FFe={kernelName:jue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:a,halfPixelCenters:o,size:s}=r;nDe(i,"resizeBilinear");const l=w.computeStrides(i.shape),[u,c]=s,[d,h,f,p]=i.shape,m=n.data.get(i.dataId).values,g=new Float32Array(w.sizeFromShape([d,u,c,p])),v=[a&&u>1?h-1:h,a&&c>1?f-1:f],y=[a&&u>1?u-1:u,a&&c>1?c-1:c];let b=0;const x=v[0]/y[0],_=v[1]/y[1];for(let w=0;w<d;w++)for(let e=0;e<u;e++){let t;t=o?x*(e+.5)-.5:x*e;const n=Math.max(0,Math.floor(t)),r=t-n,i=Math.min(h-1,Math.ceil(t)),a=w*l[0]+n*l[1],s=w*l[0]+i*l[1];for(let e=0;e<c;e++){let t;t=o?_*(e+.5)-.5:_*e;const n=Math.max(0,Math.floor(t)),i=t-n,u=Math.min(f-1,Math.ceil(t)),c=a+n*l[2],d=s+n*l[2],h=a+u*l[2],v=s+u*l[2];for(let e=0;e<p;e++){const t=m[c+e],n=m[d+e],a=t+(m[h+e]-t)*i;g[b++]=a+(n+(m[v+e]-n)*i-a)*r}}}return n.makeTensorInfo([d,u,c,p],"float32",g)}},RFe={kernelName:Fue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:a}=t,{alignCorners:o}=r;nDe([a,i],"resizeBilinearGrad");const s=w.computeStrides(i.shape),[l,u,c,d]=i.shape,[,h,f]=a.shape,p=new Float32Array(l*u*c*d),m=[o&&h>1?u-1:u,o&&f>1?c-1:c],g=[o&&h>1?h-1:h,o&&f>1?f-1:f],v=m[0]/g[0],y=m[1]/g[1],b=n.data.get(a.dataId).values;let x=0;for(let w=0;w<l;w++){const e=w*s[0];for(let t=0;t<h;t++){const n=t*v,r=Math.floor(n),i=Math.min(Math.ceil(n),u-1),a=e+r*s[1],o=e+i*s[1],l=n-r,h=1-l;for(let e=0;e<f;e++){const t=e*y,n=Math.floor(t),r=Math.min(Math.ceil(t),c-1),i=t-n,u=1-i,f=a+n*s[2],m=a+r*s[2],g=o+n*s[2],v=o+r*s[2],w=h*u,_=h*i,k=l*u,E=l*i;for(let e=0;e<d;e++){const t=b[x++];p[f+e]+=t*w,p[m+e]+=t*_,p[g+e]+=t*k,p[v+e]+=t*E}}}}return n.makeTensorInfo([l,c,u,d],"float32",p)}},PFe={kernelName:Mue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:a,halfPixelCenters:o,size:s}=r;nDe(i,"resizeNearestNeighbor");const l=w.computeStrides(i.shape),[u,c]=s,[d,h,f,p]=i.shape,m=n.data.get(i.dataId).values,g=new Float32Array(d*u*c*p),v=[a&&u>1?h-1:h,a&&c>1?f-1:f],y=[a&&u>1?u-1:u,a&&c>1?c-1:c],b=v[0]/y[0],x=v[1]/y[1];let _=0;for(let w=0;w<d;w++){const e=w*l[0];for(let t=0;t<u;t++){const n=o?b*(t+.5):b*t;let r=Math.min(h-1,a?Math.round(n):Math.floor(n));o&&(r=Math.max(0,r));const i=e+r*l[1];for(let e=0;e<c;e++){const t=o?x*(e+.5):x*e;let n=Math.min(f-1,a?Math.round(t):Math.floor(t));o&&(n=Math.max(0,n));const r=i+n*l[2];for(let e=0;e<p;e++)g[_++]=m[r+e]}}}return n.makeTensorInfo([d,u,c,p],i.dtype,g)}},LFe={kernelName:Nue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:a}=t,{alignCorners:o}=r;nDe([a,i],"resizeNearestNeighborGrad");const s=w.computeStrides(i.shape),l=w.computeStrides(a.shape),[u,c,d,h]=i.shape,[,f,p]=a.shape,m=new Float32Array(u*c*d*h),g=n.data.get(a.dataId).values,v=[o&&f>1?c-1:c,o&&p>1?d-1:d],y=[o&&f>1?f-1:f,o&&p>1?p-1:p],b=v[0]/y[0],x=v[1]/y[1],_=1/b,k=1/x,E=2*Math.ceil(_)+2,S=2*Math.ceil(k)+2;for(let w=0;w<u;w++){const e=w*s[0];for(let t=0;t<c;t++){const n=e+t*s[1],r=Math.floor(t*_),i=Math.floor(r-E/2);for(let a=0;a<d;a++){const r=n+a*s[2],u=Math.floor(a*k),v=Math.floor(u-S/2);for(let n=0;n<h;n++){let s=0;for(let r=0;r<E;r++){const u=r+i;if(u<0||u>=f)continue;const h=e+u*l[1],m=u*b;if(t===Math.min(c-1,o?Math.round(m):Math.floor(m)))for(let e=0;e<S;e++){const t=e+v;if(t<0||t>=p)continue;const r=h+t*l[2],i=t*x;a===Math.min(d-1,o?Math.round(i):Math.floor(i))&&(s+=g[r+n])}}m[r+n]=s}}}}return n.makeTensorInfo(i.shape,i.dtype,m)}},BFe={kernelName:Pue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dims:a}=r;nDe(i,"reverse");const o=i.shape.length,s=w.parseAxisParam(a,i.shape);if(0===o)return uDe({inputs:{x:i},backend:n});const l=new Hce(i.shape,i.dtype),u=n.bufferSync(i);for(let c=0;c<l.size;c++){const e=l.indexToLoc(c),t=e.slice();s.forEach(e=>t[e]=i.shape[e]-1-t[e]),l.set(u.get(...t),...e)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}},$Fe={kernelName:gce,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,{radians:i,fillValue:a,center:o}=t,s=n,l=w.getTypedArrayFromDType(r.dtype,w.sizeFromShape(r.shape)),[u,c,d,h]=r.shape,[f,p]=j.getImageCenter(o,c,d),m=Math.sin(i),g=Math.cos(i),v=s.data.get(r.dataId).values;for(let y=0;y<u;y++){const e=y*d*c*h;for(let t=0;t<c;t++){const n=t*(d*h);for(let r=0;r<d;r++){const i=r*h;for(let o=0;o<h;o++){const s=[u,t,r,o],y=s[2],b=s[1];let x=(y-f)*g-(b-p)*m,w=(y-f)*m+(b-p)*g;x=Math.round(x+f),w=Math.round(w+p);let _=a;"number"!=typeof a&&(_=3===o?255:a[o]),x>=0&&x<d&&w>=0&&w<c&&(_=v[e+w*(d*h)+x*h+o]),l[e+n+i+o]=_}}}}return{dataId:s.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},zFe=aDe(Lue,e=>{const t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2==0?t:t+1}),UFe={kernelName:Lue,backendName:"cpu",kernelFunc:zFe},HFe=TMe(e=>1/Math.sqrt(e)),WFe=oDe(Bue,HFe),VFe={kernelName:Bue,backendName:"cpu",kernelFunc:WFe};function qFe(e,t,n,r,i,a,o,s,l,u){const c=[r/i,i],d=e.values,h=t.values;if(0===r)return mhe(n,t.dtype);const f=mhe(c,t.dtype);f.values.fill(l);for(let p=0;p<a;p++){const e=[];let a=0;for(let t=0;t<o;t++){const n=d[p*o+t];e.push(n),a+=n*s[t]}if(a<0||a>=r/i)throw new Error(`Invalid indices: ${e} does not index into ${n}`);for(let n=0;n<i;n++)u?f.values[a*i+n]+=h[p*i+n]:f.values[a*i+n]=0===t.rank?h[0]:h[p*i+n]}return f}const GFe={kernelName:$ue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i,updates:a}=t,{shape:o}=r,{sliceRank:s,numUpdates:l,sliceSize:u,strides:c,outputSize:d}=j.calculateShapes(a,i,o),h=qFe(n.bufferSync(i),n.bufferSync(a),o,d,u,l,s,c,0,!0);return n.makeTensorInfo(o,h.dtype,h.values)}},YFe={kernelName:zue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:r,t:i,e:a}=t;nDe([r,i,a],"select");const o=r.shape.length,s=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,u=n.data.get(a.dataId).values,c=tde(i.dtype,a.dtype),d=w.makeZerosTypedArray(w.sizeFromShape(i.shape),c);let h=0;const f=0===o||o>1||1===i.shape.length?1:w.sizeFromShape(i.shape.slice(1));for(let p=0;p<s.length;p++)for(let e=0;e<f;e++)d[h++]=1===s[p]?l[p]:u[p];return n.makeTensorInfo(i.shape,c,d)}},XFe=j.SELU_SCALEALPHA,KFe=j.SELU_SCALE,ZFe=aDe(Uue,e=>e>=0?KFe*e:XFe*(Math.exp(e)-1)),JFe={kernelName:Uue,backendName:"cpu",kernelFunc:ZFe},QFe=aDe(Gue,e=>1/(1+Math.exp(-e))),eRe={kernelName:Gue,backendName:"cpu",kernelFunc:QFe},tRe=aDe(que,e=>e<0?-1:e>0?1:0),nRe={kernelName:que,backendName:"cpu",kernelFunc:tRe},rRe=aDe(Wue,e=>Math.sin(e)),iRe={kernelName:Wue,backendName:"cpu",kernelFunc:rRe},aRe=aDe(Vue,e=>Math.sinh(e)),oRe={kernelName:Vue,backendName:"cpu",kernelFunc:aRe},sRe=Math.log(1.1920928955078125e-7)+2,lRe=aDe(Yue,e=>{const t=e>-sRe,n=e<sRe,r=Math.exp(e);let i;return i=n?r:t?e:Math.log(1+r),i}),uRe={kernelName:Yue,backendName:"cpu",kernelFunc:lRe},cRe={kernelName:Zue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:a,paddings:o}=r;nDe([i],"spaceToBatchND");const s=w.sizeFromShape(a),l=[[0,0]];l.push(...o);for(let g=1+a.length;g<i.shape.length;++g)l.push([0,0]);const u=SFe.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),c=j.getReshaped(u.shape,a,s,!1),d=j.getPermuted(c.length,a.length,!1),h=j.getReshapedPermuted(u.shape,a,s,!1),f=FDe({inputs:{x:u},backend:n,attrs:{shape:c}}),p=YDe({inputs:{x:f},backend:n,attrs:{perm:d}}),m=FDe({inputs:{x:p},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),m}},dRe={kernelName:rce,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:i,sparseValues:a,defaultValue:o}=t,{outputShape:s}=r,{sliceRank:l,numUpdates:u,sliceSize:c,strides:d,outputSize:h}=j.calculateShapes(a,i,s),f=qFe(n.bufferSync(i),n.bufferSync(a),s,h,c,u,l,d,n.data.get(o.dataId).values[0],!1);return n.makeTensorInfo(s,f.dtype,f.values)}},hRe={kernelName:Jue,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{numOrSizeSplits:a,axis:o}=r,s=w.parseAxisParam(o,i.shape)[0],l=j.prepareSplitSize(i,a,s),u=new Array(i.shape.length).fill(0),c=i.shape.slice();return l.map(e=>{const t=[...c];t[s]=e;const r=xMe({inputs:{x:i},backend:n,attrs:{begin:u,size:t}});return u[s]+=e,r})}},fRe=aDe(Xue,e=>Math.sqrt(e)),pRe={kernelName:Xue,backendName:"cpu",kernelFunc:fRe},mRe={kernelName:tce,backendName:"cpu",kernelFunc:({inputs:e,backend:t})=>{const{x:n}=e,r=t;nDe(n,"square");const i=r.data.get(n.dataId).values,a=new Float32Array(i.length);for(let o=0;o<i.length;++o){const e=i[o];a[o]=e*e}return{dataId:r.write(a,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},gRe=fDe((e,t)=>{const n=e-t;return n*n}),vRe=ADe(ece,gRe),yRe={kernelName:ece,backendName:"cpu",kernelFunc:vRe},bRe=aDe(pce,(e,t)=>{const n=t;return isNaN(e)?NaN:e>0?1:n.alpha}),xRe={kernelName:pce,backendName:"cpu",kernelFunc:bRe};function wRe(e,t,n,r){const i=mhe(e,t.dtype);for(let a=0;a<i.size;a++){const e=i.indexToLoc(a),o=new Array(e.length);for(let t=0;t<o.length;t++)o[t]=e[t]*n[t]+r[t];i.set(t.get(...o),...e)}return i}const _Re={kernelName:ice,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:a,end:o,strides:s,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:d,shrinkAxisMask:h}=r;nDe(i,"stridedSlice");const{nonStrided:f,$begin:p,$strides:m,size:g,newShape:v,outShape:y}=A.sliceInfo(i.shape,a,o,s,l,u,c,d,h),b=FDe({inputs:{x:i},backend:n,attrs:{shape:v}});let x;if(f){const e=xMe({inputs:{x:b},backend:n,attrs:{begin:p,size:g}});x=FDe({inputs:{x:e},backend:n,attrs:{shape:y}}),n.disposeIntermediateTensorInfo(e)}else if(y.some(e=>0===e))x=n.makeTensorInfo(y,i.dtype,[]);else{const e=wRe(y,n.bufferSync(b),m,p);x=n.makeTensorInfo(e.shape,e.dtype,e.values)}const w=FDe({inputs:{x:x},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(x),w}},kRe=aDe(ace,e=>Math.tan(e)),ERe={kernelName:ace,backendName:"cpu",kernelFunc:kRe},SRe=aDe(oce,e=>Math.tanh(e));function TRe(e,t){const n=new Array(e.rank);for(let i=0;i<n.length;i++)n[i]=e.shape[i]*t[i];const r=mhe(n,e.dtype);for(let i=0;i<r.values.length;++i){const t=r.indexToLoc(i),n=new Array(e.rank);for(let r=0;r<n.length;r++)n[r]=t[r]%e.shape[r];const a=e.locToIndex(n);r.values[i]=e.values[a]}return r}function CRe(e,t,n,r,i){const a=t[t.length-1],[o,s]=[e.length/a,a],l=w.getTypedArrayFromDType(n,o*r),u=w.getTypedArrayFromDType("int32",o*r);for(let d=0;d<o;d++){const t=d*s,n=e.subarray(t,t+s),i=[];for(let e=0;e<n.length;e++)i.push({value:n[e],index:e});i.sort((e,t)=>t.value-e.value);const a=d*r,o=l.subarray(a,a+r),c=u.subarray(a,a+r);for(let e=0;e<r;e++)o[e]=i[e].value,c[e]=i[e].index}const c=t.slice();return c[c.length-1]=r,[mhe(c,n,l),mhe(c,"int32",u)]}function IRe(e,t,n,r){const i=w.parseAxisParam(t,n)[0],a=[1,n[0],1];for(let p=0;p<i;p++)a[0]*=n[p];a[1]=n[i];for(let p=i+1;p<n.length;p++)a[2]*=n[p];const o={},s=new Int32Array(n[i]),l=new Hce(a,r,e),u=[],c=1===a[0]&&1===a[2];for(let p=0;p<n[i];p++){let t;if(c)t=e[p].toString();else{const e=[];for(let t=0;t<a[0];t++)for(let n=0;n<a[2];n++)e.push(l.get(t,p,n));t=e.join(",")}if(void 0!==o[t])s[p]=o[t];else{const e=Object.keys(o).length;o[t]=e,s[p]=e,u.push(p)}}const d=a.slice();d[1]=Object.keys(o).length;const h=new Hce(d,r);u.forEach((e,t)=>{for(let n=0;n<a[0];n++)for(let r=0;r<a[2];r++)h.set(l.get(n,e,r),n,t,r)});const f=n.slice();return f[i]=d[1],{outputValues:h.values,outputShape:f,indices:s}}const ARe=[BDe,zDe,HDe,VDe,jDe,qDe,KDe,ZDe,JDe,QDe,tMe,rMe,aMe,lMe,cMe,pMe,mMe,gMe,vMe,LDe,yMe,_Me,SMe,IDe,AMe,DMe,kDe,MMe,PMe,$Me,zMe,BMe,HMe,WMe,UMe,qMe,YMe,XMe,KMe,ZMe,JMe,eNe,tNe,nNe,rNe,iNe,oNe,aNe,NNe,lDe,sNe,cNe,yNe,wNe,kNe,TNe,$Ne,UNe,HNe,qNe,XNe,KNe,ZNe,JNe,eje,rje,oje,cDe,sje,FMe,uje,dje,fje,hDe,gje,bje,wje,Eje,Tje,Aje,Dje,jje,Fje,Rje,Uje,Hje,Wje,Vje,qje,Gje,Bje,Kje,Zje,eFe,tFe,iFe,sFe,ONe,uFe,dFe,fFe,mFe,yFe,bFe,_Fe,EFe,SFe,IFe,gDe,OFe,MFe,TDe,jFe,yDe,xDe,RDe,FFe,RFe,PFe,LFe,BFe,$Fe,UFe,VFe,GFe,YFe,JFe,eRe,nRe,iRe,oRe,wMe,oFe,uRe,cRe,dRe,hRe,pRe,mRe,yRe,xRe,_Re,PNe,Xje,ERe,{kernelName:oce,backendName:"cpu",kernelFunc:SRe},{kernelName:sce,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reps:a}=r;nDe(i,"tile");const o=TRe(n.bufferSync(i),a);return n.makeTensorInfo(o.shape,o.dtype,o.values)}},{kernelName:lce,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{k:a}=r;nDe(i,"topk");const o=n.data.get(i.dataId).values,[s,l]=CRe(o,i.shape,i.dtype,a);return[n.makeTensorInfo(s.shape,s.dtype,s.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}},XDe,{kernelName:cce,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{axis:i}=n,{x:a}=t;nDe(a,"unique");const o=r.data.get(a.dataId).values,{outputValues:s,outputShape:l,indices:u}=IRe(o,i,a.shape,a.dtype);return[r.makeTensorInfo(l,a.dtype,s),r.makeTensorInfo([u.length],"int32",u)]}},{kernelName:dce,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:i}=t;let{axis:a}=r;a<0&&(a+=i.shape.length);const o=i.shape.length,s=i.shape[a],l=new Array(o-1);let u=0;for(let f=0;f<o;f++)f!==a&&(l[u++]=i.shape[f]);const c=new Array(o).fill(0),d=i.shape.slice();d[a]=1;const h=new Array(s);for(let f=0;f<h.length;f++){c[a]=f;const e=xMe({inputs:{x:i},backend:n,attrs:{begin:c,size:d}});h[f]=FDe({inputs:{x:e},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(e)}return h}},{kernelName:hce,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,segmentIds:a}=t,{numSegments:o}=r;nDe(i,"unsortedSegmentSum");const s=[],l=[],u=i.shape.length-a.shape.length;let c=a;for(let h=0;h<u;++h){const e=_Ne({inputs:{input:c},backend:n,attrs:{dim:h+1}});c=e,l.push(e)}for(let h=0;h<o;++h){const e=w.createScalarValue(h,"int32"),t=n.makeTensorInfo([],"int32",e),r=uNe({inputs:{a:t,b:c},backend:n}),a=CDe({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),o=ANe({inputs:{a:a,b:i},backend:n}),u=Yje({inputs:{x:o},backend:n,attrs:{axis:0,keepDims:!1}});s.push(u),l.push(t),l.push(r),l.push(a),l.push(o),l.push(u)}const d=kFe({inputs:s,backend:n,attrs:{axis:0}});return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),d}},wFe];for(const Gqe of ARe)Sce(Gqe);const ORe={},DRe={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function MRe(e){if(!(e in ORe)){const t=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",t=>{t.preventDefault(),delete ORe[e]},!1),1===e?t.getContext("webgl",DRe)||t.getContext("experimental-webgl",DRe):t.getContext("webgl2",DRe)}(e);if(null===t)return console.log("Could not get context for WebGL version",e),null;ORe[e]=t}const t=ORe[e];return t.isContextLost()?(delete ORe[e],MRe(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),ORe[e])}var NRe,jRe,FRe;function RRe(e,t){return[t,e]}function PRe(e){const t=w.sizeFromShape(e),n=Math.ceil(t/4);return w.sizeToSquarishShape(n)}function LRe(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function BRe(e,t){const n=e;let r,i,a,o,s,l,u,c,d,h;return 2===xse().getNumber("WEBGL_VERSION")?(r=n.R32F,i=n.R16F,a=n.RGBA16F,o=n.RGBA32F,s=n.RED,u=4,c=1,d=n.HALF_FLOAT,h=n.FLOAT):(r=e.RGBA,i=e.RGBA,a=e.RGBA,o=n.RGBA,s=e.RGBA,u=4,c=4,d=null!=t?t.HALF_FLOAT_OES:null,h=e.FLOAT),l=e.RGBA,{internalFormatFloat:r,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:d,textureTypeFloat:h}}function $Re(e,t){const n=t();return xse().getBool("DEBUG")&&function(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}(e,t))}(e),n}function zRe(e){return!!(xse().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function URe(e,t){return XRe(e,()=>e.getExtension(t),'Extension "'+t+'" not supported on this browser.')}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(NRe||(NRe={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(jRe||(jRe={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(FRe||(FRe={}));const HRe=/ERROR: [0-9]+:([0-9]+):/g;function WRe(e,t){if($Re(e,()=>e.validateProgram(t)),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function VRe(e,t,n,r,i,a,o){const s=e.getAttribLocation(t,n);return-1!==s&&($Re(e,()=>e.bindBuffer(e.ARRAY_BUFFER,r)),$Re(e,()=>e.vertexAttribPointer(s,i,e.FLOAT,!1,a,o)),$Re(e,()=>e.enableVertexAttribArray(s)),!0)}function qRe(e,t,n){$Re(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,n)),$Re(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))}function GRe(e,t){$Re(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,t)),$Re(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0))}function YRe(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}(e,t))}function XRe(e,t,n){const r=$Re(e,()=>t());if(null==r)throw new Error(n);return r}function KRe(e,t=2){return w.sizeFromShape(e.slice(0,e.length-t))}function ZRe(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function JRe(e){let t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[KRe(e),...ZRe(e)]),t}function QRe(e){return e%2==0}function ePe(e,t){if(e=e.slice(-2),t=t.slice(-2),w.arraysEqual(e,t))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){const n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(QRe(n)&&QRe(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&QRe(e[0])&&QRe(t[0])}let tPe,nPe;function rPe(e,t){return null!=e.getExtension(t)}function iPe(e){try{if(null!=MRe(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function aPe(e){const t=BRe(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),i}function oPe(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{null!=e&&w.assert("complex64"!==e.dtype,()=>t+" does not support complex64 tensors in the WebGL backend.")})}const sPe=xse();function lPe(){let e,t,n,r,i,a,o,s,l,u;return 2===xse().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",i="texture",a="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",l="",u="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",i="texture2D",a="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",l="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",u="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:i,output:a,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:l,defineRound:u}}function uPe(e,t,n="index"){const r=w.computeStrides(t);return r.map((t,i)=>`int ${e[i]} = ${n} / ${t}; ${i===r.length-1?`int ${e[i+1]} = ${n} - ${e[i]} * ${t}`:`index -= ${e[i]} * ${t}`};`).join("")}function cPe(e){const t=w.computeStrides(e).map(e=>e.toString());return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;\n  }\n`}sPe.registerFlag("HAS_WEBGL",()=>sPe.getNumber("WEBGL_VERSION")>0),sPe.registerFlag("WEBGL_VERSION",()=>iPe(2)?2:iPe(1)?1:0),sPe.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1),sPe.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>2===sPe.get("WEBGL_VERSION")),sPe.registerFlag("WEBGL_CPU_FORWARD",()=>!0),sPe.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1),sPe.registerFlag("WEBGL_PACK",()=>sPe.getBool("HAS_WEBGL")),sPe.registerFlag("WEBGL_PACK_NORMALIZATION",()=>sPe.getBool("WEBGL_PACK")),sPe.registerFlag("WEBGL_PACK_CLIP",()=>sPe.getBool("WEBGL_PACK")),sPe.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>!1),sPe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>sPe.getBool("WEBGL_PACK")),sPe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>sPe.getBool("WEBGL_PACK")),sPe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>sPe.getBool("WEBGL_PACK")),sPe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>sPe.getBool("WEBGL_PACK")),sPe.registerFlag("WEBGL_PACK_REDUCE",()=>sPe.getBool("WEBGL_PACK")),sPe.registerFlag("WEBGL_LAZILY_UNPACK",()=>sPe.getBool("WEBGL_PACK")),sPe.registerFlag("WEBGL_CONV_IM2COL",()=>sPe.getBool("WEBGL_PACK")),sPe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>function(e){if(null==tPe){const t=MRe(e);tPe=t.getParameter(t.MAX_TEXTURE_SIZE)}return tPe}(sPe.getNumber("WEBGL_VERSION"))),sPe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>function(e){if(null==nPe){const t=MRe(e);nPe=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,nPe)}(sPe.getNumber("WEBGL_VERSION"))),sPe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const e=sPe.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;let t;const n=MRe(e);return t=rPe(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:rPe(n,"EXT_disjoint_timer_query")?1:0,t}(e)}),sPe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>sPe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!k.isMobile()),sPe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>function(e){if(0===e)return!1;const t=MRe(e);if(1===e){if(!rPe(t,"OES_texture_float"))return!1}else if(!rPe(t,"EXT_color_buffer_float"))return!1;return aPe(t)}(sPe.getNumber("WEBGL_VERSION"))),sPe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>!sPe.getBool("WEBGL_FORCE_F16_TEXTURES")&&sPe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")),sPe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>function(e){if(0===e)return!1;const t=MRe(e);if(1!==e){if(rPe(t,"EXT_color_buffer_float"))return aPe(t);const e="EXT_color_buffer_half_float";if(rPe(t,e)){const n=t.getExtension(e);return function(e,t){const n=BRe(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(i),a}(t,n)}return!1}return!!rPe(t,"OES_texture_float")&&!!rPe(t,"WEBGL_color_buffer_float")&&aPe(t)}(sPe.getNumber("WEBGL_VERSION"))),sPe.registerFlag("WEBGL_FENCE_API_ENABLED",()=>{return 2===(e=sPe.getNumber("WEBGL_VERSION"))&&null!=MRe(e).fenceSync;var e}),sPe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>sPe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0),sPe.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,e=>{if(e<0&&-1!==e)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)});const dPe="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";class hPe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=NRe.DENSE;const t=PRe(e),n=lPe();this.outputShape=e,this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${uPe(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(${t[0]}, ${t[1]}));\n        int index = 4 * (resTexRC.x * ${t[1]} + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${n.output} = result;\n      }\n    `}}class fPe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=NRe.DENSE;const t=PRe(e),n=lPe();this.outputShape=e,this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${uPe(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(${t[0]}, ${t[1]}));\n        int index = 4 * (resTexRC.x * ${t[1]} + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${n.output} = result;\n      }\n    `}}class pPe{constructor(e){this.variableNames=["A"],this.outTexUsage=jRe.DOWNLOAD;const t=lPe();this.outputShape=e,this.userCode=`\n      ${dPe}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${t.output} = encode_float(x);\n      }\n    `}}class mPe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=jRe.DOWNLOAD;const t=lPe();this.outputShape=e,this.userCode=`\n      ${dPe}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${t.output} = encode_float(x);\n      }\n    `}}class gPe{constructor(e,t,n=!1){this.variableNames=["A"];const r=lPe(),[i,a]=t;this.outputShape=e;let o="result";n&&(o="floor(result * 255. + 0.5)"),this.userCode=`\n      ${cPe(e)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / ${a};\n        int c = imod(flatIndex, ${a});\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(${a}.0, ${i}.0);\n        vec4 values = ${r.texture2D}(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ${r.output} = vec4(${o}, 0., 0., 0.);\n      }\n    `}}class vPe{constructor(e,t,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const r=lPe(),[i,a]=t;this.outputShape=e;let o="",s="result";n&&(s="floor(result * 255. + 0.5)");for(let l=0;l<=1;l++)for(let t=0;t<=1;t++){const n=2*l+t;o+=`\n          localCoords = coords;\n          if(localCoords[2] + ${t} < ${e[2]}) {\n            localCoords[2] += ${t};\n            if(localCoords[1] + ${l} < ${e[1]}) {\n              localCoords[1] += ${l};\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / ${a};\n              c = imod(flatIndex, ${a});\n              uv = (vec2(c, r) + halfCR) / vec2(${a}.0, ${i}.0);\n              values = ${r.texture2D}(A, uv);\n\n              if(offset == 0) {\n                result[${n}] = values[0];\n              } else if(offset == 1) {\n                result[${n}] = values[1];\n              } else if(offset == 2) {\n                result[${n}] = values[2];\n              } else {\n                result[${n}] = values[3];\n              }\n            }\n          }\n        `}this.userCode=`\n      ${cPe(e)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        ${o}\n\n        ${r.output} = ${s};\n      }\n    `}}function yPe(e,t,n,r,i,a){!function(e,t){const n=xse().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0)throw new Error(`Requested texture size [${e}x${t}] is invalid.`);if(e>n||t>n)throw new Error(`Requested texture size [${e}x${t}] greater than WebGL maximum on this browser / GPU [${n}x${n}].`)}(t,n);const o=function(e){return XRe(e,()=>e.createTexture(),"Unable to create WebGLTexture.")}(e),s=e.TEXTURE_2D;return $Re(e,()=>e.bindTexture(s,o)),$Re(e,()=>e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)),$Re(e,()=>e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),$Re(e,()=>e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)),$Re(e,()=>e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)),$Re(e,()=>e.texImage2D(s,0,r,t,n,0,i,a,null)),$Re(e,()=>e.bindTexture(e.TEXTURE_2D,null)),o}function bPe(e){return e.internalFormatFloat}function xPe(e){return e.internalFormatHalfFloat}function wPe(e){return e.downloadTextureFormat}function _Pe(e){return e.internalFormatPackedFloat}function kPe(e){return e.internalFormatPackedHalfFloat}class EPe{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const t=xse().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,function(e,t){ORe[e]=t}(t,e)):this.gl=MRe(t);let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(1===xse().getNumber("WEBGL_VERSION")){const e="OES_texture_half_float";if(this.textureFloatExtension=URe(this.gl,"OES_texture_float"),rPe(this.gl,e))this.textureHalfFloatExtension=URe(this.gl,e);else if(xse().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),rPe(this.gl,r))this.colorBufferHalfFloatExtension=URe(this.gl,r);else if(xse().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",rPe(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!rPe(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=function(e){return function(e,t){const n=XRe(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return $Re(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),$Re(e,()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}(this.gl),this.indexBuffer=function(e){return function(e,t){const n=XRe(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return $Re(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)),$Re(e,()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)),n}(e,new Uint16Array([0,1,2,2,1,3]))}(this.gl),this.framebuffer=function(e){return XRe(e,()=>e.createFramebuffer(),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=BRe(this.gl,this.textureHalfFloatExtension)}get debug(){return xse().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;$Re(e,()=>e.finish()),$Re(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),$Re(e,()=>e.deleteFramebuffer(this.framebuffer)),$Re(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),$Re(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),$Re(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=RRe(t,n);return yPe(e,i,a,bPe(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=RRe(t,n);return yPe(e,i,a,xPe(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=RRe(t,n);return yPe(e,i,a,wPe(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),function(e,t,n){$Re(e,()=>e.bindTexture(e.TEXTURE_2D,t)),n.data instanceof Uint8Array?$Re(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)):$Re(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),$Re(e,()=>e.bindTexture(e.TEXTURE_2D,null))}(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,i,a){let o,s,l;$Re(e,()=>e.bindTexture(e.TEXTURE_2D,t)),i instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,l=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,l=a.internalFormatPackedFloat),o.set(i),$Re(e,()=>e.texImage2D(e.TEXTURE_2D,0,l,n,r,0,e.RGBA,s,o)),$Re(e,()=>e.bindTexture(e.TEXTURE_2D,null))}(this.gl,e,t,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=LRe(t,n);return yPe(e,i,a,kPe(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=LRe(t,n);return yPe(e,i,a,_Pe(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(GRe(this.gl,this.framebuffer),this.outputTexture=null),$Re(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,()=>function(e,t,n,r){const[i,a]=RRe(t,n),o=new Uint8Array(t*n*4);return $Re(e,()=>e.readPixels(0,0,i,a,r.downloadTextureFormat,e.UNSIGNED_BYTE,o)),new Float32Array(o.buffer)}(this.gl,t,n,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,n,r,i,a){return function(e,t,n,r,i,a,o,s){const l=e,u=new Float32Array(function(e,t){const[n,r]=LRe(e,t);return n*r*4}(a,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,t),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}(this.gl,e,0,0,0,i,a)}downloadFloat32MatrixFromBuffer(e,t){return function(e,t,n){const r=e,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);const r=function(e,t,n,r){const i=e.createBuffer();$Re(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,i));const a=16*t*n;return $Re(e,()=>e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ)),$Re(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)),$Re(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null)),i}(this.gl,t,n);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(xse().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{const e=r.clientWaitSync(i,0,0);return e===r.ALREADY_SIGNALED||e===r.CONDITION_SATISFIED},t=i}else xse().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,xse().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,()=>function(e,t,n){const r=new Float32Array(t*n*4);return $Re(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)),r}(this.gl,t,n))}createProgram(e){this.throwIfDisposed();const t=this.gl,n=function(e,t){const n=XRe(e,()=>e.createShader(e.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if($Re(e,()=>e.shaderSource(n,t)),$Re(e,()=>e.compileShader(n)),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw function(e,t){const n=HRe.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);const r=+n[1],i=e.split("\n"),a=i.length.toString().length+2,o=i.map((e,t)=>w.rightPad((t+1).toString(),a)+e);let s=0;for(let d=0;d<o.length;d++)s=Math.max(o[d].length,s);const l=o.slice(0,r-1),u=o.slice(r-1,r),c=o.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+w.rightPad(u[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join("\n"))}(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(t,e),r=function(e){const t=lPe();return function(e,t){const n=XRe(e,()=>e.createShader(e.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if($Re(e,()=>e.shaderSource(n,t)),$Re(e,()=>e.compileShader(n)),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,`${t.version}\n    precision highp float;\n    ${t.attribute} vec3 clipSpacePos;\n    ${t.attribute} vec2 uv;\n    ${t.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`)}(t),i=function(e){return XRe(e,()=>e.createProgram(),"Unable to create WebGLProgram.")}(t);return $Re(t,()=>t.attachShader(i,r)),$Re(t,()=>t.attachShader(i,n)),function(e,t){if($Re(e,()=>e.linkProgram(t)),!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,i),this.debug&&WRe(t,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=function(e,t,n){return $Re(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),VRe(e,t,"clipSpacePos",n,3,20,0)&&VRe(e,t,"uv",n,2,20,12)}(t,this.program,this.vertexBuffer)),i}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&$Re(this.gl,()=>this.gl.deleteProgram(e))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&WRe(this.gl,this.program),$Re(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,n=!0){return this.throwIfDisposed(),n?function(e,t,n){return XRe(e,()=>e.getUniformLocation(t,n),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),$Re(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(e,t,n,r){$Re(e,()=>function(e,t,n){(function(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error(`textureUnit must be in [gl.TEXTURE0, gl.TEXTURE${n}].`)})(e,n),$Re(e,()=>e.activeTexture(e.TEXTURE0+n)),$Re(e,()=>e.bindTexture(e.TEXTURE_2D,t))}(e,t,r)),$Re(e,()=>e.uniform1i(n,r))}(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();const[r,i]=LRe(t,n);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&WRe(this.gl,this.program),YRe(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;this.debug&&this.debugValidate(),$Re(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),$Re(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=URe(this.gl,2===xse().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===xse().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===xse().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await w.repeatedTry(()=>this.disposed||this.isQueryAvailable(e,xse().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,xse().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){const t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{const t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){const t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=function(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map(e=>e.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||w.repeatedTry(()=>(this.pollItems(),0===this.itemsToPoll.length))}bindTextureToFrameBuffer(e){this.throwIfDisposed(),qRe(this.gl,e,this.framebuffer),this.debug&&YRe(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(qRe(this.gl,this.outputTexture,this.framebuffer),this.debug&&YRe(this.gl)):GRe(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();const r=this.gl;qRe(r,e,this.framebuffer),this.debug&&YRe(r),this.outputTexture=e,$Re(r,()=>r.viewport(0,0,t,n)),$Re(r,()=>r.scissor(0,0,t,n))}setOutputMatrixWriteRegionDriver(e,t,n,r){this.throwIfDisposed(),$Re(this.gl,()=>this.gl.scissor(e,t,n,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}const{getBroadcastDims:SPe}=j;const TPe="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",CPe="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",IPe="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",APe="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function OPe(e){return"offset"+e}function DPe(e){const t=e.name,n=w.sizeFromShape(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${t}[i];\n      }\n    }\n  `}function MPe(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function NPe(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function jPe(e,t){return t.map(t=>e[t]).join(", ")}function FPe(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach((e,n)=>{const r=e.logicalShape,i=t[n],a=i.shape;if(!w.arraysEqual(r,a))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${a} must match`);if(e.isUniform&&i.isUniform)return;const o=e.texShape,s=i.isUniform?null:i.texData.texShape;if(!w.arraysEqual(o,s))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${o} and ${s} must match`)})}const{addImpl:RPe,bincountImpl:PPe,bincountReduceImpl:LPe,ceilImpl:BPe,concatImpl:$Pe,expImpl:zPe,expm1Impl:UPe,floorImpl:HPe,gatherV2Impl:WPe,greaterImpl:VPe,lessImpl:qPe,linSpaceImpl:GPe,logImpl:YPe,maxImpl:XPe,maximumImpl:KPe,minimumImpl:ZPe,multiplyImpl:JPe,negImpl:QPe,prodImpl:eLe,rangeImpl:tLe,rsqrtImpl:nLe,simpleAbsImpl:rLe,sliceImpl:iLe,stridedSliceImpl:aLe,subImpl:oLe,tileImpl:sLe,topKImpl:lLe,transposeImpl:uLe,uniqueImpl:cLe}=oe;function dLe(e,t){return["x","y","z","w","u","v"].slice(0,t).map(t=>`${e}.${t}`)}function hLe(e,t){return 1===t?[e]:dLe(e,t)}class fLe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;const t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const n=hLe("rc",t),r=MPe(t),i=function(e,t,n){if(1===e)return"rc > "+t[0];let r="";for(let i=e-2;i<e;i++)r+=`${n[i]} >= ${t[i]}`,i<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";const i=r.slice(-2);return`\n    int r = ${i[0]};\n    int c = ${i[1]};\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= ${t};\n    bool rEdge = rp1 >= ${n};\n  `}(t,e[e.length-1],e[e.length-2],n),o=function(e,t){const n=e.length,r=function(e,t){const n=[];for(let r=0;r<=1;r++)for(let i=0;i<=1;i++){let a=`${0===r?"r":"rp1"}, ${0===i?"c":"cp1"}`;for(let n=2;n<e;n++)a=t[t.length-1-n]+","+a;n.push(a)}return n}(n,t);return 1===n?`getA(rc),\n            rc + 1 >= ${e[0]} ? 0. : getA(rc + 1),\n            0, 0`:`getA(${r[0]}),\n          cEdge ? 0. : getA(${r[1]}),\n          rEdge ? 0. : getA(${r[2]}),\n          rEdge || cEdge ? 0. : getA(${r[3]})`}(e,n);this.userCode=`\n        void main() {\n          ${r} rc = getOutputCoords();\n\n          if(${i}) {\n            setOutput(vec4(0));\n          } else {\n            ${a}\n\n            setOutput(vec4(${o}));\n          }\n        }\n      `}}}class pLe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;let n="";for(let i=0;i<4;i++){let e="thisRC = rc;";i%2==1&&(e+="thisRC.z += 1;"),i>1&&(e+="thisRC.y += 1;"),n+=`\n        ${e}\n        ${i>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${i}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${i>0?"}":""}\n      `}var r;this.userCode=`\n      ${r=t,`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${uPe(["r","c","d"],r)}\n      return ivec3(r, c, d);\n    }\n  `}\n      ${cPe(e)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${e[1]};\n        int cols = ${e[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}}class mLe{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(e,t,n){const r=vLe(t,n),i=yLe(e,r,n);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const a=gLe(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=a,this.log();const e=this.freeTextures[i].shift();return this.usedTextures[i].push(e),e}let o;return r===FRe.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===FRe.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===FRe.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===FRe.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===FRe.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(o),this.numUsedTextures++,this._numBytesAllocated+=a,this.log(),o}releaseTexture(e,t,n,r){if(null==this.freeTextures)return;const i=vLe(n,r),a=yLe(t,i,r);a in this.freeTextures||(this.freeTextures[a]=[]);const o=gLe(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=xse().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e),this._numBytesAllocated-=o):(this.freeTextures[a].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;const l=this.usedTextures[a],u=l.indexOf(e);if(u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l.splice(u,1),this.log()}log(){if(!this.logEnabled)return;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${this.numFreeTextures+this.numUsedTextures})`);const e=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: "+this._numBytesAllocated),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const e in this.freeTextures)this.freeTextures[e].forEach(e=>{this.gpgpu.deleteMatrixTexture(e)});for(const e in this.usedTextures)this.usedTextures[e].forEach(e=>{this.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function gLe(e,t,n,r,i){const a=function(e,t){switch(e){case FRe.PACKED_2X2_FLOAT32:return _Pe(t);case FRe.PACKED_2X2_FLOAT16:return kPe(t);case FRe.UNPACKED_FLOAT32:return bPe(t);case FRe.UNPACKED_FLOAT16:return xPe(t);case FRe.PACKED_4X1_UNSIGNED_BYTE:return wPe(t);default:throw new Error("Unknown physical texture type "+e)}}(t,r);let o;if(i){const[t,n]=LRe(e[0],e[1]);o=t*n}else{const[t,n]=RRe(e[0],e[1]);o=t*n}return o*function(e,t){if(t===e.R32F)return 4;if(t===e.R16F)return 2;if(t===e.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===e.RGBA16F)return 8;throw new Error("Unknown internal format "+t)}(n,a)}function vLe(e,t){if(e===jRe.UPLOAD)return FRe.PACKED_2X2_FLOAT32;if(e===jRe.RENDER||null==e)return function(e){return xse().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?FRe.PACKED_2X2_FLOAT32:FRe.UNPACKED_FLOAT32:e?FRe.PACKED_2X2_FLOAT16:FRe.UNPACKED_FLOAT16}(t);if(e===jRe.DOWNLOAD||e===jRe.PIXELS)return FRe.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function yLe(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}class bLe{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode=`\n      float unaryOperation(float x) {\n        ${t}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}const xLe="return abs(x);",wLe="return x;";class _Le{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${t}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}class kLe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;const t=e.length,n=hLe("rc",t),r=MPe(t),i=function(e,t){if(1===e)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),o=t<=1?"rc":`vec2(${a.join(",")})`;this.userCode=`\n      void main() {\n        ${r} rc = getOutputCoords();\n        vec4 packedInput = getA(${i});\n\n        setOutput(getChannel(packedInput, ${o}));\n      }\n    `}}const ELe=F.whereImpl,SLe={};class TLe extends Toe{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.warnedAboutMemory=!1,this.warnedAboutCPUBackend=!1,this.pendingDeletes=0,this.disposed=!1,!xse().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){const e=MRe(xse().getNumber("WEBGL_VERSION"));this.binaryCache=((t=xse().getNumber("WEBGL_VERSION"))in SLe||(SLe[t]={}),SLe[t]),this.gpgpu=new EPe(e),this.canvas=e.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpu=e,this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;var t;this.textureManager=new mLe(this.gpgpu),this.numMBBeforeWarning=null==xse().global.screen?1024:xse().global.screen.height*xse().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new Soe(this,Ofe())}numDataIds(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes}write(e,t,n){if((xse().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||xse().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:jRe.UPLOAD,refCount:1,complexParentRefCount:0}),r}incRef(e){this.texData.get(e).refCount++}decRef(e){this.texData.has(e)&&this.texData.get(e).refCount--}move(e,t,n,r){if(xse().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:jRe.UPLOAD,refCount:1,complexParentRefCount:0})}disposeIntermediateTensorInfo(e){const t=e.dataId;if(this.texData.has(t)){const e=this.texData.get(t);e.refCount--,e.refCount<1&&this.disposeData(t)}}readSync(e){const t=this.texData.get(e),{values:n,dtype:r,complexTensorInfos:i,slice:a,shape:o,isPacked:s}=t;if(null!=a){let t;t=s?new _Le(o,wLe):new bLe(o,wLe);const n=this.runWebGLProgram(t,[{dataId:e,shape:o,dtype:r}],r),i=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),i}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;const l=null!=this.activeTimers;let u,c;if(l&&(u=w.now()),"complex64"===r){const e=this.readSync(i.real.dataId),t=this.readSync(i.imag.dataId);c=j.mergeRealAndImagArrays(e,t)}else c=this.getValuesFromTexture(e);return l&&(this.downloadWaitMs+=w.now()-u),this.convertAndCacheOnCPU(e,c)}async read(e){if(this.pendingRead.has(e)){const t=this.pendingRead.get(e);return new Promise(e=>t.push(e))}const t=this.texData.get(e),{values:n,shape:r,slice:i,dtype:a,complexTensorInfos:o,isPacked:s}=t;if(null!=i){let t;t=s?new _Le(r,wLe):new bLe(r,wLe);const n=this.runWebGLProgram(t,[{dataId:e,shape:r,dtype:a}],a),i=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),i}if(null!=n)return this.convertAndCacheOnCPU(e);if(!xse().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===xse().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l,u,c=null;if("complex64"!==a&&xse().get("WEBGL_BUFFER_SUPPORTED")){l=this.decode(e);const t=this.texData.get(l.dataId);c=this.gpgpu.createBufferFromTexture(t.texture,...PRe(r))}if(this.pendingRead.set(e,[]),"complex64"!==a&&await this.gpgpu.createAndWaitForFence(),"complex64"===a){const e=await Promise.all([this.read(o.real.dataId),this.read(o.imag.dataId)]);u=j.mergeRealAndImagArrays(e[0],e[1])}else if(null==c)u=this.getValuesFromTexture(e);else{const e=w.sizeFromShape(r);u=this.gpgpu.downloadFloat32MatrixFromBuffer(c,e)}null!=l&&this.disposeIntermediateTensorInfo(l);const d=this.convertAndCacheOnCPU(e,u),h=this.pendingRead.get(e);return this.pendingRead.delete(e),h.forEach(e=>e(d)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),d}bufferSync(e){const t=this.readSync(e.dataId);let n=t;if("string"===e.dtype)try{n=t.map(e=>w.decodeString(e))}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return mhe(e.shape,e.dtype,n)}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){const n=e[t];if(!zRe(n)){if(xse().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(e){const{shape:t,dtype:n,isPacked:r}=this.texData.get(e),i=w.sizeFromShape(t);if(xse().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(e),r=this.texData.get(n.dataId),a=this.gpgpu.downloadMatrixFromPackedTexture(r.texture,...PRe(t)).subarray(0,i);return this.disposeIntermediateTensorInfo(n),a}const a=xse().getBool("WEBGL_PACK")&&!0===r,o=a?JRe(t):t,s=a?new mPe(o):new pPe(o),l=this.runWebGLProgram(s,[{shape:o,dtype:n,dataId:e}],"float32"),u=this.texData.get(l.dataId),c=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture,u.texShape[0],u.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(l),c}async time(e){const t=this.activeTimers,n=[];let r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e();const i=w.flatten(this.activeTimers.map(e=>e.query)).filter(e=>null!=e),a=w.flatten(this.activeTimers.map(e=>e.name)).filter(e=>null!=e);this.activeTimers=t,r&&(this.programTimersStack=null);const o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};if(xse().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const e=await Promise.all(i);o.kernelMs=w.sum(e),o.getExtraProfileInfo=()=>e.map((e,t)=>({name:a[t],ms:e})).map(e=>`${e.name}: ${e.ms}`).join(", ")}else o.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,o}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return xse().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:w.now(),endMs:null}}endTimer(e){return xse().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=w.now(),e)}async getQueryTime(e){return xse().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.waitForQueryAndGetTime(e):e.endMs-e.startMs}disposeData(e){if(this.pendingDisposal.has(e))return;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(!this.texData.has(e))return;if(this.texData.get(e).complexParentRefCount>0)return void this.texData.get(e).refCount--;this.releaseGPUData(e);const{complexTensorInfos:t}=this.texData.get(e);null!=t&&(this.texData.get(t.real.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(t.real),this.texData.get(t.imag.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(t.imag)),this.texData.delete(e)}releaseGPUData(e){const{texture:t,dtype:n,texShape:r,usage:i,isPacked:a,slice:o}=this.texData.get(e),s=o&&o.origDataId||e,l=this.dataRefCount.get(s);l>1?this.dataRefCount.set(s,l-1):(this.dataRefCount.delete(s),null!=t&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(t,r,i,a)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture}getDataInfo(e){return this.texData.get(e)}getCPUBackend(){return xse().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Ofe().findBackend("cpu")),this.cpuBackend):null}shouldExecuteOnCPU(e,t=128){const n=this.getCPUBackend();return xse().getBool("IS_TEST")||this.warnedAboutCPUBackend||null!=n||(console.warn("Your application contains ops that are small enough to be executed on the CPU backend, however the CPU backend cannot be found. Consider importing the CPU backend (@tensorflow/tfjs-backend-cpu) for better performance."),this.warnedAboutCPUBackend=!0),null!=n&&e.every(e=>null==this.texData.get(e.dataId).texture&&w.sizeFromShape(e.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){j.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return ELe(e.shape,t)}packedUnaryOp(e,t,n){const r=new _Le(e.shape,t);return this.compileAndRun(r,[e],n)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){const t=rLe(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(xse().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,xLe,e.dtype);const t=new bLe(e.shape,xLe);return this.compileAndRun(t,[e])}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&w.isString(n[0])){const i=n.map(e=>w.encodeString(e));r=this.write(i,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,n){const{dataId:r}=this.makeTensorInfo(e,t,n);return Ofe().makeTensorFromDataId(r,e,t,this)}unpackTensor(e){const t=new kLe(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new fLe(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const n=[KRe(e.shape),...ZRe(e.shape)],r={dtype:e.dtype,shape:n,dataId:e.dataId},i=[KRe(t),...ZRe(t)],a=new pLe(i,n),o=this.runWebGLProgram(a,[r],e.dtype,null,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}}decode(e){const t=this.texData.get(e),{isPacked:n,shape:r,dtype:i}=t,a=JRe(r);let o;return o=n?new fPe(a):new hPe(a),{dtype:i,shape:r,dataId:this.runWebGLProgram(o,[{shape:a,dtype:i,dataId:e}],i,null,!0).dataId}}runWebGLProgram(e,t,n,r,i=!1){const a=this.makeTensorInfo(e.outputShape,n),o=this.texData.get(a.dataId);if(e.packedOutput&&(o.isPacked=!0),e.outPackingScheme===NRe.DENSE){const t=PRe(e.outputShape);o.texShape=t.map(e=>2*e)}if(null!=e.outTexUsage&&(o.usage=e.outTexUsage),0===w.sizeFromShape(a.shape))return o.values=w.getTypedArrayFromDType(a.dtype,0),a;const s=[],l=t.map(t=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&w.sizeFromShape(t.shape)<=xse().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),s.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!ePe(n.shape,t.shape)){const e=t,r=t.shape;t.shape=n.shape,t=this.packedReshape(t,r),s.push(t),n=this.texData.get(t.dataId),e.shape=r}return this.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(a.dataId);const u={shape:a.shape,texData:o,isUniform:!1},c=function(e,t,n){let r="";t.concat(n).forEach(e=>{r+=`${e.shape}_${e.isUniform?"uniform":e.texData.texShape}_${null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0}`});let i=e.constructor.name;return i+="_"+r+"_"+e.userCode,i}(e,l,u),d=this.getAndSaveBinary(c,()=>function(e,t,n,r){const i=t.userCode,a=n.map((e,n)=>{const r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}}),o=a.map(e=>e.shapeInfo),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},l=function(e,t,n,r){const i=[];e.forEach(e=>{const t=w.sizeFromShape(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?i.push(`uniform float ${e.name}${t>1?`[${t}]`:""};`):(i.push(`uniform sampler2D ${e.name};`),i.push(`uniform int offset${e.name};`))});const a=i.join("\n"),o=e.map(e=>function(e,t,n=!1){let r="";return r+=n?function e(t){switch(t.shapeInfo.logicalShape.length){case 0:return function(e){const t=e.name;return`\n    vec4 ${"get"+t.charAt(0).toUpperCase()+t.slice(1)}() {\n      return ${lPe().texture2D}(${t}, halfCR);\n    }\n  `}(t);case 1:return function(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=lPe();return`\n    vec4 ${n}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${i[0]}, ${i[1]}, index);\n      return ${a.texture2D}(${t}, uv);\n    }\n  `}(t);case 2:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,a=i[0],o=i[1],s=lPe();if(null!=i&&w.arraysEqual(t,i))return`\n      vec4 ${r}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${o}.0, ${a}.0);\n\n        return ${s.texture2D}(${n}, uv);\n      }\n    `;const l=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`\n    vec4 ${r}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${Math.ceil(t[1]/2)}, ${l[0]}, ${l[1]}, row, col);\n      return ${s.texture2D}(${n}, uv);\n    }\n  `}(t);case 3:return function(t){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=t.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(1===n[0]){const r=[1,2],a=["b","row","col"];return`\n        ${e(NPe(t,n.slice(1)))}\n        vec4 ${i}(int b, int row, int col) {\n          return ${i}(${jPe(a,r)});\n        }\n      `}const s=o[0],l=o[1],u=Math.ceil(n[2]/2);return`\n    vec4 ${i}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${s}, ${l}, ${u*Math.ceil(n[1]/2)}, ${u}, b, row, col);\n      return ${lPe().texture2D}(${r}, uv);\n    }\n  `}(t);default:return function(e){const t=e.shapeInfo.logicalShape,n=t.length,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=o[0],l=o[1],u=Math.ceil(t[n-1]/2);let c=u*Math.ceil(t[n-2]/2),d="int b, int row, int col",h=`b * ${c} + (row / 2) * ${u} + (col / 2)`;for(let f=2;f<n-1;f++)d=`int b${f}, `+d,c*=t[n-f-1],h=`b${f} * ${c} + `+h;return`\n    vec4 ${i}(${d}) {\n      int index = ${h};\n      int texR = index / ${l};\n      int texC = index - texR * ${l};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${l}, ${s});\n      return ${lPe().texture2D}(${r}, uv);\n    }\n  `}(t)}}(e):function e(t){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return`float ${n}() {return ${t};}`;const[r,i]=e.shapeInfo.texShape;if(1===r&&1===i)return`\n      float ${n}() {\n        return sampleTexture(${t}, halfCR);\n      }\n    `;const[a,o]=e.shapeInfo.texShape;return`\n    float ${n}() {\n      vec2 uv = uvFromFlat(${a}, ${o}, ${OPe(t)});\n      return sampleTexture(${t}, uv);\n    }\n  `}(t);case 1:return function(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return`\n      float ${n}(int index) {\n        ${DPe(e)}\n      }\n    `;const r=e.shapeInfo.texShape,i=r[0],a=r[1];if(1===a&&1===i)return`\n      float ${n}(int index) {\n        return sampleTexture(${t}, halfCR);\n      }\n    `;const o=OPe(t);return 1===a?`\n      float ${n}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / ${i}.0);\n        return sampleTexture(${t}, uv);\n      }\n    `:1===i?`\n      float ${n}(int index) {\n        vec2 uv = vec2((float(index + ${o}) + 0.5) / ${a}.0, 0.5);\n        return sampleTexture(${t}, uv);\n      }\n    `:`\n    float ${n}(int index) {\n      vec2 uv = uvFromFlat(${i}, ${a}, index + ${o});\n      return sampleTexture(${t}, uv);\n    }\n  `}(t);case 2:return function(t){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=t.shapeInfo.texShape;if(null!=a&&w.arraysEqual(n,a))return`\n    float ${i}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${a[1]}.0, ${a[0]}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;const{newShape:o,keptDims:s}=w.squeezeShape(n);if(o.length<n.length){const n=["row","col"];return`\n      ${e(NPe(t,o))}\n      float ${i}(int row, int col) {\n        return ${i}(${jPe(n,s)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));\n        ${DPe(t)}\n      }\n    `;const l=a[0],u=a[1],c=OPe(r);return 1===u?`\n    float ${i}(int row, int col) {\n      float index = dot(vec3(row, col, ${c}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `:1===l?`\n    float ${i}(int row, int col) {\n      float index = dot(vec3(row, col, ${c}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);\n      return sampleTexture(${r}, uv);\n    }\n  `:`\n  float ${i}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${n[1]} + col + ${c};\n    vec2 uv = uvFromFlat(${l}, ${u}, index);\n    return sampleTexture(${r}, uv);\n  }\n`}(t);case 3:return function(t){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n[1]*n[2],o=n[2],{newShape:s,keptDims:l}=w.squeezeShape(n);if(s.length<n.length){const n=["row","col","depth"];return`\n        ${e(NPe(t,s))}\n        float ${i}(int row, int col, int depth) {\n          return ${i}(${jPe(n,l)});\n        }\n      `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${a}, ${o}, 1)));\n        ${DPe(t)}\n      }\n    `;const u=t.shapeInfo.texShape,c=u[0],d=u[1],h=t.shapeInfo.flatOffset;return d===a&&null==h?`\n        float ${i}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${o}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${d}.0, ${c}.0);\n          return sampleTexture(${r}, uv);\n        }\n      `:d===o&&null==h?`\n    float ${i}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${c}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `:`\n      float ${i}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${a} + col * ${o} + depth + ${OPe(r)};\n        vec2 uv = uvFromFlat(${c}, ${d}, index);\n        return sampleTexture(${r}, uv);\n      }\n  `}(t);case 4:return function(t){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n[3],o=n[2]*a,s=n[1]*o,{newShape:l,keptDims:u}=w.squeezeShape(n);if(l.length<n.length){const n=["row","col","depth","depth2"];return`\n      ${e(NPe(t,l))}\n      float ${i}(int row, int col, int depth, int depth2) {\n        return ${i}(${jPe(n,u)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${s}, ${o}, ${a}, 1)));\n        ${DPe(t)}\n      }\n    `;const c=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,h=d[0],f=d[1];return f===s&&null==c?`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${o}, ${a}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${f}.0, ${h}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `:f===a&&null==c?`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${n[1]*n[2]}, ${n[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${f}.0, ${h}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${s} + col * ${o} +\n          depth * ${a} + depth2;\n      vec2 uv = uvFromFlat(${h}, ${f}, index + ${OPe(r)});\n      return sampleTexture(${r}, uv);\n    }\n  `}(t);case 5:return function(t){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n[4],o=n[3]*a,s=n[2]*o,l=n[1]*s,{newShape:u,keptDims:c}=w.squeezeShape(n);if(u.length<n.length){const n=["row","col","depth","depth2","depth3"];return`\n      ${e(NPe(t,u))}\n      float ${i}(int row, int col, int depth, int depth2, int depth3) {\n        return ${i}(${jPe(n,c)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${l}, ${s}, ${o}, ${a})) +\n          depth3;\n        ${DPe(t)}\n      }\n    `;const d=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,f=h[0],p=h[1];return p===l&&null==d?`\n      float ${i}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${s}, ${o}, ${a}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${f}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `:p===a&&null==d?`\n      float ${i}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${n[1]*n[2]*n[3]},\n               ${n[2]*n[3]}, ${n[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${f}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${l} + col * ${s} + depth * ${o} +\n          depth2 * ${a} + depth3 + ${OPe(r)};\n      vec2 uv = uvFromFlat(${f}, ${p}, index);\n      return sampleTexture(${r}, uv);\n    }\n  `}(t);case 6:return function(t){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),{newShape:a,keptDims:o}=w.squeezeShape(n);if(a.length<n.length){const n=["row","col","depth","depth2","depth3","depth4"];return`\n      ${e(NPe(t,a))}\n      float ${i}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${i}(${jPe(n,o)});\n      }\n    `}const s=n[5],l=n[4]*s,u=n[3]*l,c=n[2]*u,d=n[1]*c;if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${d}, ${c}, ${u}, ${l})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${s}, 1)));\n        ${DPe(t)}\n      }\n    `;const h=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,p=f[0],m=f[1];return m===d&&null==h?`\n      float ${i}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${c}, ${u}, ${l}, ${s})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${m}.0, ${p}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `:m===s&&null==h?`\n      float ${i}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${n[1]*n[2]*n[3]*n[4]},\n               ${n[2]*n[3]*n[4]},\n               ${n[3]*n[4]},\n               ${n[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${m}.0, ${p}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${d} + col * ${c} + depth * ${u} +\n          depth2 * ${l} + depth3 * ${s} + depth4 + ${OPe(r)};\n      vec2 uv = uvFromFlat(${p}, ${m}, index);\n      return sampleTexture(${r}, uv);\n    }\n  `}(t);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(e),e.shapeInfo.logicalShape.length<=t.logicalShape.length&&(r+=n?function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",a=e.shapeInfo.logicalShape.length,o=t.logicalShape.length,s=SPe(e.shapeInfo.logicalShape,t.logicalShape),l=MPe(o),u=o-a;let c;const d=["x","y","z","w","u","v"];c=0===a?"":o<2&&s.length>=1?"coords = 0;":s.map(e=>`coords.${d[e+u]} = 0;`).join("\n");let h="";h=o<2&&a>0?"coords":e.shapeInfo.logicalShape.map((e,t)=>"coords."+d[t+u]).join(", ");let f="return outputValue;";const p=1===w.sizeFromShape(e.shapeInfo.logicalShape),m=1===w.sizeFromShape(t.logicalShape);if(1!==a||p||m){if(p&&!m)f=1===o?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(s.length){const e=a-2,t=a-1;s.indexOf(e)>-1&&s.indexOf(t)>-1?f="return vec4(outputValue.x);":s.indexOf(e)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":s.indexOf(t)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${i}() {\n      ${l} coords = getOutputCoords();\n      ${c}\n      vec4 outputValue = get${r}(${h});\n      ${f}\n    }\n  `}(e,t):function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",a=e.shapeInfo.logicalShape.length,o=t.logicalShape.length;if(!e.shapeInfo.isUniform&&a===o&&null==e.shapeInfo.flatOffset&&w.arraysEqual(e.shapeInfo.texShape,t.texShape))return`\n      float ${i}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;const s=MPe(o),l=SPe(e.shapeInfo.logicalShape,t.logicalShape),u=o-a;let c;const d=["x","y","z","w","u","v"];c=0===a?"":o<2&&l.length>=1?"coords = 0;":l.map(e=>`coords.${d[e+u]} = 0;`).join("\n");let h="";return h=o<2&&a>0?"coords":e.shapeInfo.logicalShape.map((e,t)=>"coords."+d[t+u]).join(", "),`\n    float ${i}() {\n      ${s} coords = getOutputCoords();\n      ${c}\n      return get${r}(${h});\n    }\n  `}(e,t)),r}(e,t,r)).join("\n"),s=t.texShape,l=lPe(),u=function(e){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${e.texture2D}(textureSampler, uv).r;\n    }\n  `}(l);let c,d,h=function(e){return`${e.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${e.varyingFs} vec2 resultUV;\n    ${e.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${e.defineSpecialNaN}\n    ${e.defineSpecialInf}\n    ${e.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${TPe}\n    ${CPe}\n    ${IPe}\n  `}(l);return t.isPacked?(c=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){const n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${n[1]}.0);\n      }\n    `:1===n[1]?`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${n[0]}.0);\n      }\n    `:`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      return 2 * (resTexRC.x * ${n[1]} + resTexRC.y);\n    }\n  `}(0,t);case 2:return function(e,t){const n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(w.arraysEqual(e,t))return`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${n[0]}, ${n[1]}));\n      }\n    `;const r=Math.ceil(e[1]/2);return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n\n      int index = resTexRC.x * ${n[1]} + resTexRC.y;\n      int r = 2 * (index / ${r});\n      int c = imod(index, ${r}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}(e,t);case 3:return function(e,t){const n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),i=r*Math.ceil(e[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      int index = resTexRC.x * ${n[1]} + resTexRC.y;\n\n      int b = index / ${i};\n      index -= b * ${i};\n\n      int r = 2 * (index / ${r});\n      int c = imod(index, ${r}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}(e,t);default:return function(e,t){const n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),i=r*Math.ceil(e[e.length-2]/2);let a=i,o="",s="b, r, c";for(let l=2;l<e.length-1;l++)a*=e[e.length-l-1],o=`\n      int b${l} = index / ${a};\n      index -= b${l} * ${a};\n    `+o,s=`b${l}, `+s;return`\n    ivec${e.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      int index = resTexRC.x * ${n[1]} + resTexRC.y;\n\n      ${o}\n\n      int b = index / ${i};\n      index -= b * ${i};\n\n      int r = 2 * (index / ${r});\n      int c = imod(index, ${r}) * 2;\n\n      return ivec${e.length}(${s});\n    }\n  `}(e,t)}}(t.logicalShape,s),d=function(e){return`\n    void setOutput(vec4 val) {\n      ${e.output} = val;\n    }\n  `}(l)):(c=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(n=t)[0]?`\n      int getOutputCoords() {\n        return int(resultUV.x * ${n[1]}.0);\n      }\n    `:1===n[1]?`\n      int getOutputCoords() {\n        return int(resultUV.y * ${n[0]}.0);\n      }\n    `:`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      return resTexRC.x * ${n[1]} + resTexRC.y;\n    }\n  `;case 2:return function(e,t){return w.arraysEqual(e,t)?`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));\n      }\n    `:1===e[1]?`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `:1===e[0]?`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `:`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      int r = index / ${e[1]};\n      int c = index - r * ${e[1]};\n      return ivec2(r, c);\n    }\n  `}(e,t);case 3:return function(e,t){const n=uPe(["r","c","d"],e);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${n}\n      return ivec3(r, c, d);\n    }\n  `}(e,t);case 4:return function(e,t){const n=uPe(["r","c","d","d2"],e);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${n}\n      return ivec4(r, c, d, d2);\n    }\n  `}(e,t);case 5:return function(e,t){const n=uPe(["r","c","d","d2","d3"],e);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},\n                             ${t[1]}));\n\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}(e,t);case 6:return function(e,t){const n=uPe(["r","c","d","d2","d3","d4"],e);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n}(t.logicalShape,s),d=function(e){return`\n    void setOutput(float val) {\n      ${e.output} = vec4(val, 0, 0, 0);\n    }\n  `}(l)),r&&(h+=APe),[h,u,d,a,c,o,n].join("\n")}(a,s,i,t.packedInputs),u=e.createProgram(l);let c=null;const d=e.getUniformLocation(u,"NAN",!1);1===xse().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(u,"INFINITY",!1));const h={};for(let f=0;f<t.variableNames.length;f++){const n=t.variableNames[f],r=!1;h[n]=e.getUniformLocation(u,n,r),h["offset"+n]=e.getUniformLocation(u,"offset"+n,r)}return{program:t,source:l,webGLProgram:u,uniformLocations:h,inShapeInfos:o,outShapeInfo:s,infLoc:c,nanLoc:d}}(this.gpgpu,e,l,u)),h=null!=this.activeTimers;let f;if(h&&(f=this.startTimer()),function(e,t,n,r,i){FPe(t.inShapeInfos,n),FPe([t.outShapeInfo],[r]);const a=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a,o[0],o[1]):e.setOutputMatrixTexture(a,o[0],o[1]),e.setProgram(t.webGLProgram),1===xse().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((n,r)=>{const i=t.program.variableNames[r],a=t.uniformLocations[i],o=t.uniformLocations["offset"+i];if(null!=a)if(n.isUniform)if(w.sizeFromShape(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{let t=n.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(a,t)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,r)}),null!=i&&i(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,d,l,u,r),s.forEach(e=>this.disposeIntermediateTensorInfo(e)),h&&(f=this.endTimer(f),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(f)})),!xse().getBool("WEBGL_LAZILY_UNPACK")&&o.isPacked&&!1===i){const e=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),e}return a}compileAndRun(e,t,n,r,i=!1){const a=this.runWebGLProgram(e,t,n=n||t[0].dtype,r,i);return Ofe().makeTensorFromDataId(a.dataId,a.shape,a.dtype)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(xse().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Nfe(()=>{if(!xse().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=xse().getBool("DEBUG");xse().set("DEBUG",!1);const t=this.abs(ope(1e-8)).dataSync()[0];if(xse().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(e){const t=this.texData.get(e),{shape:n,dtype:r,values:i,texture:a,usage:o,isPacked:s}=t;if(null!=a)return;const l=null!=this.activeTimers;let u;l&&(u=w.now());let c=t.texShape;if(null==c&&(c=function(e,t=!1){let n=xse().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,1===(e=e.map((t,n)=>n>=e.length-2?w.nearestLargerEven(e[n]):e[n])).length&&(e=[2,e[0]])),2!==e.length){const t=w.squeezeShape(e);e=t.newShape}let r=w.sizeFromShape(e);if(e.length<=1&&r<=n)return[1,r];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){const t=KRe(e);let n=2,i=2;return e.length&&([n,i]=ZRe(e)),r=t*(n/2)*(i/2),w.sizeToSquarishShape(r).map(e=>2*e)}return w.sizeToSquarishShape(r)}(n,s),t.texShape=c),null!=i){const e=JRe(n);let a,o=c[1],d=c[0];const h=i instanceof Uint8Array;s?([o,d]=LRe(c[0],c[1]),a=new vPe(e,[d,o],h)):a=new gPe(e,[d,o],h);const f=this.makeTensorInfo([d,o],r);this.texData.get(f.dataId).usage=h?jRe.PIXELS:jRe.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(f.dataId),o,d,i);const p=this.runWebGLProgram(a,[f],r,null,!0),m=this.texData.get(p.dataId);t.texture=m.texture,t.texShape=m.texShape,t.isPacked=m.isPacked,t.usage=m.usage,this.disposeIntermediateTensorInfo(f),this.texData.delete(p.dataId),t.values=null,l&&(this.uploadWaitMs+=w.now()-u)}else{const e=this.acquireTexture(c,o,r,s);t.texture=e}}convertAndCacheOnCPU(e,t){const n=this.texData.get(e),{dtype:r}=n;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){const n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values}acquireTexture(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${e} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*w.bytesPerElement(t)}}k.isBrowser()&&Hfe("webgl",()=>new TLe,2);class CLe{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=j.assertAndGetBroadcastShape(t,n),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${e}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}class ILe{constructor(e,t,n,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=j.assertAndGetBroadcastShape(t,n);const i=this.outputShape.length;let a="";if(r)if(0===i||1===w.sizeFromShape(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a=`\n          ${MPe(i)} coords = getOutputCoords();\n        `,1===i)a+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const e=hLe("coords",i);a+=`\n            bool nextRowOutOfBounds =\n              (${e[i-2]} + 1) >= ${this.outputShape[i-2]};\n            bool nextColOutOfBounds =\n              (${e[i-1]} + 1) >= ${this.outputShape[i-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${e}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${a}\n\n        setOutput(result);\n      }\n    `}}function ALe(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const OLe={kernelName:Rle,backendName:"webgl",kernelFunc:ALe};function DLe(e){const{inputs:t,backend:n}=e,{real:r,imag:i}=t,a=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(a.dataId),s=ALe({inputs:{x:r},backend:n});n.texData.get(s.dataId).complexParentRefCount++;const l=ALe({inputs:{x:i},backend:n});return n.texData.get(l.dataId).complexParentRefCount++,o.complexTensorInfos={real:s,imag:l},a}const MLe={kernelName:Kse,backendName:"webgl",kernelFunc:DLe},NLe="return (a < 0.) ? b * a : a;",jLe="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",FLe={kernelName:Ule,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{alpha:a}=r,o=n.makeTensorInfo([],"float32",w.createScalarValue(a,"float32")),s=xse().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ILe(jLe,i.shape,o.shape):new CLe(NLe,i.shape,o.shape),l=n.runWebGLProgram(s,[i,o],i.dtype);return n.disposeIntermediateTensorInfo(o),l}},RLe="return (a < 0.) ? b * a : a;",PLe="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",LLe={kernelName:Sue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r,alpha:i}=t,a=xse().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ILe(PLe,r.shape,i.shape):new CLe(RLe,r.shape,i.shape);return n.runWebGLProgram(a,[r,i],r.dtype)}};function BLe({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:n,dtype:r}){return({inputs:i,backend:a})=>{const{x:o}=i,s=a,l=r||o.dtype;if(s.shouldExecuteOnCPU([o])&&null!=n){const e=s.texData.get(o.dataId),t=n(e.values,l);return s.makeTensorInfo(o.shape,l,t)}let u;return u=xse().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=t?new _Le(o.shape,t):new bLe(o.shape,e),s.runWebGLProgram(u,[o],l)}}function $Le({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:i,dtype:a}){return({inputs:o,backend:s})=>{const{a:l,b:u}=o,c=s;if(r&&"complex64"===l.dtype){const t=c.texData.get(l.dataId),n=c.texData.get(u.dataId),[r,i]=[[t.complexTensorInfos.real,n.complexTensorInfos.real],[t.complexTensorInfos.imag,n.complexTensorInfos.imag]].map(t=>{const[n,r]=t,i={dataId:n.dataId,dtype:n.dtype,shape:l.shape},a={dataId:r.dataId,dtype:r.dtype,shape:u.shape},o=new CLe(e,l.shape,u.shape);return c.runWebGLProgram(o,[i,a],tde(n.dtype,r.dtype))}),a=DLe({inputs:{real:r,imag:i},backend:c});return c.disposeIntermediateTensorInfo(r),c.disposeIntermediateTensorInfo(i),a}const d=a||tde(l.dtype,u.dtype);if(c.shouldExecuteOnCPU([l,u])&&null!=i){const e=c.texData.get(l.dataId),t=c.texData.get(u.dataId),[n,r]=i(l.shape,u.shape,e.values,t.values,d),a=c.makeTensorInfo(r,d);return c.texData.get(a.dataId).values=n,a}let h;return h=xse().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=t?new ILe(t,l.shape,u.shape,n):new CLe(e,l.shape,u.shape),c.runWebGLProgram(h,[l,u],d)}}function zLe(e,t=!1){if("linear"===e)return"return x;";if("relu"===e)return t?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n";if("elu"===e)return t?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n";if("prelu"===e)return t?PLe:RLe;if("leakyrelu"===e)return t?jLe:NLe;throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}class ULe{constructor(e,t,n,r=!1,i=!1,a=!1,o=null,s=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;const u=Math.ceil((r?e[1]:e[2])/2),c=r?"i * 2, rc.y":"rc.y, i * 2",d=i?"rc.z, i * 2":"i * 2, rc.z",h=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let p="",m="";o&&(p=s?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${o}\n        }`:l?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${o}\n        }`:`vec4 activation(vec4 x) {\n          ${o}\n        }`,m="result = activation(result);");const g=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let v="rc.x",y="rc.x";e[0]<t[0]?v=`int(min(float(rc.x), ${e[0]-1}.))`:t[0]<e[0]&&(y=`int(min(float(rc.x), ${t[0]-1}.))`),this.userCode=`\n      ${p}\n\n      const float sharedDimension = ${u}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ${u}; i++) {\n          int batchA = ${v};\n          int batchB = ${y};\n          vec4 a = getMatrixA(batchA, ${c});\n          vec4 b = getMatrixB(batchB, ${d});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${h[0]} * ${f[0]});\n          result += (${h[1]} * ${f[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${g}\n\n        ${m}\n\n        setOutput(result);\n      }\n    `}}class HLe{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=j.assertAndGetBroadcastShape(t,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${e}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}const WLe="return a * b;";function VLe(e){const{inputs:t,backend:n}=e,{a:r,b:i}=t,a=j.upcastType(r.dtype,i.dtype);if("complex64"===r.dtype){const e=n.texData.get(r.dataId),t=n.texData.get(i.dataId),a=new HLe("return areal * breal - aimag * bimag;",r.shape,i.shape),o=new HLe("return areal * bimag + aimag * breal;",r.shape,i.shape),s=[{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:r.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:i.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:i.shape}],l=n.runWebGLProgram(a,s,"float32"),u=n.runWebGLProgram(o,s,"float32"),c=DLe({inputs:{real:l,imag:u},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),c}if(n.shouldExecuteOnCPU([r,i])){const e=n.texData.get(r.dataId),t=n.texData.get(i.dataId),[o,s]=JPe(r.shape,i.shape,e.values,t.values,a),l=n.makeTensorInfo(s,a);return n.texData.get(l.dataId).values=o,l}let o;return o=xse().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ILe(WLe,r.shape,i.shape):new CLe(WLe,r.shape,i.shape),n.runWebGLProgram(o,[r,i],a)}const qLe={kernelName:fue,backendName:"webgl",kernelFunc:VLe};function GLe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{shape:a}=r,o=n,s=w.sizeFromShape(i.shape),l=w.inferFromImplicitShape(a,s),u=w.sizeFromShape(l);w.assert(s===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${i.shape}) has ${s} elements. The new shape and old shape must have the same number of elements.`);const c=o.texData.get(i.dataId);return!c.isPacked||ePe(i.shape,l)||null!==c.texture&&ePe(c.shape,l)?(o.incRef(i.dataId),{dataId:i.dataId,shape:l,dtype:i.dtype}):function(e,t,n){const r=[KRe(e.shape),...ZRe(e.shape)],i={dtype:e.dtype,shape:r,dataId:e.dataId},a=[KRe(t),...ZRe(t)],o=new pLe(a,r),s=n.runWebGLProgram(o,[i],e.dtype,null,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}(i,l,o)}const YLe={kernelName:Due,backendName:"webgl",kernelFunc:GLe};class XLe{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:i,outSize:a}=e;this.outputShape=[r,a];const o=4*Math.floor(n/4),s=n%4;let l="sumValue += dot(values, ones);";if(null!=t){const e=1/t;l=`sumValue += dot(values * ${w.isInt(e)?e.toPrecision(2):e}, ones);`}let u="";i%n>0&&(u=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return 0.0;\n        }\n      `),this.userCode=`\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${u}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${o}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${l}\n        }\n\n        int inIdx = inOffset + ${o};\n        if (${1===s}) {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ${l}\n        } else if (${2===s}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ${l}\n        } else if (${3===s}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ${l}\n        }\n        setOutput(sumValue);\n      }\n    `}}class KLe{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:i,outSize:a}=e;this.outputShape=[r,a];let o="0.0",s="";"prod"===t?o="1.0":"min"===t?(o="1.0 / 1e-20",s="min"):"max"===t&&(o="-1.0 / 1e-20",s="max");let l=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===t?l="sumValue":"prod"===t?l="prodValue":"all"===t?l="allValue":"any"===t&&(l="anyValue");const u=4*Math.floor(n/4),c=n%4;let d=`\n      if (${"sum"===t}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===t}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${s}(values, minMaxValue);\n      }\n    `,h="vec4";"all"===t?(o="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===t&&(o="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");let f="";i%n>0&&(f=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${o};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${f}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${o});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${u}; i += 4) {\n          int inIdx = inOffset + i;\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${d}\n        }\n\n        int inIdx = inOffset + ${u};\n        if (${1===c}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${d}\n        } else if (${2===c}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${d}\n        } else if (${3===c}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${d}\n        }\n        setOutput(${l});\n      }\n    `}}function ZLe(e,t,n,r){const i=function(e){const t=[];for(;0===t.length||1!==t[t.length-1].outSize;){const n=t.length?t[t.length-1].outSize:e[1],r=j.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape);let a=e;for(let o=0;o<i.length;o++){const{inSize:s,windowSize:l,outSize:u}=i[o];let c,d;c="mean"===n?0===o?new XLe({windowSize:l,inSize:s,batchSize:e.shape[0],outSize:u},s):new XLe({windowSize:l,inSize:s,batchSize:e.shape[0],outSize:u}):new KLe({windowSize:l,inSize:s,batchSize:e.shape[0],outSize:u},n),d=a,a=r.runWebGLProgram(c,[a],t),d.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(d)}return a}class JLe{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let a=0;a<n.length;a++)n[a]=e[t[a]];this.outputShape=n,this.rank=n.length;const r=MPe(this.rank),i=function(e){const t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let i=0;i<e.length;i++)r[e[i]]=n[i];return r.join()}(t);this.userCode=`\n    void main() {\n      ${r} resRC = getOutputCoords();\n      setOutput(getA(${i}));\n    }\n    `}}class QLe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(e.length);for(let u=0;u<n.length;u++)n[u]=e[t[u]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=MPe(this.rank),i=dLe("rc",this.rank),a=new Array(this.rank);for(let u=0;u<t.length;u++)a[t[u]]=i[u];const o=`vec2(${a.slice(-2).join()})`,s=`++${i[this.rank-1]} < ${n[this.rank-1]}`,l=`getChannel(getA(${a.join()}), ${o})`;this.userCode=`\n    void main() {\n      ${r} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${l};\n      if(${s}) {\n        result[1] = ${l};\n      }\n      --${i[this.rank-1]};\n      if(++${i[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${l};\n        if(${s}) {\n          result[3] = ${l};\n        }\n      }\n      setOutput(result);\n    }\n    `}}function eBe(e,t,n){const r=xse().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new QLe(e.shape,t):new JLe(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function tBe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:o}=r;return function(e,t,n,r){const i=e.shape.length,a=w.parseAxisParam(t,e.shape);let o=a;const s=j.getAxesPermutation(o,i),l=null!=s;let u=e;l&&(u=eBe(e,s,r),o=j.getInnerMostAxes(o.length,i)),j.assertAxesAreInnerMostDims("sum",o,i);const[c,d]=j.computeOutAndReduceShapes(u.shape,o);let h=c;n&&(h=j.expandShapeToKeepDim(c,a));const f=w.sizeFromShape(d),p=GLe({inputs:{x:u},attrs:{shape:[w.sizeFromShape(e.shape)/f,f]},backend:r}),m=ZLe(p,nde(e.dtype),"sum",r),g=GLe({inputs:{x:m},attrs:{shape:h},backend:r});return r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(m),l&&r.disposeIntermediateTensorInfo(u),g}(i,a,o,n)}const nBe={kernelName:Kue,backendName:"webgl",kernelFunc:tBe};function rBe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{perm:a}=r,o=n,s=new Array(i.shape.length);for(let u=0;u<s.length;u++)s[u]=i.shape[a[u]];let l;if(o.shouldExecuteOnCPU([i])){const e=o.texData.get(i.dataId),t=uLe(e.values,i.shape,i.dtype,a,s);l=o.makeTensorInfo(s,i.dtype),o.texData.get(l.dataId).values=t}else l=eBe(i,a,o);return l}const iBe={kernelName:uce,backendName:"webgl",kernelFunc:rBe};function aBe({a:e,b:t,transposeA:n,transposeB:r,backend:i,bias:a=null,preluActivationWeights:o=null,leakyreluAlpha:s=0,activation:l=null}){const u=e.shape.length,c=t.shape.length,d=n?e.shape[u-2]:e.shape[u-1],h=r?t.shape[c-1]:t.shape[c-2],f=n?e.shape[u-1]:e.shape[u-2],p=r?t.shape[c-2]:t.shape[c-1],m=e.shape.slice(0,-2),g=t.shape.slice(0,-2),v=w.sizeFromShape(m),y=w.sizeFromShape(g);w.assert(u>=2&&c>=2&&(v===y||1===v||1===y),()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${m}) and (${g}).`);const b=(v>y?e.shape.slice(0,-2):t.shape.slice(0,-2)).concat([f,p]);w.assert(d===h,()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${r} must match.`);const x=n?[v,d,f]:[v,f,d],_=r?[y,p,h]:[y,h,p],k=GLe({inputs:{x:e},backend:i,attrs:{shape:x}}),E=GLe({inputs:{x:t},backend:i,attrs:{shape:_}}),S=[k,E],T=Math.max(v,y),C=n?k.shape[1]:k.shape[2],I=null!=a,A=null!=o,O="leakyrelu"===l,D=null!=l?zLe(l,!0):null;let M;if((1===f||1===p)&&C>1e3&&!1===(I||A||O||null!=D)){let e=k,t=E;n&&(e=rBe({inputs:{x:k},backend:i,attrs:{perm:[0,2,1]}}),S.push(e)),r&&(t=rBe({inputs:{x:E},backend:i,attrs:{perm:[0,2,1]}}),S.push(t));const a=1===p;let o=e;1!==p&&(o=GLe({inputs:{x:e},backend:i,attrs:{shape:[T,C,1]}}),S.push(o));const s=1===p?2:1;let l=t;a&&(l=GLe({inputs:{x:t},backend:i,attrs:{shape:[T,1,C]}}),S.push(l));const u=VLe({inputs:{a:o,b:l},backend:i});M=tBe({inputs:{x:u},backend:i,attrs:{axis:s,keepDims:!0}}),S.push(u)}else{const l=tde(e.dtype,t.dtype),u=new ULe(x,_,[T,f,p],n,r,I,D,A,O),c=[k,E];if(null!=a&&c.push(a),A&&c.push(o),O){const e=i.makeTensorInfo([],"float32",w.createScalarValue(s,"float32"));c.push(e),S.push(e)}M=i.runWebGLProgram(u,c,l)}const N=GLe({inputs:{x:M},backend:i,attrs:{shape:b}});S.push(M);for(const w of S)i.disposeIntermediateTensorInfo(w);return N}const oBe={kernelName:vce,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:a,bias:o,preluActivationWeights:s}=t,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:d}=r;return aBe({a:i,b:a,transposeA:l,transposeB:u,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:d,activation:c})}},sBe="return abs(x);",lBe={kernelName:Sse,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])&&"complex64"!==r.dtype){const e=n.texData.get(r.dataId),t=rLe(e.values);return n.makeTensorInfo(r.shape,r.dtype,t)}let i;return i=xse().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new _Le(r.shape,sBe):new bLe(r.shape,sBe),n.runWebGLProgram(i,[r],r.dtype)}},uBe=BLe({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),cBe={kernelName:Tse,backendName:"webgl",kernelFunc:uBe},dBe=BLe({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),hBe={kernelName:Cse,backendName:"webgl",kernelFunc:dBe},fBe="return a + b;",pBe=$Le({opSnippet:fBe,packedOpSnippet:fBe,supportsComplex:!0,cpuKernelImpl:RPe}),mBe={kernelName:Ise,backendName:"webgl",kernelFunc:pBe};class gBe{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((e,t)=>"T"+t);const n=[];this.variableNames.forEach(e=>{n.push(`float v${e} = get${e}AtOutCoords();`)});const r=this.variableNames.map(e=>"v"+e).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${r};\n        setOutput(result);\n      }\n    `}}class vBe{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((e,t)=>"T"+t);const n=[];this.variableNames.forEach(e=>{n.push(`vec4 v${e} = get${e}AtOutCoords();`)});const r=this.variableNames.map(e=>"v"+e).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${r};\n        setOutput(result);\n      }\n    `}}const yBe={kernelName:Ase,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r}=t,i=n;if(1===i.length)return ALe({inputs:{x:i[0]},backend:r});if(i.length>xse().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const t=Math.floor(i.length/2),n=e({inputs:i.slice(0,t),backend:r}),a=e({inputs:i.slice(t),backend:r});return e({inputs:[n,a],backend:r})}const a=i.map(e=>e.dtype).reduce((e,t)=>tde(e,t)),o=i.map(e=>e.shape),s=xse().getBool("WEBGL_PACK")?new vBe(i[0].shape,o):new gBe(i[0].shape,o);return r.runWebGLProgram(s,i,a)}},bBe={kernelName:Ose,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:o}=r,s=i.shape.length,l=w.parseAxisParam(a,i.shape);let u=l;const c=j.getAxesPermutation(u,s);let d=i;null!=c&&(d=rBe({inputs:{x:i},backend:n,attrs:{perm:c}}),u=j.getInnerMostAxes(u.length,s)),j.assertAxesAreInnerMostDims("all",u,s);const[h,f]=j.computeOutAndReduceShapes(d.shape,u),p=GLe({inputs:{x:d},backend:n,attrs:{shape:[-1,w.sizeFromShape(f)]}}),m=ZLe(p,p.dtype,"all",n);let g;return g=GLe(o?{inputs:{x:m},backend:n,attrs:{shape:j.expandShapeToKeepDim(h,l)}}:{inputs:{x:m},backend:n,attrs:{shape:h}}),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(d),g}},xBe={kernelName:Dse,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:o}=r,s=i.shape.length,l=w.parseAxisParam(a,i.shape);let u=l;const c=j.getAxesPermutation(u,s);let d=i;null!=c&&(d=rBe({inputs:{x:i},backend:n,attrs:{perm:c}}),u=j.getInnerMostAxes(u.length,s)),j.assertAxesAreInnerMostDims("any",u,s);const[h,f]=j.computeOutAndReduceShapes(d.shape,u),p=GLe({inputs:{x:d},backend:n,attrs:{shape:[-1,w.sizeFromShape(f)]}}),m=ZLe(p,p.dtype,"any",n);let g;return g=GLe(o?{inputs:{x:m},backend:n,attrs:{shape:j.expandShapeToKeepDim(h,l)}}:{inputs:{x:m},backend:n,attrs:{shape:h}}),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(d),g}};class wBe{constructor(e,t,n){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:a}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${r};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${r}; i++) {\n          int inIdx = ${n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));"};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${"max"===t?">":"<"} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}class _Be{constructor(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,w.assert(e.length>2,()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`);const i=Math.ceil(e[e.length-1]/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,o=a.length,s=MPe(o),l=hLe("coords",o);let u,c;if(1===i){c=o+1;const e=MPe(c);u=`\n        ${e} sourceLocR = ${e}(${l.join()}, 0);\n        ++${l[o-1]};\n        ${e} sourceLocG = ${e}(${l.join()}, 0);\n        ++${l[o-2]};\n        ${e} sourceLocA = ${e}(${l.join()}, 0);\n        --${l[o-1]};\n        ${e} sourceLocB = ${e}(${l.join()}, 0);\n        --${l[o-2]};`}else c=o,u=`\n        ${s} sourceLocR = coords;\n        ++${l[o-1]};\n        ${s} sourceLocG = coords;\n        ++${l[o-2]};\n        ${s} sourceLocA = coords;\n        --${l[o-1]};\n        ${s} sourceLocB = coords;\n        --${l[o-2]};`;const d=["x","y","z","w","u","v"].slice(0,c),h="."+d[c-1],f=d.map(e=>"int "+e),p=hLe("sourceLocR",c-1).concat("inIdx.r"),m=hLe("sourceLocG",c-1).concat("inIdx.g"),g=hLe("sourceLocB",c-1).concat("inIdx.b"),v=hLe("sourceLocA",c-1).concat("inIdx.a"),y="max"===n?"greaterThan":"lessThan",b=r?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${p.join()}),\n                             getBestIndicesAChannel(${m.join()}),\n                             getBestIndicesAChannel(${g.join()}),\n                             getBestIndicesAChannel(${v.join()})));`,x=`vec4(\n            getAChannel(${p.join()}),\n            hasNextCol ? getAChannel(${m.join()}) : 0.,\n            hasNextRow ? getAChannel(${g.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${v.join()}) : 0.)`,_=r?"":`\n      float getBestIndicesAChannel(${f.join()}) {\n        return getChannel(getBestIndicesA(${d.join()}),\n                                          vec2(${d.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${f.join()}) {\n        return getChannel(getA(${d.join()}),\n                               vec2(${d.slice(-2).join()}));\n      }\n      ${_}\n      void main() {\n        ${s} coords = getOutputCoords();\n        bool hasNextCol = ${l[o-1]} < ${a[o-1]-1};\n        bool hasNextRow = ${l[o-2]} < ${a[o-2]-1};\n        ${u}\n        ivec4 srcIdx = ivec4(sourceLocR${h}, sourceLocG${h},\n          sourceLocB${h}, sourceLocA${h}) * ${t};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${x};\n\n        for (int i = 0; i < ${t}; i++) {\n          inIdx = srcIdx;\n          ${b}\n          vec4 candidate = ${x};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${y}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}function kBe(e,t,n,r){const i=[n];if(j.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),i,t.shape.length),!xse().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const n=[],[a,o]=j.computeOutAndReduceShapes(t.shape,i),s=w.sizeFromShape(o),l=GLe({inputs:{x:t},backend:e,attrs:{shape:[-1,s]}});n.push(l);const u=function e(t,n,r,i=null){let a=n.shape[0],o=n.shape[1];null!=i&&(a=i.shape[0],o=i.shape[1]);const s=j.computeOptimalWindowSize(o),l={windowSize:s,inSize:o,batchSize:a,outSize:Math.ceil(o/s)},u=new wBe(l,r,null==i),c=[n];null!=i&&c.push(i);const d=t.runWebGLProgram(u,c,"int32");if(1===d.shape[1])return d;const h=e(t,n,r,d);return t.disposeIntermediateTensorInfo(d),h}(e,l,r);n.push(u);const c=GLe({inputs:{x:u},backend:e,attrs:{shape:a}});return n.forEach(t=>e.disposeIntermediateTensorInfo(t)),c}return function e(t,n,r,i=null){const a=null!=i?i.shape:n.shape,o=j.computeOptimalWindowSize(a[a.length-1]),s=new _Be(a,o,r,null==i),l=t.runWebGLProgram(s,null==i?[n]:[n,i],"int32");if(l.shape.length===n.shape.length){const i=e(t,n,r,l);return t.disposeIntermediateTensorInfo(l),i}return l}(e,t,r)}const EBe={kernelName:Mse,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a}=r;let o=w.parseAxisParam(a,i.shape);const s=j.getAxesPermutation(o,i.shape.length);let l=i;const u=[];null!=s&&(l=rBe({inputs:{x:i},backend:n,attrs:{perm:s}}),u.push(l),o=j.getInnerMostAxes(o.length,l.shape.length)),j.assertAxesAreInnerMostDims("argMax",[o[0]],l.shape.length);const c=kBe(n,l,o[0],"max");return u.forEach(e=>n.disposeIntermediateTensorInfo(e)),c}},SBe={kernelName:Nse,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a}=r;let o=w.parseAxisParam(a,i.shape);const s=j.getAxesPermutation(o,i.shape.length);let l=i;const u=[];null!=s&&(l=rBe({inputs:{x:i},backend:n,attrs:{perm:s}}),u.push(l),o=j.getInnerMostAxes(o.length,l.shape.length)),j.assertAxesAreInnerMostDims("argMin",[o[0]],l.shape.length);const c=kBe(n,l,o[0],"min");return u.forEach(e=>n.disposeIntermediateTensorInfo(e)),c}},TBe=BLe({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),CBe={kernelName:jse,backendName:"webgl",kernelFunc:TBe},IBe=BLe({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"}),ABe={kernelName:Fse,backendName:"webgl",kernelFunc:IBe},OBe=BLe({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"}),DBe={kernelName:Rse,backendName:"webgl",kernelFunc:OBe},MBe=$Le({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),NBe={kernelName:Lse,backendName:"webgl",kernelFunc:MBe},jBe=BLe({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),FBe={kernelName:Pse,backendName:"webgl",kernelFunc:jBe};class RBe{constructor(e,t,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const a=e.filterWidth,o=e.strideHeight,s=e.strideWidth,l=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;const p="avg"===t;let m="0.0";if(p||(m="-1.0 / 1e-20"),n)return void(this.userCode=`\n        const ivec2 strides = ivec2(${o}, ${s});\n        const ivec2 pads = ivec2(${h}, ${f});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${c};\n              wR += ${l}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${d};\n                wC += ${u}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${r?i?`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`:`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`:`wR * ${d} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `);let g=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(g="avgValue / count");const v=4*Math.floor(a/4),y=a%4,b=`\n      if (${p}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${o}, ${s});\n      const ivec2 pads = ivec2(${h}, ${f});\n      const float initializationValue = ${m};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${e.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${m});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${c};\n            wR += ${l}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${v}; wC += 4) {\n            int xC = xCCorner + wC * ${u};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              getValue(batch, xR, xC + 2 * ${u}, d),\n              getValue(batch, xR, xC + 3 * ${u}, d)\n            );\n\n            ${b}\n          }\n\n          int xC = xCCorner + ${v};\n          if (${1===y}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${b}\n          } else if (${2===y}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${b}\n          } else if (${3===y}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              getValue(batch, xR, xC + 2 * ${u}, d),\n              initializationValue\n            );\n\n            ${b}\n          }\n        }\n        setOutput(${g});\n      }\n    `}}class PBe{constructor(e,t,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const a=e.filterWidth,o=e.strideDepth,s=e.strideHeight,l=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterDepth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,v=e.padInfo.left;this.outputShape=e.outShape;const y="avg"===t;let b="0.0";if(y||(b="-1.0 / 1e-20"),n)return void(this.userCode=`\n        const ivec3 strides =\n            ivec3(${o}, ${s}, ${l});\n        const ivec3 pads = ivec3(${m}, ${g}, ${v});\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ${h};\n              wD += ${u}) {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ${e.inDepth}) {\n              continue;\n            }\n\n            for (int wR = 0; wR < ${f};\n                wR += ${c}) {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ${e.inHeight}) {\n                continue;\n              }\n\n              for (int wC = 0; wC < ${p};\n                  wC += ${d}) {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ${e.inWidth}) {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${f} * ${p} +\n                      wR * ${p} + wC`};\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `);let x=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(x="avgValue / count");const w=4*Math.floor(a/4),_=a%4,k=`\n      if (${y}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec3 strides =\n        ivec3(${o}, ${s}, ${l});\n      const ivec3 pads = ivec3(${m}, ${g}, ${v});\n      const float initializationValue = ${b};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ${e.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${b});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ${h};\n            wD += ${u}) {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ${e.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${f};\n            wR += ${c}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${w}; wC += 4) {\n              int xC = xCCorner + wC * ${d};\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${d}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${d}, ch),\n                getValue(batch, xD, xR, xC + 3 * ${d}, ch)\n              );\n\n              ${k}\n            }\n\n            int xC = xCCorner + ${w};\n            if (${1===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ${k}\n            } else if (${2===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${d}, ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ${k}\n            } else if (${3===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${d}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${d}, ch),\n                initializationValue\n              );\n\n              ${k}\n            }\n          }\n          setOutput(${x});\n        }\n      }\n    `}}const LBe={kernelName:Bse,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;oPe(i,"avgPool");const{filterSize:a,strides:o,pad:s,dimRoundingMode:l}=r;w.assert(j.eitherStridesOrDilationsAreOne(o,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`);const u=j.computePool2DInfo(i.shape,a,o,1,s,l);if(1===u.filterWidth&&1===u.filterHeight&&w.arraysEqual(u.inShape,u.outShape))return ALe({inputs:{x:i},backend:n});const c=new RBe(u,"avg",!1);return n.runWebGLProgram(c,[i],"float32")}},BBe={kernelName:zse,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:a,strides:o,pad:s,dimRoundingMode:l,dataFormat:u}=r,c=j.computePool3DInfo(i.shape,a,o,[1,1,1],s,l,u),d=new PBe(c,"avg",!1);return n.runWebGLProgram(d,[i],"float32")}};class $Be{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.effectiveFilterHeight,n=e.effectiveFilterWidth;this.userCode=`\n      const ivec2 pads = ivec2(${t-1-e.padInfo.top}, ${n-1-e.padInfo.left});\n      const float avgMultiplier = float(${1/(e.filterHeight*e.filterWidth)});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${t};\n            wR += ${e.dilationHeight}) {\n          float dyR = float(dyRCorner + wR) / ${e.strideHeight}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${n};\n            wC+= ${e.dilationWidth}) {\n            float dyC = float(dyCCorner + wC) / ${e.strideWidth}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class zBe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.effectiveFilterDepth,n=e.effectiveFilterHeight,r=e.effectiveFilterWidth;this.userCode=`\n      const ivec3 pads = ivec3(${t-1-e.padInfo.front}, ${n-1-e.padInfo.top}, ${r-1-e.padInfo.left});\n      const float avgMultiplier = float(${1/(e.filterDepth*e.filterHeight*e.filterWidth)});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${t};\n            wD += ${e.dilationDepth}) {\n          float dyD = float(dyDCorner + wD) / ${e.strideDepth}.0;\n\n          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${n};\n              wR += ${e.dilationHeight}) {\n            float dyR = float(dyRCorner + wR) / ${e.strideHeight}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${r};\n                wC += ${e.dilationWidth}) {\n              float dyC = float(dyCCorner + wC) / ${e.strideWidth}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const UBe={kernelName:Use,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,o=a,{filterSize:s,strides:l,pad:u,dimRoundingMode:c}=r,d=j.computePool3DInfo(o.shape,s,l,[1,1,1],u,c),h=new zBe(d);return n.runWebGLProgram(h,[i],o.dtype)}},HBe={kernelName:$se,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,o=a;oPe([i,a],"avgPoolGrad");const{filterSize:s,strides:l,pad:u}=r,c=j.computePool2DInfo(o.shape,s,l,1,u),d=new $Be(c);return n.runWebGLProgram(d,[i],o.dtype)}},WBe={kernelName:Hse,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:a}=t,{transposeA:o,transposeB:s}=r;return aBe({a:i,b:a,transposeA:o,transposeB:s,backend:n})}};class VBe{constructor(e,t,n,r,i,a){this.outputShape=[],this.variableNames=["x","mean","variance"],j.assertAndGetBroadcastShape(e,t),j.assertAndGetBroadcastShape(e,n);let o="0.0";null!=r&&(j.assertAndGetBroadcastShape(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let s="1.0";null!=i&&(j.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${o};\n        float scale = ${s};\n        float inv = scale * inversesqrt(variance + float(${a}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}class qBe{constructor(e,t,n,r,i,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],j.assertAndGetBroadcastShape(e,t),j.assertAndGetBroadcastShape(e,n);let o="vec4(0.0)";null!=r&&(j.assertAndGetBroadcastShape(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let s="vec4(1.0)";null!=i&&(j.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`\n      void main() {\n        vec4 offset = ${o};\n        vec4 scale = ${s};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${a}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}const GBe={kernelName:Dle,backendName:"webgl",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,mean:i,variance:a,offset:o,scale:s}=e;w.assert(i.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),w.assert(null==o||i.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),w.assert(null==s||i.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;null==l&&(l=.001);const u=[r,i,a];let c=null;null!=o&&(c=o.shape,u.push(o));let d=null;null!=s&&(d=s.shape,u.push(s));const h=xse().getBool("WEBGL_PACK_NORMALIZATION")?new qBe(r.shape,i.shape,a.shape,c,d,l):new VBe(r.shape,i.shape,a.shape,c,d,l);return t.runWebGLProgram(h,u,u[0].dtype)}};class YBe{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=MPe(this.rank),n=`uniform int start[${this.rank}];`,r=function(e){if(1===e)return"sourceLoc";if(e<=6)return XBe.slice(0,e).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}(this.rank);let i;i=`\n        ${t} sourceLoc;\n        ${t} coords = getOutputCoords();\n        ${e.map((e,t)=>`sourceLoc.${XBe[t]} = start[${t}] + coords.${XBe[t]};`).join("\n")}\n      `,this.userCode=`\n      ${n}\n      void main() {\n        ${i}\n        setOutput(getSource(${r}));\n      }\n    `}getCustomSetupFunc(e){if(e.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${e.length})`);return(t,n)=>{null==this.startLoc&&(this.startLoc=t.getUniformLocationNoThrow(n,"start"),null==this.startLoc)||t.gl.uniform1iv(this.startLoc,e)}}}const XBe=["x","y","z","w","u","v"];class KBe{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;const t=MPe(this.rank),n=hLe("coords",this.rank),r=hLe("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":`vec2(${r.slice(-2).join()})`,a=`getChannel(getSource(${r.join()}), ${i})`,o=`\n      result.x = ${a};\n      if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n        ++${r[this.rank-1]};\n        result.y = ${a};\n        --${r[this.rank-1]};\n      }\n    `,s=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${e[this.rank-2]}) {\n        ++${r[this.rank-2]};\n        result.z = ${a};\n        if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n          ++${r[this.rank-1]};\n          result.w = ${a};\n        }\n      }\n    `,l=this.rank<=4?`sourceLoc = coords +\n            ${t}(${e.map((e,t)=>`start[${t}]`).join()});`:e.map((e,t)=>`${r[t]} = ${n[t]} + start[${t}];`).join("\n");this.userCode=`\n      uniform int start[${this.rank}];\n      void main() {\n        ${t} coords = getOutputCoords();\n        ${t} sourceLoc;\n        ${l}\n        vec4 result = vec4(0.);\n        ${o}\n        ${s}\n        setOutput(result);\n      }\n    `}getCustomSetupFunc(e){if(e.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${e.length})`);return(t,n)=>{null==this.startLoc&&(this.startLoc=t.getUniformLocationNoThrow(n,"start"),null==this.startLoc)||t.gl.uniform1iv(this.startLoc,e)}}}function ZBe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:a,size:o}=r,[s,l]=A.parseSliceParams(i,a,o);if(A.assertParamsValid(i,s,l),0===w.sizeFromShape(l))return n.makeTensorInfo(l,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||"string"===i.dtype){const e=n.texData.get(i.dataId),t=iLe(e.values,s,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,t)}const{isPacked:u}=n.texData.get(i.dataId),c=A.isSliceContinous(i.shape,s,l);if(u||!c){const e=xse().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new KBe(l):new YBe(l),t=e.getCustomSetupFunc(s);return n.runWebGLProgram(e,[i],i.dtype,t)}return n.uploadToGPU(i.dataId),function(e,t,n,r){const i=r.texData.get(e.dataId),a=r.makeTensorInfo(n,e.dtype),o=r.texData.get(a.dataId);Object.assign(o,i),o.shape=n,o.dtype=e.dtype;let s=A.computeFlatOffset(t,w.computeStrides(e.shape));i.slice&&(s+=i.slice.flatOffset),o.slice={flatOffset:s,origDataId:i.slice&&i.slice.origDataId||e.dataId};const l=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,l+1),a}(i,s,l,n)}const JBe={kernelName:Hue,backendName:"webgl",kernelFunc:ZBe},QBe={kernelName:Wse,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:a,crops:o}=r;w.assert(i.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const s=a.reduce((e,t)=>e*t),l=j.getReshaped(i.shape,a,s),u=j.getPermuted(l.length,a.length),c=j.getReshapedPermuted(i.shape,a,s),d=j.getSliceBeginCoords(o,a.length),h=j.getSliceSize(c,o,a.length),f=[],p=GLe({inputs:{x:i},backend:n,attrs:{shape:l}}),m=rBe({inputs:{x:p},backend:n,attrs:{perm:u}}),g=GLe({inputs:{x:m},backend:n,attrs:{shape:c}}),v=ZBe({inputs:{x:g},backend:n,attrs:{begin:d,size:h}});return f.push(p),f.push(m),f.push(g),f.forEach(e=>n.disposeIntermediateTensorInfo(e)),v}},e$e={kernelName:Vse,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:a}=t,{size:o}=r,s=n.texData.get(i.dataId).values,l=n.texData.get(a.dataId).values,u=PPe(s,l,a.dtype,a.shape,o);return n.makeTensorInfo([o],a.dtype,u)}},t$e=$Le({opSnippet:"return float(a != b);",dtype:"bool"}),n$e={kernelName:mue,backendName:"webgl",kernelFunc:t$e};function r$e(e){const{inputs:t,backend:n}=e,{input:r}=t;return ALe({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}const i$e={kernelName:Iue,backendName:"webgl",kernelFunc:r$e},a$e={kernelName:Gse,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r,attrs:i}=t,{x:a}=n,{dtype:o}=i;if("complex64"===o){if("complex64"===a.dtype)return ALe({inputs:{x:a},backend:r});const t=Nge(a.shape),n=e({inputs:{x:a},backend:r,attrs:{dtype:"float32"}}),i=DLe({inputs:{real:n,imag:t},backend:r});return t.dispose(),r.disposeIntermediateTensorInfo(n),i}if("complex64"===a.dtype){const t=r$e({inputs:{input:a},backend:r}),n=e({inputs:{x:t},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(t),n}if(!w.hasEncodingLoss(a.dtype,o)){const e=ALe({inputs:{x:a},backend:r});return{dataId:e.dataId,shape:e.shape,dtype:o}}if("int32"===o)return function(e,t){const n=new bLe(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(a,r);if("bool"===o){const e=r.makeTensorInfo([],"bool",w.getTypedArrayFromDType("bool",1)),t=t$e({inputs:{a:a,b:e},backend:r});return r.disposeIntermediateTensorInfo(e),t}throw new Error(`Error in Cast: failed to cast ${a.dtype} to ${o}`)}},o$e="return ceil(x);",s$e=BLe({opSnippet:o$e,packedOpSnippet:o$e,cpuKernelImpl:BPe}),l$e={kernelName:Yse,backendName:"webgl",kernelFunc:s$e};class u$e{constructor(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}getCustomSetupFunc(e,t){return(n,r)=>{null==this.minLoc&&(this.minLoc=n.getUniformLocationNoThrow(r,"minVal"),this.maxLoc=n.getUniformLocationNoThrow(r,"maxVal")),n.gl.uniform1f(this.minLoc,e),n.gl.uniform1f(this.maxLoc,t)}}}class c$e{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}getCustomSetupFunc(e,t){return(n,r)=>{null==this.minLoc&&(this.minLoc=n.getUniformLocationNoThrow(r,"minVal"),this.maxLoc=n.getUniformLocationNoThrow(r,"maxVal")),n.gl.uniform1f(this.minLoc,e),n.gl.uniform1f(this.maxLoc,t)}}}const d$e={kernelName:Xse,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{clipValueMin:a,clipValueMax:o}=r;let s;s=xse().getBool("WEBGL_PACK_CLIP")?new c$e(i.shape):new u$e(i.shape);const l=s.getCustomSetupFunc(a,o);return n.runWebGLProgram(s,[i],i.dtype,l)}};class h$e{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}function f$e(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}const p$e={kernelName:Zse,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,i=n.texData.get(r.dataId),a=new h$e(r.shape),o=[f$e(r,i.complexTensorInfos.real),f$e(r,i.complexTensorInfos.imag)];return n.runWebGLProgram(a,o,o[0].dtype)}};class m$e{constructor(e){this.outputShape=[],this.outputShape=j.computeOutShape(e,1),this.variableNames=e.map((e,t)=>"T"+t);const t=new Array(e.length-1);t[0]=e[0][1];for(let r=1;r<t.length;r++)t[r]=t[r-1]+e[r][1];const n=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let r=1;r<t.length;r++)n.push(`else if (yC < ${t[r]}) setOutput(getT${r}(yR, yC-${t[r-1]}));`);n.push(`else setOutput(getT${t.length}(yR, yC-${t[t.length-1]}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}class g$e{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=j.computeOutShape(e,t);const n=this.outputShape,r=n.length,i=MPe(r),a=hLe("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((e,t)=>"T"+t);const s=new Array(e.length-1);s[0]=e[0][t];for(let f=1;f<s.length;f++)s[f]=s[f-1]+e[f][t];const l=o[t],u=o.slice(-2),c=o.join();let d=`if (${l} < ${s[0]}) {\n        return getChannel(\n            getT0(${c}), vec2(${u.join()}));\n        }`;for(let f=1;f<s.length;f++){const e=s[f-1];d+=`\n        if (${l} < ${s[f]}  && ${l} >= ${s[f-1]}) {\n          return getChannel(\n            getT${f}(${v$e(o,l,e)}),\n            vec2(${v$e(u,l,e)}));\n        }`}const h=s[s.length-1];d+=`\n        return getChannel(\n          getT${s.length}(${v$e(o,l,h)}),\n          vec2(${v$e(u,l,h)}));`,this.userCode=`\n      float getValue(${o.map(e=>"int "+e)}) {\n        ${d}\n      }\n\n      void main() {\n        ${i} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${a}), 0., 0., 0.);\n\n        ${a[r-1]} = ${a[r-1]} + 1;\n        if (${a[r-1]} < ${n[r-1]}) {\n          result.g = getValue(${a});\n        }\n\n        ${a[r-2]} = ${a[r-2]} + 1;\n        if (${a[r-2]} < ${n[r-2]}) {\n          result.a = getValue(${a});\n        }\n\n        ${a[r-1]} = ${a[r-1]} - 1;\n        if (${a[r-2]} < ${n[r-2]} &&\n            ${a[r-1]} < ${n[r-1]}) {\n          result.b = getValue(${a});\n        }\n        setOutput(result);\n      }\n    `}}function v$e(e,t,n){const r=e.indexOf(t);return e.map((e,t)=>t===r?`${e} - ${n}`:e).join()}function y$e(e){const{inputs:t,backend:n}=e,{input:r}=t;return ALe({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}const b$e={kernelName:Lle,backendName:"webgl",kernelFunc:y$e};function x$e(e,t,n){const r=j.computeOutShape(e.map(e=>e.shape),t);return{tensors2D:e.map(e=>GLe({inputs:{x:e},attrs:{shape:[-1,w.sizeFromShape(e.shape.slice(t))]},backend:n})),outShape:r}}function w$e(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r,a=w.parseAxisParam(i,t[0].shape)[0],o=j.computeOutShape(t.map(e=>e.shape),a);if(0===w.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);const s=t.filter(e=>w.sizeFromShape(e.shape)>0);if(1===s.length)return ALe({inputs:{x:s[0]},backend:n});const l=s.map(e=>e.shape);return j.assertParamsConsistent(l,a),function e(t,n,r){const i=t[0].dtype;if("complex64"===i){const i=t.map(e=>r$e({inputs:{input:e},backend:r})),a=t.map(e=>y$e({inputs:{input:e},backend:r})),o=e(i,n,r),s=e(a,n,r),l=DLe({inputs:{real:o,imag:s},backend:r});return i.forEach(e=>r.disposeIntermediateTensorInfo(e)),a.forEach(e=>r.disposeIntermediateTensorInfo(e)),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),l}if("string"===i){const{tensors2D:e,outShape:a}=x$e(t,n,r),o=e.map(e=>({vals:r.texData.get(e.dataId).values,shape:e.shape})),s=$Pe(o,a,i,1===e[0].shape[0]),l=j.computeOutShape(t.map(e=>e.shape),n),u=r.makeTensorInfo(l,i,s);return e.forEach(e=>r.disposeIntermediateTensorInfo(e)),u}if(t.length>xse().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const i=Math.floor(t.length/2),a=e(t.slice(0,i),n,r),o=e(t.slice(i),n,r),s=e([a,o],n,r);return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(o),s}if(xse().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){const e=new g$e(t.map(e=>e.shape),n);return r.runWebGLProgram(e,t,i)}const{tensors2D:a,outShape:o}=x$e(t,n,r),s=new m$e(a.map(e=>e.shape)),l=r.runWebGLProgram(s,a,i);a.forEach(e=>r.disposeIntermediateTensorInfo(e));const u=GLe({inputs:{x:l},attrs:{shape:o},backend:r});return r.disposeIntermediateTensorInfo(l),u}(s,a,n)}const _$e={kernelName:Jse,backendName:"webgl",kernelFunc:w$e};class k$e{constructor(e,t=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const a=e.padInfo.top,o=e.padInfo.left,s=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,f=4*Math.floor(e.inChannels/4),p=e.inChannels%4,m="channelsLast"===e.dataFormat,g=m?1:2,v=m?2:3,y=m?3:1;let b="",x="";n&&(b=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,x="result = activation(result);");const w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${b}\n\n      const ivec2 strides = ivec2(${s}, ${l});\n      const ivec2 pads = ivec2(${a}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${y}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${g}], coords[${v}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${d}; wR++) {\n          int xR = xRCorner + wR * ${u};\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${h}; wC++) {\n            int xC = xCCorner + wC * ${c};\n\n            if (xC < 0 || xC >= ${e.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${f}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${m}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===p}) {\n\n              if (${m}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${f}) *\n                    getW(wR, wC, ${f}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${f}, xR, xC) *\n                    getW(wR, wC, ${f}, d2);\n              }\n\n            } else if (${2===p}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${f}, d2),\n                getW(wR, wC, ${f} + 1, d2)\n              );\n\n              if (${m}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${f}),\n                  getX(batch, xR, xC, ${f} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${f}, xR, xC),\n                  getX(batch, ${f} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===p}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${f}, d2),\n                getW(wR, wC, ${f} + 1, d2),\n                getW(wR, wC, ${f} + 2, d2)\n              );\n\n              if (${m}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${f}),\n                  getX(batch, xR, xC, ${f} + 1),\n                  getX(batch, xR, xC, ${f} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${f}, xR, xC),\n                  getX(batch, ${f} + 1, xR, xC),\n                  getX(batch, ${f} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${w}\n        ${x}\n        setOutput(result);\n      }\n    `}}class E$e{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,c=e.filterDepth,d=e.filterHeight,h=e.filterWidth,f=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${i}, ${a}, ${o});\n      const ivec3 pads = ivec3(${t}, ${n}, ${r});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${c}; wF++) {\n          int xF = xFCorner + wF * ${s};\n\n          if (xF < 0 || xF >= ${e.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${d}; wR++) {\n            int xR = xRCorner + wR * ${l};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h}; wC++) {\n              int xC = xCCorner + wC * ${u};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${f}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===p}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${f}) *\n                  getW(wF, wR, wC, ${f}, d2);\n              } else if (${2===p}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${f}),\n                  getX(batch, xF, xR, xC, ${f} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${f}, d2),\n                  getW(wF, wR, wC, ${f} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===p}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${f}),\n                  getX(batch, xF, xR, xC, ${f} + 1),\n                  getX(batch, xF, xR, xC, ${f} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${f}, d2),\n                  getW(wF, wR, wC, ${f} + 1, d2),\n                  getW(wF, wR, wC, ${f} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class S$e{constructor(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;const{filterWidth:r,inChannels:i,strideWidth:a,strideHeight:o,padInfo:s,outWidth:l,dilationWidth:u,dilationHeight:c,dataFormat:d}=n,{left:h,top:f}=s,p=i*r,m=lPe(),g="channelsLast"===d,v=g?0:1,y=g?1:2;let b="";for(let x=0;x<=1;x++)for(let n=0;n<=1;n++)b+=`\n          blockIndex = rc.y + ${n};\n          pos = rc.x + ${x};\n\n          if(blockIndex < ${e[1]} && pos < ${e[0]}) {\n            offsetY = int(blockIndex / (${l})) * ${o} - ${f};\n            d0 = offsetY + ${c} * (pos / ${p});\n\n            if(d0 < ${t[v]} && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), ${l}.) * ${a}. - ${h}.);\n              d1 = offsetX + ${u} * (int(mod(float(pos), ${p}.) / ${i}.));\n\n              if(d1 < ${t[y]} && d1 >= 0) {\n\n                ch = int(mod(float(pos), ${i}.));\n\n                if (${g}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*x+n}] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*x+n}] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${b}\n\n        ${m.output} = result;\n      }\n    `}}function T$e({x:e,filter:t,convInfo:n,backend:r,bias:i=null,preluActivationWeights:a=null,leakyreluAlpha:o=0,activation:s=null}){const l=e.shape,u=r.texData.get(e.dataId),c="channelsLast"===n.dataFormat;let d;const h=[],f=l[2]%2!=0&&!!u.isPacked;if((1!=l[0]*l[1]*l[2]&&1!==n.outChannels||!(n.inChannels>1e3))&&xse().getBool("WEBGL_LAZILY_UNPACK")&&xse().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&f){const f={dataId:e.dataId,shape:[1,c?l[0]*l[1]*(l[2]+1):l[0]*l[2]*(l[3]+1),n.inChannels],dtype:e.dtype},p=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,w.assert(ePe(u.shape,f.shape),()=>`packed reshape ${u.shape} to ${f.shape} isn't free`);const m=GLe({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});h.push(m);const g=aBe({a:f,b:m,backend:r,transposeA:!1,transposeB:!1,bias:i,activation:s,preluActivationWeights:a,leakyreluAlpha:o}),v=r.texData.get(g.dataId);w.assert(v.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=p,v.shape=n.outShape,d=ALe({inputs:{x:g},backend:r}),d.shape=n.outShape,h.push(g)}else{const u=GLe({inputs:{x:e},backend:r,attrs:{shape:[1,c?l[0]*l[1]*l[2]:l[0]*l[2]*l[3],n.inChannels]}}),f=GLe({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),p=aBe({a:u,b:f,transposeA:!1,transposeB:!1,backend:r,bias:i,activation:s,preluActivationWeights:a,leakyreluAlpha:o});d=GLe({inputs:{x:p},backend:r,attrs:{shape:n.outShape}}),h.push(u),h.push(f),h.push(p)}for(const p of h)r.disposeIntermediateTensorInfo(p);return d}function C$e({x:e,filter:t,convInfo:n,backend:r,bias:i=null,preluActivationWeights:a=null,leakyreluAlpha:o=0,activation:s=null}){const{filterWidth:l,filterHeight:u,inChannels:c,outWidth:d,outHeight:h,dataFormat:f}=n,p="channelsLast"===f,m=l*u*c,g=h*d,v=[m,g],y=[],b=GLe({inputs:{x:e},backend:r,attrs:{shape:e.shape.slice(1)}}),x=GLe({inputs:{x:t},backend:r,attrs:{shape:[1,m,w.sizeFromShape(t.shape)/m]}});y.push(b),y.push(x);const _=new S$e(v,b.shape,n),k=r.runWebGLProgram(_,[b],"float32"),E=GLe({inputs:{x:k},backend:r,attrs:{shape:[1,v[0],v[1]]}});y.push(k),y.push(E);const S=null!=i,T=null!=a,C="leakyrelu"===s,I=s?zLe(s,!0):null,A=new ULe(E.shape,x.shape,[1,g,n.outChannels],!0,!1,S,I,T,C),O=[E,x];if(i&&O.push(i),T&&O.push(a),C){const e=r.makeTensorInfo([],"float32",w.createScalarValue(o,"float32"));O.push(e),y.push(e)}const D=r.runWebGLProgram(A,O,"float32"),M=GLe({inputs:{x:D},backend:r,attrs:{shape:p?[1,h,d,n.outChannels]:[1,n.outChannels,h,d]}});y.push(D);for(const w of y)r.disposeIntermediateTensorInfo(w);return M}const I$e={kernelName:Qse,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:o,pad:s,dataFormat:l,dilations:u,dimRoundingMode:c}=r,d=j.convertConv2DDataFormat(l),h=j.computeConv2DInfo(i.shape,a.shape,o,u,s,c,!1,d);let f;if(1!==h.filterHeight||1!==h.filterWidth||1!==h.dilationHeight||1!==h.dilationWidth||1!==h.strideHeight||1!==h.strideWidth||"SAME"!==h.padInfo.type&&"VALID"!==h.padInfo.type)if(xse().getBool("WEBGL_CONV_IM2COL")&&1===i.shape[0])f=C$e({x:i,filter:a,convInfo:h,backend:n});else{const e=new k$e(h);f=n.runWebGLProgram(e,[i,a],"float32")}else f=T$e({x:i,filter:a,convInfo:h,backend:n});const p=GLe({inputs:{x:f},backend:n,attrs:{shape:h.outShape}});return n.disposeIntermediateTensorInfo(f),p}};class A$e{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yR = 0; yR < ${e.outHeight}; yR++) {\n            int xR = wR + yR * ${e.strideHeight} - ${e.padInfo.top};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${e.outWidth}; yC++) {\n              int xC = wC + yC * ${e.strideWidth} - ${e.padInfo.left};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              if (${"channelsLast"===e.dataFormat}) {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class O$e{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r="channelsLast"===e.dataFormat;this.userCode=`\n      const ivec2 pads = ivec2(${t-1-e.padInfo.top}, ${n-1-e.padInfo.left});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${r?3:1}];\n\n        ivec2 dyCorner = ivec2(coords[${r?1:2}], coords[${r?2:3}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${e.strideHeight}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${e.strideWidth}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n\n              if (${r}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class D$e{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape,this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yF = 0; yF < ${e.outDepth}; yF++) {\n            int xF = wF + yF * ${e.strideDepth} - ${e.padInfo.front};\n\n            if (xF < 0 || xF >= ${e.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${e.outHeight}; yR++) {\n              int xR = wR + yR * ${e.strideHeight} - ${e.padInfo.top};\n\n              if (xR < 0 || xR >= ${e.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${e.outWidth}; yC++) {\n                int xC = wC + yC * ${e.strideWidth} - ${e.padInfo.left};\n\n                if (xC < 0 || xC >= ${e.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class M$e{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth;this.userCode=`\n      const ivec3 pads = ivec3(${t-1-e.padInfo.front}, ${n-1-e.padInfo.top}, ${r-1-e.padInfo.left});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${t}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${e.strideDepth}.0;\n\n          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${t} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${e.strideHeight}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${r}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${e.strideWidth}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${r} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const N$e={kernelName:ele,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:o,pad:s,dataFormat:l,dimRoundingMode:u,filterShape:c}=r,d=j.convertConv2DDataFormat(l),h=j.computeConv2DInfo(i.shape,c,o,1,s,u,!1,d),f=new A$e(h);return n.runWebGLProgram(f,[i,a],"float32")}},j$e={kernelName:tle,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{inputShape:o,strides:s,pad:l,dataFormat:u,dimRoundingMode:c}=r,d=j.convertConv2DDataFormat(u),h=j.computeConv2DInfo(o,a.shape,s,1,l,c,!1,d),f=new O$e(h);return n.runWebGLProgram(f,[i,a],"float32")}},F$e={kernelName:nle,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:o,pad:s,dilations:l}=r,u=j.computeConv3DInfo(i.shape,a.shape,o,l,s),c=new E$e(u);return n.runWebGLProgram(c,[i,a],"float32")}},R$e={kernelName:rle,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:o,pad:s,filterShape:l}=r,u=j.computeConv3DInfo(i.shape,l,o,1,s),c=new D$e(u);return n.runWebGLProgram(c,[i,a],"float32")}},P$e={kernelName:ile,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{pad:o,strides:s,inputShape:l}=r,u=j.computeConv3DInfo(l,a.shape,s,1,o),c=new M$e(u);return n.runWebGLProgram(c,[i,a],"float32")}},L$e=BLe({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"}),B$e={kernelName:ale,backendName:"webgl",kernelFunc:L$e},$$e=BLe({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),z$e={kernelName:ole,backendName:"webgl",kernelFunc:$$e};class U$e{constructor(e,t,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[a,o,s,l]=e,[u]=t,[c,d]=n;this.outputShape=[u,c,d,l];const h="bilinear"===r?1:0,[f,p]=[o-1+".0",s-1+".0"],[m,g,v]=c>1?[""+(o-1)/(c-1),"(y2-y1) * height_ratio",`y1*${f} + float(y)*(height_scale)`]:["0.0","0.0","0.5 * (y1+y2) * "+f],[y,b,x]=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio",`x1*${p} + float(x)*(width_scale)`]:["0.0","0.0","0.5 * (x1+x2) * "+p];this.userCode=`\n      const float height_ratio = float(${m});\n      const float width_ratio = float(${y});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${a}) {\n          return;\n        }\n\n        float height_scale = ${g};\n        float width_scale = ${b};\n\n        float in_y = ${v};\n        if( in_y < 0.0 || in_y > ${f} ) {\n          setOutput(float(${i}));\n          return;\n        }\n        float in_x = ${x};\n        if( in_x < 0.0 || in_x > ${p} ) {\n          setOutput(float(${i}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${h} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}const H$e={kernelName:lle,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{image:i,boxes:a,boxInd:o}=t,{cropSize:s,method:l,extrapolationValue:u}=r,c=new U$e(i.shape,a.shape,s,l,u);return n.runWebGLProgram(c,[i,a,o],"float32")}};class W$e{constructor(e,t,n){this.variableNames=["x"],this.outputShape=e;const r=e.length,i=t?"0.0":`getX(${V$e(r,"coords")})`,a=e[e.length-1];let o="",s="";t?(o=n?"end != "+(a-1):"end != 0",s=n?"end + 1":"end - 1"):(o=n?"end + pow2 < "+a:"end >= pow2",s=n?"end + pow2":"end - pow2"),this.userCode=`\n      uniform float index;\n      void main() {\n        ${MPe(r)} coords = getOutputCoords();\n        int end = ${q$e(r,"coords")};\n        float val = ${i};\n        int pow2 = int(pow(2.0, index));\n        if (${o}) {\n          int idx = ${s};\n          ${q$e(r,"coords")} = idx;\n          val += getX(${V$e(r,"coords")});\n        }\n        setOutput(val);\n      }\n    `}getCustomSetupFunc(e){return(t,n)=>{null==this.index&&(this.index=t.getUniformLocation(n,"index")),t.gl.uniform1f(this.index,e)}}}function V$e(e,t){if(1===e)return""+t;if(2===e)return`${t}.x, ${t}.y`;if(3===e)return`${t}.x, ${t}.y, ${t}.z`;if(4===e)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw Error(`Cumulative sum for rank ${e} is not yet supported`)}function q$e(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error(`Cumulative sum for rank ${e} is not yet supported`)}const G$e={kernelName:sle,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,exclusive:o,reverse:s}=r,l=i.shape.length,u=j.getAxesPermutation([a],l);let c=i;null!=u&&(c=rBe({inputs:{x:i},backend:n,attrs:{perm:u}}));const d=j.getInnerMostAxes(1,l)[0];if(d!==l-1)throw new Error(`WebGL cumsum shader expects an inner-most axis=${i.shape.length-1} but got axis=`+a);const h=i.shape[d];let f=ALe({inputs:{x:c},backend:n});for(let p=0;p<=Math.ceil(Math.log2(h))-1;p++){const e=new W$e(c.shape,!1,s),t=e.getCustomSetupFunc(p),r=f;f=n.runWebGLProgram(e,[f],f.dtype,t),n.disposeIntermediateTensorInfo(r)}if(o){const e=new W$e(c.shape,o,s),t=f;f=n.runWebGLProgram(e,[f],f.dtype),n.disposeIntermediateTensorInfo(t)}if(null!=u){const e=rBe({inputs:{x:f},backend:n,attrs:{perm:j.getUndoAxesPermutation(u)}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(c),e}return f}},Y$e={kernelName:ule,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:a}=t,{size:o,binaryOutput:s}=r;if(1===i.shape.length){const e=n.texData.get(i.dataId).values,t=n.texData.get(a.dataId).values,r=PPe(e,t,a.dtype,a.shape,o);return n.makeTensorInfo([o],a.dtype,r)}if(2===i.shape.length){const e=n.bufferSync(i),t=n.bufferSync(a),r=LPe(e,t,o,s);return n.makeTensorInfo(r.shape,a.dtype,r.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+i.shape.length+".")}};class X$e{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${t};\n      int offset_h = imod(h, ${t});\n      int in_w = w / ${t};\n      int offset_w = imod(w, ${t});\n      int offset_d = (offset_h * ${t} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}const K$e={kernelName:cle,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockSize:a,dataFormat:o}=r;w.assert(a>1,()=>"blockSize should be > 1 for depthToSpace, but was: "+a);const s=i.shape[0],l=("NHWC"===o?i.shape[1]:i.shape[2])*a,u=("NHWC"===o?i.shape[2]:i.shape[3])*a,c=("NHWC"===o?i.shape[3]:i.shape[1])/(a*a),d=new X$e("NHWC"===o?[s,l,u,c]:[s,c,l,u],a,o);return n.runWebGLProgram(d,[i],i.dtype)}};class Z$e{constructor(e,t=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const a=e.inHeight,o=e.inWidth,s=e.padInfo.top,l=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,d=e.dilationHeight,h=e.dilationWidth,f=e.filterHeight,p=e.filterWidth,m=e.outChannels/e.inChannels;let g="",v="";n&&(g=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,v="result = activation(result);");const y=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${g}\n\n      const ivec2 strides = ivec2(${u}, ${c});\n      const ivec2 pads = ivec2(${s}, ${l});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${m};\n        int q = d2 - d1 * ${m};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${f}; wR++) {\n          int xR = xRCorner + wR * ${d};\n\n          if (xR < 0 || xR >= ${a}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${p}; wC++) {\n            int xC = xCCorner + wC * ${h};\n\n            if (xC < 0 || xC >= ${o}) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${y}\n        ${v}\n        setOutput(result);\n      }\n    `}}class J$e{constructor(e,t=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;const a=e.inHeight,o=e.inWidth,s=e.padInfo.top,l=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,d=e.dilationHeight,h=e.dilationWidth,f=e.filterHeight,p=e.filterWidth,m=p;let g="int xR; int xC; int xCOffset;";for(let x=0;x<f;x++)for(let e=0;e<p;e++)g+=`\n          vec4 xTexelR${x}C${2*e} = vec4(0.);\n          vec4 wR${x}C${e} = vec4(0.);\n          vec4 xR${x}C${e} = vec4(0.);`;for(let x=0;x<f;x++)for(let e=0;e<m;e++){const t=2*e;if(g+=`\n          xR = xRCorner + ${x*d};\n          xC = xCCorner + ${t*h};\n        `,1===c){if(t<p&&(g+=l%2==1?`\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < ${a} && xCOffset >= 0 && xCOffset < ${o}) {\n                  xTexelR${x}C${t} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ${o}) {\n                    xTexelR${x}C${t}.zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR${x}C${t} = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < ${a} && xCOffset >= 0 && xCOffset < ${o}) {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ${o}) {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR${x}C${t} = vec4(previous.zw, xTexelR${x}C${t}.xy);\n                } else {\n                  xR${x}C${t} = vec4(0, 0, xTexelR${x}C${t}.xy);\n                }\n              `:`\n                if(xR >= 0 && xR < ${a} && xC >= 0 && xC < ${o}) {\n                  xTexelR${x}C${t} = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR${x}C${t} = vec4(0.);\n                }\n\n                xR${x}C${t} = xTexelR${x}C${t};\n              `,t+1<p)){const e=l%2==0?w.nearestLargerEven(h):h;h%2==0&&l%2==1||h%2!=0&&l%2!=1?(g+=`\n                  xCOffset = xC + ${l%2} + ${e};\n\n                  if(xR >= 0 && xR < ${a} &&\n                    xCOffset >= 0 && xCOffset < ${o}) {\n                    xTexelR${x}C${t+2} = getX(batch, xR, xCOffset, d1);\n                  }\n                `,h>1&&(g+=`\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < ${a} &&\n                      xCOffset >= 0 && xCOffset < ${o}) {\n                      xTexelR${x}C${t} = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR${x}C${t} = vec4(0.);\n                    }\n                  `),g+=`\n                  xR${x}C${t+1} = vec4(\n                    xTexelR${x}C${t}.zw, xTexelR${x}C${t+2}.xy);\n                `):g+=`\n                  xCOffset = xC + ${e};\n\n                  if(xR >= 0 && xR < ${a} &&\n                    xCOffset >= 0 && xCOffset < ${o}) {\n                    xTexelR${x}C${t+2} = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR${x}C${t+1} = xTexelR${x}C${t+2};\n                `}}else t<p&&(g+=`\n              if(xR >= 0 && xR < ${a}) {\n            `,l%2==1?(g+=`\n                xCOffset = xC + 1 - ${c};\n                if(xCOffset >= 0 && xCOffset < ${o}) {\n                  xTexelR${x}C${t} = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR${x}C${t} = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < ${o}) {\n                  xTexelR${x}C${t+2} = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR${x}C${t+2} = vec4(0.);\n                }\n\n                xR${x}C${t} = vec4(\n                  xTexelR${x}C${t}.zw, xTexelR${x}C${t+2}.zw);\n              `,t+1<p&&(g+=`\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + ${c};\n                  if(xCOffset >= 0 && xCOffset < ${o}) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR${x}C${t+1} = vec4(xTexelR${x}C${t+2}.xy, final.xy);\n                `)):(g+=`\n                if(xC >= 0 && xC < ${o}) {\n                  xTexelR${x}C${t} = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR${x}C${t} = vec4(0.);\n                }\n\n                xCOffset = xC + ${c};\n                if(xCOffset >= 0 && xCOffset < ${o}) {\n                  xTexelR${x}C${t+2} = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR${x}C${t+2} = vec4(0.);\n                }\n\n                xR${x}C${t} = vec4(\n                  xTexelR${x}C${t}.xy, xTexelR${x}C${t+2}.xy);\n              `,t+1<p&&(g+=`\n                  xR${x}C${t+1} = vec4(\n                    xTexelR${x}C${t}.zw, xTexelR${x}C${t+2}.zw);\n                `)),g+="}");t<p&&(g+=`\n            vec4 wTexelR${x}C${t} = getW(${x}, ${t}, d1, q);\n            wR${x}C${t} = vec4(wTexelR${x}C${t}.xz, wTexelR${x}C${t}.xz);\n          `,t+1<p&&(g+=`\n              vec4 wTexelR${x}C${t+1} = getW(${x}, ${t+1}, d1, q);\n              wR${x}C${t+1} =\n                vec4(wTexelR${x}C${t+1}.xz, wTexelR${x}C${t+1}.xz);`))}for(let x=0;x<f;x++)for(let e=0;e<p;e++)g+=`dotProd += xR${x}C${e} * wR${x}C${e};`;let v="",y="";n&&(v=r?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,y="result = activation(result);");const b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${v}\n\n      const ivec2 strides = ivec2(${u}, ${c});\n      const ivec2 pads = ivec2(${s}, ${l});\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        ${g}\n\n        vec4 result = dotProd;\n        ${b}\n        ${y}\n        setOutput(result);\n      }\n    `}}const Q$e={kernelName:dle,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:o,pad:s,dilations:l,dimRoundingMode:u}=r;let c=l;null==c&&(c=[1,1]),w.assert(j.eitherStridesOrDilationsAreOne(o,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const d=j.computeConv2DInfo(i.shape,a.shape,o,c,s,u,!0);let h;return h=xse().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels==1?new J$e(d):new Z$e(d),n.runWebGLProgram(h,[i,a],"float32")}};class eze{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${e.outChannels/e.inChannels} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yR = 0; yR < ${e.outHeight}; yR++) {\n            int xR = wR + yR * ${e.strideHeight} - ${e.padInfo.top};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${e.outWidth}; yC++) {\n              int xC = wC + yC * ${e.strideWidth} - ${e.padInfo.left};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class tze{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.outChannels/e.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${t-1-e.padInfo.top}, ${n-1-e.padInfo.left});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${e.strideHeight}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${e.strideWidth}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${r}; dm++) {\n              int d2 = d1 * ${r} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const nze={kernelName:hle,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:o,dilations:s,pad:l,dimRoundingMode:u,filterShape:c}=r,d=j.computeConv2DInfo(i.shape,c,o,s,l,u,!0),h=new eze(d);return n.runWebGLProgram(h,[i,a],"float32")}},rze={kernelName:fle,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{strides:o,dilations:s,pad:l,dimRoundingMode:u,inputShape:c}=r,d=j.computeConv2DInfo(c,a.shape,o,s,l,u,!0),h=new tze(d);return n.runWebGLProgram(h,[i,a],"float32")}};class ize{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}const aze={kernelName:ple,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,i=[...r.shape,...r.shape],a=w.sizeFromShape(r.shape),o=GLe({inputs:{x:r},backend:n,attrs:{shape:[a]}}),s=new ize(a),l=n.runWebGLProgram(s,[o],o.dtype),u=GLe({inputs:{x:l},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),u}};class oze{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:n,padInfo:r,strideHeight:i,strideWidth:a,filterHeight:o,filterWidth:s,dilationHeight:l,dilationWidth:u}=e,{top:c,left:d}=r;this.userCode=`\n      const ivec2 strides = ivec2(${i}, ${a});\n      const ivec2 pads = ivec2(${c}, ${d});\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ${o}; h++) {\n          int hIn = hBeg + h * ${l};\n\n          if (hIn >= 0 && hIn < ${t}) {\n            for (int w = 0; w < ${s}; w++) {\n              int wIn = wBeg + w * ${u};\n\n              if (wIn >= 0 && wIn < ${n}) {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    `}}const sze={kernelName:mle,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:o,pad:s,dilations:l}=r,u=j.computeDilation2DInfo(i.shape,a.shape,o,s,"NHWC",l);let c;const d=new oze(u);c=n.runWebGLProgram(d,[i,a],"float32");const h=GLe({inputs:{x:c},backend:n,attrs:{shape:u.outShape}});return n.disposeIntermediateTensorInfo(c),h}},lze=BLe({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),uze={kernelName:ble,backendName:"webgl",kernelFunc:lze},cze={kernelName:xle,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n}=e,{dy:r,y:i}=t,a=xse().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ILe("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,i.shape):new CLe("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,i.shape);return n.runWebGLProgram(a,[r,i],r.dtype)}},dze=$Le({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool"}),hze={kernelName:_le,backendName:"webgl",kernelFunc:dze},fze=BLe({opSnippet:`\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = ${j.ERF_P};\n  float a1 = ${j.ERF_A1};\n  float a2 = ${j.ERF_A2};\n  float a3 = ${j.ERF_A3};\n  float a4 = ${j.ERF_A4};\n  float a5 = ${j.ERF_A5};\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n`}),pze={kernelName:wle,backendName:"webgl",kernelFunc:fze},mze="return exp(x);",gze=BLe({opSnippet:mze,packedOpSnippet:mze,cpuKernelImpl:zPe}),vze={kernelName:kle,backendName:"webgl",kernelFunc:gze};function yze(e){const{inputs:t,attrs:n,backend:r}=e,{dim:i}=n,{input:a}=t,o=a.shape.length,s=a.shape.slice();let l=i;return i<0&&(w.assert(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),s.splice(l,0,1),GLe({inputs:{x:a},backend:r,attrs:{shape:s}})}const bze={kernelName:Ele,backendName:"webgl",kernelFunc:yze},xze="return exp(x) - 1.0;",wze=BLe({opSnippet:xze,packedOpSnippet:xze,cpuKernelImpl:UPe}),_ze={kernelName:Sle,backendName:"webgl",kernelFunc:wze};class kze{constructor(e,t,n){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";let o;if("real"===e)o="return real * expR - imag * expI;";else{if("imag"!==e)throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);o="return real * expI + imag * expR;"}this.userCode=`\n      const float exponentMultiplier = ${i};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${o}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${r});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${r}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${a};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}}function Eze(e,t,n){const r=n.texData.get(e.dataId),i=w.sizeFromShape(e.shape),a=e.shape[e.shape.length-1],o=GLe({inputs:{x:e},backend:n,attrs:{shape:[i/a,a]}}).shape,s=new kze("real",o,t),l=new kze("imag",o,t),u=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:o},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:o}],c=n.runWebGLProgram(s,u,"float32"),d=n.runWebGLProgram(l,u,"float32"),h=DLe({inputs:{real:c,imag:d},backend:n});n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d);const f=GLe({inputs:{x:h},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(f),f}const Sze={kernelName:Tle,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t;return Eze(r,!1,n)}};class Tze{constructor(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}getCustomSetupFunc(e){return(t,n)=>{null==this.valueLoc&&(this.valueLoc=t.getUniformLocationNoThrow(n,"value")),t.gl.uniform1f(this.valueLoc,e)}}}function Cze(e){const{backend:t,attrs:n}=e,{shape:r,value:i}=n;let{dtype:a}=n;if(a=a||w.inferDtype(i),"string"===a){const e=w.getArrayFromDType(a,w.sizeFromShape(r));return e.fill(i),t.makeTensorInfo(r,a,e)}{const e=new Tze(r,i),n=e.getCustomSetupFunc(i);return t.runWebGLProgram(e,[],a,n)}}const Ize={kernelName:Cle,backendName:"webgl",kernelFunc:Cze};class Aze{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${t} - x;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${t}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}const Oze={kernelName:Ile,backendName:"webgl",kernelFunc:({inputs:e,backend:t})=>{const{image:n}=e,r=t,i=new Aze(n.shape);return r.runWebGLProgram(i,[n],n.dtype)}},Dze="return floor(x);",Mze=BLe({opSnippet:Dze,packedOpSnippet:Dze,cpuKernelImpl:HPe}),Nze={kernelName:Ale,backendName:"webgl",kernelFunc:Mze},jze=$Le({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),Fze={kernelName:Ole,backendName:"webgl",kernelFunc:jze};class Rze{constructor(e){this.variableNames=["A"];const t=lPe(),[n,r]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);\n\n        vec4 values = ${t.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}class Pze{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=lPe(),[n,r]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${r}.0, ${n}.0);\n            vec4 values = ${t.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${t.output} = result;\n      }\n    `}}const Lze={kernelName:mce,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e;let{pixels:i}=t;const{numChannels:a}=r,o="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,[l,u]=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],c=[u,l],d=[u,l,a];(s||o)&&(null==Bze&&(Bze=document.createElement("canvas").getContext("2d")),Bze.canvas.width=l,Bze.canvas.height=u,Bze.drawImage(i,0,0,l,u),i=Bze.canvas);const h=n.makeTensorInfo(c,"int32");n.texData.get(h.dataId).usage=jRe.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),i);const f=xse().getBool("WEBGL_PACK")?new Pze(d):new Rze(d),p=n.runWebGLProgram(f,[h],"int32");return n.disposeData(h.dataId),p}};let Bze;const $ze={kernelName:yce,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a,bias:o,preluActivationWeights:s}=t,{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=r,m=j.convertConv2DDataFormat(c),g=j.computeConv2DInfo(i.shape,a.shape,l,d,u,h,!1,m);let v;const y=[];if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(xse().getBool("WEBGL_CONV_IM2COL")&&1===i.shape[0])v=C$e({x:i,filter:a,convInfo:g,backend:n,bias:o,activation:f,preluActivationWeights:s,leakyreluAlpha:p});else{const e=null!=o,t=null!=s,r="leakyrelu"===f,l=f?zLe(f,!1):null,u=new k$e(g,e,l,t,r),c=[i,a];if(o&&c.push(o),s&&c.push(s),r){const e=n.makeTensorInfo([],"float32",w.createScalarValue(p,"float32"));c.push(e),y.push(e)}v=n.runWebGLProgram(u,c,"float32")}else v=T$e({x:i,filter:a,convInfo:g,backend:n,bias:o,activation:f,preluActivationWeights:s,leakyreluAlpha:p});const b=GLe({inputs:{x:v},backend:n,attrs:{shape:g.outShape}});return y.push(v),y.forEach(e=>n.disposeIntermediateTensorInfo(e)),b}},zze={kernelName:bce,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a,bias:o,preluActivationWeights:s}=t,{strides:l,pad:u,dilations:c,dimRoundingMode:d,activation:h,leakyreluAlpha:f}=r,p=[];let m=c;null==m&&(m=[1,1]),w.assert(j.eitherStridesOrDilationsAreOne(l,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`);const g=j.computeConv2DInfo(i.shape,a.shape,l,m,u,d,!0),v=xse().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels==1,y=h?zLe(h,v):null,b=[i,a],x=null!=o,_=null!=s,k="leakyrelu"===h;if(x&&b.push(o),_&&b.push(s),k){const e=n.makeTensorInfo([],"float32",w.createScalarValue(f,"float32"));b.push(e),p.push(e)}let E;E=v?new J$e(g,x,y,_,k):new Z$e(g,x,y,_,k);const S=n.runWebGLProgram(E,b,"float32");return p.forEach(e=>n.disposeIntermediateTensorInfo(e)),S}};class Uze{constructor(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;const r=MPe(t.length),i=MPe(n.length);this.userCode=`\n        ${r} strides = ${r}(${this.strides});\n         void main() {\n          ${i} coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ${this.sliceDim}; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ${this.sliceDim>1?"strides[j]":"strides"};\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      `}}const Hze={kernelName:Nle,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:r,indices:i}=t,a=i.shape,o=a[a.length-1],[s,l,u,c]=j.prepareAndValidate(r,i),d=GLe({inputs:{x:i},backend:n,attrs:{shape:[l,o]}}),h=GLe({inputs:{x:r},backend:n,attrs:{shape:[w.sizeFromShape(r.shape)/u,u]}}),f=new Uze(o,c,[l,u]),p=n.runWebGLProgram(f,[h,d],h.dtype),m=GLe({inputs:{x:p},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),m}};class Wze{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const n=MPe(this.rank),r=function(e,t){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let i=0;i<e.length;i++)r.push(2===i?"int(getIndices(resRC.x, resRC.z))":""+n[i]);return r.join()}(e);this.userCode=`\n      void main() {\n        ${n} resRC = getOutputCoords();\n        setOutput(getA(${r}));\n      }\n    `}}const Vze={kernelName:Mle,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,indices:a}=t,{axis:o,batchDims:s}=r,l=w.parseAxisParam(o,i.shape)[0],u=j.segment_util.collectGatherOpShapeInfo(i,a,l,s),c=w.sizeFromShape(a.shape),d=[],h=GLe({inputs:{x:i},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),f=GLe({inputs:{x:a},backend:n,attrs:{shape:[u.batchSize,c/u.batchSize]}});d.push(h),d.push(f);const p=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([i,a])||"string"===i.dtype){const e=n.bufferSync(f),t=n.bufferSync(h),r=WPe(t,e,p);return d.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(u.outputShape,r.dtype,r.values)}const m=new Wze(h.shape,p),g=n.runWebGLProgram(m,[h,f],h.dtype);d.push(g);const v=GLe({inputs:{x:g},backend:n,attrs:{shape:u.outputShape}});return d.forEach(e=>n.disposeIntermediateTensorInfo(e)),v}},qze=$Le({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:VPe,dtype:"bool"}),Gze={kernelName:jle,backendName:"webgl",kernelFunc:qze},Yze=$Le({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool"}),Xze={kernelName:Fle,backendName:"webgl",kernelFunc:Yze},Kze={kernelName:Ple,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t;return Eze(r,!0,n)}},Zze=BLe({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),Jze={kernelName:Ble,backendName:"webgl",kernelFunc:Zze},Qze=BLe({opSnippet:"return float(isinf(x));",dtype:"bool"}),eUe={kernelName:$le,backendName:"webgl",kernelFunc:Qze},tUe=BLe({opSnippet:"return float(isnan(x));",dtype:"bool"}),nUe={kernelName:zle,backendName:"webgl",kernelFunc:tUe},rUe=$Le({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:qPe,dtype:"bool"}),iUe={kernelName:Hle,backendName:"webgl",kernelFunc:rUe},aUe=$Le({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",dtype:"bool"}),oUe={kernelName:Wle,backendName:"webgl",kernelFunc:aUe},sUe={kernelName:Vle,backendName:"webgl",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:i,num:a}=n,o=GPe(r,i,a);return t.makeTensorInfo([o.length],"float32",o)}},lUe=BLe({opSnippet:"if (x < 0.0) return NAN;\n  return log(x);",packedOpSnippet:"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:YPe}),uUe={kernelName:qle,backendName:"webgl",kernelFunc:lUe},cUe=BLe({opSnippet:"return log(1.0 + x);"}),dUe={kernelName:Gle,backendName:"webgl",kernelFunc:cUe},hUe=$Le({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),fUe={kernelName:Yle,backendName:"webgl",kernelFunc:hUe},pUe=BLe({opSnippet:"return float(!(x >= 1.0));"}),mUe={kernelName:Xle,backendName:"webgl",kernelFunc:pUe},gUe=$Le({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),vUe={kernelName:Kle,backendName:"webgl",kernelFunc:gUe};class yUe{constructor(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[];const a=t,o=e[3]-1;let s;this.outputShape=e;const l=`float(${n}) + float(${r}) * sum`;s=.5===i?`inversesqrt(${l})`:1===i?`1.0/(${l})`:`exp(log(${l}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -${a}; j <= ${a}; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ${o}) {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ${s};\n        setOutput(val);\n      }\n    `}}class bUe{constructor(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const a=t,o=e[3]-1;let s;this.outputShape=e;const l=`float(${n}) + float(${r}) * sum`;s=.5===i?`inversesqrt(${l})`:1===i?`1.0/(${l})`:`exp(log(${l}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ${this.outputShape[3]};\n        bool hasNextRow = c < ${this.outputShape[2]};\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ${a};\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ${a}; j <= ${a}; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${o}));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ${s};\n        setOutput(result);\n      }\n    `}}const xUe={kernelName:Jle,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{depthRadius:a,bias:o,alpha:s,beta:l}=r,u=xse().getBool("WEBGL_PACK_NORMALIZATION")?new bUe(i.shape,a,o,s,l):new yUe(i.shape,a,o,s,l);return n.runWebGLProgram(u,[i],i.dtype)}};class wUe{constructor(e,t,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=i,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ${this.depth}; ++d) {\n          int depthBegin = int(max(0.0, float(d - ${t})));\n          int depthEnd = int(min(float(${this.depth}),\n              float(d + ${t} + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ${this.depth};\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(${r}) * norm + float(${n});\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(${r})\n                * float(${i})\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ${i});\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    `}}const _Ue={kernelName:Qle,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i,y:a,dy:o}=t,{depthRadius:s,bias:l,alpha:u,beta:c}=r,d=new wUe(i.shape,s,l,u,c);return n.runWebGLProgram(d,[i,a,o],i.dtype)}};function kUe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reductionIndices:a,keepDims:o}=r,s=i.shape.length,l=w.parseAxisParam(a,i.shape);let u=l;const c=j.getAxesPermutation(u,s),d=null!=c,h=n.shouldExecuteOnCPU([i]);let f=i;if(d){if(h){const e=n.texData.get(f.dataId).values,t=new Array(s);for(let n=0;n<t.length;n++)t[n]=i.shape[c[n]];const r=uLe(e,i.shape,i.dtype,c,t);f=n.makeTensorInfo(t,i.dtype),n.texData.get(f.dataId).values=r}else f=eBe(i,c,n);u=j.getInnerMostAxes(u.length,s)}j.assertAxesAreInnerMostDims("max",u,s);const[p,m]=j.computeOutAndReduceShapes(f.shape,u);let g,v=p;if(o&&(v=j.expandShapeToKeepDim(p,l)),h){const e=n.texData.get(f.dataId),t=XPe(e.values,w.sizeFromShape(m),v,i.dtype);g=n.makeTensorInfo(v,i.dtype),n.texData.get(g.dataId).values=t}else g=function(e,t,n,r){const i=w.sizeFromShape(t),a=GLe({inputs:{x:e},attrs:{shape:[w.sizeFromShape(e.shape)/i,i]},backend:r}),o=ZLe(a,e.dtype,"max",r),s=GLe({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(o),s}(f,m,v,n);return d&&n.disposeIntermediateTensorInfo(f),g}const EUe={kernelName:eue,backendName:"webgl",kernelFunc:kUe},SUe=$Le({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:KPe}),TUe={kernelName:tue,backendName:"webgl",kernelFunc:SUe},CUe={kernelName:nue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;oPe(i,"maxPool");const{filterSize:a,strides:o,pad:s,dimRoundingMode:l}=r;w.assert(j.eitherStridesOrDilationsAreOne(o,1),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`);const u=j.computePool2DInfo(i.shape,a,o,1,s,l);if(1===u.filterWidth&&1===u.filterHeight&&w.arraysEqual(u.inShape,u.outShape))return ALe({inputs:{x:i},backend:n});const c=new RBe(u,"max",!1);return n.runWebGLProgram(c,[i],i.dtype)}},IUe={kernelName:iue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:a,strides:o,pad:s,dataFormat:l,dimRoundingMode:u}=r,c=j.computePool3DInfo(i.shape,a,o,[1,1,1],s,u,l),d=new PBe(c,"max",!1);return n.runWebGLProgram(d,[i],i.dtype)}};class AUe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.effectiveFilterHeight,n=e.effectiveFilterWidth;this.userCode=`\n      const ivec2 pads = ivec2(${t-1-e.padInfo.top}, ${n-1-e.padInfo.left});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${t};\n          wR += ${e.dilationHeight}) {\n          float dyR = float(dyRCorner + wR) / ${e.strideHeight}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${e.strideWidth}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${t*n-1} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${n} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class OUe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.effectiveFilterDepth,n=e.effectiveFilterHeight,r=e.effectiveFilterWidth;this.userCode=`\n      const ivec3 pads = ivec3(${t-1-e.padInfo.front}, ${n-1-e.padInfo.top}, ${r-1-e.padInfo.left});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${t};\n           wD += ${e.dilationDepth}) {\n          float dyD = float(dyDCorner + wD) / ${e.strideDepth}.0;\n\n          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${n};\n              wR += ${e.dilationHeight}) {\n            float dyR = float(dyRCorner + wR) / ${e.strideHeight}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${r};\n                wC += ${e.dilationWidth}) {\n              float dyC = float(dyCCorner + wC) / ${e.strideWidth}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${t*n*r-1} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${n} * ${r} +\n                  wR * ${r} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const DUe={kernelName:aue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,o=a,{filterSize:s,strides:l,pad:u,dimRoundingMode:c}=r,d=j.computePool3DInfo(o.shape,s,l,[1,1,1],u,c),h=new PBe(d,"max",!0),f=n.runWebGLProgram(h,[o],o.dtype),p=new OUe(d),m=n.runWebGLProgram(p,[i,f],o.dtype);return n.disposeIntermediateTensorInfo(f),m}},MUe={kernelName:rue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a,output:o}=t,s=a;oPe([a,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:d}=r,h=j.computePool2DInfo(s.shape,l,u,1,c,d),f=new RBe(h,"max",!0),p=n.runWebGLProgram(f,[s],s.dtype),m=new AUe(h),g=n.runWebGLProgram(m,[i,p],s.dtype);return n.disposeIntermediateTensorInfo(p),g}},NUe={kernelName:oue,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{filterSize:i,strides:a,pad:o,includeBatchInIndex:s}=t,l=n;w.assert(4===r.shape.length,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);const u=[1,1];w.assert(j.eitherStridesOrDilationsAreOne(a,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${u}'`);const c=j.computePool2DInfo(r.shape,i,a,u,o),[d,h]=function(e,t,n,r){let i=new RBe(n,"max",!1);const a=r.runWebGLProgram(i,[e],"float32");return i=new RBe(n,"max",!0,!0,t),[a,r.runWebGLProgram(i,[e],"float32")]}(r,s,c,l);return[d,h]}},jUe={kernelName:sue,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{keepDims:i,axis:a}=t,o=n,s=r.shape.length,l=w.parseAxisParam(a,r.shape);let u=l;const c=j.getAxesPermutation(u,s),d=null!=c,h=o.shouldExecuteOnCPU([r]),f=[];let p=r;if(d){if(h){const e=o.texData.get(p.dataId).values,t=new Array(s);for(let i=0;i<t.length;i++)t[i]=r.shape[c[i]];const n=uLe(e,r.shape,r.dtype,c,t);p=o.makeTensorInfo(t,r.dtype),o.texData.get(p.dataId).values=n}else p=eBe(r,c,o);f.push(p),u=j.getInnerMostAxes(u.length,s)}j.assertAxesAreInnerMostDims("sum",u,s);const[m,g]=j.computeOutAndReduceShapes(p.shape,u);let v=m;i&&(v=j.expandShapeToKeepDim(m,l));const y=function(e,t,n,r){const i=w.sizeFromShape(t),a=GLe({inputs:{x:e},attrs:{shape:[w.sizeFromShape(e.shape)/i,i]},backend:r}),o=ZLe(a,"float32","mean",r),s=GLe({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(o),s}(p,g,v,o);for(const b of f)o.disposeIntermediateTensorInfo(b);return y}},FUe={kernelName:lue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:o}=r,s=i.shape.length,l=w.parseAxisParam(a,i.shape);let u=l;const c=j.getAxesPermutation(u,s);let d=i;null!=c&&(d=rBe({inputs:{x:i},backend:n,attrs:{perm:c}}),u=j.getInnerMostAxes(u.length,i.shape.length)),j.assertAxesAreInnerMostDims("min",u,s);const[h,f]=j.computeOutAndReduceShapes(d.shape,u),p=GLe({inputs:{x:d},backend:n,attrs:{shape:[-1,w.sizeFromShape(f)]}}),m=ZLe(p,p.dtype,"min",n);let g;return g=GLe(o?{inputs:{x:m},backend:n,attrs:{shape:j.expandShapeToKeepDim(h,l)}}:{inputs:{x:m},backend:n,attrs:{shape:h}}),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(d),g}},RUe=$Le({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:ZPe}),PUe={kernelName:uue,backendName:"webgl",kernelFunc:RUe};class LUe{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,i=MPe(r),a=t.map(e=>e[0]).join(","),o=t.map((t,n)=>t[0]+e[n]).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l="reflect"===n?0:1;this.userCode=1!==r?`\n      ${i} start = ${i}(${a});\n      ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outC = getOutputCoords();\n        for (int i = 0; i < ${r}; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ${l};\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};\n          }\n        }\n        ${i} coords = outC - start;\n        setOutput(getX(${s}));\n      }\n    `:`\n        int start = ${a};\n        int end = ${o};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ${l};\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ${l};\n          }\n          setOutput(getX(outC - start));\n        }\n      `}}class BUe{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,i=MPe(r),a=t.map(e=>e[0]).join(","),o=t.map((t,n)=>t[0]+e[n]).join(","),s=hLe("rc",r),l=hLe("source",r),u=`${s[r-1]} < ${this.outputShape[r-1]}`,c=1===r?"source":`vec2(${l.slice(-2).join()})`,d="reflect"===n?0:1;let h="";if(1===r){const e=`\n        ${i} source = rc;\n        if (source < start) {\n          source = start * 2 - source - ${d};\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ${d};\n        }\n        source -= start;\n      `;h=`\n        ${i} rc = outputLoc;\n        ${e}\n        result[0] = getChannel(getX(${l.join()}), ${c});\n        ${s[r-1]} += 1;\n        if(${u}) {\n          ${e}\n          result[1] = getChannel(getX(${l.join()}), ${c});\n        }\n      `}else{const e=`\n        ${i} source = rc;\n        ${i} lt = ${i}(lessThan(source, start));\n        ${i} gte = ${i}(greaterThanEqual(source, end));\n        ${i} orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ${d}) +\n                gte * ((end - 1) * 2 - source + ${d});\n        source -= start;\n      `;h=`\n        ${i} rc = outputLoc;\n        ${e}\n        result[0] = getChannel(getX(${l.join()}), ${c});\n        ${s[r-1]} += 1;\n        if(${u}) {\n          ${e}\n          result[1] = getChannel(getX(${l.join()}), ${c});\n        }\n        rc = outputLoc;\n        ${s[r-2]} += 1;\n        if(${s[r-2]} < ${this.outputShape[r-2]}) {\n          ${e}\n          result[2] = getChannel(getX(${l.join()}), ${c});\n          ${s[r-1]} += 1;\n          if(${u}) {\n            ${e}\n            result[3] = getChannel(getX(${l.join()}), ${c});\n          }\n        }\n      `}this.userCode=`\n      const ${i} start = ${i}(${a});\n      const ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${h}\n        setOutput(result);\n      }\n    `}}const $Ue={kernelName:cue,backendName:"webgl",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r}=e,{paddings:i,mode:a}=n,o=xse().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new BUe(r.shape,i,a):new LUe(r.shape,i,a);return t.runWebGLProgram(o,[r],r.dtype)}},zUe=$Le({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),UUe={kernelName:due,backendName:"webgl",kernelFunc:zUe};class HUe{constructor(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode=`\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ${t-1}; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(${t-1}));\n      }\n    `}getCustomSetupFunc(e){return(t,n)=>{null==this.seedLoc&&(this.seedLoc=t.getUniformLocation(n,"seed")),t.gl.uniform1f(this.seedLoc,e)}}}const WUe=$Le({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),VUe={kernelName:yle,backendName:"webgl",kernelFunc:WUe},qUe="return a - b;",GUe=$Le({opSnippet:qUe,packedOpSnippet:qUe,supportsComplex:!0,cpuKernelImpl:oLe}),YUe={kernelName:nce,backendName:"webgl",kernelFunc:GUe};function XUe(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{dim:a}=r,o=w.parseAxisParam([a],i.shape),s=kUe({inputs:{x:i},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),l=j.expandShapeToKeepDim(s.shape,o),u=GLe({inputs:{x:s},backend:n,attrs:{shape:l}}),c=GUe({inputs:{a:i,b:u},backend:n}),d=gze({inputs:{x:c},backend:n}),h=tBe({inputs:{x:d},backend:n,attrs:{axis:o,keepDims:!1}}),f=GLe({inputs:{x:h},backend:n,attrs:{shape:l}}),p=WUe({inputs:{a:d,b:f},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),p}const KUe={kernelName:Que,backendName:"webgl",kernelFunc:XUe},ZUe={kernelName:hue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{numSamples:a,seed:o,normalized:s}=r,l=s?i:XUe({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),u=new HUe(l.shape[0],l.shape[1],a),c=u.getCustomSetupFunc(o),d=n.runWebGLProgram(u,[l],"int32",c);return s||n.disposeIntermediateTensorInfo(l),d}},JUe="return -x;",QUe={kernelName:pue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])){const e=n.texData.get(r.dataId),[t,i]=QPe(e.values,r.shape,r.dtype);return n.makeTensorInfo(i,r.dtype,t)}let i;return i=xse().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new _Le(r.shape,JUe):new bLe(r.shape,JUe),n.runWebGLProgram(i,[r],r.dtype)}},eHe=F.nonMaxSuppressionV3Impl,tHe={kernelName:gue,backendName:"webgl",kernelFunc:function(e){j.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:l}=r,u=n.readSync(i.dataId),c=n.readSync(a.dataId),{selectedIndices:d}=eHe(u,c,o,s,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}},nHe=F.nonMaxSuppressionV4Impl,rHe={kernelName:vue,backendName:"webgl",kernelFunc:function(e){j.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:l,padToMaxOutputSize:u}=r,c=n.readSync(i.dataId),d=n.readSync(a.dataId),{selectedIndices:h,validOutputs:f}=nHe(c,d,o,s,l,u);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},iHe=F.nonMaxSuppressionV5Impl,aHe={kernelName:yue,backendName:"webgl",kernelFunc:function(e){j.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:l,softNmsSigma:u}=r,c=n.readSync(i.dataId),d=n.readSync(a.dataId),h=o,f=s,p=l,m=u,{selectedIndices:g,selectedScores:v}=iHe(c,d,h,f,p,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([v.length],"float32",new Float32Array(v))]}};class oHe{constructor(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(${r}), float(${n}),\n                      float(index == coords.y)));\n      }\n    `}}const sHe={kernelName:xue,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{indices:i}=t,{depth:a,onValue:o,offValue:s}=r,l=w.sizeFromShape(i.shape),u=new oHe(l,a,o,s),c=GLe({inputs:{x:i},backend:n,attrs:{shape:[l]}}),d=n.runWebGLProgram(u,[c],i.dtype);n.disposeIntermediateTensorInfo(c);const h=GLe({inputs:{x:d},backend:n,attrs:{shape:[...i.shape,a]}});return n.disposeIntermediateTensorInfo(d),h}};function lHe(e){const{inputs:t,backend:n}=e,{x:r}=t;if("complex64"===r.dtype){const e=r$e({inputs:{input:r},backend:n}),t=lHe({inputs:{x:e},backend:n}),i=y$e({inputs:{input:r},backend:n}),a=lHe({inputs:{x:i},backend:n}),o=DLe({inputs:{real:t,imag:a},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),o}return Cze({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}const uHe={kernelName:fce,backendName:"webgl",kernelFunc:lHe},cHe={kernelName:bue,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r}=t,{x:i}=n;if("string"===i.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===i.dtype){const t=r$e({inputs:{input:i},backend:r}),n=e({inputs:{x:t},backend:r}),a=y$e({inputs:{input:i},backend:r}),o=lHe({inputs:{x:a},backend:r}),s=DLe({inputs:{real:n,imag:o},backend:r});return r.disposeIntermediateTensorInfo(t),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(o),s}return Cze({attrs:{shape:i.shape,dtype:i.dtype,value:1},backend:r})}},dHe={kernelName:wue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r;if(1===t.length)return yze({inputs:{input:t[0]},backend:n,attrs:{dim:i}});const a=t[0].shape,o=t[0].dtype;t.forEach(e=>{w.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),w.assert(o===e.dtype,()=>"All tensors passed to stack must have matching dtypes")});const s=[],l=w$e({inputs:t.map(e=>{const t=yze({inputs:{input:e},backend:n,attrs:{dim:i}});return s.push(t),t}),backend:n,attrs:{axis:i}});return s.forEach(e=>n.disposeIntermediateTensorInfo(e)),l}};class hHe{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,i=MPe(r),a=t.map(e=>e[0]).join(","),o=t.map((t,n)=>t[0]+e[n]).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?`\n      ${i} start = ${i}(${a});\n      ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float(${n}));\n        } else {\n          ${i} coords = outC - start;\n          setOutput(getX(${s}));\n        }\n      }\n    `:`\n        int start = ${a};\n        int end = ${o};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float(${n}));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}}class fHe{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,i=MPe(r),a=t.map(e=>e[0]).join(","),o=t.map((t,n)=>t[0]+e[n]).join(","),s=hLe("rc",r),l=hLe("source",r),u=`${s[r-1]} < ${this.outputShape[r-1]}`,c=1===r?"source":`vec2(${l.slice(-2).join()})`,d=[i+" rc = outputLoc;",`${s[r-1]} += 1;\n       if(${u}) {\n      `,1===r?"":`}\n       rc = outputLoc;\n       ${s[r-2]} += 1;\n       if(${s[r-2]} < ${this.outputShape[r-2]}) {`,1===r?"":`  ${s[r-1]} += 1;\n         if(${u}) {`],h=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let f="";for(let p=0,m=1===r?2:4;p<m;p++)f+=`\n        ${d[p]}\n        if (${h}) {\n          result[${p}] = float(${n});\n        } else {\n          ${i} source = rc - start;\n          result[${p}] = getChannel(getX(${l.join()}), ${c});\n        }\n      `;f+=1===r?"} ":"}}",this.userCode=`\n      const ${i} start = ${i}(${a});\n      const ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${f}\n        setOutput(result);\n      }\n    `}}const pHe=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:a,constantValue:o}=r,s=xse().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fHe(i.shape,a,o):new hHe(i.shape,a,o);return n.runWebGLProgram(s,[i],i.dtype)},mHe={kernelName:_ue,backendName:"webgl",kernelFunc:pHe},gHe=$Le({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),vHe={kernelName:Eue,backendName:"webgl",kernelFunc:gHe},yHe={kernelName:Tue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:o}=r,s=i.shape.length,l=[],u=w.parseAxisParam(a,i.shape);let c=u;const d=j.getAxesPermutation(c,s);let h,f=i;if(null!=d&&(f=rBe({inputs:{x:i},backend:n,attrs:{perm:d}}),c=j.getInnerMostAxes(c.length,s),l.push(f)),j.assertAxesAreInnerMostDims("prod",c,s),n.shouldExecuteOnCPU([f])){const e=n.texData.get(f.dataId).values,{outVals:t,outShape:r,outDtype:i}=eLe(f.shape,f.dtype,e,c);h=n.makeTensorInfo(r,i,t)}else{const[e,t]=j.computeOutAndReduceShapes(f.shape,c),r=w.sizeFromShape(t),a=GLe({inputs:{x:f},backend:n,attrs:{shape:[-1,r]}}),o=ZLe(a,nde(i.dtype),"prod",n);h=GLe({inputs:{x:o},backend:n,attrs:{shape:e}}),l.push(a),l.push(o)}if(o){l.push(h);const e=j.expandShapeToKeepDim(h.shape,u);h=GLe({inputs:{x:h},backend:n,attrs:{shape:e}})}return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),h}},bHe=e=>{const{backend:t,attrs:n}=e,{start:r,stop:i,step:a,dtype:o}=n,s=tLe(r,i,a,o);return t.makeTensorInfo([s.length],o,s)},xHe={kernelName:Cue,backendName:"webgl",kernelFunc:bHe},wHe=BLe({opSnippet:"return 1.0 / x;"}),_He={kernelName:Aue,backendName:"webgl",kernelFunc:wHe},kHe=BLe({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),EHe={kernelName:Oue,backendName:"webgl",kernelFunc:kHe},SHe=BLe({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),THe={kernelName:Rue,backendName:"webgl",kernelFunc:SHe};class CHe{constructor(e,t,n,r,i){this.variableNames=["A"],this.outputShape=[];const[a,o,s,l]=e;this.outputShape=[a,t,n,l];const u=[r&&t>1?o-1:o,r&&n>1?s-1:s],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];let d;d=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${u[0]/c[0]},\n          ${u[1]/c[1]});\n      const vec2 inputShapeRC = vec2(${o}.0, ${s}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${d};\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}class IHe{constructor(e,t,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[a,o,s,l]=e;this.outputShape=[a,t,n,l];const u=[r&&t>1?o-1:o,r&&n>1?s-1:s],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];let d;d=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${u[0]/c[0]},\n          ${u[1]/c[1]},\n          ${u[1]/c[1]});\n      const vec3 inputShapeRC = vec3(${o}.0, ${s}.0,\n                                     ${s}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${d};\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${l-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}const AHe={kernelName:jue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:a,halfPixelCenters:o,size:s}=r,[l,u]=s,c=xse().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new IHe(i.shape,l,u,a,o):new CHe(i.shape,l,u,a,o);return n.runWebGLProgram(c,[i],"float32")}};class OHe{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,a,o]=e,s=[n&&a>1?r-1:r,n&&o>1?i-1:i],l=[n&&a>1?a-1:a,n&&o>1?o-1:o],u=s[0]/l[0],c=s[1]/l[1],d=1/u,h=1/c,f=2*Math.ceil(d)+2,p=2*Math.ceil(h)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${u});\n        const float widthScale = float(${c});\n\n        const float invHeightScale = float(${d});\n        const float invWidthScale = float(${h});\n\n        const int winHeight = int(${f});\n        const int winWidth = int(${p});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${a}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${o}) {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}const DHe={kernelName:Fue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:a}=t,{alignCorners:o}=r,s=new OHe(a.shape,i.shape,o);return n.runWebGLProgram(s,[a],a.dtype)}};class MHe{constructor(e,t,n,r,i){this.variableNames=["A"],this.outputShape=[];const[a,o,s,l]=e;this.outputShape=[a,t,n,l];const u=[r&&t>1?o-1:o,r&&n>1?s-1:s],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];let d;d=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${u[0]/c[0]},\n          ${u[1]/c[1]});\n      const vec2 inputShapeRC = vec2(${o}.0, ${s}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${d};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${r?"0.5":"0.0"})));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    `}}const NHe={kernelName:Mue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:a,halfPixelCenters:o,size:s}=r,[l,u]=s,c=new MHe(i.shape,l,u,a,o);return n.runWebGLProgram(c,[i],i.dtype)}};class jHe{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,a,o]=e,s=[n&&a>1?r-1:r,n&&o>1?i-1:i],l=[n&&a>1?a-1:a,n&&o>1?o-1:o],u=s[0]/l[0],c=s[1]/l[1],d=1/u,h=1/c,f=2*Math.ceil(d)+2,p=2*Math.ceil(h)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${u});\n        const float widthScale = float(${c});\n\n        const float invHeightScale = float(${d});\n        const float invWidthScale = float(${h});\n\n        const int winHeight = int(${f});\n        const int winWidth = int(${p});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${a}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${o}) {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(${s[0]}) *\n                (float(dyR) / float(${l[0]}));\n\n            float sourceFracCol =\n                float(${s[1]}) *\n                  (float(dyC) / float(${l[1]}));\n\n            int sourceNearestRow = int(min(\n                float(int(${r}) - 1),\n                ${n} ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(${i}) - 1),\n                ${n} ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}const FHe={kernelName:Nue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:a}=t,{alignCorners:o}=r,s=new jHe(a.shape,i.shape,o);return n.runWebGLProgram(s,[a],a.dtype)}};class RHe{constructor(e,t){this.variableNames=["x"];const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=e,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${e[0]} - coord - 1));\n        }\n      `);const r=e.map((n,r)=>(n=>-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - coords[${n}] - 1`:`coords[${n}]`)(r)).join(","),i=MPe(n);this.userCode=`\n      void main() {\n        ${i} coords = getOutputCoords();\n        setOutput(getX(${r}));\n      }\n    `}}class PHe{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=e;const r=hLe("rc",n),i=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,a=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,o=MPe(n);function s(n){const r=e.map((r,i)=>function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - ${r[n]} - 1`:""+r[n]}(i,n));return`getChannel(getX(${r.join(",")}), vec2(${r.slice(-2).join(",")}))`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${e[0]} - rc - 1),\n            ${e[0]} - rc - 1);\n          if(${i}){\n              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),\n                ${e[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${o} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${function(e){return s(e)}(r.slice())};\n          if(${i}){\n            result.g = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())};\n          }\n          if(${a}) {\n            result.b = ${function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())};\n            if(${i}) {\n              result.a = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}const LHe={kernelName:Pue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dims:a}=r,o=i.shape.length,s=w.parseAxisParam(a,i.shape);if(0===o)return ALe({inputs:{x:i},backend:n});const l=xse().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new PHe(i.shape,s):new RHe(i.shape,s);return n.runWebGLProgram(l,[i],i.dtype)}};class BHe{constructor(e,t,n,r){this.variableNames=["Image"],this.outputShape=[];const i=e[1],a=e[2],o=Math.sin(t).toFixed(3),s=Math.cos(t).toFixed(3);this.outputShape=e;const[l,u]=j.getImageCenter(r,i,a),c=l.toFixed(3),d=u.toFixed(3);let h="";h="number"==typeof n?`float outputValue = ${n.toFixed(2)};`:`\n        vec3 fill = vec3(${n.join(",")});\n        float outputValue = fill[coords[3]];`,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - ${c}) * ${s} - (float(y) - ${d}) * ${o};\n          float coordYFloat = (float(x) - ${c}) * ${o} + (float(y) - ${d}) * ${s};\n          int coordX = int(round(coordXFloat + ${c}));\n          int coordY = int(round(coordYFloat + ${d}));\n          ${h}\n          if(coordX >= 0 && coordX < ${a} && coordY >= 0 && coordY < ${i}) {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}const $He={kernelName:gce,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,{radians:i,fillValue:a,center:o}=t,s=n,l=new BHe(r.shape,i,a,o);return s.runWebGLProgram(l,[r],r.dtype)}},zHe=BLe({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),UHe={kernelName:Lue,backendName:"webgl",kernelFunc:zHe},HHe=BLe({opSnippet:"return inversesqrt(x);",cpuKernelImpl:nLe}),WHe={kernelName:Bue,backendName:"webgl",kernelFunc:HHe};class VHe{constructor(e,t,n,r,i,a,o=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;const s=MPe(i.length),l=MPe(a.length);let u="";1===n?u="i":2===n&&(u="i, j");let c="";1===r?c="i":2===r&&(c="i, coords[1]"),this.userCode=`\n        ${s} strides = ${s}(${i});\n\n        void main() {\n          ${l} coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ${e}; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ${t}; j++) {\n              int index = round(getIndices(${u}));\n              flattenedIndex += index * ${t>1?"strides[j]":"strides"};\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates(${c});\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      `}}const qHe={kernelName:$ue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i,updates:a}=t,{shape:o}=r,{sliceRank:s,numUpdates:l,sliceSize:u,strides:c,outputSize:d}=j.calculateShapes(a,i,o),h=[d/u,u];if(0===d)return n.makeTensorInfo(o,i.dtype);const f=GLe({inputs:{x:i},backend:n,attrs:{shape:[l,s]}}),p=GLe({inputs:{x:a},backend:n,attrs:{shape:[l,u]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new VHe(l,s,f.shape.length,p.shape.length,c,h),v=n.runWebGLProgram(g,[p,f,m],p.dtype),y=GLe({inputs:{x:v},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(m),y}};class GHe{constructor(e,t,n){let r,i;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error(`Where for rank ${n} is not yet supported`);if(1===n)i="resRC",r="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],o=[];for(let r=0;r<t.length;r++)o.push(""+n[r]),r<e&&a.push(""+n[r]);r=a.join(),i=o.join()}const a=MPe(n);this.userCode=`\n      void main() {\n        ${a} resRC = getOutputCoords();\n        float cVal = getC(${r});\n        if (cVal >= 1.0) {\n          setOutput(getA(${i}));\n        } else {\n          setOutput(getB(${i}));\n        }\n      }\n    `}}const YHe={kernelName:zue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:r,t:i,e:a}=t,o=new GHe(r.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(o,[r,i,a],tde(i.dtype,a.dtype))}},XHe=BLe({opSnippet:`\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ${j.SELU_SCALEALPHA};\n  float scale = ${j.SELU_SCALE};\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n`}),KHe={kernelName:Uue,backendName:"webgl",kernelFunc:XHe},ZHe=BLe({opSnippet:"return 1.0 / (1.0 + exp(-1.0 * x));"}),JHe={kernelName:Gue,backendName:"webgl",kernelFunc:ZHe},QHe=BLe({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),eWe={kernelName:que,backendName:"webgl",kernelFunc:QHe},tWe=BLe({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"}),nWe={kernelName:Wue,backendName:"webgl",kernelFunc:tWe},rWe=BLe({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),iWe={kernelName:Vue,backendName:"webgl",kernelFunc:rWe},aWe=BLe({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),oWe={kernelName:Yue,backendName:"webgl",kernelFunc:aWe},sWe={kernelName:Zue,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:a,paddings:o}=r;w.assert(i.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const s=a.reduce((e,t)=>e*t),l=[[0,0]];l.push(...o);for(let v=1+a.length;v<i.shape.length;++v)l.push([0,0]);const u=[],c=pHe({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),d=j.getReshaped(c.shape,a,s,!1),h=j.getPermuted(d.length,a.length,!1),f=j.getReshapedPermuted(c.shape,a,s,!1),p=GLe({inputs:{x:c},backend:n,attrs:{shape:d}}),m=rBe({inputs:{x:p},backend:n,attrs:{perm:h}}),g=GLe({inputs:{x:m},backend:n,attrs:{shape:f}});return u.push(c),u.push(p),u.push(m),u.forEach(e=>n.disposeIntermediateTensorInfo(e)),g}},lWe={kernelName:rce,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:i,sparseValues:a,defaultValue:o}=t,{outputShape:s}=r,{sliceRank:l,numUpdates:u,strides:c,outputSize:d}=j.calculateShapes(a,i,s),h=new VHe(u,l,i.shape.length,a.shape.length,c,[d,1],!1),f=n.runWebGLProgram(h,[a,i,o],a.dtype),p=GLe({inputs:{x:f},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(f),p}},uWe={kernelName:Jue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{numOrSizeSplits:a,axis:o}=r,s=w.parseAxisParam(o,i.shape)[0],l=j.prepareSplitSize(i,a,s),u=new Array(i.shape.length).fill(0),c=i.shape.slice();return l.map(e=>{const t=[...c];t[o]=e;const r=ZBe({inputs:{x:i},backend:n,attrs:{begin:u,size:t}});return u[o]+=e,r})}},cWe=BLe({opSnippet:"return sqrt(x);"}),dWe={kernelName:Xue,backendName:"webgl",kernelFunc:cWe},hWe=BLe({opSnippet:"return x * x;"}),fWe={kernelName:tce,backendName:"webgl",kernelFunc:hWe},pWe="return (a - b) * (a - b);",mWe=$Le({opSnippet:pWe,packedOpSnippet:pWe}),gWe={kernelName:ece,backendName:"webgl",kernelFunc:mWe},vWe={kernelName:pce,backendName:"webgl",kernelFunc:function({inputs:e,attrs:t,backend:n}){const{x:r}=e,i=new bLe(r.shape,`if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(${t.alpha});\n  `);return n.runWebGLProgram(i,[r],r.dtype)}};class yWe{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,i=MPe(n.length),a=MPe(n.length);let o="";if(1===r)o="coords * strides + begin";else{let e=0;o=n.map((t,r)=>(e++,1===n.length?`coords * strides[${r}] + begin[${r}]`:`coords[${e-1}] * strides[${r}] + begin[${r}]`)).join(",")}this.userCode=`\n      ${i} begin = ${i}(${e});\n      ${i} strides = ${i}(${t});\n\n      void main() {\n        ${a} coords = getOutputCoords();\n        setOutput(getX(${o}));\n      }\n    `}}const bWe={kernelName:ice,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:a,end:o,strides:s,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:d,shrinkAxisMask:h}=r,{nonStrided:f,$begin:p,$strides:m,size:g,newShape:v,outShape:y}=A.sliceInfo(i.shape,a,o,s,l,u,c,d,h),b=GLe({inputs:{x:i},backend:n,attrs:{shape:v}});let x;if(f){const e=ZBe({inputs:{x:b},backend:n,attrs:{begin:p,size:g}});x=GLe({inputs:{x:e},backend:n,attrs:{shape:y}}),n.disposeIntermediateTensorInfo(e)}else if(y.some(e=>0===e))x=n.makeTensorInfo(y,i.dtype,[]);else if(n.shouldExecuteOnCPU([b])){const e=n.texData.get(b.dataId),t=mhe(b.shape,b.dtype,e.values),r=aLe(y,t,m,p);x=n.makeTensorInfo(y,b.dtype,r.values)}else{const e=new yWe(p,m,y);x=n.runWebGLProgram(e,[b],b.dtype)}const w=GLe({inputs:{x:x},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(x),w}},xWe=BLe({opSnippet:"return tan(x);"}),wWe={kernelName:ace,backendName:"webgl",kernelFunc:xWe},_We=BLe({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),kWe={kernelName:oce,backendName:"webgl",kernelFunc:_We};class EWe{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let a=0;a<n.length;a++)n[a]=e[a]*t[a];this.outputShape=n,this.rank=n.length;const r=MPe(this.rank),i=function(e){const t=e.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(1===t)return`imod(resRC, ${e[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let i=0;i<e.length;i++)r.push(`imod(${n[i]}, ${e[i]})`);return r.join()}(e);this.userCode=`\n      void main() {\n        ${r} resRC = getOutputCoords();\n        setOutput(getA(${i}));\n      }\n    `}}function SWe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reps:a}=r;if("string"===i.dtype){const e=n.texData.get(i.dataId).values.map(e=>w.decodeString(e)),t=mhe(i.shape,i.dtype,e),r=sLe(t,a);return n.makeTensorInfo(r.shape,r.dtype,r.values)}const o=new EWe(i.shape,a);return n.runWebGLProgram(o,[i],i.dtype)}const TWe={kernelName:sce,backendName:"webgl",kernelFunc:SWe},CWe={kernelName:lce,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{k:a,sorted:o}=r,s=n.texData.get(i.dataId).values,[l,u]=lLe(s,i.shape,i.dtype,a,o);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(u.shape,u.dtype,u.values)]}},IWe={kernelName:cce,backendName:"webgl",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{axis:i}=n,{x:a}=t;oPe(a,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=r.readSync(a.dataId),{outputValues:s,outputShape:l,indices:u}=cLe(o,i,a.shape,a.dtype);return[r.makeTensorInfo(l,a.dtype,s),r.makeTensorInfo([u.length],"int32",u)]}},AWe={kernelName:dce,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:i}=t;let{axis:a}=r;a<0&&(a+=i.shape.length);const o=i,s=o.shape.length,l=i.shape[a],u=new Array(s-1);let c=0;for(let m=0;m<s;m++)m!==a&&(u[c++]=o.shape[m]);const d=[],h=new Array(s).fill(0),f=o.shape.slice();f[a]=1;const p=new Array(l);for(let m=0;m<p.length;m++){h[a]=m;const e=ZBe({inputs:{x:o},backend:n,attrs:{begin:h,size:f}}),t=GLe({inputs:{x:e},backend:n,attrs:{shape:u}});p[m]=t,d.push(e)}return d.forEach(e=>n.disposeIntermediateTensorInfo(e)),p}};class OWe{constructor(e,t){this.variableNames=["x","segmentIds"];const n=e.windowSize,r=e.batchSize,i=e.inSize,a=e.numSegments,o=a*Math.ceil(i/n);this.outputShape=[r,o];const s=4*Math.floor(n/4),l=n%4,u="\n        sumValue += dot(values, segFilter);\n    ";let c="";i%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `);let d="";i%n>0&&(d=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return -1.0;\n        }\n      `),this.userCode=`\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ${c}\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ${d}\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ${a})) * float(${n}));\n        int currentSeg = int(mod(float(outIdx), float(${a})));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${s}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ${u}\n        }\n\n        int inIdx = inOffset + ${s};\n        if (${1===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ${u}\n        } else if (${2===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ${u}\n        } else if (${3===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ${u}\n        }\n        setOutput(sumValue);\n      }\n    `}}const DWe=[xUe,_Ue,oBe,lBe,cBe,hBe,mBe,yBe,bBe,xBe,EBe,SBe,CBe,ABe,NBe,DBe,FBe,BBe,LBe,UBe,HBe,WBe,GBe,QBe,e$e,a$e,l$e,d$e,p$e,MLe,_$e,N$e,j$e,I$e,R$e,P$e,F$e,B$e,z$e,H$e,G$e,Y$e,K$e,nze,rze,Q$e,aze,sze,uze,cze,hze,pze,vze,bze,_ze,Sze,Ize,Oze,Nze,Fze,Lze,$ze,zze,Hze,Vze,Gze,Xze,OLe,Kze,b$e,Jze,eUe,nUe,FLe,iUe,oUe,sUe,dUe,uUe,fUe,mUe,vUe,EUe,IUe,CUe,DUe,MUe,NUe,TUe,jUe,FUe,PUe,$Ue,UUe,ZUe,qLe,QUe,tHe,rHe,aHe,n$e,sHe,cHe,dHe,mHe,vHe,LLe,yHe,xHe,i$e,VUe,_He,THe,EHe,YLe,AHe,DHe,NHe,FHe,LHe,$He,UHe,WHe,qHe,YHe,KHe,JHe,eWe,nWe,iWe,JBe,KUe,oWe,sWe,lWe,uWe,dWe,fWe,gWe,vWe,bWe,YUe,nBe,wWe,kWe,TWe,CWe,iBe,IWe,AWe,{kernelName:hce,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,segmentIds:a}=t,{numSegments:o}=r,s=i.shape.length,l=[];let u=0;const c=j.getAxesPermutation([u],s);let d=i;null!=c&&(d=rBe({inputs:{x:i},backend:n,attrs:{perm:c}}),l.push(d),u=j.getInnerMostAxes(1,s)[0]);const h=j.segment_util.computeOutShape(d.shape,u,o),f=w.sizeFromShape([d.shape[u]]),p=GLe({inputs:{x:d},backend:n,attrs:{shape:[-1,f]}});l.push(p);const m=nde(i.dtype),g=(e,t,r,i,a)=>{const o=e.shape[0],s=e.shape[1],u=j.segment_util.segOpComputeOptimalWindowSize(s,a),c=new OWe({windowSize:u,inSize:s,batchSize:o,numSegments:a},t),d=n.compileAndRun(c,[e,r],i);if(l.push(d),d.shape[1]===a)return d;const h=bHe({backend:n,attrs:{start:0,stop:a,step:1,dtype:"float32"}}),f=SWe({inputs:{x:h},backend:n,attrs:{reps:[s/u]}});return l.push(h),l.push(f),g(d,t,f,i,a)},v=GLe({inputs:{x:g(p,"unsortedSegmentSum",a,m,o)},backend:n,attrs:{shape:h}});let y=v;if(null!=c){l.push(v);const e=j.getUndoAxesPermutation(c);y=rBe({inputs:{x:y},backend:n,attrs:{perm:e}})}return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),y}},uHe];for(const Gqe of DWe)Sce(Gqe);const MWe={"tfjs-core":Efe,"tfjs-backend-cpu":"2.8.2","tfjs-backend-webgl":"2.8.2","tfjs-data":tDe,"tfjs-layers":xEe,"tfjs-converter":KAe,tfjs:"2.8.2"};var NWe,jWe;let FWe;!function(e){e[e.float32=0]="float32",e[e.int32=1]="int32",e[e.bool=2]="bool",e[e.string=3]="string",e[e.complex64=4]="complex64"}(NWe||(NWe={})),function(e){e[e.linear=0]="linear",e[e.relu=1]="relu",e[e.relu6=2]="relu6",e[e.prelu=3]="prelu",e[e.leakyrelu=4]="leakyrelu"}(jWe||(jWe={}));const RWe={kernelName:vce,backendName:"wasm",setupFunc:function(e){FWe=e.wasm.cwrap(vce,null,["number","array","number","number","array","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:a,bias:o,preluActivationWeights:s}=t;if("float32"!==i.dtype||"float32"!==a.dtype)throw new Error("_FusedMatMul for non non-float32 tensors not yet supported.");const{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:d}=r,h=n.dataIdMap.get(i.dataId).id,f=n.dataIdMap.get(a.dataId).id;let p=0;if(null!=o){const e=n.dataIdMap.get(o.dataId);if(1!==e.shape.length)throw new Error(`_FusedMatMul only supports rank-1 bias but got rank ${e.shape.length}.`);p=e.id}const m=null==s?0:n.dataIdMap.get(s.dataId).id,g=jWe[c];if(null==g)throw new Error(c+" activation not yet supported for FusedConv2D in the wasm backend.");const v=n.makeOutput([i.shape[0],l?i.shape[2]:i.shape[1],u?a.shape[1]:a.shape[2]],i.dtype),y=n.dataIdMap.get(v.dataId).id,b=new Uint8Array(new Int32Array(i.shape).buffer),x=new Uint8Array(new Int32Array(a.shape).buffer);return FWe(h,b,i.shape.length,f,x,a.shape.length,l,u,g,p,m,d||0,y),v}};function PWe(e){let t;return{kernelName:e,backendName:"wasm",setupFunc:function(n){t=n.wasm.cwrap(e,null,["number","number"])},kernelFunc:function(e){const{backend:n,inputs:{x:r}}=e,i=n.dataIdMap.get(r.dataId).id,a=n.makeOutput(r.shape,r.dtype),o=n.dataIdMap.get(a.dataId).id;return 0===w.sizeFromShape(a.shape)||t(i,o),a}}}const LWe=PWe(Sse);function BWe(e,t,n){let r;return{kernelName:e,backendName:"wasm",setupFunc:function(t){r=t.wasm.cwrap(e,null,["number","array","number","number","array","number","number","number"])},kernelFunc:function(i){const{backend:a,inputs:o}=i,{a:s,b:l}=o,u=a.dataIdMap.get(s.dataId).id,c=a.dataIdMap.get(l.dataId).id,d=null!=n?n:s.dtype,h=j.assertAndGetBroadcastShape(s.shape,l.shape),f=a.makeOutput(h,d);if(0===w.sizeFromShape(h))return f;const p=new Uint8Array(new Int32Array(s.shape).buffer),m=new Uint8Array(new Int32Array(l.shape).buffer),g=a.dataIdMap.get(f.dataId).id,v=()=>r(u,p,s.shape.length,c,m,l.shape.length,NWe[s.dtype],g);if(t&&"float32"===s.dtype)return v(),f;const y=j.getBroadcastDims(s.shape,h),b=j.getBroadcastDims(l.shape,h),x=y.every((e,t)=>e===t),_=b.every((e,t)=>e===t);if(x&&_)return v(),f;throw new Error(`Broadcasting along outer dims is not yet supported for ${s.dtype} ${e}.`)}}}const $We=BWe(Ise,!0);let zWe;const UWe={kernelName:Ase,backendName:"wasm",setupFunc:function(e){zWe=e.wasm.cwrap(Ase,null,["array","number","number","number"])},kernelFunc:function(e){const{inputs:t,backend:n}=e,r=n.makeOutput(t[0].shape,t[0].dtype);if(0===w.sizeFromShape(r.shape))return r;const i=t.map(e=>n.dataIdMap.get(e.dataId).id),a=new Uint8Array(new Int32Array(i).buffer),o=n.dataIdMap.get(r.dataId).id;return zWe(a,i.length,NWe[r.dtype],o),r}};function HWe(e){const{inputs:{x:t},backend:n}=e,r=n.makeOutput(t.shape,t.dtype),i=n.typedArrayFromHeap(t);return n.typedArrayFromHeap(r).set(i),r}const WWe={kernelName:Rle,backendName:"wasm",kernelFunc:HWe};let VWe;function qWe(e){const{inputs:t,backend:n,attrs:r}=e,[i,a]=function(e,t){const n=[],r=[];for(let i=0;i<e.length;++i)1!==e[i]&&n.push(e[i]),1!==e[t[i]]&&r.push(t[i]);for(let i=0;i<r.length;++i){let e=-1;for(let t=0;t<r.length;++t)r[t]>=i&&(-1===e||r[e]>r[t])&&(e=t);r[e]=i}return[n,r]}(t.x.shape,r.perm);let o=!0;for(let p=0;p<a.length;p++)a[p]!==p&&(o=!1);const s=function(e,t){const n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];return n}(t.x.shape,r.perm),l={dataId:t.x.dataId,shape:i,dtype:t.x.dtype};if(o){const e=HWe({inputs:t,backend:n});return e.shape=s,e}const u=n.makeOutput(s,l.dtype),c=n.dataIdMap.get(l.dataId).id,d=n.dataIdMap.get(u.dataId).id,h=new Uint8Array(new Int32Array(a).buffer),f=new Uint8Array(new Int32Array(l.shape).buffer);return VWe(c,f,l.shape.length,NWe[l.dtype],d,h,a.length),u}const GWe={kernelName:uce,backendName:"wasm",kernelFunc:qWe,setupFunc:function(e){VWe=e.wasm.cwrap(uce,null,["number","array","number","number","number","array","number"])}};function YWe(e,t,n){const r=e.shape,i=e.shape.length,a=w.parseAxisParam(t,r);let o=a;const s=j.getAxesPermutation(o,i);let l=null,u=!1;if(null!=s){const t=new Array(i);for(let e=0;e<t.length;e++)t[e]=r[s[e]];o=j.getInnerMostAxes(o.length,i),l=qWe({inputs:{x:e},attrs:{perm:s},backend:n});const a=n.dataIdMap.get(e.dataId).id;n.dataIdMap.get(l.dataId).id!==a&&(u=!0)}return{transposed:l,originalAxes:a,axes:o,inputWasTransposed:u}}let XWe;const KWe={kernelName:Mse,backendName:"wasm",kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{axis:i}=r,{x:a}=n,o=t.dataIdMap.get(a.dataId).id;let s=o,l=a;const{transposed:u,axes:c,inputWasTransposed:d}=YWe(a,i,t);if(d){const e=t.dataIdMap.get(u.dataId).id;e!==o&&(l=u,s=e)}const h=l.shape.slice(0,-1),f=t.makeOutput(h,"int32"),p=t.dataIdMap.get(f.dataId).id,m=w.sizeFromShape(f.shape);return XWe(s,NWe[l.dtype],m,l.shape[c[0]],p),d&&t.disposeData(u.dataId),f},setupFunc:function(e){XWe=e.wasm.cwrap(Mse,null,["number","number","number","number","number"])}};let ZWe;const JWe={kernelName:Bse,backendName:"wasm",setupFunc:function(e){ZWe=e.wasm.cwrap(Bse,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,i=t.x,a=r.dataIdMap.get(i.dataId).id,{filterSize:o,strides:s,pad:l,dimRoundingMode:u}=n,c=j.computePool2DInfo(i.shape,o,s,1,l,u),d=c.filterHeight,h=c.filterWidth,f=c.padInfo.top,p=c.padInfo.right,m=c.padInfo.bottom,g=c.padInfo.left,v=c.strideHeight,y=c.strideWidth,b=c.inChannels;if("channelsLast"!==c.dataFormat)throw new Error("wasm backend does not support dataFormat:'"+c.dataFormat+"'. Please use 'channelsLast'.");if(1!==c.dilationWidth||1!==c.dilationHeight)throw new Error(`was backend only supports average pooling with dilation = [1, 1], got [${c.dilationHeight}, ${c.dilationWidth}].`);const x=r.makeOutput(c.outShape,"float32"),w=r.dataIdMap.get(x.dataId).id;return ZWe(a,i.shape[0],i.shape[1],i.shape[2],d,h,f,p,m,g,v,y,b,w),x}};function QWe(e){const{inputs:t,attrs:n}=e,{x:r}=t,{shape:i}=n,a=w.sizeFromShape(r.shape),o=w.inferFromImplicitShape(i,a);return w.assert(a===w.sizeFromShape(o),()=>`new shape: ${o}, old shape: ${r.shape}. New shape and old shape must have the same number of elements.`),{dataId:r.dataId,shape:o,dtype:r.dtype}}const eVe={kernelName:Due,backendName:"wasm",kernelFunc:QWe};let tVe;const nVe={kernelName:Hse,backendName:"wasm",setupFunc:function(e){tVe=e.wasm.cwrap(Hse,null,["number","array","number","number","array","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:a}=t,{transposeA:o,transposeB:s}=r;if("float32"!==i.dtype||"float32"!==a.dtype)throw new Error("BatchMatMul for non non-float32 tensors not yet supported.");const l=i.shape.length,u=a.shape.length,c=o?i.shape[l-2]:i.shape[l-1],d=s?a.shape[u-1]:a.shape[u-2],h=o?i.shape[l-1]:i.shape[l-2],f=s?a.shape[u-2]:a.shape[u-1],p=i.shape.slice(0,-2),m=a.shape.slice(0,-2),g=w.sizeFromShape(p),v=w.sizeFromShape(m);w.assert(l>=2&&u>=2&&(g===v||1===g||1===v),()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${p}) and (${m}).`);const y=(g>v?i.shape.slice(0,-2):a.shape.slice(0,-2)).concat([h,f]);w.assert(c===d,()=>`Error in matMul: inner shapes (${c}) and (${d}) of Tensors with shapes ${i.shape} and ${a.shape} and transposeA=${o} and transposeB=${s} must match.`);const b=s?[v,f,d]:[v,d,f],x=QWe({inputs:{x:i},backend:n,attrs:{shape:o?[g,c,h]:[g,h,c]}}),_=QWe({inputs:{x:a},backend:n,attrs:{shape:b}}),k=n.dataIdMap.get(x.dataId).id,E=n.dataIdMap.get(_.dataId).id,S=o?x.shape[2]:x.shape[1],T=s?_.shape[1]:_.shape[2],C=Math.max(g,v),I=n.makeOutput([C,S,T],x.dtype),A=n.dataIdMap.get(I.dataId).id,O=new Uint8Array(new Int32Array(x.shape).buffer),D=new Uint8Array(new Int32Array(_.shape).buffer);return tVe(k,O,x.shape.length,E,D,_.shape.length,o,s,A),I.shape=y,I}};function rVe(e){const{inputs:{x:t},attrs:{dtype:n},backend:r}=e,i=r.makeOutput(t.shape,n),a=r.typedArrayFromHeap(t);return r.typedArrayFromHeap(i).set(a),i}const iVe={kernelName:Gse,backendName:"wasm",kernelFunc:rVe};let aVe;const oVe={kernelName:Xse,backendName:"wasm",setupFunc:function(e){aVe=e.wasm.cwrap(Xse,null,["number","number","number","number"])},kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{clipValueMin:a,clipValueMax:o}=r,s=n.dataIdMap.get(i.dataId).id,l=n.makeOutput(i.shape,i.dtype),u=n.dataIdMap.get(l.dataId).id;return aVe(s,a,o,u),l}};function sVe(e){const{inputs:t,backend:n}=e,r=w.parseAxisParam(e.attrs.axis,t[0].shape)[0];let i=j.computeOutShape(t.map(e=>e.shape),r);const a=t.filter(e=>w.sizeFromShape(e.shape)>0);if(1===a.length)return HWe({inputs:{x:a[0]},backend:n});const o=n.makeOutput(i,t[0].dtype);if(0===w.sizeFromShape(i))return o;const s=a.map(e=>e.shape);if(j.assertParamsConsistent(s,r),"string"===a[0].dtype){const e=a.map(e=>{const t=w.sizeFromShape(e.shape.slice(r));return QWe({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})}),s=e.map(e=>({vals:n.readSync(e.dataId),shape:e.shape}));i=j.computeOutShape(e.map(e=>e.shape),1);const l=NMe(s,i,t[0].dtype,1===e[0].shape[0]),u=j.computeOutShape(a.map(e=>e.shape),r);return o.shape=u,n.dataIdMap.get(o.dataId).stringBytes=j.fromStringArrayToUint8(l),o}const l=w.sizeFromShape(a[0].shape.slice(0,r));let u=0;const c=a.map(e=>{const t=w.sizeFromShape(e.shape.slice(r));return u+=t,t}),d=a.map(e=>n.typedArrayFromHeap(e)),h=n.typedArrayFromHeap(o);for(let f=0;f<l;f++){let e=f*u;for(let t=0;t<d.length;t++){const n=c[t],r=f*n,i=d[t].subarray(r,r+n);h.set(i,e),e+=n}}return o}const lVe={kernelName:Jse,backendName:"wasm",kernelFunc:sVe};let uVe;const cVe={kernelName:Qse,backendName:"wasm",setupFunc:function(e){uVe=e.wasm.cwrap(Qse,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{x:i,filter:a}=t,o=r.dataIdMap.get(i.dataId).id,s=r.dataIdMap.get(a.dataId).id,{strides:l,dilations:u,pad:c,dimRoundingMode:d,dataFormat:h}=n,f=j.convertConv2DDataFormat(h),p=j.computeConv2DInfo(i.shape,a.shape,l,u,c,d,!1,f),m=p.filterHeight,g=p.filterWidth,v=p.padInfo.top,y=p.padInfo.right,b=p.padInfo.bottom,x=p.padInfo.left,w=p.dilationHeight,_=p.dilationWidth,k=p.strideHeight,E=p.strideWidth,S=p.inChannels,T=p.outChannels,C="SAME"===p.padInfo.type?1:0;if("channelsLast"!==p.dataFormat)throw new Error("wasm backend Conv2D does not support dataFormat:'"+p.dataFormat+"'. Please use 'channelsLast'.");const I=r.makeOutput(p.outShape,"float32"),A=r.dataIdMap.get(I.dataId).id;return uVe(o,i.shape[0],i.shape[1],i.shape[2],s,m,g,v,y,b,x,C,w,_,k,E,S,T,A),I}};let dVe;const hVe={kernelName:tle,backendName:"wasm",setupFunc:function(e){dVe=e.wasm.cwrap(tle,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{dy:i,filter:a}=n,{strides:o,pad:s,dataFormat:l,dimRoundingMode:u,inputShape:c}=r,d=j.convertConv2DDataFormat(l),h=j.computeConv2DInfo(c,a.shape,o,1,s,u,!1,d),{batchSize:f,filterHeight:p,filterWidth:m,inChannels:g,inHeight:v,inWidth:y,outChannels:b,outHeight:x,outWidth:_,strideHeight:k,strideWidth:E}=h,S=p-1-h.padInfo.top,T=m-1-h.padInfo.left,C="channelsLast"===h.dataFormat,I=w.computeStrides(h.inShape),A=w.computeStrides(i.shape),[O,D,M]=w.computeStrides(a.shape),N=I[0],F=C?I[1]:I[2],R=C?I[2]:1,P=C?1:I[1],L=A[0],B=C?A[1]:A[2],$=C?A[2]:1,z=C?1:A[1],U=t.makeOutput(h.inShape,"float32"),H=t.dataIdMap.get(U.dataId).id,W=t.dataIdMap.get(i.dataId).id,V=t.dataIdMap.get(a.dataId).id;return dVe(W,V,f,p,m,v,y,g,x,_,b,k,E,S,T,O,D,M,N,F,R,P,L,B,$,z,H),U}},fVe=PWe(ale);var pVe;let mVe,gVe,vVe,yVe,bVe,xVe,wVe,_Ve,kVe,EVe,SVe,TVe,CVe,IVe,AVe,OVe,DVe,MVe,NVe,jVe,FVe,RVe,PVe,LVe,BVe,$Ve,zVe,UVe,HVe,WVe,VVe,qVe,GVe;function YVe(e){const{inputs:t,attrs:n,backend:r}=e,{input:i}=t,{dim:a}=n,o=i.shape.length,s=i.shape.slice();let l=a;return a<0&&(w.assert(-(o+1)<=a,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+a+1),s.splice(l,0,1),QWe({inputs:{x:i},backend:r,attrs:{shape:s}})}function XVe(e,t){const n=new Int32Array(e.wasm.HEAPU8.buffer,t,4),r=n[0],i=n[1],a=n[2],o=n[3];return e.wasm._free(t),{pSelectedIndices:r,selectedSize:i,pSelectedScores:a,pValidOutputs:o}}function KVe(e){const{inputs:{x:t},attrs:{begin:n,size:r},backend:i}=e,[a,o]=A.parseSliceParams(t,n,r),s=A.isSliceContinous(t.shape,a,o),l=i.readSync(t.dataId),u=i.makeOutput(o,t.dtype),c=w.computeStrides(t.shape),d=i.dataIdMap.get(u.dataId);if(s){const e=A.computeFlatOffset(a,c);return"string"===t.dtype?d.stringBytes=l.slice(e,e+w.sizeFromShape(o)):i.typedArrayFromHeap(u).set(l.subarray(e,e+w.sizeFromShape(o))),u}if("string"===t.dtype){const e=bMe(l,a,o,t.shape,t.dtype);return d.stringBytes=e,u}const h=i.typedArrayFromHeap(u),f=t.shape.length;if(2===f)!function(e,t,n,r,i){let a=0;const o=r[0],s=r[1],l=o+i[0];for(let u=o;u<l;u++){const r=u*t+s;n.set(e.subarray(r,r+i[1]),a),a+=i[1]}}(l,c[0],h,a,o);else if(3===f)!function(e,t,n,r,i,a){let o=0;const s=i[0],l=i[1],u=i[2],c=s+a[0],d=l+a[1];for(let h=s;h<c;h++)for(let i=l;i<d;i++){const s=h*t+i*n+u;r.set(e.subarray(s,s+a[2]),o),o+=a[2]}}(l,c[0],c[1],h,a,o);else if(4===f)!function(e,t,n,r,i,a,o){let s=0;const l=a[0],u=a[1],c=a[2],d=l+o[0],h=u+o[1],f=c+o[2],p=a[3];for(let m=l;m<d;m++)for(let a=u;a<h;a++)for(let l=c;l<f;l++){const u=m*t+a*n+l*r+p;i.set(e.subarray(u,u+o[3]),s),s+=o[3]}}(l,c[0],c[1],c[2],h,a,o);else{const e=bMe(l,a,o,t.shape,t.dtype);h.set(e)}return u}!function(e){e[e.bilinear=0]="bilinear",e[e.nearest=1]="nearest"}(pVe||(pVe={}));const ZVe=[LWe,$We,UWe,KWe,JWe,nVe,iVe,oVe,lVe,cVe,hVe,fVe,{kernelName:lle,backendName:"wasm",setupFunc:function(e){mVe=e.wasm.cwrap(lle,null,["number","number","number","number","array","number","number","number","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{method:i,extrapolationValue:a,cropSize:o}=r,{image:s,boxes:l,boxInd:u}=n,c=l.shape[0],[d,h]=o,f=[c,d,h,s.shape[3]];let p,m=t.dataIdMap.get(s.dataId);"float32"!==s.dtype&&(p=rVe({backend:t,inputs:{x:s},attrs:{dtype:"float32"}}),m=t.dataIdMap.get(p.dataId));const g=m.id,v=t.dataIdMap.get(l.dataId).id,y=t.dataIdMap.get(u.dataId).id,b=t.makeOutput(f,"float32"),x=t.dataIdMap.get(b.dataId).id,w=new Uint8Array(new Int32Array(s.shape).buffer);return mVe(g,v,y,c,w,d,h,pVe[i],a,x),null!=p&&t.disposeData(p.dataId),b}},{kernelName:sle,backendName:"wasm",setupFunc:function(e){gVe=e.wasm.cwrap(sle,null,["number","number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,exclusive:o,reverse:s}=r,l=i.shape.length;w.assert("float32"===i.dtype||"int32"===i.dtype,()=>`cumsum does not support ${i.dtype} tensors in the WASM backend`);const u=j.getAxesPermutation([a],l);let c=i;null!==u&&(c=qWe({inputs:{x:i},attrs:{perm:u},backend:n}));const d=j.getInnerMostAxes(1,l)[0];j.assertAxesAreInnerMostDims("cumsum",[d],l);const h=n.makeOutput(c.shape,c.dtype),f=c.shape[d],p=n.dataIdMap.get(c.dataId).id,m=n.dataIdMap.get(h.dataId).id;gVe(p,o?1:0,s?1:0,f,m,NWe[i.dtype]);let g=h;return null!==u&&(g=qWe({inputs:{x:h},attrs:{perm:j.getUndoAxesPermutation(u)},backend:n}),n.disposeData(c.dataId),n.disposeData(h.dataId)),g}},{kernelName:cle,backendName:"wasm",setupFunc:function(e){vVe=e.wasm.cwrap(cle,null,["number","number","number","array","number","array","array","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{x:i}=n,{blockSize:a,dataFormat:o}=r;w.assert(a>1,()=>"blockSize should be > 1 for depthToSpace, but was: "+a);const s=i.shape[0],l=("NHWC"===o?i.shape[1]:i.shape[2])*a,u=("NHWC"===o?i.shape[2]:i.shape[3])*a,c=("NHWC"===o?i.shape[3]:i.shape[1])/(a*a),d="NHWC"===o?[s,l,u,c]:[s,c,l,u],h=t.makeOutput(d,"float32"),f=t.dataIdMap.get(i.dataId).id,p=new Uint8Array(new Int32Array(w.computeStrides(i.shape)).buffer),m=new Uint8Array(new Int32Array(d).buffer),g=new Uint8Array(new Int32Array(w.computeStrides(d)).buffer),v=t.dataIdMap.get(h.dataId).id;return vVe(f,a,"NHWC"===o?1:0,p,i.shape.length-1,m,g,d.length,v),h}},{kernelName:dle,backendName:"wasm",setupFunc:function(e){yVe=e.wasm.cwrap(dle,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{x:i,filter:a}=t,o=r.dataIdMap.get(i.dataId).id,s=r.dataIdMap.get(a.dataId).id,{strides:l,dilations:u,pad:c,dimRoundingMode:d}=n,h=j.computeConv2DInfo(i.shape,a.shape,l,null==u?[1,1]:u,c,d,!0),f=h.filterHeight,p=h.filterWidth,m=h.padInfo.top,g=h.padInfo.right,v=h.padInfo.bottom,y=h.padInfo.left,b=h.dilationHeight,x=h.dilationWidth,w=h.strideHeight,_=h.strideWidth,k=h.inChannels,E=h.outChannels,S="SAME"===h.padInfo.type?1:0;if("channelsLast"!==h.dataFormat)throw new Error("wasm backend DepthwiseConv2dNative does not support dataFormat:'"+h.dataFormat+"'. Please use 'channelsLast'.");const T=r.makeOutput(h.outShape,"float32"),C=r.dataIdMap.get(T.dataId).id;return yVe(o,i.shape[0],i.shape[1],i.shape[2],s,f,p,m,g,v,y,S,b,x,w,_,k,E,C),T}},BWe(_le,!1,"bool"),PWe(kle),{kernelName:Ele,backendName:"wasm",kernelFunc:YVe},{kernelName:Cle,backendName:"wasm",kernelFunc:function(e){const{attrs:{shape:t,value:n,dtype:r},backend:i}=e,a=i.makeOutput(t,r);return i.typedArrayFromHeap(a).fill(n),a}},{kernelName:Ile,backendName:"wasm",kernelFunc:function(e){const{inputs:t,backend:n}=e,{image:r}=t,i=n.makeOutput(r.shape,r.dtype),a=n.dataIdMap.get(r.dataId).id,o=n.dataIdMap.get(i.dataId).id,[s,l,u,c]=r.shape;return bVe(a,s,l,u,c,o),i},setupFunc:function(e){bVe=e.wasm.cwrap(Ile,null,["number","number","number","number","number","number"])}},PWe(Ale),BWe(Ole,!1),RWe,{kernelName:Dle,backendName:"wasm",setupFunc:function(e){xVe=e.wasm.cwrap(Dle,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{varianceEpsilon:i}=r,{x:a,mean:o,variance:s,offset:l,scale:u}=n,c=t.dataIdMap.get(a.dataId).id,d=t.dataIdMap.get(o.dataId).id,h=t.dataIdMap.get(s.dataId).id,f=null!=l?t.dataIdMap.get(l.dataId).id:0,p=null!=u?t.dataIdMap.get(u.dataId).id:0,m=t.makeOutput(a.shape,a.dtype);if(0===w.sizeFromShape(a.shape))return m;const g=t.dataIdMap.get(m.dataId).id;return xVe(c,d,h,f,p,i,g),m}},{kernelName:yce,backendName:"wasm",setupFunc:function(e){wVe=e.wasm.cwrap(yce,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{x:i,filter:a,bias:o,preluActivationWeights:s}=t,{strides:l,pad:u,dilations:c,dataFormat:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=n,m=j.computeConv2DInfo(i.shape,a.shape,l,c,u,h),g=jWe[f];if(null==g)throw new Error(f+" activation not yet supported for FusedConv2D in the wasm backend.");const v=r.dataIdMap.get(i.dataId).id,y=r.dataIdMap.get(a.dataId).id,b=m.outChannels;let x=0;if(null!=o){const e=r.dataIdMap.get(o.dataId);if(1!==e.shape.length)throw new Error(`FusedConv2D only supports rank-1 bias but got rank ${e.shape.length}.`);if(e.shape[0]!==b)throw new Error(`FusedConv2D bias shape (${e.shape}) does not match the number of output channels (${b})`);x=e.id}const w=m.filterHeight,_=m.filterWidth,k=m.padInfo.top,E=m.padInfo.right,S=m.padInfo.bottom,T=m.padInfo.left,C=m.dilationHeight,I=m.dilationWidth,A=m.strideHeight,O=m.strideWidth,D=m.inChannels,M="SAME"===m.padInfo.type?1:0,N=m.batchSize,F=m.inHeight,R=m.inWidth;if("NHWC"!==d)throw new Error("wasm backend FusedConv2D does not support dataFormat:'"+d+"'. Please use 'NHWC'.");const P=r.makeOutput(m.outShape,"float32"),L=r.dataIdMap.get(P.dataId).id,B=null==s?0:r.dataIdMap.get(s.dataId).id;return wVe(v,N,F,R,y,w,_,x,k,E,S,T,M,C,I,A,O,D,b,g,B,p||0,L),P}},{kernelName:bce,backendName:"wasm",setupFunc:function(e){_Ve=e.wasm.cwrap(bce,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{x:i,filter:a,bias:o,preluActivationWeights:s}=t,{strides:l,pad:u,dilations:c,dataFormat:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=n,m=j.computeConv2DInfo(i.shape,a.shape,l,c,u,h,!0),g=jWe[f];if(null==g)throw new Error(f+" activation not yet supported for FusedDepthwiseConv2D in the wasm backend.");const v=r.dataIdMap.get(i.dataId).id,y=r.dataIdMap.get(a.dataId).id,b=m.outChannels;let x=0;if(null!=o){const e=r.dataIdMap.get(o.dataId);if(1!==e.shape.length)throw new Error(`FusedDepthwiseConv2D only supports rank-1 bias but got rank ${e.shape.length}.`);if(e.shape[0]!==b)throw new Error(`FusedDepthwiseConv2D bias shape (${e.shape}) does not match the number of output channels (${b})`);x=e.id}const w=m.filterHeight,_=m.filterWidth,k=m.padInfo.top,E=m.padInfo.right,S=m.padInfo.bottom,T=m.padInfo.left,C=m.dilationHeight,I=m.dilationWidth,A=m.strideHeight,O=m.strideWidth,D=m.inChannels,M="SAME"===m.padInfo.type?1:0,N=m.batchSize,F=m.inHeight,R=m.inWidth;if("NHWC"!==d)throw new Error("wasm backend FusedDepthwiseConv2D does not support dataFormat:'"+d+"'. Please use 'NHWC'.");const P=r.makeOutput(m.outShape,"float32"),L=r.dataIdMap.get(P.dataId).id,B=null==s?0:r.dataIdMap.get(s.dataId).id;return _Ve(v,N,F,R,y,w,_,x,k,E,S,T,M,C,I,A,O,D,b,g,B,p||0,L),P}},{kernelName:Nle,backendName:"wasm",setupFunc:function(e){kVe=e.wasm.cwrap(Nle,null,["number","number","number","number","number","number","array","number"])},kernelFunc:function(e){const{backend:t,inputs:n}=e,{params:r,indices:i}=n,[a,o,s,l]=C.prepareAndValidate(r,i),u=t.makeOutput(a,r.dtype);if(0===o)return u;const c=i.shape,d=c[c.length-1],h=t.dataIdMap.get(r.dataId).id,f=t.dataIdMap.get(i.dataId).id,p=new Uint8Array(new Int32Array(l).buffer),m=t.dataIdMap.get(u.dataId).id;return kVe(h,NWe[r.dtype],f,o,d,s,p,m),u}},{kernelName:Mle,backendName:"wasm",setupFunc:function(e){EVe=e.wasm.cwrap("Gather",null,["number","number","array","number","number","number","array","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{x:i,indices:a}=n,{axis:o,batchDims:s}=r,l=w.parseAxisParam(o,i.shape)[0],u=j.segment_util.collectGatherOpShapeInfo(i,a,l,s),c=QWe({inputs:{x:i},attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]},backend:t}),d=w.sizeFromShape(a.shape),h=QWe({inputs:{x:a},attrs:{shape:[u.batchSize,d/u.batchSize]},backend:t}),f=[u.batchSize,u.outerSize,d/u.batchSize,u.sliceSize],p=t.makeOutput(f,i.dtype);if(0===w.sizeFromShape(i.shape))return p;const m=c.shape.length-1,g=t.dataIdMap.get(c.dataId).id,v=t.dataIdMap.get(h.dataId).id,y=t.dataIdMap.get(p.dataId).id,b=new Uint8Array(new Int32Array(w.computeStrides(c.shape)).buffer),x=new Uint8Array(new Int32Array(w.computeStrides(f)).buffer);return EVe(g,NWe[i.dtype],b,m,v,u.batchSize,x,y),p.shape=u.outputShape,p}},BWe(jle,!1,"bool"),BWe(Fle,!1,"bool"),WWe,{kernelName:Ule,backendName:"wasm",setupFunc:function(e){SVe=e.wasm.cwrap(Ule,null,["number","number","number"])},kernelFunc:function(e){const{inputs:{x:t},attrs:{alpha:n},backend:r}=e,i=r.dataIdMap.get(t.dataId).id,a=r.makeOutput(t.shape,t.dtype);if(0!==w.sizeFromShape(t.shape)){const e=r.dataIdMap.get(a.dataId).id;SVe(i,n,e)}return a}},BWe(Hle,!1,"bool"),BWe(Wle,!1,"bool"),PWe(qle),BWe(Yle,!1,"bool"),{kernelName:eue,backendName:"wasm",setupFunc:function(e){TVe=e.wasm.cwrap(eue,null,["number, number, number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{reductionIndices:i,keepDims:a}=r,{x:o}=n;let s=t.dataIdMap.get(o.dataId).id,l=o;const{transposed:u,axes:c,originalAxes:d,inputWasTransposed:h}=YWe(o,i,t);h&&(l=u,s=t.dataIdMap.get(u.dataId).id),j.assertAxesAreInnerMostDims("max",c,l.shape.length);const[f,p]=j.computeOutAndReduceShapes(l.shape,c),m=w.sizeFromShape(p),g=t.makeOutput(f,o.dtype);if(0!==w.sizeFromShape(l.shape)){const e=t.dataIdMap.get(g.dataId).id;TVe(s,m,e)}if(h&&t.disposeData(u.dataId),a){const e=j.expandShapeToKeepDim(g.shape,d);g.shape=e}return g}},BWe(tue,!1),{kernelName:nue,backendName:"wasm",setupFunc:function(e){CVe=e.wasm.cwrap(nue,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,i=t.x,a=r.dataIdMap.get(i.dataId).id,{filterSize:o,strides:s,pad:l,dimRoundingMode:u}=n,c=j.computePool2DInfo(i.shape,o,s,1,l,u),d=c.filterHeight,h=c.filterWidth,f=c.padInfo.top,p=c.padInfo.right,m=c.padInfo.bottom,g=c.padInfo.left,v=c.dilationHeight,y=c.dilationWidth,b=c.strideHeight,x=c.strideWidth,w=c.inChannels,_=c.outChannels;if("channelsLast"!==c.dataFormat)throw new Error("wasm backend does not support dataFormat:'"+c.dataFormat+"'. Please use 'channelsLast'.");const k=r.makeOutput(c.outShape,"float32"),E=r.dataIdMap.get(k.dataId).id;return CVe(a,i.shape[0],i.shape[1],i.shape[2],d,h,f,p,m,g,v,y,b,x,w,_,E),k}},{kernelName:sue,backendName:"wasm",setupFunc:function(e){IVe=e.wasm.cwrap(sue,null,["number, number, number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{axis:i,keepDims:a}=r,{x:o}=n,s=t.dataIdMap.get(o.dataId).id;let l=s,u=o;const{transposed:c,axes:d,originalAxes:h,inputWasTransposed:f}=YWe(o,i,t);let p=d;if(f){const e=t.dataIdMap.get(c.dataId).id;e!==s&&(u=c,l=e,p=j.getInnerMostAxes(p.length,u.shape.length))}j.assertAxesAreInnerMostDims("mean",p,u.shape.length);const[m,g]=j.computeOutAndReduceShapes(u.shape,p),v=w.sizeFromShape(g);let y=u;"float32"!==u.dtype&&(y=rVe({backend:t,inputs:{x:u},attrs:{dtype:"float32"}}),l=t.dataIdMap.get(y.dataId).id);const b=t.makeOutput(m,"float32");if(0!==w.sizeFromShape(u.shape)){const e=t.dataIdMap.get(b.dataId).id;IVe(l,v,e)}if(f&&t.disposeData(c.dataId),a){const e=j.expandShapeToKeepDim(b.shape,h);b.shape=e}return"float32"!==u.dtype&&t.disposeData(y.dataId),b}},{kernelName:lue,backendName:"wasm",setupFunc:function(e){AVe=e.wasm.cwrap(lue,null,["number, number, number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{axis:i,keepDims:a}=r,{x:o}=n,s=t.dataIdMap.get(o.dataId).id;let l=s,u=o;const{transposed:c,axes:d,originalAxes:h,inputWasTransposed:f}=YWe(o,i,t);if(f){const e=t.dataIdMap.get(c.dataId).id;e!==s&&(u=c,l=e)}j.assertAxesAreInnerMostDims("min",d,u.shape.length);const[p,m]=j.computeOutAndReduceShapes(u.shape,d),g=w.sizeFromShape(m),v=t.makeOutput(p,u.dtype);if(0!==w.sizeFromShape(u.shape)){const e=t.dataIdMap.get(v.dataId).id;AVe(l,g,e)}if(f&&t.disposeData(c.dataId),a){const e=j.expandShapeToKeepDim(v.shape,h);v.shape=e}return v}},BWe(uue,!1),BWe(fue,!0),PWe(pue),{kernelName:gue,backendName:"wasm",setupFunc:function(e){OVe=e.wasm.cwrap(gue,"number",["number","number","number","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{iouThreshold:i,maxOutputSize:a,scoreThreshold:o}=r,{boxes:s,scores:l}=n,u=t.dataIdMap.get(s.dataId).id,c=t.dataIdMap.get(l.dataId).id,d=OVe(u,c,a,i,o),{pSelectedIndices:h,selectedSize:f,pSelectedScores:p,pValidOutputs:m}=XVe(t,d);return t.wasm._free(p),t.wasm._free(m),t.makeOutput([f],"int32",h)}},{kernelName:vue,backendName:"wasm",setupFunc:function(e){DVe=e.wasm.cwrap(vue,"number",["number","number","number","number","number","bool"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{iouThreshold:i,maxOutputSize:a,scoreThreshold:o,padToMaxOutputSize:s}=r,{boxes:l,scores:u}=n,c=t.dataIdMap.get(l.dataId).id,d=t.dataIdMap.get(u.dataId).id,h=DVe(c,d,a,i,o,s),{pSelectedIndices:f,selectedSize:p,pSelectedScores:m,pValidOutputs:g}=XVe(t,h);return t.wasm._free(m),[t.makeOutput([p],"int32",f),t.makeOutput([],"int32",g)]}},{kernelName:yue,backendName:"wasm",setupFunc:function(e){MVe=e.wasm.cwrap(yue,"number",["number","number","number","number","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{iouThreshold:i,maxOutputSize:a,scoreThreshold:o,softNmsSigma:s}=r,{boxes:l,scores:u}=n,c=t.dataIdMap.get(l.dataId).id,d=t.dataIdMap.get(u.dataId).id,h=MVe(c,d,a,i,o,s),{pSelectedIndices:f,selectedSize:p,pSelectedScores:m,pValidOutputs:g}=XVe(t,h);return t.wasm._free(g),[t.makeOutput([p],"int32",f),t.makeOutput([p],"float32",m)]}},BWe(mue,!1,"bool"),{kernelName:xue,backendName:"wasm",setupFunc:function(e){NVe=e.wasm.cwrap(xue,null,["number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i}=t,{depth:a,onValue:o,offValue:s}=r,l=n.makeOutput([...i.shape,a],"int32"),u=n.dataIdMap.get(l.dataId).id,c=n.dataIdMap.get(i.dataId);return NVe(c.id,a,o,s,u),l}},{kernelName:bue,backendName:"wasm",kernelFunc:function(e){const{inputs:{x:t},backend:n}=e,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(1),r}},{kernelName:wue,backendName:"wasm",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r;if(1===t.length)return YVe({inputs:{input:t[0]},backend:n,attrs:{dim:i}});const a=t[0].shape,o=t[0].dtype;return t.forEach(e=>{w.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),w.assert(o===e.dtype,()=>"All tensors passed to stack must have matching dtypes")}),sVe({inputs:t.map(e=>YVe({inputs:{input:e},backend:n,attrs:{dim:i}})),backend:n,attrs:{axis:i}})}},{kernelName:_ue,backendName:"wasm",kernelFunc:function(e){const{inputs:{x:t},backend:n,attrs:{paddings:r,constantValue:i}}=e,a=r.map((e,n)=>e[0]+t.shape[n]+e[1]),o=n.dataIdMap.get(t.dataId).id,s=n.makeOutput(a,t.dtype),l=n.dataIdMap.get(s.dataId).id,u=new Uint8Array(new Int32Array(t.shape).buffer),c=r.map(e=>e[0]),d=r.map(e=>e[1]),h=new Uint8Array(new Int32Array(c).buffer),f=new Uint8Array(new Int32Array(d).buffer);return jVe(o,u,t.shape.length,NWe[t.dtype],h,f,i,l),s},setupFunc:function(e){jVe=e.wasm.cwrap(_ue,null,["number","array","number","number","array","array","number","number"])}},BWe(Eue,!1),{kernelName:Sue,backendName:"wasm",setupFunc:function(e){FVe=e.wasm.cwrap(Sue,null,["number","number","number"])},kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r,alpha:i}=t,a=n.dataIdMap.get(r.dataId).id,o=n.dataIdMap.get(i.dataId).id,s=n.makeOutput(r.shape,"float32"),l=n.dataIdMap.get(s.dataId).id;return FVe(a,o,l),s}},{kernelName:Tue,backendName:"wasm",setupFunc:function(e){RVe=e.wasm.cwrap(Tue,null,["number","number","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{axis:i,keepDims:a}=r,{x:o}=n,s=t.dataIdMap.get(o.dataId).id;let l=s,u=o;const{transposed:c,axes:d,originalAxes:h,inputWasTransposed:f}=YWe(o,i,t);let p=d;if(f){const e=t.dataIdMap.get(c.dataId).id;e!==s&&(u=c,l=e,p=j.getInnerMostAxes(p.length,u.shape.length))}j.assertAxesAreInnerMostDims("prod",p,u.shape.length);const[m,g]=j.computeOutAndReduceShapes(u.shape,p),v=w.sizeFromShape(g),y=t.makeOutput(m,u.dtype);if(0!==w.sizeFromShape(u.shape)){const e=t.dataIdMap.get(y.dataId).id;RVe(l,v,NWe[y.dtype],e)}if(f&&t.disposeData(c.dataId),a){const e=j.expandShapeToKeepDim(y.shape,h);y.shape=e}return y}},{kernelName:Cue,backendName:"wasm",kernelFunc:e=>{const{backend:t,attrs:n}=e,{start:r,stop:i,step:a,dtype:o}=n,s=DFe(r,i,a,o),l=t.makeOutput([s.length],o);return t.typedArrayFromHeap(l).set(s),l}},BWe(yle,!0),PWe(Oue),PWe(Rue),eVe,{kernelName:jue,backendName:"wasm",setupFunc:function(e){PVe=e.wasm.cwrap(jue,null,["number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{images:i}=n,{alignCorners:a,halfPixelCenters:o,size:s}=r,[l,u]=s,[c,d,h,f]=i.shape,p=[c,l,u,f];let m,g=t.dataIdMap.get(i.dataId);"float32"!==g.dtype&&(m=rVe({backend:t,inputs:{x:i},attrs:{dtype:"float32"}}),g=t.dataIdMap.get(m.dataId));const v=g.id,y=t.makeOutput(p,"float32");if(0===w.sizeFromShape(i.shape))return y;const b=t.dataIdMap.get(y.dataId).id;return PVe(v,c,d,h,f,l,u,a?1:0,o?1:0,b),null!=m&&t.disposeData(m.dataId),y}},{kernelName:Pue,backendName:"wasm",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dims:a}=r,o=w.parseAxisParam(a,i.shape);if(0===i.shape.length)return HWe({inputs:{x:i},backend:n});const s=n.makeOutput(i.shape,i.dtype),l=n.dataIdMap.get(i.dataId).id,u=n.dataIdMap.get(s.dataId).id,c=new Uint8Array(new Int32Array(o).buffer),d=new Uint8Array(new Int32Array(i.shape).buffer);return LVe(l,c,o.length,d,i.shape.length,u),QWe({inputs:{x:s},attrs:{shape:i.shape},backend:n})},setupFunc:function(e){LVe=e.wasm.cwrap(Pue,null,["number","array","number","array","number","number"])}},{kernelName:gce,backendName:"wasm",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:i}=t,{radians:a,fillValue:o,center:s}=r,l=n.makeOutput(i.shape,i.dtype),u=n.dataIdMap.get(i.dataId).id,c=n.dataIdMap.get(l.dataId).id,[d,h,f,p]=i.shape,[m,g]=j.getImageCenter(s,h,f),v="number"==typeof o?[o,o,o,0===o?0:255]:[...o,255],y=new Uint8Array(new Int32Array(v).buffer);return BVe(u,d,h,f,p,a,m,g,y,v.length,c),l},setupFunc:function(e){BVe=e.wasm.cwrap(gce,null,["number","number","number","number","number","number","number","number","array","number","number"])}},PWe(Bue),{kernelName:$ue,backendName:"wasm",setupFunc:function(e){$Ve=e.wasm.cwrap($ue,null,["number","number","number","number","number","number","array","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{indices:i,updates:a}=n,{shape:o}=r,s=t.makeOutput(o,a.dtype);if(0===w.sizeFromShape(o))return s;const{sliceRank:l,numUpdates:u,sliceSize:c,strides:d,outputSize:h}=I.calculateShapes(a,i,o),f=t.dataIdMap.get(i.dataId).id,p=t.dataIdMap.get(a.dataId).id,m=new Uint8Array(new Int32Array(d).buffer),g=t.dataIdMap.get(s.dataId).id;return $Ve(f,p,NWe[a.dtype],l,u,c,m,h,g),s}},{kernelName:zue,backendName:"wasm",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:r,t:i,e:a}=t,o=n.dataIdMap.get(r.dataId).id,s=n.dataIdMap.get(i.dataId).id,l=n.dataIdMap.get(a.dataId).id,u=n.makeOutput(i.shape,i.dtype),c=n.dataIdMap.get(u.dataId).id,d=r.shape.length,h=0===d||d>1||1===i.shape.length?1:w.sizeFromShape(i.shape.slice(1));return zVe(o,s,l,h,c),u},setupFunc:function(e){zVe=e.wasm.cwrap("SelectV2",null,["number","number","number","number","number"])}},{kernelName:"Sigmoid",backendName:"wasm",setupFunc:function(e){UVe=e.wasm.cwrap(Gue,null,["number","number"])},kernelFunc:function(e){const{backend:t,inputs:{x:n}}=e,r=t.dataIdMap.get(n.dataId).id,i=t.makeOutput(n.shape,n.dtype),a=t.dataIdMap.get(i.dataId).id;return 0===w.sizeFromShape(i.shape)||UVe(r,a),i}},PWe(Wue),{kernelName:Hue,backendName:"wasm",kernelFunc:KVe},{kernelName:Que,backendName:"wasm",setupFunc:function(e){HVe=e.wasm.cwrap(Que,null,["number","number","number","number"])},kernelFunc:function(e){const{backend:t,inputs:{logits:n},attrs:{dim:r}}=e,i=t.dataIdMap.get(n.dataId).id,a=t.makeOutput(n.shape,n.dtype),o=t.dataIdMap.get(a.dataId).id,s=n.shape[r],l=w.sizeFromShape(n.shape)/s;return 0===w.sizeFromShape(a.shape)||HVe(i,o,s,l),a}},{kernelName:Jue,backendName:"wasm",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{x:i}=t,{numOrSizeSplits:a,axis:o}=n,s=w.parseAxisParam(o,i.shape)[0],l=j.prepareSplitSize(i,a,o),u=new Array(i.shape.length).fill(0),c=i.shape.slice();return l.map(e=>{const t=[...c];t[s]=e;const n=KVe({inputs:{x:i},attrs:{begin:u,size:t},backend:r});return u[s]+=e,n})}},PWe(Xue),PWe(tce),BWe(ece,!0),{kernelName:ice,backendName:"wasm",setupFunc:function(e){WVe=e.wasm.cwrap(ice,null,["number","array","number","array","array","array","array","array","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{x:i}=n;let{begin:a,end:o,strides:s}=r;null==s&&(s=new Array(a.length));const{beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:d,shrinkAxisMask:h}=r,f=j.slice_util.maskToAxes(c);if(f.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==c&&0!==d)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==c&&0!==h)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");const p=i.shape.length-a.length,m=j.slice_util.maskToAxes(d),g=i.shape.slice();m.forEach(e=>{a[e]=0,o[e]=1,g.splice(e,0,1)});const v=QWe({inputs:{x:i},attrs:{shape:g},backend:t}),{begin:y,end:b,strides:x}=j.slice_util.getNormalizedAxes(v.shape,f,p,a,o,s,l,u,c);a=y,o=b,s=x;const _=j.slice_util.maskToAxes(h);_.forEach(e=>{o[e]=a[e]+1,s[e]=1});const k=j.slice_util.computeOutShape(a,o,s),E=k.filter((e,t)=>-1===_.indexOf(t));if(s.every(e=>1===e))return QWe({inputs:{x:KVe({inputs:{x:i},attrs:{begin:a,size:k},backend:t})},attrs:{shape:E},backend:t});const S=t.makeOutput(E,"float32");if(!E.some(e=>0===e)){const e=t.dataIdMap.get(v.dataId).id,n=new Uint8Array(new Int32Array(w.computeStrides(v.shape)).buffer),r=new Uint8Array(new Int32Array(a).buffer),i=new Uint8Array(new Int32Array(o).buffer),l=new Uint8Array(new Int32Array(s).buffer),u=new Uint8Array(new Int32Array(E).buffer),c=new Uint8Array(new Int32Array(w.computeStrides(E)).buffer),d=t.dataIdMap.get(S.dataId).id;WVe(e,n,v.shape.length,r,i,l,u,c,E.length,d)}return QWe({inputs:{x:S},attrs:{shape:E},backend:t})}},BWe(nce,!0),{kernelName:Kue,backendName:"wasm",setupFunc:function(e){VVe=e.wasm.cwrap(Kue,null,["number, number, number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{axis:i,keepDims:a}=r,{x:o}=n,s=t.dataIdMap.get(o.dataId).id;let l=s,u=o;const{transposed:c,axes:d,originalAxes:h,inputWasTransposed:f}=YWe(o,i,t);let p=d;if(f){const e=t.dataIdMap.get(c.dataId).id;e!==s&&(u=c,l=e,p=j.getInnerMostAxes(p.length,u.shape.length))}j.assertAxesAreInnerMostDims("sum",p,u.shape.length);const[m,g]=j.computeOutAndReduceShapes(u.shape,p),v=w.sizeFromShape(g),y=t.makeOutput(m,u.dtype);if(0!==w.sizeFromShape(u.shape)){const e=t.dataIdMap.get(y.dataId).id;VVe(l,v,e)}if(f&&t.disposeData(c.dataId),a){const e=j.expandShapeToKeepDim(y.shape,h);y.shape=e}return y}},PWe(oce),{kernelName:sce,backendName:"wasm",setupFunc:function(e){qVe=e.wasm.cwrap(sce,null,["number","array","number","array","number","number"])},kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,a=n.dataIdMap.get(i.dataId).id,{reps:o}=r,s=new Array(i.shape.length);for(let h=0;h<s.length;h++)s[h]=i.shape[h]*o[h];const l=new Uint8Array(new Int32Array(i.shape).buffer),u=new Uint8Array(new Int32Array(s).buffer),c=n.makeOutput(s,i.dtype),d=n.dataIdMap.get(c.dataId).id;return qVe(a,l,i.shape.length,u,s.length,NWe[c.dtype],d),c}},{kernelName:lce,backendName:"wasm",setupFunc:function(e){GVe=e.wasm.cwrap(lce,null,["number","array","number","number","number","bool","number","number"])},kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r}=e,{k:i,sorted:a}=n,o=t.dataIdMap.get(r.dataId).id,s=new Uint8Array(new Int32Array(r.shape).buffer),l=r.shape.slice();l[l.length-1]=i;const u=t.makeOutput(l,r.dtype),c=t.dataIdMap.get(u.dataId).id,d=t.makeOutput(l,"int32"),h=t.dataIdMap.get(d.dataId).id;return GVe(o,s,r.shape.length,NWe[r.dtype],i,a,c,h),[u,d]}},GWe,{kernelName:dce,backendName:"wasm",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:i}=t;let{axis:a}=r;a<0&&(a+=i.shape.length);const o=i.shape[a],s=i.shape.length,l=new Array(s-1);let u=0;for(let f=0;f<s;f++)f!==a&&(l[u++]=i.shape[f]);const c=new Array(o),d=new Array(s).fill(0),h=i.shape.slice();h[a]=1;for(let f=0;f<c.length;f++)d[a]=f,c[f]=KVe({inputs:{x:i},attrs:{begin:d,size:h},backend:n});return c.map(({dataId:e,dtype:t})=>({dataId:e,dtype:t,shape:l}))}},{kernelName:fce,backendName:"wasm",kernelFunc:function(e){const{inputs:{x:t},backend:n}=e,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(0),r}}];for(const Gqe of ZVe)Sce(Gqe);const JVe=xse();JVe.registerFlag("WASM_HAS_SIMD_SUPPORT",async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]))),JVe.registerFlag("WASM_HAS_MULTITHREAD_SUPPORT",async()=>{if(JVe.get("IS_NODE"))return!1;try{return(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch(e){return!1}});var QVe=n("VYYE"),eqe=n.n(QVe),tqe=n("0I5M"),nqe=n.n(tqe);class rqe extends Toe{constructor(e){super(),this.wasm=e,this.dataIdNextNumber=1,this.wasm.tfjs.init(),this.dataIdMap=new Soe(this,Ofe())}write(e,t,n){const r={};return this.move(r,e,t,n),r}numDataIds(){return this.dataIdMap.numDataIds()}async time(e){const t=w.now();return e(),{kernelMs:w.now()-t}}move(e,t,n,r){const i=this.dataIdNextNumber++;if("string"===r)return void this.dataIdMap.set(e,{id:i,stringBytes:t,shape:n,dtype:r,memoryOffset:null});const a=w.sizeFromShape(n),o=a*w.bytesPerElement(r),s=this.wasm._malloc(o);this.dataIdMap.set(e,{id:i,memoryOffset:s,shape:n,dtype:r}),this.wasm.tfjs.registerTensor(i,a,s),null!=t&&this.wasm.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,o),s)}async read(e){return this.readSync(e)}readSync(e){const{memoryOffset:t,dtype:n,shape:r,stringBytes:i}=this.dataIdMap.get(e);return"string"===n?i:function(e,t){switch(t){case"float32":return new Float32Array(e);case"int32":return new Int32Array(e);case"bool":return new Uint8Array(e);default:throw new Error("Unknown dtype "+t)}}(this.wasm.HEAPU8.slice(t,t+w.sizeFromShape(r)*w.bytesPerElement(n)).buffer,n)}disposeData(e){const t=this.dataIdMap.get(e);this.wasm._free(t.memoryOffset),this.wasm.tfjs.disposeData(t.id),this.dataIdMap.delete(e)}floatPrecision(){return 32}getMemoryOffset(e){return this.dataIdMap.get(e).memoryOffset}dispose(){this.wasm.tfjs.dispose(),this.wasm=null}memory(){return{unreliable:!1}}makeOutput(e,t,n){let r;if(null==n)r=this.write(null,e,t);else{r={};const i=this.dataIdNextNumber++;this.dataIdMap.set(r,{id:i,memoryOffset:n,shape:e,dtype:t});const a=w.sizeFromShape(e);this.wasm.tfjs.registerTensor(i,a,n)}return{dataId:r,shape:e,dtype:t}}typedArrayFromHeap({shape:e,dtype:t,dataId:n}){const r=this.wasm.HEAPU8.buffer,{memoryOffset:i}=this.dataIdMap.get(n),a=w.sizeFromShape(e);switch(t){case"float32":return new Float32Array(r,i,a);case"int32":return new Int32Array(r,i,a);case"bool":return new Uint8Array(r,i,a);default:throw new Error("Unknown dtype "+t)}}}function iqe(e,t,n){if(null!=oqe)return oqe;let r="tfjs-backend-wasm.wasm";return e&&t?r="tfjs-backend-wasm-threaded-simd.wasm":e&&(r="tfjs-backend-wasm-simd.wasm"),null!=lqe&&null!=lqe[r]?lqe[r]:n+r}const aqe=["tfjs-backend-wasm.wasm","tfjs-backend-wasm-simd.wasm","tfjs-backend-wasm-threaded-simd.wasm"];let oqe=null,sqe=null,lqe={},uqe=!1,cqe=!1;Hfe("wasm",async()=>{const{wasm:e}=await async function(){const[e,t]=await Promise.all([xse().getAsync("WASM_HAS_SIMD_SUPPORT"),xse().getAsync("WASM_HAS_MULTITHREAD_SUPPORT")]);return new Promise((n,r)=>{const i={};var a;let o;i.locateFile=(n,r)=>{if(n.endsWith(".worker.js")){const e=new Blob(['var threadInfoStruct=0;var selfThreadId=0;var parentThreadId=0;var Module={};function threadPrintErr(){var text=Array.prototype.slice.call(arguments).join(" ");console.error(text)}function threadAlert(){var text=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:text,threadId:selfThreadId})}var err=threadPrintErr;this.alert=threadAlert;Module["instantiateWasm"]=function(info,receiveInstance){var instance=new WebAssembly.Instance(Module["wasmModule"],info);Module["wasmModule"]=null;receiveInstance(instance);return instance.exports};this.onmessage=function(e){try{if(e.data.cmd==="load"){Module["DYNAMIC_BASE"]=e.data.DYNAMIC_BASE;Module["DYNAMICTOP_PTR"]=e.data.DYNAMICTOP_PTR;Module["wasmModule"]=e.data.wasmModule;Module["wasmMemory"]=e.data.wasmMemory;Module["buffer"]=Module["wasmMemory"].buffer;Module["ENVIRONMENT_IS_PTHREAD"]=true;if(typeof e.data.urlOrBlob==="string"){importScripts(e.data.urlOrBlob)}else{var objectUrl=URL.createObjectURL(e.data.urlOrBlob);importScripts(objectUrl);URL.revokeObjectURL(objectUrl)}Module=WasmBackendModuleThreadedSimd(Module);postMessage({"cmd":"loaded"})}else if(e.data.cmd==="objectTransfer"){Module["PThread"].receiveObjectTransfer(e.data)}else if(e.data.cmd==="run"){Module["__performance_now_clock_drift"]=performance.now()-e.data.time;threadInfoStruct=e.data.threadInfoStruct;Module["__register_pthread_ptr"](threadInfoStruct,0,0);selfThreadId=e.data.selfThreadId;parentThreadId=e.data.parentThreadId;var max=e.data.stackBase;var top=e.data.stackBase+e.data.stackSize;Module["establishStackSpace"](top,max);Module["_emscripten_tls_init"]();Module["PThread"].receiveObjectTransfer(e.data);Module["PThread"].setThreadStatus(Module["_pthread_self"](),1);try{var result=Module["dynCall_ii"](e.data.start_routine,e.data.arg);if(!Module["getNoExitRuntime"]())Module["PThread"].threadExit(result)}catch(ex){if(ex==="Canceled!"){Module["PThread"].threadCancel()}else if(ex!="unwind"){Atomics.store(Module["HEAPU32"],threadInfoStruct+4>>2,ex instanceof Module["ExitStatus"]?ex.status:-2);Atomics.store(Module["HEAPU32"],threadInfoStruct+0>>2,1);Module["_emscripten_futex_wake"](threadInfoStruct+0,2147483647);if(!(ex instanceof Module["ExitStatus"]))throw ex}}}else if(e.data.cmd==="cancel"){if(threadInfoStruct){Module["PThread"].threadCancel()}}else if(e.data.target==="setimmediate"){}else if(e.data.cmd==="processThreadQueue"){if(threadInfoStruct){Module["_emscripten_current_thread_process_queued_calls"]()}}else{err("worker.js received unknown command "+e.data.cmd);err(e.data)}}catch(ex){err("worker.js onmessage() captured an uncaught exception: "+ex);if(ex.stack)err(ex.stack);throw ex}};if(typeof process==="object"&&typeof process.versions==="object"&&typeof process.versions.node==="string"){self={location:{href:__filename}};var onmessage=this.onmessage;var nodeWorkerThreads=require("worker_threads");Worker=nodeWorkerThreads.Worker;var parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",function(data){onmessage({data:data})});var nodeFS=require("fs");var nodeRead=function(filename){return nodeFS.readFileSync(filename,"utf8")};function globalEval(x){global.require=require;global.Module=Module;eval.call(null,x)}importScripts=function(f){globalEval(nodeRead(f))};postMessage=function(msg){parentPort.postMessage(msg)};if(typeof performance==="undefined"){performance={now:function(){return Date.now()}}}}'],{type:"application/javascript"});return URL.createObjectURL(e)}return n.endsWith(".wasm")?iqe(e,t,null!=sqe?sqe:r):r+n},cqe&&(i.instantiateWasm=(a=iqe(e,t,null!=sqe?sqe:""),(e,t)=>(w.fetch(a,{credentials:"same-origin"}).then(n=>{n.ok||e.env.a(`failed to load wasm binary file at '${a}'`),n.arrayBuffer().then(n=>{WebAssembly.instantiate(n,e).then(e=>{t(e.instance)})})}),{}))),t&&e&&null==oqe?(o=eqe()(i),o.mainScriptUrlOrBlob=new Blob(["var WasmBackendModuleThreadedSimd = "+eqe.a.toString()],{type:"text/javascript"})):o=nqe()(i),o.tfjs={init:o.cwrap("init",null,[]),registerTensor:o.cwrap("register_tensor",null,["number","number","number"]),disposeData:o.cwrap("dispose_data",null,["number"]),dispose:o.cwrap("dispose",null,[])};let s=!1;o.onRuntimeInitialized=()=>{s=!0,uqe=!1,n({wasm:o})},o.onAbort=()=>{s||uqe||(uqe=!0,r({message:"Make sure the server can serve the `.wasm` file relative to the bundled js file. For more details see https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/README.md#using-bundlers"}))}})}();return new rqe(e)},2),function(e,t=!1){if(uqe)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPaths()` before you call `tf.setBackend()` or `tf.ready()`");if("string"==typeof e)sqe=e;else{lqe=e;const t=aqe.filter(e=>null==lqe[e]);if(t.length>0)throw new Error("There were no entries found for the following binaries: "+t.join(",")+". Please either call setWasmPaths with a map providing a path for each binary, or with a string indicating the directory where all the binaries can be found.")}cqe=t}(document.location.href+"assets/"),Pfe("wasm").then(e=>{console.log("loadedTFWasm: ",e)});const dqe=(e,t,n)=>Nfe(()=>{const r=$he(Array.from(e),[t.h,t.w,1],"float32");return hbe.resizeNearestNeighbor(r,[n.h,n.w])}),hqe={uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array};window.resizeImage=dqe,window.resizeCornerstoneImage=(e,t)=>{const n=e.getPixelData();let r;n instanceof Uint8Array?r="uint8":n instanceof Uint16Array?r="uint16":n instanceof Uint32Array&&(r="uint32");const i=dqe(n,{h:e.height,w:e.width},t),a=hqe[r].from(i.dataSync());return Object.assign(Object.assign({},e),{getPixelData:()=>a,columnPixelSpacing:e.columnPixelSpacing*e.width/t.w,rowPixelSpacing:e.rowPixelSpacing*e.height/t.h,sizeInBytes:e.sizeInBytes*(t.w/e.width)*(t.h/e.height),height:t.h,rows:t.h,width:t.w,columns:t.w})},window.tf=se;class fqe{constructor(e,t){this.cornerstoneService=e,this.createOverlayImage=(e,t,n)=>({imageId:t.getElement().id,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:e.width/2,windowWidth:e.width,getPixelData:this.createGetPixelData(t,n),rows:e.rows,columns:e.columns,render:dp.renderGrayscaleImage,height:e.height,width:e.width,color:!1,columnPixelSpacing:e.columnPixelSpacing,rowPixelSpacing:e.rowPixelSpacing,invert:!1,sizeInBytes:e.height*e.width,data:{rawPixels:new Uint8Array(e.height*e.width)}}),this.createGetPixelData=(e,t)=>()=>{const n=e.currentStackPoints(),r=e.getRoiPixels();if(0===r.length)return e.dynamicImage.data.rawPixels;const i=new Uint8Array(e.dynamicImage.height*e.dynamicImage.width),a=this.cornerstoneService.buildTranslatePoints(t.getElement(),e.getElement(),this.getTranslation),o=this.cornerstoneService.calculateScaleRatio(t.getElement(),e.getElement()),s=e.isLeft?e:t;for(let l=0;l<r.length;l++){const u=r[l];let c=n[u.uuid].diffData;if(console.log(u.bbox),(null==c?void 0:c.imageId)!==s.imageId||!up(null==c?void 0:c.points,u.points)){const n=lp(u.bbox,a);let r,i,s=dp.getPixels(t.getElement(),n.left,n.top,n.width,n.height),l=u.pixels,d=u.bbox,h=u.points;1!==o&&(s=dqe(s,{h:n.height,w:n.width},{w:u.bbox.width,h:u.bbox.height}).dataSync()),e.isLeft?(r=l,i=s):(i=l,r=s);let f=0;const p=[];let m=Number.MIN_VALUE,g=Number.MAX_VALUE,v=0;for(let t=d.top;t<d.top+d.height;t++)for(let n=d.left;n<d.left+d.width;n++){if(this.cornerstoneService.pointInFreehand2(h,{x:n,y:t},d)){const a=r[f]-i[f];isNaN(a)&&console.log(n,t,f,r[f],i[f],r.length,i.length),m=Math.max(m,a),g=Math.min(g,a),v+=a,p.push({left:r[f],right:i[f],index:t*e.dynamicImage.width+n,diff:a,x:n,y:t})}f++}c={array:p,max:m,min:g,sum:v,points:u.points.map(e=>Object.assign({},e)),imageId:e.imageId},e.currentStackPoints()[u.uuid].diffData=c}console.log("max",c.max,"min",c.min);for(const e of c.array){const t=Math.floor((e.diff-c.min)/(c.max-c.min)*255);i[e.index]=t}}return setTimeout(this.updateVolumeStats,10),i},this.updateVolumeStats=t.updateVolumeStats,this.getTranslation=t.getTranslation}}let pqe=(()=>{class e{constructor(e){this.cornerstone=e,this.getDicomSummary=e=>{if(void 0===e)return;const t={};return Object.entries(mqe).forEach(([n,r])=>{let i="";if(void 0!==e.elements[r]){const t=e.string(r);void 0!==t&&(i=t)}t[n]=i}),t["Image Orientation Patient"]=t["Image Orientation Patient"].replace(/\\/g,"\\ "),Object.entries(gqe).forEach(([n,r])=>{const i=e.elements[r];let a="";void 0!==i&&(2===i.length?a+=e.uint16(r):4===i.length&&(a+=e.uint32(r))),t[n]=a}),{info:t,instanceId:Number.parseInt(t["Instance #"])}},this.getNiftiSummary=e=>{const t={},n=t=>this.cornerstone.cornerstone.metaData.get(t,e);return Object.entries({imagePixelModule:["columns","rows","samplesPerPixel","photometricInterpretation","planarConfiguration","pixelAspectRatio","bitsAllocated","bitsStored","highBit","pixelRepresentation","smallestPixelValue","largestPixelValue"]}).forEach(([e,r])=>{r.forEach(r=>{t[r]=""+n(e)[r]})}),[["numberOfFrames","multiFrameModule"],["pixelSpacing","imagePlaneModule"],["windowCenter","voiLutModule"],["windowWidth","voiLutModule"],["rescaleIntercept","modalityLutModule"],["rescaleSlope","modalityLutModule"]].forEach(([e,r])=>{t[e]=""+n(r)[e]}),Object.entries(n("imagePlaneModule")).forEach(([e,n])=>{"frameOfReferenceUID"!==e&&(t[e]=""+n)}),t}}}return e.\u0275fac=function(t){return new(t||e)(Kt(bp))},e.\u0275prov=ht({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const mqe={"Study UID":"x0020000d","Series UID":"x0020000e","Instance UID":"x00080018","SOP Class UID":"x00080016","Transfer Syntax UID":"x00020010","Frame of Reference UID":"x00200052",Manufacturer:"x00080070",Model:"x00081090","Station Name":"x00081010","AE Title":"x00020016","Institution Name":"x00080080","Software Version":"x00181020","Implementation Version Name":"x00020013","Photometric Interpretation":"x00280004","Image Type":"x00080008","Window Center":"x00281050","Window Width":"x00281051","Rescale Slope":"x00281053","Rescale Intercept":"x00281052","Image Position Patient":"x00200032","Image Orientation Patient":"x00200037","Pixel Spacing":"x00280030","Instance #":"x00200013","Acquisition #":"x00200012","Acquisition Date":"x00080022","Acquisition Time":"x00080032","Content Date":"x00080023","Content Time":"x00080033","Patient Name":"x00100010","Patient ID":"x00100020","Patient Birth Date":"x00100030","Patient Sex":"x00100040","Study Description":"x00081030","Protocol Name":"x00181030","Accession #":"x00080050","Study Id":"x00200010","Study Date":"x00080020","Study Time":"x00080030","Series Description":"x0008103e","Series #":"x00200011",Modality:"x00080060","Body Part":"x00180015","Series Date":"x00080021","Series Time":"x00080031"},gqe={Rows:"x00280010",Columns:"x00280011","Bits Allocated":"x00280100","Bits Stored":"x00280101",HighBit:"x00280102","Pixel Representation (0=us)":"x00280103","Samples Per Pixel":"x00280002"};let vqe=(()=>{class e{constructor(){this.onFileDropped=new Zs,this.background="#f5fcff",this.opacity="1"}onDragOver(e){e.preventDefault(),e.stopPropagation(),this.background="#9ecbec",this.opacity="0.8"}onDragLeave(e){e.preventDefault(),e.stopPropagation(),this.background="#f5fcff",this.opacity="1"}onDrop(e){e.preventDefault(),e.stopPropagation(),this.background="#f5fcff",this.opacity="1";const t=e.dataTransfer.files;t.length>0&&this.onFileDropped.emit(t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=xn({type:e,selectors:[["","appDropFile",""]],hostVars:4,hostBindings:function(e,t){1&e&&Fo("dragover",(function(e){return t.onDragOver(e)}))("dragleave",(function(e){return t.onDragLeave(e)}))("drop",(function(e){return t.onDrop(e)})),2&e&&Wo("background-color",t.background)("opacity",t.opacity)},outputs:{onFileDropped:"onFileDropped"}}),e})();const yqe=["dicomImageLeft"],bqe=["dicomImageRight"];function xqe(e,t){if(1&e&&(Oo(0,"option",80),Xo(1),Do()),2&e){const e=t.$implicit,n=Lo();Bo("value",e.id),Io("selected",e.id===n.selectedColormap),Ni(1),Zo("",e.name," ")}}function wqe(e,t){if(1&e&&(Oo(0,"option",80),Xo(1),Do()),2&e){const e=t.$implicit,n=Lo();Bo("value",e),Io("selected",n.registration.registerMethod===""+e),Ni(1),Zo("",e," ")}}function _qe(e,t){if(1&e&&(Oo(0,"option",80),Xo(1),Do()),2&e){const e=t.$implicit,n=Lo(2);Bo("value",e.key),Io("selected",n.imageDataLeft.imageId===e.key),Ni(1),Ko(e.key)}}function kqe(e,t){if(1&e){const e=No();Oo(0,"fieldset",81),Oo(1,"label",82),Xo(2,"Image import"),Do(),Oo(3,"select",83,84),Fo("input",(function(){rr(e);const t=To(4),n=Lo();return n.changeImage(t,n.imageDataLeft)})),So(5,_qe,2,3,"option",16),Xs(6,"keyvalue"),Oo(7,"option",85),Xo(8,"Import Image"),Do(),Do(),Do()}if(2&e){const e=Lo();Ni(5),Io("ngForOf",Ks(6,2,e.importedImageIds)),Ni(2),Io("selected",!1)}}function Eqe(e,t){if(1&e&&(Oo(0,"div",86),Xo(1),Do()),2&e){const e=Lo();Ni(1),Jo(" ",e.imageDataLeft.stackPosition+1,"/",e.imageDataLeft.stackSize," ")}}function Sqe(e,t){if(1&e&&(Oo(0,"option",80),Xo(1),Do()),2&e){const e=t.$implicit,n=Lo(2);Bo("value",e.key),Io("selected",n.imageDataRight.imageId===e.key),Ni(1),Ko(e.key)}}function Tqe(e,t){if(1&e){const e=No();Oo(0,"fieldset",81),Oo(1,"label",87),Xo(2,"Image import"),Do(),Oo(3,"select",88,89),Fo("input",(function(){rr(e);const t=To(4),n=Lo();return n.changeImage(t,n.imageDataRight)})),So(5,Sqe,2,3,"option",16),Xs(6,"keyvalue"),Oo(7,"option",85),Xo(8,"Import Image"),Do(),Do(),Do()}if(2&e){const e=Lo();Ni(5),Io("ngForOf",Ks(6,2,e.importedImageIds)),Ni(2),Io("selected",!e.imageDataRight.loaded)}}function Cqe(e,t){if(1&e&&(Oo(0,"div",86),Xo(1),Do()),2&e){const e=Lo();Ni(1),Jo(" ",e.imageDataRight.stackPosition+1,"/",e.imageDataRight.stackSize," ")}}function Iqe(e,t){1&e&&(Oo(0,"div",90),Oo(1,"div",91),Mo(2,"div",92),Oo(3,"h3",93),Xo(4,"Loading files..."),Do(),Do(),Do())}function Aqe(e,t){1&e&&(Oo(0,"div",90),Oo(1,"div",91),Mo(2,"div",92),Oo(3,"h3",93),Xo(4,"Loading files..."),Do(),Do(),Do())}function Oqe(e,t){if(1&e){const e=No();Oo(0,"button",94),Fo("click",(function(){rr(e);const t=Lo();return t.currentInfoView=t.InfoView.Comparison})),Xo(1,"Comparison"),Do()}}function Dqe(e,t){if(1&e){const e=No();Oo(0,"button",94),Fo("click",(function(){rr(e);const t=Lo();return t.currentInfoView=t.InfoView.Metadata})),Xo(1,"Metadata"),Do()}}function Mqe(e,t){if(1&e&&(Oo(0,"tr"),Oo(1,"td"),Xo(2),Do(),Oo(3,"td"),Xo(4),Do(),Do()),2&e){const e=t.$implicit;Ni(2),Ko(e.key),Ni(2),Ko(e.value)}}function Nqe(e,t){1&e&&(Oo(0,"div",99),Xo(1," No matches for filter "),Do())}function jqe(e,t){if(1&e&&(Oo(0,"table",95),Oo(1,"thead"),Oo(2,"tr"),Oo(3,"td",96),Xo(4,"Key"),Do(),Oo(5,"td"),Xo(6,"Value"),Do(),Do(),Do(),Oo(7,"tbody"),So(8,Mqe,5,2,"tr",97),Xs(9,"keyvalue"),Do(),So(10,Nqe,2,0,"div",98),Do()),2&e){const e=Lo();Ni(8),Io("ngForOf",Ks(9,2,e.selectedMetadata.filteredInfo)),Ni(2),Io("ngIf",e.noMatchesForFilter)}}function Fqe(e,t){1&e&&(Oo(0,"div",74),Oo(1,"div",100),Xo(2," No metadata available. "),Do(),Do())}function Rqe(e,t){1&e&&(Oo(0,"div",100),Xo(1," No comparison available. Select a region of interest for the comparison. "),Do())}function Pqe(e,t){if(1&e&&(Oo(0,"div",101),Oo(1,"table"),Oo(2,"h4"),Xo(3,"Left (union)"),Do(),Oo(4,"tr"),Oo(5,"td"),Xo(6,"Mean"),Do(),Oo(7,"td"),Xo(8),Do(),Do(),Oo(9,"tr"),Oo(10,"td"),Xo(11,"Std."),Do(),Oo(12,"td"),Xo(13),Do(),Do(),Oo(14,"tr"),Oo(15,"td"),Xo(16,"Area"),Do(),Oo(17,"td"),Xo(18),Do(),Do(),Oo(19,"h4"),Xo(20,"Right (union)"),Do(),Oo(21,"tr"),Oo(22,"td"),Xo(23,"Mean"),Do(),Oo(24,"td"),Xo(25),Do(),Do(),Oo(26,"tr"),Oo(27,"td"),Xo(28,"Std."),Do(),Oo(29,"td"),Xo(30),Do(),Do(),Oo(31,"tr"),Oo(32,"td"),Xo(33,"Area"),Do(),Oo(34,"td"),Xo(35),Do(),Do(),Oo(36,"h4"),Xo(37,"Difference"),Do(),Oo(38,"tr"),Oo(39,"td"),Xo(40,"Mean"),Do(),Oo(41,"td"),Xo(42),Do(),Do(),Oo(43,"tr"),Oo(44,"td"),Xo(45,"Std."),Do(),Oo(46,"td"),Xo(47),Do(),Do(),Do(),Do()),2&e){const e=Lo();Ni(8),Jo("",e.volumeStats.meanLeftOwn," (",e.volumeStats.meanLeft,")"),Ni(5),Jo("",e.volumeStats.stdLeftOwn," (",e.volumeStats.stdLeft,")"),Ni(5),Zo("",e.volumeStats.areaLeft," mm\xb2"),Ni(7),Jo("",e.volumeStats.meanRightOwn," (",e.volumeStats.meanRight,")"),Ni(5),Jo("",e.volumeStats.stdRightOwn," (",e.volumeStats.stdRight,")"),Ni(5),Zo("",e.volumeStats.areaRight," mm\xb2"),Ni(7),Ko(e.volumeStats.mean),Ni(5),Ko(e.volumeStats.std)}}const Lqe=function(e){return{pressed:e}},Bqe=function(){return[1,2,3,4,5,6,7,8]},$qe=function(e){return{hidden:e}};var zqe=function(e){return e.volume="volume",e.lastRoi="lastRoi",e.stackPosition="stackPosition",e}({}),Uqe=function(e){return e.Comparison="Comparison",e.Metadata="Metadata",e}({}),Hqe=function(e){return e[e.dist=0]="dist",e[e.diff=1]="diff",e}({});let Wqe=(()=>{class e{constructor(e,t){this.cornerstoneService=e,this.metadataService=t,this.ToolName=gp,this.InfoView=Uqe,this.HistogramType=Hqe,this.HistogramRegion=zqe,this.colormaps=dp.colors.getColormapsList(),this.defaultTool=gp.Pan,this.enabledTool=gp.Pan,this.selectedColormap=_p.hotIron,this.deltaStackIndex=0,this.importedImageIds=new Map,this.imageDataLeft=new xp(()=>this._dicomImageLeftElem.nativeElement,{isLeft:!0}),this.imageDataRight=new xp(()=>this._dicomImageRightElem.nativeElement,{isLeft:!1}),this.synchronizeRoi=!0,this.synchronizeStack=!0,this.isLoadingRegistration=!1,this.selectedHistogram=Hqe.dist,this.currentInfoView=Uqe.Metadata,this.isLeftSelected=!0,this.metadataFilter="",this.noMatchesForFilter=!1,this.changeImage=(e,t)=>{if("IMPORT"===e.value)e.value=t.imageId,document.getElementById("fileInput"+(t===this.imageDataLeft?"Left":"Right")).click();else if(e.value!==t.imageId){const n=this.importedImageIds.get(e.value);this.loadAndViewImages(e.value,n,t,!1)}},this.changeColormap=e=>{if(this.selectedColormap=e,this.allLoaded)for(const{getElement:t,overlayLayerId:n}of[this.imageDataLeft,this.imageDataRight]){const e=dp.getLayer(t(),n),r=dp.colors.getColormap(this.selectedColormap);r.setColor(0,[0,0,0,0]),e.viewport.colormap=r,dp.updateImage(t(),!0)}},this.updateLayerOpacity=(e,t)=>{t.opacity=e,this.allLoaded&&(dp.getLayer(t.getElement(),t.overlayLayerId).options.opacity=t.opacity,dp.updateImage(t.getElement()))},this.updateLayerVisibility=e=>{e.visible=!e.visible,this.synchronizeRoiPoints(e),dp.updateImage(e.getElement())},this.updateRoiSynchronization=()=>{this.synchronizeRoi=!this.synchronizeRoi},this.updateStackSynchronization=()=>{this.synchronizeStack=!this.synchronizeStack},this._didChangeRoi=(e,t)=>{let n;n=t.id===this.imageDataLeft.getElement().id?this.imageDataLeft:this.imageDataRight,e.visible=n.visible;const r=n.currentStackIndex(),i=n.currentStackPoints(r);return!(i&&i[e.uuid]&&up(i[e.uuid].points,e.handles.points))},this._onRoiEdited=(e,t)=>{let n;if(n=t.id===this.imageDataLeft.getElement().id?this.imageDataLeft:this.imageDataRight,e.visible=n.visible,!this._didChangeRoi(e,t))return!1;const r=cp.getToolForElement(t,gp.FreehandRoi),i=dp.getImage(t);r.updateCachedStats(i,t,e),this.lastRoiUuid=e.uuid,this.stats.setSelectedSide(n);const a=n.currentStackIndex();return n.setPoints(a,e),dp.updateImage(n.getElement(),!0),!0},this.uploadFile=(e,t)=>{const n=[];console.log(e);for(let r=0;r<e.length;r++)n.push(e[r]);if(n.length>0){let e;const r=n.map((t,n)=>(0===n&&(e=t.name),"application/x-gzip"===t.type?"nifti:"+URL.createObjectURL(t):hp.wadouri.fileManager.add(t)));this.loadAndViewImages(e,r,t,!0)}},this.clearTool=e=>{for(const t of[this.imageDataLeft,this.imageDataRight])t.removeData(e,this.lastRoiUuid)&&this.synchronizeRoiPoints(t);this.imageDataLeft.getElement().click()},this.toggleTool=e=>{(this.imageDataLeft.loaded||this.imageDataRight.loaded)&&(this.enabledTool!==e?(this.enabledTool=e,cp.setToolActive(e,{mouseButtonMask:1}),cp.setToolActive(this.defaultTool,{mouseButtonMask:4})):(this.enabledTool=this.defaultTool,cp.setToolPassive(e,{mouseButtonMask:1}),cp.setToolActive(this.defaultTool,{mouseButtonMask:1}),cp.setToolActive(gp.Wwwc,{mouseButtonMask:4})))},this.otherData=e=>e===this.imageDataLeft?this.imageDataRight:this.imageDataLeft,this.loadAndViewImages=(e,t,n,r)=>Zf(this,void 0,void 0,(function*(){n.loaded||(n.loading=!0);const i=(yield Promise.all(t.map(e=>dp.loadImage(e).catch(e=>{console.log(e)})))).filter(e=>void 0!==e);let a,o;if(console.log(i),t[0].startsWith("nifti:")){o=i[0];const e=i[0].imageId,t=fp.nifti.ImageId.fromURL(e),r=this.metadataService.getNiftiSummary(e);n.parsingResult={info:r,warnings:[],filteredInfo:r};const s=dp.metaData.get("multiFrameModule",t.url).numberOfFrames;a={currentImageIdIndex:0,imageIds:Array.from(Array(s),(e,n)=>`nifti:${t.filePath}#${t.slice.dimension}-${n}`)}}else{const e=i.map(e=>({image:e,metadata:this.metadataService.getDicomSummary(e.data)})).sort((e,t)=>e.metadata.instanceId-t.metadata.instanceId);o=e[0].image;const t=e[0].metadata.info;n.parsingResult={info:t,warnings:e[0].image.data.warnings,filteredInfo:t},a={currentImageIdIndex:0,imageIds:e.map(e=>e.image.imageId)}}const s=n.getElement();if(n.loaded=!0,this._setUpTools(s),void 0!==n.layerId?(dp.removeLayer(s,n.layerId),dp.removeLayer(s,n.overlayLayerId),cp.clearToolState(s,"stack")):cp.addStackStateManager(s,["stack"]),this.allLoaded&&(a.currentImageIdIndex=this.otherData(n).currentStackIndex()),cp.addToolState(s,"stack",a),n.stackPosition=a.currentImageIdIndex,n.stackSize=a.imageIds.length,n.layerId=dp.addLayer(s,o,{opacity:1}),r){n.imageId=e;let t=1;for(;this.importedImageIds.has(n.imageId);)n.imageId=e+t++;this.importedImageIds.set(n.imageId,a.imageIds)}console.log(o),n.dynamicImage=this.overlay.createOverlayImage(o,n,this.otherData(n));const l=dp.colors.getColormap(this.selectedColormap);l.setColor(0,[0,0,0,0]),n.overlayLayerId=dp.addLayer(s,n.dynamicImage,{opacity:n.opacity,viewport:{colormap:l}}),this.toggleTool(gp.FreehandRoi),this.toggleTool(gp.FreehandRoi),this.allLoaded&&(cp.clearToolState(s,gp.FreehandRoi),this.otherData(n).getElement().click());for(const{loaded:e,getElement:t}of[this.imageDataLeft,this.imageDataRight])e&&dp.updateImage(t(),!0);s.addEventListener(cp.EVENTS.STACK_SCROLL,e=>this.onStackScroll(e,n)),setTimeout(()=>{var e;const t=dp.getLayer(s,n.overlayLayerId).syncProps;t&&(t.originalScale=null===(e=dp.getLayer(s,n.layerId).syncProps)||void 0===e?void 0:e.originalScale,dp.updateImage(s))},10),n.loading=!1})),this.onStackScroll=(e,t)=>Zf(this,void 0,void 0,(function*(){const n=e.detail;t.stackPosition=n.newImageIdIndex;const r=this.otherData(t),i=r.loaded?Math.min(Math.max(r.currentStackIndex()+(r.isLeft?1:-1)*this.deltaStackIndex,0),r.stackSize-1):0;if(this.synchronizeStack){if([this.imageDataLeft,this.imageDataRight].every(e=>e.loaded)){let e=0;for(;e<5&&n.newImageIdIndex!==i;)yield new Promise(e=>setTimeout(e,20)),e++;r.stackPosition=t.isLeft?this.imageDataRight.currentStackIndex():this.imageDataLeft.currentStackIndex()}for(const e of[this.imageDataLeft,this.imageDataRight]){if(!e.loaded||e===t&&n.newImageIdIndex!==e.currentStackIndex()||e===r&&i===e.currentStackIndex())return;this.synchronizeRoiPoints(e),dp.updateImage(e.getElement(),!0)}}else yield new Promise(e=>setTimeout(e,20)),this.synchronizeRoiPoints(t),dp.updateImage(t.getElement(),!0)})),this.synchronizeRoiPoints=e=>{var t,n,r,i;const a=e.getElement(),o=null!==(t=e.currentStackPoints())&&void 0!==t?t:{},s=(null!==(n=cp.getToolState(a,gp.FreehandRoi))&&void 0!==n?n:{data:[]}).data;s.length>Object.keys(o).length&&cp.clearToolState(a,gp.FreehandRoi);const l=s.reduce((e,t)=>(e.set(t.uuid,t),e),new Map);let u=!1;if(Object.entries(o).map(([t,{points:n}])=>{if(l.has(t)){const r=l.get(t);r.handles.points.forEach((e,t)=>{u=u||e.x!==n[t].x||e.y!==n[t].y,e.x=n[t].x,e.y=n[t].y}),u=u||r.visible!==e.visible,r.visible=e.visible}else u=!0,cp.addToolState(a,gp.FreehandRoi,this.cornerstoneService.createRoiData(t,n,e.visible))}),u){const t=e.getElement(),n=cp.getToolForElement(t,gp.FreehandRoi),o=dp.getImage(t);for(const e of null!==(i=null===(r=cp.getToolState(a,gp.FreehandRoi))||void 0===r?void 0:r.data)&&void 0!==i?i:[])n.updateCachedStats(o,t,e)}return u},this._setUpTools=e=>{if(dp.enable(e),this.allLoaded){const e=new cp.Synchronizer(dp.EVENTS.IMAGE_RENDERED,this.cornerstoneService.panZoomSynchronizer(this.imageDataLeft,this.imageDataRight)),t=new cp.Synchronizer(dp.EVENTS.IMAGE_RENDERED,(e,t,n,r)=>{if(this.synchronizeStack)return this.cornerstoneService.stackImageIndexSynchronizer(e,t,n,this.imageDataLeft.getElement().id===t.id?this.deltaStackIndex:-this.deltaStackIndex)}),n=new cp.Synchronizer("click",this.cornerstoneService.freehandRoiSynchronizer({onUpdateCompleted:this._onRoiEdited,didChangeRoi:this._didChangeRoi,getImageVisibility:e=>this.imageDataLeft.getElement()===e?this.imageDataLeft.visible:this.imageDataRight.visible,shouldSynchronize:()=>this.synchronizeRoi&&this.synchronizeStack,getTranslation:this.getTranslation}));for(const r of[this.imageDataLeft,this.imageDataRight]){const i=r.getElement();e.add(i),t.add(i),n.add(i),i.addEventListener("keydown",e=>{var t;if("Escape"===e.key){cp.getToolForElement(i,gp.FreehandRoi).cancelDrawing(i);const e=this.otherData(r),n=null===(t=cp.getToolState(e.getElement(),gp.FreehandRoi))||void 0===t?void 0:t.data;for(const t of n)void 0===t.area&&cp.removeToolState(e.getElement(),gp.FreehandRoi,t);dp.updateImage(e.getElement()),dp.updateImage(i)}})}window.synchronizer=e,this.configureTools([{name:gp.Pan,options:{mouseButtonMask:1,synchronizationContext:e}},{name:gp.Zoom,options:{mouseButtonMask:2,synchronizationContext:e}},{name:gp.StackScrollMouseWheel,options:{synchronizationContext:t}},{name:gp.FreehandRoi,options:{synchronizationContext:n}}])}this.configureTools([{name:gp.Pan,options:{mouseButtonMask:1}},{name:gp.Zoom,options:{mouseButtonMask:2}},{name:gp.Wwwc,options:{mouseButtonMask:4}},{name:gp.StackScrollMouseWheel,options:{}},{name:gp.Probe,options:{},active:!1},{name:gp.FreehandRoi,options:{},active:!1}])},this.configureTools=e=>{var t,n;for(const r of e){const e=yp(r.name);cp.addTool(e),(null===(t=r.active)||void 0===t||t)&&cp.setToolActive(r.name,null!==(n=r.options)&&void 0!==n?n:{})}},this.resetStackPosition=()=>{const e=this.imageDataLeft.currentStackIndex();this.imageDataLeft.removeData(zqe.volume,""),this.imageDataRight.removeData(zqe.volume,"");const t=this.imageDataRight.currentStackIndex();this.deltaStackIndex=e-t,this.synchronizeStack=!0},this.selectMetadata=e=>{this.isLeftSelected=e,this._updateMetadata()},this.selectHistogram=e=>{this.selectedHistogram=e},this.selectHistogramRegion=e=>{this.stats.updateHistogramRegion(e,this.lastRoiUuid)},this.onSearchInput=e=>{this.metadataFilter=e.toLowerCase(),this._updateMetadata()},this.getTranslation=(e,t)=>{const n={dx:this.imageDataRight.dx,dy:this.imageDataRight.dy},r=this.cornerstoneService.calculateScaleRatio(this.imageDataRight.getElement(),this.imageDataLeft.getElement());return this.imageDataLeft.getElement().id===e.id?(console.log("top"),n.dx=-n.dx,n.dy=-n.dy):(console.log("bottom"),n.dx=n.dx/r,n.dy=n.dy/r),n},this._updateMetadata=()=>{void 0!==this.selectedMetadata&&"info"in this.selectedMetadata&&(this.selectedMetadata.filteredInfo=Object.entries(this.selectedMetadata.info).filter(([e,t])=>e.toLowerCase().includes(this.metadataFilter)||t.toLowerCase().includes(this.metadataFilter)).reduce((e,[t,n])=>(e[t]=n,e),{}),this.noMatchesForFilter=0===Object.keys(this.selectedMetadata.filteredInfo).length)},window.app=this,window.dataL=this.imageDataLeft,window.dataR=this.imageDataRight,this.stats=new koe({left:this.imageDataLeft,right:this.imageDataRight}),this.registration=new Eoe({left:this.imageDataLeft,right:this.imageDataRight}),this.overlay=new fqe(this.cornerstoneService,{getTranslation:this.getTranslation,updateVolumeStats:()=>{this.stats.updateVolumeStats(this.lastRoiUuid)}})}get allLoaded(){return this.imageDataLeft.loaded&&this.imageDataRight.loaded}get volumeStats(){return this.stats.volumeStats}get selectedMetadata(){return this.isLeftSelected?this.imageDataLeft.parsingResult:this.imageDataRight.parsingResult}}return e.\u0275fac=function(t){return new(t||e)(Co(bp),Co(pqe))},e.\u0275cmp=pn({type:e,selectors:[["app-root"]],viewQuery:function(e,t){var n;1&e&&(ul(yqe,!0),ul(bqe,!0)),2&e&&(ll(n=cl())&&(t._dicomImageLeftElem=n.first),ll(n=cl())&&(t._dicomImageRightElem=n.first))},decls:162,vars:85,consts:[[1,"col",2,"height","100%"],["id","top-section",1,"row",2,"justify-content","center"],[1,"col",2,"width","250px","padding-right","15px","overflow-y","auto","height","100%"],[1,"col",2,"align-items","center"],[1,"row"],[3,"ngClass","click"],[2,"align-self","center","padding","5px 0"],[1,"dropdown"],[1,"dropdown-button",2,"white-space","break-spaces"],[1,"dropdown-content"],[3,"click"],[1,"row",2,"justify-content","space-between"],[1,"col"],["for","selectColormap",1,"small-label"],["name","colormap","id","selectColormap",3,"change"],["selectColormap",""],[3,"value","selected",4,"ngFor","ngForOf"],[1,"col",2,"align-items","center","padding-right","3px"],["for","checkboxRoisSynchronization",1,"small-label"],["type","checkbox","id","checkboxRoiSynchronization",3,"disabled","checked","change"],["checkboxRoiSynchronization",""],["for","registerMethodSelect",1,"small-label"],["name","register-method-select","id","registerMethodSelect","ng-model","registration.registerMethod",3,"change"],["registerMethodSelect",""],[3,"disabled","click"],[1,"col",2,"justify-content","space-between","align-items","center"],["for","checkboxStackSynchronization",1,"small-label"],["type","checkbox","id","checkboxStackSynchronization",3,"checked","change"],["checkboxStackSynchronization",""],["class","select-fieldset",4,"ngIf"],["style","align-self: center;",4,"ngIf"],[1,"row",2,"justify-content","space-between","align-items","flex-end"],["for","layerOpacityLeft",1,"small-label"],["type","checkbox","id","layerVisibilityLeft",3,"checked","change"],["layerVisibilityLeft",""],["id","layerOpacityLeft","type","range","min","0","max","1","step","0.05",3,"value","change"],["layerOpacityLeft",""],["for","layerOpacityRight",1,"small-label"],["type","checkbox","id","layerVisibilityRight",3,"checked","change"],["layerVisibilityRight",""],["id","layerOpacityRight","type","range","min","0","max","1","step","0.05",3,"value","change"],["layerOpacityRight",""],[1,"col",2,"padding-top","3px","padding-bottom","15px"],["id","translate-buttons-row",1,"row"],[1,"small-label",3,"click"],[1,"row",2,"padding-top","2px"],["for","rotationRight",1,"small-label",2,"padding-right","4px","padding-top","2px"],["id","rotationRight","type","range","min","0","max","360","step","0.2",2,"flex","1",3,"value","change"],["rotationRight",""],["oncontextmenu","return false;","unselectable","on","onselectstart","return false;","onmousedown","return false;",1,"disable-selection","noIbar","image-wrapper"],["id","dicomImageLeft","tabindex","0",1,"image-inner"],["dicomImageLeft",""],["appDropFile","",1,"dropZone",3,"onFileDropped"],["hidden","","id","fileInputLeft","type","file","multiple","",3,"change"],["fileInputLeft",""],["class","center",4,"ngIf"],["id","dicomImageRight","tabindex","0",1,"image-inner"],["dicomImageRight",""],["hidden","","id","fileInputRight","type","file","multiple","",3,"change"],["fileInputRight",""],[1,"col",2,"flex","1","overflow","auto"],[1,"row",2,"justify-content","space-between","flex","2",3,"ngClass"],[1,"row",2,"align-items","center"],[2,"padding","0 25px 5px 5px"],[3,"disabled","ngClass","click"],[1,"row-min",2,"align-items","center"],["for","inputSearchMetadata",2,"padding-right","5px"],["type","text","id","inputSearchMetadata",3,"keyup"],["inputSearchMetadata",""],[1,"row",2,"justify-content","flex-end","align-items","center","flex","1"],["style","width:100px;",3,"click",4,"ngIf"],[2,"flex","1","overflow","auto",3,"ngClass"],["id","metadata-table",4,"ngIf"],["class","row","style","justify-content: space-around;align-items: center;height: 100%;",4,"ngIf"],[1,"row",2,"justify-content","space-around","align-items","center","height","100%"],["style","flex: 1;text-align: center;",4,"ngIf"],["style","padding-left: 25px;",4,"ngIf"],[1,"col",2,"padding-right","14px"],["id","distChart",2,"flex","1"],["id","diffChart",2,"flex","1"],[3,"value","selected"],[1,"select-fieldset"],["for","selectImageLeft",1,"small-label"],["name","select-image","id","selectImageLeft",3,"input"],["selectImageLeft",""],["value","IMPORT",3,"selected"],[2,"align-self","center"],["for","selectImageRight",1,"small-label"],["name","select-image","id","selectImageRight",3,"input"],["selectImageRight",""],[1,"center"],[1,"col-min",2,"align-items","center"],[1,"loading-indicator"],[2,"color","black"],[2,"width","100px",3,"click"],["id","metadata-table"],[2,"width","13em"],[4,"ngFor","ngForOf"],["style","padding: 5px 10px;",4,"ngIf"],[2,"padding","5px 10px"],[2,"flex","1","text-align","center"],[2,"padding-left","25px"]],template:function(e,t){if(1&e){const e=No();Oo(0,"div",0),Oo(1,"div",1),Oo(2,"div",2),Oo(3,"h4"),Xo(4,"Region of Interest"),Do(),Oo(5,"div",3),Oo(6,"div",4),Oo(7,"button",5),Fo("click",(function(){return t.toggleTool(t.ToolName.Probe)})),Xo(8," Probe Tool "),Do(),Oo(9,"button",5),Fo("click",(function(){return t.toggleTool(t.ToolName.FreehandRoi)})),Xo(10," ROI Tool "),Do(),Do(),Do(),Oo(11,"div",6),Oo(12,"div",7),Oo(13,"button",8),Xo(14),Do(),Oo(15,"div",9),Oo(16,"button",10),Fo("click",(function(){return t.clearTool(t.HistogramRegion.lastRoi)})),Xo(17,"Selected ROI"),Do(),Oo(18,"button",10),Fo("click",(function(){return t.clearTool(t.HistogramRegion.stackPosition)})),Xo(19,"Stack Position"),Do(),Oo(20,"button",10),Fo("click",(function(){return t.clearTool(t.HistogramRegion.volume)})),Xo(21,"Volume"),Do(),Do(),Do(),Do(),Oo(22,"div",11),Oo(23,"div",12),Oo(24,"label",13),Xo(25,"Roi Colormap"),Do(),Oo(26,"select",14,15),Fo("change",(function(){rr(e);const n=To(27);return t.changeColormap(n.value)})),So(28,xqe,2,3,"option",16),Do(),Do(),Oo(29,"div",17),Oo(30,"label",18),Xo(31,"Sync Rois"),Do(),Oo(32,"input",19,20),Fo("change",(function(){return t.updateRoiSynchronization()})),Do(),Do(),Do(),Oo(34,"div",12),Oo(35,"h4"),Xo(36,"Stack"),Do(),Oo(37,"div",11),Oo(38,"div",12),Oo(39,"label",21),Xo(40,"Method"),Do(),Oo(41,"select",22,23),Fo("change",(function(){rr(e);const n=To(42);return t.registration.selectRegisterMethod(n.value)})),So(43,wqe,2,3,"option",16),Do(),Do(),Oo(44,"button",24),Fo("click",(function(){return t.registration.registerImages()})),Xo(45),Do(),Oo(46,"button",24),Fo("click",(function(){return t.resetStackPosition()})),Xo(47," Reset "),Do(),Oo(48,"div",25),Oo(49,"label",26),Xo(50,"Sync Stack"),Do(),Oo(51,"input",27,28),Fo("change",(function(){return t.updateStackSynchronization()})),Do(),Do(),Do(),Do(),Oo(53,"div",12),Oo(54,"h4"),Xo(55,"Left"),Do(),Oo(56,"div",11),So(57,kqe,9,4,"fieldset",29),So(58,Eqe,2,2,"div",30),Do(),Oo(59,"div",12),Oo(60,"div",31),Oo(61,"label",32),Xo(62),Do(),Oo(63,"input",33,34),Fo("change",(function(){return t.updateLayerVisibility(t.imageDataLeft)})),Do(),Do(),Oo(65,"input",35,36),Fo("change",(function(){rr(e);const n=To(66);return t.updateLayerOpacity(n.value,t.imageDataLeft)})),Do(),Do(),Do(),Oo(67,"div",12),Oo(68,"h4"),Xo(69,"Right"),Do(),Oo(70,"div",11),So(71,Tqe,9,4,"fieldset",29),So(72,Cqe,2,2,"div",30),Do(),Oo(73,"div",12),Oo(74,"div",31),Oo(75,"label",37),Xo(76),Do(),Oo(77,"input",38,39),Fo("change",(function(){return t.updateLayerVisibility(t.imageDataRight)})),Do(),Do(),Oo(79,"input",40,41),Fo("change",(function(){rr(e);const n=To(80);return t.updateLayerOpacity(n.value,t.imageDataRight)})),Do(),Do(),Oo(81,"div",42),Oo(82,"h4"),Xo(83,"Transform"),Do(),Oo(84,"div",43),Oo(85,"button",44),Fo("click",(function(){return t.imageDataRight.translateOrRotate({x:-1})})),Xo(86,"Left"),Do(),Oo(87,"button",44),Fo("click",(function(){return t.imageDataRight.translateOrRotate({x:1})})),Xo(88,"Right"),Do(),Oo(89,"button",44),Fo("click",(function(){return t.imageDataRight.translateOrRotate({y:-1})})),Xo(90,"Up"),Do(),Oo(91,"button",44),Fo("click",(function(){return t.imageDataRight.translateOrRotate({y:1})})),Xo(92,"Down"),Do(),Do(),Oo(93,"div",45),Oo(94,"label",46),Xo(95,"Angle"),Do(),Oo(96,"input",47,48),Fo("change",(function(){rr(e);const n=To(97);return t.imageDataRight.translateOrRotate({angle:n.value})})),Do(),Do(),Do(),Do(),Do(),Oo(98,"div",49),Oo(99,"div",50,51),Oo(101,"div",52),Fo("onFileDropped",(function(e){return t.uploadFile(e,t.imageDataLeft)})),Oo(102,"label"),Oo(103,"input",53,54),Fo("change",(function(e){return t.uploadFile(e.target.files,t.imageDataLeft)})),Do(),Xo(105," Select Files "),Do(),Do(),So(106,Iqe,5,0,"div",55),Do(),Do(),Oo(107,"div",49),Oo(108,"div",56,57),Oo(110,"div",52),Fo("onFileDropped",(function(e){return t.uploadFile(e,t.imageDataRight)})),Oo(111,"label"),Oo(112,"input",58,59),Fo("change",(function(e){return t.uploadFile(e.target.files,t.imageDataRight)})),Do(),Xo(114," Select Files "),Do(),Do(),So(115,Aqe,5,0,"div",55),Do(),Do(),Do(),Oo(116,"div",60),Oo(117,"div",11),Oo(118,"div",61),Oo(119,"div",62),Oo(120,"h2",63),Xo(121,"Metadata"),Do(),Oo(122,"button",64),Fo("click",(function(){return t.selectMetadata(!0)})),Xo(123,"Left"),Do(),Oo(124,"button",64),Fo("click",(function(){return t.selectMetadata(!1)})),Xo(125,"Right"),Do(),Do(),Oo(126,"div",65),Oo(127,"label",66),Xo(128,"Search:"),Do(),Oo(129,"input",67,68),Fo("keyup",(function(){rr(e);const n=To(130);return t.onSearchInput(n.value)})),Do(),Do(),Do(),Oo(131,"div",61),Oo(132,"div",62),Oo(133,"h2",63),Xo(134,"Comparison"),Do(),Oo(135,"button",64),Fo("click",(function(){return t.selectHistogramRegion(t.HistogramRegion.volume)})),Xo(136,"Volume"),Do(),Oo(137,"button",64),Fo("click",(function(){return t.selectHistogramRegion(t.HistogramRegion.stackPosition)})),Xo(138,"Stack Position"),Do(),Oo(139,"button",64),Fo("click",(function(){return t.selectHistogramRegion(t.HistogramRegion.lastRoi)})),Xo(140,"Selected ROI"),Do(),Do(),Oo(141,"div",62),Oo(142,"button",64),Fo("click",(function(){return t.selectHistogram(t.HistogramType.dist)})),Xo(143,"Distribution"),Do(),Oo(144,"button",64),Fo("click",(function(){return t.selectHistogram(t.HistogramType.diff)})),Xo(145,"Difference"),Do(),Do(),Do(),Oo(146,"div",69),So(147,Oqe,2,0,"button",70),So(148,Dqe,2,0,"button",70),Do(),Do(),Oo(149,"div",71),So(150,jqe,11,4,"table",72),So(151,Fqe,3,0,"div",73),Do(),Oo(152,"div",71),Oo(153,"div",74),So(154,Rqe,2,0,"div",75),So(155,Pqe,48,12,"div",76),Oo(156,"div",77),Oo(157,"h4"),Xo(158,"Distribution"),Do(),Mo(159,"div",78),Mo(160,"div",79),Do(),Do(),Do(),Do(),Do(),Mo(161,"router-outlet")}2&e&&(Ni(7),Io("ngClass",Gs(58,Lqe,t.enabledTool===t.ToolName.Probe)),Ni(2),Io("ngClass",Gs(60,Lqe,t.enabledTool===t.ToolName.FreehandRoi)),Ni(5),Ko("Clear  \u25bc"),Ni(14),Io("ngForOf",t.colormaps),Ni(4),Io("disabled",!t.synchronizeStack)("checked",t.synchronizeRoi&&t.synchronizeStack),Ni(11),Io("ngForOf",function(e,t,n){const r=ur()+62,i=tr();return i[r]===Ii?_o(i,r,t()):function(e,t){return e[t]}(i,r)}(0,Bqe)),Ni(1),Io("disabled",t.registration.isLoadingRegistration||!t.imageDataLeft.loaded||!t.imageDataRight.loaded),Ni(1),Zo(" ",t.isLoadingRegistration?"Loading":"Register"," "),Ni(1),Io("disabled",!t.imageDataLeft.loaded||!t.imageDataRight.loaded),Ni(5),Io("checked",t.synchronizeStack),Ni(6),Io("ngIf",t.imageDataLeft.loaded||t.importedImageIds.size>1),Ni(1),Io("ngIf",t.imageDataLeft.loaded&&1!==t.imageDataLeft.stackSize),Ni(4),Zo("Opacity: ",t.imageDataLeft.opacity,""),Ni(1),Io("checked",t.imageDataLeft.visible),Ni(2),Bo("value",t.imageDataLeft.opacity),Ni(6),Io("ngIf",t.imageDataRight.loaded||t.importedImageIds.size>1),Ni(1),Io("ngIf",t.imageDataRight.loaded&&1!==t.imageDataRight.stackSize),Ni(4),Zo("Opacity: ",t.imageDataRight.opacity,""),Ni(1),Io("checked",t.imageDataRight.visible),Ni(2),Bo("value",t.imageDataRight.opacity),Ni(17),Bo("value",t.imageDataRight.angle),Ni(5),Wo("display",!1===t.imageDataLeft.loaded&&!1===t.imageDataLeft.loading?void 0:"none"),Ni(5),Io("ngIf",!0===t.imageDataLeft.loading),Ni(4),Wo("display",!1===t.imageDataRight.loaded&&!1===t.imageDataRight.loading?void 0:"none"),Ni(5),Io("ngIf",!0===t.imageDataRight.loading),Ni(3),Io("ngClass",Gs(63,$qe,t.currentInfoView!==t.InfoView.Metadata)),Ni(4),Io("disabled",!1===t.imageDataLeft.loaded)("ngClass",Gs(65,Lqe,!0===t.imageDataLeft.loaded&&t.isLeftSelected)),Ni(2),Io("disabled",!1===t.imageDataRight.loaded)("ngClass",Gs(67,Lqe,!0===t.imageDataRight.loaded&&!t.isLeftSelected)),Ni(7),Io("ngClass",Gs(69,$qe,t.currentInfoView!==t.InfoView.Comparison)),Ni(4),Io("disabled",!1===t.imageDataLeft.loaded||!1===t.imageDataRight.loaded)("ngClass",Gs(71,Lqe,t.stats.selectedHistogramRegion===t.HistogramRegion.volume)),Ni(2),Io("disabled",!1===t.imageDataLeft.loaded||!1===t.imageDataRight.loaded)("ngClass",Gs(73,Lqe,t.stats.selectedHistogramRegion===t.HistogramRegion.stackPosition)),Ni(2),Io("disabled",!1===t.imageDataLeft.loaded||!1===t.imageDataRight.loaded)("ngClass",Gs(75,Lqe,t.stats.selectedHistogramRegion===t.HistogramRegion.lastRoi)),Ni(3),Io("disabled",!1===t.imageDataLeft.loaded||!1===t.imageDataRight.loaded)("ngClass",Gs(77,Lqe,t.selectedHistogram===t.HistogramType.dist)),Ni(2),Io("disabled",!1===t.imageDataLeft.loaded||!1===t.imageDataRight.loaded)("ngClass",Gs(79,Lqe,t.selectedHistogram===t.HistogramType.diff)),Ni(3),Io("ngIf",t.currentInfoView!==t.InfoView.Comparison),Ni(1),Io("ngIf",t.currentInfoView!==t.InfoView.Metadata),Ni(1),Io("ngClass",Gs(81,$qe,t.currentInfoView!==t.InfoView.Metadata)),Ni(1),Io("ngIf",void 0!==t.selectedMetadata),Ni(1),Io("ngIf",void 0===t.selectedMetadata),Ni(1),Io("ngClass",Gs(83,$qe,t.currentInfoView!==t.InfoView.Comparison)),Ni(2),Io("ngIf",void 0===t.volumeStats),Ni(1),Io("ngIf",void 0!==t.volumeStats),Ni(1),Wo("display",void 0!==t.volumeStats?void 0:"none"),Ni(3),Wo("display",t.selectedHistogram===t.HistogramType.dist?void 0:"none"),Ni(1),Wo("display",t.selectedHistogram===t.HistogramType.diff?void 0:"none"))},directives:[Du,Nu,Fu,vqe,Of],pipes:[Lu],styles:["@keyframes spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.loading-indicator[_ngcontent-%COMP%]{border:8px solid #eee;border-top-color:#9b9b9b;border-radius:50%;width:50px;height:50px;animation:spin 1.5s linear infinite}.dropZone[_ngcontent-%COMP%]{flex:1;display:flex;width:100%;height:100%;align-items:center;justify-content:center}.dropZone[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#000;padding:12px;border-radius:8px;background-color:#fff;cursor:pointer;box-shadow:2px 2px #888181}#metadata-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}#metadata-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{font-weight:700;font-size:larger;padding:0 5px}#metadata-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid #e6e6e6}#metadata-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:2px 5px}#top-section[_ngcontent-%COMP%]{height:460px}.image-wrapper[_ngcontent-%COMP%]{width:460px;height:460px;position:relative;color:#fff;display:inline-block;border-style:solid;border-color:#000}.image-inner[_ngcontent-%COMP%]{width:460px;height:460px;top:0;left:0;position:absolute;outline:none}.small-label[_ngcontent-%COMP%]{font-size:.8em}#top-menu[_ngcontent-%COMP%]{padding:3px 0;justify-content:space-between;width:1050px;align-self:center}#top-menu[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-height:20px;margin-top:1px}#top-menu[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]{width:95px}#canvasComp[_ngcontent-%COMP%]{height:250px;width:250px}.select-fieldset[_ngcontent-%COMP%]{padding:0 0 3px;margin:0;border:0;display:flex;flex-direction:column}.select-fieldset[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:145px}#translate-buttons-row[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1}.dropdown-button[_ngcontent-%COMP%]{min-width:110px;border-radius:0}.dropdown[_ngcontent-%COMP%]{position:relative;display:inline-block}.dropdown-content[_ngcontent-%COMP%]{display:none;position:absolute;background-color:#f9f9f9;width:100%;box-shadow:0 8px 16px 0 rgba(0,0,0,.2);z-index:1}.dropdown-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;border-radius:0}.dropdown[_ngcontent-%COMP%]:hover   .dropdown-content[_ngcontent-%COMP%]{display:block}.dropdown[_ngcontent-%COMP%]:hover   .dropdown-button[_ngcontent-%COMP%]{background-color:#eee}\n.cornerstone-enabled-image[_ngcontent-%COMP%]{-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;cursor:default}",'[_nghost-%COMP%] {\n    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";\n    font-size: 14px;\n    color: #333;\n    box-sizing: border-box;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n  }']}),e})(),Vqe=(()=>{class e{}return e.\u0275mod=yn({type:e,bootstrap:[Wqe]}),e.\u0275inj=ft({factory:function(t){return new(t||e)},providers:[],imports:[[vc,Kf]]}),e})();(function(){if(pi)throw new Error("Cannot enable prod mode after platform setup.");fi=!1})(),mc().bootstrapModule(Vqe).catch(e=>console.error(e))},zn8P:function(e,t){function n(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="zn8P"},zv5s:function(e,t,n){const r=n("ex/Z");e.exports=(e,t)=>{try{return new r(e,t).range||"*"}catch(n){return null}}}},[[0,0]]]);