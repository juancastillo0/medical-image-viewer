(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"/kWe":function(e,t){e.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH:16}},0:function(e,t,n){e.exports=n("zUnb")},"0I5M":function(e,t,n){var r,i=(r="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(r=r||__filename),function(e){var t,i=void 0!==(e=e||{})?e:{},a={};for(t in i)i.hasOwnProperty(t)&&(a[t]=i[t]);var o=[],s=function(e,t){throw t},l=!1,u=!1,c=!1,d=!1;l="object"==typeof window,u="function"==typeof importScripts,c="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,d=!l&&!c&&!u;var h,f,p,m,g="";function v(e){return i.locateFile?i.locateFile(e,g):g+e}c?(g=u?n(6).dirname(g)+"/":__dirname+"/",h=function(e,t){return p||(p=n(7)),m||(m=n(6)),e=m.normalize(e),p.readFileSync(e,t?null:"utf8")},f=function(e){var t=h(e,!0);return t.buffer||(t=new Uint8Array(t)),E(t.buffer),t},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),o=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof ke))throw e})),process.on("unhandledRejection",ne),s=function(e){process.exit(e)},i.inspect=function(){return"[Emscripten Module object]"}):d?("undefined"!=typeof read&&(h=function(e){return read(e)}),f=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(E("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?o=scriptArgs:void 0!==arguments&&(o=arguments),"function"==typeof quit&&(s=function(e){quit(e)}),"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(l||u)&&(u?g=self.location.href:document.currentScript&&(g=document.currentScript.src),r&&(g=r),g=0!==g.indexOf("blob:")?g.substr(0,g.lastIndexOf("/")+1):"",h=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},u&&(f=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}));var y,b,x,w=i.print||console.log.bind(console),_=i.printErr||console.warn.bind(console);for(t in a)a.hasOwnProperty(t)&&(i[t]=a[t]);a=null,i.arguments&&(o=i.arguments),i.quit&&(s=i.quit),i.wasmBinary&&(y=i.wasmBinary),i.noExitRuntime&&(b=i.noExitRuntime),"object"!=typeof WebAssembly&&_("no native wasm support detected"),new WebAssembly.Table({initial:147,maximum:147,element:"anyfunc"});var S=!1;function E(e,t){e||ne("Assertion failed: "+t)}function T(e){var t=i["_"+e];return E(t,"Cannot call unknown function "+e+", make sure it is exported"),t}function k(e,t,n,r,i){var a={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);R(e,t=Ee(n),n)}return t},array:function(e){var t=Ee(e.length);return P(e,t),t}},o=T(e),s=[],l=0;if(r)for(var u=0;u<r.length;u++){var c=a[n[u]];c?(0===l&&(l=Se()),s[u]=c(r[u])):s[u]=r[u]}var d=o.apply(null,s);return d=function(e){return"string"===t?N(e):"boolean"===t?Boolean(e):e}(d),0!==l&&Te(l),d}function C(e,t,n,r){var i=(n=n||[]).every((function(e){return"number"===e}));return"string"!==t&&i&&!r?T(e):function(){return k(e,t,n,arguments)}}var I,O,A,D="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function M(e,t,n){for(var r=t+n,i=t;e[i]&&!(i>=r);)++i;if(i-t>16&&e.subarray&&D)return D.decode(e.subarray(t,i));for(var a="";t<i;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var l=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|l:(7&o)<<18|s<<12|l<<6|63&e[t++])<65536)a+=String.fromCharCode(o);else{var u=o-65536;a+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else a+=String.fromCharCode((31&o)<<6|s)}else a+=String.fromCharCode(o)}return a}function N(e,t){return e?M(O,e,t):""}function j(e,t,n,r){if(!(r>0))return 0;for(var i=n,a=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(n>=a)break;t[n++]=s}else if(s<=2047){if(n+1>=a)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=a)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=a)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}return t[n]=0,n-i}function R(e,t,n){return j(e,O,t,n)}function P(e,t){I.set(e,t)}function F(e){i.HEAP8=I=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=A=new Int32Array(e),i.HEAPU8=O=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}function L(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?i.dynCall_v(n):i.dynCall_vi(n,t.arg):n(void 0===t.arg?null:t.arg)}else t(i)}}var $=[],B=[],z=[],U=[];function H(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)G(i.preRun.shift());L($)}function W(){L(B)}function V(){L(z)}function q(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)Y(i.postRun.shift());L(U)}function G(e){$.unshift(e)}function Y(e){U.unshift(e)}var X=Math.ceil,K=Math.floor,Z=0,J=null,Q=null;function ee(e){Z++,i.monitorRunDependencies&&i.monitorRunDependencies(Z)}function te(e){if(Z--,i.monitorRunDependencies&&i.monitorRunDependencies(Z),0==Z&&(null!==J&&(clearInterval(J),J=null),Q)){var t=Q;Q=null,t()}}function ne(e){throw i.onAbort&&i.onAbort(e),w(e+=""),_(e),S=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(e)}function re(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}i.preloadedImages={},i.preloadedAudios={};var ie="data:application/octet-stream;base64,";function ae(e){return re(e,ie)}var oe="file://";function se(e){return re(e,oe)}var le="tfjs-backend-wasm.wasm";function ue(){try{if(y)return new Uint8Array(y);if(f)return f(le);throw"both async and sync fetching of the wasm failed"}catch(_){ne(_)}}function ce(){return y||!l&&!u||"function"!=typeof fetch||se(le)?new Promise((function(e,t){e(ue())})):fetch(le,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+le+"'";return e.arrayBuffer()})).catch((function(){return ue()}))}function de(){var e={env:xe,wasi_snapshot_preview1:xe};function t(e,t){var n=e.exports;i.asm=n,F((x=n.memory).buffer),te()}function n(e){t(e.instance)}function r(t){return ce().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){_("failed to asynchronously prepare wasm: "+e),ne(e)}))}if(ee(),i.instantiateWasm)try{return i.instantiateWasm(e,t)}catch(a){return _("Module.instantiateWasm callback failed with error: "+a),!1}return function(){if(y||"function"!=typeof WebAssembly.instantiateStreaming||ae(le)||se(le)||"function"!=typeof fetch)return r(n);fetch(le,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){_("wasm streaming compile failed: "+e),_("falling back to ArrayBuffer instantiation"),r(n)}))}))}(),{}}function he(e){F(x.buffer)}ae(le)||(le=v(le)),B.push();var fe={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var n=fe.buffers[e];0===t||10===t?((1===e?w:_)(M(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function(){return fe.varargs+=4,A[fe.varargs-4>>2]},getStr:function(e){return N(e)},get64:function(e,t){return e}};function pe(e){return 0}function me(e,t,n,r,i){}function ge(e,t,n,r){for(var i=0,a=0;a<n;a++){for(var o=A[t+8*a>>2],s=A[t+(8*a+4)>>2],l=0;l<s;l++)fe.printChar(e,O[o+l]);i+=s}return A[r>>2]=i,0}function ve(e){Oe(e)}function ye(e){ve(e)}function be(e){return(e=+e)>=0?+K(e+.5):+X(e-.5)}var xe={emscripten_notify_memory_growth:he,fd_close:pe,fd_seek:me,fd_write:ge,proc_exit:ye,roundf:be},we=de();i.asm=we,i._init=function(){return(i._init=i.asm.init).apply(null,arguments)},i._register_tensor=function(){return(i._register_tensor=i.asm.register_tensor).apply(null,arguments)},i._dispose_data=function(){return(i._dispose_data=i.asm.dispose_data).apply(null,arguments)},i._dispose=function(){return(i._dispose=i.asm.dispose).apply(null,arguments)},i._Abs=function(){return(i._Abs=i.asm.Abs).apply(null,arguments)},i._Add=function(){return(i._Add=i.asm.Add).apply(null,arguments)},i._AddN=function(){return(i._AddN=i.asm.AddN).apply(null,arguments)},i._ArgMax=function(){return(i._ArgMax=i.asm.ArgMax).apply(null,arguments)},i._AvgPool=function(){return(i._AvgPool=i.asm.AvgPool).apply(null,arguments)},i._BatchMatMul=function(){return(i._BatchMatMul=i.asm.BatchMatMul).apply(null,arguments)},i._ClipByValue=function(){return(i._ClipByValue=i.asm.ClipByValue).apply(null,arguments)},i._Conv2D=function(){return(i._Conv2D=i.asm.Conv2D).apply(null,arguments)},i._Conv2DBackpropInput=function(){return(i._Conv2DBackpropInput=i.asm.Conv2DBackpropInput).apply(null,arguments)},i._Cos=function(){return(i._Cos=i.asm.Cos).apply(null,arguments)},i._CropAndResize=function(){return(i._CropAndResize=i.asm.CropAndResize).apply(null,arguments)},i._Cumsum=function(){return(i._Cumsum=i.asm.Cumsum).apply(null,arguments)},i._DepthToSpace=function(){return(i._DepthToSpace=i.asm.DepthToSpace).apply(null,arguments)},i._DepthwiseConv2dNative=function(){return(i._DepthwiseConv2dNative=i.asm.DepthwiseConv2dNative).apply(null,arguments)},i._Div=function(){return(i._Div=i.asm.Div).apply(null,arguments)},i._Equal=function(){return(i._Equal=i.asm.Equal).apply(null,arguments)},i._Exp=function(){return(i._Exp=i.asm.Exp).apply(null,arguments)},i._FlipLeftRight=function(){return(i._FlipLeftRight=i.asm.FlipLeftRight).apply(null,arguments)},i._FloorDiv=function(){return(i._FloorDiv=i.asm.FloorDiv).apply(null,arguments)},i._FusedBatchNorm=function(){return(i._FusedBatchNorm=i.asm.FusedBatchNorm).apply(null,arguments)},i._FusedConv2D=function(){return(i._FusedConv2D=i.asm.FusedConv2D).apply(null,arguments)},i._FusedDepthwiseConv2D=function(){return(i._FusedDepthwiseConv2D=i.asm.FusedDepthwiseConv2D).apply(null,arguments)},i._Gather=function(){return(i._Gather=i.asm.Gather).apply(null,arguments)},i._GatherNd=function(){return(i._GatherNd=i.asm.GatherNd).apply(null,arguments)},i._Greater=function(){return(i._Greater=i.asm.Greater).apply(null,arguments)},i._GreaterEqual=function(){return(i._GreaterEqual=i.asm.GreaterEqual).apply(null,arguments)},i._Less=function(){return(i._Less=i.asm.Less).apply(null,arguments)},i._LessEqual=function(){return(i._LessEqual=i.asm.LessEqual).apply(null,arguments)},i._Log=function(){return(i._Log=i.asm.Log).apply(null,arguments)},i._LogicalAnd=function(){return(i._LogicalAnd=i.asm.LogicalAnd).apply(null,arguments)},i._Max=function(){return(i._Max=i.asm.Max).apply(null,arguments)},i._MaxPool=function(){return(i._MaxPool=i.asm.MaxPool).apply(null,arguments)},i._Maximum=function(){return(i._Maximum=i.asm.Maximum).apply(null,arguments)},i._Min=function(){return(i._Min=i.asm.Min).apply(null,arguments)},i._Minimum=function(){return(i._Minimum=i.asm.Minimum).apply(null,arguments)},i._Multiply=function(){return(i._Multiply=i.asm.Multiply).apply(null,arguments)},i._Negate=function(){return(i._Negate=i.asm.Negate).apply(null,arguments)},i._NonMaxSuppressionV3=function(){return(i._NonMaxSuppressionV3=i.asm.NonMaxSuppressionV3).apply(null,arguments)},i._NonMaxSuppressionV4=function(){return(i._NonMaxSuppressionV4=i.asm.NonMaxSuppressionV4).apply(null,arguments)},i._NonMaxSuppressionV5=function(){return(i._NonMaxSuppressionV5=i.asm.NonMaxSuppressionV5).apply(null,arguments)},i._NotEqual=function(){return(i._NotEqual=i.asm.NotEqual).apply(null,arguments)},i._OneHot=function(){return(i._OneHot=i.asm.OneHot).apply(null,arguments)},i._PadV2=function(){return(i._PadV2=i.asm.PadV2).apply(null,arguments)},i._Pow=function(){return(i._Pow=i.asm.Pow).apply(null,arguments)},i._Prelu=function(){return(i._Prelu=i.asm.Prelu).apply(null,arguments)},i._Relu=function(){return(i._Relu=i.asm.Relu).apply(null,arguments)},i._Relu6=function(){return(i._Relu6=i.asm.Relu6).apply(null,arguments)},i._ResizeBilinear=function(){return(i._ResizeBilinear=i.asm.ResizeBilinear).apply(null,arguments)},i._Reverse=function(){return(i._Reverse=i.asm.Reverse).apply(null,arguments)},i._RotateWithOffset=function(){return(i._RotateWithOffset=i.asm.RotateWithOffset).apply(null,arguments)},i._Rsqrt=function(){return(i._Rsqrt=i.asm.Rsqrt).apply(null,arguments)},i._ScatterNd=function(){return(i._ScatterNd=i.asm.ScatterNd).apply(null,arguments)},i._SelectV2=function(){return(i._SelectV2=i.asm.SelectV2).apply(null,arguments)},i._Sigmoid=function(){return(i._Sigmoid=i.asm.Sigmoid).apply(null,arguments)},i._Sin=function(){return(i._Sin=i.asm.Sin).apply(null,arguments)},i._Softmax=function(){return(i._Softmax=i.asm.Softmax).apply(null,arguments)},i._Sqrt=function(){return(i._Sqrt=i.asm.Sqrt).apply(null,arguments)},i._Square=function(){return(i._Square=i.asm.Square).apply(null,arguments)},i._SquaredDifference=function(){return(i._SquaredDifference=i.asm.SquaredDifference).apply(null,arguments)},i._StridedSlice=function(){return(i._StridedSlice=i.asm.StridedSlice).apply(null,arguments)},i._Sub=function(){return(i._Sub=i.asm.Sub).apply(null,arguments)},i._Sum=function(){return(i._Sum=i.asm.Sum).apply(null,arguments)},i._Tanh=function(){return(i._Tanh=i.asm.Tanh).apply(null,arguments)},i._Tile=function(){return(i._Tile=i.asm.Tile).apply(null,arguments)},i._Transpose=function(){return(i._Transpose=i.asm.Transpose).apply(null,arguments)},i.__FusedMatMul=function(){return(i.__FusedMatMul=i.asm._FusedMatMul).apply(null,arguments)},i._malloc=function(){return(i._malloc=i.asm.malloc).apply(null,arguments)},i._free=function(){return(i._free=i.asm.free).apply(null,arguments)},i.__start=function(){return(i.__start=i.asm._start).apply(null,arguments)};var _e,Se=i.stackSave=function(){return(Se=i.stackSave=i.asm.stackSave).apply(null,arguments)},Ee=i.stackAlloc=function(){return(Ee=i.stackAlloc=i.asm.stackAlloc).apply(null,arguments)},Te=i.stackRestore=function(){return(Te=i.stackRestore=i.asm.stackRestore).apply(null,arguments)};function ke(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function Ce(e){var t=i.__start;try{t(),Oe(0,!0)}catch(r){if(r instanceof ke)return;if("unwind"==r)return void(b=!0);var n=r;r&&"object"==typeof r&&r.stack&&(n=[r,r.stack]),_("exception thrown: "+n),s(1,r)}}function Ie(e){function t(){_e||(_e=!0,i.calledRun=!0,S||(W(),V(),i.onRuntimeInitialized&&i.onRuntimeInitialized(),Ae&&Ce(),q()))}e=e||o,Z>0||(H(),Z>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t()))}function Oe(e,t){t&&b&&0===e||(b||(S=!0,i.onExit&&i.onExit(e)),s(e,new ke(e)))}if(i.asm=we,i.cwrap=C,i.then=function(e){if(_e)e(i);else{var t=i.onRuntimeInitialized;i.onRuntimeInitialized=function(){t&&t(),e(i)}}return i},Q=function e(){_e||Ie(),_e||(Q=e)},i.run=Ie,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();var Ae=!0;return i.noInitialRun&&(Ae=!1),b=!0,Ie(),e});e.exports=i},"0eLh":function(e,t,n){const r=n("3wIk"),i=n("vwDW"),{ANY:a}=i,o=n("ex/Z"),s=n("MpxT"),l=n("7sNm"),u=n("JCZO"),c=n("bdwG"),d=n("Dknc");e.exports=(e,t,n,h)=>{let f,p,m,g,v;switch(e=new r(e,h),t=new o(t,h),n){case">":f=l,p=c,m=u,g=">",v=">=";break;case"<":f=u,p=d,m=l,g="<",v="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(e,t,h))return!1;for(let r=0;r<t.set.length;++r){let n=null,o=null;if(t.set[r].forEach(e=>{e.semver===a&&(e=new i(">=0.0.0")),n=n||e,o=o||e,f(e.semver,n.semver,h)?n=e:m(e.semver,o.semver,h)&&(o=e)}),n.operator===g||n.operator===v)return!1;if((!o.operator||o.operator===g)&&p(e,o.semver))return!1;if(o.operator===v&&m(e,o.semver))return!1}return!0}},1:function(e,t){},"18Y9":function(e,t,n){const r=n("ex/Z");e.exports=(e,t,n)=>(e=new r(e,n),t=new r(t,n),e.intersects(t))},2:function(e,t){},"23LK":function(e,t,n){window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.external=void 0;var r,i=(r=n(4))&&r.__esModule?r:{default:r},a=void 0;t.external={set cornerstone(e){(0,i.default)(a=e)},get cornerstone(){return a}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadImage=function(e){var t=r.external.cornerstone,n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",s.beforeSend(n),n.onprogress=function(n){if(n.lengthComputable){var r=n.loaded,i=n.total,a=Math.round(r/i*100);t.triggerEvent(t.events,"cornerstoneimageloadprogress",{imageId:e,loaded:r,total:i,percentComplete:a})}},{promise:new Promise((function(t,r){n.onload=function(){(0,i.default)(this.response).then((function(n){var r=(0,a.default)(n,e);t(r)}),r)},n.send()})),cancelFn:function(){n.abort()}}},t.configure=function(e){s=e};var r=n(0),i=o(n(3)),a=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}var s={beforeSend:function(){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.naturalHeight,o=e.naturalWidth;return{imageId:t,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:128,windowWidth:255,render:r.external.cornerstone.renderWebImage,getPixelData:function(){return(n=void 0,a===t?n=i.getContext("2d"):(i.height=e.naturalHeight,i.width=e.naturalWidth,(n=i.getContext("2d")).drawImage(e,0,0),a=t),n.getImageData(0,0,e.naturalWidth,e.naturalHeight)).data;var n},getCanvas:function(){return a===t||(i.height=e.naturalHeight,i.width=e.naturalWidth,i.getContext("2d").drawImage(e,0,0),a=t),i},getImage:function(){return e},rows:n,columns:o,height:n,width:o,color:!0,rgba:!1,columnPixelSpacing:void 0,rowPixelSpacing:void 0,invert:!1,sizeInBytes:n*o*4}};var r=n(0),i=document.createElement("canvas"),a=void 0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return new Promise((function(t,n){var r=new Image,i=new Uint8Array(e),a=new Blob([i]),o=window.URL||window.webkitURL,s=o.createObjectURL(a);r.src=s,r.onload=function(){t(r),o.revokeObjectURL(s)},r.onerror=function(e){o.revokeObjectURL(s),n(e)}}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.registerImageLoader("http",r.loadImage),e.registerImageLoader("https",r.loadImage)};var r=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.external=t.configure=t.loadImage=t.createImage=t.arrayBufferToImage=void 0;var r=s(n(3)),i=s(n(2)),a=n(1),o=n(0);function s(e){return e&&e.__esModule?e:{default:e}}var l={arrayBufferToImage:r.default,createImage:i.default,loadImage:a.loadImage,configure:a.configure,external:o.external};t.arrayBufferToImage=r.default,t.createImage=i.default,t.loadImage=a.loadImage,t.configure=a.configure,t.external=o.external,t.default=l}])},"27OZ":function(e,t,n){const r=n("iEBQ");e.exports=(e,t)=>e.sort((e,n)=>r(n,e,t))},"2wtF":function(e,t,n){const r=n("0eLh");e.exports=(e,t,n)=>r(e,t,"<",n)},3:function(e,t){},"3cPs":function(e,t,n){const r=n("IsDc");e.exports={re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:n("/kWe").SEMVER_SPEC_VERSION,SemVer:n("3wIk"),compareIdentifiers:n("KHQI").compareIdentifiers,rcompareIdentifiers:n("KHQI").rcompareIdentifiers,parse:n("Ybu3"),valid:n("gqzR"),clean:n("oBeb"),inc:n("eQf7"),diff:n("Yn5A"),major:n("Br5v"),minor:n("YJ14"),patch:n("LJ9E"),prerelease:n("O9TA"),compare:n("8GxW"),rcompare:n("oh0K"),compareLoose:n("8YLp"),compareBuild:n("iEBQ"),sort:n("lYj8"),rsort:n("27OZ"),gt:n("7sNm"),lt:n("JCZO"),eq:n("xfvg"),neq:n("dtu/"),gte:n("Dknc"),lte:n("bdwG"),cmp:n("VMJL"),coerce:n("eXNJ"),Comparator:n("vwDW"),Range:n("ex/Z"),satisfies:n("MpxT"),toComparators:n("j0pM"),maxSatisfying:n("d43V"),minSatisfying:n("ygsx"),minVersion:n("lkeM"),validRange:n("zv5s"),outside:n("0eLh"),gtr:n("VmpX"),ltr:n("2wtF"),intersects:n("18Y9"),simplifyRange:n("v6YA"),subset:n("I9dd")}},"3wIk":function(e,t,n){const r=n("DXxi"),{MAX_LENGTH:i,MAX_SAFE_INTEGER:a}=n("/kWe"),{re:o,t:s}=n("IsDc"),l=n("4S+G"),{compareIdentifiers:u}=n("KHQI");class c{constructor(e,t){if(t=l(t),e instanceof c){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>i)throw new TypeError(`version is longer than ${i} characters`);r("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?o[s.LOOSE]:o[s.FULL]);if(!n)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>a||this.major<0)throw new TypeError("Invalid major version");if(this.minor>a||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>a||this.patch<0)throw new TypeError("Invalid patch version");this.prerelease=n[4]?n[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<a)return t}return e}):[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version}toString(){return this.version}compare(e){if(r("SemVer.compare",this.version,this.options,e),!(e instanceof c)){if("string"==typeof e&&e===this.version)return 0;e=new c(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof c||(e=new c(e,this.options)),u(this.major,e.major)||u(this.minor,e.minor)||u(this.patch,e.patch)}comparePre(e){if(e instanceof c||(e=new c(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],i=e.prerelease[t];if(r("prerelease compare",t,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return u(n,i)}while(++t)}compareBuild(e){e instanceof c||(e=new c(e,this.options));let t=0;do{const n=this.build[t],i=e.build[t];if(r("prerelease compare",t,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return u(n,i)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this}}e.exports=c},4:function(e,t){},"4S+G":function(e,t){const n=["includePrerelease","loose","rtl"];e.exports=e=>e?"object"!=typeof e?{loose:!0}:n.filter(t=>e[t]).reduce((e,t)=>(e[t]=!0,e),{}):{}},5:function(e,t){},"5q2q":function(e,t,n){var r;window,r=function(){return function(e){var t=window.webpackHotUpdate;window.webpackHotUpdate=function(e,n){!function(e,t){if(x[e]&&b[e]){for(var n in b[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(p[n]=t[n]);0==--g&&0===v&&E()}}(e,n),t&&t(e,n)};var n,r=!0,i="27483cfdfb7fceb94238",a={},o=[],s=[];function l(e){var t=k[e];if(!t)return C;var r=function(r){return t.hot.active?(k[r]?-1===k[r].parents.indexOf(e)&&k[r].parents.push(e):(o=[e],n=r),-1===t.children.indexOf(r)&&t.children.push(r)):(console.warn("[HMR] unexpected require("+r+") from disposed module "+e),o=[]),C(r)},i=function(e){return{configurable:!0,enumerable:!0,get:function(){return C[e]},set:function(t){C[e]=t}}};for(var a in C)Object.prototype.hasOwnProperty.call(C,a)&&"e"!==a&&"t"!==a&&Object.defineProperty(r,a,i(a));return r.e=function(e){return"ready"===d&&h("prepare"),v++,C.e(e).then(t,(function(e){throw t(),e}));function t(){v--,"prepare"===d&&(y[e]||S(e),0===v&&0===g&&E())}},r.t=function(e,t){return 1&t&&(e=r(e)),C.t(e,-2&t)},r}function u(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:n!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var r=0;r<e.length;r++)t._acceptedDependencies[e[r]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:_,apply:T,status:function(e){if(!e)return d;c.push(e)},addStatusHandler:function(e){c.push(e)},removeStatusHandler:function(e){var t=c.indexOf(e);t>=0&&c.splice(t,1)},data:a[e]};return n=void 0,t}var c=[],d="idle";function h(e){d=e;for(var t=0;t<c.length;t++)c[t].call(null,e)}var f,p,m,g=0,v=0,y={},b={},x={};function w(e){return+e+""===e?+e:e}function _(e){if("idle"!==d)throw new Error("check() is only allowed in idle status");return r=e,h("check"),(t=1e4,t=t||1e4,new Promise((function(e,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var r=new XMLHttpRequest,a=C.p+""+i+".hot-update.json";r.open("GET",a,!0),r.timeout=t,r.send(null)}catch(o){return n(o)}r.onreadystatechange=function(){if(4===r.readyState)if(0===r.status)n(new Error("Manifest request to "+a+" timed out."));else if(404===r.status)e();else if(200!==r.status&&304!==r.status)n(new Error("Manifest request to "+a+" failed."));else{try{var t=JSON.parse(r.responseText)}catch(i){return void n(i)}e(t)}}}))).then((function(e){if(!e)return h("idle"),null;b={},y={},x=e.c,m=e.h,h("prepare");var t=new Promise((function(e,t){f={resolve:e,reject:t}}));return p={},S("cornerstoneTools"),"prepare"===d&&0===v&&0===g&&E(),t}));var t}function S(e){x[e]?(b[e]=!0,g++,function(e){var t=document.createElement("script");t.charset="utf-8",t.src=C.p+""+e+"."+i+".hot-update.js",document.head.appendChild(t)}(e)):y[e]=!0}function E(){h("ready");var e=f;if(f=null,e)if(r)Promise.resolve().then((function(){return T(r)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var n in p)Object.prototype.hasOwnProperty.call(p,n)&&t.push(w(n));e.resolve(t)}}function T(t){if("ready"!==d)throw new Error("apply() is only allowed in ready status");var n,r,s,l,u;function c(e){for(var t=[e],n={},r=t.map((function(e){return{chain:[e],id:e}}));r.length>0;){var i=r.pop(),a=i.id,o=i.chain;if((l=k[a])&&!l.hot._selfAccepted){if(l.hot._selfDeclined)return{type:"self-declined",chain:o,moduleId:a};if(l.hot._main)return{type:"unaccepted",chain:o,moduleId:a};for(var s=0;s<l.parents.length;s++){var u=l.parents[s],c=k[u];if(c){if(c.hot._declinedDependencies[a])return{type:"declined",chain:o.concat([u]),moduleId:a,parentId:u};-1===t.indexOf(u)&&(c.hot._acceptedDependencies[a]?(n[u]||(n[u]=[]),f(n[u],[a])):(delete n[u],t.push(u),r.push({chain:o.concat([u]),id:u})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];-1===e.indexOf(r)&&e.push(r)}}t=t||{};var g={},v=[],y={},b=function(){console.warn("[HMR] unexpected require("+S.moduleId+") to disposed module")};for(var _ in p)if(Object.prototype.hasOwnProperty.call(p,_)){var S;u=w(_);var E=!1,T=!1,I=!1,O="";switch((S=p[_]?c(u):{type:"disposed",moduleId:_}).chain&&(O="\nUpdate propagation: "+S.chain.join(" -> ")),S.type){case"self-declined":t.onDeclined&&t.onDeclined(S),t.ignoreDeclined||(E=new Error("Aborted because of self decline: "+S.moduleId+O));break;case"declined":t.onDeclined&&t.onDeclined(S),t.ignoreDeclined||(E=new Error("Aborted because of declined dependency: "+S.moduleId+" in "+S.parentId+O));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(S),t.ignoreUnaccepted||(E=new Error("Aborted because "+u+" is not accepted"+O));break;case"accepted":t.onAccepted&&t.onAccepted(S),T=!0;break;case"disposed":t.onDisposed&&t.onDisposed(S),I=!0;break;default:throw new Error("Unexception type "+S.type)}if(E)return h("abort"),Promise.reject(E);if(T)for(u in y[u]=p[u],f(v,S.outdatedModules),S.outdatedDependencies)Object.prototype.hasOwnProperty.call(S.outdatedDependencies,u)&&(g[u]||(g[u]=[]),f(g[u],S.outdatedDependencies[u]));I&&(f(v,[S.moduleId]),y[u]=b)}var A,D=[];for(r=0;r<v.length;r++)k[u=v[r]]&&k[u].hot._selfAccepted&&y[u]!==b&&D.push({module:u,errorHandler:k[u].hot._selfAccepted});h("dispose"),Object.keys(x).forEach((function(e){!1===x[e]&&function(e){delete installedChunks[e]}(e)}));for(var M,N=v.slice();N.length>0;)if(u=N.pop(),l=k[u]){var j={},R=l.hot._disposeHandlers;for(s=0;s<R.length;s++)(n=R[s])(j);for(a[u]=j,l.hot.active=!1,delete k[u],delete g[u],s=0;s<l.children.length;s++){var P=k[l.children[s]];P&&(A=P.parents.indexOf(u))>=0&&P.parents.splice(A,1)}}for(u in g)if(Object.prototype.hasOwnProperty.call(g,u)&&(l=k[u]))for(M=g[u],s=0;s<M.length;s++)(A=l.children.indexOf(M[s]))>=0&&l.children.splice(A,1);for(u in h("apply"),i=m,y)Object.prototype.hasOwnProperty.call(y,u)&&(e[u]=y[u]);var F=null;for(u in g)if(Object.prototype.hasOwnProperty.call(g,u)&&(l=k[u])){M=g[u];var L=[];for(r=0;r<M.length;r++)if(n=l.hot._acceptedDependencies[M[r]]){if(-1!==L.indexOf(n))continue;L.push(n)}for(r=0;r<L.length;r++){n=L[r];try{n(M)}catch(B){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:u,dependencyId:M[r],error:B}),t.ignoreErrored||F||(F=B)}}}for(r=0;r<D.length;r++){var $=D[r];o=[u=$.module];try{C(u)}catch(B){if("function"==typeof $.errorHandler)try{$.errorHandler(B)}catch(z){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:u,error:z,originalError:B}),t.ignoreErrored||F||(F=z),F||(F=B)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:u,error:B}),t.ignoreErrored||F||(F=B)}}return F?(h("fail"),Promise.reject(F)):(h("idle"),new Promise((function(e){e(v)})))}var k={};function C(t){if(k[t])return k[t].exports;var n=k[t]={i:t,l:!1,exports:{},hot:u(t),parents:(s=o,o=[],s),children:[]};return e[t].call(n.exports,n,n.exports,l(t)),n.l=!0,n.exports}return C.m=e,C.c=k,C.d=function(e,t,n){C.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},C.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},C.t=function(e,t){if(1&t&&(e=C(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(C.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)C.d(n,r,(function(t){return e[t]}).bind(null,r));return n},C.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return C.d(t,"a",t),t},C.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},C.p="",C.h=function(){return i},l("./index.js")(C.s="./index.js")}({"../node_modules/@babel/runtime/helpers/arrayWithHoles.js":function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},"../node_modules/@babel/runtime/helpers/arrayWithoutHoles.js":function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},"../node_modules/@babel/runtime/helpers/assertThisInitialized.js":function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},"../node_modules/@babel/runtime/helpers/asyncToGenerator.js":function(e,t){function n(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(u){return void n(u)}s.done?t(l):Promise.resolve(l).then(r,i)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(i,a){var o=e.apply(t,r);function s(e){n(o,i,a,s,l,"next",e)}function l(e){n(o,i,a,s,l,"throw",e)}s(void 0)}))}}},"../node_modules/@babel/runtime/helpers/classCallCheck.js":function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},"../node_modules/@babel/runtime/helpers/createClass.js":function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},"../node_modules/@babel/runtime/helpers/defineProperty.js":function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},"../node_modules/@babel/runtime/helpers/getPrototypeOf.js":function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},"../node_modules/@babel/runtime/helpers/inherits.js":function(e,t,n){var r=n("../node_modules/@babel/runtime/helpers/setPrototypeOf.js");e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},"../node_modules/@babel/runtime/helpers/iterableToArray.js":function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},"../node_modules/@babel/runtime/helpers/iterableToArrayLimit.js":function(e,t){e.exports=function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(l){i=!0,a=l}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}},"../node_modules/@babel/runtime/helpers/nonIterableRest.js":function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},"../node_modules/@babel/runtime/helpers/nonIterableSpread.js":function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},"../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js":function(e,t,n){var r=n("../node_modules/@babel/runtime/helpers/typeof.js"),i=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js");e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?i(e):t}},"../node_modules/@babel/runtime/helpers/setPrototypeOf.js":function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},"../node_modules/@babel/runtime/helpers/slicedToArray.js":function(e,t,n){var r=n("../node_modules/@babel/runtime/helpers/arrayWithHoles.js"),i=n("../node_modules/@babel/runtime/helpers/iterableToArrayLimit.js"),a=n("../node_modules/@babel/runtime/helpers/nonIterableRest.js");e.exports=function(e,t){return r(e)||i(e,t)||a()}},"../node_modules/@babel/runtime/helpers/toConsumableArray.js":function(e,t,n){var r=n("../node_modules/@babel/runtime/helpers/arrayWithoutHoles.js"),i=n("../node_modules/@babel/runtime/helpers/iterableToArray.js"),a=n("../node_modules/@babel/runtime/helpers/nonIterableSpread.js");e.exports=function(e){return r(e)||i(e)||a()}},"../node_modules/@babel/runtime/helpers/typeof.js":function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return e.exports=r="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(e){return n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},"../node_modules/@babel/runtime/regenerator/index.js":function(e,t,n){e.exports=n("../node_modules/regenerator-runtime/runtime-module.js")},"../node_modules/ms/index.js":function(e,t){var n=1e3,r=60*n,i=60*r,a=24*i;function o(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,t){t=t||{};var s,l,u=typeof e;if("string"===u&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^((?:\d+)?\-?\d?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var o=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*a;case"hours":case"hour":case"hrs":case"hr":case"h":return o*i;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===u&&!1===isNaN(e))return t.long?(s=e,(l=Math.abs(s))>=a?o(s,l,a,"day"):l>=i?o(s,l,i,"hour"):l>=r?o(s,l,r,"minute"):l>=n?o(s,l,n,"second"):s+" ms"):function(e){var t=Math.abs(e);return t>=a?Math.round(e/a)+"d":t>=i?Math.round(e/i)+"h":t>=r?Math.round(e/r)+"m":t>=n?Math.round(e/n)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},"../node_modules/process/browser.js":function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var l,u=[],c=!1,d=-1;function h(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length&&f())}function f(){if(!c){var e=s(h);c=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||c||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},"../node_modules/regenerator-runtime/runtime-module.js":function(e,t,n){var r=function(){return this||"object"==typeof self&&self}()||Function("return this")(),i=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,a=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n("../node_modules/regenerator-runtime/runtime.js"),i)r.regeneratorRuntime=a;else try{delete r.regeneratorRuntime}catch(o){r.regeneratorRuntime=void 0}},"../node_modules/regenerator-runtime/runtime.js":function(e,t){!function(t){"use strict";var n,r=Object.prototype,i=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag",u="object"==typeof e,c=t.regeneratorRuntime;if(c)u&&(e.exports=c);else{(c=t.regeneratorRuntime=u?e.exports:{}).wrap=x;var d="suspendedStart",h="suspendedYield",f="executing",p="completed",m={},g={};g[o]=function(){return this};var v=Object.getPrototypeOf,y=v&&v(v(D([])));y&&y!==r&&i.call(y,o)&&(g=y);var b=E.prototype=_.prototype=Object.create(g);S.prototype=b.constructor=E,E.constructor=S,E[l]=S.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===S||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,l in e||(e[l]="GeneratorFunction")),e.prototype=Object.create(b),e},c.awrap=function(e){return{__await:e}},T(k.prototype),k.prototype[s]=function(){return this},c.AsyncIterator=k,c.async=function(e,t,n,r){var i=new k(x(e,t,n,r));return c.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},T(b),b[l]="Generator",b[o]=function(){return this},b.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},c.values=D,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return s.type="throw",s.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),u=i.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;O(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:D(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),m}}}function x(e,t,n,r){var i=Object.create((t&&t.prototype instanceof _?t:_).prototype),a=new A(r||[]);return i._invoke=function(e,t,n){var r=d;return function(i,a){if(r===f)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw a;return M()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=C(o,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var l=w(e,t,n);if("normal"===l.type){if(r=n.done?p:h,l.arg===m)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=p,n.method="throw",n.arg=l.arg)}}}(e,n,a),i}function w(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}function _(){}function S(){}function E(){}function T(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function k(e){var t;this._invoke=function(n,r){function a(){return new Promise((function(t,a){!function t(n,r,a,o){var s=w(e[n],e,r);if("throw"!==s.type){var l=s.arg,u=l.value;return u&&"object"==typeof u&&i.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,a,o)}),(function(e){t("throw",e,a,o)})):Promise.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return t("throw",e,a,o)}))}o(s.arg)}(n,r,t,a)}))}return t=t?t.then(a,a):a()}}function C(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,C(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=w(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,m;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,m):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function D(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return a.next=a}}return{next:M}}function M(){return{value:n,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},"./drawing/draw.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){e.save(),t(e),e.restore()}},"./drawing/drawArrow.js":function(e,t,n){"use strict";n.r(t);var r=n("./drawing/drawLine.js"),i=n("./drawing/drawJoinedLines.js");t.default=function(e,t,n,a,o,s){var l=Math.atan2(n.y-t.y,n.x-t.x),u={color:a,lineWidth:o};s&&(u.lineDash=s),Object(r.default)(e,void 0,t,n,u,"canvas"),u={color:a,lineWidth:o,fillStyle:a};var c=[{x:n.x-10*Math.cos(l-Math.PI/7),y:n.y-10*Math.sin(l-Math.PI/7)},{x:n.x-10*Math.cos(l+Math.PI/7),y:n.y-10*Math.sin(l+Math.PI/7)},n];Object(i.default)(e,void 0,n,c,u,"canvas")}},"./drawing/drawCircle.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./drawing/path.js");t.default=function(e,t,n,a,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";"pixel"===s&&(n=r.default.cornerstone.pixelToCanvas(t,n)),Object(i.default)(e,o,(function(e){e.arc(n.x,n.y,a,0,2*Math.PI)}))}},"./drawing/drawEllipse.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./drawing/path.js"),a=n("./util/pointProjector.js");t.default=function(e,t,n,o,s){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel",u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;"pixel"===l&&(n=r.default.cornerstone.pixelToCanvas(t,n),o=r.default.cornerstone.pixelToCanvas(t,o));var c=r.default.cornerstone.getViewport(t),d=t.clientWidth,h=t.clientHeight,f=c.scale,p=c.translation,m=c.rotation-u,g={x:d/2+p.x*f,y:h/2+p.y*f};Math.abs(m)>.05&&(n=Object(a.rotatePoint)(n,g,-m),o=Object(a.rotatePoint)(o,g,-m));var v=Math.abs(n.x-o.x),y=Math.abs(n.y-o.y),b=Math.min(n.x,o.x),x=Math.min(n.y,o.y),w={x:b+v/2,y:x+y/2};Math.abs(m)>.05&&(w=Object(a.rotatePoint)(w,g,m));var _=m*Math.PI/180;Object(i.default)(e,s,(function(e){e.ellipse(w.x,w.y,v/2,y/2,_,0,2*Math.PI),e.closePath()}))}},"./drawing/drawHandles.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./stateManagement/toolStyle.js"),a=n("./stateManagement/toolColors.js"),o=n("./drawing/path.js"),s=n("./store/index.js");t.default=function(e,t,n){var l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=t.element,c=a.default.getToolColor();e.strokeStyle=l.color||c;for(var d=Object.keys(n),h=function(t){var a=n[d[t]];if(!0===a.drawnIndependently)return"continue";if(!0===l.drawHandlesIfActive&&!a.active)return"continue";if(l.hideHandlesIfMoving&&a.moving)return"continue";var c={lineWidth:a.active?i.default.getActiveWidth():i.default.getToolWidth(),fillStyle:l.fill};l.lineDash&&(c.lineDash=l.lineDash),Object(o.default)(e,c,(function(e){var t=r.default.cornerstone.pixelToCanvas(u,a);e.arc(t.x,t.y,a.radius||l.handleRadius||s.state.handleRadius,0,2*Math.PI)}))},f=0;f<d.length;f++)h(f)}},"./drawing/drawJoinedLines.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./drawing/path.js");t.default=function(e,t,n,a,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";Object(i.default)(e,o,(function(e){"pixel"===s&&(n=r.default.cornerstone.pixelToCanvas(t,n),a=a.map((function(e){return r.default.cornerstone.pixelToCanvas(t,e)}))),e.moveTo(n.x,n.y),a.forEach((function(t){e.lineTo(t.x,t.y)}))}))}},"./drawing/drawLine.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=n("./externalModules.js"),i=n("./drawing/path.js");function a(e,t,n,a,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";Object(i.default)(e,o,(function(e){"pixel"===s&&(n=r.default.cornerstone.pixelToCanvas(t,n),a=r.default.cornerstone.pixelToCanvas(t,a)),e.moveTo(n.x,n.y),e.lineTo(a.x,a.y)}))}},"./drawing/drawLines.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./drawing/path.js");t.default=function(e,t,n,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"pixel";Object(i.default)(e,a,(function(e){n.forEach((function(n){var i=n.start,a=n.end;if("pixel"===o){var s=r.default.cornerstone;i=s.pixelToCanvas(t,i),a=s.pixelToCanvas(t,a)}e.moveTo(i.x,i.y),e.lineTo(a.x,a.y)}))}))}},"./drawing/drawLink.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./drawing/drawLine.js");t.default=function(e,t,n,a,o,s){var l=e.length>0?r.default.cornerstoneMath.point.findClosestPoint(e,t):t,u=r.default.cornerstoneMath.point.findClosestPoint([{x:n.left+n.width/2,y:n.top},{x:n.left,y:n.top+n.height/2},{x:n.left+n.width/2,y:n.top+n.height},{x:n.left+n.width,y:n.top+n.height/2}],l),c={color:o,lineWidth:s,lineDash:[2,3]};Object(i.default)(a,void 0,l,u,c,"canvas")}},"./drawing/drawLinkedTextBox.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./drawing/drawTextBox.js"),a=n("./drawing/drawLink.js");t.default=function(e,t,n,o,s,l,u,c,d,h){var f=r.default.cornerstone,p=f.pixelToCanvas(t,n);d&&(p.x+=d);var m={centering:{x:!1,y:h}};if(n.boundingBox=Object(i.default)(e,o,p.x,p.y,u,m),n.hasMoved){var g=l(s).map((function(e){return f.pixelToCanvas(t,e)}));Object(a.default)(g,p,n.boundingBox,e,u,c)}}},"./drawing/drawRect.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./drawing/path.js"),a=n("./util/pointProjector.js");t.default=function(e,t,n,o,s){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel",u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if("pixel"===l){var c=r.default.cornerstone;n=c.pixelToCanvas(t,n),o=c.pixelToCanvas(t,o)}var d=r.default.cornerstone.getViewport(t),h=t.clientWidth,f=t.clientHeight,p=d.scale,m=d.translation,g=d.rotation-u,v={x:h/2+m.x*p,y:f/2+m.y*p};Math.abs(g)>.05&&(n=Object(a.rotatePoint)(n,v,-g),o=Object(a.rotatePoint)(o,v,-g));var y=Math.abs(n.x-o.x),b=Math.abs(n.y-o.y);n={x:Math.min(n.x,o.x),y:Math.min(n.y,o.y)},o={x:n.x+y,y:n.y+b};var x={x:n.x+y,y:n.y},w={x:n.x,y:n.y+b};Math.abs(g)>.05&&(n=Object(a.rotatePoint)(n,v,g),o=Object(a.rotatePoint)(o,v,g),x=Object(a.rotatePoint)(x,v,g),w=Object(a.rotatePoint)(w,v,g)),Object(i.default)(e,s,(function(e){e.moveTo(n.x,n.y),e.lineTo(x.x,x.y),e.lineTo(o.x,o.y),e.lineTo(w.x,w.y),e.lineTo(n.x,n.y)}))}},"./drawing/drawTextBox.js":function(e,t,n){"use strict";n.r(t),n.d(t,"textBoxWidth",(function(){return s}));var r=n("./stateManagement/textStyle.js"),i=n("./drawing/draw.js"),a=n("./drawing/fillTextLines.js"),o=n("./drawing/fillBox.js");function s(e,t,n){var i=r.default.getFont(),a=e.font;i&&i!==a&&(e.font=i);var o=e.measureText(t).width;return i&&i!==a&&(e.font=a),o+2*n}t.default=function(e,t,n,l,u,c){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var d=r.default.getFontSize(),h=r.default.getBackgroundColor(),f=0;t.forEach((function(t){var n=s(e,t,5);f=Math.max(f,n)}));var p={width:f,height:5+t.length*(d+5)};return Object(i.default)(e,(function(e){e.strokeStyle=u,c&&c.centering&&!0===c.centering.x&&(n-=p.width/2),c&&c.centering&&!0===c.centering.y&&(l-=p.height/2),p.left=n,p.top=l;var r=c&&!0===c.debug?"#FF0000":h;Object(o.default)(e,p,r),Object(a.default)(e,p,t,u,5)})),p}},"./drawing/fillBox.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){e.fillStyle=n,e.fillRect(t.left,t.top,t.width,t.height)}},"./drawing/fillOutsideRect.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./drawing/path.js");t.default=function(e,t,n,a,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";if("pixel"===s){var l=r.default.cornerstone;n=l.pixelToCanvas(t,n),a=l.pixelToCanvas(t,a)}var u=Math.min(n.x,a.x),c=Math.min(n.y,a.y),d=Math.abs(n.x-a.x),h=Math.abs(n.y-a.y);Object(i.default)(e,o,(function(e){e.rect(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.rect(u+d,c,-d,h)}))}},"./drawing/fillTextLines.js":function(e,t,n){"use strict";n.r(t);var r=n("./stateManagement/textStyle.js");t.default=function(e,t,n,i,a){var o=r.default.getFontSize();e.font=r.default.getFont(),e.textBaseline="top",e.fillStyle=i,n.forEach((function(n,r){e.fillText(n,t.left+a,t.top+a+r*(o+a))}))}},"./drawing/getNewContext.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=e.getContext("2d");return t.setTransform(1,0,0,1,0,0),t}},"./drawing/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./drawing/draw.js");n.d(t,"draw",(function(){return r.default}));var i=n("./drawing/drawArrow.js");n.d(t,"drawArrow",(function(){return i.default}));var a=n("./drawing/drawCircle.js");n.d(t,"drawCircle",(function(){return a.default}));var o=n("./drawing/drawEllipse.js");n.d(t,"drawEllipse",(function(){return o.default}));var s=n("./drawing/drawHandles.js");n.d(t,"drawHandles",(function(){return s.default}));var l=n("./drawing/drawJoinedLines.js");n.d(t,"drawJoinedLines",(function(){return l.default}));var u=n("./drawing/drawLine.js");n.d(t,"drawLine",(function(){return u.default}));var c=n("./drawing/drawLines.js");n.d(t,"drawLines",(function(){return c.default}));var d=n("./drawing/drawLink.js");n.d(t,"drawLink",(function(){return d.default}));var h=n("./drawing/drawLinkedTextBox.js");n.d(t,"drawLinkedTextBox",(function(){return h.default}));var f=n("./drawing/drawRect.js");n.d(t,"drawRect",(function(){return f.default}));var p=n("./drawing/drawTextBox.js");n.d(t,"drawTextBox",(function(){return p.default}));var m=n("./drawing/fillBox.js");n.d(t,"fillBox",(function(){return m.default}));var g=n("./drawing/fillOutsideRect.js");n.d(t,"fillOutsideRect",(function(){return g.default}));var v=n("./drawing/fillTextLines.js");n.d(t,"fillTextLines",(function(){return v.default}));var y=n("./drawing/getNewContext.js");n.d(t,"getNewContext",(function(){return y.default}));var b=n("./drawing/path.js");n.d(t,"path",(function(){return b.default}));var x=n("./drawing/setShadow.js");n.d(t,"setShadow",(function(){return x.default}));var w=n("./drawing/transformCanvasContext.js");n.d(t,"transformCanvasContext",(function(){return w.default}));var _=n("./drawing/resetCanvasContextTransform.js");n.d(t,"resetCanvasContextTransform",(function(){return _.default}))},"./drawing/path.js":function(e,t,n){"use strict";n.r(t);var r=n("./stateManagement/toolStyle.js");t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=t.color,a=t.lineWidth,o=t.fillStyle,s=t.lineDash,l=t.shouldDrawLines,u=void 0===l||l;e.beginPath(),e.strokeStyle=i||e.strokeStyle,e.lineWidth=a||void 0===a&&r.default.getToolWidth()||e.lineWidth,s&&e.setLineDash(s),n(e),o&&(e.fillStyle=o,e.fill()),u&&e.stroke(),s&&e.setLineDash([])}},"./drawing/resetCanvasContextTransform.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){e.setTransform(1,0,0,1,0,0)}},"./drawing/setShadow.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/getDefault.js");t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.shadow&&(e.shadowColor=Object(r.default)(t.shadowColor,"#000000"),e.shadowBlur=Object(r.default)(t.shadowBlur,0),e.shadowOffsetX=Object(r.default)(t.shadowOffsetX,1),e.shadowOffsetY=Object(r.default)(t.shadowOffsetY,1))}},"./drawing/transformCanvasContext.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){if(n.hflip||n.vflip||n.rotation){var r={x:t.width/2+n.translation.x*n.scale,y:t.height/2+n.translation.y*n.scale};e.translate(r.x,r.y),n.rotation&&e.rotate(n.rotation*Math.PI/180),n.vflip&&e.scale(1,-1),n.hflip&&e.scale(-1,1),e.translate(-r.x,-r.y)}}},"./eventDispatchers/imageRenderedEventDispatcher.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./stateManagement/toolState.js"),a=n("./eventListeners/onImageRenderedBrushEventHandler.js"),o=n("./externalModules.js"),s=Object(r.getModule)("segmentation"),l=function(e){var t=e.detail,n=t.element,o=r.state.tools.filter((function(e){return e.element===n&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)})),l=Object(i.getToolState)(n,"stack"),u=s.configuration;l&&(u.renderFill||u.renderOutline)&&Object(a.default)(e);var c=t.canvasContext.canvas.getContext("2d");o.forEach((function(t){t.renderToolData&&(c.save(),t.renderToolData(e),c.restore())}))};t.default={enable:function(e){e.addEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,l)},disable:function(e){e.removeEventListener(o.default.cornerstone.EVENTS.IMAGE_RENDERED,l)}}},"./eventDispatchers/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./eventDispatchers/imageRenderedEventDispatcher.js");n.d(t,"imageRenderedEventDispatcher",(function(){return r.default}));var i=n("./eventDispatchers/mouseToolEventDispatcher.js");n.d(t,"mouseToolEventDispatcher",(function(){return i.default}));var a=n("./eventDispatchers/newImageEventDispatcher.js");n.d(t,"newImageEventDispatcher",(function(){return a.default}));var o=n("./eventDispatchers/touchToolEventDispatcher.js");n.d(t,"touchToolEventDispatcher",(function(){return o.default}))},"./eventDispatchers/mouseEventHandlers/addNewMeasurement.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./externalModules.js"),a=n("./stateManagement/toolState.js"),o=n("./manipulators/index.js"),s=n("./util/logger.js"),l=n("./util/triggerEvent.js"),u=Object(s.getLogger)("eventDispatchers:mouseEventHandlers");t.default=function(e,t){u.log("addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,s=n.element,c=t.createNewMeasurement(n);c&&(Object(a.addToolState)(s,t.name,c),i.default.cornerstone.updateImage(s),(1===Object.keys(c.handles).length?o.moveHandle:o.moveNewHandle)(n,t.name,c,c.handles.end,t.options,"mouse",(function(e){if(!c.cancelled)if(e){var n=r.default.MEASUREMENT_COMPLETED,i={toolName:t.name,toolType:t.name,element:s,measurementData:c};Object(l.default)(s,n,i)}else Object(a.removeToolState)(s,t.name,c)})))}},"./eventDispatchers/mouseEventHandlers/index.js":function(e,t,n){"use strict";n.r(t),n.d(t,"mouseClick",(function(){return l})),n.d(t,"mouseDoubleClick",(function(){return u})),n.d(t,"mouseUp",(function(){return c})),n.d(t,"mouseWheel",(function(){return d}));var r=n("./eventDispatchers/shared/customCallbackHandler.js"),i=n("./eventDispatchers/mouseEventHandlers/mouseDown.js");n.d(t,"mouseDown",(function(){return i.default}));var a=n("./eventDispatchers/mouseEventHandlers/mouseDownActivate.js");n.d(t,"mouseDownActivate",(function(){return a.default}));var o=n("./eventDispatchers/mouseEventHandlers/mouseDrag.js");n.d(t,"mouseDrag",(function(){return o.default}));var s=n("./eventDispatchers/mouseEventHandlers/mouseMove.js");n.d(t,"mouseMove",(function(){return s.default}));var l=r.default.bind(null,"Mouse","mouseClickCallback"),u=r.default.bind(null,"Mouse","doubleClickCallback"),c=r.default.bind(null,"Mouse","mouseUpCallback"),d=r.default.bind(null,"MouseWheel","mouseWheelCallback")},"./eventDispatchers/mouseEventHandlers/mouseDown.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./stateManagement/toolState.js"),a=n("./store/getToolsWithMoveableHandles.js"),o=n("./util/findAndMoveHelpers.js"),s=n("./store/getInteractiveToolsForElement.js"),l=n("./store/getToolsWithDataForElement.js"),u=n("./store/filterToolsUsableWithMultiPartTools.js");t.default=function(e){if(!r.state.isToolLocked){var t=e.detail,n=e.detail.element,c=e.detail.currentPoints.canvas,d=Object(s.default)(n,r.getters.mouseTools()),h=d.filter((function(e){return"active"===e.mode&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(t.buttons)&&e.options.isMouseActive}));if(r.state.isMultiPartToolActive&&(h=Object(u.default)(h)),h.length>0){var f=h.find((function(e){return"function"==typeof e.preMouseDownCallback}));if(f&&f.preMouseDownCallback(e))return}if(!r.state.isMultiPartToolActive){var p=Object(l.default)(n,d),m=Object(a.default)(n,p,c,"mouse");if(m.length>0){var g=m[0],v=Object(i.getToolState)(n,g.name),y=Object(o.findHandleDataNearImagePoint)(n,v,g.name,c);g.handleSelectedCallback(e,y.data,y.handle,"mouse")}else{var b=d.filter((function(e){var t=Object(i.getToolState)(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,c,"mouse")}))}));if(b.length>0){var x=b[0],w=Object(i.getToolState)(n,x.name).data.find((function(e){return x.pointNearTool(n,e,c)}));x.toolSelectedCallback(e,w,"mouse")}else if(h.length>0){var _=h.find((function(e){return"function"==typeof e.postMouseDownCallback}));if(_&&_.postMouseDownCallback(e))return}}}}}},"./eventDispatchers/mouseEventHandlers/mouseDownActivate.js":function(e,t,n){"use strict";n.r(t);var r=n("./eventDispatchers/mouseEventHandlers/addNewMeasurement.js"),i=n("./store/index.js"),a=n("./tools/base/BaseAnnotationTool.js"),o=n("./util/getActiveTool.js");t.default=function(e){if(!i.state.isToolLocked){var t=e.detail,n=t.element,s=t.buttons,l=Object(o.default)(n,s,"mouse");if(l){if("function"==typeof l.preMouseDownActivateCallback&&l.preMouseDownActivateCallback(e))return;i.state.isMultiPartToolActive||(l.addNewMeasurement?l.addNewMeasurement(e,"mouse"):l instanceof a.default&&Object(r.default)(e,l))}}}},"./eventDispatchers/mouseEventHandlers/mouseDrag.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./store/getActiveToolsForElement.js"),a=n("./store/filterToolsUsableWithMultiPartTools.js");t.default=function(e){if(!r.state.isToolLocked){var t,n=e.detail,o=n.element;t=(t=(t=Object(i.default)(o,r.getters.mouseTools())).filter((function(e){return Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(n.buttons)&&e.options.isMouseActive}))).filter((function(e){return"function"==typeof e.mouseDragCallback})),r.state.isMultiPartToolActive&&(t=Object(a.default)(t)),0!==t.length&&t[0].mouseDragCallback(e)}}},"./eventDispatchers/mouseEventHandlers/mouseMove.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./store/index.js"),a=n("./store/getInteractiveToolsForElement.js"),o=n("./store/getToolsWithDataForElement.js");t.default=function(e){if(!i.state.isToolLocked&&!i.state.isMultiPartToolActive){var t,n=e.detail,s=n.element;i.state.mousePositionImage=n.currentPoints.image;var l=(t=Object(a.default)(s,i.getters.mouseTools())).filter((function(e){return"active"===e.mode&&e.options.isMouseActive})),u=!1;l.length>0&&(u=l.some((function(e){return e.updateOnMouseMove}))),t=Object(o.default)(s,t);for(var c=0;c<t.length;c++){var d=t[c];"function"==typeof d.mouseMoveCallback&&(u=d.mouseMoveCallback(e)||u)}!0===u&&r.default.cornerstone.updateImage(s)}}},"./eventDispatchers/mouseToolEventDispatcher.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./eventDispatchers/mouseEventHandlers/index.js");t.default={enable:function(e){e.addEventListener(r.default.MOUSE_CLICK,i.mouseClick),e.addEventListener(r.default.MOUSE_DOWN,i.mouseDown),e.addEventListener(r.default.MOUSE_DOWN_ACTIVATE,i.mouseDownActivate),e.addEventListener(r.default.MOUSE_DOUBLE_CLICK,i.mouseDoubleClick),e.addEventListener(r.default.MOUSE_DRAG,i.mouseDrag),e.addEventListener(r.default.MOUSE_MOVE,i.mouseMove),e.addEventListener(r.default.MOUSE_UP,i.mouseUp),e.addEventListener(r.default.MOUSE_WHEEL,i.mouseWheel)},disable:function(e){e.removeEventListener(r.default.MOUSE_CLICK,i.mouseClick),e.removeEventListener(r.default.MOUSE_DOWN,i.mouseDown),e.removeEventListener(r.default.MOUSE_DOWN_ACTIVATE,i.mouseDownActivate),e.removeEventListener(r.default.MOUSE_DOUBLE_CLICK,i.mouseDoubleClick),e.removeEventListener(r.default.MOUSE_DRAG,i.mouseDrag),e.removeEventListener(r.default.MOUSE_MOVE,i.mouseMove),e.removeEventListener(r.default.MOUSE_UP,i.mouseUp),e.removeEventListener(r.default.MOUSE_WHEEL,i.mouseWheel)}}},"./eventDispatchers/newImageEventDispatcher.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./externalModules.js"),a=function(e){if(r.state.isToolLocked)return!1;var t=e.detail.element,n=r.state.tools.filter((function(e){return e.element===t&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)}));if(0===n.length)return!1;n.forEach((function(t){t.newImageCallback&&t.newImageCallback(e)}))};t.default={enable:function(e){e.addEventListener(i.default.cornerstone.EVENTS.NEW_IMAGE,a)},disable:function(e){e.removeEventListener(i.default.cornerstone.EVENTS.NEW_IMAGE,a)}}},"./eventDispatchers/shared/customCallbackHandler.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./store/getActiveToolsForElement.js"),a=n("./store/filterToolsUsableWithMultiPartTools.js");t.default=function(e,t,n){if(r.state.isToolLocked)return!1;var o=n.detail.element,s=r.state.tools.filter((function(t){return t.supportedInteractionTypes.includes(e)}));if(s=(s=Object(i.default)(o,s,e)).filter((function(e){return"function"==typeof e[t]})),r.state.isMultiPartToolActive&&(s=Object(a.default)(s)),0===s.length)return!1;s[0][t](n)}},"./eventDispatchers/touchEventHandlers/addNewMeasurement.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./externalModules.js"),a=n("./store/index.js"),o=n("./manipulators/anyHandlesOutsideImage.js"),s=n("./manipulators/index.js"),l=n("./stateManagement/toolState.js"),u=n("./util/triggerEvent.js"),c=n("./util/logger.js"),d=Object(c.getLogger)("eventDispatchers:touchEventHandlers");t.default=function(e,t){d.log("addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,c=n.element,h=t.createNewMeasurement(n);if(h){if(Object(l.addToolState)(c,t.name,h),1===Object.keys(h.handles).length&&n.type===r.default.TAP)return h.active=!1,h.handles.end.active=!1,h.handles.end.highlight=!1,h.invalidated=!0,(a.state.deleteIfHandleOutsideImage||t.options.deleteIfHandleOutsideImage)&&Object(o.default)(n,h.handles)&&Object(l.removeToolState)(c,t.name,h),void i.default.cornerstone.updateImage(c);i.default.cornerstone.updateImage(c),Object(s.moveNewHandle)(n,t.name,h,h.handles.end,t.options,"touch",(function(){var e=r.default.MEASUREMENT_COMPLETED,n={toolName:t.name,toolType:t.name,element:c,measurementData:h};Object(u.default)(c,e,n)}))}}},"./eventDispatchers/touchEventHandlers/index.js":function(e,t,n){"use strict";n.r(t),n.d(t,"doubleTap",(function(){return l})),n.d(t,"touchDrag",(function(){return u})),n.d(t,"touchEnd",(function(){return c})),n.d(t,"touchPinch",(function(){return d})),n.d(t,"touchPress",(function(){return h})),n.d(t,"touchRotate",(function(){return f}));var r=n("./eventDispatchers/shared/customCallbackHandler.js"),i=n("./eventDispatchers/touchEventHandlers/multiTouchDrag.js");n.d(t,"multiTouchDrag",(function(){return i.default}));var a=n("./eventDispatchers/touchEventHandlers/tap.js");n.d(t,"tap",(function(){return a.default}));var o=n("./eventDispatchers/touchEventHandlers/touchStart.js");n.d(t,"touchStart",(function(){return o.default}));var s=n("./eventDispatchers/touchEventHandlers/touchStartActive.js");n.d(t,"touchStartActive",(function(){return s.default}));var l=r.default.bind(null,"DoubleTap","doubleTapCallback"),u=r.default.bind(null,"Touch","touchDragCallback"),c=r.default.bind(null,"Touch","touchEndCallback"),d=r.default.bind(null,"TouchPinch","touchPinchCallback"),h=r.default.bind(null,"Touch","touchPressCallback"),f=r.default.bind(null,"TouchRotate","touchRotateCallback")},"./eventDispatchers/touchEventHandlers/multiTouchDrag.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./store/getActiveToolsForElement.js"),a=n("./store/filterToolsUsableWithMultiPartTools.js");t.default=function(e){if(r.state.isToolLocked)return!1;var t=e.detail,n=t.element,o=t.numPointers,s=r.state.tools.filter((function(e){return e.supportedInteractionTypes.includes("MultiTouch")}));if(s=(s=Object(i.default)(n,s,"MultiTouch")).filter((function(e){return"function"==typeof e.multiTouchDragCallback&&o===e.configuration.touchPointers})),r.state.isMultiPartToolActive&&(s=Object(a.default)(s)),0===s.length)return!1;s[0].multiTouchDragCallback(e)}},"./eventDispatchers/touchEventHandlers/shared/deactivateAllToolInstances.js":function(e,t,n){"use strict";function r(e){Object.keys(e).forEach((function(t){e[t].active=!1}))}n.r(t),t.default=function(e){if(e)for(var t=0;t<e.data.length;t++){var n=e.data[t];n.active=!1,n.handles&&r(n.handles)}}},"./eventDispatchers/touchEventHandlers/tap.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./eventDispatchers/touchEventHandlers/touchStartActive.js"),a=n("./store/index.js"),o=n("./store/getActiveToolsForElement.js"),s=n("./store/getToolsWithDataForElement.js"),l=n("./stateManagement/toolState.js"),u=n("./manipulators/getHandleNearImagePoint.js"),c=n("./manipulators/index.js"),d=n("./eventDispatchers/touchEventHandlers/shared/deactivateAllToolInstances.js");t.default=function(e){if(!a.state.isToolLocked&&!a.state.isMultiPartToolActive){var t,n=e.detail.element,h=e.detail.currentPoints.canvas;t=Object(o.default)(n,a.getters.touchTools());var f=(t=Object(s.default)(n,t)).filter((function(e){for(var t=Object(l.getToolState)(n,e.name),r=0;r<t.data.length;r++)if(void 0!==Object(u.default)(n,t.data[r].handles,h,28))return!0;return!1}));if(f.length>0){var p=f[0],m=Object(l.getToolState)(n,p.name),g=m.data.find((function(e){return void 0!==Object(u.default)(n,e.handles,h,28)}));return m.data.active=!0,g.active=!0,r.default.cornerstone.updateImage(n),Object(c.moveHandle)(e.detail,p.name,m.data,g,p.options,"touch",(function(){return Object(d.default)(m)})),e.stopImmediatePropagation(),void e.preventDefault()}var v=t.filter((function(e){var t=Object(l.getToolState)(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,h)}))}));if(v.length>0){var y=v[0],b=Object(l.getToolState)(n,y.name),x=b.data.find((function(e){return y.pointNearTool(n,e,h)}));return x.active=!0,r.default.cornerstone.updateImage(n),Object(c.moveAllHandles)(e.detail,y.name,x,null,y.options,"touch",(function(){return Object(d.default)(b)})),e.stopImmediatePropagation(),void e.preventDefault()}var w=Object(o.default)(n,a.getters.touchTools());return w.length>0&&w[0].touchStartActiveCallback?w[0].touchStartActiveCallback(e):Object(i.default)(e),!1}}},"./eventDispatchers/touchEventHandlers/touchStart.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./util/findAndMoveHelpers.js"),a=n("./store/getToolsWithMoveableHandles.js"),o=n("./stateManagement/toolState.js"),s=n("./store/getInteractiveToolsForElement.js"),l=n("./store/getToolsWithDataForElement.js"),u=n("./store/filterToolsUsableWithMultiPartTools.js");t.default=function(e){if(!r.state.isToolLocked){var t=e.detail,n=t.element,c=t.startPoints.canvas,d=Object(s.default)(n,r.getters.touchTools()),h=d.filter((function(e){return"active"===e.mode&&e.options.isTouchActive}));if(r.state.isMultiPartToolActive&&(h=Object(u.default)(h)),h.length>0){var f=h.find((function(e){return"function"==typeof e.preTouchStartCallback}));if(f&&f.preTouchStartCallback(e))return}if(!r.state.isMultiPartToolActive){var p=Object(l.default)(n,d),m=Object(a.default)(n,p,c,"touch");if(m.length>0){var g=m[0],v=Object(o.getToolState)(n,g.name),y=Object(i.findHandleDataNearImagePoint)(n,v,g.name,c,"touch");g.handleSelectedCallback(e,y.data,y.handle,"touch")}else{var b=p.filter((function(e){var t=Object(o.getToolState)(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,c,"touch")}))}));if(b.length>0){var x=b[0],w=Object(o.getToolState)(n,x.name).data.find((function(e){return x.pointNearTool(n,e,c)}));x.toolSelectedCallback(e,w,"touch")}else if(h.length>0){var _=h.find((function(e){return"function"==typeof e.postTouchStartCallback}));if(_&&_.postTouchStartCallback(e))return}}}}}},"./eventDispatchers/touchEventHandlers/touchStartActive.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./eventDispatchers/touchEventHandlers/addNewMeasurement.js"),a=n("./tools/base/BaseAnnotationTool.js"),o=n("./util/getActiveTool.js");t.default=function(e){if(!r.state.isToolLocked&&!r.state.isMultiPartToolActive){var t=e.detail.element,n=Object(o.default)(t,null,"touch");n&&n.addNewMeasurement?n.addNewMeasurement(e,"touch"):n instanceof a.default&&Object(i.default)(e,n)}}},"./eventDispatchers/touchToolEventDispatcher.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./eventDispatchers/touchEventHandlers/index.js");t.default={enable:function(e){e.addEventListener(r.default.TAP,i.tap),e.addEventListener(r.default.TOUCH_START,i.touchStart,{passive:!1}),e.addEventListener(r.default.TOUCH_DRAG,i.touchDrag,{passive:!1}),e.addEventListener(r.default.TOUCH_END,i.touchEnd),e.addEventListener(r.default.TOUCH_START_ACTIVE,i.touchStartActive),e.addEventListener(r.default.TOUCH_PRESS,i.touchPress),e.addEventListener(r.default.DOUBLE_TAP,i.doubleTap),e.addEventListener(r.default.TOUCH_PINCH,i.touchPinch),e.addEventListener(r.default.TOUCH_ROTATE,i.touchRotate),e.addEventListener(r.default.MULTI_TOUCH_DRAG,i.multiTouchDrag)},disable:function(e){e.removeEventListener(r.default.TAP,i.tap),e.removeEventListener(r.default.TOUCH_START,i.touchStart),e.removeEventListener(r.default.TOUCH_DRAG,i.touchDrag),e.removeEventListener(r.default.TOUCH_END,i.touchEnd),e.removeEventListener(r.default.TOUCH_START_ACTIVE,i.touchStartActive),e.removeEventListener(r.default.TOUCH_PRESS,i.touchPress),e.removeEventListener(r.default.DOUBLE_TAP,i.doubleTap),e.removeEventListener(r.default.TOUCH_PINCH,i.touchPinch),e.removeEventListener(r.default.TOUCH_ROTATE,i.touchRotate),e.removeEventListener(r.default.MULTI_TOUCH_DRAG,i.multiTouchDrag)}}},"./eventListeners/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./eventListeners/mouseEventListeners.js");n.d(t,"mouseEventListeners",(function(){return r.default}));var i=n("./eventListeners/wheelEventListener.js");n.d(t,"wheelEventListener",(function(){return i.default}));var a=n("./eventListeners/touchEventListeners.js");n.d(t,"touchEventListeners",(function(){return a.default}))},"./eventListeners/internals/normalizeWheel.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=0,n=0,r=0,i=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),r=10*t,i=10*n,"deltaY"in e&&(i=e.deltaY),"deltaX"in e&&(r=e.deltaX),(r||i)&&e.deltaMode&&(1===e.deltaMode?(r*=40,i*=40):(r*=800,i*=800)),r&&!t&&(t=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:t,spinY:n,pixelX:r,pixelY:i}}},"./eventListeners/internals/renderSegmentation.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));var r=n("./store/index.js"),i=n("./eventListeners/internals/renderSegmentationFill.js"),a=n("./eventListeners/internals/renderSegmentationOutline.js"),o=Object(r.getModule)("segmentation");function s(e,t,n,r,s){(function(e){var t=o.configuration;return t.renderFill&&(e&&0!==t.fillAlpha||!e&&0!==t.fillAlphaInactive)})(s)&&Object(i.default)(e,t,r,n,s),function(e){var t=o.configuration;return t.renderOutline&&(e&&0!==t.outlineAlpha||!e&&0!==t.outlineAlphaInactive)}(s)&&Object(a.default)(e,t,r,n,s)}},"./eventListeners/internals/renderSegmentationFill.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s})),n.d(t,"getLabelmapCanvas",(function(){return l})),n.d(t,"renderFill",(function(){return u}));var r=n("./store/index.js"),i=n("./drawing/index.js"),a=n("./externalModules.js"),o=Object(r.getModule)("segmentation");function s(e,t,n,r,i){u(e,l(e,t,n),i)}function l(e,t,n){var r=e.detail.image,a=r.width,s=r.height,l=t.segmentsHidden,u=n.pixelData,c=o.state.colorLutTables[t.colorLUTIndex],d=document.createElement("canvas");d.width=a,d.height=s;for(var h=Object(i.getNewContext)(d),f=new ImageData(a,s),p=f.data,m=0;m<u.length;m++){var g=u[m];if(0!==g&&!l[g]){var v=c[u[m]];p[4*m]=v[0],p[4*m+1]=v[1],p[4*m+2]=v[2],p[4*m+3]=v[3]}}return h.putImageData(f,0,0),d}function u(e,t,n){var r=o.configuration,s=e.detail,l=Object(i.getNewContext)(s.canvasContext.canvas),u=a.default.cornerstone.pixelToCanvas(s.element,{x:0,y:0}),c=a.default.cornerstone.pixelToCanvas(s.element,{x:s.image.width,y:0}),d=a.default.cornerstone.pixelToCanvas(s.element,{x:s.image.width,y:s.image.height}),h=a.default.cornerstoneMath.point.distance(u,c),f=a.default.cornerstoneMath.point.distance(c,d),p=s.canvasContext.canvas,m=s.viewport,g=l.imageSmoothingEnabled,v=l.globalAlpha;l.imageSmoothingEnabled=!1,l.globalAlpha=n?r.fillAlpha:r.fillAlphaInactive,Object(i.transformCanvasContext)(l,p,m);var y=function(e){var t=e.viewport,n=e.image,r=t.scale,i=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?r*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(i*=n.rowPixelSpacing/n.columnPixelSpacing),{x:t.translation.x*r,y:t.translation.y*i}}(s);l.drawImage(t,p.width/2-h/2+y.x,p.height/2-f/2+y.y,h,f),l.globalAlpha=v,l.imageSmoothingEnabled=g,Object(i.resetCanvasContextTransform)(l)}},"./eventListeners/internals/renderSegmentationOutline.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s})),n.d(t,"renderOutline",(function(){return l})),n.d(t,"getOutline",(function(){return u})),n.d(t,"_addTopRightCorner",(function(){return h}));var r=n("./store/index.js"),i=n("./externalModules.js"),a=n("./drawing/index.js"),o=(n("./index.js"),Object(r.getModule)("segmentation"));function s(e,t,n,r,i){l(e,u(e,t,n,o.configuration.outlineWidth),t.colorLUTIndex,i)}function l(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=o.configuration,s=o.state,l=e.detail,u=l.element,c=l.canvasContext,d=i.outlineWidth||1,h=Object(a.getNewContext)(c.canvas),f=s.colorLutTables[n],p=h.globalAlpha;h.globalAlpha=r?i.outlineAlpha:i.outlineAlphaInactive,Object(a.draw)(h,(function(e){for(var n=1;n<t.length;n++)if(t[n]){var r=f[n];Object(a.drawLines)(e,u,t[n],{color:"rgba(".concat(r[0],", ").concat(r[1],", ").concat(r[2],", 1.0 )"),lineWidth:d},"canvas")}})),h.globalAlpha=p}function u(e,t,n,r){var i=e.detail,a=i.element,o=i.image,s=i.viewport,l=o.width,u=o.height;r=r||1;var b=t.segmentsHidden,x=n.pixelData,w=t.activeSegmentIndex,_=[];n.segmentsOnLabelmap.forEach((function(e){!b[e]&&(_[e]=[])})),_[w]||(_[w]=[]);for(var S,E=function(e,t){var n=t/2,r=e.rotation;r*=Math.PI/180;var i=Math.cos(r),a=Math.sin(r),o=[i,a],s=[-a,i],l={x:n*o[0],y:n*o[1]},u={x:n*s[0],y:n*s[1]};return e.hflip&&(l.x*=-1,l.y*=-1),e.vflip&&(u.x*=-1,u.y*=-1),{i:l,j:u}}(s,r),T=0;T<x.length;T++){var k=x[T];if(0!==k&&!b[k]){var C={x:(S=T)%l,y:Math.floor(S/l)},I=c(C,u,l);void 0!==I.top&&x[I.top]===k||m(_[k],a,C,E),void 0!==I.bottom&&x[I.bottom]===k||g(_[k],a,C,E),void 0!==I.left&&x[I.left]===k||v(_[k],a,C,E),void 0!==I.right&&x[I.right]===k||y(_[k],a,C,E),void 0!==I.topLeft&&x[I.topLeft]!==k&&x[I.top]===k&&x[I.left]===k&&d(_[k],a,C,E),void 0!==I.topRight&&x[I.topRight]!==k&&x[I.top]===k&&x[I.right]===k&&h(_[k],a,C,E),void 0!==I.bottomLeft&&x[I.bottomLeft]!==k&&x[I.bottom]===k&&x[I.left]===k&&f(_[k],a,C,E),void 0!==I.bottomRight&&x[I.bottomRight]!==k&&x[I.bottom]===k&&x[I.right]===k&&p(_[k],a,C,E)}}return _}function c(e,t,n){var r=e.y*n+e.x,i={},a=e.y+1<t,o=e.x-1>=0,s=e.x+1<n;return e.y-1>=0&&(i.top=r-n,s&&(i.topRight=i.top+1),o&&(i.topLeft=i.top-1)),a&&(i.bottom=r+n,s&&(i.bottomRight=i.bottom+1),o&&(i.bottomLeft=i.bottom-1)),o&&(i.left=r-1),s&&(i.right=r+1),i}function d(e,t,n,r){var a=(0,i.default.cornerstone.pixelToCanvas)(t,n);a.x+=r.j.x,a.y+=r.j.y;var o={x:a.x,y:a.y};o.x+=2*r.i.x,o.y+=2*r.i.y,e.push({start:a,end:o})}function h(e,t,n,r){var a=(0,i.default.cornerstone.pixelToCanvas)(t,{x:n.x+1,y:n.y});a.x+=r.j.x,a.y+=r.j.y;var o={x:a.x,y:a.y};o.x-=2*r.i.x,o.y-=2*r.i.y,e.push({start:a,end:o})}function f(e,t,n,r){var a=(0,i.default.cornerstone.pixelToCanvas)(t,{x:n.x,y:n.y+1});a.x-=r.j.x,a.y-=r.j.y;var o={x:a.x,y:a.y};o.x+=2*r.i.x,o.y+=2*r.i.y,e.push({start:a,end:o})}function p(e,t,n,r){var a=(0,i.default.cornerstone.pixelToCanvas)(t,{x:n.x+1,y:n.y+1});a.x-=r.j.x,a.y-=r.j.y;var o={x:a.x,y:a.y};o.x-=2*r.i.x,o.y-=2*r.i.y,e.push({start:a,end:o})}function m(e,t,n,r){var a=i.default.cornerstone.pixelToCanvas,o=a(t,n),s=a(t,{x:n.x+1,y:n.y});o.x+=r.j.x,o.y+=r.j.y,s.x+=r.j.x,s.y+=r.j.y,e.push({start:o,end:s})}function g(e,t,n,r){var a=i.default.cornerstone.pixelToCanvas,o=a(t,{x:n.x,y:n.y+1}),s=a(t,{x:n.x+1,y:n.y+1});o.x-=r.j.x,o.y-=r.j.y,s.x-=r.j.x,s.y-=r.j.y,e.push({start:o,end:s})}function v(e,t,n,r){var a=i.default.cornerstone.pixelToCanvas,o=a(t,n),s=a(t,{x:n.x,y:n.y+1});o.x+=r.i.x,o.y+=r.i.y,s.x+=r.i.x,s.y+=r.i.y,e.push({start:o,end:s})}function y(e,t,n,r){var a=i.default.cornerstone.pixelToCanvas,o=a(t,{x:n.x+1,y:n.y}),s=a(t,{x:n.x+1,y:n.y+1});o.x-=r.i.x,o.y-=r.i.y,s.x-=r.i.x,s.y-=r.i.y,e.push({start:o,end:s})}},"./eventListeners/mouseEventListeners.js":function(e,t,n){"use strict";n.r(t);var r,i=n("./events.js"),a=n("./externalModules.js"),o=n("./util/copyPoints.js"),s=n("./util/triggerEvent.js"),l=n("./util/logger.js"),u=Object(l.getLogger)("eventListeners:mouseEventListeners"),c=!0;function d(e){if("number"==typeof e.buttons)return e.buttons;switch(e.which){case 0:return 0;case 1:return 1;case 2:return 4;case 3:return 2}return 0}function h(){c=!1}function f(e){var t=e.currentTarget,n=a.default.cornerstone.getEnabledElement(t);if(n.image){var r=i.default.MOUSE_DOUBLE_CLICK,l={page:a.default.cornerstoneMath.point.pageToPoint(e),image:a.default.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};l.canvas=a.default.cornerstone.pixelToCanvas(t,l.image);var c=Object(o.default)(l);u.log("double-click: %o",d(e));var h={event:e,buttons:d(e),viewport:a.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:l,lastPoints:c,currentPoints:l,deltaPoints:{x:0,y:0},type:r};Object(s.default)(t,r,h)}}function p(e){var t=e.currentTarget,n=a.default.cornerstone.getEnabledElement(t);if(n.image){r=setTimeout(h,200),t.removeEventListener("mousemove",m);var l={page:a.default.cornerstoneMath.point.pageToPoint(e),image:a.default.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};l.canvas=a.default.cornerstone.pixelToCanvas(t,l.image);var f=Object(o.default)(l),p={event:e,buttons:d(e),viewport:a.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:l,lastPoints:f,currentPoints:l,deltaPoints:{x:0,y:0},type:i.default.MOUSE_DOWN};Object(s.default)(p.element,i.default.MOUSE_DOWN,p)&&(p.type=i.default.MOUSE_DOWN_ACTIVATE,Object(s.default)(p.element,i.default.MOUSE_DOWN_ACTIVATE,p)),document.addEventListener("mousemove",g),document.addEventListener("mouseup",(function e(o){clearTimeout(r);var h=i.default.MOUSE_UP;c&&(h=i.default.MOUSE_CLICK);var p={page:a.default.cornerstoneMath.point.pageToPoint(o),image:a.default.cornerstone.pageToPixel(t,o.pageX,o.pageY),client:{x:o.clientX,y:o.clientY}};p.canvas=a.default.cornerstone.pixelToCanvas(t,p.image);var v={page:a.default.cornerstoneMath.point.subtract(p.page,f.page),image:a.default.cornerstoneMath.point.subtract(p.image,f.image),client:a.default.cornerstoneMath.point.subtract(p.client,f.client),canvas:a.default.cornerstoneMath.point.subtract(p.canvas,f.canvas)};u.log("mouseup: %o",d(o));var y={event:o,buttons:d(o),viewport:a.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:l,lastPoints:f,currentPoints:p,deltaPoints:v,type:h};Object(s.default)(y.element,h,y),document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",e),t.addEventListener("mousemove",m),c=!0}))}function g(e){var r=i.default.MOUSE_DRAG,c={page:a.default.cornerstoneMath.point.pageToPoint(e),image:a.default.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};c.canvas=a.default.cornerstone.pixelToCanvas(t,c.image);var h={page:a.default.cornerstoneMath.point.subtract(c.page,f.page),image:a.default.cornerstoneMath.point.subtract(c.image,f.image),client:a.default.cornerstoneMath.point.subtract(c.client,f.client),canvas:a.default.cornerstoneMath.point.subtract(c.canvas,f.canvas)};u.log("mousemove: %o",d(e));var p={buttons:d(e),viewport:a.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:l,lastPoints:f,currentPoints:c,deltaPoints:h,type:r,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey};Object(s.default)(p.element,r,p),f=Object(o.default)(c)}}function m(e){var t=e.currentTarget,n=a.default.cornerstone.getEnabledElement(t);if(n.image){var r=i.default.MOUSE_MOVE,l={page:a.default.cornerstoneMath.point.pageToPoint(e),image:a.default.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};l.canvas=a.default.cornerstone.pixelToCanvas(t,l.image);var u=Object(o.default)(l),c={page:a.default.cornerstoneMath.point.pageToPoint(e),image:a.default.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};c.canvas=a.default.cornerstone.pixelToCanvas(t,c.image);var d={page:a.default.cornerstoneMath.point.subtract(c.page,u.page),image:a.default.cornerstoneMath.point.subtract(c.image,u.image),client:a.default.cornerstoneMath.point.subtract(c.client,u.client),canvas:a.default.cornerstoneMath.point.subtract(c.canvas,u.canvas)},h={viewport:a.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:l,lastPoints:u,currentPoints:c,deltaPoints:d,type:r};Object(s.default)(t,r,h),u=Object(o.default)(c)}}function g(e){e.removeEventListener("mousedown",p),e.removeEventListener("mousemove",m),e.removeEventListener("dblclick",f)}t.default={enable:function(e){g(e),e.addEventListener("mousedown",p),e.addEventListener("mousemove",m),e.addEventListener("dblclick",f)},disable:g}},"./eventListeners/onImageRenderedBrushEventHandler.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./eventListeners/internals/renderSegmentation.js"),a=Object(r.getModule)("segmentation");t.default=function(e){var t=a.configuration,n=a.getters.labelmaps3D(e.detail.element),r=n.activeLabelmapIndex,o=n.labelmaps3D,s=n.currentImageIdIndex;o&&(t.shouldRenderInactiveLabelmaps&&function(e,t,n,r){for(var a=0;a<t.length;a++){var o=t[a];if(a!==n&&o){var s=o.labelmaps2D[r];s&&Object(i.default)(e,o,a,s,!1)}}}(e,o,r,s),function(e,t,n,r){var a=t[n];if(a){var o=a.labelmaps2D[r];o&&Object(i.default)(e,a,n,o,!0)}}(e,o,r,s))}},"./eventListeners/preventGhostClick.js":function(e,t,n){"use strict";var r,i;function a(e,t){var n=Date.now();if(e!==r){if(n-i<=2e3)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;r=e}i=n}n.r(t);var o=a.bind(null,0),s=a.bind(null,1);function l(e,t,n){var r=n?o:s;t.forEach((function(t){e.addEventListener(t,r,{passive:!1})}))}function u(e,t,n){var r=n?o:s;t.forEach((function(t){e.removeEventListener(t,r)}))}var c=["mousedown","mouseup"],d=["touchstart","touchend"];function h(e){u(e,c,0),u(e,d,1)}t.default={enable:function(e){h(e),l(e,c,0),l(e,d,1)},disable:h}},"./eventListeners/touchEventListeners.js":function(e,t,n){"use strict";n.r(t);var r,i,a,o,s,l,u,c,d,h=n("./events.js"),f=n("./externalModules.js"),p=n("./util/copyPoints.js"),m=n("./eventListeners/preventGhostClick.js"),g=n("./util/triggerEvent.js"),v=n("./toolOptions.js"),y=1,b=0,x=!1,w=!1,_="touchInput";function S(e){var t=e.currentTarget||e.srcEvent.currentTarget,n=f.default.cornerstone.getEnabledElement(t);if(n.image){var m,v,_,S;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.touches&&e.touches.length>1)&&(w=!1,clearTimeout(u)),e.type){case"tap":w=!1,clearTimeout(u),(i={page:f.default.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:f.default.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=f.default.cornerstone.pixelToCanvas(t,i.image),m=h.default.TAP,s={event:e,viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:i,type:m,isTouchEvent:!0},Object(g.default)(t,m,s);break;case"doubletap":w=!1,clearTimeout(u),(i={page:f.default.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:f.default.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=f.default.cornerstone.pixelToCanvas(t,i.image),m=h.default.DOUBLE_TAP,s={event:e,viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:i,type:m,isTouchEvent:!0},Object(g.default)(t,m,s);break;case"pinchstart":w=!1,clearTimeout(u),y=1;break;case"pinchmove":if(w=!1,clearTimeout(u),!0===x){y=e.scale,x=!1;break}v=(e.scale-y)/y,(r={page:e.center,image:f.default.cornerstone.pageToPixel(t,e.center.x,e.center.y)}).canvas=f.default.cornerstone.pixelToCanvas(t,r.image),m=h.default.TOUCH_PINCH,s={event:e,startPoints:r,viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,direction:e.scale<1?1:-1,scaleChange:v,type:m,isTouchEvent:!0},Object(g.default)(t,m,s),y=e.scale;break;case"touchstart":y=1,clearTimeout(u),clearTimeout(l),l=setTimeout((function(){(r={page:f.default.cornerstoneMath.point.pageToPoint(e.touches[0]),image:f.default.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=f.default.cornerstone.pixelToCanvas(t,r.image),m=h.default.TOUCH_START,e.touches.length>1&&(m=h.default.MULTI_TOUCH_START),s={event:e,viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,currentPoints:r,type:m,isTouchEvent:!0},!0===Object(g.default)(t,m,s)&&(m=h.default.TOUCH_START_ACTIVE,e.touches.length>1&&(m=h.default.MULTI_TOUCH_START_ACTIVE),s.type=m,Object(g.default)(t,m,s)),a=Object(p.default)(r)}),50),w=!0,c=0,u=setTimeout((function(){w&&((i={page:f.default.cornerstoneMath.point.pageToPoint(e.touches[0]),image:f.default.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=f.default.cornerstone.pixelToCanvas(t,r.image),m=h.default.TOUCH_PRESS,s={event:e,viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:i,type:m,isTouchEvent:!0},Object(g.default)(t,m,s))}),700);break;case"touchend":y=1,w=!1,clearTimeout(u),setTimeout((function(){(r={page:f.default.cornerstoneMath.point.pageToPoint(e.changedTouches[0]),image:f.default.cornerstone.pageToPixel(t,e.changedTouches[0].pageX,e.changedTouches[0].pageY),client:{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}).canvas=f.default.cornerstone.pixelToCanvas(t,r.image),m=h.default.TOUCH_END,s={event:e,viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,currentPoints:r,type:m,isTouchEvent:!0},Object(g.default)(t,m,s)}),50);break;case"panmove":_={x:e.deltaX-d.x,y:e.deltaY-d.y},d={x:e.deltaX,y:e.deltaY},(i={page:{x:a.page.x+_.x,y:a.page.y+_.y},image:f.default.cornerstone.pageToPixel(t,a.page.x+_.x,a.page.y+_.y),client:{x:a.client.x+_.x,y:a.client.y+_.y}}).canvas=f.default.cornerstone.pixelToCanvas(t,i.image),o={page:f.default.cornerstoneMath.point.subtract(i.page,a.page),image:f.default.cornerstoneMath.point.subtract(i.image,a.image),client:f.default.cornerstoneMath.point.subtract(i.client,a.client),canvas:f.default.cornerstoneMath.point.subtract(i.canvas,a.canvas)},(c+=Math.sqrt(o.page.x*o.page.x+o.page.y*o.page.y))>5&&(w=!1,clearTimeout(u)),m=h.default.TOUCH_DRAG,e.pointers.length>1&&(m=h.default.MULTI_TOUCH_DRAG),s={viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,lastPoints:a,currentPoints:i,deltaPoints:o,numPointers:e.pointers.length,type:m,isTouchEvent:!0},Object(g.default)(t,m,s),a=Object(p.default)(i);break;case"panstart":d={x:e.deltaX,y:e.deltaY},(i={page:f.default.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:f.default.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=f.default.cornerstone.pixelToCanvas(t,i.image),a=Object(p.default)(i);break;case"panend":if(w=!1,clearTimeout(u),!a)return!1;(i={page:f.default.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:f.default.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=f.default.cornerstone.pixelToCanvas(t,i.image),o={page:f.default.cornerstoneMath.point.subtract(i.page,a.page),image:f.default.cornerstoneMath.point.subtract(i.image,a.image),client:f.default.cornerstoneMath.point.subtract(i.client,a.client),canvas:f.default.cornerstoneMath.point.subtract(i.canvas,a.canvas)},m=h.default.TOUCH_DRAG_END,s={event:e.srcEvent,viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,lastPoints:a,currentPoints:i,deltaPoints:o,type:m,isTouchEvent:!0},Object(g.default)(t,m,s),2==e.pointers.length-e.changedPointers.length&&(x=!0);break;case"rotatemove":w=!1,clearTimeout(u),S=e.rotation-b,b=e.rotation,m=h.default.TOUCH_ROTATE,s={event:e.srcEvent,viewport:f.default.cornerstone.getViewport(t),image:n.image,element:t,rotation:S,type:m},Object(g.default)(t,m,s)}return!1}}function E(e){m.default.disable(e),["touchstart","touchend"].forEach((function(t){e.removeEventListener(t,S)}));var t=Object(v.getToolOptions)(_,e).hammer;t&&t.off("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",S)}t.default={enable:function(e){E(e);var t=f.default.Hammer,n=new t.Manager(e,{inputClass:t.SUPPORT_POINTER_EVENTS?t.PointerEventInput:t.TouchInput}),r=new t.Pan({pointers:0,direction:t.DIRECTION_ALL,threshold:0}),i=new t.Pinch({threshold:0}),a=new t.Rotate({threshold:0});i.recognizeWith(r),i.recognizeWith(a),a.recognizeWith(r);var o=new t.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});o.recognizeWith(r),n.add([o,r,a,i]),n.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",S),m.default.enable(e),["touchstart","touchend"].forEach((function(t){e.addEventListener(t,S,{passive:!1})}));var s=Object(v.getToolOptions)(_,e);s.hammer=n,Object(v.setToolOptions)(_,e,s)},disable:E}},"./eventListeners/wheelEventListener.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./externalModules.js"),a=n("./util/triggerEvent.js"),o=n("./eventListeners/internals/normalizeWheel.js");function s(e){var t=e.currentTarget,n=i.default.cornerstone.getEnabledElement(t);if(n.image&&!(e.deltaY>-1&&e.deltaY<1)){e.preventDefault();var s=e.pageX,l=e.pageY,u=i.default.cornerstone.pageToPixel(t,s,l),c=Object(o.default)(e),d=c.spinX,h=c.spinY,f=c.pixelX,p=c.pixelY,m=h<0?-1:1,g={element:t,viewport:i.default.cornerstone.getViewport(t),detail:e,image:n.image,direction:m,spinX:d,spinY:h,pixelX:f,pixelY:p,pageX:s,pageY:l,imageX:u.x,imageY:u.y};Object(a.default)(t,r.default.MOUSE_WHEEL,g)}}function l(e){e.removeEventListener("wheel",s,{passive:!1})}t.default={enable:function(e){l(e),e.addEventListener("wheel",s,{passive:!1})},disable:l}},"./eventListeners/windowResizeHandler.js":function(e,t,n){"use strict";n.r(t),n.d(t,"forceEnabledElementResize",(function(){return l}));var r,i=n("./store/index.js"),a=n("./externalModules.js"),o=function(){window.removeEventListener("resize",s,!1)};function s(){r||(r=setTimeout((function(){r=null,l()}),66))}var l=function(){i.state.enabledElements.forEach((function(e){a.default.cornerstone.resize(e)}))};t.default={enable:function(){o(),window.addEventListener("resize",s,!1)},disable:o}},"./events.js":function(e,t,n){"use strict";n.r(t),t.default={MOUSE_DOWN:"cornerstonetoolsmousedown",MOUSE_UP:"cornerstonetoolsmouseup",MOUSE_DOWN_ACTIVATE:"cornerstonetoolsmousedownactivate",MOUSE_DRAG:"cornerstonetoolsmousedrag",MOUSE_MOVE:"cornerstonetoolsmousemove",MOUSE_CLICK:"cornerstonetoolsmouseclick",MOUSE_DOUBLE_CLICK:"cornerstonetoolsmousedoubleclick",MOUSE_WHEEL:"cornerstonetoolsmousewheel",TOUCH_START:"cornerstonetoolstouchstart",TOUCH_START_ACTIVE:"cornerstonetoolstouchstartactive",TOUCH_END:"cornerstonetoolstouchend",TOUCH_DRAG:"cornerstonetoolstouchdrag",TOUCH_DRAG_END:"cornerstonetoolstouchdragend",TOUCH_PINCH:"cornerstonetoolstouchpinch",TOUCH_ROTATE:"cornerstonetoolstouchrotate",TOUCH_PRESS:"cornerstonetoolstouchpress",TAP:"cornerstonetoolstap",DOUBLE_TAP:"cornerstonetoolsdoubletap",MULTI_TOUCH_START:"cornerstonetoolsmultitouchstart",MULTI_TOUCH_START_ACTIVE:"cornerstonetoolsmultitouchstartactive",MULTI_TOUCH_DRAG:"cornerstonetoolsmultitouchdrag",KEY_DOWN:"cornerstonetoolskeydown",KEY_UP:"cornerstonetoolskeyup",KEY_PRESS:"cornerstonetoolskeypress",MEASUREMENT_ADDED:"cornerstonetoolsmeasurementadded",MEASUREMENT_MODIFIED:"cornerstonetoolsmeasurementmodified",MEASUREMENT_COMPLETED:"cornerstonetoolsmeasurementcompleted",MEASUREMENT_REMOVED:"cornerstonetoolsmeasurementremoved",TOOL_DEACTIVATED:"cornerstonetoolstooldeactivated",CLIP_STOPPED:"cornerstonetoolsclipstopped",STACK_SCROLL:"cornerstonetoolsstackscroll",STACK_PREFETCH_IMAGE_LOADED:"cornerstonetoolsstackprefetchimageloaded",STACK_PREFETCH_DONE:"cornerstonetoolsstackprefetchdone",LABELMAP_MODIFIED:"cornersontetoolslabelmapmodified"}},"./externalModules.js":function(e,t,n){"use strict";n.r(t);var r=window.cornerstone,i=window.cornerstoneMath,a=window.Hammer;t.default={set cornerstone(e){r=e},get cornerstone(){return r},set cornerstoneMath(e){i=e},get cornerstoneMath(){return i},set Hammer(e){a=e},get Hammer(){return a}}},"./importInternal.js":function(e,t,n){"use strict";n.r(t);var r=n("./lib.js");t.default=function(e){return r.lib[e]}},"./index.js":function(e,t,n){"use strict";n.r(t);var r=n("./tools/annotation/index.js");n.d(t,"AngleTool",(function(){return r.AngleTool})),n.d(t,"ArrowAnnotateTool",(function(){return r.ArrowAnnotateTool})),n.d(t,"BidirectionalTool",(function(){return r.BidirectionalTool})),n.d(t,"CircleRoiTool",(function(){return r.CircleRoiTool})),n.d(t,"CobbAngleTool",(function(){return r.CobbAngleTool})),n.d(t,"EllipticalRoiTool",(function(){return r.EllipticalRoiTool})),n.d(t,"FreehandRoiTool",(function(){return r.FreehandRoiTool})),n.d(t,"LengthTool",(function(){return r.LengthTool})),n.d(t,"ProbeTool",(function(){return r.ProbeTool})),n.d(t,"RectangleRoiTool",(function(){return r.RectangleRoiTool})),n.d(t,"TextMarkerTool",(function(){return r.TextMarkerTool}));var i=n("./tools/segmentation/index.js");n.d(t,"BrushTool",(function(){return i.BrushTool})),n.d(t,"SphericalBrushTool",(function(){return i.SphericalBrushTool})),n.d(t,"RectangleScissorsTool",(function(){return i.RectangleScissorsTool})),n.d(t,"FreehandScissorsTool",(function(){return i.FreehandScissorsTool})),n.d(t,"CircleScissorsTool",(function(){return i.CircleScissorsTool})),n.d(t,"CorrectionScissorsTool",(function(){return i.CorrectionScissorsTool}));var a=n("./tools/index.js");n.d(t,"CrosshairsTool",(function(){return a.CrosshairsTool})),n.d(t,"DoubleTapFitToWindowTool",(function(){return a.DoubleTapFitToWindowTool})),n.d(t,"DragProbeTool",(function(){return a.DragProbeTool})),n.d(t,"EraserTool",(function(){return a.EraserTool})),n.d(t,"FreehandRoiSculptorTool",(function(){return a.FreehandRoiSculptorTool})),n.d(t,"MagnifyTool",(function(){return a.MagnifyTool})),n.d(t,"OverlayTool",(function(){return a.OverlayTool})),n.d(t,"OrientationMarkersTool",(function(){return a.OrientationMarkersTool})),n.d(t,"PanMultiTouchTool",(function(){return a.PanMultiTouchTool})),n.d(t,"PanTool",(function(){return a.PanTool})),n.d(t,"ReferenceLinesTool",(function(){return a.ReferenceLinesTool})),n.d(t,"RotateTool",(function(){return a.RotateTool})),n.d(t,"RotateTouchTool",(function(){return a.RotateTouchTool})),n.d(t,"ScaleOverlayTool",(function(){return a.ScaleOverlayTool})),n.d(t,"StackScrollMouseWheelTool",(function(){return a.StackScrollMouseWheelTool})),n.d(t,"StackScrollMultiTouchTool",(function(){return a.StackScrollMultiTouchTool})),n.d(t,"StackScrollTool",(function(){return a.StackScrollTool})),n.d(t,"WwwcRegionTool",(function(){return a.WwwcRegionTool})),n.d(t,"WwwcTool",(function(){return a.WwwcTool})),n.d(t,"ZoomMouseWheelTool",(function(){return a.ZoomMouseWheelTool})),n.d(t,"ZoomTool",(function(){return a.ZoomTool})),n.d(t,"ZoomTouchPinchTool",(function(){return a.ZoomTouchPinchTool}));var o=n("./init.js");n.d(t,"init",(function(){return o.default}));var s=n("./stackTools/stackPrefetch.js");n.d(t,"stackPrefetch",(function(){return s.default}));var l=n("./stackTools/stackRenderers.js");n.d(t,"stackRenderers",(function(){return l.default}));var u=n("./stackTools/playClip.js");n.d(t,"playClip",(function(){return u.playClip})),n.d(t,"stopClip",(function(){return u.stopClip}));var c=n("./store/index.js");n.d(t,"store",(function(){return c.default})),n.d(t,"getModule",(function(){return c.getModule}));var d=n("./store/getToolForElement.js");n.d(t,"getToolForElement",(function(){return d.default}));var h=n("./store/addTool.js");n.d(t,"addTool",(function(){return h.addTool})),n.d(t,"addToolForElement",(function(){return h.addToolForElement}));var f=n("./store/removeTool.js");n.d(t,"removeTool",(function(){return f.removeTool})),n.d(t,"removeToolForElement",(function(){return f.removeToolForElement}));var p=n("./store/setToolOptions.js");n.d(t,"setToolOptions",(function(){return p.setToolOptions})),n.d(t,"setToolOptionsForElement",(function(){return p.setToolOptionsForElement}));var m=n("./store/setToolMode.js");n.d(t,"setToolActive",(function(){return m.setToolActive})),n.d(t,"setToolActiveForElement",(function(){return m.setToolActiveForElement})),n.d(t,"setToolEnabled",(function(){return m.setToolEnabled})),n.d(t,"setToolEnabledForElement",(function(){return m.setToolEnabledForElement})),n.d(t,"setToolDisabled",(function(){return m.setToolDisabled})),n.d(t,"setToolDisabledForElement",(function(){return m.setToolDisabledForElement})),n.d(t,"setToolPassive",(function(){return m.setToolPassive})),n.d(t,"setToolPassiveForElement",(function(){return m.setToolPassiveForElement}));var g=n("./store/isToolActiveForElement.js");n.d(t,"isToolActiveForElement",(function(){return g.default}));var v=n("./stateManagement/toolState.js");n.d(t,"addToolState",(function(){return v.addToolState})),n.d(t,"getToolState",(function(){return v.getToolState})),n.d(t,"removeToolState",(function(){return v.removeToolState})),n.d(t,"clearToolState",(function(){return v.clearToolState})),n.d(t,"setElementToolStateManager",(function(){return v.setElementToolStateManager})),n.d(t,"getElementToolStateManager",(function(){return v.getElementToolStateManager}));var y=n("./stateManagement/textStyle.js");n.d(t,"textStyle",(function(){return y.default}));var b=n("./stateManagement/toolStyle.js");n.d(t,"toolStyle",(function(){return b.default}));var x=n("./stateManagement/toolColors.js");n.d(t,"toolColors",(function(){return x.default}));var w=n("./stateManagement/toolCoordinates.js");n.d(t,"toolCoordinates",(function(){return w.default}));var _=n("./stateManagement/stackSpecificStateManager.js");n.d(t,"stackSpecificStateManager",(function(){return _.stackSpecificStateManager})),n.d(t,"newStackSpecificToolStateManager",(function(){return _.newStackSpecificToolStateManager})),n.d(t,"addStackStateManager",(function(){return _.addStackStateManager}));var S=n("./stateManagement/loadHandlerManager.js");n.d(t,"loadHandlerManager",(function(){return S.default}));var E=n("./stateManagement/imageIdSpecificStateManager.js");n.d(t,"newImageIdSpecificToolStateManager",(function(){return E.newImageIdSpecificToolStateManager})),n.d(t,"globalImageIdSpecificToolStateManager",(function(){return E.globalImageIdSpecificToolStateManager}));var T=n("./stateManagement/frameOfReferenceStateManager.js");n.d(t,"newFrameOfReferenceSpecificToolStateManager",(function(){return T.newFrameOfReferenceSpecificToolStateManager})),n.d(t,"globalFrameOfReferenceSpecificToolStateManager",(function(){return T.globalFrameOfReferenceSpecificToolStateManager}));var k=n("./eventListeners/windowResizeHandler.js");n.d(t,"forceEnabledElementResize",(function(){return k.forceEnabledElementResize}));var C=n("./orientation/index.js");n.d(t,"orientation",(function(){return C.default}));var I=n("./util/SaveAs.js");n.d(t,"SaveAs",(function(){return I.default}));var O=n("./util/logger.js");n.d(t,"enableLogger",(function(){return O.enable})),n.d(t,"disableLogger",(function(){return O.disable}));var A=n("./thirdParty/register.js");n.d(t,"register",(function(){return A.default}));var D=n("./thirdParty/registerSome.js");n.d(t,"registerSome",(function(){return D.default}));var M=n("./synchronization/wwwcSynchronizer.js");n.d(t,"wwwcSynchronizer",(function(){return M.default}));var N=n("./synchronization/updateImageSynchronizer.js");n.d(t,"updateImageSynchronizer",(function(){return N.default}));var j=n("./synchronization/Synchronizer.js");n.d(t,"Synchronizer",(function(){return j.default}));var R=n("./synchronization/stackScrollSynchronizer.js");n.d(t,"stackScrollSynchronizer",(function(){return R.default}));var P=n("./synchronization/stackImagePositionSynchronizer.js");n.d(t,"stackImagePositionSynchronizer",(function(){return P.default}));var F=n("./synchronization/stackImagePositionOffsetSynchronizer.js");n.d(t,"stackImagePositionOffsetSynchronizer",(function(){return F.default}));var L=n("./synchronization/stackImageIndexSynchronizer.js");n.d(t,"stackImageIndexSynchronizer",(function(){return L.default}));var $=n("./synchronization/panZoomSynchronizer.js");n.d(t,"panZoomSynchronizer",(function(){return $.default}));var B=n("./requestPool/requestPoolManager.js");n.d(t,"requestPoolManager",(function(){return B.default}));var z=n("./externalModules.js");n.d(t,"external",(function(){return z.default}));var U=n("./events.js");n.d(t,"EVENTS",(function(){return U.default}));var H=n("./version.js");n.d(t,"version",(function(){return H.default}));var W=n("./importInternal.js");n.d(t,"importInternal",(function(){return W.default})),n.d(t,"import",(function(){return W.default})),t.default={AngleTool:r.AngleTool,ArrowAnnotateTool:r.ArrowAnnotateTool,BidirectionalTool:r.BidirectionalTool,CircleRoiTool:r.CircleRoiTool,CobbAngleTool:r.CobbAngleTool,EllipticalRoiTool:r.EllipticalRoiTool,FreehandRoiTool:r.FreehandRoiTool,LengthTool:r.LengthTool,ProbeTool:r.ProbeTool,RectangleRoiTool:r.RectangleRoiTool,TextMarkerTool:r.TextMarkerTool,BrushTool:i.BrushTool,SphericalBrushTool:i.SphericalBrushTool,RectangleScissorsTool:i.RectangleScissorsTool,FreehandScissorsTool:i.FreehandScissorsTool,CircleScissorsTool:i.CircleScissorsTool,CorrectionScissorsTool:i.CorrectionScissorsTool,CrosshairsTool:a.CrosshairsTool,DoubleTapFitToWindowTool:a.DoubleTapFitToWindowTool,DragProbeTool:a.DragProbeTool,EraserTool:a.EraserTool,FreehandRoiSculptorTool:a.FreehandRoiSculptorTool,MagnifyTool:a.MagnifyTool,OverlayTool:a.OverlayTool,OrientationMarkersTool:a.OrientationMarkersTool,PanMultiTouchTool:a.PanMultiTouchTool,PanTool:a.PanTool,ReferenceLinesTool:a.ReferenceLinesTool,RotateTool:a.RotateTool,RotateTouchTool:a.RotateTouchTool,ScaleOverlayTool:a.ScaleOverlayTool,StackScrollMouseWheelTool:a.StackScrollMouseWheelTool,StackScrollMultiTouchTool:a.StackScrollMultiTouchTool,StackScrollTool:a.StackScrollTool,WwwcRegionTool:a.WwwcRegionTool,WwwcTool:a.WwwcTool,ZoomMouseWheelTool:a.ZoomMouseWheelTool,ZoomTool:a.ZoomTool,ZoomTouchPinchTool:a.ZoomTouchPinchTool,init:o.default,stackPrefetch:s.default,stackRenderers:l.default,playClip:u.playClip,stopClip:u.stopClip,store:c.default,getModule:c.getModule,getToolForElement:d.default,addTool:h.addTool,addToolForElement:h.addToolForElement,removeTool:f.removeTool,removeToolForElement:f.removeToolForElement,setToolOptions:p.setToolOptions,setToolOptionsForElement:p.setToolOptionsForElement,isToolActiveForElement:g.default,setToolActive:m.setToolActive,setToolActiveForElement:m.setToolActiveForElement,setToolEnabled:m.setToolEnabled,setToolEnabledForElement:m.setToolEnabledForElement,setToolDisabled:m.setToolDisabled,setToolDisabledForElement:m.setToolDisabledForElement,setToolPassive:m.setToolPassive,setToolPassiveForElement:m.setToolPassiveForElement,addToolState:v.addToolState,getToolState:v.getToolState,removeToolState:v.removeToolState,clearToolState:v.clearToolState,setElementToolStateManager:v.setElementToolStateManager,getElementToolStateManager:v.getElementToolStateManager,textStyle:y.default,toolStyle:b.default,toolColors:x.default,toolCoordinates:w.default,stackSpecificStateManager:_.stackSpecificStateManager,newStackSpecificToolStateManager:_.newStackSpecificToolStateManager,addStackStateManager:_.addStackStateManager,loadHandlerManager:S.default,newImageIdSpecificToolStateManager:E.newImageIdSpecificToolStateManager,globalImageIdSpecificToolStateManager:E.globalImageIdSpecificToolStateManager,newFrameOfReferenceSpecificToolStateManager:T.newFrameOfReferenceSpecificToolStateManager,globalFrameOfReferenceSpecificToolStateManager:T.globalFrameOfReferenceSpecificToolStateManager,forceEnabledElementResize:k.forceEnabledElementResize,orientation:C.default,SaveAs:I.default,enableLogger:O.enable,disableLogger:O.disable,importInternal:W.default,import:W.default,register:A.default,registerSome:D.default,wwwcSynchronizer:M.default,updateImageSynchronizer:N.default,Synchronizer:j.default,stackScrollSynchronizer:R.default,stackImagePositionSynchronizer:P.default,stackImagePositionOffsetSynchronizer:F.default,stackImageIndexSynchronizer:L.default,panZoomSynchronizer:$.default,requestPoolManager:B.default,external:z.default,EVENTS:U.default,version:H.default}},"./init.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./store/index.js"),a=n("./store/internals/addEnabledElement.js"),o=n("./store/internals/removeEnabledElement.js"),s=n("./eventListeners/windowResizeHandler.js");function l(){!function(){var e=r.default.cornerstone,t=e.EVENTS.ELEMENT_DISABLED;e.events.removeEventListener(e.EVENTS.ELEMENT_ENABLED,a.default),e.events.removeEventListener(t,o.default)}();var e=r.default.cornerstone,t=e.EVENTS.ELEMENT_DISABLED;e.events.addEventListener(e.EVENTS.ELEMENT_ENABLED,a.default),e.events.addEventListener(t,o.default)}function u(){var e=i.default.modules;Object.keys(e).forEach((function(t){"function"==typeof e[t].onRegisterCallback&&e[t].onRegisterCallback()}))}t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l(),u();var t=Object(i.getModule)("globalConfiguration");Array.isArray(e)?e.forEach((function(e){var t=e.moduleName,n=e.configuration,r=Object(i.getModule)(t);r&&(r.configuration=Object.assign({},r.configuration,n))})):t.configuration=Object.assign({},t.configuration,e),t.configuration.autoResizeViewports&&s.default.enable()}},"./lib.js":function(e,t,n){"use strict";n.r(t),n.d(t,"lib",(function(){return J}));var r=n("./tools/base/BaseTool.js"),i=n("./tools/base/BaseAnnotationTool.js"),a=n("./tools/base/BaseBrushTool.js"),o=n("./manipulators/index.js"),s=n("./util/findAndMoveHelpers.js"),l=n("./mixins/index.js"),u=n("./tools/cursors/index.js"),c=n("./drawing/index.js"),d=n("./util/clip.js"),h=n("./util/debounce.js"),f=n("./util/deepmerge.js"),p=n("./util/getDefault.js"),m=n("./util/getPixelSpacing.js"),g=n("./util/isEmptyObject.js"),v=n("./util/isObject.js"),y=n("./util/isPointInImage.js"),b=n("./util/isPointInPolygon.js"),x=n("./util/throttle.js"),w=n("./util/wait.js"),_=n("./util/getKeyPressData.js"),S=n("./drawing/drawTextBox.js"),E=n("./drawing/drawArrow.js"),T=n("./drawing/drawLink.js"),k=n("./drawing/drawLinkedTextBox.js"),C=n("./drawing/drawHandles.js"),I=n("./util/getLuminance.js"),O=n("./util/getROITextBoxCoords.js"),A=n("./util/copyPoints.js"),D=n("./util/calculateSUV.js"),M=n("./util/setContextToDisplayFontSize.js"),N=n("./util/scrollToIndex.js"),j=n("./util/scroll.js"),R=n("./util/roundToDecimal.js"),P=n("./util/pointProjector.js"),F=n("./util/lineSegDistance.js"),L=n("./util/logger.js"),$=n("./util/pointInsideBoundingBox.js"),B=n("./util/makeUnselectable.js"),z=n("./util/getRGBPixels.js"),U=n("./util/getMaxSimultaneousRequests.js"),H=n("./util/angleBetweenPoints.js"),W=n("./util/numbersWithCommas.js"),V=n("./tools/cursors/MouseCursor.js"),q=n("./util/ellipse/index.js"),G=n("./util/freehand/index.js"),Y=n("./util/segmentation/index.js"),X=n("./util/zoom/index.js"),K=n("./util/triggerEvent.js"),Z=n("./util/convertToVector3.js"),J={"base/BaseTool":r.default,"base/BaseAnnotationTool":i.default,"base/BaseBrushTool":a.default,"tools/cursors/MouseCursor":V.default,"tools/cursors":u,"manipulators/anyHandlesOutsideImage":o.anyHandlesOutsideImage,"manipulators/getHandleNearImagePoint":o.getHandleNearImagePoint,"manipulators/handleActivator":o.handleActivator,"manipulators/moveAllHandles":o.moveAllHandles,"manipulators/moveHandle":o.moveHandle,"manipulators/moveNewHandle":o.moveNewHandle,"manipulators/moveHandleNearImagePoint":s.moveHandleNearImagePoint,"manipulators/findHandleDataNearImagePoint":s.findHandleDataNearImagePoint,"manipulators/moveAnnotation":s.moveAnnotation,"mixins/activeOrDisabledBinaryTool":l.default.activeOrDisabledBinaryTool,"mixins/enabledOrDisabledBinaryTool":l.default.enabledOrDisabledBinaryTool,"drawing/getNewContext":c.getNewContext,"drawing/draw":c.draw,"drawing/path":c.path,"drawing/setShadow":c.setShadow,"drawing/drawLine":c.drawLine,"drawing/drawLines":c.drawLines,"drawing/drawJoinedLines":c.drawJoinedLines,"drawing/drawCircle":c.drawCircle,"drawing/drawEllipse":c.drawEllipse,"drawing/drawRect":c.drawRect,"drawing/fillOutsideRect":c.fillOutsideRect,"drawing/drawTextBox":S.default,"drawing/drawArrow":E.default,"drawing/fillBox":c.fillBox,"drawing/fillTextLines":c.fillTextLines,"drawing/drawLink":T.default,"drawing/drawLinkedTextBox":k.default,"drawing/drawHandles":C.default,"drawing/textBoxWidth":S.textBoxWidth,"util/getLuminance":I.default,"util/getROITextBoxCoords":O.default,"util/copyPoints":A.default,"util/calculateSUV":D.default,"util/setContextToDisplayFontSize":M.default,"util/scrollToIndex":N.default,"util/scroll":j.default,"util/roundToDecimal":R.default,"util/projectPatientPointToImagePlane":P.projectPatientPointToImagePlane,"util/imagePointToPatientPoint":P.imagePointToPatientPoint,"util/planePlaneIntersection":P.planePlaneIntersection,"util/pointInsideBoundingBox":$.default,"util/makeUnselectable":B.default,"util/getRGBPixels":z.default,"util/getDefaultSimultaneousRequests":U.getDefaultSimultaneousRequests,"util/getMaxSimultaneousRequests":U.getMaxSimultaneousRequests,"util/getBrowserInfo":U.getBrowserInfo,"util/isMobileDevice":U.isMobileDevice,"util/angleBetweenPoints":H.default,"util/numbersWithCommas":W.default,"util/lineSegDistance":F.default,"util/triggerEvent":K.default,"util/convertToVector3":Z.default,"util/clip":d.clip,"util/clipToBox":d.clipToBox,"util/debounce":h.default,"util/deepmerge":f.default,"util/getDefault":p.default,"util/getPixelSpacing":m.default,"util/isEmptyObject":g.default,"util/isObject":v.default,"util/isPointInImage":y.default,"util/isPointInPolygon":b.default,"util/getLogger":L.getLogger,"util/throttle":x.default,"util/wait":w.wait,"util/waitForEnabledElementImageToLoad":w.waitForEnabledElementImageToLoad,"util/getKeyPressData":_.default,"util/ellipseUtils":q.default,"util/freehandUtils":G.default,"util/segmentationUtils":Y,"util/zoomUtils":X.default}},"./manipulators/anyHandlesOutsideImage.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t){var n=e.image,i={left:0,top:0,width:n.width,height:n.height},a=!1;return Object.keys(t).forEach((function(e){var n=t[e];!0!==n.allowedOutsideImage&&!1===r.default.cornerstoneMath.point.insideRect(n,i)&&(a=!0)})),a}},"./manipulators/getHandleNearImagePoint.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/typeof.js"),i=n.n(r),a=n("./externalModules.js"),o=n("./util/pointInsideBoundingBox.js"),s=function(e,t,n,r){if(e.hasOwnProperty("pointNearHandle")){if(e.pointNearHandle(t,e,n))return!0}else if(!0===e.hasBoundingBox){if(Object(o.default)(e,n))return!0}else{var i=a.default.cornerstone.pixelToCanvas(t,e);if(a.default.cornerstoneMath.point.distance(i,n)<=r)return!0}return!1};t.default=function e(t,n,r,a){var o;if(n){if(Array.isArray(n))for(var l=Object.keys(n),u=0;u<l.length;u++){var c=n[l[u]];if(c.hasOwnProperty("x")&&c.hasOwnProperty("y")&&s(c,t,r,a)){o=c;break}}else if("object"===i()(n))for(var d=Object.keys(n),h=0;h<d.length;h++){var f=d[h];if(Array.isArray(n[f])){if(o=e(t,n[f],r,a))break}else{var p=n[f];if(s(p,t,r,a)){o=p;break}}}return o}}},"./manipulators/handleActivator.js":function(e,t,n){"use strict";n.r(t);var r=n("./manipulators/getHandleNearImagePoint.js");t.default=function(e,t,n,i){i||(i=6);var a=function(e){var t;return Object.keys(e).forEach((function(n){var r=e[n];!0!==r.active||(t=r)})),t}(t),o=Object(r.default)(e,t,n,i);return a!==o&&(void 0!==o&&(o.active=!0),void 0!==a&&(a.active=!1),!0)}},"./manipulators/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./manipulators/anyHandlesOutsideImage.js");n.d(t,"anyHandlesOutsideImage",(function(){return r.default}));var i=n("./manipulators/getHandleNearImagePoint.js");n.d(t,"getHandleNearImagePoint",(function(){return i.default}));var a=n("./manipulators/handleActivator.js");n.d(t,"handleActivator",(function(){return a.default}));var o=n("./manipulators/moveAllHandles.js");n.d(t,"moveAllHandles",(function(){return o.default}));var s=n("./manipulators/moveHandle.js");n.d(t,"moveHandle",(function(){return s.default}));var l=n("./manipulators/moveNewHandle.js");n.d(t,"moveNewHandle",(function(){return l.default}))},"./manipulators/moveAllHandles.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./externalModules.js"),a=n("./manipulators/anyHandlesOutsideImage.js"),o=n("./stateManagement/toolState.js"),s=n("./util/triggerEvent.js"),l=n("./util/clip.js"),u=n("./store/index.js"),c=n("./util/getActiveTool.js"),d=n("./tools/base/BaseAnnotationTool.js"),h=n("./util/logger.js"),f=Object(h.getLogger)("manipulators:moveAllHandles"),p=Object(u.getModule)("manipulatorState"),m={mouse:[r.default.MOUSE_DRAG],touch:[r.default.TOUCH_DRAG]},g={mouse:[r.default.MOUSE_UP,r.default.MOUSE_CLICK],touch:[r.default.TOUCH_END,r.default.TOUCH_DRAG_END,r.default.TOUCH_PINCH,r.default.TOUCH_PRESS,r.default.TAP]};function v(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,u=o.detail,h=u.element,f=u.image,p=u.buttons,m=o.detail.deltaPoints.image,g=m.x,v=m.y;t.active=!0,t.invalidated=!0;for(var y=Object.keys(t.handles),b=0;b<y.length;b++){var x=y[b],w=t.handles[x];!0!==w.movesIndependently&&w.hasOwnProperty("x")&&w.hasOwnProperty("y")&&(w.x+=g,w.y+=v,n.preventHandleOutsideImage&&Object(l.clipToBox)(w,f))}i.default.cornerstone.updateImage(h);var _=Object(c.default)(h,p,a);_ instanceof d.default&&_.updateCachedStats(f,h,t);var S=r.default.MEASUREMENT_MODIFIED,E={toolName:e,toolType:e,element:h,measurementData:t};Object(s.default)(h,S,E),o.preventDefault(),o.stopPropagation()}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=r.dragHandler,a=r.upOrEndHandler,o=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0;x(e,t,n,{dragHandler:i,upOrEndHandler:a},o,s,!1)}function b(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,s=i.dragHandler,l=i.upOrEndHandler,u=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0,d=u.detail,h=d.element;p.setters.removeActiveManipulatorForElement(h),n.deleteIfHandleOutsideImage&&Object(a.default)(d,t.handles)&&Object(o.removeToolState)(h,e,t),x(t,n,r,{dragHandler:s,upOrEndHandler:l},h,c,!0)}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=r.dragHandler,o=r.upOrEndHandler,s=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0,c=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];e.active=!1,e.invalidated=!0,u.state.isToolLocked=!1,m[n].forEach((function(e){s.removeEventListener(e,a)})),g[n].forEach((function(e){s.removeEventListener(e,o)})),"function"==typeof t.doneMovingCallback&&(f.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),t.doneMovingCallback(c)),"function"==typeof l&&l(c),i.default.cornerstone.updateImage(s)}t.default=function(e,t,n,r){var i=e.element,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",s=arguments.length>6?arguments[6]:void 0;a=Object.assign({deleteIfHandleOutsideImage:u.state.deleteIfHandleOutsideImage,preventHandleOutsideImage:u.state.preventHandleOutsideImage},a);var l=v.bind(this,t,n,a,o),c=function e(r){b(t,n,a,o,{dragHandler:l,upOrEndHandler:e},r,s)};p.setters.addActiveManipulatorForElement(i,y.bind(null,n,a,o,{dragHandler:l,upOrEndHandler:c},i,s)),n.active=!0,u.state.isToolLocked=!0,m[o].forEach((function(e){i.addEventListener(e,l)})),g[o].forEach((function(e){i.addEventListener(e,c)}))}},"./manipulators/moveHandle.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./externalModules.js"),a=n("./manipulators/anyHandlesOutsideImage.js"),o=n("./stateManagement/toolState.js"),s=n("./util/triggerEvent.js"),l=n("./util/clip.js"),u=n("./store/index.js"),c=n("./util/getActiveTool.js"),d=n("./tools/base/BaseAnnotationTool.js"),h=n("./util/logger.js"),f=Object(h.getLogger)("manipulators:moveHandle"),p=Object(u.getModule)("manipulatorState"),m={value:!1},g={mouse:[r.default.MOUSE_DRAG],touch:[r.default.TOUCH_DRAG]},v={mouse:[r.default.MOUSE_UP,r.default.MOUSE_CLICK],touch:[r.default.TOUCH_END,r.default.TOUCH_DRAG_END,r.default.TOUCH_PINCH,r.default.TOUCH_PRESS,r.default.TAP]};function y(e,t,n,a,o,u){var h=u.detail,f=h.image,p=h.element,g=h.buttons,v=h.currentPoints.page,y=i.default.cornerstone.pageToPixel(p,v.x,"touch"===o?v.y+-57:v.y);m.value=!1,n.active=!0,n.hasMoved=!0,n.x=y.x,n.y=y.y,t.invalidated=!0,a.preventHandleOutsideImage&&Object(l.clipToBox)(n,f),i.default.cornerstone.updateImage(p);var b=Object(c.default)(p,g,o);b instanceof d.default&&b.updateCachedStats(f,p,t);var x=r.default.MEASUREMENT_MODIFIED,w={toolName:e,toolType:e,element:p,measurementData:t};Object(s.default)(p,x,w)}function b(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=o.dragHandler,l=o.upOrEndHandler,u=arguments.length>7?arguments[7]:void 0;w(e,t,n,r,i,a,{dragHandler:s,upOrEndHandler:l},u,!1)}function x(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=o.dragHandler,l=o.upOrEndHandler,u=arguments.length>7?arguments[7]:void 0,c=t.element;p.setters.removeActiveManipulatorForElement(c),w(e,t,n,r,i,a,{dragHandler:s,upOrEndHandler:l},u,!0)}function w(e,t,n,r){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},l=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0,d=c.dragHandler,h=c.upOrEndHandler,p=arguments.length>7?arguments[7]:void 0,y=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],b=t.element;r.active=!1,r.moving=!1,n.active=!1,n.invalidated=!0,m.value=!1,u.state.isToolLocked=!1,g[l].forEach((function(e){b.removeEventListener(e,d)})),v[l].forEach((function(e){b.removeEventListener(e,h)})),s.deleteIfHandleOutsideImage&&Object(a.default)(t,n.handles)&&Object(o.removeToolState)(b,e,n),"function"==typeof s.doneMovingCallback&&(f.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),s.doneMovingCallback(y)),"function"==typeof p&&p(y),i.default.cornerstone.updateImage(b)}function _(e,t,n,r){if(t.value){var a=Math.abs(e.y-r.y),o=a/10;if(a<1)return e.y=r.y,void(t.value=!1);e.y>r.y?e.y-=o:e.y<r.y&&(e.y+=o),i.default.cornerstone.updateImage(n.element),i.default.cornerstone.requestAnimationFrame((function(){_(e,t,n,r)}))}}t.default=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",s=arguments.length>6?arguments[6]:void 0;a=Object.assign({deleteIfHandleOutsideImage:u.state.deleteIfHandleOutsideImage,preventHandleOutsideImage:u.state.preventHandleOutsideImage},a);var l=e.element,c=y.bind(this,t,n,r,a,o),d=function i(){x(t,e,n,r,a,o,{dragHandler:c,upOrEndHandler:i},s)};if(p.setters.addActiveManipulatorForElement(l,b.bind(null,t,e,n,r,a,o,{dragHandler:c,upOrEndHandler:d},s)),r.active=!0,r.moving=!0,n.active=!0,u.state.isToolLocked=!0,g[o].forEach((function(e){l.addEventListener(e,c)})),v[o].forEach((function(e){l.addEventListener(e,d)})),"touch"===o){m.value=!0;var h=i.default.cornerstone.getEnabledElement(l),f=-57,w={x:e.currentPoints.page.x,y:e.currentPoints.page.y+f},S=i.default.cornerstone.pageToPixel(l,w.x,w.y);_(r,m,h,S)}}},"./manipulators/moveNewHandle.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./externalModules.js"),a=n("./manipulators/anyHandlesOutsideImage.js"),o=n("./stateManagement/toolState.js"),s=n("./util/triggerEvent.js"),l=n("./util/clip.js"),u=n("./store/index.js"),c=n("./util/getActiveTool.js"),d=n("./tools/base/BaseAnnotationTool.js"),h=n("./util/logger.js"),f=Object(h.getLogger)("manipulators:moveNewHandle"),p=Object(u.getModule)("manipulatorState"),m={mouse:[r.default.MOUSE_MOVE,r.default.MOUSE_DRAG],touch:[r.default.TOUCH_DRAG]},g={mouse:[r.default.MOUSE_UP,r.default.MOUSE_CLICK],touch:[r.default.TOUCH_END,r.default.TOUCH_PINCH,r.default.TAP]};function v(e,t,n,a,o,u){var h=u.detail,f=h.currentPoints,p=h.image,m=h.element,g=h.buttons;a.hasMoved=!0;var v=f.page,y=i.default.cornerstone.pageToPixel(m,"touch"===o?v.x+-57:v.x,"touch"===o?v.y+-57:v.y);t.invalidated=!0,n.active=!0,n.x=y.x,n.y=y.y,a&&a.preventHandleOutsideImage&&Object(l.clipToBox)(n,p),i.default.cornerstone.updateImage(m);var b=Object(c.default)(m,g,o);b instanceof d.default&&b.updateCachedStats(p,m,t);var x=r.default.MEASUREMENT_MODIFIED,w={toolName:e,toolType:e,element:m,measurementData:t};Object(s.default)(m,x,w)}function y(e,t,n,a,o){var s=a.moveHandler,l=a.moveEndHandler,c=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];m[e].forEach((function(e){n.removeEventListener(e,s)})),g[e].forEach((function(e){n.removeEventListener(e,l)})),n.removeEventListener(r.default.TOUCH_START,w),u.state.isToolLocked=!1,"function"==typeof o&&o(c),"function"==typeof t.doneMovingCallback&&(f.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),t.doneMovingCallback(c)),i.default.cornerstone.updateImage(n)}function b(e,t,n,r,s,u,c,d){var h=u.moveHandler,f=u.moveEndHandler,m=c.detail,g=m.element;if(!1!==r.hasMoved){var v=m.currentPoints.page,b=i.default.cornerstone.pageToPixel(g,"touch"===s?v.x+-57:v.x,"touch"===s?v.y+-57:v.y);t.active=!1,t.invalidated=!0,n.active=!1,n.moving=!1,n.x=b.x,n.y=b.y,p.setters.removeActiveManipulatorForElement(g),r.preventHandleOutsideImage&&Object(l.clipToBox)(n,c.detail.image),r.deleteIfHandleOutsideImage&&Object(a.default)(c.detail,t.handles)&&(t.cancelled=!0,Object(o.removeToolState)(g,e,t)),y(s,r,g,{moveHandler:h,moveEndHandler:f},d,!0)}}function x(e,t,n,r,i,a,o){var s=i.moveHandler,l=i.moveEndHandler;e.active=!1,e.invalidated=!0,t.active=!1,y(r,n,a,{moveHandler:s,moveEndHandler:l},o,!1)}function w(e){return e.stopImmediatePropagation(),!1}t.default=function(e,t,n,i,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",s=arguments.length>6?arguments[6]:void 0;(a=Object.assign({deleteIfHandleOutsideImage:u.state.deleteIfHandleOutsideImage,preventHandleOutsideImage:u.state.preventHandleOutsideImage},a)).hasMoved=!1;var l=e.element;function c(e){v(t,n,i,a,o,e)}function d(e){b(t,n,i,a,o,{moveHandler:c,moveEndHandler:d},e,s)}n.active=!0,i.moving=!0,i.active=!0,u.state.isToolLocked=!0,m[o].forEach((function(e){l.addEventListener(e,c)})),l.addEventListener(r.default.TOUCH_START,w),g[o].forEach((function(e){l.addEventListener(e,d)})),p.setters.addActiveManipulatorForElement(l,x.bind(null,n,i,a,o,{moveHandler:c,moveEndHandler:d},l,s))}},"./mixins/activeOrDisabledBinaryTool.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/setToolMode.js");t.default={passiveCallback:function(e){Object(r.setToolDisabledForElement)(e,this.name)},enabledCallback:function(e){Object(r.setToolActiveForElement)(e,this.name)}}},"./mixins/enabledOrDisabledBinaryTool.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/setToolMode.js");t.default={passiveCallback:function(e){Object(r.setToolDisabledForElement)(e,this.name)},activeCallback:function(e){Object(r.setToolEnabledForElement)(e,this.name)}}},"./mixins/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./mixins/activeOrDisabledBinaryTool.js"),i=n("./mixins/enabledOrDisabledBinaryTool.js"),a=n("./mixins/segmentation/circleSegmentationMixin.js"),o=n("./mixins/segmentation/polylineSegmentationMixin.js"),s=n("./mixins/segmentation/freehandSegmentationMixin.js"),l=n("./mixins/segmentation/rectangleSegmentationMixin.js"),u=n("./mixins/segmentation/renderBrushMixin.js");t.default={activeOrDisabledBinaryTool:r.default,enabledOrDisabledBinaryTool:i.default,circleSegmentationMixin:a.default,polylineSegmentationMixin:o.default,freehandSegmentationMixin:s.default,rectangleSegmentationMixin:l.default,renderBrushMixin:u.default}},"./mixins/segmentation/circleSegmentationMixin.js":function(e,t,n){"use strict";n.r(t);var r=n("./drawing/index.js"),i=n("./externalModules.js"),a=n("./util/isEmptyObject.js"),o=n("./store/index.js"),s=n("./util/segmentation/index.js"),l=Object(o.getModule)("segmentation"),u=l.getters,c=l.setters;function d(){this.handles={start:{},end:{}}}function h(e){var t=e.detail.element,n=e.detail.currentPoints.image;return Object(a.default)(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),i.default.cornerstone.updateImage(t),!0}function f(e){var t=e.detail,n=t.element;this.handles.end=t.currentPoints.image,i.default.cornerstone.updateImage(n)}function p(e){e.detail.handles=this.handles;var t=e.detail.element,n=u.labelmap2D(t),r=n.labelmap2D,a=n.labelmap3D,o=n.currentImageIdIndex,l=r.pixelData,d=l.slice();this.applyActiveStrategy(e,{points:{start:{x:this.handles.start.x,y:this.handles.start.y},end:{x:this.handles.end.x,y:this.handles.end.y}},pixelData:l,segmentIndex:a.activeSegmentIndex,segmentationMixinType:"circleSegmentationMixin"});var h={imageIdIndex:o,diff:Object(s.getDiffBetweenPixelData)(d,l)};c.pushState(this.element,[h]),c.updateSegmentsOnLabelmap2D(r),i.default.cornerstone.updateImage(t),this._resetHandles()}t.default={postTouchStartCallback:h,postMouseDownCallback:h,mouseClickCallback:h,touchDragCallback:f,mouseDragCallback:f,mouseMoveCallback:f,touchEndCallback:p,mouseUpCallback:p,initializeMixin:d,renderToolData:function(e){var t=this,n=e.detail,a=n.element,o=u.brushColor(a,!0),s=Object(r.getNewContext)(n.canvasContext.canvas),l=i.default.cornerstoneMath.point.distance;Object(r.draw)(s,(function(e){if(!t.handles)return null;var n=i.default.cornerstone.pixelToCanvas(a,t.handles.start),s=i.default.cornerstone.pixelToCanvas(a,t.handles.end),u=l(n,s);Object(r.drawCircle)(e,a,t.handles.start,u,{color:o})}))},_resetHandles:d,_applyStrategy:p}},"./mixins/segmentation/freehandSegmentationMixin.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=n.n(r),a=n("./externalModules.js"),o=n("./store/index.js"),s=n("./util/logger.js"),l=n("./drawing/index.js"),u=n("./util/segmentation/index.js"),c=Object(s.getLogger)("tools:ScissorsTool"),d=Object(o.getModule)("segmentation"),h=d.getters,f=d.setters;function p(e){var t=e.detail.element,n=e.detail.currentPoints.image,r=this.handles.points;if(!r.length)return c.warn("Something went wrong, empty handles detected."),null;r.push({x:n.x,y:n.y,lines:[]}),this.currentHandle+=1,a.default.cornerstone.updateImage(t)}function m(e){var t=e.detail.element;this._addPoint(e.detail),a.default.cornerstone.updateImage(t)}function g(e){var t=this.handles.points,n=e.detail.element,r=h.labelmap2D(n),i=r.labelmap2D,o=r.labelmap3D,s=r.currentImageIdIndex,l=i.pixelData,c=l.slice();this.applyActiveStrategy(e,{points:t,pixelData:l,segmentIndex:o.activeSegmentIndex,segmentationMixinType:"freehandSegmentationMixin"});var d={imageIdIndex:s,diff:Object(u.getDiffBetweenPixelData)(c,l)};f.pushState(this.element,[d]),f.updateSegmentsOnLabelmap2D(i),a.default.cornerstone.updateImage(n),this._resetHandles()}function v(){this.handles={points:[]},this.currentHandle=0}t.default={postTouchStartCallback:p,postMouseDownCallback:p,mouseClickCallback:p,touchDragCallback:m,mouseDragCallback:m,mouseMoveCallback:m,touchEndCallback:g,mouseUpCallback:g,initializeMixin:v,renderToolData:function(e){var t=e.detail,n=t.element,r=h.brushColor(n,!0),a=Object(l.getNewContext)(t.canvasContext.canvas),o=this.handles.points;o.length<2||Object(l.draw)(a,(function(e){for(var t=0;t<o.length;t++){var a=i()(o[t].lines);t===o.length-1&&a.push(o[0]),Object(l.drawJoinedLines)(e,n,o[t],a,{color:r})}}))},_resetHandles:v,_addPoint:function(e){var t=this.handles.points;t.length&&t[this.currentHandle-1].lines.push({x:e.currentPoints.image.x,y:e.currentPoints.image.y,lines:[]}),t.push({x:e.currentPoints.image.x,y:e.currentPoints.image.y,lines:[]}),this.currentHandle+=1,a.default.cornerstone.updateImage(e.element)},_applyStrategy:g}},"./mixins/segmentation/polylineSegmentationMixin.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=n.n(r),a=n("./drawing/index.js"),o=n("./store/index.js"),s=n("./mixins/segmentation/freehandSegmentationMixin.js"),l=Object(o.getModule)("segmentation").getters,u=Object.assign({},s.default,{renderToolData:function(e){var t=this,n=e.detail,r=n.element,o=l.brushColor(r,!0),s=Object(a.getNewContext)(n.canvasContext.canvas),u=this.handles;Object(a.draw)(s,(function(e){if(u.points.length>1)for(var n=0;n<u.points.length;n++){var s=i()(u.points[n].lines);Object(a.drawJoinedLines)(e,r,t.handles.points[n],s,{color:o})}}))}});t.default=u},"./mixins/segmentation/rectangleSegmentationMixin.js":function(e,t,n){"use strict";n.r(t);var r=n("./drawing/index.js"),i=n("./externalModules.js"),a=n("./util/isEmptyObject.js"),o=n("./store/index.js"),s=n("./util/segmentation/index.js"),l=Object(o.getModule)("segmentation"),u=l.getters,c=l.setters;function d(e){var t=e.detail.element,n=e.detail.currentPoints.image;return Object(a.default)(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),i.default.cornerstone.updateImage(t),!0}function h(e){var t=e.detail,n=t.element;this.handles.end=t.currentPoints.image,i.default.cornerstone.updateImage(n)}function f(e){e.detail.handles=this.handles;var t=e.detail.element,n=u.labelmap2D(t),r=n.labelmap2D,a=n.labelmap3D,o=n.currentImageIdIndex,l=r.pixelData,d=l.slice();this.applyActiveStrategy(e,{points:[{x:this.handles.start.x,y:this.handles.start.y},{x:this.handles.end.x,y:this.handles.end.y}],pixelData:l,segmentIndex:a.activeSegmentIndex,segmentationMixinType:"rectangleSegmentationMixin"});var h={imageIdIndex:o,diff:Object(s.getDiffBetweenPixelData)(d,l)};c.pushState(this.element,[h]),c.updateSegmentsOnLabelmap2D(r),i.default.cornerstone.updateImage(t),this._resetHandles()}function p(){this.handles={start:{},end:{}}}t.default={postTouchStartCallback:d,postMouseDownCallback:d,mouseClickCallback:d,touchDragCallback:h,mouseDragCallback:h,mouseMoveCallback:h,touchEndCallback:f,mouseUpCallback:f,initializeMixin:p,renderToolData:function(e){var t=this,n=e.detail,i=n.element,a=u.brushColor(i,!0),o=Object(r.getNewContext)(n.canvasContext.canvas);Object(r.draw)(o,(function(e){Object(r.drawRect)(e,i,t.handles.start,t.handles.end,{color:a})}))},_resetHandles:p,_applyStrategy:f}},"./mixins/segmentation/renderBrushMixin.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./store/index.js");t.default={renderBrush:function(e){var t,n=r.default.cornerstone,a=Object(i.getModule)("segmentation"),o=a.getters,s=a.configuration,l=e.detail,u=l.viewport;if(this._drawing?t=this._lastImageCoords:this._mouseUpRender?(t=this._lastImageCoords,this._mouseUpRender=!1):t=i.default.state.mousePositionImage,t){var c=l.image,d=t.x,h=t.y;if(!(d<0||d>c.columns||h<0||h>c.rows)){var f=s.radius,p=l.canvasContext,m=l.element,g=o.brushColor(m,this._drawing);p.setTransform(1,0,0,1,0,0);var v=f*u.scale,y=n.pixelToCanvas(m,t);p.beginPath(),p.strokeStyle=g,p.ellipse(y.x,y.y,v,v,0,0,2*Math.PI),p.stroke()}}}}},"./orientation/getOrientationString.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./util/convertToVector3.js");t.default=function(e){for(var t=Object(i.default)(e),n="",a=t.x<0?"R":"L",o=t.y<0?"A":"P",s=t.z<0?"F":"H",l=new r.default.cornerstoneMath.Vector3(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z)),u=1e-4,c=0;c<3;c++)if(l.x>u&&l.x>l.y&&l.x>l.z)n+=a,l.x=0;else if(l.y>u&&l.y>l.x&&l.y>l.z)n+=o,l.y=0;else if(l.z>u&&l.z>l.x&&l.z>l.y)n+=s,l.z=0;else if(l.x>u&&l.y>u&&l.x===l.y)n+=a+o,l.x=0,l.y=0;else if(l.x>u&&l.z>u&&l.x===l.z)n+=a+s,l.x=0,l.z=0;else{if(!(l.y>u&&l.z>u&&l.y===l.z))break;n+=o+s,l.y=0,l.z=0}return n}},"./orientation/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./orientation/getOrientationString.js"),i=n("./orientation/invertOrientationString.js");t.default={getOrientationString:r.default,invertOrientationString:i.default}},"./orientation/invertOrientationString.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=e.replace("H","f");return(t=(t=(t=(t=(t=t.replace("F","h")).replace("R","l")).replace("L","r")).replace("A","p")).replace("P","a")).toUpperCase()}},"./requestPool/requestPoolManager.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./util/getMaxSimultaneousRequests.js"),a={interaction:[],thumbnail:[],prefetch:[]},o={interaction:0,thumbnail:0,prefetch:0},s={interaction:6,thumbnail:6,prefetch:5},l=!1;function u(){l&&setTimeout((function(){d()}),20)}function c(e){var t=r.default.cornerstone,n=e.type;o[n]++,l=!0;var i=e.imageId,a=e.doneCallback,s=e.failCallback,c=t.imageCache.getImageLoadObject(i);if(c)c.promise.then((function(e){o[n]--,a(e),u()}),(function(e){o[n]--,s(e),u()}));else{var d=function(e){return"prefetch"===e.type?-5:"interactive"===e.type?0:"thumbnail"===e.type?5:void 0}(e);(!0===e.preventCache?t.loadImage(i,{priority:d,type:e.type}):t.loadAndCacheImage(i,{priority:d,type:e.type})).then((function(e){o[n]--,a(e),u()}),(function(e){o[n]--,s(e),u()}))}}function d(){var e=Object(i.getMaxSimultaneousRequests)();s={interaction:Math.max(e,1),thumbnail:Math.max(e-2,1),prefetch:Math.max(e-1,1)};for(var t=e-(o.interaction+o.thumbnail+o.prefetch),n=0;n<t;n++){var r=a.interaction.length&&o.interaction<s.interaction?a.interaction.shift():a.thumbnail.length&&o.thumbnail<s.thumbnail?a.thumbnail.shift():a.prefetch.length&&o.prefetch<s.prefetch?a.prefetch.shift():(a.interaction.length||a.thumbnail.length||a.prefetch.length||(l=!1),!1);r&&c(r)}}t.default={addRequest:function(e,t,n,i,o,s,u){if(!a.hasOwnProperty(n))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");if(e&&t){var c={type:n,imageId:t,preventCache:i,doneCallback:o,failCallback:s},d=r.default.cornerstone.imageCache.getImageLoadObject(t);d?d.promise.then((function(e){o(e)}),(function(e){s(e)})):(u?a[n].unshift(c):a[n].push(c),l=!0)}},clearRequestStack:function(e){if(!a.hasOwnProperty(e))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");a[e]=[]},startGrabbing:d,getRequestPool:function(){return a}}},"./stackTools/fusionRenderer.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("./externalModules.js"),l=n("./stateManagement/toolState.js"),u=function(){function e(){i()(this,e),this.currentImageIdIndex=0,this.layerIds=[],this.findImageFn=void 0}return o()(e,[{key:"render",value:function(e,t){var n=this;if(!Number.isInteger(this.currentImageIdIndex))throw new Error("FusionRenderer: render - Image ID Index is not an integer");if(!this.findImageFn)throw new Error("No findImage function has been defined");t||(t=Object(l.getToolState)(e,"stack").data);var r=s.default.cornerstone,i=t[0],a=i.imageIds[this.currentImageIdIndex],o=t.slice(1,t.length);r.loadAndCacheImage(a).then((function(t){var s=n.layerIds[0];s?r.setLayerImage(e,t,s):(s=r.addLayer(e,t,i.options),n.layerIds.push(s)),r.displayImage(e,t),o.forEach((function(t,i){var o=n.findImageFn(t.imageIds,a),l=n.layerIds[i+1];l||(l=r.addLayer(e,void 0,t.options),n.layerIds.push(l)),o?r.loadAndCacheImage(o).then((function(t){r.setLayerImage(e,t,l),r.updateImage(e)})):(r.setLayerImage(e,void 0,l),r.setActiveLayer(e,s),r.updateImage(e))}))}))}}]),e}()},"./stackTools/playClip.js":function(e,t,n){"use strict";n.r(t),n.d(t,"playClip",(function(){return c})),n.d(t,"stopClip",(function(){return d}));var r=n("./events.js"),i=n("./externalModules.js"),a=n("./stateManagement/loadHandlerManager.js"),o=n("./stateManagement/toolState.js"),s=n("./util/triggerEvent.js"),l="playClip";function u(e){var t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}function c(e,t){var n,c;if(void 0===e)throw new Error("playClip: element must not be undefined");var d=Object(o.getToolState)(e,"stack");if(d&&d.data&&d.data.length){var h,f=i.default.cornerstone;if(d.data.length>1){var p=Object(o.getToolState)(e,"stackRenderer");p&&p.data&&p.data.length&&(h=p.data[0])}var m=d.data[0],g=Object(o.getToolState)(e,l);g&&g.data&&g.data.length?u(n=g.data[0]):(n={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0},Object(o.addToolState)(e,l,n)),(t<0||t>0)&&(n.framesPerSecond=Number(t),n.reverse=n.framesPerSecond<0,n.ignoreFrameTimeVector=!0),!0!==n.ignoreFrameTimeVector&&n.frameTimeVector&&n.frameTimeVector.length===m.imageIds.length&&(c=function(e,t){var n,r,i,a=0,o=e.length,s=[];for(s.isTimeVarying=!1,("number"!=typeof t||t<=0)&&(t=1),n=1;n<o;n++)i=Number(e[n])/t|0,s.push(i),1===n?r=i:i!==r&&(s.isTimeVarying=!0),a+=i;return s.length>0&&s.push(i=s.isTimeVarying?a/s.length|0:s[0]),s}(n.frameTimeVector,n.speed));var v=function(){var t,i,o,l=m.currentImageIdIndex,c=m.imageIds.length;if(n.reverse?l--:l++,!n.loop&&(l<0||l>=c))return u(n),void function(e){var t={element:e};Object(s.default)(e,r.default.CLIP_STOPPED,t)}(e);l>=c&&(l=0),l<0&&(l=c-1),l!==m.currentImageIdIndex&&(t=a.default.getStartLoadHandler(e),i=a.default.getEndLoadHandler(e),o=a.default.getErrorLoadingHandler(e),t&&t(e),(!0===m.preventCache?f.loadImage(m.imageIds[l]):f.loadAndCacheImage(m.imageIds[l])).then((function(t){try{m.currentImageIdIndex=l,h?(h.currentImageIdIndex=l,h.render(e,d.data)):f.displayImage(e,t),i&&i(e,t)}catch(n){return}}),(function(t){o&&o(e,m.imageIds[l],t)})))};c&&c.length>0&&c.isTimeVarying?(n.usingFrameTimeVector=!0,n.intervalId=setTimeout((function e(){n.intervalId=setTimeout(e,c[m.currentImageIdIndex]),v()}),0)):(n.usingFrameTimeVector=!1,n.intervalId=setInterval(v,1e3/Math.abs(n.framesPerSecond)))}}function d(e){var t=Object(o.getToolState)(e,l);t&&t.data&&t.data.length&&u(t.data[0])}},"./stackTools/stackPrefetch.js":function(e,t,n){"use strict";n.r(t);var r,i=n("./externalModules.js"),a=n("./requestPool/requestPoolManager.js"),o=n("./stateManagement/loadHandlerManager.js"),s=n("./stateManagement/toolState.js"),l=n("./util/getMaxSimultaneousRequests.js"),u=n("./util/logger.js"),c=n("./util/triggerEvent.js"),d=n("./events.js"),h=Object(u.getLogger)("stackTools:stackPrefetch"),f="stackPrefetch",p="prefetch",m={maxImagesToPrefetch:1/0,preserveExistingPool:!1};function g(e,t){e=Math.round(e)||0;var n=[],r=(t=Math.round(t)||0)-e+1;if(r<=0)return n;for(;r--;)n[r]=t--;return n}var v=function(e){return Math.max.apply(null,e)},y=function(e){return Math.min.apply(null,e)};function b(e){var t=Object(s.getToolState)(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0],r=Object(s.getToolState)(e,f);if(r){var l=r.data[0]||{};if(l.indicesToRequest&&l.indicesToRequest.length||(l.enabled=!1),!1!==l.enabled&&(r.data[0].indicesToRequest.sort((function(e,t){return e-t})),l.indicesToRequest.slice().forEach((function(e){var t=n.imageIds[e];t&&i.default.cornerstone.imageCache.getImageLoadObject(t)&&P(e)})),l.indicesToRequest.length)){m.preserveExistingPool||a.default.clearRequestStack(p);for(var u,g,b,x,w,_,S=(g=n.currentImageIdIndex,b=[],x=[],(u=l.indicesToRequest).forEach((function(e){e<g?b.push(e):e>g&&x.push(e)})),{low:u.indexOf(v(b)),high:u.indexOf(y(x))}),E=o.default.getErrorLoadingHandler(e),T=S.low,k=S.high,C=[];T>=0||k<l.indicesToRequest.length;){var I=n.currentImageIdIndex,O=!(I-l.indicesToRequest[T]>m.maxImagesToPrefetch)&&T>=0,A=!(l.indicesToRequest[k]-I>m.maxImagesToPrefetch)&&k<l.indicesToRequest.length;if(!A&&!O)break;O&&(_=l.indicesToRequest[T--],C.push(w=n.imageIds[_])),A&&(_=l.indicesToRequest[k++],C.push(w=n.imageIds[_]))}var D=!0,M=!1,N=void 0;try{for(var j,R=C.reverse()[Symbol.iterator]();!(D=(j=R.next()).done);D=!0)a.default.addRequest(e,j.value,p,!1,F,L,!0)}catch($){M=!0,N=$}finally{try{D||null==R.return||R.return()}finally{if(M)throw N}}a.default.startGrabbing()}}}function P(e){var t=l.indicesToRequest.indexOf(e);t>-1&&l.indicesToRequest.splice(t,1)}function F(t){h.log("prefetch done: %s",t.imageId);var r=n.imageIds.indexOf(t.imageId);P(r),Object(c.default)(e,d.default.STACK_PREFETCH_IMAGE_LOADED,{element:e,imageId:t.imageId,imageIndex:r,stackPrefetch:l,stack:n}),l.indicesToRequest&&l.indicesToRequest.length>0||Object(c.default)(e,d.default.STACK_PREFETCH_DONE,{element:e,stackPrefetch:l,stack:n})}function L(t){h.log("prefetch errored: %o",t),E&&E(e,w,t,"stackPrefetch")}}function x(e){return function(t){var n,r=t.detail;try{n=Object(s.getToolState)(e,"stack")}catch(o){return}if(n&&n.data&&n.data.length){var i=n.data[0].imageIds.indexOf(r.imageId);if(!(i<0)){var a=Object(s.getToolState)(e,f);a&&a.data&&a.data.length&&a.data[0].indicesToRequest.push(i)}}}}function w(e){clearTimeout(r),r=setTimeout((function(){var t=e.target;try{b(t)}catch(n){return}}),10)}t.default={enable:function(e){Object(s.getToolState)(e,f).data=[];var t=Object(s.getToolState)(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];if(!0!==n.preventCache){var r={indicesToRequest:g(0,n.imageIds.length-1),enabled:!0,direction:1},a=r.indicesToRequest.indexOf(n.currentImageIdIndex);r.indicesToRequest.splice(a,1),Object(s.addToolState)(e,f,r),b(e),e.removeEventListener(i.default.cornerstone.EVENTS.NEW_IMAGE,w),e.addEventListener(i.default.cornerstone.EVENTS.NEW_IMAGE,w);var o=x(e);i.default.cornerstone.events.removeEventListener(i.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,o),i.default.cornerstone.events.addEventListener(i.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,o)}else h.warn("A stack that should not be cached was given the stackPrefetch")}},disable:function(e){clearTimeout(r),e.removeEventListener(i.default.cornerstone.EVENTS.NEW_IMAGE,w);var t=x(e);i.default.cornerstone.events.removeEventListener(i.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,t);var n=Object(s.getToolState)(e,f);n&&n.data.length&&(n.data[0].enabled=!1,a.default.clearRequestStack(p))},getConfiguration:function(){return m},setConfiguration:function(e){m=e,e.maxSimultaneousRequests&&Object(l.setMaxSimultaneousRequests)(e.maxSimultaneousRequests)}}},"./stackTools/stackRenderers.js":function(e,t,n){"use strict";n.r(t);var r=n("./stackTools/fusionRenderer.js"),i={};i.FusionRenderer=r.default,t.default=i},"./stateManagement/frameOfReferenceStateManager.js":function(e,t,n){"use strict";function r(){var e={};return{get:function(t,n){if(!1!==e.hasOwnProperty(t)){var r=e[t];if(!1!==r.hasOwnProperty(n))return r[n]}},add:function(t,n,r){!1===e.hasOwnProperty(t)&&(e[t]={});var i=e[t];!1===i.hasOwnProperty(n)&&(i[n]={data:[]}),i[n].data.push(r)},remove:function(t,n,r){if(!1!==e.hasOwnProperty(t)){var i=e[t];if(!1!==i.hasOwnProperty(n)){for(var a=i[n],o=-1,s=0;s<a.data.length;s++)a.data[s]===r&&(o=s);-1!==o&&a.data.splice(o,1)}}}}}n.r(t),n.d(t,"newFrameOfReferenceSpecificToolStateManager",(function(){return r})),n.d(t,"globalFrameOfReferenceSpecificToolStateManager",(function(){return i}));var i=r()},"./stateManagement/imageIdSpecificStateManager.js":function(e,t,n){"use strict";n.r(t),n.d(t,"newImageIdSpecificToolStateManager",(function(){return i})),n.d(t,"globalImageIdSpecificToolStateManager",(function(){return a}));var r=n("./externalModules.js");function i(){var e={};function t(t,n,r){!1===e.hasOwnProperty(t)&&(e[t]={});var i=e[t];!1===i.hasOwnProperty(n)&&(i[n]={data:[]}),i[n].data.push(r)}function n(t,n){if(!1!==e.hasOwnProperty(t)){var r=e[t];if(!1!==r.hasOwnProperty(n))return r[n]}}function i(t){!1!==e.hasOwnProperty(t)&&delete e[t]}return{get:function(e,t){var i=r.default.cornerstone.getEnabledElement(e);if(i.image)return n(i.image.imageId,t)},add:function(e,n,i){var a=r.default.cornerstone.getEnabledElement(e);a.image&&t(a.image.imageId,n,i)},clear:function(e){var t=r.default.cornerstone.getEnabledElement(e);t.image&&i(t.image.imageId)},getImageIdToolState:n,addImageIdToolState:t,clearImageIdToolState:i,saveImageIdToolState:function(t){return e[t]},restoreImageIdToolState:function(t,n){e[t]=n},saveToolState:function(){return e},restoreToolState:function(t){e=t},toolState:e}}var a=i()},"./stateManagement/loadHandlerManager.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i={},a={},o={};function s(e){if(!e)return"DEFAULT";var t=r.default.cornerstone.getEnabledElement(e).uuid;if(!t)throw new Error("Something went wrong when getting uuid from element");return t}t.default={setStartLoadHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=s(t);i[n]=e},getStartLoadHandler:function(e){var t=s(e);return i[t]||i.DEFAULT},setEndLoadHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=s(t);a[n]=e},getEndLoadHandler:function(e){var t=s(e);return a[t]||a.DEFAULT},setErrorLoadingHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=s(t);o[n]=e},getErrorLoadingHandler:function(e){var t=s(e);return o[t]||o.DEFAULT},removeHandlers:function(e){var t=s(e);delete i[t],delete a[t],delete o[t]}}},"./stateManagement/stackSpecificStateManager.js":function(e,t,n){"use strict";n.r(t),n.d(t,"stackSpecificStateManager",(function(){return l})),n.d(t,"newStackSpecificToolStateManager",(function(){return a})),n.d(t,"addStackStateManager",(function(){return s}));var r=n("./stateManagement/imageIdSpecificStateManager.js"),i=n("./stateManagement/toolState.js");function a(e,t){var n={};return{get:function(r,i){return e.indexOf(i)>=0?(!1===n.hasOwnProperty(i)&&(n[i]={data:[]}),n[i]):t.get(r,i)},add:function(r,i,a){if(!(e.indexOf(i)>=0))return t.add(r,i,a);!1===n.hasOwnProperty(i)&&(n[i]={data:[]}),n[i].data.push(a)},saveToolState:function(){return n},restoreToolState:function(e){n=e},toolState:n}}var o=[];function s(e,t){var n=Object(i.getElementToolStateManager)(e);n||(n=r.globalImageIdSpecificToolStateManager);var s=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs","stackRenderer"];t&&(s=s.concat(t));var l=a(s,n);o.push(l),Object(i.setElementToolStateManager)(e,l)}var l={newStackSpecificToolStateManager:a,addStackStateManager:s}},"./stateManagement/textStyle.js":function(e,t,n){"use strict";n.r(t);var r=15,i="".concat(r,"px Arial"),a="transparent";t.default={setFont:function(e){i=e},getFont:function(){return i},setFontSize:function(e){r=e},getFontSize:function(){return r},setBackgroundColor:function(e){a=e},getBackgroundColor:function(){return a}}},"./stateManagement/toolColors.js":function(e,t,n){"use strict";n.r(t);var r="white",i="greenyellow",a="transparent";t.default={setFillColor:function(e){a=e},getFillColor:function(){return a},setToolColor:function(e){r=e},getToolColor:function(){return r},setActiveColor:function(e){i=e},getActiveColor:function(){return i},getColorIfActive:function(e){return e.color?e.color:e.active?i:r}}},"./stateManagement/toolCoordinates.js":function(e,t,n){"use strict";var r;n.r(t),t.default={setCoords:function(e){r=e.currentPoints.canvas},getCoords:function(){return r}}},"./stateManagement/toolState.js":function(e,t,n){"use strict";n.r(t),n.d(t,"addToolState",(function(){return u})),n.d(t,"getToolState",(function(){return c})),n.d(t,"removeToolState",(function(){return d})),n.d(t,"clearToolState",(function(){return h})),n.d(t,"setElementToolStateManager",(function(){return f})),n.d(t,"getElementToolStateManager",(function(){return l}));var r=n("./events.js"),i=n("./externalModules.js"),a=n("./stateManagement/imageIdSpecificStateManager.js"),o=n("./util/triggerEvent.js"),s=n("./util/uuidv4.js");function l(e){var t=i.default.cornerstone.getEnabledElement(e);return void 0===t.toolStateManager&&(t.toolStateManager=a.globalImageIdSpecificToolStateManager),t.toolStateManager}function u(e,t,n){var i=l(e);n.uuid=n.uuid||Object(s.default)(),i.add(e,t,n);var a=r.default.MEASUREMENT_ADDED,u={toolName:t,toolType:t,element:e,measurementData:n};Object(o.default)(e,a,u)}function c(e,t){return l(e).get(e,t)}function d(e,t,n){var i=l(e).get(e,t);if(i&&i.data&&i.data.length){for(var a=-1,s=0;s<i.data.length;s++)i.data[s]===n&&(a=s);if(-1!==a){i.data.splice(a,1);var u=r.default.MEASUREMENT_REMOVED,c={toolName:t,toolType:t,element:e,measurementData:n};Object(o.default)(e,u,c)}}}function h(e,t){var n=l(e).get(e,t);void 0!==n&&(n.data=[])}function f(e,t){i.default.cornerstone.getEnabledElement(e).toolStateManager=t}},"./stateManagement/toolStyle.js":function(e,t,n){"use strict";n.r(t);var r=1,i=2;t.default={setToolWidth:function(e){r=e},getToolWidth:function(){return r},setActiveWidth:function(e){i=e},getActiveWidth:function(){return i}}},"./store/addTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"addTool",(function(){return l})),n.d(t,"addToolForElement",(function(){return s}));var r=n("./store/index.js"),i=n("./store/getToolForElement.js"),a=n("./util/logger.js"),o=Object(a.getLogger)("addTool"),s=function(e,t,n){var a=new t(n);Object(i.default)(e,a.name)?o.warn("%s has already been added to the target element",a.name):(a.element=e,r.default.state.tools.push(a))},l=function(e,t){u(e,t),r.default.state.enabledElements.forEach((function(n){s(n,e,t)}))},u=function(e,t){if(Object(r.getModule)("globalConfiguration").configuration.globalToolSyncEnabled){var n=new e(t);void 0!==r.default.state.globalTools[n.name]?o.warn("%s has already been added globally",n.name):r.default.state.globalTools[n.name]={tool:e,props:t,activeBindings:[]}}}},"./store/filterToolsUsableWithMultiPartTools.js":function(e,t,n){"use strict";n.r(t);var r=n("./tools/base/BaseAnnotationTool.js"),i=n("./tools/base/BaseBrushTool.js");t.default=function(e){return e.filter((function(e){return!(e.isMultiPartTool||e instanceof r.default||e instanceof i.default)}))}},"./store/getActiveToolsForElement.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){return t.filter((function(t){return t.element===e&&"active"===t.mode&&(void 0===n||t.options["is".concat(n,"Active")])}))}},"./store/getInteractiveToolsForElement.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){return t.filter((function(t){return t.element===e&&("active"===t.mode||"passive"===t.mode)}))}},"./store/getToolForElement.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js");t.default=function(e,t){return r.state.tools.find((function(n){return n.element===e&&n.name===t}))}},"./store/getToolsWithDataForElement.js":function(e,t,n){"use strict";n.r(t);var r=n("./stateManagement/toolState.js");t.default=function(e,t){return t.filter((function(t){var n=Object(r.getToolState)(e,t.name);return n&&n.data.length>0}))}},"./store/getToolsWithMoveableHandles.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./stateManagement/toolState.js"),a=n("./manipulators/getHandleNearImagePoint.js");t.default=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",s="mouse"===o?r.state.clickProximity:r.state.touchProximity;return t.filter((function(t){for(var r=Object(i.getToolState)(e,t.name),o=0;o<r.data.length;o++)if(void 0!==Object(a.default)(e,r.data[o].handles,n,s))return!0;return!1}))}},"./store/index.js":function(e,t,n){"use strict";n.r(t),n.d(t,"state",(function(){return u})),n.d(t,"getters",(function(){return c})),n.d(t,"modules",(function(){return d})),n.d(t,"getModule",(function(){return h}));var r=n("./store/modules/segmentationModule/index.js"),i=n("./store/modules/manipulatorStateModule.js"),a=n("./store/modules/cursorModule.js"),o=n("./store/modules/globalConfigurationModule.js"),s=n("./externalModules.js"),l=n("./util/logger.js"),u=(Object(l.getLogger)("store:modules:storeLogger"),{globalTools:{},globalToolChangeHistory:[],enabledElements:[],tools:[],isToolLocked:!1,activeMultiPartTool:null,mousePositionImage:{},clickProximity:6,touchProximity:10,handleRadius:6,deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1,svgCursorUrl:null}),c={mouseTools:function(){return u.tools.filter((function(e){return e.supportedInteractionTypes.includes("Mouse")}))},touchTools:function(){return u.tools.filter((function(e){return e.supportedInteractionTypes.includes("Touch")}))},enabledElementByUID:function(e){return u.enabledElements.find((function(t){return s.default.cornerstone.getEnabledElement(t).uuid===e}))}},d={segmentation:r.default,cursor:a.default,globalConfiguration:o.default,manipulatorState:i.default};function h(e){return d[e]}t.default={modules:d,state:u,getters:c}},"./store/internals/addEnabledElement.js":function(e,t,n){"use strict";n.r(t);var r=n("./eventListeners/index.js"),i=n("./eventDispatchers/index.js"),a=n("./store/addTool.js"),o=n("./store/setToolMode.js"),s=n("./store/index.js"),l=n("./util/logger.js"),u=Object(l.getLogger)("internals:addEnabledElement");t.default=function(e){u.log("EVENT:ELEMENT_ENABLED");var t=e.detail.element;i.imageRenderedEventDispatcher.enable(t),i.newImageEventDispatcher.enable(t);var n=Object(s.getModule)("globalConfiguration").configuration;n.mouseEnabled&&(r.mouseEventListeners.enable(t),r.wheelEventListener.enable(t),i.mouseToolEventDispatcher.enable(t)),n.touchEnabled&&(r.touchEventListeners.enable(t),i.touchToolEventDispatcher.enable(t)),c(t)};var c=function(e){s.default.state.enabledElements.push(e),s.default.modules&&function(e){var t=s.default.modules;Object.keys(t).forEach((function(n){"function"==typeof t[n].enabledElementCallback&&t[n].enabledElementCallback(e)}))}(e),function(e){Object(s.getModule)("globalConfiguration").configuration.globalToolSyncEnabled&&Object.keys(s.default.state.globalTools).forEach((function(t){var n=s.default.state.globalTools[t],r=n.tool,i=n.props;Object(a.addToolForElement)(e,r,i)}))}(e),function(e){if(Object(s.getModule)("globalConfiguration").configuration.globalToolSyncEnabled){var t={active:o.setToolActiveForElement,passive:o.setToolPassiveForElement,enabled:o.setToolEnabledForElement,disabled:o.setToolDisabledForElement};s.default.state.globalToolChangeHistory.forEach((function(n){var r=n.args.slice(0);r.unshift(e),t[n.mode].apply(null,r)}))}}(e)}},"./store/internals/removeEnabledElement.js":function(e,t,n){"use strict";n.r(t);var r=n("./eventListeners/index.js"),i=n("./eventDispatchers/index.js"),a=n("./store/index.js"),o=n("./util/logger.js"),s=n("./stateManagement/loadHandlerManager.js"),l=n("./store/setToolMode.js"),u=Object(o.getLogger)("internals:removeEnabledElement");t.default=function(e){u.log("EVENT:ELEMENT_DISABLED");var t=e.detail.element,n=Object(a.getModule)("globalConfiguration").configuration;i.imageRenderedEventDispatcher.disable(t),i.newImageEventDispatcher.disable(t),n.mouseEnabled&&(r.mouseEventListeners.disable(t),r.wheelEventListener.disable(t),i.mouseToolEventDispatcher.disable(t)),n.touchEnabled&&(r.touchEventListeners.disable(t),i.touchToolEventDispatcher.disable(t)),c(t),d(t),h(t)};var c=function(e){a.default.state.tools.forEach((function(t){t.element===e&&Object(l.setToolDisabledForElement)(t.element,t.name)})),a.default.state.tools=a.default.state.tools.filter((function(t){return t.element!==e}))},d=function(e){a.default.modules&&function(e){var t=a.default.modules;Object.keys(t).forEach((function(n){"function"==typeof t[n].removeEnabledElementCallback&&t[n].removeEnabledElementCallback(e)}))}(e);var t=a.default.state.enabledElements.findIndex((function(t){return t===e}));t>-1?a.default.state.enabledElements.splice(t,1):u.warn("unable to remove element")},h=function(e){s.default.removeHandlers(e)}},"./store/isToolActiveForElement.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/getToolForElement.js");t.default=function(e,t){return"active"===Object(r.default)(e,t).mode}},"./store/modules/cursorModule.js":function(e,t,n){"use strict";n.r(t),n("./externalModules.js");var r={iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:'\n    <path stroke="ACTIVE_COLOR" d="M8 16L8 0"></path>\n    <path stroke="ACTIVE_COLOR" d="M16 8L0 8"></path>\n  '};t.default={configuration:r,getters:{defaultOptions:function(){return r}},setters:{defaultOptions:function(e){Object.assign(r,e)}}}},"./store/modules/globalConfigurationModule.js":function(e,t,n){"use strict";n.r(t),t.default={configuration:{mouseEnabled:!0,touchEnabled:!0,globalToolSyncEnabled:!1,showSVGCursors:!1,autoResizeViewports:!0,lineDash:[4,4]}}},"./store/modules/manipulatorStateModule.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i={activeManipulators:{}};function a(e){var t=r.default.cornerstone.getEnabledElement(e);delete i.activeManipulators[t.uuid]}function o(e){var t=i.activeManipulators,n=t[e];"function"==typeof n&&n(),delete t[e]}function s(e){a(e.detail.element)}t.default={setters:{addActiveManipulatorForElement:function(e,t){var n=r.default.cornerstone.getEnabledElement(e);i.activeManipulators[n.uuid]=t},removeActiveManipulatorForElement:a,cancelActiveManipulatorsForElement:function(e){o(r.default.cornerstone.getEnabledElement(e).uuid)},cancelActiveManipulators:function(){Object.keys(i.activeManipulators).forEach((function(e){return o(e)}))}},state:i,enabledElementCallback:function(e){var t=r.default.cornerstone.EVENTS.NEW_IMAGE;e.removeEventListener(t,s),e.addEventListener(t,s)},removeEnabledElementCallback:function(e){e.removeEventListener(r.default.cornerstone.EVENTS.NEW_IMAGE,s),a(e)}}},"./store/modules/segmentationModule/activeLabelmapIndex.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getActiveLabelmapIndex",(function(){return l})),n.d(t,"setActiveLabelmapIndex",(function(){return u}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./stateManagement/toolState.js"),a=n("./store/modules/segmentationModule/addLabelmap3D.js"),o=n("./store/modules/segmentationModule/state.js"),s=n("./externalModules.js");function l(e){var t=Object(r.default)(e);if(t){var n=Object(i.getToolState)(t,"stack"),a=o.default.series[n.data[0].imageIds[0]];if(a)return a.activeLabelmapIndex}}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(r.default)(e);if(n){var l=s.default.cornerstone,u=Object(i.getToolState)(n,"stack"),c=u.data[0],d=l.getEnabledElement(n),h=d.image,f=h.rows,p=h.columns,m=c.imageIds.length,g=f*p*m,v=c.imageIds[0],y=o.default.series[v];y?(y.activeLabelmapIndex=t,y.labelmaps3D[t]||Object(a.default)(y,t,g)):(o.default.series[v]={activeLabelmapIndex:t,labelmaps3D:[]},y=o.default.series[v],Object(a.default)(y,t,g)),l.updateImage(n)}}},"./store/modules/segmentationModule/activeSegmentIndex.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getActiveSegmentIndex",(function(){return s})),n.d(t,"setActiveSegmentIndex",(function(){return l})),n.d(t,"incrementActiveSegmentIndex",(function(){return u})),n.d(t,"decrementActiveSegmentIndex",(function(){return c}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./stateManagement/toolState.js"),a=n("./store/modules/segmentationModule/state.js"),o=n("./store/index.js");function s(e,t){var n=Object(r.default)(e);if(n){var o=Object(i.getToolState)(n,"stack"),s=a.default.series[o.data[0].imageIds[0]];if(s){var l=s.labelmaps3D[t=void 0===t?s.activeLabelmapIndex:t];if(l)return l.activeSegmentIndex}return 1}}function l(e,t){var n=Object(r.default)(e);if(n){var s=Object(i.getToolState)(n,"stack"),l=a.default.series[s.data[0].imageIds[0]];if(l){var u=l.labelmaps3D[l.activeLabelmapIndex],c=Object(o.getModule)("segmentation").configuration;t<=0?t=1:t>c.segmentsPerLabelmap&&(t=c.segmentsPerLabelmap),u.activeSegmentIndex=t}}}function u(e){var t=Object(r.default)(e);t&&d(t,"increase")}function c(e){var t=Object(r.default)(e);t&&d(t,"decrease")}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"increase",n=Object(o.getModule)("segmentation"),r=n.configuration,s=Object(i.getToolState)(e,"stack"),l=s.data[0],u=l.imageIds[0],c=a.default.series[u];if(c){var d=c.activeLabelmapIndex,h=c.labelmaps3D[d];switch(t){case"increase":h.activeSegmentIndex++,h.activeSegmentIndex>r.segmentsPerLabelmap&&(h.activeSegmentIndex=1);break;case"decrease":h.activeSegmentIndex--,h.activeSegmentIndex<=0&&(h.activeSegmentIndex=r.segmentsPerLabelmap)}}}},"./store/modules/segmentationModule/addLabelmap2D.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));var r=n("./store/modules/segmentationModule/arrayTypes.js"),i=n("./store/index.js"),a=r.default.UINT_16_ARRAY,o=r.default.FLOAT_32_ARRAY;function s(e,t,n,r,s){var l,u=Object(i.getModule)("segmentation").configuration,c=r*s,d=c*n;switch(u.arrayType){case a:l=new Uint16Array(e.labelmaps3D[t].buffer,2*d,c);break;case o:l=new Float32Array(e.labelmaps3D[t].buffer,4*d,c);break;default:throw new Error("Unsupported Array Type ".concat(u.arrayType))}e.labelmaps3D[t].labelmaps2D[n]={pixelData:l,segmentsOnLabelmap:[]}}},"./store/modules/segmentationModule/addLabelmap3D.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));var r=n("./store/modules/segmentationModule/arrayTypes.js"),i=n("./store/index.js"),a=r.default.UINT_16_ARRAY,o=r.default.FLOAT_32_ARRAY;function s(e,t,n){var r,s=Object(i.getModule)("segmentation").configuration;switch(s.arrayType){case a:r=2;break;case o:r=4;break;default:throw new Error("Unsupported Array Type ".concat(s.arrayType))}e.labelmaps3D[t]={buffer:new ArrayBuffer(n*r),labelmaps2D:[],metadata:[],activeSegmentIndex:1,colorLUTIndex:0,segmentsHidden:[],undo:[],redo:[]}}},"./store/modules/segmentationModule/arrayTypes.js":function(e,t,n){"use strict";n.r(t),t.default={UINT_16_ARRAY:0,FLOAT_32_ARRAY:1}},"./store/modules/segmentationModule/colorLUT.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u})),n.d(t,"setColorLUTIndexForLabelmap3D",(function(){return c})),n.d(t,"getColorForSegmentIndexColorLUT",(function(){return d})),n.d(t,"setColorForSegmentIndexOfColorLUT",(function(){return h})),n.d(t,"getColorLUT",(function(){return f}));var r=n("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=n.n(r),a=n("./util/logger.js"),o=n("./store/modules/segmentationModule/state.js"),s=n("./store/index.js"),l=Object(a.getLogger)("store:modules:segmentationModule:setColorLUT");function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Object(s.getModule)("segmentation"),r=n.configuration,a=r.segmentsPerLabelmap;t?(p(t,a),t.length<a&&(t=[].concat(i()(t),i()(m(a-t.length))))):t=t||m(a),t.unshift([0,0,0,0]),o.default.colorLutTables[e]=t}function c(e,t){e.colorLUTIndex=t}function d(e,t){return f(e)[t]}function h(e,t,n){f(e)[t]=n}function f(e){return"number"==typeof e?o.default.colorLutTables[e]:o.default.colorLutTables[e.colorLUTIndex]}function p(e,t){e.length<t?l.warn("The provided colorLUT only provides ".concat(e.length," labels, whereas segmentsPerLabelmap is set to ").concat(t,". Autogenerating the rest.")):e.length>t&&l.warn("segmentsPerLabelmap is set to ".concat(t,", and the provided colorLUT provides ").concat(e.length,". Using the first ").concat(t," colors from the LUT."))}function m(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:255,t=[],n=0;n<e;n++)t.push(x(v(),b()));return t}var g=222.5;function v(){return(g+=137.5)>=360&&(g-=360),g}var y=.6;function b(){return(y+=.07)>.82&&(y=y-.82+.3),y}function x(e){var t,n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.6,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,s=(1-Math.abs(2*a-1))*i,l=s*(1-Math.abs(e/60%2-1)),u=a-s/2;return e<60?(t=s,n=l,r=0):e<120?(t=l,n=s,r=0):e<180?(t=0,n=s,r=l):e<240?(t=0,n=l,r=s):e<300?(t=l,n=0,r=s):e<360&&(t=s,n=0,r=l),[255*(t+u),255*(n+u),255*(r+u),o]}},"./store/modules/segmentationModule/defaultConfiguration.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/modules/segmentationModule/arrayTypes.js");t.default={renderOutline:!0,renderFill:!0,shouldRenderInactiveLabelmaps:!0,radius:10,minRadius:1,maxRadius:50,fillAlpha:.2,fillAlphaInactive:.1,outlineAlpha:.7,outlineAlphaInactive:.35,outlineWidth:3,storeHistory:!0,segmentsPerLabelmap:65535,arrayType:r.default.UINT_16_ARRAY}},"./store/modules/segmentationModule/deleteSegment.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./stateManagement/toolState.js"),a=n("./store/modules/segmentationModule/state.js"),o=n("./externalModules.js");function s(e,t,n){if(t){var s=Object(r.default)(e);if(s){var l=Object(i.getToolState)(s,"stack"),u=a.default.series[l.data[0].imageIds[0]];if(u){var c=u.labelmaps3D[n=void 0===n?u.activeLabelmapIndex:n];if(c){delete c.metadata[t];for(var d=c.labelmaps2D,h=0;h<d.length;h++){var f=d[h];if(f&&f.segmentsOnLabelmap.includes(t)){var p=f.pixelData,m=f.segmentsOnLabelmap.indexOf(t);f.segmentsOnLabelmap.splice(m,1);for(var g=0;g<p.length;g++)p[g]===t&&(p[g]=0)}}o.default.cornerstone.updateImage(s)}}}}}},"./store/modules/segmentationModule/getBrushColor.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l}));var r=n("./stateManagement/toolState.js"),i=n("./store/modules/segmentationModule/state.js"),a=n("./store/modules/segmentationModule/getElement.js"),o=n("./util/logger.js"),s=Object(o.getLogger)("store:modules:segmentationModule:getBrushColor");function l(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(a.default)(e);if(n){var o=Object(r.getToolState)(n,"stack");if(o){var l,u=o.data[0],c=u.imageIds[0],d=i.default.series[c];if(d){var h=d.activeLabelmapIndex,f=d.labelmaps3D[h],p=f.activeSegmentIndex;l=i.default.colorLutTables[f.colorLUTIndex][p]}else l=i.default.colorLutTables[0][1];return t?"rgba(".concat(l[0],", ").concat(l[1],", ").concat(l[2],", 1.0 )"):"rgba(".concat(l[0],", ").concat(l[1],", ").concat(l[2],", 0.8 )")}s.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}}},"./store/modules/segmentationModule/getElement.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./store/index.js");function i(e){return e instanceof HTMLElement?e:r.getters.enabledElementByUID(e)}},"./store/modules/segmentationModule/getLabelmap2D.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return g})),n.d(t,"getLabelmap2DByImageIdIndex",(function(){return v}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./stateManagement/toolState.js"),a=n("./store/modules/segmentationModule/getSegmentsOnPixeldata.js"),o=n("./store/modules/segmentationModule/addLabelmap3D.js"),s=n("./store/modules/segmentationModule/addLabelmap2D.js"),l=n("./externalModules.js"),u=n("./store/modules/segmentationModule/state.js"),c=n("./store/modules/segmentationModule/arrayTypes.js"),d=n("./store/index.js"),h=n("./util/logger.js"),f=c.default.UINT_16_ARRAY,p=c.default.FLOAT_32_ARRAY,m=Object(h.getLogger)("store:modules:segmentationModule:getLabelmap2D");function g(e){var t=Object(r.default)(e);if(t){var n=l.default.cornerstone,a=Object(i.getToolState)(t,"stack");if(a){var c,d=a.data[0],h=n.getEnabledElement(t),f=d.currentImageIdIndex,p=h.image,g=p.rows,v=p.columns,y=d.imageIds.length,b=d.imageIds[0],x=u.default.series[b];if(x){if(!x.labelmaps3D[c=x.activeLabelmapIndex]){var w=g*v*y;Object(o.default)(x,c,w)}x.labelmaps3D[c].labelmaps2D[f]||Object(s.default)(x,c,f,g,v)}else{u.default.series[b]={activeLabelmapIndex:c=0,labelmaps3D:[]},x=u.default.series[b];var _=g*v*y;Object(o.default)(x,c,_),Object(s.default)(x,c,f,g,v)}var S=x.labelmaps3D[c];return{labelmap2D:S.labelmaps2D[f],labelmap3D:S,currentImageIdIndex:f,activeLabelmapIndex:c}}m.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}}function v(e,t,n,r){if(!e.labelmaps2D[t]){var i,o=Object(d.getModule)("segmentation").configuration,s=n*r,l=s*t;switch(o.arrayType){case f:i=new Uint16Array(e.buffer,2*l,s);break;case p:i=new Float32Array(e.buffer,4*l,s);break;default:throw new Error("Unsupported Array Type ".concat(o.arrayType))}e.labelmaps2D[t]={pixelData:i,segmentsOnLabelmap:Object(a.default)(i)}}return e.labelmaps2D[t]}},"./store/modules/segmentationModule/getLabelmapBuffers.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getLabelmapBuffers",(function(){return d})),n.d(t,"getActiveLabelmapBuffer",(function(){return h}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./stateManagement/toolState.js"),a=n("./store/modules/segmentationModule/getLabelmaps3D.js"),o=n("./store/modules/segmentationModule/state.js"),s=n("./store/modules/segmentationModule/arrayTypes.js"),l=n("./store/index.js"),u=s.default.UINT_16_ARRAY,c=s.default.FLOAT_32_ARRAY;function d(e,t){var n=Object(r.default)(e);if(n){var i=Object(a.default)(n).labelmaps3D;if(!i)return[];var s,d,h=Object(l.getModule)("segmentation").configuration;switch(h.arrayType){case u:s="Uint16Array",d="2";break;case c:s="Float32Array",d="4";break;default:throw new Error("Unsupported Array Type ".concat(h.arrayType))}var f=o.default.colorLutTables;if(void 0!==t){var p=i[t];return p?{labelmapIndex:t,bytesPerVoxel:d,type:s,buffer:p.buffer,colorLUT:f[p.colorLUTIndex]}:void 0}for(var m=[],g=0;g<i.length;g++){var v=i[g];v&&m.push({labelmapIndex:g,bytesPerVoxel:2,buffer:v.buffer,colorLUT:f[v.colorLUTIndex]})}return m}}function h(e){var t=Object(r.default)(e);if(t){var n=Object(i.getToolState)(t,"stack"),a=o.default.series[n.data[0].imageIds[0]];if(a)return d(t,a.activeLabelmapIndex)}}},"./store/modules/segmentationModule/getLabelmapStats.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u})),n.d(t,"_calculateLabelmapStats",(function(){return c}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./stateManagement/toolState.js"),a=n("./store/modules/segmentationModule/state.js"),o=n("./externalModules.js"),s=n("./util/logger.js"),l=Object(s.getLogger)("store:modules:segmentationModule:getLabelmapStats");function u(e,t,n){var s=o.default.cornerstone,u=Object(r.default)(e);if(!u)return null;var d=Object(i.getToolState)(u,"stack").data[0].imageIds,h=d[0];return new Promise((function(e){var r=a.default.series[h];r||e(null);var i=function(e){for(var t=[],n=o.default.cornerstone.metaData,r=!0,i=0;i<e.length;i++){var a=n.get("imagePlaneModule",e[i]);if(!a){r=!1;break}t.push(a)}return{sufficientMetadata:r,imagePlanes:t}}(d),u=i.imagePlanes;i.sufficientMetadata||(l.warn("Insufficient imagePlaneModule information to calculate volume statistics."),e(null));for(var f=r.labelmaps3D[n=void 0===n?r.activeLabelmapIndex:n],p=[],m=0;m<d.length;m++)p.push(s.loadAndCacheImage(d[m]));Promise.all(p).then((function(n){var r=c(f,n,u,t);e(r)}))}))}function c(e,t,n,r){for(var i=function(e,t,n,r){for(var i=t[0],a=i.rowPixelSpacing,o=i.columnPixelSpacing,s=e.labelmaps2D,l=[],u=0;u<s.length;u++){var c=s[u];if(c&&c.segmentsOnLabelmap.includes(r)){for(var h=d(t,n,u)*a*o,f=c.pixelData,p=t[u].getPixelData(),m=[],g=0;g<f.length;g++)f[g]===r&&m.push(p[g]);l.push({voxelInMM3:h,values:m})}}return l}(e,t,n,r),a=0,o=i[0].values[0],s=o,l=0,u=0;u<i.length;u++){var c=i[u];l+=(v=c.voxelInMM3)*(m=c.values).length;var h=0;m.forEach((function(e){e>o?o=e:e<s&&(s=e),h+=e})),a+=h*v}a/=l;for(var f=0,p=0;p<i.length;p++){var m,g=i[p],v=g.voxelInMM3,y=0;(m=g.values).forEach((function(e){y+=Math.pow(e-a,2)})),f+=y*v}return f/=l,f=Math.sqrt(f),{volume:l,mean:a,stdDev:f,max:o,min:s}}function d(e,t,n){var r=e.length,i=t[n].imagePositionPatient;if(0===n)return h(i,t[n+1].imagePositionPatient);if(n===r-1)return h(i,t[n-1].imagePositionPatient);var a=t[n+1].imagePositionPatient;return(h(i,t[n-1].imagePositionPatient)+h(i,a))/2}function h(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}},"./store/modules/segmentationModule/getLabelmaps3D.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l})),n.d(t,"getLabelmap3D",(function(){return u}));var r=n("./stateManagement/toolState.js"),i=n("./store/modules/segmentationModule/getElement.js"),a=n("./store/modules/segmentationModule/state.js"),o=n("./util/logger.js"),s=Object(o.getLogger)("store:modules:segmentationModule:getLabelmaps3D");function l(e){var t=Object(i.default)(e);if(t){var n=Object(r.getToolState)(t,"stack");if(n){var o,l,u=n.data[0],c=a.default.series[u.imageIds[0]];return c&&(o=c.labelmaps3D,l=c.activeLabelmapIndex),{labelmaps3D:o,activeLabelmapIndex:l,currentImageIdIndex:u.currentImageIdIndex}}s.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}}function u(e,t){var n=l(e);return n.labelmaps3D[t=void 0!==t?t:n.activeLabelmapIndex]}},"./store/modules/segmentationModule/getSegmentOfActiveLabelmapAtEvent.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l}));var r=n("./stateManagement/toolState.js"),i=n("./store/modules/segmentationModule/state.js"),a=n("./util/isPointInImage.js"),o=n("./util/logger.js"),s=Object(o.getLogger)("store:modules:segmentationModule:getSegmentOfActiveLabelmapAtEvent");function l(e){var t=e.detail,n=t.element,o=t.image,l=t.currentPoints;if(l){var u=o.width,c=o.height;if(n){var d=Object(r.getToolState)(n,"stack").data[0],h=i.default.series[d.imageIds[0]],f=h.labelmaps3D[h.activeLabelmapIndex];if(f){var p=f.labelmaps2D[d.currentImageIdIndex];if(p){var m=p.pixelData,g=l.image,v=g.x,y=g.y;if(v=Math.floor(v),y=Math.floor(y),Object(a.default)({x:v,y:y},c,u)){var b=m[y*u+v];if(0===b)return;return{segmentIndex:b,metadata:f.metadata[b]}}}}}}else s.warn("Not a cornerstone input event.")}},"./store/modules/segmentationModule/getSegmentsOnPixeldata.js":function(e,t,n){"use strict";function r(e){for(var t=new Set(e).values(),n=[],r=!1;!r;){var i=t.next();(r=i.done)||n.push(i.value)}return n}n.r(t),n.d(t,"default",(function(){return r}))},"./store/modules/segmentationModule/history.js":function(e,t,n){"use strict";n.r(t),n.d(t,"pushState",(function(){return s})),n.d(t,"undo",(function(){return l})),n.d(t,"redo",(function(){return u}));var r=n("./store/modules/segmentationModule/getLabelmaps3D.js"),i=n("./util/logger.js"),a=n("./externalModules.js"),o=Object(i.getLogger)("util:segmentation:labelmap3DHistory");function s(e,t,n){var i=Object(r.getLabelmap3D)(e,n);i.undo.push(t),i.redo=[]}function l(e,t){var n=Object(r.getLabelmap3D)(e,t),i=n.undo,s=n.redo;if(i.length){var l=i.pop();c(n,l,1),s.push(l),a.default.cornerstone.updateImage(e)}else o.warn("No undos left.")}function u(e,t){var n=Object(r.getLabelmap3D)(e,t),i=n.undo,s=n.redo;if(s.length){var l=s.pop();c(n,l,2),i.push(l),a.default.cornerstone.updateImage(e)}else o.warn("No redos left.")}function c(e,t,n){var r=e.labelmaps2D;t.forEach((function(e){for(var t=e.diff,i=r[e.imageIdIndex].pixelData,a=0;a<t.length;a++){var o=t[a];i[o[0]]=o[n]}}))}},"./store/modules/segmentationModule/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/modules/segmentationModule/metadata.js"),i=n("./store/modules/segmentationModule/activeLabelmapIndex.js"),a=n("./store/modules/segmentationModule/activeSegmentIndex.js"),o=n("./store/modules/segmentationModule/segmentVisibility.js"),s=n("./store/modules/segmentationModule/getLabelmapBuffers.js"),l=n("./store/modules/segmentationModule/setLabelmap3D.js"),u=n("./store/modules/segmentationModule/getLabelmapStats.js"),c=n("./store/modules/segmentationModule/getLabelmaps3D.js"),d=n("./store/modules/segmentationModule/getLabelmap2D.js"),h=n("./store/modules/segmentationModule/getSegmentOfActiveLabelmapAtEvent.js"),f=n("./store/modules/segmentationModule/colorLUT.js"),p=n("./store/modules/segmentationModule/getBrushColor.js"),m=n("./store/modules/segmentationModule/getSegmentsOnPixeldata.js"),g=n("./store/modules/segmentationModule/deleteSegment.js"),v=n("./store/modules/segmentationModule/state.js"),y=n("./store/modules/segmentationModule/defaultConfiguration.js"),b=n("./store/modules/segmentationModule/history.js"),x=n("./store/modules/segmentationModule/setRadius.js");t.default={state:v.default,configuration:y.default,onRegisterCallback:function(){Object(f.default)(0)},getters:{metadata:r.getMetadata,labelmap3D:c.getLabelmap3D,labelmaps3D:c.default,activeLabelmapIndex:i.getActiveLabelmapIndex,activeSegmentIndex:a.getActiveSegmentIndex,isSegmentVisible:o.isSegmentVisible,labelmap2D:d.default,labelmap2DByImageIdIndex:d.getLabelmap2DByImageIdIndex,labelmapStats:u.default,segmentOfActiveLabelmapAtEvent:h.default,brushColor:p.default,labelmapBuffers:s.getLabelmapBuffers,activeLabelmapBuffer:s.getActiveLabelmapBuffer,colorLUT:f.getColorLUT,colorForSegmentIndexColorLUT:f.getColorForSegmentIndexColorLUT},setters:{metadata:r.setMetadata,labelmap3DForElement:l.setLabelmap3DForElement,labelmap3DByFirstImageId:l.setLabelmap3DByFirstImageId,incrementActiveSegmentIndex:a.incrementActiveSegmentIndex,decrementActiveSegmentIndex:a.decrementActiveSegmentIndex,activeSegmentIndex:a.setActiveSegmentIndex,toggleSegmentVisibility:o.toggleSegmentVisibility,updateSegmentsOnLabelmap2D:function(e){e.segmentsOnLabelmap=Object(m.default)(e.pixelData)},deleteSegment:g.default,colorLUT:f.default,colorLUTIndexForLabelmap3D:f.setColorLUTIndexForLabelmap3D,colorForSegmentIndexOfColorLUT:f.setColorForSegmentIndexOfColorLUT,activeLabelmapIndex:i.setActiveLabelmapIndex,radius:x.default,pushState:b.pushState,undo:b.undo,redo:b.redo}}},"./store/modules/segmentationModule/metadata.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getMetadata",(function(){return c})),n.d(t,"setMetadata",(function(){return d}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./store/modules/segmentationModule/addLabelmap3D.js"),a=n("./stateManagement/toolState.js"),o=n("./externalModules.js"),s=n("./util/logger.js"),l=n("./store/modules/segmentationModule/state.js"),u=Object(s.getLogger)("store:modules:segmentationModule:metadata");function c(e,t,n){var i=Object(r.default)(e);if(i){var o=Object(a.getToolState)(i,"stack"),s=l.default.series[o.data[0].imageIds[0]];if(s){if(s.labelmaps3D[t=void 0===t?s.activeLabelmapIndex:t]){var c=s.labelmaps3D[t];return void 0===n?c.metadata:c.metadata[n]}u.warn("No labelmap3D of labelmap index ".concat(t," on stack."))}else u.warn("brushStackState is undefined")}}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,u=Object(r.default)(e);if(u){var c=o.default.cornerstone,d=Object(a.getToolState)(u,"stack"),h=d.data[0],f=h.imageIds[0],p=l.default.series[f];if(p||(l.default.series[f]={labelmapIndex:t,labelmaps3D:[]},p=l.default.series[f]),!p.labelmaps3D[t]){var m=c.getEnabledElement(u),g=m.image,v=g.rows,y=g.columns,b=h.imageIds.length,x=v*y*b;Object(i.default)(p,t,x)}var w=p.labelmaps3D[t];w.metadata[n]=s}}},"./store/modules/segmentationModule/segmentVisibility.js":function(e,t,n){"use strict";n.r(t),n.d(t,"isSegmentVisible",(function(){return l})),n.d(t,"toggleSegmentVisibility",(function(){return u}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./stateManagement/toolState.js"),a=n("./store/modules/segmentationModule/state.js"),o=n("./util/logger.js"),s=Object(o.getLogger)("store:modules:segmentationModule:segmentVisibility");function l(e,t,n){if(t){var o=Object(r.default)(e);if(o){var l=Object(i.getToolState)(o,"stack"),u=a.default.series[l.data[0].imageIds[0]];if(u){if(u.labelmaps3D[n=void 0===n?u.activeLabelmapIndex:n])return!u.labelmaps3D[n].segmentsHidden[t];s.warn("No labelmap3D of labelmap index ".concat(n," on stack."))}else s.warn("brushStackState is undefined")}}}function u(e,t,n){if(t){var o=Object(r.default)(e);if(o){var l=Object(i.getToolState)(o,"stack"),u=a.default.series[l.data[0].imageIds[0]];if(u){if(u.labelmaps3D[n=void 0===n?u.activeLabelmapIndex:n]){var c=u.labelmaps3D[n].segmentsHidden;return c[t]=!c[t],!c[t]}s.warn("No labelmap3D of labelmap index ".concat(n," on stack."))}else s.warn("brushStackState is undefined")}}}},"./store/modules/segmentationModule/setLabelmap3D.js":function(e,t,n){"use strict";n.r(t),n.d(t,"setLabelmap3DByFirstImageId",(function(){return f})),n.d(t,"setLabelmap3DForElement",(function(){return h}));var r=n("./store/modules/segmentationModule/getElement.js"),i=n("./stateManagement/toolState.js"),a=n("./store/modules/segmentationModule/state.js"),o=n("./store/modules/segmentationModule/getSegmentsOnPixeldata.js"),s=n("./util/segmentation/index.js"),l=n("./store/modules/segmentationModule/arrayTypes.js"),u=n("./store/index.js"),c=l.default.UINT_16_ARRAY,d=l.default.FLOAT_32_ARRAY;function h(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=Object(r.default)(e);if(u){var c=Object(i.getToolState)(u,"stack"),d=c.data[0].imageIds.length,h=c.data[0].imageIds[0];f(h,t,n,a,d,o,l),Object(s.triggerLabelmapModifiedEvent)(u,n)}}function f(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,h=Object(u.getModule)("segmentation"),f=h.configuration,p=a.default.series[e];p||(a.default.series[e]={activeLabelmapIndex:n,labelmaps3D:[]},p=a.default.series[e]),p.labelmaps3D[n]={buffer:t,labelmaps2D:[],metadata:r,activeSegmentIndex:1,colorLUTIndex:l,segmentsHidden:[],undo:[],redo:[]};for(var m=p.labelmaps3D[n].labelmaps2D,g=t.byteLength/i,v=0;v<i;v++){var y=void 0;switch(f.arrayType){case c:y=new Uint16Array(t,g*v,g/2);break;case d:y=new Float32Array(t,g*v,g/4);break;default:throw new Error("Unsupported Array Type ".concat(f.arrayType))}var b=s?s[v]:Object(o.default)(y);b&&b.some((function(e){return e}))&&(m[v]={pixelData:y,segmentsOnLabelmap:b})}}},"./store/modules/segmentationModule/setRadius.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./store/index.js");function i(e){var t=Object(r.getModule)("segmentation").configuration;t.radius=Math.min(Math.max(e,t.minRadius),t.maxRadius)}},"./store/modules/segmentationModule/state.js":function(e,t,n){"use strict";n.r(t),t.default={series:{},colorLutTables:[]}},"./store/removeTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"removeTool",(function(){return a})),n.d(t,"removeToolForElement",(function(){return i}));var r=n("./store/index.js"),i=function(e,t){var n=r.default.state.tools.findIndex((function(n){return n.element===e&&n.name===t}));n>=0&&r.default.state.tools.splice(n,1)},a=function(e){o(e),r.default.state.enabledElements.forEach((function(t){i(t,e)}))},o=function(e){Object(r.getModule)("globalConfiguration").configuration.globalToolSyncEnabled&&r.default.state.globalTools[e]&&delete r.default.state.globalTools[e]}},"./store/setToolCursor.js":function(e,t,n){"use strict";n.r(t),n.d(t,"setToolCursor",(function(){return a})),n.d(t,"resetToolCursor",(function(){return o})),n.d(t,"hideToolCursor",(function(){return s}));var r=n("./store/index.js"),i=r.modules.globalConfiguration;function a(e,t){if(i.configuration.showSVGCursors){var n=t.getIconWithPointerSVG(),a=t.mousePoint,o=window.URL.createObjectURL(n);e.style.cursor="url('".concat(o,"') ").concat(a,", auto"),r.state.svgCursorUrl=o}}function o(e){l(e,"initial")}function s(e){i.configuration.showSVGCursors&&l(e,"none")}function l(e,t){r.state.svgCursorUrl&&window.URL.revokeObjectURL(r.state.svgCursorUrl),r.state.svgCursorUrl=null,e.style.cursor=t}},"./store/setToolMode.js":function(e,t,n){"use strict";n.r(t),n.d(t,"setToolActive",(function(){return h})),n.d(t,"setToolActiveForElement",(function(){return d})),n.d(t,"setToolDisabled",(function(){return p})),n.d(t,"setToolDisabledForElement",(function(){return f})),n.d(t,"setToolEnabled",(function(){return g})),n.d(t,"setToolEnabledForElement",(function(){return m})),n.d(t,"setToolPassive",(function(){return y})),n.d(t,"setToolPassiveForElement",(function(){return v})),n.d(t,"setToolMode",(function(){return x})),n.d(t,"setToolModeForElement",(function(){return b})),n.d(t,"_getNormalizedOptions",(function(){return E})),n.d(t,"_mergeMouseButtonMask",(function(){return T}));var r=n("./events.js"),i=n("./util/triggerEvent.js"),a=n("./store/getToolForElement.js"),o=n("./store/setToolCursor.js"),s=n("./util/logger.js"),l=n("./store/index.js"),u=Object(l.getModule)("globalConfiguration"),c=Object(s.getLogger)("store:setToolMode"),d=function(e,t,n,r){void 0===r&&Array.isArray(n)&&(r=n,n=null);var i=Object(a.default)(e,t);i&&(function(e,t,n,r){t.supportedInteractionTypes.forEach((function(i){if(void 0===r||r.includes(i)){var a=S[i];a?a(t,e,n):c.warn("Unable to resolve input conflicts for type %s",i)}})),l.default.state.tools.filter((function(t){return t.element===e&&"active"===t.mode&&t.supportedInteractionTypes.length>0})).forEach((function(t){var n=!1;t.supportedInteractionTypes.forEach((function(e){t.options["is".concat(e,"Active")]&&(n=!0)})),n||(c.log("Setting tool %s's to PASSIVE",t.name),v(e,t.name))}))}(e,i,n,r),i.supportedInteractionTypes.forEach((function(e){void 0===r||r.includes(e)?n["is".concat(e,"Active")]=!0:n["is".concat(e,"Active")]=!1})),u.configuration.showSVGCursors&&i.supportedInteractionTypes.includes("Mouse")&&function(e,t,n){("number"==typeof t?[t]:t.mouseButtonMask).includes(1)&&(n.svgCursor?Object(o.setToolCursor)(n.element,n.svgCursor):n.hideDefaultCursor?Object(o.hideToolCursor)(e):Object(o.resetToolCursor)(e))}(e,n,i)),b("active",null,e,t,n)},h=function(e,t,n){_("active",e,t,n),l.default.state.enabledElements.forEach((function(r){d(r,e,t,n)}))},f=b.bind(null,"disabled",null),p=x.bind(null,"disabled",null),m=b.bind(null,"enabled",null),g=x.bind(null,"enabled",null),v=b.bind(null,"passive",r.default.TOOL_DEACTIVATED),y=x.bind(null,"passive",r.default.TOOL_DEACTIVATED);function b(e,t,n,r,o){var s=Object(a.default)(n,r);if(s){if(o=E(o),Array.isArray(o.mouseButtonMask)&&0!==o.mouseButtonMask.length&&Array.isArray(s.options.mouseButtonMask)&&(o.mouseButtonMask=T(o.mouseButtonMask,s.options.mouseButtonMask)),s.mode=e,s.mergeOptions(o),s["".concat(e,"Callback")]&&s["".concat(e,"Callback")](n,o),t){var l={options:o,toolName:r,toolType:r,type:t};Object(i.default)(n,t,l)}}else c.warn('Unable to find tool "%s" for enabledElement',r)}function x(e,t,n,r){_(e,n,r),l.default.state.enabledElements.forEach((function(i){b(e,t,i,n,r)}))}function w(e,t,n){var r="is".concat(e,"Active"),i=l.default.state.tools.find((function(e){return e.element===n&&"active"===e.mode&&!0===e.options[r]}));i&&(c.log("Setting tool %s's %s to false",i.name,r),i.options[r]=!1)}function _(e,t,n,r){if(u.configuration.globalToolSyncEnabled){var i={mode:e,args:[t,n]};r&&i.push(r),l.default.state.globalToolChangeHistory.push(i),l.default.state.globalToolChangeHistory.length>50&&l.default.state.globalToolChangeHistory.shift();var a=l.default.state.globalTools[t];if(a)if("active"===e){var o=function(e,t,n){void 0===n&&Array.isArray(t)&&(n=t,t=null);var r=[],i=l.default.state.globalTools[e];if(i){var a=new i.tool(i.props);a.supportedInteractionTypes.forEach((function(e){if(void 0===n||n.includes(e))if("Mouse"===e){var i=E(t).mouseButtonMask;Array.isArray(i)&&i.length>0?i.forEach((function(t){return r.push("".concat(e,"-").concat(t))})):Array.isArray(i)&&0===i.length&&r.push("".concat(e,"-DELETE"))}else r.push("MultiTouch"===e?"".concat(e,"-").concat(a.configuration.touchPointers):e)}))}return r}(t,n,r);Object.keys(l.default.state.globalTools).forEach((function(e){var t=l.default.state.globalTools[e];t.activeBindings=t.activeBindings.filter((function(e){return!o.includes(e)}))})),o.some((function(e){return e.includes("Mouse-DELETE")}))&&(a.activeBindings=a.activeBindings.filter((function(e){return!e.includes("Mouse")})),o=o.filter((function(e){return!e.includes("Mouse")}))),a.activeBindings=a.activeBindings.concat(o)}else a.activeBindings=[];else c.warn("setToolMode call for tool not available globally: ".concat(t))}}var S={Mouse:function(e,t,n){var r=E(n).mouseButtonMask;if(Array.isArray(r)&&r.length>0){var i=l.default.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMouseActive&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.some((function(e){return r.includes(e)}))}));i&&(i.options.mouseButtonMask=i.options.mouseButtonMask.filter((function(e){return!r.includes(e)})),0===i.options.mouseButtonMask.length&&(i.options.isMouseActive=!1))}},MouseWheel:w.bind(void 0,"MouseWheel"),Touch:function(e,t){var n=l.default.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive})),r=l.default.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMultiTouchActive&&1===e.configuration.touchPointers}));n&&(c.log("Setting tool %s's isTouchActive to false",n.name),n.options.isTouchActive=!1),r&&(c.log("Setting tool %s's isTouchActive to false",r.name),r.options.isMultiTouchActive=!1)},TouchPinch:w.bind(void 0,"TouchPinch"),TouchRotate:w.bind(void 0,"TouchRotate"),DoubleTap:w.bind(void 0,"DoubleTap"),MultiTouch:function(e,t){var n,r=l.default.state.tools.find((function(n){return n.element===t&&"active"===n.mode&&!0===n.options.isMultiTouchActive&&n.configuration.touchPointers===e.configuration.touchPointers}));1===e.configuration.touchPointers&&(n=l.default.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive}))),r&&(c.log("Setting tool %s's isMultiTouchActive to false",r.name),r.options.isMultiTouchActive=!1),n&&(c.log("Setting tool %s's isTouchActive to false",n.name),n.options.isTouchActive=!1)}};function E(e){return Array.isArray(e)?e={mouseButtonMask:e}:e!==Object(e)&&(e={mouseButtonMask:[e]}),e.hasOwnProperty("mouseButtonMask")||(e.mouseButtonMask=[]),Array.isArray(e.mouseButtonMask)||(e.mouseButtonMask=[e.mouseButtonMask]),e.mouseButtonMask=e.mouseButtonMask.filter((function(e){return"number"==typeof e&&0!==e})),e}function T(e,t){return e.concat(t).reduce((function(e,t){return-1===e.indexOf(t)&&e.push(t),e}),[])}},"./store/setToolOptions.js":function(e,t,n){"use strict";n.r(t),n.d(t,"setToolOptions",(function(){return o})),n.d(t,"setToolOptionsForElement",(function(){return a}));var r=n("./store/getToolForElement.js"),i=n("./store/index.js"),a=function(e,t,n){var i=Object(r.default)(e,t);i&&i.mergeOptions(n)},o=function(e,t){i.state.enabledElements.forEach((function(n){a(n,e,t)}))}},"./synchronization/Synchronizer.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./util/convertToVector3.js"),a=n("./toolOptions.js");function o(e){return e.filter((function(e,t,n){return n.indexOf(e)===t}))}t.default=function(e,t){var n=r.default.cornerstone,s=this,l=[],u=[],c=!1,d={},h=t;function f(e){var t=e.detail.element;s.remove(t),Object(a.clearToolOptionsByElement)(t)}this.enabled=!0,this.setHandler=function(e){h=e},this.getHandler=function(){return h},this.getDistances=function(){l.length&&u.length&&(d.distances={},d.imageIds={sourceElements:[],targetElements:[]},l.forEach((function(e){var t=n.getEnabledElement(e);if(t&&t.image){var r=t.image.imageId,a=n.metaData.get("imagePlaneModule",r);if(a&&a.imagePositionPatient){var o=Object(i.default)(a.imagePositionPatient);d.hasOwnProperty(t)||(d.distances[r]={},d.imageIds.sourceElements.push(r),u.forEach((function(t){var a=n.getEnabledElement(t);if(a&&a.image){var s=a.image.imageId;if(d.imageIds.targetElements.push(s),e!==t&&r!==s&&!d.distances[r].hasOwnProperty(s)){var l=n.metaData.get("imagePlaneModule",s);if(l&&l.imagePositionPatient){var u=Object(i.default)(l.imagePositionPatient);d.distances[r][s]=u.clone().sub(o)}}}})),Object.keys(d.distances[r]).length||delete d.distances[r])}}})))},this.fireEvent=function(e,t){!s.enabled||!l.length||!u.length||(c=!0,u.forEach((function(n){var r=u.indexOf(n);if(-1!==r){var i=d.imageIds.targetElements[r],a=l.indexOf(e);if(-1!==a){var o,c=d.imageIds.sourceElements[a];c===i?o=0:void 0!==d.distances[c]&&(o=d.distances[c][i]),h(s,e,n,t,o)}}})),c=!1)},this.onEvent=function(e){!0!==c&&s.fireEvent(e.currentTarget,e.detail)},this.addSource=function(t){-1===l.indexOf(t)&&(l.push(t),e.split(" ").forEach((function(e){t.addEventListener(e,s.onEvent)})),s.getDistances(),s.updateDisableHandlers())},this.addTarget=function(e){-1===u.indexOf(e)&&(u.push(e),s.getDistances(),h(s,e,e,0),s.updateDisableHandlers())},this.add=function(e){s.addSource(e),s.addTarget(e)},this.removeSource=function(t){var n=l.indexOf(t);-1!==n&&(l.splice(n,1),e.split(" ").forEach((function(e){t.removeEventListener(e,s.onEvent)})),s.getDistances(),s.fireEvent(t),s.updateDisableHandlers())},this.removeTarget=function(e){var t=u.indexOf(e);-1!==t&&(u.splice(t,1),s.getDistances(),h(s,e,e,0),s.updateDisableHandlers())},this.remove=function(e){s.removeTarget(e),s.removeSource(e)},this.getSourceElements=function(){return l},this.getTargetElements=function(){return u},this.displayImage=function(e,t,r){c=!0,n.displayImage(e,t,r),c=!1},this.setViewport=function(e,t){c=!0,n.setViewport(e,t),c=!1},this.updateDisableHandlers=function(){o(l.concat(u)).forEach((function(e){e.removeEventListener(r.default.cornerstone.EVENTS.ELEMENT_DISABLED,f),e.addEventListener(r.default.cornerstone.EVENTS.ELEMENT_DISABLED,f)}))},this.destroy=function(){o(l.concat(u)).forEach((function(e){s.remove(e)}))}}},"./synchronization/panZoomSynchronizer.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t,n){if(n!==t){var i=r.default.cornerstone,a=i.getViewport(t),o=i.getViewport(n);o.scale===a.scale&&o.translation.x===a.translation.x&&o.translation.y===a.translation.y||(o.scale=a.scale,o.translation.x=a.translation.x,o.translation.y=a.translation.y,e.setViewport(n,o))}}},"./synchronization/stackImageIndexSynchronizer.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./stateManagement/toolState.js"),a=n("./stateManagement/loadHandlerManager.js"),o=n("./util/clip.js");t.default=function(e,t,n){if(n!==t){var s=r.default.cornerstone,l=Object(i.getToolState)(t,"stack").data[0],u=Object(i.getToolState)(n,"stack").data[0],c=l.currentImageIdIndex;if((c=Object(o.default)(c,0,u.imageIds.length-1))!==u.currentImageIdIndex){var d=a.default.getStartLoadHandler(n),h=a.default.getEndLoadHandler(n),f=a.default.getErrorLoadingHandler(n);d&&d(n),(!0===u.preventCache?s.loadImage(u.imageIds[c]):s.loadAndCacheImage(u.imageIds[c])).then((function(t){var r=s.getViewport(n);u.currentImageIdIndex=c,e.displayImage(n,t,r),h&&h(n,t)}),(function(e){f&&f(n,u.imageIds[c],e)}))}}}},"./synchronization/stackImagePositionOffsetSynchronizer.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./stateManagement/toolState.js"),a=n("./stateManagement/loadHandlerManager.js"),o=n("./util/convertToVector3.js");t.default=function(e,t,n,s,l){if(n!==t){var u=r.default.cornerstone,c=Object(i.getToolState)(t,"stack").data[0],d=u.metaData.get("imagePlaneModule",c.imageIds[c.currentImageIdIndex]);if(void 0!==d&&void 0!==d.imagePositionPatient){var h=Object(o.default)(d.imagePositionPatient),f=Object(i.getToolState)(n,"stack").data[0],p=Number.MAX_VALUE,m=-1;if(l){var g=h.clone().add(l);if(f.imageIds.forEach((function(e,t){var n=u.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var r=Object(o.default)(n.imagePositionPatient),i=g.distanceToSquared(r);i<p&&(p=i,m=t)}})),m!==f.currentImageIdIndex&&-1!==m){var v=a.default.getStartLoadHandler(n),y=a.default.getEndLoadHandler(n),b=a.default.getErrorLoadingHandler(n);f.currentImageIdIndex=m;var x=f.imageIds[m];v&&v(n),(!0===f.preventCache?u.loadImage(x):u.loadAndCacheImage(x)).then((function(t){var r=u.getViewport(n);f.currentImageIdIndex===m&&(e.displayImage(n,t,r),y&&y(n,t))}),(function(e){b&&b(n,f.imageIds[m],e)}))}}}}}},"./synchronization/stackImagePositionSynchronizer.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./stateManagement/toolState.js"),a=n("./stateManagement/loadHandlerManager.js"),o=n("./util/convertToVector3.js");t.default=function(e,t,n){if(n!==t){var s=r.default.cornerstone,l=Object(i.getToolState)(t,"stack").data[0],u=s.metaData.get("imagePlaneModule",l.imageIds[l.currentImageIdIndex]);if(void 0!==u&&void 0!==u.imagePositionPatient){var c=Object(o.default)(u.imagePositionPatient),d=Object(i.getToolState)(n,"stack").data[0],h=Number.MAX_VALUE,f=-1;if(d.imageIds.forEach((function(e,t){var n=s.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var r=Object(o.default)(n.imagePositionPatient).distanceToSquared(c);r<h&&(h=r,f=t)}})),f!==d.currentImageIdIndex){var p=a.default.getStartLoadHandler(n),m=a.default.getEndLoadHandler(n),g=a.default.getErrorLoadingHandler(n);d.currentImageIdIndex=f;var v=d.imageIds[f];p&&p(n),-1!==f&&(!0===d.preventCache?s.loadImage(v):s.loadAndCacheImage(v)).then((function(t){var r=s.getViewport(n);d.currentImageIdIndex===f&&(e.displayImage(n,t,r),m&&m(n,t))}),(function(e){g&&g(n,d.imageIds[f],e)}))}}}}},"./synchronization/stackScrollSynchronizer.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./stateManagement/toolState.js"),a=n("./stateManagement/loadHandlerManager.js"),o=n("./util/clip.js");t.default=function(e,t,n,s){if(t!==n&&s&&s.direction){var l=r.default.cornerstone,u=Object(i.getToolState)(n,"stack").data[0],c=u.currentImageIdIndex+s.direction;if(c=Object(o.default)(c,0,u.imageIds.length-1),u.currentImageIdIndex!==c){var d=a.default.getStartLoadHandler(n),h=a.default.getEndLoadHandler(n),f=a.default.getErrorLoadingHandler(n);u.currentImageIdIndex=c;var p=u.imageIds[c];d&&d(n),(!0===u.preventCache?l.loadImage(p):l.loadAndCacheImage(p)).then((function(t){var r=l.getViewport(n);u.currentImageIdIndex===c&&(e.displayImage(n,t,r),h&&h(n,t))}),(function(e){f&&f(n,u.imageIds[c],e)}))}}}},"./synchronization/updateImageSynchronizer.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t,n){n!==t&&r.default.cornerstone.updateImage(n)}},"./synchronization/wwwcSynchronizer.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t,n){if(n!==t){var i=r.default.cornerstone,a=i.getViewport(t),o=i.getViewport(n);o.voi.windowWidth===a.voi.windowWidth&&o.voi.windowCenter===a.voi.windowCenter&&o.invert===a.invert||(o.voi.windowWidth=a.voi.windowWidth,o.voi.windowCenter=a.voi.windowCenter,o.invert=a.invert,e.setViewport(n,o))}}},"./thirdParty/register.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/typeof.js"),i=n.n(r),a=n("./thirdParty/registerModule.js"),o=n("./thirdParty/registerMixin.js"),s=n("./thirdParty/registerItem.js"),l=n("./util/logger.js"),u=Object(l.getLogger)("thirdParty:register");function c(e,t,n){return e?t?"object"===i()(n)||"function"==typeof n||(u.warn("The %s is a %s, it should be an Object or a function.",n,i()(n)),!1):(u.warn("The %s must have a name in order to register.",e),!1):(u.warn("The type must be given in order to register."),!1)}t.default=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(c(e,t,n))switch(e){case"module":Object(a.default)(t,n,r);break;case"mixin":Object(o.default)(t,n,r);break;default:Object(s.default)(e,t,n,r)}}},"./thirdParty/registerItem.js":function(e,t,n){"use strict";n.r(t);var r=n("./lib.js"),i=n("./util/logger.js"),a=Object(i.getLogger)("thirdParty:registerType");function o(e){return void 0!==r.lib[e]}t.default=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s="".concat(e,"/").concat(t),l=o(s);!l||i?(l&&a.warn("Overwriting %s",s),r.lib[s]=n):a.warn("%s is already registered",s)}},"./thirdParty/registerMixin.js":function(e,t,n){"use strict";n.r(t);var r=n("./lib.js"),i=n("./mixins/index.js"),a=n("./util/logger.js"),o=Object(a.getLogger)("thirdParty:registerMixin");function s(e){return void 0!==i.default[e]}t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=s(e);!a||n?(a&&o.warn("Overwriting mixins/%s",e),i.default[e]=t,r.lib["mixins/".concat(e)]=i.default[e]):o.warn("mixins/%s is already registered",e)}},"./thirdParty/registerModule.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./util/logger.js"),a=Object(i.getLogger)("thirdParty:registerModule");function o(e){return void 0!==r.modules[e]}t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=o(e);!i||n?(i&&a.warn("Overwriting module %s",e),r.modules[e]=t,"function"==typeof r.modules[e].onRegisterCallback&&r.modules[e].onRegisterCallback()):a.warn("A module with the name %s is already registered",e)}},"./thirdParty/registerSome.js":function(e,t,n){"use strict";n.r(t);var r=n("./thirdParty/register.js");t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.forEach((function(e){var n=e.type,i=e.name,a=e.item;Object(r.default)(n,i,a,t)}))}},"./toolOptions.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getToolOptions",(function(){return i})),n.d(t,"setToolOptions",(function(){return a})),n.d(t,"clearToolOptions",(function(){return o})),n.d(t,"clearToolOptionsByToolType",(function(){return s})),n.d(t,"clearToolOptionsByToolName",(function(){return l})),n.d(t,"clearToolOptionsByElement",(function(){return u}));var r={};function i(e,t){if(!r[e])return{};var n=r[e].find((function(e){return e.element===t}));return n?n.options:{}}function a(e,t,n){if(r[e]){var i=r[e].findIndex((function(e){return e.element===t}));-1===i?r[e].push({element:t,options:n}):r[e][i].options=Object.assign(r[e][i].options||{},n)}else r[e]=[{element:t,options:n}]}function o(e,t){var n=r[e];n&&(r[e]=n.filter((function(e){return e.element!==t})))}function s(e){return l(e)}function l(e){delete r[e]}function u(e){for(var t in r)r[t]=r[t].filter((function(t){return t.element!==e}))}},"./tools/CrosshairsTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return S}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./tools/base/BaseTool.js"),g=n("./externalModules.js"),v=n("./stateManagement/loadHandlerManager.js"),y=n("./stateManagement/toolState.js"),b=n("./util/pointProjector.js"),x=n("./util/convertToVector3.js"),w=n("./toolOptions.js"),_=n("./tools/cursors/index.js"),S=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Crosshairs",supportedInteractionTypes:["Mouse","Touch"],svgCursor:_.crosshairsCursor};return(e=l()(this,c()(t).call(this,n,r))).mouseDownCallback=e._chooseLocation.bind(h()(e)),e.mouseDragCallback=e._chooseLocation.bind(h()(e)),e.touchDragCallback=e._chooseLocation.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_chooseLocation",value:function(e){var t=e.detail,n=t.element;e.stopImmediatePropagation();var r=Object(y.getToolState)(n,this.name);if(r){var i=n,a=g.default.cornerstone.getEnabledElement(i),o=g.default.cornerstone.metaData.get("imagePlaneModule",a.image.imageId);if(o){var s=t.currentPoints.image,l=Object(b.imagePointToPatientPoint)(s,o);r.data[0].synchronizationContext.getSourceElements().forEach((function(e){if(e!==i){var t=Number.MAX_VALUE,n=-1,r=Object(y.getToolState)(e,"stack");if(void 0!==r){var a=r.data[0];if(a.imageIds.forEach((function(e,r){var i=g.default.cornerstone.metaData.get("imagePlaneModule",e);if(i&&i.imagePositionPatient&&i.rowCosines&&i.columnCosines){var a=Object(x.default)(i.imagePositionPatient),o=Object(x.default)(i.rowCosines),s=Object(x.default)(i.columnCosines).clone().cross(o.clone()),u=Math.abs(s.clone().dot(a)-s.clone().dot(l));u<t&&(t=u,n=r)}})),n!==a.currentImageIdIndex&&-1!==n&&void 0!==a.imageIds[n]){var o=v.default.getStartLoadHandler(e),s=v.default.getEndLoadHandler(e),u=v.default.getErrorLoadingHandler(e);o&&o(e),(!0===a.preventCache?g.default.cornerstone.loadImage(a.imageIds[n]):g.default.cornerstone.loadAndCacheImage(a.imageIds[n])).then((function(t){var r=g.default.cornerstone.getViewport(e);a.currentImageIdIndex=n,g.default.cornerstone.displayImage(e,t,r),s&&s(e,t)}),(function(t){u&&u(e,a.imageIds[n],t)}))}}}}))}}}},{key:"activeCallback",value:function(e,t){var n=t.mouseButtonMask,r=t.synchronizationContext;Object(w.setToolOptions)(this.name,e,{mouseButtonMask:n}),Object(y.clearToolState)(e,this.name),Object(y.addToolState)(e,this.name,{synchronizationContext:r})}}]),t}(m.default)},"./tools/DoubleTapFitToWindowTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"DoubleTapFitToWindow",supportedInteractionTypes:["DoubleTap"]};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"doubleTapCallback",value:function(e){f.default.cornerstone.fitToWindow(e.detail.element)}}]),t}(n("./tools/base/BaseTool.js").default)},"./tools/DragProbeTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return E}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./externalModules.js"),g=n("./tools/base/BaseTool.js"),v=n("./stateManagement/textStyle.js"),y=n("./stateManagement/toolColors.js"),b=n("./util/getRGBPixels.js"),x=n("./util/calculateSUV.js"),w=n("./drawing/index.js"),_=n("./drawing/drawTextBox.js"),S=n("./tools/cursors/index.js"),E=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"DragProbe",strategies:{default:T,minimal:k},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],svgCursor:S.probeCursor};return(e=l()(this,c()(t).call(this,n,r))).touchDragCallback=e._movingEventCallback.bind(h()(e)),e.touchEndCallback=e._endMovingEventCallback.bind(h()(e)),e.mouseDragCallback=e._movingEventCallback.bind(h()(e)),e.mouseUpCallback=e._endMovingEventCallback.bind(h()(e)),e.dragEventData={},e}return p()(t,e),o()(t,[{key:"_movingEventCallback",value:function(e){var t=e.detail,n=t.element;this.dragEventData=t,m.default.cornerstone.updateImage(n)}},{key:"_endMovingEventCallback",value:function(e){var t=e.detail.element;this.dragEventData={},m.default.cornerstone.updateImage(t)}},{key:"renderToolData",value:function(e){this.dragEventData.currentPoints&&e&&e.detail&&Boolean(Object.keys(this.dragEventData.currentPoints).length)&&(e.detail.currentPoints=this.dragEventData.currentPoints,this.applyActiveStrategy(e))}}]),t}(g.default);function T(e){var t=this.configuration,n=m.default.cornerstone,r=e.detail,i=r.element,a=r.image,o=r.currentPoints,s=r.canvasContext,l=Object(w.getNewContext)(s.canvas),u=y.default.getActiveColor(),c=v.default.getFontSize(),d=Math.round(o.image.x),h=Math.round(o.image.y);d<0||h<0||d>=a.columns||h>=a.rows||Object(w.draw)(l,(function(e){Object(w.setShadow)(e,t);var r,s,l="".concat(d,", ").concat(h);if(a.color)r=Object(b.default)(i,d,h,1,1),s="R: ".concat(r[0]," G: ").concat(r[1]," B: ").concat(r[2]," A: ").concat(r[3]);else{var f=(r=n.getStoredPixels(i,d,h,1,1))[0],p=f*a.slope+a.intercept,m=Object(x.default)(a,f);s="SP: ".concat(f," MO: ").concat(parseFloat(p.toFixed(3))),m&&(s+=" SUV: ".concat(parseFloat(m.toFixed(3))))}var g={x:o.canvas.x+5,y:o.canvas.y-5};Object(_.default)(e,s,g.x,g.y+c+5,u),Object(_.default)(e,l,g.x,g.y,u)}))}function k(e){var t=this.configuration,n=m.default.cornerstone,r=e.detail,i=r.element,a=r.image,o=r.currentPoints,s=r.canvasContext,l=r.isTouchEvent,u=Object(w.getNewContext)(s.canvas),c=y.default.getActiveColor(),d=o.page.y-v.default.getFontSize()/2;l&&(d=o.page.y-4*v.default.getFontSize());var h=n.pageToPixel(i,o.page.x,d);h.x<0||h.y<0||h.x>=a.columns||h.y>=a.rows||Object(w.draw)(u,(function(e){Object(w.setShadow)(e,t);var r,o=n.metaData.get("generalSeriesModule",a.imageId),s=o&&o.modality,u="";if(a.color)r=Object(b.default)(i,h.x,h.y,1,1),u="R: ".concat(r[0]," G: ").concat(r[1]," B: ").concat(r[2]);else{var d=(r=n.getStoredPixels(i,h.x,h.y,1,1))[0],f=parseFloat((d*a.slope+a.intercept).toFixed(2));if("CT"===s)u+="HU: ".concat(f);else if("PT"===s){u+=f;var p=Object(x.default)(a,d);p&&(u+=" SUV: ".concat(parseFloat(p.toFixed(2))))}else u+=f}var m=n.pixelToCanvas(i,h),g={x:12,y:-(v.default.getFontSize()+10)/2},y=Object(_.textBoxWidth)(e,u,5);l&&(g={x:-y/2,y:-v.default.getFontSize()-10-12}),Object(w.drawCircle)(e,i,m,6,{color:c},"canvas"),Object(_.default)(e,u,m.x+g.x,m.y+g.y,c)}))}},"./tools/EraserTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return x}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./externalModules.js"),g=n("./tools/base/BaseTool.js"),v=n("./stateManagement/toolState.js"),y=n("./store/index.js"),b=n("./tools/cursors/index.js"),x=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Eraser",supportedInteractionTypes:["Mouse","Touch"],svgCursor:b.eraserCursor};return(e=l()(this,c()(t).call(this,n,r))).preMouseDownCallback=e._deleteAllNearbyTools.bind(h()(e)),e.preTouchStartCallback=e._deleteAllNearbyTools.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_deleteAllNearbyTools",value:function(e){var t=e.detail.currentPoints.canvas,n=e.detail.element;return y.state.tools.forEach((function(e){var r=Object(v.getToolState)(n,e.name);r&&r.data.forEach((function(r){"function"==typeof e.pointNearTool&&e.pointNearTool(n,r,t)&&(Object(v.removeToolState)(n,e.name,r),m.default.cornerstone.updateImage(n))}))})),!0}}]),t}(g.default)},"./tools/FreehandRoiSculptorTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return I}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./events.js"),g=n("./externalModules.js"),v=n("./stateManagement/toolColors.js"),y=n("./drawing/drawHandles.js"),b=n("./store/index.js"),x=n("./stateManagement/toolState.js"),w=n("./util/clip.js"),_=n("./store/getToolForElement.js"),S=n("./tools/base/BaseTool.js"),E=n("./store/setToolCursor.js"),T=n("./tools/cursors/index.js"),k=n("./util/freehand/index.js"),C=k.default.FreehandHandleData,I=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"FreehandRoiSculptor",referencedToolName:"FreehandRoi",supportedInteractionTypes:["Mouse","Touch","DoubleTap"],mixins:["activeOrDisabledBinaryTool"],configuration:O(),svgCursor:T.freehandRoiSculptorCursor};return(e=l()(this,c()(t).call(this,n,r))).updateOnMouseMove=!0,e.isMultiPartTool=!0,e.referencedToolName=e.initialConfiguration.referencedToolName,e._active=!1,e.activeMouseUpCallback=e.activeMouseUpCallback.bind(h()(e)),e.activeTouchEndCallback=e.activeTouchEndCallback.bind(h()(e)),e.activeMouseDragCallback=e.activeMouseDragCallback.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"renderToolData",value:function(e){var t=e.detail;if(null===this.configuration.currentTool)return!1;var n=t.element,r=this.configuration;if(!Object(x.getToolState)(n,this.referencedToolName).data[r.currentTool])return!1;if(this._active){var i=t.canvasContext.canvas.getContext("2d"),a={color:this.configuration.dragColor,fill:null,handleRadius:this._toolSizeCanvas};Object(y.default)(i,t,this.configuration.mouseLocation.handles,a)}else this.configuration.showCursorOnHover&&!this._recentTouchEnd&&this._renderHoverCursor(e)}},{key:"doubleClickCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),g.default.cornerstone.updateImage(t.element)}},{key:"doubleTapCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),g.default.cornerstone.updateImage(t.element)}},{key:"preTouchStartCallback",value:function(e){return this._initialiseSculpting(e),!0}},{key:"preMouseDownCallback",value:function(e){if(this.options.mouseButtonMask.includes(e.detail.buttons))return this._initialiseSculpting(e),!0}},{key:"activeMouseDragCallback",value:function(e){var t=this.configuration;if(this._active){var n=e.detail,r=Object(x.getToolState)(n.element,this.referencedToolName);if(r){var i=r.data[t.currentTool].handles.points;this._getMouseLocation(n),this._sculpt(n,i),g.default.cornerstone.updateImage(n.element)}}}},{key:"activeMouseUpCallback",value:function(e){this._activeEnd(e)}},{key:"activeTouchEndCallback",value:function(e){this._activeEnd(e),this._deselectAllTools(e),this._recentTouchEnd=!0}},{key:"_activeEnd",value:function(e){var t=e.detail,n=t.element,r=this.configuration;this._active=!1,b.state.isMultiPartToolActive=!1,this._getMouseLocation(t),this._invalidateToolData(t),r.mouseUpRender=!0,this._deactivateSculpt(n),g.default.cornerstone.updateImage(t.element),function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}(e)}},{key:"_renderHoverCursor",value:function(e){var t,n=e.detail,r=n.element,i=n.canvasContext.canvas.getContext("2d"),a=Object(x.getToolState)(r,this.referencedToolName).data[this.configuration.currentTool];this._recentTouchEnd=!1,this.configuration.mouseUpRender?(t=this.configuration.mouseLocation.handles.start,this.configuration.mouseUpRender=!1):t=b.state.mousePositionImage;var o=Object(_.default)(r,this.referencedToolName).distanceFromPointCanvas(r,a,t);if(this.configuration.mouseLocation.handles.start.x=t.x,this.configuration.mouseLocation.handles.start.y=t.y,this.configuration.limitRadiusOutsideRegion){var s=o;o=this._limitCursorRadiusCanvas(n,o),s>this.configuration.hoverCursorFadeDistance*o&&(i.globalAlpha=this.configuration.hoverCursorFadeAlpha)}var l={fill:null,color:this.configuration.hoverColor,handleRadius:o};Object(y.default)(i,n,this.configuration.mouseLocation.handles,l),this.configuration.limitRadiusOutsideRegion&&(i.globalAlpha=1)}},{key:"newImageCallback",value:function(e){this._deselectAllTools(e)}},{key:"enabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"passiveCallback",value:function(e){this._deselectAllTools(e)}},{key:"disabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"_selectFreehandTool",value:function(e){var t=this.configuration,n=e.element,r=this._getClosestFreehandToolOnElement(n,e);void 0!==r&&(t.currentTool=r,Object(E.hideToolCursor)(n))}},{key:"_activateFreehandTool",value:function(e,t){var n=Object(x.getToolState)(e,this.referencedToolName).data;this.configuration.currentTool=t;for(var r=0;r<n.length;r++)n[r].active=r===t}},{key:"_initialiseSculpting",value:function(e){var t=e.detail,n=this.configuration,r=t.element;null===n.currentTool&&(this._selectFreehandTool(t),null===n.currentTool)||(this._active=!0,b.state.isMultiPartToolActive=!0,this._configureToolSize(t),this._getMouseLocation(t),this._activateFreehandTool(r,n.currentTool),this._activateSculpt(r),g.default.cornerstone.updateImage(t.element))}},{key:"_sculpt",value:function(e,t){var n=this.configuration;this._sculptData={element:e.element,image:e.image,mousePoint:e.currentPoints.image,points:t,toolSize:this._toolSizeImage,minSpacing:n.minSpacing,maxSpacing:Math.max(this._toolSizeImage,2*n.minSpacing)};var r=this._pushHandles();void 0!==r.first&&(this._insertNewHandles(r),this._consolidateHandles())}},{key:"_pushHandles",value:function(){for(var e=this._sculptData,t=e.points,n=e.mousePoint,r=e.toolSize,i={},a=0;a<t.length;a++){var o=g.default.cornerstoneMath.point.distance(t[a],n);o>r||(this._pushOneHandle(a,o),void 0===i.first?(i.first=a,i.last=a):i.last=a)}return i}},{key:"_pushOneHandle",value:function(e,t){var n=this._sculptData,r=n.points,i=n.mousePoint,a=n.toolSize,o=n.image,s=r[e],l={x:i.x+a*((s.x-i.x)/t),y:i.y+a*((s.y-i.y)/t)};Object(w.clipToBox)(l,o),s.x=l.x,s.y=l.y;var u=this.constructor._getPreviousHandleIndex(e,r.length);r[u].lines.pop(),r[u].lines.push(s)}},{key:"_insertNewHandles",value:function(e){for(var t=this._findNewHandleIndicies(e),n=0,r=0;r<t.length;r++)this._insertHandleRadially(t[r]+1+n),n++}},{key:"_findNewHandleIndicies",value:function(e){for(var t=this._sculptData,n=t.points,r=t.maxSpacing,i=[],a=e.first;a<=e.last;a++)this._checkSpacing(a,n,i,r);var o=this.constructor._getNextHandleIndex(e.last,n.length);if(o!==e.first){this._checkSpacing(o,n,i,r);var s=this.constructor._getPreviousHandleIndex(e.first,n.length);s!==o&&this._checkSpacing(s,n,i,r)}return i}},{key:"_checkSpacing",value:function(e,t,n,r){var i=this.constructor._getNextHandleIndex(e,t.length);g.default.cornerstoneMath.point.distance(t[e],t[i])>r&&n.push(e)}},{key:"_insertHandleRadially",value:function(e){var t=this._sculptData.points,n=e-1,r=this.constructor._getNextHandleIndexBeforeInsert(e,t.length),i=this._getInsertPosition(e,n,r),a=new C(i);t.splice(e,0,a),t[n].lines.pop(),t[n].lines.push(t[e]),k.default.addLine(t,e)}},{key:"_consolidateHandles",value:function(){if(!(this._sculptData.points.length<=3)){var e=this._findCloseHandlePairs();this._mergeCloseHandles(e)}}},{key:"_findCloseHandlePairs",value:function(){for(var e=this._sculptData,t=e.points,n=e.minSpacing,r=[],i=t.length,a=0;a<i;a++){var o=this.constructor._getNextHandleIndex(a,t.length);g.default.cornerstoneMath.point.distance(t[a],t[o])<n&&(r.push([a,o]),0===a&&(i-=1),a++)}return r}},{key:"_mergeCloseHandles",value:function(e){for(var t=0,n=0;n<e.length;n++){var r=this.constructor._getCorrectedPair(e[n],t);this._combineHandles(r),t++}var i=this._findCloseHandlePairs();i.length&&this._mergeCloseHandles(i)}},{key:"_combineHandles",value:function(e){var t=this._sculptData,n=t.points,r=t.image,i={x:(n[e[0]].x+n[e[1]].x)/2,y:(n[e[0]].y+n[e[1]].y)/2};Object(w.clipToBox)(i,r),n[e[0]].x=i.x,n[e[0]].y=i.y;var a=this.constructor._getNextHandleIndex(e[1],n.length);n[e[0]].lines.pop(),n[e[0]].lines.push(n[a]),n.splice(e[1],1)}},{key:"_configureToolSize",value:function(e){var t=e.element,n=this.configuration,r=n.currentTool,i=e.currentPoints.image,a=Object(x.getToolState)(t,this.referencedToolName).data[r],o=Object(_.default)(t,this.referencedToolName),s=o.distanceFromPoint(t,a,i),l=o.distanceFromPointCanvas(t,a,i);n.limitRadiusOutsideRegion&&(s=this._limitCursorRadiusImage(e,s),l=this._limitCursorRadiusCanvas(e,l)),this._toolSizeImage=s,this._toolSizeCanvas=l}},{key:"_getMouseLocation",value:function(e){var t=this.configuration;t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,Object(w.clipToBox)(t.mouseLocation.handles.start,e.image)}},{key:"_activateSculpt",value:function(e){this._deactivateSculpt(e),e.addEventListener(m.default.MOUSE_UP,this.activeMouseUpCallback),e.addEventListener(m.default.MOUSE_CLICK,this.activeMouseUpCallback),e.addEventListener(m.default.MOUSE_DRAG,this.activeMouseDragCallback),e.addEventListener(m.default.TOUCH_END,this.activeTouchEndCallback),e.addEventListener(m.default.TOUCH_TAP,this.activeTouchEndCallback),e.addEventListener(m.default.TOUCH_DRAG,this.activeMouseDragCallback),g.default.cornerstone.updateImage(e)}},{key:"_deactivateSculpt",value:function(e){e.removeEventListener(m.default.MOUSE_UP,this.activeMouseUpCallback),e.removeEventListener(m.default.MOUSE_CLICK,this.activeMouseUpCallback),e.removeEventListener(m.default.MOUSE_DRAG,this.activeMouseDragCallback),e.removeEventListener(m.default.TOUCH_END,this.activeTouchEndCallback),e.removeEventListener(m.default.TOUCH_TAP,this.activeTouchEndCallback),e.removeEventListener(m.default.TOUCH_DRAG,this.activeMouseDragCallback),g.default.cornerstone.updateImage(e)}},{key:"_invalidateToolData",value:function(e){var t=this.configuration,n=e.element;Object(x.getToolState)(n,this.referencedToolName).data[t.currentTool].invalidated=!0}},{key:"_deselectAllTools",value:function(e){var t=this.configuration,n=Object(x.getToolState)(this.element,this.referencedToolName);if(t.currentTool=null,n)for(var r=0;r<n.data.length;r++)n.data[r].active=!1;Object(E.setToolCursor)(this.element,this.svgCursor),g.default.cornerstone.updateImage(this.element)}},{key:"_limitCursorRadiusCanvas",value:function(e,t){return this._limitCursorRadius(e,t,!0)}},{key:"_limitCursorRadiusImage",value:function(e,t){return this._limitCursorRadius(e,t,!1)}},{key:"_limitCursorRadius",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.element,i=e.image,a=this.configuration,o=Object(x.getToolState)(r,this.referencedToolName),s=o.data[a.currentTool],l=1;if(n){var u=g.default.cornerstone.pixelToCanvas(r,{x:0,y:0}),c=g.default.cornerstone.pixelToCanvas(r,{x:i.width,y:i.height}),d=(c.x-u.x)*(c.y-u.y);l=d/(i.width*i.height)}var h=s.area*l,f=Math.pow(h/Math.PI,.5);return Math.min(t,f)}},{key:"_getClosestFreehandToolOnElement",value:function(e,t){var n=Object(_.default)(e,this.referencedToolName),r=Object(x.getToolState)(e,this.referencedToolName);if(r){for(var i=r.data,a=t.currentPoints.image,o={distance:1/0,toolIndex:null},s=0;s<i.length;s++){var l=n.distanceFromPoint(e,i[s],a);-1!==l&&l<o.distance&&(o.distance=l,o.toolIndex=s)}return o.toolIndex}}},{key:"_getInsertPosition",value:function(e,t,n){var r,i=this._sculptData,a=i.points,o=i.toolSize,s=i.mousePoint,l=i.image,u={x:(a[t].x+a[n].x)/2,y:(a[t].y+a[n].y)/2},c=g.default.cornerstoneMath.point.distance(s,u);if(c<o){var d={x:(u.x-s.x)/c,y:(u.y-s.y)/c};r={x:s.x+o*d.x,y:s.y+o*d.y}}else r=u;return Object(w.clipToBox)(r,l),r}},{key:"minSpacing",get:function(){return this.configuration.minSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter minSpacing to a value other than a number.");this.configuration.minSpacing=e}},{key:"maxSpacing",get:function(){return this.configuration.maxSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter maxSpacing to a value other than a number.");this.configuration.maxSpacing=e}},{key:"showCursorOnHover",get:function(){return this.configuration.showCursorOnHover},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter showCursorOnHover to a value other than a boolean.");this.configuration.showCursorOnHover=e,g.default.cornerstone.updateImage(this.element)}},{key:"limitRadiusOutsideRegion",get:function(){return this.configuration.limitRadiusOutsideRegion},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter limitRadiusOutsideRegion to a value other than a boolean.");this.configuration.limitRadiusOutsideRegion=e,g.default.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeAlpha",get:function(){return this.configuration.hoverCursorFadeAlpha},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeAlpha to a value other than a number.");e=Math.max(Math.min(e,1),0),this.configuration.hoverCursorFadeAlpha=e,g.default.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeDistance",get:function(){return this.configuration.hoverCursorFadeDistance},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeDistance to a value other than a number.");e=Math.max(e,1),this.configuration.hoverCursorFadeDistance=e,g.default.cornerstone.updateImage(this.element)}}],[{key:"_getCorrectedPair",value:function(e,t){var n=[e[0]-t,e[1]-t];return n[1]<0&&(n[1]=0),n}},{key:"_getNextHandleIndex",value:function(e,t){return e===t-1?0:e+1}},{key:"_getPreviousHandleIndex",value:function(e,t){return 0===e?t-1:e-1}},{key:"_getNextHandleIndexBeforeInsert",value:function(e,t){return e===t?0:e}}]),t}(S.default);function O(){return{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},minSpacing:1,currentTool:null,dragColor:v.default.getActiveColor(),hoverColor:v.default.getToolColor(),showCursorOnHover:!0,limitRadiusOutsideRegion:!0,hoverCursorFadeAlpha:.5,hoverCursorFadeDistance:1.2}}},"./tools/MagnifyTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return x}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./externalModules.js"),g=n("./drawing/index.js"),v=n("./tools/base/BaseTool.js"),y=n("./store/setToolCursor.js"),b=n("./tools/cursors/index.js"),x=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Magnify",supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:300,magnificationLevel:2},svgCursor:b.magnifyCursor};return(e=l()(this,c()(t).call(this,n,r))).zoomCanvas=void 0,e.zoomElement=void 0,e.activeCallback=e._createMagnificationCanvas.bind(h()(e)),e.enabledCallback=e._createMagnificationCanvas.bind(h()(e)),e.disabledCallback=e._destroyMagnificationCanvas.bind(h()(e)),e.postTouchStartCallback=e._addMagnifyingGlass.bind(h()(e)),e.touchDragCallback=e._updateMagnifyingGlass.bind(h()(e)),e.touchEndCallback=e._removeMagnifyingGlass.bind(h()(e)),e.touchDragEndCallback=e._removeMagnifyingGlass.bind(h()(e)),e.postMouseDownCallback=e._addMagnifyingGlass.bind(h()(e)),e.mouseDragCallback=e._updateMagnifyingGlass.bind(h()(e)),e.mouseUpCallback=e._removeMagnifyingGlass.bind(h()(e)),e.mouseClickCallback=e._removeMagnifyingGlass.bind(h()(e)),e.newImageCallback=e._drawMagnificationTool.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_addMagnifyingGlass",value:function(e){var t=this;this._removeZoomElement(),this._drawZoomedElement(e),window.requestAnimationFrame((function(){return t._drawMagnificationTool(e)})),Object(y.hideToolCursor)(e.detail.element),e.preventDefault(),e.stopPropagation()}},{key:"_updateMagnifyingGlass",value:function(e){this._drawMagnificationTool(e),e.preventDefault(),e.stopPropagation()}},{key:"_removeMagnifyingGlass",value:function(e){var t=e.detail.element;Object(y.setToolCursor)(this.element,this.svgCursor),t.querySelector(".magnifyTool").style.display="none",this._removeZoomElement()}},{key:"_drawMagnificationTool",value:function(e){var t=e.detail.element,n=t.querySelector(".magnifyTool");if(n||this._createMagnificationCanvas(t),void 0!==this.zoomCanvas){var r=t.querySelector("canvas:not(.magnifyTool)"),i=Object(g.getNewContext)(n),a=m.default.cornerstone.pixelToCanvas(e.detail.element,e.detail.currentPoints.image),o=Math.min(this.configuration.magnifySize,r.width,r.height),s=this.configuration.magnificationLevel;n.width=o,n.height=o,a.x=Math.max(a.x,.5*o/s),a.x=Math.min(a.x,r.width-.5*o/s),a.y=Math.max(a.y,.5*o/s),a.y=Math.min(a.y,r.height-.5*o/s);var l={x:a.x*s-.5*o,y:a.y*s-.5*o};l.x=Math.max(l.x,0),l.y=Math.max(l.y,0),i.drawImage(this.zoomCanvas,l.x,l.y,o,o,0,0,o,o);var u={top:Math.max(a.y-.5*o-(e.detail.isTouchEvent?120:0),0),left:Math.max(a.x-.5*o,0)},c=n.getBoundingClientRect();u.top=Math.min(u.top,r.height-c.height),u.left=Math.min(u.left,r.width-c.width),n.style.top="".concat(u.top,"px"),n.style.left="".concat(u.left,"px"),n.style.display="block"}}},{key:"_drawZoomedElement",value:function(e){var t=e.detail.enabledElement;void 0===t&&(t=m.default.cornerstone.getEnabledElement(e.detail.element));var n=this.configuration.magnificationLevel,r=t.canvas,i=t.image;this.zoomElement||(this.zoomElement=document.createElement("div"),this.zoomElement.width=r.width*n,this.zoomElement.height=r.height*n,m.default.cornerstone.enable(this.zoomElement,t.options));var a=m.default.cornerstone.getEnabledElement(this.zoomElement),o=m.default.cornerstone.getViewport(t.element);this.zoomCanvas=a.canvas,this.zoomCanvas.width=r.width*n,this.zoomCanvas.height=r.height*n,a.viewport=Object.assign({},o),o.scale*=n,m.default.cornerstone.displayImage(this.zoomElement,i),m.default.cornerstone.setViewport(this.zoomElement,o)}},{key:"_removeZoomElement",value:function(){void 0!==this.zoomElement&&(m.default.cornerstone.disable(this.zoomElement),this.zoomElement=void 0,this.zoomCanvas=void 0)}},{key:"_createMagnificationCanvas",value:function(e){if(null===e.querySelector(".magnifyTool")){var t=document.createElement("canvas");t.classList.add("magnifyTool"),t.width=this.configuration.magnifySize,t.height=this.configuration.magnifySize,t.style.position="absolute",t.style.display="none",e.appendChild(t)}}},{key:"_destroyMagnificationCanvas",value:function(e){var t=e.querySelector(".magnifyTool");t&&e.removeChild(t)}}]),t}(v.default)},"./tools/OrientationMarkersTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return b}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseTool.js"),m=n("./orientation/index.js"),g=n("./drawing/index.js"),v=n("./stateManagement/toolColors.js"),y=n("./drawing/drawTextBox.js"),b=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"OrientationMarkers",configuration:{drawAllMarkers:!0},mixins:["enabledOrDisabledBinaryTool"]};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){var t=f.default.cornerstone;t.getEnabledElement(e).image&&t.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=Object(g.getNewContext)(t.canvasContext.canvas),r=t.element,i=_(r);if(i){var a=S(r,i),o=v.default.getToolColor(),s={top:Object(y.textBoxWidth)(n,i.top,0),left:Object(y.textBoxWidth)(n,i.left,0),right:Object(y.textBoxWidth)(n,i.right,0),bottom:Object(y.textBoxWidth)(n,i.bottom,0),height:Object(y.textBoxWidth)(n,"M",0)};x(n,i,a,s,o),this.configuration.drawAllMarkers&&w(n,i,a,s,o)}}}]),t}(p.default),x=function(e,t,n,r,i){Object(y.default)(e,t.top,n.top.x-r.top/2,n.top.y,i),Object(y.default)(e,t.left,n.left.x-r.left/2,n.left.y,i)},w=function(e,t,n,r,i){Object(y.default)(e,t.right,n.right.x-r.right,n.right.y,i),Object(y.default)(e,t.bottom,n.bottom.x-r.bottom/2,n.bottom.y-r.height,i)},_=function(e){var t=f.default.cornerstone,n=t.getEnabledElement(e),r=t.metaData.get("imagePlaneModule",n.image.imageId);if(r&&r.rowCosines&&r.columnCosines){var i=m.default.getOrientationString(r.rowCosines),a=m.default.getOrientationString(r.columnCosines),o=m.default.invertOrientationString(i);return{top:m.default.invertOrientationString(a),bottom:a,left:o,right:i}}},S=function(e){var t=f.default.cornerstone.getEnabledElement(e);return{top:f.default.cornerstone.pixelToCanvas(e,{x:t.image.width/2,y:5}),bottom:f.default.cornerstone.pixelToCanvas(e,{x:t.image.width/2,y:t.image.height-15}),left:f.default.cornerstone.pixelToCanvas(e,{x:5,y:t.image.height/2}),right:f.default.cornerstone.pixelToCanvas(e,{x:t.image.width-10,y:t.image.height/2})}}},"./tools/OverlayTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Overlay",configuration:{},mixins:["enabledOrDisabledBinaryTool"]},a=Object.assign(r,n);return(e=l()(this,c()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),o()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){f.default.cornerstone.getEnabledElement(e).image&&f.default.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=t.image,r=t.viewport,i=t.canvasContext;if(t&&t.enabledElement&&n){var a=f.default.cornerstone.metaData.get("overlayPlaneModule",n.imageId);if(a&&a.overlays&&a.overlays.length){var o=r.displayedArea.columnPixelSpacing||1,s=r.displayedArea.rowPixelSpacing||1,l=Math.abs(r.displayedArea.brhc.x-r.displayedArea.tlhc.x)*o,u=Math.abs(r.displayedArea.brhc.y-r.displayedArea.tlhc.y)*s;a.overlays.forEach((function(e){if(!1!==e.visible){var t=document.createElement("canvas");t.width=l,t.height=u;var n=t.getContext("2d");n.fillStyle=e.fillStyle||"white","R"===e.type&&(n.fillRect(0,0,t.width,t.height),n.globalCompositeOperation="xor");for(var r=0,a=0;a<e.rows;a++)for(var o=0;o<e.columns;o++)e.pixelData[r++]>0&&n.fillRect(o,a,1,1);var s=!isNaN(parseFloat(e.x))&&isFinite(e.x)?e.x:0,c=!isNaN(parseFloat(e.y))&&isFinite(e.y)?e.y:0;i.drawImage(t,s,c)}}))}}}}]),t}(n("./tools/base/BaseTool.js").default)},"./tools/PanMultiTouchTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return g}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./externalModules.js"),g=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"PanMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{touchPointers:2}};return(e=l()(this,c()(t).call(this,n,r))).multiTouchDragCallback=e._dragCallback.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport;if(t.numPointers===this.configuration.touchPointers){var i=this._getTranslation(t);this._applyTranslation(r,i),m.default.cornerstone.setViewport(n,r)}}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,r=e.deltaPoints,i=t.scale,a=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?i*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(a*=n.rowPixelSpacing/n.columnPixelSpacing),{x:r.page.x/i,y:r.page.y/a}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(n("./tools/base/BaseTool.js").default)},"./tools/PanTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return y}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./externalModules.js"),g=n("./tools/base/BaseTool.js"),v=n("./tools/cursors/index.js"),y=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Pan",supportedInteractionTypes:["Mouse","Touch"],svgCursor:v.panCursor};return(e=l()(this,c()(t).call(this,n,r))).touchDragCallback=e._dragCallback.bind(h()(e)),e.mouseDragCallback=e._dragCallback.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport,i=this._getTranslation(t);this._applyTranslation(r,i),m.default.cornerstone.setViewport(n,r)}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,r=e.deltaPoints,i=t.scale,a=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?i*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(a*=n.rowPixelSpacing/n.columnPixelSpacing),{x:r.page.x/i,y:r.page.y/a}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(g.default)},"./tools/ReferenceLinesTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return E}));var r=n("../node_modules/@babel/runtime/regenerator/index.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/asyncToGenerator.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/createClass.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),p=n.n(f),m=n("../node_modules/@babel/runtime/helpers/inherits.js"),g=n.n(m),v=n("./externalModules.js"),y=n("./tools/base/BaseTool.js"),b=n("./drawing/index.js"),x=n("./tools/referenceLines/renderActiveReferenceLine.js"),w=n("./util/wait.js"),_=n("./util/logger.js"),S=Object(_.getLogger)("tools:ReferenceLinesTool"),E=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l()(this,t);var r={name:"ReferenceLines",mixins:["enabledOrDisabledBinaryTool"],configuration:{renderer:x.default}};return(e=h()(this,p()(t).call(this,n,r))).renderer=null,e.synchronizationContext=null,e}var n;return g()(t,e),c()(t,[{key:"enabledCallback",value:(n=o()(i.a.mark((function e(t){var n,r,a=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(a.length>1&&void 0!==a[1]?a[1]:{}).synchronizationContext,r=this.configuration.renderer,e.next=4,Object(w.waitForEnabledElementImageToLoad)(t);case 4:if(e.sent&&r&&n){e.next=8;break}return S.warn("Unable to enable ".concat(this.name,". Exiting enable callback. Tool will be enabled, but will not render.")),e.abrupt("return");case 8:this.renderer=r,this.synchronizationContext=n,this.forceImageUpdate(t);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){v.default.cornerstone.getEnabledElement(e).image&&v.default.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=this,n=e.detail;if(this.renderer&&this.synchronizationContext){var r=this.synchronizationContext.getSourceElements(),i=Object(b.getNewContext)(n.canvasContext.canvas);v.default.cornerstone.setToPixelCoordinateSystem(n.enabledElement,i),r.forEach((function(r){r!==e.currentTarget&&t.renderer(i,n,e.currentTarget,r)}))}}}]),t}(y.default)},"./tools/RotateTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return v}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseTool.js"),m=n("./util/angleBetweenPoints.js"),g=n("./tools/cursors/index.js"),v=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Rotate",strategies:{default:y,horizontal:b,vertical:x},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{roundAngles:!1,flipHorizontal:!1,flipVertical:!1},svgCursor:g.rotateCursor};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"touchDragCallback",value:function(e){this.dragCallback(e)}},{key:"mouseDragCallback",value:function(e){this.dragCallback(e)}},{key:"postMouseDownCallback",value:function(e){this.initialRotation=e.detail.viewport.rotation}},{key:"dragCallback",value:function(e){e.detail.viewport.initialRotation=this.initialRotation,this.applyActiveStrategy(e),f.default.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(p.default);function y(e){var t=this.configuration.roundAngles,n=e.detail,r=n.element,i=n.viewport,a=i.initialRotation,o=r.getBoundingClientRect(r),s={x:n.startPoints.client.x,y:n.startPoints.client.y},l=i.scale,u=i.translation,c={x:o.left+r.clientWidth/2+u.x*l,y:o.top+r.clientHeight/2+u.y*l},d={x:n.currentPoints.client.x,y:n.currentPoints.client.y},h=Object(m.default)(c,s,d);t&&(h.angle=Math.ceil(h.angle)),h.direction<0&&(h.angle=-h.angle),i.rotation=a+h.angle}function b(e){var t=this.configuration,n=t.flipHorizontal,r=e.detail,i=r.viewport,a=r.deltaPoints.page.x/i.scale;t.roundAngles&&(a=Math[a>0?"ceil":"floor"](a)),n&&(a=-a),i.rotation+=a}function x(e){var t=this.configuration,n=t.flipVertical,r=e.detail,i=r.viewport,a=r.deltaPoints.page.y/i.scale;t.roundAngles&&(a=Math[a>0?"ceil":"floor"](a)),n&&(a=-a),i.rotation+=a}},"./tools/RotateTouchTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"RotateTouch",supportedInteractionTypes:["TouchRotate"]};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"touchRotateCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport;r.rotation+=t.rotation,f.default.cornerstone.setViewport(n,r)}}]),t}(n("./tools/base/BaseTool.js").default)},"./tools/ScaleOverlayTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return x}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseTool.js"),m=n("./drawing/index.js"),g=n("./stateManagement/toolStyle.js"),v=n("./stateManagement/toolColors.js"),y=n("./util/logger.js"),b=Object(y.getLogger)("tools:ScaleOverlayTool"),x=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ScaleOverlay",configuration:{minorTickLength:12.5,majorTickLength:25},mixins:["enabledOrDisabledBinaryTool"]};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){f.default.cornerstone.getEnabledElement(e).image&&f.default.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=Object(m.getNewContext)(t.canvasContext.canvas),r=t.image,i=t.viewport,a=t.element,o=r.rowPixelSpacing,s=r.columnPixelSpacing,l=f.default.cornerstone.metaData.get("imagePlaneModule",r.imageId);if(l&&(o=l.rowPixelSpacing||l.rowImagePixelSpacing,s=l.columnPixelSpacing||l.colImagePixelSpacing),o&&s){var u={width:n.canvas.width,height:n.canvas.height},c=10/o*i.scale,d=10/s*i.scale,h=w(u,.25,.05),p=w(u,.05,.15);if(u.width&&u.height&&h&&p){var y=v.default.getToolColor(),x=g.default.getToolWidth(),E=Object.assign({},{hscaleBounds:h,vscaleBounds:p,verticalMinorTick:c,horizontalMinorTick:d,verticalLine:{start:{x:p.bottomRight.x,y:p.topLeft.y},end:{x:p.bottomRight.x,y:p.bottomRight.y}},horizontalLine:{start:{x:h.topLeft.x,y:h.bottomRight.y},end:{x:h.bottomRight.x,y:h.bottomRight.y}},color:y,lineWidth:x},this.configuration);Object(m.draw)(n,(function(e){Object(m.setShadow)(e,E),Object(m.drawLine)(e,a,E.verticalLine.start,E.verticalLine.end,{color:E.color,lineWidth:E.lineWidth},"canvas"),_(e,a,E),Object(m.drawLine)(e,a,E.horizontalLine.start,E.horizontalLine.end,{color:E.color,lineWidth:E.lineWidth},"canvas"),S(e,a,E)}))}}else b.warn("unable to define rowPixelSpacing or colPixelSpacing from data on ".concat(this.name,"'s renderToolData"))}}]),t}(p.default),w=function(e,t,n){var r=t*Math.min(1e3,e.width),i=n*Math.min(1e3,e.height),a={left:r,top:i,width:e.width-2*r,height:e.height-2*i};return{topLeft:{x:a.left,y:a.top},bottomRight:{x:a.left+a.width,y:a.top+a.height}}},_=function(e,t,n){for(var r=0;n.verticalLine.start.y+r*n.verticalMinorTick<=n.vscaleBounds.bottomRight.y;){var i=n.color,a=n.lineWidth,o={x:n.verticalLine.start.x,y:n.verticalLine.start.y+r*n.verticalMinorTick},s={x:0,y:n.verticalLine.start.y+r*n.verticalMinorTick};s.x=r%5==0?n.verticalLine.start.x-n.majorTickLength:n.verticalLine.start.x-n.minorTickLength,Object(m.drawLine)(e,t,o,s,{color:i,lineWidth:a},"canvas"),r++}},S=function(e,t,n){for(var r=0;n.horizontalLine.start.x+r*n.horizontalMinorTick<=n.hscaleBounds.bottomRight.x;){var i=n.color,a=n.lineWidth,o={x:n.horizontalLine.start.x+r*n.horizontalMinorTick,y:n.horizontalLine.start.y},s={x:n.horizontalLine.start.x+r*n.horizontalMinorTick,y:0};s.y=r%5==0?n.horizontalLine.start.y-n.majorTickLength:n.horizontalLine.start.y-n.minorTickLength,Object(m.drawLine)(e,t,o,s,{color:i,lineWidth:a},"canvas"),r++}}},"./tools/StackScrollMouseWheelTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return m}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./tools/base/BaseTool.js"),p=n("./util/scroll.js"),m=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"StackScrollMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{loop:!1,allowSkipping:!0,invert:!1}};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.direction,r=t.element,i=this.configuration,a=i.loop,o=i.allowSkipping,s=i.invert?-n:n;Object(p.default)(r,s,a,o)}}]),t}(f.default)},"./tools/StackScrollMultiTouchTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return b}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./tools/base/BaseTool.js"),g=n("./util/scroll.js"),v=n("./stateManagement/toolState.js"),y=n("./toolOptions.js"),b=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"StackScrollMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{loop:!1,allowSkipping:!0,touchPointers:3}};return(e=l()(this,c()(t).call(this,n,r))).multiTouchDragCallback=e._dragCallback.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_dragCallback",value:function(e){var t=e.detail;if(t.numPointers===this.configuration.touchPointers){var n=t.element,r=t.deltaPoints,i=this.configuration,a=i.loop,o=i.allowSkipping,s=Object(y.getToolOptions)(this.name,n),l=this._getPixelPerImage(n),u=this._getDeltaY(n,r.page.y);if(!l)return;if(Math.abs(u)>=l){var c=Math.round(u/l);Object(g.default)(n,c,a,o),s.deltaY=u%l}else s.deltaY=u;Object(y.setToolOptions)(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return(Object(y.getToolOptions)(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=Object(v.getToolState)(e,"stack");if(t&&t.data&&t.data.length)return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(t.data[0].imageIds.length,8))}}]),t}(m.default)},"./tools/StackScrollTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return x}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./tools/base/BaseTool.js"),g=n("./util/scroll.js"),v=n("./stateManagement/toolState.js"),y=n("./toolOptions.js"),b=n("./tools/cursors/index.js"),x=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"StackScroll",supportedInteractionTypes:["Mouse","Touch"],configuration:{loop:!1,allowSkipping:!0},svgCursor:b.stackScrollCursor};return(e=l()(this,c()(t).call(this,n,r))).mouseDragCallback=e._dragCallback.bind(h()(e)),e.touchDragCallback=e._dragCallback.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,r=t.deltaPoints,i=this.configuration,a=i.loop,o=i.allowSkipping,s=Object(y.getToolOptions)(this.name,n),l=this._getPixelPerImage(n),u=this._getDeltaY(n,r.page.y);if(l){if(Math.abs(u)>=l){var c=Math.round(u/l);Object(g.default)(n,c,a,o),s.deltaY=u%l}else s.deltaY=u;Object(y.setToolOptions)(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return(Object(y.getToolOptions)(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=Object(v.getToolState)(e,"stack");if(t&&t.data&&t.data.length)return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(t.data[0].imageIds.length,8))}}]),t}(m.default)},"./tools/WwwcRegionTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return _}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./externalModules.js"),g=n("./tools/base/BaseTool.js"),v=n("./drawing/index.js"),y=n("./util/clip.js"),b=n("./util/getLuminance.js"),x=n("./stateManagement/toolColors.js"),w=n("./tools/cursors/index.js"),_=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"WwwcRegion",supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10},svgCursor:w.wwwcRegionCursor};return(e=l()(this,c()(t).call(this,n,r)))._resetHandles(),e.postTouchStartCallback=e._startOutliningRegion.bind(h()(e)),e.touchDragCallback=e._setHandlesAndUpdate.bind(h()(e)),e.touchEndCallback=e._applyStrategy.bind(h()(e)),e.postMouseDownCallback=e._startOutliningRegion.bind(h()(e)),e.mouseClickCallback=e._startOutliningRegion.bind(h()(e)),e.mouseDragCallback=e._setHandlesAndUpdate.bind(h()(e)),e.mouseMoveCallback=e._setHandlesAndUpdate.bind(h()(e)),e.mouseUpCallback=e._applyStrategy.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=n.element,i=x.default.getColorIfActive({active:!0}),a=Object(v.getNewContext)(n.canvasContext.canvas);Object(v.draw)(a,(function(e){Object(v.drawRect)(e,r,t.handles.start,t.handles.end,{color:i})}))}},{key:"_startOutliningRegion",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;return S(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),m.default.cornerstone.updateImage(t),!0}},{key:"_setHandlesAndUpdate",value:function(e){var t=e.detail.element;this.handles.end=e.detail.currentPoints.image,m.default.cornerstone.updateImage(t)}},{key:"_applyStrategy",value:function(e){S(this.handles.start)||S(this.handles.end)||(e.detail.handles=this.handles,E(e,this.configuration),this._resetHandles())}},{key:"_resetHandles",value:function(){this.handles={start:{},end:{}}}}]),t}(g.default),S=function(e){return 0===Object.keys(e).length&&e.constructor===Object},E=function(e,t){var n=e.detail,r=n.image,i=n.element,a=e.detail.handles,o=a.start,s=a.end,l=Math.min(o.x,s.x),u=Math.min(o.y,s.y),c=Math.abs(o.x-s.x),d=Math.abs(o.y-s.y);l=Object(y.default)(l,0,r.width),u=Object(y.default)(u,0,r.height),c=Math.floor(Math.min(c,Math.abs(r.width-l))),d=Math.floor(Math.min(d,Math.abs(r.height-u)));var h=Object(b.default)(i,l,u,c,d),f=T(h,r.minPixelValue,r.maxPixelValue),p=n.viewport;void 0===t.minWindowWidth&&(t.minWindowWidth=10),p.voi.windowWidth=Math.max(Math.abs(f.max-f.min),t.minWindowWidth),p.voi.windowCenter=f.mean,p.voiLUT=void 0,m.default.cornerstone.setViewport(i,p),m.default.cornerstone.updateImage(i)},T=function(e,t,n){var r=e.length,i=n,a=t,o=0;if(r<2)return{min:i,max:a,mean:(t+n)/2};for(var s=0;s<r;s++){var l=e[s];i=Math.min(i,l),a=Math.max(a,l),o+=l}return{min:i,max:a,mean:o/r}}},"./tools/WwwcTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return g}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseTool.js"),m=n("./tools/cursors/index.js"),g=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Wwwc",strategies:{basicLevelingStrategy:v},supportedInteractionTypes:["Mouse","Touch"],configuration:{orientation:0},svgCursor:m.wwwcCursor};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"mouseDragCallback",value:function(e){this.applyActiveStrategy(e),f.default.cornerstone.setViewport(e.detail.element,e.detail.viewport)}},{key:"touchDragCallback",value:function(e){e.stopImmediatePropagation(),this.applyActiveStrategy(e),f.default.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(p.default);function v(e){var t=e.detail,n=(t.image.maxPixelValue*t.image.slope+t.image.intercept-(t.image.minPixelValue*t.image.slope+t.image.intercept))/1024,r=t.deltaPoints.page.x*n,i=t.deltaPoints.page.y*n;0===this.configuration.orientation?(t.viewport.voi.windowWidth+=r,t.viewport.voi.windowCenter+=i):(t.viewport.voi.windowWidth+=i,t.viewport.voi.windowCenter+=r),t.viewport.voiLUT=void 0}},"./tools/ZoomMouseWheelTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return g}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseTool.js"),m=n("./util/zoom/index.js"),g=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ZoomMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{minScale:.25,maxScale:20,invert:!1}};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport,i=t.spinY,a=this.configuration,o=a.maxScale,s=a.minScale,l=a.invert?i/4:-i/4,u=Object(m.changeViewportScale)(r,l,{maxScale:o,minScale:s});f.default.cornerstone.setViewport(n,u)}}]),t}(p.default)},"./tools/ZoomTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return x}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseTool.js"),m=n("./util/clip.js"),g=n("./util/zoom/index.js"),v=n("./tools/cursors/index.js"),y=g.default.correctShift,b=g.default.changeViewportScale,x=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Zoom",strategies:{default:_,translate:S,zoomToCenter:E},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,preventZoomOutsideImage:!1,minScale:.25,maxScale:20},svgCursor:v.zoomCursor};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"touchDragCallback",value:function(e){w.call(this,e)}},{key:"mouseDragCallback",value:function(e){w.call(this,e)}}]),t}(p.default),w=function(e){if(!e.detail.deltaPoints.page.y)return!1;this.applyActiveStrategy(e,this.configuration),f.default.cornerstone.setViewport(e.detail.element,e.detail.viewport)};function _(e){var t=this.configuration,n=e.detail.deltaPoints.page.y,r=e.detail,i=r.element,a=r.viewport,o=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],s=o[0],l=o[1],u=o[2],c=o[3],d=b(a,t.invert?-n/100:n/100,{maxScale:t.maxScale,minScale:t.minScale});f.default.cornerstone.setViewport(i,d);var h=f.default.cornerstone.pageToPixel(i,s,l),p={x:u-h.x,y:c-h.y};p=y(p,d),a.translation.x-=p.x,a.translation.y-=p.y}function S(e){var t=this.configuration,n=t.preventZoomOutsideImage,r=e.detail.deltaPoints.page.y,i=t.invert?-r/100:r/100,a=e.detail.image,o=[e.detail.startPoints.image.x,e.detail.startPoints.image.y],s=o[0],l=o[1],u=b(e.detail.viewport,i,{maxScale:t.maxScale,minScale:t.minScale}),c={x:0,y:0},d=.01;if(i<0)u.scale<3&&(Math.abs(u.translation.x)<d?u.translation.x=0:c.x=u.translation.x/8,Math.abs(u.translation.y)<d?u.translation.y=0:c.y=u.translation.y/8);else{n&&Object(m.clipToBox)(e.detail.startPoints.image,a);var h={x:a.width/2-s,y:a.height/2-l};h=y(h,u);var f={x:u.translation.x-h.x,y:u.translation.y-h.y};Math.abs(f.x)<d?u.translation.x=h.x:c.x=f.x/8,Math.abs(f.y)<d?u.translation.y=h.y:c.y=f.y/8}u.translation.x-=c.x,u.translation.y-=c.y}function E(e){var t=this.configuration,n=e.detail.deltaPoints.page.y;b(e.detail.viewport,t.invert?-n/100:n/100,{maxScale:t.maxScale,minScale:t.minScale})}},"./tools/ZoomTouchPinchTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return g}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseTool.js"),m=n("./util/zoom/index.js").default.correctShift,g=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ZoomTouchPinch",supportedInteractionTypes:["TouchPinch"],configuration:{minScale:.25,maxScale:20}};return l()(this,c()(t).call(this,e,n))}return h()(t,e),o()(t,[{key:"touchPinchCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport,i=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],a=i[0],o=i[1],s=i[2],l=i[3],u=this.configuration,c=u.maxScale,d=u.minScale;r.scale+=t.scaleChange*r.scale,c&&r.scale>c?r.scale=c:d&&r.scale<d&&(r.scale=d),f.default.cornerstone.setViewport(n,r);var h=f.default.cornerstone.pageToPixel(n,a,o),p={x:s-h.x,y:l-h.y};p=m(p,r),r.translation.x-=p.x,r.translation.y-=p.y,f.default.cornerstone.setViewport(n,r)}}]),t}(p.default)},"./tools/annotation/AngleTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return D}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseAnnotationTool.js"),m=n("./stateManagement/toolState.js"),g=n("./stateManagement/toolStyle.js"),v=n("./stateManagement/toolColors.js"),y=n("./manipulators/index.js"),b=n("./drawing/index.js"),x=n("./drawing/drawLinkedTextBox.js"),w=n("./drawing/drawTextBox.js"),_=n("./drawing/drawHandles.js"),S=n("./util/lineSegDistance.js"),E=n("./util/roundToDecimal.js"),T=n("./tools/cursors/index.js"),k=n("./util/triggerEvent.js"),C=n("./events.js"),I=n("./util/getPixelSpacing.js"),O=n("./util/throttle.js"),A=n("./store/index.js"),D=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Angle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:T.angleCursor,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(e=l()(this,c()(t).call(this,n,r))).preventNewMeasurement=!1,e.throttledUpdateCachedStats=Object(O.default)(e.updateCachedStats,110),e}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&(Object(S.default)(e,t.handles.start,t.handles.middle,n)<25||Object(S.default)(e,t.handles.middle,t.handles.end,n)<25)}},{key:"updateCachedStats",value:function(e,t,n){var r=N(e,n.handles.middle,n.handles.start),i=N(e,n.handles.end,n.handles.middle),a=N(e,n.handles.end,n.handles.start),o=M(r),s=M(i),l=M(a),u=Math.acos((Math.pow(o,2)+Math.pow(s,2)-Math.pow(l,2))/(2*o*s));u*=180/Math.PI,n.rAngle=Object(E.default)(u,2),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=n.enabledElement,i=this.configuration,a=i.handleRadius,o=i.drawHandlesOnHover,s=i.hideHandlesIfMoving,l=i.renderDashed,u=Object(m.getToolState)(e.currentTarget,this.name),c=Object(A.getModule)("globalConfiguration").configuration.lineDash;if(u)for(var d=Object(b.getNewContext)(n.canvasContext.canvas),h=n.image,p=n.element,y=Object(I.default)(h),S=y.rowPixelSpacing,E=y.colPixelSpacing,T=g.default.getToolWidth(),k=function(e){var i=u.data[e];if(!1===i.visible)return"continue";Object(b.draw)(d,(function(e){Object(b.setShadow)(e,t.configuration);var u=v.default.getColorIfActive(i),d=f.default.cornerstone.pixelToCanvas(n.element,i.handles.start),m=f.default.cornerstone.pixelToCanvas(n.element,i.handles.middle),g={color:u};l&&(g.lineDash=c),Object(b.drawJoinedLines)(e,n.element,i.handles.start,[i.handles.middle,i.handles.end],g);var y={color:u,handleRadius:a,drawHandlesIfActive:o,hideHandlesIfMoving:s};if(t.configuration.drawHandles&&Object(_.default)(e,n,i.handles,y),!0===i.invalidated&&(i.rAngle?t.throttledUpdateCachedStats(h,p,i):t.updateCachedStats(h,p,i)),i.rAngle){var k,C=function(e,t,n){var r=t&&n?"":" (isotropic)";return e.rAngle.toString()+String.fromCharCode(parseInt("00B0",16))+r}(i,S,E);if(!i.handles.textBox.hasMoved){k={x:m.x,y:m.y};var I=Object(w.textBoxWidth)(e,C,5);m.x<d.x?k.x-=15+I+10:k.x+=15;var A=f.default.cornerstone.internal.getTransform(r);A.invert();var D=A.transformPoint(k.x,k.y);i.handles.textBox.x=D.x,i.handles.textBox.y=D.y}Object(x.default)(e,n.element,i.handles.textBox,C,i.handles,O,u,T,0,!0)}}))},C=0;C<u.data.length;C++)k(C);function O(e){return[e.start,e.middle,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this;if(!this.preventNewMeasurement){this.preventNewMeasurement=!0,e.preventDefault(),e.stopPropagation();var r=e.detail,i=this.createNewMeasurement(r),a=e.detail.element;Object(m.addToolState)(a,this.name,i),f.default.cornerstone.updateImage(a),Object(y.moveNewHandle)(r,this.name,i,i.handles.middle,this.options,t,(function(e){if(i.active=!1,!e)return Object(m.removeToolState)(a,n.name,i),void(n.preventNewMeasurement=!1);i.handles.end.active=!0,f.default.cornerstone.updateImage(a),Object(y.moveNewHandle)(r,n.name,i,i.handles.end,n.options,t,(function(e){e?(i.active=!1,f.default.cornerstone.updateImage(a)):Object(m.removeToolState)(a,n.name,i),n.preventNewMeasurement=!1,f.default.cornerstone.updateImage(a);var t={toolName:n.name,toolType:n.name,element:a,measurementData:i};Object(k.default)(a,C.default.MEASUREMENT_COMPLETED,t)}))}))}}}]),t}(p.default);function M(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function N(e,t,n){var r=Object(I.default)(e);return{x:(t.x-n.x)*(r.colPixelSpacing||1),y:(t.y-n.y)*(r.rowPixelSpacing||1)}}},"./tools/annotation/ArrowAnnotateTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return D}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseAnnotationTool.js"),m=n("./events.js"),g=n("./stateManagement/toolStyle.js"),v=n("./stateManagement/textStyle.js"),y=n("./stateManagement/toolColors.js"),b=n("./manipulators/index.js"),x=n("./util/pointInsideBoundingBox.js"),w=n("./util/lineSegDistance.js"),_=n("./util/triggerEvent.js"),S=n("./stateManagement/toolState.js"),E=n("./drawing/drawLinkedTextBox.js"),T=n("./drawing/index.js"),k=n("./drawing/drawArrow.js"),C=n("./drawing/drawHandles.js"),I=n("./drawing/drawTextBox.js"),O=n("./tools/cursors/index.js"),A=n("./store/index.js"),D=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"ArrowAnnotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:M,changeTextCallback:N,drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,arrowFirst:!0,renderDashed:!1,allowEmptyLabel:!1},svgCursor:O.arrowAnnotateCursor};return(e=l()(this,c()(t).call(this,n,r))).preventNewMeasurement=!1,e}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&Object(w.default)(e,t.handles.start,t.handles.end,n)<25}},{key:"updateCachedStats",value:function(){}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=n.element,i=n.enabledElement,a=this.configuration,o=a.handleRadius,s=a.drawHandlesOnHover,l=a.hideHandlesIfMoving,u=a.renderDashed,c=Object(S.getToolState)(r,this.name);if(c){var d,h=e.detail.canvasContext.canvas,p=Object(T.getNewContext)(h),m=g.default.getToolWidth();u&&(d=Object(A.getModule)("globalConfiguration").configuration.lineDash);for(var b=function(n){var a=c.data[n];if(!1===a.visible)return"continue";Object(T.draw)(p,(function(n){Object(T.setShadow)(n,t.configuration);var u=y.default.getColorIfActive(a),c=f.default.cornerstone.pixelToCanvas(r,a.handles.start),h=f.default.cornerstone.pixelToCanvas(r,a.handles.end);t.configuration.arrowFirst?Object(k.default)(n,h,c,u,m,d):Object(k.default)(n,c,h,u,m,d);var p={color:u,handleRadius:o,drawHandlesIfActive:s,hideHandlesIfMoving:l};t.configuration.drawHandles&&Object(C.default)(n,e.detail,a.handles,p);var g=function(e){return e.text}(a);if(g&&""!==g){var b=Object(I.textBoxWidth)(n,g,5),x=v.default.getFontSize()+10,_=Math.max(b,x)/2+5;if(h.x<c.x&&(_=-_),!a.handles.textBox.hasMoved){var S;S=t.configuration.arrowFirst?{x:h.x-b/2+_,y:h.y-x/2}:{x:c.x-b/2-_,y:c.y-x/2};var O=f.default.cornerstone.internal.getTransform(i);O.invert();var A=O.transformPoint(S.x,S.y);a.handles.textBox.x=A.x,a.handles.textBox.y=A.y}Object(E.default)(n,r,a.handles.textBox,g,a.handles,w,u,m,0,!1)}}))},x=0;x<c.data.length;x++)b(x)}function w(e){return[e.start,{x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2},e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this,r=e.detail.element,i=this.createNewMeasurement(e),a=this.configuration.allowEmptyLabel;Object(S.addToolState)(r,this.name,i),f.default.cornerstone.updateImage(r),Object(b.moveNewHandle)(e.detail,this.name,i,i.handles.end,this.options,t,(function(t){t?void 0===i.text&&n.configuration.getTextCallback((function(e){if(e||a){i.text=e,i.active=!1;var t={toolName:n.name,toolType:n.name,element:r,measurementData:i};f.default.cornerstone.updateImage(r),Object(_.default)(r,m.default.MEASUREMENT_COMPLETED,t)}else Object(S.removeToolState)(r,n.name,i)}),e.detail):Object(S.removeToolState)(r,n.name,i),f.default.cornerstone.updateImage(r)}))}},{key:"doubleClickCallback",value:function(e){return this._updateTextForNearbyAnnotation(e)}},{key:"touchPressCallback",value:function(e){return this._updateTextForNearbyAnnotation(e)}},{key:"_updateTextForNearbyAnnotation",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.canvas,r=Object(S.getToolState)(t,this.name);if(!r)return!1;for(var i=0;i<r.data.length;i++){var a=r.data[i];if(this.pointNearTool(t,a,n)||Object(x.default)(a.handles.textBox,n))return a.active=!0,f.default.cornerstone.updateImage(t),this.configuration.changeTextCallback(a,e.detail,this._doneChangingTextCallback.bind(this,t,a)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}}},{key:"_doneChangingTextCallback",value:function(e,t,n,r){!0===r?Object(S.removeToolState)(e,this.name,t):t.text=n,t.active=!1,f.default.cornerstone.updateImage(e),Object(_.default)(e,m.default.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}}]),t}(p.default);function M(e){e(prompt("Enter your annotation:"))}function N(e,t,n){n(prompt("Change your annotation:"))}},"./tools/annotation/BidirectionalTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return O}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./tools/base/BaseAnnotationTool.js"),g=n("./tools/annotation/bidirectionalTool/createNewMeasurement.js"),v=n("./tools/annotation/bidirectionalTool/pointNearTool.js"),y=n("./tools/annotation/bidirectionalTool/renderToolData.js"),b=n("./tools/annotation/bidirectionalTool/addNewMeasurement.js"),x=n("./tools/annotation/bidirectionalTool/mouseMoveCallback.js"),w=n("./tools/annotation/bidirectionalTool/handleSelectedCallback.js"),_=n("./tools/annotation/bidirectionalTool/handleSelectedMouseCallback.js"),S=n("./tools/annotation/bidirectionalTool/handleSelectedTouchCallback.js"),E=n("./tools/cursors/index.js"),T=n("./util/throttle.js"),k=n("./util/getPixelSpacing.js"),C=n("./tools/annotation/bidirectionalTool/utils/calculateLongestAndShortestDiameters.js"),I=function(e,t,n){return n()},O=function(e){function t(e){var n;i()(this,t);var r={name:"Bidirectional",supportedInteractionTypes:["Mouse","Touch"],configuration:{changeMeasurementLocationCallback:I,getMeasurementLocationCallback:I,textBox:"",shadow:"",drawHandles:!0,drawHandlesOnHover:!0,hideHandlesIfMoving:!1,renderDashed:!1,additionalData:[]},svgCursor:E.bidirectionalCursor};return(n=l()(this,c()(t).call(this,e,r))).throttledUpdateCachedStats=Object(T.default)(n.updateCachedStats,110),n.createNewMeasurement=g.default.bind(h()(n)),n.pointNearTool=v.default.bind(h()(n)),n.renderToolData=y.default.bind(h()(n)),n.addNewMeasurement=b.default.bind(h()(n)),n._moveCallback=x.default.bind(h()(n)),n.handleSelectedCallback=w.default.bind(h()(n)),n.handleSelectedMouseCallback=_.default.bind(h()(n)),n.handleSelectedTouchCallback=S.default.bind(h()(n)),n}return p()(t,e),o()(t,[{key:"updateCachedStats",value:function(e,t,n){if(n.toolName===this.name){var r=Object(k.default)(e),i=Object(C.default)(n,r),a=i.shortestDiameter;n.longestDiameter=i.longestDiameter,n.shortestDiameter=a,n.invalidated=!1}}}]),t}(m.default)},"./tools/annotation/CircleRoiTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return A}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseAnnotationTool.js"),m=n("./stateManagement/toolState.js"),g=n("./stateManagement/toolStyle.js"),v=n("./stateManagement/toolColors.js"),y=n("./store/index.js"),b=n("./drawing/index.js"),x=n("./util/calculateSUV.js"),w=n("./util/ellipse/index.js"),_=n("./util/getROITextBoxCoords.js"),S=n("./util/numbersWithCommas.js"),E=n("./util/throttle.js"),T=n("./util/logger.js"),k=n("./util/getPixelSpacing.js"),C=n("./tools/cursors/index.js"),I=n("./util/getCircleCoords.js"),O=Object(T.getLogger)("tools:annotation:CircleRoiTool"),A=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"CircleRoi",supportedInteractionTypes:["Mouse","Touch"],svgCursor:C.circleRoiCursor,configuration:{renderDashed:!1,hideHandlesIfMoving:!1}};return(e=l()(this,c()(t).call(this,n,r))).throttledUpdateCachedStats=Object(E.default)(e.updateCachedStats,110),e}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};O.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,r){var i=t&&t.handles&&t.handles.start&&t.handles.end,a=f.default.cornerstoneMath.point.distance;if(i||O.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!i||!1===t.visible)return!1;var o="mouse"===r?15:25,s=f.default.cornerstone.pixelToCanvas(e,t.handles.start),l=f.default.cornerstone.pixelToCanvas(e,t.handles.end),u=a(s,n),c=a(s,l);return u>c-o/2&&u<c+o/2}},{key:"updateCachedStats",value:function(e,t,n){var r=(f.default.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,i=Object(k.default)(e),a=function(e,t,n,r,i){var a,o=Object(I.default)(n.start,n.end),s=f.default.cornerstone.getPixels(t,o.left,o.top,o.width,o.height),l=Object(w.calculateEllipseStatistics)(s,o);return"PT"===r&&(a={mean:Object(x.default)(e,l.mean,!0)||0,stdDev:Object(x.default)(e,l.stdDev,!0)||0}),{area:Math.PI*(o.width*(i.colPixelSpacing||1)/2)*(o.height*(i.rowPixelSpacing||1)/2)||0,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:a}}(e,t,n.handles,r,i);n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=Object(m.getToolState)(e.currentTarget,this.name);if(n){var r=f.default.cornerstoneMath.point.distance,i=e.detail,a=i.image,o=i.element,s=i.canvasContext,l=g.default.getToolWidth(),u=this.configuration,c=u.handleRadius,d=u.drawHandlesOnHover,h=u.hideHandlesIfMoving,p=u.renderDashed,x=Object(b.getNewContext)(s.canvas),w=Object(k.default)(a),S=w.rowPixelSpacing,E=w.colPixelSpacing,T=Object(y.getModule)("globalConfiguration").configuration.lineDash,C=(f.default.cornerstone.metaData.get("generalSeriesModule",a.imageId)||{}).modality,O=S&&E;Object(b.draw)(x,(function(e){for(var s=0;s<n.data.length;s++){var u=n.data[s];if(!1!==u.visible){var m=v.default.getColorIfActive(u),g={color:m,handleRadius:c,drawHandlesIfActive:d,hideHandlesIfMoving:h};Object(b.setShadow)(e,t.configuration);var y=f.default.cornerstone.pixelToCanvas(o,u.handles.start),x=f.default.cornerstone.pixelToCanvas(o,u.handles.end),w=r(y,x),S={color:m};if(p&&(S.lineDash=T),Object(b.drawCircle)(e,o,u.handles.start,w,S,"pixel"),Object(b.drawHandles)(e,i,u.handles,g),!0===u.invalidated&&(u.cachedStats?t.throttledUpdateCachedStats(a,o,u):t.updateCachedStats(a,o,u)),!u.handles.textBox.hasMoved){var E=Object(_.default)(i.viewport,u.handles);Object.assign(u.handles.textBox,E)}var k=M(e,a.color,u.cachedStats,C,O,t.configuration);u.unit=D(C,t.configuration.showHounsfieldUnits),Object(b.drawLinkedTextBox)(e,o,u.handles.textBox,k,u.handles,(function(e){return t=e.start,n=e.end,[{x:(i=(r=Object(I.default)(t,n)).left)+(o=r.width)/2,y:a=r.top},{x:i,y:a+(s=r.height)/2},{x:i+o/2,y:a+s},{x:i+o,y:a+s/2}];var t,n,r,i,a,o,s}),m,l,10,!0)}}}))}}}]),t}(p.default);function D(e,t){return"CT"===e&&!1!==t?"HU":""}function M(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.area,i=n.mean,a=n.stdDev,o=n.min,s=n.max,l=n.meanStdDevSUV,u=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},h=d.showMinMax||!1,f=[],p=[];if(!t){var m=l&&0!==l.mean,g=D(u,d.showHounsfieldUnits),v="Mean: ".concat(Object(S.default)(i.toFixed(2))," ").concat(g),y="Std Dev: ".concat(Object(S.default)(a.toFixed(2))," ").concat(g);if(m){for(var b=" SUV: ",x="".concat(b).concat(Object(S.default)(l.mean.toFixed(2))),w="".concat(b).concat(Object(S.default)(l.stdDev.toFixed(2))),_=Math.floor(e.measureText("".concat(y,"     ")).width);e.measureText(v).width<_;)v+=" ";p.push("".concat(v).concat(x)),p.push("".concat(y,"     ").concat(w))}else p.push("".concat(v,"     ").concat(y));if(h){for(var E="Min: ".concat(o," ").concat(g),T="Max: ".concat(s," ").concat(g),k=m?Math.floor(e.measureText("".concat(y,"     ")).width):Math.floor(e.measureText("".concat(v,"     ")).width);e.measureText(E).width<k;)E+=" ";p.push("".concat(E).concat(T))}}return f.push(N(r,c)),p.forEach((function(e){return f.push(e)})),f}function N(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(Object(S.default)(e.toFixed(2))).concat(n)}},"./tools/annotation/CobbAngleTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return D}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseAnnotationTool.js"),m=n("./stateManagement/textStyle.js"),g=n("./stateManagement/toolState.js"),v=n("./stateManagement/toolStyle.js"),y=n("./stateManagement/toolColors.js"),b=n("./manipulators/index.js"),x=n("./drawing/index.js"),w=n("./drawing/drawHandles.js"),_=n("./drawing/drawLinkedTextBox.js"),S=n("./util/lineSegDistance.js"),E=n("./util/roundToDecimal.js"),T=n("./events.js"),k=n("./tools/cursors/index.js"),C=n("./util/triggerEvent.js"),I=n("./util/throttle.js"),O=n("./util/getPixelSpacing.js"),A=n("./store/index.js"),D=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"CobbAngle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:k.cobbAngleCursor,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(e=l()(this,c()(t).call(this,n,r))).hasIncomplete=!1,e.throttledUpdateCachedStats=Object(I.default)(e.updateCachedStats,110),e}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){return this.hasIncomplete=!0,{visible:!0,active:!0,color:void 0,invalidated:!0,complete:!1,value:"",handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},end2:{x:e.currentPoints.image.x+1,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&!this.hasIncomplete&&(Object(S.default)(e,t.handles.start,t.handles.end,n)<25||Object(S.default)(e,t.handles.start2,t.handles.end2,n)<25)}},{key:"updateCachedStats",value:function(e,t,n){var r=Object(O.default)(e),i=r.rowPixelSpacing,a=r.colPixelSpacing,o=(Math.ceil(n.handles.start.x)-Math.ceil(n.handles.end.x))*(a||1),s=(Math.ceil(n.handles.start.y)-Math.ceil(n.handles.end.y))*(i||1),l=(Math.ceil(n.handles.start2.x)-Math.ceil(n.handles.end2.x))*(a||1),u=(Math.ceil(n.handles.start2.y)-Math.ceil(n.handles.end2.y))*(i||1),c=Math.acos(Math.abs((o*l+s*u)/(Math.sqrt(o*o+s*s)*Math.sqrt(l*l+u*u))));c*=180/Math.PI,n.rAngle=Object(E.default)(c,2),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=this.configuration,i=r.handleRadius,a=r.drawHandlesOnHover,o=r.hideHandlesIfMoving,s=r.renderDashed,l=Object(g.getToolState)(e.currentTarget,this.name);if(l)for(var u=Object(x.getNewContext)(n.canvasContext.canvas),c=v.default.getToolWidth(),d=Object(A.getModule)("globalConfiguration").configuration.lineDash,h=m.default.getFont(),f=function(e){var r=l.data[e];if(!1===r.visible)return"continue";Object(x.draw)(u,(function(e){Object(x.setShadow)(e,t.configuration);var l=y.default.getColorIfActive(r),u={color:l};s&&(u.lineDash=d),Object(x.drawLine)(e,n.element,r.handles.start,r.handles.end,u),r.complete&&Object(x.drawLine)(e,n.element,r.handles.start2,r.handles.end2,u);var f={color:l,handleRadius:i,drawHandlesIfActive:a,hideHandlesIfMoving:o};t.configuration.drawHandles&&Object(w.default)(e,n,r.handles,f),e.fillStyle=l;var p=r.value;if(!r.handles.textBox.hasMoved){var m={x:(r.handles.start.x+r.handles.end.x)/2,y:(r.handles.start.y+r.handles.end.y)/2-10};e.font=h,r.handles.textBox.x=m.x,r.handles.textBox.y=m.y}Object(_.default)(e,n.element,r.handles.textBox,p,r.handles,b,l,c,0,!0)}))},p=0;p<l.data.length;p++)f(p);function b(e){return[e.start,e.start2,e.end,e.end2]}}},{key:"getIncomplete",value:function(e){var t=Object(g.getToolState)(e,this.name);if(t&&Array.isArray(t.data))return t.data.find((function(e){return!1===e.complete}))}},{key:"addNewMeasurement",value:function(e,t){var n=this;e.preventDefault(),e.stopPropagation();var r,i,a=e.detail,o=function(e){e||Object(g.removeToolState)(s,n.name,r)},s=e.detail.element,l=this.getIncomplete(s);l?((r=l).complete=!0,r.handles.start2={x:a.currentPoints.image.x,y:a.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!1},r.handles.end2={x:a.currentPoints.image.x,y:a.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!0},i=r.handles.end2,this.hasIncomplete=!1,o=function(e){if(e){var t=T.default.MEASUREMENT_COMPLETED,i={toolName:n.name,toolType:n.name,element:s,measurementData:r};Object(C.default)(s,t,i)}else Object(g.removeToolState)(s,n.name,r)}):(r=this.createNewMeasurement(a),Object(g.addToolState)(s,this.name,r),i=r.handles.end),f.default.cornerstone.updateImage(s),Object(b.moveNewHandle)(a,this.name,r,i,this.options,t,o)}},{key:"onMeasureModified",value:function(e){var t=e.detail.element,n=f.default.cornerstone.getEnabledElement(t).image,r=Object(O.default)(n),i=r.rowPixelSpacing,a=r.colPixelSpacing;if(e.detail.toolName===this.name){var o=e.detail.measurementData;!0===o.invalidated&&(o.rAngle?this.throttledUpdateCachedStats(n,t,o):this.updateCachedStats(n,t,o));var s=o.rAngle;o.value="",Number.isNaN(s)||(o.value=function(e,t,n){var r=t&&n?"":" (isotropic)";return e.toString()+String.fromCharCode(parseInt("00B0",16))+r}(s,i,a))}}},{key:"activeCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(T.default.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"passiveCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(T.default.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"enabledCallback",value:function(e){e.removeEventListener(T.default.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"disabledCallback",value:function(e){e.removeEventListener(T.default.MEASUREMENT_MODIFIED,this.onMeasureModified)}}]),t}(p.default)},"./tools/annotation/EllipticalRoiTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return A}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseAnnotationTool.js"),m=n("./stateManagement/toolState.js"),g=n("./stateManagement/toolStyle.js"),v=n("./stateManagement/toolColors.js"),y=n("./manipulators/getHandleNearImagePoint.js"),b=n("./drawing/index.js"),x=n("./util/calculateSUV.js"),w=n("./util/ellipse/index.js"),_=n("./util/getROITextBoxCoords.js"),S=n("./util/numbersWithCommas.js"),E=n("./util/throttle.js"),T=n("./tools/cursors/index.js"),k=n("./util/logger.js"),C=n("./util/getPixelSpacing.js"),I=n("./store/index.js"),O=Object(k.getLogger)("tools:annotation:EllipticalRoiTool"),A=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"EllipticalRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:T.ellipticalRoiCursor};return(e=l()(this,c()(t).call(this,n,r))).throttledUpdateCachedStats=Object(E.default)(e.updateCachedStats,110),e}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};O.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,r){var i=t&&t.handles&&t.handles.start&&t.handles.end;if(i||O.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!i||!1===t.visible)return!1;if(Object(y.default)(e,t.handles,n,6))return!0;var a="mouse"===r?15:25,o=f.default.cornerstone.pixelToCanvas(e,t.handles.start),s=f.default.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(o.x,s.x)+a/2,top:Math.min(o.y,s.y)+a/2,width:Math.abs(o.x-s.x)-a,height:Math.abs(o.y-s.y)-a},u={left:Math.min(o.x,s.x)-a/2,top:Math.min(o.y,s.y)-a/2,width:Math.abs(o.x-s.x)+a,height:Math.abs(o.y-s.y)+a},c=Object(w.pointInEllipse)(l,n);return!(!Object(w.pointInEllipse)(u,n)||c)}},{key:"updateCachedStats",value:function(e,t,n){var r=(f.default.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,i=Object(C.default)(e),a=function(e,t,n,r,i){var a,o=j(n.start,n.end),s=f.default.cornerstone.getPixels(t,o.left,o.top,o.width,o.height),l=Object(w.calculateEllipseStatistics)(s,o);return"PT"===r&&(a={mean:Object(x.default)(e,l.mean,!0)||0,stdDev:Object(x.default)(e,l.stdDev,!0)||0}),{area:Math.PI*(o.width*(i.colPixelSpacing||1)/2)*(o.height*(i.rowPixelSpacing||1)/2)||0,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:a}}(e,t,n.handles,r,i);n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=Object(m.getToolState)(e.currentTarget,this.name);if(n){var r=e.detail,i=r.image,a=r.element,o=g.default.getToolWidth(),s=Object(I.getModule)("globalConfiguration").configuration.lineDash,l=this.configuration,u=l.handleRadius,c=l.drawHandlesOnHover,d=l.hideHandlesIfMoving,h=l.renderDashed,p=Object(b.getNewContext)(r.canvasContext.canvas),y=Object(C.default)(i),x=y.rowPixelSpacing,w=y.colPixelSpacing,S=(f.default.cornerstone.metaData.get("generalSeriesModule",i.imageId)||{}).modality,E=x&&w;Object(b.draw)(p,(function(e){for(var l=0;l<n.data.length;l++){var f=n.data[l];if(!1!==f.visible){var p=v.default.getColorIfActive(f),m={color:p,handleRadius:u,drawHandlesIfActive:c,hideHandlesIfMoving:d};Object(b.setShadow)(e,t.configuration);var g={color:p};if(h&&(g.lineDash=s),Object(b.drawEllipse)(e,a,f.handles.start,f.handles.end,g,"pixel",f.handles.initialRotation),Object(b.drawHandles)(e,r,f.handles,m),!0===f.invalidated&&(f.cachedStats?t.throttledUpdateCachedStats(i,a,f):t.updateCachedStats(i,a,f)),!f.handles.textBox.hasMoved){var y=Object(_.default)(r.viewport,f.handles);Object.assign(f.handles.textBox,y)}var x=M(e,i.color,f.cachedStats,S,E,t.configuration);f.unit=D(S,t.configuration.showHounsfieldUnits),Object(b.drawLinkedTextBox)(e,a,f.handles.textBox,x,f.handles,(function(e){return[{x:(n=(t=j(e.start,e.end)).left)+(i=t.width)/2,y:r=t.top},{x:n,y:r+(a=t.height)/2},{x:n+i/2,y:r+a},{x:n+i,y:r+a/2}];var t,n,r,i,a}),p,o,10,!0)}}}))}}}]),t}(p.default);function D(e,t){return"CT"===e&&!1!==t?"HU":""}function M(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.area,i=n.mean,a=n.stdDev,o=n.min,s=n.max,l=n.meanStdDevSUV,u=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},h=d.showMinMax||!1,f=[],p=[];if(!t){var m=l&&0!==l.mean,g=D(u,d.showHounsfieldUnits),v="Mean: ".concat(Object(S.default)(i.toFixed(2))," ").concat(g),y="Std Dev: ".concat(Object(S.default)(a.toFixed(2))," ").concat(g);if(m){for(var b=" SUV: ",x="".concat(b).concat(Object(S.default)(l.mean.toFixed(2))),w="".concat(b).concat(Object(S.default)(l.stdDev.toFixed(2))),_=Math.floor(e.measureText("".concat(y,"     ")).width);e.measureText(v).width<_;)v+=" ";p.push("".concat(v).concat(x)),p.push("".concat(y,"     ").concat(w))}else p.push("".concat(v,"     ").concat(y));if(h){for(var E="Min: ".concat(o," ").concat(g),T="Max: ".concat(s," ").concat(g),k=m?Math.floor(e.measureText("".concat(y,"     ")).width):Math.floor(e.measureText("".concat(v,"     ")).width);e.measureText(E).width<k;)E+=" ";p.push("".concat(E).concat(T))}}return f.push(N(r,c)),p.forEach((function(e){return f.push(e)})),f}function N(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(Object(S.default)(e.toFixed(2))).concat(n)}function j(e,t){return{left:Math.round(Math.min(e.x,t.x)),top:Math.round(Math.min(e.y,t.y)),width:Math.round(Math.abs(e.x-t.x)),height:Math.round(Math.abs(e.y-t.y))}}},"./tools/annotation/FreehandRoiTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return U}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./events.js"),g=n("./externalModules.js"),v=n("./tools/base/BaseAnnotationTool.js"),y=n("./stateManagement/toolState.js"),b=n("./stateManagement/toolStyle.js"),x=n("./stateManagement/toolColors.js"),w=n("./store/index.js"),_=n("./util/triggerEvent.js"),S=n("./util/findAndMoveHelpers.js"),E=n("./util/pointInsideBoundingBox.js"),T=n("./util/calculateSUV.js"),k=n("./util/numbersWithCommas.js"),C=n("./drawing/index.js"),I=n("./drawing/drawLinkedTextBox.js"),O=n("./drawing/drawHandles.js"),A=n("./util/clip.js"),D=n("./store/setToolCursor.js"),M=n("./tools/cursors/index.js"),N=n("./util/freehand/index.js"),j=n("./util/logger.js"),R=n("./util/throttle.js"),P=Object(j.getLogger)("tools:annotation:FreehandRoiTool"),F=N.default.insertOrDelete,L=N.default.freehandArea,$=N.default.calculateFreehandStatistics,B=N.default.freehandIntersect,z=N.default.FreehandHandleData,U=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"FreehandRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},spacing:1,activeHandleRadius:3,completeHandleRadius:6,completeHandleRadiusTouch:28,alwaysShowHandles:!1,invalidColor:"crimson",currentHandle:0,currentTool:-1,drawHandles:!0,renderDashed:!1},svgCursor:M.freehandRoiCursor};return(e=l()(this,c()(t).call(this,n,r))).isMultiPartTool=!0,e._drawing=!1,e._dragging=!1,e._modifying=!1,e._drawingMouseDownCallback=e._drawingMouseDownCallback.bind(h()(e)),e._drawingMouseMoveCallback=e._drawingMouseMoveCallback.bind(h()(e)),e._drawingMouseDragCallback=e._drawingMouseDragCallback.bind(h()(e)),e._drawingMouseUpCallback=e._drawingMouseUpCallback.bind(h()(e)),e._drawingMouseDoubleClickCallback=e._drawingMouseDoubleClickCallback.bind(h()(e)),e._editMouseUpCallback=e._editMouseUpCallback.bind(h()(e)),e._editMouseDragCallback=e._editMouseDragCallback.bind(h()(e)),e._drawingTouchStartCallback=e._drawingTouchStartCallback.bind(h()(e)),e._drawingTouchDragCallback=e._drawingTouchDragCallback.bind(h()(e)),e._drawingDoubleTapClickCallback=e._drawingDoubleTapClickCallback.bind(h()(e)),e._editTouchDragCallback=e._editTouchDragCallback.bind(h()(e)),e.throttledUpdateCachedStats=Object(R.default)(e.updateCachedStats,110),e}return p()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t={visible:!0,active:!0,invalidated:!0,color:void 0,handles:{points:[]}};return t.handles.textBox={active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0},t}P.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var r=t&&t.handles&&t.handles.points;if(!r)throw new Error("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool"));return!(!r||!1===t.visible)&&void 0!==this._pointNearHandle(e,t,n)}},{key:"distanceFromPoint",value:function(e,t,n){for(var r=1/0,i=0;i<t.handles.points.length;i++){var a=g.default.cornerstoneMath.point.distance(t.handles.points[i],n);r=Math.min(r,a)}return r===1/0?-1:r}},{key:"distanceFromPointCanvas",value:function(e,t,n){var r=1/0;if(!t)return-1;for(var i=g.default.cornerstone.pixelToCanvas(e,n),a=t.handles.points,o=0;o<a.length;o++){var s=g.default.cornerstone.pixelToCanvas(e,a[o]),l=g.default.cornerstoneMath.point.distance(s,i);r=Math.min(r,l)}return r===1/0?-1:r}},{key:"updateCachedStats",value:function(e,t,n){for(var r,i,a=g.default.cornerstone.metaData.get("generalSeriesModule",e.imageId),o=a?a.modality:null,s=n.handles.points,l={left:s[0].x,right:s[0].x,bottom:s[0].y,top:s[0].x},u=0;u<s.length;u++)l.left=Math.min(l.left,s[u].x),l.right=Math.max(l.right,s[u].x),l.bottom=Math.min(l.bottom,s[u].y),l.top=Math.max(l.top,s[u].y);var c={left:l.left,top:l.bottom,width:Math.abs(l.right-l.left),height:Math.abs(l.top-l.bottom)};if(n.polyBoundingBox=c,!e.color){var d=g.default.cornerstone.getPixels(t,c.left,c.top,c.width,c.height);r=$.call(this,d,c,n.handles.points),"PT"===o&&(i={mean:Object(T.default)(e,(r.mean-e.intercept)/e.slope),stdDev:Object(T.default)(e,(r.stdDev-e.intercept)/e.slope)}),r&&!isNaN(r.mean)&&(n.meanStdDev=r,n.meanStdDevSUV=i)}var h=L(n.handles.points,(e.columnPixelSpacing||1)*(e.rowPixelSpacing||1));isNaN(h)||(n.area=h),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=Object(y.getToolState)(e.currentTarget,this.name);if(r)for(var i=n.image,a=n.element,o=this.configuration,s=g.default.cornerstone.metaData.get("generalSeriesModule",i.imageId),l=s?s.modality:null,u=Object(C.getNewContext)(n.canvasContext.canvas),c=b.default.getToolWidth(),d=o.renderDashed,h=Object(w.getModule)("globalConfiguration").configuration.lineDash,f=function(e){var s=r.data[e];if(!1===s.visible)return"continue";Object(C.draw)(u,(function(e){var r,l=x.default.getColorIfActive(s);s.active?s.handles.invalidHandlePlacement?(l=o.invalidColor,r=o.invalidColor):(l=x.default.getColorIfActive(s),r=x.default.getFillColor()):r=x.default.getToolColor();var u={color:l};if(d&&(u.lineDash=h),s.handles.points.length){var f=s.handles.points;Object(C.drawJoinedLines)(e,a,f[0],f,u),s.polyBoundingBox?Object(C.drawJoinedLines)(e,a,f[f.length-1],[f[0]],u):Object(C.drawJoinedLines)(e,a,f[f.length-1],[o.mouseLocation.handles.start],u)}if(u={color:l,fill:r},(o.alwaysShowHandles||s.active&&s.polyBoundingBox)&&(u.handleRadius=o.activeHandleRadius,t.configuration.drawHandles&&Object(O.default)(e,n,s.handles.points,u)),s.canComplete){u.handleRadius=o.completeHandleRadius;var p=s.handles.points[0];t.configuration.drawHandles&&Object(O.default)(e,n,[p],u)}if(s.active&&!s.polyBoundingBox){u.handleRadius=o.activeHandleRadius,t.configuration.drawHandles&&Object(O.default)(e,n,o.mouseLocation.handles,u);var g=s.handles.points[0];t.configuration.drawHandles&&Object(O.default)(e,n,[g],u)}if(!0!==s.invalidated||s.active||(s.meanStdDev&&s.meanStdDevSUV&&s.area?t.throttledUpdateCachedStats(i,a,s):t.updateCachedStats(i,a,s)),s.polyBoundingBox&&!s.handles.textBox.freehand){s.handles.textBox.hasMoved||(s.handles.textBox.x=s.polyBoundingBox.left+s.polyBoundingBox.width,s.handles.textBox.y=s.polyBoundingBox.top+s.polyBoundingBox.height/2);var y=m.call(t,s);Object(I.default)(e,a,s.handles.textBox,y,s.handles.points,v,l,c,0,!0)}}))},p=0;p<r.data.length;p++)f(p);function m(e){var t=e.meanStdDev,n=e.meanStdDevSUV,r=e.area,a=[];if(t&&void 0!==t.mean){var o="";"CT"===l&&(o="HU"),e.unit=o;var s="Mean: ".concat(Object(k.default)(t.mean.toFixed(2))," ").concat(o),u="StdDev: ".concat(Object(k.default)(t.stdDev.toFixed(2))," ").concat(o);if(n&&void 0!==n.mean){var c=" SUV: ";s+=c+Object(k.default)(n.mean.toFixed(2)),u+=c+Object(k.default)(n.stdDev.toFixed(2))}a.push(s),a.push(u)}if(r){var d=" mm".concat(String.fromCharCode(178));i.rowPixelSpacing&&i.columnPixelSpacing||(d=" pixels".concat(String.fromCharCode(178)));var h="Area: ".concat(Object(k.default)(r.toFixed(2))).concat(d);a.push(h)}return a}function v(e){return e}}},{key:"addNewMeasurement",value:function(e){var t=e.detail;this._startDrawing(e),this._addPoint(t),H(e)}},{key:"preMouseDownCallback",value:function(e){var t=e.detail,n=this._pointNearHandleAllTools(t);return!!t.event.ctrlKey&&(void 0!==n&&n.handleNearby.hasBoundingBox||F.call(this,e,n),H(e),!0)}},{key:"handleSelectedCallback",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",i=e.detail.element,a=Object(y.getToolState)(i,this.name);if(n.hasBoundingBox)Object(S.moveHandleNearImagePoint)(e,this,t,n,r);else{var o=this.configuration;o.dragOrigin={x:n.x,y:n.y};for(var s=0;s<a.data.length;s++)for(var l=a.data[s].handles.points,u=0;u<l.length;u++)l[u]===n&&(o.currentHandle=u,o.currentTool=s);this._modifying=!0,this._activateModify(i),H(e)}}},{key:"_drawingMouseMoveCallback",value:function(e){var t=e.detail,n=t.currentPoints,r=t.element,i=Object(y.getToolState)(r,this.name),a=this.configuration,o=i.data[a.currentTool],s=n.canvas;this._getMouseLocation(t),this._checkInvalidHandleLocation(o,t);var l=this._pointNearHandle(r,o,s),u=o.handles.points;void 0!==l&&!l.hasBoundingBox&&l<u.length-1&&(a.mouseLocation.handles.start.x=u[l].x,a.mouseLocation.handles.start.y=u[l].y),g.default.cornerstone.updateImage(r)}},{key:"_drawingMouseDragCallback",value:function(e){this.options.mouseButtonMask.includes(e.detail.buttons)&&this._drawingDrag(e)}},{key:"_drawingTouchDragCallback",value:function(e){this._drawingDrag(e)}},{key:"_drawingDrag",value:function(e){var t=e.detail,n=t.element,r=Object(y.getToolState)(n,this.name).data[this.configuration.currentTool];this._getMouseLocation(t),this._checkInvalidHandleLocation(r,t),this._addPointPencilMode(t,r.handles.points),this._dragging=!0,g.default.cornerstone.updateImage(n)}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail.element;if(this._dragging){this._dragging=!1;var n=this.configuration,r=n.currentTool,i=Object(y.getToolState)(t,this.name).data[r];!B.end(i.handles.points)&&i.canComplete&&this._endDrawing(t,n.currentHandle),H(e)}}},{key:"_drawingMouseDownCallback",value:function(e){var t=e.detail,n=t.currentPoints,r=t.element;if(this.options.mouseButtonMask.includes(t.buttons)){var i=n.canvas,a=this.configuration,o=a.currentTool,s=Object(y.getToolState)(r,this.name).data[o],l=this._pointNearHandle(r,s,i);!B.end(s.handles.points)&&s.canComplete?this._endDrawing(r,a.currentHandle):void 0===l&&this._addPoint(t),H(e)}}},{key:"_drawingTouchStartCallback",value:function(e){var t=e.detail,n=t.element,r=t.currentPoints.canvas,i=this.configuration,a=i.currentTool,o=Object(y.getToolState)(n,this.name).data[a],s=this._pointNearHandle(n,o,r);!B.end(o.handles.points)&&o.canComplete?this._endDrawing(n,i.currentHandle):void 0===s&&this._addPoint(t),H(e)}},{key:"completeDrawing",value:function(e){if(this._drawing){var t=Object(y.getToolState)(e,this.name),n=this.configuration,r=t.data[n.currentTool];if(!B.end(r.handles.points)&&r.handles.points.length>=2){var i=n.currentHandle;r.polyBoundingBox={},this._endDrawing(e,i)}}}},{key:"_drawingMouseDoubleClickCallback",value:function(e){this.completeDrawing(e.detail.element),H(e)}},{key:"_drawingDoubleTapClickCallback",value:function(e){this.completeDrawing(e.detail.element),H(e)}},{key:"_editMouseDragCallback",value:function(e){var t=e.detail,n=t.element;if(this.options.mouseButtonMask.includes(t.buttons)){var r,i=Object(y.getToolState)(n,this.name),a=this.configuration,o=i.data[a.currentTool],s=a.currentHandle,l=o.handles.points;if(this._getMouseLocation(t),o.handles.invalidHandlePlacement=B.modify(l,s),o.active=!0,o.highlight=!0,l[s].x=a.mouseLocation.handles.start.x,l[s].y=a.mouseLocation.handles.start.y,r=this._getPrevHandleIndex(s,l),s>=0){var u=l[r].lines[l[r].lines.length-1];u.x=a.mouseLocation.handles.start.x,u.y=a.mouseLocation.handles.start.y}g.default.cornerstone.updateImage(n)}}},{key:"_editTouchDragCallback",value:function(e){var t,n=e.detail,r=n.element,i=Object(y.getToolState)(r,this.name),a=this.configuration,o=i.data[a.currentTool],s=a.currentHandle,l=o.handles.points;if(this._getMouseLocation(n),o.handles.invalidHandlePlacement=B.modify(l,s),o.active=!0,o.highlight=!0,l[s].x=a.mouseLocation.handles.start.x,l[s].y=a.mouseLocation.handles.start.y,t=this._getPrevHandleIndex(s,l),s>=0){var u=l[t].lines[l[t].lines.length-1];u.x=a.mouseLocation.handles.start.x,u.y=a.mouseLocation.handles.start.y}g.default.cornerstone.updateImage(r)}},{key:"_getPrevHandleIndex",value:function(e,t){return 0===e?t.length-1:e-1}},{key:"_editMouseUpCallback",value:function(e){var t=e.detail,n=t.element,r=Object(y.getToolState)(n,this.name);this._deactivateModify(n),this._dropHandle(t,r),this._endDrawing(n),g.default.cornerstone.updateImage(n)}},{key:"_dropHandle",value:function(e,t){var n=this.configuration,r=t.data[n.currentTool].handles,i=r.points;if(r.invalidHandlePlacement){var a,o=n.currentHandle,s=i[o];a=0===o?i[i.length-1]:i[o-1],s.x=n.dragOrigin.x,s.y=n.dragOrigin.y,a.lines[0]=s,r.invalidHandlePlacement=!1}}},{key:"_startDrawing",value:function(e){var t,n=e.detail,r=this.createNewMeasurement(n),i=n.element,a=this.configuration;e.type===m.default.MOUSE_DOWN_ACTIVATE?t="Mouse":e.type===m.default.TOUCH_START_ACTIVE&&(t="Touch"),this._activateDraw(i,t),this._getMouseLocation(n),Object(y.addToolState)(i,this.name,r);var o=Object(y.getToolState)(i,this.name);a.currentTool=o.data.length-1,this._activeDrawingToolReference=o.data[a.currentTool]}},{key:"_addPoint",value:function(e){var t=e.currentPoints,n=e.element,r=Object(y.getToolState)(n,this.name),i=this.configuration,a=r.data[i.currentTool];if(!a.handles.invalidHandlePlacement){var o=new z(t.image);a.handles.points.length&&a.handles.points[i.currentHandle-1].lines.push(t.image),a.handles.points.push(o),i.currentHandle+=1,g.default.cornerstone.updateImage(n),this.fireModifiedEvent(n,a)}}},{key:"_addPointPencilMode",value:function(e,t){var n=this,r=e.element,i=this.configuration.mouseLocation.handles.start;t.every((function(e){return n._isDistanceLargerThanSpacing(r,e,i)}))&&this._addPoint(e)}},{key:"_endDrawing",value:function(e,t){var n=Object(y.getToolState)(e,this.name),r=this.configuration,i=n.data[r.currentTool];if(i.active=!1,i.highlight=!1,i.handles.invalidHandlePlacement=!1,void 0!==t){var a=i.handles.points;a[r.currentHandle-1].lines.push(a[0])}this._modifying&&(this._modifying=!1,i.invalidated=!0),r.currentHandle=0,r.currentTool=-1,i.canComplete=!1,this._drawing&&this._deactivateDraw(e),g.default.cornerstone.updateImage(e),this.fireModifiedEvent(e,i),this.fireCompletedEvent(e,i)}},{key:"_pointNearHandle",value:function(e,t,n){if(void 0!==t.handles&&void 0!==t.handles.points&&!1!==t.visible){for(var r=0;r<t.handles.points.length;r++){var i=g.default.cornerstone.pixelToCanvas(e,t.handles.points[r]);if(g.default.cornerstoneMath.point.distance(i,n)<6)return r}return t.handles.textBox&&Object(E.default)(t.handles.textBox,n)?t.handles.textBox:void 0}}},{key:"_pointNearHandleAllTools",value:function(e){var t=e.element,n=e.currentPoints.canvas,r=Object(y.getToolState)(t,this.name);if(r)for(var i,a=0;a<r.data.length;a++)if(void 0!==(i=this._pointNearHandle(t,r.data[a],n)))return{handleNearby:i,toolIndex:a}}},{key:"_getMouseLocation",value:function(e){var t=e.currentPoints,n=e.image,r=this.configuration;r.mouseLocation.handles.start.x=t.image.x,r.mouseLocation.handles.start.y=t.image.y,Object(A.clipToBox)(r.mouseLocation.handles.start,n)}},{key:"_checkInvalidHandleLocation",value:function(e,t){if(e.handles.points.length<2)return!0;var n;n=this._dragging?this._checkHandlesPencilMode(e,t):this._checkHandlesPolygonMode(e,t),e.handles.invalidHandlePlacement=n}},{key:"_checkHandlesPolygonMode",value:function(e,t){var n=t.element,r=this.configuration.mouseLocation.handles.start,i=e.handles.points,a=!1;return e.canComplete=!1,this._isDistanceSmallerThanCompleteSpacingCanvas(n,i[0],r)&&!B.end(i)&&i.length>2?(e.canComplete=!0,a=!1):a=B.newHandle(r,i),a}},{key:"_checkHandlesPencilMode",value:function(e,t){var n=B.newHandle(this.configuration.mouseLocation.handles.start,e.handles.points);return!1===n&&(n=this._invalidHandlePencilMode(e,t)),n}},{key:"_invalidHandlePencilMode",value:function(e,t){var n=t.element,r=this.configuration.mouseLocation.handles.start,i=e.handles.points;if(this._isDistanceSmallerThanCompleteSpacingCanvas(n,i[0],r))return e.canComplete=!0,!1;e.canComplete=!1;for(var a=1;a<i.length-1;a++)if(this._isDistanceSmallerThanSpacing(n,i[a],r))return!0;return!1}},{key:"_isDistanceSmallerThanCompleteSpacingCanvas",value:function(e,t,n){var r,i=g.default.cornerstone.pixelToCanvas(e,t),a=g.default.cornerstone.pixelToCanvas(e,n);return"Mouse"===this._drawingInteractionType?r=this.configuration.completeHandleRadius:"Touch"===this._drawingInteractionType&&(r=this.configuration.completeHandleRadiusTouch),this._compareDistanceToSpacing(e,i,a,"<",r)}},{key:"_isDistanceSmallerThanSpacing",value:function(e,t,n){return this._compareDistanceToSpacing(e,t,n,"<")}},{key:"_isDistanceLargerThanSpacing",value:function(e,t,n){return this._compareDistanceToSpacing(e,t,n,">")}},{key:"_compareDistanceToSpacing",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:">",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.configuration.spacing;return">"===r?g.default.cornerstoneMath.point.distance(t,n)>i:g.default.cornerstoneMath.point.distance(t,n)<i}},{key:"_activateDraw",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Mouse";this._drawing=!0,this._drawingInteractionType=t,w.state.isMultiPartToolActive=!0,Object(D.hideToolCursor)(this.element),e.addEventListener(m.default.MOUSE_DOWN,this._drawingMouseDownCallback),e.addEventListener(m.default.MOUSE_MOVE,this._drawingMouseMoveCallback),e.addEventListener(m.default.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),e.addEventListener(m.default.MOUSE_DRAG,this._drawingMouseDragCallback),e.addEventListener(m.default.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(m.default.TOUCH_START,this._drawingMouseMoveCallback),e.addEventListener(m.default.TOUCH_START,this._drawingTouchStartCallback),e.addEventListener(m.default.TOUCH_DRAG,this._drawingTouchDragCallback),e.addEventListener(m.default.TOUCH_END,this._drawingMouseUpCallback),e.addEventListener(m.default.DOUBLE_TAP,this._drawingDoubleTapClickCallback),g.default.cornerstone.updateImage(e)}},{key:"_deactivateDraw",value:function(e){this._drawing=!1,w.state.isMultiPartToolActive=!1,this._activeDrawingToolReference=null,this._drawingInteractionType=null,Object(D.setToolCursor)(this.element,this.svgCursor),e.removeEventListener(m.default.MOUSE_DOWN,this._drawingMouseDownCallback),e.removeEventListener(m.default.MOUSE_MOVE,this._drawingMouseMoveCallback),e.removeEventListener(m.default.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),e.removeEventListener(m.default.MOUSE_DRAG,this._drawingMouseDragCallback),e.removeEventListener(m.default.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(m.default.TOUCH_START,this._drawingTouchStartCallback),e.removeEventListener(m.default.TOUCH_DRAG,this._drawingTouchDragCallback),e.removeEventListener(m.default.TOUCH_START,this._drawingMouseMoveCallback),e.removeEventListener(m.default.TOUCH_END,this._drawingMouseUpCallback),g.default.cornerstone.updateImage(e)}},{key:"_activateModify",value:function(e){w.state.isToolLocked=!0,e.addEventListener(m.default.MOUSE_UP,this._editMouseUpCallback),e.addEventListener(m.default.MOUSE_DRAG,this._editMouseDragCallback),e.addEventListener(m.default.MOUSE_CLICK,this._editMouseUpCallback),e.addEventListener(m.default.TOUCH_END,this._editMouseUpCallback),e.addEventListener(m.default.TOUCH_DRAG,this._editTouchDragCallback),g.default.cornerstone.updateImage(e)}},{key:"_deactivateModify",value:function(e){w.state.isToolLocked=!1,e.removeEventListener(m.default.MOUSE_UP,this._editMouseUpCallback),e.removeEventListener(m.default.MOUSE_DRAG,this._editMouseDragCallback),e.removeEventListener(m.default.MOUSE_CLICK,this._editMouseUpCallback),e.removeEventListener(m.default.TOUCH_END,this._editMouseUpCallback),e.removeEventListener(m.default.TOUCH_DRAG,this._editTouchDragCallback),g.default.cornerstone.updateImage(e)}},{key:"passiveCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"enabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"disabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"_closeToolIfDrawing",value:function(e){this._drawing&&(this._endDrawing(e,this.configuration.currentHandle),g.default.cornerstone.updateImage(e))}},{key:"fireModifiedEvent",value:function(e,t){var n=m.default.MEASUREMENT_MODIFIED,r={toolName:this.name,toolType:this.name,element:e,measurementData:t};Object(_.default)(e,n,r)}},{key:"fireCompletedEvent",value:function(e,t){var n=m.default.MEASUREMENT_COMPLETED,r={toolName:this.name,toolType:this.name,element:e,measurementData:t};Object(_.default)(e,n,r)}},{key:"cancelDrawing",value:function(e){if(this._drawing){var t=Object(y.getToolState)(e,this.name),n=this.configuration,r=t.data[n.currentTool];r.active=!1,r.highlight=!1,r.handles.invalidHandlePlacement=!1,n.currentHandle=0,n.currentTool=-1,r.canComplete=!1,Object(y.removeToolState)(e,this.name,r),this._deactivateDraw(e),g.default.cornerstone.updateImage(e)}}},{key:"newImageCallback",value:function(e){var t=this.configuration;if(this._drawing&&this._activeDrawingToolReference){var n=e.detail.element,r=this._activeDrawingToolReference;r.active=!1,r.highlight=!1,r.handles.invalidHandlePlacement=!1;var i=r.handles.points;i[t.currentHandle-1].lines.push(i[0]),t.currentHandle=0,t.currentTool=-1,r.canComplete=!1,this._deactivateDraw(n),g.default.cornerstone.updateImage(n)}}},{key:"spacing",get:function(){return this.configuration.spacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand spacing to a value other than a number.");this.configuration.spacing=e,g.default.cornerstone.updateImage(this.element)}},{key:"activeHandleRadius",get:function(){return this.configuration.activeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand activeHandleRadius to a value other than a number.");this.configuration.activeHandleRadius=e,g.default.cornerstone.updateImage(this.element)}},{key:"completeHandleRadius",get:function(){return this.configuration.completeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand completeHandleRadius to a value other than a number.");this.configuration.completeHandleRadius=e,g.default.cornerstone.updateImage(this.element)}},{key:"alwaysShowHandles",get:function(){return this.configuration.alwaysShowHandles},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehand alwaysShowHandles to a value other than a boolean.");this.configuration.alwaysShowHandles=e,g.default.cornerstone.updateImage(this.element)}},{key:"invalidColor",get:function(){return this.configuration.invalidColor},set:function(e){this.configuration.invalidColor=e,g.default.cornerstone.updateImage(this.element)}}]),t}(v.default);function H(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}},"./tools/annotation/LengthTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return C}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./tools/base/BaseAnnotationTool.js"),p=n("./stateManagement/toolState.js"),m=n("./stateManagement/toolStyle.js"),g=n("./stateManagement/toolColors.js"),v=n("./drawing/index.js"),y=n("./drawing/drawLinkedTextBox.js"),b=n("./drawing/drawHandles.js"),x=n("./util/lineSegDistance.js"),w=n("./tools/cursors/index.js"),_=n("./util/logger.js"),S=n("./util/getPixelSpacing.js"),E=n("./util/throttle.js"),T=n("./store/index.js"),k=Object(_.getLogger)("tools:annotation:LengthTool"),C=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Length",supportedInteractionTypes:["Mouse","Touch"],svgCursor:w.lengthCursor,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(e=l()(this,c()(t).call(this,n,r))).throttledUpdateCachedStats=Object(E.default)(e.updateCachedStats,110),e}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t=e.currentPoints.image,n=t.x,r=t.y;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:n,y:r,highlight:!0,active:!1},end:{x:n,y:r,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}k.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){return t&&t.handles&&t.handles.start&&t.handles.end?!1!==t.visible&&Object(x.default)(e,t.handles.start,t.handles.end,n)<25:(k.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!1)}},{key:"updateCachedStats",value:function(e,t,n){var r=Object(S.default)(e),i=(n.handles.end.x-n.handles.start.x)*(r.colPixelSpacing||1),a=(n.handles.end.y-n.handles.start.y)*(r.rowPixelSpacing||1),o=Math.sqrt(i*i+a*a);n.length=o,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=this.configuration,i=r.handleRadius,a=r.drawHandlesOnHover,o=r.hideHandlesIfMoving,s=r.renderDashed,l=Object(p.getToolState)(e.currentTarget,this.name);if(l)for(var u=Object(v.getNewContext)(n.canvasContext.canvas),c=n.image,d=n.element,h=Object(S.default)(c),f=h.rowPixelSpacing,x=h.colPixelSpacing,w=m.default.getToolWidth(),_=Object(T.getModule)("globalConfiguration").configuration.lineDash,E=function(e){var r=l.data[e];if(!1===r.visible)return"continue";Object(v.draw)(u,(function(e){Object(v.setShadow)(e,t.configuration);var l=g.default.getColorIfActive(r),u={color:l};s&&(u.lineDash=_),Object(v.drawLine)(e,d,r.handles.start,r.handles.end,u);var h={color:l,handleRadius:i,drawHandlesIfActive:a,hideHandlesIfMoving:o};if(t.configuration.drawHandles&&Object(b.default)(e,n,r.handles,h),!r.handles.textBox.hasMoved){var p={x:Math.max(r.handles.start.x,r.handles.end.x)};p.y=p.x===r.handles.start.x?r.handles.start.y:r.handles.end.y,r.handles.textBox.x=p.x,r.handles.textBox.y=p.y}!0===r.invalidated&&(r.length?t.throttledUpdateCachedStats(c,d,r):t.updateCachedStats(c,d,r));var m=function(e,t,n){var r,i=(r=Number(e.length),isNaN(r)?void 0:r);if(!i)return"";var a="mm";return t&&n||(a="pixels"),e.unit=a,"".concat(i.toFixed(2)," ").concat(a)}(r,f,x);Object(y.default)(e,d,r.handles.textBox,m,r.handles,C,l,w,10,!0)}))},k=0;k<l.data.length;k++)E(k);function C(e){return[e.start,{x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2},e.end]}}}]),t}(f.default)},"./tools/annotation/ProbeTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return I}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseAnnotationTool.js"),m=n("./stateManagement/toolState.js"),g=n("./stateManagement/textStyle.js"),v=n("./stateManagement/toolColors.js"),y=n("./drawing/index.js"),b=n("./drawing/drawTextBox.js"),x=n("./drawing/drawHandles.js"),w=n("./util/getRGBPixels.js"),_=n("./util/calculateSUV.js"),S=n("./tools/cursors/index.js"),E=n("./util/logger.js"),T=n("./util/throttle.js"),k=n("./store/index.js"),C=Object(E.getLogger)("tools:annotation:ProbeTool"),I=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Probe",supportedInteractionTypes:["Mouse","Touch"],svgCursor:S.probeCursor,configuration:{drawHandles:!0,renderDashed:!1}};return(e=l()(this,c()(t).call(this,n,r))).throttledUpdateCachedStats=Object(T.default)(e.updateCachedStats,110),e}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};C.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var r=t&&t.handles&&t.handles.end;if(r||C.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!r||!1===t.visible)return!1;var i=f.default.cornerstone.pixelToCanvas(e,t.handles.end);return f.default.cornerstoneMath.point.distance(i,n)<5}},{key:"updateCachedStats",value:function(e,t,n){var r=Math.round(n.handles.end.x),i=Math.round(n.handles.end.y),a={};r>=0&&i>=0&&r<e.columns&&i<e.rows&&(a.x=r,a.y=i,e.color?a.storedPixels=Object(w.default)(t,r,i,1,1):(a.storedPixels=f.default.cornerstone.getStoredPixels(t,r,i,1,1),a.sp=a.storedPixels[0],a.mo=a.sp*e.slope+e.intercept,a.suv=Object(_.default)(e,a.sp))),n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=this.configuration,i=r.handleRadius,a=r.renderDashed,o=Object(m.getToolState)(e.currentTarget,this.name);if(o)for(var s=Object(y.getNewContext)(n.canvasContext.canvas),l=n.image,u=n.element,c=g.default.getFontSize(),d=Object(k.getModule)("globalConfiguration").configuration.lineDash,h=function(e){var r=o.data[e];if(!1===r.visible)return"continue";Object(y.draw)(s,(function(e){var o,s,h=v.default.getColorIfActive(r);if(t.configuration.drawHandles){var p={handleRadius:i,color:h};a&&(p.lineDash=d),Object(x.default)(e,n,r.handles,p)}!0===r.invalidated&&(r.cachedStats?t.throttledUpdateCachedStats(l,u,r):t.updateCachedStats(l,u,r));var m=r.cachedStats,g=m.x,y=m.y,w=m.storedPixels,_=m.sp,S=m.mo,E=m.suv;if(g>=0&&y>=0&&g<l.columns&&y<l.rows){o="".concat(g,", ").concat(y),l.color?s="R: ".concat(w[0]," G: ").concat(w[1]," B: ").concat(w[2]):(s="SP: ".concat(_," MO: ").concat(parseFloat(S.toFixed(3))),E&&(s+=" SUV: ".concat(parseFloat(E.toFixed(3)))));var T=f.default.cornerstone.pixelToCanvas(n.element,{x:r.handles.end.x+3,y:r.handles.end.y-3});Object(b.default)(e,s,T.x,T.y+c+5,h),Object(b.default)(e,o,T.x,T.y,h)}}))},p=0;p<o.data.length;p++)h(p)}}]),t}(p.default)},"./tools/annotation/RectangleRoiTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return I}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./externalModules.js"),p=n("./tools/base/BaseAnnotationTool.js"),m=n("./stateManagement/toolState.js"),g=n("./stateManagement/toolStyle.js"),v=n("./stateManagement/toolColors.js"),y=n("./drawing/index.js"),b=n("./util/calculateSUV.js"),x=n("./util/getROITextBoxCoords.js"),w=n("./util/numbersWithCommas.js"),_=n("./util/throttle.js"),S=n("./tools/cursors/index.js"),E=n("./util/logger.js"),T=n("./util/getPixelSpacing.js"),k=n("./store/index.js"),C=Object(E.getLogger)("tools:annotation:RectangleRoiTool"),I=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"RectangleRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:S.rectangleRoiCursor};return(e=l()(this,c()(t).call(this,n,r))).throttledUpdateCachedStats=Object(_.default)(e.updateCachedStats,110),e}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};C.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,r){var i=t&&t.handles&&t.handles.start&&t.handles.end;if(i||C.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!i||!1===t.visible)return!1;var a="mouse"===r?15:25,o=f.default.cornerstone.pixelToCanvas(e,t.handles.start),s=f.default.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(o.x,s.x),top:Math.min(o.y,s.y),width:Math.abs(o.x-s.x),height:Math.abs(o.y-s.y)};return f.default.cornerstoneMath.rect.distanceToPoint(l,n)<a}},{key:"updateCachedStats",value:function(e,t,n){var r=(f.default.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,i=Object(T.default)(e),a=function(e,t,n,r,i){var a,o=O(n.start,n.end),s=function(e,t){for(var n=0,r=0,i=0,a=0,o=e?e[0]:null,s=e?e[0]:null,l=t.top;l<t.top+t.height;l++)for(var u=t.left;u<t.left+t.width;u++)n+=e[a],r+=e[a]*e[a],o=Math.min(o,e[a]),s=Math.max(s,e[a]),i++,a++;if(0===i)return{count:i,mean:0,variance:0,stdDev:0,min:0,max:0};var c=n/i,d=r/i-c*c;return{count:i,mean:c,variance:d,stdDev:Math.sqrt(d),min:o,max:s}}(f.default.cornerstone.getPixels(t,o.left,o.top,o.width,o.height),o);return"PT"===r&&(a={mean:Object(b.default)(e,s.mean,!0)||0,stdDev:Object(b.default)(e,s.stdDev,!0)||0}),{area:o.width*(i.colPixelSpacing||1)*(o.height*(i.rowPixelSpacing||1))||0,count:s.count||0,mean:s.mean||0,variance:s.variance||0,stdDev:s.stdDev||0,min:s.min||0,max:s.max||0,meanStdDevSUV:a}}(e,t,n.handles,r,i);n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=Object(m.getToolState)(e.currentTarget,this.name);if(n){var r=e.detail,i=r.image,a=r.element,o=g.default.getToolWidth(),s=Object(k.getModule)("globalConfiguration").configuration.lineDash,l=this.configuration,u=l.handleRadius,c=l.drawHandlesOnHover,d=l.hideHandlesIfMoving,h=l.renderDashed,p=Object(y.getNewContext)(r.canvasContext.canvas),b=Object(T.default)(i),w=b.rowPixelSpacing,_=b.colPixelSpacing,S=(f.default.cornerstone.metaData.get("generalSeriesModule",i.imageId)||{}).modality,E=w&&_;Object(y.draw)(p,(function(e){for(var l=0;l<n.data.length;l++){var f=n.data[l];if(!1!==f.visible){var p=v.default.getColorIfActive(f),m={color:p,handleRadius:u,drawHandlesIfActive:c,hideHandlesIfMoving:d};Object(y.setShadow)(e,t.configuration);var g={color:p};if(h&&(g.lineDash=s),Object(y.drawRect)(e,a,f.handles.start,f.handles.end,g,"pixel",f.handles.initialRotation),t.configuration.drawHandles&&Object(y.drawHandles)(e,r,f.handles,m),!0===f.invalidated&&(f.cachedStats?t.throttledUpdateCachedStats(i,a,f):t.updateCachedStats(i,a,f)),!f.handles.textBox.hasMoved){var b=Object(x.default)(r.viewport,f.handles);Object.assign(f.handles.textBox,b)}var w=M(e,i.color,f.cachedStats,S,E,t.configuration);f.unit=D(S,t.configuration.showHounsfieldUnits),Object(y.drawLinkedTextBox)(e,a,f.handles.textBox,w,f.handles,(function(e){return[{x:(n=(t=O(e.start,e.end)).left)+(i=t.width)/2,y:r=t.top},{x:n,y:r+(a=t.height)/2},{x:n+i/2,y:r+a},{x:n+i,y:r+a/2}];var t,n,r,i,a}),p,o,10,!0)}}}))}}}]),t}(p.default);function O(e,t){return{left:Math.min(e.x,t.x),top:Math.min(e.y,t.y),width:Math.abs(e.x-t.x),height:Math.abs(e.y-t.y)}}function A(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(Object(w.default)(e.toFixed(2))).concat(n)}function D(e,t){return"CT"===e&&!1!==t?"HU":""}function M(e,t,n,r,i){var a=n.area,o=n.mean,s=n.stdDev,l=n.min,u=n.max,c=n.meanStdDevSUV,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},h=d.showMinMax||!1,f=[],p=[];if(!t){var m=c&&0!==c.mean,g=D(r,d.showHounsfieldUnits),v="Mean: ".concat(Object(w.default)(o.toFixed(2))," ").concat(g),y="Std Dev: ".concat(Object(w.default)(s.toFixed(2))," ").concat(g);if(m){for(var b=" SUV: ",x="".concat(b).concat(Object(w.default)(c.mean.toFixed(2))),_="".concat(b).concat(Object(w.default)(c.stdDev.toFixed(2))),S=Math.floor(e.measureText("".concat(y,"     ")).width);e.measureText(v).width<S;)v+=" ";p.push("".concat(v).concat(x)),p.push("".concat(y,"     ").concat(_))}else p.push("".concat(v)),p.push("".concat(y));if(h){for(var E="Min: ".concat(l," ").concat(g),T="Max: ".concat(u," ").concat(g),k=m?Math.floor(e.measureText("".concat(y,"     ")).width):Math.floor(e.measureText("".concat(v,"     ")).width);e.measureText(E).width<k;)E+=" ";p.push("".concat(E).concat(T))}}return f.push(A(a,i)),p.forEach((function(e){return f.push(e)})),f}},"./tools/annotation/TextMarkerTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return S}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./tools/base/BaseAnnotationTool.js"),g=n("./externalModules.js"),v=n("./util/pointInsideBoundingBox.js"),y=n("./stateManagement/toolColors.js"),b=n("./drawing/index.js"),x=n("./drawing/drawTextBox.js"),w=n("./stateManagement/toolState.js"),_=n("./tools/cursors/index.js"),S=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"TextMarker",supportedInteractionTypes:["Mouse","Touch"],configuration:{markers:[],current:"",ascending:!0,loop:!1,changeTextCallback:E},svgCursor:_.textMarkerCursor};return(e=l()(this,c()(t).call(this,n,r))).touchPressCallback=e._changeText.bind(h()(e)),e.doubleClickCallback=e._changeText.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){var t=this.configuration;if(t.current){var n={visible:!0,active:!0,text:t.current,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}};if(g.default.cornerstoneMath.point.insideRect(n.handles.end,{left:0,top:0,width:e.image.width,height:e.image.height})){var r=t.markers.indexOf(t.current);return(r+=t.ascending?1:-1)>=t.markers.length?r=t.loop?0:-1:r<0&&(r=t.loop?t.markers.length:-1),t.current=t.markers[r],n}}}},{key:"pointNearTool",value:function(e,t,n){if(!1===t.visible)return!1;if(t.handles.end.boundingBox){var r=g.default.cornerstoneMath.rect.distanceToPoint(t.handles.end.boundingBox,n),i=Object(v.default)(t.handles.end,n);return r<10||i}}},{key:"updateCachedStats",value:function(){}},{key:"renderToolData",value:function(e){var t=e.detail,n=this.configuration,r=Object(w.getToolState)(t.element,this.name);if(r)for(var i=Object(b.getNewContext)(t.canvasContext.canvas),a=function(e){var a=r.data[e];if(!1===a.visible)return"continue";var o=y.default.getColorIfActive(a);Object(b.draw)(i,(function(e){Object(b.setShadow)(e,n);var r=g.default.cornerstone.pixelToCanvas(t.element,a.handles.end);a.handles.end.boundingBox=Object(x.default)(e,a.text,r.x,r.y-10,o,{centering:{x:!0,y:!0}})}))},o=0;o<r.data.length;o++)a(o)}},{key:"_changeText",value:function(e){var t,n=e.detail,r=n.element;function i(e,t,n){!0===n?Object(w.removeToolState)(r,this.name,e):e.text=t,e.active=!1,g.default.cornerstone.updateImage(r)}var a=this.configuration,o=n.currentPoints.canvas,s=Object(w.getToolState)(r,this.name);if(s)for(var l=0;l<s.data.length;l++)if(this.pointNearTool(r,t=s.data[l],o))return t.active=!0,g.default.cornerstone.updateImage(r),a.changeTextCallback(t,n,i),e.stopImmediatePropagation(),e.preventDefault(),void e.stopPropagation()}}]),t}(m.default),E=function(e,t,n){n(e,prompt("Change your annotation:"))}},"./tools/annotation/bidirectionalTool/addNewMeasurement.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./events.js"),a=n("./manipulators/index.js"),o=n("./manipulators/anyHandlesOutsideImage.js"),s=n("./stateManagement/toolState.js"),l=n("./util/triggerEvent.js"),u=n("./util/getActiveTool.js"),c=n("./tools/annotation/BidirectionalTool.js"),d=n("./tools/annotation/bidirectionalTool/utils/updatePerpendicularLineHandles.js");t.default=function(e,t){var n=this,f=e.detail,p=f.element,m=f.image,g=f.buttons,v=this.configuration;if(!h(m)){var y=this.createNewMeasurement(f),b=function(){y.active=!1,r.default.cornerstone.updateImage(p)};Object(s.addToolState)(p,this.name,y),r.default.cornerstone.updateImage(p);var x=(new Date).getTime(),w=y.handles,_=w.end,S=w.perpendicularStart;Object(a.moveNewHandle)(f,this.name,y,_,{},t,(function(e){if(e){var a=y.handles,h=y.longestDiameter,w=y.shortestDiameter,_=Object(o.default)(f,a),E=parseFloat(h)||0,T=parseFloat(w)||0,k=E<1||T<1,C=(new Date).getTime()-x<150;_||k||C?(y.cancelled=!0,Object(s.removeToolState)(p,n.name,y)):v.getMeasurementLocationCallback(y,f,b),Object(d.default)(f,y),S.locked=!1,y.invalidated=!0,r.default.cornerstone.updateImage(p);var I=Object(u.default)(p,g,t);I instanceof c.default&&I.updateCachedStats(m,p,y);var O={toolName:n.name,toolType:n.name,element:p,measurementData:y};Object(l.default)(p,i.default.MEASUREMENT_MODIFIED,O),Object(l.default)(p,i.default.MEASUREMENT_COMPLETED,O)}else Object(s.removeToolState)(p,n.name,y)}))}};var h=function(e){var t=r.default.cornerstone.metaData.get("imagePlaneModule",e.imageId),n=e.rowPixelSpacing,i=e.columnPixelSpacing;return t&&(n=t.rowPixelSpacing||t.rowImagePixelSpacing,i=t.columnPixelSpacing||t.colImagePixelSpacing),!n||!i}},"./tools/annotation/bidirectionalTool/createNewMeasurement.js":function(e,t,n){"use strict";n.r(t);var r=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object.assign({x:e,y:t,index:n,drawnIndependently:!1,allowedOutsideImage:!1,highlight:!0,active:!1},r)};t.default=function(e){var t=e.currentPoints.image,n=t.x,i=t.y;return{toolName:this.name,toolType:this.name,isCreating:!0,visible:!0,active:!0,invalidated:!0,handles:{start:r(n,i,0),end:r(n,i,1,{active:!0}),perpendicularStart:r(n,i,2,{locked:!0}),perpendicularEnd:r(n,i,3),textBox:r(n-50,i-70,null,{highlight:!1,hasMoved:!0,active:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0})},longestDiameter:0,shortestDiameter:0}}},"./tools/annotation/bidirectionalTool/handleSelectedCallback.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";"touch"===r?this.handleSelectedTouchCallback(e):this.handleSelectedMouseCallback(e)}},"./tools/annotation/bidirectionalTool/handleSelectedMouseCallback.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/typeof.js"),i=n.n(r),a=n("./externalModules.js"),o=n("./store/index.js"),s=n("./events.js"),l=n("./stateManagement/toolState.js"),u=n("./manipulators/anyHandlesOutsideImage.js"),c=n("./manipulators/getHandleNearImagePoint.js"),d=n("./manipulators/index.js"),h=n("./tools/annotation/bidirectionalTool/moveHandle/moveHandle.js"),f=n("./tools/annotation/bidirectionalTool/invertHandles.js"),p=n("./store/setToolCursor.js");t.default=function(e){var t,n=this,r=e.detail,y=r.element,b=o.state.clickProximity,x=function(e){t.invalidated=!0,Object(u.default)(r,t.handles)&&Object(l.removeToolState)(y,n.name,t),e&&(e.moving=!1,e.selected=!0),Object(p.setToolCursor)(n.element,n.svgCursor),a.default.cornerstone.updateImage(y),y.addEventListener(s.default.MOUSE_MOVE,n._moveCallback),y.addEventListener(s.default.TOUCH_START,n._moveCallback)},w=r.startPoints.canvas,_=Object(l.getToolState)(e.currentTarget,this.name);if(_){for(var S=function(i){var a=c.default.apply(void 0,[y,(t=_.data[i]).handles,w,b]);if(a)return y.removeEventListener(s.default.MOUSE_MOVE,n._moveCallback),y.removeEventListener(s.default.TOUCH_START,n._moveCallback),t.active=!0,m(t.handles),a.moving=!0,(a=Object(f.default)(r,t,a)).hasBoundingBox||Object(p.hideToolCursor)(n.element),Object(h.default)(r,n.name,t,a,(function(){return x(a)})),v(e),{v:!0}},E=0;E<_.data.length;E++){var T=S(E);if("object"===i()(T))return T.v}var k=function(e){return function(){g(e,!1),x()}};for(E=0;E<_.data.length;E++)if(this.pointNearTool(y,t=_.data[E],w,"mouse")){y.removeEventListener(s.default.MOUSE_MOVE,this._moveCallback),y.removeEventListener(s.default.TOUCH_START,this._moveCallback),t.active=!0,m(t.handles),g(t.handles,!0);var C=k(t.handles);return Object(d.moveAllHandles)(r,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},"mouse",C),v(e),!0}}};var m=function(e){var t=!1;return Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)})),t},g=function(e,t){Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].moving=t)}))},v=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}},"./tools/annotation/bidirectionalTool/handleSelectedTouchCallback.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/typeof.js"),i=n.n(r),a=n("./externalModules.js"),o=n("./store/index.js"),s=n("./events.js"),l=n("./stateManagement/toolState.js"),u=n("./manipulators/anyHandlesOutsideImage.js"),c=n("./manipulators/getHandleNearImagePoint.js"),d=n("./manipulators/index.js"),h=n("./tools/annotation/bidirectionalTool/moveHandle/touchMoveHandle.js");t.default=function(e){var t,n=this,r=e.detail,g=r.element,v=o.state.touchProximity,y=function(e){t.invalidated=!0,Object(u.default)(r,t.handles)&&Object(l.removeToolState)(g,n.name,t),e&&(e.moving=!1,e.selected=!0),a.default.cornerstone.updateImage(g),g.addEventListener(s.default.TOUCH_DRAG,n._moveCallback)},b=r.startPoints.canvas,x=Object(l.getToolState)(e.currentTarget,this.name);if(x){for(var w=function(i){var a=c.default.apply(void 0,[g,(t=x.data[i]).handles,b,v]);if(a)return g.removeEventListener(s.default.TOUCH_DRAG,n._moveCallback),t.active=!0,f(t.handles),a.moving=!0,Object(h.default)(r,n.name,t,a,(function(){return y(a)})),m(e),{v:!0}},_=0;_<x.data.length;_++){var S=w(_);if("object"===i()(S))return S.v}var E=function(e){return function(){p(e,!1),y()}};for(_=0;_<x.data.length;_++)if(this.pointNearTool(g,t=x.data[_],b,"touch")){g.removeEventListener(s.default.TOUCH_DRAG,this._moveCallback),t.active=!0,f(t.handles),p(t.handles,!0);var T=E(t.handles);return Object(d.moveAllHandles)(r,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},"touch",T),m(e),!0}}};var f=function(e){var t=!1;return Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)})),t},p=function(e,t){Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].moving=t)}))},m=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}},"./tools/annotation/bidirectionalTool/invertHandles.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=function(e,t,n){var r=e[n];e[n]=t[n],t[n]=r},i=function(e,t){r(e,t,"x"),r(e,t,"y"),r(e,t,"moving"),r(e,t,"hover"),r(e,t,"active"),r(e,t,"selected")};function a(e,t,n){var r=e.image,a=r.rowPixelSpacing,o=r.columnPixelSpacing,s=t.handles,l=s.start,u=s.end,c=s.perpendicularStart,d=s.perpendicularEnd,h=(l.x-u.x)*(o||1),f=(l.y-u.y)*(a||1),p=Math.sqrt(h*h+f*f),m=(c.x-d.x)*(o||1),g=(c.y-d.y)*(a||1);return(Math.sqrt(m*m+g*g)||0)>p?(i(l,u),i(l,c),i(u,d),Object.values(s).find((function(e){return!0===e.moving}))):n}},"./tools/annotation/bidirectionalTool/mouseMoveCallback.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./stateManagement/toolCoordinates.js"),a=n("./manipulators/getHandleNearImagePoint.js"),o=n("./stateManagement/toolState.js");t.default=function(e){var t=this,n=e.detail,s=n.element;i.default.setCoords(n);var l=Object(o.getToolState)(s,this.name);if(l){for(var u=!1,c=function(e){var r=n.currentPoints.canvas,i=l.data[e],o=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,i=Object(a.default)(e,t,n,r),o=!1;return Object.keys(t).forEach((function(e){if("textBox"!==e){var n=t[e],r=n===i;n.active!==r&&(o=!0),n.active=r}})),o}(s,i.handles,r);Object.keys(i.handles).forEach((function(e){if("textBox"!==e){var t=i.handles[e];t.hover=t.active}})),o&&(u=!0);var c=t.pointNearTool(s,i,r,"mouse");(c&&!i.active||!c&&i.active)&&(i.active=!i.active,u=!0)},d=0;d<l.data.length;d++)c(d);!0===u&&r.default.cornerstone.updateImage(s)}}},"./tools/annotation/bidirectionalTool/moveHandle/getBaseData.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));var r=n("./externalModules.js"),i=n("./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js");function a(e,t){return{start:e,end:t}}function o(e,t,n){var o=r.default.cornerstoneMath.lineSegment,s=e.handles,l=s.start,u=s.end,c=s.perpendicularStart,d=s.perpendicularEnd,h=t.image,f=h.columnPixelSpacing,p=void 0===f?1:f,m=h.rowPixelSpacing,g=void 0===m?1:m,v=a(l,u),y=a(c,d),b=o.intersectLine(v,y);return{columnPixelSpacing:p,rowPixelSpacing:g,start:l,end:u,perpendicularStart:c,perpendicularEnd:d,longLine:v,intersection:b,distanceToFixed:Object(i.default)(p,g,n,b),fixedPoint:n}}},"./tools/annotation/bidirectionalTool/moveHandle/moveHandle.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./store/index.js"),a=n("./events.js"),o=n("./tools/annotation/bidirectionalTool/moveHandle/setHandlesPosition.js"),s=n("./util/getActiveTool.js"),l=n("./tools/base/BaseAnnotationTool.js");t.default=function(e,t,n,u,c,d){var h=e.element,f=e.image,p=e.buttons,m={x:u.x-e.currentPoints.image.x,y:u.y-e.currentPoints.image.y},g=function(e){var i=e.detail;u.hasMoved=!0,null==u.index?(u.x=i.currentPoints.image.x+m.x,u.y=i.currentPoints.image.y+m.y):Object(o.default)(u,i,n,m),d&&(u.x=Math.max(u.x,0),u.x=Math.min(u.x,i.image.width),u.y=Math.max(u.y,0),u.y=Math.min(u.y,i.image.height)),n.invalidated=!0,r.default.cornerstone.updateImage(h);var c=Object(s.default)(h,p,"mouse");c instanceof l.default&&c.updateCachedStats(f,h,n),r.default.cornerstone.triggerEvent(h,a.default.MEASUREMENT_MODIFIED,{toolName:t,toolType:t,element:h,measurementData:n})};u.active=!0,u.moving=!0,i.state.isToolLocked=!0,h.addEventListener(a.default.MOUSE_DRAG,g),h.addEventListener(a.default.TOUCH_DRAG,g);var v=r.default.cornerstone.getImage(h),y=function(){r.default.cornerstone.getImage(h).imageId!==v.imageId&&b()};h.addEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,y);var b=function e(){u.active=!1,i.state.isToolLocked=!1,h.removeEventListener(r.default.cornerstone.EVENTS.IMAGE_RENDERED,y),h.removeEventListener(a.default.MOUSE_DRAG,g),h.removeEventListener(a.default.MOUSE_UP,e),h.removeEventListener(a.default.MOUSE_CLICK,e),h.removeEventListener(a.default.TOUCH_DRAG,g),h.removeEventListener(a.default.TOUCH_DRAG_END,e),h.removeEventListener(a.default.TAP,e),r.default.cornerstone.updateImage(h),"function"==typeof c&&c()};h.addEventListener(a.default.MOUSE_UP,b),h.addEventListener(a.default.MOUSE_CLICK,b),h.addEventListener(a.default.TOUCH_DRAG_END,b),h.addEventListener(a.default.TAP,b)}},"./tools/annotation/bidirectionalTool/moveHandle/moveLongLine/moveLongLine.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));var r=n("./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js"),i=n("./tools/annotation/bidirectionalTool/moveHandle/getBaseData.js"),a=n("./tools/annotation/bidirectionalTool/moveHandle/moveLongLine/updatePerpendicularLine.js");function o(e,t,n,o){var s=Object(i.default)(t,n,o),l=s.columnPixelSpacing,u=s.rowPixelSpacing,c=s.distanceToFixed,d=Object(r.default)(l,u,o,e);if(d<=c)return!1;var h=c/d,f={x:o.x+(e.x-o.x)*h,y:o.y+(e.y-o.y)*h},p=Object(a.default)(s,f);return t.handles.perpendicularStart.x=p.start.x,t.handles.perpendicularStart.y=p.start.y,t.handles.perpendicularEnd.x=p.end.x,t.handles.perpendicularEnd.y=p.end.y,!0}},"./tools/annotation/bidirectionalTool/moveHandle/moveLongLine/updatePerpendicularLine.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=n("./tools/annotation/bidirectionalTool/utils/getLineVector.js"),i=n("./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js");function a(e,t){var n=e.columnPixelSpacing,a=e.rowPixelSpacing,o=e.start,s=e.perpendicularStart,l=e.perpendicularEnd,u=e.intersection,c=e.fixedPoint,d=Object(i.default)(n,a,s,u),h=Object(i.default)(n,a,l,u),f=Object(r.default)(n,a,c,t),p=c===o?1:-1,m=p*a,g=p*n;return{start:{x:t.x+f.y*d*m,y:t.y+f.x*d*g*-1},end:{x:t.x+f.y*h*m*-1,y:t.y+f.x*h*g}}}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getDirectionMultiplier.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/isPerpendicularEndFixed.js");function i(e,t){return Object(r.default)(e,t)?-1:1}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getHelperLine.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getDirectionMultiplier.js");function i(e,t,n){var i=e.columnPixelSpacing,a=e.rowPixelSpacing,o=e.perpendicularEnd,s=e.fixedPoint,l=Number.MAX_SAFE_INTEGER,u=Object(r.default)(s,o)*l;return{start:t,end:{x:t.x+n.y*a*u,y:t.y+n.x*i*u*-1}}}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getMovingPoint.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/isPerpendicularEndFixed.js");function i(e,t,n){return Object(r.default)(e,n)?t:n}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/isPerpendicularEndFixed.js":function(e,t,n){"use strict";function r(e,t){return e===t}n.r(t),n.d(t,"default",(function(){return r}))},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/lineHasLength.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js");function i(e,t,n){return 0!==Object(r.default)(e,t,n.start,n.end)}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/movePerpendicularLine.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));var r=n("./externalModules.js"),i=n("./tools/annotation/bidirectionalTool/utils/getLineVector.js"),a=n("./tools/annotation/bidirectionalTool/moveHandle/getBaseData.js"),o=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/lineHasLength.js"),s=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getHelperLine.js"),l=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/updatePerpendicularLine.js");function u(e,t,n,u){var c=r.default.cornerstoneMath.lineSegment,d=Object(a.default)(t,n,u),h=d.columnPixelSpacing,f=d.rowPixelSpacing,p=d.start,m=d.longLine,g=d.intersection;if(!Object(o.default)(h,f,m))return!1;var v=Object(i.default)(h,f,p,g),y=Object(s.default)(d,e,v),b=c.intersectLine(m,y);if(!b)return!1;var x=Object(l.default)(d,b,y,v);return t.handles.perpendicularStart.x=x.start.x,t.handles.perpendicularStart.y=x.start.y,t.handles.perpendicularEnd.x=x.end.x,t.handles.perpendicularEnd.y=x.end.y,!0}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/updatePerpendicularLine.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));var r=n("../node_modules/@babel/runtime/helpers/defineProperty.js"),i=n.n(r),a=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getDirectionMultiplier.js"),o=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getMovingPoint.js");function s(e,t,n,r){var s,l=e.columnPixelSpacing,u=e.rowPixelSpacing,c=e.fixedPoint,d=e.perpendicularStart,h=e.perpendicularEnd,f=e.distanceToFixed,p=Object(a.default)(c,h)*f,m=Object(o.default)(c,d,h)===d,g=m?"start":"end",v=m?"end":"start";return s={},i()(s,g,{x:n.start.x,y:n.start.y}),i()(s,v,{x:t.x+r.y*u*p,y:t.y+r.x*l*p*-1}),s}},"./tools/annotation/bidirectionalTool/moveHandle/setHandlesPosition.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./tools/annotation/bidirectionalTool/moveHandle/moveLongLine/moveLongLine.js"),a=n("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/movePerpendicularLine.js");t.default=function(e,t,n,o){var s,l,u,c,d={},h={},f={x:t.currentPoints.image.x+o.x,y:t.currentPoints.image.y+o.y};0===e.index?Object(i.default)(f,n,t,n.handles.end)?(e.x=f.x,e.y=f.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):1===e.index?Object(i.default)(f,n,t,n.handles.start)?(e.x=f.x,e.y=f.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):2===e.index?(s=!1,d.start={x:n.handles.start.x,y:n.handles.start.y},d.end={x:n.handles.end.x,y:n.handles.end.y},h.start={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},h.end={x:f.x,y:f.y},(l=r.default.cornerstoneMath.lineSegment.intersectLine(d,h))||(h.end={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},l=r.default.cornerstoneMath.lineSegment.intersectLine(d,h),u=r.default.cornerstoneMath.point.distance(l,n.handles.start),c=r.default.cornerstoneMath.point.distance(l,n.handles.end),(!l||u<3||c<3)&&(s=!0)),s||Object(a.default)(f,n,t,n.handles.perpendicularEnd)||(t.currentPoints.image.x=n.handles.perpendicularStart.x,t.currentPoints.image.y=n.handles.perpendicularStart.y)):3===e.index&&(s=!1,d.start={x:n.handles.start.x,y:n.handles.start.y},d.end={x:n.handles.end.x,y:n.handles.end.y},h.start={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},h.end={x:f.x,y:f.y},(l=r.default.cornerstoneMath.lineSegment.intersectLine(d,h))||(h.end={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},l=r.default.cornerstoneMath.lineSegment.intersectLine(d,h),u=r.default.cornerstoneMath.point.distance(l,n.handles.start),c=r.default.cornerstoneMath.point.distance(l,n.handles.end),(!l||u<3||c<3)&&(s=!0)),s||Object(a.default)(f,n,t,n.handles.perpendicularStart)||(t.currentPoints.image.x=n.handles.perpendicularEnd.x,t.currentPoints.image.y=n.handles.perpendicularEnd.y))}},"./tools/annotation/bidirectionalTool/moveHandle/touchMoveHandle.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./store/index.js"),a=n("./events.js"),o=n("./tools/annotation/bidirectionalTool/moveHandle/setHandlesPosition.js"),s=n("./util/getActiveTool.js"),l=n("./tools/base/BaseAnnotationTool.js"),u=[a.default.TOUCH_END,a.default.TOUCH_DRAG_END,a.default.TOUCH_PINCH,a.default.TOUCH_PRESS,a.default.TAP];t.default=function(e,t,n,c,d,h){var f=e.element,p=e.image,m=e.buttons,g={x:c.x-e.currentPoints.image.x,y:c.y-e.currentPoints.image.y},v=function(e){var i=e.detail;c.hasMoved=!0,null==c.index?(c.x=i.currentPoints.image.x+g.x,c.y=i.currentPoints.image.y+g.y):Object(o.default)(c,i,n,g),h&&(c.x=Math.max(c.x,0),c.x=Math.min(c.x,i.image.width),c.y=Math.max(c.y,0),c.y=Math.min(c.y,i.image.height)),n.invalidated=!0,r.default.cornerstone.updateImage(f);var u=Object(s.default)(f,m,"touch");u instanceof l.default&&u.updateCachedStats(p,f,n),r.default.cornerstone.triggerEvent(f,a.default.MEASUREMENT_MODIFIED,{toolName:t,toolType:t,element:f,measurementData:n})};c.active=!0,i.state.isToolLocked=!0,f.addEventListener(a.default.TOUCH_DRAG,v);var y=function e(){c.active=!1,i.state.isToolLocked=!1,f.removeEventListener(a.default.TOUCH_DRAG,v),u.forEach((function(t){f.removeEventListener(t,e)})),r.default.cornerstone.updateImage(f),"function"==typeof d&&d()};u.forEach((function(e){f.addEventListener(e,y)}))}},"./tools/annotation/bidirectionalTool/pointNearTool.js":function(e,t,n){"use strict";n.r(t);var r=n("./store/index.js"),i=n("./externalModules.js"),a=n("./util/pointInsideBoundingBox.js"),o=function(e,t,n,r){var a=i.default.cornerstone,o=i.default.cornerstoneMath,s={start:a.pixelToCanvas(e,t.perpendicularStart),end:a.pixelToCanvas(e,t.perpendicularEnd)};return o.lineSegment.distanceToPoint(s,n)<r};t.default=function(e,t,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",l=i.default.cornerstone,u=i.default.cornerstoneMath,c=t.handles,d={start:l.pixelToCanvas(e,c.start),end:l.pixelToCanvas(e,c.end)},h=u.lineSegment.distanceToPoint(d,n);if(Object(a.default)(c.textBox,n))return!0;var f="mouse"===s?r.state.clickProximity:r.state.touchProximity;return!!o(e,c,n,f)||h<f}},"./tools/annotation/bidirectionalTool/renderToolData.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=n.n(r),a=n("./drawing/drawHandles.js"),o=n("./tools/annotation/bidirectionalTool/utils/updatePerpendicularLineHandles.js"),s=n("./store/index.js"),l=n("./stateManagement/toolStyle.js"),u=n("./stateManagement/toolColors.js"),c=n("./stateManagement/toolState.js"),d=n("./drawing/index.js"),h=n("./drawing/drawLinkedTextBox.js"),f=n("./util/getPixelSpacing.js");t.default=function(e){var t=this,n=e.detail,r=n.element,i=n.canvasContext,m=n.image,g=this.configuration,v=g.handleRadius,y=g.drawHandlesOnHover,b=g.hideHandlesIfMoving,x=g.renderDashed,w=Object(s.getModule)("globalConfiguration").configuration.lineDash,_=Object(c.getToolState)(r,this.name);if(_){var S=Object(f.default)(m),E=S.rowPixelSpacing,T=S.colPixelSpacing;if(E&&T)for(var k,C=Object(d.getNewContext)(i.canvas),I=u.default.getActiveColor(),O=l.default.getToolWidth(),A=function(e){var i=_.data[e];if(!1===i.visible)return"continue";k=i.active?I:u.default.getToolColor(),!0===i.invalidated&&(i.longestDiameter&&i.shortestDiameter?t.throttledUpdateCachedStats(m,r,i):t.updateCachedStats(m,r,i)),Object(d.draw)(C,(function(e){Object(d.setShadow)(e,t.configuration);var s=i.handles,l=s.start,u=s.end,c=s.perpendicularStart,f=s.perpendicularEnd,m=s.textBox,g={color:k},_={color:k,strokeWidth:S};x&&(g.lineDash=w,_.lineDash=w),Object(d.drawLine)(e,r,l,u,g);var S=O;Object(o.default)(n,i),Object(d.drawLine)(e,r,c,f,_);var C={color:k,handleRadius:v,drawHandlesIfActive:y,hideHandlesIfMoving:b};t.configuration.drawHandles&&Object(a.default)(e,n,i.handles,C);var I=p(i,E,T);Object(h.default)(e,r,m,I,i.handles,(function(e){return[e.start,e.end,e.perpendicularStart,e.perpendicularEnd]}),k,O,10,!0)}))},D=0;D<_.data.length;D++)A(D)}};var p=function(e,t,n){var r=" mm";t&&n||(r=" pixels");var a=" L ".concat(e.longestDiameter).concat(r),o=" W ".concat(e.shortestDiameter).concat(r),s=e.labels;return s&&Array.isArray(s)?[].concat(i()(s),[a,o]):[a,o]}},"./tools/annotation/bidirectionalTool/utils/calculateLongestAndShortestDiameters.js":function(e,t,n){"use strict";function r(e,t){var n=t.rowPixelSpacing,r=t.colPixelSpacing,i=e.handles,a=i.start,o=i.end,s=i.perpendicularStart,l=i.perpendicularEnd,u=(a.x-o.x)*(r||1),c=(a.y-o.y)*(n||1),d=Math.sqrt(u*u+c*c),h=(s.x-l.x)*(r||1),f=(s.y-l.y)*(n||1),p=Math.sqrt(h*h+f*f);if(p||(p=0),p>d){var m=d;d=p,p=m}return{longestDiameter:d.toFixed(1),shortestDiameter:p.toFixed(1)}}n.r(t),n.d(t,"default",(function(){return r}))},"./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js":function(e,t,n){"use strict";function r(e,t,n,r){var i=(n.x-r.x)/t,a=(n.y-r.y)/e;return Math.sqrt(i*i+a*a)}n.r(t),n.d(t,"default",(function(){return r}))},"./tools/annotation/bidirectionalTool/utils/getLineVector.js":function(e,t,n){"use strict";function r(e,t,n,r){var i=(n.x-r.x)*e,a=(n.y-r.y)*t,o=Math.sqrt(i*i+a*a);return{x:i/o,y:a/o,length:o}}n.r(t),n.d(t,"default",(function(){return r}))},"./tools/annotation/bidirectionalTool/utils/updatePerpendicularLineHandles.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./tools/annotation/bidirectionalTool/utils/getLineVector.js");function i(e,t){if(!t.handles.perpendicularStart.locked)return!1;var n,i,a,o,s=t.handles,l=s.start,u=s.end,c=e.image,d=c.columnPixelSpacing,h=void 0===d?1:d,f=c.rowPixelSpacing,p=void 0===f?1:f;if(l.x===u.x&&l.y===u.y)n=l.x,i=l.y,a=u.x,o=u.y;else{var m={x:(l.x+u.x)/2,y:(l.y+u.y)/2},g=Object(r.default)(h,p,l,u),v=g.length/2,y=v/(2*p),b=v/(2*h);n=m.x+b*g.y,i=m.y-y*g.x,a=m.x-b*g.y,o=m.y+y*g.x}return t.handles.perpendicularStart.x=n,t.handles.perpendicularStart.y=i,t.handles.perpendicularEnd.x=a,t.handles.perpendicularEnd.y=o,!0}},"./tools/annotation/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./tools/annotation/AngleTool.js"),i=n("./tools/annotation/ArrowAnnotateTool.js"),a=n("./tools/annotation/BidirectionalTool.js"),o=n("./tools/annotation/CircleRoiTool.js"),s=n("./tools/annotation/CobbAngleTool.js"),l=n("./tools/annotation/EllipticalRoiTool.js"),u=n("./tools/annotation/FreehandRoiTool.js"),c=n("./tools/annotation/LengthTool.js"),d=n("./tools/annotation/ProbeTool.js"),h=n("./tools/annotation/RectangleRoiTool.js"),f=n("./tools/annotation/TextMarkerTool.js");n.d(t,"AngleTool",(function(){return r.default})),n.d(t,"ArrowAnnotateTool",(function(){return i.default})),n.d(t,"BidirectionalTool",(function(){return a.default})),n.d(t,"CircleRoiTool",(function(){return o.default})),n.d(t,"CobbAngleTool",(function(){return s.default})),n.d(t,"EllipticalRoiTool",(function(){return l.default})),n.d(t,"FreehandRoiTool",(function(){return u.default})),n.d(t,"LengthTool",(function(){return c.default})),n.d(t,"ProbeTool",(function(){return d.default})),n.d(t,"RectangleRoiTool",(function(){return h.default})),n.d(t,"TextMarkerTool",(function(){return f.default})),t.default={AngleTool:r.default,ArrowAnnotateTool:i.default,BidirectionalTool:a.default,CircleRoiTool:o.default,CobbAngleTool:s.default,EllipticalRoiTool:l.default,FreehandRoiTool:u.default,LengthTool:c.default,ProbeTool:d.default,RectangleRoiTool:h.default,TextMarkerTool:f.default}},"./tools/base/BaseAnnotationTool.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(d),f=n("./tools/base/BaseTool.js"),p=n("./stateManagement/toolState.js"),m=n("./manipulators/handleActivator.js"),g=n("./util/findAndMoveHelpers.js"),v=n("./util/logger.js"),y=Object(v.getLogger)("baseAnnotationTool");t.default=function(e){function t(){return i()(this,t),l()(this,c()(t).apply(this,arguments))}return h()(t,e),o()(t,[{key:"createNewMeasurement",value:function(e){throw new Error("Method createNewMeasurement not implemented for ".concat(this.name,"."))}},{key:"pointNearTool",value:function(e,t,n){throw new Error("Method pointNearTool not implemented for ".concat(this.name,"."))}},{key:"distanceFromPoint",value:function(e,t,n){throw new Error("Method distanceFromPoint not implemented for ".concat(this.name,"."))}},{key:"renderToolData",value:function(e){throw new Error("renderToolData not implemented for ".concat(this.name,"."))}},{key:"mouseMoveCallback",value:function(e){for(var t=e.detail,n=t.element,r=t.currentPoints.canvas,i=Object(p.getToolState)(n,this.name),a=!1,o=0;o<i.data.length;o++){var s=i.data[o];!0===Object(m.default)(n,s.handles,r)&&(a=!0);var l=this.pointNearTool(n,s,r,"mouse")&&!s.active,u=!this.pointNearTool(n,s,r,"mouse")&&s.active;(l||u)&&(s.active=!s.active,a=!0)}return a}},{key:"handleSelectedCallback",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";Object(g.moveHandleNearImagePoint)(e,this,t,n,r)}},{key:"toolSelectedCallback",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse";Object(g.moveAnnotation)(e,this,t,n)}},{key:"updateCachedStats",value:function(e,t,n){y.warn("updateCachedStats not implemented for ".concat(this.name,"."))}}]),t}(f.default)},"./tools/base/BaseBrushTool.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./tools/base/BaseTool.js"),g=n("./events.js"),v=n("./externalModules.js"),y=n("./store/isToolActiveForElement.js"),b=n("./store/index.js"),x=n("./util/segmentation/index.js"),w=Object(b.getModule)("segmentation");t.default=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i()(this,t),r.configuration||(r.configuration={alwaysEraseOnClick:!1}),(n=l()(this,c()(t).call(this,e,r))).updateOnMouseMove=!0,n.hideDefaultCursor=!0,n._drawing=!1,n._drawingMouseUpCallback=n._drawingMouseUpCallback.bind(h()(n)),n}return p()(t,e),o()(t,[{key:"renderBrush",value:function(e){throw new Error("Method renderBrush not implemented for ".concat(this.name,"."))}},{key:"_paint",value:function(e){throw new Error("Method _paint not implemented for ".concat(this.name,"."))}},{key:"mouseDragCallback",value:function(e){this._lastImageCoords=e.detail.currentPoints.image,this._drawing&&this._paint(e)}},{key:"preMouseDownCallback",value:function(e){var t=e.detail,n=t.element,r=t.currentPoints;return this._startPainting(e),this._lastImageCoords=r.image,this._drawing=!0,this._startListeningForMouseUp(n),this._paint(e),!0}},{key:"_startPainting",value:function(e){var t=e.detail,n=w.configuration,r=w.getters.labelmap2D(t.element),i=r.labelmap2D,a=r.labelmap3D,o=r.currentImageIdIndex,s=r.activeLabelmapIndex,l=this._isCtrlDown(t)||this.configuration.alwaysEraseOnClick;if(this.paintEventData={labelmap2D:i,labelmap3D:a,currentImageIdIndex:o,activeLabelmapIndex:s,shouldErase:l},n.storeHistory){var u=i.pixelData.slice();this.paintEventData.previousPixelData=u}}},{key:"_endPainting",value:function(e){for(var t=w.configuration,n=w.setters,r=this.paintEventData,i=r.labelmap2D,a=r.currentImageIdIndex,o=new Set(i.pixelData).values(),s=[],l=!1;!l;){var u=o.next();(l=u.done)||s.push(u.value)}if(i.segmentsOnLabelmap=s,t.storeHistory){var c=this.paintEventData.previousPixelData,d=i.pixelData,h={imageIdIndex:a,diff:Object(x.getDiffBetweenPixelData)(c,d)};n.pushState(this.element,[h])}Object(x.triggerLabelmapModifiedEvent)(this.element)}},{key:"mouseMoveCallback",value:function(e){this._lastImageCoords=e.detail.currentPoints.image}},{key:"renderToolData",value:function(e){var t=e.detail.element;Object(y.default)(t,this.name)&&this.renderBrush(e)}},{key:"passiveCallback",value:function(e){try{v.default.cornerstone.updateImage(this.element)}catch(t){return}}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail.element;this._endPainting(e),this._drawing=!1,this._mouseUpRender=!0,this._stopListeningForMouseUp(t)}},{key:"newImageCallback",value:function(e){this._drawing&&(this._endPainting(e),this._startPainting(e))}},{key:"_startListeningForMouseUp",value:function(e){e.removeEventListener(g.default.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(g.default.MOUSE_CLICK,this._drawingMouseUpCallback),e.addEventListener(g.default.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(g.default.MOUSE_CLICK,this._drawingMouseUpCallback),v.default.cornerstone.updateImage(e)}},{key:"_stopListeningForMouseUp",value:function(e){e.removeEventListener(g.default.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(g.default.MOUSE_CLICK,this._drawingMouseUpCallback),v.default.cornerstone.updateImage(e)}},{key:"increaseBrushSize",value:function(){var e=w.setters,t=w.configuration.radius,n=Math.floor(1.2*t);n===t&&(n+=1),e.radius(n)}},{key:"decreaseBrushSize",value:function(){var e=w.setters,t=Math.floor(.8*w.configuration.radius);e.radius(t)}},{key:"_isCtrlDown",value:function(e){return e.event&&e.event.ctrlKey||e.ctrlKey}}]),t}(m.default)},"./tools/base/BaseTool.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/typeof.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/createClass.js"),l=n.n(s),u=n("./mixins/index.js"),c=n("./util/logger.js"),d=n("./util/deepmerge.js"),h=n("./store/setToolCursor.js"),f=n("./store/index.js"),p=Object(c.getLogger)("tools:base:BaseTool"),m=Object(f.getModule)("globalConfiguration");t.default=function(){function e(t,n){o()(this,e),this.initialConfiguration=Object(d.default)(n,t);var r=this.initialConfiguration,i=r.strategies,a=r.defaultStrategy,s=r.configuration,l=r.supportedInteractionTypes,u=r.mixins,c=r.svgCursor;this.name=r.name,this.mode="disabled",this.element=void 0,this.supportedInteractionTypes=l||[],this.strategies=i||{},this.defaultStrategy=a||Object.keys(this.strategies)[0]||void 0,this.activeStrategy=this.defaultStrategy,c&&(this.svgCursor=c),this._options={},this._configuration=Object.assign({},s),this.updateOnMouseMove=!1,this.hideDefaultCursor=!1,u&&u.length&&this._applyMixins(u),this._cursors=Object.assign({},this.initialConfiguration.cursors);var h=this.defaultStrategy&&this._cursors[this.activeStrategy];h&&(this.svgCursor=h)}return l()(e,[{key:"mergeOptions",value:function(e){this._options=Object.assign({},this._options,e)}},{key:"clearOptions",value:function(){this._options={}}},{key:"applyActiveStrategy",value:function(e,t){return this.strategies[this.activeStrategy].call(this,e,t)}},{key:"_applyMixins",value:function(e){for(var t=0;t<e.length;t++){var n=u.default["".concat(e[t])];"object"===i()(n)?(Object.assign(this,n),"function"==typeof this.initializeMixin&&this.initializeMixin()):p.warn("".concat(this.name,": mixin ").concat(u.default[t]," does not exist."))}"function"===this.initializeMixin&&delete this.initializeMixin}},{key:"setActiveStrategy",value:function(e){this.activeStrategy=e,m.configuration.showSVGCursors&&this.changeCursor(this.element,e)}},{key:"changeCursor",value:function(e,t){if(e){var n=this._cursors[t];n&&(this.svgCursor=n,"active"===this.mode&&Object(h.setToolCursor)(e,n))}}},{key:"configuration",get:function(){return this._configuration},set:function(e){this._configuration=e}},{key:"options",get:function(){return this._options}}],[{key:"configuration",get:function(){}}]),e}()},"./tools/base/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./tools/base/BaseAnnotationTool.js"),i=n("./tools/base/BaseTool.js"),a=n("./tools/base/BaseBrushTool.js");n.d(t,"BaseAnnotationTool",(function(){return r.default})),n.d(t,"BaseBrushTool",(function(){return a.default})),n.d(t,"BaseTool",(function(){return i.default})),t.default={BaseAnnotationTool:r.default,BaseBrushTool:a.default,BaseTool:i.default}},"./tools/cursors/MouseCursor.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("./stateManagement/toolColors.js"),l=n("./store/index.js").modules.cursor,u=function(){function e(t,n){i()(this,e),this.iconGroupString=t,this.options=Object.assign({},l.getters.defaultOptions(),n)}return o()(e,[{key:"getIconSVG",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._generateIconSVGString(e);return new Blob([t],{type:"image/svg+xml"})}},{key:"getIconSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._generateIconSVGString(e)}},{key:"getIconWithPointerSVG",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._generateIconWithPointerSVGString(e);return new Blob([t],{type:"image/svg+xml"})}},{key:"getIconWithPointerString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._generateIconWithPointerSVGString(e)}},{key:"_generateIconWithPointerSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},this.options,e),n=t.mousePointerGroupString,r=t.iconSize,i=t.viewBox,a=r/Math.max(i.x,i.y),o=16+r,s='\n        <svg\n        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n        width="'.concat(o,'" height="').concat(o,'" viewBox="0 0 ').concat(o," ").concat(o,'"\n      >\n        <g>\n          ').concat(n,'\n        </g>\n        <g transform="translate(16, 16) scale(').concat(a,')">\n          ').concat(this.iconGroupString,"\n        </g>\n      </svg>");return this._injectColors(s,t)}},{key:"_generateIconSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},this.options,e),n=t.iconSize,r=t.viewBox,i='\n      <svg\n        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n        width="'.concat(n,'" height="').concat(n,'" viewBox="0 0\n        ').concat(r.x," ").concat(r.y,'"\n      >\n        ').concat(this.iconGroupString,"\n      </svg>");return this._injectColors(i,t)}},{key:"_injectColors",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.activeColor||s.default.getActiveColor(),r=t.toolColor||s.default.getToolColor(),i=t.fillColor||s.default.getFillColor();return e.replace(/ACTIVE_COLOR/g,"".concat(n)).replace(/TOOL_COLOR/g,"".concat(r)).replace(/FILL_COLOR/g,"".concat(i))}},{key:"mousePoint",get:function(){var e=this.options.mousePoint;return"".concat(e.x," ").concat(e.y)}}]),e}()},"./tools/cursors/index.js":function(e,t,n){"use strict";n.r(t),n.d(t,"angleCursor",(function(){return i})),n.d(t,"arrowAnnotateCursor",(function(){return a})),n.d(t,"bidirectionalCursor",(function(){return o})),n.d(t,"cobbAngleCursor",(function(){return s})),n.d(t,"circleRoiCursor",(function(){return l})),n.d(t,"ellipticalRoiCursor",(function(){return u})),n.d(t,"freehandRoiCursor",(function(){return c})),n.d(t,"freehandRoiSculptorCursor",(function(){return d})),n.d(t,"lengthCursor",(function(){return h})),n.d(t,"probeCursor",(function(){return f})),n.d(t,"rectangleRoiCursor",(function(){return p})),n.d(t,"textMarkerCursor",(function(){return m})),n.d(t,"crosshairsCursor",(function(){return g})),n.d(t,"eraserCursor",(function(){return v})),n.d(t,"magnifyCursor",(function(){return y})),n.d(t,"panCursor",(function(){return b})),n.d(t,"rotateCursor",(function(){return x})),n.d(t,"stackScrollCursor",(function(){return w})),n.d(t,"wwwcRegionCursor",(function(){return _})),n.d(t,"wwwcCursor",(function(){return S})),n.d(t,"zoomCursor",(function(){return E})),n.d(t,"freehandEraseInsideCursor",(function(){return D})),n.d(t,"freehandFillInsideCursor",(function(){return M})),n.d(t,"freehandEraseOutsideCursor",(function(){return N})),n.d(t,"freehandFillOutsideCursor",(function(){return j})),n.d(t,"segRectangleEraseInsideCursor",(function(){return R})),n.d(t,"segRectangleFillInsideCursor",(function(){return P})),n.d(t,"segRectangleEraseOutsideCursor",(function(){return F})),n.d(t,"segRectangleFillOutsideCursor",(function(){return L})),n.d(t,"segCircleEraseInsideCursor",(function(){return $})),n.d(t,"segCircleFillInsideCursor",(function(){return B})),n.d(t,"segCircleEraseOutsideCursor",(function(){return z})),n.d(t,"segCircleFillOutsideCursor",(function(){return U}));var r=n("./tools/cursors/MouseCursor.js"),i=new r.default('<path fill="ACTIVE_COLOR" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50\n        50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23\n        10l50 50q10 10 10 23z"\n      />',{viewBox:{x:1792,y:1792}}),a=new r.default('<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />\n  </g>',{viewBox:{x:24,y:24}}),o=new r.default('<g fill="ACTIVE_COLOR" stroke-width="3" stroke="ACTIVE_COLOR">\n    <path d="M27.63 3.21L3.12 28.81"></path>\n    <path d="M27.63 15.75L15.27 4.43"></path>\n    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>\n    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>\n    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>\n    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>\n  </g>',{viewBox:{x:48,y:48}}),s=new r.default('<g stroke="ACTIVE_COLOR" stroke-width="3">\n    <path d="M28.59 2.34L3.82 12.32"></path>\n    <path d="M28.59 29.66L3.82 19.68"></path>\n    <path stroke-dasharray="2" fill-opacity="0" d="M12.37\n      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15\n      9.33C13.11 9.24 13.02 9 12.88 8.63">\n    </path>\n  </g>',{viewBox:{x:32,y:32}}),l=new r.default('<circle stroke="ACTIVE_COLOR" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',{viewBox:{x:32,y:32}}),u=new r.default('<path stroke="ACTIVE_COLOR" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16\n    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14\n    6.3 30.74 10.54 30.74 15.76Z"\n    />',{viewBox:{x:32,y:32}}),c=new r.default('\n  <g fill="ACTIVE_COLOR" stroke="ACTIVE_COLOR" stroke-width="2">\n    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>\n    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>\n    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>\n    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>\n    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>\n    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>\n    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>\n    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>\n    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>\n    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>\n    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>\n    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>\n    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>\n    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>\n    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>\n    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>\n    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>\n    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>\n    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>\n    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>\n    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>\n    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>\n    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>\n    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>\n    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>\n    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>\n    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>\n    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>\n    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>\n    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>\n  </g>',{viewBox:{x:18,y:18}}),d=new r.default('<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n      <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>\n      <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>\n      <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>\n      <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>\n      <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>\n      <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>\n      <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>\n      <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>\n      <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>\n      <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>\n      <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>\n      <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>\n      <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>\n      <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>\n      <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>\n      <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>\n      <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>\n      <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>\n      <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>\n      <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>\n      <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>\n      <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>\n      <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>\n      <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>\n      <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>\n      <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>\n      <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>\n      <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>\n      <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>\n      <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>\n      <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>\n      <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>\n    </g>',{viewBox:{x:18,y:18}}),h=new r.default('<g id="length-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />\n  </g>',{viewBox:{x:24,y:24}}),f=new r.default('<path fill="ACTIVE_COLOR" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75\n    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73\n    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5\n    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5\n    385.5-103 385.5 103 279.5 279.5 103 385.5z"\n  />',{viewBox:{x:1792,y:1792}}),p=new r.default('<path fill="ACTIVE_COLOR" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47\n    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0\n    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119\n    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z"\n  />',{viewBox:{x:1792,y:1792}}),m=new r.default('<path fill="ACTIVE_COLOR" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0\n    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29\n    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15\n    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5\n    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0\n    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11\n    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0\n    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58\n    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z"\n  />',{viewBox:{x:1792,y:1792}}),g=new r.default('<path fill="ACTIVE_COLOR" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26\n    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45\n    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26\n    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5\n    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32\n    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5\n    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26\n    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26\n    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161\n    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161\n    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z"\n  />',{viewBox:{x:1792,y:1792}}),v=new r.default('<path transform="translate(0,1792) scale(1,-1)" fill="ACTIVE_COLOR" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15\n      34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38\n      0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38\n      0 69.5 20.5t47.5 54.5z"\n    />',{viewBox:{x:2048,y:1792}}),y=new r.default('<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z"\n    />',{viewBox:{x:512,y:512}}),b=new r.default('<path fill="ACTIVE_COLOR" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17\n      39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355\n      355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59\n      39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12\n      0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144\n      144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19\n      45v448q0 42-39 59-13 5-25 5-26 0-45-19z"\n    />',{viewBox:{x:1792,y:1792}}),x=new r.default('<path fill="ACTIVE_COLOR" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39\n      14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5\n      163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0\n      225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109\n      132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298\n      164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14\n      39 17 39 59z"\n    />',{viewBox:{x:1792,y:1792}}),w=new r.default('<path fill="ACTIVE_COLOR" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0\n      0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547\n      0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z"\n      />',{viewBox:{x:24,y:28}}),_=new r.default('<path fill="ACTIVE_COLOR" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119\n    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5\n    84.5t84.5 203.5z"\n  />',{viewBox:{x:1792,y:1792}}),S=new r.default('<path fill="ACTIVE_COLOR" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />\n    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="ACTIVE_COLOR" />',{viewBox:{x:18,y:18}}),E=new r.default('<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z"\n    />\n    <path fill="ACTIVE_COLOR" transform="scale(0.22,0.22) translate(1400,0)" d="M1216\n      320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19\n      19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26\n      0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z"\n    />',{viewBox:{x:640,y:512}}),T={x:127,y:60},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ACTIVE_COLOR";return'<rect fill="'.concat(e,'" x="80.19" y="25.03" width="47.14" height="15.85"/>')},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ACTIVE_COLOR";return'<rect fill="'.concat(e,'" x="80.19" y="25.03" width="47.14" height="15.85"/>\n      <rect fill="').concat(e,'" x="95.84" y="9.38" width="15.85" height="47.14"/>')},I='<path fill="ACTIVE_COLOR" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',O='<path fill="ACTIVE_COLOR" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',A='<path fill="ACTIVE_COLOR" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',D=new r.default("".concat(I," ").concat(k()),{viewBox:T}),M=new r.default("".concat(I," ").concat(C()),{viewBox:T}),N=new r.default("".concat(I," ").concat(k()),{viewBox:T}),j=new r.default("".concat(I," ").concat(C()),{viewBox:T}),R=new r.default("".concat(O," ").concat(k()),{viewBox:T}),P=new r.default("".concat(O," ").concat(C()),{viewBox:T}),F=new r.default("".concat(O," ").concat(k()),{viewBox:T}),L=new r.default("".concat(O," ").concat(C()),{viewBox:T}),$=new r.default("".concat(A," ").concat(k()),{viewBox:T}),B=new r.default("".concat(A," ").concat(C()),{viewBox:T}),z=new r.default("".concat(A," ").concat(k()),{viewBox:T}),U=new r.default("".concat(A," ").concat(C()),{viewBox:T})},"./tools/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./tools/CrosshairsTool.js");n.d(t,"CrosshairsTool",(function(){return r.default}));var i=n("./tools/DoubleTapFitToWindowTool.js");n.d(t,"DoubleTapFitToWindowTool",(function(){return i.default}));var a=n("./tools/DragProbeTool.js");n.d(t,"DragProbeTool",(function(){return a.default}));var o=n("./tools/EraserTool.js");n.d(t,"EraserTool",(function(){return o.default}));var s=n("./tools/FreehandRoiSculptorTool.js");n.d(t,"FreehandRoiSculptorTool",(function(){return s.default}));var l=n("./tools/MagnifyTool.js");n.d(t,"MagnifyTool",(function(){return l.default}));var u=n("./tools/OverlayTool.js");n.d(t,"OverlayTool",(function(){return u.default}));var c=n("./tools/OrientationMarkersTool.js");n.d(t,"OrientationMarkersTool",(function(){return c.default}));var d=n("./tools/PanMultiTouchTool.js");n.d(t,"PanMultiTouchTool",(function(){return d.default}));var h=n("./tools/PanTool.js");n.d(t,"PanTool",(function(){return h.default}));var f=n("./tools/ReferenceLinesTool.js");n.d(t,"ReferenceLinesTool",(function(){return f.default}));var p=n("./tools/RotateTool.js");n.d(t,"RotateTool",(function(){return p.default}));var m=n("./tools/RotateTouchTool.js");n.d(t,"RotateTouchTool",(function(){return m.default}));var g=n("./tools/ScaleOverlayTool.js");n.d(t,"ScaleOverlayTool",(function(){return g.default}));var v=n("./tools/StackScrollMouseWheelTool.js");n.d(t,"StackScrollMouseWheelTool",(function(){return v.default}));var y=n("./tools/StackScrollMultiTouchTool.js");n.d(t,"StackScrollMultiTouchTool",(function(){return y.default}));var b=n("./tools/StackScrollTool.js");n.d(t,"StackScrollTool",(function(){return b.default}));var x=n("./tools/WwwcRegionTool.js");n.d(t,"WwwcRegionTool",(function(){return x.default}));var w=n("./tools/WwwcTool.js");n.d(t,"WwwcTool",(function(){return w.default}));var _=n("./tools/ZoomMouseWheelTool.js");n.d(t,"ZoomMouseWheelTool",(function(){return _.default}));var S=n("./tools/ZoomTool.js");n.d(t,"ZoomTool",(function(){return S.default}));var E=n("./tools/ZoomTouchPinchTool.js");n.d(t,"ZoomTouchPinchTool",(function(){return E.default})),t.default={CrosshairsTool:r.default,DoubleTapFitToWindowTool:i.default,DragProbeTool:a.default,EraserTool:o.default,FreehandRoiSculptorTool:s.default,MagnifyTool:l.default,OverlayTool:u.default,OrientationMarkersTool:c.default,PanMultiTouchTool:d.default,PanTool:h.default,ReferenceLinesTool:f.default,RotateTool:p.default,RotateTouchTool:m.default,ScaleOverlayTool:g.default,StackScrollMouseWheelTool:v.default,StackScrollMultiTouchTool:y.default,StackScrollTool:b.default,WwwcRegionTool:x.default,WwwcTool:w.default,ZoomMouseWheelTool:_.default,ZoomTool:S.default,ZoomTouchPinchTool:E.default}},"./tools/referenceLines/calculateReferenceLine.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/pointProjector.js");t.default=function(e,t){var n=Object(r.planePlaneIntersection)(e,t);if(n)return{start:Object(r.projectPatientPointToImagePlane)(n.start,e),end:Object(r.projectPatientPointToImagePlane)(n.end,e)}}},"./tools/referenceLines/renderActiveReferenceLine.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./tools/referenceLines/calculateReferenceLine.js"),a=n("./stateManagement/toolColors.js"),o=n("./util/convertToVector3.js"),s=n("./drawing/index.js");t.default=function(e,t,n,l){var u=r.default.cornerstone,c=u.getEnabledElement(n).image,d=u.getEnabledElement(l).image;if(c&&d){var h=u.metaData.get("imagePlaneModule",c.imageId),f=u.metaData.get("imagePlaneModule",d.imageId);if(h&&f&&h.rowCosines&&h.columnCosines&&h.imagePositionPatient&&f.rowCosines&&f.columnCosines&&f.imagePositionPatient&&h.frameOfReferenceUID===f.frameOfReferenceUID){h.rowCosines=Object(o.default)(h.rowCosines),h.columnCosines=Object(o.default)(h.columnCosines),h.imagePositionPatient=Object(o.default)(h.imagePositionPatient),f.rowCosines=Object(o.default)(f.rowCosines),f.columnCosines=Object(o.default)(f.columnCosines),f.imagePositionPatient=Object(o.default)(f.imagePositionPatient);var p=h.rowCosines.clone().cross(h.columnCosines),m=f.rowCosines.clone().cross(f.columnCosines),g=p.angleTo(m);if(!((g=Math.abs(g))<.5)){var v=Object(i.default)(h,f);if(v){var y=a.default.getActiveColor();e.setTransform(1,0,0,1,0,0),Object(s.draw)(e,(function(e){Object(s.drawLine)(e,t.element,v.start,v.end,{color:y})}))}}}}}},"./tools/segmentation/BrushTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return w}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./externalModules.js"),g=n("./tools/base/index.js"),v=n("./store/index.js"),y=n("./util/segmentation/index.js"),b=n("./util/logger.js"),x=(Object(b.getLogger)("tools:BrushTool"),Object(v.getModule)("segmentation")),w=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Brush",supportedInteractionTypes:["Mouse","Touch"],configuration:{},mixins:["renderBrushMixin"]};return(e=l()(this,c()(t).call(this,n,r))).touchDragCallback=e._paint.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_paint",value:function(e){var t=e.detail,n=t.image,r=n.rows,i=n.columns,a=t.currentPoints.image,o=a.x,s=a.y;if(!(o<0||o>i||s<0||s>r)){var l=x.configuration.radius,u=Object(y.getCircle)(l,r,i,o,s),c=this.paintEventData,d=c.labelmap2D,h=c.labelmap3D,f=c.shouldErase;Object(y.drawBrushPixels)(u,d.pixelData,h.activeSegmentIndex,i,f),m.default.cornerstone.updateImage(e.detail.element)}}}]),t}(g.BaseBrushTool)},"./tools/segmentation/CircleScissorsTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/inherits.js"),c=n.n(u),d=n("./tools/base/index.js"),h=n("./tools/segmentation/strategies/index.js"),f=n("./tools/cursors/index.js"),p=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"CircleScissors",strategies:{FILL_INSIDE:h.fillInsideCircle,FILL_OUTSIDE:h.fillOutsideCircle,ERASE_OUTSIDE:h.eraseOutsideCircle,ERASE_INSIDE:h.eraseInsideCircle},cursors:{FILL_INSIDE:f.segCircleFillInsideCursor,FILL_OUTSIDE:f.segCircleFillOutsideCursor,ERASE_OUTSIDE:f.segCircleEraseOutsideCursor,ERASE_INSIDE:f.segCircleEraseInsideCursor},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],svgCursor:f.segCircleFillInsideCursor,mixins:["circleSegmentationMixin"]};return o()(this,l()(t).call(this,e,n))}return c()(t,e),t}(d.BaseTool)},"./tools/segmentation/CorrectionScissorsTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/inherits.js"),c=n.n(u),d=n("./tools/base/index.js"),h=n("./tools/cursors/index.js"),f=n("./tools/segmentation/strategies/index.js"),p=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"CorrectionScissors",strategies:{CORRECTION:f.correction},cursors:{CORRECTION:h.freehandFillInsideCursor},defaultStrategy:"CORRECTION",supportedInteractionTypes:["Mouse","Touch"],svgCursor:h.freehandFillInsideCursor,mixins:["polylineSegmentationMixin"]};return o()(this,l()(t).call(this,e,n))}return c()(t,e),t}(d.BaseTool)},"./tools/segmentation/FreehandScissorsTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return f}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/inherits.js"),c=n.n(u),d=n("./tools/cursors/index.js"),h=n("./tools/segmentation/strategies/index.js"),f=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"FreehandScissors",strategies:{FILL_INSIDE:h.fillInsideFreehand,FILL_OUTSIDE:h.fillOutsideFreehand,ERASE_OUTSIDE:h.eraseOutsideFreehand,ERASE_INSIDE:h.eraseInsideFreehand},cursors:{FILL_INSIDE:d.freehandFillInsideCursor,FILL_OUTSIDE:d.freehandFillOutsideCursor,ERASE_OUTSIDE:d.freehandEraseOutsideCursor,ERASE_INSIDE:d.freehandEraseInsideCursor},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],svgCursor:d.freehandFillInsideCursor,mixins:["freehandSegmentationMixin"]};return o()(this,l()(t).call(this,e,n))}return c()(t,e),t}(n("./tools/base/index.js").BaseTool)},"./tools/segmentation/RectangleScissorsTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/inherits.js"),c=n.n(u),d=n("./tools/base/index.js"),h=n("./tools/segmentation/strategies/index.js"),f=n("./tools/cursors/index.js"),p=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"RectangleScissors",strategies:{FILL_INSIDE:h.fillInsideRectangle,FILL_OUTSIDE:h.fillOutsideRectangle,ERASE_OUTSIDE:h.eraseOutsideRectangle,ERASE_INSIDE:h.eraseInsideRectangle},cursors:{FILL_INSIDE:f.segRectangleFillInsideCursor,FILL_OUTSIDE:f.segRectangleFillOutsideCursor,ERASE_OUTSIDE:f.segRectangleEraseOutsideCursor,ERASE_INSIDE:f.segRectangleEraseInsideCursor},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],mixins:["rectangleSegmentationMixin"]};return o()(this,l()(t).call(this,e,n))}return c()(t,e),t}(d.BaseTool)},"./tools/segmentation/SphericalBrushTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return S}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=n.n(s),u=n("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),c=n.n(u),d=n("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),h=n.n(d),f=n("../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(f),m=n("./externalModules.js"),g=n("./tools/base/BaseBrushTool.js"),v=n("./store/index.js"),y=n("./util/segmentation/index.js"),b=n("./stateManagement/toolState.js"),x=n("./util/logger.js"),w=Object(x.getLogger)("tools:SphericalBrushTool"),_=Object(v.getModule)("segmentation"),S=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"SphericalBrush",supportedInteractionTypes:["Mouse","Touch"],configuration:{alwaysEraseOnClick:!1},mixins:["renderBrushMixin"]};return(e=l()(this,c()(t).call(this,n,r))).touchDragCallback=e._paint.bind(h()(e)),e}return p()(t,e),o()(t,[{key:"_startPainting",value:function(e){var t,n=_.configuration,r=_.getters,i=e.detail,a=i.element,o=i.image,s=m.default.cornerstone,l=n.radius,u=o.rows,c=o.columns,d=Math.max(o.rowPixelSpacing,o.columnPixelSpacing),h=Object(b.getToolState)(a,"stack").data[0].imageIds,f=r.labelmap2D(a),p=f.labelmap2D,g=f.labelmap3D,v=f.currentImageIdIndex,y=f.activeLabelmapIndex,x=this._isCtrlDown(i)||this.configuration.alwaysEraseOnClick,S=s.metaData.get("imagePlaneModule",o.imageId);if(S?t=this._getImagesInRange(v,S.imagePositionPatient,h,l,d):(w.warn("No imagePlane metadata found for image, defaulting to circle brush application."),t=[{imageIdIndex:v,radiusOnImage:l}]),this.paintEventData={labelmap2D:p,labelmap3D:g,currentImageIdIndex:v,activeLabelmapIndex:y,shouldErase:x,imagesInRange:t},n.storeHistory){for(var E=[],T=0;T<t.length;T++){var k=r.labelmap2DByImageIdIndex(g,t[T].imageIdIndex,u,c).pixelData.slice();E.push(k)}this.paintEventData.previousPixeldataForImagesInRange=E}}},{key:"_paint",value:function(e){var t=_.getters,n=e.detail,r=n.image,i=r.rows,a=r.columns,o=n.currentPoints.image,s=o.x,l=o.y;if(!(s<0||s>a||l<0||l>i)){for(var u=this.paintEventData,c=u.labelmap3D,d=u.imagesInRange,h=u.shouldErase,f=0;f<d.length;f++){var p=d[f],g=p.imageIdIndex,v=p.radiusOnImage,b=Object(y.getCircle)(v,i,a,s,l),x=t.labelmap2DByImageIdIndex(c,g,i,a);Object(y.drawBrushPixels)(b,x.pixelData,c.activeSegmentIndex,a,h)}m.default.cornerstone.updateImage(e.detail.element)}}},{key:"_getImagesInRange",value:function(e,t,n,r,i){for(var a=r*i,o=[{imageIdIndex:e,radiusOnImage:r}],s=e+1;s<n.length;s++){var l=this._getRadiusOnImage(n[s],t,a,i);if(!l)break;o.push({imageIdIndex:s,radiusOnImage:l})}for(var u=e-1;u>=0;u--){var c=this._getRadiusOnImage(n[u],t,a,i);if(!c)break;o.push({imageIdIndex:u,radiusOnImage:c})}return o}},{key:"_getRadiusOnImage",value:function(e,t,n,r){var i=m.default.cornerstone.metaData.get("imagePlaneModule",e);if(i){var a=i.imagePositionPatient,o=Math.sqrt(Math.pow(a[0]-t[0],2)+Math.pow(a[1]-t[1],2)+Math.pow(a[2]-t[2],2));if(!(o>n))return Math.floor(Math.sqrt(Math.pow(n,2)-Math.pow(o,2))/r)}else w.warn("Can't find imagePlane metadata for image, cancelling spherical brushing on: ".concat(e,","))}},{key:"_endPainting",value:function(e){for(var t=this.paintEventData,n=t.labelmap3D,r=t.imagesInRange,i=[],a=_.configuration,o=_.setters,s=0;s<r.length;s++){for(var l=r[s].imageIdIndex,u=n.labelmaps2D[l],c=new Set(u.pixelData).values(),d=[],h=!1;!h;){var f=c.next();(h=f.done)||d.push(f.value)}if(u.segmentsOnLabelmap=d,a.storeHistory){var p=this.paintEventData.previousPixeldataForImagesInRange[s],m=n.labelmaps2D[l].pixelData;i.push({imageIdIndex:l,diff:Object(y.getDiffBetweenPixelData)(p,m)})}}a.storeHistory&&o.pushState(this.element,i),Object(y.triggerLabelmapModifiedEvent)(this.element)}}]),t}(g.default)},"./tools/segmentation/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./tools/segmentation/BrushTool.js"),i=n("./tools/segmentation/SphericalBrushTool.js"),a=n("./tools/segmentation/FreehandScissorsTool.js"),o=n("./tools/segmentation/RectangleScissorsTool.js"),s=n("./tools/segmentation/CircleScissorsTool.js"),l=n("./tools/segmentation/CorrectionScissorsTool.js");n.d(t,"BrushTool",(function(){return r.default})),n.d(t,"SphericalBrushTool",(function(){return i.default})),n.d(t,"FreehandScissorsTool",(function(){return a.default})),n.d(t,"RectangleScissorsTool",(function(){return o.default})),n.d(t,"CircleScissorsTool",(function(){return s.default})),n.d(t,"CorrectionScissorsTool",(function(){return l.default})),t.default={BrushTool:r.default,SphericalBrushTool:i.default,CircleScissorsTool:s.default,CorrectionScissorsTool:l.default,FreehandScissorsTool:a.default,RectangleScissorsTool:o.default}},"./tools/segmentation/strategies/correction.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return d}));var r=n("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=n.n(r),a=n("./tools/segmentation/strategies/index.js"),o=n("./util/segmentation/index.js"),s=n("./util/clip.js"),l=n("./util/isPointInImage.js"),u=n("./util/logger.js"),c=Object(u.getLogger)("util:segmentation:operations:correction");function d(e,t){var n=t.pixelData,r=t.segmentIndex,u=t.segmentationMixinType;if("freehandSegmentationMixin"===u){var d=function(e,t){for(var n=t.pixelData,r=t.points,i=e.detail.image,a=i.width,o=i.height,l=[],u=0;u<r.length;u++){var c=r[u],d=Math.floor(c.x),h=Math.floor(c.y);d=Object(s.default)(d,0,a-1),h=Object(s.default)(h,0,o-1);var f=l[l.length-1];f&&d===f.x&&h===f.y||l.push({x:d,y:h,segment:n[h*a+d]})}return l}(e,t),p=function(e,t){for(var n=!0,r=!0,i=0;i<e.length&&(e[i].segment===t?r=!1:n=!1,n||r);i++);return r?{isScissorOperation:!0,operation:"fillInsideFreehand"}:n?{isScissorOperation:!0,operation:"eraseInsideFreehand"}:{isScissorOperation:!1}}(d,r);if(p.isScissorOperation)"fillInsideFreehand"===p.operation?(c.warn("The line never intersects a segment."),Object(a.fillInsideFreehand)(e,t)):"eraseInsideFreehand"===p.operation&&(c.warn("The line is only ever inside the segment."),Object(a.eraseInsideFreehand)(e,t));else{var m=new Uint8Array(n.length);(function(e,t){var n=e[0].segment===t,r=[];r.push({additive:!n,nodes:[]});for(var i=0,a=0;a<e.length;a++){var o=e[a];n?(r[i].nodes.push(o),o.segment!==t&&(i++,n=!n,r.push({additive:!0,nodes:[]}),r[i].nodes.push(e[a-1]),r[i].nodes.push(o))):(r[i].nodes.push(o),o.segment===t&&(i++,n=!n,r.push({additive:!1,nodes:[]}),r[i].nodes.push(e[a-1]),r[i].nodes.push(o)))}return r.pop(),r.shift(),r})(d,r).forEach((function(t){!function(e,t,n,r,a){var s=a.detail.image,u=s.width,d=s.height,p=e.nodes,m=e.additive,g=m?0:1,v=function(e){return e.y*u+e.x},y=function(e){return{x:e%u,y:Math.floor(e/u)}};c.warn(m?"additive operation...":"subtractive operation...");for(var b=function(e){for(var t=[],n=0;n<e.length-1;n++)t.push(e[n]),t.push.apply(t,i()(Object(o.getPixelPathBetweenPixels)(e[n],e[n+1])));for(var r=[],a=[],s=0;s<t.length-1;s++){var l=(void 0,-1===(f={x:(h=t[s+1]).x-(d=t[s]).x,y:h.y-d.y}).x&&1===f.y?{left:{x:d.x-1,y:d.y-1},right:{x:d.x+1,y:d.y+1}}:0===f.x&&1===f.y?{left:{x:d.x-1,y:d.y},right:{x:d.x+1,y:d.y}}:1===f.x&&1===f.y?{left:{x:d.x-1,y:d.y+1},right:{x:d.x+1,y:d.y-1}}:1===f.x&&0===f.y?{left:{x:d.x,y:d.y+1},right:{x:d.x,y:d.y-1}}:1===f.x&&-1===f.y?{left:{x:d.x+1,y:d.y+1},right:{x:d.x-1,y:d.y-1}}:0===f.x&&-1===f.y?{left:{x:d.x+1,y:d.y},right:{x:d.x-1,y:d.y}}:-1===f.x&&-1===f.y?{left:{x:d.x+1,y:d.y-1},right:{x:d.x-1,y:d.y+1}}:-1===f.x&&0===f.y?{left:{x:d.x,y:d.y-1},right:{x:d.x,y:d.y+1}}:void c.error("Unable to find left and right paths for flood fill ",d,h,f)),u=l.right;r.push(l.left),a.push(u)}var d,h,f;return{pixelPath:t,leftPath:r,rightPath:a}}(p),x=b.pixelPath,w=b.leftPath,_=b.rightPath,S=x[0],E={xMin:S.x,xMax:S.x,yMin:S.y,yMax:S.y},T=0;T<n.length;T++)t[T]===r?(h(E,y(T)),n[T]=1):n[T]=0;for(var k=0;k<x.length;k++){var C=x[k];n[v(C)]=2,h(E,C)}!function(e,t,n){e.xMax=Math.min(e.xMax+2,n),e.xMin=Math.max(e.xMin-2,0),e.yMax=Math.min(e.yMax+2,t),e.yMin=Math.max(e.yMin-2,0)}(E,d,u);var I=E.xMin,O=E.xMax,A=E.yMin,D=E.yMax;function M(e,t){if(!(e>=O||e<I||t>=D||t<A))return n[t*u+e]}for(var N=0,j=0,R=0;R<w.length;R++){var P=w[R];n[v(P)]===g&&Object(l.default)(P,d,u)&&(N+=f(P,3,n,M,u));var F=_[R];n[v(F)]===g&&Object(l.default)(F,d,u)&&(j+=f(F,4,n,M,u))}if(0!==N&&0!==j){for(var L=m?r:0,$=N<j?3:4,B=0;B<n.length;B++)n[B]===$&&(t[B]=L);if(L===r)for(var z=0;z<x.length;z++)t[v(x[z])]=r;else for(var U=0;U<x.length;U++){var H=v(x[U]);t[H]===r&&(t[H]=0)}}}(t,n,m,r,e)}))}}else c.error("correction operation requires freehandSegmentationMixin operationData, recieved ".concat(u))}function h(e,t){var n=t.x,r=t.y;n<e.xMin&&(e.xMin=n),n>e.xMax&&(e.xMax=n),r<e.yMin&&(e.yMin=r),r>e.yMax&&(e.yMax=r)}function f(e,t,n,r,i){for(var a=Object(o.floodFill)(r,[e.x,e.y]).flooded,s=0;s<a.length;s++){var l=a[s];n[l[1]*i+l[0]]=t}return a.length}},"./tools/segmentation/strategies/eraseCircle.js":function(e,t,n){"use strict";n.r(t),n.d(t,"eraseInsideCircle",(function(){return d})),n.d(t,"eraseOutsideCircle",(function(){return h}));var r=n("../node_modules/@babel/runtime/helpers/slicedToArray.js"),i=n.n(r),a=n("./util/ellipse/index.js"),o=n("./util/logger.js"),s=n("./util/segmentation/index.js"),l=n("./util/getCircleCoords.js"),u=Object(o.getLogger)("util:segmentation:operations:eraseInsideCircle");function c(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.segmentationMixinType;if("circleSegmentationMixin"===r){var o=e.detail,c=Object(s.getBoundingBoxAroundCircle)(e),d=i()(c,2),h=d[0],f=d[1],p=Object(l.default)(o.handles.start,o.handles.end);n?Object(s.eraseInsideShape)(e,t,(function(e){return Object(a.pointInEllipse)(p,e)}),h,f):Object(s.eraseOutsideShape)(e,t,(function(e){return Object(a.pointInEllipse)(p,e)}),h,f)}else u.error("eraseInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(r))}function d(e,t){c(e,t,!0)}function h(e,t){c(e,t,!1)}},"./tools/segmentation/strategies/eraseFreehand.js":function(e,t,n){"use strict";n.r(t),n.d(t,"eraseInsideFreehand",(function(){return c})),n.d(t,"eraseOutsideFreehand",(function(){return d}));var r=n("../node_modules/@babel/runtime/helpers/slicedToArray.js"),i=n.n(r),a=n("./util/segmentation/index.js"),o=n("./util/isPointInPolygon.js"),s=n("./util/logger.js"),l=Object(s.getLogger)("util:segmentation:operations:eraseInsideFreehand");function u(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.points,s=t.segmentationMixinType;if("freehandSegmentationMixin"===s){var u=e.detail.image,c=r.map((function(e){return[e.x,e.y]})),d=Object(a.getBoundingBoxAroundPolygon)(c,u),h=i()(d,2),f=h[0],p=h[1];n?Object(a.eraseInsideShape)(e,t,(function(e){return Object(o.default)([e.x,e.y],c)}),f,p):Object(a.eraseOutsideShape)(e,t,(function(e){return Object(o.default)([e.x,e.y],c)}),f,p)}else l.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(s))}function c(e,t){u(e,t,!0)}function d(e,t){u(e,t,!1)}},"./tools/segmentation/strategies/eraseRectangle.js":function(e,t,n){"use strict";n.r(t),n.d(t,"eraseInsideRectangle",(function(){return u})),n.d(t,"eraseOutsideRectangle",(function(){return c}));var r=n("../node_modules/@babel/runtime/helpers/slicedToArray.js"),i=n.n(r),a=n("./util/logger.js"),o=n("./util/segmentation/index.js"),s=Object(a.getLogger)("util:segmentation:operations:eraseInsideRectangle");function l(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.points,a=t.segmentationMixinType;if("rectangleSegmentationMixin"===a){var l=e.detail,u=l.image,c=r.map((function(e){return[e.x,e.y]})),d=Object(o.getBoundingBoxAroundPolygon)(c,u),h=i()(d,2),f=h[0],p=h[1];n?Object(o.eraseInsideShape)(e,t,(function(){return!0}),f,p):Object(o.eraseOutsideBoundingBox)(e,t,f,p)}else s.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(a))}function u(e,t){l(e,t,!0)}function c(e,t){l(e,t,!1)}},"./tools/segmentation/strategies/fillCircle.js":function(e,t,n){"use strict";n.r(t),n.d(t,"fillInsideCircle",(function(){return d})),n.d(t,"fillOutsideCircle",(function(){return h}));var r=n("../node_modules/@babel/runtime/helpers/slicedToArray.js"),i=n.n(r),a=n("./util/segmentation/index.js"),o=n("./util/ellipse/index.js"),s=n("./util/getCircleCoords.js"),l=n("./util/logger.js"),u=Object(l.getLogger)("util:segmentation:operations:fillCircle");function c(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.segmentationMixinType;if("circleSegmentationMixin"===r){var l=e.detail,c=Object(a.getBoundingBoxAroundCircle)(e),d=i()(c,2),h=d[0],f=d[1],p=Object(s.default)(l.handles.start,l.handles.end);n?Object(a.fillInsideShape)(e,t,(function(e){return Object(o.pointInEllipse)(p,e)}),h,f):Object(a.fillOutsideShape)(e,t,(function(e){return Object(o.pointInEllipse)(p,e)}),h,f)}else u.error("fillInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(r))}function d(e,t){c(e,t,!0)}function h(e,t){c(e,t,!1)}},"./tools/segmentation/strategies/fillFreehand.js":function(e,t,n){"use strict";n.r(t),n.d(t,"fillInsideFreehand",(function(){return c})),n.d(t,"fillOutsideFreehand",(function(){return d}));var r=n("../node_modules/@babel/runtime/helpers/slicedToArray.js"),i=n.n(r),a=n("./util/segmentation/index.js"),o=n("./util/isPointInPolygon.js"),s=n("./util/logger.js"),l=Object(s.getLogger)("util:segmentation:operations:fillInsideFreehand");function u(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.points,s=t.segmentationMixinType;if("freehandSegmentationMixin"===s){var u=e.detail.image,c=r.map((function(e){return[e.x,e.y]})),d=Object(a.getBoundingBoxAroundPolygon)(c,u),h=i()(d,2),f=h[0],p=h[1];n?Object(a.fillInsideShape)(e,t,(function(e){return Object(o.default)([e.x,e.y],c)}),f,p):Object(a.fillOutsideShape)(e,t,(function(e){return Object(o.default)([e.x,e.y],c)}),f,p)}else l.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(s))}function c(e,t){u(e,t,!0)}function d(e,t){u(e,t,!1)}},"./tools/segmentation/strategies/fillRectangle.js":function(e,t,n){"use strict";n.r(t),n.d(t,"fillInsideRectangle",(function(){return u})),n.d(t,"fillOutsideRectangle",(function(){return c}));var r=n("../node_modules/@babel/runtime/helpers/slicedToArray.js"),i=n.n(r),a=n("./util/segmentation/index.js"),o=n("./util/logger.js"),s=Object(o.getLogger)("util:segmentation:operations:fillInsideRectangle");function l(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.points,o=t.segmentationMixinType;if("rectangleSegmentationMixin"===o){var l=e.detail.image,u=r.map((function(e){return[e.x,e.y]})),c=Object(a.getBoundingBoxAroundPolygon)(u,l),d=i()(c,2),h=d[0],f=d[1];n?Object(a.fillInsideShape)(e,t,(function(){return!0}),h,f):Object(a.fillOutsideBoundingBox)(e,t,h,f)}else s.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(o))}function u(e,t){l(e,t,!0)}function c(e,t){l(e,t,!1)}},"./tools/segmentation/strategies/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./tools/segmentation/strategies/correction.js");n.d(t,"correction",(function(){return r.default}));var i=n("./tools/segmentation/strategies/eraseFreehand.js");n.d(t,"eraseInsideFreehand",(function(){return i.eraseInsideFreehand})),n.d(t,"eraseOutsideFreehand",(function(){return i.eraseOutsideFreehand}));var a=n("./tools/segmentation/strategies/eraseRectangle.js");n.d(t,"eraseInsideRectangle",(function(){return a.eraseInsideRectangle})),n.d(t,"eraseOutsideRectangle",(function(){return a.eraseOutsideRectangle}));var o=n("./tools/segmentation/strategies/fillFreehand.js");n.d(t,"fillInsideFreehand",(function(){return o.fillInsideFreehand})),n.d(t,"fillOutsideFreehand",(function(){return o.fillOutsideFreehand}));var s=n("./tools/segmentation/strategies/fillRectangle.js");n.d(t,"fillInsideRectangle",(function(){return s.fillInsideRectangle})),n.d(t,"fillOutsideRectangle",(function(){return s.fillOutsideRectangle}));var l=n("./tools/segmentation/strategies/fillCircle.js");n.d(t,"fillInsideCircle",(function(){return l.fillInsideCircle})),n.d(t,"fillOutsideCircle",(function(){return l.fillOutsideCircle}));var u=n("./tools/segmentation/strategies/eraseCircle.js");n.d(t,"eraseInsideCircle",(function(){return u.eraseInsideCircle})),n.d(t,"eraseOutsideCircle",(function(){return u.eraseOutsideCircle}))},"./util/SaveAs.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",r=e.querySelector("canvas");if(r.msToBlob){var i=r.msToBlob();return window.navigator.msSaveBlob(i,t)}var a=document.createElement("a");if(a.download=t,a.href=r.toDataURL(n,1),document.createEvent){var o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(o)}else a.fireEvent&&a.fireEvent("onclick")}},"./util/angleBetweenPoints.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){var r=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),i=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)),a=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2));return{angle:180*Math.acos((Math.pow(r,2)+Math.pow(i,2)-Math.pow(a,2))/(2*r*i))/Math.PI,direction:(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)}}},"./util/calculateSUV.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");function i(e){return parseFloat(".".concat(e))}t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=r.default.cornerstone,o=a.metaData.get("patientStudyModule",e.imageId),s=a.metaData.get("generalSeriesModule",e.imageId);if(o&&s){var l=s.modality;if("PT"===l){var u=n?t:t*e.slope+e.intercept,c=o.patientWeight;if(c){var d=a.metaData.get("petIsotopeModule",e.imageId);if(d){var h=d.radiopharmaceuticalInfo,f=h.radiopharmaceuticalStartTime,p=h.radionuclideTotalDose,m=h.radionuclideHalfLife,g=s.seriesTime;if(f&&p&&m&&g){var v=i(g.fractionalSeconds||0)+g.seconds+60*g.minutes+60*g.hours*60,y=i(f.fractionalSeconds||0)+f.seconds+60*f.minutes+60*f.hours*60,b=v-y,x=p*Math.exp(-b*Math.log(2)/m),w=u*c/x*1e3;return w}}}}}}},"./util/clip.js":function(e,t,n){"use strict";function r(e,t,n){return Math.min(Math.max(t,e),n)}function i(e,t){e.x=r(e.x,0,t.width),e.y=r(e.y,0,t.height)}n.r(t),n.d(t,"clip",(function(){return r})),n.d(t,"clipToBox",(function(){return i})),t.default=r},"./util/convertToVector3.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./externalModules.js");function i(e){var t=r.default.cornerstoneMath;if(e instanceof t.Vector3)return e;var n=Object.keys(e);return n.includes("x")&&n.includes("y")&&n.includes("z")?new t.Vector3(e.x,e.y,e.z):new t.Vector3(e[0],e[1],e[2])}},"./util/copyPoints.js":function(e,t,n){"use strict";function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.x,n=e.y;return{x:t,y:n}}n.r(t),t.default=function(e){return{page:r(e.page),image:r(e.image),client:r(e.client),canvas:r(e.canvas)}}},"./util/debounce.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/isObject.js");t.default=function(e,t,n){var i,a,o,s,l,u,c=0,d=!1,h=!1,f=!0,p=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var n=i,r=a;return i=a=void 0,c=t,s=e.apply(r,n)}function g(e,t){return p?window.requestAnimationFrame(e):setTimeout(e,t)}function v(e){return c=e,l=g(b,t),d?m(e):s}function y(e){var n=e-u;return void 0===u||n>=t||n<0||h&&e-c>=o}function b(){var e=Date.now();if(y(e))return x(e);l=g(b,function(e){var n=t-(e-u);return h?Math.min(n,o-(e-c)):n}(e))}function x(e){return l=void 0,f&&i?m(e):(i=a=void 0,s)}function w(){for(var e=Date.now(),n=y(e),r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];if(i=o,a=this,u=e,n){if(void 0===l)return v(u);if(h)return l=g(b,t),m(u)}return void 0===l&&(l=g(b,t)),s}return t=Number(t)||0,Object(r.default)(n)&&(d=Boolean(n.leading),o=(h="maxWait"in n)?Math.max(Number(n.maxWait)||0,t):o,f="trailing"in n?Boolean(n.trailing):f),w.cancel=function(){void 0!==l&&function(e){if(p)return window.cancelAnimationFrame(e);clearTimeout(e)}(l),c=0,i=u=a=l=void 0},w.flush=function(){return void 0===l?s:x(Date.now())},w.pending=function(){return void 0!==l},w}},"./util/debugLib/common.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=n.n(r);t.default=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){var n;function i(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];if(i.enabled){var o=i,s=Number(new Date),l=s-(n||s);o.diff=l,o.prev=n,o.curr=s,n=s,t[0]=r.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var u=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,n){if("%%"===e)return e;u++;var i=r.formatters[n];return"function"==typeof i&&(e=i.call(o,t[u]),t.splice(u,1),u--),e})),r.formatArgs.call(o,t);var c=o.log||r.log;c.apply(o,t)}}return i.namespace=e,i.enabled=r.enabled(e),i.useColors=r.useColors(),i.color=t(e),i.destroy=a,i.extend=o,"function"==typeof r.init&&r.init(i),r.instances.push(i),i}function a(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function o(e,t){var n=r(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){var e=[].concat(i()(r.names.map(s)),i()(r.skips.map(s).map((function(e){return"-".concat(e)})))).join(",");return r.enable(""),e},r.enable=function(e){var t;r.save(e),r.names=[],r.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^".concat(e.substr(1),"$"))):r.names.push(new RegExp("^".concat(e,"$"))));for(t=0;t<r.instances.length;t++){var a=r.instances[t];a.enabled=r.enabled(a.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n("../node_modules/ms/index.js"),Object.keys(e).forEach((function(t){r[t]=e[t]})),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},"./util/debugLib/index.js":function(e,t,n){"use strict";n.r(t),(function(e){var r=n("./util/debugLib/common.js"),i={formatArgs:function(e){if(e[0]="".concat((this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" "),"+").concat(a.humanize(this.diff)),this.useColors){var t="color: ".concat(this.color);e.splice(1,0,t,"color: inherit");var n=0,r=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(r=n))})),e.splice(r,0,t)}},save:function(e){try{e?i.storage.setItem("debug",e):i.storage.removeItem("debug")}catch(t){}},load:function(){var t;try{t=i.storage.getItem("debug")}catch(n){console.warn(n)}return!t&&void 0!==e&&"env"in e&&(t=e.env.DEBUG),t},useColors:function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},storage:function(){try{return localStorage}catch(e){}}(),colors:["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"]};i.log=console.debug||console.log||function(){};var a=Object(r.default)(i);a.formatters.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: ".concat(t.message)}},t.default=a}).call(this,n("../node_modules/process/browser.js"))},"./util/deepmerge.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/typeof.js"),i=n.n(r),a=function(e){return e&&"object"===i()(e)&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)},o=function(e,t){return t&&!0===t.clone&&a(e)?u(Array.isArray(e)?[]:{},e,t):e},s=function(e,t,n){var r=e.slice();return t.forEach((function(t,i){void 0===r[i]?r[i]=o(t,n):a(t)?r[i]=u(e[i],t,n):-1===e.indexOf(t)&&r.push(o(t,n))})),r},l=function(e,t,n){var r={};return a(e)&&Object.keys(e).forEach((function(t){r[t]=o(e[t],n)})),Object.keys(t).forEach((function(i){r[i]=a(t[i])&&e[i]?u(e[i],t[i],n):o(t[i],n)})),r},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=Array.isArray(t),i=n||{arrayMerge:s},a=i.arrayMerge||s;return r?Array.isArray(e)?a(e,t,n):o(t,n):l(e,t,n)};t.default=u},"./util/ellipse/calculateEllipseStatistics.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/ellipse/pointInEllipse.js");t.default=function(e,t){for(var n=0,i=0,a=0,o=0,s=null,l=null,u=t.top;u<t.top+t.height;u++)for(var c=t.left;c<t.left+t.width;c++){var d={x:c,y:u};Object(r.default)(t,d)&&(null===s&&(s=e[o],l=e[o]),n+=e[o],i+=e[o]*e[o],s=Math.min(s,e[o]),l=Math.max(l,e[o]),a++),o++}if(0===a)return{count:a,mean:0,variance:0,stdDev:0,min:0,max:0};var h=n/a,f=i/a-h*h;return{count:a,mean:h,variance:f,stdDev:Math.sqrt(f),min:s,max:l}}},"./util/ellipse/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/ellipse/calculateEllipseStatistics.js");n.d(t,"calculateEllipseStatistics",(function(){return r.default}));var i=n("./util/ellipse/pointInEllipse.js");n.d(t,"pointInEllipse",(function(){return i.default})),t.default={calculateEllipseStatistics:r.default,pointInEllipse:i.default}},"./util/ellipse/pointInEllipse.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=e.width/2,r=e.height/2;if(n<=0||r<=0)return!1;var i=t.x-(e.left+n),a=t.y-(e.top+r);return i*i/(n*n)+a*a/(r*r)<=1}},"./util/findAndMoveHelpers.js":function(e,t,n){"use strict";n.r(t),n.d(t,"moveHandleNearImagePoint",(function(){return o})),n.d(t,"findHandleDataNearImagePoint",(function(){return s})),n.d(t,"moveAnnotation",(function(){return l}));var r=n("./store/index.js"),i=n("./manipulators/getHandleNearImagePoint.js"),a=n("./manipulators/index.js"),o=function(e,t,n,i,o){n.active=!0,r.state.isToolLocked=!0,Object(a.moveHandle)(e.detail,t.name,n,i,t.options,o),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},s=function(e,t,n,a){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"mouse",s=0;s<t.data.length;s++){var l=t.data[s],u=Object(i.default)(e,l.handles,a,"mouse"===o?r.state.clickProximity:r.state.touchProximity);if(u)return{handle:u,data:l}}},l=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";n.active=!0,r.state.isToolLocked=!0,Object(a.moveAllHandles)(e.detail,t.name,n,null,t.options,i,(function(){n.active=!1,r.state.isToolLocked=!1})),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}},"./util/freehand/ClickedLineData.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=function e(t,n){i()(this,e),this.toolIndex=t,this.handleIndexArray=n}},"./util/freehand/FreehandHandleData.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];i()(this,e),this.x=t.x,this.y=t.y,this.highlight=n,this.active=r,this.lines=[]}},"./util/freehand/FreehandLineFinder.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return c}));var r=n("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(r),a=n("../node_modules/@babel/runtime/helpers/createClass.js"),o=n.n(a),s=n("./stateManagement/toolState.js"),l=n("./externalModules.js"),u=n("./util/freehand/ClickedLineData.js"),c=function(){function e(t,n){i()(this,e),this._eventData=t,this._toolName=n}return o()(e,[{key:"findLine",value:function(){var e=this.findTool();if(null===e)return null;var t=this._getCloseLinesInTool(e);return t?this._findCorrectLine(e,t):null}},{key:"findTool",value:function(){return this._toolData=Object(s.getToolState)(this._eventData.element,this._toolName),this._mousePoint=this._eventData.currentPoints.canvas,this._toolData?this._nearestHandleToPointAllTools().toolIndex:null}},{key:"_nearestHandleToPointAllTools",value:function(){for(var e=this._toolData,t={toolIndex:null,handleIndex:null,distance:1/0},n=0;n<e.data.length;n++){var r=this._nearestHandleToPoint(n);null!==r&&r.distance<t.distance&&(t=r)}return t}},{key:"_nearestHandleToPoint",value:function(e){var t=this._eventData,n=this._toolData.data[e],r=n.handles.points;if(void 0===r)return null;if(!1===n.visible)return null;for(var i={toolIndex:e,handleIndex:null,distance:1/0},a=0;a<r.length;a++){var o=l.default.cornerstone.pixelToCanvas(t.element,r[a]),s=l.default.cornerstoneMath.point.distance(o,this._mousePoint);s<i.distance&&(i.handleIndex=a,i.distance=s)}return i}},{key:"_getCloseLinesInTool",value:function(t){for(var n=this._toolData.data[t].handles.points,r=[],i=0;i<n.length;i++){var a=e.getNextHandleIndex(i,n.length);this._distanceOfPointfromLine(n[i],n[a])<10&&r.push([i,a])}return r}},{key:"_findCorrectLine",value:function(e,t){for(var n=0;n<t.length;n++)if(this._pointProjectsToLineSegment(e,t[n]))return new u.default(e,t[n]);return null}},{key:"_pointProjectsToLineSegment",value:function(t,n){var r=this._toolData.data[t],i=r.handles.points;if(void 0!==r.handles.points){if(!1===r.visible)return!1;var a=e.getCanvasPointsFromHandles(i[n[0]],i[n[1]],this._eventData.element),o=e.getLineAsVector(a),s=this._getLineOriginToMouseAsVector(a),l=(s[0]*o[0]+s[1]*o[1])/o.magnitude;return l>0&&l<o.magnitude}}},{key:"_getLineOriginToMouseAsVector",value:function(e){return[this._mousePoint.x-e[0].x,this._mousePoint.y-e[0].y]}},{key:"_distanceOfPointfromLine",value:function(e,t){var n=this._eventData,r=l.default.cornerstone.pixelToCanvas(n.element,e),i=l.default.cornerstone.pixelToCanvas(n.element,t),a=this._mousePoint;return Math.abs((i.y-r.y)*a.x-(i.x-r.x)*a.y+i.x*r.y-i.y*r.x)/l.default.cornerstoneMath.point.distance(r,i)}}],[{key:"getCanvasPointsFromHandles",value:function(e,t,n){var r=[];return e.x<t.x?(r.push(l.default.cornerstone.pixelToCanvas(n,e)),r.push(l.default.cornerstone.pixelToCanvas(n,t))):(r.push(l.default.cornerstone.pixelToCanvas(n,t)),r.push(l.default.cornerstone.pixelToCanvas(n,e))),r}},{key:"getLineAsVector",value:function(e){var t=[e[1].x-e[0].x,e[1].y-e[0].y];return t.magnitude=l.default.cornerstoneMath.point.distance(e[0],e[1]),t}},{key:"getNextHandleIndex",value:function(e,t){return e<t-1?e+1:0}}]),e}()},"./util/freehand/addLine.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){e[t].lines.push(t===e.length-1?e[0]:e[t+1])}},"./util/freehand/calculateFreehandStatistics.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/freehand/pointInFreehand.js");function i(e,t,n,i){Object(r.default)(e,t)&&(n.value+=i,n.squared+=i*i,n.count++)}t.default=function(e,t,n){var r={count:0,mean:0,variance:0,stdDev:0},a=function(e,t,n){for(var r={value:0,squared:0,count:0},a=0,o=t.top;o<t.top+t.height;o++)for(var s=t.left;s<t.left+t.width;s++)i(n,{x:s,y:o},r,e[a]),a++;return r}(e,t,n);return 0===a.count||(r.count=a.count,r.mean=a.value/a.count,r.variance=a.squared/a.count-r.mean*r.mean,r.stdDev=Math.sqrt(r.variance)),r}},"./util/freehand/freehandArea.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=0,r=e.length-1;t=t||1;for(var i=0;i<e.length;i++)n+=(e[r].x+e[i].x)*(e[r].y-e[i].y),r=i;return Math.abs(n*t/2)}},"./util/freehand/freehandIntersect.js":function(e,t,n){"use strict";function r(e,t,n,r){for(var o=e.length-1,s=0;s<e.length;s++)if(-1===r.indexOf(s)&&-1===r.indexOf(o)){if(i(t,n,a(e[o]),a(e[s])))return!0;o=s}else o=s;return!1}function i(e,t,n,r){var i=!1,a=[o(e,t,n),o(e,t,r),o(n,r,e),o(n,r,t)];return a[0]!==a[1]&&a[2]!==a[3]||((0===a[0]&&s(e,n,t)||0===a[1]&&s(e,r,t)||0===a[2]&&s(n,e,r)||0===a[3]&&s(n,t,r))&&(i=!0),i)}function a(e){return{x:e.x,y:e.y}}function o(e,t,n){var r=(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y);return 0===r?0:r>0?1:2}function s(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}n.r(t),t.default={newHandle:function(e,t){var n=t.length-1;return r(t,a(t[n]),a(e),[n])},end:function(e){var t=e.length-1;return r(e,a(e[t]),a(e[0]),[t,0])},modify:function(e,t){var n=a(e[t]),i=t-1;0===t&&(i=e.length-1);var o=a(e[i]);return!!r(e,n,o,[t,i])||r(e,n,o=a(e[i=t===e.length-1?0:t+1]),[t,i])}}},"./util/freehand/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/freehand/calculateFreehandStatistics.js"),i=n("./util/freehand/ClickedLineData.js"),a=n("./util/freehand/freehandArea.js"),o=n("./util/freehand/FreehandHandleData.js"),s=n("./util/freehand/freehandIntersect.js"),l=n("./util/freehand/FreehandLineFinder.js"),u=n("./util/freehand/insertOrDelete.js"),c=n("./util/freehand/pointInFreehand.js"),d=n("./util/freehand/addLine.js");t.default={calculateFreehandStatistics:r.default,ClickedLineData:i.default,freehandArea:a.default,FreehandHandleData:o.default,freehandIntersect:s.default,FreehandLineFinder:l.default,insertOrDelete:u.default,pointInFreehand:c.default,addLine:d.default}},"./util/freehand/insertOrDelete.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/freehand/FreehandLineFinder.js"),i=n("./util/freehand/FreehandHandleData.js"),a=n("./stateManagement/toolState.js"),o=n("./externalModules.js"),s=n("./util/freehand/addLine.js");function l(e,t){var n=Object(a.getToolState)(e.element,this.name);if(void 0!==n){var r=t.handleIndex,i=n.data[t.toolIndex],s=i.handles.points;s.length<=3||(r===s.length-1?(s[r-1].lines.pop(),s[r-1].lines.push(s[0])):0===r?(s[s.length-1].lines.pop(),s[s.length-1].lines.push(s[r+1])):(s[r-1].lines.pop(),s[r-1].lines.push(s[r+1])),s.splice(r,1),i.invalidated=!0,i.active=!0,i.highlight=!0,o.default.cornerstone.updateImage(e.element))}}function u(e,t){var n=Object(a.getToolState)(e.element,this.name);if(void 0!==n){var r=n.data[t.toolIndex],l=function(e){for(var t=e.handleIndexArray,n=1/0,r=t.includes(0),i=0;i<t.length;i++){var a=t[i];0!==a&&a<n&&(n=a)}return r&&1===n&&(n=0),++n}(t);if(l!==1/0){var u=new i.default(e.currentPoints.image),c=r.handles.points;c.splice(l,0,u),c[l-1].lines.pop(),c[l-1].lines.push(e.currentPoints.image),Object(s.default)(c,l),r.active=!0,r.highlight=!0,r.invalidated=!0,o.default.cornerstone.updateImage(e.element)}}}t.default=function(e,t){var n=e.detail;if(t&&null!==t.handleNearby)l.call(this,n,{toolIndex:t.toolIndex,handleIndex:t.handleNearby});else{var i=new r.default(n,this.name).findLine();i&&u.call(this,n,i)}}},"./util/freehand/pointInFreehand.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){for(var n=!1,r=e.length-1,i=0;i<e.length;i++)void 0,void 0,void 0,c=(s=e[r]).y,!((u=(o=e[i]).y)<(l=(a=t).y)&&l<c||c<l&&l<u)||!function(e,t,n){if(t.x>e.x&&n.x>e.x)return!0;if(t.x===n.x)return e.x<t.x;if(t.x>n.x){var r=t;t=n,n=r}var i=function(e,t,n){var r=(n.y-t.y)/(n.x-t.x);return{value:t.y+r*(e.x-t.x),gradient:r}}(e,t,n);return Math.sign(i.gradient)*e.y>Math.sign(i.gradient)*i.value}(a,o,s)||(n=!n),r=i;var a,o,s,l,u,c;return n}},"./util/getActiveTool.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));var r=n("./store/index.js"),i=n("./store/getActiveToolsForElement.js"),a=n("./store/filterToolsUsableWithMultiPartTools.js");function o(e,t){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse";if("touch"===o?n=(n=Object(i.default)(e,r.getters.touchTools())).filter((function(e){return e.options.isTouchActive})):(n=(n=Object(i.default)(e,r.getters.mouseTools())).filter((function(e){return Array.isArray(e.options.mouseButtonMask)&&t&&e.options.mouseButtonMask.includes(t)&&e.options.isMouseActive})),r.state.isMultiPartToolActive&&(n=Object(a.default)(n))),0!==n.length)return n[0]}},"./util/getCircleCoords.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./externalModules.js");function i(e,t){var n=(0,r.default.cornerstoneMath.point.distance)(e,t);return{left:Math.floor(Math.min(e.x-n,t.x)),top:Math.floor(Math.min(e.y-n,t.y)),width:2*n,height:2*n}}},"./util/getDefault.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){return void 0===e?t:e}},"./util/getKeyPressData.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=n("./store/index.js"),i=n("./externalModules.js");function a(e){var t=i.default.cornerstone,n=e.currentTarget,a=t.getEnabledElement(n);if(a&&a.image){var o=r.default.state.mousePositionImage;return{event:window.event||e,element:n,viewport:t.getViewport(n),image:a.image,currentPoints:{image:o,canvas:t.pixelToCanvas(n,o)},keyCode:e.keyCode,which:e.which}}}},"./util/getLuminance.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t,n,i,a){if(!e)throw new Error("getLuminance: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var o,s,l,u=r.default.cornerstone.getEnabledElement(e).image,c=[],d=0,h=u.getPixelData();if(u.color)for(s=0;s<a;s++)for(l=0;l<i;l++)c[d++]=.2126*h[o=4*((s+n)*u.columns+(l+t))]+.7152*h[o+1]+.0722*h[o+2];else for(s=0;s<a;s++)for(l=0;l<i;l++)c[d++]=h[o=(s+n)*u.columns+(l+t)]*u.slope+u.intercept;return c}},"./util/getMaxSimultaneousRequests.js":function(e,t,n){"use strict";var r;n.r(t),n.d(t,"getDefaultSimultaneousRequests",(function(){return l})),n.d(t,"getMaxSimultaneousRequests",(function(){return s})),n.d(t,"setMaxSimultaneousRequests",(function(){return o})),n.d(t,"getBrowserInfo",(function(){return a})),n.d(t,"isMobileDevice",(function(){return u}));var i={default:6,IE:{9:6,10:8,default:8},Firefox:{default:6},Opera:{10:8,11:6,12:6,default:6},Chrome:{default:6},Safari:{default:6}};function a(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE ".concat(e[1]||"")):"Chrome"===n[1]&&null!==(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(" "))}function o(e){r=e}function s(){return r||l()}function l(){var e=a().split(" "),t=e[1],n=i[e[0]];return n?n[t]?n[t]:n.default:i.default}function u(){return new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)}},"./util/getPixelSpacing.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./externalModules.js");function i(e){var t=r.default.cornerstone.metaData.get("imagePlaneModule",e.imageId);return t?{rowPixelSpacing:t.rowPixelSpacing||t.rowImagePixelSpacing,colPixelSpacing:t.columnPixelSpacing||t.colImagePixelSpacing}:{rowPixelSpacing:e.rowPixelSpacing,colPixelSpacing:e.columnPixelSpacing}}},"./util/getRGBPixels.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t,n,i,a){if(!e)throw new Error("getRGBPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var o,s,l,u=r.default.cornerstone.getEnabledElement(e),c=[],d=0,h=u.image.getPixelData();if(u.image.color)for(s=0;s<a;s++)for(l=0;l<i;l++){var f=h[1+(o=4*((s+n)*u.image.columns+(l+t)))],p=h[o+2],m=h[o+3];c[d++]=h[o],c[d++]=f,c[d++]=p,c[d++]=m}return c}},"./util/getROITextBoxCoords.js":function(e,t,n){"use strict";function r(e,t){var n=function(e){var t=[e.start,e.end].sort((function(e,t){return e.x<t.x?-1:1})),n=[e.start,e.end].sort((function(e,t){return e.y<t.y?-1:1}));return{top:n[0],left:t[0],bottom:n[n.length-1],right:t[t.length-1]}}(t),r=(n.left.x+n.right.x)/2,i=(n.top.y+n.bottom.y)/2,a={};return e.rotation>=0&&e.rotation<90&&(a.x=e.hflip?n.left.x:n.right.x,a.y=i),e.rotation>=90&&e.rotation<180&&(a.x=r,a.y=e.vflip?n.bottom.y:n.top.y),e.rotation>=180&&e.rotation<270&&(a.x=e.hflip?n.right.x:n.left.x,a.y=i),e.rotation>=270&&e.rotation<360&&(a.x=r,a.y=e.vflip?n.top.y:n.bottom.y),a}n.r(t),n.d(t,"default",(function(){return r}))},"./util/isEmptyObject.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){return 0===Object.keys(e).length&&e.constructor===Object}},"./util/isObject.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/typeof.js"),i=n.n(r);t.default=function(e){var t=i()(e);return null!==e&&("object"===t||"function"===t)}},"./util/isPointInImage.js":function(e,t,n){"use strict";function r(e,t,n){var r=e.x,i=e.y;return r<n&&r>=0&&i<t&&i>=0}n.r(t),n.d(t,"default",(function(){return r}))},"./util/isPointInPolygon.js":function(e,t,n){"use strict";function r(e,t){for(var n=e[0],r=e[1],i=!1,a=0,o=t.length-1;a<t.length;o=a++){var s=t[a][0],l=t[a][1],u=t[o][1];l>r!=u>r&&n<(t[o][0]-s)*(r-l)/(u-l)+s&&(i=!i)}return i}n.r(t),n.d(t,"default",(function(){return r}))},"./util/lineSegDistance.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t,n,i){var a=r.default.cornerstone,o={start:a.pixelToCanvas(e,t),end:a.pixelToCanvas(e,n)};return r.default.cornerstoneMath.lineSegment.distanceToPoint(o,i)}},"./util/logger.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getLogger",(function(){return o})),n.d(t,"enable",(function(){return s})),n.d(t,"disable",(function(){return l}));var r=n("./util/debugLib/index.js"),i="cornerstoneTools",a=Object(r.default)(i);a.enabled||(console.log("%cCornerstone Tools","background: #339955; padding: 4px; font-weight: bold; color: white"),console.info('run %clocalStorage.setItem("debug", "cornerstoneTools")%c to see console output',"background: #eaeaea; color: #333; font-family: monospace",""));var o=function(e){return{log:a.extend(e),warn:console.warn.bind(console),error:console.error.bind(console)}},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"".concat(i,":*");return r.default.enable(e)},l=function(){return r.default.disable()}},"./util/makeUnselectable.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){e.style.webkitUserSelect="none",e.style.webkitTouchCallout="none",e.style.mozUserSelect="none",e.style.msUserSelect="none",e.style.oUserSelect="none",e.style.khtmlUserSelect="none",e.style.userSelect="none",e.unselectable="on",e.oncontextmenu=function(){return!1},!0===t&&(e.style.pointerEvents="none")}},"./util/numbersWithCommas.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}},"./util/pointInsideBoundingBox.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t){if(e.boundingBox)return r.default.cornerstoneMath.point.insideRect(t,e.boundingBox)}},"./util/pointProjector.js":function(e,t,n){"use strict";n.r(t),n.d(t,"projectPatientPointToImagePlane",(function(){return a})),n.d(t,"imagePointToPatientPoint",(function(){return o})),n.d(t,"planePlaneIntersection",(function(){return s})),n.d(t,"rotatePoint",(function(){return l}));var r=n("./externalModules.js"),i=n("./util/convertToVector3.js");function a(e,t){var n=Object(i.default)(t.rowCosines),r=Object(i.default)(t.columnCosines),a=Object(i.default)(t.imagePositionPatient),o=e.clone().sub(a);return{x:n.dot(o)/t.columnPixelSpacing,y:r.dot(o)/t.rowPixelSpacing}}function o(e,t){var n=Object(i.default)(t.rowCosines),r=Object(i.default)(t.columnCosines),a=Object(i.default)(t.imagePositionPatient),o=n.clone().multiplyScalar(e.x);o.multiplyScalar(t.columnPixelSpacing);var s=r.clone().multiplyScalar(e.y);s.multiplyScalar(t.rowPixelSpacing);var l=o.add(s);return l.add(a),l}function s(e,t){var n=Object(i.default)(e.rowCosines),a=Object(i.default)(e.columnCosines),s=Object(i.default)(e.imagePositionPatient),l=Object(i.default)(t.rowCosines),u=Object(i.default)(t.columnCosines),c=Object(i.default)(t.imagePositionPatient),d=n.clone().cross(a),h=new r.default.cornerstoneMath.Plane;h.setFromNormalAndCoplanarPoint(d,s);var f=l.clone().cross(u),p=new r.default.cornerstoneMath.Plane;p.setFromNormalAndCoplanarPoint(f,c);var m=p.clone().intersectPlane(h),g=m.origin,v=m.direction,y=o({x:t.columns,y:t.rows},t),b=c.distanceTo(y),x=new r.default.cornerstoneMath.Line3;x.start=g,x.end=g.clone().add(v.multiplyScalar(b));var w=function(e,t){var n=[];return Object.keys(t).forEach((function(r){var i=e.intersectLine(t[r]);i&&n.push(i)})),n}(x,function(e){var t=o({x:0,y:0},e),n=o({x:e.columns,y:0},e),i=o({x:0,y:e.rows},e),a=o({x:e.columns,y:e.rows},e);return{top:new r.default.cornerstoneMath.Line3(t,n),left:new r.default.cornerstoneMath.Line3(t,i),right:new r.default.cornerstoneMath.Line3(n,a),bottom:new r.default.cornerstoneMath.Line3(i,a)}}(t));if(2===w.length)return{start:w[0],end:w[1]}}function l(e,t,n){var r=n*(Math.PI/180);return{x:Math.cos(r)*(e.x-t.x)-Math.sin(r)*(e.y-t.y)+t.x,y:Math.sin(r)*(e.x-t.x)+Math.cos(r)*(e.y-t.y)+t.y}}},"./util/roundToDecimal.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}},"./util/scroll.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/scrollToIndex.js"),i=n("./stateManagement/toolState.js"),a=n("./util/clip.js"),o=n("./externalModules.js");function s(e,t,n){if(e.pending[0]===t){if(e.currentImageIdIndex===t.index)return e.pending.splice(e.pending.indexOf(t),1),void(e.pending.length>0&&s(e,e.pending[0],n));n.addEventListener(o.default.cornerstone.EVENTS.NEW_IMAGE,(function r(i){e.imageIds.indexOf(i.detail.image.imageId)===t.index&&(e.pending.splice(e.pending.indexOf(t),1),n.removeEventListener(o.default.cornerstone.EVENTS.NEW_IMAGE,r),e.pending.length>0&&s(e,e.pending[0],n))})),Object(r.default)(n,t.index)}}t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],l=Object(i.getToolState)(e,"stack");if(l&&l.data&&l.data.length){var u=l.data[0];u.pending||(u.pending=[]);var c=u.currentImageIdIndex+t;if(n){var d=u.imageIds.length;c%=d}else c=Object(a.default)(c,0,u.imageIds.length-1);if(o)Object(r.default)(e,c);else{var h={index:c};u.pending.push(h),s(u,h,e)}}}},"./util/scrollToIndex.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./externalModules.js"),a=n("./stateManagement/toolState.js"),o=n("./requestPool/requestPoolManager.js"),s=n("./stateManagement/loadHandlerManager.js"),l=n("./util/triggerEvent.js");t.default=function(e,t){var n=Object(a.getToolState)(e,"stack");if(n&&n.data&&n.data.length){var u,c=i.default.cornerstone;if(n.data.length>1){var d=Object(a.getToolState)(e,"stackRenderer");d&&d.data&&d.data.length&&(u=d.data[0])}var h=n.data[0];t<0&&(t+=h.imageIds.length);var f=s.default.getStartLoadHandler(e),p=s.default.getEndLoadHandler(e),m=s.default.getErrorLoadingHandler(e);if(t!==h.currentImageIdIndex){f&&f(e);var g={newImageIdIndex:t,direction:t-h.currentImageIdIndex};h.currentImageIdIndex=t;var v=h.imageIds[t];(Boolean(h.preventCache)?c.loadImage(v):c.loadAndCacheImage(v)).then((function(r){if(h.currentImageIdIndex===t){try{c.getEnabledElement(e)}catch(i){return}u?(u.currentImageIdIndex=t,u.render(e,n.data)):c.displayImage(e,r),p&&p(e,r)}}),(function(n){m&&m(e,h.imageIds[t],n)})),o.default.startGrabbing(),Object(l.default)(e,r.default.STACK_SCROLL,g)}}}},"./util/segmentation/drawBrush.js":function(e,t,n){"use strict";n.r(t),n.d(t,"drawBrushPixels",(function(){return o}));var r=n("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=n.n(r),a=n("./util/segmentation/eraseIfSegmentIndex.js");function o(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=function(e,t){return t*r+e};e.forEach((function(e){var r=s.apply(void 0,i()(e));o?Object(a.default)(r,t,n):t[r]=n}))}},"./util/segmentation/eraseIfSegmentIndex.js":function(e,t,n){"use strict";function r(e,t,n){t[e]===n&&(t[e]=0)}n.r(t),n.d(t,"default",(function(){return r}))},"./util/segmentation/eraseOutsideBoundingBox.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./util/segmentation/eraseIfSegmentIndex.js");function i(e,t,n,i){for(var a=t.pixelData,o=t.segmentIndex,s=e.detail.image,l=s.width,u=s.height,c=0;c<l;c++)for(var d=0;d<n[1];d++)Object(r.default)(d*l+c,a,o);for(var h=0;h<n[0];h++)for(var f=n[1];f<i[1];f++)Object(r.default)(f*l+h,a,o);for(var p=i[0];p<l;p++)for(var m=n[1];m<i[1];m++)Object(r.default)(m*l+p,a,o);for(var g=0;g<l;g++)for(var v=i[1];v<u;v++)Object(r.default)(v*l+g,a,o)}},"./util/segmentation/eraseShape.js":function(e,t,n){"use strict";n.r(t),n.d(t,"eraseInsideShape",(function(){return u})),n.d(t,"eraseOutsideShape",(function(){return c}));var r=n("../node_modules/@babel/runtime/helpers/slicedToArray.js"),i=n.n(r),a=n("./util/segmentation/eraseOutsideBoundingBox.js"),o=n("./util/segmentation/isSameSegment.js"),s=n("./util/logger.js");function l(e,t,n,r,s){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"inside",u=e.detail.image.width,c=t.pixelData,d=t.segmentIndex,h=i()(r,2),f=h[0],p=h[1],m=i()(s,2),g=m[0],v=m[1];"outside"===l&&Object(a.default)(e,t,r,s);for(var y=f;y<g;y++)for(var b=p;b<v;b++){var x=b*u+y;Object(o.default)(x,c,d)&&n({x:y,y:b})&&(c[x]=0)}}function u(e,t,n,r,i){l(e,t,n,r,i,"inside")}function c(e,t,n,r,i){l(e,t,(function(e){return!n(e)}),r,i,"outside")}Object(s.getLogger)("util:segmentation:operations:eraseOutsideCircle")},"./util/segmentation/fillOutsideBoundingBox.js":function(e,t,n){"use strict";function r(e,t,n,r){for(var i=t.pixelData,a=t.segmentIndex,o=e.detail.image,s=o.width,l=o.height,u=0;u<s;u++)for(var c=0;c<n[1];c++)i[c*s+u]=a;for(var d=0;d<n[0];d++)for(var h=n[1];h<r[1];h++)i[h*s+d]=a;for(var f=r[0];f<s;f++)for(var p=n[1];p<r[1];p++)i[p*s+f]=a;for(var m=0;m<s;m++)for(var g=r[1];g<l;g++)i[g*s+m]=a}n.r(t),n.d(t,"default",(function(){return r}))},"./util/segmentation/fillShape.js":function(e,t,n){"use strict";n.r(t),n.d(t,"fillInsideShape",(function(){return u})),n.d(t,"fillOutsideShape",(function(){return c}));var r=n("../node_modules/@babel/runtime/helpers/slicedToArray.js"),i=n.n(r),a=n("./util/segmentation/fillOutsideBoundingBox.js"),o=n("./util/logger.js"),s=Object(o.getLogger)("util:segmentation:operations:helpers:fillShape");function l(e,t,n,r,o){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"inside",u=t.pixelData,c=t.segmentIndex;if(void 0!==u&&void 0!==c){var d=e.detail.image.width,h=i()(r,2),f=h[0],p=h[1],m=i()(o,2),g=m[0],v=m[1];"outside"===l&&Object(a.default)(e,t,r,o);for(var y=f;y<g;y++)for(var b=p;b<v;b++){var x=b*d+y;n({x:y,y:b})&&(u[x]=c)}}else s.error("fillInsideShape requires operationData to contain pixelData and segmentIndex")}function u(e,t,n,r,i){l(e,t,n,r,i,"inside")}function c(e,t,n,r,i){l(e,t,(function(e){return!n(e)}),r,i,"outside")}},"./util/segmentation/floodFill.js":function(e,t,n){"use strict";n.r(t);var r=n("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=n.n(r);function a(e,t){return e===t}function o(e){for(var t=0,n=0;n<e.length;n+=1)0!==e[n]&&(t+=1);return t}function s(e,t,n){return(new Array(n+1).join(t)+e).slice(-n)}t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.onFlood||function(){},l=n.onBoundary||function(){},u=n.equals||a,c=n.diagonals||!1,d=E(t),h=k(),f=[],p=[],m={},g={};for(f.push({currentArgs:t});f.length>0;)v(f.pop());return{flooded:p,boundaries:I()};function v(e){var t=e.currentArgs,n=e.previousArgs;y(t)||(b(t),x(t)?(w(t),S(t)):_(n))}function y(e){return!0===m[e]}function b(e){m[e]=!0}function x(e){var t=T(E,[e]);return T(u,[t,d])}function w(e){p.push(e),r.apply(void 0,i()(e))}function _(e){g[e]=e,l.apply(void 0,i()(e))}function S(e){for(var t=0;t<h.length;t+=1){for(var n=h[t],r=e.slice(0),i=0;i<e.length;i+=1)r[i]+=n[i];f.push({currentArgs:r,previousArgs:e})}}function E(t){return e.apply(void 0,i()(t))}function T(e,t){try{return e.apply(void 0,i()(t))}catch(n){return}}function k(){return C(t.length).filter((function(e){var t=o(e);return 0!==t&&(1===t||c)}))}function C(e){for(var t=[],n=function(e){return e.split("").map((function(e){return parseInt(e,10)-1}))},r=0;r<Math.pow(3,e);r+=1){var i=s(r.toString(3),"0",e);t.push(n(i))}return t}function I(){var e=[];for(var t in g)g.hasOwnProperty(t)&&e.unshift(g[t]);return e}}},"./util/segmentation/getBoundingBoxAroundCircle.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./util/getCircleCoords.js");function i(e){var t=e.detail.handles,n=e.detail.image,i=n.width,a=n.height,o=Object(r.default)(t.start,t.end),s=o.width+o.left,l=o.left,u=o.top+o.height,c=o.top;return l=Math.floor(l),c=Math.floor(c),s=Math.floor(s),u=Math.floor(u),s=Math.min(i,s),l=Math.max(0,l),u=Math.min(a,u),[[l,c=Math.max(0,c)],[s,u]]}},"./util/segmentation/getBoundingBoxAroundPolygon.js":function(e,t,n){"use strict";function r(e,t){var n=1/0,r=0,i=1/0,a=0,o=t.width,s=t.height;return e.forEach((function(e){n=Math.min(e[0],n),r=Math.max(e[0],r),i=Math.min(e[1],i),a=Math.max(e[1],a)})),n=Math.floor(n),i=Math.floor(i),r=Math.floor(r),a=Math.floor(a),r=Math.min(o,r),n=Math.max(0,n),a=Math.min(s,a),i=Math.max(0,i),[[n,i],[r,a]]}n.r(t),n.d(t,"default",(function(){return r}))},"./util/segmentation/getCircle.js":function(e,t,n){"use strict";function r(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=Math.floor(r),o=Math.floor(i);if(1===e)return[[a,o]];for(var s=[],l=0,u=-e;u<=e;u++){var c=o+u;if(!(c>t||c<0))for(var d=-e;d<=e;d++){var h=a+d;h>=n||h<0||d*d+u*u<e*e&&(s[l++]=[a+d,o+u])}}return s}n.r(t),n.d(t,"default",(function(){return r}))},"./util/segmentation/getDiffBetweenPixelData.js":function(e,t,n){"use strict";function r(e,t){for(var n=[],r=0;r<e.length;r++)e[r]!==t[r]&&n.push([r,e[r],t[r]]);return n}n.r(t),n.d(t,"default",(function(){return r}))},"./util/segmentation/getPixelPathBetweenPixels.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=1/Math.sqrt(2),a={up:{x:0,y:1},upRight:{x:i,y:i},right:{x:1,y:0},downRight:{x:i,y:-i},down:{x:0,y:1},downLeft:{x:-i,y:-i},left:{x:-1,y:0},upLeft:{x:-i,y:i}};function o(e,t){var n=c(e,t);switch(h([d(n,a.up),d(n,a.right),d(n,a.upRight)])){case 0:e.y++;break;case 1:e.x++;break;case 2:e.y++,e.x++}}function s(e,t){var n=c(e,t);switch(h([d(n,a.up),d(n,a.left),d(n,a.upLeft)])){case 0:e.y++;break;case 1:e.x--;break;case 2:e.y++,e.x--}}function l(e,t){var n=c(e,t);switch(h([d(n,a.down),d(n,a.right),d(n,a.downRight)])){case 0:e.y--;break;case 1:e.x++;break;case 2:e.y--,e.x++}}function u(e,t){var n=c(e,t);switch(h([d(n,a.down),d(n,a.left),d(n,a.downLeft)])){case 0:e.y--;break;case 1:e.x--;break;case 2:e.y--,e.x--}}function c(e,t){var n=r.default.cornerstoneMath.point.distance(e,t);return{x:(t.x-e.x)/n,y:(t.y-e.y)/n}}function d(e,t){return e.x*t.x+e.y*t.y}function h(e){var t=e[0]>e[1]?0:1;return e[2]>e[t]&&(t=2),t}t.default=function(e,t){for(var n={x:e.x,y:e.y},r=[];t.x!==n.x||t.y!==n.y;)t.x===n.x?t.y>n.y?n.y++:n.y--:t.y===n.y?t.x>n.x?n.x++:n.x--:t.y>n.y?t.x>n.x?o(n,t):s(n,t):t.x>n.x?l(n,t):u(n,t),r.push({x:n.x,y:n.y});return r.pop(),r}},"./util/segmentation/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/segmentation/drawBrush.js");n.d(t,"drawBrushPixels",(function(){return r.drawBrushPixels}));var i=n("./util/segmentation/eraseIfSegmentIndex.js");n.d(t,"eraseIfSegmentIndex",(function(){return i.default}));var a=n("./util/segmentation/eraseOutsideBoundingBox.js");n.d(t,"eraseOutsideBoundingBox",(function(){return a.default}));var o=n("./util/segmentation/eraseShape.js");n.d(t,"eraseInsideShape",(function(){return o.eraseInsideShape})),n.d(t,"eraseOutsideShape",(function(){return o.eraseOutsideShape}));var s=n("./util/segmentation/fillOutsideBoundingBox.js");n.d(t,"fillOutsideBoundingBox",(function(){return s.default}));var l=n("./util/segmentation/fillShape.js");n.d(t,"fillInsideShape",(function(){return l.fillInsideShape})),n.d(t,"fillOutsideShape",(function(){return l.fillOutsideShape}));var u=n("./util/segmentation/floodFill.js");n.d(t,"floodFill",(function(){return u.default}));var c=n("./util/segmentation/getBoundingBoxAroundCircle.js");n.d(t,"getBoundingBoxAroundCircle",(function(){return c.default}));var d=n("./util/segmentation/getBoundingBoxAroundPolygon.js");n.d(t,"getBoundingBoxAroundPolygon",(function(){return d.default}));var h=n("./util/segmentation/getCircle.js");n.d(t,"getCircle",(function(){return h.default}));var f=n("./util/segmentation/getPixelPathBetweenPixels.js");n.d(t,"getPixelPathBetweenPixels",(function(){return f.default}));var p=n("./util/segmentation/isSameSegment.js");n.d(t,"isSameSegment",(function(){return p.default}));var m=n("./util/segmentation/triggerLabelmapModifiedEvent.js");n.d(t,"triggerLabelmapModifiedEvent",(function(){return m.default}));var g=n("./util/segmentation/getDiffBetweenPixelData.js");n.d(t,"getDiffBetweenPixelData",(function(){return g.default}))},"./util/segmentation/isSameSegment.js":function(e,t,n){"use strict";function r(e,t,n){return t[e]===n}n.r(t),n.d(t,"default",(function(){return r}))},"./util/segmentation/triggerLabelmapModifiedEvent.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));var r=n("./externalModules.js"),i=n("./events.js"),a=n("./store/index.js");function o(e,t){var n=Object(a.getModule)("segmentation");t=void 0===t?n.getters.activeLabelmapIndex(e):t,r.default.cornerstone.triggerEvent(e,i.default.LABELMAP_MODIFIED,{labelmapIndex:t})}},"./util/setContextToDisplayFontSize.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e,t,n){var i=.1;return r.default.cornerstone.setToPixelCoordinateSystem(e,t,i),{fontSize:n/e.viewport.scale/i,lineHeight:n/e.viewport.scale/i,fontScale:i}}},"./util/throttle.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/debounce.js"),i=n("./util/isObject.js");t.default=function(e,t,n){var a=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Object(i.default)(n)&&(a="leading"in n?Boolean(n.leading):a,o="trailing"in n?Boolean(n.trailing):o),Object(r.default)(e,t,{leading:a,trailing:o,maxWait:t})}},"./util/triggerEvent.js":function(e,t,n){"use strict";function r(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:r,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,r),e.dispatchEvent(n)}n.r(t),n.d(t,"default",(function(){return r}))},"./util/uuidv4.js":function(e,t,n){"use strict";function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}n.r(t),n.d(t,"default",(function(){return r}))},"./util/wait.js":function(e,t,n){"use strict";n.r(t),n.d(t,"wait",(function(){return i})),n.d(t,"waitForEnabledElementImageToLoad",(function(){return a}));var r=n("./externalModules.js"),i=function(e){return new Promise((function(t){return setTimeout(t,e)}))};function a(e){try{var t=r.default.cornerstone.getEnabledElement(e);return t.image?t:i(250).then((function(){return a(e)}))}catch(n){return null}}t.default=i},"./util/zoom/changeViewportScale.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){var r=n.maxScale,i=n.minScale,a=Math.log(e.scale)/Math.log(1.7),o=Math.pow(1.7,a+t);return e.scale=r&&o>r?r:i&&o<i?i:o,e}},"./util/zoom/correctShift.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=t.vflip,r=t.rotation;if(e.x*=t.hflip?-1:1,e.y*=n?-1:1,0!==r){var i=r*Math.PI/180,a=Math.cos(i),o=Math.sin(i),s=e.x*o+e.y*a;e.x=e.x*a-e.y*o,e.y=s}return e}},"./util/zoom/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./util/zoom/changeViewportScale.js");n.d(t,"changeViewportScale",(function(){return r.default}));var i=n("./util/zoom/correctShift.js");n.d(t,"correctShift",(function(){return i.default})),t.default={changeViewportScale:r.default,correctShift:i.default}},"./version.js":function(e,t,n){"use strict";n.r(t),t.default="4.22.1"}})},e.exports=r()},6:function(e,t){},7:function(e,t){},"7sNm":function(e,t,n){const r=n("8GxW");e.exports=(e,t,n)=>r(e,t,n)>0},8:function(e,t){},"8GxW":function(e,t,n){const r=n("3wIk");e.exports=(e,t,n)=>new r(e,n).compare(new r(t,n))},"8YLp":function(e,t,n){const r=n("8GxW");e.exports=(e,t)=>r(e,t,!0)},9:function(e,t){},"9x6x":function(e,t,n){"use strict";e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n,r="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(n=t.cmp,function(e){return function(t,r){return n({key:t,value:e[t]},{key:r,value:e[r]})}}),a=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var n,o;if(Array.isArray(t)){for(o="[",n=0;n<t.length;n++)n&&(o+=","),o+=e(t[n])||"null";return o+"]"}if(null===t)return"null";if(-1!==a.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=a.push(t)-1,l=Object.keys(t).sort(i&&i(t));for(o="",n=0;n<l.length;n++){var u=l[n],c=e(t[u]);c&&(o&&(o+=","),o+=JSON.stringify(u)+":"+c)}return a.splice(s,1),"{"+o+"}"}}(e)}},B9Yq:function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},Br5v:function(e,t,n){const r=n("3wIk");e.exports=(e,t)=>new r(e,t).major},DXxi:function(e,t){const n="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=n},Dknc:function(e,t,n){const r=n("8GxW");e.exports=(e,t,n)=>r(e,t,n)>=0},EhIR:function(e,t,n){(function(e){var r;!function(e,i,a){function o(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function l(e,t){var n=new o(e),r=t&&t.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(t,n,t,i))||(i.exports=r):this.alea=l}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},HwNo:function(e,t,n){"use strict";e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},HyWp:function(e,t,n){"use strict";const r=n("XPeR"),i=Symbol("max"),a=Symbol("length"),o=Symbol("lengthCalculator"),s=Symbol("allowStale"),l=Symbol("maxAge"),u=Symbol("dispose"),c=Symbol("noDisposeOnSet"),d=Symbol("lruList"),h=Symbol("cache"),f=Symbol("updateAgeOnGet"),p=()=>1,m=(e,t,n)=>{const r=e[h].get(t);if(r){const t=r.value;if(g(e,t)){if(y(e,r),!e[s])return}else n&&(e[f]&&(r.value.now=Date.now()),e[d].unshiftNode(r));return t.value}},g=(e,t)=>{if(!t||!t.maxAge&&!e[l])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[l]&&n>e[l]},v=e=>{if(e[a]>e[i])for(let t=e[d].tail;e[a]>e[i]&&null!==t;){const n=t.prev;y(e,t),t=n}},y=(e,t)=>{if(t){const n=t.value;e[u]&&e[u](n.key,n.value),e[a]-=n.length,e[h].delete(n.key),e[d].removeNode(t)}};class b{constructor(e,t,n,r,i){this.key=e,this.value=t,this.length=n,this.now=r,this.maxAge=i||0}}const x=(e,t,n,r)=>{let i=n.value;g(e,i)&&(y(e,n),e[s]||(i=void 0)),i&&t.call(r,i.value,i.key,e)};e.exports=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[i]=e.max||1/0;const t=e.length||p;if(this[o]="function"!=typeof t?p:t,this[s]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[l]=e.maxAge||0,this[u]=e.dispose,this[c]=e.noDisposeOnSet||!1,this[f]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[i]=e||1/0,v(this)}get max(){return this[i]}set allowStale(e){this[s]=!!e}get allowStale(){return this[s]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[l]=e,v(this)}get maxAge(){return this[l]}set lengthCalculator(e){"function"!=typeof e&&(e=p),e!==this[o]&&(this[o]=e,this[a]=0,this[d].forEach(e=>{e.length=this[o](e.value,e.key),this[a]+=e.length})),v(this)}get lengthCalculator(){return this[o]}get length(){return this[a]}get itemCount(){return this[d].length}rforEach(e,t){t=t||this;for(let n=this[d].tail;null!==n;){const r=n.prev;x(this,e,n,t),n=r}}forEach(e,t){t=t||this;for(let n=this[d].head;null!==n;){const r=n.next;x(this,e,n,t),n=r}}keys(){return this[d].toArray().map(e=>e.key)}values(){return this[d].toArray().map(e=>e.value)}reset(){this[u]&&this[d]&&this[d].length&&this[d].forEach(e=>this[u](e.key,e.value)),this[h]=new Map,this[d]=new r,this[a]=0}dump(){return this[d].map(e=>!g(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[d]}set(e,t,n){if((n=n||this[l])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const r=n?Date.now():0,s=this[o](t,e);if(this[h].has(e)){if(s>this[i])return y(this,this[h].get(e)),!1;const o=this[h].get(e).value;return this[u]&&(this[c]||this[u](e,o.value)),o.now=r,o.maxAge=n,o.value=t,this[a]+=s-o.length,o.length=s,this.get(e),v(this),!0}const f=new b(e,t,s,r,n);return f.length>this[i]?(this[u]&&this[u](e,t),!1):(this[a]+=f.length,this[d].unshift(f),this[h].set(e,this[d].head),v(this),!0)}has(e){if(!this[h].has(e))return!1;const t=this[h].get(e).value;return!g(this,t)}get(e){return m(this,e,!0)}peek(e){return m(this,e,!1)}pop(){const e=this[d].tail;return e?(y(this,e),e.value):null}del(e){y(this,this[h].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const r=e[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{const e=i-t;e>0&&this.set(r.k,r.v,e)}}}prune(){this[h].forEach((e,t)=>m(this,t,!1))}}},I9dd:function(e,t,n){const r=n("ex/Z"),{ANY:i}=n("vwDW"),a=n("MpxT"),o=n("8GxW"),s=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===i)return 1===t.length&&t[0].semver===i;const r=new Set;let s,c,d,h,f,p,m;for(const i of e)">"===i.operator||">="===i.operator?s=l(s,i,n):"<"===i.operator||"<="===i.operator?c=u(c,i,n):r.add(i.semver);if(r.size>1)return null;if(s&&c){if(d=o(s.semver,c.semver,n),d>0)return null;if(0===d&&(">="!==s.operator||"<="!==c.operator))return null}for(const i of r){if(s&&!a(i,String(s),n))return null;if(c&&!a(i,String(c),n))return null;for(const e of t)if(!a(i,String(e),n))return!1;return!0}for(const i of t){if(m=m||">"===i.operator||">="===i.operator,p=p||"<"===i.operator||"<="===i.operator,s)if(">"===i.operator||">="===i.operator){if(h=l(s,i,n),h===i&&h!==s)return!1}else if(">="===s.operator&&!a(s.semver,String(i),n))return!1;if(c)if("<"===i.operator||"<="===i.operator){if(f=u(c,i,n),f===i&&f!==c)return!1}else if("<="===c.operator&&!a(c.semver,String(i),n))return!1;if(!i.operator&&(c||s)&&0!==d)return!1}return!(s&&p&&!c&&0!==d||c&&m&&!s&&0!==d)},l=(e,t,n)=>{if(!e)return t;const r=o(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},u=(e,t,n)=>{if(!e)return t;const r=o(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,n)=>{if(e===t)return!0;e=new r(e,n),t=new r(t,n);let i=!1;e:for(const r of e.set){for(const e of t.set){const t=s(r,e,n);if(i=i||null!==t,t)continue e}if(i)return!1}return!0}},IsDc:function(e,t,n){const{MAX_SAFE_COMPONENT_LENGTH:r}=n("/kWe"),i=n("DXxi"),a=(t=e.exports={}).re=[],o=t.src=[],s=t.t={};let l=0;const u=(e,t,n)=>{const r=l++;i(r,t),s[e]=r,o[r]=t,a[r]=new RegExp(t,n?"g":void 0)};u("NUMERICIDENTIFIER","0|[1-9]\\d*"),u("NUMERICIDENTIFIERLOOSE","[0-9]+"),u("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),u("MAINVERSION",`(${o[s.NUMERICIDENTIFIER]})\\.(${o[s.NUMERICIDENTIFIER]})\\.(${o[s.NUMERICIDENTIFIER]})`),u("MAINVERSIONLOOSE",`(${o[s.NUMERICIDENTIFIERLOOSE]})\\.(${o[s.NUMERICIDENTIFIERLOOSE]})\\.(${o[s.NUMERICIDENTIFIERLOOSE]})`),u("PRERELEASEIDENTIFIER",`(?:${o[s.NUMERICIDENTIFIER]}|${o[s.NONNUMERICIDENTIFIER]})`),u("PRERELEASEIDENTIFIERLOOSE",`(?:${o[s.NUMERICIDENTIFIERLOOSE]}|${o[s.NONNUMERICIDENTIFIER]})`),u("PRERELEASE",`(?:-(${o[s.PRERELEASEIDENTIFIER]}(?:\\.${o[s.PRERELEASEIDENTIFIER]})*))`),u("PRERELEASELOOSE",`(?:-?(${o[s.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${o[s.PRERELEASEIDENTIFIERLOOSE]})*))`),u("BUILDIDENTIFIER","[0-9A-Za-z-]+"),u("BUILD",`(?:\\+(${o[s.BUILDIDENTIFIER]}(?:\\.${o[s.BUILDIDENTIFIER]})*))`),u("FULLPLAIN",`v?${o[s.MAINVERSION]}${o[s.PRERELEASE]}?${o[s.BUILD]}?`),u("FULL",`^${o[s.FULLPLAIN]}$`),u("LOOSEPLAIN",`[v=\\s]*${o[s.MAINVERSIONLOOSE]}${o[s.PRERELEASELOOSE]}?${o[s.BUILD]}?`),u("LOOSE",`^${o[s.LOOSEPLAIN]}$`),u("GTLT","((?:<|>)?=?)"),u("XRANGEIDENTIFIERLOOSE",o[s.NUMERICIDENTIFIERLOOSE]+"|x|X|\\*"),u("XRANGEIDENTIFIER",o[s.NUMERICIDENTIFIER]+"|x|X|\\*"),u("XRANGEPLAIN",`[v=\\s]*(${o[s.XRANGEIDENTIFIER]})(?:\\.(${o[s.XRANGEIDENTIFIER]})(?:\\.(${o[s.XRANGEIDENTIFIER]})(?:${o[s.PRERELEASE]})?${o[s.BUILD]}?)?)?`),u("XRANGEPLAINLOOSE",`[v=\\s]*(${o[s.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[s.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[s.XRANGEIDENTIFIERLOOSE]})(?:${o[s.PRERELEASELOOSE]})?${o[s.BUILD]}?)?)?`),u("XRANGE",`^${o[s.GTLT]}\\s*${o[s.XRANGEPLAIN]}$`),u("XRANGELOOSE",`^${o[s.GTLT]}\\s*${o[s.XRANGEPLAINLOOSE]}$`),u("COERCE",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?(?:$|[^\\d])`),u("COERCERTL",o[s.COERCE],!0),u("LONETILDE","(?:~>?)"),u("TILDETRIM",`(\\s*)${o[s.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",u("TILDE",`^${o[s.LONETILDE]}${o[s.XRANGEPLAIN]}$`),u("TILDELOOSE",`^${o[s.LONETILDE]}${o[s.XRANGEPLAINLOOSE]}$`),u("LONECARET","(?:\\^)"),u("CARETTRIM",`(\\s*)${o[s.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",u("CARET",`^${o[s.LONECARET]}${o[s.XRANGEPLAIN]}$`),u("CARETLOOSE",`^${o[s.LONECARET]}${o[s.XRANGEPLAINLOOSE]}$`),u("COMPARATORLOOSE",`^${o[s.GTLT]}\\s*(${o[s.LOOSEPLAIN]})$|^$`),u("COMPARATOR",`^${o[s.GTLT]}\\s*(${o[s.FULLPLAIN]})$|^$`),u("COMPARATORTRIM",`(\\s*)${o[s.GTLT]}\\s*(${o[s.LOOSEPLAIN]}|${o[s.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",u("HYPHENRANGE",`^\\s*(${o[s.XRANGEPLAIN]})\\s+-\\s+(${o[s.XRANGEPLAIN]})\\s*$`),u("HYPHENRANGELOOSE",`^\\s*(${o[s.XRANGEPLAINLOOSE]})\\s+-\\s+(${o[s.XRANGEPLAINLOOSE]})\\s*$`),u("STAR","(<|>)?=?\\s*\\*"),u("GTE0","^\\s*>=\\s*0.0.0\\s*$"),u("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")},JBAE:function(e,t,n){var r=function(){"use strict";function e(e,t){return null!=t&&e instanceof t}var t,n,r;try{t=Map}catch(s){t=function(){}}try{n=Set}catch(s){n=function(){}}try{r=Promise}catch(s){r=function(){}}function i(a,s,l,u,c){"object"==typeof s&&(l=s.depth,u=s.prototype,c=s.includeNonEnumerable,s=s.circular);var d=[],h=[],f="undefined"!=typeof Buffer;return void 0===s&&(s=!0),void 0===l&&(l=1/0),function a(l,p){if(null===l)return null;if(0===p)return l;var m,g;if("object"!=typeof l)return l;if(e(l,t))m=new t;else if(e(l,n))m=new n;else if(e(l,r))m=new r((function(e,t){l.then((function(t){e(a(t,p-1))}),(function(e){t(a(e,p-1))}))}));else if(i.__isArray(l))m=[];else if(i.__isRegExp(l))m=new RegExp(l.source,o(l)),l.lastIndex&&(m.lastIndex=l.lastIndex);else if(i.__isDate(l))m=new Date(l.getTime());else{if(f&&Buffer.isBuffer(l))return m=Buffer.allocUnsafe?Buffer.allocUnsafe(l.length):new Buffer(l.length),l.copy(m),m;e(l,Error)?m=Object.create(l):void 0===u?(g=Object.getPrototypeOf(l),m=Object.create(g)):(m=Object.create(u),g=u)}if(s){var v=d.indexOf(l);if(-1!=v)return h[v];d.push(l),h.push(m)}for(var y in e(l,t)&&l.forEach((function(e,t){var n=a(t,p-1),r=a(e,p-1);m.set(n,r)})),e(l,n)&&l.forEach((function(e){var t=a(e,p-1);m.add(t)})),l){var b;g&&(b=Object.getOwnPropertyDescriptor(g,y)),b&&null==b.set||(m[y]=a(l[y],p-1))}if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(l);for(y=0;y<x.length;y++){var w=x[y];(!(S=Object.getOwnPropertyDescriptor(l,w))||S.enumerable||c)&&(m[w]=a(l[w],p-1),S.enumerable||Object.defineProperty(m,w,{enumerable:!1}))}}if(c){var _=Object.getOwnPropertyNames(l);for(y=0;y<_.length;y++){var S,E=_[y];(S=Object.getOwnPropertyDescriptor(l,E))&&S.enumerable||(m[E]=a(l[E],p-1),Object.defineProperty(m,E,{enumerable:!1}))}}return m}(a,l)}function a(e){return Object.prototype.toString.call(e)}function o(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return i.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},i.__objToStr=a,i.__isDate=function(e){return"object"==typeof e&&"[object Date]"===a(e)},i.__isArray=function(e){return"object"==typeof e&&"[object Array]"===a(e)},i.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===a(e)},i.__getRegExpFlags=o,i}();e.exports&&(e.exports=r)},JCZO:function(e,t,n){const r=n("8GxW");e.exports=(e,t,n)=>r(e,t,n)<0},KHQI:function(e,t){const n=/^[0-9]+$/,r=(e,t)=>{const r=n.test(e),i=n.test(t);return r&&i&&(e=+e,t=+t),e===t?0:r&&!i?-1:i&&!r?1:e<t?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},LJ9E:function(e,t,n){const r=n("3wIk");e.exports=(e,t)=>new r(e,t).patch},MpxT:function(e,t,n){const r=n("ex/Z");e.exports=(e,t,n)=>{try{t=new r(t,n)}catch(i){return!1}return t.test(e)}},Nm83:function(e,t,n){var r;r=function(){return function(e){var t=this.webpackHotUpdate_name_;this.webpackHotUpdate_name_=function(e,n){!function(e,t){if(x[e]&&b[e]){for(var n in b[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(p[n]=t[n]);0==--g&&0===v&&E()}}(e,n),t&&t(e,n)};var n,r=!0,i="c170bba28ef5906c081d",a={},o=[],s=[];function l(e){var t=k[e];if(!t)return C;var r=function(r){return t.hot.active?(k[r]?-1===k[r].parents.indexOf(e)&&k[r].parents.push(e):(o=[e],n=r),-1===t.children.indexOf(r)&&t.children.push(r)):(console.warn("[HMR] unexpected require("+r+") from disposed module "+e),o=[]),C(r)},i=function(e){return{configurable:!0,enumerable:!0,get:function(){return C[e]},set:function(t){C[e]=t}}};for(var a in C)Object.prototype.hasOwnProperty.call(C,a)&&"e"!==a&&"t"!==a&&Object.defineProperty(r,a,i(a));return r.e=function(e){return"ready"===d&&h("prepare"),v++,C.e(e).then(t,(function(e){throw t(),e}));function t(){v--,"prepare"===d&&(y[e]||S(e),0===v&&0===g&&E())}},r.t=function(e,t){return 1&t&&(e=r(e)),C.t(e,-2&t)},r}function u(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:n!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var r=0;r<e.length;r++)t._acceptedDependencies[e[r]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:_,apply:T,status:function(e){if(!e)return d;c.push(e)},addStatusHandler:function(e){c.push(e)},removeStatusHandler:function(e){var t=c.indexOf(e);t>=0&&c.splice(t,1)},data:a[e]};return n=void 0,t}var c=[],d="idle";function h(e){d=e;for(var t=0;t<c.length;t++)c[t].call(null,e)}var f,p,m,g=0,v=0,y={},b={},x={};function w(e){return+e+""===e?+e:e}function _(e){if("idle"!==d)throw new Error("check() is only allowed in idle status");return r=e,h("check"),(t=1e4,t=t||1e4,new Promise((function(e,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var r=new XMLHttpRequest,a=C.p+""+i+".hot-update.json";r.open("GET",a,!0),r.timeout=t,r.send(null)}catch(o){return n(o)}r.onreadystatechange=function(){if(4===r.readyState)if(0===r.status)n(new Error("Manifest request to "+a+" timed out."));else if(404===r.status)e();else if(200!==r.status&&304!==r.status)n(new Error("Manifest request to "+a+" failed."));else{try{var t=JSON.parse(r.responseText)}catch(i){return void n(i)}e(t)}}}))).then((function(e){if(!e)return h("idle"),null;b={},y={},x=e.c,m=e.h,h("prepare");var t=new Promise((function(e,t){f={resolve:e,reject:t}}));return p={},S("cornerstoneWADOImageLoader"),"prepare"===d&&0===v&&0===g&&E(),t}));var t}function S(e){x[e]?(b[e]=!0,g++,function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.charset="utf-8",n.src=C.p+""+e+"."+i+".hot-update.js",t.appendChild(n)}(e)):y[e]=!0}function E(){h("ready");var e=f;if(f=null,e)if(r)Promise.resolve().then((function(){return T(r)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var n in p)Object.prototype.hasOwnProperty.call(p,n)&&t.push(w(n));e.resolve(t)}}function T(t){if("ready"!==d)throw new Error("apply() is only allowed in ready status");var n,r,s,l,u;function c(e){for(var t=[e],n={},r=t.slice().map((function(e){return{chain:[e],id:e}}));r.length>0;){var i=r.pop(),a=i.id,o=i.chain;if((l=k[a])&&!l.hot._selfAccepted){if(l.hot._selfDeclined)return{type:"self-declined",chain:o,moduleId:a};if(l.hot._main)return{type:"unaccepted",chain:o,moduleId:a};for(var s=0;s<l.parents.length;s++){var u=l.parents[s],c=k[u];if(c){if(c.hot._declinedDependencies[a])return{type:"declined",chain:o.concat([u]),moduleId:a,parentId:u};-1===t.indexOf(u)&&(c.hot._acceptedDependencies[a]?(n[u]||(n[u]=[]),f(n[u],[a])):(delete n[u],t.push(u),r.push({chain:o.concat([u]),id:u})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];-1===e.indexOf(r)&&e.push(r)}}t=t||{};var g={},v=[],y={},b=function(){console.warn("[HMR] unexpected require("+S.moduleId+") to disposed module")};for(var _ in p)if(Object.prototype.hasOwnProperty.call(p,_)){var S;u=w(_);var E=!1,T=!1,I=!1,O="";switch((S=p[_]?c(u):{type:"disposed",moduleId:_}).chain&&(O="\nUpdate propagation: "+S.chain.join(" -> ")),S.type){case"self-declined":t.onDeclined&&t.onDeclined(S),t.ignoreDeclined||(E=new Error("Aborted because of self decline: "+S.moduleId+O));break;case"declined":t.onDeclined&&t.onDeclined(S),t.ignoreDeclined||(E=new Error("Aborted because of declined dependency: "+S.moduleId+" in "+S.parentId+O));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(S),t.ignoreUnaccepted||(E=new Error("Aborted because "+u+" is not accepted"+O));break;case"accepted":t.onAccepted&&t.onAccepted(S),T=!0;break;case"disposed":t.onDisposed&&t.onDisposed(S),I=!0;break;default:throw new Error("Unexception type "+S.type)}if(E)return h("abort"),Promise.reject(E);if(T)for(u in y[u]=p[u],f(v,S.outdatedModules),S.outdatedDependencies)Object.prototype.hasOwnProperty.call(S.outdatedDependencies,u)&&(g[u]||(g[u]=[]),f(g[u],S.outdatedDependencies[u]));I&&(f(v,[S.moduleId]),y[u]=b)}var A,D=[];for(r=0;r<v.length;r++)k[u=v[r]]&&k[u].hot._selfAccepted&&D.push({module:u,errorHandler:k[u].hot._selfAccepted});h("dispose"),Object.keys(x).forEach((function(e){!1===x[e]&&function(e){delete installedChunks[e]}(e)}));for(var M,N=v.slice();N.length>0;)if(u=N.pop(),l=k[u]){var j={},R=l.hot._disposeHandlers;for(s=0;s<R.length;s++)(n=R[s])(j);for(a[u]=j,l.hot.active=!1,delete k[u],delete g[u],s=0;s<l.children.length;s++){var P=k[l.children[s]];P&&(A=P.parents.indexOf(u))>=0&&P.parents.splice(A,1)}}for(u in g)if(Object.prototype.hasOwnProperty.call(g,u)&&(l=k[u]))for(M=g[u],s=0;s<M.length;s++)(A=l.children.indexOf(M[s]))>=0&&l.children.splice(A,1);for(u in h("apply"),i=m,y)Object.prototype.hasOwnProperty.call(y,u)&&(e[u]=y[u]);var F=null;for(u in g)if(Object.prototype.hasOwnProperty.call(g,u)&&(l=k[u])){M=g[u];var L=[];for(r=0;r<M.length;r++)if(n=l.hot._acceptedDependencies[M[r]]){if(-1!==L.indexOf(n))continue;L.push(n)}for(r=0;r<L.length;r++){n=L[r];try{n(M)}catch(B){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:u,dependencyId:M[r],error:B}),t.ignoreErrored||F||(F=B)}}}for(r=0;r<D.length;r++){var $=D[r];o=[u=$.module];try{C(u)}catch(B){if("function"==typeof $.errorHandler)try{$.errorHandler(B)}catch(z){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:u,error:z,originalError:B}),t.ignoreErrored||F||(F=z),F||(F=B)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:u,error:B}),t.ignoreErrored||F||(F=B)}}return F?(h("fail"),Promise.reject(F)):(h("idle"),new Promise((function(e){e(v)})))}var k={};function C(t){if(k[t])return k[t].exports;var n=k[t]={i:t,l:!1,exports:{},hot:u(t),parents:(s=o,o=[],s),children:[]};return e[t].call(n.exports,n,n.exports,l(t)),n.l=!0,n.exports}return C.m=e,C.c=k,C.d=function(e,t,n){C.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},C.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},C.t=function(e,t){if(1&t&&(e=C(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(C.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)C.d(n,r,(function(t){return e[t]}).bind(null,r));return n},C.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return C.d(t,"a",t),t},C.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},C.p="",C.h=function(){return i},l("./imageLoader/index.js")(C.s="./imageLoader/index.js")}({"./externalModules.js":function(e,t,n){"use strict";n.r(t);var r,i,a=n("./imageLoader/registerLoaders.js");t.default={set cornerstone(e){r=e,Object(a.default)(r)},get cornerstone(){if(!r){if(!window||!window.cornerstone)throw new Error("cornerstoneWADOImageLoader requires a copy of Cornerstone to work properly. Please add cornerstoneWADOImageLoader.external.cornerstone = cornerstone; to your application.");r=window.cornerstone,Object(a.default)(r)}return r},set dicomParser(e){i=e},get dicomParser(){if(!i){if(!window||!window.dicomParser)throw new Error("cornerstoneWADOImageLoader requires a copy of dicomParser to work properly. Please add cornerstoneWADOImageLoader.external.dicomParser = dicomParser; to your application.");i=window.dicomParser}return i}}},"./imageLoader/colorSpaceConverters/convertPALETTECOLOR.js":function(e,t,n){"use strict";function r(e,t){for(var n=e.length,r=new Uint8ClampedArray(n),i=0;i<n;++i)r[i]=e[i]>>t;return r}n.r(t),t.default=function(e,t){for(var n=e.columns*e.rows,i=e.pixelData,a=e.greenPaletteColorLookupTableData,o=e.bluePaletteColorLookupTableData,s=e.redPaletteColorLookupTableData.length,l=0,u=0,c=e.redPaletteColorLookupTableDescriptor[1],d=8===e.redPaletteColorLookupTableDescriptor[2]?0:8,h=r(e.redPaletteColorLookupTableData,d),f=r(a,d),p=r(o,d),m=0;m<n;++m){var g=i[l++];g<c?g=0:g>c+s-1?g=s-1:g-=c,t[u++]=h[g],t[u++]=f[g],t[u++]=p[g],t[u++]=255}}},"./imageLoader/colorSpaceConverters/convertRGBColorByPixel.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if(void 0===e)throw new Error("decodeRGB: rgbBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: rgbBuffer length must be divisible by 3");for(var n=e.length/3,r=0,i=0,a=0;a<n;a++)t[i++]=e[r++],t[i++]=e[r++],t[i++]=e[r++],t[i++]=255}},"./imageLoader/colorSpaceConverters/convertRGBColorByPlane.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if(void 0===e)throw new Error("decodeRGB: rgbBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: rgbBuffer length must be divisible by 3");for(var n=e.length/3,r=0,i=0,a=n,o=2*n,s=0;s<n;s++)t[r++]=e[i++],t[r++]=e[a++],t[r++]=e[o++],t[r++]=255}},"./imageLoader/colorSpaceConverters/convertYBRFullByPixel.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");for(var n=e.length/3,r=0,i=0,a=0;a<n;a++){var o=e[r++],s=e[r++],l=e[r++];t[i++]=o+1.402*(l-128),t[i++]=o-.34414*(s-128)-.71414*(l-128),t[i++]=o+1.772*(s-128),t[i++]=255}}},"./imageLoader/colorSpaceConverters/convertYBRFullByPlane.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");for(var n=e.length/3,r=0,i=0,a=n,o=2*n,s=0;s<n;s++){var l=e[i++],u=e[a++],c=e[o++];t[r++]=l+1.402*(c-128),t[r++]=l-.34414*(u-128)-.71414*(c-128),t[r++]=l+1.772*(u-128),t[r++]=255}}},"./imageLoader/colorSpaceConverters/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/colorSpaceConverters/convertRGBColorByPixel.js");n.d(t,"convertRGBColorByPixel",(function(){return r.default}));var i=n("./imageLoader/colorSpaceConverters/convertRGBColorByPlane.js");n.d(t,"convertRGBColorByPlane",(function(){return i.default}));var a=n("./imageLoader/colorSpaceConverters/convertYBRFullByPixel.js");n.d(t,"convertYBRFullByPixel",(function(){return a.default}));var o=n("./imageLoader/colorSpaceConverters/convertYBRFullByPlane.js");n.d(t,"convertYBRFullByPlane",(function(){return o.default}));var s=n("./imageLoader/colorSpaceConverters/convertPALETTECOLOR.js");n.d(t,"convertPALETTECOLOR",(function(){return s.default}))},"./imageLoader/configure.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/internal/index.js");t.default=function(e){Object(r.setOptions)(e)}},"./imageLoader/convertColorSpace.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=n("./imageLoader/colorSpaceConverters/index.js");function i(e,t){0===e.planarConfiguration?Object(r.convertRGBColorByPixel)(e.pixelData,t):Object(r.convertRGBColorByPlane)(e.pixelData,t)}function a(e,t){var n=t.data;if("RGB"===e.photometricInterpretation)i(e,n);else if("YBR_RCT"===e.photometricInterpretation)i(e,n);else if("YBR_ICT"===e.photometricInterpretation)i(e,n);else if("PALETTE COLOR"===e.photometricInterpretation)Object(r.convertPALETTECOLOR)(e,n);else if("YBR_FULL_422"===e.photometricInterpretation)i(e,n);else{if("YBR_FULL"!==e.photometricInterpretation)throw new Error("No color space conversion for photometric interpretation ".concat(e.photometricInterpretation));!function(e,t){0===e.planarConfiguration?Object(r.convertYBRFullByPixel)(e.pixelData,t):Object(r.convertYBRFullByPlane)(e.pixelData,t)}(e,n)}}},"./imageLoader/createImage.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./imageLoader/getImageFrame.js"),a=n("./imageLoader/decodeImageFrame.js"),o=n("./imageLoader/isColorImage.js"),s=n("./imageLoader/convertColorSpace.js"),l=n("./shared/getMinMax.js"),u=n("./imageLoader/isJPEGBaseline8BitColor.js"),c="";t.default=function(e,t,n,d){if(!t||!t.length)return Promise.reject(new Error("The file does not contain image data."));var h=r.default.cornerstone,f=document.createElement("canvas"),p=Object(i.default)(e),m=Object(a.default)(p,n,t,f,d);return new Promise((function(t,r){m.then((function(r){var i=h.metaData.get("imagePlaneModule",e)||{},a=h.metaData.get("voiLutModule",e)||{},d=h.metaData.get("modalityLutModule",e)||{},p=h.metaData.get("sopCommonModule",e)||{},m=Object(o.default)(r.photometricInterpretation);if(!Object(u.default)(r,n)&&(function(e){e.pixelData=32===e.bitsAllocated?new Float32Array(e.pixelData):16===e.bitsAllocated?0===e.pixelRepresentation?new Uint16Array(e.pixelData):new Int16Array(e.pixelData):new Uint8Array(e.pixelData)}(r),m)){f.height=r.rows,f.width=r.columns;var g=f.getContext("2d").createImageData(r.columns,r.rows);Object(s.default)(r,g),r.imageData=g,r.pixelData=g.data;var v=Object(l.default)(r.pixelData);r.smallestPixelValue=v.min,r.largestPixelValue=v.max}var y,b={imageId:e,color:m,columnPixelSpacing:i.columnPixelSpacing,columns:r.columns,height:r.rows,intercept:d.rescaleIntercept?d.rescaleIntercept:0,invert:"MONOCHROME1"===r.photometricInterpretation,minPixelValue:r.smallestPixelValue,maxPixelValue:r.largestPixelValue,rowPixelSpacing:i.rowPixelSpacing,rows:r.rows,sizeInBytes:r.pixelData.length,slope:d.rescaleSlope?d.rescaleSlope:1,width:r.columns,windowCenter:a.windowCenter?a.windowCenter[0]:void 0,windowWidth:a.windowWidth?a.windowWidth[0]:void 0,decodeTimeInMS:r.decodeTimeInMS,floatPixelData:void 0};if(r.pixelData instanceof Float32Array){var x=r.pixelData,w=function(e){for(var t=Object(l.default)(e),n=Math.abs(t.max-t.min)/65535,r=t.min,i=e.length,a=new Uint16Array(i),o=65535,s=0,u=0;u<i;u++){var c=Math.floor((e[u]-r)/n);a[u]=c,o=Math.min(o,c),s=Math.max(s,c)}return{min:o,max:s,intPixelData:a,slope:n,intercept:r}}(x);b.minPixelValue=w.min,b.maxPixelValue=w.max,b.slope=w.slope,b.intercept=w.intercept,b.floatPixelData=x,b.getPixelData=function(){return w.intPixelData}}else b.getPixelData=function(){return r.pixelData};if(b.color&&(b.getCanvas=function(){return c===e||(f.height=b.rows,f.width=b.columns,f.getContext("2d").putImageData(r.imageData,0,0),c=e),f}),d.modalityLUTSequence&&d.modalityLUTSequence.length>0&&"1.2.840.10008.5.1.4.1.1.12.1"!==(y=p.sopClassUID)&&"1.2.840.10008.5.1.4.1.1.12.2.1"!==y&&(b.modalityLUT=d.modalityLUTSequence[0]),a.voiLUTSequence&&a.voiLUTSequence.length>0&&(b.voiLUT=a.voiLUTSequence[0]),b.color&&(b.windowWidth=255,b.windowCenter=127),void 0===b.windowCenter||void 0===b.windowWidth){var _=b.maxPixelValue*b.slope+b.intercept,S=b.minPixelValue*b.slope+b.intercept;b.windowWidth=_-S,b.windowCenter=(_+S)/2}t(b)}),r)}))}},"./imageLoader/decodeImageFrame.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/internal/options.js"),i=n("./imageLoader/webWorkerManager.js"),a=n("./imageLoader/decodeJPEGBaseline8BitColor.js"),o=n("./shared/decodeImageFrame.js"),s=n("./shared/calculateMinMax.js"),l=n("./shared/decoders/decodeJPEG2000.js"),u=n("./shared/decoders/decodeJPEGLS.js"),c=!1;function d(e,t,n,a){var d=a.priority||void 0,h=a.transferPixelData?[n.buffer]:void 0,f=Object(r.getOptions)(),p=f.strict,m=f.decodeConfig;return!1===f.useWebWorkers?(!1===c&&(Object(l.initializeJPEG2000)(m),Object(u.initializeJPEGLS)(m),c=!0),new Promise((function(r,i){try{var l=o.default.apply(void 0,[e,t,n,m,a]);Object(s.default)(l,p),r(l)}catch(u){i(u)}}))):i.default.addTask("decodeTask",{imageFrame:e,transferSyntax:t,pixelData:n,options:a},d,h).promise}t.default=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return"1.2.840.10008.1.2"===t||"1.2.840.10008.1.2.1"===t||"1.2.840.10008.1.2.2"===t||"1.2.840.10008.1.2.1.99"===t||"1.2.840.10008.1.2.5"===t?d(e,t,n,i):"1.2.840.10008.1.2.4.50"===t?8!==e.bitsAllocated||3!==e.samplesPerPixel&&4!==e.samplesPerPixel?d(e,t,n,i):Object(a.default)(e,n,r):"1.2.840.10008.1.2.4.51"===t||"1.2.840.10008.1.2.4.57"===t||"1.2.840.10008.1.2.4.70"===t||"1.2.840.10008.1.2.4.80"===t||"1.2.840.10008.1.2.4.81"===t||"1.2.840.10008.1.2.4.90"===t||"1.2.840.10008.1.2.4.91"===t?d(e,t,n,i):new Promise((function(e,n){n(new Error("No decoder for transfer syntax ".concat(t)))}))}},"./imageLoader/decodeJPEGBaseline8BitColor.js":function(e,t,n){"use strict";n.r(t);var r=n("./shared/getMinMax.js");t.default=function(e,t,n){var i=(new Date).getTime(),a=new Blob([t],{type:"image/jpeg"});return new Promise((function(t,o){var s=new FileReader;void 0===s.readAsBinaryString?s.readAsArrayBuffer(a):s.readAsBinaryString(a),s.onload=function(){var a=new Image;a.onload=function(){n.height=a.height,n.width=a.width,e.rows=a.height,e.columns=a.width;var o=n.getContext("2d");o.drawImage(this,0,0);var s=o.getImageData(0,0,a.width,a.height),l=(new Date).getTime();e.pixelData=s.data,e.imageData=s,e.decodeTimeInMS=l-i;var u=Object(r.default)(e.pixelData);e.smallestPixelValue=u.min,e.largestPixelValue=u.max,t(e)},a.onerror=function(e){o(e)},a.src="data:image/jpeg;base64,".concat(void 0===s.readAsBinaryString?window.btoa(function(e){var t;try{return decodeURIComponent(escape(e))}catch(n){if((t=n)instanceof URIError)return e;throw t}}(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(s.result))))):window.btoa(s.result))},s.onerror=function(e){o(e)}}))}},"./imageLoader/getImageFrame.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js");t.default=function(e){var t=r.default.cornerstone.metaData.get("imagePixelModule",e);return{samplesPerPixel:t.samplesPerPixel,photometricInterpretation:t.photometricInterpretation,planarConfiguration:t.planarConfiguration,rows:t.rows,columns:t.columns,bitsAllocated:t.bitsAllocated,bitsStored:t.bitsStored,pixelRepresentation:t.pixelRepresentation,smallestPixelValue:t.smallestPixelValue,largestPixelValue:t.largestPixelValue,redPaletteColorLookupTableDescriptor:t.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:t.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:t.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:t.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:t.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:t.bluePaletteColorLookupTableData,pixelData:void 0}}},"./imageLoader/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/colorSpaceConverters/index.js");n.d(t,"convertRGBColorByPixel",(function(){return r.convertRGBColorByPixel})),n.d(t,"convertRGBColorByPlane",(function(){return r.convertRGBColorByPlane})),n.d(t,"convertYBRFullByPixel",(function(){return r.convertYBRFullByPixel})),n.d(t,"convertYBRFullByPlane",(function(){return r.convertYBRFullByPlane})),n.d(t,"convertPALETTECOLOR",(function(){return r.convertPALETTECOLOR}));var i=n("./imageLoader/wadouri/index.js");n.d(t,"wadouri",(function(){return i.default}));var a=n("./imageLoader/wadors/index.js");n.d(t,"wadors",(function(){return a.default}));var o=n("./imageLoader/configure.js");n.d(t,"configure",(function(){return o.default}));var s=n("./imageLoader/convertColorSpace.js");n.d(t,"convertColorSpace",(function(){return s.default}));var l=n("./imageLoader/createImage.js");n.d(t,"createImage",(function(){return l.default}));var u=n("./imageLoader/decodeImageFrame.js");n.d(t,"decodeImageFrame",(function(){return u.default}));var c=n("./imageLoader/decodeJPEGBaseline8BitColor.js");n.d(t,"decodeJPEGBaseline8BitColor",(function(){return c.default}));var d=n("./imageLoader/getImageFrame.js");n.d(t,"getImageFrame",(function(){return d.default}));var h=n("./shared/getMinMax.js");n.d(t,"getMinMax",(function(){return h.default}));var f=n("./imageLoader/isColorImage.js");n.d(t,"isColorImage",(function(){return f.default}));var p=n("./imageLoader/isJPEGBaseline8BitColor.js");n.d(t,"isJPEGBaseline8BitColor",(function(){return p.default}));var m=n("./imageLoader/webWorkerManager.js");n.d(t,"webWorkerManager",(function(){return m.default}));var g=n("./version.js");n.d(t,"version",(function(){return g.default}));var v=n("./imageLoader/internal/index.js");n.d(t,"internal",(function(){return v.internal}));var y=n("./externalModules.js");n.d(t,"external",(function(){return y.default})),t.default={convertRGBColorByPixel:r.convertRGBColorByPixel,convertRGBColorByPlane:r.convertRGBColorByPlane,convertYBRFullByPixel:r.convertYBRFullByPixel,convertYBRFullByPlane:r.convertYBRFullByPlane,convertPALETTECOLOR:r.convertPALETTECOLOR,wadouri:i.default,wadors:a.default,configure:o.default,convertColorSpace:s.default,createImage:l.default,decodeImageFrame:u.default,decodeJPEGBaseline8BitColor:c.default,getImageFrame:d.default,getMinMax:h.default,isColorImage:f.default,isJPEGBaseline8BitColor:p.default,webWorkerManager:m.default,version:g.default,internal:v.internal,external:y.default}},"./imageLoader/internal/index.js":function(e,t,n){"use strict";n.r(t),n.d(t,"internal",(function(){return a}));var r=n("./imageLoader/internal/xhrRequest.js");n.d(t,"xhrRequest",(function(){return r.default}));var i=n("./imageLoader/internal/options.js");n.d(t,"setOptions",(function(){return i.setOptions})),n.d(t,"getOptions",(function(){return i.getOptions}));var a={xhrRequest:r.default,setOptions:i.setOptions,getOptions:i.getOptions}},"./imageLoader/internal/options.js":function(e,t,n){"use strict";n.r(t),n.d(t,"setOptions",(function(){return i})),n.d(t,"getOptions",(function(){return a}));var r={beforeSend:function(){},imageCreated:function(){},strict:!1,useWebWorkers:!0,decodeConfig:{usePDFJS:!1}};function i(e){r=Object.assign(r,e)}function a(){return r}},"./imageLoader/internal/xhrRequest.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./imageLoader/internal/options.js");t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=r.default.cornerstone,s=Object(i.getOptions)();return new Promise((function(r,i){var l=new XMLHttpRequest;l.open("get",e,!0),l.responseType="arraybuffer",s.beforeSend(l,t,n,a),Object.keys(n).forEach((function(e){l.setRequestHeader(e,n[e])})),a.deferred={resolve:r,reject:i},a.url=e,a.imageId=t,l.onloadstart=function(n){s.onloadstart&&s.onloadstart(n,a),o.triggerEvent(o.events,"cornerstoneimageloadstart",{url:e,imageId:t})},l.onloadend=function(n){s.onloadend&&s.onloadend(n,a),o.triggerEvent(o.events,"cornerstoneimageloadend",{url:e,imageId:t})},l.onreadystatechange=function(e){s.onreadystatechange?s.onreadystatechange(e,a):4===l.readyState&&(200===l.status?r(l.response,l):i(l))},l.onprogress=function(n){var r,i,l=n.loaded;n.lengthComputable&&(r=n.total,i=Math.round(l/r*100)),s.onprogress&&s.onprogress(n,a),o.triggerEvent(o.events,"cornerstoneimageloadprogress",{url:e,imageId:t,loaded:l,total:r,percentComplete:i})},l.onerror=function(){i(l)},l.onabort=function(){i(l)},l.send()}))}},"./imageLoader/isColorImage.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){return"RGB"===e||"PALETTE COLOR"===e||"YBR_FULL"===e||"YBR_FULL_422"===e||"YBR_PARTIAL_422"===e||"YBR_PARTIAL_420"===e||"YBR_RCT"===e||"YBR_ICT"===e}},"./imageLoader/isJPEGBaseline8BitColor.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if(t=t||e.transferSyntax,8===e.bitsAllocated&&"1.2.840.10008.1.2.4.50"===t&&(3===e.samplesPerPixel||4===e.samplesPerPixel))return!0}},"./imageLoader/registerLoaders.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadors/index.js"),i=n("./imageLoader/wadouri/index.js");t.default=function(e){r.default.register(e),i.default.register(e)}},"./imageLoader/wadors/findIndexOfString.js":function(e,t,n){"use strict";function r(e,t,n){if(n+e.length>t.length)return!1;for(var r=n,i=0;i<e.length;i++)if(e[i]!==t[r++])return!1;return!0}n.r(t),t.default=function(e,t,n){n=n||0;for(var i=function(e){for(var t=new Uint8Array(e.length),n=0,r=e.length;n<r;n++)t[n]=e.charCodeAt(n);return t}(t),a=n;a<e.length;a++)if(i[0]===e[a]&&r(i,e,a))return a;return-1}},"./imageLoader/wadors/getPixelData.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/internal/index.js"),i=n("./imageLoader/wadors/findIndexOfString.js");function a(e){for(var t=0;t<e.length;t++)if("--"===e[t].substr(0,2))return e[t]}function o(e){for(var t=0;t<e.length;t++)if("Content-Type:"===e[t].substr(0,13))return e[t].substr(13).trim()}function s(e,t,n){t=t||0,n=n||e.length-t;for(var r="",i=t;i<t+n;i++)r+=String.fromCharCode(e[i]);return r}t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/octet-stream",l={accept:n};return new Promise((function(n,u){Object(r.xhrRequest)(e,t,l).then((function(e){var t=new Uint8Array(e),r=Object(i.default)(t,"\r\n\r\n");-1===r&&u(new Error("invalid response - no multipart mime header"));var l=s(t,0,r).split("\r\n"),c=a(l);c||u(new Error("invalid response - no boundary marker"));var d=r+4,h=Object(i.default)(t,c,d);-1===h&&u(new Error("invalid response - terminating boundary not found"));var f=h-d-2;n({contentType:o(l),imageFrame:{pixelData:new Uint8Array(e,d,f)}})}),u)}))}},"./imageLoader/wadors/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadors/metaData/index.js"),i=n("./imageLoader/wadors/findIndexOfString.js"),a=n("./imageLoader/wadors/getPixelData.js"),o=n("./imageLoader/wadors/metaDataManager.js"),s=n("./imageLoader/wadors/loadImage.js"),l=n("./imageLoader/wadors/register.js");t.default={metaData:{getNumberString:r.getNumberString,getNumberValue:r.getNumberValue,getNumberValues:r.getNumberValues,getValue:r.getValue,metaDataProvider:r.metaDataProvider},findIndexOfString:i.default,getPixelData:a.default,loadImage:s.default,metaDataManager:o.default,register:l.default}},"./imageLoader/wadors/loadImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getTransferSyntaxForContentType",(function(){return o}));var r=n("./imageLoader/wadors/metaDataManager.js"),i=n("./imageLoader/wadors/getPixelData.js"),a=n("./imageLoader/createImage.js");function o(e){var t="1.2.840.10008.1.2";if(!e)return t;var n=e.split(";"),r={};n.forEach((function(e){var t=e.split("=");if(2===t.length){var n=t[1].trim().replace(/"/g,"");r[t[0].trim()]=n}}));var i={"image/jpeg":"1.2.840.10008.1.2.4.70","image/x-dicom-rle":"1.2.840.10008.1.2.5","image/x-jls":"1.2.840.10008.1.2.4.80","image/jp2":"1.2.840.10008.1.2.4.90","image/jpx":"1.2.840.10008.1.2.4.92"};return r["transfer-syntax"]?r["transfer-syntax"]:e&&!Object.keys(r).length&&i[e]?i[e]:r.type&&i[r.type]?i[r.type]:t}t.default=function(e,t){var n=(new Date).getTime(),s=e.substring(7);return{promise:new Promise((function(l,u){if(void 0===r.default.get(e)){var c=new Error("no metadata for imageId ".concat(e));return u(c)}Object(i.default)(s,e,'multipart/related; type="application/octet-stream"').then((function(r){var i=o(r.contentType),s=r.imageFrame.pixelData;Object(a.default)(e,s,i,t).then((function(e){var t=(new Date).getTime();e.loadTimeInMS=t-n,l(e)}),u)}),u).catch((function(e){u(e)}))})),cancelFn:void 0}}},"./imageLoader/wadors/metaData/getNumberString.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadors/metaData/getValue.js");t.default=function(e,t,n){var i=Object(r.default)(e,t,n);if(void 0!==i)return parseFloat(i)}},"./imageLoader/wadors/metaData/getNumberValue.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadors/metaData/getValue.js");t.default=function(e,t){var n=Object(r.default)(e,t);if(void 0!==n)return parseFloat(n)}},"./imageLoader/wadors/metaData/getNumberValues.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if(e&&e.Value&&!(t&&e.Value.length<t)){for(var n=[],r=0;r<e.Value.length;r++)n.push(parseFloat(e.Value[r]));return n}}},"./imageLoader/wadors/metaData/getValue.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){return t=t||0,e&&e.Value?e.Value.length<=t?n:e.Value[t]:n}},"./imageLoader/wadors/metaData/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadors/metaData/getNumberString.js");n.d(t,"getNumberString",(function(){return r.default}));var i=n("./imageLoader/wadors/metaData/getNumberValue.js");n.d(t,"getNumberValue",(function(){return i.default}));var a=n("./imageLoader/wadors/metaData/getNumberValues.js");n.d(t,"getNumberValues",(function(){return a.default}));var o=n("./imageLoader/wadors/metaData/getValue.js");n.d(t,"getValue",(function(){return o.default}));var s=n("./imageLoader/wadors/metaData/metaDataProvider.js");n.d(t,"metaDataProvider",(function(){return s.default}))},"./imageLoader/wadors/metaData/metaDataProvider.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./imageLoader/wadors/metaData/getNumberValues.js"),a=n("./imageLoader/wadors/metaData/getValue.js"),o=n("./imageLoader/wadors/metaData/getNumberValue.js"),s=n("./imageLoader/wadors/metaDataManager.js");t.default=function(e,t){var n=r.default.dicomParser,l=s.default.get(t);if(l){if("generalSeriesModule"===e)return{modality:Object(a.default)(l["00080060"]),seriesInstanceUID:Object(a.default)(l["0020000e"]),seriesNumber:Object(o.default)(l["00200011"]),studyInstanceUID:Object(a.default)(l["0020000d"]),seriesDate:n.parseDA(Object(a.default)(l["00080021"])),seriesTime:n.parseTM(Object(a.default)(l["00080031"],0,""))};if("patientStudyModule"===e)return{patientAge:Object(o.default)(l["00101010"]),patientSize:Object(o.default)(l["00101020"]),patientWeight:Object(o.default)(l["00101030"])};if("imagePlaneModule"===e){var u=Object(i.default)(l["00200037"],6),c=Object(i.default)(l["00200032"],3),d=Object(i.default)(l["00280030"],2),h=null,f=null;d&&(f=d[0],h=d[1]);var p=null,m=null;return u&&(p=[parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])],m=[parseFloat(u[3]),parseFloat(u[4]),parseFloat(u[5])]),{frameOfReferenceUID:Object(a.default)(l["00200052"]),rows:Object(o.default)(l["00280010"]),columns:Object(o.default)(l["00280011"]),imageOrientationPatient:u,rowCosines:p,columnCosines:m,imagePositionPatient:c,sliceThickness:Object(o.default)(l["00180050"]),sliceLocation:Object(o.default)(l["00201041"]),pixelSpacing:d,rowPixelSpacing:f,columnPixelSpacing:h}}if("imagePixelModule"===e)return{samplesPerPixel:Object(o.default)(l["00280002"]),photometricInterpretation:Object(a.default)(l["00280004"]),rows:Object(o.default)(l["00280010"]),columns:Object(o.default)(l["00280011"]),bitsAllocated:Object(o.default)(l["00280100"]),bitsStored:Object(o.default)(l["00280101"]),highBit:Object(a.default)(l["00280102"]),pixelRepresentation:Object(o.default)(l["00280103"]),planarConfiguration:Object(o.default)(l["00280006"]),pixelAspectRatio:Object(a.default)(l["00280034"]),smallestPixelValue:Object(o.default)(l["00280106"]),largestPixelValue:Object(o.default)(l["00280107"]),redPaletteColorLookupTableDescriptor:Object(i.default)(l["00281101"]),greenPaletteColorLookupTableDescriptor:Object(i.default)(l["00281102"]),bluePaletteColorLookupTableDescriptor:Object(i.default)(l["00281103"]),redPaletteColorLookupTableData:Object(i.default)(l["00281201"]),greenPaletteColorLookupTableData:Object(i.default)(l["00281202"]),bluePaletteColorLookupTableData:Object(i.default)(l["00281203"])};if("voiLutModule"===e)return{windowCenter:Object(i.default)(l["00281050"],1),windowWidth:Object(i.default)(l["00281051"],1)};if("modalityLutModule"===e)return{rescaleIntercept:Object(o.default)(l["00281052"]),rescaleSlope:Object(o.default)(l["00281053"]),rescaleType:Object(a.default)(l["00281054"])};if("sopCommonModule"===e)return{sopClassUID:Object(a.default)(l["00080016"]),sopInstanceUID:Object(a.default)(l["00080018"])};if("petIsotopeModule"===e){var g=Object(a.default)(l["00540016"]);if(void 0===g)return;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:n.parseTM(Object(a.default)(g["00181072"],0,"")),radionuclideTotalDose:Object(o.default)(g["00181074"]),radionuclideHalfLife:Object(o.default)(g["00181075"])}}}}}},"./imageLoader/wadors/metaDataManager.js":function(e,t,n){"use strict";n.r(t);var r=[];t.default={add:function(e,t){r[e]=t},get:function(e){return r[e]},remove:function(e){r[e]=void 0},purge:function(){r=[]}}},"./imageLoader/wadors/register.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadors/loadImage.js"),i=n("./imageLoader/wadors/metaData/index.js");t.default=function(e){e.registerImageLoader("wadors",r.default),e.metaData.addProvider(i.metaDataProvider)}},"./imageLoader/wadouri/dataSetCacheManager.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getInfo",(function(){return l}));var r=n("./externalModules.js"),i=n("./imageLoader/internal/index.js"),a=0,o={},s={};function l(){return{cacheSizeInBytes:a,numberOfDataSetsCached:Object.keys(o).length}}t.default={isLoaded:function(e){return void 0!==o[e]},load:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.xhrRequest,n=arguments.length>2?arguments[2]:void 0,u=r.default.cornerstone,c=r.default.dicomParser;if(o[e])return new Promise((function(t){o[e].cacheCount++,t(o[e].dataSet)}));if(s[e])return s[e].cacheCount++,s[e];var d=t(e,n),h=new Promise((function(t,n){d.then((function(r){var i,s=new Uint8Array(r);try{i=c.parseDicom(s)}catch(d){return n(d)}o[e]={dataSet:i,cacheCount:h.cacheCount},a+=i.byteArray.length,t(i),u.triggerEvent(u.events,"datasetscachechanged",{uri:e,action:"loaded",cacheInfo:l()})}),n).then((function(){delete s[e]}),(function(){delete s[e]}))}));return h.cacheCount=1,s[e]=h,h},unload:function(e){var t=r.default.cornerstone;o[e]&&(o[e].cacheCount--,0===o[e].cacheCount&&(a-=o[e].dataSet.byteArray.length,delete o[e],t.triggerEvent(t.events,"datasetscachechanged",{uri:e,action:"unloaded",cacheInfo:l()})))},getInfo:l,purge:function(){o={},s={}},get:function(e){if(o[e])return o[e].dataSet}}},"./imageLoader/wadouri/fileManager.js":function(e,t,n){"use strict";n.r(t);var r=[];t.default={add:function(e){var t=r.push(e);return"dicomfile:".concat(t-1)},get:function(e){return r[e]},remove:function(e){r[e]=void 0},purge:function(){r=[]}}},"./imageLoader/wadouri/getEncapsulatedImageFrame.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./externalModules.js");function i(e,t){var n=r.default.dicomParser;if(e.elements.x7fe00010&&e.elements.x7fe00010.basicOffsetTable.length)return n.readEncapsulatedImageFrame(e,e.elements.x7fe00010,t);if(function(e){return e.intString("x00280008")!==e.elements.x7fe00010.fragments.length}(e)){var i=n.createJPEGBasicOffsetTable(e,e.elements.x7fe00010);return n.readEncapsulatedImageFrame(e,e.elements.x7fe00010,t,i)}return n.readEncapsulatedPixelDataFromFragments(e,e.elements.x7fe00010,t)}},"./imageLoader/wadouri/getPixelData.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadouri/getEncapsulatedImageFrame.js"),i=n("./imageLoader/wadouri/getUncompressedImageFrame.js");t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.elements.x7fe00010||e.elements.x7fe00008;return n?n.encapsulatedPixelData?Object(r.default)(e,t):Object(i.default)(e,t):null}},"./imageLoader/wadouri/getUncompressedImageFrame.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadouri/unpackBinaryFrame.js");t.default=function(e,t){var n,i=e.elements.x7fe00010||e.elements.x7fe00008,a=e.uint16("x00280100"),o=e.uint16("x00280010"),s=e.uint16("x00280011"),l=e.uint16("x00280002"),u=i.dataOffset,c=o*s*l;if(8===a){if((n=u+t*c)>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer,n,c)}if(16===a){if((n=u+t*c*2)>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer,n,2*c)}if(1===a){if((n=u+t*c*.125)>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return Object(r.default)(e.byteArray,n,c)}if(32===a){if((n=u+t*c*4)>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer,n,4*c)}throw new Error("unsupported pixel format")}},"./imageLoader/wadouri/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadouri/metaData/index.js"),i=n("./imageLoader/wadouri/dataSetCacheManager.js"),a=n("./imageLoader/wadouri/fileManager.js"),o=n("./imageLoader/wadouri/getEncapsulatedImageFrame.js"),s=n("./imageLoader/wadouri/getUncompressedImageFrame.js"),l=n("./imageLoader/wadouri/loadFileRequest.js"),u=n("./imageLoader/wadouri/loadImage.js"),c=n("./imageLoader/wadouri/parseImageId.js"),d=n("./imageLoader/wadouri/unpackBinaryFrame.js"),h=n("./imageLoader/wadouri/register.js");t.default={metaData:{getImagePixelModule:r.getImagePixelModule,getLUTs:r.getLUTs,getModalityLUTOutputPixelRepresentation:r.getModalityLUTOutputPixelRepresentation,getNumberValues:r.getNumberValues,metaDataProvider:r.metaDataProvider},dataSetCacheManager:i.default,fileManager:a.default,getEncapsulatedImageFrame:o.default,getUncompressedImageFrame:s.default,loadFileRequest:l.default,loadImageFromPromise:u.loadImageFromPromise,getLoaderForScheme:u.getLoaderForScheme,loadImage:u.loadImage,parseImageId:c.default,unpackBinaryFrame:d.default,register:h.default}},"./imageLoader/wadouri/loadFileRequest.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadouri/parseImageId.js"),i=n("./imageLoader/wadouri/fileManager.js");t.default=function(e){var t=Object(r.default)(e),n=parseInt(t.url,10),a=i.default.get(n);return new Promise((function(e,t){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.onerror=t,n.readAsArrayBuffer(a)}))}},"./imageLoader/wadouri/loadImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"loadImageFromPromise",(function(){return c})),n.d(t,"getLoaderForScheme",(function(){return h})),n.d(t,"loadImage",(function(){return f}));var r=n("./imageLoader/createImage.js"),i=n("./imageLoader/wadouri/parseImageId.js"),a=n("./imageLoader/wadouri/dataSetCacheManager.js"),o=n("./imageLoader/wadouri/loadFileRequest.js"),s=n("./imageLoader/wadouri/getPixelData.js"),l=n("./imageLoader/internal/index.js");function u(e,t){e.decache=function(){var e=Object(i.default)(t);a.default.unload(e.url)}}function c(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,l=(new Date).getTime(),c={cancelFn:void 0};return c.promise=new Promise((function(d,h){e.then((function(e){var f=Object(s.default)(e,n),p=e.string("x00020010"),m=(new Date).getTime(),g=Object(r.default)(t,f,p,a);u(c,t),g.then((function(t){t.data=e,t.sharedCacheKey=i;var n=(new Date).getTime();t.loadTimeInMS=m-l,t.totalTimeInMS=n-l,void 0!==o&&void 0!==o.imageDoneCallback&&o.imageDoneCallback(t),d(t)}),(function(t){h({error:t,dataSet:e})}))}),(function(e){h({error:e})}))})),c}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,o=(new Date).getTime(),l=new Promise((function(l,u){var c,d=(new Date).getTime();try{var h=Object(s.default)(e,n),f=e.string("x00020010");c=Object(r.default)(t,h,f,a)}catch(p){return void u({error:p,dataSet:e})}c.then((function(t){t.data=e,t.sharedCacheKey=i;var n=(new Date).getTime();t.loadTimeInMS=d-o,t.totalTimeInMS=n-o,l(t)}),u)}));return{promise:l,cancelFn:void 0}}function h(e){return"dicomweb"===e||"wadouri"===e?l.xhrRequest:"dicomfile"===e?o.default:void 0}function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(i.default)(e),r=(t=Object.assign({},t)).loader;if(void 0===r?r=h(n.scheme):delete t.loader,a.default.isLoaded(n.url)){var o=a.default.get(n.url,r,e);return d(o,e,n.frame,n.url,t)}var s=a.default.load(n.url,r,e);return c(s,e,n.frame,n.url,t)}},"./imageLoader/wadouri/metaData/getImagePixelModule.js":function(e,t,n){"use strict";function r(e,t){if(e.elements[t]&&6===e.elements[t].length)return[e.uint16(t,0),e.uint16(t,1),e.uint16(t,2)]}function i(e,t,n){for(var r=[],i=e.elements[t],a=0;a<n[0];a++)r[a]=16===n[2]?e.uint16(t,a):e.byteArray[a+i.dataOffset];return r}n.r(t),t.default=function(e){var t={samplesPerPixel:e.uint16("x00280002"),photometricInterpretation:e.string("x00280004"),rows:e.uint16("x00280010"),columns:e.uint16("x00280011"),bitsAllocated:e.uint16("x00280100"),bitsStored:e.uint16("x00280101"),highBit:e.uint16("x00280102"),pixelRepresentation:e.uint16("x00280103"),planarConfiguration:e.uint16("x00280006"),pixelAspectRatio:e.string("x00280034")};return function(e,t){0===e.uint16("x00280103")?(t.smallestPixelValue=e.uint16("x00280106"),t.largestPixelValue=e.uint16("x00280107")):(t.smallestPixelValue=e.int16("x00280106"),t.largestPixelValue=e.int16("x00280107"))}(e,t),"PALETTE COLOR"===t.photometricInterpretation&&e.elements.x00281101&&function(e,t){t.redPaletteColorLookupTableDescriptor=r(e,"x00281101"),t.greenPaletteColorLookupTableDescriptor=r(e,"x00281102"),t.bluePaletteColorLookupTableDescriptor=r(e,"x00281103"),0===t.redPaletteColorLookupTableDescriptor[0]&&(t.redPaletteColorLookupTableDescriptor[0]=65536,t.greenPaletteColorLookupTableDescriptor[0]=65536,t.bluePaletteColorLookupTableDescriptor[0]=65536);var n=e.elements.x00281201.length===t.redPaletteColorLookupTableDescriptor[0]?8:16;t.redPaletteColorLookupTableDescriptor[2]!==n&&(t.redPaletteColorLookupTableDescriptor[2]=n,t.greenPaletteColorLookupTableDescriptor[2]=n,t.bluePaletteColorLookupTableDescriptor[2]=n),t.redPaletteColorLookupTableData=i(e,"x00281201",t.redPaletteColorLookupTableDescriptor),t.greenPaletteColorLookupTableData=i(e,"x00281202",t.greenPaletteColorLookupTableDescriptor),t.bluePaletteColorLookupTableData=i(e,"x00281203",t.bluePaletteColorLookupTableDescriptor)}(e,t),t}},"./imageLoader/wadouri/metaData/getLUTs.js":function(e,t,n){"use strict";function r(e,t){var n=t.uint16("x00283002",0);0===n&&(n=65535);for(var r={id:"1",firstValueMapped:0===e?t.uint16("x00283002",1):t.int16("x00283002",1),numBitsPerEntry:t.uint16("x00283002",2),lut:[]},i=0;i<n;i++)r.lut[i]=0===e?t.uint16("x00283006",i):t.int16("x00283006",i);return r}n.r(t),t.default=function(e,t){if(t&&t.items.length){for(var n=[],i=0;i<t.items.length;i++){var a=r(e,t.items[i].dataSet);a&&n.push(a)}return n}}},"./imageLoader/wadouri/metaData/getModalityLUTOutputPixelRepresentation.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=e.string("x00080016");if("1.2.840.10008.5.1.4.1.1.2"===t||"1.2.840.10008.5.1.4.1.1.2.1"===t)return 1;var n=e.floatString("x00281052"),r=e.floatString("x00281053");return void 0!==n&&void 0!==r?function(e){var t=e.uint16("x00280103"),n=e.uint16("x00280101");return 0===t?0:-1<<n-1}(e)*r+n<0?1:0:e.elements.x00283000&&e.elements.x00283000.length>0?0:e.uint16("x00280103")}},"./imageLoader/wadouri/metaData/getNumberValues.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){var r=[],i=e.string(t);if(i){var a=i.split("\\");if(!(n&&a.length<n)){for(var o=0;o<a.length;o++)r.push(parseFloat(a[o]));return r}}}},"./imageLoader/wadouri/metaData/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadouri/metaData/getImagePixelModule.js");n.d(t,"getImagePixelModule",(function(){return r.default}));var i=n("./imageLoader/wadouri/metaData/getLUTs.js");n.d(t,"getLUTs",(function(){return i.default}));var a=n("./imageLoader/wadouri/metaData/getModalityLUTOutputPixelRepresentation.js");n.d(t,"getModalityLUTOutputPixelRepresentation",(function(){return a.default}));var o=n("./imageLoader/wadouri/metaData/getNumberValues.js");n.d(t,"getNumberValues",(function(){return o.default}));var s=n("./imageLoader/wadouri/metaData/metaDataProvider.js");n.d(t,"metaDataProvider",(function(){return s.default}))},"./imageLoader/wadouri/metaData/metaDataProvider.js":function(e,t,n){"use strict";n.r(t);var r=n("./externalModules.js"),i=n("./imageLoader/wadouri/metaData/getNumberValues.js"),a=n("./imageLoader/wadouri/parseImageId.js"),o=n("./imageLoader/wadouri/dataSetCacheManager.js"),s=n("./imageLoader/wadouri/metaData/getImagePixelModule.js"),l=n("./imageLoader/wadouri/metaData/getLUTs.js"),u=n("./imageLoader/wadouri/metaData/getModalityLUTOutputPixelRepresentation.js");t.default=function(e,t){var n=r.default.dicomParser,c=Object(a.default)(t),d=o.default.get(c.url);if(d){if("generalSeriesModule"===e)return{modality:d.string("x00080060"),seriesInstanceUID:d.string("x0020000e"),seriesNumber:d.intString("x00200011"),studyInstanceUID:d.string("x0020000d"),seriesDate:n.parseDA(d.string("x00080021")),seriesTime:n.parseTM(d.string("x00080031")||"")};if("patientStudyModule"===e)return{patientAge:d.intString("x00101010"),patientSize:d.floatString("x00101020"),patientWeight:d.floatString("x00101030")};if("imagePlaneModule"===e){var h=Object(i.default)(d,"x00200037",6),f=Object(i.default)(d,"x00200032",3),p=Object(i.default)(d,"x00280030",2),m=null,g=null;p&&(g=p[0],m=p[1]);var v=null,y=null;return h&&(v=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])],y=[parseFloat(h[3]),parseFloat(h[4]),parseFloat(h[5])]),{frameOfReferenceUID:d.string("x00200052"),rows:d.uint16("x00280010"),columns:d.uint16("x00280011"),imageOrientationPatient:h,rowCosines:v,columnCosines:y,imagePositionPatient:f,sliceThickness:d.floatString("x00180050"),sliceLocation:d.floatString("x00201041"),pixelSpacing:p,rowPixelSpacing:g,columnPixelSpacing:m}}if("imagePixelModule"===e)return Object(s.default)(d);if("modalityLutModule"===e)return{rescaleIntercept:d.floatString("x00281052"),rescaleSlope:d.floatString("x00281053"),rescaleType:d.string("x00281054"),modalityLUTSequence:Object(l.default)(d.uint16("x00280103"),d.elements.x00283000)};if("voiLutModule"===e){var b=Object(u.default)(d);return{windowCenter:Object(i.default)(d,"x00281050",1),windowWidth:Object(i.default)(d,"x00281051",1),voiLUTSequence:Object(l.default)(b,d.elements.x00283010)}}if("sopCommonModule"===e)return{sopClassUID:d.string("x00080016"),sopInstanceUID:d.string("x00080018")};if("petIsotopeModule"===e){var x=d.elements.x00540016;if(void 0===x)return;var w=x.items[0].dataSet;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:n.parseTM(w.string("x00181072")||""),radionuclideTotalDose:w.floatString("x00181074"),radionuclideHalfLife:w.floatString("x00181075")}}}}}},"./imageLoader/wadouri/parseImageId.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t,n=e.indexOf(":"),r=e.substring(n+1),i=r.indexOf("frame=");if(-1!==i){var a=r.substr(i+6);t=parseInt(a,10),r=r.substr(0,i-1)}return{scheme:e.substr(0,n),url:r,frame:t}}},"./imageLoader/wadouri/register.js":function(e,t,n){"use strict";n.r(t);var r=n("./imageLoader/wadouri/loadImage.js"),i=n("./imageLoader/wadouri/metaData/index.js");t.default=function(e){e.registerImageLoader("dicomweb",r.loadImage),e.registerImageLoader("wadouri",r.loadImage),e.registerImageLoader("dicomfile",r.loadImage),e.metaData.addProvider(i.metaDataProvider)}},"./imageLoader/wadouri/unpackBinaryFrame.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){for(var r=new Uint8Array(n),i=0;i<n;i++){var a=Math.floor(i/8);r[i]=e[a+t]&1<<i%8?1:0}return r}},"./imageLoader/webWorkerManager.js":function(e,t,n){"use strict";n.r(t);var r,i=n("./imageLoader/internal/options.js"),a=0,o=[],s=[],l=Object(i.getOptions)(),u={maxWebWorkers:navigator.hardwareConcurrency||1,startWebWorkersOnDemand:!0,webWorkerPath:"../../dist/cornerstoneWADOImageLoaderWebWorker.js",webWorkerTaskPaths:[],taskConfiguration:{decodeTask:{loadCodecsOnStartup:!0,initializeCodecsOnStartup:!1,codecsPath:"../dist/cornerstoneWADOImageLoaderCodecs.js",usePDFJS:!1,strict:l.strict}}},c={maxWebWorkers:0,numWebWorkers:0,numTasksQueued:0,numTasksExecuting:0,numTasksCompleted:0,totalTaskTimeInMS:0,totalTimeDelayedInMS:0};function d(){if(o.length){for(var e=0;e<s.length;e++)if("ready"===s[e].status){s[e].status="busy";var t=o.shift();t.start=(new Date).getTime();var n=(new Date).getTime();return c.totalTimeDelayedInMS+=n-t.added,s[e].task=t,s[e].worker.postMessage({taskType:t.taskType,workerIndex:e,data:t.data},t.transferList),void c.numTasksExecuting++}s.length<r.maxWebWorkers&&f()}}function h(e){if("initialize"===e.data.taskType)s[e.data.workerIndex].status="ready",d();else{var t=s[e.data.workerIndex].task.start;s[e.data.workerIndex].task.deferred.resolve(e.data.result),s[e.data.workerIndex].task=void 0,c.numTasksExecuting--,s[e.data.workerIndex].status="ready",c.numTasksCompleted++;var n=(new Date).getTime();c.totalTaskTimeInMS+=n-t,d()}}function f(){if(!(s.length>=r.maxWebWorkers)){var e=new Worker(r.webWorkerPath);s.push({worker:e,status:"initializing"}),e.addEventListener("message",h),e.postMessage({taskType:"initialize",workerIndex:s.length-1,config:r})}}function p(e){if(e=e||u,r)throw new Error("WebWorkerManager already initialized");if((r=e).maxWebWorkers=r.maxWebWorkers||navigator.hardwareConcurrency||1,!r.startWebWorkersOnDemand)for(var t=0;t<r.maxWebWorkers;t++)f()}t.default={initialize:p,loadWebWorkerTask:function(e,t){r.webWorkerTaskPaths.push(e),t&&(r.taskConfiguration=Object.assign(r.taskConfiguration,t));for(var n=0;n<s.length;n++)s[n].worker.postMessage({taskType:"loadWebWorkerTask",workerIndex:s.length-1,sourcePath:e,config:r})},addTask:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;r||p();var s,l={},u=new Promise((function(e,t){l={resolve:e,reject:t}}));for(s=0;s<o.length&&!(o[s].priority<n);s++);var c=a++;return o.splice(s,0,{taskId:c,taskType:e,status:"ready",added:(new Date).getTime(),data:t,deferred:l,priority:n,transferList:i}),d(),{taskId:c,promise:u}},getStatistics:function(){return c.maxWebWorkers=r.maxWebWorkers,c.numWebWorkers=s.length,c.numTasksQueued=o.length,c},setTaskPriority:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<o.length;n++)if(o[n].taskId===e){var r=o.splice(n,1)[0];for(r.priority=t,n=0;n<o.length&&!(o[n].priority<t);n++);return o.splice(n,0,r),!0}return!1},cancelTask:function(e,t){for(var n=0;n<o.length;n++)if(o[n].taskId===e)return o.splice(n,1).deferred.reject(t),!0;return!1}}},"./shared/calculateMinMax.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./shared/getMinMax.js");function i(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Object(r.default)(e.pixelData),i=!(a(e.smallestPixelValue)&&a(e.largestPixelValue));!0!==t||i?(e.smallestPixelValue=n.min,e.largestPixelValue=n.max):(e.smallestPixelValue!==n.min&&console.warn("Image smallestPixelValue tag is incorrect. Rendering performance will suffer considerably."),e.largestPixelValue!==n.max&&console.warn("Image largestPixelValue tag is incorrect. Rendering performance will suffer considerably."))}function a(e){return"number"==typeof e}},"./shared/decodeImageFrame.js":function(e,t,n){"use strict";n.r(t);var r=n("./shared/decoders/decodeLittleEndian.js"),i=n("./shared/decoders/decodeBigEndian.js"),a=n("./shared/decoders/decodeRLE.js"),o=n("./shared/decoders/decodeJPEGBaseline.js"),s=n("./shared/decoders/decodeJPEGLossless.js"),l=n("./shared/decoders/decodeJPEGLS.js"),u=n("./shared/decoders/decodeJPEG2000.js");t.default=function(e,t,n,c,d){var h=(new Date).getTime();if("1.2.840.10008.1.2"===t)e=Object(r.default)(e,n);else if("1.2.840.10008.1.2.1"===t)e=Object(r.default)(e,n);else if("1.2.840.10008.1.2.2"===t)e=Object(i.default)(e,n);else if("1.2.840.10008.1.2.1.99"===t)e=Object(r.default)(e,n);else if("1.2.840.10008.1.2.5"===t)e=Object(a.default)(e,n);else if("1.2.840.10008.1.2.4.50"===t)e=Object(o.default)(e,n);else if("1.2.840.10008.1.2.4.51"===t)e=Object(o.default)(e,n);else if("1.2.840.10008.1.2.4.57"===t)e=Object(s.default)(e,n);else if("1.2.840.10008.1.2.4.70"===t)e=Object(s.default)(e,n);else if("1.2.840.10008.1.2.4.80"===t)e=Object(l.default)(e,n);else if("1.2.840.10008.1.2.4.81"===t)e=Object(l.default)(e,n);else if("1.2.840.10008.1.2.4.90"===t)e=Object(u.default)(e,n,c,d);else{if("1.2.840.10008.1.2.4.91"!==t)throw new Error("no decoder for transfer syntax ".concat(t));e=Object(u.default)(e,n,c,d)}var f=void 0!==e.pixelRepresentation&&1===e.pixelRepresentation,p=f&&void 0!==e.bitsStored?32-e.bitsStored:void 0;if(f&&void 0!==p)for(var m=0;m<e.pixelData.length;m++)e.pixelData[m]=e.pixelData[m]<<p>>p;var g=(new Date).getTime();return e.decodeTimeInMS=g-h,e}},"./shared/decoders/decodeBigEndian.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if(16===e.bitsAllocated){var n=t.buffer,r=t.byteOffset,i=t.length;r%2&&(n=n.slice(r),r=0),e.pixelData=0===e.pixelRepresentation?new Uint16Array(n,r,i/2):new Int16Array(n,r,i/2);for(var a=0;a<e.pixelData.length;a++)e.pixelData[a]=(255&(o=e.pixelData[a]))<<8|o>>8&255}else 8===e.bitsAllocated&&(e.pixelData=t);var o;return e}},"./shared/decoders/decodeJPEG2000.js":function(e,t,n){"use strict";function r(e,t){var n=new JpxImage;n.parse(t);var r=n.tiles.length;if(1!==r)throw new Error("JPEG2000 decoder returned a tileCount of ".concat(r,", when 1 is expected"));return e.columns=n.width,e.rows=n.height,e.pixelData=n.tiles[0].items,e}var i;function a(e,t){var n=function(e,t,n){var r=i._malloc(e.length);i.writeArrayToMemory(e,r);var a=i._malloc(4),o=i._malloc(4),s=i._malloc(4),l=i._malloc(4),u=i._malloc(4),c=(new Date).getTime();if(0!==i.ccall("jp2_decode","number",["number","number","number","number","number","number","number"],[r,e.length,a,o,s,l,u]))return console.log("[opj_decode] decoding failed!"),i._free(r),i._free(i.getValue(a,"*")),i._free(s),i._free(l),i._free(o),void i._free(u);var d=i.getValue(a,"*"),h={length:i.getValue(o,"i32"),sx:i.getValue(s,"i32"),sy:i.getValue(l,"i32"),nbChannels:i.getValue(u,"i32"),perf_timetodecode:void 0,pixelData:void 0},f=h.sx*h.sy*h.nbChannels,p=new Int32Array(i.HEAP32.buffer,d,f);if(1===t)if(Uint8Array.from)h.pixelData=Uint8Array.from(p);else{h.pixelData=new Uint8Array(f);for(var m=0;m<f;m++)h.pixelData[m]=p[m]}else if(n)if(Int16Array.from)h.pixelData=Int16Array.from(p);else{h.pixelData=new Int16Array(f);for(var g=0;g<f;g++)h.pixelData[g]=p[g]}else if(Uint16Array.from)h.pixelData=Uint16Array.from(p);else{h.pixelData=new Uint16Array(f);for(var v=0;v<f;v++)h.pixelData[v]=p[v]}var y=(new Date).getTime();return h.perf_timetodecode=y-c,i._free(r),i._free(a),i._free(d),i._free(o),i._free(s),i._free(l),i._free(u),h}(t,e.bitsAllocated<=8?1:2,1===e.pixelRepresentation);return e.columns=n.sx,e.rows=n.sy,e.pixelData=n.pixelData,n.nbChannels>1&&(e.photometricInterpretation="RGB"),e}function o(e){if(!e.usePDFJS&&"undefined"==typeof OpenJPEG)throw new Error("OpenJPEG decoder not loaded");if(!(i||(i=OpenJPEG())&&i._jp2_decode))throw new Error("OpenJPEG failed to initialize")}n.r(t),n.d(t,"initializeJPEG2000",(function(){return o})),t.default=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return o(n),i.usePDFJS||n.usePDFJS?r(e,t):a(e,t)}},"./shared/decoders/decodeJPEGBaseline.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if("undefined"==typeof JpegImage)throw new Error("No JPEG Baseline decoder loaded");var n=new JpegImage;return n.parse(t),n.colorTransform=!1,8===e.bitsAllocated?(e.pixelData=n.getData(e.columns,e.rows),e):16===e.bitsAllocated?(e.pixelData=n.getData16(e.columns,e.rows),e):void 0}},"./shared/decoders/decodeJPEGLS.js":function(e,t,n){"use strict";var r;function i(){if("undefined"==typeof CharLS)throw new Error("No JPEG-LS decoder loaded");if(!(r||(r=CharLS())&&r._jpegls_decode))throw new Error("JPEG-LS failed to initialize")}n.r(t),n.d(t,"initializeJPEGLS",(function(){return i})),t.default=function(e,t){i();var n=function(e,t){var n=r._malloc(e.length);r.writeArrayToMemory(e,n);var i=r._malloc(4),a=r._malloc(4),o=r._malloc(4),s=r._malloc(4),l=r._malloc(4),u=r._malloc(4),c=r._malloc(4),d=r._malloc(4),h=r._malloc(4),f={result:r.ccall("jpegls_decode","number",["number","number","number","number","number","number","number","number","number","number","number"],[n,e.length,i,a,o,s,l,u,d,c,h]),width:r.getValue(o,"i32"),height:r.getValue(s,"i32"),bitsPerSample:r.getValue(l,"i32"),stride:r.getValue(u,"i32"),components:r.getValue(d,"i32"),allowedLossyError:r.getValue(c,"i32"),interleaveMode:r.getValue(h,"i32"),pixelData:void 0},p=r.getValue(i,"*");return f.bitsPerSample<=8?(f.pixelData=new Uint8Array(f.width*f.height*f.components),f.pixelData.set(new Uint8Array(r.HEAP8.buffer,p,f.pixelData.length))):t?(f.pixelData=new Int16Array(f.width*f.height*f.components),f.pixelData.set(new Int16Array(r.HEAP16.buffer,p,f.pixelData.length))):(f.pixelData=new Uint16Array(f.width*f.height*f.components),f.pixelData.set(new Uint16Array(r.HEAP16.buffer,p,f.pixelData.length))),r._free(n),r._free(p),r._free(i),r._free(a),r._free(o),r._free(s),r._free(l),r._free(u),r._free(d),r._free(h),f}(t,1===e.pixelRepresentation);if(0!==n.result&&6!==n.result)throw new Error("JPEG-LS decoder failed to decode frame (error code ".concat(n.result,")"));return e.columns=n.width,e.rows=n.height,e.pixelData=n.pixelData,e}},"./shared/decoders/decodeJPEGLossless.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if("undefined"==typeof jpeg||void 0===jpeg.lossless||void 0===jpeg.lossless.Decoder)throw new Error("No JPEG Lossless decoder loaded");var n=e.bitsAllocated<=8?1:2,r=t.buffer,i=(new jpeg.lossless.Decoder).decode(r,t.byteOffset,t.length,n);return 0===e.pixelRepresentation?16===e.bitsAllocated?(e.pixelData=new Uint16Array(i.buffer),e):(e.pixelData=new Uint8Array(i.buffer),e):(e.pixelData=new Int16Array(i.buffer),e)}},"./shared/decoders/decodeLittleEndian.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=t.buffer,r=t.byteOffset,i=t.length;return 16===e.bitsAllocated?(r%2&&(n=n.slice(r),r=0),e.pixelData=0===e.pixelRepresentation?new Uint16Array(n,r,i/2):new Int16Array(n,r,i/2)):8===e.bitsAllocated||1===e.bitsAllocated?e.pixelData=t:32===e.bitsAllocated&&(r%2&&(n=n.slice(r),r=0),e.pixelData=new Float32Array(n,r,i/4)),e}},"./shared/decoders/decodeRLE.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){if(8===e.bitsAllocated)return e.planarConfiguration?function(e,t){for(var n=t,r=e.rows*e.columns,i=new ArrayBuffer(r*e.samplesPerPixel),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i),l=0,u=a.getInt32(0,!0),c=0;c<u;++c){l=c*r;var d=a.getInt32(4*(c+1),!0),h=a.getInt32(4*(c+2),!0);0===h&&(h=n.length);for(var f=r*u;d<h;){var p=o[d++];if(p>=0&&p<=127)for(var m=0;m<p+1&&l<f;++m)s[l]=o[d++],l++;else if(p<=-1&&p>=-127)for(var g=o[d++],v=0;v<1-p&&l<f;++v)s[l]=g,l++}}return e.pixelData=new Uint8Array(i),e}(e,t):function(e,t){for(var n=t,r=e.rows*e.columns,i=new ArrayBuffer(r*e.samplesPerPixel),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i),l=0,u=a.getInt32(0,!0),c=0;c<u;++c){l=c;var d=a.getInt32(4*(c+1),!0),h=a.getInt32(4*(c+2),!0);0===h&&(h=n.length);for(var f=r*u;d<h;){var p=o[d++];if(p>=0&&p<=127)for(var m=0;m<p+1&&l<f;++m)s[l]=o[d++],l+=e.samplesPerPixel;else if(p<=-1&&p>=-127)for(var g=o[d++],v=0;v<1-p&&l<f;++v)s[l]=g,l+=e.samplesPerPixel}}return e.pixelData=new Uint8Array(i),e}(e,t);if(16===e.bitsAllocated)return function(e,t){for(var n=t,r=e.rows*e.columns,i=new ArrayBuffer(r*e.samplesPerPixel*2),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i),l=a.getInt32(0,!0),u=0;u<l;++u){var c=0,d=0===u?1:0,h=a.getInt32(4*(u+1),!0),f=a.getInt32(4*(u+2),!0);for(0===f&&(f=n.length);h<f;){var p=o[h++];if(p>=0&&p<=127)for(var m=0;m<p+1&&c<r;++m)s[2*c+d]=o[h++],c++;else if(p<=-1&&p>=-127)for(var g=o[h++],v=0;v<1-p&&c<r;++v)s[2*c+d]=g,c++}}return e.pixelData=0===e.pixelRepresentation?new Uint16Array(i):new Int16Array(i),e}(e,t);throw new Error("unsupported pixel format for RLE")}},"./shared/getMinMax.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){for(var t,n=e[0],r=e[0],i=e.length,a=1;a<i;a++)t=e[a],n=Math.min(n,t),r=Math.max(r,t);return{min:n,max:r}}},"./version.js":function(e,t,n){"use strict";n.r(t),t.default="2.2.4"}})},e.exports=r()},O9TA:function(e,t,n){const r=n("Ybu3");e.exports=(e,t)=>{const n=r(e,t);return n&&n.prerelease.length?n.prerelease:null}},PDX0:function(e,t){(function(t){e.exports=t}).call(this,{})},VMJL:function(e,t,n){const r=n("xfvg"),i=n("dtu/"),a=n("7sNm"),o=n("Dknc"),s=n("JCZO"),l=n("bdwG");e.exports=(e,t,n,u)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return r(e,n,u);case"!=":return i(e,n,u);case">":return a(e,n,u);case">=":return o(e,n,u);case"<":return s(e,n,u);case"<=":return l(e,n,u);default:throw new TypeError("Invalid operator: "+t)}}},VYYE:function(e,t,n){var r,i=(r="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(r=r||__filename),function(e){function t(){return k.buffer!=H&&Z(k.buffer),W}function i(){return k.buffer!=H&&Z(k.buffer),V}function a(){return k.buffer!=H&&Z(k.buffer),q}function o(){return k.buffer!=H&&Z(k.buffer),G}function s(){return k.buffer!=H&&Z(k.buffer),Y}var l,u=void 0!==(e=e||{})?e:{},c={};for(l in u)u.hasOwnProperty(l)&&(c[l]=u[l]);var d=[],h=!1,f=!1,p=!1,m=!1;h="object"==typeof window,f="function"==typeof importScripts,p="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,m=!h&&!p&&!f;var g=u.ENVIRONMENT_IS_PTHREAD||!1;g&&(H=u.buffer,J=u.DYNAMIC_BASE,Q=u.DYNAMICTOP_PTR);var v,y,b,x,w="";function _(e){return u.locateFile?u.locateFile(e,w):w+e}if(p){var S;w=f?n(6).dirname(w)+"/":__dirname+"/",v=function(e,t){return b||(b=n(7)),x||(x=n(6)),e=x.normalize(e),b.readFileSync(e,t?null:"utf8")},y=function(e){var t=v(e,!0);return t.buffer||(t=new Uint8Array(t)),N(t.buffer),t},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),d=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof dn))throw e})),process.on("unhandledRejection",xe),u.inspect=function(){return"[Emscripten Module object]"};try{S=n(8)}catch(fn){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),fn}Worker=S.Worker}else m?("undefined"!=typeof read&&(v=function(e){return read(e)}),y=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(N("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?d=scriptArgs:void 0!==arguments&&(d=arguments),"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(h||f)&&(f?w=self.location.href:document.currentScript&&(w=document.currentScript.src),r&&(w=r),w=0!==w.indexOf("blob:")?w.substr(0,w.lastIndexOf("/")+1):"",p?(v=function(e,t){return b||(b=n(7)),x||(x=n(6)),e=x.normalize(e),b.readFileSync(e,t?null:"utf8")},y=function(e){var t=v(e,!0);return t.buffer||(t=new Uint8Array(t)),N(t.buffer),t}):(v=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},f&&(y=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)})));p&&"undefined"==typeof performance&&(performance=n(9).performance);var E,T,k,C=u.print||console.log.bind(console),I=u.printErr||console.warn.bind(console);for(l in c)c.hasOwnProperty(l)&&(u[l]=c[l]);c=null,u.arguments&&(d=u.arguments),Atomics,Atomics,Atomics,u.wasmBinary&&(E=u.wasmBinary),u.noExitRuntime&&(T=u.noExitRuntime),"object"!=typeof WebAssembly&&I("no native wasm support detected");var O,A=new WebAssembly.Table({initial:165,maximum:165,element:"anyfunc"}),D=0,M=!1;function N(e,t){e||xe("Assertion failed: "+t)}function j(e){var t=u["_"+e];return N(t,"Cannot call unknown function "+e+", make sure it is exported"),t}function R(e,t,n,r,i){var a={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);B(e,t=ln(n),n)}return t},array:function(e){var t=ln(e.length);return U(e,t),t}},o=j(e),s=[],l=0;if(r)for(var u=0;u<r.length;u++){var c=a[n[u]];c?(0===l&&(l=sn()),s[u]=c(r[u])):s[u]=r[u]}var d=o.apply(null,s);return d=function(e){return"string"===t?L(e):"boolean"===t?Boolean(e):e}(d),0!==l&&un(l),d}function P(e,t,n,r){var i=(n=n||[]).every((function(e){return"number"===e}));return"string"!==t&&i&&!r?j(e):function(){return R(e,t,n,arguments)}}function F(e,t,n){for(var r=t+n,i="";!(t>=r);){var a=e[t++];if(!a)return i;if(128&a){var o=63&e[t++];if(192!=(224&a)){var s=63&e[t++];if((a=224==(240&a)?(15&a)<<12|o<<6|s:(7&a)<<18|o<<12|s<<6|63&e[t++])<65536)i+=String.fromCharCode(a);else{var l=a-65536;i+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else i+=String.fromCharCode((31&a)<<6|o)}else i+=String.fromCharCode(a)}return i}function L(e,t){return e?F(i(),e,t):""}function $(e,t,n,r){if(!(r>0))return 0;for(var i=n,a=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(n>=a)break;t[n++]=s}else if(s<=2047){if(n+1>=a)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=a)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=a)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}return t[n]=0,n-i}function B(e,t,n){return $(e,i(),t,n)}function z(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),r<=127?++t:t+=r<=2047?2:r<=65535?3:4}return t}function U(e,n){t().set(e,n)}var H,W,V,q,G,Y,X=65536;function K(e,t){return e%t>0&&(e+=t-e%t),e}function Z(e){H=e,u.HEAP8=W=new Int8Array(e),u.HEAP16=new Int16Array(e),u.HEAP32=q=new Int32Array(e),u.HEAPU8=V=new Uint8Array(e),u.HEAPU16=new Uint16Array(e),u.HEAPU32=G=new Uint32Array(e),u.HEAPF32=new Float32Array(e),u.HEAPF64=Y=new Float64Array(e)}var J=5256384,Q=12576,ee=u.INITIAL_MEMORY||16777216;if(g)k=u.wasmMemory,H=u.buffer;else if(u.wasmMemory)k=u.wasmMemory;else if(!((k=new WebAssembly.Memory({initial:ee/X,maximum:2147483648/X,shared:!0})).buffer instanceof SharedArrayBuffer))throw I("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),p&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");function te(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?u.dynCall_v(n):u.dynCall_vi(n,t.arg):n(void 0===t.arg?null:t.arg)}else t(u)}}k&&(H=k.buffer),ee=H.byteLength,Z(H),g||(a()[Q>>2]=J);var ne=[],re=[],ie=[],ae=[],oe=[];function se(){if(!g){if(u.preRun)for("function"==typeof u.preRun&&(u.preRun=[u.preRun]);u.preRun.length;)de(u.preRun.shift());te(ne)}}function le(){te(re)}function ue(){g||te(ie)}function ce(){if(!g){if(u.postRun)for("function"==typeof u.postRun&&(u.postRun=[u.postRun]);u.postRun.length;)he(u.postRun.shift());te(oe)}}function de(e){ne.unshift(e)}function he(e){oe.unshift(e)}var fe=Math.ceil,pe=Math.floor,me=0,ge=null,ve=null;function ye(e){N(!g,"addRunDependency cannot be used in a pthread worker"),me++,u.monitorRunDependencies&&u.monitorRunDependencies(me)}function be(e){if(me--,u.monitorRunDependencies&&u.monitorRunDependencies(me),0==me&&(null!==ge&&(clearInterval(ge),ge=null),ve)){var t=ve;ve=null,t()}}function xe(e){throw u.onAbort&&u.onAbort(e),g&&console.error("Pthread aborting at "+(new Error).stack),C(e+=""),I(e),M=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(e)}function we(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}u.preloadedImages={},u.preloadedAudios={};var _e="data:application/octet-stream;base64,";function Se(e){return we(e,_e)}var Ee="file://";function Te(e){return we(e,Ee)}var ke="tfjs-backend-wasm-threaded-simd.wasm";function Ce(){try{if(E)return new Uint8Array(E);if(y)return y(ke);throw"both async and sync fetching of the wasm failed"}catch(I){xe(I)}}function Ie(){return E||!h&&!f||"function"!=typeof fetch||Te(ke)?new Promise((function(e,t){e(Ce())})):fetch(ke,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+ke+"'";return e.arrayBuffer()})).catch((function(){return Ce()}))}function Oe(){var e={a:Vt};function t(e,t){if(u.asm=e.exports,O=t,!g){var n=He.unusedWorkers.length;He.unusedWorkers.forEach((function(e){He.loadWasmModuleToWorker(e,(function(){--n||be()}))}))}}function n(e){t(e.instance,e.module)}function r(t){return Ie().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){I("failed to asynchronously prepare wasm: "+e),xe(e)}))}if(g||ye(),u.instantiateWasm)try{return u.instantiateWasm(e,t)}catch(fn){return I("Module.instantiateWasm callback failed with error: "+fn),!1}return function(){if(E||"function"!=typeof WebAssembly.instantiateStreaming||Se(ke)||Te(ke)||"function"!=typeof fetch)return r(n);fetch(ke,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){I("wasm streaming compile failed: "+e),I("falling back to ArrayBuffer instantiation"),r(n)}))}))}(),{}}Se(ke)||(ke=_(ke));var Ae={};function De(){He.initRuntime()}g||re.push({func:function(){Yt()}});var Me=0,Ne=0,je=0;function Re(e,t,n){Me=e|=0,je=t|=0,Ne=n|=0}u.__register_pthread_ptr=Re;var Pe={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135},Fe=13488;function Le(e,n){if(e<=0||e>t().length||!0&e||n<0)return-28;if(0==n)return 0;n>=2147483647&&(n=1/0);var r=Atomics.load(a(),Fe>>2),i=0;if(r==e&&Atomics.compareExchange(a(),Fe>>2,r,0)==r&&(i=1,--n<=0))return 1;var o=Atomics.notify(a(),e>>2,n);if(o>=0)return o+i;throw"Atomics.notify returned an unexpected value "+o}function $e(e){if(g)throw"Internal Error! _kill_thread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in _kill_thread!";a()[e+12>>2]=0;var t=He.pthreads[e];t.worker.terminate(),He.freeThreadData(t),He.runningWorkers.splice(He.runningWorkers.indexOf(t.worker),1),t.worker.pthread=void 0}function Be(e){if(g)throw"Internal Error! _cancel_thread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in _cancel_thread!";He.pthreads[e].worker.postMessage({cmd:"cancel"})}function ze(e){if(g)throw"Internal Error! _cleanup_thread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in _cleanup_thread!";a()[e+12>>2]=0;var t=He.pthreads[e];t&&He.returnWorkerToPool(t.worker)}u._emscripten_futex_wake=Le;var Ue,He={MAIN_THREAD_ID:1,mainThreadInfo:{schedPolicy:0,schedPrio:0},unusedWorkers:[],runningWorkers:[],initRuntime:function(){Re(He.mainThreadBlock,!f,1),nn(He.mainThreadBlock)},initMainThreadBlock:function(){for(var e=0;e<8;++e)He.allocateUnusedWorker();for(He.mainThreadBlock=12736,e=0;e<58;++e)o()[He.mainThreadBlock/4+e]=0;a()[He.mainThreadBlock+12>>2]=He.mainThreadBlock;var t=He.mainThreadBlock+156;for(a()[t>>2]=t,e=0;e<128;++e)o()[3244+e]=0;Atomics.store(o(),He.mainThreadBlock+104>>2,12976),Atomics.store(o(),He.mainThreadBlock+40>>2,He.mainThreadBlock),Atomics.store(o(),He.mainThreadBlock+44>>2,42)},initWorker:function(){},pthreads:{},exitHandlers:null,setThreadStatus:function(){},runExitHandlers:function(){if(null!==He.exitHandlers){for(;He.exitHandlers.length>0;)He.exitHandlers.pop()();He.exitHandlers=null}g&&D&&en()},threadExit:function(e){var t=Bt();t&&(Atomics.store(o(),t+4>>2,e),Atomics.store(o(),t+0>>2,1),Atomics.store(o(),t+60>>2,1),Atomics.store(o(),t+64>>2,0),He.runExitHandlers(),Le(t+0,2147483647),Re(0,0,0),D=0,g&&postMessage({cmd:"exit"}))},threadCancel:function(){He.runExitHandlers(),Atomics.store(o(),D+4>>2,-1),Atomics.store(o(),D+0>>2,1),Le(D+0,2147483647),D=0,Re(0,0,0),postMessage({cmd:"cancelDone"})},terminateAllThreads:function(){for(var e in He.pthreads)(r=He.pthreads[e])&&r.worker&&He.returnWorkerToPool(r.worker);He.pthreads={};for(var t=0;t<He.unusedWorkers.length;++t)(n=He.unusedWorkers[t]).terminate();for(He.unusedWorkers=[],t=0;t<He.runningWorkers.length;++t){var n,r;He.freeThreadData(r=(n=He.runningWorkers[t]).pthread),n.terminate()}He.runningWorkers=[]},freeThreadData:function(e){if(e){if(e.threadInfoStruct){var t=a()[e.threadInfoStruct+104>>2];a()[e.threadInfoStruct+104>>2]=0,Kt(t),Kt(e.threadInfoStruct)}e.threadInfoStruct=0,e.allocatedOwnStack&&e.stackBase&&Kt(e.stackBase),e.stackBase=0,e.worker&&(e.worker.pthread=null)}},returnWorkerToPool:function(e){delete He.pthreads[e.pthread.thread],He.unusedWorkers.push(e),He.runningWorkers.splice(He.runningWorkers.indexOf(e),1),He.freeThreadData(e.pthread),e.pthread=void 0},receiveObjectTransfer:function(e){},loadWasmModuleToWorker:function(e,t){e.onmessage=function(n){var r=n.data,i=r.cmd;if(e.pthread&&(He.currentProxiedOperationCallerThread=e.pthread.threadInfoStruct),r.targetThread&&r.targetThread!=Bt()){var a=He.pthreads[r.targetThread];return a?a.worker.postMessage(n.data,r.transferList):console.error('Internal error! Worker sent a message "'+i+'" to target pthread '+r.targetThread+", but that thread no longer exists!"),void(He.currentProxiedOperationCallerThread=void 0)}"processQueuedMainThreadWork"===i?tn():"spawnThread"===i?Lt(n.data):"cleanupThread"===i?ze(r.thread):"killThread"===i?$e(r.thread):"cancelThread"===i?Be(r.thread):"loaded"===i?(e.loaded=!0,t&&t(e),e.runPthread&&(e.runPthread(),delete e.runPthread)):"print"===i?C("Thread "+r.threadId+": "+r.text):"printErr"===i?I("Thread "+r.threadId+": "+r.text):"alert"===i?alert("Thread "+r.threadId+": "+r.text):"exit"===i?e.pthread&&Atomics.load(o(),e.pthread.thread+68>>2)&&He.returnWorkerToPool(e):"cancelDone"===i?He.returnWorkerToPool(e):"objectTransfer"===i?He.receiveObjectTransfer(n.data):"setimmediate"===n.data.target?e.postMessage(n.data):I("worker sent an unknown command "+i),He.currentProxiedOperationCallerThread=void 0},e.onerror=function(e){I("pthread sent an error! "+e.filename+":"+e.lineno+": "+e.message)},p&&(e.on("message",(function(t){e.onmessage({data:t})})),e.on("error",(function(t){e.onerror(t)})),e.on("exit",(function(e){console.log("worker exited - TODO: update the worker queue?")}))),e.postMessage({cmd:"load",urlOrBlob:u.mainScriptUrlOrBlob||r,wasmMemory:k,wasmModule:O,DYNAMIC_BASE:J,DYNAMICTOP_PTR:Q})},allocateUnusedWorker:function(){var e=_("tfjs-backend-wasm-threaded-simd.worker.js");He.unusedWorkers.push(new Worker(e))},getNewWorker:function(){return 0==He.unusedWorkers.length&&(He.allocateUnusedWorker(),He.loadWasmModuleToWorker(He.unusedWorkers[0])),He.unusedWorkers.length>0?He.unusedWorkers.pop():null},busySpinWait:function(e){for(var t=performance.now()+e;performance.now()<t;);}};function We(e,t){un(e)}function Ve(){return T}function qe(e,t,n,r){xe("Assertion failed: "+L(e)+", at: "+[t?L(t):"unknown filename",n,r?L(r):"unknown function"])}function Ge(e,t){_main(e,t)}function Ye(e){return a()[Jt()>>2]=e,e}function Xe(e,t){if(g)return it(1,1,e,t);ae.unshift({func:e,arg:t})}function Ke(e,t){if(e==t)postMessage({cmd:"processQueuedMainThreadWork"});else if(g)postMessage({targetThread:e,cmd:"processThreadQueue"});else{var n=He.pthreads[e],r=n&&n.worker;if(!r)return;r.postMessage({cmd:"processThreadQueue"})}return 1}function Ze(){xe()}function Je(e,t){}function Qe(e,n,r){if(e<=0||e>t().length||!0&e)return-28;if(f){var i=Atomics.wait(a(),e>>2,n,r);if("timed-out"===i)return-73;if("not-equal"===i)return-6;if("ok"===i)return 0;throw"Atomics.wait returned an unexpected value "+i}if(n!=Atomics.load(a(),e>>2))return-6;var o=performance.now(),s=o+r;Atomics.store(a(),Fe>>2,e);for(var l=e;e==l;){if((o=performance.now())>s)return-73;tn(),e=Atomics.load(a(),Fe>>2)}return 0}function et(){return 0|je}function tt(){return 0|Ne}function nt(e,t,n){i().copyWithin(e,t,t+n)}function rt(){return navigator.hardwareConcurrency}function it(e,t){for(var n=arguments.length-2,r=sn(),i=ln(8*n),a=i>>3,o=0;o<n;o++)s()[a+o]=arguments[2+o];var l=an(e,n,i,t);return un(r),l}u.establishStackSpace=We,u.getNoExitRuntime=Ve,Ue=p?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:g?function(){return performance.now()-u.__performance_now_clock_drift}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var at=[];function ot(e,t){ot.array||(ot.array=[]);var n,r=ot.array;for(r.length=0;n=i()[e++];)100===n||102===n?(t=t+7&-8,r.push(s()[t>>3]),t+=8):(t=t+3&-4,r.push(a()[t>>2]),t+=4);return r}function st(e,t,n){at.length=t;for(var r=n>>3,i=0;i<t;i++)at[i]=s()[r+i];var a=e<0,o=a?Ae[-e-1]:Wt[e];if(a){var l=ot(at[1],at[2]);return o.apply(null,l)}return o.apply(null,at)}function lt(){return i().length}function ut(e){try{return k.grow(e-H.byteLength+65535>>>16),Z(k.buffer),1}catch(fn){}}function ct(e){e>>>=0;var t=lt();if(e<=t)return!1;var n=2147483648;if(e>n)return!1;for(var r=1;r<=4;r*=2){var i=t*(1+.2/r);if(i=Math.min(i,e+100663296),ut(Math.min(n,K(Math.max(16777216,e,i),65536))))return!0}return!1}var dt={keyEvent:0,mouseEvent:0,wheelEvent:0,uiEvent:0,focusEvent:0,deviceOrientationEvent:0,deviceMotionEvent:0,fullscreenChangeEvent:0,pointerlockChangeEvent:0,visibilityChangeEvent:0,touchEvent:0,previousFullscreenElement:null,previousScreenX:null,previousScreenY:null,removeEventListenersRegistered:!1,removeAllEventListeners:function(){for(var e=dt.eventHandlers.length-1;e>=0;--e)dt._removeHandler(e);dt.eventHandlers=[],dt.deferredCalls=[]},registerRemoveEventListeners:function(){dt.removeEventListenersRegistered||(ae.push(dt.removeAllEventListeners),dt.removeEventListenersRegistered=!0)},deferredCalls:[],deferCall:function(e,t,n){function r(e,t){if(e.length!=t.length)return!1;for(var n in e)if(e[n]!=t[n])return!1;return!0}for(var i in dt.deferredCalls){var a=dt.deferredCalls[i];if(a.targetFunction==e&&r(a.argsList,n))return}dt.deferredCalls.push({targetFunction:e,precedence:t,argsList:n}),dt.deferredCalls.sort((function(e,t){return e.precedence<t.precedence}))},removeDeferredCalls:function(e){for(var t=0;t<dt.deferredCalls.length;++t)dt.deferredCalls[t].targetFunction==e&&(dt.deferredCalls.splice(t,1),--t)},canPerformEventHandlerRequests:function(){return dt.inEventHandler&&dt.currentEventHandler.allowsDeferredCalls},runDeferredCalls:function(){if(dt.canPerformEventHandlerRequests())for(var e=0;e<dt.deferredCalls.length;++e){var t=dt.deferredCalls[e];dt.deferredCalls.splice(e,1),--e,t.targetFunction.apply(null,t.argsList)}},inEventHandler:0,currentEventHandler:null,eventHandlers:[],removeAllHandlersOnTarget:function(e,t){for(var n=0;n<dt.eventHandlers.length;++n)dt.eventHandlers[n].target!=e||t&&t!=dt.eventHandlers[n].eventTypeString||dt._removeHandler(n--)},_removeHandler:function(e){var t=dt.eventHandlers[e];t.target.removeEventListener(t.eventTypeString,t.eventListenerFunc,t.useCapture),dt.eventHandlers.splice(e,1)},registerOrRemoveHandler:function(e){var t=function(t){++dt.inEventHandler,dt.currentEventHandler=e,dt.runDeferredCalls(),e.handlerFunc(t),dt.runDeferredCalls(),--dt.inEventHandler};if(e.callbackfunc)e.eventListenerFunc=t,e.target.addEventListener(e.eventTypeString,t,e.useCapture),dt.eventHandlers.push(e),dt.registerRemoveEventListeners();else for(var n=0;n<dt.eventHandlers.length;++n)dt.eventHandlers[n].target==e.target&&dt.eventHandlers[n].eventTypeString==e.eventTypeString&&dt._removeHandler(n--)},queueEventHandlerOnThread_iiii:function(e,t,n,r,i){var o=sn(),s=ln(12);a()[s>>2]=n,a()[s+4>>2]=r,a()[s+8>>2]=i,on(e,637534208,t,r,s),un(o)},getTargetThreadForEventCallback:function(e){switch(e){case 1:return 0;case 2:return He.currentProxiedOperationCallerThread;default:return e}},getNodeNameForTarget:function(e){return e?e==window?"#window":e==screen?"#screen":e&&e.nodeName?e.nodeName:"":""},fullscreenEnabled:function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}};function ht(e){var t=z(e)+1,n=Xt(t);return B(e,n,t),n}function ft(e,t,n,r){var i=sn(),o=ln(12),s=0;t&&(s=ht(t)),a()[o>>2]=s,a()[o+4>>2]=n,a()[o+8>>2]=r,on(e,657457152,0,s,o),un(i)}function pt(e,t,n,r){ft(e,t=t?L(t):"",n,r)}function mt(e){return e>2?L(e):e}var gt=[0,"undefined"!=typeof document?document:0,"undefined"!=typeof window?window:0];function vt(e){return e=mt(e),gt[e]||("undefined"!=typeof document?document.querySelector(e):void 0)}function yt(e){return vt(e)}function bt(e,t,n){var r=yt(e);if(!r)return-4;if(r.canvasSharedPtr&&(a()[r.canvasSharedPtr>>2]=t,a()[r.canvasSharedPtr+4>>2]=n),!r.offscreenCanvas&&r.controlTransferredOffscreen)return r.canvasSharedPtr?(pt(a()[r.canvasSharedPtr+8>>2],e,t,n),1):-4;r.offscreenCanvas&&(r=r.offscreenCanvas);var i=!1;if(r.GLctxObject&&r.GLctxObject.GLctx){var o=r.GLctxObject.GLctx.getParameter(2978);i=0===o[0]&&0===o[1]&&o[2]===r.width&&o[3]===r.height}return r.width=t,r.height=n,i&&r.GLctxObject.GLctx.viewport(0,0,t,n),0}function xt(e,t,n){return g?it(2,1,e,t,n):bt(e,t,n)}function wt(e,t,n){return yt(e)?bt(e,t,n):xt(e,t,n)}function _t(e){}function St(e,t){}function Et(e){var t=e.getExtension("ANGLE_instanced_arrays");if(t)return e.vertexAttribDivisor=function(e,n){t.vertexAttribDivisorANGLE(e,n)},e.drawArraysInstanced=function(e,n,r,i){t.drawArraysInstancedANGLE(e,n,r,i)},e.drawElementsInstanced=function(e,n,r,i,a){t.drawElementsInstancedANGLE(e,n,r,i,a)},1}function Tt(e){var t=e.getExtension("OES_vertex_array_object");if(t)return e.createVertexArray=function(){return t.createVertexArrayOES()},e.deleteVertexArray=function(e){t.deleteVertexArrayOES(e)},e.bindVertexArray=function(e){t.bindVertexArrayOES(e)},e.isVertexArray=function(e){return t.isVertexArrayOES(e)},1}function kt(e){var t=e.getExtension("WEBGL_draw_buffers");if(t)return e.drawBuffers=function(e,n){t.drawBuffersWEBGL(e,n)},1}var Ct={counter:1,lastError:0,buffers:[],mappedBuffers:{},programs:[],framebuffers:[],renderbuffers:[],textures:[],uniforms:[],shaders:[],vaos:[],contexts:{},currentContext:null,offscreenCanvases:{},timerQueriesEXT:[],programInfos:{},stringCache:{},unpackAlignment:4,init:function(){for(var e=new Float32Array(Ct.MINI_TEMP_BUFFER_SIZE),t=0;t<Ct.MINI_TEMP_BUFFER_SIZE;t++)Ct.miniTempBufferFloatViews[t]=e.subarray(0,t+1);var n=new Int32Array(Ct.MINI_TEMP_BUFFER_SIZE);for(t=0;t<Ct.MINI_TEMP_BUFFER_SIZE;t++)Ct.miniTempBufferIntViews[t]=n.subarray(0,t+1)},recordError:function(e){Ct.lastError||(Ct.lastError=e)},getNewId:function(e){for(var t=Ct.counter++,n=e.length;n<t;n++)e[n]=null;return t},MINI_TEMP_BUFFER_SIZE:256,miniTempBufferFloatViews:[0],miniTempBufferIntViews:[0],getSource:function(e,t,n,r){for(var i="",o=0;o<t;++o){var s=r?a()[r+4*o>>2]:-1;i+=L(a()[n+4*o>>2],s<0?void 0:s)}return i},createContext:function(e,t){var n=e.getContext("webgl",t);return n?Ct.registerContext(n,t):0},registerContext:function(e,t){var n=Xt(8);a()[n+4>>2]=Bt();var r={handle:n,attributes:t,version:t.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=r),Ct.contexts[n]=r,(void 0===t.enableExtensionsByDefault||t.enableExtensionsByDefault)&&Ct.initExtensions(r),n},makeContextCurrent:function(e){return Ct.currentContext=Ct.contexts[e],u.ctx=Dt=Ct.currentContext&&Ct.currentContext.GLctx,!(e&&!Dt)},getContext:function(e){return Ct.contexts[e]},deleteContext:function(e){Ct.currentContext===Ct.contexts[e]&&(Ct.currentContext=null),"object"==typeof dt&&dt.removeAllHandlersOnTarget(Ct.contexts[e].GLctx.canvas),Ct.contexts[e]&&Ct.contexts[e].GLctx.canvas&&(Ct.contexts[e].GLctx.canvas.GLctxObject=void 0),Kt(Ct.contexts[e].handle),Ct.contexts[e]=null},initExtensions:function(e){if(e||(e=Ct.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var t=e.GLctx;Et(t),Tt(t),kt(t),t.disjointTimerQueryExt=t.getExtension("EXT_disjoint_timer_query");var n=["OES_texture_float","OES_texture_half_float","OES_standard_derivatives","OES_vertex_array_object","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","OES_element_index_uint","EXT_texture_filter_anisotropic","EXT_frag_depth","WEBGL_draw_buffers","ANGLE_instanced_arrays","OES_texture_float_linear","OES_texture_half_float_linear","EXT_blend_minmax","EXT_shader_texture_lod","EXT_texture_norm16","WEBGL_compressed_texture_pvrtc","EXT_color_buffer_half_float","WEBGL_color_buffer_float","EXT_sRGB","WEBGL_compressed_texture_etc1","EXT_disjoint_timer_query","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_astc","EXT_color_buffer_float","WEBGL_compressed_texture_s3tc_srgb","EXT_disjoint_timer_query_webgl2","WEBKIT_WEBGL_compressed_texture_pvrtc"];(t.getSupportedExtensions()||[]).forEach((function(e){-1!=n.indexOf(e)&&t.getExtension(e)}))}},populateUniformTable:function(e){for(var t=Ct.programs[e],n=Ct.programInfos[e]={uniforms:{},maxUniformLength:0,maxAttributeLength:-1,maxUniformBlockNameLength:-1},r=n.uniforms,i=Dt.getProgramParameter(t,35718),a=0;a<i;++a){var o=Dt.getActiveUniform(t,a),s=o.name;n.maxUniformLength=Math.max(n.maxUniformLength,s.length+1),"]"==s.slice(-1)&&(s=s.slice(0,s.lastIndexOf("[")));var l=Dt.getUniformLocation(t,s);if(l){var u=Ct.getNewId(Ct.uniforms);r[s]=[o.size,u],Ct.uniforms[u]=l;for(var c=1;c<o.size;++c)l=Dt.getUniformLocation(t,s+"["+c+"]"),u=Ct.getNewId(Ct.uniforms),Ct.uniforms[u]=l}}}},It=["default","low-power","high-performance"];function Ot(e,t){var n={},r=t>>2;n.alpha=!!a()[r+0],n.depth=!!a()[r+1],n.stencil=!!a()[r+2],n.antialias=!!a()[r+3],n.premultipliedAlpha=!!a()[r+4],n.preserveDrawingBuffer=!!a()[r+5];var i=a()[r+6];n.powerPreference=It[i],n.failIfMajorPerformanceCaveat=!!a()[r+7],n.majorVersion=a()[r+8],n.minorVersion=a()[r+9],n.enableExtensionsByDefault=a()[r+10],n.explicitSwapControl=a()[r+11],n.proxyContextToMainThread=a()[r+12],n.renderViaOffscreenBackBuffer=a()[r+13];var o=yt(e);return o?n.explicitSwapControl?-1:Ct.createContext(o,n):-4}function At(e,t){return Ot(e,t)}var Dt,Mt={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var n=Mt.buffers[e];0===t||10===t?((1===e?C:I)(F(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function(){return Mt.varargs+=4,a()[Mt.varargs-4>>2]},getStr:function(e){return L(e)},get64:function(e,t){return e}};function Nt(e){return g?it(3,1,e):0}function jt(e,t,n,r,i){if(g)return it(4,1,e,t,n,r,i)}function Rt(e,t,n,r){if(g)return it(5,1,e,t,n,r);for(var o=0,s=0;s<n;s++){for(var l=a()[t+8*s>>2],u=a()[t+(8*s+4)>>2],c=0;c<u;c++)Mt.printChar(e,i()[l+c]);o+=u}return a()[r>>2]=o,0}function Pt(e){var t=He.exitHandlers.pop();e&&t()}function Ft(e,t){null===He.exitHandlers&&(He.exitHandlers=[]),He.exitHandlers.push((function(){cn(e,t)}))}function Lt(e){if(g)throw"Internal Error! _spawn_thread() can only ever be called from main application thread!";var t=He.getNewWorker();if(void 0!==t.pthread)throw"Internal error!";if(!e.pthread_ptr)throw"Internal error, no pthread ptr!";He.runningWorkers.push(t);for(var n=Xt(512),r=0;r<128;++r)a()[n+4*r>>2]=0;var i=e.stackBase+e.stackSize,s=He.pthreads[e.pthread_ptr]={worker:t,stackBase:e.stackBase,stackSize:e.stackSize,allocatedOwnStack:e.allocatedOwnStack,thread:e.pthread_ptr,threadInfoStruct:e.pthread_ptr},l=s.threadInfoStruct>>2;Atomics.store(o(),l+0,0),Atomics.store(o(),l+1,0),Atomics.store(o(),l+2,0),Atomics.store(o(),l+17,e.detached),Atomics.store(o(),l+26,n),Atomics.store(o(),l+12,0),Atomics.store(o(),l+10,s.threadInfoStruct),Atomics.store(o(),l+11,42),Atomics.store(o(),l+27,e.stackSize),Atomics.store(o(),l+21,e.stackSize),Atomics.store(o(),l+20,i),Atomics.store(o(),l+29,i),Atomics.store(o(),l+30,e.detached),Atomics.store(o(),l+32,e.schedPolicy),Atomics.store(o(),l+33,e.schedPrio);var u=Zt()+40;Atomics.store(o(),l+44,u),t.pthread=s;var c={cmd:"run",start_routine:e.startRoutine,arg:e.arg,threadInfoStruct:e.pthread_ptr,selfThreadId:e.pthread_ptr,parentThreadId:e.parent_pthread_ptr,stackBase:e.stackBase,stackSize:e.stackSize};t.runPthread=function(){c.time=performance.now(),t.postMessage(c,e.transferList)},t.loaded&&(t.runPthread(),delete t.runPthread)}function $t(e,t,n){if(!t&&!n)return Pe.EINVAL;if(!e)return I("pthread_getschedparam called with a null thread pointer!"),Pe.ESRCH;if(a()[e+12>>2]!==e)return I("pthread_getschedparam attempted on thread "+e+", which does not point to a valid thread, or does not exist anymore!"),Pe.ESRCH;var r=Atomics.load(o(),e+108+20>>2),i=Atomics.load(o(),e+108+24>>2);return t&&(a()[t>>2]=r),n&&(a()[n>>2]=i),0}function Bt(){return 0|Me}function zt(e,t,n,r){if("undefined"==typeof SharedArrayBuffer)return I("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;if(!e)return I("pthread_create called with a null thread pointer!"),28;var i=[];if(g&&0===i.length)return rn(687865856,e,t,n,r);var s=0,l=0,u=0,c=0,d=0;if(t)if(s=a()[t>>2],s+=81920,l=a()[t+8>>2],u=0!==a()[t+12>>2],0===a()[t+16>>2]){var h=a()[t+20>>2],f=a()[t+24>>2];$t(He.currentProxiedOperationCallerThread?He.currentProxiedOperationCallerThread:Bt(),t+20,t+24),c=a()[t+20>>2],d=a()[t+24>>2],a()[t+20>>2]=h,a()[t+24>>2]=f}else c=a()[t+20>>2],d=a()[t+24>>2];else s=2097152;var p=0==l;p?l=Qt(16,s):N((l-=s)>0);for(var m=Xt(232),v=0;v<58;++v)o()[(m>>2)+v]=0;a()[e>>2]=m,a()[m+12>>2]=m;var y=m+156;a()[y>>2]=y;var b={stackBase:l,stackSize:s,allocatedOwnStack:p,schedPolicy:c,schedPrio:d,detached:u,startRoutine:n,pthread_ptr:m,parent_pthread_ptr:Bt(),arg:r,transferList:i};return g?(b.cmd="spawnThread",postMessage(b,i)):Lt(b),0}function Ut(e){return(e=+e)>=0?+pe(e+.5):+fe(e-.5)}function Ht(e){if(g)return it(6,1,e);switch(e){case 30:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:case 79:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return Ye(28),-1}u._pthread_self=Bt,g?He.initWorker():He.initMainThreadBlock(),Ct.init();var Wt=[null,Xe,xt,Nt,jt,Rt,Ht],Vt={e:qe,r:Ge,w:Ke,a:Ze,l:Je,d:Qe,c:Le,h:Ue,g:et,x:tt,q:nt,B:rt,t:st,A:ct,u:wt,k:_t,s:St,v:At,m:Nt,o:jt,i:Rt,p:De,memory:k||u.wasmMemory,y:Pt,z:Ft,j:zt,b:Bt,f:Ut,n:Ht,table:A},qt=Oe();u.asm=qt;var Gt,Yt=u.___wasm_call_ctors=function(){return(Yt=u.___wasm_call_ctors=u.asm.C).apply(null,arguments)},Xt=(u._init=function(){return(u._init=u.asm.D).apply(null,arguments)},u._register_tensor=function(){return(u._register_tensor=u.asm.E).apply(null,arguments)},u._dispose_data=function(){return(u._dispose_data=u.asm.F).apply(null,arguments)},u._dispose=function(){return(u._dispose=u.asm.G).apply(null,arguments)},u._Abs=function(){return(u._Abs=u.asm.H).apply(null,arguments)},u._Add=function(){return(u._Add=u.asm.I).apply(null,arguments)},u._AddN=function(){return(u._AddN=u.asm.J).apply(null,arguments)},u._ArgMax=function(){return(u._ArgMax=u.asm.K).apply(null,arguments)},u._AvgPool=function(){return(u._AvgPool=u.asm.L).apply(null,arguments)},u._BatchMatMul=function(){return(u._BatchMatMul=u.asm.M).apply(null,arguments)},u._ClipByValue=function(){return(u._ClipByValue=u.asm.N).apply(null,arguments)},u._Conv2D=function(){return(u._Conv2D=u.asm.O).apply(null,arguments)},u._Conv2DBackpropInput=function(){return(u._Conv2DBackpropInput=u.asm.P).apply(null,arguments)},u._Cos=function(){return(u._Cos=u.asm.Q).apply(null,arguments)},u._CropAndResize=function(){return(u._CropAndResize=u.asm.R).apply(null,arguments)},u._Cumsum=function(){return(u._Cumsum=u.asm.S).apply(null,arguments)},u._DepthToSpace=function(){return(u._DepthToSpace=u.asm.T).apply(null,arguments)},u._DepthwiseConv2dNative=function(){return(u._DepthwiseConv2dNative=u.asm.U).apply(null,arguments)},u._Div=function(){return(u._Div=u.asm.V).apply(null,arguments)},u._Equal=function(){return(u._Equal=u.asm.W).apply(null,arguments)},u._Exp=function(){return(u._Exp=u.asm.X).apply(null,arguments)},u._FlipLeftRight=function(){return(u._FlipLeftRight=u.asm.Y).apply(null,arguments)},u._FloorDiv=function(){return(u._FloorDiv=u.asm.Z).apply(null,arguments)},u._FusedBatchNorm=function(){return(u._FusedBatchNorm=u.asm._).apply(null,arguments)},u._FusedConv2D=function(){return(u._FusedConv2D=u.asm.$).apply(null,arguments)},u._FusedDepthwiseConv2D=function(){return(u._FusedDepthwiseConv2D=u.asm.aa).apply(null,arguments)},u._Gather=function(){return(u._Gather=u.asm.ba).apply(null,arguments)},u._GatherNd=function(){return(u._GatherNd=u.asm.ca).apply(null,arguments)},u._Greater=function(){return(u._Greater=u.asm.da).apply(null,arguments)},u._GreaterEqual=function(){return(u._GreaterEqual=u.asm.ea).apply(null,arguments)},u._Less=function(){return(u._Less=u.asm.fa).apply(null,arguments)},u._LessEqual=function(){return(u._LessEqual=u.asm.ga).apply(null,arguments)},u._Log=function(){return(u._Log=u.asm.ha).apply(null,arguments)},u._LogicalAnd=function(){return(u._LogicalAnd=u.asm.ia).apply(null,arguments)},u._Max=function(){return(u._Max=u.asm.ja).apply(null,arguments)},u._MaxPool=function(){return(u._MaxPool=u.asm.ka).apply(null,arguments)},u._Maximum=function(){return(u._Maximum=u.asm.la).apply(null,arguments)},u._Min=function(){return(u._Min=u.asm.ma).apply(null,arguments)},u._Minimum=function(){return(u._Minimum=u.asm.na).apply(null,arguments)},u._Multiply=function(){return(u._Multiply=u.asm.oa).apply(null,arguments)},u._Negate=function(){return(u._Negate=u.asm.pa).apply(null,arguments)},u._NonMaxSuppressionV3=function(){return(u._NonMaxSuppressionV3=u.asm.qa).apply(null,arguments)},u._NonMaxSuppressionV4=function(){return(u._NonMaxSuppressionV4=u.asm.ra).apply(null,arguments)},u._NonMaxSuppressionV5=function(){return(u._NonMaxSuppressionV5=u.asm.sa).apply(null,arguments)},u._NotEqual=function(){return(u._NotEqual=u.asm.ta).apply(null,arguments)},u._OneHot=function(){return(u._OneHot=u.asm.ua).apply(null,arguments)},u._PadV2=function(){return(u._PadV2=u.asm.va).apply(null,arguments)},u._Pow=function(){return(u._Pow=u.asm.wa).apply(null,arguments)},u._Prelu=function(){return(u._Prelu=u.asm.xa).apply(null,arguments)},u._Relu=function(){return(u._Relu=u.asm.ya).apply(null,arguments)},u._Relu6=function(){return(u._Relu6=u.asm.za).apply(null,arguments)},u._ResizeBilinear=function(){return(u._ResizeBilinear=u.asm.Aa).apply(null,arguments)},u._Reverse=function(){return(u._Reverse=u.asm.Ba).apply(null,arguments)},u._RotateWithOffset=function(){return(u._RotateWithOffset=u.asm.Ca).apply(null,arguments)},u._Rsqrt=function(){return(u._Rsqrt=u.asm.Da).apply(null,arguments)},u._ScatterNd=function(){return(u._ScatterNd=u.asm.Ea).apply(null,arguments)},u._SelectV2=function(){return(u._SelectV2=u.asm.Fa).apply(null,arguments)},u._Sigmoid=function(){return(u._Sigmoid=u.asm.Ga).apply(null,arguments)},u._Sin=function(){return(u._Sin=u.asm.Ha).apply(null,arguments)},u._Softmax=function(){return(u._Softmax=u.asm.Ia).apply(null,arguments)},u._Sqrt=function(){return(u._Sqrt=u.asm.Ja).apply(null,arguments)},u._Square=function(){return(u._Square=u.asm.Ka).apply(null,arguments)},u._SquaredDifference=function(){return(u._SquaredDifference=u.asm.La).apply(null,arguments)},u._StridedSlice=function(){return(u._StridedSlice=u.asm.Ma).apply(null,arguments)},u._Sub=function(){return(u._Sub=u.asm.Na).apply(null,arguments)},u._Sum=function(){return(u._Sum=u.asm.Oa).apply(null,arguments)},u._Tanh=function(){return(u._Tanh=u.asm.Pa).apply(null,arguments)},u._Tile=function(){return(u._Tile=u.asm.Qa).apply(null,arguments)},u._Transpose=function(){return(u._Transpose=u.asm.Ra).apply(null,arguments)},u.__FusedMatMul=function(){return(u.__FusedMatMul=u.asm.Sa).apply(null,arguments)},u._malloc=function(){return(Xt=u._malloc=u.asm.Ta).apply(null,arguments)}),Kt=u._free=function(){return(Kt=u._free=u.asm.Ua).apply(null,arguments)},Zt=u._emscripten_get_global_libc=function(){return(Zt=u._emscripten_get_global_libc=u.asm.Va).apply(null,arguments)},Jt=u.___errno_location=function(){return(Jt=u.___errno_location=u.asm.Wa).apply(null,arguments)},Qt=(u.___em_js__initPthreadsJS=function(){return(u.___em_js__initPthreadsJS=u.asm.Xa).apply(null,arguments)},u._memalign=function(){return(Qt=u._memalign=u.asm.Ya).apply(null,arguments)}),en=u.___pthread_tsd_run_dtors=function(){return(en=u.___pthread_tsd_run_dtors=u.asm.Za).apply(null,arguments)},tn=u._emscripten_main_thread_process_queued_calls=function(){return(tn=u._emscripten_main_thread_process_queued_calls=u.asm._a).apply(null,arguments)},nn=(u._emscripten_current_thread_process_queued_calls=function(){return(u._emscripten_current_thread_process_queued_calls=u.asm.$a).apply(null,arguments)},u._emscripten_register_main_browser_thread_id=function(){return(nn=u._emscripten_register_main_browser_thread_id=u.asm.ab).apply(null,arguments)}),rn=(u._emscripten_main_browser_thread_id=function(){return(u._emscripten_main_browser_thread_id=u.asm.bb).apply(null,arguments)},u._emscripten_async_run_in_main_thread=function(){return(u._emscripten_async_run_in_main_thread=u.asm.cb).apply(null,arguments)},u._emscripten_sync_run_in_main_thread=function(){return(u._emscripten_sync_run_in_main_thread=u.asm.db).apply(null,arguments)},u._emscripten_sync_run_in_main_thread_0=function(){return(u._emscripten_sync_run_in_main_thread_0=u.asm.eb).apply(null,arguments)},u._emscripten_sync_run_in_main_thread_1=function(){return(u._emscripten_sync_run_in_main_thread_1=u.asm.fb).apply(null,arguments)},u._emscripten_sync_run_in_main_thread_2=function(){return(u._emscripten_sync_run_in_main_thread_2=u.asm.gb).apply(null,arguments)},u._emscripten_sync_run_in_main_thread_xprintf_varargs=function(){return(u._emscripten_sync_run_in_main_thread_xprintf_varargs=u.asm.hb).apply(null,arguments)},u._emscripten_sync_run_in_main_thread_3=function(){return(u._emscripten_sync_run_in_main_thread_3=u.asm.ib).apply(null,arguments)},u._emscripten_sync_run_in_main_thread_4=function(){return(rn=u._emscripten_sync_run_in_main_thread_4=u.asm.jb).apply(null,arguments)}),an=(u._emscripten_sync_run_in_main_thread_5=function(){return(u._emscripten_sync_run_in_main_thread_5=u.asm.kb).apply(null,arguments)},u._emscripten_sync_run_in_main_thread_6=function(){return(u._emscripten_sync_run_in_main_thread_6=u.asm.lb).apply(null,arguments)},u._emscripten_sync_run_in_main_thread_7=function(){return(u._emscripten_sync_run_in_main_thread_7=u.asm.mb).apply(null,arguments)},u._emscripten_run_in_main_runtime_thread_js=function(){return(an=u._emscripten_run_in_main_runtime_thread_js=u.asm.nb).apply(null,arguments)}),on=u._emscripten_async_queue_on_thread_=function(){return(on=u._emscripten_async_queue_on_thread_=u.asm.ob).apply(null,arguments)},sn=(u._emscripten_tls_init=function(){return(u._emscripten_tls_init=u.asm.pb).apply(null,arguments)},u.stackSave=function(){return(sn=u.stackSave=u.asm.qb).apply(null,arguments)}),ln=u.stackAlloc=function(){return(ln=u.stackAlloc=u.asm.rb).apply(null,arguments)},un=u.stackRestore=function(){return(un=u.stackRestore=u.asm.sb).apply(null,arguments)},cn=u.dynCall_vi=function(){return(cn=u.dynCall_vi=u.asm.tb).apply(null,arguments)};function dn(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function hn(e){function t(){Gt||(Gt=!0,u.calledRun=!0,M||(le(),ue(),u.onRuntimeInitialized&&u.onRuntimeInitialized(),ce()))}e=e||d,me>0||(se(),me>0||(u.setStatus?(u.setStatus("Running..."),setTimeout((function(){setTimeout((function(){u.setStatus("")}),1),t()}),1)):t()))}if(u.dynCall_v=function(){return(u.dynCall_v=u.asm.ub).apply(null,arguments)},u.dynCall_ii=function(){return(u.dynCall_ii=u.asm.vb).apply(null,arguments)},u.asm=qt,u.cwrap=P,u.PThread=He,u.PThread=He,u._pthread_self=Bt,u.wasmMemory=k,u.ExitStatus=dn,u.then=function(e){if(Gt)e(u);else{var t=u.onRuntimeInitialized;u.onRuntimeInitialized=function(){t&&t(),e(u)}}return u},ve=function e(){Gt||hn(),Gt||(ve=e)},u.run=hn,u.preInit)for("function"==typeof u.preInit&&(u.preInit=[u.preInit]);u.preInit.length>0;)u.preInit.pop()();return g||(T=!0),g||hn(),e});e.exports=i},VmpX:function(e,t,n){const r=n("0eLh");e.exports=(e,t,n)=>r(e,t,">",n)},"W6+N":function(e,t,n){"undefined"!=typeof self&&self,e.exports=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=41)}([function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.external=void 0;var r=n(44),i=function(e){return e&&e.__esModule?e:{default:e}}(n(55)),a=null,o=r.enhancedNiftiReader;t.external={set cornerstone(e){(0,i.default)(a=e)},get cornerstone(){return a},set niftiReader(e){o=e},get niftiReader(){return o}}},function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)r(n,i)&&(e[i]=n[i])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){var t,n,r,i,a,o;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(o=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)o.set(a=e[t],i),i+=a.length;return o}},o={arraySet:function(e,t,n,r,i){for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(i)},function(e,t){e.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function a(){p&&h&&(p=!1,h.length?f=h.concat(f):m=-1,f.length&&o())}function o(){if(!p){var e=i(a);p=!0;for(var t=f.length;t;){for(h=f,f=[];++m<t;)h&&h[m].run();m=-1,t=f.length}h=null,p=!1,function(e){if(c===clearTimeout)return clearTimeout(e);if((c===r||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}(e)}}function s(e,t){this.fun=e,this.array=t}function l(){}var u,c,d=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{c="function"==typeof clearTimeout?clearTimeout:r}catch(e){c=r}}();var h,f=[],p=!1,m=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new s(e,t)),1!==f.length||p||i(o)},s.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.prependListener=l,d.prependOnceListener=l,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);u.call(this,e),c.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",i)}function i(){this.allowHalfOpen||this._writableState.ended||o(a,this)}function a(e){e.end()}var o=n(10),s=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=r;var l=n(7);l.inherits=n(3);var u=n(34),c=n(38);l.inherits(r,u);for(var d=s(c.prototype),h=0;h<d.length;h++){var f=d[h];r.prototype[f]||(r.prototype[f]=c.prototype[f])}Object.defineProperty(r.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),r.prototype._destroy=function(e,t){this.push(null),this.end(),o(t,e)}},function(e,t,n){"use strict";(function(e){function r(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function i(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return a.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=a.prototype:(null===e&&(e=new a(t)),e.length=t),e}function a(e,t,n){if(!(a.TYPED_ARRAY_SUPPORT||this instanceof a))return new a(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return o(this,e,t,n)}function o(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),a.TYPED_ARRAY_SUPPORT?(e=t).__proto__=a.prototype:e=u(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!a.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|d(t,n),o=(e=i(e,r)).write(t,n);return o!==r&&(e=e.slice(0,o)),e}(e,t,n):function(e,t){if(a.isBuffer(t)){var n=0|c(t.length);return 0===(e=i(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function(e){return e!=e}(t.length)?i(e,0):u(e,t);if("Buffer"===t.type&&z(t.data))return u(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t){if(s(t),e=i(e,t<0?0:0|c(t)),!a.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function u(e,t){var n=t.length<0?0:0|c(t.length);e=i(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function c(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function d(e,t){if(a.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return P(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return F(e).length;default:if(r)return P(e).length;t=(""+t).toLowerCase(),r=!0}}function h(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return k(this,t,n);case"utf8":case"utf-8":return S(this,t,n);case"ascii":return E(this,t,n);case"latin1":case"binary":return T(this,t,n);case"base64":return _(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function f(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function p(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=a.from(t,r)),a.isBuffer(t))return 0===t.length?-1:m(e,t,n,r,i);if("number"==typeof t)return t&=255,a.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):m(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,r,i){function a(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var o,s=1,l=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,l/=2,u/=2,n/=2}if(i){var c=-1;for(o=n;o<l;o++)if(a(e,o)===a(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===u)return c*s}else-1!==c&&(o-=o-c),c=-1}else for(n+u>l&&(n=l-u),o=n;o>=0;o--){for(var d=!0,h=0;h<u;h++)if(a(e,o+h)!==a(t,h)){d=!1;break}if(d)return o}return-1}function g(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function v(e,t,n,r){return L(P(t,e.length-n),e,n,r)}function y(e,t,n,r){return L(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function b(e,t,n,r){return y(e,t,n,r)}function x(e,t,n,r){return L(F(t),e,n,r)}function w(e,t,n,r){return L(function(e,t){for(var n,r,i=[],a=0;a<e.length&&!((t-=2)<0);++a)r=(n=e.charCodeAt(a))>>8,i.push(n%256),i.push(r);return i}(t,e.length-n),e,n,r)}function _(e,t,n){return $.fromByteArray(0===t&&n===e.length?e:e.slice(t,n))}function S(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,l,u=e[i],c=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=n)switch(d){case 1:u<128&&(c=u);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&u)<<6|63&a)>127&&(c=l);break;case 3:o=e[i+2],128==(192&(a=e[i+1]))&&128==(192&o)&&(l=(15&u)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:o=e[i+2],s=e[i+3],128==(192&(a=e[i+1]))&&128==(192&o)&&128==(192&s)&&(l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,d=1):c>65535&&(r.push((c-=65536)>>>10&1023|55296),c=56320|1023&c),r.push(c),i+=d}return function(e){var t=e.length;if(t<=U)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=U));return n}(r)}function E(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function T(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function k(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=R(e[a]);return i}function C(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function I(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,n,r,i,o){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function A(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);i<a;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function D(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);i<a;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function M(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function N(e,t,n,r,i){return i||M(e,0,n,4),B.write(e,t,n,r,23,4),n+4}function j(e,t,n,r,i){return i||M(e,0,n,8),B.write(e,t,n,r,52,8),n+8}function R(e){return e<16?"0"+e.toString(16):e.toString(16)}function P(e,t){t=t||1/0;for(var n,r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function F(e){return $.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(H,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function L(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}var $=n(72),B=n(73),z=n(30);t.Buffer=a,t.SlowBuffer=function(e){return+e!=e&&(e=0),a.alloc(+e)},t.INSPECT_MAX_BYTES=50,a.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=r(),a.poolSize=8192,a._augment=function(e){return e.__proto__=a.prototype,e},a.from=function(e,t,n){return o(null,e,t,n)},a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0})),a.alloc=function(e,t,n){return function(e,t,n,r){return s(t),t<=0?i(e,t):void 0!==n?"string"==typeof r?i(e,t).fill(n,r):i(e,t).fill(n):i(e,t)}(null,e,t,n)},a.allocUnsafe=function(e){return l(null,e)},a.allocUnsafeSlow=function(e){return l(null,e)},a.isBuffer=function(e){return!(null==e||!e._isBuffer)},a.compare=function(e,t){if(!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!z(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=a.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!a.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},a.byteLength=d,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)f(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)f(this,t,t+3),f(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)f(this,t,t+7),f(this,t+1,t+6),f(this,t+2,t+5),f(this,t+3,t+4);return this},a.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?S(this,0,e):h.apply(this,arguments)},a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},a.prototype.compare=function(e,t,n,r,i){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),l=Math.min(o,s),u=this.slice(r,i),c=e.slice(t,n),d=0;d<l;++d)if(u[d]!==c[d]){o=u[d],s=c[d];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},a.prototype.indexOf=function(e,t,n){return p(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return p(this,e,t,n,!1)},a.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return g(this,e,t,n);case"utf8":case"utf-8":return v(this,e,t,n);case"ascii":return y(this,e,t,n);case"latin1":case"binary":return b(this,e,t,n);case"base64":return x(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var U=4096;a.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),a.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=a.prototype;else{var i=t-e;n=new a(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},a.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},a.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},a.prototype.readUInt8=function(e,t){return t||I(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return t||I(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return t||I(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUInt32BE=function(e,t){return t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},a.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},a.prototype.readInt8=function(e,t){return t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},a.prototype.readInt16LE=function(e,t){t||I(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(e,t){t||I(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(e,t){return t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return t||I(e,4,this.length),B.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return t||I(e,4,this.length),B.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return t||I(e,8,this.length),B.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return t||I(e,8,this.length),B.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||O(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},a.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||O(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},a.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,1,255,0),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):A(this,e,t,!0),t+2},a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):A(this,e,t,!1),t+2},a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},a.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);O(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},a.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);O(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,1,127,-128),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):A(this,e,t,!0),t+2},a.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):A(this,e,t,!1),t+2},a.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},a.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},a.prototype.writeFloatLE=function(e,t,n){return N(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return N(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!a.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},a.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=a.isBuffer(e)?e:P(new a(e,r).toString()),l=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%l]}return this};var H=/[^+\/0-9A-Za-z-_]/g}).call(t,n(0))},function(e,t,n){(function(e){function n(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===n(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===n(e)},t.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(t,n(6).Buffer)},function(e,t,n){"use strict";function r(e){return void 0!==e}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n,r){var i=n.dimension,a=n.index;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.filePath=t,this.slice={dimension:i,index:a},this.timePoint=r}return i(e,[{key:"url",get:function(){var e="nifti:"+this.filePath;return(r(this.slice.dimension)||r(this.slice.index))&&(e+="#"),r(this.slice.dimension)&&(e+=this.slice.dimension,r(this.slice.index)&&(e+="-")),r(this.slice.index)&&(e+=this.slice.index),r(this.timePoint)&&(e+=",t-"+this.timePoint),e}}],[{key:"fromURL",value:function(t){var n=/^nifti:([^#]+)(?:#(?:(?=[xyz])(?:([xyz])(?:(?=-[\d]+)-([\d]+))?(?:,t-(\d+))?)|(?![xyz])([\d]+)))?$/.exec(t);if(!n)throw new Error("Not in a valid imageId format: "+t);return new e(n&&n[1],{dimension:n&&n[2]||"z",index:n&&parseInt(n[3]||n[5],0)||0},n&&n[4]&&parseInt(n[4],0)||0)}}]),e}();t.default=a},function(e,t,n){function r(e,t){return e[0]-t[0]}function i(){var e,t=this.stride,n=new Array(t.length);for(e=0;e<n.length;++e)n[e]=[Math.abs(t[e]),e];n.sort(r);var i=new Array(n.length);for(e=0;e<i.length;++e)i[e]=n[e][1];return i}function a(e,t){var n=["View",t,"d",e].join("");t<0&&(n="View_Nil"+e);var r="generic"===e;if(-1===t){var a="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(a)()}if(0===t)return a="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(r?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(r?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}",new Function("TrivialArray",a)(c[e][0]);a=["'use strict'"];var o=s(t),l=o.map((function(e){return"i"+e})),u="this.offset+"+o.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),d=o.map((function(e){return"b"+e})).join(","),h=o.map((function(e){return"c"+e})).join(",");a.push("function "+n+"(a,"+d+","+h+",d){this.data=a","this.shape=["+d+"]","this.stride=["+h+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),a.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+o.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?a.push("proto.order=[0]"):(a.push("Object.defineProperty(proto,'order',{get:"),t<4?(a.push("function "+n+"_order(){"),2===t?a.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&a.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):a.push("ORDER})")),a.push("proto.set=function "+n+"_set("+l.join(",")+",v){"),a.push(r?"return this.data.set("+u+",v)}":"return this.data["+u+"]=v}"),a.push("proto.get=function "+n+"_get("+l.join(",")+"){"),a.push(r?"return this.data.get("+u+")}":"return this.data["+u+"]}"),a.push("proto.index=function "+n+"_index(",l.join(),"){return "+u+"}"),a.push("proto.hi=function "+n+"_hi("+l.join(",")+"){return new "+n+"(this.data,"+o.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+o.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var f=o.map((function(e){return"a"+e+"=this.shape["+e+"]"})),p=o.map((function(e){return"c"+e+"=this.stride["+e+"]"}));a.push("proto.lo=function "+n+"_lo("+l.join(",")+"){var b=this.offset,d=0,"+f.join(",")+","+p.join(","));for(var m=0;m<t;++m)a.push("if(typeof i"+m+"==='number'&&i"+m+">=0){d=i"+m+"|0;b+=c"+m+"*d;a"+m+"-=d}");for(a.push("return new "+n+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"c"+e})).join(",")+",b)}"),a.push("proto.step=function "+n+"_step("+l.join(",")+"){var "+o.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+o.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil"),m=0;m<t;++m)a.push("if(typeof i"+m+"==='number'){d=i"+m+"|0;if(d<0){c+=b"+m+"*(a"+m+"-1);a"+m+"=ceil(-a"+m+"/d)}else{a"+m+"=ceil(a"+m+"/d)}b"+m+"*=d}");a.push("return new "+n+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"b"+e})).join(",")+",c)}");var g=new Array(t),v=new Array(t);for(m=0;m<t;++m)g[m]="a[i"+m+"]",v[m]="b[i"+m+"]";for(a.push("proto.transpose=function "+n+"_transpose("+l+"){"+l.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+g.join(",")+","+v.join(",")+",this.offset)}"),a.push("proto.pick=function "+n+"_pick("+l+"){var a=[],b=[],c=this.offset"),m=0;m<t;++m)a.push("if(typeof i"+m+"==='number'&&i"+m+">=0){c=(c+this.stride["+m+"]*i"+m+")|0}else{a.push(this.shape["+m+"]);b.push(this.stride["+m+"])}");return a.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),a.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+o.map((function(e){return"shape["+e+"]"})).join(",")+","+o.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",a.join("\n"))(c[e],i)}function o(e){if(l(e))return"buffer";if(u)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(e)?"array":"generic"}var s=n(62),l=n(63),u="undefined"!=typeof Float64Array,c={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};e.exports=function(e,t,n,r){if(void 0===e)return(0,c.array[0])([]);"number"==typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var i=t.length;if(void 0===n){n=new Array(i);for(var s=i-1,l=1;s>=0;--s)n[s]=l,l*=t[s]}if(void 0===r)for(r=0,s=0;s<i;++s)n[s]<0&&(r-=(t[s]-1)*n[s]);for(var u=o(e),d=c[u];d.length<=i+1;)d.push(a(u,d.length-1));return(0,d[i+1])(e,t,n,r)}},function(e,t,n){"use strict";(function(t){e.exports=!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?function(e,n,r,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var a,o,s=arguments.length;switch(s){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,n)}));case 3:return t.nextTick((function(){e.call(null,n,r)}));case 4:return t.nextTick((function(){e.call(null,n,r,i)}));default:for(a=new Array(s-1),o=0;o<a.length;)a[o++]=arguments[o];return t.nextTick((function(){e.apply(null,a)}))}}:t.nextTick}).call(t,n(4))},function(e,t,n){function r(e,t){for(var n in e)t[n]=e[n]}function i(e,t,n){return o(e,t,n)}var a=n(6),o=a.Buffer;o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?e.exports=a:(r(a,t),t.Buffer=i),r(o,i),i.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return o(e,t,n)},i.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=o(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return a.SlowBuffer(e)}},function(e,t,n){"use strict";var r=r||{};r.Utils=r.Utils||{},r.Utils.crcTable=null,r.Utils.GUNZIP_MAGIC_COOKIE1=31,r.Utils.GUNZIP_MAGIC_COOKIE2=139,r.Utils.getStringAt=function(e,t,n){var r,i,a="";for(r=t;r<n;r+=1)0!==(i=e.getUint8(r))&&(a+=String.fromCharCode(i));return a},r.Utils.getByteAt=function(e,t){return e.getInt8(t)},r.Utils.getShortAt=function(e,t,n){return e.getInt16(t,n)},r.Utils.getIntAt=function(e,t,n){return e.getInt32(t,n)},r.Utils.getFloatAt=function(e,t,n){return e.getFloat32(t,n)},r.Utils.getDoubleAt=function(e,t,n){return e.getFloat64(t,n)},r.Utils.getLongAt=function(e,t,n){var i,a=[],o=0;for(i=0;i<8;i+=1)a[i]=r.Utils.getByteAt(e,t+i,n);for(i=a.length-1;i>=0;i--)o=256*o+a[i];return o},r.Utils.toArrayBuffer=function(e){var t,n,r;for(t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r+=1)n[r]=e[r];return t},r.Utils.isString=function(e){return"string"==typeof e||e instanceof String},r.Utils.formatNumber=function(e,t){var n=0;return n=(n=r.Utils.isString(e)?Number(e):e).toPrecision(t?5:7),parseFloat(n)},r.Utils.makeCRCTable=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t},r.Utils.crc32=function(e){for(var t=r.Utils.crcTable||(r.Utils.crcTable=r.Utils.makeCRCTable()),n=-1,i=0;i<e.byteLength;i++)n=n>>>8^t[255&(n^e.getUint8(i))];return(-1^n)>>>0},void 0!==e&&e.exports&&(e.exports=r.Utils)},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";function r(e){var t=new CustomEvent(e,{detail:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}});i.external.cornerstone.events.dispatchEvent(t)}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);t.default={imageLoadProgress:function(e){return r("cornerstoneimageloadprogress",e)},imageLoadStart:function(e){return r("cornerstoneimageloadstart",e)},imageLoadEnd:function(e){return r("cornerstoneimageloadend",e)}}},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){var t=u.external.niftiReader,n=t.readHeader(e);!function(e,t){var n=void 0;switch(7&t.xyzt_units){case e.NIFTI1.UNITS_METER:n=1e3;break;case e.NIFTI1.UNITS_MICRON:n=.001;break;case e.NIFTI1.UNITS_MM:default:n=1}t.pixDims=t.pixDims.map((function(e,r){return r>0&&r<=t.dims[0]?e*n:e})),t.affine&&(t.affine=t.affine.map((function(e){return e.map((function(e){return e*n}))}))),(t.quatern_b||t.quatern_c||t.quatern_d)&&(t.quatern_b*=n,t.quatern_c*=n,t.quatern_d*=n),(t.qoffset_x||t.qoffset_y||t.qoffset_z)&&(t.qoffset_x*=n,t.qoffset_y*=n,t.qoffset_z*=n)}(t,n);var r=n.scl_inter,i=0===n.scl_slope?1:n.scl_slope,c=0==n.cal_max-n.cal_min,d=c?void 0:n.cal_min,h=c?void 0:n.cal_max,f=n.dims.slice(1,4),p=n.dims[0]>3?n.dims[4]:1,m={TypedArrayConstructor:a(t,n.datatypeCode),samplesPerPixel:l(n.dims),isDataInFloat:o(t,n.datatypeCode),isDataInColors:s(t,n.dims,n.datatypeCode)},g=n.pixDims.slice(1,4),v=function(e){if(e.affine&&e.sform_code>0)return e.affine;if(e.qform_code>0)return e.convertNiftiQFormToNiftiSForm(e.quatern_b,e.quatern_c,e.quatern_d,e.qoffset_x,e.qoffset_y,e.qoffset_z,e.pixDims[1],e.pixDims[2],e.pixDims[3],e.pixDims[0]);var t={x:e.pixDims[1],y:e.pixDims[2],z:e.pixDims[3]},n={x:-t.x*e.dims[1]/2,y:-t.y*e.dims[2]/2,z:-t.z*e.dims[3]/2};return[[t.x,0,0,n.x],[0,t.y,0,n.y],[0,0,t.z,n.z],[0,0,0,1]]}(n);return{slope:i,intercept:r,windowMinimumValue:d,windowMaximumValue:h,isWindowInfoAbsent:c,voxelLength:f,timeSlices:p,dataType:m,pixelSpacing:g,orientationMatrix:v,orientationString:n.convertNiftiSFormToNEMA(v),header:n}}function a(e,t){var n;return(n={},r(n,e.NIFTI1.TYPE_UINT8,Uint8Array),r(n,e.NIFTI1.TYPE_UINT16,Uint16Array),r(n,e.NIFTI1.TYPE_UINT32,Uint32Array),r(n,e.NIFTI1.TYPE_INT8,Int8Array),r(n,e.NIFTI1.TYPE_INT16,Int16Array),r(n,e.NIFTI1.TYPE_INT32,Int32Array),r(n,e.NIFTI1.TYPE_FLOAT32,Float32Array),r(n,e.NIFTI1.TYPE_FLOAT64,Float64Array),r(n,e.NIFTI1.TYPE_RGB,Uint8Array),r(n,e.NIFTI1.TYPE_RGBA,Uint8Array),n)[t]}function o(e,t){var n;return(n={},r(n,e.NIFTI1.TYPE_UINT8,!1),r(n,e.NIFTI1.TYPE_UINT16,!1),r(n,e.NIFTI1.TYPE_UINT32,!1),r(n,e.NIFTI1.TYPE_INT8,!1),r(n,e.NIFTI1.TYPE_INT16,!1),r(n,e.NIFTI1.TYPE_INT32,!1),r(n,e.NIFTI1.TYPE_FLOAT32,!0),r(n,e.NIFTI1.TYPE_FLOAT64,!0),r(n,e.NIFTI1.TYPE_RGB,!1),r(n,e.NIFTI1.TYPE_RGBA,!1),n)[t]}function s(e,t,n){var i,a=l(t);return(i={},r(i,e.NIFTI1.TYPE_UINT8,!1),r(i,e.NIFTI1.TYPE_UINT16,!1),r(i,e.NIFTI1.TYPE_UINT32,!1),r(i,e.NIFTI1.TYPE_INT8,!1),r(i,e.NIFTI1.TYPE_INT16,!1),r(i,e.NIFTI1.TYPE_INT32,!1),r(i,e.NIFTI1.TYPE_FLOAT32,!1),r(i,e.NIFTI1.TYPE_FLOAT64,!1),r(i,e.NIFTI1.TYPE_RGB,3===a),r(i,e.NIFTI1.TYPE_RGBA,4===a),i)[n]}function l(e){return e[0]>=5?e[5]:1}Object.defineProperty(t,"__esModule",{value:!0}),t.parseNiftiHeader=i,t.parseNiftiFile=function(e,t){var n=u.external.niftiReader;t||(t=i(e));var r=new(0,t.dataType.TypedArrayConstructor)(n.readImage(t.header,e));return t.header.littleEndian||(r=(0,c.default)(t.header.datatypeCode,r)),{metaData:t,imageData:r}};var u=n(1),c=function(e){return e&&e.__esModule?e:{default:e}}(n(66))},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(17)),a=n(42),o=r(n(56)),s=r(n(67)),l=r(n(8)),u=r(n(90)),c=r(n(14)),d={headers:{}},h={loadImage:function(e){var t=void 0;try{var n=l.default.fromURL(e),r=o.default.getInstance(d.headers);c.default.imageLoadStart(n),t=r.acquire(n).then((function(e){return e.slice(n)})).then((function(e){return i.default.add(n.url,e.compoundMetaData),c.default.imageLoadEnd(n),e.cornerstoneImageObject}))}catch(e){t=Promise.reject(e)}return(t=(0,u.default)(t)).promise=t,t},loadVolumeTimepoint:function(e){var t=void 0;try{var n=l.default.fromURL(e),r=s.default.getInstance(d.headers);c.default.imageLoadStart(n),t=r.acquireTimepoint(n).then((function(e){return e.slice(n)})).then((function(e){return i.default.add(n.url,e.compoundMetaData),c.default.imageLoadEnd(n),e.cornerstoneImageObject}))}catch(e){t=Promise.reject(e)}return(t=(0,u.default)(t)).promise=t,t},loadHeader:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=void 0;try{var r=l.default.fromURL(e);n=s.default.getInstance(d.headers).acquireHeaderOnly(r,t).then((function(e){return e.slice(r)})).then((function(e){return i.default.add(r.url,e.compoundMetaData),e.compoundMetaData}))}catch(e){n=Promise.reject(e)}return(n=(0,u.default)(n)).promise=n,n},ImageId:l.default,streamingMode:!1,cornerstoneLoader:function(e){return this.streamingMode?this.loadVolumeTimepoint(e):this.loadImage(e)},register:function(e){var t=this;e.registerImageLoader("nifti",(function(e){return t.cornerstoneLoader(e,t)})),e.metaData.addProvider(a.metaDataProvider,1e4)},configure:function(e){Object.assign(d,e)}};t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=[];t.default={add:function(e,t){r[e]=t},get:function(e){return r[e]},remove:function(e){r[e]=void 0},purge:function(){r=[]}}},function(e,t,n){"use strict";var r=r||{};r.Utils=r.Utils||n(12),r.NIFTI1=r.NIFTI1||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.isHDR=!1,this.extensionFlag=[0,0,0,0],this.extensionSize=0,this.extensionCode=0},r.NIFTI1.TYPE_NONE=0,r.NIFTI1.TYPE_BINARY=1,r.NIFTI1.TYPE_UINT8=2,r.NIFTI1.TYPE_INT16=4,r.NIFTI1.TYPE_INT32=8,r.NIFTI1.TYPE_FLOAT32=16,r.NIFTI1.TYPE_COMPLEX64=32,r.NIFTI1.TYPE_FLOAT64=64,r.NIFTI1.TYPE_RGB24=128,r.NIFTI1.TYPE_INT8=256,r.NIFTI1.TYPE_UINT16=512,r.NIFTI1.TYPE_UINT32=768,r.NIFTI1.TYPE_INT64=1024,r.NIFTI1.TYPE_UINT64=1280,r.NIFTI1.TYPE_FLOAT128=1536,r.NIFTI1.TYPE_COMPLEX128=1792,r.NIFTI1.TYPE_COMPLEX256=2048,r.NIFTI1.XFORM_UNKNOWN=0,r.NIFTI1.XFORM_SCANNER_ANAT=1,r.NIFTI1.XFORM_ALIGNED_ANAT=2,r.NIFTI1.XFORM_TALAIRACH=3,r.NIFTI1.XFORM_MNI_152=4,r.NIFTI1.SPATIAL_UNITS_MASK=7,r.NIFTI1.TEMPORAL_UNITS_MASK=56,r.NIFTI1.UNITS_UNKNOWN=0,r.NIFTI1.UNITS_METER=1,r.NIFTI1.UNITS_MM=2,r.NIFTI1.UNITS_MICRON=3,r.NIFTI1.UNITS_SEC=8,r.NIFTI1.UNITS_MSEC=16,r.NIFTI1.UNITS_USEC=24,r.NIFTI1.UNITS_HZ=32,r.NIFTI1.UNITS_PPM=40,r.NIFTI1.UNITS_RADS=48,r.NIFTI1.MAGIC_COOKIE=348,r.NIFTI1.STANDARD_HEADER_SIZE=348,r.NIFTI1.MAGIC_NUMBER_LOCATION=344,r.NIFTI1.MAGIC_NUMBER=[110,43,49],r.NIFTI1.MAGIC_NUMBER2=[110,105,49],r.NIFTI1.EXTENSION_HEADER_SIZE=8,r.NIFTI1.prototype.readHeader=function(e){var t,n,i,a=new DataView(e),o=r.Utils.getIntAt(a,0,this.littleEndian);if(o!==r.NIFTI1.MAGIC_COOKIE&&(this.littleEndian=!0,o=r.Utils.getIntAt(a,0,this.littleEndian)),o!==r.NIFTI1.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=r.Utils.getByteAt(a,39),t=0;t<8;t+=1)this.dims[t]=r.Utils.getShortAt(a,40+2*t,this.littleEndian);for(this.intent_p1=r.Utils.getFloatAt(a,56,this.littleEndian),this.intent_p2=r.Utils.getFloatAt(a,60,this.littleEndian),this.intent_p3=r.Utils.getFloatAt(a,64,this.littleEndian),this.intent_code=r.Utils.getShortAt(a,68,this.littleEndian),this.datatypeCode=r.Utils.getShortAt(a,70,this.littleEndian),this.numBitsPerVoxel=r.Utils.getShortAt(a,72,this.littleEndian),this.slice_start=r.Utils.getShortAt(a,74,this.littleEndian),t=0;t<8;t+=1)this.pixDims[t]=r.Utils.getFloatAt(a,76+4*t,this.littleEndian);for(this.vox_offset=r.Utils.getFloatAt(a,108,this.littleEndian),this.scl_slope=r.Utils.getFloatAt(a,112,this.littleEndian),this.scl_inter=r.Utils.getFloatAt(a,116,this.littleEndian),this.slice_end=r.Utils.getShortAt(a,120,this.littleEndian),this.slice_code=r.Utils.getByteAt(a,122),this.xyzt_units=r.Utils.getByteAt(a,123),this.cal_max=r.Utils.getFloatAt(a,124,this.littleEndian),this.cal_min=r.Utils.getFloatAt(a,128,this.littleEndian),this.slice_duration=r.Utils.getFloatAt(a,132,this.littleEndian),this.toffset=r.Utils.getFloatAt(a,136,this.littleEndian),this.description=r.Utils.getStringAt(a,148,228),this.aux_file=r.Utils.getStringAt(a,228,252),this.qform_code=r.Utils.getShortAt(a,252,this.littleEndian),this.sform_code=r.Utils.getShortAt(a,254,this.littleEndian),this.quatern_b=r.Utils.getFloatAt(a,256,this.littleEndian),this.quatern_c=r.Utils.getFloatAt(a,260,this.littleEndian),this.quatern_d=r.Utils.getFloatAt(a,264,this.littleEndian),this.qoffset_x=r.Utils.getFloatAt(a,268,this.littleEndian),this.qoffset_y=r.Utils.getFloatAt(a,272,this.littleEndian),this.qoffset_z=r.Utils.getFloatAt(a,276,this.littleEndian),n=0;n<3;n+=1)for(i=0;i<4;i+=1)this.affine[n][i]=r.Utils.getFloatAt(a,280+4*(4*n+i),this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=r.Utils.getStringAt(a,328,344),this.magic=r.Utils.getStringAt(a,344,348),this.isHDR=this.magic===r.NIFTI1.MAGIC_NUMBER2,a.byteLength>r.NIFTI1.MAGIC_COOKIE&&(this.extensionFlag[0]=r.Utils.getByteAt(a,348),this.extensionFlag[1]=r.Utils.getByteAt(a,349),this.extensionFlag[2]=r.Utils.getByteAt(a,350),this.extensionFlag[3]=r.Utils.getByteAt(a,351),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(a),this.extensionCode=this.getExtensionCode(a)))},r.NIFTI1.prototype.toFormattedString=function(){var e=r.Utils.formatNumber,t="";return t+="Dim Info = "+this.dim_info+"\n",t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",t+="Intent Code = "+this.intent_code+"\n",t+="Datatype = "+this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",t+="Bits Per Voxel = "+this.numBitsPerVoxel+"\n",t+="Slice Start = "+this.slice_start+"\n",t+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+"\n",t+="Image Offset = "+this.vox_offset+"\n",t+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+"\n",t+="Slice End = "+this.slice_end+"\n",t+="Slice Code = "+this.slice_code+"\n",t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(r.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(r.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",t+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+"\n",t+="Slice Duration = "+this.slice_duration+"\n",t+="Time Axis Shift = "+this.toffset+"\n",t+='Description: "'+this.description+'"\n',t+='Auxiliary File: "'+this.aux_file+'"\n',t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",t+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+"\n",t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",t+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+"\n",t+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+"\n",t+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+"\n",t+='Intent Name: "'+this.intent_name+'"\n',this.extensionFlag[0]&&(t+="Extension: Size = "+this.extensionSize+"  Code = "+this.extensionCode+"\n"),t},r.NIFTI1.prototype.getDatatypeCodeString=function(e){return e===r.NIFTI1.TYPE_UINT8?"1-Byte Unsigned Integer":e===r.NIFTI1.TYPE_INT16?"2-Byte Signed Integer":e===r.NIFTI1.TYPE_INT32?"4-Byte Signed Integer":e===r.NIFTI1.TYPE_FLOAT32?"4-Byte Float":e===r.NIFTI1.TYPE_FLOAT64?"8-Byte Float":e===r.NIFTI1.TYPE_RGB24?"RGB":e===r.NIFTI1.TYPE_INT8?"1-Byte Signed Integer":e===r.NIFTI1.TYPE_UINT16?"2-Byte Unsigned Integer":e===r.NIFTI1.TYPE_UINT32?"4-Byte Unsigned Integer":e===r.NIFTI1.TYPE_INT64?"8-Byte Signed Integer":e===r.NIFTI1.TYPE_UINT64?"8-Byte Unsigned Integer":"Unknown"},r.NIFTI1.prototype.getTransformCodeString=function(e){return e===r.NIFTI1.XFORM_SCANNER_ANAT?"Scanner":e===r.NIFTI1.XFORM_ALIGNED_ANAT?"Aligned":e===r.NIFTI1.XFORM_TALAIRACH?"Talairach":e===r.NIFTI1.XFORM_MNI_152?"MNI":"Unknown"},r.NIFTI1.prototype.getUnitsCodeString=function(e){return e===r.NIFTI1.UNITS_METER?"Meters":e===r.NIFTI1.UNITS_MM?"Millimeters":e===r.NIFTI1.UNITS_MICRON?"Microns":e===r.NIFTI1.UNITS_SEC?"Seconds":e===r.NIFTI1.UNITS_MSEC?"Milliseconds":e===r.NIFTI1.UNITS_USEC?"Microseconds":e===r.NIFTI1.UNITS_HZ?"Hz":e===r.NIFTI1.UNITS_PPM?"PPM":e===r.NIFTI1.UNITS_RADS?"Rads":"Unknown"},r.NIFTI1.prototype.getQformMat=function(){return this.convertNiftiQFormToNiftiSForm(this.quatern_b,this.quatern_c,this.quatern_d,this.qoffset_x,this.qoffset_y,this.qoffset_z,this.pixDims[1],this.pixDims[2],this.pixDims[3],this.pixDims[0])},r.NIFTI1.prototype.convertNiftiQFormToNiftiSForm=function(e,t,n,r,i,a,o,s,l,u){var c,d,h,f,p=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],m=e,g=t,v=n;return p[3][0]=p[3][1]=p[3][2]=0,p[3][3]=1,(c=1-(m*m+g*g+v*v))<1e-7?(m*=c=1/Math.sqrt(m*m+g*g+v*v),g*=c,v*=c,c=0):c=Math.sqrt(c),h=s>0?s:1,f=l>0?l:1,u<0&&(f=-f),p[0][0]=(c*c+m*m-g*g-v*v)*(d=o>0?o:1),p[0][1]=2*(m*g-c*v)*h,p[0][2]=2*(m*v+c*g)*f,p[1][0]=2*(m*g+c*v)*d,p[1][1]=(c*c+g*g-m*m-v*v)*h,p[1][2]=2*(g*v-c*m)*f,p[2][0]=2*(m*v-c*g)*d,p[2][1]=2*(g*v+c*m)*h,p[2][2]=(c*c+v*v-g*g-m*m)*f,p[0][3]=r,p[1][3]=i,p[2][3]=a,p},r.NIFTI1.prototype.convertNiftiSFormToNEMA=function(e){var t,n,r,i,a,o,s,l,u,c,d,h,f,p,m,g,v,y,b,x,w,_,S,E,T,k,C,I,O,A,D,M,N;if(p=0,k=[[0,0,0],[0,0,0],[0,0,0]],C=[[0,0,0],[0,0,0],[0,0,0]],t=e[0][0],n=e[0][1],r=e[0][2],i=e[1][0],a=e[1][1],o=e[1][2],s=e[2][0],l=e[2][1],u=e[2][2],0===(c=Math.sqrt(t*t+i*i+s*s)))return null;if(t/=c,i/=c,s/=c,0===(c=Math.sqrt(n*n+a*a+l*l)))return null;if(c=t*(n/=c)+i*(a/=c)+s*(l/=c),Math.abs(c)>1e-4){if(n-=c*t,a-=c*i,l-=c*s,0===(c=Math.sqrt(n*n+a*a+l*l)))return null;n/=c,a/=c,l/=c}if(0===(c=Math.sqrt(r*r+o*o+u*u))?(r=i*l-s*a,o=s*n-l*t,u=t*a-i*n):(r/=c,o/=c,u/=c),c=t*r+i*o+s*u,Math.abs(c)>1e-4){if(r-=c*t,o-=c*i,u-=c*s,0===(c=Math.sqrt(r*r+o*o+u*u)))return null;r/=c,o/=c,u/=c}if(c=n*r+a*o+l*u,Math.abs(c)>1e-4){if(r-=c*n,o-=c*a,u-=c*l,0===(c=Math.sqrt(r*r+o*o+u*u)))return null;r/=c,o/=c,u/=c}if(k[0][0]=t,k[0][1]=n,k[0][2]=r,k[1][0]=i,k[1][1]=a,k[1][2]=o,k[2][0]=s,k[2][1]=l,k[2][2]=u,0===(d=this.nifti_mat33_determ(k)))return null;for(T=-666,y=w=_=S=1,b=2,x=3,h=1;h<=3;h+=1)for(f=1;f<=3;f+=1)if(h!==f)for(p=1;p<=3;p+=1)if(h!==p&&f!==p)for(C[0][0]=C[0][1]=C[0][2]=C[1][0]=C[1][1]=C[1][2]=C[2][0]=C[2][1]=C[2][2]=0,m=-1;m<=1;m+=2)for(g=-1;g<=1;g+=2)for(v=-1;v<=1;v+=2)C[0][h-1]=m,C[1][f-1]=g,C[2][p-1]=v,this.nifti_mat33_determ(C)*d>0&&(c=(E=this.nifti_mat33_mul(C,k))[0][0]+E[1][1]+E[2][2])>T&&(T=c,y=h,b=f,x=p,w=m,_=g,S=v);switch(I=O=A=D=M=N=0,y*w){case 1:I="X",D="+";break;case-1:I="X",D="-";break;case 2:I="Y",D="+";break;case-2:I="Y",D="-";break;case 3:I="Z",D="+";break;case-3:I="Z",D="-"}switch(b*_){case 1:O="X",M="+";break;case-1:O="X",M="-";break;case 2:O="Y",M="+";break;case-2:O="Y",M="-";break;case 3:O="Z",M="+";break;case-3:O="Z",M="-"}switch(x*S){case 1:A="X",N="+";break;case-1:A="X",N="-";break;case 2:A="Y",N="+";break;case-2:A="Y",N="-";break;case 3:A="Z",N="+";break;case-3:A="Z",N="-"}return I+O+A+D+M+N},r.NIFTI1.prototype.nifti_mat33_mul=function(e,t){var n,r,i=[[0,0,0],[0,0,0],[0,0,0]];for(n=0;n<3;n+=1)for(r=0;r<3;r+=1)i[n][r]=e[n][0]*t[0][r]+e[n][1]*t[1][r]+e[n][2]*t[2][r];return i},r.NIFTI1.prototype.nifti_mat33_determ=function(e){var t,n,r,i,a,o,s,l,u;return(t=e[0][0])*(a=e[1][1])*(u=e[2][2])-t*(l=e[2][1])*(o=e[1][2])-(i=e[1][0])*(n=e[0][1])*u+i*l*(r=e[0][2])+(s=e[2][0])*n*o-s*a*r},r.NIFTI1.prototype.getExtensionLocation=function(){return r.NIFTI1.MAGIC_COOKIE+4},r.NIFTI1.prototype.getExtensionSize=function(e){return r.Utils.getIntAt(e,this.getExtensionLocation(),this.littleEndian)},r.NIFTI1.prototype.getExtensionCode=function(e){return r.Utils.getIntAt(e,this.getExtensionLocation()+4,this.littleEndian)},void 0!==e&&e.exports&&(e.exports=r.NIFTI1)},function(e,t,n){"use strict";var r={};(0,n(2).assign)(r,n(47),n(50),n(24)),e.exports=r},function(e,t,n){"use strict";e.exports=function(e,t,n,r){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{a=a+(i=i+t[r++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,i){var a=r,o=i+n;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},function(e,t,n){"use strict";function r(e,t){if(t<65537&&(e.subarray&&o||!e.subarray&&a))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n}var i=n(2),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var s=new i.Buf8(256),l=0;l<256;l++)s[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;s[254]=s[254]=1,t.string2buf=function(e){var t,n,r,a,o,s=e.length,l=0;for(a=0;a<s;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new i.Buf8(l),o=0,a=0;o<l;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},t.buf2binstring=function(e){return r(e,e.length)},t.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,i,a,o,l=t||e.length,u=new Array(2*l);for(i=0,n=0;n<l;)if((a=e[n++])<128)u[i++]=a;else if((o=s[a])>4)u[i++]=65533,n+=o-1;else{for(a&=2===o?31:3===o?15:7;o>1&&n<l;)a=a<<6|63&e[n++],o--;o>1?u[i++]=65533:a<65536?u[i++]=a:(u[i++]=55296|(a-=65536)>>10&1023,u[i++]=56320|1023&a)}return r(u,i)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+s[e[n]]>t?n:t}},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=r(n(57)),s=r(n(9)),l=Symbol("convertToNeurologicalView"),u=Symbol("ensureVoxelStorageInXYZ"),c=Symbol("changeVoxelStorageOrder"),d=Symbol("convertRAStoLPS"),h=function(){function e(t,n,r,a){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];i(this,e),this.imageIdObject=t,this.metaData=n,this.imageDataNDarray=r,this.floatImageDataNDarray=a,this.isSingleTimepoint=o,this[u](),this[l](),this[d]()}return a(e,[{key:u,value:function(){for(var e=this.metaData.orientationString.slice(0,3),t=new Array(3).fill(0),n={X:0,Y:1,Z:2},r=!0,i=0;i<e.length;i++){var a=e[i];if(!(a in n)){r=!1;break}t[n[a]]=i}r?"XYZ"!==e&&this[c](t):console.info("The NIfTI file "+this.imageIdObject.filePath+" has its\n        voxel values stored in "+e+" order in the file,\n        which is a rare orientation unsupported by the viewer. Hence,\n        the viewer is not doing auto flipping to match the neurological view.")}},{key:c,value:function(e){var t,n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(e,3),r=n[0],i=n[1],a=n[2];this.hasImageData&&(this.imageDataNDarray=this.imageDataNDarray.transpose(r,i,a,3),this.floatImageDataNDarray&&(this.floatImageDataNDarray=this.floatImageDataNDarray.transpose(r,i,a,3))),this.metaData.voxelLength=[this.metaData.voxelLength[r],this.metaData.voxelLength[i],this.metaData.voxelLength[a]];var o=this.metaData.orientationMatrix,l=JSON.parse(JSON.stringify(o)),u=(0,s.default)((t=[]).concat.apply(t,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(l)),[4,4]).transpose(1,0),c=[u.pick(0,null),u.pick(1,null),u.pick(2,null),u.pick(3,null)];o[0]=[c[r].get(0),c[r].get(1),c[r].get(2),c[3].get(r)],o[1]=[c[i].get(0),c[i].get(1),c[i].get(2),-c[3].get(i)],o[2]=[c[a].get(0),c[a].get(1),c[a].get(2),-c[3].get(a)],this.metaData.pixelSpacing=[this.metaData.pixelSpacing[r],this.metaData.pixelSpacing[i],this.metaData.pixelSpacing[a]].slice(0);var d=this.metaData.orientationString.slice(3,6);d=[d[r],d[i],d[a]].join(""),this.metaData.orientationString="XYZ"+d}},{key:l,value:function(){var e,t,n=this.metaData.orientationMatrix,r=this.metaData.orientationString.slice(3,6),i=[1,1,1];"XYZ"===this.metaData.orientationString.slice(0,3)&&("-"===r[0]&&(n[0][0]*=-1,n[0][1]*=-1,n[0][2]*=-1,n[0][3]*=-1,i[0]=-1),"+"===r[1]&&(n[1][0]*=-1,n[1][1]*=-1,n[1][2]*=-1,n[1][3]*=-1,i[1]=-1),"+"===r[2]&&(n[2][0]*=-1,n[2][1]*=-1,n[2][2]*=-1,n[2][3]*=-1,i[2]=-1)),this.hasImageData&&(this.imageDataNDarray=(e=this.imageDataNDarray).step.apply(e,i.concat([1])),this.floatImageDataNDarray&&(this.floatImageDataNDarray=(t=this.floatImageDataNDarray).step.apply(t,i.concat([1]))))}},{key:d,value:function(){var e=this.metaData.orientationMatrix;e[0][0]*=-1,e[0][1]*=-1,e[0][2]*=-1,e[0][3]*=-1,e[1][0]*=-1,e[1][1]*=-1,e[1][2]*=-1,e[1][3]*=-1}},{key:"slice",value:function(e){return new o.default(this,e,this.isSingleTimepoint)}},{key:"hasImageData",get:function(){return this.imageDataNDarray&&this.imageDataNDarray.data&&this.imageDataNDarray.data.byteLength>0}},{key:"sizeInBytes",get:function(){return(this.imageDataNDarray?this.imageDataNDarray.data.byteLength:0)+(this.floatImageDataView?this.floatImageDataView.data.byteLength:0)}}]),e}();t.default=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e),this.volumeEntries={},this.cacheUses=0}return i(e,[{key:"add",value:function(e,t){this.volumeEntries[e.filePath]=new o(t)}},{key:"addTimepoint",value:function(e,t,n){this.volumeEntries[e.filePath+"-t"+t]=new o(n)}},{key:"get",value:function(e){var t=this.volumeEntries[e.filePath];if(t)return t.lastUseIndex=this.cacheUses++,t.volume}},{key:"getTimepoint",value:function(e,t){var n=this.volumeEntries[e.filePath+"-t"+t];if(n)return n.lastUseIndex=this.cacheUses++,n.volume}}]),e}();t.default=a;var o=function e(t){r(this,e),this.volume=t,this.sizeInBytes=t.sizeInBytes,this.lastUseIndex=-1}},function(e,t,n){"use strict";function r(e,t,n){return(e-n)/t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var n=Math.pow(2,16)-1,a=t.minPixelValue,o=t.maxPixelValue-a,s=0===o?1:o/n,l=a,u=(0,i.default)(new Uint16Array(e.data.length),e.shape,e.stride,e.offset),c=0;c<e.shape[3];c++)for(var d=0;d<e.shape[2];d++)for(var h=0;h<e.shape[1];h++)for(var f=0;f<e.shape[0];f++){var p=e.get(f,h,d,c);p=r(p,s,l),u.set(f,h,d,c,Math.floor(p))}return{convertedImageDataView:u,floatImageDataView:e,metaData:{slope:s,intercept:l,minPixelValue:Math.floor(r(t.minPixelValue,s,l)),maxPixelValue:Math.floor(r(t.maxPixelValue,s,l)),dataType:{TypedArrayConstructor:Uint16Array,OriginalTypedArrayConstructor:t.dataType.TypedArrayConstructor,isDataInFloat:!0,isDataInColors:t.dataType.isDataInColors}}}};var i=function(e){return e&&e.__esModule?e:{default:e}}(n(9))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=e.get(0,0,0,0),n=t,r=0;r<e.shape[3];r++)for(var i=0;i<e.shape[2];i++)for(var a=0;a<e.shape[1];a++)for(var o=0;o<e.shape[0];o++){var s=e.get(o,a,i,r);s<t?t=s:s>n&&(n=s)}return{min:t,max:n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.length,r=new Uint8Array(n+t.length);return r.set(e),r.set(t,n),r}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){(function(e){function n(){if(void 0!==a)return a;if(e.XMLHttpRequest){a=new e.XMLHttpRequest;try{a.open("GET",e.XDomainRequest?"/":"https://example.com")}catch(e){a=null}}else a=null;return a}function r(e){var t=n();if(!t)return!1;try{return t.responseType=e,t.responseType===e}catch(e){}return!1}function i(e){return"function"==typeof e}t.fetch=i(e.fetch)&&i(e.ReadableStream),t.writableStream=i(e.WritableStream),t.abortController=i(e.AbortController),t.blobConstructor=!1;try{new Blob([new ArrayBuffer(1)]),t.blobConstructor=!0}catch(e){}var a,o=void 0!==e.ArrayBuffer,s=o&&i(e.ArrayBuffer.prototype.slice);t.arraybuffer=t.fetch||o&&r("arraybuffer"),t.msstream=!t.fetch&&s&&r("ms-stream"),t.mozchunkedarraybuffer=!t.fetch&&o&&r("moz-chunked-arraybuffer"),t.overrideMimeType=t.fetch||!!n()&&i(n().overrideMimeType),t.vbArray=i(e.VBArray),a=null}).call(t,n(0))},function(e,t,n){(function(e,r,i){var a=n(31),o=n(3),s=n(33),l=t.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},u=t.IncomingMessage=function(t,n,i){var o=this;if(s.Readable.call(o),o._mode=i,o.headers={},o.rawHeaders=[],o.trailers={},o.rawTrailers=[],o.on("end",(function(){e.nextTick((function(){o.emit("close")}))})),"fetch"===i){if(o._fetchResponse=n,o.url=n.url,o.statusCode=n.status,o.statusMessage=n.statusText,n.headers.forEach((function(e,t){o.headers[t.toLowerCase()]=e,o.rawHeaders.push(t,e)})),a.writableStream){var l=new WritableStream({write:function(e){return new Promise((function(t,n){o._destroyed||(o.push(new r(e))?t():o._resumeFetch=t)}))},close:function(){o._destroyed||o.push(null)},abort:function(e){o._destroyed||o.emit("error",e)}});try{return void n.body.pipeTo(l)}catch(e){}}var u=n.body.getReader();!function e(){u.read().then((function(t){if(!o._destroyed){if(t.done)return void o.push(null);o.push(new r(t.value)),e()}})).catch((function(e){o._destroyed||o.emit("error",e)}))}()}else if(o._xhr=t,o._pos=0,o.url=t.responseURL,o.statusCode=t.status,o.statusMessage=t.statusText,t.getAllResponseHeaders().split(/\r?\n/).forEach((function(e){var t=e.match(/^([^:]+):\s*(.*)/);if(t){var n=t[1].toLowerCase();"set-cookie"===n?(void 0===o.headers[n]&&(o.headers[n]=[]),o.headers[n].push(t[2])):void 0!==o.headers[n]?o.headers[n]+=", "+t[2]:o.headers[n]=t[2],o.rawHeaders.push(t[1],t[2])}})),o._charset="x-user-defined",!a.overrideMimeType){var c=o.rawHeaders["mime-type"];if(c){var d=c.match(/;\s*charset=([^;])(;|$)/);d&&(o._charset=d[1].toLowerCase())}o._charset||(o._charset="utf-8")}};o(u,s.Readable),u.prototype._read=function(){var e=this._resumeFetch;e&&(this._resumeFetch=null,e())},u.prototype._onXHRProgress=function(){var e=this,t=e._xhr,n=null;switch(e._mode){case"text:vbarray":if(t.readyState!==l.DONE)break;try{n=new i.VBArray(t.responseBody).toArray()}catch(e){}if(null!==n){e.push(new r(n));break}case"text":try{n=t.responseText}catch(t){e._mode="text:vbarray";break}if(n.length>e._pos){var a=n.substr(e._pos);if("x-user-defined"===e._charset){for(var o=new r(a.length),s=0;s<a.length;s++)o[s]=255&a.charCodeAt(s);e.push(o)}else e.push(a,e._charset);e._pos=n.length}break;case"arraybuffer":if(t.readyState!==l.DONE||!t.response)break;n=t.response,e.push(new r(new Uint8Array(n)));break;case"moz-chunked-arraybuffer":if(n=t.response,t.readyState!==l.LOADING||!n)break;e.push(new r(new Uint8Array(n)));break;case"ms-stream":if(n=t.response,t.readyState!==l.LOADING)break;var u=new i.MSStreamReader;u.onprogress=function(){u.result.byteLength>e._pos&&(e.push(new r(new Uint8Array(u.result.slice(e._pos)))),e._pos=u.result.byteLength)},u.onload=function(){e.push(null)},u.readAsArrayBuffer(n)}e._xhr.readyState===l.DONE&&"ms-stream"!==e._mode&&e.push(null)}}).call(t,n(4),n(6).Buffer,n(0))},function(e,t,n){(t=e.exports=n(34)).Stream=t,t.Readable=t,t.Writable=n(38),t.Duplex=n(5),t.Transform=n(40),t.PassThrough=n(79)},function(e,t,n){"use strict";(function(t,r){function i(e,t){w=w||n(5),this.objectMode=!!(e=e||{}).objectMode,t instanceof w&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark;this.highWaterMark=r||0===r?r:this.objectMode?16:16384,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new D,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(A||(A=n(39).StringDecoder),this.decoder=new A(e.encoding),this.encoding=e.encoding)}function a(e){if(w=w||n(5),!(this instanceof a))return new a(e);this._readableState=new i(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),E.call(this)}function o(e,t,n,r,i){var a,o=e._readableState;return null===t?(o.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,u(e)}}(e,o)):(i||(a=function(e,t){var n;return function(e){return T.isBuffer(e)||e instanceof k}(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(o,t)),a?e.emit("error",a):o.objectMode||t&&t.length>0?("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===T.prototype||(t=function(e){return T.from(e)}(t)),r?o.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):s(e,o,t,!0):o.ended?e.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!n?(t=o.decoder.write(t),o.objectMode||0!==t.length?s(e,o,t,!1):d(e,o)):s(e,o,t,!1))):r||(o.reading=!1)),function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(o)}function s(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&u(e)),d(e,t)}function l(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=j?e=j:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function u(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(O("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?x(c,e):c(e))}function c(e){O("emit readable"),e.emit("readable"),m(e)}function d(e,t){t.readingMore||(t.readingMore=!0,x(h,e,t))}function h(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(O("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function f(e){O("readable nexttick read 0"),e.read(0)}function p(e,t){t.reading||(O("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),m(e),t.flowing&&!t.reading&&e.read(0)}function m(e){var t=e._readableState;for(O("flow",t.flowing);t.flowing&&null!==e.read(););}function g(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var a=n.data,o=e>a.length?a.length:e;if(i+=o===a.length?a:a.slice(0,e),0==(e-=o)){o===a.length?(++r,t.head=n.next?n.next:t.tail=null):(t.head=n,n.data=a.slice(o));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=T.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var a=r.data,o=e>a.length?a.length:e;if(a.copy(n,n.length-e,0,o),0==(e-=o)){o===a.length?(++i,t.head=r.next?r.next:t.tail=null):(t.head=r,r.data=a.slice(o));break}++i}return t.length-=i,n}(e,t),r}(e,t.buffer,t.decoder),n);var n}function v(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,x(y,t,e))}function y(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function b(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}var x=n(10);e.exports=a;var w,_=n(30);a.ReadableState=i;var S=(n(35),function(e,t){return e.listeners(t).length}),E=n(36),T=n(11).Buffer,k=t.Uint8Array||function(){},C=n(7);C.inherits=n(3);var I=n(74),O=void 0;O=I&&I.debuglog?I.debuglog("stream"):function(){};var A,D=n(75),M=n(37);C.inherits(a,E);var N=["error","close","destroy","pause","resume"];Object.defineProperty(a.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),a.prototype.destroy=M.destroy,a.prototype._undestroy=M.undestroy,a.prototype._destroy=function(e,t){this.push(null),t(e)},a.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=T.from(e,t),t=""),n=!0),o(this,e,t,!1,n)},a.prototype.unshift=function(e){return o(this,e,null,!0,!1)},a.prototype.isPaused=function(){return!1===this._readableState.flowing},a.prototype.setEncoding=function(e){return A||(A=n(39).StringDecoder),this._readableState.decoder=new A(e),this._readableState.encoding=e,this};var j=8388608;a.prototype.read=function(e){O("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return O("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?v(this):u(this),null;if(0===(e=l(e,t))&&t.ended)return 0===t.length&&v(this),null;var r,i=t.needReadable;return O("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&O("length less than watermark",i=!0),t.ended||t.reading?O("reading or ended",i=!1):i&&(O("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=l(n,t))),null===(r=e>0?g(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&v(this)),null!==r&&this.emit("data",r),r},a.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},a.prototype.pipe=function(e,t){function n(e,t){O("onunpipe"),e===d&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,a())}function i(){O("onend"),e.end()}function a(){O("cleanup"),e.removeListener("close",l),e.removeListener("finish",u),e.removeListener("drain",p),e.removeListener("error",s),e.removeListener("unpipe",n),d.removeListener("end",i),d.removeListener("end",c),d.removeListener("data",o),g=!0,!h.awaitDrain||e._writableState&&!e._writableState.needDrain||p()}function o(t){O("ondata"),v=!1,!1!==e.write(t)||v||((1===h.pipesCount&&h.pipes===e||h.pipesCount>1&&-1!==b(h.pipes,e))&&!g&&(O("false write response, pause",d._readableState.awaitDrain),d._readableState.awaitDrain++,v=!0),d.pause())}function s(t){O("onerror",t),c(),e.removeListener("error",s),0===S(e,"error")&&e.emit("error",t)}function l(){e.removeListener("finish",u),c()}function u(){O("onfinish"),e.removeListener("close",l),c()}function c(){O("unpipe"),d.unpipe(e)}var d=this,h=this._readableState;switch(h.pipesCount){case 0:h.pipes=e;break;case 1:h.pipes=[h.pipes,e];break;default:h.pipes.push(e)}h.pipesCount+=1,O("pipe count=%d opts=%j",h.pipesCount,t);var f=t&&!1===t.end||e===r.stdout||e===r.stderr?c:i;h.endEmitted?x(f):d.once("end",f),e.on("unpipe",n);var p=function(e){return function(){var t=e._readableState;O("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&S(e,"data")&&(t.flowing=!0,m(e))}}(d);e.on("drain",p);var g=!1,v=!1;return d.on("data",o),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?_(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",s),e.once("close",l),e.once("finish",u),e.emit("pipe",d),h.flowing||(O("pipe resume"),d.resume()),e},a.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)r[a].emit("unpipe",this,n);return this}var o=b(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},a.prototype.addListener=a.prototype.on=function(e,t){var n=E.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&u(this):x(f,this))}return n},a.prototype.resume=function(){var e=this._readableState;return e.flowing||(O("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,x(p,e,t))}(this,e)),this},a.prototype.pause=function(){return O("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(O("pause"),this._readableState.flowing=!1,this.emit("pause")),this},a.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;for(var i in e.on("end",(function(){if(O("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)})),e.on("data",(function(i){O("wrapped data"),t.decoder&&(i=t.decoder.write(i)),t.objectMode&&null==i||!(t.objectMode||i&&i.length)||r.push(i)||(n=!0,e.pause())})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var a=0;a<N.length;a++)e.on(N[a],r.emit.bind(r,N[a]));return r._read=function(t){O("wrapped _read",t),n&&(n=!1,e.resume())},r},a._fromList=g}).call(t,n(0),n(4))},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,o,s,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(a(n=this._events[e]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(i(n))for(s=Array.prototype.slice.call(arguments,1),o=(u=n.slice()).length,l=0;l<o;l++)u[l].apply(this,s);return!0},n.prototype.on=n.prototype.addListener=function(e,t){var o;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(o=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,a,o,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(n=this._events[e]).length,a=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(s=o;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){a=s;break}if(a<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){e.exports=n(35).EventEmitter},function(e,t,n){"use strict";function r(e,t){e.emit("error",t)}var i=n(10);e.exports={destroy:function(e,t){var n=this;this._readableState&&this._readableState.destroyed||this._writableState&&this._writableState.destroyed?t?t(e):!e||this._writableState&&this._writableState.errorEmitted||i(r,this,e):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(i(r,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})))},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){"use strict";(function(t,r,i){function a(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(undefined),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}function o(){}function s(e,t){g=g||n(5),this.objectMode=!!(e=e||{}).objectMode,t instanceof g&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark;this.highWaterMark=r||0===r?r:this.objectMode?16:16384,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1,this.decodeStrings=!(!1===e.decodeStrings),this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(m(i,r),m(p,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(i(r),e._writableState.errorEmitted=!0,e.emit("error",r),p(e,t))}(e,n,r,t,i);else{var a=h(n);a||n.corked||n.bufferProcessing||!n.bufferedRequest||d(e,n),r?v(c,e,n,a,i):c(e,n,a,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function l(e){if(g=g||n(5),!(b.call(l,this)||this instanceof g))return new l(e);this._writableState=new s(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),w.call(this)}function u(e,t,n,r,i,a,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function c(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),p(e,t)}function d(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=new Array(t.bufferedRequestCount),i=t.corkedRequestsFree;i.entry=n;for(var o=0,s=!0;n;)r[o]=n,n.isBuf||(s=!1),n=n.next,o+=1;r.allBuffers=s,u(e,t,!0,t.length,r,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new a(t)}else{for(;n;){var l=n.chunk;if(u(e,t,!1,t.objectMode?1:l.length,l,n.encoding,n.callback),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function h(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function f(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),p(e,t)}))}function p(e,t){var n=h(t);return n&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,m(f,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}var m=n(10);e.exports=l;var g,v=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:m;l.WritableState=s;var y=n(7);y.inherits=n(3);var b,x={deprecate:n(78)},w=n(36),_=n(11).Buffer,S=i.Uint8Array||function(){},E=n(37);y.inherits(l,w),s.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(s.prototype,"buffer",{get:x.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(b=Function.prototype[Symbol.hasInstance],Object.defineProperty(l,Symbol.hasInstance,{value:function(e){return!!b.call(this,e)||e&&e._writableState instanceof s}})):b=function(e){return e instanceof this},l.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},l.prototype.write=function(e,t,n){var r=this._writableState,i=!1,a=function(e){return _.isBuffer(e)||e instanceof S}(e)&&!r.objectMode;return a&&!_.isBuffer(e)&&(e=function(e){return _.from(e)}(e)),"function"==typeof t&&(n=t,t=null),a?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=o),r.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),m(t,n)}(this,n):(a||function(e,t,n,r){var i=!0,a=!1;return null===n?a=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(e.emit("error",a),m(r,a),i=!1),i}(this,r,e,n))&&(r.pendingcb++,i=function(e,t,n,r,i,a){if(!n){var o=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=_.from(t,n)),t}(t,r,i);r!==o&&(n=!0,i="buffer",r=o)}var s=t.objectMode?1:r.length;t.length+=s;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:a,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else u(e,t,!1,s,r,i,a);return l}(this,r,a,e,t,n)),i},l.prototype.cork=function(){this._writableState.corked++},l.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||d(this,e))},l.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},l.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},l.prototype._writev=null,l.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,p(e,t),n&&(t.finished?m(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n)},Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),l.prototype.destroy=E.destroy,l.prototype._undestroy=E.undestroy,l.prototype._destroy=function(e,t){this.end(),t(e)}}).call(t,n(4),n(76).setImmediate,n(0))},function(e,t,n){"use strict";function r(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(h.isEncoding===f||!f(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=o,this.end=s,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=l,this.end=u,t=3;break;default:return this.write=c,void(this.end=d)}this.lastNeed=0,this.lastTotal=0,this.lastChar=h.allocUnsafe(t)}function i(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:-1}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"\ufffd".repeat(n);if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"\ufffd".repeat(n+1);if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"\ufffd".repeat(n+2)}}(this,e,t);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function o(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function s(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("utf16le",0,this.lastTotal-this.lastNeed):t}function l(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function u(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function c(e){return e.toString(this.encoding)}function d(e){return e&&e.length?this.write(e):""}var h=n(11).Buffer,f=h.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};t.StringDecoder=r,r.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},r.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\ufffd".repeat(this.lastTotal-this.lastNeed):t},r.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var a=i(t[r]);return a>=0?(a>0&&(e.lastNeed=a-1),a):--r<n?0:(a=i(t[r]))>=0?(a>0&&(e.lastNeed=a-2),a):--r<n?0:(a=i(t[r]))>=0?(a>0&&(2===a?a=0:e.lastNeed=a-3),a):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},r.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";function r(e){this.afterTransform=function(t,n){return function(e,t,n){var r=e._transformState;r.transforming=!1;var i=r.writecb;if(!i)return e.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=n&&e.push(n),i(t);var a=e._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&e._read(a.highWaterMark)}(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function i(e){if(!(this instanceof i))return new i(e);o.call(this,e),this._transformState=new r(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(e,n){a(t,e,n)})):a(t)}))}function a(e,t,n){if(t)return e.emit("error",t);null!=n&&e.push(n);var r=e._transformState;if(e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(r.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}e.exports=i;var o=n(5),s=n(7);s.inherits=n(3),s.inherits(i,o),i.prototype.push=function(e,t){return this._transformState.needTransform=!1,o.prototype.push.call(this,e,t)},i.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},i.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},i.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},i.prototype._destroy=function(e,t){var n=this;o.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(16);Object.defineProperty(t,"nifti",{enumerable:!0,get:function(){return function(e){return e&&e.__esModule?e:{default:e}}(r).default}});var i=n(1);Object.defineProperty(t,"external",{enumerable:!0,get:function(){return i.external}})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){var n=p.niftiReader,r=p.metaDataManager.get(t);if(r){var i=f.default.fromURL(t);switch(e){case"functional":return{frameOfReferenceUID:i.filePath,timeSlices:r.timeSlices};case"imagePlane":case"imagePlaneModule":return{frameOfReferenceUID:i.filePath,columns:r.columns,rows:r.rows,imageOrientationPatient:r.imageOrientationPatient,columnCosines:r.columnCosines,rowCosines:r.rowCosines,imagePositionPatient:r.imagePositionPatient,sliceThickness:r.slicePixelSpacing,columnPixelSpacing:r.columnPixelSpacing,rowPixelSpacing:r.rowPixelSpacing};case"imagePixel":case"imagePixelModule":return{samplesPerPixel:a(r),photometricInterpretation:o(r,n),rows:r.rows,columns:r.columns,bitsAllocated:r.header.numBitsPerVoxel,bitsStored:r.header.numBitsPerVoxel,highBit:r.header.numBitsPerVoxel-1,pixelRepresentation:s(r,n),planarConfiguration:l(r),pixelAspectRatio:u(r),smallestPixelValue:r.minPixelValue,largestPixelValue:r.maxPixelValue};case"modalityLut":case"modalityLutModule":return{rescaleIntercept:r.intercept,rescaleSlope:r.slope,rescaleType:"US",modalityLutSequence:void 0};case"voiLut":case"voiLutModule":return{windowCenter:r.windowCenter,windowWidth:r.windowWidth,voiLutSequence:void 0};case"multiFrame":case"multiFrameModule":return{numberOfFrames:r.numberOfFrames,frameIncrementPointer:void 0,stereoPairsPresent:"NO"};default:return}}}function a(e){return e.header.dims[0]>=5&&e.header.dims[5]>1?e.header.dims[5]:1}function o(e,t){var n=e.header.datatypeCode,r=a(e);return n===t.NIFTI1.TYPE_RGB&&3===r||n===t.NIFTI1.TYPE_RGBA&&4===r?"RGB":"MONOCHROME2"}function s(e,t){switch(e.header.datatypeCode){case t.NIFTI1.TYPE_UINT8:case t.NIFTI1.TYPE_UINT16:case t.NIFTI1.TYPE_UINT32:case t.NIFTI1.TYPE_UINT64:return"0000H";case t.NIFTI1.TYPE_INT8:case t.NIFTI1.TYPE_INT16:case t.NIFTI1.TYPE_INT32:case t.NIFTI1.TYPE_INT64:return"0001H";case t.NIFTI1.TYPE_FLOAT32:case t.NIFTI1.TYPE_FLOAT64:case t.NIFTI1.TYPE_RGB:case t.NIFTI1.TYPE_RGBA:return"0000H"}}function l(e){return a(e)>1?0:void 0}function u(e){var t=(0,p.decimalToFraction)(e.header.pixDims[2]/e.header.pixDims[1]);return t.numerator+"/"+t.denominator}Object.defineProperty(t,"__esModule",{value:!0}),t.metaDataProvider=i,t.metaDataProviderBuilder=function(e){var t=e.decimalToFraction,n=e.niftiReader;return p.metaDataManager=e.metaDataManager,p.decimalToFraction=t,p.niftiReader=n,i};var c=r(n(17)),d=n(43),h=n(1),f=r(n(8)),p={metaDataManager:c.default,decimalToFraction:d.decimalToFraction,niftiReader:h.external.niftiReader}},function(e,t,n){"use strict";function r(e){return e>0&&e%1>0&&e%1<1||e<0&&e%-1<0&&e%-1>-1}function i(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}function a(e,t){if(!("number"==typeof e||e instanceof Number)||!("number"==typeof t||t instanceof Number))throw new Error("Greatest common factor requires 2 numbers to compute. What was provided: "+e+" and "+t+".");e=Math.abs(e),t=Math.abs(t);for(var n=void 0;t;)n=e%t,e=t,t=n;return e}Object.defineProperty(t,"__esModule",{value:!0});var o=function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.numerator=t,this.denominator=n};t.decimalToFraction=function(e){if("number"!=typeof e||e instanceof Number)throw new Error("The provided argument ("+e+") is not a number.");var t=new o(e,1);if(r(e)){var n=i(e,9),s=Math.pow(10,n.toString().split(".")[1].length);t.numerator=Math.round(t.numerator*s),t.denominator*=s}var l=a(t.numerator,t.denominator);return t.numerator/=l,t.denominator/=l,t},t.hasDecimalPoint=r,t.roundToPlaces=i,t.gcf=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enhancedNiftiReader=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(n(45)).default,i=[r.NIFTI1,r.NIFTI2];!function(e){e.NIFTI1.prototype.readHeader=function(t){var n=new DataView(t),r=e.Utils.getIntAt(n,0,this.littleEndian),i=void 0,a=void 0,o=void 0;if(r!==e.NIFTI1.MAGIC_COOKIE&&(this.littleEndian=!0,r=e.Utils.getIntAt(n,0,this.littleEndian)),r!==e.NIFTI1.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=e.Utils.getByteAt(n,39),i=0;i<8;i+=1)this.dims[i]=e.Utils.getShortAt(n,40+2*i,this.littleEndian);for(this.intent_p1=e.Utils.getFloatAt(n,56,this.littleEndian),this.intent_p2=e.Utils.getFloatAt(n,60,this.littleEndian),this.intent_p3=e.Utils.getFloatAt(n,64,this.littleEndian),this.intent_code=e.Utils.getShortAt(n,68,this.littleEndian),this.datatypeCode=e.Utils.getShortAt(n,70,this.littleEndian),this.numBitsPerVoxel=e.Utils.getShortAt(n,72,this.littleEndian),this.slice_start=e.Utils.getShortAt(n,74,this.littleEndian),i=0;i<8;i+=1)this.pixDims[i]=e.Utils.getFloatAt(n,76+4*i,this.littleEndian);for(this.vox_offset=e.Utils.getFloatAt(n,108,this.littleEndian),this.scl_slope=e.Utils.getFloatAt(n,112,this.littleEndian),this.scl_inter=e.Utils.getFloatAt(n,116,this.littleEndian),this.slice_end=e.Utils.getShortAt(n,120,this.littleEndian),this.slice_code=e.Utils.getByteAt(n,122),this.xyzt_units=e.Utils.getByteAt(n,123),this.cal_max=e.Utils.getFloatAt(n,124,this.littleEndian),this.cal_min=e.Utils.getFloatAt(n,128,this.littleEndian),this.slice_duration=e.Utils.getFloatAt(n,132,this.littleEndian),this.toffset=e.Utils.getFloatAt(n,136,this.littleEndian),this.description=e.Utils.getStringAt(n,148,228),this.aux_file=e.Utils.getStringAt(n,228,252),this.qform_code=e.Utils.getShortAt(n,252,this.littleEndian),this.sform_code=e.Utils.getShortAt(n,254,this.littleEndian),this.quatern_b=e.Utils.getFloatAt(n,256,this.littleEndian),this.quatern_c=e.Utils.getFloatAt(n,260,this.littleEndian),this.quatern_d=e.Utils.getFloatAt(n,264,this.littleEndian),this.qoffset_x=e.Utils.getFloatAt(n,268,this.littleEndian),this.qoffset_y=e.Utils.getFloatAt(n,272,this.littleEndian),this.qoffset_z=e.Utils.getFloatAt(n,276,this.littleEndian),a=0;a<3;a+=1)for(o=0;o<4;o+=1)this.affine[a][o]=e.Utils.getFloatAt(n,280+4*(4*a+o),this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=e.Utils.getStringAt(n,328,344),this.magic=e.Utils.getStringAt(n,344,348),this.isHDR=this.magic===e.NIFTI1.MAGIC_NUMBER2,this.setExtendedHeader(n)},e.NIFTI2.prototype.readHeader=function(t){var n=new DataView(t),r=e.Utils.getIntAt(n,0,this.littleEndian),i=void 0,a=void 0,o=void 0;if(r!==e.NIFTI2.MAGIC_COOKIE&&(this.littleEndian=!0,r=e.Utils.getIntAt(n,0,this.littleEndian)),r!==e.NIFTI2.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.datatypeCode=e.Utils.getShortAt(n,12,this.littleEndian),this.numBitsPerVoxel=e.Utils.getShortAt(n,14,this.littleEndian),i=0;i<8;i+=1)this.dims[i]=e.Utils.getLongAt(n,16+8*i,this.littleEndian);for(this.intent_p1=e.Utils.getDoubleAt(n,80,this.littleEndian),this.intent_p2=e.Utils.getDoubleAt(n,88,this.littleEndian),this.intent_p3=e.Utils.getDoubleAt(n,96,this.littleEndian),i=0;i<8;i+=1)this.pixDims[i]=e.Utils.getDoubleAt(n,104+8*i,this.littleEndian);for(this.vox_offset=e.Utils.getLongAt(n,168,this.littleEndian),this.scl_slope=e.Utils.getDoubleAt(n,176,this.littleEndian),this.scl_inter=e.Utils.getDoubleAt(n,184,this.littleEndian),this.cal_max=e.Utils.getDoubleAt(n,192,this.littleEndian),this.cal_min=e.Utils.getDoubleAt(n,200,this.littleEndian),this.slice_duration=e.Utils.getDoubleAt(n,208,this.littleEndian),this.toffset=e.Utils.getDoubleAt(n,216,this.littleEndian),this.slice_start=e.Utils.getLongAt(n,224,this.littleEndian),this.slice_end=e.Utils.getLongAt(n,232,this.littleEndian),this.description=e.Utils.getStringAt(n,240,320),this.aux_file=e.Utils.getStringAt(n,320,344),this.qform_code=e.Utils.getIntAt(n,344,this.littleEndian),this.sform_code=e.Utils.getIntAt(n,348,this.littleEndian),this.quatern_b=e.Utils.getDoubleAt(n,352,this.littleEndian),this.quatern_c=e.Utils.getDoubleAt(n,360,this.littleEndian),this.quatern_d=e.Utils.getDoubleAt(n,368,this.littleEndian),this.qoffset_x=e.Utils.getDoubleAt(n,376,this.littleEndian),this.qoffset_y=e.Utils.getDoubleAt(n,384,this.littleEndian),this.qoffset_z=e.Utils.getDoubleAt(n,392,this.littleEndian),a=0;a<3;a+=1)for(o=0;o<4;o+=1)this.affine[a][o]=e.Utils.getDoubleAt(n,400+8*(4*a+o),this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=e.Utils.getIntAt(n,496,this.littleEndian),this.xyzt_units=e.Utils.getIntAt(n,500,this.littleEndian),this.intent_code=e.Utils.getIntAt(n,504,this.littleEndian),this.intent_name=e.Utils.getStringAt(n,508,524),this.dim_info=e.Utils.getByteAt(n,524),this.setExtendedHeader(n)},i.forEach((function(t){t.prototype.setExtendedHeader=function(n){n.byteLength>t.MAGIC_COOKIE&&(this.extensionFlag[0]=e.Utils.getByteAt(n,t.MAGIC_COOKIE),this.extensionFlag[1]=e.Utils.getByteAt(n,t.MAGIC_COOKIE+1),this.extensionFlag[2]=e.Utils.getByteAt(n,t.MAGIC_COOKIE+2),this.extensionFlag[3]=e.Utils.getByteAt(n,t.MAGIC_COOKIE+3),this.hasExtendedHeaderData(n)&&(this.extensionSize=this.getExtensionSize(n),this.extensionCode=this.getExtensionCode(n)))},t.prototype.hasExtendedHeaderData=function(e){var t=this.getExtensionLocation();return this.isHDR&&this.extensionFlag[0]&&console.info("Extended header data for hdr file might produce inconsistent values"),this.extensionFlag[0]&&e.byteLength>=t+8}}))}(r),t.enhancedNiftiReader=r},function(e,t,n){"use strict";var r=r||{};r.NIFTI1=r.NIFTI1||n(18),r.NIFTI2=r.NIFTI2||n(46),r.Utils=r.Utils||n(12);var i=i||n(19);r.isNIFTI1=function(e){var t,n,i,a;return!(e.byteLength<r.NIFTI1.STANDARD_HEADER_SIZE||(t=new DataView(e),t&&(n=t.getUint8(r.NIFTI1.MAGIC_NUMBER_LOCATION)),i=t.getUint8(r.NIFTI1.MAGIC_NUMBER_LOCATION+1),a=t.getUint8(r.NIFTI1.MAGIC_NUMBER_LOCATION+2),n!==r.NIFTI1.MAGIC_NUMBER[0]||i!==r.NIFTI1.MAGIC_NUMBER[1]||a!==r.NIFTI1.MAGIC_NUMBER[2]))},r.isNIFTI2=function(e){var t,n,i,a;return!(e.byteLength<r.NIFTI1.STANDARD_HEADER_SIZE||(t=new DataView(e),n=t.getUint8(r.NIFTI2.MAGIC_NUMBER_LOCATION),i=t.getUint8(r.NIFTI2.MAGIC_NUMBER_LOCATION+1),a=t.getUint8(r.NIFTI2.MAGIC_NUMBER_LOCATION+2),n!==r.NIFTI2.MAGIC_NUMBER[0]||i!==r.NIFTI2.MAGIC_NUMBER[1]||a!==r.NIFTI2.MAGIC_NUMBER[2]))},r.isNIFTI=function(e){return r.isNIFTI1(e)||r.isNIFTI2(e)},r.isCompressed=function(e){var t,n,i;if(e){if(n=(t=new DataView(e)).getUint8(0),i=t.getUint8(1),n===r.Utils.GUNZIP_MAGIC_COOKIE1)return!0;if(i===r.Utils.GUNZIP_MAGIC_COOKIE2)return!0}return!1},r.decompress=function(e){return i.inflate(e).buffer},r.readHeader=function(e){var t=null;return r.isCompressed(e)&&(e=r.decompress(e)),r.isNIFTI1(e)?t=new r.NIFTI1:r.isNIFTI2(e)&&(t=new r.NIFTI2),t?t.readHeader(e):console.error("That file does not appear to be NIFTI!"),t},r.hasExtension=function(e){return 0!=e.extensionFlag[0]},r.readImage=function(e,t){var n=e.vox_offset,r=1,i=1;return e.dims[4]&&(r=e.dims[4]),e.dims[5]&&(i=e.dims[5]),t.slice(n,n+e.dims[1]*e.dims[2]*e.dims[3]*r*i*(e.numBitsPerVoxel/8))},r.readExtension=function(e,t){var n=e.getExtensionLocation();return t.slice(n,n+e.extensionSize)},r.readExtensionData=function(e,t){var n=e.getExtensionLocation();return t.slice(n+8,n+e.extensionSize-8)},void 0!==e&&e.exports&&(e.exports=r)},function(e,t,n){"use strict";var r=r||{};r.Utils=r.Utils||n(12),r.NIFTI1=r.NIFTI1||n(18),r.NIFTI2=r.NIFTI2||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.extensionFlag=[0,0,0,0]},r.NIFTI2.MAGIC_COOKIE=540,r.NIFTI2.MAGIC_NUMBER_LOCATION=4,r.NIFTI2.MAGIC_NUMBER=[110,43,50,0,13,10,26,10],r.NIFTI2.prototype.readHeader=function(e){var t,n,i,a=new DataView(e),o=r.Utils.getIntAt(a,0,this.littleEndian);if(o!==r.NIFTI2.MAGIC_COOKIE&&(this.littleEndian=!0,o=r.Utils.getIntAt(a,0,this.littleEndian)),o!==r.NIFTI2.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.datatypeCode=r.Utils.getShortAt(a,12,this.littleEndian),this.numBitsPerVoxel=r.Utils.getShortAt(a,14,this.littleEndian),t=0;t<8;t+=1)this.dims[t]=r.Utils.getLongAt(a,16+8*t,this.littleEndian);for(this.intent_p1=r.Utils.getDoubleAt(a,80,this.littleEndian),this.intent_p2=r.Utils.getDoubleAt(a,88,this.littleEndian),this.intent_p3=r.Utils.getDoubleAt(a,96,this.littleEndian),t=0;t<8;t+=1)this.pixDims[t]=r.Utils.getDoubleAt(a,104+8*t,this.littleEndian);for(this.vox_offset=r.Utils.getLongAt(a,168,this.littleEndian),this.scl_slope=r.Utils.getDoubleAt(a,176,this.littleEndian),this.scl_inter=r.Utils.getDoubleAt(a,184,this.littleEndian),this.cal_max=r.Utils.getDoubleAt(a,192,this.littleEndian),this.cal_min=r.Utils.getDoubleAt(a,200,this.littleEndian),this.slice_duration=r.Utils.getDoubleAt(a,208,this.littleEndian),this.toffset=r.Utils.getDoubleAt(a,216,this.littleEndian),this.slice_start=r.Utils.getLongAt(a,224,this.littleEndian),this.slice_end=r.Utils.getLongAt(a,232,this.littleEndian),this.description=r.Utils.getStringAt(a,240,320),this.aux_file=r.Utils.getStringAt(a,320,344),this.qform_code=r.Utils.getIntAt(a,344,this.littleEndian),this.sform_code=r.Utils.getIntAt(a,348,this.littleEndian),this.quatern_b=r.Utils.getDoubleAt(a,352,this.littleEndian),this.quatern_c=r.Utils.getDoubleAt(a,360,this.littleEndian),this.quatern_d=r.Utils.getDoubleAt(a,368,this.littleEndian),this.qoffset_x=r.Utils.getDoubleAt(a,376,this.littleEndian),this.qoffset_y=r.Utils.getDoubleAt(a,384,this.littleEndian),this.qoffset_z=r.Utils.getDoubleAt(a,392,this.littleEndian),n=0;n<3;n+=1)for(i=0;i<4;i+=1)this.affine[n][i]=r.Utils.getDoubleAt(a,400+8*(4*n+i),this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=r.Utils.getIntAt(a,496,this.littleEndian),this.xyzt_units=r.Utils.getIntAt(a,500,this.littleEndian),this.intent_code=r.Utils.getIntAt(a,504,this.littleEndian),this.intent_name=r.Utils.getStringAt(a,508,524),this.dim_info=r.Utils.getByteAt(a,524),a.byteLength>r.NIFTI2.MAGIC_COOKIE&&(this.extensionFlag[0]=r.Utils.getByteAt(a,540),this.extensionFlag[1]=r.Utils.getByteAt(a,541),this.extensionFlag[2]=r.Utils.getByteAt(a,542),this.extensionFlag[3]=r.Utils.getByteAt(a,543),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(a),this.extensionCode=this.getExtensionCode(a)))},r.NIFTI2.prototype.toFormattedString=function(){var e=r.Utils.formatNumber,t="";return t+="Datatype = "+ +this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",t+="Bits Per Voxel =  = "+this.numBitsPerVoxel+"\n",t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",t+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+"\n",t+="Image Offset = "+this.vox_offset+"\n",t+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+"\n",t+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+"\n",t+="Slice Duration = "+this.slice_duration+"\n",t+="Time Axis Shift = "+this.toffset+"\n",t+="Slice Start = "+this.slice_start+"\n",t+="Slice End = "+this.slice_end+"\n",t+='Description: "'+this.description+'"\n',t+='Auxiliary File: "'+this.aux_file+'"\n',t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",t+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+"\n",t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",t+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+"\n",t+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+"\n",t+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+"\n",t+="Slice Code = "+this.slice_code+"\n",t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(r.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(r.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",t+="Intent Code = "+this.intent_code+"\n",(t+='Intent Name: "'+this.intent_name+'"\n')+"Dim Info = "+this.dim_info+"\n"},r.NIFTI2.prototype.getExtensionLocation=function(){return r.NIFTI2.MAGIC_COOKIE+4},r.NIFTI2.prototype.getExtensionSize=r.NIFTI1.prototype.getExtensionSize,r.NIFTI2.prototype.getExtensionCode=r.NIFTI1.prototype.getExtensionCode,r.NIFTI2.prototype.getDatatypeCodeString=r.NIFTI1.prototype.getDatatypeCodeString,r.NIFTI2.prototype.getTransformCodeString=r.NIFTI1.prototype.getTransformCodeString,r.NIFTI2.prototype.getUnitsCodeString=r.NIFTI1.prototype.getUnitsCodeString,r.NIFTI2.prototype.getQformMat=r.NIFTI1.prototype.getQformMat,r.NIFTI2.prototype.convertNiftiQFormToNiftiSForm=r.NIFTI1.prototype.convertNiftiQFormToNiftiSForm,r.NIFTI2.prototype.convertNiftiSFormToNEMA=r.NIFTI1.prototype.convertNiftiSFormToNEMA,r.NIFTI2.prototype.nifti_mat33_mul=r.NIFTI1.prototype.nifti_mat33_mul,r.NIFTI2.prototype.nifti_mat33_determ=r.NIFTI1.prototype.nifti_mat33_determ,void 0!==e&&e.exports&&(e.exports=r.NIFTI2)},function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);this.options=o.assign({level:h,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var n=a.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==d)throw new Error(l[n]);if(t.header&&a.deflateSetHeader(this.strm,t.header),t.dictionary){var i;if(i="string"==typeof t.dictionary?s.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=a.deflateSetDictionary(this.strm,i))!==d)throw new Error(l[n]);this._dict_set=!0}}function i(e,t){var n=new r(t);if(n.push(e,!0),n.err)throw n.msg||l[n.err];return n.result}var a=n(48),o=n(2),s=n(22),l=n(13),u=n(23),c=Object.prototype.toString,d=0,h=-1,f=0,p=8;r.prototype.push=function(e,t){var n,r,i=this.strm,l=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:!0===t?4:0,i.input="string"==typeof e?s.string2buf(e):"[object ArrayBuffer]"===c.call(e)?new Uint8Array(e):e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new o.Buf8(l),i.next_out=0,i.avail_out=l),1!==(n=a.deflate(i,r))&&n!==d)return this.onEnd(n),this.ended=!0,!1;0!==i.avail_out&&(0!==i.avail_in||4!==r&&2!==r)||this.onData("string"===this.options.to?s.buf2binstring(o.shrinkBuf(i.output,i.next_out)):o.shrinkBuf(i.output,i.next_out))}while((i.avail_in>0||0===i.avail_out)&&1!==n);return 4===r?(n=a.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===d):2!==r||(this.onEnd(d),i.avail_out=0,!0)},r.prototype.onData=function(e){this.chunks.push(e)},r.prototype.onEnd=function(e){e===d&&(this.result="string"===this.options.to?this.chunks.join(""):o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=r,t.deflate=i,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,i(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,i(e,t)}},function(e,t,n){"use strict";function r(e,t){return e.msg=C[t],t}function i(e){return(e<<1)-(e>4?9:0)}function a(e){for(var t=e.length;--t>=0;)e[t]=0}function o(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(S.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function s(e,t){E._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,o(e.strm)}function l(e,t){e.pending_buf[e.pending++]=t}function u(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function c(e,t,n,r){var i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,S.arraySet(t,e.input,e.next_in,i,n),1===e.state.wrap?e.adler=T(e.adler,t,i,n):2===e.state.wrap&&(e.adler=k(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)}function d(e,t){var n,r,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-V?e.strstart-(e.w_size-V):0,u=e.window,c=e.w_mask,d=e.prev,h=e.strstart+W,f=u[a+o-1],p=u[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(n=t)+o]===p&&u[n+o-1]===f&&u[n]===u[a]&&u[++n]===u[a+1]){a+=2,n++;do{}while(u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&a<h);if(r=W-(h-a),a=h-W,r>o){if(e.match_start=t,o=r,r>=s)break;f=u[a+o-1],p=u[a+o]}}}while((t=d[t&c])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function h(e){var t,n,r,i,a,o=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=o+(o-V)){S.arraySet(e.window,e.window,o,o,0),e.match_start-=o,e.strstart-=o,e.block_start-=o,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=o?r-o:0}while(--n);t=n=o;do{r=e.prev[--t],e.prev[t]=r>=o?r-o:0}while(--n);i+=o}if(0===e.strm.avail_in)break;if(n=c(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=H)for(e.ins_h=e.window[a=e.strstart-e.insert],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+H-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<H)););}while(e.lookahead<V&&0!==e.strm.avail_in)}function f(e,t){for(var n,r;;){if(e.lookahead<V){if(h(e),e.lookahead<V&&t===I)return K;if(0===e.lookahead)break}if(n=0,e.lookahead>=H&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+H-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-V&&(e.match_length=d(e,n)),e.match_length>=H)if(r=E._tr_tally(e,e.strstart-e.match_start,e.match_length-H),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=H){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+H-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=E._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(s(e,!1),0===e.strm.avail_out))return K}return e.insert=e.strstart<H-1?e.strstart:H-1,t===O?(s(e,!0),0===e.strm.avail_out?J:Q):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?K:Z}function p(e,t){for(var n,r,i;;){if(e.lookahead<V){if(h(e),e.lookahead<V&&t===I)return K;if(0===e.lookahead)break}if(n=0,e.lookahead>=H&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+H-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=H-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-V&&(e.match_length=d(e,n),e.match_length<=5&&(e.strategy===N||e.match_length===H&&e.strstart-e.match_start>4096)&&(e.match_length=H-1)),e.prev_length>=H&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-H,r=E._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-H),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+H-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=H-1,e.strstart++,r&&(s(e,!1),0===e.strm.avail_out))return K}else if(e.match_available){if((r=E._tr_tally(e,0,e.window[e.strstart-1]))&&s(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return K}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=E._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<H-1?e.strstart:H-1,t===O?(s(e,!0),0===e.strm.avail_out?J:Q):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?K:Z}function m(e,t){for(var n,r,i,a,o=e.window;;){if(e.lookahead<=W){if(h(e),e.lookahead<=W&&t===I)return K;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=H&&e.strstart>0&&(r=o[i=e.strstart-1])===o[++i]&&r===o[++i]&&r===o[++i]){a=e.strstart+W;do{}while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<a);e.match_length=W-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=H?(n=E._tr_tally(e,1,e.match_length-H),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=E._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(s(e,!1),0===e.strm.avail_out))return K}return e.insert=0,t===O?(s(e,!0),0===e.strm.avail_out?J:Q):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?K:Z}function g(e,t){for(var n;;){if(0===e.lookahead&&(h(e),0===e.lookahead)){if(t===I)return K;break}if(e.match_length=0,n=E._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(s(e,!1),0===e.strm.avail_out))return K}return e.insert=0,t===O?(s(e,!0),0===e.strm.avail_out?J:Q):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?K:Z}function v(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function y(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=P,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new S.Buf16(2*z),this.dyn_dtree=new S.Buf16(2*(2*$+1)),this.bl_tree=new S.Buf16(2*(2*B+1)),a(this.dyn_ltree),a(this.dyn_dtree),a(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new S.Buf16(U+1),this.heap=new S.Buf16(2*L+1),a(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new S.Buf16(2*L+1),a(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function b(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=R,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?q:Y,e.adler=2===t.wrap?0:1,t.last_flush=I,E._tr_init(t),A):r(e,D)}function x(e){var t=b(e);return t===A&&function(e){e.window_size=2*e.w_size,a(e.head),e.max_lazy_match=_[e.level].max_lazy,e.good_match=_[e.level].good_length,e.nice_match=_[e.level].nice_length,e.max_chain_length=_[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=H-1,e.match_available=0,e.ins_h=0}(e.state),t}function w(e,t,n,i,a,o){if(!e)return D;var s=1;if(t===M&&(t=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),a<1||a>F||n!==P||i<8||i>15||t<0||t>9||o<0||o>j)return r(e,D);8===i&&(i=9);var l=new y;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+H-1)/H),l.window=new S.Buf8(2*l.w_size),l.head=new S.Buf16(l.hash_size),l.prev=new S.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new S.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=n,x(e)}var _,S=n(2),E=n(49),T=n(20),k=n(21),C=n(13),I=0,O=4,A=0,D=-2,M=-1,N=1,j=4,R=2,P=8,F=9,L=286,$=30,B=19,z=2*L+1,U=15,H=3,W=258,V=W+H+1,q=42,G=103,Y=113,X=666,K=1,Z=2,J=3,Q=4;_=[new v(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(h(e),0===e.lookahead&&t===I)return K;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,s(e,!1),0===e.strm.avail_out))return K;if(e.strstart-e.block_start>=e.w_size-V&&(s(e,!1),0===e.strm.avail_out))return K}return e.insert=0,t===O?(s(e,!0),0===e.strm.avail_out?J:Q):(e.strstart>e.block_start&&s(e,!1),K)})),new v(4,4,8,4,f),new v(4,5,16,8,f),new v(4,6,32,32,f),new v(4,4,16,16,p),new v(8,16,32,32,p),new v(8,16,128,128,p),new v(8,32,128,256,p),new v(32,128,258,1024,p),new v(32,258,258,4096,p)],t.deflateInit=function(e,t){return w(e,t,P,15,8,0)},t.deflateInit2=w,t.deflateReset=x,t.deflateResetKeep=b,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?D:(e.state.gzhead=t,A):D},t.deflate=function(e,t){var n,s,c,d;if(!e||!e.state||t>5||t<0)return e?r(e,D):D;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===X&&t!==O)return r(e,0===e.avail_out?-5:D);if(s.strm=e,n=s.last_flush,s.last_flush=t,s.status===q)if(2===s.wrap)e.adler=0,l(s,31),l(s,139),l(s,8),s.gzhead?(l(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),l(s,255&s.gzhead.time),l(s,s.gzhead.time>>8&255),l(s,s.gzhead.time>>16&255),l(s,s.gzhead.time>>24&255),l(s,9===s.level?2:s.strategy>=2||s.level<2?4:0),l(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(l(s,255&s.gzhead.extra.length),l(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=k(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(l(s,0),l(s,0),l(s,0),l(s,0),l(s,0),l(s,9===s.level?2:s.strategy>=2||s.level<2?4:0),l(s,3),s.status=Y);else{var h=P+(s.w_bits-8<<4)<<8;h|=(s.strategy>=2||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(h|=32),h+=31-h%31,s.status=Y,u(s,h),0!==s.strstart&&(u(s,e.adler>>>16),u(s,65535&e.adler)),e.adler=1}if(69===s.status)if(s.gzhead.extra){for(c=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>c&&(e.adler=k(e.adler,s.pending_buf,s.pending-c,c)),o(e),c=s.pending,s.pending!==s.pending_buf_size));)l(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>c&&(e.adler=k(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=k(e.adler,s.pending_buf,s.pending-c,c)),o(e),c=s.pending,s.pending===s.pending_buf_size)){d=1;break}d=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,l(s,d)}while(0!==d);s.gzhead.hcrc&&s.pending>c&&(e.adler=k(e.adler,s.pending_buf,s.pending-c,c)),0===d&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=k(e.adler,s.pending_buf,s.pending-c,c)),o(e),c=s.pending,s.pending===s.pending_buf_size)){d=1;break}d=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,l(s,d)}while(0!==d);s.gzhead.hcrc&&s.pending>c&&(e.adler=k(e.adler,s.pending_buf,s.pending-c,c)),0===d&&(s.status=G)}else s.status=G;if(s.status===G&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&o(e),s.pending+2<=s.pending_buf_size&&(l(s,255&e.adler),l(s,e.adler>>8&255),e.adler=0,s.status=Y)):s.status=Y),0!==s.pending){if(o(e),0===e.avail_out)return s.last_flush=-1,A}else if(0===e.avail_in&&i(t)<=i(n)&&t!==O)return r(e,-5);if(s.status===X&&0!==e.avail_in)return r(e,-5);if(0!==e.avail_in||0!==s.lookahead||t!==I&&s.status!==X){var f=2===s.strategy?g(s,t):3===s.strategy?m(s,t):_[s.level].func(s,t);if(f!==J&&f!==Q||(s.status=X),f===K||f===J)return 0===e.avail_out&&(s.last_flush=-1),A;if(f===Z&&(1===t?E._tr_align(s):5!==t&&(E._tr_stored_block(s,0,0,!1),3===t&&(a(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),o(e),0===e.avail_out))return s.last_flush=-1,A}return t!==O?A:s.wrap<=0?1:(2===s.wrap?(l(s,255&e.adler),l(s,e.adler>>8&255),l(s,e.adler>>16&255),l(s,e.adler>>24&255),l(s,255&e.total_in),l(s,e.total_in>>8&255),l(s,e.total_in>>16&255),l(s,e.total_in>>24&255)):(u(s,e.adler>>>16),u(s,65535&e.adler)),o(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?A:1)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==q&&69!==t&&73!==t&&91!==t&&t!==G&&t!==Y&&t!==X?r(e,D):(e.state=null,t===Y?r(e,-3):A):D},t.deflateSetDictionary=function(e,t){var n,r,i,o,s,l,u,c,d=t.length;if(!e||!e.state)return D;if(2===(o=(n=e.state).wrap)||1===o&&n.status!==q||n.lookahead)return D;for(1===o&&(e.adler=T(e.adler,t,d,0)),n.wrap=0,d>=n.w_size&&(0===o&&(a(n.head),n.strstart=0,n.block_start=0,n.insert=0),c=new S.Buf8(n.w_size),S.arraySet(c,t,d-n.w_size,n.w_size,0),t=c,d=n.w_size),s=e.avail_in,l=e.next_in,u=e.input,e.avail_in=d,e.next_in=0,e.input=t,h(n);n.lookahead>=H;){r=n.strstart,i=n.lookahead-(H-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+H-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--i);n.strstart=r,n.lookahead=H-1,h(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=H-1,n.match_available=0,e.next_in=l,e.input=u,e.avail_in=s,n.wrap=o,A},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";function r(e){for(var t=e.length;--t>=0;)e[t]=0}function i(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function a(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function o(e){return e<256?B[e]:B[256+(e>>>7)]}function s(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function l(e,t,n){e.bi_valid>O-n?(e.bi_buf|=t<<e.bi_valid&65535,s(e,e.bi_buf),e.bi_buf=t>>O-e.bi_valid,e.bi_valid+=n-O):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function u(e,t,n){l(e,n[2*t],n[2*t+1])}function c(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function d(e,t,n){var r,i,a=new Array(I+1),o=0;for(r=1;r<=I;r++)a[r]=o=o+n[r-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=c(a[s]++,s))}}function h(e){var t;for(t=0;t<E;t++)e.dyn_ltree[2*t]=0;for(t=0;t<T;t++)e.dyn_dtree[2*t]=0;for(t=0;t<k;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*A]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function f(e){e.bi_valid>8?s(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function p(e,t,n,r){var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]}function m(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&p(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!p(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function g(e,t,n){var r,i,a,s,c=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],i=e.pending_buf[e.l_buf+c],c++,0===r?u(e,i,t):(u(e,(a=z[i])+S+1,t),0!==(s=j[a])&&l(e,i-=U[a],s),u(e,a=o(--r),n),0!==(s=R[a])&&l(e,r-=H[a],s))}while(c<e.last_lit);u(e,A,t)}function v(e,t){var n,r,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=C,n=0;n<l;n++)0!==a[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)m(e,a,n);i=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],m(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,a[2*i]=a[2*n]+a[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,a[2*n+1]=a[2*r+1]=i,e.heap[1]=i++,m(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,a,o,s,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(a=0;a<=I;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<C;n++)(a=l[2*l[2*(r=e.heap[n])+1]+1]+1)>p&&(a=p,m++),l[2*r+1]=a,r>u||(e.bl_count[a]++,o=0,r>=f&&(o=h[r-f]),e.opt_len+=(s=l[2*r])*(a+o),d&&(e.static_len+=s*(c[2*r+1]+o)));if(0!==m){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(a=p;0!==a;a--)for(r=e.bl_count[a];0!==r;)(i=e.heap[--n])>u||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),r--)}}(e,t),d(a,u,e.bl_count)}function y(e,t,n){var r,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++s<l&&i===o||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[2*D]++):s<=10?e.bl_tree[2*M]++:e.bl_tree[2*N]++,s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4))}function b(e,t,n){var r,i,a=-1,o=t[1],s=0,c=7,d=4;for(0===o&&(c=138,d=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++s<c&&i===o)){if(s<d)do{u(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(u(e,i,e.bl_tree),s--),u(e,D,e.bl_tree),l(e,s-3,2)):s<=10?(u(e,M,e.bl_tree),l(e,s-3,3)):(u(e,N,e.bl_tree),l(e,s-11,7));s=0,a=i,0===o?(c=138,d=3):i===o?(c=6,d=3):(c=7,d=4)}}function x(e,t,n,r){l(e,(_<<1)+(r?1:0),3),function(e,t,n,r){f(e),s(e,n),s(e,~n),w.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}var w=n(2),_=0,S=256,E=S+1+29,T=30,k=19,C=2*E+1,I=15,O=16,A=256,D=16,M=17,N=18,j=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],L=new Array(2*(E+2));r(L);var $=new Array(2*T);r($);var B=new Array(512);r(B);var z=new Array(256);r(z);var U=new Array(29);r(U);var H=new Array(T);r(H);var W,V,q,G=!1;t._tr_init=function(e){G||(function(){var e,t,n,r,a,o=new Array(I+1);for(n=0,r=0;r<28;r++)for(U[r]=n,e=0;e<1<<j[r];e++)z[n++]=r;for(z[n-1]=r,a=0,r=0;r<16;r++)for(H[r]=a,e=0;e<1<<R[r];e++)B[a++]=r;for(a>>=7;r<T;r++)for(H[r]=a<<7,e=0;e<1<<R[r]-7;e++)B[256+a++]=r;for(t=0;t<=I;t++)o[t]=0;for(e=0;e<=143;)L[2*e+1]=8,e++,o[8]++;for(;e<=255;)L[2*e+1]=9,e++,o[9]++;for(;e<=279;)L[2*e+1]=7,e++,o[7]++;for(;e<=287;)L[2*e+1]=8,e++,o[8]++;for(d(L,E+1,o),e=0;e<T;e++)$[2*e+1]=5,$[2*e]=c(e,5);W=new i(L,j,S+1,E,I),V=new i($,R,0,T,I),q=new i(new Array(0),P,0,k,7)}(),G=!0),e.l_desc=new a(e.dyn_ltree,W),e.d_desc=new a(e.dyn_dtree,V),e.bl_desc=new a(e.bl_tree,q),e.bi_buf=0,e.bi_valid=0,h(e)},t._tr_stored_block=x,t._tr_flush_block=function(e,t,n,r){var i,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<S;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),v(e,e.l_desc),v(e,e.d_desc),o=function(e){var t;for(y(e,e.dyn_ltree,e.l_desc.max_code),y(e,e.dyn_dtree,e.d_desc.max_code),v(e,e.bl_desc),t=k-1;t>=3&&0===e.bl_tree[2*F[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),(a=e.static_len+3+7>>>3)<=(i=e.opt_len+3+7>>>3)&&(i=a)):i=a=n+5,n+4<=i&&-1!==t?x(e,t,n,r):4===e.strategy||a===i?(l(e,2+(r?1:0),3),g(e,L,$)):(l(e,4+(r?1:0),3),function(e,t,n,r){var i;for(l(e,t-257,5),l(e,n-1,5),l(e,r-4,4),i=0;i<r;i++)l(e,e.bl_tree[2*F[i]+1],3);b(e,e.dyn_ltree,t-1),b(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),g(e,e.dyn_ltree,e.dyn_dtree)),h(e),r&&f(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(z[n]+S+1)]++,e.dyn_dtree[2*o(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){l(e,2,3),u(e,A,L),function(e){16===e.bi_valid?(s(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=a.inflateInit2(this.strm,t.windowBits);if(n!==l.Z_OK)throw new Error(u[n]);this.header=new d,a.inflateGetHeader(this.strm,this.header)}function i(e,t){var n=new r(t);if(n.push(e,!0),n.err)throw n.msg||u[n.err];return n.result}var a=n(51),o=n(2),s=n(22),l=n(24),u=n(13),c=n(23),d=n(54),h=Object.prototype.toString;r.prototype.push=function(e,t){var n,r,i,u,c,d,f=this.strm,p=this.options.chunkSize,m=this.options.dictionary,g=!1;if(this.ended)return!1;r=t===~~t?t:!0===t?l.Z_FINISH:l.Z_NO_FLUSH,f.input="string"==typeof e?s.binstring2buf(e):"[object ArrayBuffer]"===h.call(e)?new Uint8Array(e):e,f.next_in=0,f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new o.Buf8(p),f.next_out=0,f.avail_out=p),(n=a.inflate(f,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&m&&(d="string"==typeof m?s.string2buf(m):"[object ArrayBuffer]"===h.call(m)?new Uint8Array(m):m,n=a.inflateSetDictionary(this.strm,d)),n===l.Z_BUF_ERROR&&!0===g&&(n=l.Z_OK,g=!1),n!==l.Z_STREAM_END&&n!==l.Z_OK)return this.onEnd(n),this.ended=!0,!1;f.next_out&&(0!==f.avail_out&&n!==l.Z_STREAM_END&&(0!==f.avail_in||r!==l.Z_FINISH&&r!==l.Z_SYNC_FLUSH)||("string"===this.options.to?(i=s.utf8border(f.output,f.next_out),u=f.next_out-i,c=s.buf2string(f.output,i),f.next_out=u,f.avail_out=p-u,u&&o.arraySet(f.output,f.output,i,u,0),this.onData(c)):this.onData(o.shrinkBuf(f.output,f.next_out)))),0===f.avail_in&&0===f.avail_out&&(g=!0)}while((f.avail_in>0||0===f.avail_out)&&n!==l.Z_STREAM_END);return n===l.Z_STREAM_END&&(r=l.Z_FINISH),r===l.Z_FINISH?(n=a.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===l.Z_OK):r!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),f.avail_out=0,!0)},r.prototype.onData=function(e){this.chunks.push(e)},r.prototype.onEnd=function(e){e===l.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=r,t.inflate=i,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,i(e,t)},t.ungzip=i},function(e,t,n){"use strict";function r(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new f.Buf16(320),this.work=new f.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(e){var t;return e&&e.state?(e.total_in=e.total_out=(t=e.state).total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=_,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new f.Buf32(T),t.distcode=t.distdyn=new f.Buf32(k),t.sane=1,t.back=-1,x):w}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,a(e)):w}function s(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?w:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,o(e))):w}function l(e,t){var n,r;return e?(r=new i,e.state=r,r.window=null,(n=s(e,t))!==x&&(e.state=null),n):w}function u(e){if(C){var t;for(d=new f.Buf32(512),h=new f.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(v(y,e.lens,0,288,d,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;v(b,e.lens,0,32,h,0,e.work,{bits:5}),C=!1}e.lencode=d,e.lenbits=9,e.distcode=h,e.distbits=5}function c(e,t,n,r){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new f.Buf8(a.wsize)),r>=a.wsize?(f.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>r&&(i=r),f.arraySet(a.window,t,n-r,i,a.wnext),(r-=i)?(f.arraySet(a.window,t,n-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}var d,h,f=n(2),p=n(20),m=n(21),g=n(52),v=n(53),y=1,b=2,x=0,w=-2,_=1,S=12,E=30,T=852,k=592,C=!0;t.inflateReset=o,t.inflateReset2=s,t.inflateResetKeep=a,t.inflateInit=function(e){return l(e,15)},t.inflateInit2=l,t.inflate=function(e,t){var n,i,a,o,s,l,d,h,T,k,C,I,O,A,D,M,N,j,R,P,F,L,$,B,z=0,U=new f.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return w;(n=e.state).mode===S&&(n.mode=13),s=e.next_out,a=e.output,o=e.next_in,i=e.input,h=n.hold,T=n.bits,k=l=e.avail_in,C=d=e.avail_out,L=x;e:for(;;)switch(n.mode){case _:if(0===n.wrap){n.mode=13;break}for(;T<16;){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}if(2&n.wrap&&35615===h){n.check=0,U[0]=255&h,U[1]=h>>>8&255,n.check=m(n.check,U,2,0),h=0,T=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",n.mode=E;break}if(8!=(15&h)){e.msg="unknown compression method",n.mode=E;break}if(T-=4,F=8+(15&(h>>>=4)),0===n.wbits)n.wbits=F;else if(F>n.wbits){e.msg="invalid window size",n.mode=E;break}n.dmax=1<<F,e.adler=n.check=1,n.mode=512&h?10:S,h=0,T=0;break;case 2:for(;T<16;){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}if(n.flags=h,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=E;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=E;break}n.head&&(n.head.text=h>>8&1),512&n.flags&&(U[0]=255&h,U[1]=h>>>8&255,n.check=m(n.check,U,2,0)),h=0,T=0,n.mode=3;case 3:for(;T<32;){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}n.head&&(n.head.time=h),512&n.flags&&(U[0]=255&h,U[1]=h>>>8&255,U[2]=h>>>16&255,U[3]=h>>>24&255,n.check=m(n.check,U,4,0)),h=0,T=0,n.mode=4;case 4:for(;T<16;){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&n.flags&&(U[0]=255&h,U[1]=h>>>8&255,n.check=m(n.check,U,2,0)),h=0,T=0,n.mode=5;case 5:if(1024&n.flags){for(;T<16;){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}n.length=h,n.head&&(n.head.extra_len=h),512&n.flags&&(U[0]=255&h,U[1]=h>>>8&255,n.check=m(n.check,U,2,0)),h=0,T=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((I=n.length)>l&&(I=l),I&&(n.head&&(F=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),f.arraySet(n.head.extra,i,o,I,F)),512&n.flags&&(n.check=m(n.check,i,I,o)),l-=I,o+=I,n.length-=I),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===l)break e;I=0;do{F=i[o+I++],n.head&&F&&n.length<65536&&(n.head.name+=String.fromCharCode(F))}while(F&&I<l);if(512&n.flags&&(n.check=m(n.check,i,I,o)),l-=I,o+=I,F)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===l)break e;I=0;do{F=i[o+I++],n.head&&F&&n.length<65536&&(n.head.comment+=String.fromCharCode(F))}while(F&&I<l);if(512&n.flags&&(n.check=m(n.check,i,I,o)),l-=I,o+=I,F)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;T<16;){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}if(h!==(65535&n.check)){e.msg="header crc mismatch",n.mode=E;break}h=0,T=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=S;break;case 10:for(;T<32;){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}e.adler=n.check=r(h),h=0,T=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=s,e.avail_out=d,e.next_in=o,e.avail_in=l,n.hold=h,n.bits=T,2;e.adler=n.check=1,n.mode=S;case S:if(5===t||6===t)break e;case 13:if(n.last){h>>>=7&T,T-=7&T,n.mode=27;break}for(;T<3;){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}switch(n.last=1&h,T-=1,3&(h>>>=1)){case 0:n.mode=14;break;case 1:if(u(n),n.mode=20,6===t){h>>>=2,T-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=E}h>>>=2,T-=2;break;case 14:for(h>>>=7&T,T-=7&T;T<32;){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",n.mode=E;break}if(n.length=65535&h,h=0,T=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(I=n.length){if(I>l&&(I=l),I>d&&(I=d),0===I)break e;f.arraySet(a,i,o,I,s),l-=I,o+=I,d-=I,s+=I,n.length-=I;break}n.mode=S;break;case 17:for(;T<14;){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}if(n.nlen=257+(31&h),T-=5,n.ndist=1+(31&(h>>>=5)),T-=5,n.ncode=4+(15&(h>>>=5)),h>>>=4,T-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=E;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;T<3;){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}n.lens[H[n.have++]]=7&h,h>>>=3,T-=3}for(;n.have<19;)n.lens[H[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,L=v(0,n.lens,0,19,n.lencode,0,n.work,$={bits:n.lenbits}),n.lenbits=$.bits,L){e.msg="invalid code lengths set",n.mode=E;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;M=(z=n.lencode[h&(1<<n.lenbits)-1])>>>16&255,N=65535&z,!((D=z>>>24)<=T);){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}if(N<16)h>>>=D,T-=D,n.lens[n.have++]=N;else{if(16===N){for(B=D+2;T<B;){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}if(h>>>=D,T-=D,0===n.have){e.msg="invalid bit length repeat",n.mode=E;break}F=n.lens[n.have-1],I=3+(3&h),h>>>=2,T-=2}else if(17===N){for(B=D+3;T<B;){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}T-=D,F=0,I=3+(7&(h>>>=D)),h>>>=3,T-=3}else{for(B=D+7;T<B;){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}T-=D,F=0,I=11+(127&(h>>>=D)),h>>>=7,T-=7}if(n.have+I>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=E;break}for(;I--;)n.lens[n.have++]=F}}if(n.mode===E)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=E;break}if(n.lenbits=9,L=v(y,n.lens,0,n.nlen,n.lencode,0,n.work,$={bits:n.lenbits}),n.lenbits=$.bits,L){e.msg="invalid literal/lengths set",n.mode=E;break}if(n.distbits=6,n.distcode=n.distdyn,L=v(b,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,$={bits:n.distbits}),n.distbits=$.bits,L){e.msg="invalid distances set",n.mode=E;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(l>=6&&d>=258){e.next_out=s,e.avail_out=d,e.next_in=o,e.avail_in=l,n.hold=h,n.bits=T,g(e,C),s=e.next_out,a=e.output,d=e.avail_out,o=e.next_in,i=e.input,l=e.avail_in,h=n.hold,T=n.bits,n.mode===S&&(n.back=-1);break}for(n.back=0;M=(z=n.lencode[h&(1<<n.lenbits)-1])>>>16&255,N=65535&z,!((D=z>>>24)<=T);){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}if(M&&0==(240&M)){for(j=D,R=M,P=N;M=(z=n.lencode[P+((h&(1<<j+R)-1)>>j)])>>>16&255,N=65535&z,!(j+(D=z>>>24)<=T);){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}h>>>=j,T-=j,n.back+=j}if(h>>>=D,T-=D,n.back+=D,n.length=N,0===M){n.mode=26;break}if(32&M){n.back=-1,n.mode=S;break}if(64&M){e.msg="invalid literal/length code",n.mode=E;break}n.extra=15&M,n.mode=22;case 22:if(n.extra){for(B=n.extra;T<B;){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,T-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;M=(z=n.distcode[h&(1<<n.distbits)-1])>>>16&255,N=65535&z,!((D=z>>>24)<=T);){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}if(0==(240&M)){for(j=D,R=M,P=N;M=(z=n.distcode[P+((h&(1<<j+R)-1)>>j)])>>>16&255,N=65535&z,!(j+(D=z>>>24)<=T);){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}h>>>=j,T-=j,n.back+=j}if(h>>>=D,T-=D,n.back+=D,64&M){e.msg="invalid distance code",n.mode=E;break}n.offset=N,n.extra=15&M,n.mode=24;case 24:if(n.extra){for(B=n.extra;T<B;){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,T-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=E;break}n.mode=25;case 25:if(0===d)break e;if(n.offset>(I=C-d)){if((I=n.offset-I)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=E;break}O=I>n.wnext?n.wsize-(I-=n.wnext):n.wnext-I,I>n.length&&(I=n.length),A=n.window}else A=a,O=s-n.offset,I=n.length;I>d&&(I=d),d-=I,n.length-=I;do{a[s++]=A[O++]}while(--I);0===n.length&&(n.mode=21);break;case 26:if(0===d)break e;a[s++]=n.length,d--,n.mode=21;break;case 27:if(n.wrap){for(;T<32;){if(0===l)break e;l--,h|=i[o++]<<T,T+=8}if(e.total_out+=C-=d,n.total+=C,C&&(e.adler=n.check=n.flags?m(n.check,a,C,s-C):p(n.check,a,C,s-C)),C=d,(n.flags?h:r(h))!==n.check){e.msg="incorrect data check",n.mode=E;break}h=0,T=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;T<32;){if(0===l)break e;l--,h+=i[o++]<<T,T+=8}if(h!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=E;break}h=0,T=0}n.mode=29;case 29:L=1;break e;case E:L=-3;break e;case 31:return-4;case 32:default:return w}return e.next_out=s,e.avail_out=d,e.next_in=o,e.avail_in=l,n.hold=h,n.bits=T,(n.wsize||C!==e.avail_out&&n.mode<E&&(n.mode<27||4!==t))&&c(e,e.output,e.next_out,C-e.avail_out)?(n.mode=31,-4):(C-=e.avail_out,e.total_in+=k-=e.avail_in,e.total_out+=C,n.total+=C,n.wrap&&C&&(e.adler=n.check=n.flags?m(n.check,a,C,e.next_out-C):p(n.check,a,C,e.next_out-C)),e.data_type=n.bits+(n.last?64:0)+(n.mode===S?128:0)+(20===n.mode||15===n.mode?256:0),(0===k&&0===C||4===t)&&L===x&&(L=-5),L)},t.inflateEnd=function(e){if(!e||!e.state)return w;var t=e.state;return t.window&&(t.window=null),e.state=null,x},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?w:(n.head=t,t.done=!1,x):w},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?w:11===n.mode&&p(1,t,r,0)!==n.check?-3:c(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,x):w},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i,a,o,s,l,u,c,d,h,f,p,m,g,v,y,b,x,w,_,S,E,T,k;T=e.input,i=(r=e.next_in)+(e.avail_in-5),k=e.output,o=(a=e.next_out)-(t-e.avail_out),s=a+(e.avail_out-257),l=(n=e.state).dmax,u=n.wsize,c=n.whave,d=n.wnext,h=n.window,f=n.hold,p=n.bits,m=n.lencode,g=n.distcode,v=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{p<15&&(f+=T[r++]<<p,f+=T[r++]<<(p+=8),p+=8),b=m[f&v];t:for(;;){if(f>>>=x=b>>>24,p-=x,0==(x=b>>>16&255))k[a++]=65535&b;else{if(!(16&x)){if(0==(64&x)){b=m[(65535&b)+(f&(1<<x)-1)];continue t}if(32&x){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}w=65535&b,(x&=15)&&(p<x&&(f+=T[r++]<<p,p+=8),w+=f&(1<<x)-1,f>>>=x,p-=x),p<15&&(f+=T[r++]<<p,f+=T[r++]<<(p+=8),p+=8),b=g[f&y];n:for(;;){if(f>>>=x=b>>>24,p-=x,!(16&(x=b>>>16&255))){if(0==(64&x)){b=g[(65535&b)+(f&(1<<x)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(_=65535&b,p<(x&=15)&&(f+=T[r++]<<p,(p+=8)<x&&(f+=T[r++]<<p,p+=8)),(_+=f&(1<<x)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=x,p-=x,_>(x=a-o)){if((x=_-x)>c&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(S=0,E=h,0===d){if(S+=u-x,x<w){w-=x;do{k[a++]=h[S++]}while(--x);S=a-_,E=k}}else if(d<x){if(S+=u+d-x,(x-=d)<w){w-=x;do{k[a++]=h[S++]}while(--x);if(S=0,d<w){w-=x=d;do{k[a++]=h[S++]}while(--x);S=a-_,E=k}}}else if(S+=d-x,x<w){w-=x;do{k[a++]=h[S++]}while(--x);S=a-_,E=k}for(;w>2;)k[a++]=E[S++],k[a++]=E[S++],k[a++]=E[S++],w-=3;w&&(k[a++]=E[S++],w>1&&(k[a++]=E[S++]))}else{S=a-_;do{k[a++]=k[S++],k[a++]=k[S++],k[a++]=k[S++],w-=3}while(w>2);w&&(k[a++]=k[S++],w>1&&(k[a++]=k[S++]))}break}}break}}while(r<i&&a<s);f&=(1<<(p-=(w=p>>3)<<3))-1,e.next_in=r-=w,e.next_out=a,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=a<s?s-a+257:257-(a-s),n.hold=f,n.bits=p}},function(e,t,n){"use strict";var r=n(2),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,l,u,c,d,h){var f,p,m,g,v,y,b,x,w,_=h.bits,S=0,E=0,T=0,k=0,C=0,I=0,O=0,A=0,D=0,M=0,N=null,j=0,R=new r.Buf16(16),P=new r.Buf16(16),F=null,L=0;for(S=0;S<=15;S++)R[S]=0;for(E=0;E<l;E++)R[t[n+E]]++;for(C=_,k=15;k>=1&&0===R[k];k--);if(C>k&&(C=k),0===k)return u[c++]=20971520,u[c++]=20971520,h.bits=1,0;for(T=1;T<k&&0===R[T];T++);for(C<T&&(C=T),A=1,S=1;S<=15;S++)if(A<<=1,(A-=R[S])<0)return-1;if(A>0&&(0===e||1!==k))return-1;for(P[1]=0,S=1;S<15;S++)P[S+1]=P[S]+R[S];for(E=0;E<l;E++)0!==t[n+E]&&(d[P[t[n+E]]++]=E);if(0===e?(N=F=d,y=19):1===e?(N=i,j-=257,F=a,L-=257,y=256):(N=o,F=s,y=-1),M=0,E=0,S=T,v=c,I=C,O=0,m=-1,g=(D=1<<C)-1,1===e&&D>852||2===e&&D>592)return 1;for(;;){b=S-O,d[E]<y?(x=0,w=d[E]):d[E]>y?(x=F[L+d[E]],w=N[j+d[E]]):(x=96,w=0),f=1<<S-O,T=p=1<<I;do{u[v+(M>>O)+(p-=f)]=b<<24|x<<16|w|0}while(0!==p);for(f=1<<S-1;M&f;)f>>=1;if(0!==f?(M&=f-1,M+=f):M=0,E++,0==--R[S]){if(S===k)break;S=t[n+d[E]]}if(S>C&&(M&g)!==m){for(0===O&&(O=C),v+=T,A=1<<(I=S-O);I+O<k&&!((A-=R[I+O])<=0);)I++,A<<=1;if(D+=1<<I,1===e&&D>852||2===e&&D>592)return 1;u[m=M&g]=C<<24|I<<16|v-c|0}}return 0!==M&&(u[v+M]=S-O<<24|64<<16|0),h.bits=C,0}},function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(16));t.default=function(e){r.default.register(e)}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t,n,r){var i=r*e+t,a=n*e+t;return{windowCenter:(i+a)/2,windowWidth:i-a}}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=r(n(25)),l=r(n(26)),u=r(n(64)),c=r(n(65)),d=n(15),h=r(n(27)),f=r(n(8)),p=r(n(28)),m=r(n(9)),g=Symbol("decompress"),v=Symbol("readMetaData"),y=Symbol("readImageData"),b=Symbol("determineImageDependentMetaData"),x=Symbol("transformImageData"),w=Symbol("createVolume"),_=Symbol("cacheVolume"),S=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e),this.volumeCache=new l.default,this.volumePromises={},this.wholeFileFetcher=new u.default({headers:n}),this.headerOnlyFetcher=new u.default({isFirstBytesOnly:!0,headers:n,beforeSend:function(e){return e.setRequestHeader("Range","bytes=0-10240")},onHeadersReceived:function(e,n,r){if(200===e.status){var i=f.default.fromURL(r.imageId),a=t.headerOnlyFetcher.getFetchPromiseFromCache(i);t.wholeFileFetcher.addFetchPromiseToCache(a.promise,i)}}})}return o(e,[{key:"acquire",value:function(e){var t=this,n=this.volumePromises[e.filePath];if(n&&n.wholeFilePromise)return n.wholeFilePromise;var r=new Promise((function(n,r){var i=t.volumeCache.get(e);i&&i.hasImageData?n(i):t.wholeFileFetcher.fetch(e).then((function(n){return t[g](n,e)})).then((function(e){return t[v](e)})).then((function(e){return t[y](e)})).then((function(e){return t[x](e)})).then((function(e){return t[b](e)})).then((function(n){return t[w](n,e)})).then((function(n){return t[_](n,e)})).then((function(e){return n(e)})).catch(r)}));return this.volumePromises[e.filePath]=this.volumePromises[e.filePath]||{},this.volumePromises[e.filePath].wholeFilePromise=r,r}},{key:"acquireHeaderOnly",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.volumePromises[e.filePath];if(r)return r.headerOnlyPromise||r.wholeFilePromise;var i=new Promise((function(r,i){var a=t.volumeCache.get(e);a?r(a):(n?t.headerOnlyFetcher:t.wholeFileFetcher).fetch(e).then((function(n){return t[g](n,e)})).then((function(e){return t[v](e)})).then((function(n){return t[w](n,e)})).then((function(n){return t[_](n,e)})).then((function(e){return r(e)})).catch(i)}));return this.volumePromises[e.filePath]=this.volumePromises[e.filePath]||{},this.volumePromises[e.filePath].headerOnlyPromise=i,i}},{key:g,value:function(e,t){return(0,c.default)(e,t)}},{key:v,value:function(e){return{decompressedFileData:e,metaData:(0,d.parseNiftiHeader)(e)}}},{key:y,value:function(e){var t=e.metaData,n=(0,d.parseNiftiFile)(e.decompressedFileData,t),r=n.imageData;Object.assign(t,n.metaData);var i=t.voxelLength,a=t.timeSlices,o=[1,i[0],i[0]*i[1],i[0]*i[1]*i[2]],s=(0,m.default)(r,[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(i),[a]),o),l=(0,p.default)(s);return t.minPixelValue=l.min,t.maxPixelValue=l.max,{metaData:t,imageDataNDarray:s}}},{key:x,value:function(e){var t=e.metaData,n=e.imageDataNDarray;if(t.dataType.isDataInFloat){var r=(0,h.default)(n,t);n=r.convertedImageDataView,Object.assign(t,r.metaData,{floatImageDataNDarray:r.floatImageDataView})}return{metaData:t,imageDataNDarray:n}}},{key:b,value:function(e){var t=e.metaData,n=e.imageDataNDarray;return Object.assign(t,t.isWindowInfoAbsent?a(t.slope,t.intercept,t.minPixelValue,t.maxPixelValue):a(1,0,t.windowMinimumValue,t.windowMaximumValue)),{metaData:t,imageDataNDarray:n}}},{key:w,value:function(e,t){var n=e.metaData;return new s.default(t,n,e.imageDataNDarray,n.floatImageDataNDarray)}},{key:_,value:function(e,t){return this.volumeCache.add(t,e),e}}],[{key:"getInstance",value:function(t){return e.instance||(e.instance=new e(t)),e.instance}}]),e}();t.default=S},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),l=r(n(58)),u=r(n(59)),c=r(n(60)),d=r(n(61)),h=Symbol("determineMetaData"),f=Symbol("determinePixelData"),p=Symbol("getDimensionsIndices"),m=Symbol("getPatientOrientation"),g=Symbol("getPatientPosition"),v=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];a(this,e),this.volume=t,this.imageIdObject=n,this.dimension=n.slice.dimension,this.index=n.slice.index,this.timePoint=r?0:n.timePoint,this.metaData={},this[h](),this.volume.hasImageData&&this[f]()}return o(e,[{key:h,value:function(){var e=this.volume.metaData,t=this[p](this.dimension),n=t.rowsIndex,r=t.columnsIndex,a=t.framesIndex,o=e.voxelLength,s=o[n],l=o[r],u=o[a],c=e.pixelSpacing[n],d=e.pixelSpacing[r],h=e.pixelSpacing[a],f=this[m](e.orientationMatrix,r,n),v=f.rowCosines,y=f.columnCosines,b=this[g](e.orientationMatrix,a);Object.assign(this.metaData,{columns:l,rows:s,numberOfFrames:u,columnsIndex:r,rowsIndex:n,framesIndex:a,columnPixelSpacing:d,rowPixelSpacing:c,slicePixelSpacing:h,columnCosines:y,rowCosines:v,imagePositionPatient:b,imageOrientationPatient:[].concat(i(v),i(y)),frameOfReferenceUID:this.imageIdObject.filePath})}},{key:f,value:function(){var e;this.volume.imageDataNDarray.set(0,0,0,255);var t=(0,u.default)([this.index,null,null],this.metaData.framesIndex),n=this.volume.metaData.dataType.TypedArrayConstructor,r=(e=this.volume.imageDataNDarray).pick.apply(e,i(t).concat([this.timePoint]));if(this.pixelData=(0,l.default)(r,n),this.volume.metaData.dataType.isDataInFloat){var a,o=(a=this.volume.imageDataNDarray).pick.apply(a,i(t).concat([this.timePoint]));this.floatPixelData=(0,l.default)(o,this.volume.metaData.dataType.OriginalTypedArrayConstructor)}}},{key:p,value:function(e){var t=void 0,n=void 0,r=void 0;switch(e){case"x":t="xyz".indexOf("z"),n="xyz".indexOf("y"),r="xyz".indexOf("x");break;case"y":t="xyz".indexOf("z"),n="xyz".indexOf("x"),r="xyz".indexOf("y");break;case"z":t="xyz".indexOf("y"),n="xyz".indexOf("x"),r="xyz".indexOf("z")}return{rowsIndex:t,columnsIndex:n,framesIndex:r}}},{key:m,value:function(e,t,n){var r=[e[0][n],e[1][n],e[2][n]];return{rowCosines:(0,d.default)([e[0][t],e[1][t],e[2][t]]),columnCosines:(0,d.default)(r)}}},{key:g,value:function(e,t){var n=(0,u.default)([this.index,0,0],t);return(0,c.default)(e,n).slice(0,3)}},{key:"cornerstoneImageObject",get:function(){var e=this,t=this.volume.metaData,n=this.metaData,r=s.external.cornerstone;return{imageId:this.imageIdObject.url,color:t.dataType.isDataInColors,columnPixelSpacing:n.columnPixelSpacing,columns:n.columns,height:n.rows,intercept:t.intercept,invert:!1,minPixelValue:t.minPixelValue,maxPixelValue:t.maxPixelValue,rowPixelSpacing:n.rowPixelSpacing,rows:n.rows,sizeInBytes:this.pixelData.byteLength,slope:t.slope,width:n.columns,windowCenter:t.windowCenter,windowWidth:t.windowWidth,floatPixelData:this.floatPixelData,decodeTimeInMS:0,getPixelData:function(){return e.pixelData},render:t.dataType.isDataInColors?r.renderColorImage:r.renderGrayscaleImage}}},{key:"compoundMetaData",get:function(){return Object.assign({},this.volume.metaData,this.metaData)}}]),e}();t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=new(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Array)(e.size),n=0,r=0;r<e.shape[1];++r)for(var i=0;i<e.shape[0];++i)t[n++]=e.get(i,r);return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;t-- >0;)e.unshift(e.pop());return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3]||1;return[n*e[0][0]+r*e[0][1]+i*e[0][2]+a*e[0][3],n*e[1][0]+r*e[1][1]+i*e[1][2]+a*e[1][3],n*e[2][0]+r*e[2][1]+i*e[2][2]+a*e[2][3],n*e[3][0]+r*e[3][1]+i*e[3][2]+a*e[3][3]]}},function(e,t,n){"use strict";function r(e,t){return e+t*t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.reduce(r,0),n=Math.sqrt(t);return 0===n&&(n=1),e.map((function(e){return e/n}))}},function(e,t,n){"use strict";e.exports=function(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=n;return t}},function(e,t){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(n(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}(e)||!!e._isBuffer)}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n,r){return function(i){var a=i.loaded,s=void 0,l=void 0;i.lengthComputable&&(s=i.total,l=Math.round(a/s*100)),o(n.onprogress,i,r),u.default.imageLoadProgress({url:e,imageId:t,loaded:a,total:s,percentComplete:l})}}function a(e,t){return function(n){o(e.onreadystatechange,n,t),e.onreadystatechange||(2===this.readyState&&e.onHeadersReceived&&e.onHeadersReceived(this,e,t),4!==this.readyState)||([200,206].includes(this.status)?t.deferred.resolve(this.response):t.deferred.reject(new Error("Could not fetch the file '"+t.url+"'. Error code was "+this.status+".")))}}function o(e,t,n){e&&e(t,n)}function s(){}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e){return e&&e.__esModule?e:{default:e}}(n(14)),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.method,i=void 0===n?"GET":n,a=t.responseType,o=void 0===a?"arraybuffer":a,l=t.beforeSend,u=void 0===l?s:l,c=t.headers,d=void 0===c?{}:c,h=t.onHeadersReceived,f=void 0===h?s:h;r(this,e),this.options={method:i,responseType:o,beforeSend:u,headers:d,onHeadersReceived:f},this.promisesCache={}}return l(e,[{key:"fetch",value:function(e){var t=this,n=this.getFetchPromiseFromCache(e),r=void 0;return n?r=n.promise:(r=new Promise((function(n,r){var o=new XMLHttpRequest,s={deferred:{resolve:n,reject:r},url:e.filePath,imageId:e.url};o.open(t.options.method,e.filePath,!0),o.responseType=t.options.responseType,"function"==typeof t.options.beforeSend&&t.options.beforeSend(o,e.url),Object.keys(t.options.headers).forEach((function(e){o.setRequestHeader(e,t.options.headers[e])})),o.addEventListener("readystatechange",a(t.options,s)),o.addEventListener("progress",i(e.filePath,e.url,t.options,s)),o.send()})),this.addFetchPromiseToCache(r,e)),r}},{key:"getFetchPromiseFromCache",value:function(e){var t=this,n=this.promisesCache[e.filePath];return Array.isArray(n)&&n.find((function(e){return e.fetcher===t}))}},{key:"addFetchPromiseToCache",value:function(e,t){this.promisesCache[t.filePath]=this.promisesCache[t.filePath]||[],this.promisesCache[t.filePath].unshift(new d(this,t,e))}}]),e}();t.default=c;var d=function e(t,n,i){r(this,e),this.fetcher=t,this.imageIdObject=n,this.promise=i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=r.nifti,i=e;if(n.isCompressed(e)&&(i=n.decompress(e)),!n.isNIFTI(i))throw new Error("The file '"+t.filePath+"' is not a valid NIFTI file.");return i};var r={nifti:n(1).external.niftiReader}},function(e,t,n){"use strict";function r(e){return e>>8&255|e<<8&65280}function i(e){return e>>24&255|e>>8&65280|e<<8&16711680|e<<24&4278190080}function a(e){return e>>56&255|e>>40&65280|e>>24&16711680|e>>8&4278190080|e<<8&0xff00000000|e<<24&0xff0000000000|e<<40&0xff000000000000|e<<56&0xff00000000000000}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=o.external.niftiReader;switch(e){case n.NIFTI1.TYPE_INT16:case n.NIFTI1.TYPE_UINT16:t=function(e){for(var t=0;t<e.length;t++)e[t]=r(e[t]);return e}(t);break;case n.NIFTI1.TYPE_RGB24:t=t;break;case n.NIFTI1.TYPE_INT32:case n.NIFTI1.TYPE_FLOAT32:case n.NIFTI1.TYPE_UINT32:t=function(e){for(var t=0;t<e.length;t++)e[t]=i(e[t]);return e}(t);break;case n.NIFTI1.TYPE_COMPLEX64:case n.NIFTI1.TYPE_FLOAT64:case n.NIFTI1.TYPE_INT64:case n.NIFTI1.TYPE_UINT64:t=function(e){for(var t=0;t<e.length;t++)e[t]=a(e[t]);return e}(t);break;case n.NIFTI1.TYPE_FLOAT128:case n.NIFTI1.TYPE_COMPLEX128:t=t;break;case n.NIFTI1.TYPE_COMPLEX256:t=t}return t};var o=n(1)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t,n,r){var i=r*e+t,a=n*e+t;return{windowCenter:(i+a)/2,windowWidth:i-a}}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=r(n(25)),l=r(n(26)),u=n(15),c=r(n(27)),d=r(n(8)),h=r(n(28)),f=r(n(29)),p=r(n(68)),m=r(n(9)),g=Symbol("readImageData"),v=Symbol("determineImageDependentMetaData"),y=Symbol("transformImageData"),b=Symbol("createVolume"),x=Symbol("cacheVolume"),w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e),this.volumeCache=new l.default,this.volumeFetchers={},this.httpHeaders=t}return o(e,[{key:"acquireTimepoint",value:function(e){var t=this,n=this.volumeCache.getTimepoint(e,e.timePoint);if(!n||!n.hasImageData){var r=this.getFetcherData(e);if(r.timePointPromises[e.timePoint])return r.timePointPromises[e.timePoint];var i=new Promise((function(n,i){r.volumeFetcher.fetchTimepoint(e.timePoint).then((function(e){return t[g](e)})).then((function(e){return t[y](e)})).then((function(e){return t[v](e)})).then((function(n){return t[b](n,e)})).then((function(n){return t[x](n,e)})).then((function(e){return n(e)})).catch(i)}));return r.timePointPromises[e.timePoint]=i,i}Promise.resolve(n)}},{key:"acquireHeaderOnly",value:function(e){var t=this,n=this.getFetcherData(e);if(n.headerPromise)return n.headerPromise;var r=new Promise((function(r,i){var a=t.volumeCache.getTimepoint(e,e.timePoint);a?r(a):n.volumeFetcher.getHeaderPromise().then((function(n){return t[b](n,e)})).then((function(n){return t[x](n,e)})).then((function(e){return r(e)})).catch(i)}));return this.volumeFetchers[e.filePath]=this.volumeFetchers[e.filePath]||{},this.volumeFetchers[e.filePath].headerOnlyPromise=r,r}},{key:g,value:function(e){var t=e.metaData,n=(0,f.default)(e.headerData,e.volumeData),r=(0,u.parseNiftiFile)(n.buffer,null),i=r.imageData;Object.assign(t,r.metaData);var a=t.voxelLength,o=[1,a[0],a[0]*a[1],a[0]*a[1]*a[2]],s=(0,m.default)(i,[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(a),[1]),o),l=(0,h.default)(s);return t.minPixelValue=l.min,t.maxPixelValue=l.max,{metaData:t,imageDataNDarray:s}}},{key:y,value:function(e){var t=e.metaData,n=e.imageDataNDarray;if(t.dataType.isDataInFloat){var r=(0,c.default)(n,t);n=r.convertedImageDataView,Object.assign(t,r.metaData,{floatImageDataNDarray:r.floatImageDataView})}return{metaData:t,imageDataNDarray:n}}},{key:v,value:function(e){var t=e.metaData,n=e.imageDataNDarray;return Object.assign(t,t.isWindowInfoAbsent?a(t.slope,t.intercept,t.minPixelValue,t.maxPixelValue):a(1,0,t.windowMinimumValue,t.windowMaximumValue)),{metaData:t,imageDataNDarray:n}}},{key:b,value:function(e,t){var n=e.metaData,r=e.imageDataNDarray,i=new d.default(t.filePath,t.slice,0);return new s.default(i,n,r,n.floatImageDataNDarray,!0)}},{key:x,value:function(e,t){return this.volumeCache.add(t,e),e}},{key:"getFetcherData",value:function(e){return this.volumeFetchers[""+e.filePath]=this.volumeFetchers[""+e.filePath]||{headerPromise:null,timePointPromises:[],volumeFetcher:new p.default(e,{headers:this.httpHeaders})},this.volumeFetchers[""+e.filePath]}}],[{key:"getInstance",value:function(t){return e.instance||(e.instance=new e(t)),e.instance}}]),e}();t.default=w},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(){}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),l=r(n(19)),u=r(n(69)),c=n(15),d=r(n(29)),h=s.external.niftiReader,f=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.method,o=void 0===r?"GET":r,s=n.responseType,l=void 0===s?"arraybuffer":s,u=n.beforeSend,c=void 0===u?a:u,d=n.headers,h=void 0===d?{}:d,f=n.onHeadersReceived,p=void 0===f?a:f;i(this,e),this.imageId=t,this.options={method:o,responseType:l,beforeSend:c,headers:h,onHeadersReceived:p},this.volumeData=e.createDefaultVolumeData()}return o(e,[{key:"fetchTimepoint",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.ensureStreaming(this.imageId),new Promise((function(r,i){try{t.getHeaderPromise().then((function(a){var o=e.getVolumeTimepointDataLength(a);t.getBufferPromise(t.volumeData.headerOffset+n*o,o).then((function(e){r({headerData:a.headerData,volumeData:e,metaData:a.metaData})})).catch(i)}))}catch(e){i(e)}}))}},{key:"ensureStreaming",value:function(t){var n=this.volumeData;if(!n.streamer){var r=new u.default(this.options);n.streamer=r,e.runStreamer(t,n)}}},{key:"getHeaderPromise",value:function(){this.ensureStreaming(this.imageId);var e=this.volumeData;return e.header?Promise.resolve(e.header):e.headerPromise}},{key:"getBufferPromise",value:function(e,t){var n=this;return this.ensureStreaming(this.imageId),new Promise((function(r,i){n.volumeData.dataStreamedLength>=t?r(n.volumeData.buffer.slice(e,e+t)):n.volumeData.bufferPromiseEntries.push({offset:e,length:t,promise:{resolve:r,reject:i}})}))}}],[{key:"runStreamer",value:function(t,n){n.streamer.stream(t,(function(t){if(!n.headerParsed){if(!e.tryParseHeader(n,t))return;return n.headerPromiseMethods.resolve(n.header),e.evaluatePromises(n),void(n.headerParsed=!0)}n.isCompressed&&(t=e.uncompress(n,t)),e.addToImageDataBuffer(n,t),e.evaluatePromises(n)}))}},{key:"evaluatePromises",value:function(e){for(var t=e.bufferPromiseEntries.length-1;t>=0;){var n=e.bufferPromiseEntries[t];e.dataStreamedLength>=n.offset+n.length&&(e.bufferPromiseEntries.splice(t,1),n.promise.resolve(e.buffer.slice(n.offset,n.offset+n.length))),t--}}},{key:"createDefaultVolumeData",value:function(){var e={},t=new Promise((function(t,n){e.resolve=t,e.reject=n}));return{streamer:null,buffer:new Uint8Array(0),bufferPromiseEntries:[],dataStreamedLength:0,isCompressed:!1,tmpBuffer:new Uint8Array(0),headerParsed:!1,inflator:new l.default.Inflate,headerPromise:t,headerPromiseMethods:e,headerOffset:352}}},{key:"parseHeaderData",value:function(e){return{headerData:e,metaData:(0,c.parseNiftiHeader)(e.buffer)}}},{key:"uncompress",value:function(e,t){return 0===t.length?t:(e.inflator.push(t,l.default.Z_SYNC_FLUSH),e.inflator.result)}},{key:"addToImageDataBuffer",value:function(e,t){e.dataStreamedLength+t.length>e.buffer.length?e.buffer=(0,d.default)(e.buffer,t):e.buffer.set(t,e.dataStreamedLength),e.dataStreamedLength+=t.length}},{key:"tryParseHeader",value:function(t,n){if(t.isHeaderTypeKnown){t.isCompressed&&(n=e.uncompress(t,n)),e.addToImageDataBuffer(t,n);var r=t.dataStreamedLength>=t.headerOffset;if(r){t.header=e.parseHeaderData(t.buffer.slice(0,t.headerOffset));var i=e.createVolumeBuffer(t);i.set(t.buffer),t.buffer=i}return r}if(t.tmpBuffer.length+n.length<t.headerOffset)return t.tmpBuffer=(0,d.default)(t.tmpBuffer,n),!1;var a=(0,d.default)(t.tmpBuffer,n);if(t.isCompressed=h.isCompressed(a.buffer),t.isCompressed){var o=new l.default.Inflate;o.push(a,l.default.Z_SYNC_FLUSH),a=o.result}var s=new DataView(a.buffer),u=!1,c=h.Utils.getIntAt(s,0,u);return h.isNIFTI2(a.buffer)?(c!==h.NIFTI2.MAGIC_COOKIE&&(u=!0),t.headerOffset=h.Utils.getLongAt(s,168,u)):(c!==h.NIFTI1.MAGIC_COOKIE&&(u=!0),t.headerOffset=h.Utils.getFloatAt(s,108,u)),t.isHeaderTypeKnown=!0,t.buffer=t.isCompressed?e.uncompress(t,t.tmpBuffer):t.tmpBuffer,t.dataStreamedLength=t.buffer.length,t.tmpBuffer=void 0,e.tryParseHeader(t,n)}},{key:"createVolumeBuffer",value:function(t){var n=e.getVolumeTimepointDataLength(t.header),r=new ArrayBuffer(t.headerOffset+n*t.header.metaData.timeSlices);return new Uint8Array(r)}},{key:"getVolumeTimepointDataLength",value:function(e){var t=e.metaData.header.dims,n=1;return t[5]&&(n=t[5]),t[1]*t[2]*t[3]*1*n*(e.metaData.header.numBitsPerVoxel/8)}}]),e}();t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(70)),a=function(e){return e&&e.__esModule?e:{default:e}}(n(14)),o=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.options={headers:t&&t.headers||{}}}return r(e,[{key:"stream",value:function(e,t){var n=this;return new Promise((function(r,o){var s={promise:{resolve:r,reject:o},url:e.filePath,imageId:e.url};i.get({path:e.filePath,headers:n.options.headers},(function(i){var o=i.headers["Content-Length"]||i.headers["content-length"]||0,l=function(e,t,n,r){return function(i){var o=i.detail.loaded,s=i.detail.total,l=Math.round(o/s*100);(function(e,t,n){e&&e(t,n)})(n.onprogress,i,r),a.default.imageLoadProgress({url:e,imageId:t,loaded:o,total:s,percentComplete:l})}}(e.filePath,e.url,n.options,s),u=0;i.on("data",(function(n){l({detail:{loaded:u+=n.length,total:o}}),t(n,e)})),i.on("end",(function(){r()}))})).on("error",(function(t){o(new Error("Could not fetch the file '"+e.url+"'. Error description: "+t+"."))}))}))}}]),e}();t.default=o},function(e,t,n){(function(e){var r=n(71),i=n(32),a=n(81),o=n(82),s=n(83),l=t;l.request=function(t,n){t="string"==typeof t?s.parse(t):a(t);var i=-1===e.location.protocol.search(/^https?:$/)?"http:":"",o=t.protocol||i,l=t.hostname||t.host,u=t.port,c=t.path||"/";l&&-1!==l.indexOf(":")&&(l="["+l+"]"),t.url=(l?o+"//"+l:"")+(u?":"+u:"")+c,t.method=(t.method||"GET").toUpperCase(),t.headers=t.headers||{};var d=new r(t);return n&&d.on("response",n),d},l.get=function(e,t){var n=l.request(e,t);return n.end(),n},l.ClientRequest=r,l.IncomingMessage=i,l.Agent=function(){},l.Agent.defaultMaxSockets=4,l.STATUS_CODES=o,l.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(t,n(0))},function(e,t,n){(function(t,r,i){var a=n(31),o=n(3),s=n(32),l=n(33),u=n(80),c=s.IncomingMessage,d=s.readyStates,h=e.exports=function(e){var n=this;l.Writable.call(n),n._opts=e,n._body=[],n._headers={},e.auth&&n.setHeader("Authorization","Basic "+new t(e.auth).toString("base64")),Object.keys(e.headers).forEach((function(t){n.setHeader(t,e.headers[t])}));var r,i=!0;if("disable-fetch"===e.mode||"requestTimeout"in e&&!a.abortController)i=!1,r=!0;else if("prefer-streaming"===e.mode)r=!1;else if("allow-wrong-content-type"===e.mode)r=!a.overrideMimeType;else{if(e.mode&&"default"!==e.mode&&"prefer-fast"!==e.mode)throw new Error("Invalid value for opts.mode");r=!0}n._mode=function(e,t){return a.fetch&&t?"fetch":a.mozchunkedarraybuffer?"moz-chunked-arraybuffer":a.msstream?"ms-stream":a.arraybuffer&&e?"arraybuffer":a.vbArray&&e?"text:vbarray":"text"}(r,i),n.on("finish",(function(){n._onFinish()}))};o(h,l.Writable),h.prototype.setHeader=function(e,t){var n=e.toLowerCase();-1===f.indexOf(n)&&(this._headers[n]={name:e,value:t})},h.prototype.getHeader=function(e){var t=this._headers[e.toLowerCase()];return t?t.value:null},h.prototype.removeHeader=function(e){delete this._headers[e.toLowerCase()]},h.prototype._onFinish=function(){var e=this;if(!e._destroyed){var n=e._opts,o=e._headers,s=null;"GET"!==n.method&&"HEAD"!==n.method&&(s=a.arraybuffer?u(t.concat(e._body)):a.blobConstructor?new r.Blob(e._body.map((function(e){return u(e)})),{type:(o["content-type"]||{}).value||""}):t.concat(e._body).toString());var l=[];if(Object.keys(o).forEach((function(e){var t=o[e].name,n=o[e].value;Array.isArray(n)?n.forEach((function(e){l.push([t,e])})):l.push([t,n])})),"fetch"===e._mode){var c=null;if(a.abortController){var h=new AbortController;c=h.signal,e._fetchAbortController=h,"requestTimeout"in n&&0!==n.requestTimeout&&r.setTimeout((function(){e.emit("requestTimeout"),e._fetchAbortController&&e._fetchAbortController.abort()}),n.requestTimeout)}r.fetch(e._opts.url,{method:e._opts.method,headers:l,body:s||void 0,mode:"cors",credentials:n.withCredentials?"include":"same-origin",signal:c}).then((function(t){e._fetchResponse=t,e._connect()}),(function(t){e.emit("error",t)}))}else{var f=e._xhr=new r.XMLHttpRequest;try{f.open(e._opts.method,e._opts.url,!0)}catch(t){return void i.nextTick((function(){e.emit("error",t)}))}"responseType"in f&&(f.responseType=e._mode.split(":")[0]),"withCredentials"in f&&(f.withCredentials=!!n.withCredentials),"text"===e._mode&&"overrideMimeType"in f&&f.overrideMimeType("text/plain; charset=x-user-defined"),"requestTimeout"in n&&(f.timeout=n.requestTimeout,f.ontimeout=function(){e.emit("requestTimeout")}),l.forEach((function(e){f.setRequestHeader(e[0],e[1])})),e._response=null,f.onreadystatechange=function(){switch(f.readyState){case d.LOADING:case d.DONE:e._onXHRProgress()}},"moz-chunked-arraybuffer"===e._mode&&(f.onprogress=function(){e._onXHRProgress()}),f.onerror=function(){e._destroyed||e.emit("error",new Error("XHR error"))};try{f.send(s)}catch(t){return void i.nextTick((function(){e.emit("error",t)}))}}}},h.prototype._onXHRProgress=function(){var e=this;(function(e){try{var t=e.status;return null!==t&&0!==t}catch(e){return!1}})(e._xhr)&&!e._destroyed&&(e._response||e._connect(),e._response._onXHRProgress())},h.prototype._connect=function(){var e=this;e._destroyed||(e._response=new c(e._xhr,e._fetchResponse,e._mode),e._response.on("error",(function(t){e.emit("error",t)})),e.emit("response",e._response))},h.prototype._write=function(e,t,n){this._body.push(e),n()},h.prototype.abort=h.prototype.destroy=function(){var e=this;e._destroyed=!0,e._response&&(e._response._destroyed=!0),e._xhr?e._xhr.abort():e._fetchAbortController&&e._fetchAbortController.abort()},h.prototype.end=function(e,t,n){"function"==typeof e&&(n=e,e=void 0),l.Writable.prototype.end.call(this,e,t,n)},h.prototype.flushHeaders=function(){},h.prototype.setTimeout=function(){},h.prototype.setNoDelay=function(){},h.prototype.setSocketKeepAlive=function(){};var f=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"]}).call(t,n(6).Buffer,n(0),n(4))},function(e,t,n){"use strict";function r(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function i(e){return o[e>>18&63]+o[e>>12&63]+o[e>>6&63]+o[63&e]}function a(e,t,n){for(var r=[],a=t;a<n;a+=3)r.push(i((e[a]<<16)+(e[a+1]<<8)+e[a+2]));return r.join("")}t.byteLength=function(e){return 3*e.length/4-r(e)},t.toByteArray=function(e){var t,n,i,a,o,u=e.length;a=r(e),o=new l(3*u/4-a),n=a>0?u-4:u;var c=0;for(t=0;t<n;t+=4)i=s[e.charCodeAt(t)]<<18|s[e.charCodeAt(t+1)]<<12|s[e.charCodeAt(t+2)]<<6|s[e.charCodeAt(t+3)],o[c++]=i>>16&255,o[c++]=i>>8&255,o[c++]=255&i;return 2===a?(i=s[e.charCodeAt(t)]<<2|s[e.charCodeAt(t+1)]>>4,o[c++]=255&i):1===a&&(i=s[e.charCodeAt(t)]<<10|s[e.charCodeAt(t+1)]<<4|s[e.charCodeAt(t+2)]>>2,o[c++]=i>>8&255,o[c++]=255&i),o},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,i="",s=[],l=0,u=n-r;l<u;l+=16383)s.push(a(e,l,l+16383>u?u:l+16383));return 1===r?(i+=o[(t=e[n-1])>>2],i+=o[t<<4&63],i+="=="):2===r&&(i+=o[(t=(e[n-2]<<8)+e[n-1])>>10],i+=o[t>>4&63],i+=o[t<<2&63],i+="="),s.push(i),s.join("")};for(var o=[],s=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,d=u.length;c<d;++c)o[c]=u[c],s[u.charCodeAt(c)]=c;s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,l=(1<<s)-1,u=l>>1,c=-7,d=n?i-1:0,h=n?-1:1,f=e[t+d];for(d+=h,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+e[t+d],d+=h,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=r;c>0;o=256*o+e[t+d],d+=h,c-=8);if(0===a)a=1-u;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),a-=u}return(f?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,l,u=8*a-i-1,c=(1<<u)-1,d=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:a-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+d>=1?h/l:h*Math.pow(2,1-d))*l>=2&&(o++,l/=2),o+d>=c?(s=0,o=c):o+d>=1?(s=(t*l-1)*Math.pow(2,i),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[n+f]=255&o,f+=p,o/=256,u-=8);e[n+f-p]|=128*m}},function(e,t){},function(e,t,n){"use strict";function r(e,t,n){e.copy(t,n)}var i=n(11).Buffer;e.exports=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return this.head=1===this.length?this.tail=null:this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var t=i.allocUnsafe(e>>>0),n=this.head,a=0;n;)r(n.data,t,a),a+=n.data.length,n=n.next;return t},e}()},function(e,t,n){function r(e,t){this._id=e,this._clearFn=t}var i=Function.prototype.apply;t.setTimeout=function(){return new r(i.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new r(i.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(77),t.setImmediate=setImmediate,t.clearImmediate=clearImmediate},function(e,t,n){(function(e,t){!function(e,n){"use strict";function r(e){delete s[e]}function i(e){if(l)setTimeout(i,0,e);else{var t=s[e];if(t){l=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{r(e),l=!1}}}}if(!e.setImmediate){var a,o=1,s={},l=!1,u=e.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(e);c=c&&c.setTimeout?c:e,"[object process]"==={}.toString.call(e.process)?a=function(e){t.nextTick((function(){i(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&i(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),a=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){i(e.data)},a=function(t){e.port2.postMessage(t)}}():u&&"onreadystatechange"in u.createElement("script")?function(){var e=u.documentElement;a=function(t){var n=u.createElement("script");n.onreadystatechange=function(){i(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():a=function(e){setTimeout(i,0,e)},c.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];return s[o]={callback:e,args:t},a(o),o++},c.clearImmediate=r}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,n(0),n(4))},function(e,t,n){(function(t){function n(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(t,n(0))},function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);i.call(this,e)}e.exports=r;var i=n(40),a=n(7);a.inherits=n(3),a.inherits(r,i),r.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){var r=n(6).Buffer;e.exports=function(e){if(e instanceof Uint8Array){if(0===e.byteOffset&&e.byteLength===e.buffer.byteLength)return e.buffer;if("function"==typeof e.buffer.slice)return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}if(r.isBuffer(e)){for(var t=new Uint8Array(e.length),n=e.length,i=0;i<n;i++)t[i]=e[i];return t.buffer}throw new Error("Argument must be a Buffer")}},function(e,t){e.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var i in r)n.call(r,i)&&(e[i]=r[i])}return e};var n=Object.prototype.hasOwnProperty},function(e,t){e.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},function(e,t,n){"use strict";function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function i(e,t,n){if(e&&o.isObject(e)&&e instanceof r)return e;var i=new r;return i.parse(e,t,n),i}var a=n(84),o=n(86);t.parse=i,t.resolve=function(e,t){return i(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?i(e,!1,!0).resolveObject(t):t},t.format=function(e){return o.isString(e)&&(e=i(e)),e instanceof r?e.format():r.prototype.format.call(e)},t.Url=r;var s=/^([a-z0-9.+-]+:)/i,l=/:[0-9]*$/,u=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),d=["'"].concat(c),h=["%","/","?",";","#"].concat(d),f=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},b=n(87);r.prototype.parse=function(e,t,n){if(!o.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),i=-1!==r&&r<e.indexOf("#")?"?":"#",l=e.split(i);l[0]=l[0].replace(/\\/g,"/");var c=e=l.join(i);if(c=c.trim(),!n&&1===e.split("#").length){var x=u.exec(c);if(x)return this.path=c,this.href=c,this.pathname=x[1],x[2]?(this.search=x[2],this.query=t?b.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var w=s.exec(c);if(w){var _=(w=w[0]).toLowerCase();this.protocol=_,c=c.substr(w.length)}if(n||w||c.match(/^\/\/[^@\/]+@[^@\/]+/)){var S="//"===c.substr(0,2);!S||w&&v[w]||(c=c.substr(2),this.slashes=!0)}if(!v[w]&&(S||w&&!y[w])){for(var E=-1,T=0;T<f.length;T++)-1!==(I=c.indexOf(f[T]))&&(-1===E||I<E)&&(E=I);var k,C;for(-1!==(C=-1===E?c.lastIndexOf("@"):c.lastIndexOf("@",E))&&(k=c.slice(0,C),c=c.slice(C+1),this.auth=decodeURIComponent(k)),E=-1,T=0;T<h.length;T++){var I;-1!==(I=c.indexOf(h[T]))&&(-1===E||I<E)&&(E=I)}-1===E&&(E=c.length),this.host=c.slice(0,E),c=c.slice(E),this.parseHost(),this.hostname=this.hostname||"";var O="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!O)for(var A=this.hostname.split(/\./),D=(T=0,A.length);T<D;T++){var M=A[T];if(M&&!M.match(p)){for(var N="",j=0,R=M.length;j<R;j++)M.charCodeAt(j)>127?N+="x":N+=M[j];if(!N.match(p)){var P=A.slice(0,T),F=A.slice(T+1),L=M.match(m);L&&(P.push(L[1]),F.unshift(L[2])),F.length&&(c="/"+F.join(".")+c),this.hostname=P.join(".");break}}}this.hostname=this.hostname.length>255?"":this.hostname.toLowerCase(),O||(this.hostname=a.toASCII(this.hostname)),this.host=(this.hostname||"")+(this.port?":"+this.port:""),this.href+=this.host,O&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==c[0]&&(c="/"+c))}if(!g[_])for(T=0,D=d.length;T<D;T++){var $=d[T];if(-1!==c.indexOf($)){var B=encodeURIComponent($);B===$&&(B=escape($)),c=c.split($).join(B)}}var z=c.indexOf("#");-1!==z&&(this.hash=c.substr(z),c=c.slice(0,z));var U=c.indexOf("?");return-1!==U?(this.search=c.substr(U),this.query=c.substr(U+1),t&&(this.query=b.parse(this.query)),c=c.slice(0,U)):t&&(this.search="",this.query={}),c&&(this.pathname=c),y[_]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(this.path=(this.pathname||"")+(this.search||"")),this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,a="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&o.isObject(this.query)&&Object.keys(this.query).length&&(a=b.stringify(this.query));var s=this.search||a&&"?"+a||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||y[t])&&!1!==i?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),t+i+(n=n.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(s=s.replace("#","%23"))+r},r.prototype.resolve=function(e){return this.resolveObject(i(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if(o.isString(e)){var t=new r;t.parse(e,!1,!0),e=t}for(var n=new r,i=Object.keys(this),a=0;a<i.length;a++){var s=i[a];n[s]=this[s]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),u=0;u<l.length;u++){var c=l[u];"protocol"!==c&&(n[c]=e[c])}return y[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!y[e.protocol]){for(var d=Object.keys(e),h=0;h<d.length;h++){var f=d[h];n[f]=e[f]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||v[e.protocol])n.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}return n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,(n.pathname||n.search)&&(n.path=(n.pathname||"")+(n.search||"")),n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var m=n.pathname&&"/"===n.pathname.charAt(0),g=e.host||e.pathname&&"/"===e.pathname.charAt(0),b=g||m||n.host&&e.pathname,x=b,w=n.pathname&&n.pathname.split("/")||[],_=(p=e.pathname&&e.pathname.split("/")||[],n.protocol&&!y[n.protocol]);if(_&&(n.hostname="",n.port=null,n.host&&(""===w[0]?w[0]=n.host:w.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),b=b&&(""===p[0]||""===w[0])),g)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,w=p;else if(p.length)w||(w=[]),w.pop(),w=w.concat(p),n.search=e.search,n.query=e.query;else if(!o.isNullOrUndefined(e.search))return _&&(n.hostname=n.host=w.shift(),(C=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=C.shift(),n.host=n.hostname=C.shift())),n.search=e.search,n.query=e.query,o.isNull(n.pathname)&&o.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!w.length)return n.pathname=null,n.path=n.search?"/"+n.search:null,n.href=n.format(),n;for(var S=w.slice(-1)[0],E=(n.host||e.host||w.length>1)&&("."===S||".."===S)||""===S,T=0,k=w.length;k>=0;k--)"."===(S=w[k])?w.splice(k,1):".."===S?(w.splice(k,1),T++):T&&(w.splice(k,1),T--);if(!b&&!x)for(;T--;T)w.unshift("..");!b||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),E&&"/"!==w.join("/").substr(-1)&&w.push("");var C,I=""===w[0]||w[0]&&"/"===w[0].charAt(0);return _&&(n.hostname=n.host=I?"":w.length?w.shift():"",(C=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=C.shift(),n.host=n.hostname=C.shift())),(b=b||n.host&&w.length)&&!I&&w.unshift(""),w.length?n.pathname=w.join("/"):(n.pathname=null,n.path=null),o.isNull(n.pathname)&&o.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var e=this.host,t=l.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,n){(function(e,r){var i;!function(r){function a(e){throw new RangeError(I[e])}function o(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function s(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+o((e=e.replace(C,".")).split("."),t).join(".")}function l(e){for(var t,n,r=[],i=0,a=e.length;i<a;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<a?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function u(e){return o(e,(function(e){var t="";return e>65535&&(t+=D((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+D(e)})).join("")}function c(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:v}function d(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function h(e,t,n){var r=0;for(e=n?A(e/w):e>>1,e+=A(e/t);e>O*b>>1;r+=v)e=A(e/O);return A(r+(O+1)*e/(e+x))}function f(e){var t,n,r,i,o,s,l,d,f,p,m=[],x=e.length,w=0,T=S,k=_;for((n=e.lastIndexOf(E))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&a("not-basic"),m.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<x;){for(o=w,s=1,l=v;i>=x&&a("invalid-input"),((d=c(e.charCodeAt(i++)))>=v||d>A((g-w)/s))&&a("overflow"),w+=d*s,!(d<(f=l<=k?y:l>=k+b?b:l-k));l+=v)s>A(g/(p=v-f))&&a("overflow"),s*=p;k=h(w-o,t=m.length+1,0==o),A(w/t)>g-T&&a("overflow"),T+=A(w/t),w%=t,m.splice(w++,0,T)}return u(m)}function p(e){var t,n,r,i,o,s,u,c,f,p,m,x,w,T,k,C=[];for(x=(e=l(e)).length,t=S,n=0,o=_,s=0;s<x;++s)(m=e[s])<128&&C.push(D(m));for(r=i=C.length,i&&C.push(E);r<x;){for(u=g,s=0;s<x;++s)(m=e[s])>=t&&m<u&&(u=m);for(u-t>A((g-n)/(w=r+1))&&a("overflow"),n+=(u-t)*w,t=u,s=0;s<x;++s)if((m=e[s])<t&&++n>g&&a("overflow"),m==t){for(c=n,f=v;!(c<(p=f<=o?y:f>=o+b?b:f-o));f+=v)C.push(D(d(p+(k=c-p)%(T=v-p),0))),c=A(k/T);C.push(D(d(c,0))),o=h(n,w,r==i),n=0,++r}++n,++t}return C.join("")}var m,g=2147483647,v=36,y=1,b=26,x=38,w=700,_=72,S=128,E="-",T=/^xn--/,k=/[^\x20-\x7E]/,C=/[\x2E\u3002\uFF0E\uFF61]/g,I={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},O=v-y,A=Math.floor,D=String.fromCharCode;m={version:"1.4.1",ucs2:{decode:l,encode:u},decode:f,encode:p,toASCII:function(e){return s(e,(function(e){return k.test(e)?"xn--"+p(e):e}))},toUnicode:function(e){return s(e,(function(e){return T.test(e)?f(e.slice(4).toLowerCase()):e}))}},void 0!==(i=(function(){return m}).call(t,n,t,e))&&(e.exports=i)}()}).call(t,n(85)(e),n(0))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,n){"use strict";t.decode=t.parse=n(88),t.encode=t.stringify=n(89)},function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,a){n=n||"=";var o={};if("string"!=typeof e||0===e.length)return o;var s=/\+/g;e=e.split(t=t||"&");var l=1e3;a&&"number"==typeof a.maxKeys&&(l=a.maxKeys);var u=e.length;l>0&&u>l&&(u=l);for(var c=0;c<u;++c){var d,h,f,p,m=e[c].replace(s,"%20"),g=m.indexOf(n);g>=0?(d=m.substr(0,g),h=m.substr(g+1)):(d=m,h=""),f=decodeURIComponent(d),p=decodeURIComponent(h),r(o,f)?i(o[f])?o[f].push(p):o[f]=[o[f],p]:o[f]=p}return o};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";function r(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?r(o(e),(function(o){var s=encodeURIComponent(i(o))+n;return a(e[o])?r(e[o],(function(e){return s+encodeURIComponent(i(e))})).join(t):s+encodeURIComponent(i(e[o]))})).join(t):s?encodeURIComponent(i(s))+n+encodeURIComponent(i(e)):""};var a=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if("function"!=typeof e.state){var t="pending";e.then((function(e){return t="resolved",e}),(function(e){return t="rejected",e})),e.state=function(){return t}}return e}}])},XPeR:function(e,t,n){"use strict";function r(e){var t=this;if(t instanceof r||(t=new r),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)t.push(arguments[n]);return t}function i(e,t,n){var r=t===e.head?new s(n,null,t,e):new s(n,t,t.next,e);return null===r.next&&(e.tail=r),null===r.prev&&(e.head=r),e.length++,r}function a(e,t){e.tail=new s(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function o(e,t){e.head=new s(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function s(e,t,n,r){if(!(this instanceof s))return new s(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}e.exports=r,r.Node=s,r.create=r,r.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t},r.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},r.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},r.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)a(this,arguments[e]);return this.length},r.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)o(this,arguments[e]);return this.length},r.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},r.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},r.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;null!==n;r++)e.call(t,n.value,r,this),n=n.next},r.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;null!==n;r--)e.call(t,n.value,r,this),n=n.prev},r.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},r.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},r.prototype.map=function(e,t){t=t||this;for(var n=new r,i=this.head;null!==i;)n.push(e.call(t,i.value,this)),i=i.next;return n},r.prototype.mapReverse=function(e,t){t=t||this;for(var n=new r,i=this.tail;null!==i;)n.push(e.call(t,i.value,this)),i=i.prev;return n},r.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=e(n,r.value,i),r=r.next;return n},r.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=e(n,r.value,i),r=r.prev;return n},r.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},r.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},r.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,a=this.head;null!==a&&i<e;i++)a=a.next;for(;null!==a&&i<t;i++,a=a.next)n.push(a.value);return n},r.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,a=this.tail;null!==a&&i>t;i--)a=a.prev;for(;null!==a&&i>e;i--,a=a.prev)n.push(a.value);return n},r.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,a=this.head;null!==a&&r<e;r++)a=a.next;var o=[];for(r=0;a&&r<t;r++)o.push(a.value),a=this.removeNode(a);for(null===a&&(a=this.tail),a!==this.head&&a!==this.tail&&(a=a.prev),r=0;r<n.length;r++)a=i(this,a,n[r]);return o},r.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this};try{n("HwNo")(r)}catch(l){}},YJ14:function(e,t,n){const r=n("3wIk");e.exports=(e,t)=>new r(e,t).minor},YSVl:function(e,t,n){var r=n("EhIR"),i=n("uDiL"),a=n("pJ6O"),o=n("yuCN"),s=n("euyF"),l=n("ie1u"),u=n("pJ3+");u.alea=r,u.xor128=i,u.xorwow=a,u.xorshift7=o,u.xor4096=s,u.tychei=l,e.exports=u},Ybu3:function(e,t,n){const{MAX_LENGTH:r}=n("/kWe"),{re:i,t:a}=n("IsDc"),o=n("3wIk"),s=n("4S+G");e.exports=(e,t)=>{if(t=s(t),e instanceof o)return e;if("string"!=typeof e)return null;if(e.length>r)return null;if(!(t.loose?i[a.LOOSE]:i[a.FULL]).test(e))return null;try{return new o(e,t)}catch(n){return null}}},Yn5A:function(e,t,n){const r=n("Ybu3"),i=n("xfvg");e.exports=(e,t)=>{if(i(e,t))return null;{const n=r(e),i=r(t),a=n.prerelease.length||i.prerelease.length,o=a?"pre":"",s=a?"prerelease":"";for(const e in n)if(("major"===e||"minor"===e||"patch"===e)&&n[e]!==i[e])return o+e;return s}}},YuTi:function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},ZYJ9:function(e,t,n){"use strict";var r=/("(?:[^\\"]|\\.)*")|[:,]/g;e.exports=function(e,t){var n,i,a;return t=t||{},n=JSON.stringify([1],void 0,void 0===t.indent?2:t.indent).slice(2,-3),i=""===n?1/0:void 0===t.maxLength?80:t.maxLength,a=t.replacer,function e(t,o,s){var l,u,c,d,h,f,p,m,g,v,y,b;if(t&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===(y=JSON.stringify(t,a)))return y;if(y.length<=(p=i-o.length-s)&&(g=y.replace(r,(function(e,t){return t||e+" "}))).length<=p)return g;if(null!=a&&(t=JSON.parse(y),a=void 0),"object"==typeof t&&null!==t){if(m=o+n,c=[],u=0,Array.isArray(t))for(v="[",l="]",p=t.length;u<p;u++)c.push(e(t[u],m,u===p-1?0:1)||"null");else for(v="{",l="}",p=(f=Object.keys(t)).length;u<p;u++)d=f[u],h=JSON.stringify(d)+": ",void 0!==(b=e(t[d],m,h.length+(u===p-1?0:1)))&&c.push(h+b);if(c.length>0)return[v,n+c.join(",\n"+m),l].join("\n"+o)}return y}(e,"",0)}},aUsF:function(e,t,n){"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(i=r;0!=i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(a=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=r;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;0!=i--;){var o=a[i];if(!e(t[o],n[o]))return!1}return!0}return t!=t&&n!=n}},bdwG:function(e,t,n){const r=n("8GxW");e.exports=(e,t,n)=>r(e,t,n)<=0},bkNj:function(e,t,n){window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,(function(t){return e[t]}).bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(n(2)),a=n(1),o=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t||0,this.y=n||0,this.z=r||0}return r(e,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12],this.y=i[1]*t+i[5]*n+i[9]*r+i[13],this.z=i[2]*t+i[6]*n+i[10]*r+i[14],this}},{key:"applyProjection",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*r-o*n,u=s*n+o*t-i*r,c=s*r+i*n-a*t,d=-i*t-a*n-o*r;return this.x=l*s+d*-i+u*-o-c*-a,this.y=u*s+d*-a+c*-i-l*-o,this.z=c*s+d*-o+l*-a-u*-i,this}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize(),this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this}},{key:"min",value:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this}},{key:"max",value:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this}},{key:"clamp",value:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.multiplyScalar(-1)}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,r=this.y,i=this.z;return this.x=r*e.z-i*e.y,this.y=i*e.x-n*e.z,this.z=n*e.y-r*e.x,this}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}},{key:"angleTo",value:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos((0,a.clamp)(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}},{key:"setFromMatrixPosition",value:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){var n=4*e,r=t.elements;return this.x=r[n],this.y=r[n+1],this.z=r[n+2],this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"clone",value:function(){return new e(this.x,this.y,this.z)}}]),e}();o.prototype.projectOnVector=function(){var e=void 0,t=void 0;return function(n){return void 0===e&&(e=new o),e.copy(n).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),o.prototype.projectOnPlane=function(){var e=void 0;return function(t){return void 0===e&&(e=new o),e.copy(this).projectOnVector(t),this.sub(e)}}(),o.prototype.reflect=function(){var e=void 0;return function(t){return void 0===e&&(e=new o),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),o.prototype.clampScalar=function(){var e=void 0,t=void 0;return function(n,r){return void 0===e&&(e=new o,t=new o),e.set(n,n,n),t.set(r,r,r),this.clamp(e,t)}}(),o.prototype.applyAxisAngle=function(){var e=void 0;return function(t,n){return void 0===e&&(e=new i.default),this.applyQuaternion(e.setFromAxisAngle(t.normalize(),n)),this}}(),t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clamp=function(e,t,n){return e<t?t:e>n?n:e},t.degToRad=function(e){return e*(Math.PI/180)},t.approximatelyEquals=function(e,t,n){var r=n||1e-4;return Math.abs(e-t)<=r*Math.max(1,Math.abs(e),Math.abs(t))},t.radToDeg=function(e){return e*(180/Math.PI)},t.sign=function(e){return"number"==typeof e?e?e<0?-1:1:e==e?0:NaN:NaN}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t||0,this.y=n||0,this.z=r||0,this.w=void 0!==i?i:1}return r(e,[{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(n),this}},{key:"multiplyQuaternions",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=e.w,o=t.x,s=t.y,l=t.z,u=t.w;return this.x=n*u+a*o+r*l-i*s,this.y=r*u+a*s+i*o-n*l,this.z=i*u+a*l+n*s-r*o,this.w=a*u-n*o-r*s-i*l,this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],o=t[5],s=t[9],l=t[2],u=t[6],c=t[10],d=n+o+c,h=void 0;return d>0?(h=.5/Math.sqrt(d+1),this.w=.25/h,this.x=(u-s)*h,this.y=(i-l)*h,this.z=(a-r)*h):n>o&&n>c?(h=2*Math.sqrt(1+n-o-c),this.w=(u-s)/h,this.x=.25*h,this.y=(r+a)/h,this.z=(i+l)/h):o>c?(h=2*Math.sqrt(1+o-n-c),this.w=(i-l)/h,this.x=(r+a)/h,this.y=.25*h,this.z=(s+u)/h):(h=2*Math.sqrt(1+c-n-o),this.w=(a-r)/h,this.x=(i+l)/h,this.y=(s+u)/h,this.z=.25*h),this}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);function i(e){return e*e}function a(e,t){return i(e.x-t.x)+i(e.y-t.y)}t.default={distanceToPoint:function(e,t){return Math.sqrt(function(e,t){var n=a(e.start,e.end);if(0===n)return a(t,e.start);var r=((t.x-e.start.x)*(e.end.x-e.start.x)+(t.y-e.start.y)*(e.end.y-e.start.y))/n;return a(t,r<0?e.start:r>1?e.end:{x:e.start.x+r*(e.end.x-e.start.x),y:e.start.y+r*(e.end.y-e.start.y)})}(e,t))},intersectLine:function(e,t){var n,i,a,o,s,l,u,c,d,h,f,p={},m=e.start.x,g=e.start.y,v=e.end.x,y=e.end.y,b=t.start.x,x=t.start.y,w=t.end.x,_=t.end.y,S=void 0;if(h=(n=y-g)*w+(a=m-v)*_+(s=v*g-m*y),(0===(d=n*b+a*x+s)||0===h||(0,r.sign)(d)!==(0,r.sign)(h))&&(c=(i=_-x)*v+(o=b-w)*y+(l=w*x-b*_),0===(u=i*m+o*g+l)||0===c||(0,r.sign)(u)!==(0,r.sign)(c))){f=n*o-i*a,S=a*l-o*s;var E=parseFloat(S/f);S=i*s-n*l;var T=parseFloat(S/f);return p.x=E,p.y=T,p}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vector3=t.rect=t.quaternion=t.point=t.Plane=t.Matrix4=t.sign=t.radToDeg=t.degToRad=t.clamp=t.lineSegment=t.Line3=void 0;var r=h(n(5)),i=h(n(3)),a=n(1),o=h(n(6)),s=h(n(7)),l=h(n(8)),u=h(n(2)),c=h(n(9)),d=h(n(0));function h(e){return e&&e.__esModule?e:{default:e}}var f={Line3:r.default,lineSegment:i.default,clamp:a.clamp,degToRad:a.degToRad,radToDeg:a.radToDeg,sign:a.sign,Matrix4:o.default,Plane:s.default,point:l.default,quaternion:u.default,rect:c.default,Vector3:d.default};t.Line3=r.default,t.lineSegment=i.default,t.clamp=a.clamp,t.degToRad=a.degToRad,t.radToDeg=a.radToDeg,t.sign=a.sign,t.Matrix4=o.default,t.Plane=s.default,t.point=l.default,t.quaternion=u.default,t.rect=c.default,t.Vector3=d.default,t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),a=n(1),o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.start=void 0!==t?t:new i.default,this.end=void 0!==n?n:new i.default}return r(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"center",value:function(e){return(e||new i.default).addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return(e||new i.default).subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){var n=t||new i.default;return this.delta(n).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){var n=new i.default,r=new i.default;n.subVectors(e,this.start),r.subVectors(this.end,this.start);var o=r.dot(r),s=r.dot(n)/o;return t&&(s=(0,a.clamp)(s,0,1)),s}},{key:"closestPointToPoint",value:function(e,t,n){var r=this.closestPointToPointParameter(e,t),a=n||new i.default;return this.delta(a).multiplyScalar(r).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"intersectLine",value:function(e){var t=this.end.clone().sub(this.start),n=e.end.clone().sub(e.start),r=e.start.clone().sub(this.start),i=t.clone().cross(n),o=r.clone().cross(n),s=r.dot(i);if((0,a.approximatelyEquals)(s,0)){var l=o.dot(i)/i.lengthSq();if(!(l>1||isNaN(l))){var u=this.start.clone().add(t.clone().multiplyScalar(l));return u.clone().sub(e.start).lengthSq()+u.clone().sub(e.end).lengthSq()<=e.distanceSq()?u:void 0}}}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),a=function(){function e(t,n,r,i,a,o,s,l,u,c,d,h,f,p,m,g){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.elements=new Float32Array(16);var v=this.elements;v[0]=void 0!==t?t:1,v[4]=n||0,v[8]=r||0,v[12]=i||0,v[1]=a||0,v[5]=void 0!==o?o:1,v[9]=s||0,v[13]=l||0,v[2]=u||0,v[6]=c||0,v[10]=void 0!==d?d:1,v[14]=h||0,v[3]=f||0,v[7]=p||0,v[11]=m||0,v[15]=void 0!==g?g:1}return r(e,[{key:"makeRotationFromQuaternion",value:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,a=e.w,o=n+n,s=r+r,l=i+i,u=n*o,c=n*s,d=n*l,h=r*s,f=r*l,p=i*l,m=a*o,g=a*s,v=a*l;return t[0]=1-(h+p),t[4]=c-v,t[8]=d+g,t[1]=c+v,t[5]=1-(u+p),t[9]=f-m,t[2]=d-g,t[6]=f+m,t[10]=1-(u+h),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],u=n[1],c=n[5],d=n[9],h=n[13],f=n[2],p=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],x=n[15],w=r[0],_=r[4],S=r[8],E=r[12],T=r[1],k=r[5],C=r[9],I=r[13],O=r[2],A=r[6],D=r[10],M=r[14],N=r[3],j=r[7],R=r[11],P=r[15];return i[0]=a*w+o*T+s*O+l*N,i[4]=a*_+o*k+s*A+l*j,i[8]=a*S+o*C+s*D+l*R,i[12]=a*E+o*I+s*M+l*P,i[1]=u*w+c*T+d*O+h*N,i[5]=u*_+c*k+d*A+h*j,i[9]=u*S+c*C+d*D+h*R,i[13]=u*E+c*I+d*M+h*P,i[2]=f*w+p*T+m*O+g*N,i[6]=f*_+p*k+m*A+g*j,i[10]=f*S+p*C+m*D+g*R,i[14]=f*E+p*I+m*M+g*P,i[3]=v*w+y*T+b*O+x*N,i[7]=v*_+y*k+b*A+x*j,i[11]=v*S+y*C+b*D+x*R,i[15]=v*E+y*I+b*M+x*P,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"getInverse",value:function(e,t){var n=this.elements,r=e.elements,i=r[0],a=r[4],o=r[8],s=r[12],l=r[1],u=r[5],c=r[9],d=r[13],h=r[2],f=r[6],p=r[10],m=r[14],g=r[3],v=r[7],y=r[11],b=r[15];n[0]=c*m*v-d*p*v+d*f*y-u*m*y-c*f*b+u*p*b,n[4]=s*p*v-o*m*v-s*f*y+a*m*y+o*f*b-a*p*b,n[8]=o*d*v-s*c*v+s*u*y-a*d*y-o*u*b+a*c*b,n[12]=s*c*f-o*d*f-s*u*p+a*d*p+o*u*m-a*c*m,n[1]=d*p*g-c*m*g-d*h*y+l*m*y+c*h*b-l*p*b,n[5]=o*m*g-s*p*g+s*h*y-i*m*y-o*h*b+i*p*b,n[9]=s*c*g-o*d*g-s*l*y+i*d*y+o*l*b-i*c*b,n[13]=o*d*h-s*c*h+s*l*p-i*d*p-o*l*m+i*c*m,n[2]=u*m*g-d*f*g+d*h*v-l*m*v-u*h*b+l*f*b,n[6]=s*f*g-a*m*g-s*h*v+i*m*v+a*h*b-i*f*b,n[10]=a*d*g-s*u*g+s*l*v-i*d*v-a*l*b+i*u*b,n[14]=s*u*h-a*d*h-s*l*f+i*d*f+a*l*m-i*u*m,n[3]=c*f*g-u*p*g-c*h*v+l*p*v+u*h*y-l*f*y,n[7]=a*p*g-o*f*g+o*h*v-i*p*v-a*h*y+i*f*y,n[11]=o*u*g-a*c*g-o*l*v+i*c*v+a*l*y-i*u*y,n[15]=a*c*h-o*u*h+o*l*f-i*c*f-a*l*p+i*u*p;var x=i*n[0]+l*n[4]+h*n[8]+g*n[12];if(0===x){var w="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(w);return console.warn(w),this.identity(),this}return this.multiplyScalar(1/x),this}},{key:"applyToVector3Array",value:function(){var e=new i.default;return function(t,n,r){void 0===n&&(n=0),void 0===r&&(r=t.length);for(var i=0,a=n;i<r;i+=3,a+=3)e.x=t[a],e.y=t[a+1],e.z=t[a+2],e.applyMatrix4(this),t[a]=e.x,t[a+1]=e.y,t[a+2]=e.z;return t}}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"set",value:function(e,t,n,r,i,a,o,s,l,u,c,d,h,f,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=d,g[3]=h,g[7]=f,g[11]=p,g[15]=m,this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.normal=void 0!==t?t:new i.default(1,0,0),this.constant=void 0!==n?n:0}return r(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return this.orthoPoint(e,t).sub(e).negate()}},{key:"orthoPoint",value:function(e,t){var n=this.distanceToPoint(e);return(t||new i.default).copy(this.normal).multiplyScalar(n)}},{key:"isIntersectionLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectPlane",value:function(e){var t=this.normal.clone().cross(e.normal),n={origin:new i.default,direction:t};if(this.normal.clone().cross(e.normal).length<1e-10)return n.direction=new i.default,n;var r=this.constant,a=e.constant,o=this.normal.clone().dot(e.normal),s=-(r-a*o)/(1-o*o),l=-(a-r*o)/(1-o*o);return n.origin=this.normal.clone().multiplyScalar(s).add(e.normal.clone().multiplyScalar(l)),n}},{key:"coplanarPoint",value:function(e){return(e||new i.default).copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(e){return this.constant=this.constant-e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new e).copy(this)}}]),e}();a.prototype.setFromCoplanarPoints=function(){var e=new i.default,t=new i.default;return function(n,r,i){var a=e.subVectors(i,r).cross(t.subVectors(n,r)).normalize();return this.setFromNormalAndCoplanarPoint(a,n),this}}(),a.prototype.intersectLine=function(){var e=new i.default;return function(t,n){var r=n||new i.default,a=t.delta(e),o=this.normal.dot(a);if(0===o)return 0===this.distanceToPoint(t.start)?r.copy(t.start):void 0;var s=-(t.start.dot(this.normal)+this.constant)/o;return s<0||s>1?void 0:r.copy(a).multiplyScalar(s).add(t.start)}}(),t.default=a},function(e,t,n){"use strict";function r(e,t){return{x:e.x-t.x,y:e.y-t.y}}function i(e,t){return Math.sqrt(a(e,t))}function a(e,t){var n=r(e,t);return n.x*n.x+n.y*n.y}Object.defineProperty(t,"__esModule",{value:!0}),t.default={subtract:r,copy:function(e){return{x:e.x,y:e.y}},pageToPoint:function(e){return{x:e.pageX,y:e.pageY}},distance:i,distanceSquared:a,insideRect:function(e,t){return!(e.x<t.left||e.x>t.left+t.width||e.y<t.top||e.y>t.top+t.height)},findClosestPoint:function(e,t){var n=[],r=void 0;return e.forEach((function(e,a){var o=i(e,t);n.push(o),r=0===a?o:Math.min(o,r)})),e[n.indexOf(r)]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(3));function i(e){return{topLeft:{x:e.left,y:e.top},bottomRight:{x:e.left+e.width,y:e.top+e.height}}}t.default={distanceToPoint:function(e,t){var n=655535;return function(e){return[{start:{x:e.left,y:e.top},end:{x:e.left+e.width,y:e.top}},{start:{x:e.left+e.width,y:e.top},end:{x:e.left+e.width,y:e.top+e.height}},{start:{x:e.left+e.width,y:e.top+e.height},end:{x:e.left,y:e.top+e.height}},{start:{x:e.left,y:e.top+e.height},end:{x:e.left,y:e.top}}]}(e).forEach((function(e){var i=r.default.distanceToPoint(e,t);i<n&&(n=i)})),n},getIntersectionRect:function(e,t){var n={topLeft:{},bottomRight:{}};if(function(e,t){var n=i(e),r=i(t);return!((e.width>=0?t.width>=0?n.bottomRight.x<=r.topLeft.x||r.bottomRight.x<=n.topLeft.x:n.bottomRight.x<=r.bottomRight.x||r.topLeft.x<=n.topLeft.x:t.width>=0?n.topLeft.x<=r.topLeft.x||r.bottomRight.x<=n.bottomRight.x:n.topLeft.x<=r.bottomRight.x||r.topLeft.x<=n.bottomRight.x)||(e.height>=0?t.height>=0?n.bottomRight.y<=r.topLeft.y||r.bottomRight.y<=n.topLeft.y:n.bottomRight.y<=r.bottomRight.y||r.topLeft.y<=n.topLeft.y:t.height>=0?n.topLeft.y<=r.topLeft.y||r.bottomRight.y<=n.bottomRight.y:n.topLeft.y<=r.bottomRight.y||r.top<=n.bottomRight.y))}(e,t)){var r=i(e),a=i(t);return e.width>=0?t.width>=0?(n.topLeft.x=Math.max(r.topLeft.x,a.topLeft.x),n.bottomRight.x=Math.min(r.bottomRight.x,a.bottomRight.x)):(n.topLeft.x=Math.max(r.topLeft.x,a.bottomRight.x),n.bottomRight.x=Math.min(r.bottomRight.x,a.topLeft.x)):t.width>=0?(n.topLeft.x=Math.min(r.topLeft.x,a.bottomRight.x),n.bottomRight.x=Math.max(r.bottomRight.x,a.topLeft.x)):(n.topLeft.x=Math.min(r.topLeft.x,a.topLeft.x),n.bottomRight.x=Math.max(r.bottomRight.x,a.bottomRight.x)),e.height>=0?t.height>=0?(n.topLeft.y=Math.max(r.topLeft.y,a.topLeft.y),n.bottomRight.y=Math.min(r.bottomRight.y,a.bottomRight.y)):(n.topLeft.y=Math.max(r.topLeft.y,a.bottomRight.y),n.bottomRight.y=Math.min(r.bottomRight.y,a.topLeft.y)):t.height>=0?(n.topLeft.y=Math.min(r.topLeft.y,a.bottomRight.y),n.bottomRight.y=Math.max(r.bottomRight.y,a.topLeft.y)):(n.topLeft.y=Math.min(r.topLeft.y,a.topLeft.y),n.bottomRight.y=Math.max(r.bottomRight.y,a.bottomRight.y)),n}}}}])},d43V:function(e,t,n){const r=n("3wIk"),i=n("ex/Z");e.exports=(e,t,n)=>{let a=null,o=null,s=null;try{s=new i(t,n)}catch(l){return null}return e.forEach(e=>{s.test(e)&&(a&&-1!==o.compare(e)||(a=e,o=new r(a,n)))}),a}},"dtu/":function(e,t,n){const r=n("8GxW");e.exports=(e,t,n)=>0!==r(e,t,n)},eQf7:function(e,t,n){const r=n("3wIk");e.exports=(e,t,n,i)=>{"string"==typeof n&&(i=n,n=void 0);try{return new r(e,n).inc(t,i).version}catch(a){return null}}},eXNJ:function(e,t,n){const r=n("3wIk"),i=n("Ybu3"),{re:a,t:o}=n("IsDc");e.exports=(e,t)=>{if(e instanceof r)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){let t;for(;(t=a[o.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&t.index+t[0].length===n.index+n[0].length||(n=t),a[o.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;a[o.COERCERTL].lastIndex=-1}else n=e.match(a[o.COERCE]);return null===n?null:i(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)}},euyF:function(e,t,n){(function(e){var r;!function(e,i,a){function o(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,a=t.i;return t.w=r=r+1640531527|0,n=i[a+34&127],e=i[a=a+1&127],n^=n<<13,e^=e<<17,n=i[a]=(n^=n>>>15)^(e^=e>>>12),t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,i,a,o,s=[],l=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,l=Math.max(l,t.length)),i=0,a=-32;a<l;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(i=0==(n=s[127&a]^=r+(o=o+1640531527|0))?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,a=512;a>0;--a)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,s[i]=(r^=r>>>15)^(n^=n>>>12);e.w=o,e.X=s,e.i=i}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function l(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.X&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(t,n,t,i))||(i.exports=r):this.xor4096=l}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},"ex/Z":function(e,t,n){class r{constructor(e,t){if(t=a(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter(e=>!p(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const t of this.set)if(1===t.length&&m(t[0])){this.set=[t];break}}this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=`parseRange:${Object.keys(this.options).join(",")}:${e}`,n=i.get(t);if(n)return n;const r=this.options.loose;e=e.replace(r?u[c.HYPHENRANGELOOSE]:u[c.HYPHENRANGE],C(this.options.includePrerelease)),s("hyphen replace",e),e=e.replace(u[c.COMPARATORTRIM],d),s("comparator trim",e,u[c.COMPARATORTRIM]),e=(e=(e=e.replace(u[c.TILDETRIM],h)).replace(u[c.CARETTRIM],f)).split(/\s+/).join(" ");const a=r?u[c.COMPARATORLOOSE]:u[c.COMPARATOR],l=e.split(" ").map(e=>v(e,this.options)).join(" ").split(/\s+/).map(e=>k(e,this.options)).filter(this.options.loose?e=>!!e.match(a):()=>!0).map(e=>new o(e,this.options)),m=new Map;for(const i of l){if(p(i))return[i];m.set(i.value,i)}m.size>1&&m.has("")&&m.delete("");const g=[...m.values()];return i.set(t,g),g}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(n=>g(n,t)&&e.set.some(e=>g(e,t)&&n.every(n=>e.every(e=>n.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new l(e,this.options)}catch(t){return!1}for(let n=0;n<this.set.length;n++)if(I(this.set[n],e,this.options))return!0;return!1}}e.exports=r;const i=new(n("HyWp"))({max:1e3}),a=n("4S+G"),o=n("vwDW"),s=n("DXxi"),l=n("3wIk"),{re:u,t:c,comparatorTrimReplace:d,tildeTrimReplace:h,caretTrimReplace:f}=n("IsDc"),p=e=>"<0.0.0-0"===e.value,m=e=>""===e.value,g=(e,t)=>{let n=!0;const r=e.slice();let i=r.pop();for(;n&&r.length;)n=r.every(e=>i.intersects(e,t)),i=r.pop();return n},v=(e,t)=>(s("comp",e,t),e=w(e,t),s("caret",e),e=b(e,t),s("tildes",e),e=S(e,t),s("xrange",e),e=T(e,t),s("stars",e),e),y=e=>!e||"x"===e.toLowerCase()||"*"===e,b=(e,t)=>e.trim().split(/\s+/).map(e=>x(e,t)).join(" "),x=(e,t)=>e.replace(t.loose?u[c.TILDELOOSE]:u[c.TILDE],(t,n,r,i,a)=>{let o;return s("tilde",e,t,n,r,i,a),y(n)?o="":y(r)?o=`>=${n}.0.0 <${+n+1}.0.0-0`:y(i)?o=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:a?(s("replaceTilde pr",a),o=`>=${n}.${r}.${i}-${a} <${n}.${+r+1}.0-0`):o=`>=${n}.${r}.${i} <${n}.${+r+1}.0-0`,s("tilde return",o),o}),w=(e,t)=>e.trim().split(/\s+/).map(e=>_(e,t)).join(" "),_=(e,t)=>{s("caret",e,t);const n=t.includePrerelease?"-0":"";return e.replace(t.loose?u[c.CARETLOOSE]:u[c.CARET],(t,r,i,a,o)=>{let l;return s("caret",e,t,r,i,a,o),y(r)?l="":y(i)?l=`>=${r}.0.0${n} <${+r+1}.0.0-0`:y(a)?l="0"===r?`>=${r}.${i}.0${n} <${r}.${+i+1}.0-0`:`>=${r}.${i}.0${n} <${+r+1}.0.0-0`:o?(s("replaceCaret pr",o),l="0"===r?"0"===i?`>=${r}.${i}.${a}-${o} <${r}.${i}.${+a+1}-0`:`>=${r}.${i}.${a}-${o} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${a}-${o} <${+r+1}.0.0-0`):(s("no pr"),l="0"===r?"0"===i?`>=${r}.${i}.${a}${n} <${r}.${i}.${+a+1}-0`:`>=${r}.${i}.${a}${n} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${a} <${+r+1}.0.0-0`),s("caret return",l),l})},S=(e,t)=>(s("replaceXRanges",e,t),e.split(/\s+/).map(e=>E(e,t)).join(" ")),E=(e,t)=>(e=e.trim()).replace(t.loose?u[c.XRANGELOOSE]:u[c.XRANGE],(n,r,i,a,o,l)=>{s("xRange",e,n,r,i,a,o,l);const u=y(i),c=u||y(a),d=c||y(o);return"="===r&&d&&(r=""),l=t.includePrerelease?"-0":"",u?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&d?(c&&(a=0),o=0,">"===r?(r=">=",c?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):"<="===r&&(r="<",c?i=+i+1:a=+a+1),"<"===r&&(l="-0"),n=`${r+i}.${a}.${o}${l}`):c?n=`>=${i}.0.0${l} <${+i+1}.0.0-0`:d&&(n=`>=${i}.${a}.0${l} <${i}.${+a+1}.0-0`),s("xRange return",n),n}),T=(e,t)=>(s("replaceStars",e,t),e.trim().replace(u[c.STAR],"")),k=(e,t)=>(s("replaceGTE0",e,t),e.trim().replace(u[t.includePrerelease?c.GTE0PRE:c.GTE0],"")),C=e=>(t,n,r,i,a,o,s,l,u,c,d,h,f)=>`${n=y(r)?"":y(i)?`>=${r}.0.0${e?"-0":""}`:y(a)?`>=${r}.${i}.0${e?"-0":""}`:o?">="+n:`>=${n}${e?"-0":""}`} ${l=y(u)?"":y(c)?`<${+u+1}.0.0-0`:y(d)?`<${u}.${+c+1}.0-0`:h?`<=${u}.${c}.${d}-${h}`:e?`<${u}.${c}.${+d+1}-0`:"<="+l}`.trim(),I=(e,t,n)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(s(e[n].semver),e[n].semver!==o.ANY&&e[n].semver.prerelease.length>0){const r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0}},gdl2:function(e,t,n){var r;window,r=function(){return function(e){var t=window.webpackHotUpdate;window.webpackHotUpdate=function(e,n){!function(e,t){if(x[e]&&b[e]){for(var n in b[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(p[n]=t[n]);0==--g&&0===v&&E()}}(e,n),t&&t(e,n)};var n,r=!0,i="f1fc9ee2018efa87b506",a={},o=[],s=[];function l(e){var t=k[e];if(!t)return C;var r=function(r){return t.hot.active?(k[r]?-1===k[r].parents.indexOf(e)&&k[r].parents.push(e):(o=[e],n=r),-1===t.children.indexOf(r)&&t.children.push(r)):(console.warn("[HMR] unexpected require("+r+") from disposed module "+e),o=[]),C(r)},i=function(e){return{configurable:!0,enumerable:!0,get:function(){return C[e]},set:function(t){C[e]=t}}};for(var a in C)Object.prototype.hasOwnProperty.call(C,a)&&"e"!==a&&"t"!==a&&Object.defineProperty(r,a,i(a));return r.e=function(e){return"ready"===d&&h("prepare"),v++,C.e(e).then(t,(function(e){throw t(),e}));function t(){v--,"prepare"===d&&(y[e]||S(e),0===v&&0===g&&E())}},r.t=function(e,t){return 1&t&&(e=r(e)),C.t(e,-2&t)},r}function u(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:n!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var r=0;r<e.length;r++)t._acceptedDependencies[e[r]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:_,apply:T,status:function(e){if(!e)return d;c.push(e)},addStatusHandler:function(e){c.push(e)},removeStatusHandler:function(e){var t=c.indexOf(e);t>=0&&c.splice(t,1)},data:a[e]};return n=void 0,t}var c=[],d="idle";function h(e){d=e;for(var t=0;t<c.length;t++)c[t].call(null,e)}var f,p,m,g=0,v=0,y={},b={},x={};function w(e){return+e+""===e?+e:e}function _(e){if("idle"!==d)throw new Error("check() is only allowed in idle status");return r=e,h("check"),(t=1e4,t=t||1e4,new Promise((function(e,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var r=new XMLHttpRequest,a=C.p+""+i+".hot-update.json";r.open("GET",a,!0),r.timeout=t,r.send(null)}catch(o){return n(o)}r.onreadystatechange=function(){if(4===r.readyState)if(0===r.status)n(new Error("Manifest request to "+a+" timed out."));else if(404===r.status)e();else if(200!==r.status&&304!==r.status)n(new Error("Manifest request to "+a+" failed."));else{try{var t=JSON.parse(r.responseText)}catch(i){return void n(i)}e(t)}}}))).then((function(e){if(!e)return h("idle"),null;b={},y={},x=e.c,m=e.h,h("prepare");var t=new Promise((function(e,t){f={resolve:e,reject:t}}));return p={},S("cornerstone"),"prepare"===d&&0===v&&0===g&&E(),t}));var t}function S(e){x[e]?(b[e]=!0,g++,function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.charset="utf-8",n.src=C.p+""+e+"."+i+".hot-update.js",t.appendChild(n)}(e)):y[e]=!0}function E(){h("ready");var e=f;if(f=null,e)if(r)Promise.resolve().then((function(){return T(r)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var n in p)Object.prototype.hasOwnProperty.call(p,n)&&t.push(w(n));e.resolve(t)}}function T(t){if("ready"!==d)throw new Error("apply() is only allowed in ready status");var n,r,s,l,u;function c(e){for(var t=[e],n={},r=t.slice().map((function(e){return{chain:[e],id:e}}));r.length>0;){var i=r.pop(),a=i.id,o=i.chain;if((l=k[a])&&!l.hot._selfAccepted){if(l.hot._selfDeclined)return{type:"self-declined",chain:o,moduleId:a};if(l.hot._main)return{type:"unaccepted",chain:o,moduleId:a};for(var s=0;s<l.parents.length;s++){var u=l.parents[s],c=k[u];if(c){if(c.hot._declinedDependencies[a])return{type:"declined",chain:o.concat([u]),moduleId:a,parentId:u};-1===t.indexOf(u)&&(c.hot._acceptedDependencies[a]?(n[u]||(n[u]=[]),f(n[u],[a])):(delete n[u],t.push(u),r.push({chain:o.concat([u]),id:u})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];-1===e.indexOf(r)&&e.push(r)}}t=t||{};var g={},v=[],y={},b=function(){console.warn("[HMR] unexpected require("+S.moduleId+") to disposed module")};for(var _ in p)if(Object.prototype.hasOwnProperty.call(p,_)){var S;u=w(_);var E=!1,T=!1,I=!1,O="";switch((S=p[_]?c(u):{type:"disposed",moduleId:_}).chain&&(O="\nUpdate propagation: "+S.chain.join(" -> ")),S.type){case"self-declined":t.onDeclined&&t.onDeclined(S),t.ignoreDeclined||(E=new Error("Aborted because of self decline: "+S.moduleId+O));break;case"declined":t.onDeclined&&t.onDeclined(S),t.ignoreDeclined||(E=new Error("Aborted because of declined dependency: "+S.moduleId+" in "+S.parentId+O));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(S),t.ignoreUnaccepted||(E=new Error("Aborted because "+u+" is not accepted"+O));break;case"accepted":t.onAccepted&&t.onAccepted(S),T=!0;break;case"disposed":t.onDisposed&&t.onDisposed(S),I=!0;break;default:throw new Error("Unexception type "+S.type)}if(E)return h("abort"),Promise.reject(E);if(T)for(u in y[u]=p[u],f(v,S.outdatedModules),S.outdatedDependencies)Object.prototype.hasOwnProperty.call(S.outdatedDependencies,u)&&(g[u]||(g[u]=[]),f(g[u],S.outdatedDependencies[u]));I&&(f(v,[S.moduleId]),y[u]=b)}var A,D=[];for(r=0;r<v.length;r++)k[u=v[r]]&&k[u].hot._selfAccepted&&D.push({module:u,errorHandler:k[u].hot._selfAccepted});h("dispose"),Object.keys(x).forEach((function(e){!1===x[e]&&function(e){delete installedChunks[e]}(e)}));for(var M,N=v.slice();N.length>0;)if(u=N.pop(),l=k[u]){var j={},R=l.hot._disposeHandlers;for(s=0;s<R.length;s++)(n=R[s])(j);for(a[u]=j,l.hot.active=!1,delete k[u],delete g[u],s=0;s<l.children.length;s++){var P=k[l.children[s]];P&&(A=P.parents.indexOf(u))>=0&&P.parents.splice(A,1)}}for(u in g)if(Object.prototype.hasOwnProperty.call(g,u)&&(l=k[u]))for(M=g[u],s=0;s<M.length;s++)(A=l.children.indexOf(M[s]))>=0&&l.children.splice(A,1);for(u in h("apply"),i=m,y)Object.prototype.hasOwnProperty.call(y,u)&&(e[u]=y[u]);var F=null;for(u in g)if(Object.prototype.hasOwnProperty.call(g,u)&&(l=k[u])){M=g[u];var L=[];for(r=0;r<M.length;r++)if(n=l.hot._acceptedDependencies[M[r]]){if(-1!==L.indexOf(n))continue;L.push(n)}for(r=0;r<L.length;r++){n=L[r];try{n(M)}catch(B){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:u,dependencyId:M[r],error:B}),t.ignoreErrored||F||(F=B)}}}for(r=0;r<D.length;r++){var $=D[r];o=[u=$.module];try{C(u)}catch(B){if("function"==typeof $.errorHandler)try{$.errorHandler(B)}catch(z){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:u,error:z,originalError:B}),t.ignoreErrored||F||(F=z),F||(F=B)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:u,error:B}),t.ignoreErrored||F||(F=B)}}return F?(h("fail"),Promise.reject(F)):(h("idle"),new Promise((function(e){e(v)})))}var k={};function C(t){if(k[t])return k[t].exports;var n=k[t]={i:t,l:!1,exports:{},hot:u(t),parents:(s=o,o=[],s),children:[]};return e[t].call(n.exports,n,n.exports,l(t)),n.l=!0,n.exports}return C.m=e,C.c=k,C.d=function(e,t,n){C.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},C.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},C.t=function(e,t){if(1&t&&(e=C(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(C.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)C.d(n,r,(function(t){return e[t]}).bind(null,r));return n},C.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return C.d(t,"a",t),t},C.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},C.p="",C.h=function(){return i},l("./index.js")(C.s="./index.js")}({"./canvasToPixel.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/getTransform.js");t.default=function(e,t){var n=Object(r.getEnabledElement)(e),a=Object(i.default)(n);return a.invert(),a.transformPoint(t.x,t.y)}},"./colors/colormap.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getColormapsList",(function(){return l})),n.d(t,"getColormap",(function(){return u}));var r=n("./colors/lookupTable.js"),i=[0,0,0,0],a={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}};function o(e,t){for(var n=0,r=e.length-1;n<=r;){var i=n+Math.floor((r-n)/2),a=e[i];if(a===t)return i;t<a?r=i-1:n=i+1}return n}function s(e,t,n){var r,i=[],a=[],s=[],l=[];for(n=null===n?1:n,r=0;r<t.length;r++){var u=t[r];i.push((e-1)*u[0]),a.push(u[1]),s.push(u[1])}var c=function(e,t,n){for(var r=(1-e)/((n=null===n?100:n)-1),i=[];n-- >0;)i.push(e),e+=r;return i[i.length-1]=1,i}(0,0,e);for(r=0;r<e;r++)c[r]=(e-1)*Math.pow(c[r],n);var d=function(e,t){var n,r=[],i=t.length;for(e.sort((function(e,t){return e-t})),n=0;n<i;n++)r[n]=o(e,t[n]);return r}(i,c);for(r=1;r<e-1;r++){var h=d[r];l[r]=(c[r]-i[h-1])/(i[h]-i[h-1])*(a[h]-s[h-1])+s[h-1]}return l[0]=s[0],l[e-1]=a[t.length-1],l}function l(){var e=[];return Object.keys(a).forEach((function(t){a.hasOwnProperty(t)&&e.push({id:t,name:a[t].name})})),e.sort((function(e,t){var n=e.name.toLowerCase(),r=t.name.toLowerCase();return n===r?0:n<r?-1:1})),e}function u(e,t){var n=a[e];return n||(n=a[e]=t||{name:"",colors:[]}),!n.colors&&n.segmentedData&&(n.colors=function(e,t,n){var r,i=[],a=s(t=null===t?256:t,e.red,n=null===n?1:n),o=s(t,e.green,n),l=s(t,e.blue,n);for(r=0;r<t;r++){var u=Math.round(255*a[r]),c=Math.round(255*o[r]),d=Math.round(255*l[r]);i.push([u,c,d,255])}return i}(n.segmentedData,n.numColors,n.gamma)),{getId:function(){return e},getColorSchemeName:function(){return n.name},setColorSchemeName:function(e){n.name=e},getNumberOfColors:function(){return n.colors.length},setNumberOfColors:function(e){for(;n.colors.length<e;)n.colors.push(i);n.colors.length=e},getColor:function(e){return this.isValidIndex(e)?n.colors[e]:i},getColorRepeating:function(e){var t=n.colors.length;return this.getColor(e=t?e%t:0)},setColor:function(e,t){this.isValidIndex(e)&&(n.colors[e]=t)},addColor:function(e){n.colors.push(e)},insertColor:function(e,t){this.isValidIndex(e)&&n.colors.splice(e,1,t)},removeColor:function(e){this.isValidIndex(e)&&n.colors.splice(e,1)},clearColors:function(){n.colors=[]},buildLookupTable:function(e){if(e){var t=n.colors.length;e.setNumberOfTableValues(t);for(var r=0;r<t;r++)e.setTableValue(r,n.colors[r])}},createLookupTable:function(){var e=new r.default;return this.buildLookupTable(e),e},isValidIndex:function(e){return e>=0&&e<n.colors.length}}}},"./colors/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./colors/colormap.js"),i=n("./colors/lookupTable.js");t.default={getColormap:r.getColormap,getColormapsList:r.getColormapsList,LookupTable:i.default}},"./colors/lookupTable.js":function(e,t,n){"use strict";function r(e,t,n){if(e>1)throw new Error("HSVToRGB expects hue < 1");var r=[];if(0===t)return r[0]=n,r[1]=n,r[2]=n,r;var i=Math.floor(6*e),a=6*e-i,o=n*(1-t),s=n*(1-t*a),l=n*(1-t*(1-a));switch(i){case 0:case 6:r[0]=n,r[1]=l,r[2]=o;break;case 1:r[0]=s,r[1]=n,r[2]=o;break;case 2:r[0]=o,r[1]=n,r[2]=l;break;case 3:r[0]=o,r[1]=s,r[2]=n;break;case 4:r[0]=l,r[1]=o,r[2]=n;break;case 5:r[0]=n,r[1]=o,r[2]=s}return r}n.r(t),t.default=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}var t;return(t=[{key:"setNumberOfTableValues",value:function(e){this.NumberOfColors=e}},{key:"setRamp",value:function(e){this.Ramp=e}},{key:"setTableRange",value:function(e,t){this.TableRange[0]=e,this.TableRange[1]=t}},{key:"setHueRange",value:function(e,t){this.HueRange[0]=e,this.HueRange[1]=t}},{key:"setSaturationRange",value:function(e,t){this.SaturationRange[0]=e,this.SaturationRange[1]=t}},{key:"setValueRange",value:function(e,t){this.ValueRange[0]=e,this.ValueRange[1]=t}},{key:"setRange",value:function(e,t){this.InputRange[0]=e,this.InputRange[1]=t}},{key:"setAlphaRange",value:function(e,t){this.AlphaRange[0]=e,this.AlphaRange[1]=t}},{key:"getColor",value:function(e){return this.mapValue(e)}},{key:"build",value:function(e){if(!(this.Table.length>1)||e){this.Table=[];var t,n,i,a,o=this.NumberOfColors-1;o?(t=(this.HueRange[1]-this.HueRange[0])/o,n=(this.SaturationRange[1]-this.SaturationRange[0])/o,i=(this.ValueRange[1]-this.ValueRange[0])/o,a=(this.AlphaRange[1]-this.AlphaRange[0])/o):t=n=i=a=0;for(var s=0;s<=o;s++){var l=this.AlphaRange[0]+s*a,u=r(this.HueRange[0]+s*t,this.SaturationRange[0]+s*n,this.ValueRange[0]+s*i),c=[];switch(this.Ramp){case"scurve":c[0]=Math.floor(127.5*(1+Math.cos((1-u[0])*Math.PI))),c[1]=Math.floor(127.5*(1+Math.cos((1-u[1])*Math.PI))),c[2]=Math.floor(127.5*(1+Math.cos((1-u[2])*Math.PI))),c[3]=Math.floor(255*l);break;case"linear":c[0]=Math.floor(255*u[0]+.5),c[1]=Math.floor(255*u[1]+.5),c[2]=Math.floor(255*u[2]+.5),c[3]=Math.floor(255*l+.5);break;case"sqrt":c[0]=Math.floor(255*Math.sqrt(u[0])+.5),c[1]=Math.floor(255*Math.sqrt(u[1])+.5),c[2]=Math.floor(255*Math.sqrt(u[2])+.5),c[3]=Math.floor(255*Math.sqrt(l)+.5);break;default:throw new Error("Invalid Ramp value (".concat(this.Ramp,")"))}this.Table.push(c)}this.buildSpecialColors()}}},{key:"buildSpecialColors",value:function(){var e=this.NumberOfColors,t=e+1,n=e+2;this.Table[e+0]=this.UseBelowRangeColor||0===e?this.BelowRangeColor:this.Table[0],this.Table[t]=this.UseAboveRangeColor||0===e?this.AboveRangeColor:this.Table[e-1],this.Table[n]=this.NaNColor}},{key:"mapValue",value:function(e){var t=this.getIndex(e);if(t<0)return this.NaNColor;if(0===t){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(t===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[t]}},{key:"getIndex",value:function(e){var t={Range:[]};if(t.MaxIndex=this.NumberOfColors-1,t.Shift=-this.TableRange[0],t.Scale=this.TableRange[1]<=this.TableRange[0]?Number.MAX_VALUE:t.MaxIndex/(this.TableRange[1]-this.TableRange[0]),t.Range[0]=this.TableRange[0],t.Range[1]=this.TableRange[1],isNaN(e))return-1;var n=function(e,t){return Math.floor(e<t.Range[0]?t.MaxIndex+0+1.5:e>t.Range[1]?t.MaxIndex+1+1.5:(e+t.Shift)*t.Scale)}(e,t);return n===this.NumberOfColors+0?n=0:n===this.NumberOfColors+1&&(n=this.NumberOfColors-1),n}},{key:"setTableValue",value:function(e,t){if(5===arguments.length&&(t=Array.prototype.slice.call(arguments,1)),e<0)throw new Error("Can't set the table value for negative index (".concat(e,")"));e>=this.NumberOfColors&&new Error("Index ".concat(e," is greater than the number of colors ").concat(this.NumberOfColors)),this.Table[e]=t,0!==e&&e!==this.NumberOfColors-1||this.buildSpecialColors()}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}()},"./disable.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./triggerEvent.js"),a=n("./events.js");t.default=function(e){if(void 0===e)throw new Error("disable: element must not be undefined");for(var t=Object(r.getEnabledElements)(),n=0;n<t.length;n++)if(t[n].element===e){var o={element:e};Object(i.default)(e,a.default.ELEMENT_DISABLED,o),Object(i.default)(a.events,a.default.ELEMENT_DISABLED,o),t[n].element.removeChild(t[n].canvas),t[n].canvas=void 0,t.splice(n,1);break}}},"./displayImage.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/getDefaultViewport.js"),a=n("./updateImage.js"),o=n("./internal/now.js"),s=n("./layers.js"),l=n("./triggerEvent.js"),u=n("./events.js");t.default=function(e,t,n){if(void 0===e)throw new Error("displayImage: parameter element must not be undefined");if(void 0===t)throw new Error("displayImage: parameter image must not be undefined");var c,d=Object(r.getEnabledElement)(e),h=d.image;if(d.image=t,d.layers&&d.layers.length&&Object(s.setLayerImage)(e,t),void 0===d.viewport&&(d.viewport=Object(i.default)(d.canvas,t)),n)for(var f in n)null!==n[f]&&(d.viewport[f]=n[f]);void 0!==d.lastImageTimeStamp&&(c=(1e3/(Object(o.default)()-d.lastImageTimeStamp)).toFixed()),d.lastImageTimeStamp=Object(o.default)();var p={viewport:d.viewport,element:d.element,image:d.image,oldImage:h,enabledElement:d,frameRate:c};Object(l.default)(d.element,u.default.NEW_IMAGE,p),Object(a.default)(e)}},"./draw.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/drawImage.js");t.default=function(e){var t=Object(r.getEnabledElement)(e);if(void 0===t.image)throw new Error("draw: image has not been loaded yet");Object(i.default)(t)}},"./drawInvalidated.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/drawImage.js");t.default=function(){for(var e=Object(r.getEnabledElements)(),t=0;t<e.length;t++){var n=e[t];!0===n.invalid&&Object(i.default)(n,!0)}}},"./enable.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./resize.js"),a=n("./internal/drawImageSync.js"),o=n("./internal/requestAnimationFrame.js"),s=n("./internal/tryEnableWebgl.js"),l=n("./triggerEvent.js"),u=n("./generateUUID.js"),c=n("./events.js"),d=n("./internal/getCanvas.js");t.default=function(e,t){if(void 0===e)throw new Error("enable: parameter element cannot be undefined");t&&t.renderer&&"webgl"===t.renderer.toLowerCase()&&Object(s.default)(t);var n={element:e,canvas:Object(d.default)(e),image:void 0,invalid:!1,needsRedraw:!0,options:t,layers:[],data:{},renderingTools:{},uuid:Object(u.default)()};Object(r.addEnabledElement)(n),Object(l.default)(c.events,c.default.ELEMENT_ENABLED,n),Object(i.default)(e,!0),function e(t){if(void 0!==n.canvas){var r={enabledElement:n,timestamp:t};Object(l.default)(n.element,c.default.PRE_RENDER,r),n.needsRedraw&&function(e){return void 0!==e.image||e.layers.length>0}(n)&&Object(a.default)(n,n.invalid),Object(o.default)(e)}}()}},"./enabledElementData.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getElementData",(function(){return i})),n.d(t,"removeElementData",(function(){return a}));var r=n("./enabledElements.js");function i(e,t){var n=Object(r.getEnabledElement)(e);return!1===n.data.hasOwnProperty(t)&&(n.data[t]={}),n.data[t]}function a(e,t){delete Object(r.getEnabledElement)(e).data[t]}},"./enabledElements.js":function(e,t,n){"use strict";n.r(t),n.d(t,"getEnabledElement",(function(){return i})),n.d(t,"addEnabledElement",(function(){return a})),n.d(t,"getEnabledElementsByImageId",(function(){return o})),n.d(t,"getEnabledElements",(function(){return s}));var r=[];function i(e){if(void 0===e)throw new Error("getEnabledElement: parameter element must not be undefined");for(var t=0;t<r.length;t++)if(r[t].element===e)return r[t];throw new Error("element not enabled")}function a(e){if(void 0===e)throw new Error("getEnabledElement: enabledElement element must not be undefined");r.push(e)}function o(e){var t=[];return r.forEach((function(n){n.image&&n.image.imageId===e&&t.push(n)})),t}function s(){return r}},"./events.js":function(e,t,n){"use strict";n.r(t),n.d(t,"events",(function(){return r})),t.default={NEW_IMAGE:"cornerstonenewimage",INVALIDATED:"cornerstoneinvalidated",PRE_RENDER:"cornerstoneprerender",IMAGE_CACHE_MAXIMUM_SIZE_CHANGED:"cornerstoneimagecachemaximumsizechanged",IMAGE_CACHE_PROMISE_REMOVED:"cornerstoneimagecachepromiseremoved",IMAGE_CACHE_FULL:"cornerstoneimagecachefull",IMAGE_CACHE_CHANGED:"cornerstoneimagecachechanged",WEBGL_TEXTURE_REMOVED:"cornerstonewebgltextureremoved",WEBGL_TEXTURE_CACHE_FULL:"cornerstonewebgltexturecachefull",IMAGE_LOADED:"cornerstoneimageloaded",IMAGE_LOAD_FAILED:"cornerstoneimageloadfailed",ELEMENT_RESIZED:"cornerstoneelementresized",IMAGE_RENDERED:"cornerstoneimagerendered",LAYER_ADDED:"cornerstonelayeradded",LAYER_REMOVED:"cornerstonelayerremoved",ACTIVE_LAYER_CHANGED:"cornerstoneactivelayerchanged",ELEMENT_DISABLED:"cornerstoneelementdisabled",ELEMENT_ENABLED:"cornerstoneelementenabled"};var r=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listeners={},this.namespaces={}}var t;return(t=[{key:"addEventNamespaceListener",value:function(e,t){e.indexOf(".")<=0||(this.namespaces[e]=t,this.addEventListener(e.split(".")[0],t))}},{key:"removeEventNamespaceListener",value:function(e){e.indexOf(".")<=0||!this.namespaces[e]||(this.removeEventListener(e.split(".")[0],this.namespaces[e]),delete this.namespaces[e])}},{key:"addEventListener",value:function(e,t){e.indexOf(".")>0?this.addEventNamespaceListener(e,t):(e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t))}},{key:"removeEventListener",value:function(e,t){if(e.indexOf(".")>0)this.removeEventNamespaceListener(e);else if(e in this.listeners)for(var n=this.listeners[e],r=0,i=n.length;r<i;r++)if(n[r]===t)return void n.splice(r,1)}},{key:"dispatchEvent",value:function(e){if(!(e.type in this.listeners))return!0;for(var t=this.listeners[e.type],n=0,r=t.length;n<r;n++)t[n].call(this,e);return!e.defaultPrevented}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}())},"./falseColorMapping.js":function(e,t,n){"use strict";n.r(t),n.d(t,"convertImageToFalseColorImage",(function(){return s})),n.d(t,"convertToFalseColorImage",(function(){return l})),n.d(t,"restoreImage",(function(){return o}));var r=n("./enabledElements.js"),i=n("./pixelDataToFalseColorData.js"),a=n("./colors/colormap.js");function o(e){return!(!e.restore||"function"!=typeof e.restore||(e.restore(),0))}function s(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");var n=(t=function(e){return e&&"string"==typeof e&&(e=Object(a.getColormap)(e)),e}(t)).getId();if(e.colormapId===n)return!1;if(o(e),n){var r=e.minPixelValue||0,s=e.maxPixelValue||255;e.restore=function(e){if(e.restore)return e.restore;var t=e.color,n=e.rgba,r=e.cachedLut,i=e.slope,a=e.windowWidth,o=e.windowCenter,s=e.minPixelValue,l=e.maxPixelValue;return function(){if(e.color=t,e.rgba=n,e.cachedLut=r,e.slope=i,e.windowWidth=a,e.windowCenter=o,e.minPixelValue=s,e.maxPixelValue=l,e.origPixelData){var u=e.origPixelData;e.getPixelData=function(){return u}}e.origPixelData=void 0,e.colormapId=void 0,e.falseColor=void 0}}(e);var l=t.createLookupTable();l.setTableRange(r,s),Object(i.default)(e,l);var u=function(e){for(var t,n=Number.MAX_VALUE,r=Number.MIN_VALUE,i=e.length,a=0;a<i;a++)n=n<(t=e[a])?n:t,r=r>t?r:t;return{minPixelValue:n,maxPixelValue:r}}(e.getPixelData());e.minPixelValue=u.minPixelValue,e.maxPixelValue=u.maxPixelValue,e.windowWidth=255,e.windowCenter=128,e.colormapId=n}return!0}function l(e,t){return s(Object(r.getEnabledElement)(e).image,t)}},"./fitToWindow.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./updateImage.js"),a=n("./internal/getImageFitScale.js");t.default=function(e){var t=Object(r.getEnabledElement)(e),n=t.image;t.viewport.scale=Object(a.default)(t.canvas,n,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0,Object(i.default)(e)}},"./generateUUID.js":function(e,t,n){"use strict";n.r(t),t.default=function(){var e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"x.x.x.x.x.x.xxxx.xxx.x.x.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))}},"./getDefaultViewportForImage.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/getDefaultViewport.js");t.default=function(e,t){var n=Object(r.getEnabledElement)(e);return Object(i.default)(n.canvas,t)}},"./getImage.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js");t.default=function(e){return Object(r.getEnabledElement)(e).image}},"./getPixels.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./getStoredPixels.js"),a=n("./internal/getModalityLUT.js");t.default=function(e,t,n,o,s){var l=Object(i.default)(e,t,n,o,s),u=Object(r.getEnabledElement)(e),c=Object(a.default)(u.image.slope,u.image.intercept,u.viewport.modalityLUT);return l.map(c)}},"./getStoredPixels.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js");t.default=function(e,t,n,i,a){if(void 0===e)throw new Error("getStoredPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);for(var o=Object(r.getEnabledElement)(e),s=[],l=0,u=o.image.getPixelData(),c=0;c<a;c++)for(var d=0;d<i;d++)s[l++]=u[(c+n)*o.image.columns+(d+t)];return s}},"./getViewport.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js");t.default=function(e){var t=Object(r.getEnabledElement)(e).viewport;if(void 0!==t)return Object.assign({},t)}},"./imageCache.js":function(e,t,n){"use strict";n.r(t),n.d(t,"cachedImages",(function(){return l})),n.d(t,"setMaximumSizeBytes",(function(){return u})),n.d(t,"putImageLoadObject",(function(){return d})),n.d(t,"getImageLoadObject",(function(){return h})),n.d(t,"removeImageLoadObject",(function(){return f})),n.d(t,"getCacheInfo",(function(){return p})),n.d(t,"purgeCache",(function(){return m})),n.d(t,"changeImageIdCacheSize",(function(){return g}));var r=n("./events.js"),i=n("./triggerEvent.js"),a=1073741824,o=0,s={},l=[];function u(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");a=e,Object(i.default)(r.events,r.default.IMAGE_CACHE_MAXIMUM_SIZE_CHANGED),c()}function c(){if(!(o<=a)){for(l.sort((function(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0}));o>a;){var e=l[l.length-1].imageId;f(e),Object(i.default)(r.events,r.default.IMAGE_CACHE_PROMISE_REMOVED,{imageId:e})}var t=p();Object(i.default)(r.events,r.default.IMAGE_CACHE_FULL,t)}}function d(e,t){if(void 0===e)throw new Error("putImageLoadObject: imageId must not be undefined");if(void 0===t.promise)throw new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");if(!0===s.hasOwnProperty(e))throw new Error("putImageLoadObject: imageId already in cache");if(t.cancelFn&&"function"!=typeof t.cancelFn)throw new Error("putImageLoadObject: imageLoadObject.cancelFn must be a function");var n={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:t,timeStamp:Date.now(),sizeInBytes:0};s[e]=n,l.push(n),t.promise.then((function(e){if(-1!==l.indexOf(n)){if(n.loaded=!0,n.image=e,void 0===e.sizeInBytes)throw new Error("putImageLoadObject: image.sizeInBytes must not be undefined");if(void 0===e.sizeInBytes.toFixed)throw new Error("putImageLoadObject: image.sizeInBytes is not a number");n.sizeInBytes=e.sizeInBytes,o+=n.sizeInBytes;var t={action:"addImage",image:n};Object(i.default)(r.events,r.default.IMAGE_CACHE_CHANGED,t),n.sharedCacheKey=e.sharedCacheKey,c()}}),(function(){l.splice(l.indexOf(s[e]),1),delete s[e]}))}function h(e){if(void 0===e)throw new Error("getImageLoadObject: imageId must not be undefined");var t=s[e];if(void 0!==t)return t.timeStamp=Date.now(),t.imageLoadObject}function f(e){if(void 0===e)throw new Error("removeImageLoadObject: imageId must not be undefined");var t=s[e];if(void 0===t)throw new Error("removeImageLoadObject: imageId was not present in imageCache");l.splice(l.indexOf(t),1),o-=t.sizeInBytes;var n,a={action:"deleteImage",image:t};Object(i.default)(r.events,r.default.IMAGE_CACHE_CHANGED,a),(n=t.imageLoadObject).promise.then((function(){n.decache&&n.decache()}),(function(){n.decache&&n.decache()})),delete s[e]}function p(){return{maximumSizeInBytes:a,cacheSizeInBytes:o,numberOfImagesCached:l.length}}function m(){for(;l.length>0;)f(l[0].imageId)}function g(e,t){var n=s[e];n&&n.imageLoadObject.promise.then((function(e){var a=t-e.sizeInBytes;e.sizeInBytes=t,n.sizeInBytes=t,o+=a;var s={action:"changeImageSize",image:e};Object(i.default)(r.events,r.default.IMAGE_CACHE_CHANGED,s)}))}t.default={imageCache:s,cachedImages:l,setMaximumSizeBytes:u,putImageLoadObject:d,getImageLoadObject:h,removeImageLoadObject:f,getCacheInfo:p,purgeCache:m,changeImageIdCacheSize:g}},"./imageLoader.js":function(e,t,n){"use strict";n.r(t),n.d(t,"loadImage",(function(){return u})),n.d(t,"loadAndCacheImage",(function(){return c})),n.d(t,"registerImageLoader",(function(){return d})),n.d(t,"registerUnknownImageLoader",(function(){return h}));var r,i=n("./imageCache.js"),a=n("./events.js"),o=n("./triggerEvent.js"),s={};function l(e,t){var n=e.indexOf(":"),i=e.substring(0,n),l=s[i];if(null==l){if(void 0!==r)return r(e);throw new Error("loadImageFromImageLoader: no image loader for imageId")}var u=l(e,t);return u.promise.then((function(e){Object(o.default)(a.events,a.default.IMAGE_LOADED,{image:e})}),(function(t){var n={imageId:e,error:t};Object(o.default)(a.events,a.default.IMAGE_LOAD_FAILED,n)})),u}function u(e,t){if(void 0===e)throw new Error("loadImage: parameter imageId must not be undefined");var n=Object(i.getImageLoadObject)(e);return void 0!==n?n.promise:l(e,t).promise}function c(e,t){if(void 0===e)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");var n=Object(i.getImageLoadObject)(e);return void 0!==n||(n=l(e,t),Object(i.putImageLoadObject)(e,n)),n.promise}function d(e,t){s[e]=t}function h(e){var t=r;return r=e,t}},"./index.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js");n.d(t,"EVENTS",(function(){return r.default})),n.d(t,"events",(function(){return r.events}));var i=n("./enabledElements.js");n.d(t,"getEnabledElement",(function(){return i.getEnabledElement})),n.d(t,"addEnabledElement",(function(){return i.addEnabledElement})),n.d(t,"getEnabledElementsByImageId",(function(){return i.getEnabledElementsByImageId})),n.d(t,"getEnabledElements",(function(){return i.getEnabledElements}));var a=n("./layers.js");n.d(t,"addLayer",(function(){return a.addLayer})),n.d(t,"removeLayer",(function(){return a.removeLayer})),n.d(t,"getLayer",(function(){return a.getLayer})),n.d(t,"getLayers",(function(){return a.getLayers})),n.d(t,"getVisibleLayers",(function(){return a.getVisibleLayers})),n.d(t,"setActiveLayer",(function(){return a.setActiveLayer})),n.d(t,"getActiveLayer",(function(){return a.getActiveLayer})),n.d(t,"purgeLayers",(function(){return a.purgeLayers})),n.d(t,"setLayerImage",(function(){return a.setLayerImage}));var o=n("./falseColorMapping.js");n.d(t,"convertImageToFalseColorImage",(function(){return o.convertImageToFalseColorImage})),n.d(t,"convertToFalseColorImage",(function(){return o.convertToFalseColorImage})),n.d(t,"restoreImage",(function(){return o.restoreImage}));var s=n("./enabledElementData.js");n.d(t,"getElementData",(function(){return s.getElementData})),n.d(t,"removeElementData",(function(){return s.removeElementData}));var l=n("./imageLoader.js");n.d(t,"loadImage",(function(){return l.loadImage})),n.d(t,"loadAndCacheImage",(function(){return l.loadAndCacheImage})),n.d(t,"registerImageLoader",(function(){return l.registerImageLoader})),n.d(t,"registerUnknownImageLoader",(function(){return l.registerUnknownImageLoader}));var u=n("./canvasToPixel.js");n.d(t,"canvasToPixel",(function(){return u.default}));var c=n("./colors/index.js");n.d(t,"colors",(function(){return c.default}));var d=n("./disable.js");n.d(t,"disable",(function(){return d.default}));var h=n("./displayImage.js");n.d(t,"displayImage",(function(){return h.default}));var f=n("./draw.js");n.d(t,"draw",(function(){return f.default}));var p=n("./internal/drawImage.js");n.d(t,"drawImage",(function(){return p.default}));var m=n("./drawInvalidated.js");n.d(t,"drawInvalidated",(function(){return m.default}));var g=n("./enable.js");n.d(t,"enable",(function(){return g.default}));var v=n("./fitToWindow.js");n.d(t,"fitToWindow",(function(){return v.default}));var y=n("./internal/generateLut.js");n.d(t,"generateLut",(function(){return y.default}));var b=n("./internal/getDefaultViewport.js");n.d(t,"getDefaultViewport",(function(){return b.default}));var x=n("./getDefaultViewportForImage.js");n.d(t,"getDefaultViewportForImage",(function(){return x.default}));var w=n("./getImage.js");n.d(t,"getImage",(function(){return w.default}));var _=n("./getPixels.js");n.d(t,"getPixels",(function(){return _.default}));var S=n("./getStoredPixels.js");n.d(t,"getStoredPixels",(function(){return S.default}));var E=n("./getViewport.js");n.d(t,"getViewport",(function(){return E.default}));var T=n("./imageCache.js");n.d(t,"imageCache",(function(){return T.default}));var k=n("./internal/index.js");n.d(t,"internal",(function(){return k.default}));var C=n("./invalidate.js");n.d(t,"invalidate",(function(){return C.default}));var I=n("./invalidateImageId.js");n.d(t,"invalidateImageId",(function(){return I.default}));var O=n("./metaData.js");n.d(t,"metaData",(function(){return O.default}));var A=n("./pageToPixel.js");n.d(t,"pageToPixel",(function(){return A.default}));var D=n("./pixelDataToFalseColorData.js");n.d(t,"pixelDataToFalseColorData",(function(){return D.default}));var M=n("./pixelToCanvas.js");n.d(t,"pixelToCanvas",(function(){return M.default}));var N=n("./rendering/renderColorImage.js");n.d(t,"renderColorImage",(function(){return N.renderColorImage}));var j=n("./rendering/renderGrayscaleImage.js");n.d(t,"renderGrayscaleImage",(function(){return j.renderGrayscaleImage}));var R=n("./rendering/renderLabelMapImage.js");n.d(t,"renderLabelMapImage",(function(){return R.renderLabelMapImage}));var P=n("./rendering/renderPseudoColorImage.js");n.d(t,"renderPseudoColorImage",(function(){return P.renderPseudoColorImage}));var F=n("./rendering/renderToCanvas.js");n.d(t,"renderToCanvas",(function(){return F.default}));var L=n("./rendering/renderWebImage.js");n.d(t,"renderWebImage",(function(){return L.renderWebImage}));var $=n("./rendering/index.js");n.d(t,"rendering",(function(){return $.default}));var B=n("./internal/requestAnimationFrame.js");n.d(t,"requestAnimationFrame",(function(){return B.default}));var z=n("./reset.js");n.d(t,"reset",(function(){return z.default}));var U=n("./resize.js");n.d(t,"resize",(function(){return U.default}));var H=n("./internal/setDefaultViewport.js");n.d(t,"setDefaultViewport",(function(){return H.default}));var W=n("./setToPixelCoordinateSystem.js");n.d(t,"setToPixelCoordinateSystem",(function(){return W.default}));var V=n("./setViewport.js");n.d(t,"setViewport",(function(){return V.default}));var q=n("./internal/storedColorPixelDataToCanvasImageData.js");n.d(t,"storedColorPixelDataToCanvasImageData",(function(){return q.default}));var G=n("./internal/storedPixelDataToCanvasImageData.js");n.d(t,"storedPixelDataToCanvasImageData",(function(){return G.default}));var Y=n("./internal/storedPixelDataToCanvasImageDataColorLUT.js");n.d(t,"storedPixelDataToCanvasImageDataColorLUT",(function(){return Y.default}));var X=n("./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js");n.d(t,"storedPixelDataToCanvasImageDataPseudocolorLUT",(function(){return X.default}));var K=n("./triggerEvent.js");n.d(t,"triggerEvent",(function(){return K.default}));var Z=n("./updateImage.js");n.d(t,"updateImage",(function(){return Z.default}));var J=n("./webgl/index.js");n.d(t,"webGL",(function(){return J.default})),t.default={drawImage:p.default,generateLut:y.default,getDefaultViewport:b.default,requestAnimationFrame:B.default,storedPixelDataToCanvasImageData:G.default,storedColorPixelDataToCanvasImageData:q.default,storedPixelDataToCanvasImageDataColorLUT:Y.default,storedPixelDataToCanvasImageDataPseudocolorLUT:X.default,internal:k.default,renderLabelMapImage:R.renderLabelMapImage,renderPseudoColorImage:P.renderPseudoColorImage,renderColorImage:N.renderColorImage,renderGrayscaleImage:j.renderGrayscaleImage,renderWebImage:L.renderWebImage,renderToCanvas:F.default,canvasToPixel:u.default,disable:d.default,displayImage:h.default,draw:f.default,drawInvalidated:m.default,enable:g.default,getElementData:s.getElementData,removeElementData:s.removeElementData,getEnabledElement:i.getEnabledElement,addEnabledElement:i.addEnabledElement,getEnabledElementsByImageId:i.getEnabledElementsByImageId,getEnabledElements:i.getEnabledElements,addLayer:a.addLayer,removeLayer:a.removeLayer,getLayer:a.getLayer,getLayers:a.getLayers,getVisibleLayers:a.getVisibleLayers,setActiveLayer:a.setActiveLayer,getActiveLayer:a.getActiveLayer,purgeLayers:a.purgeLayers,setLayerImage:a.setLayerImage,fitToWindow:v.default,getDefaultViewportForImage:x.default,setDefaultViewport:H.default,getImage:w.default,getPixels:_.default,getStoredPixels:S.default,getViewport:E.default,loadImage:l.loadImage,loadAndCacheImage:l.loadAndCacheImage,registerImageLoader:l.registerImageLoader,registerUnknownImageLoader:l.registerUnknownImageLoader,invalidate:C.default,invalidateImageId:I.default,pageToPixel:A.default,pixelToCanvas:M.default,reset:z.default,resize:U.default,setToPixelCoordinateSystem:W.default,setViewport:V.default,updateImage:Z.default,pixelDataToFalseColorData:D.default,rendering:$.default,imageCache:T.default,metaData:O.default,webGL:J.default,colors:c.default,convertImageToFalseColorImage:o.convertImageToFalseColorImage,convertToFalseColorImage:o.convertToFalseColorImage,restoreImage:o.restoreImage,EVENTS:r.default,events:r.events,triggerEvent:K.default}},"./internal/calculateTransform.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/transform.js");t.default=function(e,t){var n=new r.Transform;n.translate(e.canvas.width/2,e.canvas.height/2);var i=e.viewport.rotation;0!==i&&n.rotate(i*Math.PI/180);var a=e.viewport.scale,o=e.viewport.scale,s=e.viewport.displayedArea.brhc.x-(e.viewport.displayedArea.tlhc.x-1),l=e.viewport.displayedArea.brhc.y-(e.viewport.displayedArea.tlhc.y-1);return"NONE"===e.viewport.displayedArea.presentationSizeMode?e.image.rowPixelSpacing<e.image.columnPixelSpacing?a*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(o*=e.image.rowPixelSpacing/e.image.columnPixelSpacing):(a=e.viewport.displayedArea.columnPixelSpacing,o=e.viewport.displayedArea.rowPixelSpacing,"SCALE TO FIT"===e.viewport.displayedArea.presentationSizeMode&&(a=o=Math.min(e.canvas.width/(s*a),e.canvas.height/(l*o)),e.viewport.displayedArea.rowPixelSpacing<e.viewport.displayedArea.columnPixelSpacing?a*=e.viewport.displayedArea.columnPixelSpacing/e.viewport.displayedArea.rowPixelSpacing:e.viewport.displayedArea.columnPixelSpacing<e.viewport.displayedArea.rowPixelSpacing&&(o*=e.viewport.displayedArea.rowPixelSpacing/e.viewport.displayedArea.columnPixelSpacing))),n.scale(a,o),0!==i&&n.rotate(-i*Math.PI/180),n.translate(e.viewport.translation.x,e.viewport.translation.y),0!==i&&n.rotate(i*Math.PI/180),void 0!==t&&n.scale(t,t),e.viewport.hflip&&n.scale(-1,1),e.viewport.vflip&&n.scale(1,-1),n.translate(-s/2,-l/2),n}},"./internal/computeAutoVoi.js":function(e,t,n){"use strict";function r(e,t){if(!function(e){return e.voiLUT&&e.voiLUT.lut&&e.voiLUT.lut.length>0||void 0!==e.voi.windowWidth&&void 0!==e.voi.windowCenter}(e)){var n=t.maxPixelValue*t.slope+t.intercept,r=t.minPixelValue*t.slope+t.intercept,i=n-r,a=(n+r)/2;void 0===e.voi?e.voi={windowWidth:i,windowCenter:a}:(e.voi.windowWidth=i,e.voi.windowCenter=a)}}n.r(t),n.d(t,"default",(function(){return r}))},"./internal/createViewport.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/setDefaultViewport.js");t.default=function(){return Object.assign({},{scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:{tlhc:{x:1,y:1},brhc:{x:1,y:1},rowPixelSpacing:1,columnPixelSpacing:1,presentationSizeMode:"NONE"}},r.state.viewport)}},"./internal/drawCompositeImage.js":function(e,t,n){"use strict";n.r(t);var r=n("./layers.js"),i=n("./rendering/renderGrayscaleImage.js"),a=n("./rendering/renderColorImage.js"),o=n("./rendering/renderPseudoColorImage.js"),s=n("./rendering/renderLabelMapImage.js"),l=n("./setToPixelCoordinateSystem.js");function u(e){var t=e.syncProps||{};t.originalScale=e.viewport.scale,e.syncProps=t}t.default=function(e,t){var n=e.element,c=Object(r.getLayers)(n),d=Object(r.getActiveLayer)(n),h=Object(r.getVisibleLayers)(n),f=!e.lastSyncViewportsState&&e.syncViewports;e.lastSyncViewportsState=e.syncViewports,f&&c.forEach((function(e){e.viewport&&u(e)})),!0===e.syncViewports&&function(e,t){e.forEach((function(e){if(e!==t&&e.viewport&&t.viewport){e.syncProps||u(e);var n,r,i=(r=e,(n=t).syncProps||u(n),r.syncProps||u(r),r.syncProps.originalScale/n.syncProps.originalScale);e.viewport.scale=t.viewport.scale*i,e.viewport.rotation=t.viewport.rotation,e.viewport.translation={x:t.viewport.translation.x/i,y:t.viewport.translation.y/i},e.viewport.hflip=t.viewport.hflip,e.viewport.vflip=t.viewport.vflip}}))}(h,d);var p=e.canvas.getContext("2d");p.setTransform(1,0,0,1,0,0),p.fillStyle="black",p.fillRect(0,0,e.canvas.width,e.canvas.height),function(e,t,n){t.forEach((function(t,r){if(t.image){e.save(),t.canvas=e.canvas,Object(l.default)(t,e);var u=t.viewport.colormap||t.options.colormap,c=t.invalid||n;if(u&&""!==u&&!0===t.viewport.labelmap)Object(s.addLabelMapLayer)(t,c);else if(u&&""!==u)Object(o.addPseudoColorLayer)(t,c);else if(!0===t.image.color)Object(a.addColorLayer)(t,c);else{var d=0===r;Object(i.addGrayscaleLayer)(t,c,d)}e.globalAlpha=t.options&&t.options.opacity?t.options.opacity:1,t.options&&t.options.fillStyle&&(e.fillStyle=t.options.fillStyle),e.imageSmoothingEnabled=!t.viewport.pixelReplication,e.mozImageSmoothingEnabled=e.imageSmoothingEnabled;var h=t.viewport.displayedArea.tlhc.x-1,f=t.viewport.displayedArea.tlhc.y-1,p=t.viewport.displayedArea.brhc.x-h,m=t.viewport.displayedArea.brhc.y-f;e.drawImage(t.canvas,h,f,p,m,0,0,p,m),e.restore(),t.invalid=!1}}))}(p,h,t)}},"./internal/drawImage.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.needsRedraw=!0,t&&(e.invalid=!0)}},"./internal/drawImageSync.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/now.js"),i=n("./internal/drawCompositeImage.js"),a=n("./rendering/renderColorImage.js"),o=n("./rendering/renderGrayscaleImage.js"),s=n("./rendering/renderPseudoColorImage.js"),l=n("./rendering/renderLabelMapImage.js"),u=n("./triggerEvent.js"),c=n("./events.js");t.default=function(e,t){var n=e.image,d=e.element,h=e.layers||[];if(e.canvas&&(e.image||h.length)){var f=Object(r.default)();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},h&&h.length)Object(i.default)(e,t);else if(n){var p=n.render;p||(p=e.viewport.colormap&&""!==e.viewport.colormap&&!0===e.image.labelmap?l.renderLabelMapImage:e.viewport.colormap&&""!==e.viewport.colormap?s.renderPseudoColorImage:n.color?a.renderColorImage:o.renderGrayscaleImage),p(e,t)}var m=Object(r.default)()-f,g={viewport:e.viewport,element:d,image:n,enabledElement:e,canvasContext:e.canvas.getContext("2d"),renderTimeInMs:m};n.stats.lastRenderTime=m,e.invalid=!1,e.needsRedraw=!1,Object(u.default)(d,c.default.IMAGE_RENDERED,g)}}},"./internal/generateColorLut.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/getVOILut.js");t.default=function(e,t,n,i,a){var o=e.maxPixelValue,s=e.minPixelValue,l=Math.min(s,0);if(void 0===e.cachedLut){var u=o-l+1;e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(u)}var c=e.cachedLut.lutArray,d=Object(r.default)(t,n,a);if(!0===i)for(var h=s;h<=o;h++)c[h+-l]=255-d(h);else for(var f=s;f<=o;f++)c[f+-l]=d(f);return c}},"./internal/generateLut.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/getModalityLUT.js"),i=n("./internal/getVOILut.js");t.default=function(e,t,n,a,o,s){var l=e.maxPixelValue,u=e.minPixelValue,c=Math.min(u,0);if(void 0===e.cachedLut){var d=l-c+1;e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(d)}var h=e.cachedLut.lutArray,f=Object(r.default)(e.slope,e.intercept,o),p=Object(i.default)(t,n,s);if(!0===a)for(var m=u;m<=l;m++)h[m+-c]=255-p(f(m));else for(var g=u;g<=l;g++)h[g+-c]=p(f(g));return h}},"./internal/getCanvas.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r="cornerstone-canvas";function i(e){var t="canvas.".concat(r);return e.querySelector(t)||function(e){var t=document.createElement("canvas");return t.style.display="block",t.classList.add(r),e.appendChild(t),t}(e)}},"./internal/getDefaultViewport.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/createViewport.js"),i=n("./internal/getImageFitScale.js");t.default=function(e,t){if(void 0===e)throw new Error("getDefaultViewport: parameter canvas must not be undefined");return void 0===t?Object(r.default)():{scale:Object(i.default)(e,t,0).scaleFactor,translation:{x:0,y:0},voi:{windowWidth:t.windowWidth,windowCenter:t.windowCenter},invert:t.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:t.modalityLUT,voiLUT:t.voiLUT,colormap:t.colormap,labelmap:Boolean(t.labelmap),displayedArea:{tlhc:{x:1,y:1},brhc:{x:t.columns,y:t.rows},rowPixelSpacing:void 0===t.rowPixelSpacing?1:t.rowPixelSpacing,columnPixelSpacing:void 0===t.columnPixelSpacing?1:t.columnPixelSpacing,presentationSizeMode:"NONE"}}}},"./internal/getImageFitScale.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/validator.js"),i=n("./internal/getImageSize.js");t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(r.validateParameterUndefinedOrNull)(e,"getImageScale: parameter windowSize must not be undefined"),Object(r.validateParameterUndefinedOrNull)(t,"getImageScale: parameter image must not be undefined");var a=Object(i.default)(t,n),o=t.rowPixelSpacing||1,s=t.columnPixelSpacing||1,l=1,u=1;o<s?u=s/o:l=o/s;var c=e.height/a.height/l,d=e.width/a.width/u;return{verticalScale:c,horizontalScale:d,scaleFactor:Math.min(d,c)}}},"./internal/getImageSize.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/validator.js");function i(e){return!(null==e||0===e||180===e)}t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Object(r.validateParameterUndefinedOrNull)(e,"getImageSize: parameter image must not be undefined"),Object(r.validateParameterUndefinedOrNull)(e.width,"getImageSize: parameter image must have width"),Object(r.validateParameterUndefinedOrNull)(e.height,"getImageSize: parameter image must have height"),i(t)?{height:e.width,width:e.height}:{width:e.width,height:e.height}}},"./internal/getModalityLUT.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){return n?function(e){var t=e.lut[0],n=e.lut[e.lut.length-1],r=e.firstValueMapped+e.lut.length;return function(i){return i<e.firstValueMapped?t:i>=r?n:e.lut[i]}}(n):function(e,t){return function(n){return n*e+t}}(e,t)}},"./internal/getTransform.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/calculateTransform.js");t.default=function(e){return Object(r.default)(e)}},"./internal/getVOILut.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t,n){return n?function(e){var t,n=Math.max.apply(Math,(t=e.lut,function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(t)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}())).toString(2).length-8,r=e.lut[0]>>n,i=e.lut[e.lut.length-1]>>n,a=e.firstValueMapped+e.lut.length-1;return function(t){return t<e.firstValueMapped?r:t>=a?i:e.lut[t-e.firstValueMapped]>>n}}(n):function(e,t){return function(n){return 255*((n-t)/e+.5)}}(e,t)}},"./internal/guid.js":function(e,t,n){"use strict";function r(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}n.r(t),t.default=function(){return"".concat(r()+r(),"-").concat(r(),"-").concat(r(),"-").concat(r(),"-").concat(r()).concat(r()).concat(r())}},"./internal/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/transform.js"),i=n("./internal/calculateTransform.js"),a=n("./internal/drawImage.js"),o=n("./internal/generateLut.js"),s=n("./internal/getDefaultViewport.js"),l=n("./internal/getTransform.js"),u=n("./internal/requestAnimationFrame.js"),c=n("./internal/setDefaultViewport.js"),d=n("./internal/storedColorPixelDataToCanvasImageData.js"),h=n("./internal/storedPixelDataToCanvasImageData.js"),f=n("./internal/storedPixelDataToCanvasImageDataColorLUT.js"),p=n("./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js"),m=n("./internal/storedPixelDataToCanvasImageDataRGBA.js");t.default={drawImage:a.default,generateLut:o.default,getDefaultViewport:s.default,requestAnimationFrame:u.default,setDefaultViewport:c.default,storedPixelDataToCanvasImageData:h.default,storedPixelDataToCanvasImageDataRGBA:m.default,storedPixelDataToCanvasImageDataColorLUT:f.default,storedPixelDataToCanvasImageDataPseudocolorLUT:p.default,storedColorPixelDataToCanvasImageData:d.default,getTransform:l.default,calculateTransform:i.default,Transform:r.Transform}},"./internal/now.js":function(e,t,n){"use strict";n.r(t),t.default=function(){return window.performance?performance.now():Date.now()}},"./internal/requestAnimationFrame.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){return window.requestAnimationFrame(e)||window.webkitRequestAnimationFrame(e)||window.mozRequestAnimationFrame(e)||window.oRequestAnimationFrame(e)||window.msRequestAnimationFrame(e)||function(e){window.setTimeout(e,1e3/60)}(e)}},"./internal/setDefaultViewport.js":function(e,t,n){"use strict";n.r(t),n.d(t,"state",(function(){return r}));var r={viewport:{}};t.default=function(e){r.viewport=e||{}}},"./internal/storedColorPixelDataToCanvasImageData.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/now.js");t.default=function(e,t,n){var i=Object(r.default)(),a=e.getPixelData();e.stats.lastGetPixelDataTime=Object(r.default)()-i;var o=e.minPixelValue,s=0,l=0,u=a.length;if(i=Object(r.default)(),o<0)for(;l<u;)n[s++]=t[a[l++]+-o],n[s++]=t[a[l++]+-o],n[s]=t[a[l]+-o],l+=2,s+=2;else for(;l<u;)n[s++]=t[a[l++]],n[s++]=t[a[l++]],n[s]=t[a[l]],l+=2,s+=2;e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(r.default)()-i}},"./internal/storedPixelDataToCanvasImageData.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/now.js");t.default=function(e,t,n){var i=Object(r.default)(),a=e.getPixelData();e.stats.lastGetPixelDataTime=Object(r.default)()-i;var o=a.length,s=e.minPixelValue,l=3,u=0;if(i=Object(r.default)(),a instanceof Int16Array)if(s<0)for(;u<o;)n[l]=t[a[u++]+-s],l+=4;else for(;u<o;)n[l]=t[a[u++]],l+=4;else if(a instanceof Uint16Array)for(;u<o;)n[l]=t[a[u++]],l+=4;else if(s<0)for(;u<o;)n[l]=t[a[u++]+-s],l+=4;else for(;u<o;)n[l]=t[a[u++]],l+=4;e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(r.default)()-i}},"./internal/storedPixelDataToCanvasImageDataColorLUT.js":function(e,t,n){"use strict";n.r(t);var r=n("./colors/index.js"),i=n("./internal/now.js");t.default=function(e,t,n){var a=Object(i.default)(),o=e.getPixelData();e.stats.lastGetPixelDataTime=Object(i.default)()-a;var s,l,u=o.length,c=e.minPixelValue,d=0,h=0;if(a=Object(i.default)(),l=t instanceof r.default.LookupTable?t.Table:t,c<0)for(;h<u;)s=l[o[h++]+-c],n[d++]=s[0],n[d++]=s[1],n[d++]=s[2],n[d++]=s[3];else for(;h<u;)s=l[o[h++]],n[d++]=s[0],n[d++]=s[1],n[d++]=s[2],n[d++]=s[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(i.default)()-a}},"./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js":function(e,t,n){"use strict";n.r(t);var r=n("./colors/index.js"),i=n("./internal/now.js");t.default=function(e,t,n,a){var o=Object(i.default)(),s=e.getPixelData();e.stats.lastGetPixelDataTime=Object(i.default)()-o;var l,u,c,d=s.length,h=e.minPixelValue,f=0,p=0;if(o=Object(i.default)(),c=n instanceof r.default.LookupTable?n.Table:n,h<0)for(;p<d;)l=t[s[p++]+-h],a[f++]=(u=c[l])[0],a[f++]=u[1],a[f++]=u[2],a[f++]=u[3];else for(;p<d;)l=t[s[p++]],a[f++]=(u=c[l])[0],a[f++]=u[1],a[f++]=u[2],a[f++]=u[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(i.default)()-o}},"./internal/storedPixelDataToCanvasImageDataRGBA.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/now.js");t.default=function(e,t,n){var i=Object(r.default)(),a=e.getPixelData();e.stats.lastGetPixelDataTime=Object(r.default)()-i;var o,s=a.length,l=e.minPixelValue,u=0,c=0;if(i=Object(r.default)(),a instanceof Int16Array)if(l<0)for(;c<s;)o=t[a[c++]+-l],n[u++]=o,n[u++]=o,n[u++]=o,n[u++]=255;else for(;c<s;)o=t[a[c++]],n[u++]=o,n[u++]=o,n[u++]=o,n[u++]=255;else if(a instanceof Uint16Array)for(;c<s;)o=t[a[c++]],n[u++]=o,n[u++]=o,n[u++]=o,n[u++]=255;else if(l<0)for(;c<s;)o=t[a[c++]+-l],n[u++]=o,n[u++]=o,n[u++]=o,n[u++]=255;else for(;c<s;)o=t[a[c++]],n[u++]=o,n[u++]=o,n[u++]=o,n[u++]=255;e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(r.default)()-i}},"./internal/storedRGBAPixelDataToCanvasImageData.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/now.js");t.default=function(e,t,n){var i=Object(r.default)(),a=e.getPixelData();e.stats.lastGetPixelDataTime=Object(r.default)()-i;var o=e.minPixelValue,s=0,l=0,u=a.length;if(i=Object(r.default)(),o<0)for(;l<u;)n[s++]=t[a[l++]+-o],n[s++]=t[a[l++]+-o],n[s++]=t[a[l++]+-o],n[s++]=a[l++];else for(;l<u;)n[s++]=t[a[l++]],n[s++]=t[a[l++]],n[s++]=t[a[l++]],n[s++]=a[l++];e.stats.lastStoredPixelDataToCanvasImageDataTime=Object(r.default)()-i}},"./internal/transform.js":function(e,t,n){"use strict";n.r(t),n.d(t,"Transform",(function(){return r}));var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.reset()}var t;return(t=[{key:"reset",value:function(){this.m=[1,0,0,1,0,0]}},{key:"clone",value:function(){var t=new e;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t}},{key:"multiply",value:function(e){var t=this.m[1]*e.m[0]+this.m[3]*e.m[1],n=this.m[0]*e.m[2]+this.m[2]*e.m[3],r=this.m[1]*e.m[2]+this.m[3]*e.m[3],i=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],a=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];this.m[0]=this.m[0]*e.m[0]+this.m[2]*e.m[1],this.m[1]=t,this.m[2]=n,this.m[3]=r,this.m[4]=i,this.m[5]=a}},{key:"invert",value:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=-this.m[1]*e,n=-this.m[2]*e,r=this.m[0]*e,i=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),a=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=this.m[3]*e,this.m[1]=t,this.m[2]=n,this.m[3]=r,this.m[4]=i,this.m[5]=a}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.m[1]*t+this.m[3]*n,i=this.m[0]*-n+this.m[2]*t,a=this.m[1]*-n+this.m[3]*t;this.m[0]=this.m[0]*t+this.m[2]*n,this.m[1]=r,this.m[2]=i,this.m[3]=a}},{key:"translate",value:function(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}},{key:"scale",value:function(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}},{key:"transformPoint",value:function(e,t){var n=e;return{x:e=n*this.m[0]+t*this.m[2]+this.m[4],y:t=n*this.m[1]+t*this.m[3]+this.m[5]}}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}()},"./internal/tryEnableWebgl.js":function(e,t,n){"use strict";n.r(t);var r=n("./webgl/index.js");t.default=function(e){return r.default.renderer.isWebGLAvailable()?(r.default.renderer.initRenderer(),e.renderer="webgl",!0):(console.error("WebGL not available, falling back to Canvas renderer"),delete e.renderer,!1)}},"./internal/validator.js":function(e,t,n){"use strict";function r(e,t){if(void 0===e)throw new Error(t)}function i(e,t){if(null==e)throw new Error(t)}n.r(t),n.d(t,"validateParameterUndefined",(function(){return r})),n.d(t,"validateParameterUndefinedOrNull",(function(){return i}))},"./invalidate.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./triggerEvent.js"),a=n("./events.js");t.default=function(e){var t=Object(r.getEnabledElement)(e);t.invalid=!0,t.needsRedraw=!0;var n={element:e};Object(i.default)(e,a.default.INVALIDATED,n)}},"./invalidateImageId.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/drawImage.js");t.default=function(e){Object(r.getEnabledElementsByImageId)(e).forEach((function(e){Object(i.default)(e,!0)}))}},"./layers.js":function(e,t,n){"use strict";n.r(t),n.d(t,"rescaleImage",(function(){return c})),n.d(t,"addLayer",(function(){return d})),n.d(t,"removeLayer",(function(){return h})),n.d(t,"getLayer",(function(){return f})),n.d(t,"getLayers",(function(){return p})),n.d(t,"getVisibleLayers",(function(){return m})),n.d(t,"setActiveLayer",(function(){return g})),n.d(t,"setLayerImage",(function(){return v})),n.d(t,"getActiveLayer",(function(){return y})),n.d(t,"purgeLayers",(function(){return b}));var r=n("./internal/guid.js"),i=n("./enabledElements.js"),a=n("./internal/getDefaultViewport.js"),o=n("./updateImage.js"),s=n("./triggerEvent.js"),l=n("./events.js");function u(e,t,n){var r=t.element,i={viewport:t.viewport,element:t.element,image:t.image,enabledElement:t,layerId:n};Object(s.default)(r,e,i)}function c(e,t){if(e.layerId===t.layerId)throw new Error("rescaleImage: both arguments represent the same layer");var n=e.image,r=t.image;n.imageId&&r.imageId&&(t.viewport.scale=e.viewport.scale*(t.viewport.scale/e.viewport.scale*(t.viewport.displayedArea.columnPixelSpacing*r.width/(e.viewport.displayedArea.columnPixelSpacing*n.width))))}function d(e,t,n){var o,s=Object(r.default)(),d=Object(i.getEnabledElement)(e),h=d.layers;t&&(o=Object(a.default)(d.canvas,t),n&&n.viewport&&(o=Object.assign(o,n.viewport))),!1!==d.syncViewports&&(d.syncViewports=!0);var f={image:t,layerId:s,viewport:o,options:n||{},renderingTools:{}};return h.length&&t&&c(h[0],f),h.push(f),u(l.default.LAYER_ADDED,d,s),1===h.length&&t&&g(e,s),s}function h(e,t){var n=Object(i.getEnabledElement)(e),r=n.layers,a=n.layers.findIndex((function(e){return e.layerId===t}));-1!==a&&(r.splice(a,1),t===n.activeLayerId&&r.length&&g(e,r[0].layerId),u(l.default.LAYER_REMOVED,n,t))}function f(e,t){return Object(i.getEnabledElement)(e).layers.find((function(e){return e.layerId===t}))}function p(e){return Object(i.getEnabledElement)(e).layers}function m(e){return Object(i.getEnabledElement)(e).layers.filter((function(e){return e.options&&!1!==e.options.visible&&0!==e.options.opacity}))}function g(e,t){var n=Object(i.getEnabledElement)(e);if(n.activeLayerId!==t){var r=n.layers.findIndex((function(e){return e.layerId===t}));if(-1===r)throw new Error("setActiveLayer: layer not found in layers array");var a=n.layers[r];if(!a.image)throw new Error("setActiveLayer: layer with undefined image cannot be set as active.");n.activeLayerId=t,n.image=a.image,n.viewport=a.viewport,Object(o.default)(e),u(l.default.ACTIVE_LAYER_CHANGED,n,t)}}function v(e,t,n){var r,o=Object(i.getEnabledElement)(e),s=o.layers[0];if(!(r=n?f(e,n):y(e)))throw new Error("setLayerImage: Layer not found");if(r.image=t,t){if(!r.viewport){var l=Object(a.default)(o.canvas,t);r.options&&r.options.viewport&&(r.viewport=Object.assign(l,r.options.viewport)),s.layerId!==n&&c(s,r)}}else r.viewport=void 0}function y(e){var t=Object(i.getEnabledElement)(e);return t.layers.find((function(e){return e.layerId===t.activeLayerId}))}function b(e){var t=Object(i.getEnabledElement)(e);t.layers=[],delete t.activeLayerId,delete t.lastSyncViewportsState}},"./metaData.js":function(e,t,n){"use strict";n.r(t),n.d(t,"addProvider",(function(){return i})),n.d(t,"removeProvider",(function(){return a}));var r=[];function i(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(t=0;t<r.length&&!(r[t].priority<=n);t++);r.splice(t,0,{priority:n,provider:e})}function a(e){for(var t=0;t<r.length;t++)if(r[t].provider===e){r.splice(t,1);break}}t.default={addProvider:i,removeProvider:a,get:function(e,t){for(var n=0;n<r.length;n++){var i=r[n].provider(e,t);if(void 0!==i)return i}}}},"./pageToPixel.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/getTransform.js");t.default=function(e,t,n){var a=Object(r.getEnabledElement)(e);if(void 0===a.image)throw new Error("image has not been loaded yet");var o=e.getBoundingClientRect(),s={x:t-o.left-window.pageXOffset,y:n-o.top-window.pageYOffset},l=Object(i.default)(a);return l.invert(),l.transformPoint(s.x,s.y)}},"./pixelDataToFalseColorData.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n("./colors/index.js");function i(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");var n,i,a=e.minPixelValue,o=0,s=0,l=e.width*e.height,u=e.origPixelData||e.getPixelData(),c=new Uint8Array(4*l);if(e.color=!0,e.falseColor=!0,e.origPixelData=u,t instanceof r.default.LookupTable)for(t.build();s<l;)n=u[s++],i=t.mapValue(n),c[o++]=i[0],c[o++]=i[1],c[o++]=i[2],c[o++]=i[3];else if(a<0)for(;s<l;)n=u[s++],c[o++]=t[n+-a][0],c[o++]=t[n+-a][1],c[o++]=t[n+-a][2],c[o++]=t[n+-a][3];else for(;s<l;)n=u[s++],c[o++]=t[n][0],c[o++]=t[n][1],c[o++]=t[n][2],c[o++]=t[n][3];e.rgba=!0,e.cachedLut=void 0,e.render=void 0,e.slope=1,e.intercept=0,e.minPixelValue=0,e.maxPixelValue=255,e.windowWidth=255,e.windowCenter=128,e.getPixelData=function(){return c}}},"./pixelToCanvas.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/getTransform.js");t.default=function(e,t){var n=Object(r.getEnabledElement)(e);return Object(i.default)(n).transformPoint(t.x,t.y)}},"./rendering/doesImageNeedToBeRendered.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=e.renderingTools.lastRenderedViewport;return t.imageId!==e.renderingTools.lastRenderedImageId||!n||n.windowCenter!==e.viewport.voi.windowCenter||n.windowWidth!==e.viewport.voi.windowWidth||n.invert!==e.viewport.invert||n.rotation!==e.viewport.rotation||n.hflip!==e.viewport.hflip||n.vflip!==e.viewport.vflip||n.modalityLUT!==e.viewport.modalityLUT||n.voiLUT!==e.viewport.voiLUT||n.colormap!==e.viewport.colormap}},"./rendering/getLut.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/computeAutoVoi.js"),i=n("./rendering/lutMatches.js"),a=n("./internal/generateLut.js");t.default=function(e,t,n){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&Object(i.default)(e.cachedLut.modalityLUT,t.modalityLUT)&&Object(i.default)(e.cachedLut.voiLUT,t.voiLUT)&&e.cachedLut.invert===t.invert&&!0!==n||(Object(r.default)(t,e),Object(a.default)(e,t.voi.windowWidth,t.voi.windowCenter,t.invert,t.modalityLUT,t.voiLUT),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert,e.cachedLut.voiLUT=t.voiLUT,e.cachedLut.modalityLUT=t.modalityLUT),e.cachedLut.lutArray}},"./rendering/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./rendering/renderColorImage.js"),i=n("./rendering/renderGrayscaleImage.js"),a=n("./rendering/renderWebImage.js"),o=n("./rendering/renderPseudoColorImage.js"),s=n("./rendering/renderLabelMapImage.js"),l=n("./rendering/renderToCanvas.js");t.default={colorImage:r.renderColorImage,grayscaleImage:i.renderGrayscaleImage,webImage:a.renderWebImage,pseudoColorImage:o.renderPseudoColorImage,labelMapImage:s.renderLabelMapImage,toCanvas:l.default}},"./rendering/initializeRenderCanvas.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){var n=e.renderingTools.renderCanvas;n.width=t.width,n.height=t.height;var r=n.getContext("2d");r.fillStyle="white",r.fillRect(0,0,n.width,n.height);var i=r.getImageData(0,0,t.width,t.height);e.renderingTools.renderCanvasContext=r,e.renderingTools.renderCanvasData=i}},"./rendering/lutMatches.js":function(e,t,n){"use strict";n.r(t),t.default=function(e,t){return!e&&!t||!(!e||!t)&&e.id===t.id}},"./rendering/renderColorImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"renderColorImage",(function(){return f})),n.d(t,"addColorLayer",(function(){return p}));var r=n("./internal/now.js"),i=n("./internal/generateColorLut.js"),a=n("./internal/storedColorPixelDataToCanvasImageData.js"),o=n("./internal/storedRGBAPixelDataToCanvasImageData.js"),s=n("./setToPixelCoordinateSystem.js"),l=n("./webgl/index.js"),u=n("./rendering/doesImageNeedToBeRendered.js"),c=n("./rendering/initializeRenderCanvas.js"),d=n("./rendering/saveLastRendered.js");function h(e,t,n){e.renderingTools.renderCanvas&&!0===e.renderingTools.lastRenderedIsColor||(e.renderingTools.renderCanvas=document.createElement("canvas"));var s=e.renderingTools.renderCanvas;if(255===e.viewport.voi.windowWidth&&128===e.viewport.voi.windowCenter&&!1===e.viewport.invert&&t.getCanvas&&t.getCanvas())return t.getCanvas();if(!1===Object(u.default)(e,t)&&!0!==n)return s;s.width===t.width&&s.height===t.height||Object(c.default)(e,t);var l=Object(r.default)(),d=function(e,t){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&e.cachedLut.invert===t.invert||(Object(i.default)(e,t.voi.windowWidth,t.voi.windowCenter,t.invert),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert),e.cachedLut.lutArray}(t,e.viewport);t.stats=t.stats||{},t.stats.lastLutGenerateTime=Object(r.default)()-l;var h=e.renderingTools.renderCanvasData,f=e.renderingTools.renderCanvasContext;return t.rgba?Object(o.default)(t,d,h.data):Object(a.default)(t,d,h.data),l=Object(r.default)(),f.putImageData(h,0,0),t.stats.lastPutImageDataTime=Object(r.default)()-l,s}function f(e,t){if(void 0===e)throw new Error("renderColorImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("renderColorImage: image must be loaded before it can be drawn");var r,i=e.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0),i.fillStyle="black",i.fillRect(0,0,e.canvas.width,e.canvas.height),i.imageSmoothingEnabled=!e.viewport.pixelReplication,i.mozImageSmoothingEnabled=i.imageSmoothingEnabled,Object(s.default)(e,i),r=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?l.default.renderer.render(e):h(e,n,t);var a=e.viewport.displayedArea.tlhc.x-1,o=e.viewport.displayedArea.tlhc.y-1,u=e.viewport.displayedArea.brhc.x-a,c=e.viewport.displayedArea.brhc.y-o;i.drawImage(r,a,o,u,c,0,0,u,c),e.renderingTools=Object(d.default)(e)}function p(e,t){if(void 0===e)throw new Error("addColorLayer: layer parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("addColorLayer: image must be loaded before it can be drawn");n.rgba=!0,e.canvas=h(e,n,t);var r=e.canvas.getContext("2d");r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,e.renderingTools=Object(d.default)(e)}},"./rendering/renderGrayscaleImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"renderGrayscaleImage",(function(){return f})),n.d(t,"addGrayscaleLayer",(function(){return p}));var r=n("./internal/storedPixelDataToCanvasImageData.js"),i=n("./internal/storedPixelDataToCanvasImageDataRGBA.js"),a=n("./setToPixelCoordinateSystem.js"),o=n("./internal/now.js"),s=n("./webgl/index.js"),l=n("./rendering/getLut.js"),u=n("./rendering/doesImageNeedToBeRendered.js"),c=n("./rendering/initializeRenderCanvas.js"),d=n("./rendering/saveLastRendered.js");function h(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=!0===e.renderingTools.lastRenderedIsColor;e.renderingTools.renderCanvas&&!s||(e.renderingTools.renderCanvas=document.createElement("canvas"),Object(c.default)(e,t));var d=e.renderingTools.renderCanvas;if(!1===Object(u.default)(e,t)&&!0!==n)return d;d.width===t.width&&d.height===t.height||Object(c.default)(e,t);var h=Object(o.default)(),f=Object(l.default)(t,e.viewport,n);t.stats=t.stats||{},t.stats.lastLutGenerateTime=Object(o.default)()-h;var p=e.renderingTools.renderCanvasData,m=e.renderingTools.renderCanvasContext;return a?Object(r.default)(t,f,p.data):Object(i.default)(t,f,p.data),h=Object(o.default)(),m.putImageData(p,0,0),t.stats.lastPutImageDataTime=Object(o.default)()-h,d}function f(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");var r,i=e.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0),i.fillStyle="black",i.fillRect(0,0,e.canvas.width,e.canvas.height),i.imageSmoothingEnabled=!e.viewport.pixelReplication,i.mozImageSmoothingEnabled=i.imageSmoothingEnabled,Object(a.default)(e,i),r=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?s.default.renderer.render(e):h(e,n,t);var o=e.viewport.displayedArea.tlhc.x-1,l=e.viewport.displayedArea.tlhc.y-1,u=e.viewport.displayedArea.brhc.x-o,c=e.viewport.displayedArea.brhc.y-l;i.drawImage(r,o,l,u,c,0,0,u,c),e.renderingTools=Object(d.default)(e)}function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===e)throw new Error("addGrayscaleLayer: layer parameter must not be undefined");var r=e.image;if(void 0===r)throw new Error("addGrayscaleLayer: image must be loaded before it can be drawn");e.canvas=h(e,r,t,n);var i=e.canvas.getContext("2d");i.imageSmoothingEnabled=!e.viewport.pixelReplication,i.mozImageSmoothingEnabled=i.imageSmoothingEnabled,e.renderingTools=Object(d.default)(e)}},"./rendering/renderLabelMapImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"renderLabelMapImage",(function(){return d})),n.d(t,"addLabelMapLayer",(function(){return h}));var r=n("./setToPixelCoordinateSystem.js"),i=n("./internal/now.js"),a=n("./rendering/initializeRenderCanvas.js"),o=n("./rendering/saveLastRendered.js"),s=n("./rendering/doesImageNeedToBeRendered.js"),l=n("./internal/storedPixelDataToCanvasImageDataColorLUT.js"),u=n("./colors/index.js");function c(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));var r=e.renderingTools.renderCanvas,o=e.viewport.colormap||e.options.colormap;if(e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),o&&"string"==typeof o&&(o=u.default.getColormap(o)),!o)throw new Error("renderLabelMapImage: colormap not found.");var c=o.getId();if(!1===Object(s.default)(e,t)&&!0!==n&&e.renderingTools.colormapId===c)return r;r.width===t.width&&r.height===t.height||Object(a.default)(e,t);var d=Object(i.default)();e.renderingTools.colorLut&&!n&&e.renderingTools.colormapId===c||(e.renderingTools.colorLut=o.createLookupTable(),e.renderingTools.colormapId=c),t.stats=t.stats||{},t.stats.lastLutGenerateTime=Object(i.default)()-d;var h=e.renderingTools.colorLut,f=e.renderingTools.renderCanvasData,p=e.renderingTools.renderCanvasContext;return Object(l.default)(t,h,f.data),d=Object(i.default)(),p.putImageData(f,0,0),t.stats.lastPutImageDataTime=Object(i.default)()-d,r}function d(e,t){if(void 0===e)throw new Error("renderLabelMapImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("renderLabelMapImage: image must be loaded before it can be drawn");var i=e.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0),i.fillStyle="black",i.fillRect(0,0,e.canvas.width,e.canvas.height),i.imageSmoothingEnabled=!e.viewport.pixelReplication,i.mozImageSmoothingEnabled=i.imageSmoothingEnabled,Object(r.default)(e,i);var a=c(e,n,t),s=e.viewport.displayedArea.tlhc.x-1,l=e.viewport.displayedArea.tlhc.y-1,u=e.viewport.displayedArea.brhc.x-s,d=e.viewport.displayedArea.brhc.y-l;i.drawImage(a,s,l,u,d,0,0,u,d),e.renderingTools=Object(o.default)(e)}function h(e,t){if(void 0===e)throw new Error("addLabelMapLayer: layer parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("addLabelMapLayer: image must be loaded before it can be drawn");e.canvas=c(e,n,t);var r=e.canvas.getContext("2d");r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,e.renderingTools=Object(o.default)(e)}},"./rendering/renderPseudoColorImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"renderPseudoColorImage",(function(){return h})),n.d(t,"addPseudoColorLayer",(function(){return f}));var r=n("./setToPixelCoordinateSystem.js"),i=n("./internal/now.js"),a=n("./rendering/initializeRenderCanvas.js"),o=n("./rendering/getLut.js"),s=n("./rendering/saveLastRendered.js"),l=n("./rendering/doesImageNeedToBeRendered.js"),u=n("./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js"),c=n("./colors/index.js");function d(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));var r=e.renderingTools.renderCanvas,s=e.viewport.colormap||e.options.colormap;if(e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),s&&"string"==typeof s&&(s=c.default.getColormap(s)),!s)throw new Error("renderPseudoColorImage: colormap not found.");var d=s.getId();if(!1===Object(l.default)(e,t)&&!0!==n&&e.renderingTools.colormapId===d)return r;r.width===t.width&&r.height===t.height||Object(a.default)(e,t);var h=Object(i.default)();e.renderingTools.colorLut&&!n&&e.renderingTools.colormapId===d||(s.setNumberOfColors(256),e.renderingTools.colorLut=s.createLookupTable(),e.renderingTools.colormapId=d);var f=Object(o.default)(t,e.viewport,n);t.stats=t.stats||{},t.stats.lastLutGenerateTime=Object(i.default)()-h;var p=e.renderingTools.colorLut,m=e.renderingTools.renderCanvasData,g=e.renderingTools.renderCanvasContext;return Object(u.default)(t,f,p,m.data),h=Object(i.default)(),g.putImageData(m,0,0),t.stats.lastPutImageDataTime=Object(i.default)()-h,r}function h(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");var i=e.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0),i.fillStyle="black",i.fillRect(0,0,e.canvas.width,e.canvas.height),i.imageSmoothingEnabled=!e.viewport.pixelReplication,i.mozImageSmoothingEnabled=i.imageSmoothingEnabled,Object(r.default)(e,i);var a=d(e,n,t),o=e.viewport.displayedArea.tlhc.x-1,l=e.viewport.displayedArea.tlhc.y-1,u=e.viewport.displayedArea.brhc.x-o,c=e.viewport.displayedArea.brhc.y-l;i.drawImage(a,o,l,u,c,0,0,u,c),e.renderingTools=Object(s.default)(e)}function f(e,t){if(void 0===e)throw new Error("addPseudoColorLayer: layer parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("addPseudoColorLayer: image must be loaded before it can be drawn");e.canvas=d(e,n,t);var r=e.canvas.getContext("2d");r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,e.renderingTools=Object(s.default)(e)}},"./rendering/renderToCanvas.js":function(e,t,n){"use strict";n.r(t);var r=n("./triggerEvent.js"),i=n("./events.js"),a=n("./internal/drawImageSync.js"),o=n("./internal/getDefaultViewport.js"),s=n("./internal/tryEnableWebgl.js");function l(e,t,n,r){return{element:e,canvas:e,image:t,invalid:!0,needsRedraw:!0,options:n,layers:[],data:{},renderingTools:{},viewport:r}}t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(void 0===e)throw new Error("renderToCanvas: parameter canvas cannot be undefined");u&&u.renderer&&"webgl"===u.renderer.toLowerCase()&&Object(s.default)(u);var c=Object(o.default)(e,t);n&&Object.assign(c,n);var d=l(e,t,u,c),h={enabledElement:d,timestamp:Date.now()};Object(r.default)(d.element,i.default.PRE_RENDER,h),Object(a.default)(d,d.invalid)}},"./rendering/renderWebImage.js":function(e,t,n){"use strict";n.r(t),n.d(t,"renderWebImage",(function(){return a}));var r=n("./setToPixelCoordinateSystem.js"),i=n("./rendering/renderColorImage.js");function a(e,t){if(void 0===e)throw new Error("renderWebImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("renderWebImage: image must be loaded before it can be drawn");if(e.viewport.voi.windowWidth===e.image.windowWidth&&e.viewport.voi.windowCenter===e.image.windowCenter&&!1===e.viewport.invert){var a=e.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0),a.fillStyle="black",a.fillRect(0,0,e.canvas.width,e.canvas.height),a.imageSmoothingEnabled=!e.viewport.pixelReplication,a.mozImageSmoothingEnabled=a.imageSmoothingEnabled,Object(r.default)(e,a);var o=e.viewport.displayedArea.tlhc.x-1,s=e.viewport.displayedArea.tlhc.y-1,l=e.viewport.displayedArea.brhc.x-o,u=e.viewport.displayedArea.brhc.y-s;a.drawImage(n.getImage(),o,s,l,u,0,0,l,u)}else Object(i.renderColorImage)(e,t)}},"./rendering/saveLastRendered.js":function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=e.viewport,n=e.image.color;return e.renderingTools.lastRenderedImageId=e.image.imageId,e.renderingTools.lastRenderedIsColor=n,e.renderingTools.lastRenderedViewport={windowCenter:t.voi.windowCenter,windowWidth:t.voi.windowWidth,invert:t.invert,rotation:t.rotation,hflip:t.hflip,vflip:t.vflip,modalityLUT:t.modalityLUT,voiLUT:t.voiLUT,colormap:t.colormap},e.renderingTools}},"./reset.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/getDefaultViewport.js"),i=n("./enabledElements.js"),a=n("./updateImage.js");t.default=function(e){var t=Object(i.getEnabledElement)(e);t.viewport=Object(r.default)(t.canvas,t.image),Object(a.default)(e)}},"./resize.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./fitToWindow.js"),a=n("./updateImage.js"),o=n("./triggerEvent.js"),s=n("./internal/getImageSize.js"),l=n("./events.js");t.default=function(e,t){var n=Object(r.getEnabledElement)(e),u=n.canvas.width,c=n.canvas.height;!function(e,t){t.width!==e.clientWidth&&(t.width=e.clientWidth,t.style.width="".concat(e.clientWidth,"px")),t.height!==e.clientHeight&&(t.height=e.clientHeight,t.style.height="".concat(e.clientHeight,"px"))}(e,n.canvas);var d={element:e};Object(o.default)(e,l.default.ELEMENT_RESIZED,d),void 0!==n.image&&(t||function(e,t,n){var r=e.viewport.scale,i=Object(s.default)(e.image,e.viewport.rotation),a=Math.round(i.width*r),o=Math.round(i.height*r);return a===t&&o<=n||a<=t&&o===n&&0===e.viewport.translation.x&&0===e.viewport.translation.y}(n,u,c)?Object(i.default)(e):(function(e,t,n){var r=e.viewport.scale,i=Math.sqrt(e.canvas.width/t*(e.canvas.height/n));e.viewport.scale=i*r}(n,u,c),Object(a.default)(e)))}},"./setToPixelCoordinateSystem.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/calculateTransform.js");t.default=function(e,t,n){if(void 0===e)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(void 0===t)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");var i=Object(r.default)(e,n);t.setTransform(i.m[0],i.m[1],i.m[2],i.m[3],i.m[4],i.m[5])}},"./setViewport.js":function(e,t,n){"use strict";n.r(t);var r=n("./internal/getDefaultViewport.js"),i=n("./enabledElements.js"),a=n("./updateImage.js");t.default=function(e,t){var n=Object(i.getEnabledElement)(e);if(void 0===n.viewport&&(n.viewport=Object(r.default)(n.canvas)),t)for(var o in t)null!==t[o]&&(n.viewport[o]=t[o]);n.viewport.voi.windowWidth&&(n.viewport.voi.windowWidth=Math.max(t.voi.windowWidth,1e-6)),n.viewport.scale&&(n.viewport.scale=Math.max(t.scale,1e-4)),n.viewport.rotation%=360,n.viewport.rotation<0&&(n.viewport.rotation+=360),n.image&&Object(a.default)(e)}},"./triggerEvent.js":function(e,t,n){"use strict";function r(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:r,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,r),e.dispatchEvent(n)}n.r(t),n.d(t,"default",(function(){return r}))},"./updateImage.js":function(e,t,n){"use strict";n.r(t);var r=n("./enabledElements.js"),i=n("./internal/drawImage.js");t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(r.getEnabledElement)(e);if(void 0===n.image&&!n.layers.length)throw new Error("updateImage: image has not been loaded yet");Object(i.default)(n,t)}},"./webgl/createProgramFromString.js":function(e,t,n){"use strict";function r(e,t,n){var r=e.createShader(n);if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)&&!e.isContextLost()){var i=e.getShaderInfoLog(r);console.error("Could not compile shader:\n".concat(i))}return r}n.r(t),t.default=function(e,t,n){return function(e,t,n){var r=e.createProgram();if(e.attachShader(r,t),e.attachShader(r,n),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS)&&!e.isContextLost()){var i=e.getProgramInfoLog(r);console.error("WebGL program filed to link:\n".concat(i))}return r}(e,r(e,t,e.VERTEX_SHADER),r(e,n,e.FRAGMENT_SHADER))}},"./webgl/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./webgl/renderer.js"),i=n("./webgl/createProgramFromString.js"),a=n("./webgl/textureCache.js"),o={createProgramFromString:i.default,renderer:{render:r.render,initRenderer:r.initRenderer,getRenderCanvas:r.getRenderCanvas,isWebGLAvailable:r.isWebGLAvailable},textureCache:a.default};Object.defineProperty(o,"isWebGLInitialized",{enumerable:!0,configurable:!1,get:function(){return r.isWebGLInitialized}}),t.default=o},"./webgl/renderer.js":function(e,t,n){"use strict";n.r(t),n.d(t,"isWebGLInitialized",(function(){return d})),n.d(t,"getRenderCanvas",(function(){return h})),n.d(t,"initRenderer",(function(){return f})),n.d(t,"render",(function(){return v})),n.d(t,"isWebGLAvailable",(function(){return y}));var r,i,a,o=n("./webgl/shaders/index.js"),s=n("./webgl/vertexShader.js"),l=n("./webgl/textureCache.js"),u=n("./webgl/createProgramFromString.js"),c=document.createElement("canvas"),d=!1;function h(){return c}function f(){!0!==d&&function(e){r=null;try{var t={preserveDrawingBuffer:!0};r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),e.removeEventListener("webglcontextlost",p,!1),e.addEventListener("webglcontextlost",p,!1),e.removeEventListener("webglcontextrestored",m,!1),e.addEventListener("webglcontextrestored",m,!1)}catch(n){throw new Error("Error creating WebGL context")}return r||(console.error("Unable to initialize WebGL. Your browser may not support it."),r=null),r}(c)&&(a=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,a),r.bufferData(r.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),r.STATIC_DRAW),i=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,i),r.bufferData(r.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),r.STATIC_DRAW),function(){for(var e in o.shaders){var t=o.shaders[e];t.attributes={},t.uniforms={},t.vert=s.vertexShader,t.program=Object(u.default)(r,t.vert,t.frag),t.attributes.texCoordLocation=r.getAttribLocation(t.program,"a_texCoord"),r.enableVertexAttribArray(t.attributes.texCoordLocation),t.attributes.positionLocation=r.getAttribLocation(t.program,"a_position"),r.enableVertexAttribArray(t.attributes.positionLocation),t.uniforms.resolutionLocation=r.getUniformLocation(t.program,"u_resolution")}}(),d=!0)}function p(e){e.preventDefault(),console.warn("WebGL Context Lost!")}function m(e){e.preventDefault(),d=!1,l.default.purgeCache(),f()}function g(e){if(e.color)return"rgb";var t=e.getPixelData();return t instanceof Int16Array?"int16":t instanceof Uint16Array?"uint16":t instanceof Int8Array?"int8":"uint8"}function v(e){var t=e.image;c.width=t.width,c.height=t.height;var n=e.viewport,s=function(e){var t=g(e);return o.shaders.hasOwnProperty(t)?o.shaders[t]:o.shaders.rgb}(t),u=function(e){var t=l.default.getImageTexture(e.imageId);return t||(t=function(e){var t={uint8:r.LUMINANCE,int8:r.LUMINANCE_ALPHA,uint16:r.LUMINANCE_ALPHA,int16:r.RGB,rgb:r.RGB},n=g(e),i=t[n],a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.pixelStorei(r.UNPACK_ALIGNMENT,1);var s=o.dataUtilities[n].storedPixelDataToImageData(e,e.width,e.height);return r.texImage2D(r.TEXTURE_2D,0,i,e.width,e.height,0,i,r.UNSIGNED_BYTE,s),{texture:a,sizeInBytes:e.width*e.height*{int8:1,uint16:2,int16:3,rgb:3}[n]}}(e),l.default.putImageTexture(e,t)),t.texture}(t);return function(e,t,n,o,s){for(var l in r.clearColor(1,0,0,1),r.viewport(0,0,o,s),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.useProgram(e.program),r.bindBuffer(r.ARRAY_BUFFER,i),r.vertexAttribPointer(e.attributes.texCoordLocation,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,a),r.vertexAttribPointer(e.attributes.positionLocation,2,r.FLOAT,!1,0,0),t){var u=r.getUniformLocation(e.program,l);if(u){var c=t[l],d=c.type,h=c.value;"i"===d?r.uniform1i(u,h):"f"===d?r.uniform1f(u,h):"2f"===d&&r.uniform2f(u,h[0],h[1])}}!function(e,t,n){e.bufferData(e.ARRAY_BUFFER,new Float32Array([t,n,0,n,t,0,0,0]),e.STATIC_DRAW)}(r,o,s),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,n),r.drawArrays(r.TRIANGLE_STRIP,0,4)}(s,{u_resolution:{type:"2f",value:[t.width,t.height]},wc:{type:"f",value:n.voi.windowCenter},ww:{type:"f",value:n.voi.windowWidth},slope:{type:"f",value:t.slope},intercept:{type:"f",value:t.intercept},minPixelValue:{type:"f",value:t.minPixelValue},invert:{type:"i",value:n.invert?1:0}},u,t.width,t.height),c}function y(){var e={failIfMajorPerformanceCaveat:!0};try{var t=document.createElement("canvas");return Boolean(window.WebGLRenderingContext)&&(t.getContext("webgl",e)||t.getContext("experimental-webgl",e))}catch(n){return!1}}},"./webgl/shaders/index.js":function(e,t,n){"use strict";n.r(t),n.d(t,"shaders",(function(){return l})),n.d(t,"dataUtilities",(function(){return u}));var r=n("./webgl/shaders/int16.js"),i=n("./webgl/shaders/int8.js"),a=n("./webgl/shaders/rgb.js"),o=n("./webgl/shaders/uint16.js"),s=n("./webgl/shaders/uint8.js"),l={int16:r.int16Shader,int8:i.int8Shader,rgb:a.rgbShader,uint16:o.uint16Shader,uint8:s.uint8Shader},u={int16:r.int16DataUtilities,int8:i.int8DataUtilities,rgb:a.rgbDataUtilities,uint16:o.uint16DataUtilities,uint8:s.uint8DataUtilities}},"./webgl/shaders/int16.js":function(e,t,n){"use strict";n.r(t),n.d(t,"int16DataUtilities",(function(){return i})),n.d(t,"int16Shader",(function(){return r}));var r={},i={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*3),r=0,i=0;i<t.length;i++){var a=Math.abs(t[i]);n[r++]=255&a,n[r++]=a>>8,n[r++]=t[i]<0?0:1}return n}};r.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.g*65536.0;if (color.b == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}"},"./webgl/shaders/int8.js":function(e,t,n){"use strict";n.r(t),n.d(t,"int8DataUtilities",(function(){return i})),n.d(t,"int8Shader",(function(){return r}));var r={},i={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),r=0,i=0;i<t.length;i++)n[r++]=t[i],n[r++]=t[i]<0?0:1;return n}};r.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.;if (color.a == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}"},"./webgl/shaders/rgb.js":function(e,t,n){"use strict";n.r(t),n.d(t,"rgbDataUtilities",(function(){return i})),n.d(t,"rgbShader",(function(){return r}));var r={},i={storedPixelDataToImageData:function(e){var t=e.minPixelValue,n=0,r=0,i=e.width*e.height*4,a=e.width*e.height*3,o=e.getPixelData(),s=new Uint8Array(a);if(t<0)for(;r<i;)s[n++]=o[r++]+-t,s[n++]=o[r++]+-t,s[n++]=o[r++]+-t,r+=1;else for(;r<i;)s[n++]=o[r++],s[n++]=o[r++],s[n++]=o[r++],r+=1;return s}};r.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform float minPixelValue;uniform int invert;varying vec2 v_texCoord;void main() {vec3 color = texture2D(u_image, v_texCoord).xyz;color = color * 256.0 * slope + intercept;float center0 = wc - 0.5 - minPixelValue;float width0 = max(ww, 1.0);color = (color - center0) / width0 + 0.5;gl_FragColor = vec4(color, 1);if (invert == 1)gl_FragColor.rgb = 1. - gl_FragColor.rgb;}"},"./webgl/shaders/uint16.js":function(e,t,n){"use strict";n.r(t),n.d(t,"uint16DataUtilities",(function(){return i})),n.d(t,"uint16Shader",(function(){return r}));var r={},i={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),r=0,i=0;i<t.length;i++){var a=t[i];n[r++]=255&a,n[r++]=a>>8}return n}};r.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.a*65536.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}"},"./webgl/shaders/uint8.js":function(e,t,n){"use strict";n.r(t),n.d(t,"uint8DataUtilities",(function(){return i})),n.d(t,"uint8Shader",(function(){return r}));var r={},i={storedPixelDataToImageData:function(e){return e.getPixelData()}};r.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}"},"./webgl/textureCache.js":function(e,t,n){"use strict";n.r(t);var r=n("./events.js"),i=n("./triggerEvent.js"),a={},o=[],s=268435456,l=0;function u(){if(!(l<=s)){for(o.sort((function(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0}));l>s;){var e=o[o.length-1];l-=e.sizeInBytes,delete a[e.imageId],o.pop(),Object(i.default)(r.events,r.default.WEBGL_TEXTURE_REMOVED,{imageId:e.imageId})}var t={maximumSizeInBytes:s,cacheSizeInBytes:l,numberOfImagesCached:o.length};Object(i.default)(r.events,r.default.WEBGL_TEXTURE_CACHE_FULL,t)}}t.default={purgeCache:function(){for(;o.length>0;){var e=o.pop();delete a[e.imageId]}l=0},getImageTexture:function(e){if(void 0===e)throw new Error("getImageTexture: imageId must not be undefined");var t=a[e];if(void 0!==t)return t.timeStamp=new Date,t.imageTexture},putImageTexture:function(e,t){var n=e.imageId;if(void 0===e)throw new Error("putImageTexture: image must not be undefined");if(void 0===n)throw new Error("putImageTexture: imageId must not be undefined");if(void 0===t)throw new Error("putImageTexture: imageTexture must not be undefined");if(!0===Object.prototype.hasOwnProperty.call(a,n))throw new Error("putImageTexture: imageId already in cache");var r={imageId:n,imageTexture:t,timeStamp:new Date,sizeInBytes:t.sizeInBytes};if(a[n]=r,o.push(r),void 0===t.sizeInBytes)throw new Error("putImageTexture: imageTexture.sizeInBytes must not be undefined");if(void 0===t.sizeInBytes.toFixed)throw new Error("putImageTexture: imageTexture.sizeInBytes is not a number");l+=r.sizeInBytes,u()},removeImageTexture:function(e){if(void 0===e)throw new Error("removeImageTexture: imageId must not be undefined");var t=a[e];if(void 0===t)throw new Error("removeImageTexture: imageId must not be undefined");return o.splice(o.indexOf(t),1),l-=t.sizeInBytes,delete a[e],t.imageTexture},setMaximumSizeBytes:function(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");s=e,u()}}},"./webgl/vertexShader.js":function(e,t,n){"use strict";n.r(t),n.d(t,"vertexShader",(function(){return r}));var r="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}"}})},e.exports=r()},gqzR:function(e,t,n){const r=n("Ybu3");e.exports=(e,t)=>{const n=r(e,t);return n?n.version:null}},iEBQ:function(e,t,n){const r=n("3wIk");e.exports=(e,t,n)=>{const i=new r(e,n),a=new r(t,n);return i.compare(a)||i.compareBuild(a)}},ie1u:function(e,t,n){(function(e){var r;!function(e,i,a){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function l(e,t){var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(t,n,t,i))||(i.exports=r):this.tychei=l}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},j0pM:function(e,t,n){const r=n("ex/Z");e.exports=(e,t)=>new r(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},lYj8:function(e,t,n){const r=n("iEBQ");e.exports=(e,t)=>e.sort((e,n)=>r(e,n,t))},lkeM:function(e,t,n){const r=n("3wIk"),i=n("ex/Z"),a=n("7sNm");e.exports=(e,t)=>{e=new i(e,t);let n=new r("0.0.0");if(e.test(n))return n;if(n=new r("0.0.0-0"),e.test(n))return n;n=null;for(let i=0;i<e.set.length;++i){let t=null;e.set[i].forEach(e=>{const n=new r(e.semver.version);switch(e.operator){case">":0===n.prerelease.length?n.patch++:n.prerelease.push(0),n.raw=n.format();case"":case">=":t&&!a(n,t)||(t=n);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+e.operator)}}),!t||n&&!a(n,t)||(n=t)}return n&&e.test(n)?n:null}},oBeb:function(e,t,n){const r=n("Ybu3");e.exports=(e,t)=>{const n=r(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null}},oh0K:function(e,t,n){const r=n("8GxW");e.exports=(e,t,n)=>r(t,e,n)},"pJ3+":function(e,t,n){var r;!function(i,a){var o,s=this,l=256,u=a.pow(l,6),c=a.pow(2,52),d=2*c,h=255;function f(e,t,n){var r=[],h=g(function e(t,n){var r,i=[],a=typeof t;if(n&&"object"==a)for(r in t)try{i.push(e(t[r],n-1))}catch(o){}return i.length?i:"string"==a?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[e,v(i)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(l):(e=new Uint8Array(l),(s.crypto||s.msCrypto).getRandomValues(e)),v(e)}catch(r){var t=s.navigator,n=t&&t.plugins;return[+new Date,s,n,s.screen,v(i)]}}():e,3),r),f=new p(r),y=function(){for(var e=f.g(6),t=u,n=0;e<c;)e=(e+n)*l,t*=l,n=f.g(1);for(;e>=d;)e/=2,t/=2,n>>>=1;return(e+n)/t};return y.int32=function(){return 0|f.g(4)},y.quick=function(){return f.g(4)/4294967296},y.double=y,g(v(f.S),i),(t.pass||n||function(e,t,n,r){return r&&(r.S&&m(r,f),e.state=function(){return m(f,{})}),n?(a.random=e,t):e})(y,h,"global"in t?t.global:this==a,t.state)}function p(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);i<l;)o[i]=i++;for(i=0;i<l;i++)o[i]=o[a=h&a+e[i%n]+(t=o[i])],o[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,o=r.S;e--;)t=o[i=h&i+1],n=n*l+o[h&(o[i]=o[a=h&a+t])+(o[a]=t)];return r.i=i,r.j=a,n})(l)}function m(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function g(e,t){for(var n,r=e+"",i=0;i<r.length;)t[h&i]=h&(n^=19*t[h&i])+r.charCodeAt(i++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(a.seedrandom=f,g(a.random(),i),e.exports){e.exports=f;try{o=n(3)}catch(y){}}else void 0===(r=(function(){return f}).call(t,n,t,e))||(e.exports=r)}([],Math)},pJ6O:function(e,t,n){(function(e){var r;!function(e,i,a){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function l(e,t){var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(t,n,t,i))||(i.exports=r):this.xorwow=l}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},qHvB:function(e){e.exports=JSON.parse('{"a":"4.17.0"}')},rNSh:function(e,t,n){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=79)}([function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";(function(e){var r=n(73),i=n(72),a=n(39);function o(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,n){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=h(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!l.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=s(e,r)).write(t,n);return i!==r&&(e=e.slice(0,i)),e}(e,t,n):function(e,t){if(l.isBuffer(t)){var n=0|f(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?s(e,0):h(e,t);if("Buffer"===t.type&&a(t.data))return h(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(c(t),e=s(e,t<0?0:0|f(t)),!l.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function h(e,t){var n=t.length<0?0:0|f(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(e).length;default:if(r)return B(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=l.from(t,r)),l.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,i);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,i){var a,o=1,s=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,n/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var c=-1;for(a=n;a<s;a++)if(u(e,a)===u(t,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===l)return c*o}else-1!==c&&(a-=a-c),c=-1}else for(n+l>s&&(n=s-l),a=n;a>=0;a--){for(var d=!0,h=0;h<l;h++)if(u(e,a+h)!==u(t,h)){d=!1;break}if(d)return a}return-1}function y(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function b(e,t,n,r){return U(B(t,e.length-n),e,n,r)}function x(e,t,n,r){return U(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function w(e,t,n,r){return x(e,t,n,r)}function _(e,t,n,r){return U(z(t),e,n,r)}function S(e,t,n,r){return U(function(e,t){for(var n,r,i=[],a=0;a<e.length&&!((t-=2)<0);++a)r=(n=e.charCodeAt(a))>>8,i.push(n%256),i.push(r);return i}(t,e.length-n),e,n,r)}function E(e,t,n){return r.fromByteArray(0===t&&n===e.length?e:e.slice(t,n))}function T(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,l,u=e[i],c=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=n)switch(d){case 1:u<128&&(c=u);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&u)<<6|63&a)>127&&(c=l);break;case 3:o=e[i+2],128==(192&(a=e[i+1]))&&128==(192&o)&&(l=(15&u)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:o=e[i+2],s=e[i+3],128==(192&(a=e[i+1]))&&128==(192&o)&&128==(192&s)&&(l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,d=1):c>65535&&(r.push((c-=65536)>>>10&1023|55296),c=56320|1023&c),r.push(c),i+=d}return function(e){var t=e.length;if(t<=k)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=k));return n}(r)}t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,n){return u(null,e,t,n)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,n){return function(e,t,n,r){return c(t),t<=0?s(e,t):void 0!==n?"string"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},l.allocUnsafe=function(e){return d(null,e)},l.allocUnsafeSlow=function(e){return d(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=l.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?T(this,0,e):(function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return O(this,t,n);case"utf8":case"utf-8":return T(this,t,n);case"ascii":return C(this,t,n);case"latin1":case"binary":return I(this,t,n);case"base64":return E(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}).apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,n,r,i){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(a,o),u=this.slice(r,i),c=e.slice(t,n),d=0;d<s;++d)if(u[d]!==c[d]){a=u[d],o=c[d];break}return a<o?-1:o<a?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},l.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return y(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return x(this,e,t,n);case"latin1":case"binary":return w(this,e,t,n);case"base64":return _(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function C(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function I(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function O(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=$(e[a]);return i}function A(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function D(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,n,r,i,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function N(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);i<a;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function j(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);i<a;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function R(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function P(e,t,n,r,a){return a||R(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function F(e,t,n,r,a){return a||R(e,0,n,8),i.write(e,t,n,r,52,8),n+8}l.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=l.prototype;else{var i=t-e;n=new l(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+e]}return n},l.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},l.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},l.prototype.readUInt8=function(e,t){return t||D(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||D(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||D(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},l.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return t||D(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||D(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){t||D(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||M(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},l.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||M(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},l.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):j(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):j(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);M(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},l.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);M(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):j(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):j(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,n){return P(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return P(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return F(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return F(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(a<1e3||!l.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},l.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=l.isBuffer(e)?e:B(new l(e,r).toString()),s=o.length;for(a=0;a<n-t;++a)this[a+t]=o[a%s]}return this};var L=/[^+\/0-9A-Za-z-_]/g;function $(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var n;t=t||1/0;for(var r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function z(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(L,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function U(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(0))},function(e,t,n){"use strict";var r=n(10),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=d;var a=n(6);a.inherits=n(5);var o=n(36),s=n(19);a.inherits(d,o);for(var l=i(s.prototype),u=0;u<l.length;u++){var c=l[u];d.prototype[c]||(d.prototype[c]=s.prototype[c])}function d(e){if(!(this instanceof d))return new d(e);o.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||r.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),d.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var l,u=[],c=!1,d=-1;function h(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length&&f())}function f(){if(!c){var e=s(h);c=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||c||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";return"x"+("00000000"+(256*e.readUint16()*256+e.readUint16()).toString(16)).substr(-8)}},function(e,t){e.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){(function(e){function n(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===n(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===n(e)},t.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(this,n(1).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(14);function a(e,t){return void 0!==e.parser?e.parser:t}var o=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.byteArrayParser=t,this.byteArray=n,this.elements=r}return r(e,[{key:"uint16",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readUint16(this.byteArray,n.dataOffset+2*t)}},{key:"int16",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readInt16(this.byteArray,n.dataOffset+2*t)}},{key:"uint32",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readUint32(this.byteArray,n.dataOffset+4*t)}},{key:"int32",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readInt32(this.byteArray,n.dataOffset+4*t)}},{key:"float",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readFloat(this.byteArray,n.dataOffset+4*t)}},{key:"double",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readDouble(this.byteArray,n.dataOffset+8*t)}},{key:"numStringValues",value:function(e){var t=this.elements[e];if(t&&t.length>0){var n=(0,i.readFixedString)(this.byteArray,t.dataOffset,t.length).match(/\\/g);return null===n?1:n.length+1}}},{key:"string",value:function(e,t){var n=this.elements[e];if(n&&n.length>0){var r=(0,i.readFixedString)(this.byteArray,n.dataOffset,n.length);return t>=0?r.split("\\")[t].trim():r.trim()}}},{key:"text",value:function(e,t){var n=this.elements[e];if(n&&n.length>0){var r=(0,i.readFixedString)(this.byteArray,n.dataOffset,n.length);return t>=0?r.split("\\")[t].replace(/ +$/,""):r.replace(/ +$/,"")}}},{key:"floatString",value:function(e,t){var n=this.elements[e];if(n&&n.length>0){var r=this.string(e,t=void 0!==t?t:0);if(void 0!==r)return parseFloat(r)}}},{key:"intString",value:function(e,t){var n=this.elements[e];if(n&&n.length>0){var r=this.string(e,t=void 0!==t?t:0);if(void 0!==r)return parseInt(r)}}},{key:"attributeTag",value:function(e){var t=this.elements[e];if(t&&4===t.length){var n=a(t,this.byteArrayParser).readUint16,r=this.byteArray,i=t.dataOffset;return"x"+("00000000"+(256*n(r,i)*256+n(r,i+2)).toString(16)).substr(-8)}}}]),e}();t.default=o},function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){var t,n,r,i,a,o;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(o=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)o.set(a=e[t],i),i+=a.length;return o}},o={arraySet:function(e,t,n,r,i){for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(r)},function(e,t,n){var r=n(1),i=r.Buffer;function a(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(a(r,t),t.Buffer=o),a(i,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,n){"use strict";(function(t){e.exports=!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?{nextTick:function(e,n,r,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var a,o,s=arguments.length;switch(s){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,n)}));case 3:return t.nextTick((function(){e.call(null,n,r)}));case 4:return t.nextTick((function(){e.call(null,n,r,i)}));default:for(a=new Array(s-1),o=0;o<a.length;)a[o++]=arguments[o];return t.nextTick((function(){e.apply(null,a)}))}}}:t}).call(this,n(3))},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,n,r){if(void 0!==e&&t instanceof e)return t.slice(n,n+r);if(t instanceof Uint8Array)return new Uint8Array(t.buffer,t.byteOffset+n,r);throw"dicomParser.from: unknown type for byteArray"}}).call(this,n(1).Buffer)},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=(r=n(11))&&r.__esModule?r:{default:r},o=n(14),s=function(){function t(n,r,i){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),void 0===n)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===r)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(r instanceof Uint8Array==0&&r instanceof e==0)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(i<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(i>=r.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=n,this.byteArray=r,this.position=i||0,this.warnings=[]}return i(t,[{key:"seek",value:function(e){if(this.position+e<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=e}},{key:"readByteStream",value:function(e){if(this.position+e>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var n=(0,a.default)(this.byteArray,this.position,e);return this.position+=e,new t(this.byteArrayParser,n)}},{key:"readUint16",value:function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e}},{key:"readUint32",value:function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e}},{key:"readFixedString",value:function(e){var t=(0,o.readFixedString)(this.byteArray,this.position,e);return this.position+=e,t}}]),t}();t.default=s}).call(this,n(1).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(void 0===e)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var t={tag:(0,i.default)(e),length:e.readUint32(),dataOffset:e.position};if("xfffee000"!==t.tag)throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset "+e.position;return t};var r,i=(r=n(4))&&r.__esModule?r:{default:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readFixedString=function(e,t,n){if(n<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(t+n>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var r,i="",a=0;a<n;a++){if(0===(r=e[t+a]))return t+=n,i;i+=String.fromCharCode(r)}return i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var l={tag:(0,a.default)(e),vr:e.readFixedString(2)};return 2===u(l.vr)?(l.length=e.readUint16(),l.dataOffset=e.position):(e.seek(2),l.length=e.readUint32(),l.dataOffset=e.position),4294967295===l.length&&(l.hadUndefinedLength=!0),l.tag===n?l:"SQ"===l.vr?((0,s.default)(e,l,t),l):4294967295===l.length?"x7fe00010"===l.tag?((0,r.default)(e,l,t),l):"UN"===l.vr?((0,i.default)(e,l),l):((0,o.default)(e,l),l):(e.seek(l.length),l)};var r=l(n(42)),i=(l(n(41)),l(n(26))),a=l(n(4)),o=l(n(24)),s=l(n(40));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){return"OB"===e||"OW"===e||"SQ"===e||"OF"===e||"UT"===e||"UN"===e?4:2}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDicomDataSetExplicit=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(void 0===t)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if((n=void 0===n?t.byteArray.length:n)<t.position||n>t.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var a=e.elements;t.position<n;){var o=(0,r.default)(t,e.warnings,i.untilTag);if(a[o.tag]=o,o.tag===i.untilTag)return}if(t.position>n)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"},t.parseDicomDataSetImplicit=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(void 0===t)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if((n=void 0===n?e.byteArray.length:n)<t.position||n>t.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var a=e.elements;t.position<n;){var o=(0,i.default)(t,r.untilTag,r.vrCallback);if(a[o.tag]=o,o.tag===r.untilTag)return}};var r=a(n(15)),i=a(n(25));function a(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};t.isStringVr=function(e){return r[e]},t.isPrivateTag=function(e){return parseInt(e[4],10)%2==1},t.parsePN=function(e){if(void 0!==e){var t=e.split("^");return{familyName:t[0],givenName:t[1],middleName:t[2],prefix:t[3],suffix:t[4]}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,s,u){if(u=u||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===(s=s||1))throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(n>=t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(s<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(n+s>t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var c=new i.default(e.byteArrayParser,e.byteArray,t.dataOffset),d=(0,a.default)(c);if("xfffee000"!==d.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";c.seek(d.length);var h=c.position;if(1===s)return(0,o.default)(c.byteArray,h+u[n].offset+8,u[n].length);for(var f=l(u,n,s),p=(0,r.default)(c.byteArray,f),m=0,g=n;g<n+s;g++)for(var v=h+u[g].offset+8,y=0;y<u[g].length;y++)p[m++]=c.byteArray[v++];return p};var r=s(n(23)),i=s(n(12)),a=s(n(13)),o=s(n(11));function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e,t,n){for(var r=0,i=t;i<t+n;i++)r+=e[i].length;return r}},function(e,t,n){"use strict";(function(t,r,i){var a=n(10);function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(void 0),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=y;var s,l=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:a.nextTick;y.WritableState=v;var u=n(6);u.inherits=n(5);var c,d={deprecate:n(61)},h=n(35),f=n(9).Buffer,p=i.Uint8Array||function(){},m=n(34);function g(){}function v(e,t){s=s||n(2);var r=t instanceof s;this.objectMode=!!(e=e||{}).objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,u=e.writableHighWaterMark;this.highWaterMark=i||0===i?i:r&&(u||0===u)?u:this.objectMode?16:16384,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1,this.decodeStrings=!(!1===e.decodeStrings),this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(a.nextTick(i,r),a.nextTick(E,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(i(r),e._writableState.errorEmitted=!0,e.emit("error",r),E(e,t))}(e,n,r,t,i);else{var o=_(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||w(e,n),r?l(x,e,n,o,i):x(e,n,o,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function y(e){if(s=s||n(2),!(c.call(y,this)||this instanceof s))return new y(e);this._writableState=new v(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),h.call(this)}function b(e,t,n,r,i,a,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function x(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),E(e,t)}function w(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=new Array(t.bufferedRequestCount),i=t.corkedRequestsFree;i.entry=n;for(var a=0,s=!0;n;)r[a]=n,n.isBuf||(s=!1),n=n.next,a+=1;r.allBuffers=s,b(e,t,!0,t.length,r,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new o(t),t.bufferedRequestCount=0}else{for(;n;){var l=n.chunk;if(b(e,t,!1,t.objectMode?1:l.length,l,n.encoding,n.callback),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function _(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function S(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),E(e,t)}))}function E(e,t){var n=_(t);return n&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,a.nextTick(S,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}u.inherits(y,h),v.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(v.prototype,"buffer",{get:d.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(c=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!c.call(this,e)||this===y&&e&&e._writableState instanceof v}})):c=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,n){var r,i=this._writableState,o=!1,s=!i.objectMode&&(f.isBuffer(r=e)||r instanceof p);return s&&!f.isBuffer(e)&&(e=function(e){return f.from(e)}(e)),"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=g),i.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),a.nextTick(t,n)}(this,n):(s||function(e,t,n,r){var i=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),a.nextTick(r,o),i=!1),i}(this,i,e,n))&&(i.pendingcb++,o=function(e,t,n,r,i,a){if(!n){var o=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=f.from(t,n)),t}(t,r,i);r!==o&&(n=!0,i="buffer",r=o)}var s=t.objectMode?1:r.length;t.length+=s;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:a,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else b(e,t,!1,s,r,i,a);return l}(this,i,s,e,t,n)),o},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||w(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},y.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,E(e,t),n&&(t.finished?a.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=m.destroy,y.prototype._undestroy=m.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,n(3),n(63).setImmediate,n(0))},function(e,t,n){(t=e.exports=n(36)).Stream=t,t.Readable=t,t.Writable=n(19),t.Duplex=n(2),t.Transform=n(32),t.PassThrough=n(60)},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,o,s,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(a(n=this._events[e]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(i(n))for(s=Array.prototype.slice.call(arguments,1),o=(u=n.slice()).length,l=0;l<o;l++)u[l].apply(this,s);return!0},n.prototype.on=n.prototype.addListener=function(e,t){var o;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(o=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var n,a,o,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(n=this._events[e]).length,a=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(s=o;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){a=s;break}if(a<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={readUint16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=e[t]+(e[t+1]<<8);return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256},readInt32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)},readFloat:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],n[4]=e[t+4],n[5]=e[t+5],n[6]=e[t+6],n[7]=e[t+7],new Float64Array(n.buffer)[0]}}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,n){if(void 0!==e&&t instanceof e)return e.alloc(n);if(t instanceof Uint8Array)return new Uint8Array(n);throw"dicomParser.alloc: unknown type for byteArray"}}).call(this,n(1).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var n=e.byteArray.length-8;e.position<=n;)if(65534===e.readUint16()&&57357===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position "+(e.position-4)+" while reading element of undefined length with tag "+t.tag),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var s={tag:(0,a.default)(e),length:e.readUint32(),dataOffset:e.position};return 4294967295===s.length&&(s.hadUndefinedLength=!0),s.tag===t?s:l(s,e,n)&&!(0,o.isPrivateTag)(s.tag)?((0,i.default)(e,s),s):s.hadUndefinedLength?((0,r.default)(e,s),s):(e.seek(s.length),s)};var r=s(n(24)),i=s(n(26)),a=s(n(4)),o=n(17);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e,t,n){if(void 0!==n)return"SQ"===n(e.tag);if(t.position+4<=t.byteArray.length){var r=(0,a.default)(t);return t.seek(-4),"xfffee000"===r||"xfffee0dd"===r}return t.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?function(e,t,n){for(;e.position+4<=e.byteArray.length;){var r=(0,o.default)(e);if(e.seek(-4),"xfffee0dd"===r)return t.length=e.position-t.dataOffset,e.seek(8),t;var i=u(e,n);t.items.push(i)}e.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),t.length=e.byteArray.length-t.dataOffset}(e,t,n):function(e,t,n){for(var r=t.dataOffset+t.length;e.position<r;){var i=u(e,n);t.items.push(i)}}(e,t,n)};var r=l(n(7)),i=l(n(25)),a=l(n(13)),o=l(n(4)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(16));function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){var n=(0,a.default)(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,t){for(var n={};e.position<e.byteArray.length;){var a=(0,i.default)(e,void 0,t);if(n[a.tag]=a,"xfffee00d"===a.tag)return new r.default(e.byteArrayParser,e.byteArray,n)}return e.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new r.default(e.byteArrayParser,e.byteArray,n)}(e,t),n.length=e.position-n.dataOffset):(n.dataSet=new r.default(e.byteArrayParser,e.byteArray,{}),s.parseDicomDataSetImplicit(n.dataSet,e,e.position+n.length,{vrCallback:t})),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,s){if(void 0===e)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===(r=r||t.basicOffsetTable))throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===r.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(n<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(n>=r.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var l=a(s=s||t.fragments,r[n]);if(void 0===l)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";var u=o(n,r,s,l);return(0,i.default)(e,t,l,u,s)};var r,i=(r=n(18))&&r.__esModule?r:{default:r},a=function(e,t){for(var n=0;n<e.length;n++)if(e[n].offset===t)return n},o=function(e,t,n,r){if(e===t.length-1)return n.length-r;for(var i=t[e+1],a=r+1;a<n.length;a++)if(n[a].offset===i)return a-r;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"}},function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,i){var a=r,o=i+n;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},function(e,t,n){"use strict";e.exports=function(e,t,n,r){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{a=a+(i=i+t[r++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},function(e,t,n){(function(e,r){var i=/%[sdj%]/g;t.format=function(e){if(!v(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,a=r.length,o=String(e).replace(i,(function(e){if("%%"===e)return"%";if(n>=a)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),l=r[n];n<a;l=r[++n])m(l)||!x(l)?o+=" "+l:o+=" "+s(l);return o},t.deprecate=function(n,i){if(y(e.process))return function(){return t.deprecate(n,i).apply(this,arguments)};if(!0===r.noDeprecation)return n;var a=!1;return function(){if(!a){if(r.throwDeprecation)throw new Error(i);r.traceDeprecation?console.trace(i):console.error(i),a=!0}return n.apply(this,arguments)}};var a,o={};function s(e,n){var r={seen:[],stylize:u};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),p(n)?r.showHidden=n:n&&t._extend(r,n),y(r.showHidden)&&(r.showHidden=!1),y(r.depth)&&(r.depth=2),y(r.colors)&&(r.colors=!1),y(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=l),c(r,e,r.depth)}function l(e,t){var n=s.styles[t];return n?"\x1b["+s.colors[n][0]+"m"+e+"\x1b["+s.colors[n][1]+"m":e}function u(e,t){return e}function c(e,n,r){if(e.customInspect&&n&&S(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return v(i)||(i=c(e,i,r)),i}var a=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(v(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return g(t)?e.stylize(""+t,"number"):p(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}(e,n);if(a)return a;var o=Object.keys(n),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(n)),_(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return d(n);if(0===o.length){if(S(n))return e.stylize("[Function"+(n.name?": "+n.name:"")+"]","special");if(b(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(w(n))return e.stylize(Date.prototype.toString.call(n),"date");if(_(n))return d(n)}var l,u="",x=!1,E=["{","}"];return f(n)&&(x=!0,E=["[","]"]),S(n)&&(u=" [Function"+(n.name?": "+n.name:"")+"]"),b(n)&&(u=" "+RegExp.prototype.toString.call(n)),w(n)&&(u=" "+Date.prototype.toUTCString.call(n)),_(n)&&(u=" "+d(n)),0!==o.length||x&&0!=n.length?r<0?b(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),l=x?function(e,t,n,r,i){for(var a=[],o=0,s=t.length;o<s;++o)C(t,String(o))?a.push(h(e,t,n,r,String(o),!0)):a.push("");return i.forEach((function(i){i.match(/^\d+$/)||a.push(h(e,t,n,r,i,!0))})),a}(e,n,r,s,o):o.map((function(t){return h(e,n,r,s,t,x)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(l,u,E)):E[0]+u+E[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,n,r,i,a){var o,s,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=e.stylize(l.set?"[Getter/Setter]":"[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),C(r,i)||(o="["+i+"]"),s||(e.seen.indexOf(l.value)<0?(s=m(n)?c(e,l.value,null):c(e,l.value,n-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),y(o)){if(a&&i.match(/^\d+$/))return s;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function f(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function v(e){return"string"==typeof e}function y(e){return void 0===e}function b(e){return x(e)&&"[object RegExp]"===E(e)}function x(e){return"object"==typeof e&&null!==e}function w(e){return x(e)&&"[object Date]"===E(e)}function _(e){return x(e)&&("[object Error]"===E(e)||e instanceof Error)}function S(e){return"function"==typeof e}function E(e){return Object.prototype.toString.call(e)}function T(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(y(a)&&(a=r.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(a)){var n=r.pid;o[e]=function(){var r=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,r)}}else o[e]=function(){};return o[e]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=p,t.isNull=m,t.isNullOrUndefined=function(e){return null==e},t.isNumber=g,t.isString=v,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=y,t.isRegExp=b,t.isObject=x,t.isDate=w,t.isError=_,t.isFunction=S,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(54);var k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function C(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,n;console.log("%s - %s",(n=[T((e=new Date).getHours()),T(e.getMinutes()),T(e.getSeconds())].join(":"),[e.getDate(),k[e.getMonth()],n].join(" ")),t.format.apply(t,arguments))},t.inherits=n(53),t._extend=function(e,t){if(!t||!x(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,n(0),n(3))},function(e,t,n){"use strict";(function(t){function r(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0}function i(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var a=n(30),o=Object.prototype.hasOwnProperty,s=Array.prototype.slice,l="foo"===(function(){}).name;function u(e){return Object.prototype.toString.call(e)}function c(e){return!i(e)&&"function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}var d=e.exports=v,h=/\s*function\s+([^\(\s]*)\s*/;function f(e){if(a.isFunction(e)){if(l)return e.name;var t=e.toString().match(h);return t&&t[1]}}function p(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function m(e){if(l||!a.isFunction(e))return a.inspect(e);var t=f(e);return"[Function"+(t?": "+t:"")+"]"}function g(e,t,n,r,i){throw new d.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:i})}function v(e,t){e||g(e,!0,t,"==",d.ok)}function y(e,t,n,o){if(e===t)return!0;if(i(e)&&i(t))return 0===r(e,t);if(a.isDate(e)&&a.isDate(t))return e.getTime()===t.getTime();if(a.isRegExp(e)&&a.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(c(e)&&c(t)&&u(e)===u(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===r(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(i(e)!==i(t))return!1;var l=(o=o||{actual:[],expected:[]}).actual.indexOf(e);return-1!==l&&l===o.expected.indexOf(t)||(o.actual.push(e),o.expected.push(t),function(e,t,n,r){if(null==e||null==t)return!1;if(a.isPrimitive(e)||a.isPrimitive(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=b(e),o=b(t);if(i&&!o||!i&&o)return!1;if(i)return y(e=s.call(e),t=s.call(t),n);var l,u,c=_(e),d=_(t);if(c.length!==d.length)return!1;for(c.sort(),d.sort(),u=c.length-1;u>=0;u--)if(c[u]!==d[u])return!1;for(u=c.length-1;u>=0;u--)if(!y(e[l=c[u]],t[l],n,r))return!1;return!0}(e,t,n,o))}return n?e===t:e==t}function b(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function x(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function w(e,t,n,r){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(r=n,n=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),e&&!i&&g(i,n,"Missing expected exception"+r);var o="string"==typeof r,s=!e&&i&&!n;if((!e&&a.isError(i)&&o&&x(i,n)||s)&&g(i,n,"Got unwanted exception"+r),e&&i&&n&&!x(i,n)||!e&&i)throw i}d.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=p(m(this.actual),128)+" "+this.operator+" "+p(m(this.expected),128),this.generatedMessage=!0);var t=e.stackStartFunction||g;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var r=n.stack,i=f(t),a=r.indexOf("\n"+i);if(a>=0){var o=r.indexOf("\n",a+1);r=r.substring(o+1)}this.stack=r}}},a.inherits(d.AssertionError,Error),d.fail=g,d.ok=v,d.equal=function(e,t,n){e!=t&&g(e,t,n,"==",d.equal)},d.notEqual=function(e,t,n){e==t&&g(e,t,n,"!=",d.notEqual)},d.deepEqual=function(e,t,n){y(e,t,!1)||g(e,t,n,"deepEqual",d.deepEqual)},d.deepStrictEqual=function(e,t,n){y(e,t,!0)||g(e,t,n,"deepStrictEqual",d.deepStrictEqual)},d.notDeepEqual=function(e,t,n){y(e,t,!1)&&g(e,t,n,"notDeepEqual",d.notDeepEqual)},d.notDeepStrictEqual=function e(t,n,r){y(t,n,!0)&&g(t,n,r,"notDeepStrictEqual",e)},d.strictEqual=function(e,t,n){e!==t&&g(e,t,n,"===",d.strictEqual)},d.notStrictEqual=function(e,t,n){e===t&&g(e,t,n,"!==",d.notStrictEqual)},d.throws=function(e,t,n){w(!0,e,t,n)},d.doesNotThrow=function(e,t,n){w(!1,e,t,n)},d.ifError=function(e){if(e)throw e};var _=Object.keys||function(e){var t=[];for(var n in e)o.call(e,n)&&t.push(n);return t}}).call(this,n(0))},function(e,t,n){"use strict";e.exports=a;var r=n(2),i=n(6);function a(e){if(!(this instanceof a))return new a(e);r.call(this,e),this._transformState={afterTransform:(function(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}).bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",o)}function o(){var e=this;"function"==typeof this._flush?this._flush((function(t,n){s(e,t,n)})):s(this,null,null)}function s(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=n(5),i.inherits(a,r),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},a.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},a.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},function(e,t,n){"use strict";var r=n(9).Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=u,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=c,this.end=d,t=3;break;default:return this.write=h,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:-1}function s(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"\ufffd".repeat(n);if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"\ufffd".repeat(n+1);if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"\ufffd".repeat(n+2)}}(this,e,t);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("utf16le",0,this.lastTotal-this.lastNeed):t}function c(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.StringDecoder=a,a.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},a.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\ufffd".repeat(this.lastTotal-this.lastNeed):t},a.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=o(t[r]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--r<n?0:(i=o(t[r]))>=0?(i>0&&(e.lastNeed=i-2),i):--r<n?0:(i=o(t[r]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";var r=n(10);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this;return this._readableState&&this._readableState.destroyed||this._writableState&&this._writableState.destroyed?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(r.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){e.exports=n(21).EventEmitter},function(e,t,n){"use strict";(function(t,r){var i=n(10);e.exports=b;var a,o=n(39);b.ReadableState=y,n(21);var s=function(e,t){return e.listeners(t).length},l=n(35),u=n(9).Buffer,c=t.Uint8Array||function(){},d=n(6);d.inherits=n(5);var h=n(66),f=void 0;f=h&&h.debuglog?h.debuglog("stream"):function(){};var p,m=n(65),g=n(34);d.inherits(b,l);var v=["error","close","destroy","pause","resume"];function y(e,t){var r=t instanceof(a=a||n(2));this.objectMode=!!(e=e||{}).objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,o=e.readableHighWaterMark;this.highWaterMark=i||0===i?i:r&&(o||0===o)?o:this.objectMode?16:16384,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=n(33).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function b(e){if(a=a||n(2),!(this instanceof b))return new b(e);this._readableState=new y(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),l.call(this)}function x(e,t,n,r,i){var a,o=e._readableState;return null===t?(o.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,E(e)}}(e,o)):(i||(a=function(e,t){var n,r;return u.isBuffer(r=t)||r instanceof c||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(o,t)),a?e.emit("error",a):o.objectMode||t&&t.length>0?("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===u.prototype||(t=function(e){return u.from(e)}(t)),r?o.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,o,t,!0):o.ended?e.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!n?(t=o.decoder.write(t),o.objectMode||0!==t.length?w(e,o,t,!1):k(e,o)):w(e,o,t,!1))):r||(o.reading=!1)),function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(o)}function w(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&E(e)),k(e,t)}Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),b.prototype.destroy=g.destroy,b.prototype._undestroy=g.undestroy,b.prototype._destroy=function(e,t){this.push(null),t(e)},b.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=u.from(e,t),t=""),n=!0),x(this,e,t,!1,n)},b.prototype.unshift=function(e){return x(this,e,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(e){return p||(p=n(33).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var _=8388608;function S(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=_?e=_:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function E(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(T,e):T(e))}function T(e){f("emit readable"),e.emit("readable"),A(e)}function k(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(C,e,t))}function C(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function I(e){f("readable nexttick read 0"),e.read(0)}function O(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),A(e),t.flowing&&!t.reading&&e.read(0)}function A(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function D(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var a=n.data,o=e>a.length?a.length:e;if(i+=o===a.length?a:a.slice(0,e),0==(e-=o)){o===a.length?(++r,t.head=n.next?n.next:t.tail=null):(t.head=n,n.data=a.slice(o));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=u.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var a=r.data,o=e>a.length?a.length:e;if(a.copy(n,n.length-e,0,o),0==(e-=o)){o===a.length?(++i,t.head=r.next?r.next:t.tail=null):(t.head=r,r.data=a.slice(o));break}++i}return t.length-=i,n}(e,t),r}(e,t.buffer,t.decoder),n);var n}function M(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(N,t,e))}function N(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function j(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}b.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?M(this):E(this),null;if(0===(e=S(e,t))&&t.ended)return 0===t.length&&M(this),null;var r,i=t.needReadable;return f("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",i=!0),t.ended||t.reading?f("reading or ended",i=!1):i&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=S(n,t))),null===(r=e>0?D(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&M(this)),null!==r&&this.emit("data",r),r},b.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},b.prototype.pipe=function(e,t){var n=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=e;break;case 1:a.pipes=[a.pipes,e];break;default:a.pipes.push(e)}a.pipesCount+=1,f("pipe count=%d opts=%j",a.pipesCount,t);var l=t&&!1===t.end||e===r.stdout||e===r.stderr?y:u;function u(){f("onend"),e.end()}a.endEmitted?i.nextTick(l):n.once("end",l),e.on("unpipe",(function t(r,i){f("onunpipe"),r===n&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,f("cleanup"),e.removeListener("close",g),e.removeListener("finish",v),e.removeListener("drain",c),e.removeListener("error",m),e.removeListener("unpipe",t),n.removeListener("end",u),n.removeListener("end",y),n.removeListener("data",p),d=!0,!a.awaitDrain||e._writableState&&!e._writableState.needDrain||c())}));var c=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,A(e))}}(n);e.on("drain",c);var d=!1,h=!1;function p(t){f("ondata"),h=!1,!1!==e.write(t)||h||((1===a.pipesCount&&a.pipes===e||a.pipesCount>1&&-1!==j(a.pipes,e))&&!d&&(f("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,h=!0),n.pause())}function m(t){f("onerror",t),y(),e.removeListener("error",m),0===s(e,"error")&&e.emit("error",t)}function g(){e.removeListener("finish",v),y()}function v(){f("onfinish"),e.removeListener("close",g),y()}function y(){f("unpipe"),n.unpipe(e)}return n.on("data",p),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?o(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",m),e.once("close",g),e.once("finish",v),e.emit("pipe",n),a.flowing||(f("pipe resume"),n.resume()),e},b.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)r[a].emit("unpipe",this,n);return this}var o=j(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},b.prototype.addListener=b.prototype.on=function(e,t){var n=l.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&E(this):i.nextTick(I,this))}return n},b.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(O,e,t))}(this,e)),this},b.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},b.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(f("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){f("wrapped data"),n.decoder&&(i=n.decoder.write(i)),(!n.objectMode||null!=i)&&(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var a=0;a<v.length;a++)e.on(v[a],this.emit.bind(this,v[a]));return this._read=function(t){f("wrapped _read",t),r&&(r=!1,e.resume())},this},b._fromList=D}).call(this,n(0),n(3))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var n=new r.default(a.default,e);return function(){!function(){if(n.seek(128),"DICM"!==n.readFixedString(4))throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file."}();for(var e=[],t={};n.position<n.byteArray.length;){var r=n.position,s=(0,o.default)(n,e);if(s.tag>"x0002ffff"){n.position=r;break}s.parser=a.default,t[s.tag]=s}var l=new i.default(n.byteArrayParser,n.byteArray,t);return l.warnings=n.warnings,l.position=n.position,l}()};var r=s(n(12)),i=s(n(7)),a=s(n(22)),o=s(n(15));function s(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={readUint16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=(e[t]<<8)+e[t+1];return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3]},readInt32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3]},readFloat:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[3]=e[t],n[2]=e[t+1],n[1]=e[t+2],n[0]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[7]=e[t],n[6]=e[t+1],n[5]=e[t+2],n[4]=e[t+3],n[3]=e[t+4],n[2]=e[t+5],n[1]=e[t+6],n[0]=e[t+7],new Float64Array(n.buffer)[0]}}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?function(e,t,n){for(;e.position+4<=e.byteArray.length;){var r=(0,o.default)(e);if(e.seek(-4),"xfffee0dd"===r)return t.length=e.position-t.dataOffset,e.seek(8),t;var i=u(e,n);t.items.push(i)}n.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),t.length=e.position-t.dataOffset}(e,t,n):function(e,t,n){for(var r=t.dataOffset+t.length;e.position<r;){var i=u(e,n);t.items.push(i)}}(e,t,n)};var r=l(n(7)),i=l(n(15)),a=l(n(13)),o=l(n(4)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(16));function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){var n=(0,a.default)(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,t){for(var n={};e.position<e.byteArray.length;){var a=(0,i.default)(e,t);if(n[a.tag]=a,"xfffee00d"===a.tag)return new r.default(e.byteArrayParser,e.byteArray,n)}return t.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new r.default(e.byteArrayParser,e.byteArray,n)}(e,t),n.length=e.position-n.dataOffset):(n.dataSet=new r.default(e.byteArrayParser,e.byteArray,{}),s.parseDicomDataSetExplicit(n.dataSet,e,e.position+n.length)),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var n=e.byteArray.length-8;e.position<=n;)if(65534===e.readUint16()&&57565===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position "+(e.position-4)+" while reading element of undefined length with tag "+t.tag),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(t.encapsulatedPixelData=!0,t.basicOffsetTable=[],t.fragments=[],"xfffee000"!==(0,i.default)(e))throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var r=e.readUint32()/4,a=0;a<r;a++){var o=e.readUint32();t.basicOffsetTable.push(o)}for(var s=e.position;e.position<e.byteArray.length;){var l=(0,i.default)(e),u=e.readUint32();if("xfffee0dd"===l)return e.seek(u),void(t.length=e.position-t.dataOffset);if("xfffee000"!==l)return n&&n.push("unexpected tag "+l+" while searching for end of pixel data element with undefined length"),u>e.byteArray.length-e.position&&(u=e.byteArray.length-e.position),t.fragments.push({offset:e.position-s-8,position:e.position,length:u}),e.seek(u),void(t.length=e.position-t.dataOffset);t.fragments.push({offset:e.position-s-8,position:e.position,length:u}),e.seek(u)}n&&n.push("pixel data element "+t.tag+" missing sequence delimiter tag xfffee0dd")};var r,i=(r=n(4))&&r.__esModule?r:{default:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e||void 0===t)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===t.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var n,i=t.vr,a=t.tag;function o(t,n){for(var r="",i=0;i<t;i++)0!==i&&(r+="/"),r+=n.call(e,a,i).toString();return r}if(!0===r.isStringVr(i))n=e.string(a);else{if("AT"===i){var s=e.uint32(a);if(void 0===s)return;return s<0&&(s=4294967295+s+1),"x"+s.toString(16).toUpperCase()}"US"===i?n=o(t.length/2,e.uint16):"SS"===i?n=o(t.length/2,e.int16):"UL"===i?n=o(t.length/4,e.uint32):"SL"===i?n=o(t.length/4,e.int32):"FD"===i?n=o(t.length/8,e.double):"FL"===i&&(n=o(t.length/4,e.float))}return n};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(o||(o=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),void 0===e)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(n<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return 0!==t.basicOffsetTable.length?(0,r.default)(e,t,n):(0,i.default)(e,t,0,t.fragments.length)};var r=a(n(27)),i=a(n(18));function a(e){return e&&e.__esModule?e:{default:e}}var o=!1},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";var r=n(8),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,l,u,c,d,h){var f,p,m,g,v,y,b,x,w,_=h.bits,S=0,E=0,T=0,k=0,C=0,I=0,O=0,A=0,D=0,M=0,N=null,j=0,R=new r.Buf16(16),P=new r.Buf16(16),F=null,L=0;for(S=0;S<=15;S++)R[S]=0;for(E=0;E<l;E++)R[t[n+E]]++;for(C=_,k=15;k>=1&&0===R[k];k--);if(C>k&&(C=k),0===k)return u[c++]=20971520,u[c++]=20971520,h.bits=1,0;for(T=1;T<k&&0===R[T];T++);for(C<T&&(C=T),A=1,S=1;S<=15;S++)if(A<<=1,(A-=R[S])<0)return-1;if(A>0&&(0===e||1!==k))return-1;for(P[1]=0,S=1;S<15;S++)P[S+1]=P[S]+R[S];for(E=0;E<l;E++)0!==t[n+E]&&(d[P[t[n+E]]++]=E);if(0===e?(N=F=d,y=19):1===e?(N=i,j-=257,F=a,L-=257,y=256):(N=o,F=s,y=-1),M=0,E=0,S=T,v=c,I=C,O=0,m=-1,g=(D=1<<C)-1,1===e&&D>852||2===e&&D>592)return 1;for(;;){b=S-O,d[E]<y?(x=0,w=d[E]):d[E]>y?(x=F[L+d[E]],w=N[j+d[E]]):(x=96,w=0),f=1<<S-O,T=p=1<<I;do{u[v+(M>>O)+(p-=f)]=b<<24|x<<16|w|0}while(0!==p);for(f=1<<S-1;M&f;)f>>=1;if(0!==f?(M&=f-1,M+=f):M=0,E++,0==--R[S]){if(S===k)break;S=t[n+d[E]]}if(S>C&&(M&g)!==m){for(0===O&&(O=C),v+=T,A=1<<(I=S-O);I+O<k&&!((A-=R[I+O])<=0);)I++,A<<=1;if(D+=1<<I,1===e&&D>852||2===e&&D>592)return 1;u[m=M&g]=C<<24|I<<16|v-c|0}}return 0!==M&&(u[v+M]=S-O<<24|64<<16|0),h.bits=C,0}},function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i,a,o,s,l,u,c,d,h,f,p,m,g,v,y,b,x,w,_,S,E,T,k;T=e.input,i=(r=e.next_in)+(e.avail_in-5),k=e.output,o=(a=e.next_out)-(t-e.avail_out),s=a+(e.avail_out-257),l=(n=e.state).dmax,u=n.wsize,c=n.whave,d=n.wnext,h=n.window,f=n.hold,p=n.bits,m=n.lencode,g=n.distcode,v=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{p<15&&(f+=T[r++]<<p,f+=T[r++]<<(p+=8),p+=8),b=m[f&v];t:for(;;){if(f>>>=x=b>>>24,p-=x,0==(x=b>>>16&255))k[a++]=65535&b;else{if(!(16&x)){if(0==(64&x)){b=m[(65535&b)+(f&(1<<x)-1)];continue t}if(32&x){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}w=65535&b,(x&=15)&&(p<x&&(f+=T[r++]<<p,p+=8),w+=f&(1<<x)-1,f>>>=x,p-=x),p<15&&(f+=T[r++]<<p,f+=T[r++]<<(p+=8),p+=8),b=g[f&y];n:for(;;){if(f>>>=x=b>>>24,p-=x,!(16&(x=b>>>16&255))){if(0==(64&x)){b=g[(65535&b)+(f&(1<<x)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(_=65535&b,p<(x&=15)&&(f+=T[r++]<<p,(p+=8)<x&&(f+=T[r++]<<p,p+=8)),(_+=f&(1<<x)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=x,p-=x,_>(x=a-o)){if((x=_-x)>c&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(S=0,E=h,0===d){if(S+=u-x,x<w){w-=x;do{k[a++]=h[S++]}while(--x);S=a-_,E=k}}else if(d<x){if(S+=u+d-x,(x-=d)<w){w-=x;do{k[a++]=h[S++]}while(--x);if(S=0,d<w){w-=x=d;do{k[a++]=h[S++]}while(--x);S=a-_,E=k}}}else if(S+=d-x,x<w){w-=x;do{k[a++]=h[S++]}while(--x);S=a-_,E=k}for(;w>2;)k[a++]=E[S++],k[a++]=E[S++],k[a++]=E[S++],w-=3;w&&(k[a++]=E[S++],w>1&&(k[a++]=E[S++]))}else{S=a-_;do{k[a++]=k[S++],k[a++]=k[S++],k[a++]=k[S++],w-=3}while(w>2);w&&(k[a++]=k[S++],w>1&&(k[a++]=k[S++]))}break}}break}}while(r<i&&a<s);r-=w=p>>3,f&=(1<<(p-=w<<3))-1,e.next_in=r,e.next_out=a,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=a<s?s-a+257:257-(a-s),n.hold=f,n.bits=p}},function(e,t,n){"use strict";var r=n(8),i=n(29),a=n(28),o=n(47),s=n(46),l=-2,u=12,c=30;function d(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function h(e){var t;return e&&e.state?(e.total_in=e.total_out=(t=e.state).total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(852),t.distcode=t.distdyn=new r.Buf32(592),t.sane=1,t.back=-1,0):l}function f(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,h(e)):l}function p(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?l:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,f(e))):l}function m(e,t){var n,i;return e?(i=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=i,i.window=null,0!==(n=p(e,t))&&(e.state=null),n):l}var g,v,y=!0;function b(e){if(y){var t;for(g=new r.Buf32(512),v=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(1,e.lens,0,288,g,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(2,e.lens,0,32,v,0,e.work,{bits:5}),y=!1}e.lencode=g,e.lenbits=9,e.distcode=v,e.distbits=5}function x(e,t,n,i){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new r.Buf8(o.wsize)),i>=o.wsize?(r.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>i&&(a=i),r.arraySet(o.window,t,n-i,a,o.wnext),(i-=a)?(r.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}t.inflateReset=f,t.inflateReset2=p,t.inflateResetKeep=h,t.inflateInit=function(e){return m(e,15)},t.inflateInit2=m,t.inflate=function(e,t){var n,h,f,p,m,g,v,y,w,_,S,E,T,k,C,I,O,A,D,M,N,j,R,P,F=0,L=new r.Buf8(4),$=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return l;(n=e.state).mode===u&&(n.mode=13),m=e.next_out,f=e.output,p=e.next_in,h=e.input,y=n.hold,w=n.bits,_=g=e.avail_in,S=v=e.avail_out,j=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;w<16;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(2&n.wrap&&35615===y){n.check=0,L[0]=255&y,L[1]=y>>>8&255,n.check=a(n.check,L,2,0),y=0,w=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",n.mode=c;break}if(8!=(15&y)){e.msg="unknown compression method",n.mode=c;break}if(w-=4,N=8+(15&(y>>>=4)),0===n.wbits)n.wbits=N;else if(N>n.wbits){e.msg="invalid window size",n.mode=c;break}n.dmax=1<<N,e.adler=n.check=1,n.mode=512&y?10:u,y=0,w=0;break;case 2:for(;w<16;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(n.flags=y,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=c;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=c;break}n.head&&(n.head.text=y>>8&1),512&n.flags&&(L[0]=255&y,L[1]=y>>>8&255,n.check=a(n.check,L,2,0)),y=0,w=0,n.mode=3;case 3:for(;w<32;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}n.head&&(n.head.time=y),512&n.flags&&(L[0]=255&y,L[1]=y>>>8&255,L[2]=y>>>16&255,L[3]=y>>>24&255,n.check=a(n.check,L,4,0)),y=0,w=0,n.mode=4;case 4:for(;w<16;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}n.head&&(n.head.xflags=255&y,n.head.os=y>>8),512&n.flags&&(L[0]=255&y,L[1]=y>>>8&255,n.check=a(n.check,L,2,0)),y=0,w=0,n.mode=5;case 5:if(1024&n.flags){for(;w<16;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}n.length=y,n.head&&(n.head.extra_len=y),512&n.flags&&(L[0]=255&y,L[1]=y>>>8&255,n.check=a(n.check,L,2,0)),y=0,w=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((E=n.length)>g&&(E=g),E&&(n.head&&(N=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,h,p,E,N)),512&n.flags&&(n.check=a(n.check,h,E,p)),g-=E,p+=E,n.length-=E),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===g)break e;E=0;do{N=h[p+E++],n.head&&N&&n.length<65536&&(n.head.name+=String.fromCharCode(N))}while(N&&E<g);if(512&n.flags&&(n.check=a(n.check,h,E,p)),g-=E,p+=E,N)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===g)break e;E=0;do{N=h[p+E++],n.head&&N&&n.length<65536&&(n.head.comment+=String.fromCharCode(N))}while(N&&E<g);if(512&n.flags&&(n.check=a(n.check,h,E,p)),g-=E,p+=E,N)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;w<16;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(y!==(65535&n.check)){e.msg="header crc mismatch",n.mode=c;break}y=0,w=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=u;break;case 10:for(;w<32;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}e.adler=n.check=d(y),y=0,w=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=m,e.avail_out=v,e.next_in=p,e.avail_in=g,n.hold=y,n.bits=w,2;e.adler=n.check=1,n.mode=u;case u:if(5===t||6===t)break e;case 13:if(n.last){y>>>=7&w,w-=7&w,n.mode=27;break}for(;w<3;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}switch(n.last=1&y,w-=1,3&(y>>>=1)){case 0:n.mode=14;break;case 1:if(b(n),n.mode=20,6===t){y>>>=2,w-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=c}y>>>=2,w-=2;break;case 14:for(y>>>=7&w,w-=7&w;w<32;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",n.mode=c;break}if(n.length=65535&y,y=0,w=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(E=n.length){if(E>g&&(E=g),E>v&&(E=v),0===E)break e;r.arraySet(f,h,p,E,m),g-=E,p+=E,v-=E,m+=E,n.length-=E;break}n.mode=u;break;case 17:for(;w<14;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(n.nlen=257+(31&y),w-=5,n.ndist=1+(31&(y>>>=5)),w-=5,n.ncode=4+(15&(y>>>=5)),y>>>=4,w-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=c;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;w<3;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}n.lens[$[n.have++]]=7&y,y>>>=3,w-=3}for(;n.have<19;)n.lens[$[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,j=s(0,n.lens,0,19,n.lencode,0,n.work,R={bits:n.lenbits}),n.lenbits=R.bits,j){e.msg="invalid code lengths set",n.mode=c;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;I=(F=n.lencode[y&(1<<n.lenbits)-1])>>>16&255,O=65535&F,!((C=F>>>24)<=w);){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(O<16)y>>>=C,w-=C,n.lens[n.have++]=O;else{if(16===O){for(P=C+2;w<P;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(y>>>=C,w-=C,0===n.have){e.msg="invalid bit length repeat",n.mode=c;break}N=n.lens[n.have-1],E=3+(3&y),y>>>=2,w-=2}else if(17===O){for(P=C+3;w<P;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}w-=C,N=0,E=3+(7&(y>>>=C)),y>>>=3,w-=3}else{for(P=C+7;w<P;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}w-=C,N=0,E=11+(127&(y>>>=C)),y>>>=7,w-=7}if(n.have+E>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=c;break}for(;E--;)n.lens[n.have++]=N}}if(n.mode===c)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=c;break}if(n.lenbits=9,j=s(1,n.lens,0,n.nlen,n.lencode,0,n.work,R={bits:n.lenbits}),n.lenbits=R.bits,j){e.msg="invalid literal/lengths set",n.mode=c;break}if(n.distbits=6,n.distcode=n.distdyn,j=s(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,R={bits:n.distbits}),n.distbits=R.bits,j){e.msg="invalid distances set",n.mode=c;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(g>=6&&v>=258){e.next_out=m,e.avail_out=v,e.next_in=p,e.avail_in=g,n.hold=y,n.bits=w,o(e,S),m=e.next_out,f=e.output,v=e.avail_out,p=e.next_in,h=e.input,g=e.avail_in,y=n.hold,w=n.bits,n.mode===u&&(n.back=-1);break}for(n.back=0;I=(F=n.lencode[y&(1<<n.lenbits)-1])>>>16&255,O=65535&F,!((C=F>>>24)<=w);){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(I&&0==(240&I)){for(A=C,D=I,M=O;I=(F=n.lencode[M+((y&(1<<A+D)-1)>>A)])>>>16&255,O=65535&F,!(A+(C=F>>>24)<=w);){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}y>>>=A,w-=A,n.back+=A}if(y>>>=C,w-=C,n.back+=C,n.length=O,0===I){n.mode=26;break}if(32&I){n.back=-1,n.mode=u;break}if(64&I){e.msg="invalid literal/length code",n.mode=c;break}n.extra=15&I,n.mode=22;case 22:if(n.extra){for(P=n.extra;w<P;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}n.length+=y&(1<<n.extra)-1,y>>>=n.extra,w-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;I=(F=n.distcode[y&(1<<n.distbits)-1])>>>16&255,O=65535&F,!((C=F>>>24)<=w);){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(0==(240&I)){for(A=C,D=I,M=O;I=(F=n.distcode[M+((y&(1<<A+D)-1)>>A)])>>>16&255,O=65535&F,!(A+(C=F>>>24)<=w);){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}y>>>=A,w-=A,n.back+=A}if(y>>>=C,w-=C,n.back+=C,64&I){e.msg="invalid distance code",n.mode=c;break}n.offset=O,n.extra=15&I,n.mode=24;case 24:if(n.extra){for(P=n.extra;w<P;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}n.offset+=y&(1<<n.extra)-1,y>>>=n.extra,w-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=c;break}n.mode=25;case 25:if(0===v)break e;if(n.offset>(E=S-v)){if((E=n.offset-E)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=c;break}T=E>n.wnext?n.wsize-(E-=n.wnext):n.wnext-E,E>n.length&&(E=n.length),k=n.window}else k=f,T=m-n.offset,E=n.length;E>v&&(E=v),v-=E,n.length-=E;do{f[m++]=k[T++]}while(--E);0===n.length&&(n.mode=21);break;case 26:if(0===v)break e;f[m++]=n.length,v--,n.mode=21;break;case 27:if(n.wrap){for(;w<32;){if(0===g)break e;g--,y|=h[p++]<<w,w+=8}if(e.total_out+=S-=v,n.total+=S,S&&(e.adler=n.check=n.flags?a(n.check,f,S,m-S):i(n.check,f,S,m-S)),S=v,(n.flags?y:d(y))!==n.check){e.msg="incorrect data check",n.mode=c;break}y=0,w=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;w<32;){if(0===g)break e;g--,y+=h[p++]<<w,w+=8}if(y!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=c;break}y=0,w=0}n.mode=29;case 29:j=1;break e;case c:j=-3;break e;case 31:return-4;case 32:default:return l}return e.next_out=m,e.avail_out=v,e.next_in=p,e.avail_in=g,n.hold=y,n.bits=w,(n.wsize||S!==e.avail_out&&n.mode<c&&(n.mode<27||4!==t))&&x(e,e.output,e.next_out,S-e.avail_out)?(n.mode=31,-4):(S-=e.avail_out,e.total_in+=_-=e.avail_in,e.total_out+=S,n.total+=S,n.wrap&&S&&(e.adler=n.check=n.flags?a(n.check,f,S,e.next_out-S):i(n.check,f,S,e.next_out-S)),e.data_type=n.bits+(n.last?64:0)+(n.mode===u?128:0)+(20===n.mode||15===n.mode?256:0),(0===_&&0===S||4===t)&&0===j&&(j=-5),j)},t.inflateEnd=function(e){if(!e||!e.state)return l;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?l:(n.head=t,t.done=!1,0):l},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?l:11===n.mode&&i(1,t,r,0)!==n.check?-3:x(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,0):l},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";var r=n(8);function i(e){for(var t=e.length;--t>=0;)e[t]=0}var a=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],o=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],l=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],u=new Array(576);i(u);var c=new Array(60);i(c);var d=new Array(512);i(d);var h=new Array(256);i(h);var f=new Array(29);i(f);var p,m,g,v=new Array(30);function y(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function b(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function x(e){return e<256?d[e]:d[256+(e>>>7)]}function w(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function _(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,w(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function S(e,t,n){_(e,n[2*t],n[2*t+1])}function E(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function T(e,t,n){var r,i,a=new Array(16),o=0;for(r=1;r<=15;r++)a[r]=o=o+n[r-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=E(a[s]++,s))}}function k(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function C(e){e.bi_valid>8?w(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function I(e,t,n,r){var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]}function O(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&I(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!I(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function A(e,t,n){var r,i,s,l,u=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*u]<<8|e.pending_buf[e.d_buf+2*u+1],i=e.pending_buf[e.l_buf+u],u++,0===r?S(e,i,t):(S(e,(s=h[i])+256+1,t),0!==(l=a[s])&&_(e,i-=f[s],l),S(e,s=x(--r),n),0!==(l=o[s])&&_(e,r-=v[s],l))}while(u<e.last_lit);S(e,256,t)}function D(e,t){var n,r,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<l;n++)0!==a[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)O(e,a,n);i=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],O(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,a[2*i]=a[2*n]+a[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,a[2*n+1]=a[2*r+1]=i,e.heap[1]=i++,O(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,a,o,s,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(a=0;a<=15;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(a=l[2*l[2*(r=e.heap[n])+1]+1]+1)>p&&(a=p,m++),l[2*r+1]=a,r>u||(e.bl_count[a]++,o=0,r>=f&&(o=h[r-f]),e.opt_len+=(s=l[2*r])*(a+o),d&&(e.static_len+=s*(c[2*r+1]+o)));if(0!==m){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(a=p;0!==a;a--)for(r=e.bl_count[a];0!==r;)(i=e.heap[--n])>u||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),r--)}}(e,t),T(a,u,e.bl_count)}function M(e,t,n){var r,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++s<l&&i===o||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4))}function N(e,t,n){var r,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++s<l&&i===o)){if(s<u)do{S(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(S(e,i,e.bl_tree),s--),S(e,16,e.bl_tree),_(e,s-3,2)):s<=10?(S(e,17,e.bl_tree),_(e,s-3,3)):(S(e,18,e.bl_tree),_(e,s-11,7));s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4)}}i(v);var j=!1;function R(e,t,n,i){_(e,0+(i?1:0),3),function(e,t,n,i){C(e),w(e,n),w(e,~n),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}t._tr_init=function(e){j||(function(){var e,t,n,r,i,l=new Array(16);for(n=0,r=0;r<28;r++)for(f[r]=n,e=0;e<1<<a[r];e++)h[n++]=r;for(h[n-1]=r,i=0,r=0;r<16;r++)for(v[r]=i,e=0;e<1<<o[r];e++)d[i++]=r;for(i>>=7;r<30;r++)for(v[r]=i<<7,e=0;e<1<<o[r]-7;e++)d[256+i++]=r;for(t=0;t<=15;t++)l[t]=0;for(e=0;e<=143;)u[2*e+1]=8,e++,l[8]++;for(;e<=255;)u[2*e+1]=9,e++,l[9]++;for(;e<=279;)u[2*e+1]=7,e++,l[7]++;for(;e<=287;)u[2*e+1]=8,e++,l[8]++;for(T(u,287,l),e=0;e<30;e++)c[2*e+1]=5,c[2*e]=E(e,5);p=new y(u,a,257,286,15),m=new y(c,o,0,30,15),g=new y(new Array(0),s,0,19,7)}(),j=!0),e.l_desc=new b(e.dyn_ltree,p),e.d_desc=new b(e.dyn_dtree,m),e.bl_desc=new b(e.bl_tree,g),e.bi_buf=0,e.bi_valid=0,k(e)},t._tr_stored_block=R,t._tr_flush_block=function(e,t,n,r){var i,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),D(e,e.l_desc),D(e,e.d_desc),o=function(e){var t;for(M(e,e.dyn_ltree,e.l_desc.max_code),M(e,e.dyn_dtree,e.d_desc.max_code),D(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*l[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),(a=e.static_len+3+7>>>3)<=(i=e.opt_len+3+7>>>3)&&(i=a)):i=a=n+5,n+4<=i&&-1!==t?R(e,t,n,r):4===e.strategy||a===i?(_(e,2+(r?1:0),3),A(e,u,c)):(_(e,4+(r?1:0),3),function(e,t,n,r){var i;for(_(e,t-257,5),_(e,n-1,5),_(e,r-4,4),i=0;i<r;i++)_(e,e.bl_tree[2*l[i]+1],3);N(e,e.dyn_ltree,t-1),N(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),A(e,e.dyn_ltree,e.dyn_dtree)),k(e),r&&C(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(h[n]+256+1)]++,e.dyn_dtree[2*x(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){_(e,2,3),S(e,256,u),function(e){16===e.bi_valid?(w(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";var r,i=n(8),a=n(50),o=n(29),s=n(28),l=n(49),u=-2,c=258,d=262,h=103,f=113,p=666;function m(e,t){return e.msg=l[t],t}function g(e){return(e<<1)-(e>4?9:0)}function v(e){for(var t=e.length;--t>=0;)e[t]=0}function y(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function b(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,y(e.strm)}function x(e,t){e.pending_buf[e.pending++]=t}function w(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function _(e,t){var n,r,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-d?e.strstart-(e.w_size-d):0,u=e.window,h=e.w_mask,f=e.prev,p=e.strstart+c,m=u[a+o-1],g=u[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(n=t)+o]===g&&u[n+o-1]===m&&u[n]===u[a]&&u[++n]===u[a+1]){a+=2,n++;do{}while(u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&a<p);if(r=c-(p-a),a=p-c,r>o){if(e.match_start=t,o=r,r>=s)break;m=u[a+o-1],g=u[a+o]}}}while((t=f[t&h])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function S(e){var t,n,r,a,l,u,c,h,f,p,m=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=m+(m-d)){i.arraySet(e.window,e.window,m,m,0),e.match_start-=m,e.strstart-=m,e.block_start-=m,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=m?r-m:0}while(--n);t=n=m;do{r=e.prev[--t],e.prev[t]=r>=m?r-m:0}while(--n);a+=m}if(0===e.strm.avail_in)break;if(c=e.window,h=e.strstart+e.lookahead,p=void 0,(p=(u=e.strm).avail_in)>(f=a)&&(p=f),n=0===p?0:(u.avail_in-=p,i.arraySet(c,u.input,u.next_in,p,h),1===u.state.wrap?u.adler=o(u.adler,c,p,h):2===u.state.wrap&&(u.adler=s(u.adler,c,p,h)),u.next_in+=p,u.total_in+=p,p),e.lookahead+=n,e.lookahead+e.insert>=3)for(e.ins_h=e.window[l=e.strstart-e.insert],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+3-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<d&&0!==e.strm.avail_in)}function E(e,t){for(var n,r;;){if(e.lookahead<d){if(S(e),e.lookahead<d&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-d&&(e.match_length=_(e,n)),e.match_length>=3)if(r=a._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}function T(e,t){for(var n,r,i;;){if(e.lookahead<d){if(S(e),e.lookahead<d&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-d&&(e.match_length=_(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(b(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=a._tr_tally(e,0,e.window[e.strstart-1]))&&b(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}function k(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function C(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:f,e.adler=2===t.wrap?0:1,t.last_flush=0,a._tr_init(t),0):m(e,u)}function I(e){var t,n=C(e);return 0===n&&((t=e.state).window_size=2*t.w_size,v(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function O(e,t,n,r,a,o){if(!e)return u;var s=1;if(-1===t&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),a<1||a>9||8!==n||r<8||r>15||t<0||t>9||o<0||o>4)return m(e,u);8===r&&(r=9);var l=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),v(this.dyn_ltree),v(this.dyn_dtree),v(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),v(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),v(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=n,I(e)}r=[new k(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(S(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,b(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-d&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&b(e,!1),1)})),new k(4,4,8,4,E),new k(4,5,16,8,E),new k(4,6,32,32,E),new k(4,4,16,16,T),new k(8,16,32,32,T),new k(8,16,128,128,T),new k(8,32,128,256,T),new k(32,128,258,1024,T),new k(32,258,258,4096,T)],t.deflateInit=function(e,t){return O(e,t,8,15,8,0)},t.deflateInit2=O,t.deflateReset=I,t.deflateResetKeep=C,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?u:(e.state.gzhead=t,0):u},t.deflate=function(e,t){var n,i,o,l;if(!e||!e.state||t>5||t<0)return e?m(e,u):u;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===p&&4!==t)return m(e,0===e.avail_out?-5:u);if(i.strm=e,n=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,x(i,31),x(i,139),x(i,8),i.gzhead?(x(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),x(i,255&i.gzhead.time),x(i,i.gzhead.time>>8&255),x(i,i.gzhead.time>>16&255),x(i,i.gzhead.time>>24&255),x(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),x(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(x(i,255&i.gzhead.extra.length),x(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(x(i,0),x(i,0),x(i,0),x(i,0),x(i,0),x(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),x(i,3),i.status=f);else{var d=8+(i.w_bits-8<<4)<<8;d|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(d|=32),d+=31-d%31,i.status=f,w(i,d),0!==i.strstart&&(w(i,e.adler>>>16),w(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),y(e),o=i.pending,i.pending!==i.pending_buf_size));)x(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),y(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,x(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),y(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,x(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.status=h)}else i.status=h;if(i.status===h&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&y(e),i.pending+2<=i.pending_buf_size&&(x(i,255&e.adler),x(i,e.adler>>8&255),e.adler=0,i.status=f)):i.status=f),0!==i.pending){if(y(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&g(t)<=g(n)&&4!==t)return m(e,-5);if(i.status===p&&0!==e.avail_in)return m(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&i.status!==p){var _=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(S(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var n,r,i,o,s=e.window;;){if(e.lookahead<=c){if(S(e),e.lookahead<=c&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=s[i=e.strstart-1])===s[++i]&&r===s[++i]&&r===s[++i]){o=e.strstart+c;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<o);e.match_length=c-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=a._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}(i,t):r[i.level].func(i,t);if(3!==_&&4!==_||(i.status=p),1===_||3===_)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===_&&(1===t?a._tr_align(i):5!==t&&(a._tr_stored_block(i,0,0,!1),3===t&&(v(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),y(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(x(i,255&e.adler),x(i,e.adler>>8&255),x(i,e.adler>>16&255),x(i,e.adler>>24&255),x(i,255&e.total_in),x(i,e.total_in>>8&255),x(i,e.total_in>>16&255),x(i,e.total_in>>24&255)):(w(i,e.adler>>>16),w(i,65535&e.adler)),y(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==h&&t!==f&&t!==p?m(e,u):(e.state=null,t===f?m(e,-3):0):u},t.deflateSetDictionary=function(e,t){var n,r,a,s,l,c,d,h,f=t.length;if(!e||!e.state)return u;if(2===(s=(n=e.state).wrap)||1===s&&42!==n.status||n.lookahead)return u;for(1===s&&(e.adler=o(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===s&&(v(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new i.Buf8(n.w_size),i.arraySet(h,t,f-n.w_size,n.w_size,0),t=h,f=n.w_size),l=e.avail_in,c=e.next_in,d=e.input,e.avail_in=f,e.next_in=0,e.input=t,S(n);n.lookahead>=3;){r=n.strstart,a=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--a);n.strstart=r,n.lookahead=2,S(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=c,e.input=d,e.avail_in=l,n.wrap=s,0},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t){e.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t,n){"use strict";(function(e,r){var i=n(31),a=n(52),o=n(51),s=n(48),l=n(45);for(var u in l)t[u]=l[u];function c(e){if("number"!=typeof e||e<t.DEFLATE||e>t.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=e,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}t.NONE=0,t.DEFLATE=1,t.INFLATE=2,t.GZIP=3,t.GUNZIP=4,t.DEFLATERAW=5,t.INFLATERAW=6,t.UNZIP=7,c.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,i(this.init_done,"close before init"),i(this.mode<=t.UNZIP),this.mode===t.DEFLATE||this.mode===t.GZIP||this.mode===t.DEFLATERAW?o.deflateEnd(this.strm):this.mode!==t.INFLATE&&this.mode!==t.GUNZIP&&this.mode!==t.INFLATERAW&&this.mode!==t.UNZIP||s.inflateEnd(this.strm),this.mode=t.NONE,this.dictionary=null)},c.prototype.write=function(e,t,n,r,i,a,o){return this._write(!0,e,t,n,r,i,a,o)},c.prototype.writeSync=function(e,t,n,r,i,a,o){return this._write(!1,e,t,n,r,i,a,o)},c.prototype._write=function(n,a,o,s,l,u,c,d){if(i.equal(arguments.length,8),i(this.init_done,"write before init"),i(this.mode!==t.NONE,"already finalized"),i.equal(!1,this.write_in_progress,"write already in progress"),i.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,i.equal(!1,void 0===a,"must provide flush value"),this.write_in_progress=!0,a!==t.Z_NO_FLUSH&&a!==t.Z_PARTIAL_FLUSH&&a!==t.Z_SYNC_FLUSH&&a!==t.Z_FULL_FLUSH&&a!==t.Z_FINISH&&a!==t.Z_BLOCK)throw new Error("Invalid flush value");if(null==o&&(o=e.alloc(0),l=0,s=0),this.strm.avail_in=l,this.strm.input=o,this.strm.next_in=s,this.strm.avail_out=d,this.strm.output=u,this.strm.next_out=c,this.flush=a,!n)return this._process(),this._checkError()?this._afterSync():void 0;var h=this;return r.nextTick((function(){h._process(),h._after()})),this},c.prototype._afterSync=function(){var e=this.strm.avail_out,t=this.strm.avail_in;return this.write_in_progress=!1,[t,e]},c.prototype._process=function(){var e=null;switch(this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflate(this.strm,this.flush);break;case t.UNZIP:switch(this.strm.avail_in>0&&(e=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===e)break;if(31!==this.strm.input[e]){this.mode=t.INFLATE;break}if(this.gzip_id_bytes_read=1,e++,1===this.strm.avail_in)break;case 1:if(null===e)break;139===this.strm.input[e]?(this.gzip_id_bytes_read=2,this.mode=t.GUNZIP):this.mode=t.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:for(this.err=s.inflate(this.strm,this.flush),this.err===t.Z_NEED_DICT&&this.dictionary&&(this.err=s.inflateSetDictionary(this.strm,this.dictionary),this.err===t.Z_OK?this.err=s.inflate(this.strm,this.flush):this.err===t.Z_DATA_ERROR&&(this.err=t.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===t.GUNZIP&&this.err===t.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=s.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},c.prototype._checkError=function(){switch(this.err){case t.Z_OK:case t.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===t.Z_FINISH)return this._error("unexpected end of file"),!1;break;case t.Z_STREAM_END:break;case t.Z_NEED_DICT:return this._error(null==this.dictionary?"Missing dictionary":"Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},c.prototype._after=function(){if(this._checkError()){var e=this.strm.avail_out,t=this.strm.avail_in;this.write_in_progress=!1,this.callback(t,e),this.pending_close&&this.close()}},c.prototype._error=function(e){this.strm.msg&&(e=this.strm.msg),this.onerror(e,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},c.prototype.init=function(e,n,r,a,o){i(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),i(e>=8&&e<=15,"invalid windowBits"),i(n>=-1&&n<=9,"invalid compression level"),i(r>=1&&r<=9,"invalid memlevel"),i(a===t.Z_FILTERED||a===t.Z_HUFFMAN_ONLY||a===t.Z_RLE||a===t.Z_FIXED||a===t.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(n,e,r,a,o),this._setDictionary()},c.prototype.params=function(){throw new Error("deflateParams Not supported")},c.prototype.reset=function(){this._reset(),this._setDictionary()},c.prototype._init=function(e,n,r,i,l){switch(this.level=e,this.windowBits=n,this.memLevel=r,this.strategy=i,this.flush=t.Z_NO_FLUSH,this.err=t.Z_OK,this.mode!==t.GZIP&&this.mode!==t.GUNZIP||(this.windowBits+=16),this.mode===t.UNZIP&&(this.windowBits+=32),this.mode!==t.DEFLATERAW&&this.mode!==t.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new a,this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflateInit2(this.strm,this.level,t.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:case t.UNZIP:this.err=s.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==t.Z_OK&&this._error("Init error"),this.dictionary=l,this.write_in_progress=!1,this.init_done=!0},c.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:this.err=o.deflateSetDictionary(this.strm,this.dictionary)}this.err!==t.Z_OK&&this._error("Failed to set dictionary")}},c.prototype._reset=function(){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:case t.GZIP:this.err=o.deflateReset(this.strm);break;case t.INFLATE:case t.INFLATERAW:case t.GUNZIP:this.err=s.inflateReset(this.strm)}this.err!==t.Z_OK&&this._error("Failed to reset stream")},t.Zlib=c}).call(this,n(1).Buffer,n(3))},function(e,t,n){e.exports=n(20).PassThrough},function(e,t,n){e.exports=n(20).Transform},function(e,t,n){e.exports=n(2)},function(e,t,n){e.exports=n(19)},function(e,t,n){"use strict";e.exports=a;var r=n(32),i=n(6);function a(e){if(!(this instanceof a))return new a(e);r.call(this,e)}i.inherits=n(5),i.inherits(a,r),a.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){(function(t){function n(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this,n(0))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,i,a,o,s,l=1,u={},c=!1,d=e.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(e);h=h&&h.setTimeout?h:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){p(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?(o="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&p(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),r=function(t){e.postMessage(o+t,"*")}):e.MessageChannel?((a=new MessageChannel).port1.onmessage=function(e){p(e.data)},r=function(e){a.port2.postMessage(e)}):d&&"onreadystatechange"in d.createElement("script")?(i=d.documentElement,r=function(e){var t=d.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):r=function(e){setTimeout(p,0,e)},h.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];return u[l]={callback:e,args:t},r(l),l++},h.clearImmediate=f}function f(e){delete u[e]}function p(e){if(c)setTimeout(p,0,e);else{var t=u[e];if(t){c=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{f(e),c=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(0),n(3))},function(e,t,n){(function(e){var r=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(r.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(r.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(62),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(0))},function(e,t){},function(e,t,n){"use strict";var r=n(9).Buffer,i=n(64);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return this.head=1===this.length?this.tail=null:this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t=r.allocUnsafe(e>>>0),n=this.head,i=0;n;)n.data.copy(t,i),i+=n.data.length,n=n.next;return t},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,n){e.exports=i;var r=n(21).EventEmitter;function i(){r.call(this)}n(5)(i,r),i.Readable=n(20),i.Writable=n(59),i.Duplex=n(58),i.Transform=n(57),i.PassThrough=n(56),i.Stream=i,i.prototype.pipe=function(e,t){var n=this;function i(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function a(){n.readable&&n.resume&&n.resume()}n.on("data",i),e.on("drain",a),e._isStdio||t&&!1===t.end||(n.on("end",s),n.on("close",l));var o=!1;function s(){o||(o=!0,e.end())}function l(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function u(e){if(c(),0===r.listenerCount(this,"error"))throw e}function c(){n.removeListener("data",i),e.removeListener("drain",a),n.removeListener("end",s),n.removeListener("close",l),n.removeListener("error",u),e.removeListener("error",u),n.removeListener("end",c),n.removeListener("close",c),e.removeListener("close",c)}return n.on("error",u),e.on("error",u),n.on("end",c),n.on("close",c),e.on("close",c),e.emit("pipe",n),e}},function(e,t,n){"use strict";(function(e){var r=n(1).Buffer,i=n(67).Transform,a=n(55),o=n(30),s=n(31).ok,l=n(1).kMaxLength,u="Cannot create final Buffer. It would be larger than 0x"+l.toString(16)+" bytes";a.Z_MIN_WINDOWBITS=8,a.Z_MAX_WINDOWBITS=15,a.Z_DEFAULT_WINDOWBITS=15,a.Z_MIN_CHUNK=64,a.Z_MAX_CHUNK=1/0,a.Z_DEFAULT_CHUNK=16384,a.Z_MIN_MEMLEVEL=1,a.Z_MAX_MEMLEVEL=9,a.Z_DEFAULT_MEMLEVEL=8,a.Z_MIN_LEVEL=-1,a.Z_MAX_LEVEL=9,a.Z_DEFAULT_LEVEL=a.Z_DEFAULT_COMPRESSION;for(var c=Object.keys(a),d=0;d<c.length;d++){var h=c[d];h.match(/^Z/)&&Object.defineProperty(t,h,{enumerable:!0,value:a[h],writable:!1})}for(var f={Z_OK:a.Z_OK,Z_STREAM_END:a.Z_STREAM_END,Z_NEED_DICT:a.Z_NEED_DICT,Z_ERRNO:a.Z_ERRNO,Z_STREAM_ERROR:a.Z_STREAM_ERROR,Z_DATA_ERROR:a.Z_DATA_ERROR,Z_MEM_ERROR:a.Z_MEM_ERROR,Z_BUF_ERROR:a.Z_BUF_ERROR,Z_VERSION_ERROR:a.Z_VERSION_ERROR},p=Object.keys(f),m=0;m<p.length;m++){var g=p[m];f[f[g]]=g}function v(e,t,n){var i=[],a=0;function o(){for(var t;null!==(t=e.read());)i.push(t),a+=t.length;e.once("readable",o)}function s(){var t,o=null;a>=l?o=new RangeError(u):t=r.concat(i,a),i=[],e.close(),n(o,t)}e.on("error",(function(t){e.removeListener("end",s),e.removeListener("readable",o),n(t)})),e.on("end",s),e.end(t),o()}function y(e,t){if("string"==typeof t&&(t=r.from(t)),!r.isBuffer(t))throw new TypeError("Not a string or buffer");return e._processChunk(t,e._finishFlushFlag)}function b(e){if(!(this instanceof b))return new b(e);C.call(this,e,a.DEFLATE)}function x(e){if(!(this instanceof x))return new x(e);C.call(this,e,a.INFLATE)}function w(e){if(!(this instanceof w))return new w(e);C.call(this,e,a.GZIP)}function _(e){if(!(this instanceof _))return new _(e);C.call(this,e,a.GUNZIP)}function S(e){if(!(this instanceof S))return new S(e);C.call(this,e,a.DEFLATERAW)}function E(e){if(!(this instanceof E))return new E(e);C.call(this,e,a.INFLATERAW)}function T(e){if(!(this instanceof T))return new T(e);C.call(this,e,a.UNZIP)}function k(e){return e===a.Z_NO_FLUSH||e===a.Z_PARTIAL_FLUSH||e===a.Z_SYNC_FLUSH||e===a.Z_FULL_FLUSH||e===a.Z_FINISH||e===a.Z_BLOCK}function C(e,n){var o=this;if(this._opts=e=e||{},this._chunkSize=e.chunkSize||t.Z_DEFAULT_CHUNK,i.call(this,e),e.flush&&!k(e.flush))throw new Error("Invalid flush flag: "+e.flush);if(e.finishFlush&&!k(e.finishFlush))throw new Error("Invalid flush flag: "+e.finishFlush);if(this._flushFlag=e.flush||a.Z_NO_FLUSH,this._finishFlushFlag=void 0!==e.finishFlush?e.finishFlush:a.Z_FINISH,e.chunkSize&&(e.chunkSize<t.Z_MIN_CHUNK||e.chunkSize>t.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<t.Z_MIN_WINDOWBITS||e.windowBits>t.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<t.Z_MIN_LEVEL||e.level>t.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<t.Z_MIN_MEMLEVEL||e.memLevel>t.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=t.Z_FILTERED&&e.strategy!=t.Z_HUFFMAN_ONLY&&e.strategy!=t.Z_RLE&&e.strategy!=t.Z_FIXED&&e.strategy!=t.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!r.isBuffer(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new a.Zlib(n);var s=this;this._hadError=!1,this._handle.onerror=function(e,n){I(s),s._hadError=!0;var r=new Error(e);r.errno=n,r.code=t.codes[n],s.emit("error",r)};var l=t.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(l=e.level);var u=t.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(u=e.strategy),this._handle.init(e.windowBits||t.Z_DEFAULT_WINDOWBITS,l,e.memLevel||t.Z_DEFAULT_MEMLEVEL,u,e.dictionary),this._buffer=r.allocUnsafe(this._chunkSize),this._offset=0,this._level=l,this._strategy=u,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!o._handle},configurable:!0,enumerable:!0})}function I(t,n){n&&e.nextTick(n),t._handle&&(t._handle.close(),t._handle=null)}function O(e){e.emit("close")}Object.defineProperty(t,"codes",{enumerable:!0,value:Object.freeze(f),writable:!1}),t.Deflate=b,t.Inflate=x,t.Gzip=w,t.Gunzip=_,t.DeflateRaw=S,t.InflateRaw=E,t.Unzip=T,t.createDeflate=function(e){return new b(e)},t.createInflate=function(e){return new x(e)},t.createDeflateRaw=function(e){return new S(e)},t.createInflateRaw=function(e){return new E(e)},t.createGzip=function(e){return new w(e)},t.createGunzip=function(e){return new _(e)},t.createUnzip=function(e){return new T(e)},t.deflate=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new b(t),e,n)},t.deflateSync=function(e,t){return y(new b(t),e)},t.gzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new w(t),e,n)},t.gzipSync=function(e,t){return y(new w(t),e)},t.deflateRaw=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new S(t),e,n)},t.deflateRawSync=function(e,t){return y(new S(t),e)},t.unzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new T(t),e,n)},t.unzipSync=function(e,t){return y(new T(t),e)},t.inflate=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new x(t),e,n)},t.inflateSync=function(e,t){return y(new x(t),e)},t.gunzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new _(t),e,n)},t.gunzipSync=function(e,t){return y(new _(t),e)},t.inflateRaw=function(e,t,n){return"function"==typeof t&&(n=t,t={}),v(new E(t),e,n)},t.inflateRawSync=function(e,t){return y(new E(t),e)},o.inherits(C,i),C.prototype.params=function(n,r,i){if(n<t.Z_MIN_LEVEL||n>t.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+n);if(r!=t.Z_FILTERED&&r!=t.Z_HUFFMAN_ONLY&&r!=t.Z_RLE&&r!=t.Z_FIXED&&r!=t.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+r);if(this._level!==n||this._strategy!==r){var o=this;this.flush(a.Z_SYNC_FLUSH,(function(){s(o._handle,"zlib binding closed"),o._handle.params(n,r),o._hadError||(o._level=n,o._strategy=r,i&&i())}))}else e.nextTick(i)},C.prototype.reset=function(){return s(this._handle,"zlib binding closed"),this._handle.reset()},C.prototype._flush=function(e){this._transform(r.alloc(0),"",e)},C.prototype.flush=function(t,n){var i=this,o=this._writableState;("function"==typeof t||void 0===t&&!n)&&(n=t,t=a.Z_FULL_FLUSH),o.ended?n&&e.nextTick(n):o.ending?n&&this.once("end",n):o.needDrain?n&&this.once("drain",(function(){return i.flush(t,n)})):(this._flushFlag=t,this.write(r.alloc(0),"",n))},C.prototype.close=function(t){I(this,t),e.nextTick(O,this)},C.prototype._transform=function(e,t,n){var i,o=this._writableState,s=(o.ending||o.ended)&&(!e||o.length===e.length);return null===e||r.isBuffer(e)?this._handle?(s?i=this._finishFlushFlag:(i=this._flushFlag,e.length>=o.length&&(this._flushFlag=this._opts.flush||a.Z_NO_FLUSH)),void this._processChunk(e,i,n)):n(new Error("zlib binding closed")):n(new Error("invalid input"))},C.prototype._processChunk=function(e,t,n){var i=e&&e.length,a=this._chunkSize-this._offset,o=0,c=this,d="function"==typeof n;if(!d){var h,f=[],p=0;this.on("error",(function(e){h=e})),s(this._handle,"zlib binding closed");do{var m=this._handle.writeSync(t,e,o,i,this._buffer,this._offset,a)}while(!this._hadError&&y(m[0],m[1]));if(this._hadError)throw h;if(p>=l)throw I(this),new RangeError(u);var g=r.concat(f,p);return I(this),g}s(this._handle,"zlib binding closed");var v=this._handle.write(t,e,o,i,this._buffer,this._offset,a);function y(l,u){if(this&&(this.buffer=null,this.callback=null),!c._hadError){var h=a-u;if(s(h>=0,"have should not go down"),h>0){var m=c._buffer.slice(c._offset,c._offset+h);c._offset+=h,d?c.push(m):(f.push(m),p+=m.length)}if((0===u||c._offset>=c._chunkSize)&&(a=c._chunkSize,c._offset=0,c._buffer=r.allocUnsafe(c._chunkSize)),0===u){if(o+=i-l,i=l,!d)return!0;var g=c._handle.write(t,e,o,i,c._buffer,c._offset,c._chunkSize);return g.callback=y,void(g.buffer=e)}if(!d)return!1;n()}}v.buffer=e,v.callback=y},o.inherits(b,C),o.inherits(x,C),o.inherits(w,C),o.inherits(_,C),o.inherits(S,C),o.inherits(E,C),o.inherits(T,C)}).call(this,n(3))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,h){if(void 0===t)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";return function(e,t){for(var n in e.elements)e.elements.hasOwnProperty(n)&&(t.elements[n]=e.elements[n]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}(f=(0,l.default)(t,h),function(l){var f=function(e){if(void 0===e.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var n=e.elements.x00020010;return c.readFixedString(t,n.dataOffset,n.length)}(l),p=function(e){return"1.2.840.10008.1.2"!==e}(f),m=function(o,l){if("1.2.840.10008.1.2.1.99"===o){if(h&&h.inflater){var c=h.inflater(t,l);return new a.default(s.default,c,0)}if(void 0!==e&&this.module!==e){var d=n(68),f=(0,u.default)(t,l,t.length-l),p=d.inflateRawSync(f),m=(0,r.default)(t,p.length+l);return t.copy(m,0,0,l),p.copy(m,l),new a.default(s.default,m,0)}if("undefined"!=typeof pako){var g=t.slice(l),v=pako.inflateRaw(g),y=(0,r.default)(t,v.length+l);return y.set(t.slice(0,l),0),y.set(v,l),new a.default(s.default,y,0)}throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax"}return new a.default("1.2.840.10008.1.2.2"===o?i.default:s.default,t,l)}(f,l.position),g=new o.default(m.byteArrayParser,m.byteArray,{});g.warnings=m.warnings;try{p?d.parseDicomDataSetExplicit(g,m,m.byteArray.length,h):d.parseDicomDataSetImplicit(g,m,m.byteArray.length,h)}catch(e){throw{exception:e,dataSet:g}}return g}(f));var f};var r=f(n(23)),i=f(n(38)),a=f(n(12)),o=f(n(7)),s=f(n(22)),l=f(n(37)),u=f(n(11)),c=h(n(14)),d=h(n(16));function h(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function f(e){return e&&e.__esModule?e:{default:e}}}).call(this,n(69)(e))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="1.8.5"},function(e,t){t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,l=(1<<s)-1,u=l>>1,c=-7,d=n?i-1:0,h=n?-1:1,f=e[t+d];for(d+=h,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+e[t+d],d+=h,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=r;c>0;o=256*o+e[t+d],d+=h,c-=8);if(0===a)a=1-u;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),a-=u}return(f?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,l,u=8*a-i-1,c=(1<<u)-1,d=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:a-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+d>=1?h/l:h*Math.pow(2,1-d))*l>=2&&(o++,l/=2),o+d>=c?(s=0,o=c):o+d>=1?(s=(t*l-1)*Math.pow(2,i),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[n+f]=255&o,f+=p,o/=256,u-=8);e[n+f-p]|=128*m}},function(e,t,n){"use strict";t.byteLength=function(e){return 3*e.length/4-u(e)},t.toByteArray=function(e){var t,n,r,o,s,l=e.length;o=u(e),s=new a(3*l/4-o),n=o>0?l-4:l;var c=0;for(t=0;t<n;t+=4)r=i[e.charCodeAt(t)]<<18|i[e.charCodeAt(t+1)]<<12|i[e.charCodeAt(t+2)]<<6|i[e.charCodeAt(t+3)],s[c++]=r>>16&255,s[c++]=r>>8&255,s[c++]=255&r;return 2===o?(r=i[e.charCodeAt(t)]<<2|i[e.charCodeAt(t+1)]>>4,s[c++]=255&r):1===o&&(r=i[e.charCodeAt(t)]<<10|i[e.charCodeAt(t+1)]<<4|i[e.charCodeAt(t+2)]>>2,s[c++]=r>>8&255,s[c++]=255&r),s},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a="",o=[],s=0,l=n-i;s<l;s+=16383)o.push(c(e,s,s+16383>l?l:s+16383));return 1===i?(a+=r[(t=e[n-1])>>2],a+=r[t<<4&63],a+="=="):2===i&&(a+=r[(t=(e[n-2]<<8)+e[n-1])>>10],a+=r[t>>4&63],a+=r[t<<2&63],a+="="),o.push(a),o.join("")};for(var r=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=o.length;s<l;++s)r[s]=o[s],i[o.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function c(e,t,n){for(var i,a=[],o=t;o<n;o+=3)a.push(r[(i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]))>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t,n){"use strict";function r(e,t){return 255===e.byteArray[t]&&217===e.byteArray[t+1]}function i(e,t,n){var i=t.fragments[n];return!(!r(e,i.position+i.length-2)&&!r(e,i.position+i.length-3))}function a(e,t,n){for(var r=n;r<t.fragments.length;r++)if(i(e,t,r))return r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===t)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==t.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==t.encapsulatedPixelData)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n&&n.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";n=n||t.fragments;for(var r=[],i=0;;){r.push(t.fragments[i].offset);var o=a(e,t,i);if(void 0===o||o===t.fragments.length-1)return r;i=o+1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,n){if(void 0===t)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";n=n||{omitPrivateAttibutes:!0,maxElementLength:128};var r={};for(var o in t.elements){var s=t.elements[o];if(!0!==n.omitPrivateAttibutes||!a.isPrivateTag(o))if(s.items){for(var l=[],u=0;u<s.items.length;u++)l.push(e(s.items[u].dataSet,n));r[o]=l}else{var c;c=void 0,s.length<n.maxElementLength&&(c=(0,i.default)(t,s)),r[o]=void 0!==c?c:{dataOffset:s.dataOffset,length:s.length}}}return r};var r,i=(r=n(43))&&r.__esModule?r:{default:r},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e&&8===e.length){var n=parseInt(e.substring(0,4),10),r=parseInt(e.substring(4,6),10),i=parseInt(e.substring(6,8),10);if(t&&!0!==function(e,t,n){return!isNaN(n)&&t>0&&t<=12&&e>0&&e<=function(e,t){switch(e){case 2:return t%4==0&&t%100||t%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(t,n)}(i,r,n))throw"invalid DA '"+e+"'";return{year:n,month:r,day:i}}if(t)throw"invalid DA '"+e+"'"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.length>=2){var n=parseInt(e.substring(0,2),10),r=e.length>=4?parseInt(e.substring(2,4),10):void 0,i=e.length>=6?parseInt(e.substring(4,6),10):void 0,a=e.length>=8?e.substring(7,13):void 0,o=a?parseInt(a,10)*Math.pow(10,6-a.length):void 0;if(t&&(isNaN(n)||void 0!==r&&isNaN(r)||void 0!==i&&isNaN(i)||void 0!==o&&isNaN(o)||n<0||n>23||r&&(r<0||r>59)||i&&(i<0||i>59)||o&&(o<0||o>999999)))throw"invalid TM '"+e+"'";return{hours:n,minutes:r,seconds:i,fractionalSeconds:o}}if(t)throw"invalid TM '"+e+"'"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createJPEGBasicOffsetTable=t.explicitDataSetToJS=t.explicitElementToString=t.parseDA=t.parseTM=t.parsePN=t.isPrivateTag=t.isStringVr=void 0;var r=n(17),i=u(n(77)),a=u(n(76)),o=u(n(43)),s=u(n(75)),l=u(n(74));function u(e){return e&&e.__esModule?e:{default:e}}t.isStringVr=r.isStringVr,t.isPrivateTag=r.isPrivateTag,t.parsePN=r.parsePN,t.parseTM=i.default,t.parseDA=a.default,t.explicitElementToString=o.default,t.explicitDataSetToJS=s.default,t.createJPEGBasicOffsetTable=l.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readTag=t.readSequenceItem=t.readSequenceItemsImplicit=t.readSequenceItemsExplicit=t.readPart10Header=t.readEncapsulatedPixelDataFromFragments=t.readEncapsulatedPixelData=t.readEncapsulatedImageFrame=t.readDicomElementImplicit=t.readDicomElementExplicit=t.parseDicom=t.littleEndianByteArrayParser=t.findItemDelimitationItemAndSetElementLength=t.findEndOfEncapsulatedElement=t.findAndSetUNElementLength=t.DataSet=t.sharedCopy=t.ByteStream=t.bigEndianByteArrayParser=t.version=t.alloc=t.readFixedString=t.parseDicomDataSetImplicit=t.parseDicomDataSetExplicit=t.createJPEGBasicOffsetTable=t.explicitDataSetToJS=t.explicitElementToString=t.parseDA=t.parseTM=t.parsePN=t.isPrivateTag=t.isStringVr=void 0;var r=n(78),i=n(16),a=n(14),o=C(n(23)),s=C(n(71)),l=C(n(38)),u=C(n(12)),c=C(n(11)),d=C(n(7)),h=C(n(41)),f=C(n(42)),p=C(n(24)),m=C(n(22)),g=C(n(70)),v=C(n(15)),y=C(n(25)),b=C(n(27)),x=C(n(44)),w=C(n(18)),_=C(n(37)),S=C(n(40)),E=C(n(26)),T=C(n(13)),k=C(n(4));function C(e){return e&&e.__esModule?e:{default:e}}var I={isStringVr:r.isStringVr,isPrivateTag:r.isPrivateTag,parsePN:r.parsePN,parseTM:r.parseTM,parseDA:r.parseDA,explicitElementToString:r.explicitElementToString,explicitDataSetToJS:r.explicitDataSetToJS,createJPEGBasicOffsetTable:r.createJPEGBasicOffsetTable,parseDicomDataSetExplicit:i.parseDicomDataSetExplicit,parseDicomDataSetImplicit:i.parseDicomDataSetImplicit,readFixedString:a.readFixedString,alloc:o.default,version:s.default,bigEndianByteArrayParser:l.default,ByteStream:u.default,sharedCopy:c.default,DataSet:d.default,findAndSetUNElementLength:h.default,findEndOfEncapsulatedElement:f.default,findItemDelimitationItemAndSetElementLength:p.default,littleEndianByteArrayParser:m.default,parseDicom:g.default,readDicomElementExplicit:v.default,readDicomElementImplicit:y.default,readEncapsulatedImageFrame:b.default,readEncapsulatedPixelData:x.default,readEncapsulatedPixelDataFromFragments:w.default,readPart10Header:_.default,readSequenceItemsExplicit:S.default,readSequenceItemsImplicit:E.default,readSequenceItem:T.default,readTag:k.default};t.isStringVr=r.isStringVr,t.isPrivateTag=r.isPrivateTag,t.parsePN=r.parsePN,t.parseTM=r.parseTM,t.parseDA=r.parseDA,t.explicitElementToString=r.explicitElementToString,t.explicitDataSetToJS=r.explicitDataSetToJS,t.createJPEGBasicOffsetTable=r.createJPEGBasicOffsetTable,t.parseDicomDataSetExplicit=i.parseDicomDataSetExplicit,t.parseDicomDataSetImplicit=i.parseDicomDataSetImplicit,t.readFixedString=a.readFixedString,t.alloc=o.default,t.version=s.default,t.bigEndianByteArrayParser=l.default,t.ByteStream=u.default,t.sharedCopy=c.default,t.DataSet=d.default,t.findAndSetUNElementLength=h.default,t.findEndOfEncapsulatedElement=f.default,t.findItemDelimitationItemAndSetElementLength=p.default,t.littleEndianByteArrayParser=m.default,t.parseDicom=g.default,t.readDicomElementExplicit=v.default,t.readDicomElementImplicit=y.default,t.readEncapsulatedImageFrame=b.default,t.readEncapsulatedPixelData=x.default,t.readEncapsulatedPixelDataFromFragments=w.default,t.readPart10Header=_.default,t.readSequenceItemsExplicit=S.default,t.readSequenceItemsImplicit=E.default,t.readSequenceItem=T.default,t.readTag=k.default,t.default=I}])},uDiL:function(e,t,n){(function(e){var r;!function(e,i,a){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function l(e,t){var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(t,n,t,i))||(i.exports=r):this.xor128=l}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},v6YA:function(e,t,n){const r=n("MpxT"),i=n("8GxW");e.exports=(e,t,n)=>{const a=[];let o=null,s=null;const l=e.sort((e,t)=>i(e,t,n));for(const i of l)r(i,t,n)?(s=i,o||(o=i)):(s&&a.push([o,s]),s=null,o=null);o&&a.push([o,null]);const u=[];for(const[r,i]of a)u.push(r===i?r:i||r!==l[0]?i?r===l[0]?"<="+i:`${r} - ${i}`:">="+r:"*");const c=u.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return c.length<d.length?c:t}},vwDW:function(e,t,n){const r=Symbol("SemVer ANY");class i{static get ANY(){return r}constructor(e,t){if(t=a(t),e instanceof i){if(e.loose===!!t.loose)return e;e=e.value}u("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.value=this.semver===r?"":this.operator+this.semver.version,u("comp",this)}parse(e){const t=e.match(this.options.loose?o[s.COMPARATORLOOSE]:o[s.COMPARATOR]);if(!t)throw new TypeError("Invalid comparator: "+e);this.operator=void 0!==t[1]?t[1]:"","="===this.operator&&(this.operator=""),this.semver=t[2]?new c(t[2],this.options.loose):r}toString(){return this.value}test(e){if(u("Comparator.test",e,this.options.loose),this.semver===r||e===r)return!0;if("string"==typeof e)try{e=new c(e,this.options)}catch(t){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof i))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new d(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new d(this.value,t).test(e.semver);const n=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),r=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),a=this.semver.version===e.semver.version,o=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),s=l(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),u=l(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||r||a&&o||s||u}}e.exports=i;const a=n("4S+G"),{re:o,t:s}=n("IsDc"),l=n("VMJL"),u=n("DXxi"),c=n("3wIk"),d=n("ex/Z")},xfvg:function(e,t,n){const r=n("8GxW");e.exports=(e,t,n)=>0===r(e,t,n)},yLV6:function(e,t,n){var r;!function(i,a,o,s){"use strict";var l,u=["","webkit","Moz","MS","ms","o"],c=a.createElement("div"),d=Math.round,h=Math.abs,f=Date.now;function p(e,t,n){return setTimeout(w(e,n),t)}function m(e,t,n){return!!Array.isArray(e)&&(g(e,n[t],n),!0)}function g(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==s)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function v(e,t,n){var r="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=i.console&&(i.console.warn||i.console.log);return a&&a.call(i.console,r,n),e.apply(this,arguments)}}l="function"!=typeof Object.assign?function(e){if(e===s||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==s&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}:Object.assign;var y=v((function(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;)(!n||n&&e[r[i]]===s)&&(e[r[i]]=t[r[i]]),i++;return e}),"extend","Use `assign`."),b=v((function(e,t){return y(e,t,!0)}),"merge","Use `assign`.");function x(e,t,n){var r,i=t.prototype;(r=e.prototype=Object.create(i)).constructor=e,r._super=i,n&&l(r,n)}function w(e,t){return function(){return e.apply(t,arguments)}}function _(e,t){return"function"==typeof e?e.apply(t&&t[0]||s,t):e}function S(e,t){return e===s?t:e}function E(e,t,n){g(I(t),(function(t){e.addEventListener(t,n,!1)}))}function T(e,t,n){g(I(t),(function(t){e.removeEventListener(t,n,!1)}))}function k(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function C(e,t){return e.indexOf(t)>-1}function I(e){return e.trim().split(/\s+/g)}function O(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function A(e){return Array.prototype.slice.call(e,0)}function D(e,t,n){for(var r=[],i=[],a=0;a<e.length;){var o=t?e[a][t]:e[a];O(i,o)<0&&r.push(e[a]),i[a]=o,a++}return n&&(r=t?r.sort((function(e,n){return e[t]>n[t]})):r.sort()),r}function M(e,t){for(var n,r,i=t[0].toUpperCase()+t.slice(1),a=0;a<u.length;){if((r=(n=u[a])?n+i:t)in e)return r;a++}return s}var N=1;function j(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||i}var R="ontouchstart"in i,P=M(i,"PointerEvent")!==s,F=R&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),L="touch",$="mouse",B=["x","y"],z=["clientX","clientY"];function U(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){_(e.options.enable,[e])&&n.handler(t)},this.init()}function H(e,t,n){var r=n.pointers.length,i=n.changedPointers.length,a=1&t&&r-i==0,o=12&t&&r-i==0;n.isFirst=!!a,n.isFinal=!!o,a&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,i=r.length;n.firstInput||(n.firstInput=W(t)),i>1&&!n.firstMultiple?n.firstMultiple=W(t):1===i&&(n.firstMultiple=!1);var a=n.firstInput,o=n.firstMultiple,l=o?o.center:a.center,u=t.center=V(r);t.timeStamp=f(),t.deltaTime=t.timeStamp-a.timeStamp,t.angle=X(l,u),t.distance=Y(l,u),function(e,t){var n=t.center,r=e.offsetDelta||{},i=e.prevDelta||{},a=e.prevInput||{};1!==t.eventType&&4!==a.eventType||(i=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y}),t.deltaX=i.x+(n.x-r.x),t.deltaY=i.y+(n.y-r.y)}(n,t),t.offsetDirection=G(t.deltaX,t.deltaY);var c,d,p=q(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=p.x,t.overallVelocityY=p.y,t.overallVelocity=h(p.x)>h(p.y)?p.x:p.y,t.scale=o?(c=o.pointers,Y((d=r)[0],d[1],z)/Y(c[0],c[1],z)):1,t.rotation=o?function(e,t){return X(t[1],t[0],z)+X(e[1],e[0],z)}(o.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,r,i,a,o=e.lastInterval||t,l=t.timeStamp-o.timeStamp;if(8!=t.eventType&&(l>25||o.velocity===s)){var u=t.deltaX-o.deltaX,c=t.deltaY-o.deltaY,d=q(l,u,c);r=d.x,i=d.y,n=h(d.x)>h(d.y)?d.x:d.y,a=G(u,c),e.lastInterval=t}else n=o.velocity,r=o.velocityX,i=o.velocityY,a=o.direction;t.velocity=n,t.velocityX=r,t.velocityY=i,t.direction=a}(n,t);var m=e.element;k(t.srcEvent.target,m)&&(m=t.srcEvent.target),t.target=m}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function W(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:d(e.pointers[n].clientX),clientY:d(e.pointers[n].clientY)},n++;return{timeStamp:f(),pointers:t,center:V(t),deltaX:e.deltaX,deltaY:e.deltaY}}function V(e){var t=e.length;if(1===t)return{x:d(e[0].clientX),y:d(e[0].clientY)};for(var n=0,r=0,i=0;i<t;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:d(n/t),y:d(r/t)}}function q(e,t,n){return{x:t/e||0,y:n/e||0}}function G(e,t){return e===t?1:h(e)>=h(t)?e<0?2:4:t<0?8:16}function Y(e,t,n){n||(n=B);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.sqrt(r*r+i*i)}function X(e,t,n){return n||(n=B),180*Math.atan2(t[n[1]]-e[n[1]],t[n[0]]-e[n[0]])/Math.PI}U.prototype={handler:function(){},init:function(){this.evEl&&E(this.element,this.evEl,this.domHandler),this.evTarget&&E(this.target,this.evTarget,this.domHandler),this.evWin&&E(j(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(j(this.element),this.evWin,this.domHandler)}};var K={mousedown:1,mousemove:2,mouseup:4},Z="mousedown",J="mousemove mouseup";function Q(){this.evEl=Z,this.evWin=J,this.pressed=!1,U.apply(this,arguments)}x(Q,U,{handler:function(e){var t=K[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:$,srcEvent:e}))}});var ee={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},te={2:L,3:"pen",4:$,5:"kinect"},ne="pointerdown",re="pointermove pointerup pointercancel";function ie(){this.evEl=ne,this.evWin=re,U.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}i.MSPointerEvent&&!i.PointerEvent&&(ne="MSPointerDown",re="MSPointerMove MSPointerUp MSPointerCancel"),x(ie,U,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),i=ee[r],a=te[e.pointerType]||e.pointerType,o=a==L,s=O(t,e.pointerId,"pointerId");1&i&&(0===e.button||o)?s<0&&(t.push(e),s=t.length-1):12&i&&(n=!0),s<0||(t[s]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:a,srcEvent:e}),n&&t.splice(s,1))}});var ae={touchstart:1,touchmove:2,touchend:4,touchcancel:8},oe="touchstart",se="touchstart touchmove touchend touchcancel";function le(){this.evTarget=oe,this.evWin=se,this.started=!1,U.apply(this,arguments)}function ue(e,t){var n=A(e.touches),r=A(e.changedTouches);return 12&t&&(n=D(n.concat(r),"identifier",!0)),[n,r]}x(le,U,{handler:function(e){var t=ae[e.type];if(1===t&&(this.started=!0),this.started){var n=ue.call(this,e,t);12&t&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:L,srcEvent:e})}}});var ce={touchstart:1,touchmove:2,touchend:4,touchcancel:8},de="touchstart touchmove touchend touchcancel";function he(){this.evTarget=de,this.targetIds={},U.apply(this,arguments)}function fe(e,t){var n=A(e.touches),r=this.targetIds;if(3&t&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,a,o=A(e.changedTouches),s=[],l=this.target;if(a=n.filter((function(e){return k(e.target,l)})),1===t)for(i=0;i<a.length;)r[a[i].identifier]=!0,i++;for(i=0;i<o.length;)r[o[i].identifier]&&s.push(o[i]),12&t&&delete r[o[i].identifier],i++;return s.length?[D(a.concat(s),"identifier",!0),s]:void 0}function pe(){U.apply(this,arguments);var e=w(this.handler,this);this.touch=new he(this.manager,e),this.mouse=new Q(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function me(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,ge.call(this,t)):12&e&&ge.call(this,t)}function ge(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)}),2500)}}function ve(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],a=Math.abs(t-i.x),o=Math.abs(n-i.y);if(a<=25&&o<=25)return!0}return!1}x(he,U,{handler:function(e){var t=ce[e.type],n=fe.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:L,srcEvent:e})}}),x(pe,U,{handler:function(e,t,n){var r=n.pointerType==$;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(n.pointerType==L)me.call(this,t,n);else if(r&&ve.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ye=M(c.style,"touchAction"),be=ye!==s,xe="compute",we="auto",_e="manipulation",Se="none",Ee="pan-x",Te="pan-y",ke=function(){if(!be)return!1;var e={},t=i.CSS&&i.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){e[n]=!t||i.CSS.supports("touch-action",n)})),e}();function Ce(e,t){this.manager=e,this.set(t)}Ce.prototype={set:function(e){e==xe&&(e=this.compute()),be&&this.manager.element.style&&ke[e]&&(this.manager.element.style[ye]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return g(this.manager.recognizers,(function(t){_(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(C(e,Se))return Se;var t=C(e,Ee),n=C(e,Te);return t&&n?Se:t||n?t?Ee:Te:C(e,_e)?_e:we}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,i=C(r,Se)&&!ke.none,a=C(r,Te)&&!ke["pan-y"],o=C(r,Ee)&&!ke["pan-x"];if(i&&1===e.pointers.length&&e.distance<2&&e.deltaTime<250)return;if(!o||!a)return i||a&&6&n||o&&24&n?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Ie=32;function Oe(e){this.options=l({},this.defaults,e||{}),this.id=N++,this.manager=null,this.options.enable=S(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Ae(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function De(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function Me(e,t){var n=t.manager;return n?n.get(e):e}function Ne(){Oe.apply(this,arguments)}function je(){Ne.apply(this,arguments),this.pX=null,this.pY=null}function Re(){Ne.apply(this,arguments)}function Pe(){Oe.apply(this,arguments),this._timer=null,this._input=null}function Fe(){Ne.apply(this,arguments)}function Le(){Ne.apply(this,arguments)}function $e(){Oe.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Be(e,t){return(t=t||{}).recognizers=S(t.recognizers,Be.defaults.preset),new ze(e,t)}function ze(e,t){this.options=l({},Be.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new(this.options.inputClass||(P?ie:F?he:R?pe:Q))(this,H),this.touchAction=new Ce(this,this.options.touchAction),Ue(this,!0),g(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function Ue(e,t){var n,r=e.element;r.style&&(g(e.options.cssProps,(function(i,a){n=M(r.style,a),t?(e.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}Oe.prototype={defaults:{},set:function(e){return l(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(m(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=Me(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return m(e,"dropRecognizeWith",this)||(e=Me(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(m(e,"requireFailure",this))return this;var t=this.requireFail;return-1===O(t,e=Me(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(m(e,"dropRequireFailure",this))return this;e=Me(e,this);var t=O(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function r(n){t.manager.emit(n,e)}n<8&&r(t.options.event+Ae(n)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),n>=8&&r(t.options.event+Ae(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=Ie},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=l({},e);if(!_(this.options.enable,[this,t]))return this.reset(),void(this.state=Ie);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},x(Ne,Oe,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=6&t,i=this.attrTest(e);return r&&(8&n||!i)?16|t:r||i?4&n?8|t:2&t?4|t:2:Ie}}),x(je,Ne,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push(Te),24&e&&t.push(Ee),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,i=e.direction,a=e.deltaX,o=e.deltaY;return i&t.direction||(6&t.direction?(i=0===a?1:a<0?2:4,n=a!=this.pX,r=Math.abs(e.deltaX)):(i=0===o?1:o<0?8:16,n=o!=this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&i&t.direction},attrTest:function(e){return Ne.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=De(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),x(Re,Ne,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Se]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){1!==e.scale&&(e.additionalEvent=this.options.event+(e.scale<1?"in":"out")),this._super.emit.call(this,e)}}),x(Pe,Oe,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[we]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!r||!n||12&e.eventType&&!i)this.reset();else if(1&e.eventType)this.reset(),this._timer=p((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return Ie},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=f(),this.manager.emit(this.options.event,this._input)))}}),x(Fe,Ne,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Se]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),x(Le,Ne,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return je.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return 30&n?t=e.overallVelocity:6&n?t=e.overallVelocityX:24&n&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&h(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=De(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),x($e,Oe,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[_e]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=e.eventType)return this.failTimeout();var a=!this.pTime||e.timeStamp-this.pTime<t.interval,o=!this.pCenter||Y(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,o&&a?this.count+=1:this.count=1,this._input=e,0==this.count%t.taps)return this.hasRequireFailures()?(this._timer=p((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return Ie},failTimeout:function(){return this._timer=p((function(){this.state=Ie}),this.options.interval,this),Ie},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Be.VERSION="2.0.7",Be.defaults={domEvents:!1,touchAction:xe,enable:!0,inputTarget:null,inputClass:null,preset:[[Fe,{enable:!1}],[Re,{enable:!1},["rotate"]],[Le,{direction:6}],[je,{direction:6},["swipe"]],[$e],[$e,{event:"doubletap",taps:2},["tap"]],[Pe]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},ze.prototype={set:function(e){return l(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var r=this.recognizers,i=t.curRecognizer;(!i||i&&8&i.state)&&(i=t.curRecognizer=null);for(var a=0;a<r.length;)n=r[a],2===t.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(e),!i&&14&n.state&&(i=t.curRecognizer=n),a++}},get:function(e){if(e instanceof Oe)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(m(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(m(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=O(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==s&&t!==s){var n=this.handlers;return g(I(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(e!==s){var n=this.handlers;return g(I(e),(function(e){t?n[e]&&n[e].splice(O(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var n=a.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](t),r++}},destroy:function(){this.element&&Ue(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l(Be,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Ie,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:ze,Input:U,TouchAction:Ce,TouchInput:he,MouseInput:Q,PointerEventInput:ie,TouchMouseInput:pe,SingleTouchInput:le,Recognizer:Oe,AttrRecognizer:Ne,Tap:$e,Pan:je,Swipe:Le,Pinch:Re,Rotate:Fe,Press:Pe,on:E,off:T,each:g,merge:b,extend:y,assign:l,inherit:x,bindFn:w,prefixed:M}),(void 0!==i?i:"undefined"!=typeof self?self:{}).Hammer=Be,(r=(function(){return Be}).call(t,n,t,e))===s||(e.exports=r)}(window,document)},ygsx:function(e,t,n){const r=n("3wIk"),i=n("ex/Z");e.exports=(e,t,n)=>{let a=null,o=null,s=null;try{s=new i(t,n)}catch(l){return null}return e.forEach(e=>{s.test(e)&&(a&&1!==o.compare(e)||(a=e,o=new r(a,n)))}),a}},yuCN:function(e,t,n){(function(e){var r;!function(e,i,a){function o(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],r[i]=n^=(e^=e<<13)^e<<9,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function l(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.x&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(t,n,t,i))||(i.exports=r):this.xorshift7=l}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},zUnb:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"shuffle",(function(){return tp})),n.d(r,"clamp",(function(){return np})),n.d(r,"nearestLargerEven",(function(){return rp})),n.d(r,"sum",(function(){return ip})),n.d(r,"randUniform",(function(){return ap})),n.d(r,"distSquared",(function(){return op})),n.d(r,"assert",(function(){return sp})),n.d(r,"assertShapesMatch",(function(){return lp})),n.d(r,"assertNonNull",(function(){return up})),n.d(r,"flatten",(function(){return cp})),n.d(r,"sizeFromShape",(function(){return dp})),n.d(r,"isScalarShape",(function(){return hp})),n.d(r,"arraysEqual",(function(){return fp})),n.d(r,"isInt",(function(){return pp})),n.d(r,"tanh",(function(){return mp})),n.d(r,"sizeToSquarishShape",(function(){return gp})),n.d(r,"createShuffledIndices",(function(){return vp})),n.d(r,"rightPad",(function(){return yp})),n.d(r,"repeatedTry",(function(){return bp})),n.d(r,"inferFromImplicitShape",(function(){return xp})),n.d(r,"parseAxisParam",(function(){return wp})),n.d(r,"squeezeShape",(function(){return _p})),n.d(r,"getTypedArrayFromDType",(function(){return Sp})),n.d(r,"getArrayFromDType",(function(){return Ep})),n.d(r,"checkConversionForErrors",(function(){return Tp})),n.d(r,"isValidDtype",(function(){return kp})),n.d(r,"hasEncodingLoss",(function(){return Cp})),n.d(r,"isTypedArray",(function(){return Ip})),n.d(r,"bytesPerElement",(function(){return Op})),n.d(r,"bytesFromStringArray",(function(){return Ap})),n.d(r,"isString",(function(){return Dp})),n.d(r,"isBoolean",(function(){return Mp})),n.d(r,"isNumber",(function(){return Np})),n.d(r,"inferDtype",(function(){return jp})),n.d(r,"isFunction",(function(){return Rp})),n.d(r,"nearestDivisor",(function(){return Pp})),n.d(r,"computeStrides",(function(){return Fp})),n.d(r,"toNestedArray",(function(){return Lp})),n.d(r,"makeOnesTypedArray",(function(){return $p})),n.d(r,"makeZerosTypedArray",(function(){return Bp})),n.d(r,"makeZerosNestedTypedArray",(function(){return zp})),n.d(r,"assertNonNegativeIntegerDimensions",(function(){return Up})),n.d(r,"locToIndex",(function(){return Hp})),n.d(r,"indexToLoc",(function(){return Wp})),n.d(r,"isPromise",(function(){return Vp})),n.d(r,"createScalarValue",(function(){return ry})),n.d(r,"toTypedArray",(function(){return iy})),n.d(r,"now",(function(){return ay})),n.d(r,"fetch",(function(){return oy})),n.d(r,"encodeString",(function(){return sy})),n.d(r,"decodeString",(function(){return ly}));var i={};n.r(i),n.d(i,"makeTypesMatch",(function(){return Sy})),n.d(i,"assertTypesMatch",(function(){return Ey})),n.d(i,"isTensorInList",(function(){return Ty})),n.d(i,"getTensorsInContainer",(function(){return ky}));var a={};n.r(a),n.d(a,"isMobile",(function(){return My})),n.d(a,"isBrowser",(function(){return Ny}));var o={};n.r(o),n.d(o,"copyModel",(function(){return Db})),n.d(o,"listModels",(function(){return Ob})),n.d(o,"moveModel",(function(){return Mb})),n.d(o,"removeModel",(function(){return Ab})),n.d(o,"browserFiles",(function(){return Ub})),n.d(o,"browserHTTPRequest",(function(){return Zb})),n.d(o,"concatenateArrayBuffers",(function(){return Ky})),n.d(o,"decodeWeights",(function(){return qy})),n.d(o,"encodeWeights",(function(){return Vy})),n.d(o,"fromMemory",(function(){return ex})),n.d(o,"getLoadHandlers",(function(){return ib})),n.d(o,"getModelArtifactsInfoForJSON",(function(){return Jy})),n.d(o,"getSaveHandlers",(function(){return rb})),n.d(o,"http",(function(){return Kb})),n.d(o,"isHTTPScheme",(function(){return Yb})),n.d(o,"loadWeights",(function(){return Vb})),n.d(o,"registerLoadRouter",(function(){return nb})),n.d(o,"registerSaveRouter",(function(){return tb})),n.d(o,"weightsLoaderFactory",(function(){return qb})),n.d(o,"withSaveHandler",(function(){return tx}));var s={};n.r(s),n.d(s,"confusionMatrix",(function(){return ox}));var l={};n.r(l),n.d(l,"toPixels",(function(){return ux})),n.d(l,"fromPixels",(function(){return cx}));var u={};n.r(u),n.d(u,"prepareAndValidate",(function(){return dx}));var c={};n.r(c),n.d(c,"validateUpdateShape",(function(){return hx})),n.d(c,"validateInput",(function(){return fx})),n.d(c,"calculateShapes",(function(){return px}));var d={};n.r(d),n.d(d,"assertParamsValid",(function(){return mx})),n.d(d,"maskToAxes",(function(){return gx})),n.d(d,"computeOutShape",(function(){return vx})),n.d(d,"stridesWithElidedDims",(function(){return yx})),n.d(d,"getNormalizedAxes",(function(){return wx})),n.d(d,"startIndicesWithElidedDims",(function(){return _x})),n.d(d,"stopIndicesWithElidedDims",(function(){return Sx})),n.d(d,"stridesForAxis",(function(){return Ex})),n.d(d,"startForAxis",(function(){return Tx})),n.d(d,"stopForAxis",(function(){return kx})),n.d(d,"isSliceContinous",(function(){return Cx})),n.d(d,"computeFlatOffset",(function(){return Ix})),n.d(d,"parseSliceParams",(function(){return Ox}));var h={};n.r(h),n.d(h,"Serializable",(function(){return Ax})),n.d(h,"SerializationMap",(function(){return Dx})),n.d(h,"registerClass",(function(){return Mx}));var f={};n.r(f),n.d(f,"TEST_EPSILON_FLOAT16",(function(){return Nx})),n.d(f,"expectArraysClose",(function(){return jx})),n.d(f,"testEpsilon",(function(){return Rx})),n.d(f,"expectPromiseToFail",(function(){return Fx})),n.d(f,"expectArraysEqual",(function(){return Lx})),n.d(f,"expectNumbersClose",(function(){return $x})),n.d(f,"expectValuesInRange",(function(){return zx})),n.d(f,"expectArrayBuffersEqual",(function(){return Ux}));var p={};n.r(p),n.d(p,"segOpComputeOptimalWindowSize",(function(){return vS})),n.d(p,"computeOutShape",(function(){return yS})),n.d(p,"collectGatherOpShapeInfo",(function(){return bS}));var m={};n.r(m),n.d(m,"conv2d",(function(){return YT})),n.d(m,"depthwiseConv2d",(function(){return ZT})),n.d(m,"matMul",(function(){return JT}));var g={};n.r(g),n.d(g,"axesAreInnerMostDims",(function(){return Vw})),n.d(g,"combineLocations",(function(){return qw})),n.d(g,"computeOutAndReduceShapes",(function(){return Gw})),n.d(g,"expandShapeToKeepDim",(function(){return Yw})),n.d(g,"assertAxesAreInnerMostDims",(function(){return Xw})),n.d(g,"getAxesPermutation",(function(){return Kw})),n.d(g,"getUndoAxesPermutation",(function(){return Zw})),n.d(g,"getInnerMostAxes",(function(){return Jw})),n.d(g,"getBroadcastDims",(function(){return jw})),n.d(g,"getReductionAxes",(function(){return Rw})),n.d(g,"assertAndGetBroadcastShape",(function(){return Pw})),n.d(g,"assertParamsConsistent",(function(){return S_})),n.d(g,"computeOutShape",(function(){return E_})),n.d(g,"computeDilation2DInfo",(function(){return l_})),n.d(g,"computePool2DInfo",(function(){return u_})),n.d(g,"computePool3DInfo",(function(){return c_})),n.d(g,"computeConv2DInfo",(function(){return d_})),n.d(g,"computeConv3DInfo",(function(){return h_})),n.d(g,"computeDefaultPad",(function(){return f_})),n.d(g,"tupleValuesAreOne",(function(){return y_})),n.d(g,"eitherStridesOrDilationsAreOne",(function(){return b_})),n.d(g,"convertConv2DDataFormat",(function(){return x_})),n.d(g,"getFusedDyActivation",(function(){return WT})),n.d(g,"getFusedBiasGradient",(function(){return VT})),n.d(g,"applyActivation",(function(){return qT})),n.d(g,"shouldFuse",(function(){return GT})),n.d(g,"PARALLELIZE_THRESHOLD",(function(){return mS})),n.d(g,"computeOptimalWindowSize",(function(){return gS})),n.d(g,"slice_util",(function(){return d})),n.d(g,"upcastType",(function(){return wy})),n.d(g,"getImageCenter",(function(){return Wk})),n.d(g,"getReshaped",(function(){return Vk})),n.d(g,"getPermuted",(function(){return qk})),n.d(g,"getReshapedPermuted",(function(){return Gk})),n.d(g,"getSliceBeginCoords",(function(){return Yk})),n.d(g,"getSliceSize",(function(){return Xk})),n.d(g,"prepareAndValidate",(function(){return dx})),n.d(g,"validateUpdateShape",(function(){return hx})),n.d(g,"validateInput",(function(){return fx})),n.d(g,"calculateShapes",(function(){return px})),n.d(g,"SELU_SCALEALPHA",(function(){return Kk})),n.d(g,"SELU_SCALE",(function(){return Zk})),n.d(g,"ERF_P",(function(){return Jk})),n.d(g,"ERF_A1",(function(){return Qk})),n.d(g,"ERF_A2",(function(){return eC})),n.d(g,"ERF_A3",(function(){return tC})),n.d(g,"ERF_A4",(function(){return nC})),n.d(g,"ERF_A5",(function(){return rC})),n.d(g,"warn",(function(){return iC})),n.d(g,"log",(function(){return aC})),n.d(g,"mergeRealAndImagArrays",(function(){return oC})),n.d(g,"splitRealAndImagArrays",(function(){return sC})),n.d(g,"complexWithEvenIndex",(function(){return lC})),n.d(g,"complexWithOddIndex",(function(){return uC})),n.d(g,"getComplexWithIndex",(function(){return cC})),n.d(g,"assignToTypedArray",(function(){return dC})),n.d(g,"exponents",(function(){return hC})),n.d(g,"exponent",(function(){return fC})),n.d(g,"prepareSplitSize",(function(){return ZE})),n.d(g,"segment_util",(function(){return p})),n.d(g,"castTensor",(function(){return pC})),n.d(g,"reshapeTensor",(function(){return mC})),n.d(g,"linspaceImpl",(function(){return gC}));var v={};n.r(v),n.d(v,"nonMaxSuppressionV3Impl",(function(){return ck})),n.d(v,"nonMaxSuppressionV4Impl",(function(){return dk})),n.d(v,"nonMaxSuppressionV5Impl",(function(){return hk})),n.d(v,"split",(function(){return vC})),n.d(v,"tile",(function(){return yC})),n.d(v,"topkImpl",(function(){return bC})),n.d(v,"whereImpl",(function(){return gT}));var y={};n.r(y),n.d(y,"maxNorm",(function(){return uO})),n.d(y,"unitNorm",(function(){return cO})),n.d(y,"nonNeg",(function(){return dO})),n.d(y,"minMaxNorm",(function(){return hO}));var b={};n.r(b),n.d(b,"zeros",(function(){return gA})),n.d(b,"ones",(function(){return vA})),n.d(b,"constant",(function(){return yA})),n.d(b,"randomUniform",(function(){return bA})),n.d(b,"randomNormal",(function(){return xA})),n.d(b,"truncatedNormal",(function(){return wA})),n.d(b,"identity",(function(){return _A})),n.d(b,"varianceScaling",(function(){return SA})),n.d(b,"glorotUniform",(function(){return EA})),n.d(b,"glorotNormal",(function(){return TA})),n.d(b,"heNormal",(function(){return kA})),n.d(b,"heUniform",(function(){return CA})),n.d(b,"leCunNormal",(function(){return IA})),n.d(b,"leCunUniform",(function(){return OA})),n.d(b,"orthogonal",(function(){return AA}));var x={};n.r(x),n.d(x,"inputLayer",(function(){return gj})),n.d(x,"elu",(function(){return vj})),n.d(x,"reLU",(function(){return yj})),n.d(x,"leakyReLU",(function(){return bj})),n.d(x,"prelu",(function(){return xj})),n.d(x,"softmax",(function(){return wj})),n.d(x,"thresholdedReLU",(function(){return _j})),n.d(x,"conv1d",(function(){return Sj})),n.d(x,"conv2d",(function(){return Ej})),n.d(x,"conv2dTranspose",(function(){return Tj})),n.d(x,"conv3d",(function(){return kj})),n.d(x,"separableConv2d",(function(){return Cj})),n.d(x,"cropping2D",(function(){return Ij})),n.d(x,"upSampling2d",(function(){return Oj})),n.d(x,"depthwiseConv2d",(function(){return Aj})),n.d(x,"activation",(function(){return Dj})),n.d(x,"dense",(function(){return Mj})),n.d(x,"dropout",(function(){return Nj})),n.d(x,"spatialDropout1d",(function(){return jj})),n.d(x,"flatten",(function(){return Rj})),n.d(x,"repeatVector",(function(){return Pj})),n.d(x,"reshape",(function(){return Fj})),n.d(x,"permute",(function(){return Lj})),n.d(x,"embedding",(function(){return $j})),n.d(x,"add",(function(){return Bj})),n.d(x,"average",(function(){return zj})),n.d(x,"concatenate",(function(){return Uj})),n.d(x,"maximum",(function(){return Hj})),n.d(x,"minimum",(function(){return Wj})),n.d(x,"multiply",(function(){return Vj})),n.d(x,"dot",(function(){return qj})),n.d(x,"batchNormalization",(function(){return Gj})),n.d(x,"layerNormalization",(function(){return Yj})),n.d(x,"zeroPadding2d",(function(){return Xj})),n.d(x,"averagePooling1d",(function(){return Kj})),n.d(x,"avgPool1d",(function(){return Zj})),n.d(x,"avgPooling1d",(function(){return Jj})),n.d(x,"averagePooling2d",(function(){return Qj})),n.d(x,"avgPool2d",(function(){return eR})),n.d(x,"avgPooling2d",(function(){return tR})),n.d(x,"averagePooling3d",(function(){return nR})),n.d(x,"avgPool3d",(function(){return rR})),n.d(x,"avgPooling3d",(function(){return iR})),n.d(x,"globalAveragePooling1d",(function(){return aR})),n.d(x,"globalAveragePooling2d",(function(){return oR})),n.d(x,"globalMaxPooling1d",(function(){return sR})),n.d(x,"globalMaxPooling2d",(function(){return lR})),n.d(x,"maxPooling1d",(function(){return uR})),n.d(x,"maxPooling2d",(function(){return cR})),n.d(x,"maxPooling3d",(function(){return dR})),n.d(x,"gru",(function(){return hR})),n.d(x,"gruCell",(function(){return fR})),n.d(x,"lstm",(function(){return pR})),n.d(x,"lstmCell",(function(){return mR})),n.d(x,"simpleRNN",(function(){return gR})),n.d(x,"simpleRNNCell",(function(){return vR})),n.d(x,"convLstm2d",(function(){return yR})),n.d(x,"convLstm2dCell",(function(){return bR})),n.d(x,"rnn",(function(){return xR})),n.d(x,"stackedRNNCells",(function(){return wR})),n.d(x,"bidirectional",(function(){return _R})),n.d(x,"timeDistributed",(function(){return SR})),n.d(x,"globalMaxPool1d",(function(){return ER})),n.d(x,"globalMaxPool2d",(function(){return TR})),n.d(x,"maxPool1d",(function(){return kR})),n.d(x,"maxPool2d",(function(){return CR})),n.d(x,"Layer",(function(){return YA})),n.d(x,"RNN",(function(){return dN})),n.d(x,"RNNCell",(function(){return hN})),n.d(x,"input",(function(){return pM})),n.d(x,"gaussianNoise",(function(){return IR})),n.d(x,"gaussianDropout",(function(){return OR})),n.d(x,"alphaDropout",(function(){return AR})),n.d(x,"masking",(function(){return DR}));var w={};n.r(w),n.d(w,"binaryAccuracy",(function(){return MR})),n.d(w,"binaryCrossentropy",(function(){return NR})),n.d(w,"sparseCategoricalAccuracy",(function(){return jR})),n.d(w,"categoricalAccuracy",(function(){return RR})),n.d(w,"categoricalCrossentropy",(function(){return PR})),n.d(w,"precision",(function(){return FR})),n.d(w,"recall",(function(){return LR})),n.d(w,"cosineProximity",(function(){return $R})),n.d(w,"meanAbsoluteError",(function(){return BR})),n.d(w,"meanAbsolutePercentageError",(function(){return zR})),n.d(w,"MAPE",(function(){return UR})),n.d(w,"mape",(function(){return HR})),n.d(w,"meanSquaredError",(function(){return WR})),n.d(w,"MSE",(function(){return VR})),n.d(w,"mse",(function(){return qR}));var _={};n.r(_),n.d(_,"modelFromJSON",(function(){return uM}));var S={};n.r(S),n.d(S,"l1l2",(function(){return GR})),n.d(S,"l1",(function(){return YR})),n.d(S,"l2",(function(){return XR}));var E={};n.r(E),n.d(E,"json",(function(){return pP}));var T={};n.r(T),n.d(T,"json",(function(){return mP}));var k={};n.r(k),n.d(k,"json",(function(){return gP}));var C={};n.r(C),n.d(C,"json",(function(){return vP}));var I={};n.r(I),n.d(I,"json",(function(){return yP}));var O={};n.r(O),n.d(O,"json",(function(){return bP}));var A={};n.r(A),n.d(A,"json",(function(){return xP}));var D={};n.r(D),n.d(D,"json",(function(){return wP}));var M={};n.r(M),n.d(M,"json",(function(){return _P}));var N={};n.r(N),n.d(N,"json",(function(){return SP}));var j={};n.r(j),n.d(j,"json",(function(){return EP}));var R={};n.r(R),n.d(R,"json",(function(){return TP}));var P={};n.r(P),n.d(P,"json",(function(){return kP}));var F={};n.r(F),n.d(F,"json",(function(){return CP}));var L={};n.r(L),n.d(L,"json",(function(){return IP}));var $={};n.r($),n.d($,"json",(function(){return OP}));var B={};n.r(B),n.d(B,"json",(function(){return AP}));var z={};n.r(z),n.d(z,"array",(function(){return UF})),n.d(z,"Dataset",(function(){return BF})),n.d(z,"zip",(function(){return HF})),n.d(z,"CSVDataset",(function(){return JF})),n.d(z,"TextLineDataset",(function(){return VF})),n.d(z,"csv",(function(){return hL})),n.d(z,"func",(function(){return fL})),n.d(z,"generator",(function(){return pL})),n.d(z,"microphone",(function(){return gL})),n.d(z,"webcam",(function(){return mL})),n.d(z,"FileDataSource",(function(){return cL})),n.d(z,"URLDataSource",(function(){return dL})),n.d(z,"version_data",(function(){return vL}));var U={};n.r(U),n.d(U,"simpleAbsImpl",(function(){return r$})),n.d(U,"addImpl",(function(){return YL})),n.d(U,"ceilImpl",(function(){return S$})),n.d(U,"expImpl",(function(){return sB})),n.d(U,"expm1Impl",(function(){return cB})),n.d(U,"floorImpl",(function(){return OB})),n.d(U,"logImpl",(function(){return zB})),n.d(U,"maxImpl",(function(){return YB})),n.d(U,"multiplyImpl",(function(){return fB})),n.d(U,"notEqualImpl",(function(){return az})),n.d(U,"rsqrtImpl",(function(){return pz})),n.d(U,"sliceImpl",(function(){return vB})),n.d(U,"squaredDifferenceImpl",(function(){return Lz})),n.d(U,"subImpl",(function(){return xB})),n.d(U,"transposeImpl",(function(){return XB})),n.d(U,"uniqueImpl",(function(){return qz}));var H={};n.r(H),n.d(H,"AdadeltaOptimizer",(function(){return Cw})),n.d(H,"AdagradOptimizer",(function(){return Ow})),n.d(H,"AdamOptimizer",(function(){return Mw})),n.d(H,"AdamaxOptimizer",(function(){return Lw})),n.d(H,"MomentumOptimizer",(function(){return Bw})),n.d(H,"Optimizer",(function(){return kw})),n.d(H,"RMSPropOptimizer",(function(){return zw})),n.d(H,"SGDOptimizer",(function(){return $w})),n.d(H,"Tensor",(function(){return fy})),n.d(H,"TensorBuffer",(function(){return uy})),n.d(H,"Variable",(function(){return py})),n.d(H,"Rank",(function(){return my})),n.d(H,"sumOutType",(function(){return _y})),n.d(H,"upcastType",(function(){return wy})),n.d(H,"abs",(function(){return Nw})),n.d(H,"acos",(function(){return Uw})),n.d(H,"acosh",(function(){return Hw})),n.d(H,"add",(function(){return dw})),n.d(H,"addN",(function(){return Ww})),n.d(H,"all",(function(){return Qw})),n.d(H,"any",(function(){return e_})),n.d(H,"argMax",(function(){return t_})),n.d(H,"argMin",(function(){return n_})),n.d(H,"asin",(function(){return r_})),n.d(H,"asinh",(function(){return i_})),n.d(H,"atan",(function(){return a_})),n.d(H,"atan2",(function(){return o_})),n.d(H,"atanh",(function(){return s_})),n.d(H,"avgPool",(function(){return w_})),n.d(H,"avgPool3d",(function(){return __})),n.d(H,"basicLSTMCell",(function(){return O_})),n.d(H,"batchToSpaceND",(function(){return A_})),n.d(H,"batchNorm",(function(){return M_})),n.d(H,"batchNorm2d",(function(){return N_})),n.d(H,"batchNorm3d",(function(){return j_})),n.d(H,"batchNorm4d",(function(){return R_})),n.d(H,"broadcastTo",(function(){return P_})),n.d(H,"buffer",(function(){return Rb})),n.d(H,"cast",(function(){return Pb})),n.d(H,"ceil",(function(){return F_})),n.d(H,"clipByValue",(function(){return L_})),n.d(H,"clone",(function(){return Fb})),n.d(H,"complex",(function(){return zy})),n.d(H,"concat",(function(){return T_})),n.d(H,"concat1d",(function(){return $_})),n.d(H,"concat2d",(function(){return B_})),n.d(H,"concat3d",(function(){return z_})),n.d(H,"concat4d",(function(){return U_})),n.d(H,"conv1d",(function(){return W_})),n.d(H,"conv2d",(function(){return H_})),n.d(H,"conv2dTranspose",(function(){return q_})),n.d(H,"conv3d",(function(){return G_})),n.d(H,"conv3dTranspose",(function(){return X_})),n.d(H,"cos",(function(){return K_})),n.d(H,"cosh",(function(){return Z_})),n.d(H,"cumsum",(function(){return J_})),n.d(H,"depthToSpace",(function(){return Q_})),n.d(H,"depthwiseConv2d",(function(){return eS})),n.d(H,"diag",(function(){return tS})),n.d(H,"dilation2d",(function(){return nS})),n.d(H,"div",(function(){return fw})),n.d(H,"divNoNan",(function(){return aS})),n.d(H,"dot",(function(){return oS})),n.d(H,"elu",(function(){return sS})),n.d(H,"equal",(function(){return rS})),n.d(H,"erf",(function(){return lS})),n.d(H,"exp",(function(){return uS})),n.d(H,"expandDims",(function(){return cS})),n.d(H,"expm1",(function(){return dS})),n.d(H,"eye",(function(){return fS})),n.d(H,"fill",(function(){return Iw})),n.d(H,"floor",(function(){return pS})),n.d(H,"floorDiv",(function(){return hw})),n.d(H,"gather",(function(){return xS})),n.d(H,"greater",(function(){return wS})),n.d(H,"greaterEqual",(function(){return _S})),n.d(H,"imag",(function(){return SS})),n.d(H,"isFinite",(function(){return ES})),n.d(H,"isInf",(function(){return TS})),n.d(H,"isNaN",(function(){return kS})),n.d(H,"leakyRelu",(function(){return CS})),n.d(H,"less",(function(){return IS})),n.d(H,"lessEqual",(function(){return OS})),n.d(H,"linspace",(function(){return AS})),n.d(H,"localResponseNormalization",(function(){return DS})),n.d(H,"log",(function(){return MS})),n.d(H,"log1p",(function(){return NS})),n.d(H,"logSigmoid",(function(){return PS})),n.d(H,"logSoftmax",(function(){return $S})),n.d(H,"logSumExp",(function(){return BS})),n.d(H,"logicalAnd",(function(){return zS})),n.d(H,"logicalNot",(function(){return US})),n.d(H,"logicalOr",(function(){return HS})),n.d(H,"logicalXor",(function(){return WS})),n.d(H,"matMul",(function(){return rx})),n.d(H,"max",(function(){return FS})),n.d(H,"maxPool",(function(){return VS})),n.d(H,"maxPool3d",(function(){return qS})),n.d(H,"maxPoolWithArgmax",(function(){return GS})),n.d(H,"maximum",(function(){return Fw})),n.d(H,"mean",(function(){return KS})),n.d(H,"min",(function(){return ZS})),n.d(H,"minimum",(function(){return JS})),n.d(H,"mirrorPad",(function(){return QS})),n.d(H,"mod",(function(){return eE})),n.d(H,"moments",(function(){return tE})),n.d(H,"mul",(function(){return pw})),n.d(H,"multiRNNCell",(function(){return nE})),n.d(H,"multinomial",(function(){return rE})),n.d(H,"neg",(function(){return jS})),n.d(H,"notEqual",(function(){return iE})),n.d(H,"oneHot",(function(){return ix})),n.d(H,"ones",(function(){return XS})),n.d(H,"onesLike",(function(){return oE})),n.d(H,"outerProduct",(function(){return sE})),n.d(H,"pad",(function(){return lE})),n.d(H,"pad1d",(function(){return uE})),n.d(H,"pad2d",(function(){return cE})),n.d(H,"pad3d",(function(){return dE})),n.d(H,"pad4d",(function(){return hE})),n.d(H,"pool",(function(){return pE})),n.d(H,"pow",(function(){return Aw})),n.d(H,"prelu",(function(){return mE})),n.d(H,"print",(function(){return Lb})),n.d(H,"prod",(function(){return gE})),n.d(H,"rand",(function(){return vE})),n.d(H,"randomGamma",(function(){return _E})),n.d(H,"randomNormal",(function(){return SE})),n.d(H,"randomUniform",(function(){return EE})),n.d(H,"range",(function(){return kE})),n.d(H,"real",(function(){return aE})),n.d(H,"reciprocal",(function(){return CE})),n.d(H,"relu",(function(){return IE})),n.d(H,"relu6",(function(){return OE})),n.d(H,"reshape",(function(){return nx})),n.d(H,"reverse",(function(){return AE})),n.d(H,"reverse1d",(function(){return DE})),n.d(H,"reverse2d",(function(){return ME})),n.d(H,"reverse3d",(function(){return NE})),n.d(H,"reverse4d",(function(){return jE})),n.d(H,"round",(function(){return RE})),n.d(H,"rsqrt",(function(){return PE})),n.d(H,"scalar",(function(){return Tw})),n.d(H,"selu",(function(){return FE})),n.d(H,"separableConv2d",(function(){return LE})),n.d(H,"setdiff1dAsync",(function(){return $E})),n.d(H,"sigmoid",(function(){return k_})),n.d(H,"sign",(function(){return BE})),n.d(H,"sin",(function(){return zE})),n.d(H,"sinh",(function(){return UE})),n.d(H,"slice",(function(){return C_})),n.d(H,"slice1d",(function(){return HE})),n.d(H,"slice2d",(function(){return WE})),n.d(H,"slice3d",(function(){return VE})),n.d(H,"slice4d",(function(){return qE})),n.d(H,"softmax",(function(){return GE})),n.d(H,"softplus",(function(){return RS})),n.d(H,"spaceToBatchND",(function(){return fE})),n.d(H,"fft",(function(){return YE})),n.d(H,"ifft",(function(){return XE})),n.d(H,"irfft",(function(){return KE})),n.d(H,"rfft",(function(){return QE})),n.d(H,"split",(function(){return JE})),n.d(H,"sqrt",(function(){return mw})),n.d(H,"square",(function(){return gw})),n.d(H,"squaredDifference",(function(){return eT})),n.d(H,"squeeze",(function(){return tT})),n.d(H,"stack",(function(){return nT})),n.d(H,"step",(function(){return rT})),n.d(H,"stridedSlice",(function(){return iT})),n.d(H,"sub",(function(){return Dw})),n.d(H,"sum",(function(){return LS})),n.d(H,"tan",(function(){return aT})),n.d(H,"tanh",(function(){return I_})),n.d(H,"tensor",(function(){return Hy})),n.d(H,"tensor1d",(function(){return TE})),n.d(H,"tensor2d",(function(){return oT})),n.d(H,"tensor3d",(function(){return sx})),n.d(H,"tensor4d",(function(){return sT})),n.d(H,"tensor5d",(function(){return lT})),n.d(H,"tensor6d",(function(){return uT})),n.d(H,"tile",(function(){return hS})),n.d(H,"topk",(function(){return cT})),n.d(H,"truncatedNormal",(function(){return dT})),n.d(H,"unique",(function(){return hT})),n.d(H,"unsortedSegmentSum",(function(){return fT})),n.d(H,"unstack",(function(){return pT})),n.d(H,"variable",(function(){return mT})),n.d(H,"where",(function(){return iS})),n.d(H,"whereAsync",(function(){return vT})),n.d(H,"zeros",(function(){return YS})),n.d(H,"zerosLike",(function(){return vw})),n.d(H,"booleanMaskAsync",(function(){return yT})),n.d(H,"equalStrict",(function(){return bT})),n.d(H,"greaterEqualStrict",(function(){return xT})),n.d(H,"greaterStrict",(function(){return wT})),n.d(H,"lessEqualStrict",(function(){return _T})),n.d(H,"lessStrict",(function(){return ST})),n.d(H,"notEqualStrict",(function(){return ET})),n.d(H,"addStrict",(function(){return TT})),n.d(H,"divStrict",(function(){return kT})),n.d(H,"maximumStrict",(function(){return CT})),n.d(H,"minimumStrict",(function(){return IT})),n.d(H,"modStrict",(function(){return OT})),n.d(H,"mulStrict",(function(){return AT})),n.d(H,"powStrict",(function(){return DT})),n.d(H,"squaredDifferenceStrict",(function(){return MT})),n.d(H,"subStrict",(function(){return NT})),n.d(H,"transpose",(function(){return ax})),n.d(H,"norm",(function(){return jT})),n.d(H,"movingAverage",(function(){return RT})),n.d(H,"scatterND",(function(){return PT})),n.d(H,"sparseToDense",(function(){return FT})),n.d(H,"gatherND",(function(){return LT})),n.d(H,"dropout",(function(){return $T})),n.d(H,"enclosingPowerOfTwo",(function(){return BT})),n.d(H,"cosineWindow",(function(){return zT})),n.d(H,"inTopKAsync",(function(){return UT})),n.d(H,"op",(function(){return By})),n.d(H,"OP_SCOPE_SUFFIX",(function(){return $y})),n.d(H,"image",(function(){return Fk})),n.d(H,"linalg",(function(){return Lk})),n.d(H,"losses",(function(){return $k})),n.d(H,"spectral",(function(){return Rk})),n.d(H,"fused",(function(){return m})),n.d(H,"signal",(function(){return Pk})),n.d(H,"Reduction",(function(){return Tk})),n.d(H,"train",(function(){return zk})),n.d(H,"enableProdMode",(function(){return Wx})),n.d(H,"enableDebugMode",(function(){return Vx})),n.d(H,"disableDeprecationWarnings",(function(){return qx})),n.d(H,"deprecationWarn",(function(){return Gx})),n.d(H,"disposeVariables",(function(){return Yx})),n.d(H,"engine",(function(){return Xx})),n.d(H,"memory",(function(){return Kx})),n.d(H,"profile",(function(){return Zx})),n.d(H,"tidy",(function(){return Jx})),n.d(H,"dispose",(function(){return Qx})),n.d(H,"keep",(function(){return ew})),n.d(H,"time",(function(){return tw})),n.d(H,"setBackend",(function(){return nw})),n.d(H,"ready",(function(){return rw})),n.d(H,"getBackend",(function(){return iw})),n.d(H,"removeBackend",(function(){return aw})),n.d(H,"findBackend",(function(){return ow})),n.d(H,"findBackendFactory",(function(){return sw})),n.d(H,"registerBackend",(function(){return lw})),n.d(H,"backend",(function(){return uw})),n.d(H,"setPlatform",(function(){return cw})),n.d(H,"getKernel",(function(){return Uv})),n.d(H,"getGradient",(function(){return Hv})),n.d(H,"getKernelsForBackend",(function(){return Wv})),n.d(H,"registerKernel",(function(){return Vv})),n.d(H,"registerGradient",(function(){return qv})),n.d(H,"unregisterKernel",(function(){return Gv})),n.d(H,"unregisterGradient",(function(){return Yv})),n.d(H,"copyRegisteredKernels",(function(){return Xv})),n.d(H,"customGrad",(function(){return Sw})),n.d(H,"grad",(function(){return yw})),n.d(H,"grads",(function(){return bw})),n.d(H,"valueAndGrad",(function(){return xw})),n.d(H,"valueAndGrads",(function(){return ww})),n.d(H,"variableGrads",(function(){return _w})),n.d(H,"Environment",(function(){return qp})),n.d(H,"env",(function(){return Gp})),n.d(H,"ENV",(function(){return Xp})),n.d(H,"version_core",(function(){return Hx})),n.d(H,"nextFrame",(function(){return Hk})),n.d(H,"browser",(function(){return l})),n.d(H,"io",(function(){return o})),n.d(H,"math",(function(){return s})),n.d(H,"serialization",(function(){return h})),n.d(H,"test_util",(function(){return f})),n.d(H,"util",(function(){return r})),n.d(H,"backend_util",(function(){return g})),n.d(H,"tensor_util",(function(){return i})),n.d(H,"slice_util",(function(){return d})),n.d(H,"gather_util",(function(){return u})),n.d(H,"scatter_util",(function(){return c})),n.d(H,"device_util",(function(){return a})),n.d(H,"kernel_impls",(function(){return v})),n.d(H,"KernelBackend",(function(){return Qf})),n.d(H,"DataStorage",(function(){return Jf})),n.d(H,"Abs",(function(){return Jp})),n.d(H,"Acos",(function(){return Qp})),n.d(H,"Acosh",(function(){return em})),n.d(H,"Add",(function(){return tm})),n.d(H,"AddN",(function(){return nm})),n.d(H,"All",(function(){return rm})),n.d(H,"Any",(function(){return im})),n.d(H,"ArgMax",(function(){return am})),n.d(H,"ArgMin",(function(){return om})),n.d(H,"Asin",(function(){return sm})),n.d(H,"Asinh",(function(){return lm})),n.d(H,"Atan",(function(){return um})),n.d(H,"Atanh",(function(){return cm})),n.d(H,"Atan2",(function(){return dm})),n.d(H,"AvgPool",(function(){return hm})),n.d(H,"AvgPoolBackprop",(function(){return fm})),n.d(H,"AvgPool3D",(function(){return pm})),n.d(H,"AvgPool3DBackprop",(function(){return mm})),n.d(H,"BatchMatMul",(function(){return gm})),n.d(H,"BatchToSpaceND",(function(){return vm})),n.d(H,"BroadcastTo",(function(){return ym})),n.d(H,"Cast",(function(){return bm})),n.d(H,"Ceil",(function(){return xm})),n.d(H,"ClipByValue",(function(){return wm})),n.d(H,"Complex",(function(){return _m})),n.d(H,"Concat",(function(){return Sm})),n.d(H,"Conv2D",(function(){return Em})),n.d(H,"Conv2DBackpropFilter",(function(){return Tm})),n.d(H,"Conv2DBackpropInput",(function(){return km})),n.d(H,"Conv3D",(function(){return Cm})),n.d(H,"Conv3DBackpropFilterV2",(function(){return Im})),n.d(H,"Conv3DBackpropInputV2",(function(){return Om})),n.d(H,"Cos",(function(){return Am})),n.d(H,"Cosh",(function(){return Dm})),n.d(H,"Cumsum",(function(){return Mm})),n.d(H,"CropAndResize",(function(){return Nm})),n.d(H,"DepthToSpace",(function(){return jm})),n.d(H,"DepthwiseConv2dNative",(function(){return Rm})),n.d(H,"DepthwiseConv2dNativeBackpropFilter",(function(){return Pm})),n.d(H,"DepthwiseConv2dNativeBackpropInput",(function(){return Fm})),n.d(H,"Diag",(function(){return Lm})),n.d(H,"Dilation2D",(function(){return $m})),n.d(H,"Dilation2DBackpropInput",(function(){return Bm})),n.d(H,"Dilation2DBackpropFilter",(function(){return zm})),n.d(H,"Div",(function(){return Um})),n.d(H,"Elu",(function(){return Hm})),n.d(H,"EluGrad",(function(){return Wm})),n.d(H,"Erf",(function(){return Vm})),n.d(H,"Equal",(function(){return qm})),n.d(H,"Exp",(function(){return Gm})),n.d(H,"Expm1",(function(){return Ym})),n.d(H,"FFT",(function(){return Xm})),n.d(H,"Fill",(function(){return Km})),n.d(H,"FlipLeftRight",(function(){return Zm})),n.d(H,"Floor",(function(){return Jm})),n.d(H,"FloorDiv",(function(){return Qm})),n.d(H,"FusedBatchNorm",(function(){return eg})),n.d(H,"GatherV2",(function(){return tg})),n.d(H,"GatherNd",(function(){return ng})),n.d(H,"Greater",(function(){return rg})),n.d(H,"GreaterEqual",(function(){return ig})),n.d(H,"Identity",(function(){return ag})),n.d(H,"IFFT",(function(){return og})),n.d(H,"Imag",(function(){return sg})),n.d(H,"IsFinite",(function(){return lg})),n.d(H,"IsInf",(function(){return ug})),n.d(H,"IsNan",(function(){return cg})),n.d(H,"Less",(function(){return dg})),n.d(H,"LessEqual",(function(){return hg})),n.d(H,"LinSpace",(function(){return fg})),n.d(H,"Log",(function(){return pg})),n.d(H,"Log1p",(function(){return mg})),n.d(H,"LogicalAnd",(function(){return gg})),n.d(H,"LogicalNot",(function(){return vg})),n.d(H,"LogicalOr",(function(){return yg})),n.d(H,"LogSoftmax",(function(){return bg})),n.d(H,"LRN",(function(){return xg})),n.d(H,"LRNBackprop",(function(){return wg})),n.d(H,"Max",(function(){return _g})),n.d(H,"Maximum",(function(){return Sg})),n.d(H,"MaxPool",(function(){return Eg})),n.d(H,"MaxPoolBackprop",(function(){return Tg})),n.d(H,"MaxPool3D",(function(){return kg})),n.d(H,"MaxPool3DBackprop",(function(){return Cg})),n.d(H,"MaxPoolWithArgmax",(function(){return Ig})),n.d(H,"Mean",(function(){return Og})),n.d(H,"Min",(function(){return Ag})),n.d(H,"Minimum",(function(){return Dg})),n.d(H,"MirrorPad",(function(){return Mg})),n.d(H,"Mod",(function(){return Ng})),n.d(H,"Multiply",(function(){return jg})),n.d(H,"Negate",(function(){return Rg})),n.d(H,"NotEqual",(function(){return Pg})),n.d(H,"NonMaxSuppressionV3",(function(){return Fg})),n.d(H,"NonMaxSuppressionV4",(function(){return Lg})),n.d(H,"NonMaxSuppressionV5",(function(){return $g})),n.d(H,"OnesLike",(function(){return Bg})),n.d(H,"OneHot",(function(){return zg})),n.d(H,"PadV2",(function(){return Ug})),n.d(H,"Pool",(function(){return Hg})),n.d(H,"Pow",(function(){return Wg})),n.d(H,"Prelu",(function(){return Vg})),n.d(H,"Prod",(function(){return qg})),n.d(H,"Range",(function(){return Gg})),n.d(H,"Real",(function(){return Yg})),n.d(H,"Reciprocal",(function(){return Xg})),n.d(H,"Relu",(function(){return Kg})),n.d(H,"Reshape",(function(){return Zg})),n.d(H,"ResizeNearestNeighbor",(function(){return Jg})),n.d(H,"ResizeNearestNeighborGrad",(function(){return Qg})),n.d(H,"ResizeBilinear",(function(){return ev})),n.d(H,"ResizeBilinearGrad",(function(){return tv})),n.d(H,"Relu6",(function(){return nv})),n.d(H,"Reverse",(function(){return rv})),n.d(H,"Round",(function(){return iv})),n.d(H,"Rsqrt",(function(){return av})),n.d(H,"ScatterNd",(function(){return ov})),n.d(H,"SelectV2",(function(){return sv})),n.d(H,"Selu",(function(){return lv})),n.d(H,"Slice",(function(){return uv})),n.d(H,"Sin",(function(){return cv})),n.d(H,"Sinh",(function(){return dv})),n.d(H,"Sign",(function(){return hv})),n.d(H,"Sigmoid",(function(){return fv})),n.d(H,"Softplus",(function(){return pv})),n.d(H,"Sqrt",(function(){return mv})),n.d(H,"Sum",(function(){return gv})),n.d(H,"SpaceToBatchND",(function(){return vv})),n.d(H,"SplitV",(function(){return yv})),n.d(H,"Softmax",(function(){return bv})),n.d(H,"SquaredDifference",(function(){return xv})),n.d(H,"Square",(function(){return wv})),n.d(H,"Sub",(function(){return _v})),n.d(H,"SparseToDense",(function(){return Sv})),n.d(H,"StridedSlice",(function(){return Ev})),n.d(H,"Tan",(function(){return Tv})),n.d(H,"Tanh",(function(){return kv})),n.d(H,"Tile",(function(){return Cv})),n.d(H,"TopK",(function(){return Iv})),n.d(H,"Transpose",(function(){return Ov})),n.d(H,"Unique",(function(){return Av})),n.d(H,"Unpack",(function(){return Dv})),n.d(H,"UnsortedSegmentSum",(function(){return Mv})),n.d(H,"ZerosLike",(function(){return Nv})),n.d(H,"Step",(function(){return jv})),n.d(H,"FromPixels",(function(){return Rv})),n.d(H,"RotateWithOffset",(function(){return Pv})),n.d(H,"_FusedMatMul",(function(){return Fv})),n.d(H,"FusedConv2D",(function(){return Lv})),n.d(H,"FusedDepthwiseConv2D",(function(){return $v})),n.d(H,"CallbackList",(function(){return tD})),n.d(H,"CustomCallback",(function(){return iD})),n.d(H,"History",(function(){return rD})),n.d(H,"Callback",(function(){return KR})),n.d(H,"callbacks",(function(){return eP})),n.d(H,"EarlyStopping",(function(){return QR})),n.d(H,"InputSpec",(function(){return HA})),n.d(H,"SymbolicTensor",(function(){return WA})),n.d(H,"LayersModel",(function(){return sM})),n.d(H,"input",(function(){return pM})),n.d(H,"loadLayersModel",(function(){return fM})),n.d(H,"model",(function(){return dM})),n.d(H,"registerCallbackConstructor",(function(){return mM})),n.d(H,"sequential",(function(){return hM})),n.d(H,"RNN",(function(){return dN})),n.d(H,"Sequential",(function(){return cM})),n.d(H,"LayerVariable",(function(){return BA})),n.d(H,"version_layers",(function(){return PD})),n.d(H,"constraints",(function(){return y})),n.d(H,"initializers",(function(){return b})),n.d(H,"layers",(function(){return x})),n.d(H,"metrics",(function(){return w})),n.d(H,"models",(function(){return _})),n.d(H,"regularizers",(function(){return S})),n.d(H,"GraphModel",(function(){return cF})),n.d(H,"loadGraphModel",(function(){return dF})),n.d(H,"deregisterOp",(function(){return oP})),n.d(H,"registerOp",(function(){return iP})),n.d(H,"version_converter",(function(){return hF})),n.d(H,"data",(function(){return z})),n.d(H,"version",(function(){return Tq}));var W={};n.r(W),n.d(W,"JsonPatchError",(function(){return uY})),n.d(W,"deepClone",(function(){return cY})),n.d(W,"getValueByPointer",(function(){return fY})),n.d(W,"applyOperation",(function(){return pY})),n.d(W,"applyPatch",(function(){return mY})),n.d(W,"applyReducer",(function(){return gY})),n.d(W,"validator",(function(){return vY})),n.d(W,"validate",(function(){return yY})),n.d(W,"_areEquals",(function(){return bY}));var V={};n.r(V),n.d(V,"unobserve",(function(){return SY})),n.d(V,"observe",(function(){return EY})),n.d(V,"generate",(function(){return TY})),n.d(V,"compare",(function(){return CY}));var q={};n.r(q),n.d(q,"aggregate",(function(){return f5})),n.d(q,"bin",(function(){return p5})),n.d(q,"collect",(function(){return g5})),n.d(q,"compare",(function(){return v5})),n.d(q,"countpattern",(function(){return b5})),n.d(q,"cross",(function(){return x5})),n.d(q,"density",(function(){return _5})),n.d(q,"dotbin",(function(){return k5})),n.d(q,"expression",(function(){return C5})),n.d(q,"extent",(function(){return O5})),n.d(q,"facet",(function(){return D5})),n.d(q,"field",(function(){return M5})),n.d(q,"filter",(function(){return j5})),n.d(q,"flatten",(function(){return R5})),n.d(q,"fold",(function(){return P5})),n.d(q,"formula",(function(){return F5})),n.d(q,"generate",(function(){return L5})),n.d(q,"impute",(function(){return z5})),n.d(q,"joinaggregate",(function(){return U5})),n.d(q,"kde",(function(){return H5})),n.d(q,"key",(function(){return W5})),n.d(q,"load",(function(){return q5})),n.d(q,"lookup",(function(){return Y5})),n.d(q,"multiextent",(function(){return X5})),n.d(q,"multivalues",(function(){return Z5})),n.d(q,"params",(function(){return Q5})),n.d(q,"pivot",(function(){return e3})),n.d(q,"prefacet",(function(){return t3})),n.d(q,"project",(function(){return n3})),n.d(q,"proxy",(function(){return r3})),n.d(q,"quantile",(function(){return i3})),n.d(q,"relay",(function(){return a3})),n.d(q,"sample",(function(){return o3})),n.d(q,"sequence",(function(){return s3})),n.d(q,"sieve",(function(){return l3})),n.d(q,"subflow",(function(){return A5})),n.d(q,"timeunit",(function(){return u3})),n.d(q,"tupleindex",(function(){return d3})),n.d(q,"values",(function(){return h3})),n.d(q,"window",(function(){return v3}));var G={};n.r(G),n.d(G,"interpolate",(function(){return _9})),n.d(G,"interpolateArray",(function(){return f9})),n.d(G,"interpolateBasis",(function(){return t9})),n.d(G,"interpolateBasisClosed",(function(){return n9})),n.d(G,"interpolateDate",(function(){return g9})),n.d(G,"interpolateDiscrete",(function(){return S9})),n.d(G,"interpolateHue",(function(){return E9})),n.d(G,"interpolateNumber",(function(){return v9})),n.d(G,"interpolateNumberArray",(function(){return d9})),n.d(G,"interpolateObject",(function(){return y9})),n.d(G,"interpolateRound",(function(){return T9})),n.d(G,"interpolateString",(function(){return w9})),n.d(G,"interpolateTransformCss",(function(){return A9})),n.d(G,"interpolateTransformSvg",(function(){return D9})),n.d(G,"interpolateZoom",(function(){return N9})),n.d(G,"interpolateRgb",(function(){return s9})),n.d(G,"interpolateRgbBasis",(function(){return u9})),n.d(G,"interpolateRgbBasisClosed",(function(){return c9})),n.d(G,"interpolateHsl",(function(){return R9})),n.d(G,"interpolateHslLong",(function(){return P9})),n.d(G,"interpolateLab",(function(){return tee})),n.d(G,"interpolateHcl",(function(){return ree})),n.d(G,"interpolateHclLong",(function(){return iee})),n.d(G,"interpolateCubehelix",(function(){return mee})),n.d(G,"interpolateCubehelixLong",(function(){return gee})),n.d(G,"piecewise",(function(){return vee})),n.d(G,"quantize",(function(){return yee}));var Y={};n.r(Y),n.d(Y,"bound",(function(){return Coe})),n.d(Y,"identifier",(function(){return Aoe})),n.d(Y,"mark",(function(){return Doe})),n.d(Y,"overlap",(function(){return Moe})),n.d(Y,"render",(function(){return $oe})),n.d(Y,"viewlayout",(function(){return ose}));var X={};n.r(X),n.d(X,"axisticks",(function(){return lse})),n.d(X,"datajoin",(function(){return use})),n.d(X,"encode",(function(){return dse})),n.d(X,"legendentries",(function(){return hse})),n.d(X,"linkpath",(function(){return vse})),n.d(X,"pie",(function(){return _se})),n.d(X,"scale",(function(){return Tse})),n.d(X,"sortitems",(function(){return Ose})),n.d(X,"stack",(function(){return jse}));var K={};n.r(K),n.d(K,"contour",(function(){return Hde})),n.d(K,"geojson",(function(){return qde})),n.d(K,"geopath",(function(){return Gde})),n.d(K,"geopoint",(function(){return Yde})),n.d(K,"geoshape",(function(){return Xde})),n.d(K,"graticule",(function(){return Kde})),n.d(K,"heatmap",(function(){return Zde})),n.d(K,"isocontour",(function(){return Nde})),n.d(K,"kde2d",(function(){return Bde})),n.d(K,"projection",(function(){return Qde}));var Z={};n.r(Z),n.d(Z,"force",(function(){return Yhe}));var J={};n.r(J),n.d(J,"nest",(function(){return Gfe})),n.d(J,"pack",(function(){return Qfe})),n.d(J,"partition",(function(){return tpe})),n.d(J,"stratify",(function(){return npe})),n.d(J,"tree",(function(){return ape})),n.d(J,"treelinks",(function(){return ope})),n.d(J,"treemap",(function(){return upe}));var Q={};n.r(Q),n.d(Q,"label",(function(){return Tpe}));var ee={};n.r(ee),n.d(ee,"loess",(function(){return Cpe})),n.d(ee,"regression",(function(){return Ope}));var te={};n.r(te),n.d(te,"voronoi",(function(){return Jpe}));var ne={};n.r(ne),n.d(ne,"wordcloud",(function(){return dme}));var re={};n.r(re),n.d(re,"crossfilter",(function(){return yme})),n.d(re,"resolvefilter",(function(){return bme}));var ie={};n.r(ie),n.d(ie,"Debug",(function(){return ZY})),n.d(ie,"Error",(function(){return YY})),n.d(ie,"Info",(function(){return KY})),n.d(ie,"None",(function(){return GY})),n.d(ie,"Warn",(function(){return XY})),n.d(ie,"accessor",(function(){return DY})),n.d(ie,"accessorFields",(function(){return NY})),n.d(ie,"accessorName",(function(){return MY})),n.d(ie,"array",(function(){return EX})),n.d(ie,"ascending",(function(){return IX})),n.d(ie,"clampRange",(function(){return TX})),n.d(ie,"compare",(function(){return CX})),n.d(ie,"constant",(function(){return MX})),n.d(ie,"debounce",(function(){return NX})),n.d(ie,"error",(function(){return FY})),n.d(ie,"extend",(function(){return jX})),n.d(ie,"extent",(function(){return RX})),n.d(ie,"extentIndex",(function(){return PX})),n.d(ie,"falsy",(function(){return VY})),n.d(ie,"fastmap",(function(){return BX})),n.d(ie,"field",(function(){return $Y})),n.d(ie,"flush",(function(){return zX})),n.d(ie,"hasOwnProperty",(function(){return LX})),n.d(ie,"id",(function(){return BY})),n.d(ie,"identity",(function(){return zY})),n.d(ie,"inherits",(function(){return UX})),n.d(ie,"inrange",(function(){return HX})),n.d(ie,"isArray",(function(){return QY})),n.d(ie,"isBoolean",(function(){return WX})),n.d(ie,"isDate",(function(){return VX})),n.d(ie,"isFunction",(function(){return kX})),n.d(ie,"isIterable",(function(){return qX})),n.d(ie,"isNumber",(function(){return GX})),n.d(ie,"isObject",(function(){return eX})),n.d(ie,"isRegExp",(function(){return YX})),n.d(ie,"isString",(function(){return XX})),n.d(ie,"key",(function(){return KX})),n.d(ie,"lerp",(function(){return ZX})),n.d(ie,"logger",(function(){return JY})),n.d(ie,"lruCache",(function(){return JX})),n.d(ie,"merge",(function(){return QX})),n.d(ie,"mergeConfig",(function(){return nX})),n.d(ie,"one",(function(){return HY})),n.d(ie,"pad",(function(){return tK})),n.d(ie,"panLinear",(function(){return fX})),n.d(ie,"panLog",(function(){return pX})),n.d(ie,"panPow",(function(){return mX})),n.d(ie,"panSymlog",(function(){return gX})),n.d(ie,"peek",(function(){return aX})),n.d(ie,"quarter",(function(){return _X})),n.d(ie,"repeat",(function(){return eK})),n.d(ie,"span",(function(){return nK})),n.d(ie,"splitAccessPath",(function(){return LY})),n.d(ie,"stringValue",(function(){return rK})),n.d(ie,"toBoolean",(function(){return iK})),n.d(ie,"toDate",(function(){return oK})),n.d(ie,"toNumber",(function(){return oX})),n.d(ie,"toSet",(function(){return lK})),n.d(ie,"toString",(function(){return sK})),n.d(ie,"truncate",(function(){return uK})),n.d(ie,"truthy",(function(){return WY})),n.d(ie,"utcquarter",(function(){return SX})),n.d(ie,"visitArray",(function(){return cK})),n.d(ie,"writeConfig",(function(){return rX})),n.d(ie,"zero",(function(){return UY})),n.d(ie,"zoomLinear",(function(){return yX})),n.d(ie,"zoomLog",(function(){return bX})),n.d(ie,"zoomPow",(function(){return xX})),n.d(ie,"zoomSymlog",(function(){return wX})),n.d(ie,"Dataflow",(function(){return W1})),n.d(ie,"EventStream",(function(){return A1})),n.d(ie,"MultiPulse",(function(){return B1})),n.d(ie,"Operator",(function(){return C1})),n.d(ie,"Parameters",(function(){return E1})),n.d(ie,"Pulse",(function(){return P1})),n.d(ie,"Transform",(function(){return q1})),n.d(ie,"changeset",(function(){return _1})),n.d(ie,"definition",(function(){return Y1})),n.d(ie,"ingest",(function(){return g1})),n.d(ie,"isTuple",(function(){return f1})),n.d(ie,"transform",(function(){return X1})),n.d(ie,"transforms",(function(){return G1})),n.d(ie,"tupleid",(function(){return p1})),n.d(ie,"bandwidthNRD",(function(){return o2})),n.d(ie,"bin",(function(){return s2})),n.d(ie,"bootstrapCI",(function(){return c2})),n.d(ie,"cumulativeLogNormal",(function(){return T2})),n.d(ie,"cumulativeNormal",(function(){return b2})),n.d(ie,"cumulativeUniform",(function(){return D2})),n.d(ie,"densityLogNormal",(function(){return E2})),n.d(ie,"densityNormal",(function(){return y2})),n.d(ie,"densityUniform",(function(){return A2})),n.d(ie,"dotbin",(function(){return d2})),n.d(ie,"quantileLogNormal",(function(){return k2})),n.d(ie,"quantileNormal",(function(){return x2})),n.d(ie,"quantileUniform",(function(){return M2})),n.d(ie,"quantiles",(function(){return i2})),n.d(ie,"quartiles",(function(){return a2})),n.d(ie,"random",(function(){return l2})),n.d(ie,"randomInteger",(function(){return f2})),n.d(ie,"randomKDE",(function(){return _2})),n.d(ie,"randomLCG",(function(){return h2})),n.d(ie,"randomLogNormal",(function(){return C2})),n.d(ie,"randomMixture",(function(){return I2})),n.d(ie,"randomNormal",(function(){return w2})),n.d(ie,"randomUniform",(function(){return N2})),n.d(ie,"regressionExp",(function(){return B2})),n.d(ie,"regressionLinear",(function(){return L2})),n.d(ie,"regressionLoess",(function(){return V2})),n.d(ie,"regressionLog",(function(){return $2})),n.d(ie,"regressionPoly",(function(){return H2})),n.d(ie,"regressionPow",(function(){return z2})),n.d(ie,"regressionQuad",(function(){return U2})),n.d(ie,"sampleCurve",(function(){return X2})),n.d(ie,"sampleLogNormal",(function(){return S2})),n.d(ie,"sampleNormal",(function(){return v2})),n.d(ie,"sampleUniform",(function(){return O2})),n.d(ie,"setRandom",(function(){return u2})),n.d(ie,"DATE",(function(){return ZZ})),n.d(ie,"DAY",(function(){return JZ})),n.d(ie,"DAYOFYEAR",(function(){return QZ})),n.d(ie,"HOURS",(function(){return eJ})),n.d(ie,"MILLISECONDS",(function(){return rJ})),n.d(ie,"MINUTES",(function(){return tJ})),n.d(ie,"MONTH",(function(){return XZ})),n.d(ie,"QUARTER",(function(){return YZ})),n.d(ie,"SECONDS",(function(){return nJ})),n.d(ie,"TIME_UNITS",(function(){return iJ})),n.d(ie,"WEEK",(function(){return KZ})),n.d(ie,"YEAR",(function(){return GZ})),n.d(ie,"dayofyear",(function(){return dJ})),n.d(ie,"timeBin",(function(){return KJ})),n.d(ie,"timeFloor",(function(){return CJ})),n.d(ie,"timeInterval",(function(){return NJ})),n.d(ie,"timeOffset",(function(){return PJ})),n.d(ie,"timeSequence",(function(){return $J})),n.d(ie,"timeUnitSpecifier",(function(){return lJ})),n.d(ie,"timeUnits",(function(){return oJ})),n.d(ie,"utcFloor",(function(){return AJ})),n.d(ie,"utcInterval",(function(){return jJ})),n.d(ie,"utcOffset",(function(){return FJ})),n.d(ie,"utcSequence",(function(){return BJ})),n.d(ie,"utcdayofyear",(function(){return vJ})),n.d(ie,"utcweek",(function(){return yJ})),n.d(ie,"week",(function(){return hJ})),n.d(ie,"loader",(function(){return l1})),n.d(ie,"read",(function(){return s1})),n.d(ie,"inferType",(function(){return TK})),n.d(ie,"inferTypes",(function(){return kK})),n.d(ie,"typeParsers",(function(){return _K})),n.d(ie,"format",(function(){return VK})),n.d(ie,"formats",(function(){return qK})),n.d(ie,"responseType",(function(){return GK})),n.d(ie,"Bounds",(function(){return One})),n.d(ie,"CanvasHandler",(function(){return nae})),n.d(ie,"CanvasRenderer",(function(){return sae})),n.d(ie,"Gradient",(function(){return Pte})),n.d(ie,"GroupItem",(function(){return Dne})),n.d(ie,"Handler",(function(){return Lie})),n.d(ie,"Item",(function(){return Ane})),n.d(ie,"Marks",(function(){return Sie})),n.d(ie,"RenderType",(function(){return qae})),n.d(ie,"Renderer",(function(){return Bie})),n.d(ie,"ResourceLoader",(function(){return Mne})),n.d(ie,"SVGHandler",(function(){return uae})),n.d(ie,"SVGRenderer",(function(){return Dae})),n.d(ie,"SVGStringRenderer",(function(){return Vae})),n.d(ie,"Scenegraph",(function(){return Aie})),n.d(ie,"boundClip",(function(){return eoe})),n.d(ie,"boundContext",(function(){return Qne})),n.d(ie,"boundItem",(function(){return Eie})),n.d(ie,"boundMark",(function(){return kie})),n.d(ie,"boundStroke",(function(){return Rne})),n.d(ie,"domChild",(function(){return jie})),n.d(ie,"domClear",(function(){return Rie})),n.d(ie,"domCreate",(function(){return Mie})),n.d(ie,"domFind",(function(){return Nie})),n.d(ie,"font",(function(){return vie})),n.d(ie,"fontFamily",(function(){return gie})),n.d(ie,"fontSize",(function(){return die})),n.d(ie,"intersect",(function(){return Xae})),n.d(ie,"intersectBoxLine",(function(){return cre})),n.d(ie,"intersectPath",(function(){return ore})),n.d(ie,"intersectPoint",(function(){return sre})),n.d(ie,"intersectRule",(function(){return ure})),n.d(ie,"lineHeight",(function(){return hie})),n.d(ie,"markup",(function(){return kae})),n.d(ie,"multiLineOffset",(function(){return pie})),n.d(ie,"pathCurves",(function(){return Lte})),n.d(ie,"pathEqual",(function(){return noe})),n.d(ie,"pathParse",(function(){return zte})),n.d(ie,"pathRectangle",(function(){return dne})),n.d(ie,"pathRender",(function(){return Jte})),n.d(ie,"pathSymbols",(function(){return nne})),n.d(ie,"pathTrail",(function(){return hne})),n.d(ie,"point",(function(){return Fie})),n.d(ie,"renderModule",(function(){return Yae})),n.d(ie,"resetSVGClipId",(function(){return Cne})),n.d(ie,"resetSVGDefIds",(function(){return roe})),n.d(ie,"sceneEqual",(function(){return toe})),n.d(ie,"sceneFromJSON",(function(){return Oie})),n.d(ie,"scenePickVisit",(function(){return wre})),n.d(ie,"sceneToJSON",(function(){return Iie})),n.d(ie,"sceneVisit",(function(){return xre})),n.d(ie,"sceneZOrder",(function(){return bre})),n.d(ie,"serializeXML",(function(){return Cae})),n.d(ie,"textMetrics",(function(){return aie})),n.d(ie,"interpolate",(function(){return ste})),n.d(ie,"interpolateColors",(function(){return ite})),n.d(ie,"interpolateRange",(function(){return rte})),n.d(ie,"quantizeInterpolator",(function(){return ate})),n.d(ie,"scale",(function(){return Gee})),n.d(ie,"scheme",(function(){return dte})),n.d(ie,"projection",(function(){return Hce})),n.d(ie,"View",(function(){return Wbe})),n.d(ie,"defaultLocale",(function(){return a1})),n.d(ie,"formatLocale",(function(){return Z0})),n.d(ie,"locale",(function(){return i1})),n.d(ie,"resetDefaultLocale",(function(){return o1})),n.d(ie,"timeFormatLocale",(function(){return n1})),n.d(ie,"expressionFunction",(function(){return Nye})),n.d(ie,"parse",(function(){return MSe})),n.d(ie,"runtimeContext",(function(){return Hye})),n.d(ie,"version",(function(){return NSe}));var ae={};n.r(ae),n.d(ae,"invalidSpec",(function(){return yke})),n.d(ae,"FIT_NON_SINGLE",(function(){return bke})),n.d(ae,"containerSizeNonSingle",(function(){return xke})),n.d(ae,"containerSizeNotCompatibleWithAutosize",(function(){return wke})),n.d(ae,"droppingFit",(function(){return _ke})),n.d(ae,"unknownField",(function(){return Ske})),n.d(ae,"cannotProjectOnChannelWithoutField",(function(){return Eke})),n.d(ae,"cannotProjectAggregate",(function(){return Tke})),n.d(ae,"nearestNotSupportForContinuous",(function(){return kke})),n.d(ae,"selectionNotSupported",(function(){return Cke})),n.d(ae,"selectionNotFound",(function(){return Ike})),n.d(ae,"SCALE_BINDINGS_CONTINUOUS",(function(){return Oke})),n.d(ae,"LEGEND_BINDINGS_MUST_HAVE_PROJECTION",(function(){return Ake})),n.d(ae,"noSameUnitLookup",(function(){return Dke})),n.d(ae,"NEEDS_SAME_SELECTION",(function(){return Mke})),n.d(ae,"INTERVAL_INITIALIZED_WITH_X_Y",(function(){return Nke})),n.d(ae,"noSuchRepeatedValue",(function(){return jke})),n.d(ae,"columnsNotSupportByRowCol",(function(){return Rke})),n.d(ae,"CONCAT_CANNOT_SHARE_AXIS",(function(){return Pke})),n.d(ae,"unrecognizedParse",(function(){return Fke})),n.d(ae,"differentParse",(function(){return Lke})),n.d(ae,"ADD_SAME_CHILD_TWICE",(function(){return $ke})),n.d(ae,"invalidTransformIgnored",(function(){return Bke})),n.d(ae,"NO_FIELDS_NEEDS_AS",(function(){return zke})),n.d(ae,"customFormatTypeNotAllowed",(function(){return Uke})),n.d(ae,"projectionOverridden",(function(){return Hke})),n.d(ae,"REPLACE_ANGLE_WITH_THETA",(function(){return Wke})),n.d(ae,"primitiveChannelDef",(function(){return Vke})),n.d(ae,"invalidFieldType",(function(){return qke})),n.d(ae,"invalidFieldTypeForCountAggregate",(function(){return Gke})),n.d(ae,"invalidAggregate",(function(){return Yke})),n.d(ae,"missingFieldType",(function(){return Xke})),n.d(ae,"droppingColor",(function(){return Kke})),n.d(ae,"emptyFieldDef",(function(){return Zke})),n.d(ae,"latLongDeprecated",(function(){return Jke})),n.d(ae,"LINE_WITH_VARYING_SIZE",(function(){return Qke})),n.d(ae,"incompatibleChannel",(function(){return eCe})),n.d(ae,"invalidEncodingChannel",(function(){return tCe})),n.d(ae,"facetChannelShouldBeDiscrete",(function(){return nCe})),n.d(ae,"facetChannelDropped",(function(){return rCe})),n.d(ae,"discreteChannelCannotEncode",(function(){return iCe})),n.d(ae,"rangeMarkAlignmentCannotBeExpression",(function(){return aCe})),n.d(ae,"lineWithRange",(function(){return oCe})),n.d(ae,"orientOverridden",(function(){return sCe})),n.d(ae,"CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN",(function(){return lCe})),n.d(ae,"RANGE_STEP_DEPRECATED",(function(){return uCe})),n.d(ae,"cannotUseScalePropertyWithNonColor",(function(){return cCe})),n.d(ae,"unaggregateDomainHasNoEffectForRawField",(function(){return dCe})),n.d(ae,"unaggregateDomainWithNonSharedDomainOp",(function(){return hCe})),n.d(ae,"unaggregatedDomainWithLogScale",(function(){return fCe})),n.d(ae,"cannotApplySizeToNonOrientedMark",(function(){return pCe})),n.d(ae,"scaleTypeNotWorkWithChannel",(function(){return mCe})),n.d(ae,"scaleTypeNotWorkWithFieldDef",(function(){return gCe})),n.d(ae,"scalePropertyNotWorkWithScaleType",(function(){return vCe})),n.d(ae,"scaleTypeNotWorkWithMark",(function(){return yCe})),n.d(ae,"stepDropped",(function(){return bCe})),n.d(ae,"mergeConflictingProperty",(function(){return xCe})),n.d(ae,"mergeConflictingDomainProperty",(function(){return wCe})),n.d(ae,"independentScaleMeansIndependentGuide",(function(){return _Ce})),n.d(ae,"domainSortDropped",(function(){return SCe})),n.d(ae,"MORE_THAN_ONE_SORT",(function(){return ECe})),n.d(ae,"FACETED_INDEPENDENT_DIFFERENT_SOURCES",(function(){return TCe})),n.d(ae,"FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES",(function(){return kCe})),n.d(ae,"FACETED_INDEPENDENT_SAME_SOURCE",(function(){return CCe})),n.d(ae,"INVALID_CHANNEL_FOR_AXIS",(function(){return ICe})),n.d(ae,"cannotStackRangedMark",(function(){return OCe})),n.d(ae,"cannotStackNonLinearScale",(function(){return ACe})),n.d(ae,"stackNonSummativeAggregate",(function(){return DCe})),n.d(ae,"invalidTimeUnit",(function(){return MCe})),n.d(ae,"droppedDay",(function(){return NCe})),n.d(ae,"errorBarCenterAndExtentAreNotNeeded",(function(){return jCe})),n.d(ae,"errorBarCenterIsUsedWithWrongExtent",(function(){return RCe})),n.d(ae,"errorBarContinuousAxisHasCustomizedAggregate",(function(){return PCe})),n.d(ae,"errorBand1DNotSupport",(function(){return FCe})),n.d(ae,"channelRequiredForBinned",(function(){return LCe})),n.d(ae,"channelShouldNotBeUsedForBinned",(function(){return $Ce})),n.d(ae,"domainRequiredForThresholdScale",(function(){return BCe}));var oe={};n.r(oe),n.d(oe,"compile",(function(){return JFe})),n.d(oe,"deepEqual",(function(){return VSe})),n.d(oe,"duplicate",(function(){return qSe})),n.d(oe,"pick",(function(){return GSe})),n.d(oe,"omit",(function(){return YSe})),n.d(oe,"stringify",(function(){return XSe})),n.d(oe,"hash",(function(){return KSe})),n.d(oe,"isNullOrFalse",(function(){return ZSe})),n.d(oe,"contains",(function(){return JSe})),n.d(oe,"some",(function(){return QSe})),n.d(oe,"every",(function(){return eEe})),n.d(oe,"mergeDeep",(function(){return tEe})),n.d(oe,"unique",(function(){return rEe})),n.d(oe,"isEqual",(function(){return iEe})),n.d(oe,"setEqual",(function(){return aEe})),n.d(oe,"hasIntersection",(function(){return oEe})),n.d(oe,"prefixGenerator",(function(){return sEe})),n.d(oe,"fieldIntersection",(function(){return lEe})),n.d(oe,"isEmpty",(function(){return uEe})),n.d(oe,"keys",(function(){return cEe})),n.d(oe,"vals",(function(){return dEe})),n.d(oe,"entries",(function(){return hEe})),n.d(oe,"isBoolean",(function(){return fEe})),n.d(oe,"varName",(function(){return pEe})),n.d(oe,"logicalExpr",(function(){return mEe})),n.d(oe,"deleteNestedProperty",(function(){return gEe})),n.d(oe,"titleCase",(function(){return vEe})),n.d(oe,"accessPathWithDatum",(function(){return yEe})),n.d(oe,"flatAccessWithDatum",(function(){return bEe})),n.d(oe,"replacePathInField",(function(){return wEe})),n.d(oe,"replaceAll",(function(){return _Ee})),n.d(oe,"removePathFromField",(function(){return SEe})),n.d(oe,"accessPathDepth",(function(){return EEe})),n.d(oe,"getFirstDefined",(function(){return TEe})),n.d(oe,"uniqueId",(function(){return CEe})),n.d(oe,"resetIdCounter",(function(){return IEe})),n.d(oe,"internalField",(function(){return OEe})),n.d(oe,"isInternalField",(function(){return AEe})),n.d(oe,"normalizeAngle",(function(){return DEe})),n.d(oe,"isNumeric",(function(){return MEe})),n.d(oe,"normalize",(function(){return HMe})),n.d(oe,"version",(function(){return jSe.a}));var se={};function le(e){return"function"==typeof e}n.r(se),n.d(se,"dark",(function(){return tLe})),n.d(se,"excel",(function(){return rLe})),n.d(se,"fivethirtyeight",(function(){return lLe})),n.d(se,"ggplot2",(function(){return cLe})),n.d(se,"googlecharts",(function(){return DLe})),n.d(se,"latimes",(function(){return gLe})),n.d(se,"quartz",(function(){return bLe})),n.d(se,"urbaninstitute",(function(){return CLe})),n.d(se,"version",(function(){return MLe})),n.d(se,"vox",(function(){return wLe}));let ue=!1;const ce={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else ue&&console.log("RxJS: Back to a better error behavior. Thank you. <3");ue=e},get useDeprecatedSynchronousErrorHandling(){return ue}};function de(e){setTimeout(()=>{throw e},0)}const he={closed:!0,next(e){},error(e){if(ce.useDeprecatedSynchronousErrorHandling)throw e;de(e)},complete(){}},fe=(()=>Array.isArray||(e=>e&&"number"==typeof e.length))();function pe(e){return null!==e&&"object"==typeof e}const me=(()=>{function e(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((e,t)=>`${t+1}) ${e.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e})();let ge=(()=>{class e{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let t;if(this.closed)return;let{_parentOrParents:n,_ctorUnsubscribe:r,_unsubscribe:i,_subscriptions:a}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(null!==n)for(let e=0;e<n.length;++e)n[e].remove(this);if(le(i)){r&&(this._unsubscribe=void 0);try{i.call(this)}catch(o){t=o instanceof me?ve(o.errors):[o]}}if(fe(a)){let e=-1,n=a.length;for(;++e<n;){const n=a[e];if(pe(n))try{n.unsubscribe()}catch(o){t=t||[],o instanceof me?t=t.concat(ve(o.errors)):t.push(o)}}}if(t)throw new me(t)}add(t){let n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){const t=n;n=new e,n._subscriptions=[t]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}let{_parentOrParents:r}=n;if(null===r)n._parentOrParents=this;else if(r instanceof e){if(r===this)return n;n._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return n;r.push(this)}const i=this._subscriptions;return null===i?this._subscriptions=[n]:i.push(n),n}remove(e){const t=this._subscriptions;if(t){const n=t.indexOf(e);-1!==n&&t.splice(n,1)}}}return e.EMPTY=function(e){return e.closed=!0,e}(new e),e})();function ve(e){return e.reduce((e,t)=>e.concat(t instanceof me?t.errors:t),[])}const ye=(()=>"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random())();class be extends ge{constructor(e,t,n){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=he;break;case 1:if(!e){this.destination=he;break}if("object"==typeof e){e instanceof be?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new xe(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new xe(this,e,t,n)}}[ye](){return this}static create(e,t,n){const r=new be(e,t,n);return r.syncErrorThrowable=!1,r}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class xe extends be{constructor(e,t,n,r){let i;super(),this._parentSubscriber=e;let a=this;le(t)?i=t:t&&(i=t.next,n=t.error,r=t.complete,t!==he&&(a=Object.create(t),le(a.unsubscribe)&&this.add(a.unsubscribe.bind(a)),a.unsubscribe=this.unsubscribe.bind(this))),this._context=a,this._next=i,this._error=n,this._complete=r}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:t}=this;ce.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:t}=this,{useDeprecatedSynchronousErrorHandling:n}=ce;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):de(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;de(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const t=()=>this._complete.call(this._context);ce.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,t),this.unsubscribe()):(this.__tryOrUnsub(t),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,t){try{e.call(this._context,t)}catch(n){if(this.unsubscribe(),ce.useDeprecatedSynchronousErrorHandling)throw n;de(n)}}__tryOrSetError(e,t,n){if(!ce.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(r){return ce.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=r,e.syncErrorThrown=!0,!0):(de(r),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const we=(()=>"function"==typeof Symbol&&Symbol.observable||"@@observable")();function _e(e){return e}let Se=(()=>{class e{constructor(e){this._isScalar=!1,e&&(this._subscribe=e)}lift(t){const n=new e;return n.source=this,n.operator=t,n}subscribe(e,t,n){const{operator:r}=this,i=function(e,t,n){if(e){if(e instanceof be)return e;if(e[ye])return e[ye]()}return e||t||n?new be(e,t,n):new be(he)}(e,t,n);if(i.add(r?r.call(i,this.source):this.source||ce.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),ce.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i}_trySubscribe(e){try{return this._subscribe(e)}catch(t){ce.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){const{closed:t,destination:n,isStopped:r}=e;if(t||r)return!1;e=n&&n instanceof be?n:null}return!0}(e)?e.error(t):console.warn(t)}}forEach(e,t){return new(t=Ee(t))((t,n)=>{let r;r=this.subscribe(t=>{try{e(t)}catch(i){n(i),r&&r.unsubscribe()}},n,t)})}_subscribe(e){const{source:t}=this;return t&&t.subscribe(e)}[we](){return this}pipe(...e){return 0===e.length?this:(0===(t=e).length?_e:1===t.length?t[0]:function(e){return t.reduce((e,t)=>t(e),e)})(this);var t}toPromise(e){return new(e=Ee(e))((e,t)=>{let n;this.subscribe(e=>n=e,e=>t(e),()=>e(n))})}}return e.create=t=>new e(t),e})();function Ee(e){if(e||(e=ce.Promise||Promise),!e)throw new Error("no Promise impl found");return e}const Te=(()=>{function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e})();class ke extends ge{constructor(e,t){super(),this.subject=e,this.subscriber=t,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,t=e.observers;if(this.subject=null,!t||0===t.length||e.isStopped||e.closed)return;const n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}class Ce extends be{constructor(e){super(e),this.destination=e}}let Ie=(()=>{class e extends Se{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[ye](){return new Ce(this)}lift(e){const t=new Oe(this,this);return t.operator=e,t}next(e){if(this.closed)throw new Te;if(!this.isStopped){const{observers:t}=this,n=t.length,r=t.slice();for(let i=0;i<n;i++)r[i].next(e)}}error(e){if(this.closed)throw new Te;this.hasError=!0,this.thrownError=e,this.isStopped=!0;const{observers:t}=this,n=t.length,r=t.slice();for(let i=0;i<n;i++)r[i].error(e);this.observers.length=0}complete(){if(this.closed)throw new Te;this.isStopped=!0;const{observers:e}=this,t=e.length,n=e.slice();for(let r=0;r<t;r++)n[r].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(e){if(this.closed)throw new Te;return super._trySubscribe(e)}_subscribe(e){if(this.closed)throw new Te;return this.hasError?(e.error(this.thrownError),ge.EMPTY):this.isStopped?(e.complete(),ge.EMPTY):(this.observers.push(e),new ke(this,e))}asObservable(){const e=new Se;return e.source=this,e}}return e.create=(e,t)=>new Oe(e,t),e})();class Oe extends Ie{constructor(e,t){super(),this.destination=e,this.source=t}next(e){const{destination:t}=this;t&&t.next&&t.next(e)}error(e){const{destination:t}=this;t&&t.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:t}=this;return t?this.source.subscribe(e):ge.EMPTY}}function Ae(e){return e&&"function"==typeof e.schedule}function De(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new Me(e,t))}}class Me{constructor(e,t){this.project=e,this.thisArg=t}call(e,t){return t.subscribe(new Ne(e,this.project,this.thisArg))}}class Ne extends be{constructor(e,t,n){super(e),this.project=t,this.count=0,this.thisArg=n||this}_next(e){let t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}const je=e=>t=>{for(let n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()};function Re(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}const Pe=Re(),Fe=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Le(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}const $e=e=>{if(e&&"function"==typeof e[we])return r=e,e=>{const t=r[we]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(Fe(e))return je(e);if(Le(e))return n=e,e=>(n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,de),e);if(e&&"function"==typeof e[Pe])return t=e,e=>{const n=t[Pe]();for(;;){let t;try{t=n.next()}catch(r){return e.error(r),e}if(t.done){e.complete();break}if(e.next(t.value),e.closed)break}return"function"==typeof n.return&&e.add(()=>{n.return&&n.return()}),e};{const t=pe(e)?"an invalid object":`'${e}'`;throw new TypeError(`You provided ${t} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`)}var t,n,r};function Be(e,t){return new Se(n=>{const r=new ge;let i=0;return r.add(t.schedule((function(){i!==e.length?(n.next(e[i++]),n.closed||r.add(this.schedule())):n.complete()}))),r})}function ze(e,t){return t?function(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[we]}(e))return function(e,t){return new Se(n=>{const r=new ge;return r.add(t.schedule(()=>{const i=e[we]();r.add(i.subscribe({next(e){r.add(t.schedule(()=>n.next(e)))},error(e){r.add(t.schedule(()=>n.error(e)))},complete(){r.add(t.schedule(()=>n.complete()))}}))})),r})}(e,t);if(Le(e))return function(e,t){return new Se(n=>{const r=new ge;return r.add(t.schedule(()=>e.then(e=>{r.add(t.schedule(()=>{n.next(e),r.add(t.schedule(()=>n.complete()))}))},e=>{r.add(t.schedule(()=>n.error(e)))}))),r})}(e,t);if(Fe(e))return Be(e,t);if(function(e){return e&&"function"==typeof e[Pe]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new Se(n=>{const r=new ge;let i;return r.add(()=>{i&&"function"==typeof i.return&&i.return()}),r.add(t.schedule(()=>{i=e[Pe](),r.add(t.schedule((function(){if(n.closed)return;let e,t;try{const n=i.next();e=n.value,t=n.done}catch(r){return void n.error(r)}t?n.complete():(n.next(e),this.schedule())})))})),r})}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}(e,t):e instanceof Se?e:new Se($e(e))}class Ue extends be{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class He extends be{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function We(e,t){if(!t.closed)return e instanceof Se?e.subscribe(t):$e(e)(t)}function Ve(e,t,n=Number.POSITIVE_INFINITY){return"function"==typeof t?r=>r.pipe(Ve((n,r)=>ze(e(n,r)).pipe(De((e,i)=>t(n,e,r,i))),n)):("number"==typeof t&&(n=t),t=>t.lift(new qe(e,n)))}class qe{constructor(e,t=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=t}call(e,t){return t.subscribe(new Ge(e,this.project,this.concurrent))}}class Ge extends He{constructor(e,t,n=Number.POSITIVE_INFINITY){super(e),this.project=t,this.concurrent=n,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let t;const n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(t)}_innerSub(e){const t=new Ue(this),n=this.destination;n.add(t);const r=We(e,t);r!==t&&n.add(r)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function Ye(e=Number.POSITIVE_INFINITY){return Ve(_e,e)}function Xe(e,t){return t?Be(e,t):new Se(je(e))}function Ke(){return function(e){return e.lift(new Ze(e))}}class Ze{constructor(e){this.connectable=e}call(e,t){const{connectable:n}=this;n._refCount++;const r=new Je(e,n),i=t.subscribe(r);return r.closed||(r.connection=n.connect()),i}}class Je extends be{constructor(e,t){super(e),this.connectable=t}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);const{connection:n}=this,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}class Qe extends Se{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new ge,e.add(this.source.subscribe(new tt(this.getSubject(),this))),e.closed&&(this._connection=null,e=ge.EMPTY)),e}refCount(){return Ke()(this)}}const et=(()=>{const e=Qe.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}})();class tt extends Ce{constructor(e,t){super(e),this.connectable=t}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}function nt(){return new Ie}function rt(e){return{toString:e}.toString()}const it="__parameters__";function at(e,t,n){return rt(()=>{const r=function(e){return function(...t){if(e){const n=e(...t);for(const e in n)this[e]=n[e]}}}(t);function i(...e){if(this instanceof i)return r.apply(this,e),this;const t=new i(...e);return n.annotation=t,n;function n(e,n,r){const i=e.hasOwnProperty(it)?e[it]:Object.defineProperty(e,it,{value:[]})[it];for(;i.length<=r;)i.push(null);return(i[r]=i[r]||[]).push(t),e}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i})}const ot=at("Inject",e=>({token:e})),st=at("Optional"),lt=at("Self"),ut=at("SkipSelf");var ct=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}({});function dt(e){for(let t in e)if(e[t]===dt)return t;throw Error("Could not find renamed property on target object.")}function ht(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function ft(e){return{factory:e.factory,providers:e.providers||[],imports:e.imports||[]}}function pt(e){return mt(e,e[vt])||mt(e,e[xt])}function mt(e,t){return t&&t.token===e?t:null}function gt(e){return e&&(e.hasOwnProperty(yt)||e.hasOwnProperty(wt))?e[yt]:null}const vt=dt({"\u0275prov":dt}),yt=dt({"\u0275inj":dt}),bt=dt({"\u0275provFallback":dt}),xt=dt({ngInjectableDef:dt}),wt=dt({ngInjectorDef:dt});function _t(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(_t).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return""+e.overriddenName;if(e.name)return""+e.name;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function St(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const Et=dt({__forward_ref__:dt});function Tt(e){return e.__forward_ref__=Tt,e.toString=function(){return _t(this())},e}function kt(e){return"function"==typeof(t=e)&&t.hasOwnProperty(Et)&&t.__forward_ref__===Tt?e():e;var t}const Ct="undefined"!=typeof globalThis&&globalThis,It="undefined"!=typeof window&&window,Ot="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,At="undefined"!=typeof global&&global,Dt=Ct||At||It||Ot,Mt=dt({"\u0275cmp":dt}),Nt=dt({"\u0275dir":dt}),jt=dt({"\u0275pipe":dt}),Rt=dt({"\u0275mod":dt}),Pt=dt({"\u0275loc":dt}),Ft=dt({"\u0275fac":dt}),Lt=dt({__NG_ELEMENT_ID__:dt});class $t{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=ht({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return"InjectionToken "+this._desc}}const Bt=new $t("INJECTOR",-1),zt={},Ut=/\n/gm,Ht="__source",Wt=dt({provide:String,useValue:dt});let Vt,qt=void 0;function Gt(e){const t=qt;return qt=e,t}function Yt(e){const t=Vt;return Vt=e,t}function Xt(e,t=ct.Default){if(void 0===qt)throw new Error("inject() must be called from an injection context");return null===qt?Zt(e,void 0,t):qt.get(e,t&ct.Optional?null:void 0,t)}function Kt(e,t=ct.Default){return(Vt||Xt)(kt(e),t)}function Zt(e,t,n){const r=pt(e);if(r&&"root"==r.providedIn)return void 0===r.value?r.value=r.factory():r.value;if(n&ct.Optional)return null;if(void 0!==t)return t;throw new Error(`Injector: NOT_FOUND [${_t(e)}]`)}function Jt(e){const t=[];for(let n=0;n<e.length;n++){const r=kt(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");let e=void 0,n=ct.Default;for(let t=0;t<r.length;t++){const i=r[t];i instanceof st||"Optional"===i.ngMetadataName||i===st?n|=ct.Optional:i instanceof ut||"SkipSelf"===i.ngMetadataName||i===ut?n|=ct.SkipSelf:i instanceof lt||"Self"===i.ngMetadataName||i===lt?n|=ct.Self:e=i instanceof ot||i===ot?i.token:i}t.push(Kt(e,n))}else t.push(Kt(r))}return t}class Qt{get(e,t=zt){if(t===zt){const t=new Error(`NullInjectorError: No provider for ${_t(e)}!`);throw t.name="NullInjectorError",t}return t}}class en{}class tn{}function nn(e,t){e.forEach(e=>Array.isArray(e)?nn(e,t):t(e))}function rn(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function an(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function on(e,t,n){let r=ln(e,t);return r>=0?e[1|r]=n:(r=~r,function(e,t,n,r){let i=e.length;if(i==t)e.push(n,r);else if(1===i)e.push(r,e[0]),e[0]=n;else{for(i--,e.push(e[i-1],e[i]);i>t;)e[i]=e[i-2],i--;e[t]=n,e[t+1]=r}}(e,r,t,n)),r}function sn(e,t){const n=ln(e,t);if(n>=0)return e[1|n]}function ln(e,t){return function(e,t,n){let r=0,i=e.length>>1;for(;i!==r;){const n=r+(i-r>>1),a=e[n<<1];if(t===a)return n<<1;a>t?i=n:r=n+1}return~(i<<1)}(e,t)}var un=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}({}),cn=function(e){return e[e.Emulated=0]="Emulated",e[e.Native=1]="Native",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}({});const dn={},hn=[];let fn=0;function pn(e){return rt(()=>{const t={},n={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===un.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||hn,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||cn.Emulated,id:"c",styles:e.styles||hn,_:null,setInput:null,schemas:e.schemas||null,tView:null},r=e.directives,i=e.features,a=e.pipes;return n.id+=fn++,n.inputs=bn(e.inputs,t),n.outputs=bn(e.outputs),i&&i.forEach(e=>e(n)),n.directiveDefs=r?()=>("function"==typeof r?r():r).map(mn):null,n.pipeDefs=a?()=>("function"==typeof a?a():a).map(gn):null,n})}function mn(e){return _n(e)||function(e){return e[Nt]||null}(e)}function gn(e){return function(e){return e[jt]||null}(e)}const vn={};function yn(e){const t={type:e.type,bootstrap:e.bootstrap||hn,declarations:e.declarations||hn,imports:e.imports||hn,exports:e.exports||hn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&rt(()=>{vn[e.id]=e.type}),t}function bn(e,t){if(null==e)return dn;const n={};for(const r in e)if(e.hasOwnProperty(r)){let i=e[r],a=i;Array.isArray(i)&&(a=i[1],i=i[0]),n[i]=r,t&&(t[i]=a)}return n}const xn=pn;function wn(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,onDestroy:e.type.prototype.ngOnDestroy||null}}function _n(e){return e[Mt]||null}function Sn(e,t){return e.hasOwnProperty(Ft)?e[Ft]:null}function En(e,t){const n=e[Rt]||null;if(!n&&!0===t)throw new Error(`Type ${_t(e)} does not have '\u0275mod' property.`);return n}const Tn=20,kn=10;function Cn(e){return Array.isArray(e)&&"object"==typeof e[1]}function In(e){return Array.isArray(e)&&!0===e[1]}function On(e){return 0!=(8&e.flags)}function An(e){return 2==(2&e.flags)}function Dn(e){return 1==(1&e.flags)}function Mn(e){return null!==e.template}function Nn(e){return 0!=(512&e[2])}class jn{constructor(e,t,n){this.previousValue=e,this.currentValue=t,this.firstChange=n}isFirstChange(){return this.firstChange}}function Rn(){const e=Fn(this),t=null==e?void 0:e.current;if(t){const n=e.previous;if(n===dn)e.previous=t;else for(let e in t)n[e]=t[e];e.current=null,this.ngOnChanges(t)}}function Pn(e,t,n,r){const i=Fn(e)||function(e,t){return e.__ngSimpleChanges__=t}(e,{previous:dn,current:null}),a=i.current||(i.current={}),o=i.previous,s=this.declaredInputs[n],l=o[s];a[s]=new jn(l&&l.currentValue,t,o===dn),e[r]=t}function Fn(e){return e.__ngSimpleChanges__||null}let Ln=void 0;function $n(e){return!!e.listen}const Bn={createRenderer:(e,t)=>void 0!==Ln?Ln:"undefined"!=typeof document?document:void 0};function zn(e){for(;Array.isArray(e);)e=e[0];return e}function Un(e,t){return zn(t[e+Tn])}function Hn(e,t){return zn(t[e.index])}function Wn(e,t){return e.data[t+Tn]}function Vn(e,t){return e[t+Tn]}function qn(e,t){const n=t[e];return Cn(n)?n:n[0]}function Gn(e){const t=function(e){return e.__ngContext__||null}(e);return t?Array.isArray(t)?t:t.lView:null}function Yn(e){return 4==(4&e[2])}function Xn(e){return 128==(128&e[2])}function Kn(e,t){return null===e||null==t?null:e[t]}function Zn(e){e[18]=0}function Jn(e,t){e[5]+=t;let n=e,r=e[3];for(;null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}const Qn={lFrame:xr(null),bindingsEnabled:!0,checkNoChangesMode:!1};function er(){return Qn.bindingsEnabled}function tr(){return Qn.lFrame.lView}function nr(){return Qn.lFrame.tView}function rr(e){Qn.lFrame.contextLView=e}function ir(){return Qn.lFrame.currentTNode}function ar(e,t){Qn.lFrame.currentTNode=e,Qn.lFrame.isParent=t}function or(){return Qn.lFrame.isParent}function sr(){return Qn.checkNoChangesMode}function lr(e){Qn.checkNoChangesMode=e}function ur(){const e=Qn.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function cr(){return Qn.lFrame.bindingIndex}function dr(){return Qn.lFrame.bindingIndex++}function hr(e){const t=Qn.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}function fr(e,t){const n=Qn.lFrame;n.bindingIndex=n.bindingRootIndex=e,pr(t)}function pr(e){Qn.lFrame.currentDirectiveIndex=e}function mr(){return Qn.lFrame.currentQueryIndex}function gr(e){Qn.lFrame.currentQueryIndex=e}function vr(e,t){const n=br();Qn.lFrame=n,n.currentTNode=t,n.lView=e}function yr(e){const t=br(),n=e[1];Qn.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex}function br(){const e=Qn.lFrame,t=null===e?null:e.child;return null===t?xr(e):t}function xr(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:0,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null};return null!==e&&(e.child=t),t}function wr(){const e=Qn.lFrame;return Qn.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const _r=wr;function Sr(){const e=wr();e.isParent=!0,e.tView=null,e.selectedIndex=0,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Er(){return Qn.lFrame.selectedIndex}function Tr(e){Qn.lFrame.selectedIndex=e}function kr(){const e=Qn.lFrame;return Wn(e.tView,e.selectedIndex)}function Cr(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const t=e.data[n].type.prototype,{ngAfterContentInit:r,ngAfterContentChecked:i,ngAfterViewInit:a,ngAfterViewChecked:o,ngOnDestroy:s}=t;r&&(e.contentHooks||(e.contentHooks=[])).push(-n,r),i&&((e.contentHooks||(e.contentHooks=[])).push(n,i),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,i)),a&&(e.viewHooks||(e.viewHooks=[])).push(-n,a),o&&((e.viewHooks||(e.viewHooks=[])).push(n,o),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,o)),null!=s&&(e.destroyHooks||(e.destroyHooks=[])).push(n,s)}}function Ir(e,t,n){Dr(e,t,3,n)}function Or(e,t,n,r){(3&e[2])===n&&Dr(e,t,n,r)}function Ar(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function Dr(e,t,n,r){const i=null!=r?r:-1;let a=0;for(let o=void 0!==r?65535&e[18]:0;o<t.length;o++)if("number"==typeof t[o+1]){if(a=t[o],null!=r&&a>=r)break}else t[o]<0&&(e[18]+=65536),(a<i||-1==i)&&(Mr(e,n,t,o),e[18]=(4294901760&e[18])+o+2),o++}function Mr(e,t,n,r){const i=n[r]<0,a=n[r+1],o=e[i?-n[r]:n[r]];i?e[2]>>11<e[18]>>16&&(3&e[2])===t&&(e[2]+=2048,a.call(o)):a.call(o)}const Nr=-1;class jr{constructor(e,t,n){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=n}}function Rr(e,t,n){const r=$n(e);let i=0;for(;i<n.length;){const a=n[i];if("number"==typeof a){if(0!==a)break;i++;const o=n[i++],s=n[i++],l=n[i++];r?e.setAttribute(t,s,l,o):t.setAttributeNS(o,s,l)}else{const o=a,s=n[++i];Fr(o)?r&&e.setProperty(t,o,s):r?e.setAttribute(t,o,s):t.setAttribute(o,s),i++}}return i}function Pr(e){return 3===e||4===e||6===e}function Fr(e){return 64===e.charCodeAt(0)}function Lr(e,t){if(null===t||0===t.length);else if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const i=t[r];"number"==typeof i?n=i:0===n||$r(e,n,i,null,-1===n||2===n?t[++r]:null)}}return e}function $r(e,t,n,r,i){let a=0,o=e.length;if(-1===t)o=-1;else for(;a<e.length;){const n=e[a++];if("number"==typeof n){if(n===t){o=-1;break}if(n>t){o=a-1;break}}}for(;a<e.length;){const t=e[a];if("number"==typeof t)break;if(t===n){if(null===r)return void(null!==i&&(e[a+1]=i));if(r===e[a+1])return void(e[a+2]=i)}a++,null!==r&&a++,null!==i&&a++}-1!==o&&(e.splice(o,0,t),a=o+1),e.splice(a++,0,n),null!==r&&e.splice(a++,0,r),null!==i&&e.splice(a++,0,i)}function Br(e){return e!==Nr}function zr(e){return 32767&e}function Ur(e,t){let n=e>>16,r=t;for(;n>0;)r=r[15],n--;return r}function Hr(e){return"string"==typeof e?e:null==e?"":""+e}function Wr(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Hr(e)}const Vr=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Dt))();function qr(e){return e instanceof Function?e():e}let Gr=!0;function Yr(e){const t=Gr;return Gr=e,t}let Xr=0;function Kr(e,t){const n=Jr(e,t);if(-1!==n)return n;const r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,Zr(r.data,e),Zr(t,null),Zr(r.blueprint,null));const i=Qr(e,t),a=e.injectorIndex;if(Br(i)){const e=zr(i),n=Ur(i,t),r=n[1].data;for(let i=0;i<8;i++)t[a+i]=n[e+i]|r[e+i]}return t[a+8]=i,a}function Zr(e,t){e.push(0,0,0,0,0,0,0,0,t)}function Jr(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function Qr(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,i=t;for(;null!==i;){const e=i[1],t=e.type;if(r=2===t?e.declTNode:1===t?i[6]:null,null===r)return Nr;if(n++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return Nr}function ei(e,t,n){!function(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(Lt)&&(r=n[Lt]),null==r&&(r=n[Lt]=Xr++);const i=255&r,a=1<<i,o=64&i,s=32&i,l=t.data;128&i?o?s?l[e+7]|=a:l[e+6]|=a:s?l[e+5]|=a:l[e+4]|=a:o?s?l[e+3]|=a:l[e+2]|=a:s?l[e+1]|=a:l[e]|=a}(e,t,n)}function ti(e,t,n,r=ct.Default,i){if(null!==e){const i=function(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(Lt)?e[Lt]:void 0;return"number"==typeof t&&t>0?255&t:t}(n);if("function"==typeof i){vr(t,e);try{const e=i();if(null!=e||r&ct.Optional)return e;throw new Error(`No provider for ${Wr(n)}!`)}finally{_r()}}else if("number"==typeof i){if(-1===i)return new li(e,t);let a=null,o=Jr(e,t),s=Nr,l=r&ct.Host?t[16][6]:null;for((-1===o||r&ct.SkipSelf)&&(s=-1===o?Qr(e,t):t[o+8],s!==Nr&&si(r,!1)?(a=t[1],o=zr(s),t=Ur(s,t)):o=-1);-1!==o;){const e=t[1];if(oi(i,o,e.data)){const e=ri(o,t,n,a,r,l);if(e!==ni)return e}s=t[o+8],s!==Nr&&si(r,t[1].data[o+8]===l)&&oi(i,o,t)?(a=e,o=zr(s),t=Ur(s,t)):o=-1}}}if(r&ct.Optional&&void 0===i&&(i=null),0==(r&(ct.Self|ct.Host))){const e=t[9],a=Yt(void 0);try{return e?e.get(n,i,r&ct.Optional):Zt(n,i,r&ct.Optional)}finally{Yt(a)}}if(r&ct.Optional)return i;throw new Error(`NodeInjector: NOT_FOUND [${Wr(n)}]`)}const ni={};function ri(e,t,n,r,i,a){const o=t[1],s=o.data[e+8],l=ii(s,o,n,null==r?An(s)&&Gr:r!=o&&2===s.type,i&ct.Host&&a===s);return null!==l?ai(t,o,l,s):ni}function ii(e,t,n,r,i){const a=e.providerIndexes,o=t.data,s=1048575&a,l=e.directiveStart,u=a>>20,c=i?s+u:e.directiveEnd;for(let d=r?s:s+u;d<c;d++){const e=o[d];if(d<l&&n===e||d>=l&&e.type===n)return d}if(i){const e=o[l];if(e&&Mn(e)&&e.type===n)return l}return null}function ai(e,t,n,r){let i=e[n];const a=t.data;if(i instanceof jr){const o=i;if(o.resolving)throw new Error("Circular dep for "+Wr(a[n]));const s=Yr(o.canSeeViewProviders);o.resolving=!0;const l=o.injectImpl?Yt(o.injectImpl):null;vr(e,r);try{i=e[n]=o.factory(void 0,a,e,r),t.firstCreatePass&&n>=r.directiveStart&&function(e,t,n){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:a}=t.type.prototype;if(r){const r=((o=t).type.prototype.ngOnChanges&&(o.setInput=Pn),Rn);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,r),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,r)}var o;i&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,i),a&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,a),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,a))}(n,a[n],t)}finally{null!==l&&Yt(l),Yr(s),o.resolving=!1,_r()}}return i}function oi(e,t,n){const r=64&e,i=32&e;let a;return a=128&e?r?i?n[t+7]:n[t+6]:i?n[t+5]:n[t+4]:r?i?n[t+3]:n[t+2]:i?n[t+1]:n[t],!!(a&1<<e)}function si(e,t){return!(e&ct.Self||e&ct.Host&&t)}class li{constructor(e,t){this._tNode=e,this._lView=t}get(e,t){return ti(this._tNode,this._lView,e,void 0,t)}}function ui(e){return e.ngDebugContext}function ci(e){return e.ngOriginalError}function di(e,...t){e.error(...t)}class hi{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),n=this._findContext(e),r=function(e){return e.ngErrorLogger||di}(e);r(this._console,"ERROR",e),t&&r(this._console,"ORIGINAL ERROR",t),n&&r(this._console,"ERROR CONTEXT",n)}_findContext(e){return e?ui(e)?ui(e):this._findContext(ci(e)):null}_findOriginalError(e){let t=ci(e);for(;t&&ci(t);)t=ci(t);return t}}let fi=!0,pi=!1;function mi(){return pi=!0,fi}function gi(e,t){e.__ngContext__=t}function vi(e,t,n){let r=e.length;for(;;){const i=e.indexOf(t,n);if(-1===i)return i;if(0===i||e.charCodeAt(i-1)<=32){const n=t.length;if(i+n===r||e.charCodeAt(i+n)<=32)return i}n=i+1}}const yi="ng-template";function bi(e,t,n){let r=0;for(;r<e.length;){let i=e[r++];if(n&&"class"===i){if(i=e[r],-1!==vi(i.toLowerCase(),t,0))return!0}else if(1===i){for(;r<e.length&&"string"==typeof(i=e[r++]);)if(i.toLowerCase()===t)return!0;return!1}}return!1}function xi(e){return 0===e.type&&e.tagName!==yi}function wi(e,t,n){return t===(0!==e.type||n?e.tagName:yi)}function _i(e,t,n){let r=4;const i=e.attrs||[],a=function(e){for(let t=0;t<e.length;t++)if(Pr(e[t]))return t;return e.length}(i);let o=!1;for(let s=0;s<t.length;s++){const l=t[s];if("number"!=typeof l){if(!o)if(4&r){if(r=2|1&r,""!==l&&!wi(e,l,n)||""===l&&1===t.length){if(Si(r))return!1;o=!0}}else{const u=8&r?l:t[++s];if(8&r&&null!==e.attrs){if(!bi(e.attrs,u,n)){if(Si(r))return!1;o=!0}continue}const c=Ei(8&r?"class":l,i,xi(e),n);if(-1===c){if(Si(r))return!1;o=!0;continue}if(""!==u){let e;e=c>a?"":i[c+1].toLowerCase();const t=8&r?e:null;if(t&&-1!==vi(t,u,0)||2&r&&u!==e){if(Si(r))return!1;o=!0}}}}else{if(!o&&!Si(r)&&!Si(l))return!1;if(o&&Si(l))continue;o=!1,r=l|1&r}}return Si(r)||o}function Si(e){return 0==(1&e)}function Ei(e,t,n,r){if(null===t)return-1;let i=0;if(r||!n){let n=!1;for(;i<t.length;){const r=t[i];if(r===e)return i;if(3===r||6===r)n=!0;else{if(1===r||2===r){let e=t[++i];for(;"string"==typeof e;)e=t[++i];continue}if(4===r)break;if(0===r){i+=4;continue}}i+=n?1:2}return-1}return function(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function Ti(e,t,n=!1){for(let r=0;r<t.length;r++)if(_i(e,t[r],n))return!0;return!1}function ki(e,t){return e?":not("+t.trim()+")":t}function Ci(e){let t=e[0],n=1,r=2,i="",a=!1;for(;n<e.length;){let o=e[n];if("string"==typeof o)if(2&r){const t=e[++n];i+="["+o+(t.length>0?'="'+t+'"':"")+"]"}else 8&r?i+="."+o:4&r&&(i+=" "+o);else""===i||Si(o)||(t+=ki(a,i),i=""),r=o,a=a||!Si(r);n++}return""!==i&&(t+=ki(a,i)),t}const Ii={};function Oi(e){const t=e[3];return In(t)?t[3]:t}function Ai(e){return Mi(e[13])}function Di(e){return Mi(e[4])}function Mi(e){for(;null!==e&&!In(e);)e=e[4];return e}function Ni(e){ji(nr(),tr(),Er()+e,sr())}function ji(e,t,n,r){if(!r)if(3==(3&t[2])){const r=e.preOrderCheckHooks;null!==r&&Ir(t,r,n)}else{const r=e.preOrderHooks;null!==r&&Or(t,r,0,n)}Tr(n)}function Ri(e,t){return e<<17|t<<2}function Pi(e){return e>>17&32767}function Fi(e){return 2|e}function Li(e){return(131068&e)>>2}function $i(e,t){return-131069&e|t<<2}function Bi(e){return 1|e}function zi(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const i=n[r],a=n[r+1];if(-1!==a){const n=e.data[a];gr(i),n.contentQueries(2,t[a],a)}}}function Ui(e,t,n){return $n(t)?t.createElement(e,n):null===n?t.createElement(e):t.createElementNS(n,e)}function Hi(e,t,n,r,i,a,o,s,l,u){const c=t.blueprint.slice();return c[0]=i,c[2]=140|r,Zn(c),c[3]=c[15]=e,c[8]=n,c[10]=o||e&&e[10],c[11]=s||e&&e[11],c[12]=l||e&&e[12]||null,c[9]=u||e&&e[9]||null,c[6]=a,c[16]=2==t.type?e[16]:c,c}function Wi(e,t,n,r,i){const a=t+Tn,o=e.data[a]||function(e,t,n,r,i){const a=ir(),o=or(),s=e.data[t]=function(e,t,n,r,i,a){return{type:n,index:r,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,tagName:i,attrs:a,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?a:a&&a.parent,n,t,r,i);return null===e.firstChild&&(e.firstChild=s),null!==a&&(o&&null==a.child&&null!==s.parent?a.child=s:o||(a.next=s)),s}(e,a,n,r,i);return ar(o,!0),o}function Vi(e,t,n){yr(t);try{const r=e.viewQuery;null!==r&&wa(1,r,n);const i=e.template;null!==i&&Yi(e,t,i,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&zi(e,t),e.staticViewQueries&&wa(2,e.viewQuery,n);const a=e.components;null!==a&&function(e,t){for(let n=0;n<t.length;n++)ga(e,t[n])}(t,a)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0),r}finally{t[2]&=-5,Sr()}}function qi(e,t,n,r){const i=t[2];if(256==(256&i))return;yr(t);const a=sr();try{Zn(t),Qn.lFrame.bindingIndex=e.bindingStartIndex,null!==n&&Yi(e,t,n,2,r);const o=3==(3&i);if(!a)if(o){const n=e.preOrderCheckHooks;null!==n&&Ir(t,n,null)}else{const n=e.preOrderHooks;null!==n&&Or(t,n,0,null),Ar(t,0)}if(function(e){for(let t=Ai(e);null!==t;t=Di(t)){if(!t[2])continue;const e=t[9];for(let t=0;t<e.length;t++){const n=e[t],r=n[3];0==(1024&n[2])&&Jn(r,1),n[2]|=1024}}}(t),function(e){for(let t=Ai(e);null!==t;t=Di(t))for(let e=kn;e<t.length;e++){const n=t[e],r=n[1];Xn(n)&&qi(r,n,r.template,n[8])}}(t),null!==e.contentQueries&&zi(e,t),!a)if(o){const n=e.contentCheckHooks;null!==n&&Ir(t,n)}else{const n=e.contentHooks;null!==n&&Or(t,n,1),Ar(t,1)}!function(e,t){try{const n=e.expandoInstructions;if(null!==n){let r=e.expandoStartIndex,i=-1,a=-1;for(let e=0;e<n.length;e++){const o=n[e];"number"==typeof o?o<=0?(a=0-o,Tr(a),r+=9+n[++e],i=r):r+=o:(null!==o&&(fr(r,i),o(2,t[i])),i++)}}}finally{Tr(-1)}}(e,t);const s=e.components;null!==s&&function(e,t){for(let n=0;n<t.length;n++)ma(e,t[n])}(t,s);const l=e.viewQuery;if(null!==l&&wa(2,l,r),!a)if(o){const n=e.viewCheckHooks;null!==n&&Ir(t,n)}else{const n=e.viewHooks;null!==n&&Or(t,n,2),Ar(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),a||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,Jn(t[3],-1))}finally{Sr()}}function Gi(e,t,n,r){const i=t[10],a=!sr(),o=Yn(t);try{a&&!o&&i.begin&&i.begin(),o&&Vi(e,t,r),qi(e,t,n,r)}finally{a&&!o&&i.end&&i.end()}}function Yi(e,t,n,r,i){const a=Er();try{Tr(-1),2&r&&t.length>Tn&&ji(e,t,0,sr()),n(r,i)}finally{Tr(a)}}function Xi(e,t,n){er()&&(function(e,t,n,r){const i=n.directiveStart,a=n.directiveEnd;e.firstCreatePass||Kr(n,t),gi(r,t);const o=n.initialInputs;for(let s=i;s<a;s++){const r=e.data[s],a=Mn(r);a&&da(t,n,r);const l=ai(t,e,s,n);gi(l,t),null!==o&&ha(0,s-i,l,r,0,o),a&&(qn(n.index,t)[8]=l)}}(e,t,n,Hn(n,t)),128==(128&n.flags)&&function(e,t,n){const r=n.directiveStart,i=n.directiveEnd,a=e.expandoInstructions,o=e.firstCreatePass,s=n.index-Tn,l=Qn.lFrame.currentDirectiveIndex;try{Tr(s);for(let n=r;n<i;n++){const r=e.data[n],i=t[n];pr(n),null!==r.hostBindings||0!==r.hostVars||null!==r.hostAttrs?aa(r,i):o&&a.push(null)}}finally{Tr(-1),pr(l)}}(e,t,n))}function Ki(e,t,n=Hn){const r=t.localNames;if(null!==r){let i=t.index+1;for(let a=0;a<r.length;a+=2){const o=r[a+1],s=-1===o?n(t,e):e[o];e[i++]=s}}}function Zi(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Ji(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function Ji(e,t,n,r,i,a,o,s,l,u){const c=Tn+r,d=c+i,h=function(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:Ii);return n}(c,d),f="function"==typeof u?u():u;return h[1]={type:e,blueprint:h,template:n,queries:null,viewQuery:s,declTNode:t,data:h.slice().fill(null,c),bindingStartIndex:c,expandoStartIndex:d,expandoInstructions:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof a?a():a,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:f,incompleteFirstPass:!1}}function Qi(e,t,n,r){const i=Sa(t);i.push(n),e.firstCreatePass&&function(e){return e.cleanup||(e.cleanup=[])}(e).push(r,i.length-1)}function ea(e,t,n){for(let r in e)if(e.hasOwnProperty(r)){const i=e[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(t,i):n[r]=[t,i]}return n}function ta(e,t,n,r,i,a,o,s){const l=Hn(t,n);let u,c=t.inputs;var d;!s&&null!=c&&(u=c[r])?(Ta(e,n,u,r,i),An(t)&&function(e,t){const n=qn(t,e);16&n[2]||(n[2]|=64)}(n,t.index)):2===t.type&&(r="class"===(d=r)?"className":"for"===d?"htmlFor":"formaction"===d?"formAction":"innerHtml"===d?"innerHTML":"readonly"===d?"readOnly":"tabindex"===d?"tabIndex":d,i=null!=o?o(i,t.tagName||"",r):i,$n(a)?a.setProperty(l,r,i):Fr(r)||(l.setProperty?l.setProperty(r,i):l[r]=i))}function na(e,t,n,r){let i=!1;if(er()){const a=function(e,t,n){const r=e.directiveRegistry;let i=null;if(r)for(let a=0;a<r.length;a++){const o=r[a];Ti(n,o.selectors,!1)&&(i||(i=[]),ei(Kr(n,t),e,o.type),Mn(o)?(sa(e,n),i.unshift(o)):i.push(o))}return i}(e,t,n),o=null===r?null:{"":-1};if(null!==a){let r=0;i=!0,ua(n,e.data.length,a.length);for(let e=0;e<a.length;e++){const t=a[e];t.providersResolver&&t.providersResolver(t)}oa(e,n,a.length);let s=!1,l=!1;for(let i=0;i<a.length;i++){const u=a[i];n.mergedAttrs=Lr(n.mergedAttrs,u.hostAttrs),ca(e,t,u),la(e.data.length-1,u,o),null!==u.contentQueries&&(n.flags|=8),null===u.hostBindings&&null===u.hostAttrs&&0===u.hostVars||(n.flags|=128);const c=u.type.prototype;!s&&(c.ngOnChanges||c.ngOnInit||c.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index-Tn),s=!0),l||!c.ngOnChanges&&!c.ngDoCheck||((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index-Tn),l=!0),ra(e,u),r+=u.hostVars}!function(e,t){const n=t.directiveEnd,r=e.data,i=t.attrs,a=[];let o=null,s=null;for(let l=t.directiveStart;l<n;l++){const e=r[l],n=e.inputs,u=null===i||xi(t)?null:fa(n,i);a.push(u),o=ea(n,l,o),s=ea(e.outputs,l,s)}null!==o&&(o.hasOwnProperty("class")&&(t.flags|=16),o.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=a,t.inputs=o,t.outputs=s}(e,n),ia(e,t,r)}o&&function(e,t,n){if(t){const r=e.localNames=[];for(let e=0;e<t.length;e+=2){const i=n[t[e+1]];if(null==i)throw new Error(`Export of name '${t[e+1]}' not found!`);r.push(t[e],i)}}}(n,r,o)}return n.mergedAttrs=Lr(n.mergedAttrs,n.attrs),i}function ra(e,t){const n=e.expandoInstructions;n.push(t.hostBindings),0!==t.hostVars&&n.push(t.hostVars)}function ia(e,t,n){for(let r=0;r<n;r++)t.push(Ii),e.blueprint.push(Ii),e.data.push(null)}function aa(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function oa(e,t,n){const r=Tn-t.index,i=e.data.length-(1048575&t.providerIndexes);(e.expandoInstructions||(e.expandoInstructions=[])).push(r,i,n)}function sa(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function la(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;Mn(t)&&(n[""]=e)}}function ua(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function ca(e,t,n){e.data.push(n);const r=n.factory||(n.factory=Sn(n.type)),i=new jr(r,Mn(n),null);e.blueprint.push(i),t.push(i)}function da(e,t,n){const r=Hn(t,e),i=Zi(n),a=e[10],o=va(e,Hi(e,i,null,n.onPush?64:16,r,t,a,a.createRenderer(r,n),null,null));e[t.index]=o}function ha(e,t,n,r,i,a){const o=a[t];if(null!==o){const e=r.setInput;for(let t=0;t<o.length;){const i=o[t++],a=o[t++],s=o[t++];null!==e?r.setInput(n,s,i,a):n[a]=s}}}function fa(e,t){let n=null,r=0;for(;r<t.length;){const i=t[r];if(0!==i)if(5!==i){if("number"==typeof i)break;e.hasOwnProperty(i)&&(null===n&&(n=[]),n.push(i,e[i],t[r+1])),r+=2}else r+=2;else r+=4}return n}function pa(e,t,n,r){return new Array(e,!0,!1,t,null,0,r,n,null,null)}function ma(e,t){const n=qn(t,e);if(Xn(n)){const e=n[1];80&n[2]?qi(e,n,e.template,n[8]):n[5]>0&&function e(t){for(let r=Ai(t);null!==r;r=Di(r))for(let t=kn;t<r.length;t++){const n=r[t];if(1024&n[2]){const e=n[1];qi(e,n,e.template,n[8])}else n[5]>0&&e(n)}const n=t[1].components;if(null!==n)for(let r=0;r<n.length;r++){const i=qn(n[r],t);Xn(i)&&i[5]>0&&e(i)}}(n)}}function ga(e,t){const n=qn(t,e),r=n[1];!function(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])}(r,n),Vi(r,n,n[8])}function va(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function ya(e){for(;e;){e[2]|=64;const t=Oi(e);if(Nn(e)&&!t)return e;e=t}return null}function ba(e,t,n){const r=t[10];r.begin&&r.begin();try{qi(e,t,e.template,n)}catch(i){throw Ea(t,i),i}finally{r.end&&r.end()}}function xa(e){!function(e){for(let t=0;t<e.components.length;t++){const n=e.components[t],r=Gn(n),i=r[1];Gi(i,r,i.template,n)}}(e[8])}function wa(e,t,n){gr(0),t(e,n)}const _a=(()=>Promise.resolve(null))();function Sa(e){return e[7]||(e[7]=[])}function Ea(e,t){const n=e[9],r=n?n.get(hi,null):null;r&&r.handleError(t)}function Ta(e,t,n,r,i){for(let a=0;a<n.length;){const o=n[a++],s=n[a++],l=t[o],u=e.data[o];null!==u.setInput?u.setInput(l,i,r,s):l[s]=i}}function ka(e,t,n){const r=Un(t,e),i=e[11];$n(i)?i.setValue(r,n):r.textContent=n}function Ca(e,t,n,r,i){if(null!=r){let a,o=!1;In(r)?a=r:Cn(r)&&(o=!0,r=r[0]);const s=zn(r);0===e&&null!==n?null==i?Na(t,n,s):Ma(t,n,s,i||null):1===e&&null!==n?Ma(t,n,s,i||null):2===e?function(e,t,n){const r=Ra(e,t);r&&function(e,t,n,r){$n(e)?e.removeChild(t,n,r):t.removeChild(n)}(e,r,t,n)}(t,s,o):3===e&&t.destroyNode(s),null!=a&&function(e,t,n,r,i){const a=n[7];a!==zn(n)&&Ca(t,e,r,a,i);for(let o=kn;o<n.length;o++){const i=n[o];La(i[1],i,e,t,r,a)}}(t,e,a,n,i)}}function Ia(e,t){const n=e[9],r=n.indexOf(t),i=t[3];1024&t[2]&&(t[2]&=-1025,Jn(i,-1)),n.splice(r,1)}function Oa(e,t){if(e.length<=kn)return;const n=kn+t,r=e[n];if(r){const a=r[17];null!==a&&a!==e&&Ia(a,r),t>0&&(e[n-1][4]=r[4]);const o=an(e,kn+t);La(r[1],i=r,i[11],2,null,null),i[0]=null,i[6]=null;const s=o[19];null!==s&&s.detachView(o[1]),r[3]=null,r[4]=null,r[2]&=-129}var i;return r}function Aa(e,t){if(!(256&t[2])){const n=t[11];$n(n)&&n.destroyNode&&La(e,t,n,3,null,null),function(e){let t=e[13];if(!t)return Da(e[1],e);for(;t;){let n=null;if(Cn(t))n=t[13];else{const e=t[10];e&&(n=e)}if(!n){for(;t&&!t[4]&&t!==e;)Cn(t)&&Da(t[1],t),t=t[3];null===t&&(t=e),Cn(t)&&Da(t[1],t),n=t&&t[4]}t=n}}(t)}}function Da(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const e=t[n[r]];if(!(e instanceof jr)){const t=n[r+1];if(Array.isArray(t))for(let n=0;n<t.length;n+=2)t[n+1].call(e[t[n]]);else t.call(e)}}}(e,t),function(e,t){const n=e.cleanup;if(null!==n){const e=t[7];for(let r=0;r<n.length-1;r+=2)if("string"==typeof n[r]){const i=n[r+1],a="function"==typeof i?i(t):zn(t[i]),o=e[n[r+2]],s=n[r+3];"boolean"==typeof s?a.removeEventListener(n[r],o,s):s>=0?e[s]():e[-s].unsubscribe(),r+=2}else n[r].call(e[n[r+1]]);t[7]=null}}(e,t),1===t[1].type&&$n(t[11])&&t[11].destroy();const n=t[17];if(null!==n&&In(t[3])){n!==t[3]&&Ia(n,t);const r=t[19];null!==r&&r.detachView(e)}}}function Ma(e,t,n,r){$n(e)?e.insertBefore(t,n,r):t.insertBefore(n,r,!0)}function Na(e,t,n){$n(e)?e.appendChild(t,n):t.appendChild(n)}function ja(e,t,n,r){null!==r?Ma(e,t,n,r):Na(e,t,n)}function Ra(e,t){return $n(e)?e.parentNode(t):t.parentNode}function Pa(e,t,n,r){const i=function(e,t,n){let r=t.parent;for(;null!=r&&(3===r.type||4===r.type);)r=(t=r).parent;if(null===r)return n[0];if(t&&4===t.type&&4&t.flags)return Hn(t,n).parentNode;if(2&r.flags){const t=e.data,n=t[t[r.index].directiveStart].encapsulation;if(n!==cn.ShadowDom&&n!==cn.Native)return null}return Hn(r,n)}(e,r,t);if(null!=i){const e=t[11],a=function(e,t){return 3===e.type||4===e.type?Hn(e,t):null}(r.parent||t[6],t);if(Array.isArray(n))for(let t=0;t<n.length;t++)ja(e,i,n[t],a);else ja(e,i,n,a)}}function Fa(e,t,n,r,i,a,o){for(;null!=n;){const s=r[n.index],l=n.type;o&&0===t&&(s&&gi(zn(s),r),n.flags|=4),64!=(64&n.flags)&&(3===l||4===l?(Fa(e,t,n.child,r,i,a,!1),Ca(t,e,i,s,a)):1===l?$a(e,t,r,n,i,a):Ca(t,e,i,s,a)),n=o?n.projectionNext:n.next}}function La(e,t,n,r,i,a){Fa(n,r,e.firstChild,t,i,a,!1)}function $a(e,t,n,r,i,a){const o=n[16],s=o[6].projection[r.projection];if(Array.isArray(s))for(let l=0;l<s.length;l++)Ca(t,e,i,s[l],a);else Fa(e,t,s,o[3],i,a,!0)}function Ba(e,t,n){$n(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function za(e,t,n){$n(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}class Ua{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._viewContainerRef=null}get rootNodes(){const e=this._lView,t=e[1];return function e(t,n,r,i,a=!1){for(;null!==r;){const o=n[r.index];if(null!==o&&i.push(zn(o)),In(o))for(let t=kn;t<o.length;t++){const n=o[t],r=n[1].firstChild;null!==r&&e(n[1],n,r,i)}const s=r.type;if(3===s||4===s)e(t,n,r.child,i);else if(1===s){const t=n[16],a=t[6].projection[r.projection];if(Array.isArray(a))i.push(...a);else{const n=Oi(t);e(n[1],n,a,i,!0)}}r=a?r.projectionNext:r.next}return i}(t,e,t.firstChild,[])}get context(){return this._lView[8]}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._viewContainerRef){const e=this._viewContainerRef.indexOf(this);e>-1&&this._viewContainerRef.detach(e),this._viewContainerRef=null}Aa(this._lView[1],this._lView)}onDestroy(e){Qi(this._lView[1],this._lView,null,e)}markForCheck(){ya(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){ba(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(e,t,n){lr(!0);try{ba(e,t,n)}finally{lr(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(e){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=e}detachFromAppRef(){var e;this._appRef=null,La(this._lView[1],e=this._lView,e[11],2,null,null)}attachToAppRef(e){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}class Ha extends Ua{constructor(e){super(e),this._view=e}detectChanges(){xa(this._view)}checkNoChanges(){!function(e){lr(!0);try{xa(e)}finally{lr(!1)}}(this._view)}get context(){return null}}let Wa,Va,qa;function Ga(e,t,n){return Wa||(Wa=class extends e{}),new Wa(Hn(t,n))}function Ya(e,t,n,r){return Va||(Va=class extends e{constructor(e,t,n){super(),this._declarationView=e,this._declarationTContainer=t,this.elementRef=n}createEmbeddedView(e){const t=this._declarationTContainer.tViews,n=Hi(this._declarationView,t,e,16,null,t.declTNode,null,null,null,null);n[17]=this._declarationView[this._declarationTContainer.index];const r=this._declarationView[19];return null!==r&&(n[19]=r.createEmbeddedView(t)),Vi(t,n,e),new Ua(n)}}),0===n.type?new Va(r,n,Ga(t,n,r)):null}function Xa(e,t,n,r){let i;qa||(qa=class extends e{constructor(e,t,n){super(),this._lContainer=e,this._hostTNode=t,this._hostView=n}get element(){return Ga(t,this._hostTNode,this._hostView)}get injector(){return new li(this._hostTNode,this._hostView)}get parentInjector(){const e=Qr(this._hostTNode,this._hostView);if(Br(e)){const t=Ur(e,this._hostView),n=zr(e);return new li(t[1].data[n+8],t)}return new li(null,this._hostView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){return null!==this._lContainer[8]&&this._lContainer[8][e]||null}get length(){return this._lContainer.length-kn}createEmbeddedView(e,t,n){const r=e.createEmbeddedView(t||{});return this.insert(r,n),r}createComponent(e,t,n,r,i){const a=n||this.parentInjector;if(!i&&null==e.ngModule&&a){const e=a.get(en,null);e&&(i=e)}const o=e.create(a,r,void 0,i);return this.insert(o.hostView,t),o}insert(e,t){const n=e._lView,r=n[1];if(e.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");if(this.allocateContainerIfNeeded(),In(n[3])){const t=this.indexOf(e);if(-1!==t)this.detach(t);else{const t=n[3],r=new qa(t,t[6],t[3]);r.detach(r.indexOf(e))}}const i=this._adjustIndex(t),a=this._lContainer;!function(e,t,n,r){const i=kn+r,a=n.length;r>0&&(n[i-1][4]=t),r<a-kn?(t[4]=n[i],rn(n,kn+r,t)):(n.push(t),t[4]=null),t[3]=n;const o=t[17];null!==o&&n!==o&&function(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(o,t);const s=t[19];null!==s&&s.insertView(e),t[2]|=128}(r,n,a,i);const o=function e(t,n){const r=kn+t+1;if(r<n.length){const t=n[r],i=t[1].firstChild;if(null!==i)return function t(n,r){if(null!==r){const i=r.type;if(2===i)return Hn(r,n);if(0===i)return e(-1,n[r.index]);if(3===i||4===i){const i=r.child;if(null!==i)return t(n,i);{const t=n[r.index];return In(t)?e(-1,t):zn(t)}}{const e=n[16],i=e[6],a=Oi(e),o=i.projection[r.projection];return null!=o?t(a,o):t(n,r.next)}}return null}(t,i)}return n[7]}(i,a),s=n[11],l=Ra(s,a[7]);return null!==l&&function(e,t,n,r,i,a){r[0]=i,r[6]=t,La(e,r,n,1,i,a)}(r,a[6],s,n,l,o),e.attachToViewContainerRef(this),rn(a[8],i,e),e}move(e,t){if(e.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");return this.insert(e,t)}indexOf(e){const t=this._lContainer[8];return null!==t?t.indexOf(e):-1}remove(e){this.allocateContainerIfNeeded();const t=this._adjustIndex(e,-1),n=Oa(this._lContainer,t);n&&(an(this._lContainer[8],t),Aa(n[1],n))}detach(e){this.allocateContainerIfNeeded();const t=this._adjustIndex(e,-1),n=Oa(this._lContainer,t);return n&&null!=an(this._lContainer[8],t)?new Ua(n):null}_adjustIndex(e,t=0){return null==e?this.length+t:e}allocateContainerIfNeeded(){null===this._lContainer[8]&&(this._lContainer[8]=[])}});const a=r[n.index];if(In(a))i=a;else{let e;if(3===n.type)e=zn(a);else if(e=r[11].createComment(""),Nn(r)){const t=r[11],i=Hn(n,r);Ma(t,Ra(t,i),e,function(e,t){return $n(e)?e.nextSibling(t):t.nextSibling}(t,i))}else Pa(r[1],r,e,n);r[n.index]=i=pa(a,r,e,n),va(r,i)}return new qa(i,n,r)}let Ka=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>Za(),e})();const Za=function(e=!1){return function(e,t,n){if(!n&&An(e)){const n=qn(e.index,t);return new Ua(n,n)}return 2===e.type||0===e.type||3===e.type||4===e.type?new Ua(t[16],t):null}(ir(),tr(),e)},Ja=Function,Qa=new $t("Set Injector scope."),eo={},to={},no=[];let ro=void 0;function io(){return void 0===ro&&(ro=new Qt),ro}function ao(e,t=null,n=null,r){return new oo(e,n,t||io(),r)}class oo{constructor(e,t,n,r=null){this.parent=n,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const i=[];t&&nn(t,n=>this.processProvider(n,e,t)),nn([e],e=>this.processInjectorType(e,[],i)),this.records.set(Bt,lo(void 0,this));const a=this.records.get(Qa);this.scope=null!=a?a.value:null,this.source=r||("object"==typeof e?null:_t(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=zt,n=ct.Default){this.assertNotDestroyed();const r=Gt(this);try{if(!(n&ct.SkipSelf)){let t=this.records.get(e);if(void 0===t){const n=("function"==typeof(i=e)||"object"==typeof i&&i instanceof $t)&&pt(e);t=n&&this.injectableDefInScope(n)?lo(so(e),eo):null,this.records.set(e,t)}if(null!=t)return this.hydrate(e,t)}return(n&ct.Self?io():this.parent).get(e,t=n&ct.Optional&&t===zt?null:t)}catch(a){if("NullInjectorError"===a.name){if((a.ngTempTokenPath=a.ngTempTokenPath||[]).unshift(_t(e)),r)throw a;return function(e,t,n,r){const i=e.ngTempTokenPath;throw t[Ht]&&i.unshift(t[Ht]),e.message=function(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let i=_t(t);if(Array.isArray(t))i=t.map(_t).join(" -> ");else if("object"==typeof t){let e=[];for(let n in t)if(t.hasOwnProperty(n)){let r=t[n];e.push(n+":"+("string"==typeof r?JSON.stringify(r):_t(r)))}i=`{${e.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${e.replace(Ut,"\n  ")}`}("\n"+e.message,i,n,r),e.ngTokenPath=i,e.ngTempTokenPath=null,e}(a,e,"R3InjectorError",this.source)}throw a}finally{Gt(r)}var i}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((t,n)=>e.push(_t(n))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(e,t,n){if(!(e=kt(e)))return!1;let r=gt(e);const i=null==r&&e.ngModule||void 0,a=void 0===i?e:i,o=-1!==n.indexOf(a);if(void 0!==i&&(r=gt(i)),null==r)return!1;if(null!=r.imports&&!o){let e;n.push(a);try{nn(r.imports,r=>{this.processInjectorType(r,t,n)&&(void 0===e&&(e=[]),e.push(r))})}finally{}if(void 0!==e)for(let t=0;t<e.length;t++){const{ngModule:n,providers:r}=e[t];nn(r,e=>this.processProvider(e,n,r||no))}}this.injectorDefTypes.add(a),this.records.set(a,lo(r.factory,eo));const s=r.providers;if(null!=s&&!o){const t=e;nn(s,e=>this.processProvider(e,t,s))}return void 0!==i&&void 0!==e.providers}processProvider(e,t,n){let r=co(e=kt(e))?e:kt(e&&e.provide);const i=function(e,t,n){return uo(e)?lo(void 0,e.useValue):lo(function(e,t,n){let r=void 0;if(co(e)){const t=kt(e);return Sn(t)||so(t)}if(uo(e))r=()=>kt(e.useValue);else if((i=e)&&i.useFactory)r=()=>e.useFactory(...Jt(e.deps||[]));else if(function(e){return!(!e||!e.useExisting)}(e))r=()=>Kt(kt(e.useExisting));else{const t=kt(e&&(e.useClass||e.provide));if(!function(e){return!!e.deps}(e))return Sn(t)||so(t);r=()=>new t(...Jt(e.deps))}var i;return r}(e),eo)}(e);if(co(e)||!0!==e.multi)this.records.get(r);else{let t=this.records.get(r);t||(t=lo(void 0,eo,!0),t.factory=()=>Jt(t.multi),this.records.set(r,t)),r=e,t.multi.push(e)}this.records.set(r,i)}hydrate(e,t){var n;return t.value===eo&&(t.value=to,t.value=t.factory()),"object"==typeof t.value&&t.value&&null!==(n=t.value)&&"object"==typeof n&&"function"==typeof n.ngOnDestroy&&this.onDestroy.add(t.value),t.value}injectableDefInScope(e){return!!e.providedIn&&("string"==typeof e.providedIn?"any"===e.providedIn||e.providedIn===this.scope:this.injectorDefTypes.has(e.providedIn))}}function so(e){const t=pt(e),n=null!==t?t.factory:Sn(e);if(null!==n)return n;const r=gt(e);if(null!==r)return r.factory;if(e instanceof $t)throw new Error(`Token ${_t(e)} is missing a \u0275prov definition.`);if(e instanceof Function)return function(e){const t=e.length;if(t>0){const n=function(e,t){const n=[];for(let r=0;r<e;r++)n.push("?");return n}(t);throw new Error(`Can't resolve all parameters for ${_t(e)}: (${n.join(", ")}).`)}const n=function(e){const t=e&&(e[vt]||e[xt]||e[bt]&&e[bt]());if(t){const n=function(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Error("unreachable")}function lo(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function uo(e){return null!==e&&"object"==typeof e&&Wt in e}function co(e){return"function"==typeof e}const ho=function(e,t,n){return function(e,t=null,n=null,r){const i=ao(e,t,n,r);return i._resolveInjectorDefTypes(),i}({name:n},t,e,n)};let fo=(()=>{class e{static create(e,t){return Array.isArray(e)?ho(e,t,""):ho(e.providers,e.parent,e.name||"")}}return e.THROW_IF_NOT_FOUND=zt,e.NULL=new Qt,e.\u0275prov=ht({token:e,providedIn:"any",factory:()=>Kt(Bt)}),e.__NG_ELEMENT_ID__=-1,e})();const po=new $t("AnalyzeForEntryComponents");function mo(e,t,n){let r=n?e.styles:null,i=n?e.classes:null,a=0;if(null!==t)for(let o=0;o<t.length;o++){const e=t[o];"number"==typeof e?a=e:1==a?i=St(i,e):2==a&&(r=St(r,e+": "+t[++o]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=i:e.classesWithoutHost=i}function go(e,t){const n=Gn(e)[1],r=n.data.length-1;Cr(n,{directiveStart:r,directiveEnd:r+1})}let vo=null;function yo(){if(!vo){const e=Dt.Symbol;if(e&&e.iterator)vo=e.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const n=e[t];"entries"!==n&&"size"!==n&&Map.prototype[n]===Map.prototype.entries&&(vo=n)}}}return vo}class bo{constructor(e){this.wrapped=e}static wrap(e){return new bo(e)}static unwrap(e){return bo.isWrapped(e)?e.wrapped:e}static isWrapped(e){return e instanceof bo}}function xo(e){return!!wo(e)&&(Array.isArray(e)||!(e instanceof Map)&&yo()in e)}function wo(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function _o(e,t,n){return e[t]=n}function So(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function Eo(e,t,n,r){return So(e,dr(),n)?t+Hr(n)+r:Ii}function To(e,t,n,r,i,a,o,s){const l=tr(),u=nr(),c=e+Tn,d=u.firstCreatePass?function(e,t,n,r,i,a,o,s,l){const u=t.consts,c=Wi(t,e,0,o||null,Kn(u,s));na(t,n,c,Kn(u,l)),Cr(t,c);const d=c.tViews=Ji(2,c,r,i,a,t.directiveRegistry,t.pipeRegistry,null,t.schemas,u);return null!==t.queries&&(t.queries.template(t,c),d.queries=t.queries.embeddedTView(c)),c}(e,u,l,t,n,r,i,a,o):u.data[c];ar(d,!1);const h=l[11].createComment("");Pa(u,l,h,d),gi(h,l),va(l,l[c]=pa(h,l,h,d)),Dn(d)&&Xi(u,l,d),null!=o&&Ki(l,d,s)}function ko(e){return Vn(Qn.lFrame.contextLView,e)}function Co(e,t=ct.Default){const n=tr();return null===n?Kt(e,t):ti(ir(),n,kt(e),t)}function Io(e,t,n){const r=tr();return So(r,dr(),t)&&ta(nr(),kr(),r,e,t,r[11],n,!1),Io}function Oo(e,t,n,r,i){const a=i?"class":"style";Ta(e,n,t.inputs[a],a,r)}function Ao(e,t,n,r){const i=tr(),a=nr(),o=Tn+e,s=i[11],l=i[o]=Ui(t,s,Qn.lFrame.currentNamespace),u=a.firstCreatePass?function(e,t,n,r,i,a,o){const s=t.consts,l=Wi(t,e,2,i,Kn(s,a));return na(t,n,l,Kn(s,o)),null!==l.attrs&&mo(l,l.attrs,!1),null!==l.mergedAttrs&&mo(l,l.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,l),l}(e,a,i,0,t,n,r):a.data[o];ar(u,!0);const c=u.mergedAttrs;null!==c&&Rr(s,l,c);const d=u.classes;null!==d&&za(s,l,d);const h=u.styles;null!==h&&Ba(s,l,h),Pa(a,i,l,u),0===Qn.lFrame.elementDepthCount&&gi(l,i),Qn.lFrame.elementDepthCount++,Dn(u)&&(Xi(a,i,u),function(e,t,n){if(On(t)){const r=t.directiveEnd;for(let i=t.directiveStart;i<r;i++){const t=e.data[i];t.contentQueries&&t.contentQueries(1,n[i],i)}}}(a,u,i)),null!==r&&Ki(i,u)}function Do(){let e=ir();or()?Qn.lFrame.isParent=!1:(e=e.parent,ar(e,!1));const t=e;Qn.lFrame.elementDepthCount--;const n=nr();n.firstCreatePass&&(Cr(n,e),On(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function(e){return 0!=(16&e.flags)}(t)&&Oo(n,t,tr(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function(e){return 0!=(32&e.flags)}(t)&&Oo(n,t,tr(),t.stylesWithoutHost,!1)}function Mo(e,t,n,r){Ao(e,t,n,r),Do()}function No(){return tr()}function jo(e){return!!e&&"function"==typeof e.then}function Ro(e,t,n=!1,r){const i=tr(),a=nr(),o=ir();return function(e,t,n,r,i,a,o=!1,s){const l=Dn(r),u=e.firstCreatePass&&(e.cleanup||(e.cleanup=[])),c=Sa(t);let d=!0;if(2===r.type){const h=Hn(r,t),f=s?s(h):dn,p=f.target||h,m=c.length,g=s?e=>s(zn(e[r.index])).target:r.index;if($n(n)){let o=null;if(!s&&l&&(o=function(e,t,n,r){const i=e.cleanup;if(null!=i)for(let a=0;a<i.length-1;a+=2){const e=i[a];if(e===n&&i[a+1]===r){const e=t[7],n=i[a+2];return e.length>n?e[n]:null}"string"==typeof e&&(a+=2)}return null}(e,t,i,r.index)),null!==o)(o.__ngLastListenerFn__||o).__ngNextListenerFn__=a,o.__ngLastListenerFn__=a,d=!1;else{a=Fo(r,t,a,!1);const e=n.listen(f.name||p,i,a);c.push(a,e),u&&u.push(i,g,m,m+1)}}else a=Fo(r,t,a,!0),p.addEventListener(i,a,o),c.push(a),u&&u.push(i,g,m,o)}const h=r.outputs;let f;if(d&&null!==h&&(f=h[i])){const e=f.length;if(e)for(let n=0;n<e;n+=2){const e=t[f[n]][f[n+1]].subscribe(a),o=c.length;c.push(a,e),u&&u.push(i,r.index,o,-(o+1))}}}(a,i,i[11],o,e,t,n,r),Ro}function Po(e,t,n){try{return!1!==t(n)}catch(r){return Ea(e,r),!1}}function Fo(e,t,n,r){return function i(a){if(a===Function)return n;const o=2&e.flags?qn(e.index,t):t;0==(32&t[2])&&ya(o);let s=Po(t,n,a),l=i.__ngNextListenerFn__;for(;l;)s=Po(t,l,a)&&s,l=l.__ngNextListenerFn__;return r&&!1===s&&(a.preventDefault(),a.returnValue=!1),s}}function Lo(e=1){return function(e){return(Qn.lFrame.contextLView=function(e,t){for(;e>0;)t=t[15],e--;return t}(e,Qn.lFrame.contextLView))[8]}(e)}function $o(e,t,n){return Bo(e,"",t,"",n),$o}function Bo(e,t,n,r,i){const a=tr(),o=Eo(a,t,n,r);return o!==Ii&&ta(nr(),kr(),a,e,o,a[11],i,!1),Bo}const zo=[];function Uo(e,t,n,r,i){const a=e[n+1],o=null===t;let s=r?Pi(a):Li(a),l=!1;for(;0!==s&&(!1===l||o);){const n=e[s+1];Ho(e[s],t)&&(l=!0,e[s+1]=r?Bi(n):Fi(n)),s=r?Pi(n):Li(n)}l&&(e[n+1]=r?Fi(a):Bi(a))}function Ho(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&ln(e,t)>=0}function Wo(e,t,n){return function(e,t,n,r){const i=tr(),a=nr(),o=hr(2);a.firstUpdatePass&&function(e,t,n,r){const i=e.data;if(null===i[n+1]){const a=i[Er()+Tn],o=function(e,t){return t>=e.expandoStartIndex}(e,n);(function(e,t){return 0!=(32&e.flags)})(a)&&null===t&&!o&&(t=!1),t=function(e,t,n,r){const i=function(e){const t=Qn.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let a=t.residualStyles;if(null===i)0===t.styleBindings&&(n=qo(n=Vo(null,e,t,n,r),t.attrs,r),a=null);else{const o=t.directiveStylingLast;if(-1===o||e[o]!==i)if(n=Vo(i,e,t,n,r),null===a){let n=function(e,t,n){const r=t.styleBindings;if(0!==Li(r))return e[Pi(r)]}(e,t);void 0!==n&&Array.isArray(n)&&(n=Vo(null,e,t,n[1],r),n=qo(n,t.attrs,r),function(e,t,n,r){e[Pi(t.styleBindings)]=r}(e,t,0,n))}else a=function(e,t,n){let r=void 0;const i=t.directiveEnd;for(let a=1+t.directiveStylingLast;a<i;a++)r=qo(r,e[a].hostAttrs,false);return qo(r,t.attrs,false)}(e,t)}return void 0!==a&&(t.residualStyles=a),n}(i,a,t,r),function(e,t,n,r,i,a){let o=t.styleBindings,s=Pi(o),l=Li(o);e[r]=n;let u,c=!1;if(Array.isArray(n)){const e=n;u=e[1],(null===u||ln(e,u)>0)&&(c=!0)}else u=n;if(i)if(0!==l){const t=Pi(e[s+1]);e[r+1]=Ri(t,s),0!==t&&(e[t+1]=$i(e[t+1],r)),e[s+1]=131071&e[s+1]|r<<17}else e[r+1]=Ri(s,0),0!==s&&(e[s+1]=$i(e[s+1],r)),s=r;else e[r+1]=Ri(l,0),0===s?s=r:e[l+1]=$i(e[l+1],r),l=r;c&&(e[r+1]=Fi(e[r+1])),Uo(e,u,r,!0),Uo(e,u,r,!1),function(e,t,n,r,i){const a=e.residualStyles;null!=a&&"string"==typeof t&&ln(a,t)>=0&&(n[r+1]=Bi(n[r+1]))}(t,u,e,r),o=Ri(s,l),t.styleBindings=o}(i,a,t,n,o)}}(a,e,o,false),t!==Ii&&So(i,o,t)&&function(e,t,n,r,i,a,o,s){if(2!==t.type)return;const l=e.data,u=l[s+1];Yo(1==(1&u)?Go(l,t,n,i,Li(u),o):void 0)||(Yo(a)||function(e){return 2==(2&e)}(u)&&(a=Go(l,null,n,i,s,o)),function(e,t,n,r,i){const a=$n(e);{const t=-1==r.indexOf("-")?void 0:2;null==i?a?e.removeStyle(n,r,t):n.style.removeProperty(r):a?e.setStyle(n,r,i,t):n.style.setProperty(r,i)}}(r,0,Un(Er(),n),i,a))}(a,a.data[Er()+Tn],i,i[11],e,i[o+1]=function(e,t){return null==e||("string"==typeof t?e+=t:"object"==typeof e&&(e=_t(function(e){return e instanceof class{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return"SafeValue must use [property]=binding: "+this.changingThisBreaksApplicationSecurity+" (see http://g.co/ng/security#xss)"}}?e.changingThisBreaksApplicationSecurity:e}(e)))),e}(t,n),false,o)}(e,t,n),Wo}function Vo(e,t,n,r,i){let a=null;const o=n.directiveEnd;let s=n.directiveStylingLast;for(-1===s?s=n.directiveStart:s++;s<o&&(a=t[s],r=qo(r,a.hostAttrs,i),a!==e);)s++;return null!==e&&(n.directiveStylingLast=s),r}function qo(e,t,n){const r=n?1:2;let i=-1;if(null!==t)for(let a=0;a<t.length;a++){const o=t[a];"number"==typeof o?i=o:i===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),on(e,o,!!n||t[++a]))}return void 0===e?null:e}function Go(e,t,n,r,i,a){const o=null===t;let s=void 0;for(;i>0;){const t=e[i],a=Array.isArray(t),l=a?t[1]:t,u=null===l;let c=n[i+1];c===Ii&&(c=u?zo:void 0);let d=u?sn(c,r):l===r?c:void 0;if(a&&!Yo(d)&&(d=sn(t,r)),Yo(d)&&(s=d,o))return s;const h=e[i+1];i=o?Pi(h):Li(h)}if(null!==t){let e=a?t.residualClasses:t.residualStyles;null!=e&&(s=sn(e,r))}return s}function Yo(e){return void 0!==e}function Xo(e,t=""){const n=tr(),r=nr(),i=e+Tn,a=r.firstCreatePass?Wi(r,e,2,null,null):r.data[i],o=n[i]=function(e,t){return $n(t)?t.createText(e):t.createTextNode(e)}(t,n[11]);Pa(r,n,o,a),ar(a,!1)}function Ko(e){return Zo("",e,""),Ko}function Zo(e,t,n){const r=tr(),i=Eo(r,e,t,n);return i!==Ii&&ka(r,Er(),i),Zo}function Jo(e,t,n,r,i){const a=tr(),o=function(e,t,n,r,i,a){const o=function(e,t,n,r){const i=So(e,t,n);return So(e,t+1,r)||i}(e,cr(),n,i);return hr(2),o?t+Hr(n)+r+Hr(i)+a:Ii}(a,e,t,n,r,i);return o!==Ii&&ka(a,Er(),o),Jo}class Qo{}class es{resolveComponentFactory(e){throw function(e){const t=Error(`No component factory found for ${_t(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(e)}}let ts=(()=>{class e{}return e.NULL=new es,e})(),ns=(()=>{class e{constructor(e){this.nativeElement=e}}return e.__NG_ELEMENT_ID__=()=>rs(e),e})();const rs=function(e){return Ga(e,ir(),tr())};class is{}var as=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}({});let os=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>ss(),e})();const ss=function(){const e=tr(),t=qn(ir().index,e);return function(e){const t=e[11];if($n(t))return t;throw new Error("Cannot inject Renderer2 when the application uses Renderer3!")}(Cn(t)?t:e)};let ls=(()=>{class e{}return e.\u0275prov=ht({token:e,providedIn:"root",factory:()=>null}),e})();class us{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const cs=new us("10.1.6");class ds{constructor(){}supports(e){return xo(e)}create(e){return new fs(e)}}const hs=(e,t)=>t;class fs{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||hs}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,n=this._removalsHead,r=0,i=null;for(;t||n;){const a=!n||t&&t.currentIndex<vs(n,r,i)?t:n,o=vs(a,r,i),s=a.currentIndex;if(a===n)r--,n=n._nextRemoved;else if(t=t._next,null==a.previousIndex)r++;else{i||(i=[]);const e=o-r,t=s-r;if(e!=t){for(let n=0;n<e;n++){const r=n<i.length?i[n]:i[n]=0,a=r+n;t<=a&&a<e&&(i[n]=r+1)}i[a.previousIndex]=t-e}}o!==s&&e(a,o,s)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!xo(e))throw new Error(`Error trying to diff '${_t(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t,n,r,i=this._itHead,a=!1;if(Array.isArray(e)){this.length=e.length;for(let t=0;t<this.length;t++)n=e[t],r=this._trackByFn(t,n),null!==i&&Object.is(i.trackById,r)?(a&&(i=this._verifyReinsertion(i,n,r,t)),Object.is(i.item,n)||this._addIdentityChange(i,n)):(i=this._mismatch(i,n,r,t),a=!0),i=i._next}else t=0,function(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[yo()]();let r;for(;!(r=n.next()).done;)t(r.value)}}(e,e=>{r=this._trackByFn(t,e),null!==i&&Object.is(i.trackById,r)?(a&&(i=this._verifyReinsertion(i,e,r,t)),Object.is(i.item,e)||this._addIdentityChange(i,e)):(i=this._mismatch(i,e,r,t),a=!0),i=i._next,t++}),this.length=t;return this._truncate(i),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,n,r){let i;return null===e?i=this._itTail:(i=e._prev,this._remove(e)),null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,i,r)):null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,i,r)):e=this._addAfter(new ps(t,n),i,r),e}_verifyReinsertion(e,t,n,r){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==i?e=this._reinsertAfter(i,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const r=e._prevRemoved,i=e._nextRemoved;return null===r?this._removalsHead=i:r._nextRemoved=i,null===i?this._removalsTail=r:i._prevRemoved=r,this._insertAfter(e,t,n),this._addToMoves(e,n),e}_moveAfter(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}_addAfter(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,n){const r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new gs),this._linkedRecords.put(e),e.currentIndex=n,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new gs),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class ps{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class ms{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}remove(e){const t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}class gs{constructor(){this.map=new Map}put(e){const t=e.trackById;let n=this.map.get(t);n||(n=new ms,this.map.set(t,n)),n.add(e)}get(e,t){const n=this.map.get(e);return n?n.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function vs(e,t,n){const r=e.previousIndex;if(null===r)return r;let i=0;return n&&r<n.length&&(i=n[r]),r+t+i}class ys{constructor(){}supports(e){return e instanceof Map||wo(e)}create(){return new bs}}class bs{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||wo(e)))throw new Error(`Error trying to diff '${_t(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(e,n)=>{if(t&&t.key===n)this._maybeAddToChanges(t,e),this._appendAfter=t,t=t._next;else{const r=this._getOrCreateRecordForKey(n,e);t=this._insertBeforeOrAppend(t,r)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let e=t;null!==e;e=e._nextRemoved)e===this._mapHead&&(this._mapHead=null),this._records.delete(e.key),e._nextRemoved=e._next,e.previousValue=e.currentValue,e.currentValue=null,e._prev=null,e._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const n=this._records.get(e);this._maybeAddToChanges(n,t);const r=n._prev,i=n._next;return r&&(r._next=i),i&&(i._prev=r),n._next=null,n._prev=null,n}const n=new xs(e);return this._records.set(e,n),n.currentValue=t,this._addToAdditions(n),n}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(n=>t(e[n],n))}}class xs{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}let ws=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(null!=n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>{if(!n)throw new Error("Cannot extend IterableDiffers without a parent injector");return e.create(t,n)},deps:[[e,new ut,new st]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(null!=t)return t;throw new Error(`Cannot find a differ supporting object '${e}' of type '${n=e,n.name||typeof n}'`);var n}}return e.\u0275prov=ht({token:e,providedIn:"root",factory:()=>new e([new ds])}),e})(),_s=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>{if(!n)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return e.create(t,n)},deps:[[e,new ut,new st]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(t)return t;throw new Error(`Cannot find a differ supporting object '${e}'`)}}return e.\u0275prov=ht({token:e,providedIn:"root",factory:()=>new e([new ys])}),e})();const Ss=[new ys],Es=new ws([new ds]),Ts=new _s(Ss);let ks=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>Cs(e,ns),e})();const Cs=function(e,t){return Ya(e,t,ir(),tr())};let Is=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>Os(e,ns),e})();const Os=function(e,t){return Xa(e,t,ir(),tr())},As={};class Ds extends ts{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=_n(e);return new js(t,this.ngModule)}}function Ms(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}const Ns=new $t("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>Vr});class js extends Qo{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=e.selectors.map(Ci).join(","),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return Ms(this.componentDef.inputs)}get outputs(){return Ms(this.componentDef.outputs)}create(e,t,n,r){const i=(r=r||this.ngModule)?function(e,t){return{get:(n,r,i)=>{const a=e.get(n,As,i);return a!==As||r===As?a:t.get(n,r,i)}}}(e,r.injector):e,a=i.get(is,Bn),o=i.get(ls,null),s=a.createRenderer(null,this.componentDef),l=this.componentDef.selectors[0][0]||"div",u=n?function(e,t,n){if($n(e))return e.selectRootElement(t,n===cn.ShadowDom);let r="string"==typeof t?e.querySelector(t):t;return r.textContent="",r}(s,n,this.componentDef.encapsulation):Ui(l,a.createRenderer(null,this.componentDef),function(e){const t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(l)),c=this.componentDef.onPush?576:528,d={components:[],scheduler:Vr,clean:_a,playerHandler:null,flags:0},h=Ji(0,null,null,1,0,null,null,null,null,null),f=Hi(null,h,d,c,null,null,a,s,o,i);let p,m;yr(f);try{const e=function(e,t,n,r,i,a){const o=n[1];n[20]=e;const s=Wi(o,0,2,null,null),l=s.mergedAttrs=t.hostAttrs;null!==l&&(mo(s,l,!0),null!==e&&(Rr(i,e,l),null!==s.classes&&za(i,e,s.classes),null!==s.styles&&Ba(i,e,s.styles)));const u=r.createRenderer(e,t),c=Hi(n,Zi(t),null,t.onPush?64:16,n[20],s,r,u,null,null);return o.firstCreatePass&&(ei(Kr(s,n),o,t.type),sa(o,s),ua(s,n.length,1)),va(n,c),n[20]=c}(u,this.componentDef,f,a,s);if(u)if(n)Rr(s,u,["ng-version",cs.full]);else{const{attrs:e,classes:t}=function(e){const t=[],n=[];let r=1,i=2;for(;r<e.length;){let a=e[r];if("string"==typeof a)2===i?""!==a&&t.push(a,e[++r]):8===i&&n.push(a);else{if(!Si(i))break;i=a}r++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);e&&Rr(s,u,e),t&&t.length>0&&za(s,u,t.join(" "))}if(m=Wn(h,0),void 0!==t){const e=m.projection=[];for(let n=0;n<this.ngContentSelectors.length;n++){const r=t[n];e.push(null!=r?Array.from(r):null)}}p=function(e,t,n,r,i){const a=n[1],o=function(e,t,n){const r=ir();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),oa(e,r,1),ca(e,t,n));const i=ai(t,e,t.length-1,r);gi(i,t);const a=Hn(r,t);return a&&gi(a,t),i}(a,n,t);r.components.push(o),e[8]=o,i&&i.forEach(e=>e(o,t)),t.contentQueries&&t.contentQueries(1,o,n.length-1);const s=ir();if(a.firstCreatePass&&(null!==t.hostBindings||null!==t.hostAttrs)){Tr(s.index-Tn);const e=n[1];ra(e,t),ia(e,n,t.hostVars),aa(t,o)}return o}(e,this.componentDef,f,d,[go]),Vi(h,f,null)}finally{Sr()}return new Rs(this.componentType,p,Ga(ns,m,f),f,m)}}class Rs extends class{}{constructor(e,t,n,r,i){super(),this.location=n,this._rootLView=r,this._tNode=i,this.destroyCbs=[],this.instance=t,this.hostView=this.changeDetectorRef=new Ha(r),this.componentType=e}get injector(){return new li(this._tNode,this._rootLView)}destroy(){this.destroyCbs&&(this.destroyCbs.forEach(e=>e()),this.destroyCbs=null,!this.hostView.destroyed&&this.hostView.destroy())}onDestroy(e){this.destroyCbs&&this.destroyCbs.push(e)}}const Ps=void 0;var Fs=["en",[["a","p"],["AM","PM"],Ps],[["AM","PM"],Ps,Ps],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Ps,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Ps,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Ps,"{1} 'at' {0}",Ps],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(e){let t=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===n?1:5}];let Ls={};function $s(e){return e in Ls||(Ls[e]=Dt.ng&&Dt.ng.common&&Dt.ng.common.locales&&Dt.ng.common.locales[e]),Ls[e]}var Bs=function(e){return e[e.LocaleId=0]="LocaleId",e[e.DayPeriodsFormat=1]="DayPeriodsFormat",e[e.DayPeriodsStandalone=2]="DayPeriodsStandalone",e[e.DaysFormat=3]="DaysFormat",e[e.DaysStandalone=4]="DaysStandalone",e[e.MonthsFormat=5]="MonthsFormat",e[e.MonthsStandalone=6]="MonthsStandalone",e[e.Eras=7]="Eras",e[e.FirstDayOfWeek=8]="FirstDayOfWeek",e[e.WeekendRange=9]="WeekendRange",e[e.DateFormat=10]="DateFormat",e[e.TimeFormat=11]="TimeFormat",e[e.DateTimeFormat=12]="DateTimeFormat",e[e.NumberSymbols=13]="NumberSymbols",e[e.NumberFormats=14]="NumberFormats",e[e.CurrencyCode=15]="CurrencyCode",e[e.CurrencySymbol=16]="CurrencySymbol",e[e.CurrencyName=17]="CurrencyName",e[e.Currencies=18]="Currencies",e[e.Directionality=19]="Directionality",e[e.PluralCase=20]="PluralCase",e[e.ExtraData=21]="ExtraData",e}({});const zs="en-US";let Us=zs;function Hs(e){var t,n;n="Expected localeId to be defined",null==(t=e)&&function(e,t,n,r){throw new Error("ASSERTION ERROR: "+e+` [Expected=> null != ${t} <=Actual]`)}(n,t),"string"==typeof e&&(Us=e.toLowerCase().replace(/_/g,"-"))}const Ws=new Map;class Vs extends en{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Ds(this);const n=En(e),r=e[Pt]||null;r&&Hs(r),this._bootstrapComponents=qr(n.bootstrap),this._r3Injector=ao(e,t,[{provide:en,useValue:this},{provide:ts,useValue:this.componentFactoryResolver}],_t(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=fo.THROW_IF_NOT_FOUND,n=ct.Default){return e===fo||e===en||e===Bt?this:this._r3Injector.get(e,t,n)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class qs extends tn{constructor(e){super(),this.moduleType=e,null!==En(e)&&function e(t){if(null!==t.\u0275mod.id){const e=t.\u0275mod.id;(function(e,t,n){if(t&&t!==n)throw new Error(`Duplicate module registered for ${e} - ${_t(t)} vs ${_t(t.name)}`)})(e,Ws.get(e),t),Ws.set(e,t)}let n=t.\u0275mod.imports;n instanceof Function&&(n=n()),n&&n.forEach(t=>e(t))}(e)}create(e){return new Vs(this.moduleType,e)}}function Gs(e,t,n,r){return Ys(tr(),ur(),e,t,n,r)}function Ys(e,t,n,r,i,a){const o=t+n;return So(e,o,i)?_o(e,o+1,a?r.call(a,i):r(i)):function(e,t){const n=e[t];return n===Ii?void 0:n}(e,o+1)}function Xs(e,t){const n=nr();let r;const i=e+Tn;n.firstCreatePass?(r=function(e,t){if(t)for(let n=t.length-1;n>=0;n--){const r=t[n];if(e===r.name)return r}throw new Error(`The pipe '${e}' could not be found!`)}(t,n.pipeRegistry),n.data[i]=r,r.onDestroy&&(n.destroyHooks||(n.destroyHooks=[])).push(i,r.onDestroy)):r=n.data[i];const a=r.factory||(r.factory=Sn(r.type)),o=Yt(Co);try{const t=Yr(!1),r=a();return Yr(t),function(e,t,n,r){const i=n+Tn;i>=e.data.length&&(e.data[i]=null,e.blueprint[i]=null),t[i]=r}(n,tr(),e,r),r}finally{Yt(o)}}function Ks(e,t,n){const r=tr(),i=Vn(r,e);return function(e,t){return bo.isWrapped(t)&&(t=bo.unwrap(t),e[cr()]=Ii),t}(r,function(e,t){return e[1].data[t+Tn].pure}(r,e)?Ys(r,ur(),t,i.transform,n,i):i.transform(n))}const Zs=class extends Ie{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,n){let r,i=e=>null,a=()=>null;e&&"object"==typeof e?(r=this.__isAsync?t=>{setTimeout(()=>e.next(t))}:t=>{e.next(t)},e.error&&(i=this.__isAsync?t=>{setTimeout(()=>e.error(t))}:t=>{e.error(t)}),e.complete&&(a=this.__isAsync?()=>{setTimeout(()=>e.complete())}:()=>{e.complete()})):(r=this.__isAsync?t=>{setTimeout(()=>e(t))}:t=>{e(t)},t&&(i=this.__isAsync?e=>{setTimeout(()=>t(e))}:e=>{t(e)}),n&&(a=this.__isAsync?()=>{setTimeout(()=>n())}:()=>{n()}));const o=super.subscribe(r,i,a);return e instanceof ge&&e.add(o),o}};function Js(){return this._results[yo()]()}class Qs{constructor(){this.dirty=!0,this._results=[],this.changes=new Zs,this.length=0;const e=yo(),t=Qs.prototype;t[e]||(t[e]=Js)}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e){this._results=function e(t,n){void 0===n&&(n=t);for(let r=0;r<t.length;r++){let i=t[r];Array.isArray(i)?(n===t&&(n=t.slice(0,r)),e(i,n)):n!==t&&n.push(i)}return n}(e),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]}notifyOnChanges(){this.changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}class el{constructor(e){this.queryList=e,this.matches=null}clone(){return new el(this.queryList)}setDirty(){this.queryList.setDirty()}}class tl{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const n=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let e=0;e<n;e++){const n=t.getByIndex(e);r.push(this.queries[n.indexInDeclarationView].clone())}return new tl(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==dl(e,t).matches&&this.queries[t].setDirty()}}class nl{constructor(e,t,n,r=null){this.predicate=e,this.descendants=t,this.isStatic=n,this.read=r}}class rl{constructor(e=[]){this.queries=e}elementStart(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let n=0;n<this.length;n++){const r=null!==t?t.length:0,i=this.getByIndex(n).embeddedTView(e,r);i&&(i.indexInDeclarationView=n,null!==t?t.push(i):t=[i])}return null!==t?new rl(t):null}template(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class il{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new il(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&!1===this.metadata.descendants){const t=this._declarationNodeIndex;let n=e.parent;for(;null!==n&&3===n.type&&n.index!==t;)n=n.parent;return t===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const n=this.metadata.predicate;if(Array.isArray(n))for(let r=0;r<n.length;r++){const i=n[r];this.matchTNodeWithReadOption(e,t,al(t,i)),this.matchTNodeWithReadOption(e,t,ii(t,e,i,!1,!1))}else n===ks?0===t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,ii(t,e,n,!1,!1))}matchTNodeWithReadOption(e,t,n){if(null!==n){const r=this.metadata.read;if(null!==r)if(r===ns||r===Is||r===ks&&0===t.type)this.addMatch(t.index,-2);else{const n=ii(t,e,r,!1,!1);null!==n&&this.addMatch(t.index,n)}else this.addMatch(t.index,n)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function al(e,t){const n=e.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function ol(e,t,n,r){return-1===n?function(e,t){return 2===e.type||3===e.type?Ga(ns,e,t):0===e.type?Ya(ks,ns,e,t):null}(t,e):-2===n?function(e,t,n){return n===ns?Ga(ns,t,e):n===ks?Ya(ks,ns,t,e):n===Is?Xa(Is,ns,t,e):void 0}(e,t,r):ai(e,e[1],n,t)}function sl(e,t,n,r){const i=t[19].queries[r];if(null===i.matches){const r=e.data,a=n.matches,o=[];for(let e=0;e<a.length;e+=2){const i=a[e];o.push(i<0?null:ol(t,r[i],a[e+1],n.metadata.read))}i.matches=o}return i.matches}function ll(e){const t=tr(),n=nr(),r=mr();gr(r+1);const i=dl(n,r);if(e.dirty&&Yn(t)===i.metadata.isStatic){if(null===i.matches)e.reset([]);else{const a=i.crossesNgTemplate?function e(t,n,r,i){const a=t.queries.getByIndex(r),o=a.matches;if(null!==o){const s=sl(t,n,a,r);for(let t=0;t<o.length;t+=2){const r=o[t];if(r>0)i.push(s[t/2]);else{const a=o[t+1],s=n[-r];for(let t=kn;t<s.length;t++){const n=s[t];n[17]===n[3]&&e(n[1],n,a,i)}if(null!==s[9]){const t=s[9];for(let n=0;n<t.length;n++){const r=t[n];e(r[1],r,a,i)}}}}}return i}(n,t,r,[]):sl(n,t,i,r);e.reset(a),e.notifyOnChanges()}return!0}return!1}function ul(e,t,n){!function(e,t,n,r,i,a){e.firstCreatePass&&function(e,t,n){null===e.queries&&(e.queries=new rl),e.queries.track(new il(t,-1))}(e,new nl(n,r,false,i)),function(e,t){const n=new Qs;Qi(e,t,n,n.destroy),null===t[19]&&(t[19]=new tl),t[19].queries.push(new el(n))}(e,t)}(nr(),tr(),e,t,n)}function cl(){return e=tr(),t=mr(),e[19].queries[t].queryList;var e,t}function dl(e,t){return e.queries.getByIndex(t)}const hl=new $t("Application Initializer");let fl=(()=>{class e{constructor(e){this.appInits=e,this.initialized=!1,this.done=!1,this.donePromise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}runInitializers(){if(this.initialized)return;const e=[],t=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let n=0;n<this.appInits.length;n++){const t=this.appInits[n]();jo(t)&&e.push(t)}Promise.all(e).then(()=>{t()}).catch(e=>{this.reject(e)}),0===e.length&&t(),this.initialized=!0}}return e.\u0275fac=function(t){return new(t||e)(Kt(hl,8))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();const pl=new $t("AppId"),ml={provide:pl,useFactory:function(){return`${gl()}${gl()}${gl()}`},deps:[]};function gl(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const vl=new $t("Platform Initializer"),yl=new $t("Platform ID"),bl=new $t("appBootstrapListener");let xl=(()=>{class e{log(e){console.log(e)}warn(e){console.warn(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();const wl=new $t("LocaleId"),_l=new $t("DefaultCurrencyCode");class Sl{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}const El=function(e){return new qs(e)},Tl=El,kl=function(e){return Promise.resolve(El(e))},Cl=function(e){const t=El(e),n=qr(En(e).declarations).reduce((e,t)=>{const n=_n(t);return n&&e.push(new js(n)),e},[]);return new Sl(t,n)},Il=Cl,Ol=function(e){return Promise.resolve(Cl(e))};let Al=(()=>{class e{constructor(){this.compileModuleSync=Tl,this.compileModuleAsync=kl,this.compileModuleAndAllComponentsSync=Il,this.compileModuleAndAllComponentsAsync=Ol}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();const Dl=(()=>Promise.resolve(0))();function Ml(e){"undefined"==typeof Zone?Dl.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class Nl{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Zs(!1),this.onMicrotaskEmpty=new Zs(!1),this.onStable=new Zs(!1),this.onError=new Zs(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const n=this;n._nesting=0,n._outer=n._inner=Zone.current,Zone.wtfZoneSpec&&(n._inner=n._inner.fork(Zone.wtfZoneSpec)),Zone.TaskTrackingZoneSpec&&(n._inner=n._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(n._inner=n._inner.fork(Zone.longStackTraceZoneSpec)),n.shouldCoalesceEventChangeDetection=t,n.lastRequestAnimationFrameId=-1,n.nativeRequestAnimationFrame=function(){let e=Dt.requestAnimationFrame,t=Dt.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function(e){const t=!!e.shouldCoalesceEventChangeDetection&&e.nativeRequestAnimationFrame&&(()=>{!function(e){-1===e.lastRequestAnimationFrameId&&(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Dt,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,Fl(e),Pl(e)},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),Fl(e))}(e)});e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0,maybeDelayChangeDetection:t},onInvokeTask:(n,r,i,a,o,s)=>{try{return Ll(e),n.invokeTask(i,a,o,s)}finally{t&&"eventTask"===a.type&&t(),$l(e)}},onInvoke:(t,n,r,i,a,o,s)=>{try{return Ll(e),t.invoke(r,i,a,o,s)}finally{$l(e)}},onHasTask:(t,n,r,i)=>{t.hasTask(r,i),n===r&&("microTask"==i.change?(e._hasPendingMicrotasks=i.microTask,Fl(e),Pl(e)):"macroTask"==i.change&&(e.hasPendingMacrotasks=i.macroTask))},onHandleError:(t,n,r,i)=>(t.handleError(r,i),e.runOutsideAngular(()=>e.onError.emit(i)),!1)})}(n)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Nl.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Nl.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,n){return this._inner.run(e,t,n)}runTask(e,t,n,r){const i=this._inner,a=i.scheduleEventTask("NgZoneEvent: "+r,e,Rl,jl,jl);try{return i.runTask(a,t,n)}finally{i.cancelTask(a)}}runGuarded(e,t,n){return this._inner.runGuarded(e,t,n)}runOutsideAngular(e){return this._outer.run(e)}}function jl(){}const Rl={};function Pl(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Fl(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||e.shouldCoalesceEventChangeDetection&&-1!==e.lastRequestAnimationFrameId)}function Ll(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function $l(e){e._nesting--,Pl(e)}class Bl{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Zs,this.onMicrotaskEmpty=new Zs,this.onStable=new Zs,this.onError=new Zs}run(e,t,n){return e.apply(t,n)}runGuarded(e,t,n){return e.apply(t,n)}runOutsideAngular(e){return e()}runTask(e,t,n,r){return e.apply(t,n)}}let zl=(()=>{class e{constructor(e){this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Nl.assertNotInAngularZone(),Ml(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Ml(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(t=>!t.updateCb||!t.updateCb(e)||(clearTimeout(t.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,t,n){let r=-1;t&&t>0&&(r=setTimeout(()=>{this._callbacks=this._callbacks.filter(e=>e.timeoutId!==r),e(this._didWork,this.getPendingTasks())},t)),this._callbacks.push({doneCb:e,timeoutId:r,updateCb:n})}whenStable(e,t,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(e,t,n),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(e,t,n){return[]}}return e.\u0275fac=function(t){return new(t||e)(Kt(Nl))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})(),Ul=(()=>{class e{constructor(){this._applications=new Map,Vl.addToWindow(this)}registerApplication(e,t){this._applications.set(e,t)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,t=!0){return Vl.findTestabilityInTree(this,e,t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();class Hl{addToWindow(e){}findTestabilityInTree(e,t,n){return null}}let Wl,Vl=new Hl;const ql=new $t("AllowMultipleToken");class Gl{constructor(e,t){this.name=e,this.token=t}}function Yl(e,t,n=[]){const r="Platform: "+t,i=new $t(r);return(t=[])=>{let a=Xl();if(!a||a.injector.get(ql,!1))if(e)e(n.concat(t).concat({provide:i,useValue:!0}));else{const e=n.concat(t).concat({provide:i,useValue:!0},{provide:Qa,useValue:"platform"});!function(e){if(Wl&&!Wl.destroyed&&!Wl.injector.get(ql,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Wl=e.get(Kl);const t=e.get(vl,null);t&&t.forEach(e=>e())}(fo.create({providers:e,name:r}))}return function(e){const t=Xl();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(i)}}function Xl(){return Wl&&!Wl.destroyed?Wl:null}let Kl=(()=>{class e{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,t){const n=function(e,t){let n;return n="noop"===e?new Bl:("zone.js"===e?void 0:e)||new Nl({enableLongStackTrace:mi(),shouldCoalesceEventChangeDetection:t}),n}(t?t.ngZone:void 0,t&&t.ngZoneEventCoalescing||!1),r=[{provide:Nl,useValue:n}];return n.run(()=>{const t=fo.create({providers:r,parent:this.injector,name:e.moduleType.name}),i=e.create(t),a=i.injector.get(hi,null);if(!a)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return i.onDestroy(()=>Ql(this._modules,i)),n.runOutsideAngular(()=>n.onError.subscribe({next:e=>{a.handleError(e)}})),function(e,t,n){try{const r=n();return jo(r)?r.catch(n=>{throw t.runOutsideAngular(()=>e.handleError(n)),n}):r}catch(r){throw t.runOutsideAngular(()=>e.handleError(r)),r}}(a,n,()=>{const e=i.injector.get(fl);return e.runInitializers(),e.donePromise.then(()=>(Hs(i.injector.get(wl,zs)||zs),this._moduleDoBootstrap(i),i))})})}bootstrapModule(e,t=[]){const n=Zl({},t);return function(e,t,n){const r=new qs(n);return Promise.resolve(r)}(0,0,e).then(e=>this.bootstrapModuleFactory(e,n))}_moduleDoBootstrap(e){const t=e.injector.get(Jl);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(e=>t.bootstrap(e));else{if(!e.instance.ngDoBootstrap)throw new Error(`The module ${_t(e.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);e.instance.ngDoBootstrap(t)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(e=>e.destroy()),this._destroyListeners.forEach(e=>e()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(t){return new(t||e)(Kt(fo))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();function Zl(e,t){return Array.isArray(t)?t.reduce(Zl,e):Object.assign(Object.assign({},e),t)}let Jl=(()=>{class e{constructor(e,t,n,r,i,a){this._zone=e,this._console=t,this._injector=n,this._exceptionHandler=r,this._componentFactoryResolver=i,this._initStatus=a,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=mi(),this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const o=new Se(e=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{e.next(this._stable),e.complete()})}),s=new Se(e=>{let t;this._zone.runOutsideAngular(()=>{t=this._zone.onStable.subscribe(()=>{Nl.assertNotInAngularZone(),Ml(()=>{this._stable||this._zone.hasPendingMacrotasks||this._zone.hasPendingMicrotasks||(this._stable=!0,e.next(!0))})})});const n=this._zone.onUnstable.subscribe(()=>{Nl.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{e.next(!1)}))});return()=>{t.unsubscribe(),n.unsubscribe()}});this.isStable=function(...e){let t=Number.POSITIVE_INFINITY,n=null,r=e[e.length-1];return Ae(r)?(n=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(t=e.pop())):"number"==typeof r&&(t=e.pop()),null===n&&1===e.length&&e[0]instanceof Se?e[0]:Ye(t)(Xe(e,n))}(o,s.pipe(e=>{return Ke()((t=nt,function(e){let n;n="function"==typeof t?t:function(){return t};const r=Object.create(e,et);return r.source=e,r.subjectFactory=n,r})(e));var t}))}bootstrap(e,t){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let n;n=e instanceof Qo?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(n.componentType);const r=n.isBoundToModule?void 0:this._injector.get(en),i=n.create(fo.NULL,[],t||n.selector,r);i.onDestroy(()=>{this._unloadComponent(i)});const a=i.injector.get(zl,null);return a&&i.injector.get(Ul).registerApplication(i.location.nativeElement,a),this._loadComponent(i),mi()&&this._console.log("Angular is running in development mode. Call enableProdMode() to enable production mode."),i}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let e of this._views)e.detectChanges();if(this._enforceNoNewChanges)for(let e of this._views)e.checkNoChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const t=e;this._views.push(t),t.attachToAppRef(this)}detachView(e){const t=e;Ql(this._views,t),t.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(bl,[]).concat(this._bootstrapListeners).forEach(t=>t(e))}_unloadComponent(e){this.detachView(e.hostView),Ql(this.components,e)}ngOnDestroy(){this._views.slice().forEach(e=>e.destroy())}get viewCount(){return this._views.length}}return e.\u0275fac=function(t){return new(t||e)(Kt(Nl),Kt(xl),Kt(fo),Kt(hi),Kt(ts),Kt(fl))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();function Ql(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class eu{}class tu{}const nu={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let ru=(()=>{class e{constructor(e,t){this._compiler=e,this._config=t||nu}load(e){return this.loadAndCompile(e)}loadAndCompile(e){let[t,r]=e.split("#");return void 0===r&&(r="default"),n("zn8P")(t).then(e=>e[r]).then(e=>iu(e,t,r)).then(e=>this._compiler.compileModuleAsync(e))}loadFactory(e){let[t,r]=e.split("#"),i="NgFactory";return void 0===r&&(r="default",i=""),n("zn8P")(this._config.factoryPathPrefix+t+this._config.factoryPathSuffix).then(e=>e[r+i]).then(e=>iu(e,t,r))}}return e.\u0275fac=function(t){return new(t||e)(Kt(Al),Kt(tu,8))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();function iu(e,t,n){if(!e)throw new Error(`Cannot find '${n}' in '${t}'`);return e}const au=Yl(null,"core",[{provide:yl,useValue:"unknown"},{provide:Kl,deps:[fo]},{provide:Ul,deps:[]},{provide:xl,deps:[]}]),ou=[{provide:Jl,useClass:Jl,deps:[Nl,xl,fo,hi,ts,fl]},{provide:Ns,deps:[Nl],useFactory:function(e){let t=[];return e.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(e){t.push(e)}}},{provide:fl,useClass:fl,deps:[[new st,hl]]},{provide:Al,useClass:Al,deps:[]},ml,{provide:ws,useFactory:function(){return Es},deps:[]},{provide:_s,useFactory:function(){return Ts},deps:[]},{provide:wl,useFactory:function(e){return Hs(e=e||"undefined"!=typeof $localize&&$localize.locale||zs),e},deps:[[new ot(wl),new st,new ut]]},{provide:_l,useValue:"USD"}];let su=(()=>{class e{constructor(e){}}return e.\u0275mod=yn({type:e}),e.\u0275inj=ft({factory:function(t){return new(t||e)(Kt(Jl))},providers:ou}),e})(),lu=null;function uu(){return lu}const cu=new $t("DocumentToken");let du=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ht({factory:hu,token:e,providedIn:"platform"}),e})();function hu(){return Kt(pu)}const fu=new $t("Location Initialized");let pu=(()=>{class e extends du{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=uu().getLocation(),this._history=uu().getHistory()}getBaseHrefFromDOM(){return uu().getBaseHref(this._doc)}onPopState(e){uu().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",e,!1)}onHashChange(e){uu().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",e,!1)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,t,n){mu()?this._history.pushState(e,t,n):this.location.hash=n}replaceState(e,t,n){mu()?this._history.replaceState(e,t,n):this.location.hash=n}forward(){this._history.forward()}back(){this._history.back()}getState(){return this._history.state}}return e.\u0275fac=function(t){return new(t||e)(Kt(cu))},e.\u0275prov=ht({factory:gu,token:e,providedIn:"platform"}),e})();function mu(){return!!window.history.pushState}function gu(){return new pu(Kt(cu))}function vu(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function yu(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function bu(e){return e&&"?"!==e[0]?"?"+e:e}let xu=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ht({factory:wu,token:e,providedIn:"root"}),e})();function wu(e){const t=Kt(cu).location;return new Su(Kt(du),t&&t.origin||"")}const _u=new $t("appBaseHref");let Su=(()=>{class e extends xu{constructor(e,t){if(super(),this._platformLocation=e,null==t&&(t=this._platformLocation.getBaseHrefFromDOM()),null==t)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=t}onPopState(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return vu(this._baseHref,e)}path(e=!1){const t=this._platformLocation.pathname+bu(this._platformLocation.search),n=this._platformLocation.hash;return n&&e?`${t}${n}`:t}pushState(e,t,n,r){const i=this.prepareExternalUrl(n+bu(r));this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){const i=this.prepareExternalUrl(n+bu(r));this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}}return e.\u0275fac=function(t){return new(t||e)(Kt(du),Kt(_u,8))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})(),Eu=(()=>{class e extends xu{constructor(e,t){super(),this._platformLocation=e,this._baseHref="",null!=t&&(this._baseHref=t)}onPopState(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)}getBaseHref(){return this._baseHref}path(e=!1){let t=this._platformLocation.hash;return null==t&&(t="#"),t.length>0?t.substring(1):t}prepareExternalUrl(e){const t=vu(this._baseHref,e);return t.length>0?"#"+t:t}pushState(e,t,n,r){let i=this.prepareExternalUrl(n+bu(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){let i=this.prepareExternalUrl(n+bu(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}}return e.\u0275fac=function(t){return new(t||e)(Kt(du),Kt(_u,8))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})(),Tu=(()=>{class e{constructor(e,t){this._subject=new Zs,this._urlChangeListeners=[],this._platformStrategy=e;const n=this._platformStrategy.getBaseHref();this._platformLocation=t,this._baseHref=yu(Cu(n)),this._platformStrategy.onPopState(e=>{this._subject.emit({url:this.path(!0),pop:!0,state:e.state,type:e.type})})}path(e=!1){return this.normalize(this._platformStrategy.path(e))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(e,t=""){return this.path()==this.normalize(e+bu(t))}normalize(t){return e.stripTrailingSlash(function(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,Cu(t)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}go(e,t="",n=null){this._platformStrategy.pushState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+bu(t)),n)}replaceState(e,t="",n=null){this._platformStrategy.replaceState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+bu(t)),n)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}onUrlChange(e){this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(e=>{this._notifyUrlChangeListeners(e.url,e.state)}))}_notifyUrlChangeListeners(e="",t){this._urlChangeListeners.forEach(n=>n(e,t))}subscribe(e,t,n){return this._subject.subscribe({next:e,error:t,complete:n})}}return e.\u0275fac=function(t){return new(t||e)(Kt(xu),Kt(du))},e.normalizeQueryParams=bu,e.joinWithSlash=vu,e.stripTrailingSlash=yu,e.\u0275prov=ht({factory:ku,token:e,providedIn:"root"}),e})();function ku(){return new Tu(Kt(xu),Kt(du))}function Cu(e){return e.replace(/\/index.html$/,"")}var Iu=function(e){return e[e.Zero=0]="Zero",e[e.One=1]="One",e[e.Two=2]="Two",e[e.Few=3]="Few",e[e.Many=4]="Many",e[e.Other=5]="Other",e}({});class Ou{}let Au=(()=>{class e extends Ou{constructor(e){super(),this.locale=e}getPluralCategory(e,t){switch(function(e){return function(e){const t=function(e){return e.toLowerCase().replace(/_/g,"-")}(e);let n=$s(t);if(n)return n;const r=t.split("-")[0];if(n=$s(r),n)return n;if("en"===r)return Fs;throw new Error(`Missing locale data for the locale "${e}".`)}(e)[Bs.PluralCase]}(t||this.locale)(e)){case Iu.Zero:return"zero";case Iu.One:return"one";case Iu.Two:return"two";case Iu.Few:return"few";case Iu.Many:return"many";default:return"other"}}}return e.\u0275fac=function(t){return new(t||e)(Kt(wl))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})(),Du=(()=>{class e{constructor(e,t,n,r){this._iterableDiffers=e,this._keyValueDiffers=t,this._ngEl=n,this._renderer=r,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(xo(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachChangedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachRemovedItem(e=>{e.previousValue&&this._toggleClass(e.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(e=>{if("string"!=typeof e.item)throw new Error("NgClass can only toggle CSS classes expressed as strings, got "+_t(e.item));this._toggleClass(e.item,!0)}),e.forEachRemovedItem(e=>this._toggleClass(e.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!0)):Object.keys(e).forEach(t=>this._toggleClass(t,!!e[t])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!1)):Object.keys(e).forEach(e=>this._toggleClass(e,!1)))}_toggleClass(e,t){(e=e.trim())&&e.split(/\s+/g).forEach(e=>{t?this._renderer.addClass(this._ngEl.nativeElement,e):this._renderer.removeClass(this._ngEl.nativeElement,e)})}}return e.\u0275fac=function(t){return new(t||e)(Co(ws),Co(_s),Co(ns),Co(os))},e.\u0275dir=xn({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),e})();class Mu{constructor(e,t,n,r){this.$implicit=e,this.ngForOf=t,this.index=n,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Nu=(()=>{class e{constructor(e,t,n){this._viewContainer=e,this._template=t,this._differs=n,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){mi()&&null!=e&&"function"!=typeof e&&console&&console.warn&&console.warn(`trackBy must be a function, but received ${JSON.stringify(e)}. See https://angular.io/api/common/NgForOf#change-propagation for more information.`),this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;if(!this._differ&&n)try{this._differ=this._differs.find(n).create(this.ngForTrackBy)}catch(t){throw new Error(`Cannot find a differ supporting object '${n}' of type '${e=n,e.name||typeof e}'. NgFor only supports binding to Iterables such as Arrays.`)}}var e;if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const t=[];e.forEachOperation((e,n,r)=>{if(null==e.previousIndex){const n=this._viewContainer.createEmbeddedView(this._template,new Mu(null,this._ngForOf,-1,-1),null===r?void 0:r),i=new ju(e,n);t.push(i)}else if(null==r)this._viewContainer.remove(null===n?void 0:n);else if(null!==n){const i=this._viewContainer.get(n);this._viewContainer.move(i,r);const a=new ju(e,i);t.push(a)}});for(let n=0;n<t.length;n++)this._perViewChange(t[n].view,t[n].record);for(let n=0,r=this._viewContainer.length;n<r;n++){const e=this._viewContainer.get(n);e.context.index=n,e.context.count=r,e.context.ngForOf=this._ngForOf}e.forEachIdentityChange(e=>{this._viewContainer.get(e.currentIndex).context.$implicit=e.item})}_perViewChange(e,t){e.context.$implicit=t.item}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(Co(Is),Co(ks),Co(ws))},e.\u0275dir=xn({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),e})();class ju{constructor(e,t){this.record=e,this.view=t}}let Ru=(()=>{class e{constructor(e,t){this._viewContainer=e,this._context=new Pu,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=t}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){Fu("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){Fu("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(Co(Is),Co(ks))},e.\u0275dir=xn({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e})();class Pu{constructor(){this.$implicit=null,this.ngIf=null}}function Fu(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${_t(t)}'.`)}let Lu=(()=>{class e{constructor(e){this.differs=e,this.keyValues=[]}transform(e,t=$u){if(!e||!(e instanceof Map)&&"object"!=typeof e)return null;this.differ||(this.differ=this.differs.find(e).create());const n=this.differ.diff(e);return n&&(this.keyValues=[],n.forEachItem(e=>{this.keyValues.push({key:e.key,value:e.currentValue})}),this.keyValues.sort(t)),this.keyValues}}return e.\u0275fac=function(t){return new(t||e)(Co(_s))},e.\u0275pipe=wn({name:"keyvalue",type:e,pure:!1}),e})();function $u(e,t){const n=e.key,r=t.key;if(n===r)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(null===n)return 1;if(null===r)return-1;if("string"==typeof n&&"string"==typeof r)return n<r?-1:1;if("number"==typeof n&&"number"==typeof r)return n-r;if("boolean"==typeof n&&"boolean"==typeof r)return n<r?-1:1;const i=String(n),a=String(r);return i==a?0:i<a?-1:1}let Bu=(()=>{class e{}return e.\u0275mod=yn({type:e}),e.\u0275inj=ft({factory:function(t){return new(t||e)},providers:[{provide:Ou,useClass:Au}]}),e})(),zu=(()=>{class e{}return e.\u0275prov=ht({token:e,providedIn:"root",factory:()=>new Uu(Kt(cu),window,Kt(hi))}),e})();class Uu{constructor(e,t,n){this.document=e,this.window=t,this.errorHandler=n,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.scrollX,this.window.scrollY]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(this.supportsScrolling()){const t=this.document.getElementById(e)||this.document.getElementsByName(e)[0];t&&this.scrollToElement(t)}}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),n=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(n-i[0],r-i[1])}supportScrollRestoration(){try{if(!this.window||!this.window.scrollTo)return!1;const e=Hu(this.window.history)||Hu(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}supportsScrolling(){try{return!!this.window.scrollTo}catch(e){return!1}}}function Hu(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class Wu extends class extends class{}{constructor(){super()}supportsDOMEvents(){return!0}}{static makeCurrent(){var e;e=new Wu,lu||(lu=e)}getProperty(e,t){return e[t]}log(e){window.console&&window.console.log&&window.console.log(e)}logGroup(e){window.console&&window.console.group&&window.console.group(e)}logGroupEnd(){window.console&&window.console.groupEnd&&window.console.groupEnd()}onAndCancel(e,t,n){return e.addEventListener(t,n,!1),()=>{e.removeEventListener(t,n,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){return e.parentNode&&e.parentNode.removeChild(e),e}getValue(e){return e.value}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getHistory(){return window.history}getLocation(){return window.location}getBaseHref(e){const t=qu||(qu=document.querySelector("base"),qu)?qu.getAttribute("href"):null;return null==t?null:(n=t,Vu||(Vu=document.createElement("a")),Vu.setAttribute("href",n),"/"===Vu.pathname.charAt(0)?Vu.pathname:"/"+Vu.pathname);var n}resetBaseElement(){qu=null}getUserAgent(){return window.navigator.userAgent}performanceNow(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}supportsCookies(){return!0}getCookie(e){return function(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const e=n.indexOf("="),[r,i]=-1==e?[n,""]:[n.slice(0,e),n.slice(e+1)];if(r.trim()===t)return decodeURIComponent(i)}return null}(document.cookie,e)}}let Vu,qu=null;const Gu=new $t("TRANSITION_ID"),Yu=[{provide:hl,useFactory:function(e,t,n){return()=>{n.get(fl).donePromise.then(()=>{const n=uu();Array.prototype.slice.apply(t.querySelectorAll("style[ng-transition]")).filter(t=>t.getAttribute("ng-transition")===e).forEach(e=>n.remove(e))})}},deps:[Gu,cu,fo],multi:!0}];class Xu{static init(){!function(e){Vl=e}(new Xu)}addToWindow(e){Dt.getAngularTestability=(t,n=!0)=>{const r=e.findTestabilityInTree(t,n);if(null==r)throw new Error("Could not find testability for element.");return r},Dt.getAllAngularTestabilities=()=>e.getAllTestabilities(),Dt.getAllAngularRootElements=()=>e.getAllRootElements(),Dt.frameworkStabilizers||(Dt.frameworkStabilizers=[]),Dt.frameworkStabilizers.push(e=>{const t=Dt.getAllAngularTestabilities();let n=t.length,r=!1;const i=function(t){r=r||t,n--,0==n&&e(r)};t.forEach((function(e){e.whenStable(i)}))})}findTestabilityInTree(e,t,n){if(null==t)return null;const r=e.getTestability(t);return null!=r?r:n?uu().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}const Ku=new $t("EventManagerPlugins");let Zu=(()=>{class e{constructor(e,t){this._zone=t,this._eventNameToPlugin=new Map,e.forEach(e=>e.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,t,n){return this._findPluginFor(t).addEventListener(e,t,n)}addGlobalEventListener(e,t,n){return this._findPluginFor(t).addGlobalEventListener(e,t,n)}getZone(){return this._zone}_findPluginFor(e){const t=this._eventNameToPlugin.get(e);if(t)return t;const n=this._plugins;for(let r=0;r<n.length;r++){const t=n[r];if(t.supports(e))return this._eventNameToPlugin.set(e,t),t}throw new Error("No event manager plugin found for event "+e)}}return e.\u0275fac=function(t){return new(t||e)(Kt(Ku),Kt(Nl))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();class Ju{constructor(e){this._doc=e}addGlobalEventListener(e,t,n){const r=uu().getGlobalEventTarget(this._doc,e);if(!r)throw new Error(`Unsupported event target ${r} for event ${t}`);return this.addEventListener(r,t,n)}}let Qu=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(e){const t=new Set;e.forEach(e=>{this._stylesSet.has(e)||(this._stylesSet.add(e),t.add(e))}),this.onStylesAdded(t)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})(),ec=(()=>{class e extends Qu{constructor(e){super(),this._doc=e,this._hostNodes=new Set,this._styleNodes=new Set,this._hostNodes.add(e.head)}_addStylesToHost(e,t){e.forEach(e=>{const n=this._doc.createElement("style");n.textContent=e,this._styleNodes.add(t.appendChild(n))})}addHost(e){this._addStylesToHost(this._stylesSet,e),this._hostNodes.add(e)}removeHost(e){this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach(t=>this._addStylesToHost(e,t))}ngOnDestroy(){this._styleNodes.forEach(e=>uu().remove(e))}}return e.\u0275fac=function(t){return new(t||e)(Kt(cu))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();const tc={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},nc=/%COMP%/g;function rc(e,t,n){for(let r=0;r<t.length;r++){let i=t[r];Array.isArray(i)?rc(e,i,n):(i=i.replace(nc,e),n.push(i))}return n}function ic(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let ac=(()=>{class e{constructor(e,t,n){this.eventManager=e,this.sharedStylesHost=t,this.appId=n,this.rendererByCompId=new Map,this.defaultRenderer=new oc(e)}createRenderer(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case cn.Emulated:{let n=this.rendererByCompId.get(t.id);return n||(n=new sc(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,n)),n.applyToHost(e),n}case cn.Native:case cn.ShadowDom:return new lc(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){const e=rc(t.id,t.styles,[]);this.sharedStylesHost.addStyles(e),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(t){return new(t||e)(Kt(Zu),Kt(ec),Kt(pl))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();class oc{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,t){return t?document.createElementNS(tc[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,n){e&&e.insertBefore(t,n)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error(`The selector "${e}" did not match any elements`);return t||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,n,r){if(r){t=r+":"+t;const i=tc[r];i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}removeAttribute(e,t,n){if(n){const r=tc[n];r?e.removeAttributeNS(r,t):e.removeAttribute(`${n}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,n,r){r&as.DashCase?e.style.setProperty(t,n,r&as.Important?"important":""):e.style[t]=n}removeStyle(e,t,n){n&as.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,n){e[t]=n}setValue(e,t){e.nodeValue=t}listen(e,t,n){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,ic(n)):this.eventManager.addEventListener(e,t,ic(n))}}class sc extends oc{constructor(e,t,n,r){super(e),this.component=n;const i=rc(r+"-"+n.id,n.styles,[]);t.addStyles(i),this.contentAttr="_ngcontent-%COMP%".replace(nc,r+"-"+n.id),this.hostAttr="_nghost-%COMP%".replace(nc,r+"-"+n.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const n=super.createElement(e,t);return super.setAttribute(n,this.contentAttr,""),n}}class lc extends oc{constructor(e,t,n,r){super(e),this.sharedStylesHost=t,this.hostEl=n,this.component=r,this.shadowRoot=r.encapsulation===cn.ShadowDom?n.attachShadow({mode:"open"}):n.createShadowRoot(),this.sharedStylesHost.addHost(this.shadowRoot);const i=rc(r.id,r.styles,[]);for(let a=0;a<i.length;a++){const e=document.createElement("style");e.textContent=i[a],this.shadowRoot.appendChild(e)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,n){return super.insertBefore(this.nodeOrShadowRoot(e),t,n)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let uc=(()=>{class e extends Ju{constructor(e){super(e)}supports(e){return!0}addEventListener(e,t,n){return e.addEventListener(t,n,!1),()=>this.removeEventListener(e,t,n)}removeEventListener(e,t,n){return e.removeEventListener(t,n)}}return e.\u0275fac=function(t){return new(t||e)(Kt(cu))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();const cc=["alt","control","meta","shift"],dc={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},hc={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},fc={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let pc=(()=>{class e extends Ju{constructor(e){super(e)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,n,r){const i=e.parseEventName(n),a=e.eventCallback(i.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>uu().onAndCancel(t,i.domEventName,a))}static parseEventName(t){const n=t.toLowerCase().split("."),r=n.shift();if(0===n.length||"keydown"!==r&&"keyup"!==r)return null;const i=e._normalizeKey(n.pop());let a="";if(cc.forEach(e=>{const t=n.indexOf(e);t>-1&&(n.splice(t,1),a+=e+".")}),a+=i,0!=n.length||0===i.length)return null;const o={};return o.domEventName=r,o.fullKey=a,o}static getEventFullKey(e){let t="",n=function(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&hc.hasOwnProperty(t)&&(t=hc[t]))}return dc[t]||t}(e);return n=n.toLowerCase()," "===n?n="space":"."===n&&(n="dot"),cc.forEach(r=>{r!=n&&(0,fc[r])(e)&&(t+=r+".")}),t+=n,t}static eventCallback(t,n,r){return i=>{e.getEventFullKey(i)===t&&r.runGuarded(()=>n(i))}}static _normalizeKey(e){switch(e){case"esc":return"escape";default:return e}}}return e.\u0275fac=function(t){return new(t||e)(Kt(cu))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();const mc=Yl(au,"browser",[{provide:yl,useValue:"browser"},{provide:vl,useValue:function(){Wu.makeCurrent(),Xu.init()},multi:!0},{provide:cu,useFactory:function(){return function(e){Ln=e}(document),document},deps:[]}]),gc=[[],{provide:Qa,useValue:"root"},{provide:hi,useFactory:function(){return new hi},deps:[]},{provide:Ku,useClass:uc,multi:!0,deps:[cu,Nl,yl]},{provide:Ku,useClass:pc,multi:!0,deps:[cu]},[],{provide:ac,useClass:ac,deps:[Zu,ec,pl]},{provide:is,useExisting:ac},{provide:Qu,useExisting:ec},{provide:ec,useClass:ec,deps:[cu]},{provide:zl,useClass:zl,deps:[Nl]},{provide:Zu,useClass:Zu,deps:[Ku,Nl]},[]];let vc=(()=>{class e{constructor(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:e,providers:[{provide:pl,useValue:t.appId},{provide:Gu,useExisting:pl},Yu]}}}return e.\u0275mod=yn({type:e}),e.\u0275inj=ft({factory:function(t){return new(t||e)(Kt(e,12))},providers:gc,imports:[Bu,su]}),e})();function yc(...e){let t=e[e.length-1];return Ae(t)?(e.pop(),Be(e,t)):Xe(e)}"undefined"!=typeof window&&window;class bc extends Ie{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return t&&!t.closed&&e.next(this._value),t}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Te;return this._value}next(e){super.next(this._value=e)}}class xc extends be{notifyNext(e,t,n,r,i){this.destination.next(t)}notifyError(e,t){this.destination.error(e)}notifyComplete(e){this.destination.complete()}}class wc extends be{constructor(e,t,n){super(),this.parent=e,this.outerValue=t,this.outerIndex=n,this.index=0}_next(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}_error(e){this.parent.notifyError(e,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function _c(e,t,n,r,i=new wc(e,n,r)){if(!i.closed)return t instanceof Se?t.subscribe(i):$e(t)(i)}const Sc={};class Ec{constructor(e){this.resultSelector=e}call(e,t){return t.subscribe(new Tc(e,this.resultSelector))}}class Tc extends xc{constructor(e,t){super(e),this.resultSelector=t,this.active=0,this.values=[],this.observables=[]}_next(e){this.values.push(Sc),this.observables.push(e)}_complete(){const e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(let n=0;n<t;n++)this.add(_c(this,e[n],void 0,n))}}notifyComplete(e){0==(this.active-=1)&&this.destination.complete()}notifyNext(e,t,n){const r=this.values,i=this.toRespond?r[n]===Sc?--this.toRespond:this.toRespond:0;r[n]=t,0===i&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))}_tryResultSelector(e){let t;try{t=this.resultSelector.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}const kc=(()=>{function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e})(),Cc=new Se(e=>e.complete());function Ic(e){return e?function(e){return new Se(t=>e.schedule(()=>t.complete()))}(e):Cc}function Oc(e){return new Se(t=>{let n;try{n=e()}catch(r){return void t.error(r)}return(n?ze(n):Ic()).subscribe(t)})}function Ac(){return Ye(1)}function Dc(e,t){return function(n){return n.lift(new Mc(e,t))}}class Mc{constructor(e,t){this.predicate=e,this.thisArg=t}call(e,t){return t.subscribe(new Nc(e,this.predicate,this.thisArg))}}class Nc extends be{constructor(e,t,n){super(e),this.predicate=t,this.thisArg=n,this.count=0}_next(e){let t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}t&&this.destination.next(e)}}const jc=(()=>{function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e})();function Rc(e){return function(t){return 0===e?Ic():t.lift(new Pc(e))}}class Pc{constructor(e){if(this.total=e,this.total<0)throw new jc}call(e,t){return t.subscribe(new Fc(e,this.total))}}class Fc extends be{constructor(e,t){super(e),this.total=t,this.ring=new Array,this.count=0}_next(e){const t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e}_complete(){const e=this.destination;let t=this.count;if(t>0){const n=this.count>=this.total?this.total:this.count,r=this.ring;for(let i=0;i<n;i++){const i=t++%n;e.next(r[i])}}e.complete()}}function Lc(e=zc){return t=>t.lift(new $c(e))}class $c{constructor(e){this.errorFactory=e}call(e,t){return t.subscribe(new Bc(e,this.errorFactory))}}class Bc extends be{constructor(e,t){super(e),this.errorFactory=t,this.hasValue=!1}_next(e){this.hasValue=!0,this.destination.next(e)}_complete(){if(this.hasValue)return this.destination.complete();{let t;try{t=this.errorFactory()}catch(e){t=e}this.destination.error(t)}}}function zc(){return new kc}function Uc(e=null){return t=>t.lift(new Hc(e))}class Hc{constructor(e){this.defaultValue=e}call(e,t){return t.subscribe(new Wc(e,this.defaultValue))}}class Wc extends be{constructor(e,t){super(e),this.defaultValue=t,this.isEmpty=!0}_next(e){this.isEmpty=!1,this.destination.next(e)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function Vc(e,t){return"function"==typeof t?n=>n.pipe(Vc((n,r)=>ze(e(n,r)).pipe(De((e,i)=>t(n,e,r,i))))):t=>t.lift(new qc(e))}class qc{constructor(e){this.project=e}call(e,t){return t.subscribe(new Gc(e,this.project))}}class Gc extends He{constructor(e,t){super(e),this.project=t,this.index=0}_next(e){let t;const n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this._innerSub(t)}_innerSub(e){const t=this.innerSubscription;t&&t.unsubscribe();const n=new Ue(this),r=this.destination;r.add(n),this.innerSubscription=We(e,n),this.innerSubscription!==n&&r.add(this.innerSubscription)}_complete(){const{innerSubscription:e}=this;e&&!e.closed||super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(e){this.destination.next(e)}}function Yc(e){return t=>0===e?Ic():t.lift(new Xc(e))}class Xc{constructor(e){if(this.total=e,this.total<0)throw new jc}call(e,t){return t.subscribe(new Kc(e,this.total))}}class Kc extends be{constructor(e,t){super(e),this.total=t,this.count=0}_next(e){const t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))}}function Zc(...e){return Ac()(yc(...e))}class Jc{constructor(e,t,n=!1){this.accumulator=e,this.seed=t,this.hasSeed=n}call(e,t){return t.subscribe(new Qc(e,this.accumulator,this.seed,this.hasSeed))}}class Qc extends be{constructor(e,t,n,r){super(e),this.accumulator=t,this._seed=n,this.hasSeed=r,this.index=0}get seed(){return this._seed}set seed(e){this.hasSeed=!0,this._seed=e}_next(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}_tryNext(e){const t=this.index++;let n;try{n=this.accumulator(this.seed,e,t)}catch(r){this.destination.error(r)}this.seed=n,this.destination.next(n)}}function ed(e){return function(t){const n=new td(e),r=t.lift(n);return n.caught=r}}class td{constructor(e){this.selector=e}call(e,t){return t.subscribe(new nd(e,this.selector,this.caught))}}class nd extends He{constructor(e,t,n){super(e),this.selector=t,this.caught=n}error(e){if(!this.isStopped){let n;try{n=this.selector(e,this.caught)}catch(t){return void super.error(t)}this._unsubscribeAndRecycle();const r=new Ue(this);this.add(r);const i=We(n,r);i!==r&&this.add(i)}}}function rd(e,t){return Ve(e,t,1)}function id(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Dc((t,n)=>e(t,n,r)):_e,Yc(1),n?Uc(t):Lc(()=>new kc))}function ad(){}function od(e,t,n){return function(r){return r.lift(new sd(e,t,n))}}class sd{constructor(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}call(e,t){return t.subscribe(new ld(e,this.nextOrObserver,this.error,this.complete))}}class ld extends be{constructor(e,t,n,r){super(e),this._tapNext=ad,this._tapError=ad,this._tapComplete=ad,this._tapError=n||ad,this._tapComplete=r||ad,le(t)?(this._context=this,this._tapNext=t):t&&(this._context=t,this._tapNext=t.next||ad,this._tapError=t.error||ad,this._tapComplete=t.complete||ad)}_next(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)}_error(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)}_complete(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}class ud{constructor(e){this.callback=e}call(e,t){return t.subscribe(new cd(e,this.callback))}}class cd extends be{constructor(e,t){super(e),this.add(new ge(t))}}class dd{constructor(e,t){this.id=e,this.url=t}}class hd extends dd{constructor(e,t,n="imperative",r=null){super(e,t),this.navigationTrigger=n,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class fd extends dd{constructor(e,t,n){super(e,t),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class pd extends dd{constructor(e,t,n){super(e,t),this.reason=n}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class md extends dd{constructor(e,t,n){super(e,t),this.error=n}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class gd extends dd{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class vd extends dd{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class yd extends dd{constructor(e,t,n,r,i){super(e,t),this.urlAfterRedirects=n,this.state=r,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class bd extends dd{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class xd extends dd{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class wd{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class _d{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Sd{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ed{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Td{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class kd{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Cd{constructor(e,t,n){this.routerEvent=e,this.position=t,this.anchor=n}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Id="primary";class Od{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Ad(e){return new Od(e)}function Dd(e){const t=Error("NavigationCancelingError: "+e);return t.ngNavigationCancelingError=!0,t}function Md(e,t,n){const r=n.path.split("/");if(r.length>e.length)return null;if("full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const i={};for(let a=0;a<r.length;a++){const t=r[a],n=e[a];if(t.startsWith(":"))i[t.substring(1)]=n;else if(t!==n.path)return null}return{consumed:e.slice(0,r.length),posParams:i}}function Nd(e,t){const n=Object.keys(e),r=Object.keys(t);if(!n||!r||n.length!=r.length)return!1;let i;for(let a=0;a<n.length;a++)if(i=n[a],!jd(e[i],t[i]))return!1;return!0}function jd(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((e,t)=>r[t]===e)}return e===t}function Rd(e){return Array.prototype.concat.apply([],e)}function Pd(e){return e.length>0?e[e.length-1]:null}function Fd(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function Ld(e){return(t=e)&&"function"==typeof t.subscribe?e:jo(e)?ze(Promise.resolve(e)):yc(e);var t}function $d(e,t,n){return n?function(e,t){return Nd(e,t)}(e.queryParams,t.queryParams)&&function e(t,n){if(!Hd(t.segments,n.segments))return!1;if(t.numberOfChildren!==n.numberOfChildren)return!1;for(const r in n.children){if(!t.children[r])return!1;if(!e(t.children[r],n.children[r]))return!1}return!0}(e.root,t.root):function(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>jd(e[n],t[n]))}(e.queryParams,t.queryParams)&&function e(t,n){return function t(n,r,i){if(n.segments.length>i.length)return!!Hd(n.segments.slice(0,i.length),i)&&!r.hasChildren();if(n.segments.length===i.length){if(!Hd(n.segments,i))return!1;for(const t in r.children){if(!n.children[t])return!1;if(!e(n.children[t],r.children[t]))return!1}return!0}{const e=i.slice(0,n.segments.length),a=i.slice(n.segments.length);return!!Hd(n.segments,e)&&!!n.children.primary&&t(n.children.primary,r,a)}}(t,n,n.segments)}(e.root,t.root)}class Bd{constructor(e,t,n){this.root=e,this.queryParams=t,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ad(this.queryParams)),this._queryParamMap}toString(){return Gd.serialize(this)}}class zd{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Fd(t,(e,t)=>e.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Yd(this)}}class Ud{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=Ad(this.parameters)),this._parameterMap}toString(){return eh(this)}}function Hd(e,t){return e.length===t.length&&e.every((e,n)=>e.path===t[n].path)}function Wd(e,t){let n=[];return Fd(e.children,(e,r)=>{r===Id&&(n=n.concat(t(e,r)))}),Fd(e.children,(e,r)=>{r!==Id&&(n=n.concat(t(e,r)))}),n}class Vd{}class qd{parse(e){const t=new ah(e);return new Bd(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){return`${"/"+function e(t,n){if(!t.hasChildren())return Yd(t);if(n){const n=t.children.primary?e(t.children.primary,!1):"",r=[];return Fd(t.children,(t,n)=>{n!==Id&&r.push(`${n}:${e(t,!1)}`)}),r.length>0?`${n}(${r.join("//")})`:n}{const n=Wd(t,(n,r)=>r===Id?[e(t.children.primary,!1)]:[`${r}:${e(n,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children.primary?`${Yd(t)}/${n[0]}`:`${Yd(t)}/(${n.join("//")})`}}(e.root,!0)}${function(e){const t=Object.keys(e).map(t=>{const n=e[t];return Array.isArray(n)?n.map(e=>`${Kd(t)}=${Kd(e)}`).join("&"):`${Kd(t)}=${Kd(n)}`});return t.length?"?"+t.join("&"):""}(e.queryParams)}${"string"==typeof e.fragment?"#"+encodeURI(e.fragment):""}`}}const Gd=new qd;function Yd(e){return e.segments.map(e=>eh(e)).join("/")}function Xd(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Kd(e){return Xd(e).replace(/%3B/gi,";")}function Zd(e){return Xd(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Jd(e){return decodeURIComponent(e)}function Qd(e){return Jd(e.replace(/\+/g,"%20"))}function eh(e){return`${Zd(e.path)}${t=e.parameters,Object.keys(t).map(e=>`;${Zd(e)}=${Zd(t[e])}`).join("")}`;var t}const th=/^[^\/()?;=#]+/;function nh(e){const t=e.match(th);return t?t[0]:""}const rh=/^[^=?&#]+/,ih=/^[^?&#]+/;class ah{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new zd([],{}):new zd([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n.primary=new zd(e,t)),n}parseSegment(){const e=nh(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new Ud(Jd(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=nh(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=nh(this.remaining);e&&(n=e,this.capture(n))}e[Jd(t)]=Jd(n)}parseQueryParam(e){const t=function(e){const t=e.match(rh);return t?t[0]:""}(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=function(e){const t=e.match(ih);return t?t[0]:""}(this.remaining);e&&(n=e,this.capture(n))}const r=Qd(t),i=Qd(n);if(e.hasOwnProperty(r)){let t=e[r];Array.isArray(t)||(t=[t],e[r]=t),t.push(i)}else e[r]=i}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=nh(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error(`Cannot parse url '${this.url}'`);let i=void 0;n.indexOf(":")>-1?(i=n.substr(0,n.indexOf(":")),this.capture(i),this.capture(":")):e&&(i=Id);const a=this.parseChildren();t[i]=1===Object.keys(a).length?a.primary:new zd([],a),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class oh{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=sh(e,this._root);return t?t.children.map(e=>e.value):[]}firstChild(e){const t=sh(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=lh(e,this._root);return t.length<2?[]:t[t.length-2].children.map(e=>e.value).filter(t=>t!==e)}pathFromRoot(e){return lh(e,this._root).map(e=>e.value)}}function sh(e,t){if(e===t.value)return t;for(const n of t.children){const t=sh(e,n);if(t)return t}return null}function lh(e,t){if(e===t.value)return[t];for(const n of t.children){const r=lh(e,n);if(r.length)return r.unshift(t),r}return[]}class uh{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function ch(e){const t={};return e&&e.children.forEach(e=>t[e.value.outlet]=e),t}class dh extends oh{constructor(e,t){super(e),this.snapshot=t,vh(this,e)}toString(){return this.snapshot.toString()}}function hh(e,t){const n=function(e,t){const n=new mh([],{},{},"",{},Id,t,null,e.root,-1,{});return new gh("",new uh(n,[]))}(e,t),r=new bc([new Ud("",{})]),i=new bc({}),a=new bc({}),o=new bc({}),s=new bc(""),l=new fh(r,i,o,s,a,Id,t,n.root);return l.snapshot=n.root,new dh(new uh(l,[]),n)}class fh{constructor(e,t,n,r,i,a,o,s){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=a,this.component=o,this._futureSnapshot=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(De(e=>Ad(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(De(e=>Ad(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function ph(e,t="emptyOnly"){const n=e.pathFromRoot;let r=0;if("always"!==t)for(r=n.length-1;r>=1;){const e=n[r],t=n[r-1];if(e.routeConfig&&""===e.routeConfig.path)r--;else{if(t.component)break;r--}}return function(e){return e.reduce((e,t)=>({params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(r))}class mh{constructor(e,t,n,r,i,a,o,s,l,u,c){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=a,this.component=o,this.routeConfig=s,this._urlSegment=l,this._lastPathIndex=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Ad(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ad(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(e=>e.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class gh extends oh{constructor(e,t){super(t),this.url=e,vh(this,t)}toString(){return yh(this._root)}}function vh(e,t){t.value._routerState=e,t.children.forEach(t=>vh(e,t))}function yh(e){const t=e.children.length>0?` { ${e.children.map(yh).join(", ")} } `:"";return`${e.value}${t}`}function bh(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Nd(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),Nd(t.params,n.params)||e.params.next(n.params),function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Nd(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),Nd(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function xh(e,t){var n,r;return Nd(e.params,t.params)&&Hd(n=e.url,r=t.url)&&n.every((e,t)=>Nd(e.parameters,r[t].parameters))&&!(!e.parent!=!t.parent)&&(!e.parent||xh(e.parent,t.parent))}function wh(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function _h(e,t,n,r,i){let a={};return r&&Fd(r,(e,t)=>{a[t]=Array.isArray(e)?e.map(e=>""+e):""+e}),new Bd(n.root===e?t:function e(t,n,r){const i={};return Fd(t.children,(t,a)=>{i[a]=t===n?r:e(t,n,r)}),new zd(t.segments,i)}(n.root,e,t),a,i)}class Sh{constructor(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&wh(n[0]))throw new Error("Root segment cannot have matrix parameters");const r=n.find(e=>"object"==typeof e&&null!=e&&e.outlets);if(r&&r!==Pd(n))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Eh{constructor(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}}function Th(e){return"object"==typeof e&&null!=e&&e.outlets?e.outlets.primary:""+e}function kh(e,t,n){if(e||(e=new zd([],{})),0===e.segments.length&&e.hasChildren())return Ch(e,t,n);const r=function(e,t,n){let r=0,i=t;const a={match:!1,pathIndex:0,commandIndex:0};for(;i<e.segments.length;){if(r>=n.length)return a;const t=e.segments[i],o=Th(n[r]),s=r<n.length-1?n[r+1]:null;if(i>0&&void 0===o)break;if(o&&s&&"object"==typeof s&&void 0===s.outlets){if(!Dh(o,s,t))return a;r+=2}else{if(!Dh(o,{},t))return a;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(e,t,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const t=new zd(e.segments.slice(0,r.pathIndex),{});return t.children.primary=new zd(e.segments.slice(r.pathIndex),e.children),Ch(t,0,i)}return r.match&&0===i.length?new zd(e.segments,{}):r.match&&!e.hasChildren()?Ih(e,t,n):r.match?Ch(e,0,i):Ih(e,t,n)}function Ch(e,t,n){if(0===n.length)return new zd(e.segments,{});{const r=function(e){return"object"==typeof e[0]&&null!==e[0]&&e[0].outlets?e[0].outlets:{[Id]:e}}(n),i={};return Fd(r,(n,r)=>{null!==n&&(i[r]=kh(e.children[r],t,n))}),Fd(e.children,(e,t)=>{void 0===r[t]&&(i[t]=e)}),new zd(e.segments,i)}}function Ih(e,t,n){const r=e.segments.slice(0,t);let i=0;for(;i<n.length;){if("object"==typeof n[i]&&null!==n[i]&&void 0!==n[i].outlets){const e=Oh(n[i].outlets);return new zd(r,e)}if(0===i&&wh(n[0])){r.push(new Ud(e.segments[t].path,n[0])),i++;continue}const a=Th(n[i]),o=i<n.length-1?n[i+1]:null;a&&o&&wh(o)?(r.push(new Ud(a,Ah(o))),i+=2):(r.push(new Ud(a,{})),i++)}return new zd(r,{})}function Oh(e){const t={};return Fd(e,(e,n)=>{null!==e&&(t[n]=Ih(new zd([],{}),0,e))}),t}function Ah(e){const t={};return Fd(e,(e,n)=>t[n]=""+e),t}function Dh(e,t,n){return e==n.path&&Nd(t,n.parameters)}class Mh{constructor(e,t,n,r){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=r}activate(e){const t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),bh(this.futureState.root),this.activateChildRoutes(t,n,e)}deactivateChildRoutes(e,t,n){const r=ch(t);e.children.forEach(e=>{const t=e.value.outlet;this.deactivateRoutes(e,r[t],n),delete r[t]}),Fd(r,(e,t)=>{this.deactivateRouteAndItsChildren(e,n)})}deactivateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(r===i)if(r.component){const i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(e,t,i.children)}else this.deactivateChildRoutes(e,t,n);else i&&this.deactivateRouteAndItsChildren(t,n)}deactivateRouteAndItsChildren(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const n=t.getContext(e.value.outlet);if(n&&n.outlet){const t=n.outlet.detach(),r=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:t,route:e,contexts:r})}}deactivateRouteAndOutlet(e,t){const n=t.getContext(e.value.outlet);if(n){const r=ch(e),i=e.value.component?n.children:t;Fd(r,(e,t)=>this.deactivateRouteAndItsChildren(e,i)),n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated())}}activateChildRoutes(e,t,n){const r=ch(t);e.children.forEach(e=>{this.activateRoutes(e,r[e.value.outlet],n),this.forwardEvent(new kd(e.value.snapshot))}),e.children.length&&this.forwardEvent(new Ed(e.value.snapshot))}activateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(bh(r),r===i)if(r.component){const i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,i.children)}else this.activateChildRoutes(e,t,n);else if(r.component){const t=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const e=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),t.children.onOutletReAttached(e.contexts),t.attachRef=e.componentRef,t.route=e.route.value,t.outlet&&t.outlet.attach(e.componentRef,e.route.value),Nh(e.route)}else{const n=function(e){for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig;if(e&&e.component)return null}return null}(r.snapshot),i=n?n.module.componentFactoryResolver:null;t.attachRef=null,t.route=r,t.resolver=i,t.outlet&&t.outlet.activateWith(r,i),this.activateChildRoutes(e,null,t.children)}}else this.activateChildRoutes(e,null,n)}}function Nh(e){bh(e.value),e.children.forEach(Nh)}class jh{constructor(e,t){this.routes=e,this.module=t}}function Rh(e){return"function"==typeof e}function Ph(e){return e instanceof Bd}const Fh=Symbol("INITIAL_VALUE");function Lh(){return Vc(e=>function(...e){let t=void 0,n=void 0;return Ae(e[e.length-1])&&(n=e.pop()),"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&fe(e[0])&&(e=e[0]),Xe(e,n).lift(new Ec(t))}(...e.map(e=>e.pipe(Yc(1),function(...e){const t=e[e.length-1];return Ae(t)?(e.pop(),n=>Zc(e,n,t)):t=>Zc(e,t)}(Fh)))).pipe(function(e,t){let n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new Jc(e,t,n))}}((e,t)=>{let n=!1;return t.reduce((e,r,i)=>{if(e!==Fh)return e;if(r===Fh&&(n=!0),!n){if(!1===r)return r;if(i===t.length-1||Ph(r))return r}return e},e)},Fh),Dc(e=>e!==Fh),De(e=>Ph(e)?e:!0===e),Yc(1)))}class $h{constructor(e){this.segmentGroup=e||null}}class Bh{constructor(e){this.urlTree=e}}function zh(e){return new Se(t=>t.error(new $h(e)))}function Uh(e){return new Se(t=>t.error(new Bh(e)))}function Hh(e){return new Se(t=>t.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${e}'`)))}class Wh{constructor(e,t,n,r,i){this.configLoader=t,this.urlSerializer=n,this.urlTree=r,this.config=i,this.allowRedirects=!0,this.ngModule=e.get(en)}apply(){return this.expandSegmentGroup(this.ngModule,this.config,this.urlTree.root,Id).pipe(De(e=>this.createUrlTree(e,this.urlTree.queryParams,this.urlTree.fragment))).pipe(ed(e=>{if(e instanceof Bh)return this.allowRedirects=!1,this.match(e.urlTree);if(e instanceof $h)throw this.noMatchError(e);throw e}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,Id).pipe(De(t=>this.createUrlTree(t,e.queryParams,e.fragment))).pipe(ed(e=>{if(e instanceof $h)throw this.noMatchError(e);throw e}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,n){const r=e.segments.length>0?new zd([],{[Id]:e}):e;return new Bd(r,t,n)}expandSegmentGroup(e,t,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(e,t,n).pipe(De(e=>new zd([],e))):this.expandSegment(e,n,t,n.segments,r,!0)}expandChildren(e,t,n){return function(e,t){if(0===Object.keys(e).length)return yc({});const n=[],r=[],i={};return Fd(e,(e,a)=>{const o=t(a,e).pipe(De(e=>i[a]=e));a===Id?n.push(o):r.push(o)}),yc.apply(null,n.concat(r)).pipe(Ac(),function(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Dc((t,n)=>e(t,n,r)):_e,Rc(1),n?Uc(t):Lc(()=>new kc))}(),De(()=>i))}(n.children,(n,r)=>this.expandSegmentGroup(e,t,r,n))}expandSegment(e,t,n,r,i,a){return yc(...n).pipe(rd(o=>this.expandSegmentAgainstRoute(e,t,n,o,r,i,a).pipe(ed(e=>{if(e instanceof $h)return yc(null);throw e}))),id(e=>!!e),ed((e,n)=>{if(e instanceof kc||"EmptyError"===e.name){if(this.noLeftoversInUrl(t,r,i))return yc(new zd([],{}));throw new $h(t)}throw e}))}noLeftoversInUrl(e,t,n){return 0===t.length&&!e.children[n]}expandSegmentAgainstRoute(e,t,n,r,i,a,o){return Yh(r)!==a?zh(t):void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,i):o&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,a):zh(t)}expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,a){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,r,a):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,a)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,n,r){const i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?Uh(i):this.lineralizeSegments(n,i).pipe(Ve(n=>{const i=new zd(n,{});return this.expandSegment(e,i,t,n,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,a){const{matched:o,consumedSegments:s,lastChild:l,positionalParamSegments:u}=Vh(t,r,i);if(!o)return zh(t);const c=this.applyRedirectCommands(s,r.redirectTo,u);return r.redirectTo.startsWith("/")?Uh(c):this.lineralizeSegments(r,c).pipe(Ve(r=>this.expandSegment(e,t,n,r.concat(i.slice(l)),a,!1)))}matchSegmentAgainstRoute(e,t,n,r){if("**"===n.path)return n.loadChildren?this.configLoader.load(e.injector,n).pipe(De(e=>(n._loadedConfig=e,new zd(r,{})))):yc(new zd(r,{}));const{matched:i,consumedSegments:a,lastChild:o}=Vh(t,n,r);if(!i)return zh(t);const s=r.slice(o);return this.getChildConfig(e,n,r).pipe(Ve(e=>{const n=e.module,r=e.routes,{segmentGroup:i,slicedSegments:o}=function(e,t,n,r){return n.length>0&&function(e,t,n){return n.some(n=>Gh(e,t,n)&&Yh(n)!==Id)}(e,n,r)?{segmentGroup:qh(new zd(t,function(e,t){const n={};n.primary=t;for(const r of e)""===r.path&&Yh(r)!==Id&&(n[Yh(r)]=new zd([],{}));return n}(r,new zd(n,e.children)))),slicedSegments:[]}:0===n.length&&function(e,t,n){return n.some(n=>Gh(e,t,n))}(e,n,r)?{segmentGroup:qh(new zd(e.segments,function(e,t,n,r){const i={};for(const a of n)Gh(e,t,a)&&!r[Yh(a)]&&(i[Yh(a)]=new zd([],{}));return Object.assign(Object.assign({},r),i)}(e,n,r,e.children))),slicedSegments:n}:{segmentGroup:e,slicedSegments:n}}(t,a,s,r);return 0===o.length&&i.hasChildren()?this.expandChildren(n,r,i).pipe(De(e=>new zd(a,e))):0===r.length&&0===o.length?yc(new zd(a,{})):this.expandSegment(n,i,r,o,Id,!0).pipe(De(e=>new zd(a.concat(e.segments),e.children)))}))}getChildConfig(e,t,n){return t.children?yc(new jh(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?yc(t._loadedConfig):this.runCanLoadGuards(e.injector,t,n).pipe(Ve(n=>n?this.configLoader.load(e.injector,t).pipe(De(e=>(t._loadedConfig=e,e))):function(e){return new Se(t=>t.error(Dd(`Cannot load children because the guard of the route "path: '${e.path}'" returned false`)))}(t))):yc(new jh([],e))}runCanLoadGuards(e,t,n){const r=t.canLoad;return r&&0!==r.length?yc(r.map(r=>{const i=e.get(r);let a;if(function(e){return e&&Rh(e.canLoad)}(i))a=i.canLoad(t,n);else{if(!Rh(i))throw new Error("Invalid CanLoad guard");a=i(t,n)}return Ld(a)})).pipe(Lh(),od(e=>{if(!Ph(e))return;const t=Dd(`Redirecting to "${this.urlSerializer.serialize(e)}"`);throw t.url=e,t}),De(e=>!0===e)):yc(!0)}lineralizeSegments(e,t){let n=[],r=t.root;for(;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return yc(n);if(r.numberOfChildren>1||!r.children.primary)return Hh(e.redirectTo);r=r.children.primary}}applyRedirectCommands(e,t,n){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,n)}applyRedirectCreatreUrlTree(e,t,n,r){const i=this.createSegmentGroup(e,t.root,n,r);return new Bd(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const n={};return Fd(e,(e,r)=>{if("string"==typeof e&&e.startsWith(":")){const i=e.substring(1);n[r]=t[i]}else n[r]=e}),n}createSegmentGroup(e,t,n,r){const i=this.createSegments(e,t.segments,n,r);let a={};return Fd(t.children,(t,i)=>{a[i]=this.createSegmentGroup(e,t,n,r)}),new zd(i,a)}createSegments(e,t,n,r){return t.map(t=>t.path.startsWith(":")?this.findPosParam(e,t,r):this.findOrReturn(t,n))}findPosParam(e,t,n){const r=n[t.path.substring(1)];if(!r)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return r}findOrReturn(e,t){let n=0;for(const r of t){if(r.path===e.path)return t.splice(n),r;n++}return e}}function Vh(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}:{matched:!0,consumedSegments:[],lastChild:0,positionalParamSegments:{}};const r=(t.matcher||Md)(n,e,t);return r?{matched:!0,consumedSegments:r.consumed,lastChild:r.consumed.length,positionalParamSegments:r.posParams}:{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}}function qh(e){if(1===e.numberOfChildren&&e.children.primary){const t=e.children.primary;return new zd(e.segments.concat(t.segments),t.children)}return e}function Gh(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0!==n.redirectTo}function Yh(e){return e.outlet||Id}class Xh{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class Kh{constructor(e,t){this.component=e,this.route=t}}function Zh(e,t,n){const r=e._root;return function e(t,n,r,i,a={canDeactivateChecks:[],canActivateChecks:[]}){const o=ch(n);return t.children.forEach(t=>{!function(t,n,r,i,a={canDeactivateChecks:[],canActivateChecks:[]}){const o=t.value,s=n?n.value:null,l=r?r.getContext(t.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){const u=function(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!Hd(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Hd(e.url,t.url)||!Nd(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!xh(e,t)||!Nd(e.queryParams,t.queryParams);case"paramsChange":default:return!xh(e,t)}}(s,o,o.routeConfig.runGuardsAndResolvers);u?a.canActivateChecks.push(new Xh(i)):(o.data=s.data,o._resolvedData=s._resolvedData),e(t,n,o.component?l?l.children:null:r,i,a),u&&l&&l.outlet&&l.outlet.isActivated&&a.canDeactivateChecks.push(new Kh(l.outlet.component,s))}else s&&Qh(n,l,a),a.canActivateChecks.push(new Xh(i)),e(t,null,o.component?l?l.children:null:r,i,a)}(t,o[t.value.outlet],r,i.concat([t.value]),a),delete o[t.value.outlet]}),Fd(o,(e,t)=>Qh(e,r.getContext(t),a)),a}(r,t?t._root:null,n,[r.value])}function Jh(e,t,n){const r=function(e){if(!e)return null;for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig}return null}(t);return(r?r.module.injector:n).get(e)}function Qh(e,t,n){const r=ch(e),i=e.value;Fd(r,(e,r)=>{Qh(e,i.component?t?t.children.getContext(r):null:t,n)}),n.canDeactivateChecks.push(new Kh(i.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,i))}function ef(e,t){return null!==e&&t&&t(new Td(e)),yc(!0)}function tf(e,t){return null!==e&&t&&t(new Sd(e)),yc(!0)}function nf(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;return r&&0!==r.length?yc(r.map(r=>Oc(()=>{const i=Jh(r,t,n);let a;if(function(e){return e&&Rh(e.canActivate)}(i))a=Ld(i.canActivate(t,e));else{if(!Rh(i))throw new Error("Invalid CanActivate guard");a=Ld(i(t,e))}return a.pipe(id())}))).pipe(Lh()):yc(!0)}function rf(e,t,n){const r=t[t.length-1],i=t.slice(0,t.length-1).reverse().map(e=>function(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(e)).filter(e=>null!==e).map(t=>Oc(()=>yc(t.guards.map(i=>{const a=Jh(i,t.node,n);let o;if(function(e){return e&&Rh(e.canActivateChild)}(a))o=Ld(a.canActivateChild(r,e));else{if(!Rh(a))throw new Error("Invalid CanActivateChild guard");o=Ld(a(r,e))}return o.pipe(id())})).pipe(Lh())));return yc(i).pipe(Lh())}class af{}class of{constructor(e,t,n,r,i,a){this.rootComponentType=e,this.config=t,this.urlTree=n,this.url=r,this.paramsInheritanceStrategy=i,this.relativeLinkResolution=a}recognize(){try{const e=uf(this.urlTree.root,[],[],this.config,this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,Id),n=new mh([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Id,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new uh(n,t),i=new gh(this.url,r);return this.inheritParamsAndData(i._root),yc(i)}catch(e){return new Se(t=>t.error(e))}}inheritParamsAndData(e){const t=e.value,n=ph(t,this.paramsInheritanceStrategy);t.params=Object.freeze(n.params),t.data=Object.freeze(n.data),e.children.forEach(e=>this.inheritParamsAndData(e))}processSegmentGroup(e,t,n){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,n)}processChildren(e,t){const n=Wd(t,(t,n)=>this.processSegmentGroup(e,t,n));return function(e){const t={};e.forEach(e=>{const n=t[e.value.outlet];if(n){const t=n.url.map(e=>e.toString()).join("/"),r=e.value.url.map(e=>e.toString()).join("/");throw new Error(`Two segments cannot have the same outlet name: '${t}' and '${r}'.`)}t[e.value.outlet]=e.value})}(n),n.sort((e,t)=>e.value.outlet===Id?-1:t.value.outlet===Id?1:e.value.outlet.localeCompare(t.value.outlet)),n}processSegment(e,t,n,r){for(const a of e)try{return this.processSegmentAgainstRoute(a,t,n,r)}catch(i){if(!(i instanceof af))throw i}if(this.noLeftoversInUrl(t,n,r))return[];throw new af}noLeftoversInUrl(e,t,n){return 0===t.length&&!e.children[n]}processSegmentAgainstRoute(e,t,n,r){if(e.redirectTo)throw new af;if((e.outlet||Id)!==r)throw new af;let i,a=[],o=[];if("**"===e.path){const a=n.length>0?Pd(n).parameters:{};i=new mh(n,a,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,hf(e),r,e.component,e,sf(t),lf(t)+n.length,ff(e))}else{const s=function(e,t,n){if(""===t.path){if("full"===t.pathMatch&&(e.hasChildren()||n.length>0))throw new af;return{consumedSegments:[],lastChild:0,parameters:{}}}const r=(t.matcher||Md)(n,e,t);if(!r)throw new af;const i={};Fd(r.posParams,(e,t)=>{i[t]=e.path});const a=r.consumed.length>0?Object.assign(Object.assign({},i),r.consumed[r.consumed.length-1].parameters):i;return{consumedSegments:r.consumed,lastChild:r.consumed.length,parameters:a}}(t,e,n);a=s.consumedSegments,o=n.slice(s.lastChild),i=new mh(a,s.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,hf(e),r,e.component,e,sf(t),lf(t)+a.length,ff(e))}const s=function(e){return e.children?e.children:e.loadChildren?e._loadedConfig.routes:[]}(e),{segmentGroup:l,slicedSegments:u}=uf(t,a,o,s,this.relativeLinkResolution);if(0===u.length&&l.hasChildren()){const e=this.processChildren(s,l);return[new uh(i,e)]}if(0===s.length&&0===u.length)return[new uh(i,[])];const c=this.processSegment(s,l,u,Id);return[new uh(i,c)]}}function sf(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function lf(e){let t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift?t._segmentIndexShift:0;return n-1}function uf(e,t,n,r,i){if(n.length>0&&function(e,t,n){return n.some(n=>cf(e,t,n)&&df(n)!==Id)}(e,n,r)){const i=new zd(t,function(e,t,n,r){const i={};i.primary=r,r._sourceSegment=e,r._segmentIndexShift=t.length;for(const a of n)if(""===a.path&&df(a)!==Id){const n=new zd([],{});n._sourceSegment=e,n._segmentIndexShift=t.length,i[df(a)]=n}return i}(e,t,r,new zd(n,e.children)));return i._sourceSegment=e,i._segmentIndexShift=t.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(e,t,n){return n.some(n=>cf(e,t,n))}(e,n,r)){const a=new zd(e.segments,function(e,t,n,r,i,a){const o={};for(const s of r)if(cf(e,n,s)&&!i[df(s)]){const n=new zd([],{});n._sourceSegment=e,n._segmentIndexShift="legacy"===a?e.segments.length:t.length,o[df(s)]=n}return Object.assign(Object.assign({},i),o)}(e,t,n,r,e.children,i));return a._sourceSegment=e,a._segmentIndexShift=t.length,{segmentGroup:a,slicedSegments:n}}const a=new zd(e.segments,e.children);return a._sourceSegment=e,a._segmentIndexShift=t.length,{segmentGroup:a,slicedSegments:n}}function cf(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0===n.redirectTo}function df(e){return e.outlet||Id}function hf(e){return e.data||{}}function ff(e){return e.resolve||{}}function pf(e){return function(t){return t.pipe(Vc(t=>{const n=e(t);return n?ze(n).pipe(De(()=>t)):ze([t])}))}}class mf extends class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}let gf=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=pn({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,t){1&e&&Mo(0,"router-outlet")},directives:function(){return[Af]},encapsulation:2}),e})();function vf(e,t=""){for(let n=0;n<e.length;n++){const r=e[n];yf(r,bf(t,r))}}function yf(e,t){if(!e)throw new Error(`\n      Invalid configuration of route '${t}': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    `);if(Array.isArray(e))throw new Error(`Invalid configuration of route '${t}': Array cannot be specified`);if(!e.component&&!e.children&&!e.loadChildren&&e.outlet&&e.outlet!==Id)throw new Error(`Invalid configuration of route '${t}': a componentless route without children or loadChildren cannot have a named outlet set`);if(e.redirectTo&&e.children)throw new Error(`Invalid configuration of route '${t}': redirectTo and children cannot be used together`);if(e.redirectTo&&e.loadChildren)throw new Error(`Invalid configuration of route '${t}': redirectTo and loadChildren cannot be used together`);if(e.children&&e.loadChildren)throw new Error(`Invalid configuration of route '${t}': children and loadChildren cannot be used together`);if(e.redirectTo&&e.component)throw new Error(`Invalid configuration of route '${t}': redirectTo and component cannot be used together`);if(e.path&&e.matcher)throw new Error(`Invalid configuration of route '${t}': path and matcher cannot be used together`);if(void 0===e.redirectTo&&!e.component&&!e.children&&!e.loadChildren)throw new Error(`Invalid configuration of route '${t}'. One of the following must be provided: component, redirectTo, children or loadChildren`);if(void 0===e.path&&void 0===e.matcher)throw new Error(`Invalid configuration of route '${t}': routes must have either a path or a matcher specified`);if("string"==typeof e.path&&"/"===e.path.charAt(0))throw new Error(`Invalid configuration of route '${t}': path cannot start with a slash`);if(""===e.path&&void 0!==e.redirectTo&&void 0===e.pathMatch)throw new Error(`Invalid configuration of route '{path: "${t}", redirectTo: "${e.redirectTo}"}': please provide 'pathMatch'. The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'.`);if(void 0!==e.pathMatch&&"full"!==e.pathMatch&&"prefix"!==e.pathMatch)throw new Error(`Invalid configuration of route '${t}': pathMatch can only be set to 'prefix' or 'full'`);e.children&&vf(e.children,t)}function bf(e,t){return t?e||t.path?e&&!t.path?e+"/":!e&&t.path?t.path:`${e}/${t.path}`:"":e}function xf(e){const t=e.children&&e.children.map(xf),n=t?Object.assign(Object.assign({},e),{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&n.outlet!==Id&&(n.component=gf),n}const wf=new $t("ROUTES");class _f{constructor(e,t,n,r){this.loader=e,this.compiler=t,this.onLoadStartListener=n,this.onLoadEndListener=r}load(e,t){return this.onLoadStartListener&&this.onLoadStartListener(t),this.loadModuleFactory(t.loadChildren).pipe(De(n=>{this.onLoadEndListener&&this.onLoadEndListener(t);const r=n.create(e);return new jh(Rd(r.injector.get(wf)).map(xf),r)}))}loadModuleFactory(e){return"string"==typeof e?ze(this.loader.load(e)):Ld(e()).pipe(Ve(e=>e instanceof tn?yc(e):ze(this.compiler.compileModuleAsync(e))))}}class Sf{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Ef,this.attachRef=null}}class Ef{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const n=this.getOrCreateContext(e);n.outlet=t,this.contexts.set(e,n)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new Sf,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}class Tf{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function kf(e){throw e}function Cf(e,t,n){return t.parse("/")}function If(e,t){return yc(null)}let Of=(()=>{class e{constructor(e,t,n,r,i,a,o,s){this.rootComponentType=e,this.urlSerializer=t,this.rootContexts=n,this.location=r,this.config=s,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.lastLocationChangeInfo=null,this.navigationId=0,this.isNgZoneEnabled=!1,this.events=new Ie,this.errorHandler=kf,this.malformedUriErrorHandler=Cf,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:If,afterPreactivation:If},this.urlHandlingStrategy=new Tf,this.routeReuseStrategy=new mf,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="legacy",this.ngModule=i.get(en),this.console=i.get(xl);const l=i.get(Nl);this.isNgZoneEnabled=l instanceof Nl,this.resetConfig(s),this.currentUrlTree=new Bd(new zd([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new _f(a,o,e=>this.triggerEvent(new wd(e)),e=>this.triggerEvent(new _d(e))),this.routerState=hh(this.currentUrlTree,this.rootComponentType),this.transitions=new bc({id:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}setupNavigations(e){const t=this.events;return e.pipe(Dc(e=>0!==e.id),De(e=>Object.assign(Object.assign({},e),{extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl)})),Vc(e=>{let n=!1,r=!1;return yc(e).pipe(od(e=>{this.currentNavigation={id:e.id,initialUrl:e.currentRawUrl,extractedUrl:e.extractedUrl,trigger:e.source,extras:e.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Vc(e=>{const n=!this.navigated||e.extractedUrl.toString()!==this.browserUrlTree.toString();if(("reload"===this.onSameUrlNavigation||n)&&this.urlHandlingStrategy.shouldProcessUrl(e.rawUrl))return yc(e).pipe(Vc(e=>{const n=this.transitions.getValue();return t.next(new hd(e.id,this.serializeUrl(e.extractedUrl),e.source,e.restoredState)),n!==this.transitions.getValue()?Cc:[e]}),Vc(e=>Promise.resolve(e)),(r=this.ngModule.injector,i=this.configLoader,a=this.urlSerializer,o=this.config,function(e){return e.pipe(Vc(e=>function(e,t,n,r,i){return new Wh(e,t,n,r,i).apply()}(r,i,a,e.extractedUrl,o).pipe(De(t=>Object.assign(Object.assign({},e),{urlAfterRedirects:t})))))}),od(e=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:e.urlAfterRedirects})}),function(e,t,n,r,i){return function(a){return a.pipe(Ve(a=>function(e,t,n,r,i="emptyOnly",a="legacy"){return new of(e,t,n,r,i,a).recognize()}(e,t,a.urlAfterRedirects,n(a.urlAfterRedirects),r,i).pipe(De(e=>Object.assign(Object.assign({},a),{targetSnapshot:e})))))}}(this.rootComponentType,this.config,e=>this.serializeUrl(e),this.paramsInheritanceStrategy,this.relativeLinkResolution),od(e=>{"eager"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(e.urlAfterRedirects,!!e.extras.replaceUrl,e.id,e.extras.state),this.browserUrlTree=e.urlAfterRedirects)}),od(e=>{const n=new gd(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.next(n)}));var r,i,a,o;if(n&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:n,extractedUrl:r,source:i,restoredState:a,extras:o}=e,s=new hd(n,this.serializeUrl(r),i,a);t.next(s);const l=hh(r,this.rootComponentType).snapshot;return yc(Object.assign(Object.assign({},e),{targetSnapshot:l,urlAfterRedirects:r,extras:Object.assign(Object.assign({},o),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=e.rawUrl,this.browserUrlTree=e.urlAfterRedirects,e.resolve(null),Cc}),pf(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:a,replaceUrl:o}}=e;return this.hooks.beforePreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!a,replaceUrl:!!o})}),od(e=>{const t=new vd(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),De(e=>Object.assign(Object.assign({},e),{guards:Zh(e.targetSnapshot,e.currentSnapshot,this.rootContexts)})),function(e,t){return function(n){return n.pipe(Ve(n=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:a,canDeactivateChecks:o}}=n;return 0===o.length&&0===a.length?yc(Object.assign(Object.assign({},n),{guardsResult:!0})):function(e,t,n,r){return ze(e).pipe(Ve(e=>function(e,t,n,r,i){const a=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return a&&0!==a.length?yc(a.map(a=>{const o=Jh(a,t,i);let s;if(function(e){return e&&Rh(e.canDeactivate)}(o))s=Ld(o.canDeactivate(e,t,n,r));else{if(!Rh(o))throw new Error("Invalid CanDeactivate guard");s=Ld(o(e,t,n,r))}return s.pipe(id())})).pipe(Lh()):yc(!0)}(e.component,e.route,n,t,r)),id(e=>!0!==e,!0))}(o,r,i,e).pipe(Ve(n=>n&&"boolean"==typeof n?function(e,t,n,r){return ze(t).pipe(rd(t=>ze([tf(t.route.parent,r),ef(t.route,r),rf(e,t.path,n),nf(e,t.route,n)]).pipe(Ac(),id(e=>!0!==e,!0))),id(e=>!0!==e,!0))}(r,a,e,t):yc(n)),De(e=>Object.assign(Object.assign({},n),{guardsResult:e})))}))}}(this.ngModule.injector,e=>this.triggerEvent(e)),od(e=>{if(Ph(e.guardsResult)){const t=Dd(`Redirecting to "${this.serializeUrl(e.guardsResult)}"`);throw t.url=e.guardsResult,t}}),od(e=>{const t=new yd(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot,!!e.guardsResult);this.triggerEvent(t)}),Dc(e=>{if(!e.guardsResult){this.resetUrlToCurrentUrlTree();const n=new pd(e.id,this.serializeUrl(e.extractedUrl),"");return t.next(n),e.resolve(!1),!1}return!0}),pf(e=>{if(e.guards.canActivateChecks.length)return yc(e).pipe(od(e=>{const t=new bd(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),Vc(e=>{let n=!1;return yc(e).pipe((r=this.paramsInheritanceStrategy,i=this.ngModule.injector,function(e){return e.pipe(Ve(e=>{const{targetSnapshot:t,guards:{canActivateChecks:n}}=e;if(!n.length)return yc(e);let a=0;return ze(n).pipe(rd(e=>function(e,t,n,r){return function(e,t,n,r){const i=Object.keys(e);if(0===i.length)return yc({});const a={};return ze(i).pipe(Ve(i=>function(e,t,n,r){const i=Jh(e,t,r);return Ld(i.resolve?i.resolve(t,n):i(t,n))}(e[i],t,n,r).pipe(od(e=>{a[i]=e}))),Rc(1),Ve(()=>Object.keys(a).length===i.length?yc(a):Cc))}(e._resolve,e,t,r).pipe(De(t=>(e._resolvedData=t,e.data=Object.assign(Object.assign({},e.data),ph(e,n).resolve),null)))}(e.route,t,r,i)),od(()=>a++),Rc(1),Ve(t=>a===n.length?yc(e):Cc))}))}),od({next:()=>n=!0,complete:()=>{if(!n){const n=new pd(e.id,this.serializeUrl(e.extractedUrl),"At least one route resolver didn't emit any value.");t.next(n),e.resolve(!1)}}}));var r,i}),od(e=>{const t=new xd(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}))}),pf(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:a,replaceUrl:o}}=e;return this.hooks.afterPreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!a,replaceUrl:!!o})}),De(e=>{const t=function(e,t,n){const r=function e(t,n,r){if(r&&t.shouldReuseRoute(n.value,r.value.snapshot)){const i=r.value;i._futureSnapshot=n.value;const a=function(t,n,r){return n.children.map(n=>{for(const i of r.children)if(t.shouldReuseRoute(i.value.snapshot,n.value))return e(t,n,i);return e(t,n)})}(t,n,r);return new uh(i,a)}{const r=t.retrieve(n.value);if(r){const e=r.route;return function e(t,n){if(t.value.routeConfig!==n.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(t.children.length!==n.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");n.value._futureSnapshot=t.value;for(let r=0;r<t.children.length;++r)e(t.children[r],n.children[r])}(n,e),e}{const r=new fh(new bc((i=n.value).url),new bc(i.params),new bc(i.queryParams),new bc(i.fragment),new bc(i.data),i.outlet,i.component,i),a=n.children.map(n=>e(t,n));return new uh(r,a)}}var i}(e,t._root,n?n._root:void 0);return new dh(r,t)}(this.routeReuseStrategy,e.targetSnapshot,e.currentRouterState);return Object.assign(Object.assign({},e),{targetRouterState:t})}),od(e=>{this.currentUrlTree=e.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl),this.routerState=e.targetRouterState,"deferred"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,!!e.extras.replaceUrl,e.id,e.extras.state),this.browserUrlTree=e.urlAfterRedirects)}),(a=this.rootContexts,o=this.routeReuseStrategy,s=e=>this.triggerEvent(e),De(e=>(new Mh(o,e.targetRouterState,e.currentRouterState,s).activate(a),e))),od({next(){n=!0},complete(){n=!0}}),(i=()=>{if(!n&&!r){this.resetUrlToCurrentUrlTree();const n=new pd(e.id,this.serializeUrl(e.extractedUrl),`Navigation ID ${e.id} is not equal to the current navigation id ${this.navigationId}`);t.next(n),e.resolve(!1)}this.currentNavigation=null},e=>e.lift(new ud(i))),ed(n=>{if(r=!0,(i=n)&&i.ngNavigationCancelingError){const r=Ph(n.url);r||(this.navigated=!0,this.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl));const i=new pd(e.id,this.serializeUrl(e.extractedUrl),n.message);t.next(i),r?setTimeout(()=>{const t=this.urlHandlingStrategy.merge(n.url,this.rawUrlTree);return this.scheduleNavigation(t,"imperative",null,{skipLocationChange:e.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy},{resolve:e.resolve,reject:e.reject,promise:e.promise})},0):e.resolve(!1)}else{this.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl);const r=new md(e.id,this.serializeUrl(e.extractedUrl),n);t.next(r);try{e.resolve(this.errorHandler(n))}catch(a){e.reject(a)}}var i;return Cc}));var i,a,o,s}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}getTransition(){const e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const t=this.extractLocationChangeInfoFromEvent(e);this.shouldScheduleNavigation(this.lastLocationChangeInfo,t)&&setTimeout(()=>{const{source:e,state:n,urlTree:r}=t,i={replaceUrl:!0};if(n){const e=Object.assign({},n);delete e.navigationId,0!==Object.keys(e).length&&(i.state=e)}this.scheduleNavigation(r,e,n,i)},0),this.lastLocationChangeInfo=t}))}extractLocationChangeInfoFromEvent(e){var t;return{source:"popstate"===e.type?"popstate":"hashchange",urlTree:this.parseUrl(e.url),state:(null===(t=e.state)||void 0===t?void 0:t.navigationId)?e.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(e,t){if(!e)return!0;const n=t.urlTree.toString()===e.urlTree.toString();return!(t.transitionId===e.transitionId&&n&&("hashchange"===t.source&&"popstate"===e.source||"popstate"===t.source&&"hashchange"===e.source))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){vf(e),this.config=e.map(xf),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0)}createUrlTree(e,t={}){const{relativeTo:n,queryParams:r,fragment:i,preserveQueryParams:a,queryParamsHandling:o,preserveFragment:s}=t;mi()&&a&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead.");const l=n||this.routerState.root,u=s?this.currentUrlTree.fragment:i;let c=null;if(o)switch(o){case"merge":c=Object.assign(Object.assign({},this.currentUrlTree.queryParams),r);break;case"preserve":c=this.currentUrlTree.queryParams;break;default:c=r||null}else c=a?this.currentUrlTree.queryParams:r||null;return null!==c&&(c=this.removeEmptyProps(c)),function(e,t,n,r,i){if(0===n.length)return _h(t.root,t.root,t,r,i);const a=function(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new Sh(!0,0,e);let t=0,n=!1;const r=e.reduce((e,r,i)=>{if("object"==typeof r&&null!=r){if(r.outlets){const t={};return Fd(r.outlets,(e,n)=>{t[n]="string"==typeof e?e.split("/"):e}),[...e,{outlets:t}]}if(r.segmentPath)return[...e,r.segmentPath]}return"string"!=typeof r?[...e,r]:0===i?(r.split("/").forEach((r,i)=>{0==i&&"."===r||(0==i&&""===r?n=!0:".."===r?t++:""!=r&&e.push(r))}),e):[...e,r]},[]);return new Sh(n,t,r)}(n);if(a.toRoot())return _h(t.root,new zd([],{}),t,r,i);const o=function(e,t,n){if(e.isAbsolute)return new Eh(t.root,!0,0);if(-1===n.snapshot._lastPathIndex){const e=n.snapshot._urlSegment;return new Eh(e,e===t.root,0)}const r=wh(e.commands[0])?0:1;return function(e,t,n){let r=e,i=t,a=n;for(;a>i;){if(a-=i,r=r.parent,!r)throw new Error("Invalid number of '../'");i=r.segments.length}return new Eh(r,!1,i-a)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+r,e.numberOfDoubleDots)}(a,t,e),s=o.processChildren?Ch(o.segmentGroup,o.index,a.commands):kh(o.segmentGroup,o.index,a.commands);return _h(o.segmentGroup,s,t,r,i)}(l,this.currentUrlTree,e,c,u)}navigateByUrl(e,t={skipLocationChange:!1}){mi()&&this.isNgZoneEnabled&&!Nl.isInAngularZone()&&this.console.warn("Navigation triggered outside Angular zone, did you forget to call 'ngZone.run()'?");const n=Ph(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,t)}navigate(e,t={skipLocationChange:!1}){return function(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${t}`)}}(e),this.navigateByUrl(this.createUrlTree(e,t),t)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let t;try{t=this.urlSerializer.parse(e)}catch(n){t=this.malformedUriErrorHandler(n,this.urlSerializer,e)}return t}isActive(e,t){if(Ph(e))return $d(this.currentUrlTree,e,t);const n=this.parseUrl(e);return $d(this.currentUrlTree,n,t)}removeEmptyProps(e){return Object.keys(e).reduce((t,n)=>{const r=e[n];return null!=r&&(t[n]=r),t},{})}processNavigations(){this.navigations.subscribe(e=>{this.navigated=!0,this.lastSuccessfulId=e.id,this.events.next(new fd(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.currentNavigation=null,e.resolve(!0)},e=>{this.console.warn("Unhandled Navigation Error: ")})}scheduleNavigation(e,t,n,r,i){const a=this.getTransition(),o="imperative"!==t&&"imperative"===(null==a?void 0:a.source),s=(this.lastSuccessfulId===a.id||this.currentNavigation?a.rawUrl:a.urlAfterRedirects).toString()===e.toString();if(o&&s)return Promise.resolve(!0);let l,u,c;i?(l=i.resolve,u=i.reject,c=i.promise):c=new Promise((e,t)=>{l=e,u=t});const d=++this.navigationId;return this.setTransition({id:d,source:t,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:r,resolve:l,reject:u,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(e=>Promise.reject(e))}setBrowserUrl(e,t,n,r){const i=this.urlSerializer.serialize(e);r=r||{},this.location.isCurrentPathEqualTo(i)||t?this.location.replaceState(i,"",Object.assign(Object.assign({},r),{navigationId:n})):this.location.go(i,"",Object.assign(Object.assign({},r),{navigationId:n}))}resetStateAndUrl(e,t,n){this.routerState=e,this.currentUrlTree=t,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n),this.resetUrlToCurrentUrlTree()}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",{navigationId:this.lastSuccessfulId})}}return e.\u0275fac=function(t){return new(t||e)(Kt(Ja),Kt(Vd),Kt(Ef),Kt(Tu),Kt(fo),Kt(eu),Kt(Al),Kt(void 0))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})(),Af=(()=>{class e{constructor(e,t,n,r,i){this.parentContexts=e,this.location=t,this.resolver=n,this.changeDetector=i,this.activated=null,this._activatedRoute=null,this.activateEvents=new Zs,this.deactivateEvents=new Zs,this.name=r||Id,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,e}attach(e,t){this.activated=e,this._activatedRoute=t,this.location.insert(e.hostView)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,t){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;const n=(t=t||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,i=new Df(e,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,i),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(t){return new(t||e)(Co(Ef),Co(Is),Co(ts),("name",function(e,t){const n=e.attrs;if(n){const e=n.length;let r=0;for(;r<e;){const i=n[r];if(Pr(i))break;if(0===i)r+=2;else if("number"==typeof i)for(r++;r<e&&"string"==typeof n[r];)r++;else{if(i===t)return n[r+1];r+=2}}}return null}(ir(),"name")),Co(Ka))},e.\u0275dir=xn({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),e})();class Df{constructor(e,t,n){this.route=e,this.childContexts=t,this.parent=n}get(e,t){return e===fh?this.route:e===Ef?this.childContexts:this.parent.get(e,t)}}class Mf{}class Nf{preload(e,t){return yc(null)}}let jf=(()=>{class e{constructor(e,t,n,r,i){this.router=e,this.injector=r,this.preloadingStrategy=i,this.loader=new _f(t,n,t=>e.triggerEvent(new wd(t)),t=>e.triggerEvent(new _d(t)))}setUpPreloading(){this.subscription=this.router.events.pipe(Dc(e=>e instanceof fd),rd(()=>this.preload())).subscribe(()=>{})}preload(){const e=this.injector.get(en);return this.processRoutes(e,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,t){const n=[];for(const r of t)if(r.loadChildren&&!r.canLoad&&r._loadedConfig){const e=r._loadedConfig;n.push(this.processRoutes(e.module,e.routes))}else r.loadChildren&&!r.canLoad?n.push(this.preloadConfig(e,r)):r.children&&n.push(this.processRoutes(e,r.children));return ze(n).pipe(Ye(),De(e=>{}))}preloadConfig(e,t){return this.preloadingStrategy.preload(t,()=>this.loader.load(e.injector,t).pipe(Ve(e=>(t._loadedConfig=e,this.processRoutes(e.module,e.routes)))))}}return e.\u0275fac=function(t){return new(t||e)(Kt(Of),Kt(eu),Kt(Al),Kt(fo),Kt(Mf))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})(),Rf=(()=>{class e{constructor(e,t,n={}){this.router=e,this.viewportScroller=t,this.options=n,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},n.scrollPositionRestoration=n.scrollPositionRestoration||"disabled",n.anchorScrolling=n.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof hd?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof fd&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof Cd&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,t){this.router.triggerEvent(new Cd(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,t))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(Kt(Of),Kt(zu),Kt(void 0))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();const Pf=new $t("ROUTER_CONFIGURATION"),Ff=new $t("ROUTER_FORROOT_GUARD"),Lf=[Tu,{provide:Vd,useClass:qd},{provide:Of,useFactory:function(e,t,n,r,i,a,o,s={},l,u){const c=new Of(null,e,t,n,r,i,a,Rd(o));if(l&&(c.urlHandlingStrategy=l),u&&(c.routeReuseStrategy=u),s.errorHandler&&(c.errorHandler=s.errorHandler),s.malformedUriErrorHandler&&(c.malformedUriErrorHandler=s.malformedUriErrorHandler),s.enableTracing){const e=uu();c.events.subscribe(t=>{e.logGroup("Router Event: "+t.constructor.name),e.log(t.toString()),e.log(t),e.logGroupEnd()})}return s.onSameUrlNavigation&&(c.onSameUrlNavigation=s.onSameUrlNavigation),s.paramsInheritanceStrategy&&(c.paramsInheritanceStrategy=s.paramsInheritanceStrategy),s.urlUpdateStrategy&&(c.urlUpdateStrategy=s.urlUpdateStrategy),s.relativeLinkResolution&&(c.relativeLinkResolution=s.relativeLinkResolution),c},deps:[Vd,Ef,Tu,fo,eu,Al,wf,Pf,[class{},new st],[class{},new st]]},Ef,{provide:fh,useFactory:function(e){return e.routerState.root},deps:[Of]},{provide:eu,useClass:ru},jf,Nf,class{preload(e,t){return t().pipe(ed(()=>yc(null)))}},{provide:Pf,useValue:{enableTracing:!1}}];function $f(){return new Gl("Router",Of)}let Bf=(()=>{class e{constructor(e,t){}static forRoot(t,n){return{ngModule:e,providers:[Lf,Wf(t),{provide:Ff,useFactory:Hf,deps:[[Of,new st,new ut]]},{provide:Pf,useValue:n||{}},{provide:xu,useFactory:Uf,deps:[du,[new ot(_u),new st],Pf]},{provide:Rf,useFactory:zf,deps:[Of,zu,Pf]},{provide:Mf,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:Nf},{provide:Gl,multi:!0,useFactory:$f},[Vf,{provide:hl,multi:!0,useFactory:qf,deps:[Vf]},{provide:Yf,useFactory:Gf,deps:[Vf]},{provide:bl,multi:!0,useExisting:Yf}]]}}static forChild(t){return{ngModule:e,providers:[Wf(t)]}}}return e.\u0275mod=yn({type:e}),e.\u0275inj=ft({factory:function(t){return new(t||e)(Kt(Ff,8),Kt(Of,8))}}),e})();function zf(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new Rf(e,t,n)}function Uf(e,t,n={}){return n.useHash?new Eu(e,t):new Su(e,t)}function Hf(e){if(e)throw new Error("RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function Wf(e){return[{provide:po,multi:!0,useValue:e},{provide:wf,multi:!0,useValue:e}]}let Vf=(()=>{class e{constructor(e){this.injector=e,this.initNavigation=!1,this.resultOfPreactivationDone=new Ie}appInitializer(){return this.injector.get(fu,Promise.resolve(null)).then(()=>{let e=null;const t=new Promise(t=>e=t),n=this.injector.get(Of),r=this.injector.get(Pf);if(this.isLegacyDisabled(r)||this.isLegacyEnabled(r))e(!0);else if("disabled"===r.initialNavigation)n.setUpLocationChangeListener(),e(!0);else{if("enabled"!==r.initialNavigation)throw new Error(`Invalid initialNavigation options: '${r.initialNavigation}'`);n.hooks.afterPreactivation=()=>this.initNavigation?yc(null):(this.initNavigation=!0,e(!0),this.resultOfPreactivationDone),n.initialNavigation()}return t})}bootstrapListener(e){const t=this.injector.get(Pf),n=this.injector.get(jf),r=this.injector.get(Rf),i=this.injector.get(Of),a=this.injector.get(Jl);e===a.components[0]&&(this.isLegacyEnabled(t)?i.initialNavigation():this.isLegacyDisabled(t)&&i.setUpLocationChangeListener(),n.setUpPreloading(),r.init(),i.resetRootComponentType(a.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}isLegacyEnabled(e){return"legacy_enabled"===e.initialNavigation||!0===e.initialNavigation||void 0===e.initialNavigation}isLegacyDisabled(e){return"legacy_disabled"===e.initialNavigation||!1===e.initialNavigation}}return e.\u0275fac=function(t){return new(t||e)(Kt(fo))},e.\u0275prov=ht({token:e,factory:e.\u0275fac}),e})();function qf(e){return e.appInitializer.bind(e)}function Gf(e){return e.bootstrapListener.bind(e)}const Yf=new $t("Router Initializer"),Xf=[];let Kf=(()=>{class e{}return e.\u0275mod=yn({type:e}),e.\u0275inj=ft({factory:function(t){return new(t||e)},imports:[[Bf.forRoot(Xf)],Bf]}),e})();function Zf(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(t){a(t)}}function s(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((r=r.apply(e,t||[])).next())}))}class Jf{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class Qf{time(e){return ep("time")}read(e){return ep("read")}readSync(e){return ep("readSync")}numDataIds(){return ep("numDataIds")}disposeData(e){return ep("disposeData")}write(e,t,n){return ep("write")}move(e,t,n,r){return ep("move")}memory(){return ep("memory")}floatPrecision(){return ep("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}batchMatMul(e,t,n,r){return ep("batchMatMul")}fusedBatchMatMul({}){return ep("fusedBatchMatMul")}slice(e,t,n){return ep("slice")}stridedSlice(e,t,n,r){return ep("stridedSlice")}unstack(e,t){return ep("unstack")}reverse(e,t){return ep("reverse")}concat(e,t){return ep("concat")}neg(e){return ep("neg")}add(e,t){return ep("add")}addN(e){return ep("addN")}subtract(e,t){return ep("subtract")}multiply(e,t){return ep("multiply")}realDivide(e,t){return ep("realDivide")}floorDiv(e,t){return ep("floorDiv")}sum(e,t){return ep("sum")}prod(e,t){return ep("prod")}unsortedSegmentSum(e,t,n){return ep("unsortedSegmentSum")}argMin(e,t){return ep("argMin")}argMax(e,t){return ep("argMax")}equal(e,t){return ep("equal")}notEqual(e,t){return ep("notEqual")}less(e,t){return ep("less")}lessEqual(e,t){return ep("lessEqual")}greater(e,t){return ep("greater")}greaterEqual(e,t){return ep("greaterEqual")}logicalNot(e){return ep("logicalNot")}logicalAnd(e,t){return ep("logicalAnd")}logicalOr(e,t){return ep("logicalOr")}where(e){return ep("where")}select(e,t,n){return ep("select")}topk(e,t,n){return ep("topk")}min(e,t){return ep("min")}minimum(e,t){return ep("minimum")}mod(e,t){return ep("mod")}max(e,t){return ep("max")}maximum(e,t){return ep("maximum")}all(e,t){return ep("all")}any(e,t){return ep("any")}squaredDifference(e,t){return ep("squaredDifference")}ceil(e){return ep("ceil")}floor(e){return ep("floor")}round(e){return ep("round")}sign(e){return ep("sign")}isNaN(e){return ep("isNaN")}isInf(e){return ep("isInf")}isFinite(e){return ep("isFinite")}pow(e,t){return ep("pow")}exp(e){return ep("exp")}expm1(e){return ep("expm1")}softmax(e,t){return ep("softmax")}log(e){return ep("log")}log1p(e){return ep("log1p")}sqrt(e){return ep("sqrt")}rsqrt(e){return ep("rsqrt")}square(e){return ep("square")}reciprocal(e){return ep("reciprocal")}relu(e){return ep("relu")}relu6(e){return ep("relu6")}prelu(e,t){return ep("prelu")}elu(e){return ep("elu")}eluDer(e,t){return ep("eluDer")}selu(e){return ep("selu")}int(e){return ep("int")}clip(e,t,n){return ep("clip")}abs(e){return ep("abs")}complexAbs(e){return ep("complexAbs")}sigmoid(e){return ep("sigmoid")}softplus(e){return ep("softplus")}sin(e){return ep("sin")}cos(e){return ep("cos")}tan(e){return ep("tan")}asin(e){return ep("asin")}acos(e){return ep("acos")}atan(e){return ep("atan")}atan2(e,t){return ep("atan2")}sinh(e){return ep("sinh")}cosh(e){return ep("cosh")}tanh(e){return ep("tanh")}asinh(e){return ep("asinh")}acosh(e){return ep("acosh")}atanh(e){return ep("atanh")}erf(e){return ep("erf")}step(e,t){return ep("step")}fusedConv2d({}){return ep("fusedConv2d")}conv2d(e,t,n){return ep("conv2d")}conv2dDerInput(e,t,n){return ep("conv2dDerInput")}conv2dDerFilter(e,t,n){return ep("conv2dDerFilter")}fusedDepthwiseConv2D({}){return ep("fusedDepthwiseConv2D")}depthwiseConv2D(e,t,n){return ep("depthwiseConv2D")}depthwiseConv2DDerInput(e,t,n){return ep("depthwiseConv2DDerInput")}depthwiseConv2DDerFilter(e,t,n){return ep("depthwiseConv2DDerFilter")}conv3d(e,t,n){return ep("conv3d")}conv3dDerInput(e,t,n){return ep("conv3dDerInput")}conv3dDerFilter(e,t,n){return ep("conv3dDerFilter")}maxPool(e,t){return ep("maxPool")}maxPoolBackprop(e,t,n,r){return ep("maxPoolBackprop")}avgPool(e,t){return ep("avgPool")}avgPoolBackprop(e,t,n){return ep("avgPoolBackprop")}avgPool3d(e,t){return ep("avgPool3d")}avgPool3dBackprop(e,t,n){return ep("avgPool3dBackprop")}maxPool3d(e,t){return ep("maxPool3d")}maxPool3dBackprop(e,t,n,r){return ep("maxPool3dBackprop")}reshape(e,t){return ep("reshape")}cast(e,t){return ep("cast")}tile(e,t){return ep("tile")}pad(e,t,n){return ep("pad")}transpose(e,t){return ep("transpose")}gather(e,t,n){return ep("gather")}gatherND(e,t){return ep("gatherND")}scatterND(e,t,n){return ep("scatterND")}batchToSpaceND(e,t,n){return ep("batchToSpaceND")}spaceToBatchND(e,t,n){return ep("spaceToBatchND")}resizeBilinear(e,t,n,r){return ep("resizeBilinear")}resizeBilinearBackprop(e,t,n){return ep("resizeBilinearBackprop")}resizeNearestNeighbor(e,t,n,r){return ep("resizeNearestNeighbor")}resizeNearestNeighborBackprop(e,t,n){return ep("resizeNearestNeighborBackprop")}batchNorm(e,t,n,r,i,a){return ep("batchNorm")}localResponseNormalization4D(e,t,n,r,i){return ep("localResponseNormalization4D")}LRNGrad(e,t,n,r,i,a,o){return ep("LRNGrad")}multinomial(e,t,n,r){return ep("multinomial")}oneHot(e,t,n,r){return ep("oneHot")}cumsum(e,t,n,r){return ep("cumsum")}nonMaxSuppression(e,t,n,r,i){return ep("nonMaxSuppression")}fft(e){return ep("fft")}ifft(e){return ep("ifft")}complex(e,t){return ep("complex")}real(e){return ep("real")}imag(e){return ep("imag")}cropAndResize(e,t,n,r,i,a){return ep("cropAndResize")}depthToSpace(e,t,n){return ep("depthToSpace")}split(e,t,n){return ep("split")}sparseToDense(e,t,n,r){return ep("sparseToDense")}diag(e){return ep("diag")}fill(e,t,n){return ep("fill")}onesLike(e){return ep("onesLike")}zerosLike(e){return ep("zerosLike")}linspace(e,t,n){return ep("linspace")}dispose(){return ep("dispose")}}function ep(e){throw new Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function tp(e){let t=e.length,n=0,r=0;for(;t>0;)r=Math.random()*t|0,t--,n=e[t],e[t]=e[r],e[r]=n}function np(e,t,n){return Math.max(e,Math.min(t,n))}function rp(e){return e%2==0?e:e+1}function ip(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}function ap(e,t){const n=Math.random();return t*n+(1-n)*e}function op(e,t){let n=0;for(let r=0;r<e.length;r++){const i=Number(e[r])-Number(t[r]);n+=i*i}return n}function sp(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function lp(e,t,n=""){sp(fp(e,t),()=>n+` Shapes ${e} and ${t} must match`)}function up(e){sp(null!=e,()=>"The input to the tensor constructor must be a non-null value.")}function cp(e,t=[],n=!1){if(null==t&&(t=[]),Array.isArray(e)||Ip(e)&&!n)for(let r=0;r<e.length;++r)cp(e[r],t,n);else t.push(e);return t}function dp(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function hp(e){return 0===e.length}function fp(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function pp(e){return e%1==0}function mp(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;{const t=Math.exp(2*e);return(t-1)/(t+1)}}function gp(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function vp(e){const t=new Uint32Array(e);for(let n=0;n<e;++n)t[n]=n;return tp(t),t}function yp(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function bp(e,t=(e=>0),n){return new Promise((r,i)=>{let a=0;const o=()=>{if(e())return void r();a++;const s=t(a);null!=n&&a>=n?i():setTimeout(o,s)};o()})}function xp(e,t){let n=1,r=-1;for(let a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${a}`);r=a}else if(e[a]<0)throw Error(`Shapes can not be < 0. Found ${e[a]} at dim ${a}`);if(-1===r){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(0===n)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);const i=e.slice();return i[r]=t/n,i}function wp(e,t){const n=t.length;return sp((e=null==e?t.map((e,t)=>t):[].concat(e)).every(e=>e>=-n&&e<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis `+e),sp(e.every(e=>pp(e)),()=>"All values in axis param must be integers but got axis "+e),e.map(e=>e<0?n+e:e)}function _p(e,t){const n=[],r=[],i=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||i?null:wp(t,e).sort();let o=0;for(let s=0;s<e.length;++s){if(null!=a){if(a[o]===s&&1!==e[s])throw new Error(`Can't squeeze axis ${s} since its dim '${e[s]}' is not 1`);(null==a[o]||a[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),a[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Sp(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function Ep(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function Tp(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}function kp(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function Cp(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function Ip(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function Op(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function Ap(e){if(null==e)return 0;let t=0;return e.forEach(e=>t+=e.length),t}function Dp(e){return"string"==typeof e||e instanceof String}function Mp(e){return"boolean"==typeof e}function Np(e){return"number"==typeof e}function jp(e){return Array.isArray(e)?jp(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":Np(e)?"float32":Dp(e)?"string":Mp(e)?"bool":"float32"}function Rp(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Pp(e,t){for(let n=t;n<e;++n)if(e%n==0)return n;return e}function Fp(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Lp(e,t){if(0===e.length)return t[0];const n=e.reduce((e,t)=>e*t);if(0===n)return[];if(n!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}.`);return function e(t,n,r){const i=new Array;if(1===n.length){const e=n[0];for(let n=0;n<e;n++)i[n]=r[t+n]}else{const a=n[0],o=n.slice(1),s=o.reduce((e,t)=>e*t);for(let n=0;n<a;n++)i[n]=e(t+n*s,o,r)}return i}(0,e,t)}function $p(e,t){const n=Bp(e,t);for(let r=0;r<n.length;r++)n[r]=1;return n}function Bp(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function zp(e,t){const n=e.reduce((e,t)=>e*t,1);if(null==t||"float32"===t)return Lp(e,new Float32Array(n));if("int32"===t)return Lp(e,new Int32Array(n));if("bool"===t)return Lp(e,new Uint8Array(n));throw new Error("Unknown data type "+t)}function Up(e){e.forEach(t=>{sp(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`)})}function Hp(e,t,n){if(0===t)return 0;if(1===t)return e[0];let r=e[e.length-1];for(let i=0;i<e.length-1;++i)r+=n[i]*e[i];return r}function Wp(e,t,n){if(0===t)return[];if(1===t)return[e];const r=new Array(t);for(let i=0;i<r.length-1;++i)r[i]=Math.floor(e/n[i]),e-=r[i]*n[i];return r[r.length-1]=e,r}function Vp(e){return e&&e.then&&"function"==typeof e.then}class qp{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}setPlatform(e,t){null!=this.platform&&console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){const t=this.urlFlags[e];console.warn(`Setting feature override from URL ${e}: ${t}.`),this.set(e,t)}}async getAsync(e){return e in this.flags||(this.flags[e]=await this.evaluateFlag(e)),this.flags[e]}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(Vp(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(null==this.flagRegistry[e])throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const e=function(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...n)=>(function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,n[0],n[1]),n.join("="))),t}(this.global.location.search);"tfjsflags"in e&&e.tfjsflags.split(",").forEach(e=>{const[t,n]=e.split(":");this.urlFlags[t]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error(`Could not parse value flag value ${t} for flag ${e}.`)}(t,n)})}}function Gp(){return Xp}let Yp,Xp=null;function Kp(){if(null==Yp){let e;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof global)e=global;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Yp=e}return Yp}function Zp(e,t){const n=function(){const e=Kp();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);{const r=t();return n.set(e,r),n.get(e)}}const Jp="Abs",Qp="Acos",em="Acosh",tm="Add",nm="AddN",rm="All",im="Any",am="ArgMax",om="ArgMin",sm="Asin",lm="Asinh",um="Atan",cm="Atanh",dm="Atan2",hm="AvgPool",fm="AvgPoolBackprop",pm="AvgPool3D",mm="AvgPool3DBackprop",gm="BatchMatMul",vm="BatchToSpaceND",ym="BroadcastTo",bm="Cast",xm="Ceil",wm="ClipByValue",_m="Complex",Sm="Concat",Em="Conv2D",Tm="Conv2DBackpropFilter",km="Conv2DBackpropInput",Cm="Conv3D",Im="Conv3DBackpropFilterV2",Om="Conv3DBackpropInputV2",Am="Cos",Dm="Cosh",Mm="Cumsum",Nm="CropAndResize",jm="DepthToSpace",Rm="DepthwiseConv2dNative",Pm="DepthwiseConv2dNativeBackpropFilter",Fm="DepthwiseConv2dNativeBackpropInput",Lm="Diag",$m="Dilation2D",Bm="Dilation2DBackpropInput",zm="Dilation2DBackpropFilter",Um="Div",Hm="Elu",Wm="EluGrad",Vm="Erf",qm="Equal",Gm="Exp",Ym="Expm1",Xm="FFT",Km="Fill",Zm="FlipLeftRight",Jm="Floor",Qm="FloorDiv",eg="FusedBatchNorm",tg="GatherV2",ng="GatherNd",rg="Greater",ig="GreaterEqual",ag="Identity",og="IFFT",sg="Imag",lg="IsFinite",ug="IsInf",cg="IsNan",dg="Less",hg="LessEqual",fg="LinSpace",pg="Log",mg="Log1p",gg="LogicalAnd",vg="LogicalNot",yg="LogicalOr",bg="LogSoftmax",xg="LRN",wg="LRNBackprop",_g="Max",Sg="Maximum",Eg="MaxPool",Tg="MaxPoolBackprop",kg="MaxPool3D",Cg="MaxPool3DBackprop",Ig="MaxPoolWithArgmax",Og="Mean",Ag="Min",Dg="Minimum",Mg="MirrorPad",Ng="Mod",jg="Multiply",Rg="Negate",Pg="NotEqual",Fg="NonMaxSuppressionV3",Lg="NonMaxSuppressionV4",$g="NonMaxSuppressionV5",Bg="OnesLike",zg="OneHot",Ug="PadV2",Hg="Pool",Wg="Pow",Vg="Prelu",qg="Prod",Gg="Range",Yg="Real",Xg="Reciprocal",Kg="Relu",Zg="Reshape",Jg="ResizeNearestNeighbor",Qg="ResizeNearestNeighborGrad",ev="ResizeBilinear",tv="ResizeBilinearGrad",nv="Relu6",rv="Reverse",iv="Round",av="Rsqrt",ov="ScatterNd",sv="SelectV2",lv="Selu",uv="Slice",cv="Sin",dv="Sinh",hv="Sign",fv="Sigmoid",pv="Softplus",mv="Sqrt",gv="Sum",vv="SpaceToBatchND",yv="SplitV",bv="Softmax",xv="SquaredDifference",wv="Square",_v="Sub",Sv="SparseToDense",Ev="StridedSlice",Tv="Tan",kv="Tanh",Cv="Tile",Iv="TopK",Ov="Transpose",Av="Unique",Dv="Unpack",Mv="UnsortedSegmentSum",Nv="ZerosLike",jv="Step",Rv="FromPixels",Pv="RotateWithOffset",Fv="_FusedMatMul",Lv="FusedConv2D",$v="FusedDepthwiseConv2D",Bv=Zp("kernelRegistry",()=>new Map),zv=Zp("gradRegistry",()=>new Map);function Uv(e,t){const n=Kv(e,t);return Bv.get(n)}function Hv(e){return zv.get(e)}function Wv(e){const t=Bv.entries(),n=[];for(;;){const{done:r,value:i}=t.next();if(r)break;const[a,o]=i,[s]=a.split("_");s===e&&n.push(o)}return n}function Vv(e){const{kernelName:t,backendName:n}=e,r=Kv(t,n);Bv.has(r)&&console.warn(`The kernel '${t}' for backend '${n}' is already registered`),Bv.set(r,e)}function qv(e){const{kernelName:t}=e;zv.has(t)&&Gp().getBool("DEBUG")&&console.warn(`Overriding the gradient for '${t}'`),zv.set(t,e)}function Gv(e,t){const n=Kv(e,t);if(!Bv.has(n))throw new Error(`The kernel '${e}' for backend '${t}' is not registered`);Bv.delete(n)}function Yv(e){if(!zv.has(e))throw new Error(`The gradient '${e}' for backend is not registered`);zv.delete(e)}function Xv(e,t){Wv(e).forEach(e=>{Vv(Object.assign({},e,{backendName:t}))})}function Kv(e,t){return`${t}_${e}`}class Zv{constructor(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new Qv)}profileKernel(e,t,n){let r;const i=this.backendTimer.time(()=>{r=n()});for(let a=0;a<r.length;a++){const t=r[a];t.data().then(n=>{Jv(n,t.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:i.then(e=>e.kernelMs),extraInfo:i.then(e=>null!=e.getExtraProfileInfo?e.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:n,timeMs:r,inputs:i,extraInfo:a}=e;n.forEach(e=>{Promise.all([e.data(),r,a]).then(n=>{this.logger.logKernelProfile(t,e,n[0],n[1],i,n[2])})})}}function Jv(e,t,n){if("float32"!==t)return!1;for(let r=0;r<e.length;r++){const t=e[r];if(isNaN(t)||!isFinite(t))return console.warn(`Found ${t} in the result of '${n}'`),!0}return!1}class Qv{logKernelProfile(e,t,n,r,i,a){const o="number"==typeof r?yp(r+"ms",9):r.error,s=yp(e,25),l=t.rank,u=t.size,c=yp(t.shape.toString(),14);let d="";for(const h in i){const e=i[h];if(null!=e){const n=e.shape||t.shape,r=n.length;d+=`${h}: ${r}D ${r>0?n:""} `}}console.log(`%c${s}\t%c${o}\t%c${l}D ${c}\t%c${u}\t%c${d}\t%c${a}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}function ey(e,t,n){let r;return r=Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":Dp(e)?`'${e}'`:"bool"===n?ty(e):parseFloat(e.toFixed(7)).toString(),yp(r,t)}function ty(e){return 0===e?"false":"true"}function ny(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}function ry(e,t){return"string"===t?sy(e):iy([e],t)}function iy(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=cp(e)),Gp().getBool("DEBUG")&&Tp(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){const t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)0!==Math.round(e[n])&&(t[n]=1);return t}throw new Error("Unknown data type "+t)}function ay(){return Gp().platform.now()}function oy(e,t){return Gp().platform.fetch(e,t)}function sy(e,t="utf-8"){return t=t||"utf-8",Gp().platform.encode(e,t)}function ly(e,t="utf-8"){return t=t||"utf-8",Gp().platform.decode(e,t)}class uy{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=dp(e),null!=n){const e=n.length;sp(e===this.size,()=>`Length of values '${e}' does not match the size inferred by the shape '${this.size}'.`)}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Ep(t,this.size),this.strides=Fp(e)}set(e,...t){0===t.length&&(t=[0]),sp(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const n=this.locToIndex(t);this.values[n]=e}get(...e){0===e.length&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t])throw new Error(`Requested out of range element at ${e}.   Buffer shape=`+this.shape);t++}let n=e[e.length-1];for(let r=0;r<e.length-1;++r)n+=this.strides[r]*e[r];return this.values[n]}locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];const t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return cy().makeTensor(this.values,this.shape,this.dtype)}}let cy=null,dy=null,hy=null;class fy{constructor(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=dp(e),this.strides=Fp(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return dy.buffer(this.shape,this.dtype,e)}bufferSync(){return dy.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Lp(this.shape,e)}arraySync(){return Lp(this.shape,this.dataSync())}async data(){this.throwIfDisposed();const e=cy().read(this.dataId);if("string"===this.dtype){const n=await e;try{return n.map(e=>ly(e))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataSync(){this.throwIfDisposed();const e=cy().readSync(this.dataId);if("string"===this.dtype)try{return e.map(e=>ly(e))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await cy().read(this.dataId);return"string"===this.dtype?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(cy().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return dy.print(this,e)}clone(){return this.throwIfDisposed(),dy.clone(this)}toString(e=!1){return function(e,t,n,r){const i=Fp(t),a=function(e,t,n,r){const i=dp(t),a=r[r.length-1],o=new Array(a).fill(0),s=t.length,l="complex64"===n?ny(e):e;if(s>1)for(let u=0;u<i/a;u++){const e=u*a;for(let t=0;t<a;t++)o[t]=Math.max(o[t],ey(l[e+t],0,n).length)}return o}(e,t,n,i),o=t.length,s=function e(t,n,r,i,a,o=!0){const s="complex64"===r?2:1,l=n[0],u=n.length;if(0===u)return"complex64"===r?[ey(ny(t)[0],0,r)]:"bool"===r?[ty(t[0])]:[t[0].toString()];if(1===u){if(l>20){let e=Array.from(t.slice(0,3*s)),n=Array.from(t.slice((l-3)*s,l*s));return"complex64"===r&&(e=ny(e),n=ny(n)),["["+e.map((e,t)=>ey(e,a[t],r)).join(", ")+", ..., "+n.map((e,t)=>ey(e,a[l-3+t],r)).join(", ")+"]"]}return["["+("complex64"===r?ny(t):Array.from(t)).map((e,t)=>ey(e,a[t],r)).join(", ")+"]"]}const c=n.slice(1),d=i.slice(1),h=i[0]*s,f=[];if(l>20){for(let n=0;n<3;n++){const i=n*h;f.push(...e(t.slice(i,i+h),c,r,d,a,!1))}f.push("...");for(let n=l-3;n<l;n++){const i=n*h;f.push(...e(t.slice(i,i+h),c,r,d,a,n===l-1))}}else for(let g=0;g<l;g++){const n=g*h;f.push(...e(t.slice(n,n+h),c,r,d,a,g===l-1))}const p=2===u?",":"";f[0]="["+f[0]+p;for(let g=1;g<f.length-1;g++)f[g]=" "+f[g]+p;let m=",\n";for(let g=2;g<u;g++)m+="\n";return f[f.length-1]=" "+f[f.length-1]+"]"+(o?"":m),f}(e,t,n,i,a),l=["Tensor"];return r&&(l.push("  dtype: "+n),l.push("  rank: "+o),l.push(`  shape: [${t}]`),l.push("  values:")),l.push(s.map(e=>"    "+e).join("\n")),l.join("\n")}(this.dataSync(),this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),dy.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),cy().makeVariable(this,e,t,n)}}Object.defineProperty(fy,Symbol.hasInstance,{value:e=>!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed});class py extends fy{constructor(e,t,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!fp(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);cy().disposeTensor(this),this.dataId=e.dataId,cy().incRef(this,null)}dispose(){cy().disposeVariable(this),this.isDisposedInternal=!0}}var my,gy,vy,yy,by;Object.defineProperty(py,Symbol.hasInstance,{value:e=>e instanceof fy&&null!=e.assign&&e.assign instanceof Function}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(my||(my={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(gy||(gy={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(vy||(vy={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(yy||(yy={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(by||(by={}));const xy={float32:yy,int32:gy,bool:vy,complex64:by};function wy(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error(`Can not upcast ${e} with ${t}`)}return xy[e][t]}function _y(e){return wy(e,"int32")}function Sy(e,t){if(e.dtype===t.dtype)return[e,t];const n=wy(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Ey(e,t){sp(e.dtype===t.dtype,()=>`The dtypes of the first(${e.dtype}) and second(${t.dtype}) input must match`)}function Ty(e,t){return t.some(t=>t.id===e.id)}function ky(e){const t=[];return function e(t,n,r){if(null==t)return;if(t instanceof fy)return void n.push(t);if(i=t,!Array.isArray(i)&&"object"!=typeof i)return;var i;const a=t;for(const o in a){const t=a[o];r.has(t)||(r.add(t),e(t,n,r))}}(e,t,new Set),t}class Cy{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Iy{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Cy}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then(()=>{});if(null!=this.backendInstance)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t];if(await this.initializeBackend(n).success)return void(await this.setBackend(n))}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;{const{asyncInit:t}=this.initializeBackend(e);if(t)return null}}return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,n=1){return e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(null==this.registryFactory[e])throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,null==this.registry[e]){this.backendInstance=null;const{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Zv(this.backendInstance),!0}setupRegisteredKernels(){Wv(this.backendName).forEach(e=>{null!=e.setupFunc&&e.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){Wv(e).forEach(t=>{null!=t.disposeFunc&&t.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(null==t)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const n=t.factory();if(!n||n instanceof Qf||"function"!=typeof n.then)return this.registry[e]=n,{success:!0,asyncInit:!1};{const t=++this.pendingBackendInitId,r=n.then(n=>!(t<this.pendingBackendInitId||(this.registry[e]=n,this.pendingBackendInit=null,0))).catch(n=>(t<this.pendingBackendInitId||(this.pendingBackendInit=null,console.warn(`Initialization of backend ${e} failed`),console.warn(n.stack||n.message)),!1));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(n){return console.warn(`Initialization of backend ${e} failed`),console.warn(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t],{success:r,asyncInit:i}=this.initializeBackend(n);if(i||r)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const n=this.state.tensorInfo.get(t),r=n.backend,i=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n,r=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}return this.scopedRun(()=>this.startScope(r),()=>this.endScope(n),()=>(n=t(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n))}scopedRun(e,t,n){e();try{const e=n();return t(),e}catch(r){throw t(),r}}nextTensorId(){return Iy.nextTensorId++}nextVariableId(){return Iy.nextVariableId++}clone(e){const t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype);return this.addTapeNode(this.state.activeScope.name,{x:e},[t],e=>({x:()=>{const t="float32";return Ay.runKernelFunc(n=>n.cast(e,t),{x:e},null,bm,{dtype:t})}}),[],{}),t}runKernel(e,t,n,r,i){return this.runKernelFunc(null,t,null,e,n,r,i)}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){const r=this.backend.numDataIds();let i=0;n.forEach(e=>{i+="complex64"===e.dtype?3:1});const a=r-t-i-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e,t,n,r,i,a,o){let s,l=[];const u=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");const c=this.state.numBytes,d=this.state.numTensors;let h;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);const f=Uv(r,this.backendName);let p,m;if(null!=f)h=()=>{const e=this.backend.numDataIds();p=f.kernelFunc({inputs:t,attrs:i,backend:this.backend});const n=Array.isArray(p)?p:[p];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(r,e,n);const s=n.map(({dataId:e,shape:t,dtype:n})=>this.makeTensorFromDataId(e,t,n));if(u){let e=this.getTensorsForGradient(r,t,s);if(null==e){null==o&&(o=[]);const t=s.filter((e,t)=>o[t]);e=(a||[]).slice().concat(t)}l=this.saveTensorsForBackwardMode(e)}return s};else{const t=e=>{u&&(l=e.map(e=>this.keep(this.clone(e))))};h=()=>{const n=this.backend.numDataIds();p=this.tidy(()=>e(this.backend,t));const i=Array.isArray(p)?p:[p];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(r,n,i),i}}return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(m=this.profiler.profileKernel(r,t,()=>h()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),s=m.outputs):s=h()}),u&&this.addTapeNode(r,t,s,n,l,i),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-c,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-d,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(e=>null!=t[e]?t[e].shape:null),outputShapes:s.map(e=>e.shape),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(p)?s:s[0]}saveTensorsForBackwardMode(e){return e.map(e=>this.keep(this.clone(e)))}getTensorsForGradient(e,t,n){const r=Hv(e);if(null!=r){const e=r.inputsToSave||[],i=r.outputsToSave||[];let a;r.saveAllInputs?(sp(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(e=>t[e])):a=e.map(e=>t[e]);const o=n.filter((e,t)=>i[t]);return a.concat(o)}return null}makeTensor(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");r=r||this.backend;let i=e;"string"===(n=n||"float32")&&Dp(e[0])&&(i=e.map(e=>sy(e)));const a=r.write(i,t,n),o=new fy(t,n,a,this.nextTensorId());if(this.incRef(o,r),"string"===n){const e=this.state.tensorInfo.get(a),t=Ap(i);this.state.numBytes+=t-e.bytes,e.bytes=t}return o}makeTensorFromDataId(e,t,n,r){const i=new fy(t,n=n||"float32",e,this.nextTensorId());return this.incRef(i,r),i}makeVariable(e,t=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));const i=new py(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}incRef(e,t){const n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;let n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*Op(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n,refCount:0}),this.state.numBytes+=n}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof py||this.track(e)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;const t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}disposeVariables(){for(const e in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[e])}disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(e=>e.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(e,t,n,r,i,a){const o={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},s=Hv(e);null!=s&&(r=s.gradFunc),null!=r&&(o.gradient=e=>(e=e.map((e,t)=>{if(null==e){const e=n[t],r=Bp(e.size,e.dtype);return this.makeTensor(r,e.shape,e.dtype)}return e}),r(e.length>1?e:e[0],i,a))),this.state.activeTape.push(o)}keep(e){return e.kept=!0,e}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=ky(e),n=new Set(t.map(e=>e.id));for(let i=0;i<this.state.activeScope.track.length;i++){const e=this.state.activeScope.track[i];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(e=>{e.kept||e.scopeId!==r.id||this.track(e)})}gradients(e,t,n,r=!1){if(sp(t.length>0,()=>"gradients() received an empty list of xs."),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));sp(i instanceof fy,()=>"The result y returned by f() must be a tensor.");const a=function(e,t,n){const r={},i={};for(let l=0;l<t.length;l++)r[t[l].id]=!0;for(let l=0;l<e.length;l++){const n=e[l],a=n.inputs;for(const e in a){const o=a[e];let s=!1;for(let e=0;e<t.length;e++)if(r[o.id]){n.outputs.forEach(e=>r[e.id]=!0),s=!0,i[n.id]=!0;break}if(s)break}}const a={};a[n.id]=!0;const o={};for(let l=e.length-1;l>=0;l--){const t=e[l],n=t.inputs;for(let e=0;e<t.outputs.length;e++)if(a[t.outputs[e].id]){for(const e in n)a[n[e].id]=!0,o[t.id]=!0;break}}const s=[];for(let l=0;l<e.length;l++){const t=e[l];if(i[t.id]&&o[t.id]){const e={};for(const i in t.inputs){const n=t.inputs[i];r[n.id]&&(e[i]=n)}const n=Object.assign({},t);n.inputs=e,n.outputs=t.outputs,s.push(n)}}return s}(this.state.activeTape,t,i);if(!r&&0===a.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const e={};e[i.id]=null==n?function(e){const t=$p(dp(e),"float32");return Ay.makeTensor(t,e,"float32")}(i.shape):n,function(e,t,n,r){for(let i=t.length-1;i>=0;i--){const a=t[i],o=[];if(a.outputs.forEach(t=>{const n=e[t.id];o.push(null!=n?n:null)}),null==a.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${a.kernelName}.`);const s=a.gradient(o);for(const t in a.inputs){if(!(t in s))throw new Error(`Cannot backprop through input ${t}. Available gradients found: ${Object.keys(s)}.`);const i=n(()=>s[t]());if("float32"!==i.dtype)throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input ${t} must have 'float32' dtype, but has '${i.dtype}'`);const o=a.inputs[t];if(!fp(i.shape,o.shape))throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input '${t}' has shape '${i.shape}', which does not match the shape of the input '${o.shape}'`);if(null==e[o.id])e[o.id]=i;else{const t=e[o.id];e[o.id]=r(t,i),t.dispose()}}}}(e,a,e=>this.tidy(e),Dy);const r=t.map(t=>e[t.id]);return 0===this.state.gradientDepth&&(this.state.activeTape.forEach(e=>{for(const t of e.saved)t.dispose()}),this.state.activeTape=null),{value:i,grads:r}})}customGrad(e){return sp(Rp(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{let n;sp(t.every(e=>e instanceof fy),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");const r={};return t.forEach((e,t)=>{r[t]=e}),this.runKernelFunc((r,i)=>(n=e(...t,i),sp(n.value instanceof fy,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),sp(Rp(n.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n.value),r,(e,r)=>{const i=n.gradFunc(e,r),a=Array.isArray(i)?i:[i];sp(a.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),sp(a.every(e=>e instanceof fy),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const o={};return a.forEach((e,t)=>{o[t]=()=>e}),o})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}async time(e){const t=ay(),n=await this.backend.time(e);return n.wallMs=ay()-t,n}track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Cy;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function Oy(){const e=Kp();if(null==e._tfengine){const t=new qp(e);e._tfengine=new Iy(t)}return Xp=e._tfengine.ENV,cy=()=>e._tfengine,e._tfengine}Iy.nextTensorId=0,Iy.nextVariableId=0;const Ay=Oy();function Dy(e,t){return Ay.runKernelFunc((n,r)=>{const i=n.add(e,t);return r([e,t]),i},{a:e,b:t},null,tm)}function My(){if("undefined"!=typeof navigator&&null!=navigator){const e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function Ny(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}const jy=Gp();function Ry(e,t){let n=e;if(Ip(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];const r=[];for(;Array.isArray(n)||Ip(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&Gp().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],!Array.isArray(t)&&!Ip(t))return void sp(0===n.length,()=>`Element arr[${r.join("][")}] is a primitive, but should be an array/TypedArray of ${n[0]} elements`);sp(n.length>0,()=>`Element arr[${r.join("][")}] should be a primitive, but is an array of ${t.length} elements`),sp(t.length===n[0],()=>`Element arr[${r.join("][")}] should have ${n[0]} elements, but has ${t.length} elements`);const i=n.slice(1);for(let a=0;a<t.length;++a)e(t[a],i,r.concat(a))}(e,r,[]),r}function Py(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error(`Argument '${n}' passed to '${r}' must be ${e} tensor, but got ${t} tensor`)}function Fy(e,t,n,r="numeric"){if(e instanceof fy)return Py(r,e.dtype,t,n),e;let i=jp(e);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),Py(r,i,t,n),null==e||!Ip(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${null==e?"null":e.constructor.name}'`);const a=Ry(e,i);Ip(e)||Array.isArray(e)||(e=[e]);const o="string"!==i?iy(e,i):cp(e,[],!0);return Ay.makeTensor(o,a,i)}function Ly(e,t,n,r="numeric"){if(!Array.isArray(e))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map((e,r)=>Fy(e,`${t}[${r}]`,n),r)}jy.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),jy.registerFlag("IS_BROWSER",()=>Ny()),jy.registerFlag("IS_NODE",()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node),jy.registerFlag("IS_CHROME",()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),jy.registerFlag("PROD",()=>!1),jy.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>jy.getBool("DEBUG")),jy.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),jy.registerFlag("IS_TEST",()=>!1);const $y="__op";function By(e){const t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");let n=t[0];const r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=$y;const i=(...e)=>{Ay.startScope(n);try{const t=r(...e);return Vp(t)&&console.error("Cannot return a Promise inside of tidy."),Ay.endScope(t),t}catch(t){throw Ay.endScope(null),t}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}const zy=By({complex_:function(e,t){const n=Fy(e,"real","complex"),r=Fy(t,"imag","complex");return lp(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`),Ay.runKernelFunc(e=>e.complex(n,r),{real:n,imag:r},null,_m)}});function Uy(e,t,n,r){if(null==r&&(r=jp(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Ip(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Up(t);const e=dp(t),r=dp(n);sp(e===r,()=>`Based on the provided shape, [${t}], the tensor should have ${e} values but has ${r}`);for(let i=0;i<n.length;++i){const e=n[i],r=i!==n.length-1||e!==dp(t.slice(i));sp(n[i]===t[i]||!r,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `)}}return Ip(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?iy(e,r):cp(e,[],!0),Ay.makeTensor(e,t,r)}function Hy(e,t,n){return Uy(e,t,Ry(e,n),n)}const Wy={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};async function Vy(e,t){const n=[],r=[],i=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);for(let a=0;a<i.length;++a){const o=i[a],s=Array.isArray(e)?e[a].tensor:e[o];if("float32"!==s.dtype&&"int32"!==s.dtype&&"bool"!==s.dtype&&"string"!==s.dtype&&"complex64"!==s.dtype)throw new Error(`Unsupported dtype in weight '${o}': ${s.dtype}`);const l={name:o,shape:s.shape,dtype:s.dtype};if("string"===s.dtype){const e=new Promise(async e=>{const t=await s.bytes(),n=t.reduce((e,t)=>e+t.length,0)+4*t.length,r=new Uint8Array(n);let i=0;for(let a=0;a<t.length;a++){const e=t[a],n=new Uint8Array(new Uint32Array([e.length]).buffer);r.set(n,i),i+=4,r.set(e,i),i+=e.length}e(r)});r.push(e)}else r.push(s.data());null!=t&&(l.group=t),n.push(l)}return{data:Gy(await Promise.all(r)),specs:n}}function qy(e,t){const n={};let r,i=0;for(const a of t){const t=a.name,o=a.dtype,s=a.shape,l=dp(s);let u;if("quantization"in a){const n=a.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${a.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${a.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==o)throw new Error(`Weight ${a.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${o}.`)}const s=Wy[n.dtype],c=e.slice(i,i+l*s),d="uint8"===n.dtype?new Uint8Array(c):new Uint16Array(c);if("float32"===o)if("uint8"===n.dtype||"uint16"===n.dtype){u=new Float32Array(d.length);for(let e=0;e<d.length;e++)u[e]=d[e]*n.scale+n.min}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=Qy()),u=r(d)}else{if("int32"!==o)throw new Error(`Unsupported dtype in weight '${t}': ${o}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);u=new Int32Array(d.length);for(let e=0;e<d.length;e++)u[e]=Math.round(d[e]*n.scale+n.min)}i+=l*s}else if("string"===o){const t=dp(a.shape);u=[];for(let n=0;n<t;n++){const t=new Uint32Array(e.slice(i,i+4))[0];i+=4;const n=new Uint8Array(e.slice(i,i+t));u.push(n),i+=t}}else{const r=Wy[o],a=e.slice(i,i+l*r);if("float32"===o)u=new Float32Array(a);else if("int32"===o)u=new Int32Array(a);else if("bool"===o)u=new Uint8Array(a);else{if("complex64"!==o)throw new Error(`Unsupported dtype in weight '${t}': ${o}`);{u=new Float32Array(a);const e=new Float32Array(u.length/2),r=new Float32Array(u.length/2);for(let t=0;t<e.length;t++)e[t]=u[2*t],r[t]=u[2*t+1];const i=Hy(e,s,"float32"),o=Hy(r,s,"float32");n[t]=zy(i,o),i.dispose(),o.dispose()}}i+=l*r}"complex64"!==o&&(n[t]=Hy(u,s,o))}return n}function Gy(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));let t=0;const n=[];e.forEach(e=>{if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)});const r=new Uint8Array(t);let i=0;return n.forEach(e=>{r.set(new Uint8Array(e.buffer),i),i+=e.byteLength}),r.buffer}const Yy="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function Xy(e){return Yy?Buffer.byteLength(e):new Blob([e]).size}function Ky(e){if(1===e.length)return e[0];let t=0;e.forEach(e=>{t+=e.byteLength});const n=new Uint8Array(t);let r=0;return e.forEach(e=>{n.set(new Uint8Array(e),r),r+=e.byteLength}),n.buffer}function Zy(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);const t=e.split("/");return t[t.length-1]}function Jy(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:Xy(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:Xy(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function Qy(){const e=function(){const e=e=>{let t=e<<13,n=0;for(;0==(8388608&t);)n-=8388608,t<<=1;return t&=-8388609,n+=947912704,t|n},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let n=1024;n<2048;n++)t[n]=939524096+(n-1024<<13);return t}(),t=function(){const e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}(),n=function(){const e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return r=>{const i=new ArrayBuffer(4*r.length),a=new Uint32Array(i);for(let o=0;o<r.length;o++){const i=r[o];a[o]=e[n[i>>10]+(1023&i)]+t[i>>10]}return new Float32Array(i)}}class eb{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==eb.instance&&(eb.instance=new eb),eb.instance}static registerSaveRouter(e){eb.getInstance().saveRouters.push(e)}static registerLoadRouter(e){eb.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return eb.getHandlers(e,"save")}static getLoadHandlers(e,t){return eb.getHandlers(e,"load",t)}static getHandlers(e,t,n){const r=[];return("load"===t?eb.getInstance().loadRouters:eb.getInstance().saveRouters).forEach(t=>{const i=t(e,n);null!==i&&r.push(i)}),r}}const tb=e=>eb.registerSaveRouter(e),nb=e=>eb.registerLoadRouter(e),rb=e=>eb.getSaveHandlers(e),ib=(e,t)=>eb.getLoadHandlers(e,t),ab="tensorflowjs",ob="models_store",sb="model_info_store";function lb(){if(!Gp().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function ub(e){const t=e.result;t.createObjectStore(ob,{keyPath:"modelPath"}),t.createObjectStore(sb,{keyPath:"modelPath"})}class cb{constructor(e){if(this.indexedDB=lb(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((e,n)=>{const r=this.indexedDB.open(ab,1);r.onupgradeneeded=()=>ub(r),r.onsuccess=()=>{const i=r.result;if(null==t){const t=i.transaction(ob,"readonly"),r=t.objectStore(ob).get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return i.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));e(r.result.modelArtifacts)},r.onerror=e=>(i.close(),n(r.error)),t.oncomplete=()=>i.close()}else{const r=Jy(t),a=i.transaction(sb,"readwrite");let o=a.objectStore(sb);const s=o.put({modelPath:this.modelPath,modelArtifactsInfo:r});let l;s.onsuccess=()=>{l=i.transaction(ob,"readwrite");const s=l.objectStore(ob).put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:r});s.onsuccess=()=>e({modelArtifactsInfo:r}),s.onerror=e=>{o=a.objectStore(sb);const t=o.delete(this.modelPath);t.onsuccess=()=>(i.close(),n(s.error)),t.onerror=e=>(i.close(),n(s.error))}},s.onerror=e=>(i.close(),n(s.error)),a.oncomplete=()=>{null==l?i.close():l.oncomplete=()=>i.close()}}},r.onerror=e=>n(r.error)})}}cb.URL_SCHEME="indexeddb://";const db=e=>{return Gp().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(cb.URL_SCHEME)?(t=e.slice(cb.URL_SCHEME.length),new cb(t)):null;var t};eb.registerSaveRouter(db),eb.registerLoadRouter(db);class hb{constructor(){this.indexedDB=lb()}async listModels(){return new Promise((e,t)=>{const n=this.indexedDB.open(ab,1);n.onupgradeneeded=()=>ub(n),n.onsuccess=()=>{const r=n.result,i=r.transaction(sb,"readonly"),a=i.objectStore(sb).getAll();a.onsuccess=()=>{const t={};for(const e of a.result)t[e.modelPath]=e.modelArtifactsInfo;e(t)},a.onerror=e=>(r.close(),t(a.error)),i.oncomplete=()=>r.close()},n.onerror=e=>t(n.error)})}async removeModel(e){var t;return e=(t=e).startsWith(cb.URL_SCHEME)?t.slice(cb.URL_SCHEME.length):t,new Promise((t,n)=>{const r=this.indexedDB.open(ab,1);r.onupgradeneeded=()=>ub(r),r.onsuccess=()=>{const i=r.result,a=i.transaction(sb,"readwrite"),o=a.objectStore(sb),s=o.get(e);let l;s.onsuccess=()=>{if(null==s.result)return i.close(),n(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const r=o.delete(e),a=()=>{l=i.transaction(ob,"readwrite");const r=l.objectStore(ob).delete(e);r.onsuccess=()=>t(s.result.modelArtifactsInfo),r.onerror=e=>n(s.error)};r.onsuccess=a,r.onerror=e=>(a(),i.close(),n(s.error))}},s.onerror=e=>(i.close(),n(s.error)),a.oncomplete=()=>{null==l?i.close():l.oncomplete=()=>i.close()}},r.onerror=e=>n(r.error)})}}const fb="/",pb="tensorflowjs_models",mb="info",gb="model_topology",vb="weight_specs",yb="weight_data",bb="model_metadata";function xb(e){return{info:[pb,e,mb].join(fb),topology:[pb,e,gb].join(fb),weightSpecs:[pb,e,vb].join(fb),weightData:[pb,e,yb].join(fb),modelMetadata:[pb,e,bb].join(fb)}}function wb(e){const t=e.split(fb);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(fb)}class _b{constructor(e){if(!Gp().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=xb(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=Jy(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(e){if(Yy)return Buffer.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let r=0,i=t.length;r<i;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),{modelArtifactsInfo:i}}catch(t){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(null==e)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(null!=i){const e=JSON.parse(i);t.format=e.format,t.generatedBy=e.generatedBy,t.convertedBy=e.convertedBy,t.userDefinedMetadata=e.userDefinedMetadata}const a=this.LS.getItem(this.keys.weightData);if(null==a)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=function(e){if(Yy){const t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;++r)n.set([t.charCodeAt(r)],r);return n.buffer}(a),t}}_b.URL_SCHEME="localstorage://";const Sb=e=>{return Gp().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(_b.URL_SCHEME)?(t=e.slice(_b.URL_SCHEME.length),new _b(t)):null;var t};eb.registerSaveRouter(Sb),eb.registerLoadRouter(Sb);class Eb{constructor(){sp(Gp().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),sp("undefined"==typeof window||void 0!==window.localStorage,()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=pb+fb,n=fb+mb;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);i.startsWith(t)&&i.endsWith(n)&&(e[wb(i)]=JSON.parse(this.LS.getItem(i)))}return e}async removeModel(e){var t;const n=xb(e=(t=e).startsWith(_b.URL_SCHEME)?t.slice(_b.URL_SCHEME.length):t);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${e}'`);const r=JSON.parse(this.LS.getItem(n.info));return this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),r}}const Tb="://";class kb{constructor(){this.managers={}}static getInstance(){return null==kb.instance&&(kb.instance=new kb),kb.instance}static registerManager(e,t){sp(null!=e,()=>"scheme must not be undefined or null."),e.endsWith(Tb)&&(e=e.slice(0,e.indexOf(Tb))),sp(e.length>0,()=>"scheme must not be an empty string.");const n=kb.getInstance();sp(null==n.managers[e],()=>`A model store manager is already registered for scheme '${e}'.`),n.managers[e]=t}static getManager(e){const t=this.getInstance().managers[e];if(null==t)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(this.getInstance().managers)}}function Cb(e){if(-1===e.indexOf(Tb))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+kb.getSchemes().join(","));return{scheme:e.split(Tb)[0],path:e.split(Tb)[1]}}async function Ib(e,t,n=!1){sp(e!==t,()=>`Old path and new path are the same: '${e}'`);const r=eb.getLoadHandlers(e);sp(r.length>0,()=>`Copying failed because no load handler is found for source URL ${e}.`),sp(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${e}.`);const i=r[0],a=eb.getSaveHandlers(t);sp(a.length>0,()=>`Copying failed because no save handler is found for destination URL ${t}.`),sp(a.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${t}.`);const o=a[0],s=Cb(e).scheme,l=Cb(e).path,u=s===Cb(e).scheme,c=await i.load();n&&u&&await kb.getManager(s).removeModel(l);const d=await o.save(c);return n&&!u&&await kb.getManager(s).removeModel(l),d.modelArtifactsInfo}async function Ob(){const e=kb.getSchemes(),t={};for(const n of e){const e=await kb.getManager(n).listModels();for(const r in e)t[n+Tb+r]=e[r]}return t}async function Ab(e){const t=Cb(e);return kb.getManager(t.scheme).removeModel(t.path)}async function Db(e,t){return Ib(e,t,!1)}async function Mb(e,t){return Ib(e,t,!0)}class Nb{fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}}if(Gp().get("IS_BROWSER")){Gp().setPlatform("browser",new Nb);try{kb.registerManager(_b.URL_SCHEME,new Eb)}catch(rBe){}try{kb.registerManager(cb.URL_SCHEME,new hb)}catch(rBe){}}let jb;function Rb(e,t="float32",n){return t=t||"float32",Up(e),new uy(e,t,n)}Gp().get("IS_NODE")&&Gp().setPlatform("node",new class{constructor(){this.util=n(2),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return null!=Gp().global.fetch?Gp().global.fetch(e,t):(null==jb&&(jb=n(1)),jb(e,t))}now(){const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)}decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}});const Pb=By({cast_:function(e,t){const n=Fy(e,"x","cast");if(!kp(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");return Ay.runKernelFunc(e=>e.cast(n,t),{x:n},null,bm,{dtype:t})}}),Fb=By({clone_:function(e){const t=Fy(e,"x","clone",null);return Ay.runKernelFunc(()=>Ay.makeTensorFromDataId(t.dataId,t.shape,t.dtype),{x:t},null,ag)}});function Lb(e,t=!1){console.log(e.toString(t))}function $b(e){return new Promise(e=>setTimeout(e)).then(e)}Oy(),dy={buffer:Rb,cast:Pb,clone:Fb,print:Lb};class Bb{constructor(e){if(!Gp().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(Bb.URL_SCHEME)&&(e=e.slice(Bb.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelTopologyFileName=e+".json",this.weightDataFileName=e+".weights.bin"}async save(e){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]})],{type:"application/json"})),r=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor;if(r.download=this.modelTopologyFileName,r.href=n,await $b(()=>r.dispatchEvent(new MouseEvent("click"))),null!=e.weightData){const e=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;e.download=this.weightDataFileName,e.href=t,await $b(()=>e.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Jy(e)}}}}Bb.URL_SCHEME="downloads://";class zb{constructor(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}async load(){const e=this.files[0],t=this.files.slice(1);return new Promise((n,r)=>{const i=new FileReader;i.onload=i=>{const a=JSON.parse(i.target.result),o=a.modelTopology;if(null==o)return void r(new Error("modelTopology field is missing from file "+e.name));0===t.length&&n({modelTopology:o});const s=a.weightsManifest;if(null==s)return void r(new Error("weightManifest field is missing from file "+e.name));let l;try{l=this.checkManifestAndWeightFiles(s,t)}catch(rBe){return void r(rBe)}const u=[],c=[],d=[];s.forEach(e=>{e.paths.forEach(e=>{c.push(e),d.push(null)}),u.push(...e.weights)}),s.forEach(e=>{e.paths.forEach(e=>{const t=new FileReader;t.onload=t=>{const r=t.target.result,i=c.indexOf(e);d[i]=r,-1===d.indexOf(null)&&n({modelTopology:o,weightSpecs:u,weightData:Ky(d),format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy,userDefinedMetadata:a.userDefinedMetadata})},t.onerror=t=>r(`Failed to weights data from file of path '${e}'.`),t.readAsArrayBuffer(l[e])})})},i.onerror=t=>r(`Failed to read model topology and weights manifest JSON from file '${e.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),i.readAsText(e)})}checkManifestAndWeightFiles(e,t){const n=[],r=t.map(e=>Zy(e.name)),i={};for(const a of e)a.paths.forEach(e=>{const a=Zy(e);if(-1!==n.indexOf(a))throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(n.push(a),-1===r.indexOf(a))throw new Error(`Weight file with basename '${a}' is not provided.`);i[e]=t[r.indexOf(a)]});if(n.length!==t.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${t.length}).`);return i}}function Ub(e){return new zb(e)}function Hb(e,t,n,r){!function(e){sp(null!=e&&Array.isArray(e)&&e.length>0,()=>"promises must be a none empty array")}(e),function(e,t){sp(e>=0&&e<=1,()=>"Progress fraction must be in range [0, 1], but got startFraction "+e),sp(t>=0&&t<=1,()=>"Progress fraction must be in range [0, 1], but got endFraction "+t),sp(t>=e,()=>`startFraction must be no more than endFraction, but got startFraction ${e} and endFraction `+t)}(n=null==n?0:n,r=null==r?1:r);let i=0;return Promise.all(e.map(a=>(a.then(a=>{const o=n+ ++i/e.length*(r-n);return t(o),a}),a)))}async function Wb(e,t){null==t&&(t={});const n=null==t.fetchFunc?Gp().platform.fetch:t.fetchFunc,r=e.map(e=>n(e,t.requestInit,{isBinary:!0})),i=(null==t.onProgress?await Promise.all(r):await Hb(r,t.onProgress,0,.5)).map(e=>e.arrayBuffer());return null==t.onProgress?await Promise.all(i):await Hb(i,t.onProgress,.5,1)}async function Vb(e,t="",n,r){return qb(e=>Wb(e,{requestInit:r}))(e,t,n)}function qb(e){return async(t,n="",r)=>{const i=t.map(()=>!1),a={},o=null!=r?r.map(()=>!1):[],s=[];if(t.forEach((e,t)=>{let n=0;e.weights.forEach(e=>{const l=Wy["quantization"in e?e.quantization.dtype:e.dtype]*dp(e.shape),u=()=>{i[t]=!0,null==a[t]&&(a[t]=[]),a[t].push({manifestEntry:e,groupOffset:n,sizeBytes:l})};null!=r?r.forEach((t,n)=>{t===e.name&&(u(),o[n]=!0)}):u(),s.push(e.name),n+=l})}),!o.every(e=>e)){const e=r.filter((e,t)=>!o[t]);throw new Error("Could not find weights in manifest with names: "+e.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".")}const l=i.reduce((e,t,n)=>(t&&e.push(n),e),[]),u=[];l.forEach(e=>{t[e].paths.forEach(e=>{const t=n+(n.endsWith("/")?"":"/")+e;u.push(t)})});const c=await e(u),d={};let h=0;return l.forEach(e=>{const n=t[e].paths.length;let r=0;for(let t=0;t<n;t++)r+=c[h+t].byteLength;const i=new ArrayBuffer(r),o=new Uint8Array(i);let s=0;for(let t=0;t<n;t++){const e=new Uint8Array(c[h+t]);o.set(e,s),s+=e.byteLength}a[e].forEach(e=>{const t=qy(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(const n in t)d[n]=t[n]}),h+=n}),d}}eb.registerSaveRouter(e=>Gp().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Bb.URL_SCHEME)?function(e="model"){return new Bb(e)}(e.slice(Bb.URL_SCHEME.length)):null);class Gb{constructor(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?(sp("function"==typeof t.fetchFunc,()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=Gp().platform.fetch,sp(null!=e&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&sp(2===e.length,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData,t.body.append("model.json",new Blob([JSON.stringify({modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:e.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin");const n=await this.fetch(this.path,t);if(n.ok)return{modelArtifactsInfo:Jy(e),responses:[n]};throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+n.status+".")}async load(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code `+e.status+". Please verify this URL points to the model JSON of the model to load.");let t;try{t=await e.json()}catch(h){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=t.modelTopology,r=t.weightsManifest,i=t.generatedBy,a=t.convertedBy,o=t.format,s=t.userDefinedMetadata;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);let l,u;if(null!=r){const e=await this.loadWeights(r);[l,u]=e}const c={modelTopology:n,weightSpecs:l,weightData:u,userDefinedMetadata:s,generatedBy:i,convertedBy:a,format:o},d=t.modelInitializer;return d&&(c.modelInitializer=d),c}async loadWeights(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),i=this.weightPathPrefix||n,a=[];for(const l of e)a.push(...l.weights);const o=[],s=[];for(const l of e)for(const e of l.paths)null!=this.weightUrlConverter?s.push(this.weightUrlConverter(e)):o.push(i+e+r);return this.weightUrlConverter&&o.push(...await Promise.all(s)),[a,Ky(await Wb(o,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress}))]}}function Yb(e){return null!=e.match(Gb.URL_SCHEME_REGEX)}Gb.URL_SCHEME_REGEX=/^https?:\/\//;const Xb=(e,t)=>{if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;{let n=!0;if(n=Array.isArray(e)?e.every(e=>Yb(e)):Yb(e),n)return Kb(e,t)}return null};function Kb(e,t){return new Gb(e,t)}function Zb(e,t){return Kb(e,t)}eb.registerSaveRouter(Xb),eb.registerLoadRouter(Xb);class Jb{constructor(e){this.modelArtifacts=e}async load(){return this.modelArtifacts}}class Qb{constructor(e){this.saveHandler=e}async save(e){return this.saveHandler(e)}}function ex(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new Jb(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Jb({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Jb({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function tx(e){return new Qb(e)}const nx=By({reshape_:function(e,t){const n=Fy(e,"x","reshape",null);return Ay.runKernelFunc((e,r)=>(t=xp(t,n.size),sp(n.size===dp(t),()=>"new shape and old shape must have the same number of elements."),r([n]),e.reshape(n,t)),{x:n},null,Zg,{shape:t})}}),rx=By({matMul_:function(e,t,n=!1,r=!1){let i=Fy(e,"a","matMul"),a=Fy(t,"b","matMul");return[i,a]=Sy(i,a),Ay.runKernelFunc((e,t)=>{t([i,a]);const o=n?i.shape[i.rank-2]:i.shape[i.rank-1],s=r?a.shape[a.rank-1]:a.shape[a.rank-2],l=n?i.shape[i.rank-1]:i.shape[i.rank-2],u=r?a.shape[a.rank-2]:a.shape[a.rank-1],c=i.shape.slice(0,-2),d=a.shape.slice(0,-2),h=dp(c),f=dp(d);sp(i.rank>=2&&a.rank>=2&&(h===f||1===h||1===f),()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${c}) and (${d}).`),sp(o===s,()=>`Error in matMul: inner shapes (${o}) and (${s}) of Tensors with shapes ${i.shape} and ${a.shape} and transposeA=${n} and transposeB=${r} must match.`);const p=(h>f?c:d).concat([l,u]),m=nx(i,n?[h,o,l]:[h,l,o]),g=nx(a,r?[f,u,s]:[f,s,u]),v=e.batchMatMul(m,g,n,r);return nx(v,p)},{a:i,b:a},null,gm,{transposeA:n,transposeB:r})}}),ix=By({oneHot_:function(e,t,n=1,r=0){if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);const i=Fy(e,"indices","oneHot","int32"),a=[...i.shape,t];return Ay.runKernelFunc((e,o)=>(o([i]),nx(e.oneHot(nx(i,[i.size]),t,n,r),a)),{indices:i},null,zg,{depth:t,onValue:n,offValue:r})}}),ax=By({transpose_:function(e,t){const n=Fy(e,"x","transpose");return null==t&&(t=n.shape.map((e,t)=>t).reverse()),sp(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${t}.`),t.forEach(e=>{sp(e>=0&&e<n.rank,()=>"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t)}),n.rank<=1?n.clone():Ay.runKernelFunc(e=>e.transpose(n,t),{x:n},null,Ov,{perm:t})}}),ox=By({confusionMatrix_:function(e,t,n){const r=Fy(e,"labels","confusionMatrix"),i=Fy(t,"predictions","confusionMatrix");sp(null==n||n>0&&Number.isInteger(n),()=>"If provided, numClasses must be a positive integer, but got "+n),sp(1===r.rank,()=>"Expected the rank of labels to be 1, but got "+r.rank),sp(1===i.rank,()=>"Expected the rank of predictions to be 1, but got "+i.rank),sp(r.shape[0]===i.shape[0],()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${i.shape[0]}. Labels and predictions should have the same number of elements.`),sp(n>0&&Number.isInteger(n),()=>"numClasses is required to be a positive integer, but got "+n);const a=ix(Pb(r,"int32"),n),o=ix(Pb(i,"int32"),n),s=ax(a),l=rx(s,o);return Pb(l,"int32")}});function sx(e,t,n){if(up(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");const r=Ry(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Uy(e,t,r,n)}let lx;async function ux(e,t){let n=Fy(e,"img","toPixels");if(!(e instanceof fy)){const e=n;n=Pb(e,"int32"),e.dispose()}if(2!==n.rank&&3!==n.rank)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[r,i]=n.shape.slice(0,2),a=2===n.rank?1:n.shape[2];if(a>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);if("float32"!==n.dtype&&"int32"!==n.dtype)throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);const o=await n.data(),s="float32"===n.dtype?255:1,l=new Uint8ClampedArray(i*r*4);for(let u=0;u<r*i;++u){const e=[0,0,0,255];for(let r=0;r<a;r++){const t=o[u*a+r];if("float32"===n.dtype){if(t<0||t>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${t}.`)}else if("int32"===n.dtype&&(t<0||t>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${t}.`);1===a?(e[0]=t*s,e[1]=t*s,e[2]=t*s):e[r]=t*s}const t=4*u;l[t+0]=Math.round(e[0]),l[t+1]=Math.round(e[1]),l[t+2]=Math.round(e[2]),l[t+3]=Math.round(e[3])}if(null!=t){t.width=i,t.height=r;const e=t.getContext("2d"),n=new ImageData(l,i,r);e.putImageData(n,0,0)}return n!==e&&n.dispose(),l}const cx=By({fromPixels_:function(e,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,i=!1,a=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);o=!0}if(i){const t=2;if(i&&e.readyState<t)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=Uv(Rv,Ay.backendName))return Ay.runKernel(Rv,{pixels:e},{numChannels:t});const[s,l]=i?[e.videoWidth,e.videoHeight]:[e.width,e.height];let u,c;if(o?u=e.getContext("2d").getImageData(0,0,s,l).data:r||n?u=e.data:(a||i)&&(null==lx&&(lx=document.createElement("canvas").getContext("2d")),lx.canvas.width=s,lx.canvas.height=l,lx.drawImage(e,0,0,s,l),u=lx.getImageData(0,0,s,l).data),4===t)c=new Int32Array(u);else{const e=s*l;c=new Int32Array(e*t);for(let n=0;n<e;n++)for(let e=0;e<t;++e)c[n*t+e]=u[4*n+e]}return sx(c,[l,s,t],"int32")}});function dx(e,t){if(e.rank<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==t.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[t.rank-1]>e.rank)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[t.rank-1]} vs. ${e.rank}`);if(0===e.size)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);const n=t.shape,r=n[n.length-1];let i=1;for(let u=0;u<n.length-1;++u)i*=n[u];const a=e.shape,o=n.slice();o.pop();let s=1;for(let u=r;u<e.rank;++u)s*=a[u],o.push(a[u]);const l=[...Fp(e.shape).map(e=>e/s),1].slice(0,r);return[o,i,s,l]}function hx(e,t,n){const r=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+`, indices.shape: ${t.shape}, shape: ${e}`+`, sliceDim: ${r}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(a+` update.rank < ${i}. `);if(e.length<r+(n.rank-i))throw new Error(a+" Output shape length < "+(r+(n.rank-i)));if(n.rank!==i+e.length-r)throw new Error(a+" update.rank != "+(i+e.length-r));for(let o=0;o<i;++o)if(n.shape[o]!==t.shape[o])throw new Error(a+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${t.shape[o]}).`);for(let o=0;o<n.rank-i;++o)if(n.shape[o+i]!==e[o+r])throw new Error(a+` updates.shape[${o+i}] (${n.shape[o+i]}) != shape[${o+i}] (${e[o+i]})`)}function fx(e,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}hx(n,t,e)}function px(e,t,n){const r=t.shape.length,i=r>1?t.shape[r-1]:1,a=n.length;let o=1;for(let l=i;l<a;++l)o*=n[l];const s=i<1?1:i;return{sliceRank:i,numUpdates:dp(t.shape)/s,sliceSize:o,strides:[...Fp(n.slice(0,i)),1],outputSize:dp(n)}}function mx(e,t,n){const r=e.shape.length;sp(r===t.length,()=>`Error in slice${r}D: Length of begin ${t} must match the rank of the array (${r}).`),sp(r===n.length,()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`);for(let i=0;i<r;++i)sp(t[i]+n[i]<=e.shape[i],()=>`Error in slice${r}D: begin[${i}] + size[${i}] (${t[i]+n[i]}) would overflow input.shape[${i}] (${e.shape[i]})`)}function gx(e){const t=[];let n=0;for(;e>0;)1&e&&t.push(n),e/=2,n++;return t}function vx(e,t,n){const r=[];for(let i=0;i<e.length;i++)r[i]=Math.ceil((t[i]-e[i])/n[i]);return r}function yx(e,t,n,r){const i=[...e];for(let a=i.length;a<r.length;a++)i.push(1);for(let a=0;a<n;a++)0===a?i[t]=1:(i.splice(t,0,1),i.pop());return i}function bx(e,t,n){return n<=e?n:n-(t-1)}function xx(e,t){const n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function wx(e,t,n,r,i,a,o,s,l){const u=e.length;let c=new Array(u),d=new Array(u),h=new Array(u);if(t.length&&n>0){const l=t[0],u=n+1;c=_x(o,l,u,r,e),d=Sx(s,l,u,i,e),h=yx(a,l,u,e)}else for(let f=0;f<u;f++)c[f]=Tx(o,r,a,e,f,l),d[f]=kx(s,i,a,e,f,l),h[f]=Ex(a,f,l);return{begin:c,end:d,strides:h}}function _x(e,t,n,r,i){const a=[...i],o=xx(n,t);for(let s=0;s<a.length;s++)if(o.indexOf(s)>-1)a[s]=0;else{const i=bx(t,n,s);let o=r[i];e&1<<i&&(o=0),a[s]=o}return a}function Sx(e,t,n,r,i){const a=[...i],o=xx(n,t);for(let s=0;s<a.length;s++)if(o.indexOf(s)>-1)a[s]=Number.MAX_SAFE_INTEGER;else{const i=bx(t,n,s);let o=r[i];e&1<<i&&(o=Number.MAX_SAFE_INTEGER),a[s]=o}for(let s=0;s<a.length;s++){const e=i[s];a[s]<0&&(a[s]+=e),a[s]=np(0,a[s],i[s])}return a}function Ex(e,t,n){let r=e[t];return(n&1<<t||null==r)&&(r=1),r}function Tx(e,t,n,r,i,a){let o=t[i];(e&1<<i||a&1<<i||null==o)&&(o=(n[i]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const s=r[i];return o<0&&(o+=s),o=np(0,o,s-1),o}function kx(e,t,n,r,i,a){let o=t[i];const s=n[i]||1;(e&1<<i||a&1<<i||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const l=r[i];return o<0&&(o+=l),o=s>0?np(0,o,l):np(-1,o,l-1),o}function Cx(e,t,n){let r=n.length;for(let i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(let i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function Ix(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Ox(e,t,n){let r;const i=e.shape.length;let a;return r="number"==typeof t?[t,...new Array(i-1).fill(0)]:t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice(),r.forEach(e=>{sp(-1!==e,()=>"slice() does not support negative begin indexing.")}),a=null==n?new Array(i).fill(-1):"number"==typeof n?[n,...new Array(i-1).fill(-1)]:n.length<i?n.concat(new Array(i-n.length).fill(-1)):n,a=a.map((t,n)=>t>=0?t:(sp(-1===t,()=>`Negative size values should be exactly -1 but got ${t} for the slice() size at index ${n}.`),e.shape[n]-r[n])),[r,a]}class Ax{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Dx{constructor(){this.classNameMap={}}static getMap(){return null==Dx.instance&&(Dx.instance=new Dx),Dx.instance}static register(e){Dx.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Mx(e){sp(null!=e.className,()=>"Class being registered does not have the static className property defined."),sp("string"==typeof e.className,()=>"className is required to be a string, but got type "+typeof e.className),sp(e.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),Dx.register(e)}const Nx=.1;function jx(e,t,n){return null==n&&(n=Rx()),Px(e,t,(e,t)=>Bx(e,t,n))}function Rx(){return 32===Ay.backend.floatPrecision()?.001:Nx}function Px(e,t,n){let r=!0;if((Ip(e)||Ip(t))&&(r=!1),Ip(e)&&Ip(t)&&(r=!0),r){const n=e.constructor.name,r=t.constructor.name;if(n!==r)throw new Error(`Arrays are of different type. Actual: ${n}. Expected: `+r)}if(Array.isArray(e)&&Array.isArray(t)){const n=Ry(e),r=Ry(t);if(!fp(n,r))throw new Error(`Arrays have different shapes. Actual: [${n}]. Expected: [${r}]`)}const i=Ip(e)?e:cp(e),a=Ip(t)?t:cp(t);if(i.length!==a.length)throw new Error(`Arrays have different lengths actual: ${i.length} vs expected: ${a.length}.\nActual:   ${i}.\nExpected: ${a}.`);for(let o=0;o<a.length;++o){const e=i[o],t=a[o];if(!n(e,t))throw new Error(`Arrays differ: actual[${o}] = ${e}, expected[${o}] = ${t}.\nActual:   ${i}.\nExpected: ${a}.`)}}function Fx(e,t){e().then(()=>t.fail(),()=>t())}function Lx(e,t){const n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return Dp(e)||Dp(e[0])||Dp(t)||Dp(t[0])?Px(e,n,(e,t)=>e==t):Px(e,t,(e,t)=>Bx(e,t,0))}function $x(e,t,n){if(null==n&&(n=Rx()),!Bx(e,t,n))throw new Error(`Numbers differ: actual === ${e}, expected === ${t}`)}function Bx(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function zx(e,t,n){for(let r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error(`Value out of range:${e[r]} low: ${t}, high: ${n}`)}function Ux(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}const Hx="2.7.0";function Wx(){Gp().set("PROD",!0)}function Vx(){Gp().set("DEBUG",!0)}function qx(){Gp().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Gx(e){Gp().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Yx(){Ay.disposeVariables()}function Xx(){return Ay}function Kx(){return Ay.memory()}function Zx(e){return Ay.profile(e)}function Jx(e,t){return Ay.tidy(e,t)}function Qx(e){ky(e).forEach(e=>e.dispose())}function ew(e){return Ay.keep(e)}function tw(e){return Ay.time(e)}function nw(e){return Ay.setBackend(e)}function rw(){return Ay.ready()}function iw(){return Ay.backendName}function aw(e){Ay.removeBackend(e)}function ow(e){return Ay.findBackend(e)}function sw(e){return Ay.findBackendFactory(e)}function lw(e,t,n=1){return Ay.registerBackend(e,t,n)}function uw(){return Ay.backend}function cw(e,t){Gp().setPlatform(e,t)}hy=Gx;const dw=By({add_:function(e,t){let n=Fy(e,"a","add"),r=Fy(t,"b","add");return[n,r]=Sy(n,r),Ay.runKernelFunc((e,t)=>{const i=e.add(n,r);return t([n,r]),i},{a:n,b:r},null,tm)}}),hw=By({floorDiv_:function(e,t){let n=Fy(e,"a","floorDiv"),r=Fy(t,"b","floorDiv");return[n,r]=Sy(n,r),Ay.runKernelFunc((e,t)=>{const i=e.floorDiv(n,r);return t([n,r]),i},{a:n,b:r},null,Qm)}}),fw=By({div_:function(e,t){let n=Fy(e,"a","div"),r=Fy(t,"b","div");return[n,r]=Sy(n,r),"int32"===n.dtype&&"int32"===r.dtype?hw(n,r):Ay.runKernelFunc((e,t)=>{const i=e.realDivide(n,r);return t([n,r]),i},{a:n,b:r},null,Um,{})}}),pw=By({mul_:function(e,t){let n=Fy(e,"a","mul"),r=Fy(t,"b","mul");return[n,r]=Sy(n,r),Ay.runKernelFunc((e,t)=>{const i=e.multiply(n,r);return t([n,r]),i},{a:n,b:r},null,jg)}}),mw=By({sqrt_:function(e){const t=Fy(e,"x","sqrt");return Ay.runKernelFunc((e,n)=>{const r=e.sqrt(t);return n([t]),r},{x:t},null,mv)}}),gw=By({square_:function(e){const t=Fy(e,"x","square");return Ay.runKernelFunc((e,n)=>(n([t]),e.square(t)),{x:t},null,"Square",{},[t],[])}}),vw=By({zerosLike_:function(e){const t=Fy(e,"x","zerosLike");return Ay.runKernelFunc(e=>e.zerosLike(t),{x:t},null,Nv)}});function yw(e){return sp(Rp(e),()=>"The f passed in grad(f) must be a function"),(t,n)=>{const r=Fy(t,"x","tf.grad",null),i=null!=n?Fy(n,"dy","tf.grad"):null;return Ay.tidy(()=>{const{value:t,grads:n}=Ay.gradients(()=>e(r),[r],i);return null!=i&&lp(t.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Ew(n),n[0]})}}function bw(e){return sp(Rp(e),()=>"The f passed in grads(f) must be a function"),(t,n)=>{sp(Array.isArray(t),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const r=Ly(t,"args","tf.grads",null),i=null!=n?Fy(n,"dy","tf.grads"):null;return Ay.tidy(()=>{const{value:t,grads:n}=Ay.gradients(()=>e(...r),r,i);return null!=i&&lp(t.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Ew(n),n})}}function xw(e){return sp(Rp(e),()=>"The f passed in valueAndGrad(f) must be a function"),(t,n)=>{sp(t instanceof fy,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),sp(null==n||n instanceof fy,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:r,value:i}=Ay.gradients(()=>e(t),[t],n);return Ew(r),{grad:r[0],value:i}}}function ww(e){return sp(Rp(e),()=>"The f passed in valueAndGrads(f) must be a function"),(t,n)=>{sp(Array.isArray(t)&&t.every(e=>e instanceof fy),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),sp(null==n||n instanceof fy,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const r=Ay.gradients(()=>e(...t),t,n);return null!=n&&lp(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Ew(r.grads),r}}function _w(e,t){sp(Rp(e),()=>"The f passed in variableGrads(f) must be a function"),sp(null==t||Array.isArray(t)&&t.every(e=>e instanceof py),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=null!=t;if(!n){t=[];for(const e in Ay.registeredVariables)t.push(Ay.registeredVariables[e])}const r=n?t.filter(e=>!e.trainable):null,i=t.length;sp((t=t.filter(e=>e.trainable)).length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`);const{value:a,grads:o}=Ay.gradients(e,t,null,!0);sp(o.some(e=>null!=e),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),sp(0===a.rank,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${a.rank} tensor`);const s={};return t.forEach((e,t)=>{null!=o[t]&&(s[e.name]=o[t])}),null!=r&&r.forEach(e=>s[e.name]=null),{value:a,grads:s}}function Sw(e){return Ay.customGrad(e)}function Ew(e){if(e.filter(e=>null==e).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}function Tw(e,t){if((Ip(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Ip(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Uy(e,[],[],t)}class kw extends Ax{minimize(e,t=!1,n){const{value:r,grads:i}=this.computeGradients(e,n);if(null!=n){const e=n.map(e=>({name:e.name,tensor:i[e.name]}));this.applyGradients(e)}else this.applyGradients(i);return Qx(i),t?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return _w(e,t)}dispose(){null!=this.iterations_&&Qx(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:Tw(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(kw,Symbol.hasInstance,{value:e=>null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients});class Cw extends kw{constructor(e,t,n=null){super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=Ay.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=Ay.registeredVariables[t];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:t+"/accum_grad",variable:Jx(()=>vw(r).variable(!1))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:t+"/accum_var",variable:Jx(()=>vw(r).variable(!1))});const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const a=this.accumulatedGrads[n].variable,o=this.accumulatedUpdates[n].variable;Jx(()=>{const e=dw(pw(a,this.rho),pw(gw(i),1-this.rho)),t=pw(fw(mw(dw(o,this.epsilon)),mw(dw(a,this.epsilon))),i),n=dw(pw(o,this.rho),pw(gw(t),1-this.rho));a.assign(e),o.assign(n);const s=dw(pw(t,-this.learningRate),r);r.assign(s)})}),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(Qx(this.accumulatedGrads.map(e=>e.variable)),Qx(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){const t=(e=await this.extractIterations(e)).length/2;this.accumulatedGrads=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(!1)})),this.accumulatedUpdates=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(!1)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}function Iw(e,t,n){return Ay.runKernelFunc(r=>r.fill(e,t,n),{},null,Km,{shape:e,value:t,dtype:n})}Cw.className="Adadelta",Mx(Cw);class Ow extends kw{constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=Ay.registeredVariables[t];if(null==this.accumulatedGrads[n]){const e=!1;this.accumulatedGrads[n]={originalName:t+"/accumulator",variable:Jx(()=>Iw(r.shape,this.initialAccumulatorValue).variable(e))}}const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const a=this.accumulatedGrads[n].variable;Jx(()=>{const e=dw(a,gw(i));a.assign(e);const t=dw(pw(fw(i,mw(dw(e,Ay.backend.epsilon()))),-this.learningRate),r);r.assign(t)})}),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&Qx(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e),this.accumulatedGrads=e.map(e=>({originalName:e.name,variable:e.tensor.variable(!1)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}Ow.className="Adagrad",Mx(Ow);const Aw=By({pow_:function(e,t){let n=Fy(e,"base","pow"),r=Fy(t,"exp","pow");return[n,r]=Sy(n,r),Ay.runKernelFunc((e,t)=>{const i=e.pow(n,r);return t([n,r,i]),i},{a:n,b:r},null,Wg)}}),Dw=By({sub_:function(e,t){let n=Fy(e,"a","sub"),r=Fy(t,"b","sub");return[n,r]=Sy(n,r),Ay.runKernelFunc((e,t)=>{const i=e.subtract(n,r);return t([n,r]),i},{a:n,b:r},null,_v)}});class Mw extends kw{constructor(e,t,n,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Jx(()=>{this.accBeta1=Tw(t).variable(),this.accBeta2=Tw(n).variable()}),null==r&&(this.epsilon=Ay.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);Jx(()=>{const n=Dw(1,this.accBeta1),r=Dw(1,this.accBeta2);t.forEach((t,i)=>{const a=Ay.registeredVariables[t];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:t+"/m",variable:Jx(()=>vw(a).variable(!1))}),null==this.accumulatedSecondMoment[i]&&(this.accumulatedSecondMoment[i]={originalName:t+"/v",variable:Jx(()=>vw(a).variable(!1))});const o=Array.isArray(e)?e[i].tensor:e[t];if(null==o)return;const s=this.accumulatedFirstMoment[i].variable,l=this.accumulatedSecondMoment[i].variable,u=dw(pw(s,this.beta1),pw(o,1-this.beta1)),c=dw(pw(l,this.beta2),pw(gw(o),1-this.beta2)),d=fw(u,n),h=fw(c,r);s.assign(u),l.assign(c);const f=dw(pw(fw(d,dw(mw(h),this.epsilon)),-this.learningRate),a);a.assign(f)}),this.accBeta1.assign(pw(this.accBeta1,this.beta1)),this.accBeta2.assign(pw(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Qx(this.accumulatedFirstMoment.map(e=>e.variable)),null!=this.accumulatedSecondMoment&&Qx(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e),Jx(()=>{this.accBeta1.assign(Aw(this.beta1,this.iterations_+1)),this.accBeta2.assign(Aw(this.beta2,this.iterations_+1))});const t=e.length/2;this.accumulatedFirstMoment=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(!1)})),this.accumulatedSecondMoment=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(!1)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}Mw.className="Adam",Mx(Mw);const Nw=By({abs_:function(e){const t=Fy(e,"x","abs");return Ay.runKernelFunc((e,n)=>(n([t]),"complex64"===t.dtype?e.complexAbs(t):e.abs(t)),{x:t},null,Jp)}});function jw(e,t){const n=e.length,r=[];for(let i=0;i<n;i++){const a=n-1-i,o=e[a]||1;(t[t.length-1-i]||1)>1&&1===o&&r.unshift(a)}return r}function Rw(e,t){const n=[];for(let r=0;r<t.length;r++){const i=e[e.length-r-1],a=t.length-r-1,o=t[a];(null==i||1===i&&o>1)&&n.unshift(a)}return n}function Pw(e,t){const n=[],r=Math.max(e.length,t.length);for(let i=0;i<r;i++){let r=e[e.length-i-1];null==r&&(r=1);let a=t[t.length-i-1];if(null==a&&(a=1),1===r)n.unshift(a);else if(1===a)n.unshift(r);else{if(r!==a)throw Error(`Operands could not be broadcast together with shapes ${e} and ${t}.`);n.unshift(r)}}return n}const Fw=By({maximum_:function(e,t){let n=Fy(e,"a","maximum"),r=Fy(t,"b","maximum");return[n,r]=Sy(n,r),"bool"===n.dtype&&(n=Pb(n,"int32"),r=Pb(r,"int32")),Pw(n.shape,r.shape),Ay.runKernelFunc((e,t)=>{const i=e.maximum(n,r);return t([n,r]),i},{a:n,b:r},null,Sg)}});class Lw extends kw{constructor(e,t,n,r=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Jx(()=>{this.iteration=Tw(0).variable(),this.accBeta1=Tw(t).variable()}),null==r&&(this.epsilon=Ay.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);Jx(()=>{const n=Dw(1,this.accBeta1),r=fw(-this.learningRate,dw(pw(this.iteration,this.decay),1));t.forEach((t,i)=>{const a=Ay.registeredVariables[t];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:t+"/m",variable:vw(a).variable(!1)}),null==this.accumulatedWeightedInfNorm[i]&&(this.accumulatedWeightedInfNorm[i]={originalName:t+"/v",variable:vw(a).variable(!1)});const o=Array.isArray(e)?e[i].tensor:e[t];if(null==o)return;const s=this.accumulatedFirstMoment[i].variable,l=this.accumulatedWeightedInfNorm[i].variable,u=dw(pw(s,this.beta1),pw(o,1-this.beta1)),c=pw(l,this.beta2),d=Nw(o),h=Fw(c,d);s.assign(u),l.assign(h);const f=dw(pw(fw(r,n),fw(u,dw(h,this.epsilon))),a);a.assign(f)}),this.iteration.assign(dw(this.iteration,1)),this.accBeta1.assign(pw(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Qx(this.accumulatedFirstMoment.map(e=>e.variable)),null!=this.accumulatedWeightedInfNorm&&Qx(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}Lw.className="Adamax",Mx(Lw);class $w extends kw{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=Array.isArray(e)?e[n].tensor:e[t];if(null==r)return;const i=Ay.registeredVariables[t];Jx(()=>{const e=dw(pw(this.c,r),i);i.assign(e)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=ew(Tw(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(0!==(e=await this.extractIterations(e)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}$w.className="SGD",Mx($w);class Bw extends $w{constructor(e,t,n=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=Tw(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=Ay.registeredVariables[t];if(null==this.accumulations[n]){const e=!1;this.accumulations[n]={originalName:t+"/momentum",variable:Jx(()=>vw(r).variable(e))}}const i=this.accumulations[n].variable,a=Array.isArray(e)?e[n].tensor:e[t];null!=a&&Jx(()=>{let e;const t=dw(pw(this.m,i),a);e=dw(pw(this.c,this.useNesterov?dw(a,pw(t,this.m)):t),r),i.assign(t),r.assign(e)})}),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&Qx(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e),this.accumulations=e.map(e=>({originalName:e.name,variable:e.tensor.variable(!1)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}Bw.className="Momentum",Mx(Bw);class zw extends kw{constructor(e,t=.9,n=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,null==r&&(this.epsilon=Ay.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=Ay.registeredVariables[t],i=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:t+"/rms",variable:Jx(()=>vw(r).variable(i))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:t+"/momentum",variable:Jx(()=>vw(r).variable(i))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:t+"/mg",variable:Jx(()=>vw(r).variable(i))});const a=Array.isArray(e)?e[n].tensor:e[t];if(null==a)return;const o=this.accumulatedMeanSquares[n].variable,s=this.accumulatedMoments[n].variable;Jx(()=>{const e=dw(pw(o,this.decay),pw(gw(a),1-this.decay));if(this.centered){const t=this.accumulatedMeanGrads[n].variable,i=dw(pw(t,this.decay),pw(a,1-this.decay)),l=fw(pw(a,this.learningRate),mw(Dw(e,dw(gw(i),this.epsilon)))),u=dw(pw(s,this.momentum),l);o.assign(e),t.assign(i),s.assign(u);const c=Dw(r,u);r.assign(c)}else{const e=dw(pw(o,this.decay),pw(gw(a),1-this.decay)),t=dw(pw(s,this.momentum),fw(pw(a,this.learningRate),mw(dw(e,this.epsilon))));o.assign(e),s.assign(t);const n=Dw(r,t);r.assign(n)}})}),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&Qx(this.accumulatedMeanSquares.map(e=>e.variable)),null!=this.accumulatedMeanGrads&&this.centered&&Qx(this.accumulatedMeanGrads.map(e=>e.variable)),null!=this.accumulatedMoments&&Qx(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedMoments=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}zw.className="RMSProp",Mx(zw);const Uw=By({acos_:function(e){const t=Fy(e,"x","acos");return Ay.runKernelFunc((e,n)=>{const r=e.acos(t);return n([t]),r},{x:t},null,Qp)}}),Hw=By({acosh_:function(e){const t=Fy(e,"x","acosh");return Ay.runKernelFunc((e,n)=>{const r=e.acosh(t);return n([t]),r},{x:t},null,em)}}),Ww=By({addN_:function(e){sp(Array.isArray(e),()=>"The argument passed to tf.addN() must be a list of tensors"),sp(e.length>=1,()=>"Must pass at least one tensor to tf.addN(), but got "+e.length);const t=e.map((e,t)=>Fy(e,"tensors"+t,"addN")),n=t[0];return t.forEach(e=>{if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(e=>{if(!fp(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),Ay.runKernelFunc((e,n)=>{const r=e.addN(t);return n(t),r},t,null,nm)}});function Vw(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function qw(e,t,n){const r=e.length+t.length,i=[];let a=0,o=0;for(let s=0;s<r;s++)-1===n.indexOf(s)?i.push(e[a++]):i.push(t[o++]);return i}function Gw(e,t){const n=[],r=e.length;for(let i=0;i<r;i++)-1===t.indexOf(i)&&n.push(e[i]);return[n,t.map(t=>e[t])]}function Yw(e,t){return qw(e,t.map(e=>1),t)}function Xw(e,t,n){sp(Vw(t,n),()=>e+" supports only inner-most axes for now. "+`Got axes ${t} and rank-${n} input.`)}function Kw(e,t){if(Vw(e,t))return null;const n=[];for(let r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(e=>n.push(e)),n}function Zw(e){return e.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function Jw(e,t){const n=[];for(let r=t-e;r<t;++r)n.push(r);return n}const Qw=By({all_:function(e,t=null,n=!1){let r=Fy(e,"x","all","bool");return Ay.runKernelFunc(e=>{const i=wp(t,r.shape);let a=i;const o=Kw(a,r.rank);null!=o&&(r=ax(r,o),a=Jw(a.length,r.rank));const s=e.all(r,a);if(n){const e=Yw(s.shape,i);return nx(s,e)}return s},{x:r},null,rm,{axis:t,keepDims:n})}}),e_=By({any_:function(e,t=null,n=!1){let r=Fy(e,"x","any","bool");return Ay.runKernelFunc(e=>{const i=wp(t,r.shape);let a=i;const o=Kw(a,r.rank);null!=o&&(r=ax(r,o),a=Jw(a.length,r.rank));const s=e.any(r,a);if(n){const e=Yw(s.shape,i);return nx(s,e)}return s},{x:r},null,im,{axis:t,keepDims:n})}}),t_=By({argMax_:function(e,t=0){let n=Fy(e,"x","argMax");return Ay.runKernelFunc((e,r)=>{r([n]);let i=wp(t,n.shape);const a=Kw(i,n.rank);return null!=a&&(n=ax(n,a),i=Jw(i.length,n.rank)),e.argMax(n,i[0])},{x:n},null,am,{axis:t})}}),n_=By({argMin_:function(e,t=0){let n=Fy(e,"x","argMin");return Ay.runKernelFunc((e,r)=>{r([n]),null==t&&(t=0);let i=wp(t,n.shape);const a=Kw(i,n.rank);return null!=a&&(n=ax(n,a),i=Jw(i.length,n.rank)),e.argMin(n,i[0])},{x:n},null,om,{axis:t})}}),r_=By({asin_:function(e){const t=Fy(e,"x","asin");return Ay.runKernelFunc((e,n)=>{const r=e.asin(t);return n([t]),r},{x:t},null,sm)}}),i_=By({asinh_:function(e){const t=Fy(e,"x","asinh");return Ay.runKernelFunc((e,n)=>{const r=e.asinh(t);return n([t]),r},{x:t},null,lm)}}),a_=By({atan_:function(e){const t=Fy(e,"x","atan");return Ay.runKernelFunc((e,n)=>{const r=e.atan(t);return n([t]),r},{x:t},null,um)}}),o_=By({atan2_:function(e,t){let n=Fy(e,"a","atan2"),r=Fy(t,"b","atan2");return[n,r]=Sy(n,r),Ay.runKernelFunc((e,t)=>{const i=e.atan2(n,r);return t([n,r]),i},{a:n,b:r},null,dm)}}),s_=By({atanh_:function(e){const t=Fy(e,"x","atanh");return Ay.runKernelFunc((e,n)=>{const r=e.atanh(t);return n([t]),r},{x:t},null,cm)}});function l_(e,t,n,r,i="NHWC",a){return d_(e,[...t,e[3]],n,a,r,null,null,x_(i))}function u_(e,t,n,r,i,a,o="channelsLast"){const[s,l]=p_(t);let u;if("channelsLast"===o)u=[s,l,e[3],e[3]];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);u=[s,l,e[1],e[1]]}return d_(e,u,n,r,i,a,!1,o)}function c_(e,t,n,r,i,a,o="NDHWC"){const[s,l,u]=m_(t);let c,d;if("NDHWC"===o)d="channelsLast",c=[s,l,u,e[4],e[4]];else{if("NCDHW"!==o)throw new Error("Unknown dataFormat "+o);d="channelsFirst",c=[s,l,u,e[1],e[1]]}return h_(e,c,n,r,i,!1,d,a)}function d_(e,t,n,r,i,a,o=!1,s="channelsLast"){let[l,u,c,d]=[-1,-1,-1,-1];if("channelsLast"===s)[l,u,c,d]=e;else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);[l,d,u,c]=e}const[h,f,,p]=t,[m,g]=p_(n),[v,y]=p_(r),b=g_(h,v),x=g_(f,y),{padInfo:w,outHeight:_,outWidth:S}=function(e,t,n,r,i,a,o,s,l){let u,c,d;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};const i=function(e,t,n,r,i){null==r&&(r=f_(e,t,n));const a=e[1],o=v_((e[0]-t+2*r)/n+1,i);sp(pp(o),()=>`The output # of rows (${o}) must be an integer. Change the stride and/or zero pad parameters`);const s=v_((a-t+2*r)/n+1,i);return sp(pp(s),()=>`The output # of columns (${s}) must be an integer. Change the stride and/or zero pad parameters`),[o,s]}([t,n],a,r,e,s);c=i[0],d=i[1]}else if("same"===e){c=Math.ceil(t/r),d=Math.ceil(n/i);const e=Math.max(0,(c-1)*r+a-t),s=Math.max(0,(d-1)*i+o-n),l=Math.floor(e/2),h=e-l,f=Math.floor(s/2);u={top:l,bottom:h,left:f,right:s-f,type:"SAME"}}else if("valid"===e)u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-a+1)/r),d=Math.ceil((n-o+1)/i);else{if("object"!=typeof e)throw Error("Unknown padding parameter: "+e);{const h="channelsLast"===l?e[1][0]:e[2][0],f="channelsLast"===l?e[1][1]:e[2][1],p="channelsLast"===l?e[2][0]:e[3][0],m="channelsLast"===l?e[2][1]:e[3][1];u={top:h,bottom:f,left:p,right:m,type:0===h&&0===f&&0===p&&0===m?"VALID":"EXPLICIT"},c=v_((t-a+h+f)/r+1,s),d=v_((n-o+p+m)/i+1,s)}}return{padInfo:u,outHeight:c,outWidth:d}}(i,u,c,m,g,b,x,a,s),E=o?p*d:p;let T;return"channelsFirst"===s?T=[l,E,_,S]:"channelsLast"===s&&(T=[l,_,S,E]),{batchSize:l,dataFormat:s,inHeight:u,inWidth:c,inChannels:d,outHeight:_,outWidth:S,outChannels:E,padInfo:w,strideHeight:m,strideWidth:g,filterHeight:h,filterWidth:f,effectiveFilterHeight:b,effectiveFilterWidth:x,dilationHeight:v,dilationWidth:y,inShape:e,outShape:T,filterShape:t}}function h_(e,t,n,r,i,a=!1,o="channelsLast",s){let[l,u,c,d,h]=[-1,-1,-1,-1,-1];if("channelsLast"===o)[l,u,c,d,h]=e;else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);[l,h,u,c,d]=e}const[f,p,m,,g]=t,[v,y,b]=m_(n),[x,w,_]=m_(r),S=g_(f,x),E=g_(p,w),T=g_(m,_),{padInfo:k,outDepth:C,outHeight:I,outWidth:O}=function(e,t,n,r,i,a,o,s,l,u,c){let d,h,f,p;if("number"==typeof e){d={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};const a=function(e,t,n,r,i,a){null==i&&(i=f_(e,t,r));const o=e[1],s=e[2],l=v_((e[0]-t+2*i)/r+1,a);sp(pp(l),()=>`The output # of depths (${l}) must be an integer. Change the stride and/or zero pad parameters`);const u=v_((o-t+2*i)/r+1,a);sp(pp(u),()=>`The output # of rows (${u}) must be an integer. Change the stride and/or zero pad parameters`);const c=v_((s-t+2*i)/r+1,a);return sp(pp(c),()=>`The output # of columns (${c}) must be an integer. Change the stride and/or zero pad parameters`),[l,u,c,1]}([t,n,r,1],s,0,i,e,c);h=a[0],f=a[1],p=a[2]}else if("same"===e){h=Math.ceil(t/i),f=Math.ceil(n/a),p=Math.ceil(r/o);const e=(h-1)*i+s-t,c=(f-1)*a+l-n,m=(p-1)*o+u-r,g=Math.floor(e/2),v=e-g,y=Math.floor(c/2),b=c-y,x=Math.floor(m/2);d={top:y,bottom:b,left:x,right:m-x,front:g,back:v,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);d={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((t-s+1)/i),f=Math.ceil((n-l+1)/a),p=Math.ceil((r-u+1)/o)}return{padInfo:d,outDepth:h,outHeight:f,outWidth:p}}(i,u,c,d,v,y,b,S,E,T,s),A=a?g*h:g;let D;return"channelsFirst"===o?D=[l,A,C,I,O]:"channelsLast"===o&&(D=[l,C,I,O,A]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:c,inWidth:d,inChannels:h,outDepth:C,outHeight:I,outWidth:O,outChannels:A,padInfo:k,strideDepth:v,strideHeight:y,strideWidth:b,filterDepth:f,filterHeight:p,filterWidth:m,effectiveFilterDepth:S,effectiveFilterHeight:E,effectiveFilterWidth:T,dilationDepth:x,dilationHeight:w,dilationWidth:_,inShape:e,outShape:D,filterShape:t}}function f_(e,t,n,r=1){const i=g_(t,r);return Math.floor((e[0]*(n-1)-n+i)/2)}function p_(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function m_(e){return"number"==typeof e?[e,e,e]:e}function g_(e,t){return t<=1?e:e+(e-1)*(t-1)}function v_(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function y_(e){const[t,n,r]=p_(e);return 1===t&&1===n&&1===r}function b_(e,t){return y_(e)||y_(t)}function x_(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}const w_=By({avgPool_:function(e,t,n,r,i){const a=Fy(e,"x","avgPool","float32");sp(b_(n,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`);let o=a,s=!1;3===a.rank&&(s=!0,o=nx(a,[1,a.shape[0],a.shape[1],a.shape[2]])),sp(4===o.rank,()=>`Error in avgPool: x must be rank 4 but got rank ${o.rank}.`),null!=i&&sp(pp(r),()=>`Error in avgPool: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`);let l=Ay.runKernelFunc((e,a)=>{const s=u_(o.shape,t,n,1,r,i);return a([o]),1===s.filterWidth&&1===s.filterHeight&&fp(s.inShape,s.outShape)?o.clone():e.avgPool(o,s)},{x:o},null,hm,{filterSize:t,strides:n,pad:r,dimRoundingMode:i});return l=Pb(l,a.dtype),s?nx(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),__=By({avgPool3d_:function(e,t,n,r,i,a="NDHWC",o){null==o?o=[1,1,1]:Gx("dilations is deprecated, this field will be gone in v3.0.0.");const s=Fy(e,"x","avgPool3d","float32");let l=s,u=!1;4===s.rank&&(u=!0,l=nx(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),sp(5===l.rank,()=>`Error in avgPool3d: x must be rank 5 but got rank ${l.rank}.`),sp("NDHWC"===a,()=>"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a),sp(b_(n,o),()=>`Error in avgPool3d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),null!=i&&sp(pp(r),()=>`Error in avgPool3d: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`);let c=Ay.runKernelFunc((e,s)=>{null==o&&(o=[1,1,1]);const u=c_(l.shape,t,n,o,r,i,a);return s([l]),e.avgPool3d(l,u)},{x:l},null,pm,{filterSize:t,strides:n,pad:r,dimRoundingMode:i,dataFormat:a,dilations:o});return c=Pb(c,l.dtype),u?nx(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}});function S_(e,t){const n=e[0].length;e.forEach((e,t)=>{sp(e.length===n,()=>`Error in concat${n}D: rank of tensors[${t}] must be the same as the rank of the rest (${n})`)}),sp(t>=0&&t<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const r=e[0];e.forEach((e,i)=>{for(let a=0;a<n;a++)sp(a===t||e[a]===r[a],()=>`Error in concat${n}D: Shape of tensors[${i}] (${e}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`)})}function E_(e,t){const n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}const T_=By({concat_:function(e,t=0){sp(e.length>=1,()=>"Pass at least one tensor to concat");let n=Ly(e,"tensors","concat");return"complex64"===n[0].dtype&&n.forEach(e=>{if("complex64"!==e.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${e.dtype}. `)}),Ay.runKernelFunc((e,r)=>{const i=wp(t,n[0].shape)[0],a=E_(n.map(e=>e.shape),i);if(0===dp(a))return Hy([],a);if(n=n.filter(e=>e.size>0),1===n.length)return n[0];S_(n.map(e=>e.shape),i);const o=e.concat(n,i);return r(n),o},n,null,Sm,{axis:t})}}),k_=By({sigmoid_:function(e){const t=Fy(e,"x","sigmoid");return Ay.runKernelFunc((e,n)=>{const r=e.sigmoid(t);return n([r]),r},{x:t},null,fv)}}),C_=By({slice_:function(e,t,n){const r=Fy(e,"x","slice");if(0===r.rank)throw new Error("Slicing scalar is not possible");return Ay.runKernelFunc((e,i)=>{const[a,o]=Ox(r,t,n);return mx(r,a,o),i([r]),e.slice(r,a,o)},{x:r},null,uv,{begin:t,size:n})}}),I_=By({tanh_:function(e){const t=Fy(e,"x","tanh");return Ay.runKernelFunc((e,n)=>{const r=e.tanh(t);return n([r]),r},{x:t},null,kv)}}),O_=By({basicLSTMCell_:function(e,t,n,r,i,a){const o=Fy(e,"forgetBias","basicLSTMCell"),s=Fy(t,"lstmKernel","basicLSTMCell"),l=Fy(n,"lstmBias","basicLSTMCell"),u=Fy(r,"data","basicLSTMCell"),c=Fy(i,"c","basicLSTMCell"),d=Fy(a,"h","basicLSTMCell"),h=T_([u,d],1),f=rx(h,s),p=dw(f,l),m=p.shape[1]/4,g=[p.shape[0],m],v=C_(p,[0,0],g),y=C_(p,[0,m],g),b=C_(p,[0,2*m],g),x=C_(p,[0,3*m],g),w=dw(pw(k_(v),I_(y)),pw(c,k_(dw(o,b))));return[w,pw(I_(w),k_(x))]}}),A_=By({batchToSpaceND_:function(e,t,n){const r=Fy(e,"x","batchToSpaceND"),i=t.reduce((e,t)=>e*t);return sp(r.rank>=1+t.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${t.length}`),sp(n.length===t.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`),sp(r.shape[0]%i==0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${i}`),Ay.runKernelFunc(e=>e.batchToSpaceND(r,t,n),{x:r},null,vm,{blockShape:t,crops:n})}});function D_(e){return null==e?null:0===e.rank?nx(e,[e.size]):1===e.rank?e:2===e.rank?nx(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?nx(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}const M_=By({batchNorm_:function(e,t,n,r,i,a){null==a&&(a=.001);const o=Fy(e,"x","batchNorm"),s=Fy(t,"mean","batchNorm"),l=Fy(n,"variance","batchNorm");let u,c;null!=i&&(u=Fy(i,"scale","batchNorm")),null!=r&&(c=Fy(r,"offset","batchNorm")),sp(s.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),sp(null==c||s.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),sp(null==u||s.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const d=function(e){let t;return t=0===e.rank||1===e.rank?nx(e,[1,1,1,e.size]):2===e.rank?nx(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?nx(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e,t}(o),h=Ay.runKernelFunc((e,t)=>(t([d,s,l,u]),e.batchNorm(d,D_(s),D_(l),D_(c),D_(u),a)),{x:d,scale:u,offset:c,mean:s,variance:l},null,eg,{varianceEpsilon:a});return nx(h,o.shape)}}),N_=By({batchNorm2d_:function(e,t,n,r,i,a){const o=Fy(e,"x","batchNorm"),s=Fy(t,"mean","batchNorm"),l=Fy(n,"variance","batchNorm");let u,c;return null!=i&&(u=Fy(i,"scale","batchNorm")),null!=r&&(c=Fy(r,"offset","batchNorm")),sp(2===o.rank,()=>"Error in batchNorm2D: x must be rank 2 but got rank "+o.rank+"."),sp(2===s.rank||1===s.rank,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${s.rank}.`),sp(2===l.rank||1===l.rank,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),null!=u&&sp(2===u.rank||1===u.rank,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),null!=c&&sp(2===c.rank||1===c.rank,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),M_(o,s,l,c,u,a)}}),j_=By({batchNorm3d_:function(e,t,n,r,i,a){const o=Fy(e,"x","batchNorm"),s=Fy(t,"mean","batchNorm"),l=Fy(n,"variance","batchNorm");let u,c;return null!=i&&(u=Fy(i,"scale","batchNorm")),null!=r&&(c=Fy(r,"offset","batchNorm")),sp(3===o.rank,()=>"Error in batchNorm3D: x must be rank 3 but got rank "+o.rank+"."),sp(3===s.rank||1===s.rank,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${s.rank}.`),sp(3===l.rank||1===l.rank,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),null!=u&&sp(3===u.rank||1===u.rank,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),null!=c&&sp(3===c.rank||1===c.rank,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),M_(o,s,l,c,u,a)}}),R_=By({batchNorm4d_:function(e,t,n,r,i,a){const o=Fy(e,"x","batchNorm"),s=Fy(t,"mean","batchNorm"),l=Fy(n,"variance","batchNorm");let u,c;return null!=i&&(u=Fy(i,"scale","batchNorm")),null!=r&&(c=Fy(r,"offset","batchNorm")),sp(4===o.rank,()=>"Error in batchNorm4D: x must be rank 4 but got rank "+o.rank+"."),sp(4===s.rank||1===s.rank,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${s.rank}.`),sp(4===l.rank||1===l.rank,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),null!=u&&sp(4===u.rank||1===u.rank,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),null!=c&&sp(4===c.rank||1===c.rank,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),M_(o,s,l,c,u,a)}}),P_=By({broadcastTo_:function(e,t){let n=Fy(e,"broadcastTo","x");const r=n.shape;if(t.some(e=>!(e>0)||e%1!=0))throw new Error(`broadcastTo(): Invalid broadcast shape [${t}].`);if(t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){const e=n.shape.slice();for(;e.length<t.length;)e.unshift(1);n=nx(n,e)}const i=n.shape,a=Array.from(t);for(let o=t.length-1;o>=0;o--)if(i[o]===t[o])a[o]=1;else if(1!==n.shape[o])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${t}].`);return 0===a.map((e,t)=>e>1?t:-1).filter(e=>e>=0).length?Fb(n):Ay.runKernelFunc(e=>e.tile(n,a),{x:n},null,ym,{shape:t,inputShape:i})}}),F_=By({ceil_:function(e){const t=Fy(e,"x","ceil");return Ay.runKernelFunc(e=>e.ceil(t),{x:t},null,xm)}}),L_=By({clipByValue_:function(e,t,n){const r=Fy(e,"x","clipByValue");return sp(t<=n,()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`),Ay.runKernelFunc((e,i)=>{const a=e.clip(r,t,n);return i([r]),a},{x:r},null,wm,{clipValueMin:t,clipValueMax:n})}}),$_=By({concat1d_:function(e){return T_(e,0)}}),B_=By({concat2d_:function(e,t){return T_(e,t)}}),z_=By({concat3d_:function(e,t){return T_(e,t)}}),U_=By({concat4d_:function(e,t){return T_(e,t)}}),H_=By({conv2d_:function(e,t,n,r,i="NHWC",a=[1,1],o){const s=Fy(e,"x","conv2d"),l=Fy(t,"filter","conv2d");let u=s,c=!1;3===s.rank&&(c=!0,u=nx(s,[1,s.shape[0],s.shape[1],s.shape[2]])),sp(4===u.rank,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),sp(4===l.rank,()=>"Error in conv2d: filter must be rank 4, but got rank "+l.rank+"."),null!=o&&sp(pp(r),()=>`Error in conv2d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);const d="NHWC"===i?u.shape[3]:u.shape[1];sp(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),sp(b_(n,a),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`);const h=Ay.runKernelFunc((e,t)=>{const s=x_(i),c=d_(u.shape,l.shape,n,a,r,o,!1,s),d=e.conv2d(u,l,c);return t([u,l]),d},{x:u,filter:l},null,Em,{strides:n,pad:r,dataFormat:i,dilations:a,dimRoundingMode:o});return c?nx(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),W_=By({conv1d_:function(e,t,n,r,i="NWC",a=1,o){const s=Fy(e,"x","conv1d"),l=Fy(t,"filter","conv1d");let u=s,c=!1;2===s.rank&&(c=!0,u=nx(s,[1,s.shape[0],s.shape[1]])),sp(3===u.rank,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),sp(3===l.rank,()=>"Error in conv1d: filter must be rank 3, but got rank "+l.rank+"."),null!=o&&sp(pp(r),()=>`Error in conv1d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`),sp(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),sp(b_(n,a),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${a}'`),sp("NWC"===i,()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`);const d=nx(l,[1,l.shape[0],l.shape[1],l.shape[2]]),h=nx(u,[u.shape[0],1,u.shape[1],u.shape[2]]),f=H_(h,d,[1,n],r,"NHWC",[1,a],o);return nx(f,c?[f.shape[2],f.shape[3]]:[f.shape[0],f.shape[2],f.shape[3]])}}),V_=By({conv2DBackpropInput_:function(e,t,n,r,i,a="NHWC",o){sp(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let s=e,l=t,u=!1;3===t.rank&&(u=!0,l=nx(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),sp(4===s.length,()=>"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."),sp(4===l.rank,()=>"Error in conv2dDerInput: dy must be rank 4, but got rank "+l.rank),sp(4===n.rank,()=>"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank);const c="NHWC"===a?s[3]:s[1],d="NHWC"===a?l.shape[3]:l.shape[1];sp(c===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`),sp(d===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[3]}.`),null!=o&&sp(pp(i),()=>`Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ${o} but got pad ${i}.`);const h=Ay.runKernelFunc((e,t)=>{const u=x_(a),c=d_(s,n.shape,r,1,i,o,!1,u),d=e.conv2dDerInput(l,n,c);return t([l,n]),d},{dy:l,filter:n},null,km,{strides:r,pad:i,dataFormat:a,dimRoundingMode:o,inputShape:s});return u?nx(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),q_=By({conv2dTranspose_:function(e,t,n,r,i,a){const o=Fy(e,"x","conv2dTranspose"),s=Fy(t,"filter","conv2dTranspose");return V_(n,o,s,r,i,"NHWC",a)}}),G_=By({conv3d_:function(e,t,n,r,i="NDHWC",a=[1,1,1]){const o=Fy(e,"x","conv3d"),s=Fy(t,"filter","conv3d");let l=o,u=!1;4===o.rank&&(u=!0,l=nx(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),sp(5===l.rank,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),sp(5===s.rank,()=>"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."),sp(l.shape[4]===s.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${s.shape[3]}.`),sp(b_(n,a),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`),sp("NDHWC"===i,()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`);const c=Ay.runKernelFunc((e,t)=>{const i=h_(l.shape,s.shape,n,a,r),o=e.conv3d(l,s,i);return t([l,s]),o},{x:l,filter:s},null,Cm,{strides:n,pad:r,dataFormat:i,dilations:a});return u?nx(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}}),Y_=By({conv3DBackpropInput_:function(e,t,n,r,i){sp(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let a=e,o=t,s=!1;4===t.rank&&(s=!0,o=nx(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),a=[1,e[0],e[1],e[2],e[3]]);const l=a[4],u=o.shape[4];sp(5===a.length,()=>"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."),sp(5===o.rank,()=>"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank),sp(5===n.rank,()=>"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank),sp(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),sp(u===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${n.shape[4]}.`);const c=Ay.runKernelFunc(e=>{const t=h_(a,n.shape,r,1,i);return e.conv3dDerInput(o,n,t)},{dy:o,filter:n},null,Om,{pad:i,strides:r,inputShape:a});return s?nx(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}}),X_=By({conv3dTranspose_:function(e,t,n,r,i){const a=Fy(e,"x","conv3dTranspose"),o=Fy(t,"filter","conv3dTranspose");return Y_(n,a,o,r,i)}}),K_=By({cos_:function(e){const t=Fy(e,"x","cos");return Ay.runKernelFunc((e,n)=>{const r=e.cos(t);return n([t]),r},{x:t},null,Am)}}),Z_=By({cosh_:function(e){const t=Fy(e,"x","cosh");return Ay.runKernelFunc((e,n)=>{const r=e.cosh(t);return n([t]),r},{x:t},null,Dm)}}),J_=By({cumsum_:function(e,t=0,n=!1,r=!1){const i=Fy(e,"x","cumsum");return Ay.runKernelFunc((e,a)=>{const o=Kw([t],i.rank);let s=i;null!=o&&(s=ax(i,o));const l=Jw(1,i.rank)[0];let u=e.cumsum(s,l,n,r);if(a([i]),null!=o){const e=Zw(o);u=ax(u,e)}return u},{x:i},null,Mm,{axis:t,exclusive:n,reverse:r})}}),Q_=By({depthToSpace_:function(e,t,n="NHWC"){const r=Fy(e,"x","depthToSpace"),i="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return sp(i*t>=0,()=>`Negative dimension size caused by overflow when multiplying\n    ${i} and ${t}  for depthToSpace with input shape\n    ${r.shape}`),sp(a*t>=0,()=>`Negative dimension size caused by overflow when multiplying\n    ${a} and ${t} for depthToSpace with input shape\n        ${r.shape}`),sp(o%(t*t)==0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${o} for depthToSpace with input shape ${r.shape}`),Ay.runKernelFunc(e=>e.depthToSpace(r,t,n),{x:r},null,jm,{blockSize:t,dataFormat:n})}}),eS=By({depthwiseConv2d_:function(e,t,n,r,i="NHWC",a=[1,1],o){const s=Fy(e,"x","depthwiseConv2d"),l=Fy(t,"filter","depthwiseConv2d");let u=s,c=!1;3===s.rank&&(c=!0,u=nx(s,[1,s.shape[0],s.shape[1],s.shape[2]])),sp(4===u.rank,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),sp(4===l.rank,()=>"Error in depthwiseConv2d: filter must be rank 4, but got rank "+l.rank+"."),sp(u.shape[3]===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),null!=o&&sp(pp(r),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);const d=Ay.runKernelFunc((e,t)=>{null==a&&(a=[1,1]),sp(b_(n,a),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`);const i=d_(u.shape,l.shape,n,a,r,o,!0),s=e.depthwiseConv2D(u,l,i);return t([u,l]),s},{x:u,filter:l},null,Rm,{strides:n,pad:r,dataFormat:i,dilations:a,dimRoundingMode:o});return c?nx(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),tS=By({diag_:function(e){const t=Fy(e,"x","diag");return Ay.runKernelFunc(n=>{const r=nx(t,[t.size]),i=n.diag(r),a=[...e.shape,...e.shape];return nx(i,a)},{x:t},null,Lm)}}),nS=By({dilation2d_:function(e,t,n,r,i=[1,1],a="NHWC"){const o=Fy(e,"x","dilation2d"),s=Fy(t,"filter","dilation2d");sp(3===o.rank||4===o.rank,()=>"Error in dilation2d: input must be rank 3 or 4, but got rank "+o.rank+"."),sp(3===s.rank,()=>"Error in dilation2d: filter must be rank 3, but got rank "+s.rank+"."),sp("NHWC"===a,()=>"Error in dilation2d: Only NHWC is currently supported, but got dataFormat of "+a);let l=o,u=!1;3===o.rank&&(l=nx(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0);const c=Ay.runKernel($m,{x:l,filter:s},{strides:n,pad:r,dilations:i});return u?nx(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),rS=By({equal_:function(e,t){let n=Fy(e,"a","equal"),r=Fy(t,"b","equal");return[n,r]=Sy(n,r),Pw(n.shape,r.shape),Ay.runKernelFunc(e=>e.equal(n,r),{a:n,b:r},null,qm)}}),iS=By({where_:function(e,t,n){const r=Fy(t,"a","where"),i=Fy(n,"b","where"),a=Fy(e,"condition","where","bool"),o=Pw(r.shape,i.shape),s=P_(r,o),l=P_(i,o);return 1===a.rank&&sp(a.shape[0]===r.shape[0],()=>"The first dimension of `a` must match the size of `condition`."),1!==a.rank&&lp(a.shape,l.shape,"Error in where: "),Ay.runKernelFunc((e,t)=>{const n=e.select(a,s,l);return t([a]),n},{condition:a,t:s,e:l},null,sv)}}),aS=By({divNoNan_:function(e,t){let n=Fy(e,"a","div"),r=Fy(t,"b","div");[n,r]=Sy(n,r);const i=fw(n,r),a=vw(i),o=rS(r,a);return iS(o,a,i)}}),oS=By({dot_:function(e,t){const n=Fy(e,"t1","dot"),r=Fy(t,"t2","dot");sp(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`);const i=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];if(sp(i===a,()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${a}.`),1===n.rank&&1===r.rank){const e=nx(n,[1,-1]),t=nx(r,[-1,1]),i=rx(e,t);return nx(i,[])}if(1===n.rank&&2===r.rank){const e=nx(n,[1,-1]),t=nx(r,[r.shape[0],r.shape[1]]),i=rx(e,t);return nx(i,[i.size])}if(2===n.rank&&1===r.rank){const e=nx(r,[-1,1]),t=rx(n,e);return nx(t,[t.size])}{const e=nx(r,[r.shape[0],r.shape[1]]);return rx(n,e)}}}),sS=By({elu_:function(e){const t=Fy(e,"x","elu");return Ay.runKernelFunc((e,n)=>{const r=e.elu(t);return n([r]),r},{x:t},null,Hm)}}),lS=By({erf_:function(e){let t=Fy(e,"x","erf");return sp("int32"===t.dtype||"float32"===t.dtype,()=>"Input dtype must be `int32` or `float32`."),"int32"===t.dtype&&(t=Pb(t,"float32")),Ay.runKernelFunc((e,n)=>{const r=e.erf(t);return n([t]),r},{x:t},null,Vm)}}),uS=By({exp_:function(e){const t=Fy(e,"x","exp");return Ay.runKernelFunc((e,n)=>{const r=e.exp(t);return n([r]),r},{x:t},null,Gm)}}),cS=By({expandDims_:function(e,t=0){const n=Fy(e,"x","expandDims",null);sp(t<=n.rank,()=>"Axis must be <= rank of the tensor");const r=n.shape.slice();return t<0&&(sp(-(n.rank+1)<=t,()=>`Axis must be in the interval [${-(n.rank+1)}, ${n.rank}]`),t=n.rank+t+1),r.splice(t,0,1),nx(n,r)}}),dS=By({expm1_:function(e){const t=Fy(e,"x","expm1");return Ay.runKernelFunc((e,n)=>{const r=e.expm1(t);return n([t]),r},{x:t},null,Ym)}}),hS=By({tile_:function(e,t){const n=Fy(e,"x","tile",null);return sp(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`),Ay.runKernelFunc((e,r)=>{const i=e.tile(n,t);return r([n]),i},{x:n},null,Cv,{reps:t},[n])}}),fS=By({eye_:function(e,t,n,r="float32"){null==t&&(t=e);const i=Rb([e,t],r),a=e<=t?e:t;for(let s=0;s<a;++s)i.set(1,s,s);const o=nx(i.toTensor(),[e,t]);if(null==n)return o;if(1===n.length)return hS(cS(o,0),[n[0],1,1]);if(2===n.length)return hS(cS(cS(o,0),0),[n[0],n[1],1,1]);if(3===n.length)return hS(cS(cS(cS(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}}),pS=By({floor_:function(e){const t=Fy(e,"x","floor");return Ay.runKernelFunc(e=>e.floor(t),{x:t},null,Jm)}}),mS=30;function gS(e){return e<=mS?e:Pp(e,Math.floor(Math.sqrt(e)))}function vS(e,t){let n,r=!1;for(e<=mS?(n=e,r=!0):n=Pp(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Pp(e,n+1);return n}function yS(e,t,n){const r=[],i=e.length;for(let a=0;a<i;a++)r.push(a!==t?e[a]:n);return r}function bS(e,t,n){const r=e.shape[n],i=[];let a=1,o=1;for(let s=0;s<n;s++)i.push(e.shape[s]),a*=e.shape[s];for(let s=0;s<t.rank;s++)i.push(t.shape[s]);for(let s=n+1;s<e.rank;s++)i.push(e.shape[s]),o*=e.shape[s];return{batchSize:a,sliceSize:o,dimSize:r,outputShape:i}}const xS=By({gather_:function(e,t,n=0){const r=Fy(e,"x","gather"),i=Fy(t,"indices","gather","int32");return Ay.runKernelFunc((e,t)=>{const a=wp(n,r.shape)[0],o=bS(r,i,a),s=e.gather(r,nx(i,[i.size]),a);return t([r,i]),nx(s,o.outputShape)},{x:r,indices:i},null,tg,{axis:n})}}),wS=By({greater_:function(e,t){let n=Fy(e,"a","greater"),r=Fy(t,"b","greater");return[n,r]=Sy(n,r),Pw(n.shape,r.shape),Ay.runKernelFunc(e=>e.greater(n,r),{a:n,b:r},null,rg)}}),_S=By({greaterEqual_:function(e,t){let n=Fy(e,"a","greaterEqual"),r=Fy(t,"b","greaterEqual");return[n,r]=Sy(n,r),Pw(n.shape,r.shape),Ay.runKernelFunc((e,t)=>{const i=e.greaterEqual(n,r);return t([n,r]),i},{a:n,b:r},null,ig)}}),SS=By({imag_:function(e){const t=Fy(e,"input","imag");return Ay.runKernelFunc(e=>e.imag(t),{input:t},null,sg)}}),ES=By({isFinite_:function(e){const t=Fy(e,"x","isFinite");return Ay.runKernelFunc(e=>e.isFinite(t),{x:t},null,lg)}}),TS=By({isInf_:function(e){const t=Fy(e,"x","isInf");return Ay.runKernelFunc(e=>e.isInf(t),{x:t},null,ug)}}),kS=By({isNaN_:function(e){const t=Fy(e,"x","isNaN");return Ay.runKernelFunc(e=>e.isNaN(t),{x:t},null,cg)}}),CS=By({leakyRelu_:function(e,t=.2){const n=Fy(e,"x","leakyRelu");return Fw(pw(Tw(t),n),n)}}),IS=By({less_:function(e,t){let n=Fy(e,"a","less"),r=Fy(t,"b","less");return[n,r]=Sy(n,r),Pw(n.shape,r.shape),Ay.runKernelFunc(e=>e.less(n,r),{a:n,b:r},null,dg)}}),OS=By({lessEqual_:function(e,t){let n=Fy(e,"a","lessEqual"),r=Fy(t,"b","lessEqual");return[n,r]=Sy(n,r),Pw(n.shape,r.shape),Ay.runKernelFunc((e,t)=>{const i=e.lessEqual(n,r);return t([n,r]),i},{a:n,b:r},null,hg)}});function AS(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return Ay.runKernelFunc(r=>r.linspace(e,t,n),{},null,fg,{start:e,stop:t,num:n})}const DS=By({localResponseNormalization_:function(e,t=5,n=1,r=1,i=.5){const a=Fy(e,"x","localResponseNormalization");sp(4===a.rank||3===a.rank,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${a.rank}.`),sp(pp(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let o=a,s=!1;3===a.rank&&(s=!0,o=nx(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const l=Ay.runKernelFunc((e,a)=>{const s=e.localResponseNormalization4D(o,t,n,r,i);return a([o,s]),s},{x:o},null,xg,{depthRadius:t,bias:n,alpha:r,beta:i});return s?nx(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),MS=By({log_:function(e){const t=Fy(e,"x","log");return Ay.runKernelFunc((e,n)=>{const r=e.log(t);return n([t]),r},{x:t},null,pg)}}),NS=By({log1p_:function(e){const t=Fy(e,"x","log1p");return Ay.runKernelFunc((e,n)=>{const r=e.log1p(t);return n([t]),r},{x:t},null,mg)}}),jS=By({neg_:function(e){const t=Fy(e,"x","neg");return Ay.runKernelFunc(e=>e.neg(t),{x:t},null,Rg)}}),RS=By({softplus_:function(e){const t=Fy(e,"x","softplus");return Ay.runKernelFunc((e,n)=>{const r=e.softplus(t);return n([t]),r},{x:t},null,pv)}}),PS=By({logSigmoid_:function(e){const t=Fy(e,"x","logSigmoid");return Sw(e=>({value:jS(RS(jS(e))),gradFunc:t=>pw(t,k_(jS(e)))}))(t)}}),FS=By({max_:function(e,t=null,n=!1){const r=Fy(e,"x","max");return Ay.runKernelFunc((e,i)=>{let a=wp(t,r.shape);const o=Kw(a,r.rank);let s=r;null!=o&&(s=ax(r,o),a=Jw(a.length,s.rank));const l=e.max(s,a);null!=o&&s.dispose();let u=l;if(n){const e=Yw(u.shape,wp(t,r.shape));u=nx(u,e),l.dispose()}return i([r,u]),u},{x:r},null,_g,{reductionIndices:t,keepDims:n})}}),LS=By({sum_:function(e,t=null,n=!1){let r=Fy(e,"x","sum");return"bool"===r.dtype&&(r=Pb(r,"int32")),Ay.runKernelFunc((e,i)=>{i([r]);const a=wp(t,r.shape),o=Kw(a,r.rank);let s=a,l=r;null!=o&&(l=ax(r,o),s=Jw(s.length,r.rank));let u=e.sum(l,s);if(n){const e=Yw(u.shape,a);u=nx(u,e)}return u},{x:r},null,gv,{axis:t,keepDims:n})}}),$S=By({logSoftmax_:function(e,t=-1){const n=Fy(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);return Ay.runKernelFunc((n,r)=>{const i=FS(e,t,!0),a=Dw(e,i),o=Dw(Pb(a,"float32"),MS(LS(uS(a),t,!0)));return r([o]),o},{logits:n},null,bg,{axis:t})}}),BS=By({logSumExp_:function(e,t=null,n=!1){const r=Fy(e,"x","logSumExp"),i=wp(t,r.shape),a=FS(r,i,!0),o=Dw(r,a),s=uS(o),l=LS(s,i),u=MS(l),c=dw(nx(a,u.shape),u);if(n){const e=Yw(c.shape,i);return nx(c,e)}return c}}),zS=By({logicalAnd_:function(e,t){const n=Fy(e,"a","logicalAnd","bool"),r=Fy(t,"b","logicalAnd","bool");return Pw(n.shape,r.shape),Ay.runKernelFunc(e=>e.logicalAnd(n,r),{a:n,b:r},null,gg)}}),US=By({logicalNot_:function(e){const t=Fy(e,"x","logicalNot","bool");return Ay.runKernelFunc(e=>e.logicalNot(t),{x:t},null,vg)}}),HS=By({logicalOr_:function(e,t){const n=Fy(e,"a","logicalOr","bool"),r=Fy(t,"b","logicalOr","bool");return Pw(n.shape,r.shape),Ay.runKernelFunc(e=>e.logicalOr(n,r),{a:n,b:r},null,yg)}}),WS=By({logicalXor_:function(e,t){const n=Fy(e,"a","logicalXor","bool"),r=Fy(t,"b","logicalXor","bool");return Pw(n.shape,r.shape),zS(HS(e,t),US(zS(e,t)))}}),VS=By({maxPool_:function(e,t,n,r,i){const a=Fy(e,"x","maxPool");let o=a,s=!1;3===a.rank&&(s=!0,o=nx(a,[1,a.shape[0],a.shape[1],a.shape[2]])),sp(4===o.rank,()=>`Error in maxPool: input must be rank 4 but got rank ${o.rank}.`),sp(b_(n,1),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`),null!=i&&sp(pp(r),()=>`Error in maxPool: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`);const l=Ay.runKernelFunc((e,a)=>{const s=u_(o.shape,t,n,1,r,i);let l;return l=1===s.filterWidth&&1===s.filterHeight&&fp(s.inShape,s.outShape)?o.clone():e.maxPool(o,s),a([o,l]),l},{x:o},null,Eg,{filterSize:t,strides:n,pad:r,dimRoundingMode:i});return s?nx(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),qS=By({maxPool3d_:function(e,t=[1,1,1],n,r,i,a="NDHWC",o){null==o?o=[1,1,1]:Gx("dilations is deprecated, this field will be gone in v3.0.0.");const s=Fy(e,"x","maxPool3d");let l=s,u=!1;4===s.rank&&(u=!0,l=nx(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),sp(5===l.rank,()=>`Error in maxPool3d: x must be rank 5 but got rank ${l.rank}.`),sp("NDHWC"===a,()=>"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a),sp(b_(n,o),()=>`Error in maxPool3d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),null!=i&&sp(pp(r),()=>`Error in maxPool3d: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`);const c=Ay.runKernelFunc((e,s)=>{null==o&&(o=[1,1,1]);const u=c_(l.shape,t,n,o,r,i,a),c=e.maxPool3d(l,u);return s([l,c]),c},{x:l},null,kg,{filterSize:t,strides:n,pad:r,dimRoundingMode:i,dataFormat:a,dilations:o});return u?nx(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}}),GS=By({maxPoolWithArgmax_:function(e,t,n,r,i=!1){const a=Fy(e,"x","maxPoolWithArgmax"),o=Ay.runKernel(Ig,{x:a},{filterSize:t,strides:n,pad:r,includeBatchInIndex:i});return{result:o[0],indexes:o[1]}}});function YS(e,t="float32"){if("complex64"===t){const t=YS(e,"float32"),n=YS(e,"float32");return zy(t,n)}const n=Bp(dp(e),t);return Ay.makeTensor(n,e,t)}function XS(e,t="float32"){if("complex64"===t){const t=XS(e,"float32"),n=YS(e,"float32");return zy(t,n)}const n=$p(dp(e),t);return Ay.makeTensor(n,e,t)}const KS=By({mean_:function(e,t=null,n=!1){const r=Fy(e,"x","mean"),i=wp(t,r.shape),a=dp(Gw(r.shape,i)[1]),o={x:r},s={axis:t,keepDims:n},l=()=>{const e=Tw(a),i=e.dtype===r.dtype?r:Pb(r,e.dtype),o=fw(i,e);return LS(o,t,n)};return Sw(e=>({value:Ay.runKernelFunc(l,o,null,Og,s),gradFunc:t=>{const n=e.shape.slice();i.forEach(e=>{n[e]=1});const r=nx(t,n);return fw(pw(r,XS(e.shape,"float32")),a)}}))(r)}}),ZS=By({min_:function(e,t=null,n=!1){const r=Fy(e,"x","min");return Ay.runKernelFunc((e,i)=>{const a=wp(t,r.shape);let o=a;const s=Kw(o,r.rank);let l=r;null!=s&&(l=ax(r,s),o=Jw(o.length,r.rank));const u=e.min(l,o);null!=s&&l.dispose();let c=u;if(n){const e=Yw(c.shape,a);c=nx(u,e),u.dispose()}return i([r,c]),c},{x:r},null,Ag,{axis:t,keepDims:n})}}),JS=By({minimum_:function(e,t){let n=Fy(e,"a","minimum"),r=Fy(t,"b","minimum");return[n,r]=Sy(n,r),"bool"===n.dtype&&(n=Pb(n,"int32"),r=Pb(r,"int32")),Pw(n.shape,r.shape),Ay.runKernelFunc((e,t)=>{const i=e.minimum(n,r);return t([n,r]),i},{a:n,b:r},null,Dg)}}),QS=By({mirrorPad_:function(e,t,n){sp("reflect"===n||"symmetric"===n,()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const r=Fy(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");sp(t.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${t.length}.`);const i="reflect"===n?1:0;for(let a=0;a<r.rank;a++)sp(2===t[a].length,()=>"Invalid number of paddings. Must be length of 2 each."),sp(t[a][0]>=0&&t[a][0]<=r.shape[a]-i&&t[a][1]>=0&&t[a][1]<=r.shape[a]-i,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-i} or less than 0 for input of shape `+r.shape);return Ay.runKernel(Mg,{x:r},{paddings:t,mode:n})}}),eE=By({mod_:function(e,t){let n=Fy(e,"a","mod"),r=Fy(t,"b","mod");return[n,r]=Sy(n,r),Ay.runKernelFunc((e,t)=>{const i=e.mod(n,r);return t([n,r]),i},{a:n,b:r},null,Ng)}}),tE=By({moments_:function(e,t=null,n=!1){const r=wp(t,(e=Fy(e,"x","moments")).shape),i=KS(e,r,n);let a=i.shape;n||(a=Yw(i.shape,r));const o=gw(Dw(Pb(e,"float32"),nx(i,a)));return{mean:i,variance:KS(o,r,n)}}}),nE=By({multiRNNCell_:function(e,t,n,r){const i=Fy(t,"data","multiRNNCell"),a=Ly(n,"c","multiRNNCell"),o=Ly(r,"h","multiRNNCell");let s=i;const l=[];for(let d=0;d<e.length;d++){const t=e[d](s,a[d],o[d]);l.push(t[0]),l.push(t[1]),s=t[1]}const u=[],c=[];for(let d=0;d<l.length;d+=2)u.push(l[d]),c.push(l[d+1]);return[u,c]}}),rE=By({multinomial_:function(e,t,n,r=!1){const i=Fy(e,"logits","multinomial"),a=i.size,o=i.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);n=n||Math.random();const s=1===o?nx(i,[1,-1]):i,l=Ay.runKernelFunc(e=>e.multinomial(s,r,t,n),{logits2D:s});return 1===o?nx(l,[l.size]):l}}),iE=By({notEqual_:function(e,t){let n=Fy(e,"a","notEqual"),r=Fy(t,"b","notEqual");return[n,r]=Sy(n,r),Pw(n.shape,r.shape),Ay.runKernelFunc(e=>e.notEqual(n,r),{a:n,b:r},null,Pg)}}),aE=By({real_:function(e){const t=Fy(e,"input","real");return Ay.runKernelFunc(e=>e.real(t),{input:t},null,Yg)}}),oE=By({onesLike_:function(e){const t=Fy(e,"x","onesLike");return Ay.runKernelFunc((e,n)=>{if("complex64"===t.dtype){const e=oE(aE(t)),n=vw(SS(t));return zy(e,n)}return e.onesLike(t)},{x:t},null,Bg)}}),sE=By({outerProduct_:function(e,t){const n=Fy(e,"v1","outerProduct"),r=Fy(t,"v2","outerProduct");sp(1===n.rank&&1===r.rank,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`);const i=nx(n,[-1,1]),a=nx(r,[1,-1]);return rx(i,a)}}),lE=By({pad_:function(e,t,n=0){const r=Fy(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return Ay.runKernelFunc((e,i)=>(i([r]),e.pad(r,t,n)),{x:r},null,Ug,{paddings:t,constantValue:n})}}),uE=By({pad1d_:function(e,t,n=0){return sp(2===t.length,()=>"Invalid number of paddings. Must be length of 2."),lE(e,[t],n)}}),cE=By({pad2d_:function(e,t,n=0){return sp(2===t.length&&2===t[0].length&&2===t[1].length,()=>"Invalid number of paddings. Must be length of 2 each."),lE(e,t,n)}}),dE=By({pad3d_:function(e,t,n=0){return sp(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,()=>"Invalid number of paddings. Must be length of 2 each."),lE(e,t,n)}}),hE=By({pad4d_:function(e,t,n=0){return sp(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,()=>"Invalid number of paddings. Must be length of 2 each."),lE(e,t,n)}}),fE=By({spaceToBatchND_:function(e,t,n){const r=Fy(e,"x","spaceToBatchND");return sp(r.rank>=1+t.length,()=>`input rank ${r.rank} should be > than [blockShape] ${t.length}`),sp(n.length===t.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`),sp(r.shape.reduce((e,r,i)=>i>0&&i<=t.length?e&&(r+n[i-1][0]+n[i-1][1])%t[i-1]==0:e,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`),Ay.runKernelFunc(e=>e.spaceToBatchND(r,t,n),{x:r},null,vv,{blockShape:t,paddings:n})}}),pE=By({pool_:function(e,t,n,r,i,a){null==i&&(i=[1,1]),null==a&&(a=1),0===r&&(r="valid");const o=Fy(e,"x","maxPool");let s=o,l=!1;3===o.rank&&(l=!0,s=nx(o,[1,o.shape[0],o.shape[1],o.shape[2]])),sp(b_(a,i),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${a} and dilations '${i}'`);const u=u_(s.shape,t,a,i,r),c=[u.dilationHeight,u.dilationWidth];let d;d="same"===r?function(e,t){const n=e.map((e,n)=>e+(e-1)*(t[n]-1)).map(e=>e-1),r=n.map(e=>Math.floor(e/2)),i=n.map((e,t)=>e-r[t]);return n.map((e,t)=>[r[t],i[t]])}([u.filterHeight,u.filterWidth],c):[[0,0],[0,0]];const h=1===c[0]&&1===c[1],[f,p]=function(e,t,n){const r=n.map(e=>e[0]),i=n.map(e=>e[1]),a=e.concat(r,i),o=t.map((e,t)=>(e-a[t]%e)%e),s=i.map((e,t)=>e+o[t]);return[t.map((e,t)=>[r[t],s[t]]),t.map((e,t)=>[0,o[t]])]}([u.inHeight,u.inWidth],c,d),m=h?r:"valid",g=h?s:fE(s,c,f),v=("avg"===n?()=>w_(g,t,a,m):()=>VS(g,t,a,m))(),y=h?v:A_(v,c,p);return l?nx(y,[y.shape[1],y.shape[2],y.shape[3]]):y}}),mE=By({prelu_:function(e,t){const n=Fy(e,"x","prelu"),r=Fy(t,"alpha","prelu");return Ay.runKernelFunc((e,t)=>{const i=e.prelu(n,r);return t([n,r]),i},{x:n,alpha:r},null,Vg)}}),gE=By({prod_:function(e,t=null,n=!1){let r=Fy(e,"x","prod");return"bool"===r.dtype&&(r=Pb(r,"int32")),Ay.runKernelFunc(e=>{const i=wp(t,r.shape),a=Kw(i,r.rank);let o=i,s=r;null!=a&&(s=ax(r,a),o=Jw(o.length,r.rank));let l=e.prod(s,o);if(n){const e=Yw(l.shape,i);l=nx(l,e)}return l},{x:r},null,qg,{axis:t,keepDims:n})}}),vE=By({rand_:function(e,t,n){const r=dp(e);let i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(let a=0;a<r;a++)i[a]=t();return Ay.makeTensor(i,e,n)}});var yE=n("YSVl");class bE{constructor(e,t,n,r,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const a=i||Math.random();this.random=yE.alea(a.toString())}nextValue(){if(!isNaN(this.nextVal)){const e=this.nextVal;return this.nextVal=NaN,e}let e,t,n=!1;for(;!n;){let r,i,a;do{r=2*this.random()-1,i=2*this.random()-1,a=r*r+i*i}while(a>=1||0===a);const o=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*r*o,t=this.mean+this.stdDev*i*o,this.truncated&&!this.isValidTruncated(e)||(n=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class xE{constructor(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;const i=r||Math.random();this.randu=yE.alea(i.toString()),this.randn=new bE(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,n,r,i,a;for(;;){do{r=this.randn.nextValue(),a=1+this.c*r}while(a<=0);if(a*=a*a,e=r*r,t=1-.331*e*e,n=.5*e+this.d*(1-a+Math.log(a)),i=this.randu(),i<t||Math.log(i)<n)break}return a*=1/this.beta*this.d,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)}convertValue(e){return"float32"===this.dtype?e:Math.round(e)}}class wE{constructor(e=0,t=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=yE.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}const _E=By({randomGamma_:function(e,t,n=1,r="float32",i){if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);const a=new xE(t,n,r,i),o=Rb(e,r);for(let s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),SE=By({randomNormal_:function(e,t=0,n=1,r,i){if(null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);const a=new bE(t,n,r,!1,i),o=Rb(e,r);for(let s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),EE=By({randomUniform_:function(e,t=0,n=1,r="float32",i){const a=Rb(e,r),o=new wE(t,n,null,i);for(let s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}});function TE(e,t){up(e);const n=Ry(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Uy(e,null,n,t)}function kE(e,t,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");return Ay.runKernelFunc(()=>{if(e===t||e<t&&n<0||t<e&&n>1)return YS([0],r);const i=Bp(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),i[0]=e;for(let e=1;e<i.length;e++)i[e]=i[e-1]+n;return TE(i,r)},{},null,Gg,{start:e,stop:t,step:n,dtype:r})}const CE=By({reciprocal_:function(e){const t=Fy(e,"x","reciprocal");return Ay.runKernelFunc((e,n)=>{const r=e.reciprocal(t);return n([t]),r},{x:t},null,Xg)}}),IE=By({relu_:function(e){const t=Fy(e,"x","relu");return Ay.runKernelFunc((e,n)=>(n([t]),"bool"===t.dtype?Pb(t,"int32"):e.relu(t)),{x:t},null,Kg)}}),OE=By({relu6_:function(e){const t=Fy(e,"x","relu6");return Ay.runKernelFunc((e,n)=>(n([t]),"bool"===t.dtype?Pb(t,"int32"):e.relu6(t)),{x:t},null,nv)}}),AE=By({reverse_:function(e,t){const n=Fy(e,"x","reverse");return Ay.runKernelFunc(e=>{const r=wp(t,n.shape);if(0===n.rank)return Fb(n);const i=e.reverse(n,r);return nx(i,n.shape)},{x:n},null,rv,{dims:t})}}),DE=By({reverse1d_:function(e){const t=Fy(e,"x","reverse");return sp(1===t.rank,()=>`Error in reverse1D: x must be rank 1 but got rank ${t.rank}.`),AE(t,0)}}),ME=By({reverse2d_:function(e,t){const n=Fy(e,"x","reverse");return sp(2===n.rank,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),AE(n,t)}}),NE=By({reverse3d_:function(e,t){const n=Fy(e,"x","reverse");return sp(3===n.rank,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),AE(n,t)}}),jE=By({reverse4d_:function(e,t){const n=Fy(e,"x","reverse");return sp(4===n.rank,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),AE(n,t)}}),RE=By({round_:function(e){const t=Fy(e,"x","round");return Ay.runKernelFunc(e=>e.round(t),{x:t},null,iv)}}),PE=By({rsqrt_:function(e){const t=Fy(e,"x","rsqrt");return Ay.runKernelFunc((e,n)=>{const r=e.rsqrt(t);return n([t]),r},{x:t},null,av)}}),FE=By({selu_:function(e){const t=Fy(e,"x","selu");return Ay.runKernelFunc((e,n)=>{const r=e.selu(t);return n([t]),r},{x:t},null,lv)}}),LE=By({separableConv2d_:function(e,t,n,r,i,a=[1,1],o="NHWC"){const s=Fy(e,"x","separableConv2d"),l=Fy(t,"depthwiseFilter","separableConv2d"),u=Fy(n,"pointwiseFilter","separableConv2d");let c=s,d=!1;if(3===s.rank&&(d=!0,c=nx(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");sp(4===c.rank,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),sp(4===l.rank,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),sp(4===u.rank,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),sp(1===u.shape[0],()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),sp(1===u.shape[1],()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const h=l.shape[2],f=l.shape[3];sp(u.shape[2]===h*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*f}, but got ${u.shape[2]}.`);const p=eS(c,l,r,i,o,a),m=H_(p,u,1,"valid",o);return d?nx(m,[m.shape[1],m.shape[2],m.shape[3]]):m}}),$E=async function(e,t){const n=Fy(e,"x","setdiff1d"),r=Fy(t,"y","setdiff1d");sp(n.dtype===r.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`),sp(1===n.rank,()=>`x should be 1D tensor, but got x (${n.shape}).`),sp(1===r.rank,()=>`y should be 1D tensor, but got y (${r.shape}).`);const i=await n.data(),a=await r.data(),o=new Set(a);let s=0;for(let c=0;c<i.length;c++)o.has(i[c])||s++;const l=new uy([s],n.dtype),u=new uy([s],"int32");for(let c=0,d=0;c<i.length;c++)o.has(i[c])||(l.values[d]=i[c],u.values[d]=c,d++);return[l.toTensor(),u.toTensor()]},BE=By({sign_:function(e){const t=Fy(e,"x","sign");return Ay.runKernelFunc(e=>e.sign(t),{x:t},null,hv)}}),zE=By({sin_:function(e){const t=Fy(e,"x","sin");return Ay.runKernelFunc((e,n)=>{const r=e.sin(t);return n([t]),r},{x:t},null,cv)}}),UE=By({sinh_:function(e){const t=Fy(e,"x","sinh");return Ay.runKernelFunc((e,n)=>{const r=e.sinh(t);return n([t]),r},{x:t},null,dv)}}),HE=By({slice1d_:function(e,t,n){const r=Fy(e,"x","slice1d");return sp(1===r.rank,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),C_(r,[t],[n])}}),WE=By({slice2d_:function(e,t,n){const r=Fy(e,"x","slice2d");return sp(2===r.rank,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),C_(r,t,n)}}),VE=By({slice3d_:function(e,t,n){const r=Fy(e,"x","slice3d");return sp(3===r.rank,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),C_(r,t,n)}}),qE=By({slice4d_:function(e,t,n){const r=Fy(e,"x","slice4d");return sp(4===r.rank,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),C_(r,t,n)}}),GE=By({softmax_:function(e,t=-1){const n=Fy(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);return Ay.runKernelFunc((e,r)=>{const i=e.softmax(n,t);return r([i]),i},{logits:n},null,bv,{dim:t})}}),YE=By({fft_:function(e){return sp("complex64"===e.dtype,()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`),Ay.runKernelFunc(t=>{const n=e.shape[e.shape.length-1],r=e.as2D(e.size/n,n);return t.fft(r).reshape(e.shape)},{input:e},null,Xm)}}),XE=By({ifft_:function(e){return sp("complex64"===e.dtype,()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`),Ay.runKernelFunc(t=>{const n=e.shape[e.shape.length-1],r=nx(e,[e.size/n,n]),i=t.ifft(r);return nx(i,e.shape)},{input:e},null,og)}}),KE=By({irfft_:function(e){const t=e.shape[e.shape.length-1],n=e.size/t;let r;if(t<=2){const i=nx(e,[n,t]);r=XE(i)}else{const i=[n,2*(t-1)],a=nx(aE(e),[n,t]),o=nx(SS(e),[n,t]),s=AE(C_(a,[0,1],[n,t-2]),1),l=pw(AE(C_(o,[0,1],[n,t-2]),1),Tw(-1)),u=T_([a,s],1),c=T_([o,l],1),d=nx(zy(u,c),[i[0],i[1]]);r=XE(d)}if(r=aE(r),3===e.rank&&0!==e.shape[0]){const t=r,n=e.shape[0];r=nx(r,[n,r.shape[0]/n,r.shape[1]]),t.dispose()}return r}});function ZE(e,t,n=0){let r=[];if("number"==typeof t)sp(e.shape[n]%t==0,()=>"Number of splits must evenly divide the axis."),r=new Array(t).fill(e.shape[n]/t);else{sp(t.reduce((e,t)=>(-1===t&&(e+=1),e),0)<=1,()=>"There should be only one negative value in split array.");const i=t.indexOf(-1);if(-1!==i){const r=t.reduce((e,t)=>t>0?e+t:e);t[i]=e.shape[n]-r}sp(e.shape[n]===t.reduce((e,t)=>e+t),()=>"The sum of sizes must match the size of the axis dimension."),r=t}return r}const JE=By({split_:function(e,t,n=0){const r=Fy(e,"x","split");return Ay.runKernelFunc((e,i)=>{const a=wp(n,r.shape)[0],o=ZE(r,t,a);return e.split(r,o,a)},{x:r},null,yv,{numOrSizeSplits:t,axis:n})}}),QE=By({rfft_:function(e,t){sp("float32"===e.dtype,()=>"The dtype for rfft() must be real value but got "+e.dtype);let n=e.shape[e.shape.length-1];const r=e.size/n;let i;if(null!=t&&t<n){const r=e.shape.map(e=>0),a=e.shape.map(e=>e);a[e.shape.length-1]=t,i=C_(e,r,a),n=t}else if(null!=t&&t>n){const r=e.shape.map(e=>e);r[e.shape.length-1]=t-n,i=T_([e,YS(r)],e.shape.length-1),n=t}else i=e;const a=vw(i),o=nx(zy(i,a),[r,n]),s=YE(o),l=Math.floor(n/2)+1,u=aE(s),c=SS(s),d=JE(u,[l,n-l],u.shape.length-1),h=JE(c,[l,n-l],c.shape.length-1),f=i.shape.slice();return f[i.shape.length-1]=l,nx(zy(d[0],h[0]),f)}}),eT=By({squaredDifference_:function(e,t){let n=Fy(e,"a","squaredDifference"),r=Fy(t,"b","squaredDifference");return[n,r]=Sy(n,r),Pw(n.shape,r.shape),Ay.runKernelFunc((e,t)=>{const i=e.squaredDifference(n,r);return t([n,r]),i},{a:n,b:r},null,xv,{})}}),tT=By({squeeze_:function(e,t){const n=Fy(e,"x","squeeze");return nx(n,_p(n.shape,t).newShape)}}),nT=By({stack_:function(e,t=0){const n=Ly(e,"tensors","stack");if(sp(n.length>=1,()=>"Pass at least one tensor to tf.stack"),1===n.length)return cS(n[0],t);const r=n[0].shape,i=n[0].dtype;sp(t<=n[0].rank,()=>"Axis must be <= rank of the tensor"),n.forEach(e=>{lp(r,e.shape,"All tensors passed to stack must have matching shapes"),sp(i===e.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=n.map(e=>cS(e,t));return T_(a,t)}}),rT=By({step_:function(e,t=0){const n=Fy(e,"x","step");return Ay.runKernelFunc(e=>e.step(n,t),{x:n},null,jv,{alpha:t})}}),iT=By({stridedSlice_:function(e,t,n,r,i=0,a=0,o=0,s=0,l=0){let u=Fy(e,"x","stridedSlice");return Ay.runKernelFunc(e=>{null==r&&(r=new Array(t.length));const c=gx(o);if(c.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==o&&0!==s)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==o&&0!==l)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");const d=u.rank-t.length,h=gx(s),f=u.shape.slice();h.forEach(e=>{t[e]=0,n[e]=1,f.splice(e,0,1)}),u=nx(u,f);const{begin:p,end:m,strides:g}=wx(u.shape,c,d,t,n,r,i,a,o);t=p,n=m,r=g;const v=gx(l);v.forEach(e=>{n[e]=t[e]+1,r[e]=1});const y=vx(t,n,r),b=y.filter((e,t)=>-1===v.indexOf(t));if(r.every(e=>1===e))return nx(C_(u,t,y),b);const x=e.stridedSlice(u,t,n,r);return nx(x,b)},{x:u},null,Ev,{begin:t,end:n,strides:r,beginMask:i,endMask:a,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:l})}}),aT=By({tan_:function(e){const t=Fy(e,"x","tan");return Ay.runKernelFunc((e,n)=>{const r=e.tan(t);return n([t]),r},{x:t},null,Tv)}});function oT(e,t,n){if(up(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");const r=Ry(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Uy(e,t,r,n)}function sT(e,t,n){if(up(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");const r=Ry(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Uy(e,t,r,n)}function lT(e,t,n){if(up(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");const r=Ry(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Uy(e,t,r,n)}function uT(e,t,n){if(up(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");const r=Ry(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Uy(e,t=t||r,r,n)}const cT=By({topk_:function(e,t=1,n=!0){const r=Fy(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const i=r.shape[r.shape.length-1];if(t>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got `+t);const a={x:r},o={k:t,sorted:n},[s,l]=Ay.runKernelFunc(e=>e.topk(r,t,n),a,null,Iv,o);return{values:s,indices:l}}}),dT=By({truncatedNormal_:function(e,t=0,n=1,r,i){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const a=new bE(t,n,r,!0,i),o=Rb(e,r);for(let s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),hT=By({unique_:function(e,t=0){const n=Fy(e,"x","unique",null);sp(n.rank>0,()=>"The input tensor must be at least 1D");const r={x:n},i={axis:t},[a,o]=Ay.runKernel(Av,r,i);return{values:a,indices:o}}}),fT=By({unsortedSegmentSum_:function(e,t,n){const r=Fy(e,"x","unsortedSegmentSum"),i=Fy(t,"segmentIds","unsortedSegmentSum","int32");return sp(pp(n),()=>"numSegments must be of dtype int"),Ay.runKernelFunc((e,t)=>{const a=e.unsortedSegmentSum(r,i,n);return t([i]),a},{x:r,segmentIds:i},null,Mv,{numSegments:n})}}),pT=By({unstack_:function(e,t=0){const n=Fy(e,"x","unstack");return sp(t>=-n.shape.length&&t<n.shape.length,()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`),t<0&&(t+=n.shape.length),Ay.runKernelFunc(e=>e.unstack(n,t),{value:n},null,Dv,{axis:t})}});function mT(e,t=!0,n,r){return Ay.makeVariable(e,t,n,r)}function gT(e,t){const n=[];for(let a=0;a<t.length;a++)t[a]&&n.push(a);const r=Rb(e,"int32"),i=Rb([n.length,e.length],"int32");for(let a=0;a<n.length;a++){const t=r.indexToLoc(n[a]);i.values.set(t,a*e.length)}return i.toTensor()}const vT=async function(e){const t=Fy(e,"condition","whereAsync","bool"),n=await t.data(),r=gT(t.shape,n);return e!==t&&t.dispose(),r},yT=async function(e,t,n){const r=Fy(e,"tensor","boolMask"),i=Fy(t,"mask","boolMask","bool"),a=null==n?0:n,o=i.rank,s=r.shape;sp(o>0,()=>"mask cannot be scalar"),lp(s.slice(a,a+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let m=a;m<a+o;m++)l*=s[m];const u=s.slice(0,a).concat([l],s.slice(a+o)),c=nx(r,u),d=nx(i,[-1]),h=await vT(d),f=tT(h,[1]),p=xS(c,f,a);return e!==r&&r.dispose(),t!==i&&i.dispose(),f.dispose(),c.dispose(),d.dispose(),h.dispose(),p},bT=By({equalStrict_:function(e,t){Gx("strict variants of ops have been deprecated and will be removed in future");const n=Fy(e,"a","equalStrict"),r=Fy(t,"b","equalStrict");return lp(n.shape,r.shape,"Error in equalStrict: "),rS(n,r)}}),xT=By({greaterEqualStrict_:function(e,t){Gx("strict variants of ops have been deprecated and will be removed in future");const n=Fy(e,"a","greaterEqualStrict"),r=Fy(t,"b","greaterEqualStrict");return lp(n.shape,r.shape,"Error in greaterEqualStrict: "),_S(n,r)}}),wT=By({greaterStrict_:function(e,t){Gx("strict variants of ops have been deprecated and will be removed in future");const n=Fy(e,"a","greaterStrict"),r=Fy(t,"b","greaterStrict");return lp(n.shape,r.shape,"Error in greaterStrict: "),wS(n,r)}}),_T=By({lessEqualStrict_:function(e,t){Gx("strict variants of ops have been deprecated and will be removed in future");const n=Fy(e,"a","lessEqualStrict"),r=Fy(t,"b","lessEqualStrict");return lp(n.shape,r.shape,"Error in lessEqualStrict: "),OS(n,r)}}),ST=By({lessStrict_:function(e,t){Gx("strict variants of ops have been deprecated and will be removed in future");const n=Fy(e,"a","lessStrict"),r=Fy(t,"b","lessStrict");return lp(n.shape,r.shape,"Error in lessStrict: "),IS(n,r)}}),ET=By({notEqualStrict_:function(e,t){Gx("strict variants of ops have been deprecated and will be removed in future");const n=Fy(e,"a","notEqualStrict"),r=Fy(t,"b","notEqualStrict");return lp(n.shape,r.shape,"Error in notEqualStrict: "),iE(n,r)}}),TT=By({addStrict_:function(e,t){Gx("strict variants of ops have been deprecated and will be removed in future");const n=Fy(e,"a","addStrict"),r=Fy(t,"b","addStrict");return lp(n.shape,r.shape,"Error in addStrict: "),dw(n,r)}}),kT=By({divStrict_:function(e,t){Gx("strict variants of ops have been deprecated and will be removed in future");const n=Fy(e,"a","div"),r=Fy(t,"b","div");return lp(n.shape,r.shape,"Error in divideStrict: "),fw(n,r)}}),CT=By({maximumStrict_:function(e,t){Gx("strict variants of ops have been deprecated and will be removed in future");const n=Fy(e,"a","maximumStrict"),r=Fy(t,"b","maximumStrict");return lp(n.shape,r.shape,"Error in maximumStrict: "),Fw(n,r)}}),IT=By({minimumStrict_:function(e,t){Gx("strict variants of ops have been deprecated and will be removed in future");const n=Fy(e,"a","minimumStrict"),r=Fy(t,"b","minimumStrict");return lp(n.shape,r.shape,"Error in minimumStrict: "),JS(n,r)}}),OT=By({modStrict_:function(e,t){Gx("strict variants of ops have been deprecated and will be removed in future");const n=Fy(e,"a","modStrict"),r=Fy(t,"b","modStrict");return lp(n.shape,r.shape,"Error in modStrict: "),eE(n,r)}}),AT=By({mulStrict_:function(e,t){Gx("strict variants of ops have been deprecated and will be removed in future");const n=Fy(e,"a","mul"),r=Fy(t,"b","mul");return lp(n.shape,r.shape,"Error in multiplyStrict: "),pw(n,r)}}),DT=By({powStrict_:function(e,t){return Gx("strict variants of ops have been deprecated and will be removed in future"),lp(e.shape,t.shape,"Error in powStrict: "),Aw(e,t)}}),MT=By({squaredDifferenceStrict_:function(e,t){Gx("strict variants of ops have been deprecated and will be removed in future");const n=Fy(e,"a","squaredDifferenceStrict"),r=Fy(t,"b","squaredDifferenceStrict");return lp(n.shape,r.shape,"Error in squaredDifferenceStrict: "),eT(n,r)}}),NT=By({subStrict_:function(e,t){Gx("strict variants of ops have been deprecated and will be removed in future");const n=Fy(e,"a","subStrict"),r=Fy(t,"b","subStrict");return lp(n.shape,r.shape,"Error in subStrict: "),Dw(n,r)}}),jT=By({norm_:function(e,t="euclidean",n=null,r=!1){const i=function e(t,n,r=null){if(0===t.rank)return Nw(t);if(1!==t.rank&&null===r)return e(nx(t,[-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return LS(Nw(t),r);if(n===1/0)return FS(Nw(t),r);if(n===-1/0)return ZS(Nw(t),r);if("euclidean"===n||2===n)return mw(LS(Aw(Nw(t),Tw(2,"int32")),r));throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return FS(LS(Nw(t),r[0]),r[1]-1);if(n===1/0)return FS(LS(Nw(t),r[1]),r[0]);if(n===-1/0)return ZS(LS(Nw(t),r[1]),r[0]);if("fro"===n||"euclidean"===n)return mw(LS(gw(t),r));throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=Fy(e,"x","norm"),t,n);let a=i.shape;if(r){const t=wp(n,e.shape);a=Yw(i.shape,t)}return nx(i,a)}}),RT=By({movingAverage_:function(e,t,n,r,i=!0){const a=Fy(e,"v","movingAverage"),o=Fy(t,"x","movingAverage"),s=Fy(n,"decay","movingAverage");Ey(a,o),sp(fp(a.shape,o.shape),()=>"Shape mismatch in v and x");const l=Tw(1),u=Dw(l,s);let c=pw(Dw(o,a),u);if(i){sp(null!=r,()=>"When using zeroDebias: true, step is required.");const e=Fy(r,"step","movingAverage");c=fw(c,Dw(l,Aw(s,e)))}return dw(a,c)}}),PT=By({scatterND_:function(e,t,n){const r=Fy(e,"indices","scatterND","int32"),i=Fy(t,"updates","scatterND");return fx(i,r,n),Ay.runKernelFunc(e=>e.scatterND(r,i,n),{indices:r,updates:i},null,ov,{shape:n})}}),FT=By({sparseToDense_:function(e,t,n,r=0){const i=Fy(e,"sparseIndices","sparseToDense","int32"),a=Fy(t,"sparseValues","sparseToDense"),o=Fy(r,"defaultValue","sparseToDense",a.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${e.shape}.`);const i=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${a}.`);if(0!==t.rank&&(1!==t.rank||t.size!==i))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${i}]`);if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,a,n,o),Ay.runKernelFunc(e=>e.sparseToDense(i,a,n,o),{sparseIndices:i,sparseValues:a,defaultValue:o},null,Sv,{outputShape:n})}}),LT=By({gatherND_:function(e,t){const n=Fy(t,"indices","gatherND","int32"),r=Fy(e,"x","gatherND");return Ay.runKernelFunc(e=>e.gatherND(r,n),{params:r,indices:n},null,ng)}}),$T=By({dropout_:function(e,t,n,r){const i=Fy(e,"x","dropout");if(sp("float32"===i.dtype,()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`),sp(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),0===t)return e instanceof fy?i.clone():i;const a=function(e,t){if(null==t)return e.shape.slice();if(fp(e.shape,t))return t;if(e.shape.length===t.length){const n=[];for(let r=0;r<e.shape.length;r++)n.push(null==t[r]&&null!=e.shape[r]?e.shape[r]:t[r]);return n}return t}(i,n),o=1-t,s=fw(pS(dw(EE(a,0,1,"float32",r),o)),o);return pw(i,s)}});function BT(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function zT(e,t,n){const r=1-e%2,i=new Float32Array(e);for(let a=0;a<e;++a){const o=2*Math.PI*a/(e+r-1);i[a]=t-n*Math.cos(o)}return TE(i,"float32")}const UT=async function(e,t,n=1){const r=Fy(e,"predictions","inTopK"),i=Fy(t,"targets","inTopK");sp(r.rank>1,()=>"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank),sp(r.rank-1===i.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${i.rank}`),lp(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const a=r.shape[r.shape.length-1];sp(n>0&&n<=a,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${a}), but got ${n}`);const o=await r.data(),s=await i.data(),[l,u]=[o.length/a,a],c=Sp("bool",l);for(let d=0;d<l;d++){const e=d*u,t=o.subarray(e,e+u),r=[];for(let n=0;n<t.length;n++)r.push({value:t[n],index:n});r.sort((e,t)=>t.value-e.value),c[d]=0;for(let i=0;i<n;i++)if(r[i].index===s[d]){c[d]=1;break}}return e!==r&&r.dispose(),t!==i&&i.dispose(),Hy(c,i.shape,"bool")},HT=By({conv2DBackpropFilter_:function(e,t,n,r,i,a="NHWC",o){let s=e;3===e.rank&&(s=nx(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=nx(t,[1,t.shape[0],t.shape[1],t.shape[2]])),sp(4===s.rank,()=>"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."),sp(4===l.rank,()=>"Error in conv2dDerFilter: dy must be rank 4, but got shape "+l.shape+"."),sp(4===n.length,()=>"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+".");const u="NHWC"===a?s.shape[3]:s.shape[1],c="NHWC"===a?l.shape[3]:l.shape[1];return sp(u===n[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${n[2]}.`),sp(c===n[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`),null!=o&&sp(pp(i),()=>`Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ${o} but got pad ${i}.`),Ay.runKernelFunc(e=>{const t=x_(a),u=d_(s.shape,n,r,1,i,o,!1,t);return e.conv2dDerFilter(s,l,u)},{x:s,dy:l},null,Tm,{strides:r,pad:i,dataFormat:a,dimRoundingMode:o,filterShape:n})}});function WT(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return pw(e,rT(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function VT(e,t){let n=t;const r=Rw(e.shape,t.shape);return r.length>0&&(n=LS(n,r)),nx(n,e.shape)}function qT(e,t,n){if("linear"===t)return e;if("relu"===t)return IE(e);if("elu"===t)return sS(e);if("relu6"===t)return OE(e);if("prelu"===t)return mE(e,n);throw new Error(`Unknown fused activation ${t}.`)}const GT=(e,t)=>!(e>0)||"linear"===t,YT=By({fusedConv2d_:function({x:e,filter:t,strides:n,pad:r,dataFormat:i="NHWC",dilations:a=[1,1],dimRoundingMode:o,bias:s,activation:l="linear",preluActivationWeights:u}){if(!1===GT(Ay.state.gradientDepth,l=l||"linear")){let c=H_(e,t,n,r,i,a,o);return null!=s&&(c=dw(c,s)),qT(c,l,u)}const c=Fy(e,"x","conv2d"),d=Fy(t,"filter","conv2d");let h=c,f=!1;3===c.rank&&(f=!0,h=nx(c,[1,c.shape[0],c.shape[1],c.shape[2]])),sp(4===h.rank,()=>"Error in fused conv2d: input must be rank 4, but got rank "+h.rank+"."),sp(4===d.rank,()=>"Error in fused conv2d: filter must be rank 4, but got rank "+d.rank+"."),null!=o&&sp(pp(r),()=>`Error in fused conv2d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`),sp(h.shape[3]===d.shape[2],()=>`Error in conv2d: depth of input (${h.shape[3]}) must match input depth for filter ${d.shape[2]}.`),sp(b_(n,a),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`),sp("NHWC"===i,()=>`Error in conv2d: got dataFormat of ${i} but only NHWC is currently supported.`);const p=d_(h.shape,d.shape,n,a,r,o);let m,g;null!=s&&(m=Fy(s,"bias","fused conv2d"),[m]=Sy(m,c),Pw(p.outShape,m.shape)),null!=u&&(g=Fy(u,"prelu weights","fused conv2d"));const v=(e,t)=>{const[i,o,s,u]=t,c=WT(e,s,l);sp(y_(a),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${a}'`);const d=[V_(o.shape,c,i,n,r),HT(o,c,i.shape,n,r)];if(null!=u){const e=VT(u,c);d.push(e)}return d},y=e=>e.fusedConv2d({input:h,filter:d,convInfo:p,bias:m,activation:l,preluActivationWeights:g}),b={x:h,filter:d,bias:m,preluActivationWeights:g},x={strides:n,pad:r,dataFormat:i,dilations:a,dimRoundingMode:o,activation:l};return null==s?Sw((e,t,n)=>{let r=Ay.runKernelFunc(y,b,null,Lv,x);return n([t,e,r]),f&&(r=nx(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:v}})(h,d):Sw((e,t,n,r)=>{let i=Ay.runKernelFunc(y,b,null,Lv,x);return r([t,e,i,n]),f&&(i=nx(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:v}})(h,d,m)}}),XT=By({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,i,a=[1,1],o){let s=e;3===e.rank&&(s=nx(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;return 3===l.rank&&(l=nx(t,[1,t.shape[0],t.shape[1],t.shape[2]])),Ay.runKernelFunc(t=>{const u=d_(e.shape,n,r,a,i,o,!0);return t.depthwiseConv2DDerFilter(s,l,u)},{x:s,dy:l},null,Pm,{strides:r,pad:i,dimRoundingMode:o,dilations:a,filterShape:n})}}),KT=By({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,i,a=[1,1],o){let s=t,l=!1;3===t.rank&&(l=!0,s=nx(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const u=Ay.runKernelFunc(t=>{const l=d_(e,n.shape,r,a,i,o,!0);return t.depthwiseConv2DDerInput(s,n,l)},{dy:s,filter:n},null,Fm,{strides:r,pad:i,dimRoundingMode:o,dilations:a,inputShape:e});return l?nx(u,[u.shape[1],u.shape[2],u.shape[3]]):u}}),ZT=By({fusedDepthwiseConv2d_:function({x:e,filter:t,strides:n,pad:r,dataFormat:i="NHWC",dilations:a=[1,1],dimRoundingMode:o,bias:s,activation:l="linear",preluActivationWeights:u}){if(!1===GT(Ay.state.gradientDepth,l)){let c=eS(e,t,n,r,i,a,o);return null!=s&&(c=dw(c,s)),qT(c,l,u)}const c=Fy(e,"x","depthwiseConv2d"),d=Fy(t,"filter","depthwiseConv2d");let h=c,f=!1;3===c.rank&&(f=!0,h=nx(c,[1,c.shape[0],c.shape[1],c.shape[2]])),sp(4===h.rank,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${h.rank}.`),sp(4===d.rank,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${d.rank}.`),sp(h.shape[3]===d.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${h.shape[3]}) must match the inChannels dimension in filter ${d.shape[2]}.`),null==a&&(a=[1,1]),sp(b_(n,a),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`),null!=o&&sp(pp(r),()=>`Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode ${o} but got pad ${r}.`);const p=d_(h.shape,d.shape,n,a,r,o,!0);let m,g;null!=s&&(m=Fy(s,"bias","fused conv2d"),[m]=Sy(m,c),Pw(p.outShape,m.shape)),null!=u&&(g=Fy(u,"prelu weights","fused depthwiseConv2d"));const v=(e,t)=>{sp(y_(a),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[i,s,u,c]=t,d=WT(e,u,l),h=KT(s.shape,d,i,n,r,a,o),f=XT(s,d,i.shape,n,r,a,o);return null!=c?[h,f,VT(m,d)]:[h,f]},y=e=>e.fusedDepthwiseConv2D({input:h,filter:d,convInfo:p,bias:m,activation:l,preluActivationWeights:g}),b={x:h,filter:d,bias:m,preluActivationWeights:g},x={strides:n,pad:r,dataFormat:i,dilations:a,dimRoundingMode:o,activation:l};return null==s?Sw((e,t,n)=>{let r=Ay.runKernelFunc(y,b,null,$v,x);return n([t,e,r]),f&&(r=nx(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:v}})(h,d):Sw((e,t,n,r)=>{let i=Ay.runKernelFunc(y,b,null,$v,x);return r([t,e,i,n]),f&&(i=nx(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:v}})(h,d,m)}}),JT=By({fusedMatMul_:function({a:e,b:t,transposeA:n=!1,transposeB:r=!1,bias:i,activation:a="linear",preluActivationWeights:o}){if(!1===GT(Ay.state.gradientDepth,a)){let s=rx(e,t,n,r);return null!=i&&(s=dw(s,i)),qT(s,a,o)}let s=Fy(e,"a","fused matMul"),l=Fy(t,"b","fused matMul");[s,l]=Sy(s,l);const u=n?s.shape[s.rank-2]:s.shape[s.rank-1],c=r?l.shape[l.rank-1]:l.shape[l.rank-2],d=n?s.shape[s.rank-1]:s.shape[s.rank-2],h=r?l.shape[l.rank-2]:l.shape[l.rank-1],f=s.shape.slice(0,-2),p=l.shape.slice(0,-2),m=dp(f),g=dp(p);sp(s.rank>=2&&l.rank>=2&&s.rank===l.rank,()=>`Error in fused matMul: inputs must have the same rank of at least 2, got ranks ${s.rank} and ${l.rank}.`),sp(fp(f,p),()=>`Error in fused matMul: outer dimensions (${f}) and (${p}) of Tensors with shapes ${s.shape} and `+l.shape+" must match."),sp(u===c,()=>`Error in fused matMul: inner shapes (${u}) and (${c}) of Tensors with shapes ${s.shape} and ${l.shape} and transposeA=${n} and transposeB=${r} must match.`);const v=s.shape.slice(0,-2).concat([d,h]),y=nx(s,n?[m,u,d]:[m,d,u]),b=nx(l,r?[g,h,c]:[g,c,h]);let x,w;null!=i&&(x=Fy(i,"bias","fused matMul"),[x]=Sy(x,s),Pw(v,x.shape)),null!=o&&(w=Fy(o,"prelu weights","fused matMul"));const _=(e,t)=>{const[o,s,l,u]=t,c=WT(nx(e,l.shape),l,a);let d,h;return n||r?!n&&r?(d=rx(c,s,!1,!1),h=rx(c,o,!0,!1)):n&&!r?(d=rx(s,c,!1,!0),h=rx(o,c,!1,!1)):(d=rx(s,c,!0,!0),h=rx(c,o,!0,!0)):(d=rx(c,s,!1,!0),h=rx(o,c,!0,!1)),null!=i?[d,h,VT(u,c)]:[d,h]},S=e=>e.fusedBatchMatMul({a:y,b:b,transposeA:n,transposeB:r,bias:x,activation:a,preluActivationWeights:w}),E={a:y,b:b,bias:x,preluActivationWeights:w},T={transposeA:n,transposeB:r,activation:a};return null==i?Sw((e,t,n)=>{const r=Ay.runKernelFunc(S,E,null,Fv,T);return n([e,t,r]),{value:nx(r,v),gradFunc:_}})(y,b):Sw((e,t,n,r)=>{const i=Ay.runKernelFunc(S,E,null,Fv,T);return r([e,t,i,n]),{value:nx(i,v),gradFunc:_}})(y,b,x)}}),QT=By({hammingWindow_:function(e){return zT(e,.54,.46)}}),ek=By({hannWindow_:function(e){return zT(e,.5,.5)}}),tk=By({frame_:function(e,t,n,r=!1,i=0){let a=0;const o=[];for(;a+t<=e.size;)o.push(C_(e,a,t)),a+=n;if(r)for(;a<e.size;){const r=a+t-e.size,s=T_([C_(e,a,t-r),Iw([r],i)]);o.push(s),a+=n}return 0===o.length?oT([],[0,t]):nx(T_(o),[o.length,t])}}),nk=By({stft_:function(e,t,n,r,i=ek){null==r&&(r=BT(t));const a=tk(e,t,n),o=pw(a,i(t)),s=[];for(let l=0;l<a.shape[0];l++)s.push(QE(C_(o,[l,0],[1,t]),r));return T_(s)}}),rk=By({cropAndResize_:function(e,t,n,r,i,a){const o=Fy(e,"image","cropAndResize"),s=Fy(t,"boxes","cropAndResize","float32"),l=Fy(n,"boxInd","cropAndResize","int32");i=i||"bilinear",a=a||0;const u=s.shape[0];return sp(4===o.rank,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),sp(2===s.rank&&4===s.shape[1],()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${s.shape}.`),sp(1===l.rank&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${s.shape}.`),sp(2===r.length,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),sp(r[0]>=1&&r[1]>=1,()=>"cropSize must be atleast [1,1], but was "+r),sp("bilinear"===i||"nearest"===i,()=>"method must be bilinear or nearest, but was "+i),Ay.runKernelFunc(e=>e.cropAndResize(o,s,l,r,i,a),{image:o,boxes:s,boxInd:l},null,Nm,{method:i,extrapolationValue:a,cropSize:r})}}),ik=By({flipLeftRight_:function(e){const t=Fy(e,"image","flipLeftRight","float32");return sp(4===t.rank,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`),Ay.runKernel(Zm,{image:t},{})}}),ak=By({rotateWithOffset_:function(e,t,n=0,r=.5){const i=Fy(e,"image","rotateWithOffset","float32");return sp(4===i.rank,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`),Ay.runKernel(Pv,{image:i},{radians:t,fillValue:n,center:r})}});function ok(e,t,n,r,i,a){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==a&&(a=0);const o=e.shape[0];return n=Math.min(n,o),sp(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),sp(2===e.rank,()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`),sp(4===e.shape[1],()=>"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]),sp(1===t.rank,()=>"scores must be a 1D tensor"),sp(t.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was `+t.shape[0]),sp(0<=a&&a<=1,()=>`softNmsSigma must be in [0, 1], but was '${a}'`),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:a}}const sk=By({nonMaxSuppression_:function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY){const a=Fy(e,"boxes","nonMaxSuppression"),o=Fy(t,"scores","nonMaxSuppression"),s=ok(a,o,n,r,i);return Ay.runKernelFunc(e=>e.nonMaxSuppression(a,o,n,r,i),{boxes:a,scores:o},null,Fg,{maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:i=s.scoreThreshold})}});function lk(e,t,n){const r=function(e,t,n){return function(e,t,n){let r=0,i=e.length,a=0,o=!1;for(;r<i;){a=r+(i-r>>>1);const s=n(t,e[a]);s>0?r=a+1:(i=a,o=!s)}return o?r:-r-1}(e,t,n||uk)}(e,t,n);e.splice(r<0?-(r+1):r,0,t)}function uk(e,t){return e>t?1:e<t?-1:0}function ck(e,t,n,r,i){return fk(e,t,n,r,i,0).selectedIndices}function dk(e,t,n,r,i,a){return fk(e,t,n,r,i,0,!1,a,!0)}function hk(e,t,n,r,i,a){return fk(e,t,n,r,i,a,!0)}function fk(e,t,n,r,i,a,o=!1,s=!1,l=!1){const u=[];for(let g=0;g<t.length;g++)t[g]>i&&u.push({score:t[g],boxIndex:g,suppressBeginIndex:0});u.sort(gk);const c=a>0?-.5/a:0,d=[],h=[];for(;d.length<n&&u.length>0;){const t=u.pop(),{score:n,boxIndex:a,suppressBeginIndex:o}=t;if(n<i)break;let s=!1;for(let l=d.length-1;l>=o;--l){const n=pk(e,a,d[l]);if(n>=r){s=!0;break}if(t.score=t.score*mk(r,c,n),t.score<=i)break}t.suppressBeginIndex=d.length,s||(t.score===n?(d.push(a),h.push(t.score)):t.score>i&&lk(u,t,gk))}const f=d.length,p=n-f;s&&p>0&&(d.push(...new Array(p).fill(0)),h.push(...new Array(p).fill(0)));const m={selectedIndices:TE(d,"int32")};return o&&(m.selectedScores=TE(h,"float32")),l&&(m.validOutputs=Tw(f,"int32")),m}function pk(e,t,n){const r=e.subarray(4*t,4*t+4),i=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),u=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),d=Math.max(i[0],i[2]),h=Math.max(i[1],i[3]),f=(s-a)*(l-o),p=(d-u)*(h-c);if(f<=0||p<=0)return 0;const m=Math.max(a,u),g=Math.max(o,c),v=Math.min(s,d),y=Math.min(l,h),b=Math.max(v-m,0)*Math.max(y-g,0);return b/(f+p-b)}function mk(e,t,n){const r=Math.exp(t*n*n);return n<=e?r:0}function gk(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}const vk=By({nonMaxSuppressionWithScore_:function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,a=0){const o=Fy(e,"boxes","nonMaxSuppression"),s=Fy(t,"scores","nonMaxSuppression"),l=ok(o,s,n,r,i,a),u=Ay.runKernel($g,{boxes:o,scores:s},{maxOutputSize:n=l.maxOutputSize,iouThreshold:r=l.iouThreshold,scoreThreshold:i=l.scoreThreshold,softNmsSigma:a=l.softNmsSigma});return{selectedIndices:u[0],selectedScores:u[1]}}}),yk=By({nonMaxSuppressionPadded_:function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,a=!1){const o=Fy(e,"boxes","nonMaxSuppression"),s=Fy(t,"scores","nonMaxSuppression"),l=ok(o,s,n,r,i,null),u=Ay.runKernel(Lg,{boxes:o,scores:s},{maxOutputSize:l.maxOutputSize,iouThreshold:l.iouThreshold,scoreThreshold:l.scoreThreshold,padToMaxOutputSize:a});return{selectedIndices:u[0],validOutputs:u[1]}}}),bk=By({resizeBilinear_:function(e,t,n=!1){const r=Fy(e,"images","resizeBilinear");sp(3===r.rank||4===r.rank,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),sp(2===t.length,()=>"Error in resizeBilinear: new shape must 2D, but got shape "+t+".");let i=r,a=!1;3===r.rank&&(a=!0,i=nx(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const[o,s]=t,l=Ay.runKernelFunc((e,t)=>(t([i]),e.resizeBilinear(i,o,s,n)),{images:i},null,ev,{alignCorners:n,size:t});return a?nx(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),xk=By({resizeNearestNeighbor_:function(e,t,n=!1){const r=Fy(e,"images","resizeNearestNeighbor");sp(3===r.rank||4===r.rank,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),sp(2===t.length,()=>"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."),sp("float32"===r.dtype||"int32"===r.dtype,()=>"`images` must have `int32` or `float32` as dtype");let i=r,a=!1;3===r.rank&&(a=!0,i=nx(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const[o,s]=t,l=Ay.runKernelFunc((e,t)=>(t([i]),e.resizeNearestNeighbor(i,o,s,n)),{images:i},null,Jg,{alignCorners:n,size:t});return a?nx(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),wk=By({bandPart_:function(e,t,n){sp(t%1==0,()=>`bandPart(): numLower must be an integer, got ${t}.`),sp(n%1==0,()=>`bandPart(): numUpper must be an integer, got ${n}.`);const r=Fy(e,"a","bandPart");sp(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const i=r.shape,[a,o]=r.shape.slice(-2);if(!(t<=a))throw new Error(`bandPart(): numLower (${t}) must not be greater than the number of rows (${a}).`);if(!(n<=o))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`);t<0&&(t=a),n<0&&(n=o);const s=nx(kE(0,a,1,"int32"),[-1,1]),l=kE(0,o,1,"int32"),u=Dw(s,l),c=zS(OS(u,Tw(+t,"int32")),_S(u,Tw(-n,"int32"))),d=YS([a,o],r.dtype);return nx(nT(pT(nx(r,[-1,a,o])).map(e=>iS(c,e,d))),i)}}),_k=By({gramSchmidt_:function(e){let t;if(Array.isArray(e)){t=!1,sp(null!=e&&e.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const n=e[0].shape[0];for(let t=1;t<e.length;++t)sp(e[t].shape[0]===n,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${e[t].shape[0]} vs. ${n})`)}else t=!0,e=JE(e,e.shape[0],0).map(e=>tT(e,[0]));sp(e.length<=e[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${e.length}) exceeds number of dimensions (${e[0].shape[0]}).`);const n=[],r=e;for(let i=0;i<e.length;++i)n.push(Ay.tidy(()=>{let e=r[i];if(i>0)for(let t=0;t<i;++t){const r=pw(LS(pw(n[t],e)),n[t]);e=Dw(e,r)}return fw(e,jT(e,"euclidean"))}));return t?nT(n,0):n}});function Sk(e,t=!1){return Ay.tidy(()=>{sp(2===e.shape.length,()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`);const n=e.shape[0],r=e.shape[1];let i=fS(n),a=Fb(e);const o=oT([[1]],[1,1]);let s=Fb(o);const l=n>=r?r:n;for(let e=0;e<l;++e){const t=a,l=s,u=i;[s,a,i]=Ay.tidy(()=>{const t=C_(a,[e,e],[n-e,1]),l=jT(t),u=C_(a,[e,e],[1,1]),c=iS(wS(u,0),oT([[-1]]),oT([[1]])),d=Dw(u,pw(c,l)),h=fw(t,d);s=1===h.shape[0]?Fb(o):T_([o,C_(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);const f=jS(fw(rx(c,d),l)),p=C_(a,[e,0],[n-e,r]),m=pw(f,s),g=ax(s);if(0===e)a=Dw(p,rx(m,rx(g,p)));else{const t=Dw(p,rx(m,rx(g,p)));a=T_([C_(a,[0,0],[e,r]),t],0)}const v=ax(m),y=C_(i,[0,e],[n,i.shape[1]-e]);if(0===e)i=Dw(y,rx(rx(y,s),v));else{const t=Dw(y,rx(rx(y,s),v));i=T_([C_(i,[0,0],[n,e]),t],1)}return[s,a,i]}),Qx([t,l,u])}return!t&&n>r&&(i=C_(i,[0,0],[n,r]),a=C_(a,[0,0],[r,r])),[i,a]})}const Ek=By({qr_:function(e,t=!1){if(sp(e.rank>=2,()=>"qr() requires input tensor to have a rank >= 2, but got rank "+e.rank),2===e.rank)return Sk(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce((e,t)=>e*t),r=pT(nx(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],a=[];return r.forEach(e=>{const[n,r]=Sk(e,t);i.push(n),a.push(r)}),[nx(nT(i,0),e.shape),nx(nT(a,0),e.shape)]}}});var Tk;!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Tk||(Tk={}));const kk=By({computeWeightedLoss_:function(e,t,n=Tk.SUM_BY_NONZERO_WEIGHTS){const r=Fy(e,"losses","computeWeightedLoss");let i=null;null!=t&&(i=Fy(t,"weights","computeWeightedLoss"));const a=null==i?r:pw(r,i);if(n===Tk.NONE)return a;if(n===Tk.SUM)return LS(a);if(n===Tk.MEAN){if(null==i)return KS(a);{const e=r.size/i.size,t=fw(LS(a),LS(i));return e>1?fw(t,Tw(e)):t}}if(n===Tk.SUM_BY_NONZERO_WEIGHTS){if(null==i)return fw(LS(a),Tw(r.size));{const e=pw(i,XS(r.shape)),t=Pb(LS(iE(e,Tw(0))),"float32");return fw(LS(a),t)}}throw Error("Unknown reduction: "+n)}}),Ck=By({absoluteDifference_:function(e,t,n,r=Tk.SUM_BY_NONZERO_WEIGHTS){const i=Fy(e,"labels","absoluteDifference"),a=Fy(t,"predictions","absoluteDifference");let o=null;null!=n&&(o=Fy(n,"weights","absoluteDifference")),lp(i.shape,a.shape,"Error in absoluteDifference: ");const s=Nw(Dw(i,a));return kk(s,o,r)}}),Ik=By({cosineDistance_:function(e,t,n,r,i=Tk.SUM_BY_NONZERO_WEIGHTS){const a=Fy(e,"labels","cosineDistance"),o=Fy(t,"predictions","cosineDistance");let s=null;null!=r&&(s=Fy(r,"weights","cosineDistance")),lp(a.shape,o.shape,"Error in cosineDistance: ");const l=Tw(1),u=Dw(l,LS(pw(a,o),n,!0));return kk(u,s,i)}}),Ok=By({hingeLoss_:function(e,t,n,r=Tk.SUM_BY_NONZERO_WEIGHTS){let i=Fy(e,"labels","hingeLoss");const a=Fy(t,"predictions","hingeLoss");let o=null;null!=n&&(o=Fy(n,"weights","hingeLoss")),lp(i.shape,a.shape,"Error in hingeLoss: ");const s=Tw(1);i=Dw(pw(Tw(2),i),s);const l=IE(Dw(s,pw(i,a)));return kk(l,o,r)}}),Ak=By({huberLoss_:function(e,t,n,r=1,i=Tk.SUM_BY_NONZERO_WEIGHTS){const a=Fy(e,"labels","huberLoss"),o=Fy(t,"predictions","huberLoss");let s=null;null!=n&&(s=Fy(n,"weights","huberLoss")),lp(a.shape,o.shape,"Error in huberLoss: ");const l=Tw(r),u=Nw(Dw(o,a)),c=JS(u,l),d=Dw(u,c),h=dw(pw(Tw(.5),gw(c)),pw(l,d));return kk(h,s,i)}}),Dk=By({logLoss_:function(e,t,n,r=1e-7,i=Tk.SUM_BY_NONZERO_WEIGHTS){const a=Fy(e,"labels","logLoss"),o=Fy(t,"predictions","logLoss");let s=null;null!=n&&(s=Fy(n,"weights","logLoss")),lp(a.shape,o.shape,"Error in logLoss: ");const l=Tw(1),u=Tw(r),c=jS(pw(a,MS(dw(o,u)))),d=pw(Dw(l,a),MS(dw(Dw(l,o),u))),h=Dw(c,d);return kk(h,s,i)}}),Mk=By({meanSquaredError_:function(e,t,n,r=Tk.SUM_BY_NONZERO_WEIGHTS){const i=Fy(e,"labels","meanSquaredError"),a=Fy(t,"predictions","meanSquaredError");let o=null;null!=n&&(o=Fy(n,"weights","meanSquaredError")),lp(i.shape,a.shape,"Error in meanSquaredError: ");const s=eT(i,a);return kk(s,o,r)}}),Nk=By({sigmoidCrossEntropy_:function(e,t,n,r=0,i=Tk.SUM_BY_NONZERO_WEIGHTS){let a=Fy(e,"multiClassLabels","sigmoidCrossEntropy");const o=Fy(t,"logits","sigmoidCrossEntropy");let s=null;if(null!=n&&(s=Fy(n,"weights","sigmoidCrossEntropy")),lp(a.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){const e=Tw(r),t=Tw(1),n=Tw(.5);a=dw(pw(a,Dw(t,e)),pw(n,e))}const l=function(e,t){const n=Fy(e,"labels","sigmoidCrossEntropyWithLogits"),r=Fy(t,"logits","sigmoidCrossEntropyWithLogits");lp(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const i=IE(r),a=pw(r,n),o=NS(uS(jS(Nw(r))));return dw(Dw(i,a),o)}(a,o);return kk(l,s,i)}}),jk=By({softmaxCrossEntropy_:function(e,t,n,r=0,i=Tk.SUM_BY_NONZERO_WEIGHTS){let a=Fy(e,"onehotLabels","softmaxCrossEntropy");const o=Fy(t,"logits","softmaxCrossEntropy");let s=null;if(null!=n&&(s=Fy(n,"weights","softmaxCrossEntropy")),lp(a.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){const e=Tw(r),t=Tw(1),n=Tw(a.shape[1]);a=dw(pw(a,Dw(t,e)),fw(e,n))}const l=function(e,t,n=-1){if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was `+n);return Sw((e,t,r)=>{const i=BS(t,[n],!0),a=Dw(Pb(t,"float32"),i);r([e,a]);const o=jS(pw(a,e));return{value:LS(o,[n]),gradFunc:(e,t)=>{const[r,i]=t,a=Yw(e.shape,[n]);return[pw(nx(e,a),Dw(Pb(r,"float32"),uS(i))),pw(nx(e,a),Dw(uS(i),Pb(r,"float32")))]}}})(e,t)}(a,o);return kk(l,s,i)}}),Rk={fft:YE,ifft:XE,rfft:QE,irfft:KE},Pk={hammingWindow:QT,hannWindow:ek,frame:tk,stft:nk},Fk={flipLeftRight:ik,resizeNearestNeighbor:xk,resizeBilinear:bk,rotateWithOffset:ak,cropAndResize:rk,nonMaxSuppression:sk,nonMaxSuppressionAsync:async function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY){const a=Fy(e,"boxes","nonMaxSuppressionAsync"),o=Fy(t,"scores","nonMaxSuppressionAsync"),s=ok(a,o,n,r,i);n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold;const l=await Promise.all([a.data(),o.data()]),u=ck(l[0],l[1],n,r,i);return a!==e&&a.dispose(),o!==t&&o.dispose(),u},nonMaxSuppressionWithScore:vk,nonMaxSuppressionWithScoreAsync:async function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,a=0){const o=Fy(e,"boxes","nonMaxSuppressionAsync"),s=Fy(t,"scores","nonMaxSuppressionAsync"),l=ok(o,s,n,r,i,a);n=l.maxOutputSize,r=l.iouThreshold,i=l.scoreThreshold,a=l.softNmsSigma;const u=await Promise.all([o.data(),s.data()]),c=hk(u[0],u[1],n,r,i,a);return o!==e&&o.dispose(),s!==t&&s.dispose(),c},nonMaxSuppressionPadded:yk,nonMaxSuppressionPaddedAsync:async function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,a=!1){const o=Fy(e,"boxes","nonMaxSuppressionAsync"),s=Fy(t,"scores","nonMaxSuppressionAsync"),l=ok(o,s,n,r,i,null),u=l.maxOutputSize,c=l.iouThreshold,d=l.scoreThreshold,[h,f]=await Promise.all([o.data(),s.data()]),p=dk(h,f,u,c,d,a);return o!==e&&o.dispose(),s!==t&&s.dispose(),p}},Lk={bandPart:wk,gramSchmidt:_k,qr:Ek},$k={absoluteDifference:Ck,computeWeightedLoss:kk,cosineDistance:Ik,hingeLoss:Ok,huberLoss:Ak,logLoss:Dk,meanSquaredError:Mk,sigmoidCrossEntropy:Nk,softmaxCrossEntropy:jk};class Bk{static sgd(e){return new $w(e)}static momentum(e,t,n=!1){return new Bw(e,t,n)}static rmsprop(e,t=.9,n=0,r=null,i=!1){return new zw(e,t,n,r,i)}static adam(e=.001,t=.9,n=.999,r=null){return new Mw(e,t,n,r)}static adadelta(e=.001,t=.95,n=null){return new Cw(e,t,n)}static adamax(e=.002,t=.9,n=.999,r=null,i=0){return new Lw(e,t,n,r,i)}static adagrad(e,t=.1){return new Ow(e,t)}}const zk={sgd:Bk.sgd,momentum:Bk.momentum,adadelta:Bk.adadelta,adagrad:Bk.adagrad,rmsprop:Bk.rmsprop,adamax:Bk.adamax,adam:Bk.adam},Uk="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:e=>e();function Hk(){return new Promise(e=>Uk(()=>e()))}function Wk(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function Vk(e,t,n,r=!0){let i=[];if(r)i=i.concat(t.slice(0)),i.push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);const n=t.length;for(let r=0;r<n;++r)i=i.concat([e[r+1]/t[r],t[r]]);i=i.concat(e.slice(n+1))}return i}function qk(e,t,n=!0){const r=[];if(n){r.push(t);for(let n=t+1;n<e;++n)n<=2*t?(r.push(n),r.push(n-(t+1))):r.push(n)}else{const n=[],i=[];for(let r=1;r<e;++r)r>=2*t+1||r%2==1?i.push(r):n.push(r);r.push(...n),r.push(0),r.push(...i)}return r}function Gk(e,t,n,r=!0){const i=[];i.push(r?e[0]/n:e[0]*n);for(let a=1;a<e.length;++a)i.push(a<=t.length?r?t[a-1]*e[a]:e[a]/t[a-1]:e[a]);return i}function Yk(e,t){const n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function Xk(e,t,n){const r=e.slice(0,1);for(let i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}const Kk=1.7580993408473768,Zk=1.0507009873554805,Jk=.3275911,Qk=.254829592,eC=-.284496736,tC=1.421413741,nC=-1.453152027,rC=1.061405429;function iC(...e){Gp().getBool("IS_TEST")||console.warn(...e)}function aC(...e){Gp().getBool("IS_TEST")||console.log(...e)}function oC(e,t){if(e.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);const n=new Float32Array(2*e.length);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function sC(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function lC(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let i=0;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}function uC(e){const t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let i=2;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}function cC(e,t){return{real:e[2*t],imag:e[2*t+1]}}function dC(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function hC(e,t){const n=new Float32Array(e/2),r=new Float32Array(e/2);for(let i=0;i<Math.ceil(e/2);i++){const a=(t?2:-2)*Math.PI*(i/e);n[i]=Math.cos(a),r[i]=Math.sin(a)}return{real:n,imag:r}}function fC(e,t,n){const r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function pC(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();const t=YS(e.shape),r=Pb(e,"float32"),i=n.complex(r,t);return t.dispose(),r.dispose(),i}if(!Cp(e.dtype,t))return Ay.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){const r=n.real(e),i=Pb(r,t);return r.dispose(),i}if("int32"===t)return n.int(e);if("bool"===t){const t=Tw(0,e.dtype),r=n.notEqual(e,t);return t.dispose(),r}throw new Error(`Error in Cast: failed to cast ${e.dtype} to ${t}`)}function mC(e,t){return Ay.makeTensorFromDataId(e.dataId,t,e.dtype)}function gC(e,t,n){const r=(t-e)/(n-1),i=Bp(n,"float32");i[0]=e;for(let a=1;a<i.length;a++)i[a]=i[a-1]+r;return TE(i,"float32")}function vC(e,t,n){const r=new Array(e.rank).fill(0),i=e.shape.slice();return t.map(t=>{const a=[...i];a[n]=t;const o=C_(e,r,a);return r[n]+=t,o})}function yC(e,t){const n=new Array(e.rank);for(let i=0;i<n.length;i++)n[i]=e.shape[i]*t[i];const r=Rb(n,e.dtype);for(let i=0;i<r.values.length;++i){const t=r.indexToLoc(i),n=new Array(e.rank);for(let r=0;r<n.length;r++)n[r]=t[r]%e.shape[r];const a=e.locToIndex(n);r.values[i]=e.values[a]}return r.toTensor()}function bC(e,t,n,r,i){const a=t[t.length-1],[o,s]=[e.length/a,a],l=Sp(n,o*r),u=Sp("int32",o*r);for(let d=0;d<o;d++){const t=d*s,n=e.subarray(t,t+s),i=[];for(let e=0;e<n.length;e++)i.push({value:n[e],index:e});i.sort((e,t)=>t.value-e.value);const a=d*r,o=l.subarray(a,a+r),c=u.subarray(a,a+r);for(let e=0;e<r;e++)o[e]=i[e].value,c[e]=i[e].index}const c=t.slice();return c[c.length-1]=r,[Hy(l,c,n),Hy(u,c,"int32")]}const xC={kernelName:Jp,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>pw(e,rT(Pb(n,"float32"),-1))}}},wC={kernelName:Qp,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=gw(Pb(n,"float32")),r=mw(Dw(Tw(1),t));return jS(fw(e,r))}}}},_C={kernelName:em,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=mw(Dw(gw(Pb(n,"float32")),1));return fw(e,t)}}}},SC={kernelName:tm,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Pw(n.shape,r.shape);return{a:()=>{let t=e;const r=Rw(n.shape,i);return r.length>0&&(t=LS(t,r)),nx(t,n.shape)},b:()=>{let t=e;const n=Rw(r.shape,i);return n.length>0&&(t=LS(t,n)),nx(t,r.shape)}}}},EC={kernelName:nm,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach((t,r)=>{n[r]=()=>e.clone()}),n}},TC={kernelName:am,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>vw(n)}}},kC={kernelName:om,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>vw(n)}}},CC={kernelName:sm,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>fw(e,mw(Dw(Tw(1),gw(Pb(n,"float32")))))}}},IC={kernelName:lm,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=mw(dw(Tw(1),gw(Pb(n,"float32"))));return fw(e,t)}}}},OC={kernelName:dm,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Pw(n.shape,r.shape);return{a:()=>{const t=dw(gw(n),gw(r));let a=pw(e,fw(r,t));const o=Rw(n.shape,i);return o.length>0&&(a=LS(a,o)),nx(a,n.shape)},b:()=>{const t=dw(gw(n),gw(r));let a=jS(pw(e,fw(n,t)));const o=Rw(r.shape,i);return o.length>0&&(a=LS(a,o)),nx(a,r.shape)}}}},AC={kernelName:um,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>fw(e,dw(gw(Pb(n,"float32")),1))}}},DC={kernelName:cm,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>fw(e,Dw(Tw(1),gw(Pb(n,"float32"))))}}},MC=By({avgPool3dBackprop_:function(e,t,n,r,i=[1,1,1],a,o){const s=Fy(e,"dy","avgPool3dBackprop"),l=Fy(t,"input","avgPool3dBackprop");let u=s,c=l,d=!1;4===l.rank&&(d=!0,u=nx(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),c=nx(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),sp(5===u.rank,()=>"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+u.rank+"."),sp(5===c.rank,()=>"Error in avgPool3dBackprop: input must be rank 5 but got rank "+c.rank+"."),sp(b_(r,i),()=>`Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides ${r} and dilations '${i}'`),null!=o&&sp(pp(a),()=>`Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode ${o} but got pad ${a}.`);const h=Ay.runKernelFunc(e=>{const t=c_(c.shape,n,r,i,a,o);return e.avgPool3dBackprop(u,c,t)},{dy:u,input:c},null,mm,{filterSize:n,strides:r,dilations:i,pad:a,dimRoundingMode:o});return d?nx(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),NC={kernelName:pm,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:i,strides:a,dilations:o,pad:s,dimRoundingMode:l}=n,u=null==o?[1,1,1]:o;return{x:()=>MC(e,r,i,a,u,s,l)}}},jC=By({avgPoolBackprop_:function(e,t,n,r,i){const a=Fy(e,"dy","avgPoolBackprop"),o=Fy(t,"input","avgPoolBackprop");sp(o.rank===a.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${a.rank})`);let s=o,l=a,u=!1;3===o.rank&&(u=!0,s=nx(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=nx(a,[1,a.shape[0],a.shape[1],a.shape[2]])),sp(4===l.rank,()=>"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."),sp(4===s.rank,()=>"Error in avgPoolBackprop: input must be rank 4 but got rank "+s.rank+".");const c=Ay.runKernelFunc(e=>{const t=u_(s.shape,n,r,1,i);return e.avgPoolBackprop(l,s,t)},{dy:l,input:s},null,fm,{filterSize:n,strides:r,pad:i});return u?nx(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),RC={kernelName:hm,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:i,strides:a,pad:o}=n;return{x:()=>jC(e,r,i,a,o)}}},PC={kernelName:gm,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[r,i]=t,{transposeA:a,transposeB:o}=n;return a||o?!a&&o?{a:()=>rx(e,i,!1,!1),b:()=>rx(e,r,!0,!1)}:a&&!o?{a:()=>rx(i,e,!1,!0),b:()=>rx(r,e,!1,!1)}:{a:()=>rx(i,e,!0,!0),b:()=>rx(e,r,!0,!0)}:{a:()=>rx(e,i,!1,!0),b:()=>rx(r,e,!0,!1)}}},FC={kernelName:vm,gradFunc:(e,t,n)=>{const{blockShape:r,crops:i}=n;return{x:()=>fE(e,r,i)}}},LC={kernelName:ym,gradFunc:(e,t,n)=>{const r=n.inputShape,i=n.shape,a=Array.from(i);for(let s=r.length-1;s>=0;s--)if(r[s]===i[s])a[s]=1;else if(1!==r[s])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const o=[];for(let s=0;s<a.length;s++)a[s]>1&&o.push(s);return{x:()=>LS(e,o,!0)}}},$C={kernelName:bm,gradFunc:e=>({x:()=>e.clone()})},BC={kernelName:xm,gradFunc:e=>({x:()=>vw(e)})},zC={kernelName:wm,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{clipValueMin:i,clipValueMax:a}=n;return{x:()=>iS(zS(_S(r,i),OS(r,a)),e,vw(e))}}},UC={kernelName:Sm,saveAllInputs:!0,gradFunc:(e,t,n)=>{const r=t.map(e=>e.shape),{axis:i}=n,a=wp(i,t[0].shape)[0],o=r.map(e=>e[a]);return JE(e,o,a).map(e=>()=>e)}},HC={kernelName:Em,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,{dilations:a,strides:o,pad:s,dataFormat:l}=n;return sp(y_(a),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${a}'`),{x:()=>V_(r.shape,e,i,o,s,l),filter:()=>HT(r,e,i.shape,o,s,l)}}},WC={kernelName:km,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,{strides:a,pad:o,dataFormat:s,dimRoundingMode:l}=n;return{dy:()=>H_(e,i,a,o,s,1,l),filter:()=>HT(e,r,i.shape,a,o,s,l)}}},VC=By({conv3DBackpropFilter_:function(e,t,n,r,i){let a=e;4===e.rank&&(a=nx(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let o=t;return 4===o.rank&&(o=nx(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),sp(5===a.rank,()=>"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."),sp(5===o.rank,()=>"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."),sp(5===n.length,()=>"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."),sp(a.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${a.shape[4]}) must match input depth in filter (${n[3]}.`),sp(o.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`),Ay.runKernelFunc(e=>{const t=h_(a.shape,n,r,1,i);return e.conv3dDerFilter(a,o,t)},{x:a,dy:o},null,Im,{strides:r,pad:i,filterShape:n})}}),qC={kernelName:Cm,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:i,pad:a}=n;sp(y_(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const[o,s]=t;return{x:()=>Y_(o.shape,e,s,i,a),filter:()=>VC(o,e,s.shape,i,a)}}},GC={kernelName:Am,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>pw(jS(zE(Pb(n,"float32"))),e)}}},YC={kernelName:Dm,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>pw(UE(Pb(n,"float32")),e)}}},XC={kernelName:Mm,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:i,exclusive:a,reverse:o}=n;return{x:()=>{const t=Kw([i],r.rank);let n=J_(e,i,a,!o);return null!=t&&(n=ax(n,t)),n}}}},KC={kernelName:Rm,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:i,pad:a,dimRoundingMode:o}=n,s=null==r?[1,1]:r;sp(y_(s),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);const[l,u]=t;return sp(4===l.rank,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),sp(4===u.rank,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),sp(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),sp(b_(i,s),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${s}'.`),null!=o&&sp(pp(a),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${a}.`),{x:()=>KT(l.shape,e,u,i,a,r,o),filter:()=>XT(l,e,u.shape,i,a,r,o)}}},ZC={kernelName:$m,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,a={x:r,filter:i,dy:e},o={x:r,filter:i,dy:e};return{x:()=>Ay.runKernel(Bm,a,n),filter:()=>Ay.runKernel(zm,o,n)}}},JC={kernelName:Um,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Pw(n.shape,r.shape);return{a:()=>{const t=fw(e,Pb(r,"float32")),a=Rw(n.shape,i);return a.length>0?nx(LS(t,a),n.shape):t},b:()=>{let t=pw(e,Pb(n,"float32"));const a=Rw(r.shape,i);a.length>0&&(t=nx(LS(t,a),r.shape));const o=gw(r);return jS(fw(t,Pb(o,"float32")))}}}},QC={kernelName:Hm,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,r=t=>t.eluDer(e,n),i={dy:e,y:n};return{x:()=>Ay.runKernelFunc(r,i,null,Wm)}}},eI={kernelName:Vm,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=pw(uS(jS(gw(n))),2/Math.sqrt(Math.PI));return{x:()=>pw(e,r)}}},tI={kernelName:Gm,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>pw(e,n)}}},nI={kernelName:Ym,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>pw(e,uS(n))}}},rI={kernelName:Jm,gradFunc:e=>({x:()=>vw(e)})},iI={kernelName:Qm,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Pw(n.shape,r.shape);return{a:()=>{const t=fw(e,Pb(r,"float32")),a=Rw(n.shape,i);return a.length>0?nx(LS(t,a),n.shape):t},b:()=>{let t=pw(e,Pb(n,"float32"));const a=Rw(r.shape,i);a.length>0&&(t=nx(LS(t,a),r.shape));const o=gw(r);return jS(fw(t,Pb(o,"float32")))}}}},aI={kernelName:eg,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:r}=n,[i,a,o,s]=t,l=null==s?Tw(1):s,u=Rw(a.shape,i.shape),c=[];if(1===a.rank){for(let e=0;e<i.shape.length-1;++e)c.push(i.shape[e]);c.push(1)}const d=Dw(i,a),h=pw(e,l),f=PE(dw(o,Tw(r))),p=pw(pw(pw(f,f),f),Tw(-.5));return{x:()=>nx(pw(pw(e,1===a.rank?hS(nx(f,[1,1,1,a.shape[0]]),c):f),l),i.shape),mean:()=>{let e=pw(pw(f,Tw(-1)),h);return 1===a.rank&&(e=LS(e,u)),nx(e,a.shape)},variance:()=>{let e=pw(pw(p,d),h);return 1===a.rank&&(e=LS(e,u)),nx(e,a.shape)},scale:()=>{const t=pw(d,f);let n=pw(e,t);return 1===a.rank&&(n=LS(n,u)),nx(n,a.shape)},offset:()=>{let t=e;return 1===a.rank&&(t=LS(t,u)),nx(t,a.shape)}}}},oI={kernelName:tg,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[r,i]=t,{axis:a}=n,o=wp(a,r.shape)[0];return{x:()=>{const t=r.shape,n=i.size,s=t.slice(0,o),l=s.length,u=t.slice(a,t.length).slice(1),c=u.length,d=sI(0,l),h=sI(l+1,l+1+c),f=lI([s,[n],u]),p=nx(e,f),m=nx(i,[n]),g=lI([[l],d,h]),v=ax(p,g);let y=fT(v,m,r.shape[o]);const b=Zw(g);return y=ax(y,b),y},indices:()=>i}}};function sI(e,t){const n=[];for(let r=e;r<t;++r)n.push(r);return n}function lI(e){const t=[];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)t.push(e[n][r]);return t}const uI={kernelName:ig,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>vw(n),b:()=>vw(r)}}},cI={kernelName:ag,gradFunc:e=>({x:()=>Pb(e,"float32")})},dI={kernelName:lg,gradFunc:e=>({x:()=>vw(e)})},hI={kernelName:ug,gradFunc:e=>({x:()=>vw(e)})},fI={kernelName:cg,gradFunc:e=>({x:()=>vw(e)})},pI={kernelName:mg,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>fw(e,dw(n,1))}}},mI={kernelName:pg,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>fw(e,Pb(n,"float32"))}}},gI={kernelName:bg,inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{axis:i}=n;return{logits:()=>{const t=uS(r);return Dw(e,pw(LS(e,i,!0),t))}}}},vI=By({localResponseNormalizationBackprop_:function(e,t,n,r=5,i=1,a=1,o=.5){return Ay.runKernelFunc(s=>s.LRNGrad(n,e,t,r,i,a,o),{x:e,y:t,dy:n},null,wg,{depthRadius:r,bias:i,alpha:a,beta:o})}}),yI={kernelName:xg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{depthRadius:a,bias:o,alpha:s,beta:l}=n;return{x:()=>vI(r,i,e,a,o,s,l)}}};function bI(e,t,n,r){return t.rank<n.rank&&(t=nx(t,Yw(t.shape,r))),e.rank<n.rank&&(e=nx(e,Yw(e.shape,r))),{x:()=>pw(e,Pb(rS(n,t),e.dtype))}}const xI={kernelName:_g,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{reductionIndices:i}=r,a=t[0],o=bI(e,t[1],a,wp(i,a.shape));return{x:()=>o.x()}}},wI={kernelName:Sg,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>pw(e,Pb(_S(n,r),"float32")),b:()=>pw(e,Pb(IS(n,r),"float32"))}}},_I=By({maxPool3dBackprop_:function(e,t,n,r,i,a=[1,1,1],o,s){const l=Fy(e,"dy","maxPool3dBackprop"),u=Fy(t,"input","maxPool3dBackprop"),c=Fy(n,"output","maxPool3dBackprop");let d=l,h=u,f=c,p=!1;4===u.rank&&(p=!0,d=nx(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),h=nx(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),f=nx(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),sp(5===d.rank,()=>"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+d.rank+"."),sp(5===h.rank,()=>"Error in maxPool3dBackprop: input must be rank 5 but got rank "+h.rank+"."),sp(5===f.rank,()=>"Error in maxPool3dBackprop: output must be rank 5 but got rank "+f.rank+"."),sp(b_(i,a),()=>`Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides ${i} and dilations '${a}'`),null!=s&&sp(pp(o),()=>`Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode ${s} but got pad ${o}.`);const m=Ay.runKernelFunc(e=>{const t=c_(h.shape,r,i,a,o,s);return e.maxPool3dBackprop(d,h,f,t)},{dy:d,input:h,output:f},null,Cg,{filterSize:r,strides:i,dilations:a,pad:o,dimRoundingMode:s});return p?nx(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}}),SI={kernelName:kg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{filterSize:a,strides:o,dilations:s,pad:l,dimRoundingMode:u}=n,c=null==s?[1,1,1]:s;return{x:()=>_I(e,r,i,a,o,c,l,u)}}},EI=By({maxPoolBackprop_:function(e,t,n,r,i,a,o){const s=Fy(e,"dy","maxPoolBackprop"),l=Fy(t,"input","maxPoolBackprop"),u=Fy(n,"output","maxPoolBackprop");return sp(l.rank===s.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${s.rank})`),sp(4===s.rank,()=>"Error in maxPoolBackprop: dy must be rank 4 but got rank "+s.rank+"."),sp(4===l.rank,()=>"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."),null!=o&&sp(pp(a),()=>`Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode ${o} but got pad ${a}.`),Ay.runKernelFunc(e=>{const t=u_(l.shape,r,i,1,a,o);return e.maxPoolBackprop(s,l,u,t)},{dy:s,input:l,output:u},null,Tg,{filterSize:r,strides:i,pad:a,dimRoundingMode:o})}}),TI={kernelName:Ug,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:i}=n,a=i.map(e=>e[0]);return{x:()=>C_(e,a,r.shape)}}},kI={kernelName:vv,gradFunc:(e,t,n)=>{const{blockShape:r,paddings:i}=n;return{x:()=>A_(e,r,i)}}},CI={kernelName:yv,gradFunc:(e,t,n)=>{const{axis:r}=n;return{x:()=>T_(e,r)}}},II=[xC,wC,_C,SC,EC,TC,kC,CC,IC,OC,AC,DC,NC,RC,PC,FC,LC,$C,BC,zC,UC,WC,HC,qC,GC,YC,XC,KC,ZC,JC,QC,eI,tI,nI,iI,rI,aI,oI,uI,cI,dI,hI,fI,pI,mI,gI,yI,xI,xI,wI,SI,{kernelName:Eg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{filterSize:a,strides:o,pad:s}=n;return{x:()=>EI(e,r,i,a,o,s)}}},{kernelName:Ag,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{axis:i}=r,[a,o]=t,s=bI(e,o,a,wp(i,a.shape));return{x:()=>s.x()}}},{kernelName:Dg,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>pw(e,Pb(OS(n,r),"float32")),b:()=>pw(e,Pb(wS(n,r),"float32"))}}},{kernelName:Mg,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:i}=n,a=i.map(e=>e[0]);return{x:()=>C_(e,a,r.shape)}}},{kernelName:Ng,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Pw(n.shape,r.shape);return{a:()=>{const t=Rw(n.shape,i);return t.length>0?nx(LS(e,t),n.shape):e},b:()=>{const t=pw(e,jS(pS(fw(n,r)))),a=Rw(r.shape,i);return a.length>0?nx(LS(t,a),r.shape):t}}}},{kernelName:jg,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Pw(n.shape,r.shape);return{a:()=>{const t=pw(e,Pb(r,"float32")),a=Rw(n.shape,i);return a.length>0?nx(LS(t,a),n.shape):t},b:()=>{const t=pw(e,Pb(n,"float32")),a=Rw(r.shape,i);return a.length>0?nx(LS(t,a),r.shape):t}}}},{kernelName:Rg,gradFunc:e=>({x:()=>jS(e)})},{kernelName:zg,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>YS(n.shape,"float32")}}},{kernelName:Bg,gradFunc:e=>({x:()=>vw(e)})},TI,TI,{kernelName:Wg,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,r,i]=t,a=n,o=r,s=Pw(a.shape,o.shape);return{a:()=>{const t=Pb(o,"float32");let n=pw(e,pw(t,Aw(a,Dw(t,Tw(1)))));const r=Rw(a.shape,s);return r.length>0&&(n=LS(n,r)),nx(n,a.shape)},b:()=>{const t=wS(a,0),n=iS(t,MS(a),vw(a));let r=pw(e,pw(i,n));const l=Rw(o.shape,s);return l.length>0&&(r=LS(r,l)),nx(r,o.shape)}}}},{kernelName:Vg,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,r]=t,i=wS(n,0);return{x:()=>iS(i,e,pw(e,r)),alpha:()=>{let t=iS(i,vw(e),pw(e,n));const a=Rw(r.shape,e.shape);return a.length>0&&(t=LS(t,a)),nx(t,r.shape)}}}},{kernelName:Xg,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>fw(e,jS(gw(n)))}}},{kernelName:nv,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=pw(OS(n,6),rT(n));return{x:()=>pw(e,Pb(r,"float32"))}}},{kernelName:Kg,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>pw(e,Pb(rT(n),"float32"))}}},{kernelName:Zg,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>nx(e,n.shape)}}},{kernelName:ev,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,i=t=>{const{alignCorners:i}=n;return t.resizeBilinearBackprop(e,r,i)},a={images:r};return{images:()=>Ay.runKernelFunc(i,a,null,tv,n)}}},{kernelName:Jg,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,i=t=>{const{alignCorners:i}=n;return t.resizeNearestNeighborBackprop(e,r,i)},a={images:r};return{images:()=>Ay.runKernelFunc(i,a,null,Qg,n)}}},{kernelName:rv,gradFunc:(e,t,n)=>{const{dims:r}=n,i=wp(r,e.shape);return{x:()=>AE(e,i)}}},{kernelName:iv,gradFunc:e=>({x:()=>vw(e)})},{kernelName:av,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>jS(fw(e,pw(Aw(n,1.5),2)))}}},{kernelName:sv,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>Pb(vw(n),"float32"),t:()=>pw(e,Pb(n,e.dtype)),e:()=>pw(e,Pb(US(n),e.dtype))}}},{kernelName:lv,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=wS(n,Tw(0)),r=Tw(Kk),i=Tw(Zk),a=pw(e,i),o=pw(pw(e,r),uS(Pb(n,"float32")));return iS(t,a,o)}}}},{kernelName:fv,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>pw(e,pw(n,Dw(Tw(1),n)))}}},{kernelName:hv,gradFunc:e=>({x:()=>vw(e)})},{kernelName:cv,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>pw(K_(Pb(n,"float32")),e)}}},{kernelName:dv,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>pw(Z_(Pb(n,"float32")),e)}}},{kernelName:uv,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{begin:i,size:a}=n,o=r.shape,[s,l]=Ox(r,i,a),u=[];for(let c=0;c<e.rank;c++)u.push([s[c],o[c]-s[c]-l[c]]);return{x:()=>lE(e,u)}}},{kernelName:bv,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{dim:i}=n,a=pw(e,r);return{logits:()=>Dw(a,pw(LS(a,[i],!0),r))}}},{kernelName:pv,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>pw(e,k_(n))}}},kI,kI,CI,CI,{kernelName:mv,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>fw(e,pw(mw(Pb(n,"float32")),2))}}},{kernelName:xv,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Tw(2);return{a:()=>pw(e,pw(i,Dw(n,r))),b:()=>pw(e,pw(i,Dw(r,n)))}}},{kernelName:wv,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>pw(e,pw(Pb(n,"float32"),2))}}},{kernelName:jv,gradFunc:e=>({x:()=>vw(e)})},{kernelName:_v,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Pw(n.shape,r.shape);return{a:()=>{let t=e;const r=Rw(n.shape,i);return r.length>0&&(t=LS(t,r)),nx(t,n.shape)},b:()=>{let t=e;const n=Rw(r.shape,i);return n.length>0&&(t=LS(t,n)),nx(jS(t),r.shape)}}}},{kernelName:gv,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,i=r.shape.slice(),{axis:a}=n;wp(a,r.shape).forEach(e=>{i[e]=1});const o=nx(e,i),s=pw(o,XS(r.shape,"float32"));return{x:()=>s}}},{kernelName:Tv,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>fw(e,gw(K_(n)))}}},{kernelName:kv,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>pw(Dw(Tw(1),gw(n)),e)}}},{kernelName:Cv,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{reps:i}=n;return{x:()=>{let t=vw(r);if(1===r.rank)for(let n=0;n<i[0];++n)t=dw(t,C_(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(let n=0;n<i[0];++n)for(let a=0;a<i[1];++a)t=dw(t,C_(e,[n*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(let n=0;n<i[0];++n)for(let a=0;a<i[1];++a)for(let o=0;o<i[2];++o)t=dw(t,C_(e,[n*r.shape[0],a*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(let n=0;n<i[0];++n)for(let a=0;a<i[1];++a)for(let o=0;o<i[2];++o)for(let s=0;s<i[3];++s)t=dw(t,C_(e,[n*r.shape[0],a*r.shape[1],o*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},{kernelName:Ov,gradFunc:(e,t,n)=>{const r=n,{perm:i}=r,a=Zw(i);return{x:()=>ax(e,a)}}},{kernelName:Dv,gradFunc:(e,t,n)=>{const r=n,{axis:i}=r;return{value:()=>nT(e,i)}}},{kernelName:Mv,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>function(e,t){const n=Fw(t,vw(t)),r=xS(e,n);let i=_S(t,Tw(0,"int32"));const a=r.rank-i.rank;for(let s=0;s<a;++s)i=cS(i,s+1);i=zS(i,XS(r.shape,"bool"));const o=vw(r);return iS(i,r,o)}(e,n)}}},{kernelName:Nv,gradFunc:e=>({x:()=>vw(e)})}];for(const iBe of II)qv(iBe);let OI;function AI(){return null==OI&&(OI=uw().epsilon()),OI}fy.prototype.abs=function(){return this.throwIfDisposed(),Nw(this)},fy.prototype.acos=function(){return this.throwIfDisposed(),Uw(this)},fy.prototype.acosh=function(){return this.throwIfDisposed(),Hw(this)},fy.prototype.addStrict=function(e){return this.throwIfDisposed(),TT(this,e)},fy.prototype.add=function(e){return this.throwIfDisposed(),dw(this,e)},fy.prototype.all=function(e,t){return this.throwIfDisposed(),Qw(this,e,t)},fy.prototype.any=function(e,t){return this.throwIfDisposed(),e_(this,e,t)},fy.prototype.argMax=function(e){return this.throwIfDisposed(),t_(this,e)},fy.prototype.argMin=function(e){return this.throwIfDisposed(),n_(this,e)},fy.prototype.asScalar=function(){return this.throwIfDisposed(),sp(1===this.size,()=>"The array must have only 1 element."),nx(this,[])},fy.prototype.asType=function(e){return this.throwIfDisposed(),Pb(this,e)},fy.prototype.as1D=function(){return this.throwIfDisposed(),nx(this,[this.size])},fy.prototype.as2D=function(e,t){return this.throwIfDisposed(),nx(this,[e,t])},fy.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),nx(this,[e,t,n])},fy.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),nx(this,[e,t,n,r])},fy.prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),nx(this,[e,t,n,r,i])},fy.prototype.asin=function(){return this.throwIfDisposed(),r_(this)},fy.prototype.asinh=function(){return this.throwIfDisposed(),i_(this)},fy.prototype.atan=function(){return this.throwIfDisposed(),a_(this)},fy.prototype.atan2=function(e){return this.throwIfDisposed(),o_(this,e)},fy.prototype.atanh=function(){return this.throwIfDisposed(),s_(this)},fy.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),w_(this,e,t,n,r)},fy.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),A_(this,e,t)},fy.prototype.batchNorm=function(e,t,n,r,i){return this.throwIfDisposed(),M_(this,e,t,n,r,i)},fy.prototype.broadcastTo=function(e){return this.throwIfDisposed(),P_(this,e)},fy.prototype.cast=function(e){return this.throwIfDisposed(),Pb(this,e)},fy.prototype.ceil=function(){return this.throwIfDisposed(),F_(this)},fy.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),L_(this,e,t)},fy.prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof fy&&(e=[e]),T_([this,...e],t)},fy.prototype.conv1d=function(e,t,n,r,i,a){return this.throwIfDisposed(),W_(this,e,t,n,r,i,a)},fy.prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),q_(this,e,t,n,r,i)},fy.prototype.conv2d=function(e,t,n,r,i,a){return this.throwIfDisposed(),H_(this,e,t,n,r,i,a)},fy.prototype.cos=function(){return this.throwIfDisposed(),K_(this)},fy.prototype.cosh=function(){return this.throwIfDisposed(),Z_(this)},fy.prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),J_(this,e,t,n)},fy.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Q_(this,e,t)},fy.prototype.depthwiseConv2D=function(e,t,n,r,i,a){return Gx("depthwiseConv2D is deprecated, use depthwiseConv2d instead"),this.throwIfDisposed(),eS(this,e,t,n,r,i,a)},fy.prototype.depthwiseConv2d=function(e,t,n,r,i,a){return this.throwIfDisposed(),eS(this,e,t,n,r,i,a)},fy.prototype.dilation2d=function(e,t,n,r,i){return this.throwIfDisposed(),nS(this,e,t,n,r,i)},fy.prototype.divNoNan=function(e){return this.throwIfDisposed(),aS(this,e)},fy.prototype.divStrict=function(e){return this.throwIfDisposed(),kT(this,e)},fy.prototype.div=function(e){return this.throwIfDisposed(),fw(this,e)},fy.prototype.dot=function(e){return this.throwIfDisposed(),oS(this,e)},fy.prototype.elu=function(){return this.throwIfDisposed(),sS(this)},fy.prototype.equalStrict=function(e){return this.throwIfDisposed(),bT(this,e)},fy.prototype.equal=function(e){return this.throwIfDisposed(),rS(this,e)},fy.prototype.erf=function(){return this.throwIfDisposed(),lS(this)},fy.prototype.exp=function(){return this.throwIfDisposed(),uS(this)},fy.prototype.expandDims=function(e){return this.throwIfDisposed(),cS(this,e)},fy.prototype.expm1=function(){return this.throwIfDisposed(),dS(this)},fy.prototype.fft=function(){return this.throwIfDisposed(),YE(this)},fy.prototype.flatten=function(){return this.throwIfDisposed(),nx(this,[this.size])},fy.prototype.floor=function(){return this.throwIfDisposed(),pS(this)},fy.prototype.floorDiv=function(e){return this.throwIfDisposed(),hw(this,e)},fy.prototype.gather=function(e,t){return this.throwIfDisposed(),xS(this,e,t)},fy.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),xT(this,e)},fy.prototype.greaterEqual=function(e){return this.throwIfDisposed(),_S(this,e)},fy.prototype.greaterStrict=function(e){return this.throwIfDisposed(),wT(this,e)},fy.prototype.greater=function(e){return this.throwIfDisposed(),wS(this,e)},fy.prototype.ifft=function(){return this.throwIfDisposed(),XE(this)},fy.prototype.irfft=function(){return this.throwIfDisposed(),KE(this)},fy.prototype.isFinite=function(){return this.throwIfDisposed(),ES(this)},fy.prototype.isInf=function(){return this.throwIfDisposed(),TS(this)},fy.prototype.isNaN=function(){return this.throwIfDisposed(),kS(this)},fy.prototype.leakyRelu=function(e){return this.throwIfDisposed(),CS(this,e)},fy.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),_T(this,e)},fy.prototype.lessEqual=function(e){return this.throwIfDisposed(),OS(this,e)},fy.prototype.lessStrict=function(e){return this.throwIfDisposed(),ST(this,e)},fy.prototype.less=function(e){return this.throwIfDisposed(),IS(this,e)},fy.prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),DS(this,e,t,n,r)},fy.prototype.logSigmoid=function(){return this.throwIfDisposed(),PS(this)},fy.prototype.logSoftmax=function(e){return this.throwIfDisposed(),$S(this,e)},fy.prototype.logSumExp=function(e,t){return this.throwIfDisposed(),BS(this,e,t)},fy.prototype.log=function(){return this.throwIfDisposed(),MS(this)},fy.prototype.log1p=function(){return this.throwIfDisposed(),NS(this)},fy.prototype.logicalAnd=function(e){return this.throwIfDisposed(),zS(this,e)},fy.prototype.logicalNot=function(){return this.throwIfDisposed(),US(this)},fy.prototype.logicalOr=function(e){return this.throwIfDisposed(),HS(this,e)},fy.prototype.logicalXor=function(e){return this.throwIfDisposed(),WS(this,e)},fy.prototype.matMul=function(e,t,n){return this.throwIfDisposed(),rx(this,e,t,n)},fy.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),VS(this,e,t,n,r)},fy.prototype.max=function(e,t){return this.throwIfDisposed(),FS(this,e,t)},fy.prototype.maximumStrict=function(e){return this.throwIfDisposed(),CT(this,e)},fy.prototype.maximum=function(e){return this.throwIfDisposed(),Fw(this,e)},fy.prototype.mean=function(e,t){return this.throwIfDisposed(),KS(this,e,t)},fy.prototype.min=function(e,t){return this.throwIfDisposed(),ZS(this,e,t)},fy.prototype.minimumStrict=function(e){return this.throwIfDisposed(),IT(this,e)},fy.prototype.minimum=function(e){return this.throwIfDisposed(),JS(this,e)},fy.prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),QS(this,e,t)},fy.prototype.modStrict=function(e){return this.throwIfDisposed(),OT(this,e)},fy.prototype.mod=function(e){return this.throwIfDisposed(),eE(this,e)},fy.prototype.mulStrict=function(e){return this.throwIfDisposed(),AT(this,e)},fy.prototype.mul=function(e){return this.throwIfDisposed(),pw(this,e)},fy.prototype.neg=function(){return this.throwIfDisposed(),jS(this)},fy.prototype.norm=function(e,t,n){return this.throwIfDisposed(),jT(this,e,t,n)},fy.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),ET(this,e)},fy.prototype.notEqual=function(e){return this.throwIfDisposed(),iE(this,e)},fy.prototype.oneHot=function(e,t=1,n=0){return this.throwIfDisposed(),ix(this,e,t,n)},fy.prototype.onesLike=function(){return this.throwIfDisposed(),oE(this)},fy.prototype.pad=function(e,t){return this.throwIfDisposed(),lE(this,e,t)},fy.prototype.pool=function(e,t,n,r,i){return this.throwIfDisposed(),pE(this,e,t,n,r,i)},fy.prototype.powStrict=function(e){return this.throwIfDisposed(),DT(this,e)},fy.prototype.pow=function(e){return this.throwIfDisposed(),Aw(this,e)},fy.prototype.prelu=function(e){return this.throwIfDisposed(),mE(this,e)},fy.prototype.prod=function(e,t){return this.throwIfDisposed(),gE(this,e,t)},fy.prototype.reciprocal=function(){return this.throwIfDisposed(),CE(this)},fy.prototype.relu=function(){return this.throwIfDisposed(),IE(this)},fy.prototype.relu6=function(){return this.throwIfDisposed(),OE(this)},fy.prototype.reshapeAs=function(e){return this.throwIfDisposed(),nx(this,e.shape)},fy.prototype.reshape=function(e){return this.throwIfDisposed(),nx(this,e)},fy.prototype.resizeBilinear=function(e,t){return this.throwIfDisposed(),bk(this,e,t)},fy.prototype.resizeNearestNeighbor=function(e,t){return this.throwIfDisposed(),xk(this,e,t)},fy.prototype.reverse=function(e){return this.throwIfDisposed(),AE(this,e)},fy.prototype.rfft=function(){return this.throwIfDisposed(),QE(this)},fy.prototype.round=function(){return this.throwIfDisposed(),RE(this)},fy.prototype.rsqrt=function(){return this.throwIfDisposed(),PE(this)},fy.prototype.selu=function(){return this.throwIfDisposed(),FE(this)},fy.prototype.separableConv2d=function(e,t,n,r,i,a){return this.throwIfDisposed(),LE(this,e,t,n,r,i,a)},fy.prototype.sigmoid=function(){return this.throwIfDisposed(),k_(this)},fy.prototype.sign=function(){return this.throwIfDisposed(),BE(this)},fy.prototype.sin=function(){return this.throwIfDisposed(),zE(this)},fy.prototype.sinh=function(){return this.throwIfDisposed(),UE(this)},fy.prototype.slice=function(e,t){return this.throwIfDisposed(),C_(this,e,t)},fy.prototype.softmax=function(e){return this.throwIfDisposed(),GE(this,e)},fy.prototype.softplus=function(){return this.throwIfDisposed(),RS(this)},fy.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),fE(this,e,t)},fy.prototype.split=function(e,t){return this.throwIfDisposed(),JE(this,e,t)},fy.prototype.sqrt=function(){return this.throwIfDisposed(),mw(this)},fy.prototype.square=function(){return this.throwIfDisposed(),gw(this)},fy.prototype.squaredDifference=function(e){return this.throwIfDisposed(),eT(this,e)},fy.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),MT(this,e)},fy.prototype.squeeze=function(e){return this.throwIfDisposed(),tT(this,e)},fy.prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof fy?[this,e]:[this,...e];return nT(n,t)},fy.prototype.step=function(e){return this.throwIfDisposed(),rT(this,e)},fy.prototype.stridedSlice=function(e,t,n,r,i,a,o,s){return this.throwIfDisposed(),iT(this,e,t,n,r,i,a,o,s)},fy.prototype.subStrict=function(e){return this.throwIfDisposed(),NT(this,e)},fy.prototype.sub=function(e){return this.throwIfDisposed(),Dw(this,e)},fy.prototype.sum=function(e,t){return this.throwIfDisposed(),LS(this,e,t)},fy.prototype.tan=function(){return this.throwIfDisposed(),aT(this)},fy.prototype.tanh=function(){return this.throwIfDisposed(),I_(this)},fy.prototype.tile=function(e){return this.throwIfDisposed(),hS(this,e)},fy.prototype.toBool=function(){return this.throwIfDisposed(),Pb(this,"bool")},fy.prototype.toFloat=function(){return this.throwIfDisposed(),Pb(this,"float32")},fy.prototype.toInt=function(){return this.throwIfDisposed(),Pb(this,"int32")},fy.prototype.topk=function(e,t){return this.throwIfDisposed(),cT(this,e,t)},fy.prototype.transpose=function(e){return this.throwIfDisposed(),ax(this,e)},fy.prototype.unique=function(e){return this.throwIfDisposed(),hT(this,e)},fy.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),fT(this,e,t)},fy.prototype.unstack=function(e){return this.throwIfDisposed(),pT(this,e)},fy.prototype.where=function(e,t){return this.throwIfDisposed(),iS(e,this,t)},fy.prototype.zerosLike=function(){return this.throwIfDisposed(),vw(this)};class DI extends Error{constructor(e){super(e),Object.setPrototypeOf(this,DI.prototype)}}class MI extends Error{constructor(e){super(e),Object.setPrototypeOf(this,MI.prototype)}}class NI extends Error{constructor(e){super(e),Object.setPrototypeOf(this,NI.prototype)}}class jI extends Error{constructor(e){super(e),Object.setPrototypeOf(this,jI.prototype)}}class RI extends Error{constructor(e){super(e),Object.setPrototypeOf(this,RI.prototype)}}function PI(e,t){if(Array.isArray(e)){let n=[];for(let r=0;r<t;r++)n=n.concat(e);return n}{const n=new Array(t);return n.fill(e),n}}function FI(e,t){if(!e)throw new RI(t)}function LI(e,t){let n=0;for(const r of e)r===t&&n++;return n}function $I(e){return 1===e.length?e[0]:e}function BI(e){return Array.isArray(e)?e:[e]}function zI(e){const t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function UI(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}Error;let HI={};function WI(e){if(null==e)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function VI(e,t={},n={},r="object",i=!1){if("string"==typeof e){const i=e;let a;if(i in n)a=n[i];else if(i in HI)a=HI[i];else if(a=t[i],null==a)throw new NI(`Unknown ${r}: ${e}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return a}{const a=e;if(null==a.className||null==a.config)throw new NI(r+": Improper config format: "+JSON.stringify(a)+".\n'className' and 'config' must set.");const o=a.className;let s,l;if(o in n?[s,l]=n[o]:o in HI?[s,l]=HI.className:o in t&&([s,l]=t[o]),null==s)throw new NI(`Unknown ${r}: ${o}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(null!=l){const e={};for(const n of Object.keys(HI))e[n]=HI[n];for(const i of Object.keys(n))e[i]=n[i];a.config.customObjects=e;const t=Object.assign({},HI);for(const i of Object.keys(n))HI[i]=n[i];!function e(t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))t.forEach(t=>e(t));else{const n=Object.keys(t);for(const r of n){const n=t[r];null!=n&&"object"==typeof n&&(Array.isArray(n)||"ndarray"!==n.type||"number"!=typeof n.value?e(n):t[r]=n.value)}}}(a.config);const r=l(s,a.config,n,i);return HI=Object.assign({},t),r}{const e=Object.assign({},HI);for(const r of Object.keys(n))HI[r]=n[r];const t=new s(a.config);return HI=Object.assign({},e),t}}}function qI(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function GI(e){if(null==e)return e;const t=[];for(const n of e)-1===t.indexOf(n)&&t.push(n);return t}function YI(e){if(null==e)throw new NI("Invalid value in obj: "+JSON.stringify(e));for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function XI(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new NI(`${n} is not a valid ${t}.  Valid values are ${e} or null/undefined.`)}function KI(e,t,n=0,r=1/0){return FI(n>=0),FI(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every(e=>typeof e===t)}function ZI(e,t){Array.isArray(e)?(r.assert(e.length>0,()=>t+" is unexpectedly an empty array."),e.forEach((e,n)=>ZI(e,`element ${n+1} of ${t}`))):r.assert(Number.isInteger(e)&&e>0,()=>`Expected ${t} to be a positive integer, but got `+function e(t){return null===t?"null":Array.isArray(t)?"["+t.map(t=>e(t)).join(",")+"]":"string"==typeof t?`"${t}"`:""+t}(e)+".")}function JI(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}function QI(e,t){return Jx(()=>mw(LS(pw(e,e),t,!0)))}class eO extends h.Serializable{getConfig(){return{}}}class tO extends eO{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return Jx(()=>{const t=QI(e,this.axis),n=L_(t,0,this.maxValue);return pw(e,fw(n,dw(AI(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}tO.className="MaxNorm",h.registerClass(tO);class nO extends eO{constructor(e){super(),this.defaultAxis=0,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return Jx(()=>fw(e,dw(AI(),QI(e,this.axis))))}getConfig(){return{axis:this.axis}}}nO.className="UnitNorm",h.registerClass(nO);class rO extends eO{apply(e){return IE(e)}}rO.className="NonNeg",h.registerClass(rO);class iO extends eO{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=e.minValue?e.minValue:this.defaultMinValue,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.rate=null!=e.rate?e.rate:this.defaultRate,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return Jx(()=>{const t=QI(e,this.axis),n=dw(pw(this.rate,L_(t,this.minValue,this.maxValue)),pw(1-this.rate,t));return pw(e,fw(n,dw(AI(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}iO.className="MinMaxNorm",h.registerClass(iO);const aO={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function oO(e){return WI(e)}function sO(e,t={}){return VI(e,h.SerializationMap.getMap().classNameMap,t,"constraint")}function lO(e){return null==e?null:"string"==typeof e?sO({className:e in aO?aO[e]:e,config:{}}):e instanceof eO?e:sO(e)}function uO(e){return new tO(e)}function cO(e){return new nO(e)}function dO(){return new rO}function hO(e){return new iO(e)}const fO=["channelsFirst","channelsLast"],pO=["valid","same","causal"],mO=["max","avg"],gO=["sum","mul","concat","ave"],vO=new Map;function yO(e){XI(fO,"DataFormat",e)}function bO(e){XI(pO,"PaddingMode",e)}function xO(e){XI(mO,"PoolMode",e)}const wO=[];function _O(e,t){wO.push(e);try{const e=t();return wO.pop(),e}catch(n){throw wO.pop(),n}}function SO(e){if(!kO(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===wO.length?"":wO.join("/")+"/")+e}function EO(e){if(!kO(e))throw new Error("Not a valid tensor name: '"+e+"'");vO.has(e)||vO.set(e,0);const t=vO.get(e);if(vO.set(e,vO.get(e)+1),t>0){const n=`${e}_${t}`;return vO.set(n,1),n}return e}const TO=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function kO(e){return!!e.match(TO)}function CO(e,t,n){null==t&&(t=0),null==n&&(n=e.length);let r=1;for(let i=t;i<n;++i)r*=e[i];return r}function IO(e){return TE(e=Array.isArray(e)?new Float32Array(e):e)}function OO(e){return ZS(IO(e)).dataSync()[0]}function AO(e){return FS(IO(e)).dataSync()[0]}function DO(e,t){if(t<e)throw new NI(`end (${t}) < begin (${e}) is forbidden.`);const n=[];for(let r=e;r<t;++r)n.push(r);return n}function MO(e,t){return e.asType(t)}function NO(e,t=-1){const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),e.reshape(n)}function jO(e,t,n){return Jx(()=>{switch(e.rank){case 1:return HE(e,t,n);case 2:return WE(e,[t,0],[n,e.shape[1]]);case 3:return VE(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return qE(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return C_(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return C_(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new NI("sliceAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}})}function RO(e,t,n){return Jx(()=>{switch(e.rank){case 1:return HE(e,t,n);case 2:return WE(e,[0,t],[e.shape[0],n]);case 3:return VE(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return qE(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new NI("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}})}function PO(e,t,n,r){return Jx(()=>{switch(e.rank){case 1:return HE(e,t,n);case 2:switch(r){case 1:return jO(e,t,n);case 2:return RO(e,t,n);default:throw new NI("The axis is not within the rank of the tensor "+r)}case 3:switch(r){case 1:return jO(e,t,n);case 2:return VE(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return RO(e,t,n);default:throw new NI("The axis is not within the rank of the tensor "+r)}case 4:switch(r){case 1:return jO(e,t,n);case 2:return qE(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return qE(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return RO(e,t,n);default:throw new NI("The axis is not within the rank of the tensor "+r)}default:throw new NI("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}})}function FO(e,t=-1){let n;return t<0&&(n=e[0].rank,t=0!==n?n:0),t===e[0].rank&&(t=-1),T_(e,t)}function LO(e,t){switch(e.rank){case 1:return $_([e,t]);case 2:return B_([e,t],0);case 3:return z_([e,t],0);case 4:return U_([e,t],0);default:throw new NI("concatAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}}function $O(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new NI(`The length of input n (${t.length}) does not match the number of dimensions in input x (${e.rank})`);return hS(e,t)}function BO(e,t=0,n=1,r,i){return SE(e,t,n,r,i)}function zO(e,t,n,r){if(e.rank<2||t.rank<2)throw new jI(`dot requires both inputs to be rank >= 2 but got x shape = ${e.shape} and y shape = ${t.shape}`);if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new jI(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${e.shape} and  y shape = `+t.shape);if(2===e.rank&&2===t.rank)return m.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?WO(e.rank,r,"channelsLast"):null,activation:n});{const i=e.shape.slice(),a=i.pop();e=e.reshape([-1,a]);const o=t.shape.slice(),s=o.pop(),l=o.pop(),u=[...o,s],c=Array.from({length:t.rank},(e,n)=>0===n?t.rank-2:n<=t.rank-2?n-1:n);t=t.transpose(c).reshape([l,-1]);const d=[...i,...u];return m.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?WO(e.rank,r,"channelsLast"):null,activation:n}).reshape(d)}}function UO(e,t,n){return Jx(()=>(t=Array.isArray(t)?TE(t,"int32"):t.toInt(),xS(e,t,n)))}function HO(e){return pw(e,e)}function WO(e,t,n){const r=t.shape;if(1!==t.rank&&t.rank!==e)throw new NI("Unexpected bias dimensions: "+t.rank+"; expected it to be 1 or "+e);if(5===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1,1,1]:[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,1,1,r[0]]:[1].concat(r))}else if(4===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1,1]:[1,r[2],r[0],r[1]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,1,r[0]]:[1].concat(r))}else if(3===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1]:[1,r[1],r[0]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,r[0]]:[1].concat(r))}else if(e<3)return t;throw new NI("Unsupported input rank by biasAdd: "+t.rank)}function VO(e,t,n){return Jx(()=>(null==n&&(n="channelsLast"),yO(n),e.add(WO(e.rank,t,n))))}function qO(e,t,n,r){return Jx(()=>$T(e,t,n,r))}function GO(e,t,n=!1){return n?e():t()}const YO=["fanIn","fanOut","fanAvg"],XO=["normal","uniform","truncatedNormal"];class KO extends h.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class ZO extends KO{apply(e,t){return YS(e,t)}}ZO.className="Zeros",h.registerClass(ZO);class JO extends KO{apply(e,t){return XS(e,t)}}JO.className="Ones",h.registerClass(JO);class QO extends KO{constructor(e){if(super(),"object"!=typeof e)throw new NI("Expected argument of type ConstantConfig but got "+e);if(void 0===e.value)throw new NI("config must have value set but got "+e);this.value=e.value}apply(e,t){return Jx(()=>pw(Tw(this.value),XS(e,t)))}getConfig(){return{value:this.value}}}QO.className="Constant",h.registerClass(QO);class eA extends KO{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return EE(e,this.minval,this.maxval,t)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}eA.className="RandomUniform",h.registerClass(eA);class tA extends KO{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new jI(`randomNormal does not support dType ${t}.`);return BO(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}tA.className="RandomNormal",h.registerClass(tA);class nA extends KO{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new jI(`truncatedNormal does not support dType ${t}.`);return dT(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}nA.className="TruncatedNormal",h.registerClass(nA);class rA extends KO{constructor(e){super(),this.gain=null!=e.gain?e.gain:1}apply(e,t){return Jx(()=>{if(2!==e.length||e[0]!==e[1])throw new NI("Identity matrix initializer can only be used for 2D square matrices.");return pw(this.gain,fS(e[0]))})}getConfig(){return{gain:this.gain}}}rA.className="Identity",h.registerClass(rA);class iA extends KO{constructor(e){if(super(),e.scale<0)throw new NI("scale must be a positive float. Got: "+e.scale);this.scale=null==e.scale?1:e.scale,this.mode=null==e.mode?"fanIn":e.mode,XI(YO,"FanMode",this.mode),this.distribution=null==e.distribution?"normal":e.distribution,XI(XO,"Distribution",this.distribution),this.seed=e.seed}apply(e,t){const n=function(e,t="channelsLast"){let n,r;if(yO(t),2===e.length)n=e[0],r=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===t){const t=CO(e,2);n=e[1]*t,r=e[0]*t}else if("channelsLast"===t){const t=CO(e,0,e.length-2);n=e[e.length-2]*t,r=e[e.length-1]*t}}else{const t=CO(e);n=Math.sqrt(t),r=Math.sqrt(t)}return[n,r]}(e),r=n[0],i=n[1];let a=this.scale;if(a/="fanIn"===this.mode?Math.max(1,r):"fanOut"===this.mode?Math.max(1,i):Math.max(1,(r+i)/2),"normal"===this.distribution){const n=Math.sqrt(a);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new jI(`${this.getClassName()} does not support dType ${t}.`);return dT(e,0,n,t,this.seed)}{const n=Math.sqrt(3*a);return EE(e,-n,n,t)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}iA.className="VarianceScaling",h.registerClass(iA);class aA extends iA{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return iA.className}}aA.className="GlorotUniform",h.registerClass(aA);class oA extends iA{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return iA.className}}oA.className="GlorotNormal",h.registerClass(oA);class sA extends iA{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return iA.className}}sA.className="HeNormal",h.registerClass(sA);class lA extends iA{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return iA.className}}lA.className="HeUniform",h.registerClass(lA);class uA extends iA{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return iA.className}}uA.className="LeCunNormal",h.registerClass(uA);class cA extends iA{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return iA.className}}cA.className="LeCunNormal",h.registerClass(cA);class dA extends KO{constructor(e){if(super(),this.DEFAULT_GAIN=1,this.gain=null==e.gain?this.DEFAULT_GAIN:e.gain,this.seed=e.seed,null!=this.seed)throw new jI("Random seed is not implemented for Orthogonal Initializer yet.")}apply(e,t){return Jx(()=>{if(e.length<2)throw new jI("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${e[0]*e[1]}) elements: Slowness may result.`);const t=BO(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32");let n=Lk.gramSchmidt(t);return e[0]>e[1]&&(n=n.transpose()),pw(this.gain,n)})}getConfig(){return{gain:this.gain,seed:this.seed}}}dA.className="Orthogonal",h.registerClass(dA);const hA={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function fA(e,t={}){return VI(e,h.SerializationMap.getMap().classNameMap,t,"initializer")}function pA(e){return WI(e)}function mA(e){if("string"==typeof e){const t=e in hA?hA[e]:e;if("GlorotNormal"===t)return new oA;if("GlorotUniform"===t)return new aA;if("HeNormal"===t)return new sA;if("HeUniform"===t)return new lA;if("LeCunNormal"===t)return new uA;if("LeCunUniform"===t)return new cA;{const e={};return e.className=t,e.config={},fA(e)}}return e instanceof KO?e:fA(e)}function gA(){return new ZO}function vA(){return new JO}function yA(e){return new QO(e)}function bA(e){return new eA(e)}function xA(e){return new tA(e)}function wA(e){return new nA(e)}function _A(e){return new rA(e)}function SA(e){return new iA(e)}function EA(e){return new aA(e)}function TA(e){return new oA(e)}function kA(e){return new sA(e)}function CA(e){return new lA(e)}function IA(e){return new uA(e)}function OA(e){return new cA(e)}function AA(e){return new dA(e)}let DA=0;function MA(){return DA++}const NA={};function jA(e=""){return e in NA||(NA[e]=0),NA[e]+=1,e+NA[e].toString()}function RA(e){return Array.isArray(e)&&Array.isArray(e[0])}function PA(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function FA(e){let t;if(Array.isArray(e)){if(1!==e.length)throw new NI("Expected Tensor length to be 1; got "+e.length);t=e[0]}else t=e;return t}function LA(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return(e=e)[0];throw new NI("Expected exactly 1 Shape; got "+e.length)}return e}function $A(e){let t=0;for(const n of e)t+=0===n.shape.length?1:n.shape.reduce((e,t)=>e*t);return t}class BA{constructor(e,t="float32",n="Variable",r=!0,i=null){this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=MA(),this.originalName=SO(n=null==n?"Variable":n),this.name=EO(this.originalName),this.trainable_=r,this.constraint=i,this.val=mT(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function zA(e){return e.map(e=>e.read())}function UA(e){e.forEach(e=>{e[0].write(e[1])})}class HA{constructor(e){this.dtype=e.dtype,this.shape=e.shape,this.ndim=null!=e.shape?e.shape.length:e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class WA{constructor(e,t,n,r,i,a,o){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=o,this.id=MA(),null!=a&&(this.originalName=SO(a),this.name=EO(this.originalName)),this.rank=t.length}}let VA=0;class qA{constructor(e,t){this.callArgs=t,this.id=VA++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const n of e.inboundLayers)null!=n&&n.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)e.push(null!=t?t.name:null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let GA=0;class YA extends h.Serializable{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=GA++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const e=this.getClassName();t=zI(e)+"_"+jA(e)}if(this.name=t,this.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){let t;if(null!=e.batchInputShape)t=e.batchInputShape;else if(null!=e.inputShape){let n=null;null!=e.batchSize&&(n=e.batchSize),t=[n].concat(e.inputShape)}this.batchInputShape=t;let n=e.dtype;null==n&&(n=e.inputDType),null==n&&(n="float32"),this.dtype=n}this.initialWeights=null!=e.weights?e.weights:null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(0===this.inboundNodes.length)throw new MI(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new NI(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return $I(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return $I(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new DI("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new DI("Layer "+this.name+" is not connected, no input to return.");return $I(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new DI("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new DI("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return $I(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){if(e=BI(e),null==this.inputSpec||0===this.inputSpec.length)return;const t=BI(this.inputSpec);if(e.length!==t.length)throw new NI(`Layer ${this.name} expects ${t.length} inputs, but it received ${e.length} input tensors. Input received: `+e);for(let n=0;n<e.length;n++){const r=e[n],i=t[n];if(null==i)continue;const a=r.rank;if(null!=i.ndim&&a!==i.ndim)throw new NI(`Input ${n} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(null!=i.maxNDim&&a>i.maxNDim)throw new NI(`Input ${n} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(null!=i.minNDim&&a<i.minNDim)throw new NI(`Input ${n} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(null!=i.dtype&&r.dtype!==i.dtype)throw new NI(`Input ${n} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${r.dtype}.`);if(i.axes){const e=r.shape;for(const t in i.axes){const r=Number(t),a=i.axes[t],o=r>=0?e[r]:e[e.length+r];if(null!=a&&-1===[a,null].indexOf(o))throw new NI(`Input ${n} is incompatible with layer ${this.name}: expected axis ${r} of input shape to have value ${a} but got shape ${e}.`)}}if(null!=i.shape)for(let e=0;e<i.shape.length;++e){const t=i.shape[e],a=r.shape[e];if(null!=t&&null!=a&&t!==a)throw new NI(`Input ${n} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${r.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){null!=this._callHook&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const n=BI(e);let r=!0;for(const a of n)if(!(a instanceof WA)){r=!1;break}let i=!0;for(const a of n)if(a instanceof WA){i=!1;break}if(r===i)throw new NI("Arguments to apply() must be all SymbolicTensors or all Tensors");return _O(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const t=[];for(const n of BI(e))t.push(n.shape);this.build($I(t)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let r=this.call(e,t);const i=BI(r),a=[];for(let e of i)-1!==n.indexOf(e)&&(e=e.clone()),a.push(e);if(r=$I(a),null!=this.activityRegularizer)throw new jI("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}{const n=function(e){e=BI(e);const t=[];for(const n of e)t.push(n.shape);return $I(t)}(e),r=this.computeOutputShape(n);let i;const a="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(e)?n[0]:n),i=null!=r&&r.length>0&&Array.isArray(r[0])?r.map((n,r)=>new WA(a,n,this,BI(e),t,this.name,r)):new WA(a,r,this,BI(e),t,this.name),this.addInboundNode(e,i,null,null,n,r,t),this._refCount++,null!=this.activityRegularizer)throw new jI("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}})}warnOnIncompatibleInputShape(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(e)+") does not match that of the "+`batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer `+this.name);else{let t=!1;this.batchInputShape.forEach((n,r)=>{null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: `+JSON.stringify(this.batchInputShape))}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new DI(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const n=JSON.stringify(t.outputShapes);-1===e.indexOf(n)&&e.push(n)}if(1===e.length){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&1===e.length?e[0]:e}throw new DI(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new MI(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return $A(this.weights)}build(e){this.built=!0}getWeights(e=!1){return zA(e?this.trainableWeights:this.weights)}setWeights(e){Jx(()=>{const t=this.weights;if(t.length!==e.length)throw new NI(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(0===t.length)return;const n=[],i=zA(t);for(let a=0;a<i.length;++a){const o=i[a],s=t[a],l=e[a];if(!r.arraysEqual(o.shape,l.shape))throw new NI(`Layer weight shape ${o.shape} not compatible with provided weight shape `+l.shape);n.push([s,l])}UA(n)})}addWeight(e,t,n,r,i,a,o){if(-1!==this._addedWeightNames.indexOf(e))throw new NI(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=mA("zeros"));const s=r.apply(t,n),l=new BA(s,n,e,a,o);return s.dispose(),null!=i&&this.addLoss(()=>i.apply(l.read())),null==a&&(a=!0),a?this._trainableWeights.push(l):this._nonTrainableWeights.push(l),l}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){null==e||Array.isArray(e)&&0===e.length||(e=BI(e),null!=this._losses&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);t.forEach(e=>{if(null!=e)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)})}return null}return t}addInboundNode(e,t,n,r,i,a,o=null){const s=BI(e);t=BI(t),n=BI(n),r=BI(r),i=PA(i),a=PA(a);const l=[],u=[],c=[];for(const d of s)l.push(d.sourceLayer),u.push(d.nodeIndex),c.push(d.tensorIndex);new qA({outboundLayer:this,inboundLayers:l,nodeIndices:u,tensorIndices:c,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:a},o);for(let d=0;d<t.length;d++)t[d].sourceLayer=this,t[d].nodeIndex=this.inboundNodes.length-1,t[d].tensorIndex=d}getConfig(){const e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(null===this._refCount)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return 0==--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}class XA extends YA{constructor(e){if(super({dtype:e.dtype,name:null!=e.name?e.name:jA("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new NI("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(null==t){if(null==e.inputShape)throw new NI("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new NI("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=e.dtype||"float32";this.batchInputShape=t,this.dtype=n,this.inputSpec=[{shape:t}];const r=new WA(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new qA({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new NI("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}function KA(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new NI("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));let n=e.dtype;return null==n&&(n="float32"),new XA({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}async function ZA(e){if(null==e)return;const t=[],n=[],r=[];for(const i in e){const a=e[i];if("number"!=typeof a){const e=a;t.push(e.data()),n.push(i),r.push(e)}}if(t.length>0){const i=await Promise.all(t);for(let t=0;t<i.length;++t)e[n[t]]=i[t][0];Qx(r)}}function JA(e){if(null!=e)for(const t in e){const n=e[t];"number"!=typeof n&&n.dispose()}}var QA;XA.className="InputLayer",h.registerClass(XA),function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(QA||(QA={}));class eD{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class tD{constructor(e,t=10){null==e&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochBegin(e,t)}async onEpochEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochEnd(e,t)}async onBatchBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchBegin(e,t)}async onBatchEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchEnd(e,t)}async onTrainBegin(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class nD extends eD{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){null==t&&(t={});const n=null==t.size?0:t.size;this.seen+=n;for(const r in t){const e=t[r];if("number"==typeof e)this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+e*n;else{let t;r in this.totals?t=this.totals[r]:this.totals[r]=0;const i=Jx(()=>dw(this.totals[r],pw(e,n)));this.totals[r]=i,null!=t&&t.dispose()}}}async onEpochEnd(e,t){if(null!=t)for(const n of this.params.metrics)null!=this.totals[n]&&("number"==typeof this.totals[n]?t[n]=this.totals[n]/this.seen:Jx(()=>{const e=pw(fw(1,this.seen),this.totals[n]);t[n]=e,this.totals[n].dispose(),ew(t[n])}))}}class rD extends eD{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){null==t&&(t={}),this.epoch.push(e);for(const n in t)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(t[n])}async syncData(){const e=[],t=[],n=[];for(const i in this.history){const r=this.history[i];for(let a=0;a<r.length;++a)"number"!=typeof r[a]&&(e.push(r[a].data()),t.push(i),n.push(a))}const r=await Promise.all(e);for(let i=0;i<r.length;++i)this.history[t[i]][n[i]].dispose(),this.history[t[i]][n[i]]=r[i][0]}}class iD extends eD{constructor(e,t){if(super(),this.currentEpoch=0,this.yieldEvery=t||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");r.isNumber(this.yieldEvery)&&(this.maybeWait=function(e,t){let n,i=r.now();return(...a)=>{const o=r.now();return o-i<t||(i=o,n=e(...a)),n}}(this.maybeWait.bind(this),this.yieldEvery)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,n){const r=[];null!=this.yield&&(await ZA(n),r.push(this.yield(e,t,n))),r.push(Hk()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,null!=this.epochBegin&&(await ZA(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const n=[];null!=this.epochEnd&&(await ZA(t),n.push(this.epochEnd(e,t))),"epoch"===this.yieldEvery&&n.push(Hk()),await Promise.all(n)}async onBatchBegin(e,t){null!=this.batchBegin&&(await ZA(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const n=[];null!=this.batchEnd&&(await ZA(t),n.push(this.batchEnd(e,t))),"batch"===this.yieldEvery?n.push(Hk()):r.isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(n)}async onTrainBegin(e){null!=this.trainBegin&&(await ZA(e),await this.trainBegin(e))}async onTrainEnd(e){null!=this.trainEnd&&(await ZA(e),await this.trainEnd(e))}}function aD(e,t){return null==e&&(e={}),e instanceof eD?[e]:Array.isArray(e)&&e[0]instanceof eD?e:BI(e).map(e=>new iD(e,t))}class oD{constructor(){}static registerCallbackConstructor(e,t){r.assert(e>=0&&Number.isInteger(e),()=>"Verbosity level is expected to be an integer >= 0, but got "+e),oD.checkForDuplicate(t),null==oD.constructors[e]&&(oD.constructors[e]=[]),oD.constructors[e].push(t)}static checkForDuplicate(e){for(const t in oD.constructors)oD.constructors[+t].forEach(t=>{if(t===e)throw new NI("Duplicate callback constructor.")})}static clear(){oD.constructors={}}static createCallbacks(e){const t=[];for(const n in oD.constructors){const r=+n;e>=r&&t.push(...oD.constructors[r])}return t.map(e=>new e)}}function sD(e,t,n,r,i,a,o,s,l){const u=new rD,c=[new nD,...oD.createCallbacks(t)];null!=e&&c.push(...e),c.push(u);const d=new tD(c);return d.setParams({epochs:n,initialEpoch:r,samples:i,steps:a,batchSize:o,verbose:t,doValidation:s,metrics:l}),{callbackList:d,history:u}}function lD(e,t={},n=!1){return VI(e,h.SerializationMap.getMap().classNameMap,t,"layer",n)}function uD(e,t){return Jx(()=>{"float32"!==e.dtype&&(e=e.asType("float32"));const n=LS(HO(e),t,!0),r=Iw(n.shape,AI()),i=mw(Fw(n,r));return fw(e,i)})}function cD(e,t){return Jx(()=>KS(HO(Dw(t,e)),-1))}function dD(e,t){return Jx(()=>KS(Nw(Dw(t,e)),-1))}function hD(e,t){return Jx(()=>{const n=Dw(e,t),r=L_(Nw(e),AI(),Number.MAX_VALUE),i=Nw(fw(n,r));return pw(100,KS(i,-1))})}function fD(e,t,n=!1){return Jx(()=>{if(n)t=GE(t);else{const e=LS(t,t.shape.length-1,!0);t=fw(t,e)}return t=L_(t,AI(),1-AI()),jS(LS(pw(e.toFloat(),MS(t)),t.shape.length-1))})}function pD(e,t,n=!1){return Jx(()=>{const r=pS(function(e){const t=[CO(e.shape)];return e.reshape(t)}(e)).toInt(),i=(t=L_(t,AI(),1-AI())).shape;return fD(ix(r,i[i.length-1]).reshape(i),t,n)})}function mD(e,t){return Jx(()=>{let n;return n=L_(t,AI(),1-AI()),n=MS(fw(n,Dw(1,n))),KS(function(e,t){if(!r.arraysEqual(e.shape,t.shape))throw new NI(`logits and labels must have the same shape, but got shapes ${JSON.stringify(e.shape)} and ${JSON.stringify(t.shape)}`);return Jx(()=>{const n=t.relu(),r=t.abs().neg();return n.sub(t.mul(e)).add(r.exp().log1p())})}(e,n),-1)})}function gD(e,t){return Jx(()=>{const n=uD(e,-1),r=uD(t,-1),i=pw(n,r);return jS(LS(i,-1))})}oD.constructors={};const vD={meanSquaredError:cD,meanAbsoluteError:dD,meanAbsolutePercentageError:hD,meanSquaredLogarithmicError:function(e,t){return Jx(()=>{const n=L_(t,AI(),Number.MAX_VALUE),r=MS(dw(1,n)),i=L_(e,AI(),Number.MAX_VALUE),a=MS(dw(1,i));return KS(HO(Dw(r,a)),-1)})},squaredHinge:function(e,t){return Jx(()=>{const n=Fw(0,Dw(1,pw(e,t)));return KS(HO(n),-1)})},hinge:function(e,t){return Jx(()=>{const n=Fw(0,Dw(1,pw(e,t)));return KS(n,-1)})},categoricalHinge:function(e,t){return Jx(()=>{const n=LS(pw(e,t),-1),r=FS(pw(Dw(1,e),t),-1);return Fw(0,dw(1,Dw(r,n)))})},logcosh:function(e,t){return Jx(()=>{const n=Math.log(2),r=Dw(t,e),i=Dw(dw(r,RS(pw(-2,r))),n);return KS(i,-1)})},categoricalCrossentropy:fD,sparseCategoricalCrossentropy:pD,binaryCrossentropy:mD,kullbackLeiblerDivergence:function(e,t){return Jx(()=>{const n=L_(e,AI(),1),r=L_(t,AI(),1);return LS(pw(e,MS(fw(n,r))),-1)})},poisson:function(e,t){return Jx(()=>{const n=MS(dw(AI(),t));return KS(Dw(t,pw(e,n)),-1)})},cosineProximity:gD};function yD(e){if("string"==typeof e){if(e in vD)return vD[e];let t="Unknown loss "+e;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${e}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new NI(t)}return e}function bD(e,t){return Jx(()=>{const n=pw(.5,oE(t)),r=MO(wS(t,n),e.dtype);return KS(rS(e,r),-1)})}function xD(e,t){return Jx(()=>MO(rS(t_(e,-1),t_(t,-1)),"float32"))}function wD(e,t){return Jx(()=>zS(e.equal(1),t.equal(1)).sum().cast("float32"))}function _D(e,t){return Jx(()=>{const n=wD(e,t),r=function(e,t){return Jx(()=>zS(e.equal(0),t.equal(1)).sum().cast("float32"))}(e,t),i=n.add(r);return iS(wS(i,0),n.div(i),0).cast("float32")})}function SD(e,t){return mD(e,t)}function ED(e,t){return e.rank===t.rank&&(e=e.squeeze([e.rank-1])),(t=t.argMax(-1)).dtype!==e.dtype&&(t=t.asType(e.dtype)),rS(e,t).asType("float32")}const TD=fD,kD=pD,CD={binaryAccuracy:bD,categoricalAccuracy:xD,precision:_D,categoricalCrossentropy:TD,sparseCategoricalCrossentropy:kD,mse:cD,MSE:cD,mae:dD,MAE:dD,mape:hD,MAPE:hD,cosine:gD};function ID(e){if("string"==typeof e&&e in CD)return CD[e];if("string"!=typeof e&&null!=e)return e;throw new NI("Unknown metric "+e)}function OD(e){if(FI(null!==e,"Unknown LossOrMetricFn "+e),"string"==typeof e)return e;{let t;for(const n of Object.keys(vD))if(vD[n]===e){t=n;break}if(void 0!==t)return t;for(const n of Object.keys(CD))if(CD[n]===e){t=n;break}return void 0!==t?t:e.name}}function AD(e,t,n=!1){if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!function e(t){if(null===t)return!0;if("object"==typeof t){if(Object.getPrototypeOf(t)===Object.prototype){const n=Object.keys(t);for(const r of n){if("string"!=typeof r)return!1;if(!e(t[r]))return!1}return!0}if(Array.isArray(t)){for(const n of t)if(!e(n))return!1;return!0}return!1}{const e=typeof t;return"string"===e||"number"===e||"boolean"===e}}(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(e);n.length>1048576&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function DD(e,t,n=console.log){let r="";for(let i=0;i<e.length;++i)i>0&&(r=r.slice(0,r.length-1)+" "),r+=e[i],r=r.slice(0,t[i]),r+=" ".repeat(t[i]-r.length);n(r)}function MD(e,t,n){let r;try{r=JSON.stringify(e.outputShape)}catch(rBe){r="multiple"}DD([`${e.name} (${e.getClassName()})`,r,e.countParams().toString()],t,n)}function ND(e,t,n,r){let i;try{i=JSON.stringify(e.outputShape)}catch(rBe){i="multiple"}const a=[];for(const u of e.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(let e=0;e<u.inboundLayers.length;++e)a.push(`${u.inboundLayers[e].name}[${u.nodeIndices[e]}][${u.tensorIndices[e]}]`);const o=e.name,s=e.getClassName(),l=0===a.length?"":a[0];DD([`${o} (${s})`,i,e.countParams().toString(),l],t,r);for(let u=1;u<a.length;++u)DD(["","","",a[u]],t,r)}function jD(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function RD(e,t){if(null===e)return null;if("string"==typeof e)return UI(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){const n=[],r=e.length;for(let i=0;i<r;++i){const r=e[i];jD(t,i,r)?n.push(r):n.push(RD(r,t))}return n}{const t={};for(const n of Object.keys(e)){const r=e[n];if("name"===n&&"string"==typeof r)t[n]=r;else{const e=UI(n);t[e]=RD(r,e)}}return t}}const PD="2.7.0";class FD{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof FD)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(null==e)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,n){if(null!=this.id2Value[e.id])throw new NI(`Duplicate key: name=${e.name}, id=${e.id}`);return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return Pb(t,e.dtype)}catch(rBe){throw new NI(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${e.name}' (${e.dtype}).`)}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return null!=this.id2Value[e.id]}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof WA){if(null==this.id2Value[e.id])throw new NI("Nonexistent key: "+e.name);return this.id2Value[e.id]}{const t=this.name2Id[e];if(null==t)throw new NI("Feed dict has no SymbolicTensor name: "+e);return this.id2Value[t]}}getMask(e){if(e instanceof WA){if(null==this.id2Value[e.id])throw new NI("Nonexistent key: "+e.name);return this.id2Mask[e.id]}{const t=this.name2Id[e];if(null==t)throw new NI("Feed dict has no SymbolicTensor name: "+e);return this.id2Mask[t]}}disposeMasks(){null!=this.id2Mask&&Qx(this.id2Mask)}}const LD={},$D={};function BD(e,t,n,i){const a=null!=n&&n.training,o=Array.isArray(e),s=o?e:[e],l=s.map(e=>e.name),u=[],c=t.names();for(const r of l)-1!==c.indexOf(r)?u.push(t.getValue(r)):u.push(null);null!=i&&(i.maxNumTensors=-1/0,i.minNumTensors=1/0);const d=l.join(",")+"|"+t.names().join(",");let h,f;if(null==LD[d]){const e=function(e,t){r.assert(null!=e&&e.length>0,()=>"Expected at least one fetch, got none");let n=[],i={};if(1===e.length){const r=UD(e[0],t);n=r.sorted,i=r.recipientMap}else{const r=new Set;for(const a of e){const{sorted:e,recipientMap:o}=UD(a,t);for(const t of e)r.has(t.name)||(n.push(t),r.add(t.name));for(const t in o)null==i[t]&&(i[t]=new Set),o[t].forEach(e=>i[t].add(e))}}return{sorted:n,recipientCounts:zD(i)}}(s,t);h=e.sorted,f=e.recipientCounts,LD[d]=h,$D[d]=f}h=LD[d],f={},a||Object.assign(f,$D[d]);const p=new FD(t);for(let r=0;r<h.length;++r){if(null!=i){const e=Kx().numTensors;e>i.maxNumTensors&&(i.maxNumTensors=e),e<i.minNumTensors&&(i.minNumTensors=e)}const e=h[r],o=e.sourceLayer;if(o instanceof XA)continue;const s=[],c=[],d=[];let m=!1;for(const n of e.inputs){const e=p.getValue(n),r=p.getMask(n);s.push(e),c.push(r),null!=r&&(m=!0),a||(f[n.name]--,0!==f[n.name]||t.hasKey(n)||-1!==l.indexOf(n.name)||e.isDisposed||!0===n.sourceLayer.stateful||d.push(e))}m&&((n=n||{}).mask=c[0]);const g=BI(o.apply(s,n));let v=null;o.supportsMasking&&(v=o.computeMask(s,c));const y=HD(e),b=Array.isArray(y)?y:[y];for(let t=0;t<b.length;++t){p.hasKey(b[t])||p.add(b[t],g[t],Array.isArray(v)?v[0]:v);const e=l.indexOf(b[t].name);-1!==e&&(u[e]=g[t])}a||Qx(d)}return p.disposeMasks(),o?u:u[0]}function zD(e){const t={};for(const n in e)t[n]=e[n].size;return t}function UD(e,t){const n=new Set,r=[],i={};for(const s of t.names())n.add(s);const a=[],o=[];for(a.push(e);a.length>0;){const e=a[a.length-1];if(n.has(e.name)){a.pop();continue}const t=o[o.length-1]===a.length-1;if(0===e.inputs.length||t)a.pop(),r.push(e),n.add(e.name),t&&o.pop();else{o.push(a.length-1);for(const t of e.inputs)null==i[t.name]&&(i[t.name]=new Set),i[t.name].add(e.name),n.has(t.name)||a.push(t)}}return{sorted:r,recipientMap:i}}function HD(e){let t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{let n=null;for(let t=0;t<e.sourceLayer.inboundNodes.length;++t)for(const r of e.sourceLayer.inboundNodes[t].outputTensors)if(r.id===e.id){n=t;break}t=e.sourceLayer.getOutputAt(n)}return t}class WD extends YA{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,null==this.name){const e=this.getClassName().toLowerCase();this.name=jA(e)}if(this.supportsMasking=!1,this.trainable_=!0,this.inputs=Array.isArray(e.inputs)?e.inputs.slice():[e.inputs],this.outputs=Array.isArray(e.outputs)?e.outputs.slice():[e.outputs],GI(this.inputs).length!==this.inputs.length)throw new NI("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+this.inputs.map(e=>e.name));GI(this.outputs).length!==this.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+this.outputs.map(e=>e.name)),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const v of this.outputs){const e=v.nodeIndex,t=v.tensorIndex;this.outputLayers.push(v.sourceLayer),this.outputLayersNodeIndices.push(e),this.outputLayersTensorIndices.push(t)}for(const v of this.inputs){const e=v.sourceLayer,t=v.nodeIndex,n=v.tensorIndex;FI(0===t,"input layer has >1 nodes"),FI(0===n,"input layer has >1 tensors"),this.inputLayers.push(e),this.inputLayersNodeIndices.push(t),this.inputLayersTensorIndices.push(n)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let v=0;v<this.inputLayers.length;v++){const t=this.inputLayers[v];if(!(t instanceof XA))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${v} (0-based) originates from layer type ${t.getClassName()}.`);this.inputNames.push(t.name),this.feedInputShapes.push(t.batchInputShape),this.feedInputNames.push(t.name)}for(const v of this.outputLayers)this.outputNames.push(v.name);this.internalInputShapes=this.inputs.map(e=>e.shape),this.internalOutputShapes=this.outputs.map(e=>e.shape);const t={},n={},r={},i={},a={},o=[],s=(e,t,n,r,i,l)=>{null!=r&&null!=i&&null!=l||(r=e.sourceLayer,i=e.nodeIndex,l=e.tensorIndex);const u=r.inboundNodes[i];if(-1!==n.indexOf(u))throw new MI(`The tensor ${e.name} at layer "${r.name}" is part of a cycle.`);if(-1!==t.indexOf(u))return;this.containerNodes.add(WD.nodeKey(r,i)),r.id in a||(a[r.id]=Object.keys(a).length),-1===n.indexOf(u)&&n.push(u);const c=u.inboundLayers.length;for(let a=0;a<c;a++)s(u.inputTensors[a],t,n,u.inboundLayers[a],u.nodeIndices[a],u.tensorIndices[a]);for(t.push(u);n.indexOf(u)>=0;)n.splice(n.indexOf(u),1);o.push(u)},l=[],u=[];for(const v of this.outputs)s(v,l,u);const c=o.slice().reverse();for(const v of c){n[v.id]=v,v.id in t||(t[v.id]=0);let e=t[v.id];e=Math.max(e,null==r[v.outboundLayer.id]?0:r[v.outboundLayer.id]),r[v.outboundLayer.id]=e,i[v.outboundLayer.id]=v.outboundLayer,t[v.id]=e;for(let r=0;r<v.inboundLayers.length;r++){const i=v.inboundLayers[r].inboundNodes[v.nodeIndices[r]];t[i.id]=Math.max(e+1,null==t[i.id]?0:t[i.id]),n[i.id]=i}}const d={};for(const v in t){const e=t[v];e in d||(d[e]=[]),d[e].push(n[v])}const h={};for(const v in r){const e=r[v];e in h||(h[e]=[]),h[e].push(i[v])}let f=Object.keys(h).map(e=>parseInt(e,10)).sort(qI);this.layers=[];for(const v of f){const e=h[v];e.sort((e,t)=>{const n=a[e.id],r=a[t.id];return n<r?-1:n>r?1:0});for(const t of e)t instanceof WD&&this.internalContainerRefs.push(t),this.layers.push(t)}this.layersByDepth=h,f=Object.keys(d).map(e=>parseInt(e,10)).sort(qI);const p=this.inputs.slice(),m=[];for(const v of f)for(const e of d[v]){const t=e.outboundLayer;if(null!=t){for(const n of e.inputTensors)if(-1===p.indexOf(n))throw new MI("Graph disconnected: cannot obtain value for tensor "+n+` at layer "${t.name}". The following previous layers were accessed without issue: `+m);for(const t of e.outputTensors)p.push(t);m.push(t.name)}}this.nodesByDepth=d;const g=this.layers.map(e=>e.name);for(const v of g){const e=g.filter(e=>e===v).length;if(1!==e)throw new MI(`The name "${v}" is used ${e} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(g))}this.outboundNodes=[],this.inboundNodes=[],new qA({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(e=>null),outputMasks:this.outputs.map(e=>null),inputShapes:this.inputs.map(e=>e.shape),outputShapes:this.outputs.map(e=>e.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(t=>t.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new NI("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.layers)t.push(...e.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const n={};let r=0;for(const a of this.layers)for(const e of a.weights){if(null!=n[e.originalName])throw new NI("Duplicate weight name: "+e.originalName);n[e.originalName]=e,r++}const i=[];for(const a in e){let r=a;if(null==n[a]){const e=a.split("/");r=e.slice(0,-2).concat([e[e.length-1]]).join("/")}if(null!=n[r])i.push([n[r],e[a]]);else if(t)throw new NI("Provided weight data has no target variable: "+a);delete n[r]}if(t){const e=[];for(const t in n)e.push(t);if(e.length>0)throw new NI(`${e.length} of ${r} weights are not set: `+e)}UA(i)}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers "+PD,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const n=function e(t,n){if(null==t)return null;if("string"==typeof t)return zI(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){const r=[],i=t.length;for(let a=0;a<i;++a){const i=t[a];jD(n,a,i)?r.push(i):r.push(e(i,n))}return r}{const n={};for(const r of Object.keys(t)){const i=t[r];n[zI(r)]="name"!==r&&"className"!==r||"string"!=typeof i?e(i,r):i}return n}}(this.updatedConfig());return t?JSON.stringify(n):n}call(e,t){return Jx(()=>{e=BI(e);const n=new FD;for(let t=0;t<this.inputs.length;++t)n.add(this.inputs[t],e[t]);return BD(this.outputs,n,t)})}computeMask(e,t){return Jx(()=>{let n;return e=BI(e),n=null==t?PI(null,e.length):BI(t),this.runInternalGraph(e,n)[1]})}computeOutputShape(e){const t=PA(e);if(t.length!==this.inputLayers.length)throw new NI(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const n={};for(let o=0;o<t.length;o++)n[this.inputLayers[o].name+"_0_0"]=t[o];const r=Object.keys(this.nodesByDepth).map(e=>parseInt(e,10)).sort(qI);if(r.length>1)for(const o of r){const e=this.nodesByDepth[o];for(const t of e){const e=t.outboundLayer;if(-1!==this.inputLayers.map(e=>e.id).indexOf(e.id))continue;const r=[];for(let o=0;o<t.inboundLayers.length;o++)r.push(n[`${t.inboundLayers[o].name}_${t.nodeIndices[o]}_${t.tensorIndices[o]}`]);const i=PA(e.computeOutputShape($I(r))),a=e.inboundNodes.indexOf(t);for(let t=0;t<i.length;t++)n[`${e.name}_${a}_${t}`]=i[t]}}const i=[],a=[];for(let o=0;o<this.outputLayers.length;o++)a.push(`${this.outputLayers[o].name}_${this.outputLayersNodeIndices[o]}_${this.outputLayersTensorIndices[o]}`);for(let o=0;o<a.length;o++){const e=a[o];FI(e in n),i.push(n[e])}return $I(i)}runInternalGraph(e,t){null==t&&(t=PI(null,e.length));const n={};for(let s=0;s<this.inputs.length;++s)n[this.inputs[s].id]=[e[s],t[s]];const r=Object.keys(this.nodesByDepth).map(e=>parseInt(e,10)).sort(qI);for(const s of r){const e=this.nodesByDepth[s];for(const t of e){const e=t.outboundLayer,r=t.inputTensors,i=t.outputTensors,a=new Array;for(const t of r)t.id in n&&a.push(n[t.id]);if(a.length===r.length){let r,o,s,l,u={};if(null!=t.callArgs&&(u=t.callArgs),1===a.length){const[t,n]=a[0];null==u.mask&&(u.mask=n),s=BI(e.call(t,u)),l=BI(e.computeMask(t,n)),r=[t],o=[n]}else r=a.map(e=>e[0]),o=a.map(e=>e[1]),null==u.mask&&(u.mask=o),s=BI(e.call(r,u)),l=BI(e.computeMask(r,o));if(e.activityRegularizer)throw new jI("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let e=0;e<i.length;++e)n[i[e].id]=[s[e],l[e]]}}}const i=[],a=[],o=[];for(const s of this.outputs){FI(s.id in n,`Could not compute output ${s.name} : ${s.id}`);const[e,t]=n[s.id];o.push(e.shape),i.push(e),a.push(t)}return[i,a,o]}buildNodeConversionMap(e){const t={};let n;for(const r of this.layers){n=r instanceof WD?1:0;for(let e=0;e<r.inboundNodes.length;e++){const i=WD.nodeKey(r,e);this.containerNodes.has(i)&&(t[i]=n,n+=1)}}return t}getLayer(e,t){if(null!=t){if(this.layers.length<=t)throw new NI(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}if(null==e)throw new NI("Provide either a layer name or layer index");for(const n of this.layers)if(n.name===e)return n;throw new NI("No such layer: "+e)}calculateLosses(){return Jx(()=>{const e=[];for(const t of this.layers)for(let n=0;n<t.inboundNodes.length;++n){const r=WD.nodeKey(t,n);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[];for(const a of this.layers){const e=a.getClassName(),r=a.getConfig(),i=[];for(let n=0;n<a.inboundNodes.length;n++){const e=a.inboundNodes[n],r=WD.nodeKey(a,n);let o={};if(this.containerNodes.has(r)){if(e.callArgs)try{JSON.stringify(e.callArgs),o=e.callArgs}catch(rBe){console.warn(`Layer ${a.name} was passed non-serializable keyword arguments: `+e.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),o={}}if(e.inboundLayers.length>0){const n=[];for(let r=0;r<e.inboundLayers.length;r++){const i=e.inboundLayers[r],a=e.tensorIndices[r];let s=t[WD.nodeKey(i,e.nodeIndices[r])];null==s&&(s=0),n.push([i.name,s,a,o])}i.push(n)}}}const o={};o.name=a.name,o.className=e,o.config=r,o.inboundNodes=i,n.push(o)}e.layers=n;const r=[];for(let a=0;a<this.inputLayers.length;a++){const e=this.inputLayers[a],n=WD.nodeKey(e,this.inputLayersNodeIndices[a]);if(!this.containerNodes.has(n))continue;let i=t[n];null==i&&(i=0),r.push([e.name,i,this.inputLayersTensorIndices[a]])}e.inputLayers=r;const i=[];for(let a=0;a<this.outputLayers.length;a++){const e=this.outputLayers[a],n=WD.nodeKey(e,this.outputLayersNodeIndices[a]);if(!this.containerNodes.has(n))continue;let r=t[n];null==r&&(r=0),i.push([e.name,r,this.outputLayersTensorIndices[a]])}return e.outputLayers=i,e}static fromConfig(e,t,n={},r=!1){const i={},a={};function o(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function s(e,t){const n=[];let r;for(const a of t){const s=a[0],l=a[1],u=a[2];if(r=null==a[3]?{}:a[3],!(s in i))return void o(e,t);const c=i[s];if(c.inboundNodes.length<=l)return void o(e,t);n.push(c.inboundNodes[l].outputTensors[u])}n.length>0&&e.apply($I(n),r)}function l(e){const n=e.name,a=lD(e,null!=t.customObjects?t.customObjects:{});a.setFastWeightInitDuringBuild(r),i[n]=a,e.inboundNodes.forEach(e=>{if(!(e instanceof Array))throw new NI("Corrupted configuration, expected array for nodeData: "+e);o(a,e)})}const u=t.name,c=t.layers;for(const m of c)l(m);for(;!YI(a);)for(const e of c){const t=i[e.name];if(t.name in a){const e=a[t.name];delete a[t.name];for(const n of e)s(t,n)}}const d=[],h=[],f=t.inputLayers;for(const m of f){const e=m[0],t=m[1],n=m[2];FI(e in i),d.push(i[e].inboundNodes[t].outputTensors[n])}const p=t.outputLayers;for(const m of p){const e=m[0],t=m[1],n=m[2];FI(e in i),h.push(i[e].inboundNodes[t].outputTensors[n])}return new e({inputs:d,outputs:h,name:u})}get stateful(){if(this._stateful)throw new NI("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){Jx(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}function VD(e,t){return function(e,t,n){const r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map(e=>null);if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error(`Provided classWeight is an array of ${e.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){const n=[];return t.forEach(t=>{n.push(t in e?e[t]:null)}),n}throw new Error(`The model has multiple (${r}) outputs, so classWeight must be either an array with ${r} elements or an object with ${t} keys. Provided classWeight not understood: ${JSON.stringify(e)}`)}(e,t)}async function qD(e,t,n,r){if(null!=t||null!=r)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const t=Jx(()=>{if(1===e.shape.length)return e.clone();if(2===e.shape.length){if(e.shape[1]>1)return e.argMax(1);if(1===e.shape[1])return e.reshape([e.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${e.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}throw new Error(`Unexpected rank of target (y) tensor (${e.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),r=Array.from(await t.data());Qx(t);const i=[];return r.forEach(e=>{if(null==n[e])throw new Error(`classWeight must contain all classes in the training data. The class ${e} exists in the data but not in classWeight`);i.push(n[e])}),TE(i,"float32")}return null}function GD(e,t){return pw(e,t)}function YD(e,t){let n,i;n=t.xs,i=t.ys,r.assert(null!=n&&null!=i,()=>"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+t);const a=XD("input",e.inputNames,n),o=XD("output",e.outputNames,i),s=a[0].shape[0];r.assert(a.length===e.inputs.length,()=>`LayersModel has ${e.inputs.length} inputs, but the dataset provides ${a.length} inputs.  (Expected input keys: `+JSON.stringify(e.inputNames)+")"),r.assert(o.length===e.outputs.length,()=>`LayersModel has ${e.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: `+JSON.stringify(e.outputNames)+")");for(let l=0;l<a.length;l++)r.assert(a[l].shape[0]===s,()=>`Batch size mismatch: input ${e.inputNames[l]} has ${a[l].shape[0]}; expected  ${s} based on input ${e.inputNames[0]}.`);for(let l=0;l<o.length;l++)r.assert(o[l].shape[0]===s,()=>`Batch size mismatch: output ${e.outputNames[l]} has ${o[l].shape[0]}; expected  ${s} based on input ${e.inputNames[0]}.`);return{xs:a,ys:o}}function XD(e,t,n){if(n instanceof fy)return[n];if(Array.isArray(n))return r.assert(n.length===t.length,()=>`Received an array of ${n.length} Tensors, but expected ${t.length} to match the ${e} keys ${t}.`),n;{const r=[];for(const i of t){if(null==n[i])throw new NI(`The feature data generated by the dataset lacks the required ${e} key '${i}'.`);r.push(n[i])}return r}}function KD(e){return"function"==typeof e.iterator}function ZD(e){r.assert(e>0&&Number.isInteger(e),()=>"batchSize is required to be a positive integer, but got "+e)}function JD(e,t,n){return null==e?[null]:Array.isArray(e)?e.map(e=>jO(e,t,n-t)):jO(e,t,n-t)}function QD(e,t){return Jx(()=>null==e?null:Array.isArray(e)?e.map(e=>QD(e,t)):UO(e,"int32"===t.dtype?t:t.toInt()))}function eM(e,t){const n=[];let r=0,i=null;for(;r<e;)i=r+t,i>=e&&(i=e),n.push([r,i]),r=i;return n}function tM(e){const t=[];e instanceof fy&&(e=[e]);for(let n=0;n<e.length;++n){const r=e[n];if(1===r.rank)t.push(NO(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function nM(e,t){if(null==e)return;const n=[];if(t instanceof fy)n.push(t.id);else if(Array.isArray(t))t.forEach(e=>n.push(e.id));else if(null!=t)for(const i in t)n.push(t[i].id);const r=[];if(e instanceof fy)-1===n.indexOf(e.id)&&r.push(e);else if(Array.isArray(e))e.forEach(e=>{-1===n.indexOf(e.id)&&r.push(e)});else if(null!=e)for(const i in e){const t=e[i];-1===n.indexOf(t.id)&&r.push(t)}r.forEach(e=>{e.isDisposed||e.dispose()})}function rM(e){return Array.isArray(e)}function iM(e){return!function(e){return e instanceof fy}(e)&&!rM(e)}function aM(e,t,n,r=!0,i=""){if(null==t||0===t.length){if(null!=e){let t=!1;if(rM(e)&&e.length>0)t=!0;else if(iM(e)){for(const n in e)if(e.hasOwnProperty(n)){t=!0;break}}else t=!0;if(t)throw new NI(`Error when checking model ${i} expected no data, but got `+e)}return[]}if(null==e)return t.map(e=>null);let a;if(iM(e)){e=e,a=[];for(const n of t){if(null==e[n])throw new NI(`No data provided for "${n}". Need data for each key in: `+t);a.push(e[n])}}else if(rM(e)){if((e=e).length!==t.length)throw new NI(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): `+e);a=e}else{if(e=e,t.length>1)throw new NI(`The model ${i} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape `+e.shape);a=[e]}if(a=tM(a),null!=n)for(let o=0;o<t.length;++o){if(null==n[o])continue;const e=a[o];if(e.shape.length!==n[o].length)throw new NI(`Error when checking ${i}: expected ${t[o]} to have ${n[o].length} dimension(s). but got array with shape `+e.shape);for(let a=0;a<n[o].length;++a){if(0===a&&!r)continue;const s=e.shape[a],l=n[o][a];if(null!=l&&l>=0&&s!==l)throw new NI(`Error when checking ${i}: expected ${t[o]} to have shape [${n[o]}], but got array with shape [${e.shape}].`)}}return a}function oM(e,t,n,r=!0,i=""){let a;if(Array.isArray(e)){if(e.length!==t.length)throw new NI(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${e.length} Tensors(s).`);a=e}else{if(t.length>1)throw new NI(`The model expects ${t.length} ${i} Tensors, but only received one Tensor. Found: array with shape `+JSON.stringify(e.shape)+".");a=[e]}if(null!=n)for(let o=0;o<t.length;++o){if(null==n[o])continue;const e=a[o];if(e.shape.length!==n[o].length)throw new NI(`Error when checking ${i}: expected ${t[o]} to have ${n[o].length} dimension(s), but got array with shape `+JSON.stringify(e.shape));for(let a=0;a<n[o].length;++a){if(0===a&&!r)continue;const s=e.shape[a],l=n[o][a];if(null!=l&&l!==s)throw new NI(`Error when checking ${i}: expected ${t[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(e.shape)}.`)}}}class sM extends WD{constructor(e){super(e),this.isTraining=!1}summary(e,t,n=console.log){if(!this.built)throw new NI("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");!function(e,t,n,r=console.log){const i=function(e){let t=!0;const n=[],r=[];for(const i in e.nodesByDepth)n.push(e.nodesByDepth[i]);for(const i of n){if(i.length>1||1===i.length&&i[0].inboundLayers.length>1){t=!1;break}r.push(...i)}if(t)for(const i of e.layers){let e=!1;for(const n of i.inboundNodes)if(-1!==r.indexOf(n)){if(e){t=!1;break}e=!0}if(!t)break}return t}(e),a=["Layer (type)","Output shape","Param #"];let o;if(i?(t=t||65,n=n||[.45,.85,1]):(t=t||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map(e=>Math.floor(t*e))),!i){a.push("Receives inputs"),o=[];for(const t in e.nodesByDepth)o.push(...e.nodesByDepth[t])}r("_".repeat(t)),DD(a,n,r),r("=".repeat(t));const s=e.layers;for(let c=0;c<s.length;++c)i?MD(s[c],n,r):ND(s[c],n,o,r),r((c===s.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const l=function(e){let t;return t=$A(null!=e.collectedTrainableWeights?e.collectedTrainableWeights:e.trainableWeights),t}(e),u=$A(e.nonTrainableWeights);r("Total params: "+(l+u)),r("Trainable params: "+l),r("Non-trainable params: "+u),r("_".repeat(t))}(this,e,t,n)}compile(e){if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){const t={Adagrad:()=>zk.adagrad(.01),Adadelta:()=>zk.adadelta(1,.95,AI()),Adam:()=>zk.adam(.001,.9,.999,AI()),Adamax:()=>zk.adamax(.002,.9,.999,AI(),0),RMSProp:()=>zk.rmsprop(.001,.9,0,AI()),SGD:()=>zk.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new NI("Unknown Optimizer "+e)}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof kw))throw new NI("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new NI(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(e=>yD(e))}else{const n=yD(e.loss);this.outputs.forEach(e=>{t.push(n)})}else{e.loss=e.loss;for(const t in e.loss)if(-1===this.outputNames.indexOf(t))throw new NI(`Unknown entry in loss dictionary: "${t}". Only expected the following keys: `+this.outputNames);for(const n of this.outputNames)null==e.loss[n]&&console.warn(`Output "${n}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${n} during training`),t.push(yD(e.loss[n]))}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let a=0;a<this.outputs.length;++a){const e=this.internalOutputShapes[a];this.feedOutputNames.push(this.outputNames[a]),this.feedOutputShapes.push(e),this.feedLossFns.push(this.lossFunctions[a])}const n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],_O("loss",()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;const t=this.lossFunctions[e];this.outputs.length>1&&(this.metricsTensors.push([t,e]),this.metricsNames.push(this.outputNames[e]+"_loss"))}});const r=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map(e=>[]);let n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+e);n=e}if(Array.isArray(n))return t.map(e=>n);{const e=[];for(const r of t){let t=n.hasOwnProperty(r)?n[r]:[];Array.isArray(t)||(t=[t]),e.push(t)}return e}}(e.metrics,this.outputNames),i=(e,t,n)=>{this.outputNames.length>1&&(t=this.outputNames[e]+"_"+t),this.metricsNames.push(t),this.metricsTensors.push([n,e])};_O("metric",()=>{for(let e=0;e<this.outputs.length;++e)-1===n.indexOf(e)&&(t=>{let n,r,a;for(const o of t){if("string"==typeof o&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(o)){const t=this.internalOutputShapes[e];let i;1===t[t.length-1]||this.lossFunctions[e]===mD?-1!==["accuracy","acc"].indexOf(o)?r=bD:-1!==["crossentropy","ce"].indexOf(o)&&(r=SD):this.lossFunctions[e]===pD?-1!==["accuracy","acc"].indexOf(o)?r=ED:-1!==["crossentropy","ce"].indexOf(o)&&(r=kD):-1!==["accuracy","acc"].indexOf(o)?r=xD:-1!==["crossentropy","ce"].indexOf(o)&&(r=TD),-1!==["accuracy","acc"].indexOf(o)?i="acc":-1!==["crossentropy","ce"].indexOf(o)&&(i="ce"),a=r,n=""+i}else{const e=ID(o);a=e,n=""+OD(o)}let t;_O(n,()=>{t=a}),i(e,n,t)}})(r[e])}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,n={}){const r=null==n.batchSize?32:n.batchSize;ZD(r);const i=this.standardizeUserDataXY(e,t,!0,r);try{const a=i[0].concat(i[1]);return this.makeTestFunction(),$I(this.testLoop(this.testFunction,a,r,n.verbose,n.steps))}finally{nM(i[0],e),nM(i[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),async function(e,t,n){const i=null!=(n=n||{}).batches,a=e.testFunction;let o=[];if(n.verbose>0)throw new jI("Verbose mode is not implemented yet.");r.assert(!i||n.batches>0&&Number.isInteger(n.batches),()=>"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(n.batches));const s="function"==typeof t.next?t:await t.iterator();let l=0,u=0;for(;!i||u<n.batches;){const t=await s.next();if(o=Jx(()=>{if(t.value){const{xs:n,ys:r}=YD(e,t.value),i=n.concat(r),s=Jx(()=>a(i));if(Qx(i),0===u)for(let e=0;e<s.length;++e)o.push(Tw(0));const c=i[0].shape[0];for(let e=0;e<s.length;++e){const t=s[e],n=o[e];o[e]=Jx(()=>dw(o[e],pw(c,t))),u>0&&Qx(n)}Qx(s),l+=c,++u}return o}),t.done){i&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let r=0;r<o.length;++r){const e=o[r];o[r]=fw(o[r],l),Qx(e)}return $I(o)}(this,e,t)}checkNumSamples(e,t,n,r="steps"){let i;if(null!=n){if(i=null,null!=t)throw new NI(`If ${r} is set, batchSize must be null or undefined.Got batchSize = `+t)}else{if(null==e)throw new NI("Either the input data should have a defined shape, or "+r+" shoud be specified.");i=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return i}execute(e,t){if(Array.isArray(t)&&0===t.length)throw new NI("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(t),r=this.retrieveSymbolicTensors(n?t:[t]),i=new FD;if(e instanceof fy&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new NI(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let t=0;t<this.inputs.length;++t)i.add(this.inputs[t],e[t])}else for(const o of this.inputs){const t=e[o.name];if(null==t)throw new NI("No value is provided for the model's input "+o.name);i.add(o,t)}const a=BD(r,i);return n?a:a[0]}retrieveSymbolicTensors(e){const t=PI(null,e.length);let n=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],a=i.map(e=>e.name);for(let r=0;r<e.length;++r){const o=a.indexOf(e[r]);if(-1!==o&&(t[r]=i[o],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw t.forEach((t,r)=>{null==t&&n.push(e[r])}),new NI("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(n))}return t}predictLoop(e,t=32,n=!1){return Jx(()=>{const r=this.checkNumSamples(e);if(n)throw new jI("Verbose predictLoop() is not implemented yet.");const i=eM(r,t),a=this.outputs.map(e=>[]);for(let t=0;t<i.length;++t)Jx(()=>{const n=JD(e,i[t][0],i[t][1]),r=[];if(Array.isArray(n))for(let e=0;e<n.length;++e)r.push({key:this.inputs[e],value:n[e]});else r.push({key:this.inputs[0],value:n});const a=new FD(r);return BD(this.outputs,a)}).forEach((e,t)=>a[t].push(e));return $I(a.map(e=>T_(e,0)))})}predict(e,t={}){const n=tM(e);oM(n,this.inputNames,this.feedInputShapes,!1);try{const r=null==t.batchSize?32:t.batchSize;return ZD(r),this.predictLoop(n,r)}finally{nM(n,e)}}predictOnBatch(e){oM(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,n=!0,i){if(null==this.optimizer_)throw new MI("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const a=[];for(let r=0;r<this.feedOutputShapes.length;++r){const e=this.feedOutputShapes[r];a.push(this.feedLossFns[r]===pD?e.slice(0,e.length-1).concat([1]):e)}if(function(e,t,n){const i=GI(e.map(e=>e.shape[0]));i.sort();const a=GI(t.map(e=>e.shape[0]));if(a.sort(),i.length>1)throw new NI("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map(e=>e.shape)));if(a.length>1)throw new NI("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map(e=>e.shape)));if(i.length>0&&a.length>0&&!r.arraysEqual(i,a))throw new NI(`Input Tensors should have the same number of samples as target Tensors. Found ${i[0]} input sample(s) and ${a[0]} target sample(s).`)}(e=aM(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=aM(t,this.feedOutputNames,a,!1,"target")),function(e,t,n){const r=[cD,mD,fD];for(let i=0;i<e.length;++i){const a=e[i],o=t[i],s=n[i];if(null!=o){if(o===fD&&1===a.shape[a.shape.length-1])throw new NI(`You are passing a target array of shape ${a.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(-1!==r.indexOf(o)){const e=a.shape.slice(1),t=s.slice(1);for(let n=0;n<e.length;++n){const r=e[n],i=t[n];if(null!=i&&r!==i)throw new NI(`A target Tensor with shape ${a.shape} was passed for an output of shape ${s}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=i&&i>0&&e[0].shape[0]%i!=0)throw new NI(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,n,r,i=!0,a){const[o,s]=this.standardizeUserDataXY(e,t,i,a);if(null!=n)throw new Error("sample weight is not supported yet.");let l=null;if(null!=r){const e=VD(r,this.outputNames);l=[];for(let t=0;t<e.length;++t)l.push(await qD(s[t],null,e[t]))}return[o,s,l]}testLoop(e,t,n,r=0,i){return Jx(()=>{const a=this.checkNumSamples(t,n,i,"steps"),o=[];if(r>0)throw new jI("Verbose mode is not implemented yet.");if(null!=i)throw new jI("steps mode in testLoop() is not implemented yet");{const r=eM(a,n),i=TE(DO(0,a));for(let n=0;n<r.length;++n){const a=r[n][0],s=r[n][1],l=jO(i,a,s-a),u=QD(t,l),c=e(u);if(0===n)for(let e=0;e<c.length;++e)o.push(Tw(0));for(let e=0;e<c.length;++e)o[e]=dw(o[e],pw(s-a,c[e]))}for(let e=0;e<o.length;++e)o[e]=fw(o[e],a)}return o})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let n=0;n<e.length;++n){const r=e[n];let i=r;LI(e,r)>1&&(i+="_"+LI(e.slice(0,n),r)),t.push(i)}return t}makeTrainFunction(){return e=>{const t=[],n=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),a=[],o=this.collectedTrainableWeights.map(e=>e.read());return[this.optimizer_.minimize(()=>{const e=[];for(let t=0;t<this.inputs.length;++t)e.push({key:this.inputs[t],value:n[t]});const o=new FD(e),s=BD(this.outputs,o,{training:!0});let l;for(let n=0;n<this.lossFunctions.length;++n){let e=(0,this.lossFunctions[n])(r[n],s[n]);null!=i[n]&&(e=GD(e,i[n]));const a=KS(e);t.push(a),l=0===n?e:dw(l,e)}for(let n=0;n<this.metricsTensors.length;++n){let e;if(this.outputs.length>1&&n<this.outputs.length)e=t[n];else{const t=this.metricsTensors[n][1];e=KS((0,this.metricsTensors[n][0])(r[t],s[t]))}ew(e),a.push(e)}return l=KS(l),this.calculateLosses().forEach(e=>{l=dw(l,e)}),l},!0,o)].concat(a)}}makeTestFunction(){this.testFunction=e=>Jx(()=>{const t=[];let n;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let e=0;e<this.inputs.length;++e)a.push({key:this.inputs[e],value:r[e]});const o=new FD(a),s=BD(this.outputs,o);for(let e=0;e<this.lossFunctions.length;++e){const r=KS((0,this.lossFunctions[e])(i[e],s[e]));n=0===e?r:dw(n,r),t.push(n)}for(let e=0;e<this.metricsTensors.length;++e){const n=this.metricsTensors[e][1],r=KS((0,this.metricsTensors[e][0])(i[n],s[n]));t.push(r)}return t})}async fit(e,t,n={}){return async function(e,t,n,i={}){if(e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");let a,o,s,l,u,c,d;e.isTraining=!0;try{const h=null==i.batchSize?32:i.batchSize;ZD(h);const f=!1,p=await e.standardizeUserData(t,n,i.sampleWeight,i.classWeight,f,h);a=p[0],o=p[1],d=p[2];let m,g=!1;if(null!=i.validationData&&i.validationData.length>0){if(g=!0,2!==i.validationData.length)throw 3===i.validationData.length?new jI("validationData including sample weights is not supported yet."):new NI("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+i.validationData+" is invalid.");s=i.validationData[0],l=i.validationData[1];const t=!0,n=await e.standardizeUserData(s,l,null,null,t,h);u=n[0],c=n[1],m=u.concat(c)}else if(null!=i.validationSplit&&i.validationSplit>0&&i.validationSplit<1){g=!0;const e=Math.floor(a[0].shape[0]*(1-i.validationSplit)),t=a[0].shape[0];u=JD(a,e,t),a=JD(a,0,e),c=JD(o,e,t),o=JD(o,0,e),m=u.concat(c)}else null!=i.validationSteps&&(g=!0);const v=a.concat(o).concat(d);e.checkTrainableWeightsConsistency();const y=e.makeTrainFunction(),b=e.getDedupedMetricsNames();let x,w;g?(e.makeTestFunction(),x=e.testFunction,w=b.slice().concat(b.map(e=>"val_"+e))):(x=null,m=[],w=b.slice());const _=aD(i.callbacks,i.yieldEvery);return await async function(e,t,n,i,a,o,s,l,u,c,d,h,f,p,m){null==a&&(a=32),null==o&&(o=1),null==d&&(d=!0),null==f&&(f=0);let g=!1;null!=u&&null!=c&&(g=!0);const v=e.checkNumSamples(n,a,null,"steps_per_epoch");let y;null!=v&&(y=DO(0,v)),null==s&&(s=1);const{callbackList:b,history:x}=sD(l,s,o,f,v,null,a,g,h);b.setModel(e),e.history=x,await b.onTrainBegin(),e.stopTraining_=!1;for(let w=f;w<o;++w){await b.onEpochBegin(w);const o={};{if("batch"===d)throw new jI("batch shuffling is not implemneted yet");d&&r.shuffle(y);const s=TE(y),l=eM(v,a);for(let r=0;r<l.length;++r){const d={};if(await b.onBatchBegin(r,d),Jx(()=>{const h=l[r][0],f=l[r][1],p=jO(s,h,f-h);d.batch=r,d.size=f-h;const m=QD(n,p),v=t(m);for(let e=0;e<i.length;++e){const t=v[e];d[i[e]]=t,ew(t)}if(r===l.length-1&&g){const t=e.testLoop(u,c,a);for(let e=0;e<i.length;++e){const n=i[e],r=t[e];ew(r),o["val_"+n]=r}}}),await b.onBatchEnd(r,d),JA(d),e.stopTraining_)break}s.dispose()}if(await b.onEpochEnd(w,o),e.stopTraining_)break}return await b.onTrainEnd(),await e.history.syncData(),e.history}(e,y,v,b,h,i.epochs,i.verbose,_,x,m,i.shuffle,w,i.initialEpoch)}finally{e.isTraining=!1,nM(a,t),nM(o,n),nM(u,s),nM(c,l),null!=d&&Qx(d)}}(this,e,t,n)}async fitDataset(e,t){return async function(e,t,n){const i=null!=n.batchesPerEpoch;if(r.assert(null!=e.optimizer,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),r.assert(null!=n,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),r.assert(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),()=>"For fitDataset(), config.epochs is expected to be a positive integer, but got "+n.epochs),r.assert(!i||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+n.batchesPerEpoch),r.assert(null==n.validationSplit,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const a=null!=n.validationData;let o,s;if(a)if(KD(n.validationData))r.assert(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+n.validationBatches);else{const e=function(e){if(3===e.length)throw new jI("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(n.validationData);o=e.xs,s=e.ys}const l=e.makeTrainFunction(),u=e.getDedupedMetricsNames();let c;c=a?u.slice().concat(u.map(e=>"val_"+e)):u.slice();const d=aD(n.callbacks,n.yieldEvery),h=null==n.verbose?1:n.verbose,{callbackList:f,history:p}=sD(d,h,n.epochs,null,null,function(e,t){let n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}(t,n),null,a,c);f.setModel(e),e.history=p,await f.onTrainBegin(),e.stopTraining_=!1;let m=null==n.initialEpoch?0:n.initialEpoch,g=await t.iterator();for(;m<n.epochs;){const r={};await f.onEpochBegin(m);let c=0,d=0;for(i||(g=await t.iterator());!i||c<n.batchesPerEpoch;){const t=await g.next();if(i&&t.done){console.warn("You provided `batchesPerEpoch` as "+n.batchesPerEpoch+", but your dataset iterator ran out of data after "+c+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+n.batchesPerEpoch*n.epochs+" batches). You may need to use the repeat() function when building your dataset.");break}if(null!=t.value){const{xs:r,ys:i}=YD(e,t.value),a={};a.batch=d,a.size=r[0].shape[0],await f.onBatchBegin(d,a);const o=[];if(null!=n.classWeight){const t=VD(n.classWeight,e.outputNames);for(let e=0;e<t.length;++e)o.push(await qD(i[e],null,t[e]))}const s=r.concat(i).concat(o),h=l(s);Qx(s);for(let e=0;e<u.length;++e){const t=h[e];a[u[e]]=t,ew(t)}await f.onBatchEnd(d,a),JA(a),d++,c++}if(i?c>=n.batchesPerEpoch:t.done){if(a){let t;t=KD(n.validationData)?BI(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):BI(e.evaluate(o,s,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<e.metricsNames.length;++n)r["val_"+e.metricsNames[n]]=t[n]}break}if(e.stopTraining_)break}if(await f.onEpochEnd(m,r),m++,e.stopTraining_)break}return await f.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}(this,e,t)}async trainOnBatch(e,t){const n=await this.standardizeUserData(e,t),r=n[0],i=n[1],a=this.makeTrainFunction()(r.concat(i)),o=[];for(const s of a){const e=await s.data();o.push(e[0])}return Qx(a),$I(o)}getNamedWeights(e){const t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n);for(let a=0;a<r.length;++a)n&&!r[a].trainable||t.push({name:r[a].originalName,tensor:i[a]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const t=Kx().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-Kx().numTensors}return e}getLossIdentifiers(){let e;if("string"==typeof this.loss)e=zI(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if("string"!=typeof e)throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(e=>zI(e))}else{const t=Object.keys(this.loss);e={};const n=this.loss;for(const r of t){if("string"!=typeof n[r])throw new Error("Serialization of non-string loss is not supported.");e[r]=zI(n[r])}}return e}getMetricIdentifiers(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[zI(OD(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>zI(OD(e)));{const e={};for(const t in this.metrics)e[t]=zI(OD(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const t=lD(RD(e.optimizer_config));let n,r;if("string"==typeof e.loss)n=UI(e.loss);else if(Array.isArray(e.loss))n=e.loss.map(e=>UI(e));else if(null!=e.loss){n={};for(const t in e.loss)n[t]=UI(e.loss[t])}if(Array.isArray(e.metrics))r=e.metrics.map(e=>UI(e));else if(null!=e.metrics){r={};for(const t in e.metrics)r[t]=UI(e.metrics[t])}this.compile({loss:n,metrics:r,optimizer:t})}async save(e,t){if("string"==typeof e){const t=o.getSaveHandlers(e);if(0===t.length)throw new NI(`Cannot find any save handlers for URL '${e}'`);if(t.length>1)throw new NI(`Found more than one (${t.length}) save handlers for URL '${e}'`);e=t[0]}if(null==e.save)throw new NI("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await o.encodeWeights(this.getNamedWeights(t)),r={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v"+PD,convertedBy:null};if(null!=t&&t.includeOptimizer&&null!=this.optimizer){r.trainingConfig=this.getTrainingConfig();const e="optimizer",{data:t,specs:i}=await o.encodeWeights(await this.optimizer.getWeights(),e);n.specs.push(...i),n.data=o.concatenateArrayBuffers([n.data,t])}return null!=this.userDefinedMetadata&&(AD(this.userDefinedMetadata,this.name,!0),r.userDefinedMetadata=this.userDefinedMetadata),r.weightData=n.data,r.weightSpecs=n.specs,e.save(r)}setUserDefinedMetadata(e){AD(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}sM.className="Model",h.registerClass(sM);class lM extends sM{}async function uM(e,t){"modelTopology"in e||(e={modelTopology:e});let n=(e=e).modelTopology;null!=n.model_config&&(n=n.model_config);const r=lD(RD(n),t);if(null!=e.weightsManifest){const t=await o.loadWeights(e.weightsManifest,e.pathPrefix,r.weights.map(e=>e.originalName)),n={};for(const e of r.weights)n[e.originalName]=t[e.originalName];r.loadWeights(n),Qx(t)}return r}lM.className="Functional",h.registerClass(lM);class cM extends sM{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=null!=e.name?e.name:jA("sequential_"),null!=e.layers)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(e=>e<0))throw new NI("Negative dimension size caused by adding layer "+e.name+" with input shape ["+e.inboundNodes[0].inputTensors[0].shape+"]")}add(e){const t=e instanceof cM||e instanceof sM;let n;if(t){if(n=e,1!==n.outputs.length)throw new NI("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new NI("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new NI("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const t=KA({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(t)}if(t)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==e.inboundNodes.length)throw new NI(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(1!==e.inboundNodes[0].outputTensors.length)throw new NI("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=function e(t,n,r){if((null==n||null!=r&&r>0)&&(n=t.sourceLayer,r=t.nodeIndex),0===n.inboundNodes.length)return[t];{const t=n.inboundNodes[r];if(0===t.inboundLayers.length)return t.inputTensors;{const n=[];for(let r=0;r<t.inboundLayers.length;r++){const i=e(t.inputTensors[r],t.inboundLayers[r],t.nodeIndices[r]);for(const e of i)-1===n.indexOf(e)&&n.push(e)}return n}}}(this.outputs[0])}this.inboundNodes=[],new qA({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:PI(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(e=>e.shape),outputShapes:this.outputs[0].shape})}else{const t=e.apply(this.outputs[0]);if(Array.isArray(t))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[t],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return null==this.model&&this.build(),this.model.call(e,t)}build(e){if(LA(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new sM({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,n=console.log){this.built||this.build(),super.summary(e,t,n)}setWeights(e){null==this.model&&this.build(),this.model.setWeights(e)}evaluate(e,t,n={}){if(!this.built)throw new MI("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}async evaluateDataset(e,t){if(!this.built)throw new MI("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return null==this.model&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,n={}){if(!this.built)throw new MI("The model needs to be compiled before being used.");return this.model.fit(e,t,n)}async fitDataset(e,t){if(!this.built)throw new MI("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,n={},i=!1){let a,o={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new NI("Legacy serialization format not supported yet.");a=t}else r.assert(null!=t.layers,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),a=t.layers,delete t.layers,o=t;const s=new e(o);if(!(s instanceof cM))throw new jI("Sequential.fromConfig called on non-Sequential input: "+s);for(const r of a){const e=lD(r,void 0,i);i&&e.setFastWeightInitDuringBuild(!0),s.add(e)}return s}set stopTraining(e){if(null==this.model)throw new NI("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(null==this.model)throw new NI("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const n={};n.className=t.getClassName(),n.config=t.getConfig(),e.push(n)}return{name:this.name,layers:e}}}function dM(e){return new sM(e)}function hM(e){return new cM(e)}function fM(e,t){return null==t&&(t={}),async function(e,t){if(null==t&&(t={}),"string"==typeof e){const n=o.getLoadHandlers(e,t);if(0===n.length)n.push(o.browserHTTPRequest(e,t));else if(n.length>1)throw new NI(`Found more than one (${n.length}) load handlers for URL '${e}'`);e=n[0]}return async function(e,t,n){if(null==n&&(n={}),null==e.load)throw new NI("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const r=await e.load();let i=r.modelTopology;null!=i.model_config&&(i=i.model_config);const a=null==n.strict||n.strict,s=null!=r.weightData&&null!=r.weightSpecs&&a,l=lD(RD(i),void 0,s),u=r.trainingConfig;if(null!=u&&l.loadTrainingConfig(u),null!=r.userDefinedMetadata&&l.setUserDefinedMetadata(r.userDefinedMetadata),null!=r.weightData){if(null==r.weightSpecs)throw new NI("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:e,optimizerWeights:t}=function(e,t){const n=o.decodeWeights(e,t),r={},i=[];return t.forEach(e=>{"optimizer"===e.group?i.push({name:e.name,tensor:n[e.name]}):r[e.name]=n[e.name]}),{modelWeights:r,optimizerWeights:i}}(r.weightData,r.weightSpecs);l.loadWeights(e,a),null!=l.optimizer&&t.length>0&&await l.optimizer.setWeights(t),Qx(e),Qx(t.map(e=>e.tensor))}return l}(e,0,t)}(e,t)}function pM(e){return KA(e)}function mM(e,t){oD.registerCallbackConstructor(e,t)}cM.className="Sequential",h.registerClass(cM);class gM extends h.Serializable{getConfig(){return{}}}class vM extends gM{apply(e,t=1){return function(e,t=1){if(1!==t)throw new jI(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return sS(e)}(e,t)}}vM.className="elu",h.registerClass(vM);class yM extends gM{apply(e){return FE(e)}}yM.className="selu",h.registerClass(yM);class bM extends gM{apply(e){return IE(e)}}bM.className="relu",h.registerClass(bM);class xM extends gM{apply(e){return Jx(()=>JS(6,IE(e)))}}xM.className="relu6",h.registerClass(xM);class wM extends gM{apply(e){return e}}wM.className="linear",h.registerClass(wM);class _M extends gM{apply(e){return k_(e)}}_M.className="sigmoid",h.registerClass(_M);class SM extends gM{apply(e){return function(e){return Jx(()=>{const t=dw(.5,pw(.2,e));return L_(t,0,1)})}(e)}}SM.className="hardSigmoid",h.registerClass(SM);class EM extends gM{apply(e){return RS(e)}}EM.className="softplus",h.registerClass(EM);class TM extends gM{apply(e){return function(e){return Jx(()=>fw(e,Nw(e).add(1)))}(e)}}TM.className="softsign",h.registerClass(TM);class kM extends gM{apply(e){return I_(e)}}kM.className="tanh",h.registerClass(kM);class CM extends gM{apply(e,t=-1){return GE(e,t)}}CM.className="softmax",h.registerClass(CM);class IM extends gM{apply(e,t=-1){return $S(e,t)}}IM.className="logSoftmax",h.registerClass(IM);class OM extends gM{apply(e,t=1){return Jx(()=>k_(e.mul(t)).mul(e))}}function AM(e){return e.getClassName()}function DM(e,t={}){return VI(e,h.SerializationMap.getMap().classNameMap,t,"activation")}function MM(e){if(null==e)return DM({className:"linear",config:{}});if("string"==typeof e){const t={};return t.className=e,t.config={},DM(t)}return e instanceof gM?e:DM(e)}function NM(e){if(null!=e&&"object"!=typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: "+e)}OM.className="swish",h.registerClass(OM);class jM extends h.Serializable{}class RM extends jM{constructor(e){super(),NM(e),this.l1=null==e||null==e.l1?.01:e.l1,this.l2=null==e||null==e.l2?.01:e.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(e){return Jx(()=>{let t=YS([1]);return this.hasL1&&(t=dw(t,LS(pw(this.l1,Nw(e))))),this.hasL2&&(t=dw(t,LS(pw(this.l2,HO(e))))),t.asScalar()})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}RM.className="L1L2",h.registerClass(RM);const PM={l1l2:"L1L2"};function FM(e){return WI(e)}function LM(e,t={}){return VI(e,h.SerializationMap.getMap().classNameMap,t,"regularizer")}function $M(e){return null==e?null:"string"==typeof e?LM({className:e in PM?PM[e]:e,config:{}}):e instanceof jM?e:LM(e)}class BM extends YA{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,null!=e&&(this.maxValue=e.maxValue)}call(e,t){e=FA(e);let n=IE(e);return null!=this.maxValue&&(n=L_(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}BM.className="ReLU",h.registerClass(BM);class zM extends YA{constructor(e){super(null==e?{}:e),this.DEFAULT_ALPHA=.3,null==e&&(e={}),this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=FA(e);return CS(n,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}zM.className="LeakyReLU",h.registerClass(zM);class UM extends YA{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),this.supportsMasking=!0,this.alphaInitializer=mA(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=$M(e.alphaRegularizer),this.alphaConstraint=lO(e.alphaConstraint),null==e.sharedAxes)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new NI("Expected sharedAxes to be a number or an array of numbers, but got "+e.sharedAxes);this.sharedAxes=[e.sharedAxes]}}build(e){const t=(e=LA(e)).slice(1);if(null!=this.sharedAxes)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let r=1;r<e.length;++r)n[r]=e[r];this.inputSpec=[new HA({ndim:e.length,axes:n})],this.built=!0}call(e,t){return e=FA(e),mE(e,this.alpha.read())}getConfig(){const e={alphaInitializer:pA(this.alphaInitializer),alphaRegularizer:FM(this.alphaRegularizer),alphaConstraint:oO(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}UM.className="PReLU",h.registerClass(UM);class HM extends YA{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==this.DEFAULT_ALPHA)throw new jI(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=FA(e);return sS(n)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}HM.className="ELU",h.registerClass(HM);class WM extends YA{constructor(e){super(null==e?{}:e),this.DEFAULT_THETA=1,null==e&&(e={}),this.theta=null==e.theta?this.DEFAULT_THETA:e.theta}call(e,t){const n=FA(e);return n.mul(MO(n.greater(this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}WM.className="ThresholdedReLU",h.registerClass(WM);class VM extends YA{constructor(e){super(null==e?{}:e),this.DEFAULT_AXIS=1,null==e&&(e={}),this.softmax=(new CM).apply,this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis}call(e,t){const n=FA(e);return this.softmax(n,this.axis)}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function qM(e,t,n){if("number"==typeof e)return PI(e,t);if(e.length!==t)throw new NI(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${e.length} elements.`);for(let i=0;i<t;++i){const a=e[i];if((r=a)!==parseInt(r.toString(),10))throw new NI(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(e)} including a non-integer number `+a)}return e;var r}function GM(e,t,n,r,i=1){if(null==e)return e;let a;return a="same"===n?e:e-(t+(t-1)*(i-1))+1,Math.floor((a+r-1)/r)}function YM(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+AO([n-t,0]);else{if("same"!==r)throw new NI(`Unsupport padding mode: ${r}.`);e*=t}return e}function XM(e,t){return Jx(()=>(yO(t),"channelsFirst"===t?ax(e,[0,2,3,1]):e))}function KM(e,t){return Jx(()=>(yO(t),"channelsFirst"===t?ax(e,[0,2,3,4,1]):e))}function ZM(e,t,n,r=[1,1],i="valid",a,o,s=null){return Jx(()=>{if(null==a&&(a="channelsLast"),yO(a),3!==e.rank&&4!==e.rank)throw new NI(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${e.rank}.`);if(3!==t.rank&&4!==t.rank)throw new NI(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${e.rank}.`);let l=XM(e,a);if("causal"===i)throw new jI("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=m.conv2d({x:l,filter:t,strides:r,pad:"same"===i?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===a&&(l=ax(l,[0,3,1,2])),l})}VM.className="Softmax",h.registerClass(VM);class JM extends YA{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",JM.verifyArgs(t),this.rank=e,ZI(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new jI(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=qM(t.kernelSize,e,"kernelSize"),this.strides=qM(null==t.strides?1:t.strides,e,"strides"),this.padding=null==t.padding?"valid":t.padding,bO(this.padding),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,yO(this.dataFormat),this.activation=MM(t.activation),this.useBias=null==t.useBias||t.useBias,this.biasInitializer=mA(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=lO(t.biasConstraint),this.biasRegularizer=$M(t.biasRegularizer),this.activityRegularizer=$M(t.activityRegularizer),this.dilationRate=qM(null==t.dilationRate?1:t.dilationRate,e,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new NI("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(this.dilationRate));if(2===this.rank){if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new NI("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(this.dilationRate))}else if(3===this.rank)if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new NI("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(this.dilationRate))}static verifyArgs(e){if(FI("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!KI(e.kernelSize,"number",1,3))throw new NI(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:AM(this.activation),useBias:this.useBias,biasInitializer:pA(this.biasInitializer),biasRegularizer:FM(this.biasRegularizer),activityRegularizer:FM(this.activityRegularizer),biasConstraint:oO(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class QM extends JM{constructor(e,t){super(e,t),this.kernel=null,QM.verifyArgs(t),this.filters=t.filters,ZI(this.filters,"filters"),this.kernelInitializer=mA(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=lO(t.kernelConstraint),this.kernelRegularizer=$M(t.kernelRegularizer)}build(e){e=LA(e);const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new NI("The channel dimension of the input should be defined. Found "+e[t]);const n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:n}}],this.built=!0}call(e,t){return Jx(()=>{let t;e=FA(e);const n=null==this.bias?null:this.bias.read(),r=JI(this.activation.getClassName());if(null!=r&&2===this.rank)t=ZM(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(1===this.rank)t=function(e,t,n,r=1,i="valid",a,o=1){return Jx(()=>{if(null==a&&(a="channelsLast"),yO(a),3!==e.shape.length)throw new NI("The input of a conv1dWithBias operation should be 3, but is "+e.shape.length+" instead.");if(3!==t.shape.length)throw new NI("The kernel for a conv1dWithBias operation should be 3, but is "+t.shape.length+" instead");if(null!=n&&1!==n.shape.length)throw new NI("The bias for a conv1dWithBias operation should be 1, but is "+t.shape.length+" instead");if("channelsFirst"===a&&(e=ax(e,[0,2,1])),"causal"===i)throw new jI("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let s=W_(e,t,r,"same"===i?"same":"valid","NWC",o);return null!=n&&(s=VO(s,n)),s})}(e,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)t=ZM(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new jI("convolutions greater than 3D are not implemented yet.");t=function(e,t,n,r=[1,1,1],i="valid",a,o){return Jx(()=>{if(null==a&&(a="channelsLast"),yO(a),4!==e.rank&&5!==e.rank)throw new NI("conv3dWithBias expects input to be of rank 4 or 5, but received "+e.rank+".");if(4!==t.rank&&5!==t.rank)throw new NI("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+e.rank+".");let s=KM(e,a);if("causal"===i)throw new jI("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=G_(s,t,r,"same"===i?"same":"valid","NDHWC",o),null!=n&&(s=VO(s,n)),"channelsFirst"===a&&(s=ax(s,[0,4,1,2,3])),s})}(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(t=this.activation.apply(t))}return t})}computeOutputShape(e){e=LA(e);const t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<n.length;++i){const e=GM(n[i],this.kernelSize[i],this.padding,this.strides[i],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[i]);t.push(e)}let r=[e[0]];return"channelsLast"===this.dataFormat?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:pA(this.kernelInitializer),kernelRegularizer:FM(this.kernelRegularizer),kernelConstraint:oO(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new NI("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(e.filters))}}class eN extends QM{constructor(e){super(2,e),eN.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&!KI(e.kernelSize,"number",1,2))throw new NI(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}eN.className="Conv2D",h.registerClass(eN);class tN extends QM{constructor(e){super(3,e),tN.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new NI(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}tN.className="Conv3D",h.registerClass(tN);class nN extends eN{constructor(e){if(super(e),this.inputSpec=[new HA({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new NI("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+this.padding)}build(e){if(4!==(e=LA(e)).length)throw new NI("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new NI("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new HA({ndim:4,axes:{[t]:n}})],this.built=!0}call(e,t){return Jx(()=>{let t=FA(e);if(4!==t.shape.length)throw new NI("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+t.shape.length);const n=t.shape;let r,i;"channelsFirst"===this.dataFormat?(r=2,i=3):(r=1,i=2);const a=n[i],o=this.kernelSize[1],s=this.strides[1],l=[n[0],YM(n[r],this.strides[0],this.kernelSize[0],this.padding),YM(a,s,o,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=ax(t,[0,2,3,1]));let u=q_(t,this.kernel.read(),l,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(u=ax(u,[0,3,1,2])),null!=this.bias&&(u=VO(u,this.bias.read(),this.dataFormat)),null!=this.activation&&(u=this.activation.apply(u)),u})}computeOutputShape(e){const t=(e=LA(e)).slice();let n,r,i;"channelsFirst"===this.dataFormat?(n=1,r=2,i=3):(n=3,r=1,i=2);const a=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],l=this.strides[1];return t[n]=this.filters,t[r]=YM(t[r],s,a,this.padding),t[i]=YM(t[i],l,o,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}nN.className="Conv2DTranspose",h.registerClass(nN);class rN extends QM{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==t.filters)throw new NI("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=t.kernelInitializer||null!=t.kernelRegularizer||null!=t.kernelConstraint)throw new NI("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=t.padding&&"same"!==t.padding&&"valid"!==t.padding)throw new NI(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received `+JSON.stringify(t.padding));this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=mA(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=$M(t.depthwiseRegularizer),this.depthwiseConstraint=lO(t.depthwiseConstraint),this.pointwiseInitializer=mA(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=$M(t.pointwiseRegularizer),this.pointwiseConstraint=lO(t.pointwiseConstraint)}build(e){if((e=LA(e)).length<this.rank+2)throw new NI(`Inputs to SeparableConv${this.rank}D should have rank `+(this.rank+2)+", but received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new NI("The channel dimension of the inputs should be defined, but found "+JSON.stringify(e[t]));const n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),i=[];for(let o=0;o<this.rank;++o)i.push(1);i.push(n*this.depthMultiplier,this.filters);const a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):null,this.inputSpec=[new HA({ndim:this.rank+2,axes:{[t]:n}})],this.built=!0}call(e,t){return Jx(()=>{let t;if(e=FA(e),1===this.rank)throw new jI("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(e=ax(e,[0,2,3,1])),t=LE(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(t=VO(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),"channelsFirst"===this.dataFormat&&(t=ax(t,[0,3,1,2])),t})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=pA(this.depthwiseInitializer),e.pointwiseInitializer=pA(this.pointwiseInitializer),e.depthwiseRegularizer=FM(this.depthwiseRegularizer),e.pointwiseRegularizer=FM(this.pointwiseRegularizer),e.depthwiseConstraint=oO(this.depthwiseConstraint),e.pointwiseConstraint=oO(this.pointwiseConstraint),e}}rN.className="SeparableConv";class iN extends rN{constructor(e){super(2,e)}}iN.className="SeparableConv2D",h.registerClass(iN);class aN extends QM{constructor(e){super(1,e),aN.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&!KI(e.kernelSize,"number",1,1))throw new NI(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}aN.className="Conv1D",h.registerClass(aN);class oN extends YA{constructor(e){super(e),this.cropping="number"==typeof e.cropping?[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:e.cropping,this.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return Jx(()=>{if(e=FA(e),"channelsLast"===this.dataFormat){const t=PO(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return PO(t,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const t=PO(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return PO(t,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}oN.className="Cropping2D",h.registerClass(oN);class sN extends YA{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==e.size?this.DEFAULT_SIZE:e.size,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat}computeOutputShape(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],null==e[2]?null:this.size[0]*e[2],null==e[3]?null:this.size[1]*e[3]]:[e[0],null==e[1]?null:this.size[0]*e[1],null==e[2]?null:this.size[1]*e[2],e[3]]}call(e,t){return Jx(()=>{let t=FA(e);const n=t.shape;if("channelsFirst"===this.dataFormat){t=ax(t,[0,2,3,1]);const e=t.resizeNearestNeighbor([this.size[0]*n[2],this.size[1]*n[3]]);return ax(e,[0,3,1,2])}return t.resizeNearestNeighbor([this.size[0]*n[1],this.size[1]*n[2]])})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}sN.className="UpSampling2D",h.registerClass(sN);class lN extends JM{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=mA(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=lO(e.depthwiseConstraint),this.depthwiseRegularizer=$M(e.depthwiseRegularizer)}build(e){if((e=LA(e)).length<4)throw new NI(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new NI(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const n=e[t];this.depthwiseKernel=this.addWeight("depthwise_kernel",[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier],null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}call(e,t){return Jx(()=>{let t=function(e,t,n=[1,1],r="valid",i,a){return Jx(()=>{null==i&&(i="channelsLast"),yO(i);let o=XM(e,i);if(4!==e.rank)throw new NI("Input for depthwiseConv2d is required to be 4-D, but is instead "+e.rank+"-D");if(4!==t.rank)throw new NI("depthwiseKernel is required to be 4-D, but is instead "+t.rank+"-D");return o=eS(o,t,n,"same"===r?"same":"valid","NHWC",a),"channelsFirst"===i&&(o=ax(o,[0,3,1,2])),o})}(e=FA(e),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(t=VO(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),t})}computeOutputShape(e){e=LA(e);const t="channelsFirst"===this.dataFormat?e[3]:e[2],n="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,r=GM("channelsFirst"===this.dataFormat?e[2]:e[1],this.kernelSize[0],this.padding,this.strides[0]),i=GM(t,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],n,r,i]:[e[0],r,i,n]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=pA(this.depthwiseInitializer),e.depthwiseRegularizer=FM(this.depthwiseRegularizer),e.depthwiseConstraint=oO(this.depthwiseRegularizer),e}}function uN(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new NI("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function i(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=i(t),constants:n=i(n)}}function cN(e,t,n,r=!1,i,a,o=!1,s=!1){return Jx(()=>{const l=t.shape.length;if(l<3)throw new NI(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(DO(2,l));if(t=ax(t,u),null!=a)throw new jI("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=i&&((i=i.asType("bool").asType("float32")).rank===l-1&&(i=cS(i,-1)),i=ax(i,u)),r&&(t=AE(t,0),null!=i&&(i=AE(i,0)));const c=[];let d,h=n;const f=t.shape[0],p=pT(t);let m,g;null!=i&&(m=pT(i));for(let t=0;t<f;++t){const n=p[t],r=Jx(()=>e(n,h));if(null==i)d=r[0],h=r[1];else{const e=Jx(()=>{const e=m[t],n=oE(e).sub(e);return{output:r[0].mul(e).add(h[0].mul(n)),newStates:h.map((t,i)=>r[1][i].mul(e).add(t.mul(n)))}});d=e.output,h=e.newStates}s&&c.push(d)}return s&&(g=nT(c,1)),[d,g,h]})}lN.className="DepthwiseConv2D",h.registerClass(lN);class dN extends YA{constructor(e){let t;if(super(e),null==e.cell)throw new NI("cell property is missing for the constructor of RNN.");if(t=Array.isArray(e.cell)?new bN({cells:e.cell}):e.cell,null==t.stateSize)throw new NI("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=null!=e.returnSequences&&e.returnSequences,this.returnState=null!=e.returnState&&e.returnState,this.goBackwards=null!=e.goBackwards&&e.goBackwards,this._stateful=null!=e.stateful&&e.stateful,this.unroll=null!=e.unroll&&e.unroll,this.supportsMasking=!0,this.inputSpec=[new HA({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){return null==this.states_?DO(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(e=>null):this.states_}setStates(e){this.states_=e}computeOutputShape(e){RA(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const n=t[0];let r;if(r=this.returnSequences?[e[0],e[1],n]:[e[0],n],this.returnState){const n=[];for(const r of t)n.push([e[0],r]);return[r].concat(n)}return r}computeMask(e,t){return Jx(()=>{Array.isArray(t)&&(t=t[0]);const e=this.returnSequences?t:null;if(this.returnState){const t=this.states.map(e=>null);return[e].concat(t)}return e})}get states(){if(null==this.states_){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let n=0;n<e;++n)t.push(null);return t}return this.states_}set states(e){this.states_=e}build(e){if(null!=this.numConstants)throw new jI("Constants support is not implemented in RNN yet.");RA(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new HA({shape:[t,null,...n]});const i=[e[0]].concat(e.slice(2));let a;if(this.cell.build(i),a=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!r.arraysEqual(this.stateSpec.map(e=>e.shape[e.shape.length-1]),a))throw new NI(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is `+this.cell.stateSize)}else this.stateSpec=a.map(e=>new HA({shape:[null,e]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){Jx(()=>{if(!this.stateful)throw new DI("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new NI("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)this.states_=Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(e=>YS([n,e])):[YS([n,this.cell.stateSize])];else if(null==e)Qx(this.states_),null!=this.keptStates&&(Qx(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(e=>YS([n,e])):this.states_[0]=YS([n,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new NI(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: `+e);!0===t?this.keptStates.push(this.states_.slice()):Qx(this.states_);for(let t=0;t<this.states_.length;++t){const i=e[t],a=Array.isArray(this.cell.stateSize)?this.cell.stateSize[t]:this.cell.stateSize,o=[n,a];if(!r.arraysEqual(i.shape,o))throw new NI(`State ${t} is incompatible with layer ${this.name}: expected shape=${o}, received shape=${i.shape}`);this.states_[t]=i}}this.states_=this.states_.map(e=>ew(e.clone()))})}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const i=uN(e,n,r,this.numConstants);e=i.inputs,n=i.initialState,r=i.constants;let a=[],o=[];if(null!=n){t.initialState=n,a=a.concat(n),this.stateSpec=[];for(const e of n)this.stateSpec.push(new HA({shape:e.shape}));o=o.concat(this.stateSpec)}if(null!=r&&(t.constants=r,a=a.concat(r),this.numConstants=r.length),a[0]instanceof WA){const n=[e].concat(a),r=this.inputSpec.concat(o),i=this.inputSpec;this.inputSpec=r;const s=super.apply(n,t);return this.inputSpec=i,s}return super.apply(e,t)}call(e,t){return Jx(()=>{const n=null==t?null:t.mask,r=null==t?null:t.training;let i=null==t?null:t.initialState;e=FA(e),null==i&&(i=this.stateful?this.states_:this.getInitialState(e));const a=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==a)throw new NI(`RNN Layer has ${a} state(s) but was passed `+i.length+" initial state(s).");this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const o={training:r},s=cN((e,t)=>{const n=this.cell.call([e].concat(t),o);return[n[0],n.slice(1)]},e,i,this.goBackwards,n,null,this.unroll,this.returnSequences),l=s[0],u=s[1],c=s[2];this.stateful&&this.resetStates(c,r);const d=this.returnSequences?u:l;return this.returnState?[d].concat(c):d})}getInitialState(e){return Jx(()=>{let t=YS(e.shape);return t=LS(t,[1,2]),t=NO(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(e=>e>1?$O(t,[1,e]):t):this.cell.stateSize>1?[$O(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===dN.className&&(t.cell={className:this.cell.getClassName(),config:n}),Object.assign({},n,e,t)}static fromConfig(e,t,n={}){const r=lD(t.cell,n);return new e(Object.assign(t,{cell:r}))}}dN.className="RNN",h.registerClass(dN);class hN extends YA{}class fN extends hN{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ZI(this.units,"units"),this.activation=MM(null==e.activation?this.DEFAULT_ACTIVATION:e.activation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=mA(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=mA(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=mA(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=$M(e.kernelRegularizer),this.recurrentRegularizer=$M(e.recurrentRegularizer),this.biasRegularizer=$M(e.biasRegularizer),this.kernelConstraint=lO(e.kernelConstraint),this.recurrentConstraint=lO(e.recurrentConstraint),this.biasConstraint=lO(e.biasConstraint),this.dropout=OO([1,AO([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=OO([1,AO([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=LA(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}call(e,t){return Jx(()=>{if(2!==(e=e).length)throw new NI(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let n=e[1];e=e[0];const r=null!=t.training&&t.training;let i;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=xN({ones:()=>oE(e),rate:this.dropout,training:r})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=xN({ones:()=>oE(n),rate:this.recurrentDropout,training:r}));const a=this.dropoutMask,o=this.recurrentDropoutMask;i=zO(null!=a?pw(e,a):e,this.kernel.read()),null!=this.bias&&(i=VO(i,this.bias.read())),null!=o&&(n=pw(n,o));let s=dw(i,zO(n,this.recurrentKernel.read()));return null!=this.activation&&(s=this.activation.apply(s)),[s,s]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:AM(this.activation),useBias:this.useBias,kernelInitializer:pA(this.kernelInitializer),recurrentInitializer:pA(this.recurrentInitializer),biasInitializer:pA(this.biasInitializer),kernelRegularizer:FM(this.kernelRegularizer),recurrentRegularizer:FM(this.recurrentRegularizer),biasRegularizer:FM(this.biasRegularizer),activityRegularizer:FM(this.activityRegularizer),kernelConstraint:oO(this.kernelConstraint),recurrentConstraint:oO(this.recurrentConstraint),biasConstraint:oO(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}fN.className="SimpleRNNCell",h.registerClass(fN);class pN extends dN{constructor(e){e.cell=new fN(e),super(e)}call(e,t){return Jx(()=>(null!=this.cell.dropoutMask&&(Qx(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Qx(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),super.call(e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})))}static fromConfig(e,t){return new e(t)}}pN.className="SimpleRNN",h.registerClass(pN);class mN extends hN{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new NI("GRUCell does not support reset_after parameter set to true.");this.units=e.units,ZI(this.units,"units"),this.activation=MM(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=MM(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=mA(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=mA(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=mA(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=$M(e.kernelRegularizer),this.recurrentRegularizer=$M(e.recurrentRegularizer),this.biasRegularizer=$M(e.biasRegularizer),this.kernelConstraint=lO(e.kernelConstraint),this.recurrentConstraint=lO(e.recurrentConstraint),this.biasConstraint=lO(e.biasConstraint),this.dropout=OO([1,AO([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=OO([1,AO([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=LA(e),this.kernel=this.addWeight("kernel",[e[e.length-1],3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}call(e,t){return Jx(()=>{if(2!==(e=e).length)throw new NI("GRUCell expects 2 input Tensors (inputs, h, c), got "+e.length+".");const n=null!=t.training&&t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=xN({ones:()=>oE(e),rate:this.dropout,training:n,count:3})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=xN({ones:()=>oE(r),rate:this.recurrentDropout,training:n,count:3}));const i=this.recurrentDropoutMask;let a,o,s;0<this.dropout&&this.dropout<1&&(e=pw(e,this.dropoutMask[0]));let l=zO(e,this.kernel.read());this.useBias&&(l=VO(l,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=pw(r,i[0]));const u=this.recurrentKernel.read(),[c,d]=JE(u,[2*this.units,this.units],u.rank-1),h=zO(r,c),[f,p,m]=JE(l,3,l.rank-1),[g,v]=JE(h,2,h.rank-1);a=this.recurrentActivation.apply(dw(f,g)),o=this.recurrentActivation.apply(dw(p,v));const y=zO(pw(o,r),d);s=this.activation.apply(dw(m,y));const b=dw(pw(a,r),pw(dw(1,jS(a)),s));return[b,b]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:AM(this.activation),recurrentActivation:AM(this.recurrentActivation),useBias:this.useBias,kernelInitializer:pA(this.kernelInitializer),recurrentInitializer:pA(this.recurrentInitializer),biasInitializer:pA(this.biasInitializer),kernelRegularizer:FM(this.kernelRegularizer),recurrentRegularizer:FM(this.recurrentRegularizer),biasRegularizer:FM(this.biasRegularizer),activityRegularizer:FM(this.activityRegularizer),kernelConstraint:oO(this.kernelConstraint),recurrentConstraint:oO(this.recurrentConstraint),biasConstraint:oO(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}mN.className="GRUCell",h.registerClass(mN);class gN extends dN{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new mN(e),super(e)}call(e,t){return Jx(()=>(null!=this.cell.dropoutMask&&(Qx(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Qx(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),super.call(e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})))}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}gN.className="GRU",h.registerClass(gN);class vN extends hN{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ZI(this.units,"units"),this.activation=MM(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=MM(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=mA(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=mA(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=mA(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=$M(e.kernelRegularizer),this.recurrentRegularizer=$M(e.recurrentRegularizer),this.biasRegularizer=$M(e.biasRegularizer),this.kernelConstraint=lO(e.kernelConstraint),this.recurrentConstraint=lO(e.recurrentConstraint),this.biasConstraint=lO(e.biasConstraint),this.dropout=OO([1,AO([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=OO([1,AO([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;let n;if(e=LA(e),this.kernel=this.addWeight("kernel",[e[e.length-1],4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const e=this.biasInitializer,r=this.units;n=new((t=class extends KO{apply(t,n){const i=e.apply([r]),a=(new JO).apply([r]),o=e.apply([2*r]);return LO(LO(i,a),o)}}).className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return Jx(()=>{const n=null!=t.training&&t.training;if(3!==(e=e).length)throw new NI("LSTMCell expects 3 input Tensors (inputs, h, c), got "+e.length+".");let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=xN({ones:()=>oE(e),rate:this.dropout,training:n,count:4})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=xN({ones:()=>oE(r),rate:this.recurrentDropout,training:n,count:4}));const a=this.recurrentDropoutMask;let o,s,l,u;0<this.dropout&&this.dropout<1&&(e=pw(e,this.dropoutMask[0]));let c=zO(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=pw(r,a[0])),c=dw(c,zO(r,this.recurrentKernel.read())),this.useBias&&(c=VO(c,this.bias.read()));const[d,h,f,p]=JE(c,4,c.rank-1);o=this.recurrentActivation.apply(d),s=this.recurrentActivation.apply(h),l=dw(pw(s,i),pw(o,this.activation.apply(f))),u=this.recurrentActivation.apply(p);const m=pw(u,this.activation.apply(l));return[m,m,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:AM(this.activation),recurrentActivation:AM(this.recurrentActivation),useBias:this.useBias,kernelInitializer:pA(this.kernelInitializer),recurrentInitializer:pA(this.recurrentInitializer),biasInitializer:pA(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:FM(this.kernelRegularizer),recurrentRegularizer:FM(this.recurrentRegularizer),biasRegularizer:FM(this.biasRegularizer),activityRegularizer:FM(this.activityRegularizer),kernelConstraint:oO(this.kernelConstraint),recurrentConstraint:oO(this.recurrentConstraint),biasConstraint:oO(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}vN.className="LSTMCell",h.registerClass(vN);class yN extends dN{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new vN(e),super(e)}call(e,t){return Jx(()=>(null!=this.cell.dropoutMask&&(Qx(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Qx(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),super.call(e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})))}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}yN.className="LSTM",h.registerClass(yN);class bN extends hN{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return Jx(()=>{let n=(e=e).slice(1);const r=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?r.push(n.splice(0,e.stateSize.length)):r.push(n.splice(0,1));r.reverse();const i=[];let a;for(let o=0;o<this.cells.length;++o){const s=this.cells[o];n=r[o],a=0===o?[e[0]].concat(n):[a[0]].concat(n),a=s.call(a,t),i.push(a.slice(1))}n=[];for(const e of i.slice().reverse())n.push(...e);return[a[0]].concat(n)})}build(e){let t;RA(e)&&(e=e[0]),e=e,this.cells.forEach((n,r)=>{_O("RNNCell_"+r,()=>{n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=this.cells.map(e=>({className:e.getClassName(),config:e.getConfig()}));return Object.assign({},e,{cells:t})}static fromConfig(e,t,n={}){const r=[];for(const i of t.cells)r.push(lD(i,n));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return zA(e)}setWeights(e){const t=[];for(const n of this.cells){const r=e.splice(n.weights.length);for(let e=0;e<n.weights.length;++e)t.push([n.weights[e],r[e]])}UA(t)}}function xN(e){const{ones:t,rate:n,training:r=!1,count:i=1}=e,a=()=>qO(t(),n),o=()=>GO(a,t,r);return!i||i<=1?ew(o().clone()):Array(i).fill(void 0).map(o).map(e=>ew(e.clone()))}bN.className="StackedRNNCells",h.registerClass(bN);class wN extends dN{constructor(e){if(e.unroll)throw new jI("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new jI("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new HA({ndim:5})]}call(e,t){return Jx(()=>{if(null!=this.cell.dropoutMask&&(Qx(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Qx(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new NI("ConvRNN2D cell does not support constants");return super.call(e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return Jx(()=>{const{stateSize:t}=this.cell,n=this.computeSingleOutputShape(e.shape),r=YS([n[0],...n.slice(2)]);return Array.isArray(t)?Array(t.length).fill(r):[r]})}resetStates(e,t=!1){Jx(()=>{if(!this.stateful)throw new DI("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,i=this.computeSingleOutputShape(n),a=[i[0],...i.slice(2)];if(null==n[0])throw new NI("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())this.states_=Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(()=>YS(a)):[YS(a)];else if(null==e)Qx(this.states_),null!=this.keptStates&&(Qx(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>YS(a)):this.states_[0]=YS(a);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new NI(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: `+e);t?this.keptStates.push(this.states_.slice()):Qx(this.states_);for(let t=0;t<this.states_.length;++t){const n=e[t],i=a;if(!r.arraysEqual(n.shape,i))throw new NI(`State ${t} is incompatible with layer ${this.name}: expected shape=${i}, received shape=${n.shape}`);this.states_[t]=n}}this.states_=this.states_.map(e=>ew(e.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:n,kernelSize:r,padding:i,strides:a,dilationRate:o}=this.cell,s="channelsFirst"===t,l=e[s?4:3],u=GM(e[s?3:2],r[0],i,a[0],o[0]),c=GM(l,r[1],i,a[1],o[1]);return[...e.slice(0,2),...s?[n,u,c]:[u,c,n]]}}wN.className="ConvRNN2D";class _N extends vN{constructor(e){const{filters:t,kernelSize:n,strides:r,padding:i,dataFormat:a,dilationRate:o}=e;super(Object.assign({},e,{units:t})),this.filters=t,ZI(this.filters,"filters"),this.kernelSize=qM(n,2,"kernelSize"),this.kernelSize.forEach(e=>ZI(e,"kernelSize")),this.strides=qM(r||1,2,"strides"),this.strides.forEach(e=>ZI(e,"strides")),this.padding=i||"valid",bO(this.padding),this.dataFormat=a||"channelsLast",yO(this.dataFormat),this.dilationRate=qM(o||1,2,"dilationRate"),this.dilationRate.forEach(e=>ZI(e,"dilationRate"))}build(e){var t;e=LA(e);const n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new NI("The channel dimension of the input should be defined. Found "+e[n]);const r=this.kernelSize.concat([e[n],4*this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let e;if(this.unitForgetBias){const n=this.biasInitializer,r=this.filters;e=new((t=class extends KO{apply(e,t){return FO([n.apply([r]),XS([r]),n.apply([2*r])])}}).className="CustomInit",t)}else e=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,e,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return Jx(()=>{if(3!==e.length)throw new NI("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+e.length+".");const n=t.training||!1,r=e[0],i=e[1],a=e[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=xN({ones:()=>oE(r),rate:this.dropout,training:n,count:4}));const o=this.dropoutMask,s=(e,t,n)=>t&&t[n]?pw(t[n],e):e;let l=s(r,o,0),u=s(r,o,1),c=s(r,o,2),d=s(r,o,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=xN({ones:()=>oE(i),rate:this.recurrentDropout,training:n,count:4}));const h=this.recurrentDropoutMask;let f=s(i,h,0),p=s(i,h,1),m=s(i,h,2),g=s(i,h,3);const[v,y,b,x]=JE(this.kernel.read(),4,3),[w,_,S,E]=this.useBias?JE(this.bias.read(),4):[null,null,null,null];l=this.inputConv(l,v,w,this.padding),u=this.inputConv(u,y,_,this.padding),c=this.inputConv(c,b,S,this.padding),d=this.inputConv(d,x,E,this.padding);const[T,k,C,I]=JE(this.recurrentKernel.read(),4,3);f=this.recurrentConv(f,T),p=this.recurrentConv(p,k),m=this.recurrentConv(m,C),g=this.recurrentConv(g,I);const O=this.recurrentActivation.apply(dw(l,f)),A=this.recurrentActivation.apply(dw(u,p)),D=dw(pw(A,a),pw(O,this.activation.apply(dw(c,m)))),M=pw(this.recurrentActivation.apply(dw(d,g)),this.activation.apply(D));return[M,M,D]})}getConfig(){const e=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(super.getConfig(),["units"]);return Object.assign({},e,{filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides})}inputConv(e,t,n,r){const i=H_(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?VO(i,n,this.dataFormat):i}recurrentConv(e,t){return H_(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}_N.className="ConvLSTM2DCell",h.registerClass(_N);class SN extends wN{constructor(e){const t=new _N(e);super(Object.assign({},e,{cell:t}))}static fromConfig(e,t){return new e(t)}}SN.className="ConvLSTM2D",h.registerClass(SN);class EN extends YA{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(null==this.noiseShape)return this.noiseShape;const t=e.shape,n=[];for(let r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}call(e,t){return Jx(()=>{this.invokeCallHook(e,t);const n=FA(e);if(0<this.rate&&this.rate<1){const e=null!=t.training&&t.training,r=this.getNoiseShape(n);return GO(()=>qO(n,this.rate,r,this.seed),()=>n,e)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}EN.className="Dropout",h.registerClass(EN);class TN extends EN{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}TN.className="SpatialDropout1D",h.registerClass(TN);class kN extends YA{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){let t=null;null!=e.batchSize&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,ZI(this.units,"units"),this.activation=MM(e.activation),null!=e.useBias&&(this.useBias=e.useBias),this.kernelInitializer=mA(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=mA(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=lO(e.kernelConstraint),this.biasConstraint=lO(e.biasConstraint),this.kernelRegularizer=$M(e.kernelRegularizer),this.biasRegularizer=$M(e.biasRegularizer),this.activityRegularizer=$M(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){const t=(e=LA(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){const t=(e=LA(e)).slice();return t[t.length-1]=this.units,t}call(e,t){return Jx(()=>{this.invokeCallHook(e,t);const n=FA(e),r=JI(this.activation.getClassName());let i;return null!=r?i=zO(n,this.kernel.read(),r,this.bias?this.bias.read():null):(i=zO(n,this.kernel.read()),null!=this.bias&&(i=VO(i,this.bias.read())),null!=this.activation&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:AM(this.activation),useBias:this.useBias,kernelInitializer:pA(this.kernelInitializer),biasInitializer:pA(this.biasInitializer),kernelRegularizer:FM(this.kernelRegularizer),biasRegularizer:FM(this.biasRegularizer),activityRegularizer:FM(this.activityRegularizer),kernelConstraint:oO(this.kernelConstraint),biasConstraint:oO(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}kN.className="Dense",h.registerClass(kN);class CN extends YA{constructor(e){super(e=e||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=LA(e);for(const t of e.slice(1))if(null==t)throw new NI(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],CO(e,1)]}call(e,t){return Jx(()=>{this.invokeCallHook(e,t);let n=FA(e);if("channelsFirst"===this.dataFormat&&n.rank>1){const e=[0];for(let t=2;t<n.rank;++t)e.push(t);e.push(1),n=n.transpose(e)}return function(e){if(e.rank<=1)throw new NI(`batchFlatten requires a minimum rank of 2. Got rank: ${e.rank}.`);const t=[e.shape[0],CO(e.shape,1)];return e.reshape(t)}(n)})}getConfig(){const e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}CN.className="Flatten",h.registerClass(CN);class IN extends YA{constructor(e){super(e),this.supportsMasking=!0,this.activation=MM(e.activation)}call(e,t){return Jx(()=>{this.invokeCallHook(e,t);const n=FA(e);return this.activation.apply(n)})}getConfig(){const e={activation:AM(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}IN.className="Activation",h.registerClass(IN);class ON extends YA{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return Jx(()=>{return e=FA(e),t=e,n=this.n,Jx(()=>{if(2!==t.shape.length)throw new NI(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);return $O(NO(t,1),[1,n,1])});var t,n})}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}ON.className="RepeatVector",h.registerClass(ON);class AN extends YA{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||null==e}fixUnknownDimension(e,t){const n="Total size of new array must be unchanged.",r=t.slice();let i=1,a=null;for(let s=0;s<r.length;++s){const e=r[s];if(this.isUnknown(e)){if(null!==a)throw new NI("Can only specifiy one unknown dimension.");a=s}else i*=e}const o=CO(e);if(null!==a){if(0===i||o%i!=0)throw new NI(n);r[a]=o/i}else if(o!==i)throw new NI(n);return r}computeOutputShape(e){let t=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return Jx(()=>{this.invokeCallHook(e,t);const n=FA(e),r=n.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return n.reshape(i)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}AN.className="Reshape",h.registerClass(AN);class DN extends YA{constructor(e){if(super(e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+e.dims+" instead.");const t=DO(1,e.dims.length+1);if(!r.arraysEqual(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new HA({ndim:this.dims.length+1})]}computeOutputShape(e){const t=(e=LA(e)).slice();return this.dims.forEach((n,r)=>{t[r+1]=e[n]}),t}call(e,t){return ax(FA(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}DN.className="Permute",h.registerClass(DN);class MN extends YA{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,this.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const n=FA(e);return e_(iE(n,this.maskValue),-1)}call(e,t){return Jx(()=>{this.invokeCallHook(e,t);const n=FA(e),r=e_(iE(n,this.maskValue),-1,!0);return n.mul(r.asType(n.dtype))})}}MN.className="Masking",h.registerClass(MN);class NN extends YA{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){let t=null;null!=e.batchSize&&(t=e.batchSize),this.batchInputShape=null==e.inputLength?[t,null]:[t].concat(BI(e.inputLength))}this.inputDim=e.inputDim,ZI(this.inputDim,"inputDim"),this.outputDim=e.outputDim,ZI(this.outputDim,"outputDim"),this.embeddingsInitializer=mA(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=$M(e.embeddingsRegularizer),this.activityRegularizer=$M(e.activityRegularizer),this.embeddingsConstraint=lO(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return Jx(()=>this.maskZero?(e=FA(e),iE(e,vw(e))):null)}computeOutputShape(e){if(e=LA(e),null==this.inputLength)return[...e,this.outputDim];const t=BI(this.inputLength);if(t.length!==e.length-1)throw new NI(`"inputLength" is ${this.inputLength}, but received input shape has shape `+e);{let n=0;for(let r=0;r<t.length;++r){const i=t[r],a=e[r+1];if(null!=i&&null!=a&&i!==a)throw new NI(`"inputLength" is ${this.inputLength}, but received input shape has shape `+e);null==i&&(t[n]=a),n++}}return[e[0],...t,this.outputDim]}call(e,t){return Jx(()=>{this.invokeCallHook(e,t);let n=FA(e);return"int32"!==n.dtype&&(n=MO(n,"int32")),UO(this.embeddings.read(),n.as1D()).reshape(LA(this.computeOutputShape(n.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:pA(this.embeddingsInitializer),embeddingsRegularizer:FM(this.embeddingsRegularizer),activityRegularizer:FM(this.activityRegularizer),embeddingsConstraint:oO(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}NN.className="Embedding",h.registerClass(NN);class jN extends YA{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new jI}computeElementwiseOpOutputShape(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;const n=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const i=e[e.length-t.length+r],a=t[r];if(null==i||null==a||i<0||a<0)n.push(null);else if(1===i)n.push(a);else if(1===a)n.push(i);else{if(i!==a)throw new NI("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(i)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[LA(e)]),(e=e).length<2)throw new NI(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const i of e)null!=i&&null!==i[0]&&t.push(i[0]);if(t=GI(t),t.length>1)throw new NI(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let n=null==e[0]?null:e[0].slice(1);for(let i=1;i<e.length;++i){const t=null==e[i]?null:e[i].slice(1);n=this.computeElementwiseOpOutputShape(n,t)}const r=e.map(e=>e.length);this.reshapeRequired=-1!==e.indexOf(null)||1!==GI(r).length}call(e,t){return Jx(()=>{if(e=e,this.reshapeRequired){const t=[],n=e.map(e=>e.rank);if(-1===n.indexOf(null)){const r=AO(n);for(let n of e){const e=n.rank;for(let t=0;t<r-e;++t)n=NO(n,1);t.push(n)}return this.mergeFunction(t)}{let n=!1;for(const a of e){const e=a.rank;if(null==e){const e=a.shape,r=e[0],i=e.slice(1).concat([r]);let o=a.reshape([r].concat(CO(e.slice(1))));o=ax(o,[1,0]),o=o.reshape(i),t.push(o),n=!0}else if(e>1){const r=DO(1,e).concat([0]);t.push(ax(a,r)),n=!0}else t.push(a)}let r=this.mergeFunction(t);const i=r.rank;if(n)if(null==i){const e=r.shape,t=e[e.length-1],n=[t].concat(e.slice(0,e.length-1));r=ax(r.reshape([-1,t]),[1,0]).reshape(n)}else if(i>1){const e=[i-1].concat(DO(0,i-1));r=ax(r,e)}return r}}return this.mergeFunction(e)})}computeOutputShape(e){let t;t=null==(e=e)[0]?null:e[0].slice(1);for(let r=1;r<e.length;++r){const n=null==e[r]?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,n)}let n=[];for(const r of e)null!=r&&null!==r[0]&&n.push(r[0]);return n=GI(n),t=1===n.length?n.concat(t):[null].concat(t),t}computeMask(e,t){return Jx(()=>{if(null==t)return null;if(!Array.isArray(t))throw new NI("`mask` should be an Array");if(!Array.isArray(e))throw new NI("`inputs` should be an Array");if(t.length!==e.length)throw new NI(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(e=>null==e))return null;let n=(t=t.map(e=>null==e?e:cS(e,0)))[0];for(let e=1;e<t.length-1;++e)n=zS(n,t[e]);return n})}}class RN extends jN{constructor(e){super(e)}mergeFunction(e){return Jx(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=dw(t,e[n]);return t})}}RN.className="Add",h.registerClass(RN);class PN extends jN{constructor(e){super(e)}mergeFunction(e){return Jx(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=pw(t,e[n]);return t})}}PN.className="Multiply",h.registerClass(PN);class FN extends jN{constructor(e){super(e)}mergeFunction(e){return Jx(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=dw(t,e[n]);return pw(1/e.length,t)})}}FN.className="Average",h.registerClass(FN);class LN extends jN{constructor(e){super(e)}mergeFunction(e){return Jx(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=Fw(t,e[n]);return t})}}LN.className="Maximum",h.registerClass(LN);class $N extends jN{constructor(e){super(e)}mergeFunction(e){return Jx(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=JS(t,e[n]);return t})}}$N.className="Minimum",h.registerClass($N);class BN extends jN{constructor(e){super(e),this.DEFAULT_AXIS=-1,null==e&&(e={}),this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new NI("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(null!=r){t=!1;break}if(t)return;const n=[];for(let i=0;i<e.length;++i){const t=e[i].slice();t.splice(this.axis,1);let a=!1;for(const e of n)if(r.arraysEqual(e,t)){a=!0;break}a||n.push(t)}if(n.length>1)throw new NI("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return Jx(()=>FO(e,this.axis))}computeOutputShape(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new NI("A `Concatenate` layer should be called on a list of inputs.");const t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(const i of t.slice(1)){if(null==n[r]||null==i[r]){n[r]=null;break}n[r]+=i[r]}return n}computeMask(e,t){if(null==t)return null;if(!Array.isArray(t))throw new NI("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new NI("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new NI(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return Jx(()=>{let n=!0;if(t.forEach(e=>{null==e||(n=!1)}),n)return null;const r=[];for(let a=0;a<e.length;++a)r.push(null==t[a]?oE(e[a]).asType("bool"):t[a].rank<e[a].rank?cS(t[a],-1):t[a]);const i=T_(r,this.axis);return Qw(i,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function zN(e,t){for(;e<0;)e+=t;return e}BN.className="Concatenate",h.registerClass(BN);class UN extends jN{constructor(e){super(e),this.axes=e.axes,this.normalize=null!=e.normalize&&e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){r.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],n=e[1];if(t.length>3||n.length>3)throw new jI("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(t,n);if(t[i[0]]!==n[i[1]])throw new NI(`Dimension incompatibility: ${t[i[0]]} !== ${n[i[1]]}`)}mergeFunction(e){if(2!==e.length)throw new NI(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t,n=e[0],i=e[1];return t=Array.isArray(this.axes)?this.axes.map((t,n)=>zN(t,e[n].shape.length)):[zN(this.axes,n.shape.length),zN(this.axes,i.shape.length)],this.normalize&&(n=uD(n,t[0]),i=uD(i,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new jI("batchDot is not implemented for tensors of 4D or higher rank yet");if(r.assert(e.shape.length>=2,()=>"batchDot requires the rank of x to be >= 2, but got "+e.shape.length),r.assert(e.shape.length>=2,()=>"batchDot requires the rank of y to be >= 2, but got "+t.shape.length),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new jI("batchDot is not implemented for complex64-type Tensors yet.");const i=e.shape.length,a=t.shape.length;null==n&&(n=[i-1,a-2]);const o=n;return Jx(()=>{let n,r;if(i>a){n=i-a;const e=[];for(let t=0;t<n;++t)e.push(1);t=t.reshape(t.shape.concat(e))}else if(a>i){n=a-i;const t=[];for(let e=0;e<n;++e)t.push(1);e=e.reshape(e.shape.concat(t))}else n=0;if(r=2===e.shape.length&&2===t.shape.length?o[0]===o[1]?e.mul(t).sum(o[0]):e.transpose([1,0]).mul(t).sum(o[1]):e.matMul(t,o[0]!==e.shape.length-1,o[1]===t.shape.length-1),n>0){let e;e=i>a?i+a-3:i-1;const t=[];for(let r=e;r<e+n;++r)t.push(r);r=r.squeeze(t)}return 1===r.shape.length&&(r=r.expandDims(1)),r})}(n,i,t)}interpretAxes(e,t){let n;return n=Array.isArray(this.axes)?this.axes:[zN(this.axes,e.length),zN(this.axes,t.length)],n}computeOutputShape(e){r.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new jI("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(t,n);t.splice(i[0],1),n.splice(i[1],1),n.splice(0,1);const a=t.concat(n);return 1===a.length&&a.push(1),a}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}UN.className="Dot",h.registerClass(UN);class HN extends YA{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return Jx(()=>{this.invokeCallHook(e,t);const n=FA(e);return GO(()=>BO(n.shape,0,this.stddev).add(n),()=>n,t.training||!1)})}}HN.className="GaussianNoise",h.registerClass(HN);class WN extends YA{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return Jx(()=>{this.invokeCallHook(e,t);const n=FA(e);return this.rate>0&&this.rate<1?GO(()=>{const e=Math.sqrt(this.rate/(1-this.rate));return n.mul(BO(n.shape,1,e))},()=>n,t.training||!1):n})}}WN.className="GaussianDropout",h.registerClass(WN);class VN extends YA{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||FA(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return Jx(()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(e);return GO(()=>{const t=FA(e),r=-1.7580993408473766;let i=_S(EE(n),this.rate);i=MO(i,"float32");const a=((1-this.rate)*(1+this.rate*r**2))**-.5,o=-a*r*this.rate;return t.mul(i).add(i.add(-1).mul(r)).mul(a).add(o)},()=>FA(e),t.training||!1)}return e})}}function qN(e,t,n,r,i,a=.001){let o;if(2===e.rank)o=N_(e,t,n,r,i,a);else if(3===e.rank)o=j_(e,t,n,r,i,a);else{if(4!==e.rank)throw new jI(`batchNormalization is not implemented for array of rank ${e.rank} yet`);o=R_(e,t,n,r,i,a)}return o}VN.className="AlphaDropout",h.registerClass(VN);class GN extends YA{constructor(e){null==e&&(e={}),super(e),this.supportsMasking=!0,this.axis=null==e.axis?-1:e.axis,this.momentum=null==e.momentum?.99:e.momentum,this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=mA(e.betaInitializer||"zeros"),this.gammaInitializer=mA(e.gammaInitializer||"ones"),this.movingMeanInitializer=mA(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=mA(e.movingVarianceInitializer||"ones"),this.betaConstraint=lO(e.betaConstraint),this.gammaConstraint=lO(e.gammaConstraint),this.betaRegularizer=$M(e.betaRegularizer),this.gammaRegularizer=$M(e.gammaRegularizer)}build(e){e=LA(e);const t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new NI(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape `+JSON.stringify(e)+".");this.inputSpec=[new HA({ndim:e.length,axes:{[t]:n}})];const r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return Jx(()=>{const n=null!=t.training&&t.training,i=FA(e),a=i.shape,o=a.length,s=DO(0,o),l=this.axis>=0?this.axis:this.axis+o;s.splice(l,1);const u=PI(1,o);u[l]=a[l];const c=s.slice();c.sort();const d=!r.arraysEqual(c,DO(0,o).slice(0,o-1));if(!n)return(()=>{if(d){const e=this.movingMean.read().reshape(u),t=this.movingVariance.read().reshape(u),n=this.center?this.beta.read().reshape(u):null,r=this.scale?this.gamma.read().reshape(u):null;return qN(i,e,t,n,r,this.epsilon)}return qN(i,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[h,f,p]=function(e,t,n,i,a=.001){return r.arraysEqual(i.slice().sort(),DO(0,e.rank-1))?function(e,t,n,r,i=.001){return Jx(()=>{const a=tE(e,r),o=a.mean,s=a.variance;return[qN(e,o,s,n,t,i),o,s]})}(e,t,n,i,a):function(e,t,n,r,i=.001){return Jx(()=>{const a=tE(e,r),o=a.mean,s=a.variance,l=[];for(const t of DO(0,e.rank))-1!==r.indexOf(t)?l.push(1):l.push(e.shape[t]);const u=o.reshape(l),c=s.reshape(l),d=null==t?null:t.reshape(l),h=null==n?null:n.reshape(l);return[qN(e,u,c,h,d,i),o,s]})}(e,t,n,i,a)}(i,this.gamma.read(),this.beta.read(),s,this.epsilon),m=(e,t,n)=>{Jx(()=>{const r=1-n,i=e.read(),a=i.sub(t).mul(r);e.write(i.sub(a))})};return(()=>{m(this.movingMean,f,this.momentum),m(this.movingVariance,p,this.momentum)})(),h})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:pA(this.betaInitializer),gammaInitializer:pA(this.gammaInitializer),movingMeanInitializer:pA(this.movingMeanInitializer),movingVarianceInitializer:pA(this.movingVarianceInitializer),betaRegularizer:FM(this.betaRegularizer),gammaRegularizer:FM(this.gammaRegularizer),betaConstraint:oO(this.betaConstraint),gammaConstraint:oO(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}GN.className="BatchNormalization",h.registerClass(GN);class YN extends YA{constructor(e){if(null==e&&(e={}),super(e),this.axis=null==e.axis?-1:e.axis,"number"==typeof this.axis){if(!Number.isInteger(this.axis))throw new Error("Expected axis to be an integer, but received "+this.axis)}else{if(!Array.isArray(this.axis))throw new Error("Expected axis to be an integer or an array of integers, but received "+JSON.stringify(this.axis));for(const e of this.axis)if(!Number.isInteger(e))throw new Error("Expected axis to be an array of integers, but received "+JSON.stringify(this.axis))}this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=mA(e.betaInitializer||"zeros"),this.gammaInitializer=mA(e.gammaInitializer||"ones"),this.betaRegularizer=$M(e.betaRegularizer),this.gammaRegularizer=$M(e.gammaRegularizer),this.supportsMasking=!0}build(e){const t=(e=LA(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(let r=0;r<this.axis.length;++r)this.axis[r]<0&&(this.axis[r]+=t);for(const r of this.axis)if(r<0||r>=t)throw new Error("Invalid axis: "+r);if(this.axis.length!==GI(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);const n=this.axis.map(t=>e[t]);this.gamma=this.scale?this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,!0):null,this.beta=this.center?this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,!0):null,this.built=!0}call(e,t){const n=FA(e),r=n.shape,i=r.length;return Jx(()=>{let{mean:e,variance:t}=tE(n,this.axis,!0);const a=PI(1,i);for(const n of this.axis)a[n]=r[n];const o=e=>null!=e&&e.shape.length!==i&&this.axis!==[i-1]?e.reshape(a):e;let s=o(this.gamma.read()),l=o(this.beta.read());const u=[],c=[];for(let n=0;n<i;++n)-1!==this.axis.indexOf(n)?(u.push(r[n]),c.push(1)):(u.push(1),c.push(r[n]));return e=e.tile(u),t=t.tile(u),s=s.tile(c),l=l.tile(c),qN(n,e,t,l,s,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:pA(this.betaInitializer),gammaInitializer:pA(this.gammaInitializer),betaRegularizer:FM(this.betaRegularizer),gammaRegularizer:FM(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}YN.className="LayerNormalization",h.registerClass(YN);class XN extends YA{constructor(e){if(null==e&&(e={}),super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)this.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new NI(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,n;if("number"==typeof e.padding[0])t=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new NI(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],2!==e.padding[1].length)throw new NI(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);n=e.padding[1]}this.padding=[t,n]}this.inputSpec=[new HA({ndim:4})]}computeOutputShape(e){let t,n;return e=LA(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}call(e,t){return Jx(()=>{return t=FA(e),n=this.padding,r=this.dataFormat,Jx(()=>{if(4!==t.rank)throw new NI("temporalPadding expects input tensor to be 4-D, but received a "+t.rank+"-D tensor.");if(null==n&&(n=[[1,1],[1,1]]),2!==n.length||2!==n[0].length||2!==n[1].length)throw new NI("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==r&&(r="channelsLast"),"channelsLast"!==r&&"channelsFirst"!==r)throw new NI(`Unknown data format: ${r}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let e;return e="channelsFirst"===r?[[0,0],[0,0],n[0],n[1]]:[[0,0],n[0],n[1],[0,0]],lE(t,e)});var t,n,r})}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}function KN(e,t,n,r,i,a){return Jx(()=>{let o;yO(i),xO(a),bO(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==a&&(a="max"),e=XM(e,i);const s="same"===r?"same":"valid";return o="max"===a?VS(e,t,n,s):w_(e,t,n,s),"channelsFirst"===i&&(o=ax(o,[0,3,1,2])),o})}function ZN(e,t,n,r,i,a){return Jx(()=>{let o;yO(i),xO(a),bO(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==a&&(a="max"),e=KM(e,i);const s="same"===r?"same":"valid";return o="max"===a?qS(e,t,n,s):__(e,t,n,s),"channelsFirst"===i&&(o=ax(o,[0,4,1,2,3])),o})}XN.className="ZeroPadding2D",h.registerClass(XN);class JN extends YA{constructor(e){if(null==e.poolSize&&(e.poolSize=2),super(e),"number"==typeof e.poolSize)this.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new NI("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.poolSize));this.poolSize=e.poolSize}if(ZI(this.poolSize,"poolSize"),null==e.strides)this.strides=this.poolSize;else if("number"==typeof e.strides)this.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new NI("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.strides));this.strides=e.strides}ZI(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,bO(this.padding),this.inputSpec=[new HA({ndim:3})]}computeOutputShape(e){const t=GM((e=LA(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return Jx(()=>{this.invokeCallHook(e,t),e=NO(FA(e),2);const n=this.poolingFunction(FA(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return tT(n,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class QN extends JN{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return yO(i),bO(r),KN(e,t,n,r,i,"max")}}QN.className="MaxPooling1D",h.registerClass(QN);class ej extends JN{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return yO(i),bO(r),KN(e,t,n,r,i,"avg")}}ej.className="AveragePooling1D",h.registerClass(ej);class tj extends YA{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new NI("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+e.strides.length+".");this.strides=e.strides}else this.strides=[e.strides,e.strides];ZI(this.poolSize,"poolSize"),ZI(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,yO(this.dataFormat),bO(this.padding),this.inputSpec=[new HA({ndim:4})]}computeOutputShape(e){e=LA(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=GM(t,this.poolSize[0],this.padding,this.strides[0]),n=GM(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return Jx(()=>(this.invokeCallHook(e,t),this.poolingFunction(FA(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class nj extends tj{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return yO(i),bO(r),KN(e,t,n,r,i,"max")}}nj.className="MaxPooling2D",h.registerClass(nj);class rj extends tj{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return yO(i),bO(r),KN(e,t,n,r,i,"avg")}}rj.className="AveragePooling2D",h.registerClass(rj);class ij extends YA{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new NI("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+e.strides.length+".");this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];ZI(this.poolSize,"poolSize"),ZI(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,yO(this.dataFormat),bO(this.padding),this.inputSpec=[new HA({ndim:5})]}computeOutputShape(e){e=LA(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=GM(t,this.poolSize[0],this.padding,this.strides[0]),n=GM(n,this.poolSize[1],this.padding,this.strides[1]),r=GM(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}call(e,t){return Jx(()=>(this.invokeCallHook(e,t),this.poolingFunction(FA(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class aj extends ij{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return yO(i),bO(r),ZN(e,t,n,r,i,"max")}}aj.className="MaxPooling3D",h.registerClass(aj);class oj extends ij{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return yO(i),bO(r),ZN(e,t,n,r,i,"avg")}}oj.className="AveragePooling3D",h.registerClass(oj);class sj extends YA{constructor(e){super(e),this.inputSpec=[new HA({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new jI}}class lj extends sj{constructor(e){super(e||{})}call(e,t){return Jx(()=>{const t=FA(e);return KS(t,1)})}}lj.className="GlobalAveragePooling1D",h.registerClass(lj);class uj extends sj{constructor(e){super(e||{})}call(e,t){return Jx(()=>{const t=FA(e);return FS(t,1)})}}uj.className="GlobalMaxPooling1D",h.registerClass(uj);class cj extends YA{constructor(e){super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,yO(this.dataFormat),this.inputSpec=[new HA({ndim:4})]}computeOutputShape(e){return e=e,"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new jI}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class dj extends cj{call(e,t){return Jx(()=>{const t=FA(e);return KS(t,"channelsLast"===this.dataFormat?[1,2]:[2,3])})}}dj.className="GlobalAveragePooling2D",h.registerClass(dj);class hj extends cj{call(e,t){return Jx(()=>{const t=FA(e);return FS(t,"channelsLast"===this.dataFormat?[1,2]:[2,3])})}}hj.className="GlobalMaxPooling2D",h.registerClass(hj);class fj extends YA{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(e){null!=this.layer&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,n={}){const r=lD(t.layer,n);delete t.layer;const i={layer:r};return Object.assign(i,t),new e(i)}}class pj extends fj{constructor(e){super(e),this.supportsMasking=!0}build(e){if((e=LA(e)).length<3)throw new NI("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(e));this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){const t=[(e=LA(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t);return[n[0],e[1]].concat(n.slice(1))}call(e,t){return Jx(()=>cN((e,n)=>[FA(this.layer.call(e,t)),[]],e=FA(e),[],!1,null,null,!1,!0)[1])}}pj.className="TimeDistributed",h.registerClass(pj);class mj extends fj{constructor(e){super(e);const t=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=t,this.forwardLayer=lD(n),t.goBackwards=!0!==t.goBackwards;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=lD(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,XI(gO,"BidirectionalMergeMode",this.mergeMode),e.weights)throw new jI("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=Math.floor(e.length/2);this.forwardLayer.setWeights(e.slice(0,t)),this.backwardLayer.setWeights(e.slice(t))}computeOutputShape(e){let t,n,r,i=this.forwardLayer.computeOutputShape(e);return Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),i=i,this.returnState?(r=i.slice(1),t=i[0]):t=i[0],t=t,"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):$I(n)}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const i=uN(e,n,r,this.numConstants);if(e=i.inputs,n=i.initialState,r=i.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(null==n||0===n.length)&&null==r)return super.apply(e,t);const a=[],o=[];if(null!=n){const e=n.length;if(e%2>0)throw new NI("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,a.push(...n);const r=n.map(e=>new HA({shape:e.shape}));this.forwardLayer.stateSpec=r.slice(0,e/2),this.backwardLayer.stateSpec=r.slice(e/2),o.push(...r)}if(null!=r)throw new jI("Support for constants in Bidirectional layers is not implemented yet.");const s=a[0]instanceof WA;for(const l of a)if(l instanceof WA!==s)throw new NI("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(s){const n=[e].concat(a),r=this.inputSpec.concat(o),i=this.inputSpec;this.inputSpec=r;const s=super.apply(n,t);return this.inputSpec=i,s}return super.apply(e,t)}call(e,t){return Jx(()=>{const n=t.initialState;let r,i,a,o;if(null==n)r=this.forwardLayer.call(e,t),i=this.backwardLayer.call(e,t);else{const a=n.slice(0,n.length/2),o=n.slice(n.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:a})),i=this.backwardLayer.call(e,Object.assign(t,{initialState:o}))}return this.returnState&&(Array.isArray(r)&&(a=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=AE(i,1)),"concat"===this.mergeMode?o=FO([r,i]):"sum"===this.mergeMode?o=dw(r,i):"ave"===this.mergeMode?o=pw(.5,dw(r,i)):"mul"===this.mergeMode?o=pw(r,i):null==this.mergeMode&&(o=[r,i]),this.returnState?null==this.mergeMode?o.concat(a):[o].concat(a):o})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){_O(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),_O(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){let n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){const e=this.forwardLayer.states.map(e=>null);return Array.isArray(n)?n.concat(e).concat(e):[n].concat(e).concat(e)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const n=lD(t.layer);if(delete t.layer,null!=t.numConstants)throw new jI("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=n,new e(r)}}function gj(e){return new XA(e)}function vj(e){return new HM(e)}function yj(e){return new BM(e)}function bj(e){return new zM(e)}function xj(e){return new UM(e)}function wj(e){return new VM(e)}function _j(e){return new WM(e)}function Sj(e){return new aN(e)}function Ej(e){return new eN(e)}function Tj(e){return new nN(e)}function kj(e){return new tN(e)}function Cj(e){return new iN(e)}function Ij(e){return new oN(e)}function Oj(e){return new sN(e)}function Aj(e){return new lN(e)}function Dj(e){return new IN(e)}function Mj(e){return new kN(e)}function Nj(e){return new EN(e)}function jj(e){return new TN(e)}function Rj(e){return new CN(e)}function Pj(e){return new ON(e)}function Fj(e){return new AN(e)}function Lj(e){return new DN(e)}function $j(e){return new NN(e)}function Bj(e){return new RN(e)}function zj(e){return new FN(e)}function Uj(e){return new BN(e)}function Hj(e){return new LN(e)}function Wj(e){return new $N(e)}function Vj(e){return new PN(e)}function qj(e){return new UN(e)}function Gj(e){return new GN(e)}function Yj(e){return new YN(e)}function Xj(e){return new XN(e)}function Kj(e){return new ej(e)}function Zj(e){return Kj(e)}function Jj(e){return Kj(e)}function Qj(e){return new rj(e)}function eR(e){return Qj(e)}function tR(e){return Qj(e)}function nR(e){return new oj(e)}function rR(e){return nR(e)}function iR(e){return nR(e)}function aR(e){return new lj(e)}function oR(e){return new dj(e)}function sR(e){return new uj(e)}function lR(e){return new hj(e)}function uR(e){return new QN(e)}function cR(e){return new nj(e)}function dR(e){return new aj(e)}function hR(e){return new gN(e)}function fR(e){return new mN(e)}function pR(e){return new yN(e)}function mR(e){return new vN(e)}function gR(e){return new pN(e)}function vR(e){return new fN(e)}function yR(e){return new SN(e)}function bR(e){return new _N(e)}function xR(e){return new dN(e)}function wR(e){return new bN(e)}function _R(e){return new mj(e)}function SR(e){return new pj(e)}mj.className="Bidirectional",h.registerClass(mj);const ER=sR,TR=lR,kR=uR,CR=cR;function IR(e){return new HN(e)}function OR(e){return new WN(e)}function AR(e){return new VN(e)}function DR(e){return new MN(e)}function MR(e,t){return bD(e,t)}function NR(e,t){return SD(e,t)}function jR(e,t){return ED(e,t)}function RR(e,t){return xD(e,t)}function PR(e,t){return TD(e,t)}function FR(e,t){return _D(e,t)}function LR(e,t){return function(e,t){return Jx(()=>{const n=wD(e,t),r=function(e,t){return Jx(()=>zS(e.equal(1),t.equal(0)).sum().cast("float32"))}(e,t),i=n.add(r);return iS(wS(i,0),n.div(i),0).cast("float32")})}(e,t)}function $R(e,t){return gD(e,t)}function BR(e,t){return dD(e,t)}function zR(e,t){return hD(e,t)}function UR(e,t){return hD(e,t)}function HR(e,t){return hD(e,t)}function WR(e,t){return cD(e,t)}function VR(e,t){return cD(e,t)}function qR(e,t){return cD(e,t)}function GR(e){return new RM(e)}function YR(e){return NM(t=e),new RM({l1:null!=t?t.l1:null,l2:0});var t}function XR(e){return NM(t=e),new RM({l2:null!=t?t.l2:null,l1:0});var t}class KR extends eD{constructor(){super(...arguments),this.model=null}setModel(e){if(!(e instanceof sM))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}function ZR(e,t){return e<t}function JR(e,t){return e>t}class QR extends KR{constructor(e){if(super(),null==e&&(e={}),e.restoreBestWeights)throw new jI("restoreBestWeights = True is not implemented in EarlyStopping yet.");this.monitor=e.monitor||"val_loss",this.minDelta=Math.abs(e.minDelta||0),this.patience=e.patience||0,this.verbose=e.verbose||0,this.mode=e.mode||"auto",this.baseline=e.baseline,-1===["auto","min","max"].indexOf(this.mode)&&(console.warn(`EarlyStopping mode '${this.mode}' is invalid. Falling back to mode 'auto'.`),this.mode="auto"),this.monitorFunc="min"===this.mode?ZR:"max"===this.mode||-1!==this.monitor.indexOf("acc")?JR:ZR,this.monitorFunc===ZR&&(this.minDelta*=-1)}async onTrainBegin(e){this.wait=0,this.stoppedEpoch=0,this.best=null!=this.baseline?this.baseline:this.monitorFunc===ZR?1/0:-1/0}async onEpochEnd(e,t){await ZA(t);const n=this.getMonitorValue(t);null!=n&&(this.monitorFunc(n-this.minDelta,this.best)?(this.best=n,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=e,this.model.stopTraining=!0)))}async onTrainEnd(e){this.stoppedEpoch>0&&this.verbose&&console.log(`Epoch ${this.stoppedEpoch}: early stopping.`)}getMonitorValue(e){null==e&&(e={});const t=e[this.monitor];return null==t&&console.warn(`Metric for EarlyStopping ${this.monitor} is not available. Available metrics are: `+Object.keys(e)),t}}const eP={earlyStopping:function(e){return new QR(e)}};var tP,nP;!function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(tP||(tP={})),function(e){let t;!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(nP||(nP={}));const rP={};function iP(e,t){rP[e]={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t}}function aP(e){return rP[e]}function oP(e){delete rP[e]}function sP(e,t,n,i,a){const o=t.inputParams[e];if(o&&void 0!==o.inputIndexStart){const e=o.inputIndexStart,s=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?e+1:o.inputIndexEnd;if("tensor"===o.type)return lP(t.inputNames[o.inputIndexStart],n,i,a);if("tensors"===o.type)return t.inputNames.slice(e,s).map(e=>lP(e,n,i,a));const l=lP(t.inputNames.slice(e)[0],n,i,a),u=l.dataSync();return"number"===o.type?u[0]:r.toNestedArray(l.shape,u)}const s=t.attrParams[e];return s&&s.value}function lP(e,t,n,r){const[i,a]=dP(e);if(null!=r){const e=r.getHashTableHandleByName(i);if(null!=e)return e}const o=n.currentContextIds.find(e=>!!t[cP(i,e)]);return void 0!==o?t[cP(i,o)][a]:void 0}function uP(e,t){const[n,r]=dP(e);return[cP(n,t&&t.currentContextId),r]}function cP(e,t){return t?`${e}-${t}`:e}function dP(e){const t=e.split(":");return 1===t.length?[e,0]:[t[0],Number(t[t.length-1])]}function hP(e,t,n){let r=sP("pad",e,t,n);if("explicit"===r){r=sP("explicitPaddings",e,t,n);const i=[[0,0],[0,0],[0,0],[0,0]];for(let e=0;e<4;e++)i[e][0]=r[2*e],i[e][1]=r[2*e+1];return i}return r}function fP(e){return e.kept?e:Fb(e)}const pP=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],mP=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],gP=[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]}],vP=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],yP=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],bP=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],xP=[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],wP=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],_P=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]}],SP=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}],EP=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],TP=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],kP=[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],CP=[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],IP=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],OP=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],AP=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]}];class DP{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[].concat(...[E,T,k,C,I,O,A,j,N,D,R,P,F,L,$,B,M].map(e=>e.json));this.opMappers=e.reduce((e,t)=>(e[t.tfOpName]=t,e),{})}transformGraph(e,t={}){const n=[],r=[],i=[],a=e.node.reduce((e,t)=>(e[t.name]=this.mapNode(t),t.op.startsWith("Placeholder")?n.push(e[t.name]):"Const"===t.op?r.push(e[t.name]):null!=t.input&&0!==t.input.length||i.push(e[t.name]),e),{});let o=[];const s=[];let l={},u={};null!=t&&(l=this.mapSignatureEntries(t.inputs),u=this.mapSignatureEntries(t.outputs));const c=Object.keys(a);c.forEach(e=>{const t=a[e];t.inputNames.forEach(e=>{const[n]=uP(e);t.inputs.push(a[n]),a[n].children.push(t)})}),0===Object.keys(u).length?c.forEach(e=>{const t=a[e];0===t.children.length&&s.push(t)}):Object.keys(u).forEach(e=>{const[t]=uP(e),n=a[t];null!=n&&(n.signatureKey=u[e],s.push(n))}),Object.keys(l).length>0?Object.keys(l).forEach(e=>{const[t]=uP(e),n=a[t];n&&(n.signatureKey=l[e],o.push(n))}):o=n;let d={};null!=e.library&&null!=e.library.function&&(d=e.library.function.reduce((e,t)=>(e[t.signature.name]=this.mapFunction(t),e),{}));const h={nodes:a,inputs:o,outputs:s,weights:r,placeholders:n,signature:t,functions:d};return i.length>0&&(h.initNodes=i),h}mapSignatureEntries(e){return Object.keys(e||{}).reduce((t,n)=>(t[e[n].name]=n,t),{})}mapNode(e){const t=aP(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});const n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(e=>e.startsWith("^")?e.substr(1):e),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((e,t)=>(e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((t,n)=>{const r=n.type;let i=void 0;switch(n.type){case"string":i=NP(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=NP(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":i=HP(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=HP(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":i=RP(e.attr,n.tfName,n.defaultValue||0),void 0===i&&n.tfDeprecatedName&&(i=RP(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":i=UP(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=UP(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":i=jP(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=jP(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":i=VP(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=VP(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":i=zP(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=zP(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":i=WP(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=WP(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":i=LP(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=LP(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":i=$P(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=$P(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":i=FP(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=FP(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${e.op}`)}return t[n.name]={value:i,type:r},t},{})),n}mapFunction(e){const t=e.nodeDef,n=[];let r={};null!=t&&(r=t.reduce((e,t)=>(e[t.name]=this.mapNode(t),"Const"===t.op&&n.push(e[t.name]),e),{}));const i=[],a=[];e.signature.inputArg.forEach(e=>{const[t]=uP(e.name),n={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:PP(e.type),type:"dtype"}},children:[]};n.signatureKey=e.name,i.push(n),r[t]=n}),Object.keys(r).forEach(e=>{const t=r[e];t.inputNames.forEach(e=>{const[n]=uP(e);t.inputs.push(r[n]),r[n].children.push(t)})});const o=e.ret;e.signature.outputArg.forEach(e=>{const[t,n]=uP(o[e.name]),i=r[t];null!=i&&(i.defaultOutput=n,a.push(i))});const s=this.mapArgsToSignature(e);return{nodes:r,inputs:i,outputs:a,weights:n,placeholders:[],signature:s}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((e,t)=>(e[t.name]=this.mapArgToTensorInfo(t),e),{}),outputs:e.signature.outputArg.reduce((t,n)=>(t[n.name]=this.mapArgToTensorInfo(n,e.ret),t),{})}}mapArgToTensorInfo(e,t){let n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}function MP(e,t){const n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){const t=Gp().global;if(void 0!==t.atob)return t.atob(e);if("undefined"!=typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function NP(e,t,n,r=!1){const i=e[t];return null!=i?MP(i.s,r):n}function jP(e,t,n){const r=e[t];return r?r.b:n}function RP(e,t,n){const r=e[t]||{},i=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof i?i:parseInt(i,10)}function PP(e){switch("string"==typeof e&&(e=tP[e]),e){case tP.DT_FLOAT:return"float32";case tP.DT_INT32:case tP.DT_INT64:case tP.DT_INT8:case tP.DT_UINT8:return"int32";case tP.DT_BOOL:return"bool";case tP.DT_DOUBLE:return"float32";case tP.DT_STRING:return"string";default:return null}}function FP(e,t,n){const r=e[t];return r&&r.func?r.func.name:n}function LP(e,t,n){const r=e[t];return r&&r.type?PP(r.type):n}function $P(e,t,n){const r=e[t];return r&&r.list&&r.list.type?r.list.type.map(e=>PP(e)):n}function BP(e){if(!e.unknownRank)return null!=e.dim?e.dim.map(e=>"number"==typeof e.size?e.size:parseInt(e.size,10)):[]}function zP(e,t,n){const r=e[t];return r&&r.shape?BP(r.shape):n}function UP(e,t,n){const r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(e=>"number"==typeof e?e:parseInt(e,10)):n}function HP(e,t,n,r=!1){const i=e[t];return i&&i.list&&i.list.s?i.list.s.map(e=>MP(e,r)):n}function WP(e,t,n){const r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map(e=>BP(e)):n}function VP(e,t,n){const r=e[t];return r&&r.list&&r.list.b?r.list.b:n}class qP{constructor(e,t,n){this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(e=>this.getInput(e)),null!=e.rawAttrs&&(this.attrs=Object.keys(e.rawAttrs).reduce((e,t)=>(e[t]=this.getAttr(t),e),{}))}getInput(e){return lP(e,this.tensorMap,this.context)}getAttr(e,t){const n=this.node.rawAttrs[e];if(null!=n.tensor)return lP(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return RP(this.node.rawAttrs,e,t);if(null!=n.s)return NP(this.node.rawAttrs,e,t);if(null!=n.b)return jP(this.node.rawAttrs,e,t);if(null!=n.shape)return zP(this.node.rawAttrs,e,t);if(null!=n.type)return LP(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return UP(this.node.rawAttrs,e,t);if(null!=n.list.s)return HP(this.node.rawAttrs,e,t);if(null!=n.list.shape)return WP(this.node.rawAttrs,e,t);if(null!=n.list.b)return VP(this.node.rawAttrs,e,t);if(null!=n.list.type)return $P(this.node.rawAttrs,e,t)}return t}}function GP(e,t,n=""){r.assert(function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(-1!==e[n]&&-1!==t[n]&&e[n]!==t[n])return!1;return!0}(e,t),()=>n+` Shapes ${e} and ${t} must match`)}class YP{constructor(e,t,n,r,i,a,o){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=i,this.dynamicSize=a,this.clearAfterRead=o,this.tensors=[],this.closed_=!1,this.idTensor=Tw(0),ew(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(t=>{null!=e&&e.has(t.tensor.id)||t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const t=this.tensors[e];if(t.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map(e=>this.read(e))}write(e,t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},\n          because the value dtype is ${t.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),GP(this.elementShape,t.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);n.tensor=t,ew(t),n.written=!0,this.tensors[e]=n}writeMany(e,t){if(e.length!==t.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${t.length}.`);e.forEach((e,n)=>this.write(e,t[n]))}gather(e,t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${t}`);if(e)e=e.slice(0,this.size());else{e=[];for(let t=0;t<this.size();t++)e.push(t)}if(0===e.length)return Hy([],[0].concat(this.elementShape));const n=this.readMany(e);return GP(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),nT(n,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(0===this.size())return Hy([],[0].concat(this.elementShape));const t=[];for(let r=0;r<this.size();r++)t.push(r);const n=this.readMany(t);return GP(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),T_(n,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const n=Math.max(...e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(e,pT(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);let n=0;const r=e.map(e=>(n+=e,n));if(n!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${t.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const i=0===n?0:t.size/n,a=[];Jx(()=>{t=nx(t,[1,n,i]);for(let n=0;n<e.length;++n)a[n]=nx(C_(t,[0,0===n?0:r[n-1],0],[1,e[n],i]),this.elementShape);return a});const o=[];for(let s=0;s<e.length;s++)o[s]=s;this.writeMany(o,a)}}class XP{constructor(e,t,n,r=-1){this.tensors=e,this.elementShape=t,this.elementDtype=n,null!=e&&e.forEach(e=>{if(n!==e.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${e.dtype}`);GP(t,e.shape,"TensorList shape mismatch: "),ew(e)}),this.idTensor=Tw(0),this.maxNumElements=r,ew(this.idTensor)}get id(){return this.idTensor.id}copy(){return new XP([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(t=>{null!=e&&e.has(t.id)||t.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t,n=-1){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);return GP(e,this.elementShape,"TensorList shape mismatch: "),Jx(()=>{const t=this.tensors.map(t=>nx(t,e));return nT(t,0)})}popBack(e,t){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=this.tensors.pop();return GP(n.shape,e,"TensorList shape mismatch: "),nx(n,e)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(GP(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");ew(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: "+e);if(-1!==this.maxNumElements&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);this.tensors.length=e}getItem(e,t,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[e])throw new Error(`element at index ${e} is null.`);return GP(this.tensors[e].shape,t,"TensorList shape mismatch: "),this.tensors[e]}setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);GP(this.elementShape,t.shape,"TensorList shape mismatch: "),ew(t),this.tensors[e]=t}gather(e,t,n){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);return GP(this.elementShape,n,"TensorList shape mismatch: "),0===(e=e.slice(0,this.size())).length?Hy([],[0].concat(this.elementShape)):Jx(()=>{const t=e.map(e=>nx(this.tensors[e],n));return nT(t,0)})}concat(e,t){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);return GP(this.elementShape,t,"TensorList shape mismatch: "),0===this.size()?Hy([],[0].concat(this.elementShape)):Jx(()=>{const e=this.tensors.map(e=>nx(e,t));return T_(e,0)})}}function KP(e,t,n){const[r,i]=sP("fusedOps",e,t,n),a="biasadd"===r,o="prelu"===i,s="fusedbatchnorm"===r,l=sP("numArgs",e,t,n);if(a){if(o&&2!==l)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&1!==l)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(s)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");const u=sP("strides",e,t,n),c=hP(e,t,n),d=sP("dataFormat",e,t,n).toUpperCase(),h=sP("dilations",e,t,n),[f,p]=sP("args",e,t,n);return{stride:u,pad:c,dataFormat:d,dilations:h,biasArg:f,preluArg:p,activationFunc:i}}function ZP(e,t,n){return{boxes:sP("boxes",e,t,n),scores:sP("scores",e,t,n),maxOutputSize:sP("maxOutputSize",e,t,n),iouThreshold:sP("iouThreshold",e,t,n),scoreThreshold:sP("scoreThreshold",e,t,n),softNmsSigma:sP("softNmsSigma",e,t,n)}}class JP{constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=Tw(0),this.tensorMap=new Map,ew(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}async import(e,t){this.checkKeyAndValueTensor(e,t);const n=await e.data();return this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),Jx(()=>{const e=pT(t),i=n.length,a=e.length;r.assert(i===a,()=>`The number of elements doesn't match, keys has ${i} elements, the values has ${a} elements.`);for(let t=0;t<i;t++){const r=n[t],i=e[t];ew(i),this.tensorMap.set(r,i)}return this.handle})}async find(e,t){this.checkKeyAndValueTensor(e,t);const n=await e.data();return Jx(()=>{const e=[];for(let r=0;r<n.length;r++){const i=this.findWithDefault(n[r],t);e.push(i)}return nT(e)})}findWithDefault(e,t){const n=this.tensorMap.get(e);return null!=n?n:t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got `+e.dtype);if(t.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got `+t.dtype)}}function QP(e,t,n,i){const a=((e,t,n)=>{switch(e.category){case"arithmetic":return Jx(()=>((e,t,n)=>{switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[dw(sP("a",e,t,n),sP("b",e,t,n))];case"AddN":return[Ww(sP("tensors",e,t,n))];case"FloorMod":case"Mod":return[eE(sP("a",e,t,n),sP("b",e,t,n))];case"Mul":return[pw(sP("a",e,t,n),sP("b",e,t,n))];case"RealDiv":case"Div":return[fw(sP("a",e,t,n),sP("b",e,t,n))];case"DivNoNan":return[aS(sP("a",e,t,n),sP("b",e,t,n))];case"FloorDiv":return[hw(sP("a",e,t,n),sP("b",e,t,n))];case"Sub":return[Dw(sP("a",e,t,n),sP("b",e,t,n))];case"Minimum":return[JS(sP("a",e,t,n),sP("b",e,t,n))];case"Maximum":return[Fw(sP("a",e,t,n),sP("b",e,t,n))];case"Pow":return[Aw(sP("a",e,t,n),sP("b",e,t,n))];case"SquaredDifference":return[eT(sP("a",e,t,n),sP("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"basic_math":return Jx(()=>((e,t,n)=>{switch(e.op){case"Abs":case"ComplexAbs":return[Nw(sP("x",e,t,n))];case"Acos":return[Uw(sP("x",e,t,n))];case"Acosh":return[Hw(sP("x",e,t,n))];case"Asin":return[r_(sP("x",e,t,n))];case"Asinh":return[i_(sP("x",e,t,n))];case"Atan":return[a_(sP("x",e,t,n))];case"Atan2":return[o_(sP("x",e,t,n),sP("y",e,t,n))];case"Atanh":return[s_(sP("x",e,t,n))];case"Ceil":return[F_(sP("x",e,t,n))];case"Complex":return[zy(sP("real",e,t,n),sP("imag",e,t,n))];case"Cos":return[K_(sP("x",e,t,n))];case"Cosh":return[Z_(sP("x",e,t,n))];case"Elu":return[sS(sP("x",e,t,n))];case"Erf":return[lS(sP("x",e,t,n))];case"Exp":return[uS(sP("x",e,t,n))];case"Expm1":return[dS(sP("x",e,t,n))];case"Floor":return[pS(sP("x",e,t,n))];case"Log":return[MS(sP("x",e,t,n))];case"Log1p":return[NS(sP("x",e,t,n))];case"Imag":return[SS(sP("x",e,t,n))];case"Neg":return[jS(sP("x",e,t,n))];case"Reciprocal":return[CE(sP("x",e,t,n))];case"Real":return[aE(sP("x",e,t,n))];case"Relu":return[IE(sP("x",e,t,n))];case"Round":return[RE(sP("x",e,t,n))];case"Selu":return[FE(sP("x",e,t,n))];case"Sigmoid":return[k_(sP("x",e,t,n))];case"Sin":return[zE(sP("x",e,t,n))];case"Sign":return[BE(sP("x",e,t,n))];case"Sinh":return[UE(sP("x",e,t,n))];case"Softplus":return[RS(sP("x",e,t,n))];case"Sqrt":return[mw(sP("x",e,t,n))];case"Square":return[gw(sP("x",e,t,n))];case"Tanh":return[I_(sP("x",e,t,n))];case"Tan":return[aT(sP("x",e,t,n))];case"Relu6":case"ClipByValue":return[L_(sP("x",e,t,n),sP("clipValueMin",e,t,n),sP("clipValueMax",e,t,n))];case"Rsqrt":return[PE(lP(e.inputNames[0],t,n))];case"Prod":return[gE(sP("x",e,t,n),sP("axes",e,t,n))];case"LeakyRelu":return[CS(sP("x",e,t,n),sP("alpha",e,t,n))];case"Prelu":return[mE(sP("x",e,t,n),sP("alpha",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"control":return(async(e,t,n)=>{switch(e.op){case"If":case"StatelessIf":{const r=sP("thenBranch",e,t,n),i=sP("elseBranch",e,t,n),a=sP("cond",e,t,n),o=sP("args",e,t,n);return(await a.data())[0]?n.functionMap[r].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap):n.functionMap[i].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=sP("body",e,t,n),i=sP("cond",e,t,n),a=sP("args",e,t,n),o=await n.functionMap[i].executeFunctionAsync(a,n.tensorArrayMap,n.tensorListMap),s=a.map(e=>e.id);let l=await o[0].data();o.forEach(e=>{e.kept||-1!==s.indexOf(e.id)||e.dispose()});let u=a;for(;l[0];){const e=u;u=await n.functionMap[r].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);const t=u.map(e=>e.id);e.forEach(e=>{e.kept||-1!==s.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()});const a=await n.functionMap[i].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);l=await a[0].data(),a.forEach(e=>{e.kept||-1!==s.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()})}return u}case"LoopCond":return[fP(sP("pred",e,t,n))];case"Switch":{const r=sP("pred",e,t,n);let i=sP("data",e,t,n);return i.kept||(i=fP(i)),(await r.data())[0]?[void 0,i]:[i,void 0]}case"Merge":{const r=e.inputNames.find(e=>void 0!==lP(e,t,n));return r?[fP(lP(r,t,n))]:void 0}case"Enter":{const r=sP("frameName",e,t,n),i=sP("tensor",e,t,n);return n.enterFrame(r),[fP(i)]}case"Exit":{const r=sP("tensor",e,t,n);return n.exitFrame(),[fP(r)]}case"NextIteration":{const r=sP("tensor",e,t,n);return n.nextIteration(),[fP(r)]}case"TensorArrayV3":{const r=sP("size",e,t,n),i=sP("dtype",e,t,n),a=sP("elementShape",e,t,n),o=sP("dynamicSize",e,t,n),s=sP("clearAfterRead",e,t,n),l=sP("identicalElementShapes",e,t,n),u=sP("name",e,t,n),c=new YP(u,i,r,a,l,o,s);return n.addTensorArray(c),[c.idTensor,Tw(1)]}case"TensorArrayWriteV3":{const r=sP("tensorArrayId",e,t,n),i=sP("index",e,t,n),a=sP("tensor",e,t,n),o=n.getTensorArray(r.id);return o.write(i,a),[o.idTensor]}case"TensorArrayReadV3":{const r=sP("tensorArrayId",e,t,n),i=sP("index",e,t,n);return[n.getTensorArray(r.id).read(i)]}case"TensorArrayGatherV3":{const r=sP("tensorArrayId",e,t,n),i=sP("indices",e,t,n),a=sP("dtype",e,t,n);return[n.getTensorArray(r.id).gather(i,a)]}case"TensorArrayScatterV3":{const r=sP("tensorArrayId",e,t,n),i=sP("indices",e,t,n),a=sP("tensor",e,t,n),o=n.getTensorArray(r.id);return o.scatter(i,a),[o.idTensor]}case"TensorArrayConcatV3":{const r=sP("tensorArrayId",e,t,n),i=n.getTensorArray(r.id),a=sP("dtype",e,t,n);return[i.concat(a)]}case"TensorArraySplitV3":{const r=sP("tensorArrayId",e,t,n),i=sP("tensor",e,t,n),a=sP("lengths",e,t,n),o=n.getTensorArray(r.id);return o.split(a,i),[o.idTensor]}case"TensorArraySizeV3":{const r=sP("tensorArrayId",e,t,n);return[Tw(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=sP("tensorArrayId",e,t,n),i=n.getTensorArray(r.id);return i.clearAndClose(),[i.idTensor]}case"TensorListSetItem":{const r=sP("tensorListId",e,t,n),i=sP("index",e,t,n),a=sP("tensor",e,t,n),o=n.getTensorList(r.id);return o.setItem(i,a),[o.idTensor]}case"TensorListGetItem":{const r=sP("tensorListId",e,t,n),i=sP("index",e,t,n),a=sP("elementShape",e,t,n),o=sP("elementDType",e,t,n);return[n.getTensorList(r.id).getItem(i,a,o)]}case"TensorListScatterV2":case"TensorListScatter":{const r=sP("indices",e,t,n),i=function(e,t,n,r){if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const i=Math.max(...t);if(null!=r&&-1!==r&&i>=r)throw new Error(`Max index must be < array size (${i}  vs. ${r})`);const a=new XP([],n,e.dtype,r),o=pT(e,0);return t.forEach((e,t)=>{a.setItem(e,o[t])}),a}(sP("tensor",e,t,n),r,sP("elementShape",e,t,n),sP("numElements",e,t,n));return n.addTensorList(i),[i.idTensor]}case"TensorListReserve":{const o=(r=sP("elementShape",e,t,n),i=sP("elementDType",e,t,n),a=sP("numElements",e,t,n),new XP([],r,i,a));return n.addTensorList(o),[o.idTensor]}case"TensorListGather":{const r=sP("tensorListId",e,t,n),i=sP("indices",e,t,n),a=sP("elementShape",e,t,n),o=sP("elementDType",e,t,n);return[n.getTensorList(r.id).gather(i,o,a)]}case"TensorListStack":{const r=sP("tensorListId",e,t,n),i=sP("elementShape",e,t,n),a=sP("elementDType",e,t,n),o=sP("numElements",e,t,n);return[n.getTensorList(r.id).stack(i,a,o)]}case"TensorListFromTensor":{const r=function(e,t,n){const r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: "+e.shape);if(e.dtype!==n)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${n}`);GP(e.shape.slice(1),t,"TensorList shape mismatch: ");const i=pT(e);return new XP(i,t,r)}(sP("tensor",e,t,n),sP("elementShape",e,t,n),sP("elementDType",e,t,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":{const r=sP("tensorListId",e,t,n),i=n.getTensorList(r.id),a=sP("dtype",e,t,n),o=sP("elementShape",e,t,n);return[i.concat(a,o)]}case"TensorListPushBack":{const r=sP("tensorListId",e,t,n),i=sP("tensor",e,t,n),a=n.getTensorList(r.id);return a.pushBack(i),[a.idTensor]}case"TensorListPopBack":{const r=sP("tensorListId",e,t,n),i=sP("elementShape",e,t,n),a=sP("elementDType",e,t,n);return[n.getTensorList(r.id).popBack(i,a)]}case"TensorListSplit":{const r=sP("tensor",e,t,n),i=sP("elementShape",e,t,n),a=function(e,t,n){let r=0;const i=t.map(e=>(r+=e,r));if(r!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${e.shape}`);const a=0===r?0:e.size/r,o=Jx(()=>{const o=[];e=nx(e,[1,r,a]);for(let r=0;r<t.length;++r)o[r]=nx(C_(e,[0,0===r?0:i[r-1],0],[1,t[r],a]),n);return e.dispose(),o}),s=new XP([],n,e.dtype,t.length);for(let l=0;l<o.length;l++)s.setItem(l,o[l]);return s}(r,sP("lengths",e,t,n),i);return n.addTensorList(a),[a.idTensor]}default:throw TypeError(`Node type ${e.op} is not implemented`)}var r,i,a})(e,t,n);case"convolution":return Jx(()=>((e,t,n)=>{switch(e.op){case"Conv1D":{const r=sP("stride",e,t,n),i=sP("pad",e,t,n),a=sP("dataFormat",e,t,n).toUpperCase(),o=sP("dilation",e,t,n);return[W_(sP("x",e,t,n),sP("filter",e,t,n),r,i,a,o)]}case"Conv2D":{const r=sP("strides",e,t,n),i=hP(e,t,n),a=sP("dataFormat",e,t,n).toUpperCase(),o=sP("dilations",e,t,n);return[H_(sP("x",e,t,n),sP("filter",e,t,n),[r[1],r[2]],i,a,[o[1],o[2]])]}case"_FusedConv2D":{const{stride:r,pad:i,dataFormat:a,dilations:o,biasArg:s,preluArg:l,activationFunc:u}=KP(e,t,n);return[m.conv2d({x:sP("x",e,t,n),filter:sP("filter",e,t,n),strides:[r[1],r[2]],pad:i,dataFormat:a,dilations:[o[1],o[2]],bias:s,activation:u,preluActivationWeights:l})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:i,dataFormat:a,dilations:o,biasArg:s,preluArg:l,activationFunc:u}=KP(e,t,n);return[m.depthwiseConv2d({x:sP("x",e,t,n),filter:sP("filter",e,t,n),strides:[r[1],r[2]],pad:i,dataFormat:a,dilations:[o[1],o[2]],bias:s,activation:u,preluActivationWeights:l})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=sP("outputShape",e,t,n),i=sP("strides",e,t,n),a=hP(e,t,n);return[q_(sP("x",e,t,n),sP("filter",e,t,n),r,[i[1],i[2]],a)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=sP("strides",e,t,n),i=hP(e,t,n),a=sP("dilations",e,t,n),o=sP("dataFormat",e,t,n).toUpperCase();return[eS(sP("input",e,t,n),sP("filter",e,t,n),[r[1],r[2]],i,o,[a[1],a[2]])]}case"Conv3D":{const r=sP("strides",e,t,n),i=sP("pad",e,t,n),a=sP("dataFormat",e,t,n).toUpperCase(),o=sP("dilations",e,t,n);return[G_(sP("x",e,t,n),sP("filter",e,t,n),[r[1],r[2],r[3]],i,a,[o[1],o[2],o[3]])]}case"AvgPool":{const r=sP("strides",e,t,n),i=sP("pad",e,t,n),a=sP("kernelSize",e,t,n);return[w_(sP("x",e,t,n),[a[1],a[2]],[r[1],r[2]],i)]}case"MaxPool":{const r=sP("strides",e,t,n),i=sP("pad",e,t,n),a=sP("kernelSize",e,t,n);return[VS(sP("x",e,t,n),[a[1],a[2]],[r[1],r[2]],i)]}case"MaxPoolWithArgmax":{const r=sP("strides",e,t,n),i=sP("pad",e,t,n),a=sP("kernelSize",e,t,n),o=sP("includeBatchInIndex",e,t,n),{result:s,indexes:l}=GS(sP("x",e,t,n),[a[1],a[2]],[r[1],r[2]],i,o);return[s,l]}case"AvgPool3D":{const r=sP("strides",e,t,n),i=sP("pad",e,t,n),a=sP("kernelSize",e,t,n);return[__(sP("x",e,t,n),[a[1],a[2],a[3]],[r[1],r[2],r[3]],i)]}case"MaxPool3D":{const r=sP("strides",e,t,n),i=sP("pad",e,t,n),a=sP("kernelSize",e,t,n);return[qS(sP("x",e,t,n),[a[1],a[2],a[3]],[r[1],r[2],r[3]],i)]}case"Dilation2D":{const r=sP("strides",e,t,n),i=sP("pad",e,t,n),a=sP("dilations",e,t,n),o=r[1],s=r[2],l=a[1],u=a[2];return[nS(sP("x",e,t,n),sP("filter",e,t,n),[o,s],i,[l,u],"NHWC")]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"creation":return Jx(()=>((e,t,n)=>{switch(e.op){case"Fill":{const r=sP("shape",e,t,n),i=sP("dtype",e,t,n);return[Iw(r,sP("value",e,t,n),i)]}case"LinSpace":return[AS(sP("start",e,t,n),sP("stop",e,t,n),sP("num",e,t,n))];case"Multinomial":{const r=sP("logits",e,t,n),i=sP("numSamples",e,t,n),a=sP("seed",e,t,n);return[rE(r,i,a)]}case"OneHot":{const r=sP("indices",e,t,n),i=sP("depth",e,t,n),a=sP("onValue",e,t,n),o=sP("offValue",e,t,n);return[ix(r,i,a,o)]}case"Ones":return[XS(sP("shape",e,t,n),sP("dtype",e,t,n))];case"OnesLike":return[oE(sP("x",e,t,n))];case"RandomUniform":return[EE(sP("shape",e,t,n),sP("minval",e,t,n),sP("maxval",e,t,n),sP("dtype",e,t,n))];case"Range":return[kE(sP("start",e,t,n),sP("stop",e,t,n),sP("step",e,t,n),sP("dtype",e,t,n))];case"TruncatedNormal":{const r=sP("shape",e,t,n),i=sP("mean",e,t,n),a=sP("stdDev",e,t,n),o=sP("seed",e,t,n);return[dT(r,i,a,sP("dtype",e,t,n),o)]}case"Zeros":return[YS(sP("shape",e,t,n),sP("dtype",e,t,n))];case"ZerosLike":return[vw(sP("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"dynamic":return(async(e,t,n)=>{switch(e.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:i,maxOutputSize:a,iouThreshold:o,scoreThreshold:s,softNmsSigma:l}=ZP(e,t,n),u=await Fk.nonMaxSuppressionWithScoreAsync(r,i,a,o,s,l);return[u.selectedIndices,u.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:i,maxOutputSize:a,iouThreshold:o,scoreThreshold:s}=ZP(e,t,n),l=sP("padToMaxOutputSize",e,t,n),u=await Fk.nonMaxSuppressionPaddedAsync(r,i,a,o,s,l);return[u.selectedIndices,u.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:i,maxOutputSize:a,iouThreshold:o,scoreThreshold:s}=ZP(e,t,n);return[await Fk.nonMaxSuppressionAsync(r,i,a,o,s)]}case"Where":{const r=Pb(sP("condition",e,t,n),"bool"),i=[await vT(r)];return r.dispose(),i}case"ListDiff":return $E(sP("x",e,t,n),sP("y",e,t,n));default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n);case"evaluation":return Jx(()=>((e,t,n)=>{switch(e.op){case"TopKV2":{const r=sP("x",e,t,n),i=sP("k",e,t,n),a=sP("sorted",e,t,n),o=cT(r,i,a);return[o.values,o.indices]}case"Unique":{const r=sP("x",e,t,n),i=hT(r);return[i.values,i.indices]}case"UniqueV2":{const r=sP("x",e,t,n),i=sP("axis",e,t,n),a=hT(r,i);return[a.values,a.indices]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"image":return Jx(()=>((e,t,n)=>{switch(e.op){case"ResizeBilinear":{const r=sP("images",e,t,n),i=sP("size",e,t,n),a=sP("alignCorners",e,t,n);return[Fk.resizeBilinear(r,[i[0],i[1]],a)]}case"ResizeNearestNeighbor":{const r=sP("images",e,t,n),i=sP("size",e,t,n),a=sP("alignCorners",e,t,n);return[Fk.resizeNearestNeighbor(r,[i[0],i[1]],a)]}case"CropAndResize":{const r=sP("image",e,t,n),i=sP("boxes",e,t,n),a=sP("boxInd",e,t,n),o=sP("cropSize",e,t,n),s=sP("method",e,t,n),l=sP("extrapolationValue",e,t,n);return[Fk.cropAndResize(r,i,a,o,s,l)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"graph":return Jx(()=>((e,t,n)=>{switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":const r=sP("default",e,t,n);return[lP(e.name,t,n)||r];case"Placeholder":return[lP(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[fP(sP("x",e,t,n))];case"IdentityN":return sP("x",e,t,n).map(e=>fP(e));case"Snapshot":return[fP(sP("x",e,t,n))];case"Shape":return[TE(sP("x",e,t,n).shape,"int32")];case"ShapeN":return sP("x",e,t,n).map(e=>TE(e.shape));case"Size":return[Tw(sP("x",e,t,n).size,"int32")];case"Rank":return[Tw(sP("x",e,t,n).rank,"int32")];case"NoOp":return[Tw(1)];case"Print":const i=sP("x",e,t,n),a=sP("data",e,t,n),o=sP("message",e,t,n),s=sP("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(o);for(let e=0;e<a.length;e++)console.log(Array.prototype.slice.call(a[e].dataSync()).slice(0,s));return[i];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"logical":return Jx(()=>((e,t,n)=>{switch(e.op){case"Equal":return[rS(sP("a",e,t,n),sP("b",e,t,n))];case"NotEqual":return[iE(sP("a",e,t,n),sP("b",e,t,n))];case"Greater":return[wS(sP("a",e,t,n),sP("b",e,t,n))];case"GreaterEqual":return[_S(sP("a",e,t,n),sP("b",e,t,n))];case"Less":return[IS(sP("a",e,t,n),sP("b",e,t,n))];case"LessEqual":return[OS(sP("a",e,t,n),sP("b",e,t,n))];case"LogicalAnd":return[zS(sP("a",e,t,n),sP("b",e,t,n))];case"LogicalNot":return[US(sP("a",e,t,n))];case"LogicalOr":return[HS(sP("a",e,t,n),sP("b",e,t,n))];case"Select":case"SelectV2":return[iS(sP("condition",e,t,n),sP("a",e,t,n),sP("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"matrices":return Jx(()=>((e,t,n)=>{switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[rx(sP("a",e,t,n),sP("b",e,t,n),sP("transposeA",e,t,n),sP("transposeB",e,t,n))];case"Transpose":return[ax(sP("x",e,t,n),sP("perm",e,t,n))];case"_FusedMatMul":const[r,i]=sP("fusedOps",e,t,n),a="biasadd"===r,o="prelu"===i,s=sP("numArgs",e,t,n);if(a){if(o&&2!==s)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&1!==s)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[l,u]=sP("args",e,t,n);return[m.matMul({a:sP("a",e,t,n),b:sP("b",e,t,n),transposeA:sP("transposeA",e,t,n),transposeB:sP("transposeB",e,t,n),bias:l,activation:i,preluActivationWeights:u})];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"normalization":return Jx(()=>((e,t,n)=>{switch(e.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[M_(sP("x",e,t,n),sP("mean",e,t,n),sP("variance",e,t,n),sP("offset",e,t,n),sP("scale",e,t,n),sP("epsilon",e,t,n))];case"LRN":return[DS(sP("x",e,t,n),sP("radius",e,t,n),sP("bias",e,t,n),sP("alpha",e,t,n),sP("beta",e,t,n))];case"Softmax":return[GE(sP("x",e,t,n))];case"LogSoftmax":return[$S(sP("x",e,t,n))];case"SparseToDense":return[FT(sP("sparseIndices",e,t,n),sP("outputShape",e,t,n),sP("sparseValues",e,t,n),sP("defaultValue",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"reduction":return Jx(()=>((e,t,n)=>{switch(e.op){case"Max":{const r=sP("axis",e,t,n),i=sP("keepDims",e,t,n);return[FS(sP("x",e,t,n),r,i)]}case"Mean":{const r=sP("axis",e,t,n),i=sP("keepDims",e,t,n);return[KS(sP("x",e,t,n),r,i)]}case"Min":{const r=sP("axis",e,t,n),i=sP("keepDims",e,t,n);return[ZS(sP("x",e,t,n),r,i)]}case"Sum":{const r=sP("axis",e,t,n),i=sP("keepDims",e,t,n);return[LS(sP("x",e,t,n),r,i)]}case"All":{const r=sP("axis",e,t,n),i=sP("keepDims",e,t,n);return[Qw(sP("x",e,t,n),r,i)]}case"Any":{const r=sP("axis",e,t,n),i=sP("keepDims",e,t,n);return[e_(sP("x",e,t,n),r,i)]}case"ArgMax":{const r=sP("axis",e,t,n);return[t_(sP("x",e,t,n),r)]}case"ArgMin":{const r=sP("axis",e,t,n);return[n_(sP("x",e,t,n),r)]}case"Prod":{const r=sP("axis",e,t,n),i=sP("keepDims",e,t,n);return[gE(sP("x",e,t,n),r,i)]}case"Cumsum":{const r=sP("axis",e,t,n),i=sP("exclusive",e,t,n),a=sP("reverse",e,t,n);return[J_(sP("x",e,t,n),r,i,a)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"slice_join":return Jx(()=>((e,t,n)=>{switch(e.op){case"ConcatV2":case"Concat":{const r=sP("n",e,t,n),i=sP("axis",e,t,n);let a=sP("tensors",e,t,n);return a=a.slice(0,r),[T_(a,i)]}case"GatherV2":case"Gather":{const r=sP("axis",e,t,n),i=sP("x",e,t,n),a=sP("indices",e,t,n);return[xS(i,Pb(a,"int32"),r)]}case"ReverseV2":case"Reverse":{const r=sP("axis",e,t,n),i=sP("x",e,t,n);return[AE(i,r)]}case"Slice":{const r=sP("begin",e,t,n),i=sP("size",e,t,n);return[C_(sP("x",e,t,n),r,i)]}case"StridedSlice":{const r=sP("begin",e,t,n),i=sP("end",e,t,n),a=sP("strides",e,t,n),o=sP("beginMask",e,t,n),s=sP("endMask",e,t,n),l=sP("ellipsisMask",e,t,n),u=sP("newAxisMask",e,t,n),c=sP("shrinkAxisMask",e,t,n),d=sP("x",e,t,n);return[iT(d,r,i,a,o,s,l,u,c)]}case"Pack":return Jx(()=>{const i=sP("axis",e,t,n),a=sP("tensors",e,t,n),o=a[0].shape,s=tT(a[0]).shape,l=a.map(e=>{const t=r.arraysEqual(e.shape,o);if(!t&&!r.arraysEqual(tT(e).shape,s))throw new Error("the input tensors shape does not match");return t?e:nx(e,o)});return[nT(l,i)]});case"Unpack":{const r=sP("axis",e,t,n),i=sP("tensor",e,t,n);return pT(i,r)}case"Tile":{const r=sP("reps",e,t,n);return[hS(sP("x",e,t,n),r)]}case"Split":case"SplitV":{const r=sP("axis",e,t,n),i=sP("numOrSizeSplits",e,t,n),a=sP("x",e,t,n);return JE(a,i,r)}case"ScatterNd":{const r=sP("indices",e,t,n),i=sP("values",e,t,n),a=sP("shape",e,t,n);return[PT(r,i,a)]}case"GatherNd":{const r=sP("x",e,t,n),i=sP("indices",e,t,n);return[LT(r,i)]}case"SparseToDense":{const r=sP("sparseIndices",e,t,n),i=sP("outputShape",e,t,n),a=sP("sparseValues",e,t,n),o=sP("defaultValue",e,t,n);return[FT(r,a,i,a.dtype===o.dtype?o:Pb(o,a.dtype))]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"spectral":return Jx(()=>((e,t,n)=>{switch(e.op){case"FFT":return[YE(sP("x",e,t,n))];case"IFFT":return[XE(sP("x",e,t,n))];case"RFFT":return[QE(sP("x",e,t,n))];case"IRFFT":return[KE(sP("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"transformation":return Jx(()=>((e,t,n)=>{switch(e.op){case"Cast":return[Pb(sP("x",e,t,n),sP("dtype",e,t,n))];case"ExpandDims":{const r=sP("axis",e,t,n);return[cS(sP("x",e,t,n),r)]}case"Squeeze":{const r=sP("axis",e,t,n);return[tT(sP("x",e,t,n),r)]}case"Reshape":return[nx(sP("x",e,t,n),sP("shape",e,t,n))];case"MirrorPad":return[QS(sP("x",e,t,n),sP("padding",e,t,n),sP("mode",e,t,n))];case"PadV2":case"Pad":return[lE(sP("x",e,t,n),sP("padding",e,t,n),sP("constantValue",e,t,n))];case"SpaceToBatchND":{const r=sP("blockShape",e,t,n),i=sP("paddings",e,t,n);return[fE(sP("x",e,t,n),r,i)]}case"BatchToSpaceND":{const r=sP("blockShape",e,t,n),i=sP("crops",e,t,n);return[A_(sP("x",e,t,n),r,i)]}case"DepthToSpace":{const r=sP("blockSize",e,t,n),i=sP("dataFormat",e,t,n).toUpperCase();return[Q_(sP("x",e,t,n),r,i)]}case"BroadcastTo":return[P_(sP("x",e,t,n),sP("shape",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n));case"hash_table":return(async(e,t,n,r)=>{switch(e.op){case"HashTable":case"HashTableV2":{const i=sP("keyDType",e,t,n),a=sP("valueDType",e,t,n),o=new JP(i,a);return r.addHashTable(e.name,o),[o.handle]}case"LookupTableImport":case"LookupTableImportV2":{const i=sP("tableHandle",e,t,n,r),a=sP("keys",e,t,n),o=sP("values",e,t,n),s=r.getHashTableById(i.id);return[await s.import(a,o)]}case"LookupTableFind":case"LookupTableFindV2":{const i=sP("tableHandle",e,t,n,r),a=sP("keys",e,t,n),o=sP("defaultValue",e,t,n),s=r.getHashTableById(i.id);return[await s.find(a,o)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n,i);case"custom":const a=aP(e.op);if(a&&a.customExecutor)return a.customExecutor(new qP(e,t,n));throw TypeError(`Custom op ${e.op} is not registered.`);default:throw TypeError(`Unknown op '${e.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(e,t,n);return r.isPromise(a)?a.then(e=>[].concat(e)):[].concat(a)}class eF{constructor(e={},t={},n={},r={}){this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let t=0;t<this.contexts.length-1;t++){const n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(e=>0===e.id&&0===e.iterationId?"":`${e.frameName}-${e.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(const t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}}function tF(e,t,n,r){const i=new Set,a=[];let o=null,s=null;const l=new Set,u=Object.keys(e).map(e=>dP(e)[0]);let c=[];null!=r&&(c=r.map(e=>dP(e.name)[0]));const d=[...t];for(;d.length>0;){const e=d.pop();(aF(e)||oF(e)||sF(e))&&null==o&&(o=e,s=o.children.map(e=>e.name).filter(e=>i.has(e))),i.add(e.name),null==n[e.name]&&-1===u.indexOf(e.name)&&-1===c.indexOf(e.name)&&(0!==e.inputs.length?e.inputs.forEach(e=>{l.has(e.name)||(l.add(e.name),d.push(e))}):a.push(e.name))}return{inputs:e,outputs:t,usedNodes:i,missingInputs:a,dynamicNode:o,syncInputs:s}}const nF=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],rF=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],iF=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2"];function aF(e){return nF.indexOf(e.op)>=0}function oF(e){return rF.indexOf(e.op)>=0}function sF(e){return iF.indexOf(e.op)>=0}class lF{constructor(e,t){this.graph=e,this.parent=t,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,null!=e.functions&&Object.keys(e.functions).forEach(t=>{this._functionExecutorMap[t]=new lF(e.functions[t],this)})}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const t=Object.keys(e).map(t=>e[t].map(e=>e.id));this._weightIds=[].concat(...t),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const t=e.signatureKey||e.name;return e.defaultOutput?`${t}:${e.defaultOutput}`:t})}get functions(){return Object.keys(this._functions).reduce((e,t)=>(e[t]=this._functions[t].signature,e),{})}getCompilationKey(e,t){const n=e.map(e=>e.name).sort(),r=t.map(e=>e.name).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}compile(e,t){const n=tF(e,t,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:i,syncInputs:a}=n;if(null!=i)throw new Error(`This execution contains the node '${i.name}', which has the dynamic op '${i.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${a}]`);if(r.length>0){const n=t.map(e=>e.name),i=Object.keys(e);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${i}]. Missing the following inputs: [${r}]`)}return function(e,t,n){const{usedNodes:r,inputs:i}=n,a=[],o=Object.keys(i).map(e=>dP(e)[0]).map(t=>e.nodes[t]),s=e.initNodes;o.forEach(e=>{r.has(e.name)&&a.push(e)}),e.weights.forEach(e=>{r.has(e.name)&&a.push(e)}),null!=s&&s.forEach(e=>{r.has(e.name)&&a.push(e)});const l=new Set,u=[];for(;a.length>0;){const e=a.pop();l.add(e.name),t[e.name]||u.push(e),e.children.forEach(e=>{!l.has(e.name)&&r.has(e.name)&&e.inputs.every(e=>l.has(e.name))&&a.push(e)})}return u}(this.graph,this.weightMap,n)}execute(e,t){e=this.mapInputs(e);const n=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);const i=n.map(e=>this.graph.nodes[dP(e)[0]]),a=t.map(e=>dP(e)[0]);let o=a.map(e=>this.graph.nodes[e]);0===o.length&&(o=this._outputs);const s=this.getCompilationKey(i,o);let l=this.compiledMap.get(s);null==l&&(l=this.compile(e,o),this.compiledMap.set(s,l));const u={},c={};return Jx(()=>{const n=new eF(this.weightMap,u,c,this.functionExecutorMap),i=Object.assign({},this.weightMap);Object.keys(e).forEach(t=>{const[n,r]=dP(t),a=[];a[r]=e[t],i[n]=a});const o=this.getFrozenTensorIds(i),s={};for(let e=0;e<l.length;e++){const t=l[e];if(!i[t.name]){const e=QP(t,i,n,this._resourceManager);if(r.isPromise(e))throw new Error(`The execution of the op '${t.op}' returned a promise. Please use model.executeAsync() instead.`);i[t.name]=e,this.checkTensorForDisposal(t.name,t,i,n,o,a,s)}}return null==this.parent&&n.dispose(o),t.map(e=>lP(e,i,n))})}getFrozenTensorIds(e){const t=[].concat.apply([],Object.keys(e).map(t=>e[t]).map(e=>e.map(e=>e.id)));return new Set(t)}checkTensorForDisposal(e,t,n,r,i,a,o){"control"!==t.category&&-1===a.indexOf(e)&&(n[e].forEach(e=>{null!=e&&(o[e.id]=(o[e.id]||0)+t.children.length)}),t.inputs.forEach(e=>{if("control"!==e.category){const t=function(e,t,n){return t[cP(e,n.currentContextId)]}(e.name,n,r);null!=t&&t.forEach(e=>{if(e&&!i.has(e.id)){const t=o[e.id];1===t?(e.dispose(),delete o[e.id]):null!=t&&o[e.id]--}})}}))}async executeAsync(e,t){return this._executeAsync(e,t)}async _executeAsync(e,t,n=!1,r={},i={}){n||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));const a=new eF(this.weightMap,r,i,this.functionExecutorMap),o=await this.executeWithControlFlow(e,a,t,n),s=t.map(e=>lP(e,o,a)),l=s.map(e=>e.id),u=Object.keys(e).map(t=>e[t].id),c=new Set([...l,...u,...this.weightIds]);return Object.keys(o).forEach(e=>{o[e].forEach(e=>{!e||e.isDisposed||c.has(e.id)||e.dispose()})}),null==this.parent&&a.dispose(c),s}async executeFunctionAsync(e,t,n){const r=e.reduce((e,t,n)=>(e[this.inputs[n].name]=t,e),{});return this._executeAsync(r,this.outputNodes,!0,t,n)}async executeWithControlFlow(e,t,n,r){const i=Object.keys(e),a=i.map(e=>this.graph.nodes[dP(e)[0]]),o=n.map(e=>dP(e)[0]);let s=o.map(e=>this.graph.nodes[e]);0===s.length&&(s=this._outputs);const{usedNodes:l,missingInputs:u,dynamicNode:c,syncInputs:d}=tF(e,s,this.weightMap,this._initNodes),h=[...a,...this.graph.weights,...this._initNodes||[]].map(e=>({node:e,contexts:t.currentContext})),f=Object.assign({},this.weightMap);Object.keys(e).forEach(t=>{const[n,r]=dP(t),i=[];i[r]=e[t],f[n]=i});const p={},m=this.getFrozenTensorIds(f),g={};for(;h.length>0;){const e=this.processStack(a,h,t,f,g,m,o,p,l);await Promise.all(e)}null!=c||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const v=s.filter(e=>!aF(e)&&!lP(e.name,f,t)).map(e=>e.name);if(v.length>0){let e="";throw null!=c&&(e=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${d}]`),new Error(`Cannot compute the outputs [${v}] from the provided inputs [${i}]. Consider providing the following inputs: [${u}]. ${e}`)}return f}processStack(e,t,n,i,a,o,s,l,u){const c=[];for(;t.length>0;){const e=t.pop();n.currentContext=e.contexts;let d="";if("Enter"===e.node.op&&sP("isConstant",e.node,i,n)&&([d]=uP(e.node.name,n)),null==i[e.node.name]){const h=QP(e.node,i,n,this._resourceManager);d||([d]=uP(e.node.name,n));const f=n.currentContext;r.isPromise(h)?c.push(h.then(r=>(i[d]=r,n.currentContext=f,this.checkTensorForDisposal(d,e.node,i,n,o,s,l),this.processChildNodes(e.node,t,n,i,a,u),r))):(i[d]=h,this.checkTensorForDisposal(d,e.node,i,n,o,s,l),this.processChildNodes(e.node,t,n,i,a,u))}else this.processChildNodes(e.node,t,n,i,a,u)}return c}processChildNodes(e,t,n,r,i,a){e.children.forEach(e=>{const[o]=uP(e.name,n);!i[o]&&a.has(e.name)&&("Merge"===e.op?e.inputNames.some(e=>!!lP(e,r,n))&&(i[o]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every(e=>!!lP(e,r,n))&&(i[o]=!0,t.push({contexts:n.currentContext,node:e})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(e=>e.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(t=>{const n=e[t],[i]=dP(t),a=this.graph.nodes[i];if(a.attrParams.shape&&a.attrParams.shape.value){const e=a.attrParams.shape.value,t=e.length===n.shape.length&&n.shape.every((t,n)=>-1===e[n]||e[n]===t);r.assert(t,()=>`The shape of dict['${a.name}'] provided in model.execute(dict) must be [${e}], but was [${n.shape}]`)}a.attrParams.dtype&&a.attrParams.dtype.value&&r.assert(n.dtype===a.attrParams.dtype.value,()=>`The dtype of dict['${a.name}'] provided in model.execute(dict) must be ${a.attrParams.dtype.value}, but was ${n.dtype}`)})}mapInputs(e){const t={};for(const n in e)null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]?t[this._signature.inputs[n].name]=e[n]:t[n]=e[n];return t}checkInputs(e){const t=Object.keys(e).filter(e=>{const[t]=dP(e);return null==this.graph.nodes[t]});if(t.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${t}] that are not part of graph`)}mapOutputs(e){return e.map(e=>null!=this._signature&&null!=this._signature.outputs&&null!=this._signature.outputs[e]?this._signature.outputs[e].name:e,{})}checkOutputs(e){e.forEach(e=>{const[t]=dP(e);if(!this.graph.nodes[t])throw new Error(`The output '${e}' is not found in the graph`)})}}class uF{constructor(e={},t={}){this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}class cF{constructor(e,t={}){this.modelUrl=e,this.loadOptions=t,this.version="n/a",null==t&&(this.loadOptions={}),this.resourceManager=new uF}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}findIOHandler(){const e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=o.browserHTTPRequest(e,this.loadOptions);else{const t=o.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(o.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error(`Found more than one (${t.length}) load handlers for URL '${[e]}'`);this.handler=t[0]}}async load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=await this.handler.load();return this.loadSync(e)}loadSync(e){this.artifacts=e;const t=this.artifacts.modelTopology;let n={};null!=this.artifacts.userDefinedMetadata&&(n=this.artifacts.userDefinedMetadata.signature),this.version=`${t.versions.producer}.${t.versions.minConsumer}`;const r=o.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new lF(DP.Instance.transformGraph(t,n)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer){const t=DP.Instance.transformGraph(e.modelInitializer);this.initializer=new lF(t),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(e,t){if("string"==typeof e){const t=o.getSaveHandlers(e);if(0===t.length)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(t.length>1)throw new Error(`Found more than one (${t.length}) save handlers for URL '${e}'`);e=t[0]}if(null==e.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}predict(e,t){return this.execute(e,this.outputNodes)}normalizeInputs(e){if(!(e instanceof fy||Array.isArray(e)))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${e.length} input tensors.`);return this.inputNodes.reduce((t,n,r)=>(t[n]=e[r],t),{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}execute(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const n=this.executor.execute(e,t);return n.length>1?n:n[0]}async executeAsync(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const n=await this.executor.executeAsync(e,t);return n.length>1?n:n[0]}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((t,n)=>(t[n]=[e[n]],t),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}async function dF(e,t={}){if(null==e)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==t&&(t={}),t.fromTFHub&&null==e.load&&(e.endsWith("/")||(e+="/"),e+="model.json?tfjs-format=file");const n=new cF(e,t);return await n.load(),n}const hF="2.7.0";function fF(e,t,n=new Map,r=new Set){if(null==e)return null;if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);const i=t(e);if(i.recurse&&null!==i.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(i.recurse){if(gF(e)){const i=Array.isArray(e)?[]:{};r.add(e);for(const a in e){const o=fF(e[a],t,n,r);i[a]=o}return r.delete(e),i}throw new Error("Can't recurse into non-iterable type: "+e)}return n.set(e,i.value),i.value}function pF(e){return null===e?null:gF(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}async function mF(e,t){const n=new Map;fF(e,t,n);for(const i of Array.from(n.keys())){const e=n.get(i);if(r.isPromise(e)){const t=await e;n.set(i,t)}}return fF(e,t,n)}function gF(e){return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof fy))}function vF(e){return e instanceof fy?{value:e.clone(),recurse:!1}:gF(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}class yF{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,null==e)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(const t of e)this.push(t)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}class bF extends yF{constructor(){super(bF.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){const e=2*this.capacity,t=new Array(e),n=this.length();for(let r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}function xF(e){return new SF(e)}function wF(e){return new EF(e)}bF.INITIAL_CAPACITY=32;class _F{async toArray(){const e=[];let t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){const e=this.prefetch(100),t=[];let n=await e.next();for(;!n.done;)t.push(n.value),n=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),n=e(t.value);for(;!t.done&&n;)t=await this.next(),n=e(t.value)}handleErrors(e){return new DF(this,e)}filter(e){return new OF(this,e)}map(e){return new AF(this,e)}mapAsync(e){return new MF(this,e)}serialMapAsync(e){return new MF(this,e).serial()}flatmap(e){return new jF(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(e=>!0===e)}rowMajorBatch(e,t=!0){return new IF(this,e,t)}columnMajorBatch(e,t=!0,n=pF){return this.rowMajorBatch(e,t).map(e=>function(e,t=pF){return function e(t,n,r=new Set){const i=t[0];if(r.has(i))throw new Error("Circular references are not supported.");const a=n(t);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(gF(i)){const a=Array.isArray(i)?[]:{};r.add(i);for(const o in i){const i=e(t.map(e=>e[o]),n,r);a[o]=i}return r.delete(i),a}throw new Error("Can't recurse into non-iterable type: "+i)}return a.value}(e,t)}(e,n))}concatenate(e,t){return new RF(xF([this,e]),t)}take(e){return e<0||null==e?this:new CF(this,e)}skip(e){return e<0||null==e?this:new kF(this,e)}prefetch(e){return new LF(this,e)}shuffle(e,t){return new $F(this,e,t)}serial(){return new TF(this)}}class SF extends _F{constructor(e){super(),this.items=e,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const e=this.items[this.trav];return this.trav++,{value:(t=e,fF(t,vF)),done:!1};var t}}class EF extends _F{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message="Error thrown while iterating through a dataset: "+e.message,e}}}class TF extends _F{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return this.upstream.summary()+" -> Serial"}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}}class kF extends _F{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return this.upstream.summary()+" -> Skip"}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const e=await this.upstream.next();if(e.done)return e;Qx(e.value)}return this.upstream.next()}}class CF extends _F{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return this.upstream.summary()+" -> Take"}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class IF extends _F{constructor(e,t,n=!0){super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return this.upstream.summary()+" -> RowMajorBatch"}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){const e=[];for(;e.length<this.batchSize;){const t=await this.upstream.next();if(t.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(t.value)}return{value:e,done:!1}}}class OF extends _F{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return this.upstream.summary()+" -> Filter"}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){const e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;Qx(e.value)}}}class AF extends _F{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return this.upstream.summary()+" -> Map"}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=i.getTensorsInContainer(e.value),n=this.transform(e.value),r=i.getTensorsInContainer(n);for(const a of t)i.isTensorInList(a,r)||a.dispose();return{value:n,done:!1}}}class DF extends _F{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return this.upstream.summary()+" -> handleErrors"}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}}class MF extends _F{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return this.upstream.summary()+" -> AsyncMap"}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=i.getTensorsInContainer(e.value),n=await this.transform(e.value),r=i.getTensorsInContainer(n);for(const a of t)i.isTensorInList(a,r)||a.dispose();return{value:n,done:!1}}}class NF extends _F{constructor(){super(),this.outputQueue=new bF,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;0===this.outputQueue.length();)if(!(await this.pump()))return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class jF extends NF{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return this.upstream.summary()+" -> Flatmap"}async pump(){const e=await this.upstream.next();if(e.done)return!1;const t=i.getTensorsInContainer(e.value),n=this.transform(e.value),r=i.getTensorsInContainer(n);this.outputQueue.pushAll(n);for(const a of t)i.isTensorInList(a,r)||a.dispose();return!0}}class RF extends _F{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,null==this.iterator){const e=await this.moreIterators.next();if(e.done)return{value:null,done:!0};this.iterator=e.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}}var PF;!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(PF||(PF={}));class FF extends _F{constructor(e,t=PF.FAIL){super(),this.iterators=e,this.mismatchMode=t,this.count=0,this.currentPromise=null}summary(){return"{TODO: fill in upstream of zip summaries} -> Zip"}async nextState(e){await e;let t=0,n=0;const r=await mF(this.iterators,(function(e){return e instanceof _F?{value:e.next().then(e=>(t++,e.done&&n++,e.value)),recurse:!1}:{value:null,recurse:!0}}));if(t===n)return{value:null,done:!0};if(n>0)switch(this.mismatchMode){case PF.FAIL:throw new Error(`Zipped streams should have the same length. Mismatched at element ${this.count}.`);case PF.SHORTEST:return{value:null,done:!0}}return this.count++,{value:r,done:!1}}async next(){return this.currentPromise=this.nextState(this.currentPromise),this.currentPromise}}class LF extends _F{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new yF(t)}summary(){return this.upstream.summary()+" -> Prefetch"}refill(){for(;!this.buffer.isFull();){const e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class $F extends LF{constructor(e,t,n){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=yE.alea(n||r.now().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(!t.done)return this.refill(),t;this.upstreamExhausted=!0}return{value:null,done:!0}}}class BF{constructor(){this.size=null}batch(e,t=!0){const n=this;let i;return r.assert(e>0,()=>"batchSize needs to be positive, but it is\n      "+e),i=this.size===1/0||null==this.size?this.size:t?Math.ceil(this.size/e):Math.floor(this.size/e),zF(async()=>(await n.iterator()).columnMajorBatch(e,t,WF),i)}concatenate(e){const t=this;let n;return n=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,zF(async()=>(await t.iterator()).concatenate(await e.iterator()),n)}filter(e){const t=this;let n;return n=this.size===1/0?1/0:null,zF(async()=>(await t.iterator()).filter(t=>Jx(()=>e(t))),n)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){const t=this;return zF(async()=>(await t.iterator()).map(t=>Jx(()=>e(t))),this.size)}mapAsync(e){const t=this;return zF(async()=>(await t.iterator()).mapAsync(e),this.size)}prefetch(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const t=this;return zF(async()=>(await t.iterator()).prefetch(e),this.size)}repeat(e){const t=this;let n;return n=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,zF(async()=>{return n=wF(async()=>({value:await t.iterator(),done:!1})).take(e),new RF(n,undefined);var n},n)}skip(e){const t=this;let n;return n=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,zF(async()=>(await t.iterator()).skip(e),n)}shuffle(e,t,n=!0){if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);const i=this,a=yE.alea(t||r.now().toString());return zF(async()=>{let t=a.int32();return n&&(t+=a.int32()),(await i.iterator()).shuffle(e,t.toString())},this.size)}take(e){const t=this;let n;return n=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,zF(async()=>(await t.iterator()).take(e),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function zF(e,t=null){return new class extends BF{constructor(){super(...arguments),this.size=t}async iterator(){return e()}}}function UF(e){return zF(async()=>xF(e),e.length)}function HF(e){if(!gF(e))throw new Error("The argument to zip() must be an object or array.");let t;if(Array.isArray(e))for(let n=0;n<e.length;n++)t=null==t?e[n].size:Math.min(t,e[n].size);else if(e instanceof Object)for(const n in e)t=null==t?e[n].size:Math.min(t,e[n].size);return zF(async()=>function(e,t=PF.FAIL){return new FF(e,t)}(await mF(e,e=>{if(e instanceof BF)return{value:e.iterator(),recurse:!1};if(gF(e))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")}),PF.SHORTEST),t)}function WF(e){return null===e?null:null==(t=e[0])||null===(n=t)||"object"!=typeof n&&"function"!=typeof n||Array.isArray(t)||"object"==typeof t&&t instanceof fy||r.isTypedArray(t)?{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof fy?nT(e):Hy(e)}(e),recurse:!1}:{value:null,recurse:!0};var t,n}BF.MAX_BUFFER_SIZE=1e4;class VF extends BF{constructor(e){super(),this.input=e}async iterator(){return(await this.input.iterator()).decodeUTF8().split("\n").map(e=>(e.endsWith("\r")&&(e=e.slice(0,-1)),e))}}const qF='"',GF=Symbol("out"),YF=Symbol("field"),XF=Symbol("quote"),KF=Symbol("quoteafterquote"),ZF=Symbol("quoteinquote");class JF extends BF{constructor(e,t){super(),this.input=e,this.hasHeader=!0,this.fullColumnNames=null,this.columnNamesValidated=!1,this.columnConfigs=null,this.configuredColumnsOnly=!1,this.delimiter=",",this.delimWhitespace=!1,this.base=new VF(e),t||(t={}),this.hasHeader=!1!==t.hasHeader,this.fullColumnNames=t.columnNames,this.columnConfigs=t.columnConfigs,this.configuredColumnsOnly=t.configuredColumnsOnly,t.delimWhitespace?(r.assert(null==t.delimiter,()=>"Delimiter should not be provided when delimWhitespace is true."),this.delimWhitespace=!0,this.delimiter=" "):this.delimiter=t.delimiter?t.delimiter:","}async columnNames(){return this.columnNamesValidated||await this.setColumnNames(),this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames}async setColumnNames(){const e=await this.maybeReadHeaderLine();if(!this.fullColumnNames&&!e)throw new Error("Column names must be provided if there is no header line.");this.fullColumnNames&&e&&r.assert(e.length===this.fullColumnNames.length,()=>"The length of provided columnNames ("+this.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+e.length.toString()+")."),this.fullColumnNames||(this.fullColumnNames=e);const t=this.fullColumnNames.reduce((e,t)=>(e[t]=e[t]+1||1,e),{}),n=Object.keys(t).filter(e=>t[e]>1);if(r.assert(0===n.length,()=>"Duplicate column names found: "+n.toString()),this.columnConfigs)for(const r of Object.keys(this.columnConfigs))if(-1===this.fullColumnNames.indexOf(r))throw new Error('The key "'+r+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");this.columnNamesValidated=!0}async maybeReadHeaderLine(){if(this.hasHeader){const e=await this.base.iterator(),t=await e.next();if(t.done)throw new Error("No data was found for CSV parsing.");return this.parseRow(t.value,!1)}return null}async iterator(){this.columnNamesValidated||await this.setColumnNames();let e=await this.base.iterator();return this.hasHeader&&(e=e.skip(1)),e.map(e=>this.makeDataElement(e))}makeDataElement(e){const t=this.parseRow(e),n={},r={};for(let i=0;i<this.fullColumnNames.length;i++){const a=this.fullColumnNames[i],o=this.columnConfigs?this.columnConfigs[a]:null;if(!this.configuredColumnsOnly||o){const s=t[i];let l=null;if(""===s)if(o&&void 0!==o.default)l=o.default;else{if(o&&(o.required||o.isLabel))throw new Error(`Required column ${a} is empty in this line: ${e}`);l=void 0}else{const e=Number(s);if(isNaN(e))l=o&&"bool"===o.dtype?this.getBoolean(s):s;else if(o&&o.dtype)switch(o.dtype){case"float32":l=e;break;case"int32":l=Math.floor(e);break;case"bool":l=this.getBoolean(s);break;default:l=e}else l=e}o&&o.isLabel?r[a]=l:n[a]=l}}return 0===Object.keys(r).length?n:{xs:n,ys:r}}getBoolean(e){return"1"===e||"true"===e.toLowerCase()?1:0}parseRow(e,t=!0){const n=[];let r=0;const i=e.length;let a=GF;for(let o=0;o<i;o++)switch(a){case GF:switch(e.charAt(o)){case qF:r=o+1,a=XF;break;case this.delimiter:if(r=o+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),a=GF;break;default:a=YF,r=o}break;case YF:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o)),a=GF,r=o+1}break;case XF:switch(e.charAt(o)){case qF:a=KF}break;case KF:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o-1)),a=GF,r=o+1;break;case qF:a=XF;break;default:a=ZF}break;case ZF:switch(e.charAt(o)){case qF:a=XF}}if(n.push(a===KF?e.substring(r,i-1):e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error(`Invalid row in csv file. Should have ${this.fullColumnNames.length} elements in a row, but got ${n}`);return n}}class QF extends _F{constructor(e){super(),this.microphoneConfig=e,this.isClosed=!1,this.fftSize=e.fftSize||1024;const t=Math.log2(this.fftSize);if(this.fftSize<0||t<4||t>14||!Number.isInteger(t))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got "+this.fftSize);if(this.numFrames=e.numFramesPerSpectrogram||43,this.sampleRateHz=e.sampleRateHz,this.columnTruncateLength=e.columnTruncateLength||this.fftSize,this.audioTrackConstraints=e.audioTrackConstraints,this.smoothingTimeConstant=e.smoothingTimeConstant||0,this.includeSpectrogram=!1!==e.includeSpectrogram,this.includeWaveform=!0===e.includeWaveform,!this.includeSpectrogram&&!this.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.")}summary(){return"microphone"}static async create(e={}){if(Gp().get("IS_NODE"))throw new Error("microphone API is only supported in browser environment.");const t=new QF(e);return await t.start(),t}async start(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1})}catch(n){throw new Error("Error thrown while initializing video stream: "+n.message)}if(!this.stream)throw new Error("Could not obtain audio from microphone.");const e=window.AudioContext||window.webkitAudioContext;if(this.audioContext=new e,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error(`Mismatch in sampling rate: Expected: ${this.sampleRateHz}; Actual: `+this.audioContext.sampleRate)}else this.sampleRateHz=this.audioContext.sampleRate;const t=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,t.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize)}async next(){if(this.isClosed)return{value:null,done:!0};let e,t;const n=await this.getAudioData();if(this.includeSpectrogram){const t=this.flattenQueue(n.freqDataQueue);e=this.getTensorFromAudioDataArray(t,[this.numFrames,this.columnTruncateLength,1])}if(this.includeWaveform){const e=this.flattenQueue(n.timeDataQueue);t=this.getTensorFromAudioDataArray(e,[this.numFrames*this.fftSize,1])}return{value:{spectrogram:e,waveform:t},done:!1}}async capture(){return(await this.next()).value}async getAudioData(){const e=[],t=[];let n=0;return new Promise(r=>{const i=setInterval(()=>{this.includeSpectrogram&&(this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0&&r({freqDataQueue:e,timeDataQueue:t}),e.push(this.freqData.slice(0,this.columnTruncateLength))),this.includeWaveform&&(this.analyser.getFloatTimeDomainData(this.timeData),t.push(this.timeData.slice())),++n===this.numFrames&&(clearInterval(i),r({freqDataQueue:e,timeDataQueue:t}))},this.fftSize/this.sampleRateHz*1e3)})}stop(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}toArray(){throw new Error("Can not convert infinite audio stream to array.")}getSampleRate(){return this.sampleRateHz}flattenQueue(e){const t=e[0].length,n=new Float32Array(e.length*t);return e.forEach((e,r)=>n.set(e,r*t)),n}getTensorFromAudioDataArray(e,t){const n=new Float32Array(r.sizeFromShape(t));return n.set(e,n.length-e.length),Hy(n,t)}}class eL extends _F{constructor(e,t){if(super(),this.webcamVideoElement=e,this.webcamConfig=t,this.isClosed=!0,this.resize=!1,this.needToResize())if(this.resize=!0,this.cropSize=[this.webcamConfig.resizeHeight,this.webcamConfig.resizeWidth],this.cropBoxInd=TE([0],"int32"),this.webcamConfig.centerCrop){const e=1*this.webcamConfig.resizeWidth/this.webcamVideoElement.width,t=1*this.webcamConfig.resizeHeight/this.webcamVideoElement.height,n=(1-e)/2,r=(1-t)/2;this.cropBox=oT([r,n,t+r,n+e],[1,4])}else this.cropBox=oT([0,0,1,1],[1,4])}summary(){return"webcam"}static async create(e,t={}){if(Gp().get("IS_NODE"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!e){if(e=document.createElement("video"),!t.resizeWidth||!t.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");e.width=t.resizeWidth,e.height=t.resizeHeight}const n=new eL(e,t);return await n.start(),n}async start(){this.webcamConfig.facingMode&&r.assert("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,()=>`Invalid webcam facing mode: ${this.webcamConfig.facingMode}. Please provide 'user' or 'environment'`);try{this.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})}catch(e){throw e.message="Error thrown while initializing video stream: "+e.message,e}if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(t){console.log(t),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,new Promise(e=>{this.webcamVideoElement.onloadedmetadata=()=>{e()}})}async next(){if(this.isClosed)return{value:null,done:!0};let e;try{e=l.fromPixels(this.webcamVideoElement)}catch(t){throw new Error("Error thrown converting video to pixels: "+JSON.stringify(t))}if(!this.resize)return{value:e,done:!1};try{return{value:this.cropAndResizeFrame(e),done:!1}}catch(t){throw new Error("Error thrown cropping the video: "+t.message)}finally{e.dispose()}}needToResize(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)}cropAndResizeFrame(e){return Jx(()=>{const t=e.toFloat().expandDims(0);let n;return n=Fk.cropAndResize(t,this.cropBox,this.cropBoxInd,this.cropSize,"bilinear"),n.reshape(n.shape.slice(1))})}async capture(){return(await this.next()).value}stop(){this.stream.getTracks().forEach(e=>e.stop());try{this.webcamVideoElement.srcObject=null}catch(e){console.log(e),this.webcamVideoElement.src=null}this.isClosed=!0}toArray(){throw new Error("Can not convert infinite video stream to array.")}}class tL{}class nL extends _F{split(e){return new rL(this,e)}}class rL extends nL{constructor(e,t){super(),this.upstream=e,this.impl=new iL(e,t)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class iL extends NF{constructor(e,t){super(),this.upstream=e,this.separator=t,this.carryover=""}summary(){return`${this.upstream.summary()} -> Split('${this.separator}')`}async pump(){const e=await this.upstream.next();if(e.done)return""!==this.carryover&&(this.outputQueue.push(this.carryover),this.carryover="",!0);const t=e.value.split(this.separator);t[0]=this.carryover+t[0];for(const n of t.slice(0,-1))this.outputQueue.push(n);return this.carryover=t[t.length-1],!0}}class aL extends _F{decodeUTF8(){return new oL(this)}}class oL extends nL{constructor(e){super(),this.upstream=e,this.impl=new sL(e)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class sL extends NF{constructor(e){if(super(),this.upstream=e,Gp().get("IS_BROWSER"))this.decoder=new TextDecoder("utf-8");else{const{StringDecoder:e}=n(4);this.decoder=new e("utf8")}}summary(){return this.upstream.summary()+" -> Utf8"}async pump(){const e=await this.upstream.next();let t,n;return!e.done&&(t=e.value,n=Gp().get("IS_BROWSER")?this.decoder.decode(t,{stream:!0}):this.decoder.write(Buffer.from(t.buffer)),this.outputQueue.push(n),!0)}}class lL extends aL{constructor(e,t={}){super(),this.file=e,this.options=t,r.assert(e instanceof Uint8Array||!!Gp().get("IS_BROWSER")&&(e instanceof File||e instanceof Blob),()=>"FileChunkIterator only supports File, Blob and Uint8Array right now."),this.offset=t.offset||0,this.chunkSize=t.chunkSize||1048576}summary(){return"FileChunks "+this.file}async next(){if(this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size))return{value:null,done:!0};const e=new Promise((e,t)=>{const n=this.offset+this.chunkSize;if(this.file instanceof Uint8Array)e(new Uint8Array(this.file.slice(this.offset,n)));else{const r=new FileReader;r.onload=n=>{let i=r.result;if(i instanceof ArrayBuffer&&(i=new Uint8Array(i)),!(i instanceof Uint8Array))return t(new TypeError("FileReader returned unknown type."));e(i)},r.onabort=e=>t(new Error("Aborted")),r.onerror=e=>t(new Error(e.type));const i=this.file.slice(this.offset,n);r.readAsArrayBuffer(i)}this.offset=n});return{value:await e,done:!1}}}function uL(e){return"string"==typeof e&&"file://"===e.substr(0,7)}class cL extends tL{constructor(e,t={}){super(),this.input=e,this.options=t}async iterator(){if(uL(this.input)&&Gp().get("IS_NODE")){const e=n(5);this.input=e.readFileSync(this.input.substr(7))}return new lL(this.input,this.options)}}class dL extends tL{constructor(e,t={}){super(),this.url=e,this.fileOptions=t}async iterator(){return uL(this.url)?new cL(this.url,this.fileOptions).iterator():async function(e,t={}){let n,i;var a;"string"==typeof e?n=e:(n=e.url,i={method:(a=e).method,headers:a.headers,body:a.body,mode:a.mode,credentials:a.credentials,cache:a.cache,redirect:a.redirect,referrer:a.referrer,integrity:a.integrity});const o=await r.fetch(n,i);if(o.ok){const e=new Uint8Array(await o.arrayBuffer());return new lL(e,t)}throw new Error(o.statusText)}(this.url,this.fileOptions)}}function hL(e,t={}){return new JF(new dL(e),t)}function fL(e){const t=wF(e);return zF(async()=>t)}function pL(e){return zF(async()=>{const t=await e();return wF(()=>t.next())})}async function mL(e,t){return eL.create(e,t)}async function gL(e){return QF.create(e)}const vL="2.7.0";function yL(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{null!=e&&r.assert("complex64"!==e.dtype,()=>t+" does not support complex64 tensors in the CPU backend.")})}const bL=v.nonMaxSuppressionV3Impl,xL=v.split,wL=v.tile,_L=v.topkImpl,SL=v.whereImpl;class EL extends Qf{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new Jf(this,Xx())}write(e,t,n){this.firstUse&&(this.firstUse=!1,Gp().get("IS_NODE")&&g.warn("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));const r={};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}makeTensorInfo(e,t,n){let i;if("string"===t&&null!=n&&n.length>0&&r.isString(n[0])){const a=n.map(e=>r.encodeString(e));i=this.write(a,e,t)}else i=this.write(n,e,t);return{dataId:i,shape:e,dtype:t}}incRef(e){this.data.get(e).refCount++}decRef(e){this.data.has(e)&&this.data.get(e).refCount--}move(e,t,n,r){this.data.set(e,{values:t,dtype:r,refCount:1})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:n}=this.data.get(e);if("complex64"===t){const e=this.readSync(n.real.dataId),t=this.readSync(n.imag.dataId);return g.mergeRealAndImagArrays(e,t)}return this.data.get(e).values}bufferSync(e){const t=this.readSync(e.dataId);let n=t;if("string"===e.dtype)try{n=t.map(e=>r.decodeString(e))}catch(i){throw new Error("Failed to decode encoded string bytes into utf-8")}return Rb(e.shape,e.dtype,n)}makeOutput(e,t,n){const r=this.write(e,t,n);return Xx().makeTensorFromDataId(r,t,n,this)}disposeData(e){if(this.data.has(e)){const{complexTensorInfos:t}=this.data.get(e);null!=t&&(this.disposeData(t.real.dataId),this.disposeData(t.imag.dataId)),this.data.delete(e)}}disposeIntermediateTensorInfo(e){const t=e.dataId;if(this.data.has(t)){const e=this.data.get(t);e.refCount--,e.refCount<1&&this.disposeData(t)}}async time(e){const t=r.now();return e(),{kernelMs:r.now()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}stridedSlice(e,t,n,r){yL(e,"stridedSlice");const i=d.computeOutShape(t,n,r);if(i.some(e=>0===e))return Hy([],i);const a=Rb(i,e.dtype),o=this.bufferSync(e);for(let s=0;s<a.size;s++){const e=a.indexToLoc(s),n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[i]*r[i]+t[i];a.set(o.get(...n),...e)}return a.toTensor()}diag(e){const t=this.readSync(e.dataId),n=Rb([e.size,e.size],e.dtype),r=n.values;for(let i=0;i<t.length;i++)r[i*e.size+i]=t[i];return n.toTensor()}unstack(e,t){const n=e.shape[t],r=new Array(e.rank-1);let i=0;for(let l=0;l<e.rank;l++)l!==t&&(r[i++]=e.shape[l]);const a=new Array(e.rank).fill(0),o=e.shape.slice();o[t]=1;const s=new Array(n);for(let l=0;l<s.length;l++)a[t]=l,s[l]=C_(e,a,o).reshape(r);return s}reverse(e,t){yL(e,"reverse");const n=Rb(e.shape,e.dtype),r=this.bufferSync(e);for(let i=0;i<n.size;i++){const a=n.indexToLoc(i),o=a.slice();t.forEach(t=>o[t]=e.shape[t]-1-o[t]),n.set(r.get(...o),...a)}return n.toTensor()}neg(e){return yL(e,"neg"),pw(Tw(-1),e)}addN(e){yL(e,"addN");const t=e.map(e=>this.readSync(e.dataId)),n=Rb(e[0].shape,e[0].dtype),r=n.values;for(let i=0;i<e.length;i++){const e=t[i];for(let t=0;t<r.length;t++)r[t]+=e[t]}return n.toTensor()}softmax(e,t){const n=r.parseAxisParam([t],e.shape),i=FS(e,n),a=g.expandShapeToKeepDim(i.shape,n),o=Dw(e,i.reshape(a)),s=uS(o),l=this.sum(s,n).reshape(a);return fw(s,l)}pow(e,t){return yL([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,(e,t)=>Math.pow(e,t))}floorDiv(e,t){return yL([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",(e,t)=>Math.floor(e/t))}sum(e,t){yL(e,"sum"),g.assertAxesAreInnerMostDims("sum",t,e.rank);const[n,i]=g.computeOutAndReduceShapes(e.shape,t),a=YS(n,wy(e.dtype,"int32")),o=r.sizeFromShape(i),s=this.readSync(a.dataId),l=this.readSync(e.dataId);for(let r=0;r<s.length;++r){const e=r*o;let t=0;for(let n=0;n<o;++n)t+=l[e+n];s[r]=t}return a}prod(e,t){yL(e,"sum");const[n,i]=g.computeOutAndReduceShapes(e.shape,t),a=YS(n,wy(e.dtype,"int32")),o=r.sizeFromShape(i),s=this.readSync(a.dataId),l=this.readSync(e.dataId);for(let r=0;r<s.length;++r){const e=r*o;let t=1;for(let n=0;n<o;++n)t*=l[e+n];s[r]=t}return a}unsortedSegmentSum(e,t,n){yL(e,"unsortedSegmentSum");const r=[],i=e.rank-t.rank;for(let a=0;a<i;++a)t=t.expandDims(a+1);for(let a=0;a<n;++a){const n=Tw(a,"int32"),i=rS(n,t).asType("float32").mul(e).sum(0);r.push(i)}return nT(r)}argMin(e,t){yL(e,"argMin");const n=[t];g.assertAxesAreInnerMostDims("argMin",n,e.rank);const[i,a]=g.computeOutAndReduceShapes(e.shape,n),o=YS(i,"int32"),s=r.sizeFromShape(a),l=this.readSync(o.dataId),u=this.readSync(e.dataId);for(let r=0;r<l.length;++r){const e=r*s;let t=u[e],n=0;for(let r=0;r<s;++r){const i=u[e+r];i<t&&(t=i,n=r)}l[r]=n}return o}argMax(e,t){yL(e,"argMax");const n=[t];g.assertAxesAreInnerMostDims("argMax",n,e.rank);const[i,a]=g.computeOutAndReduceShapes(e.shape,n),o=YS(i,"int32"),s=r.sizeFromShape(a),l=this.readSync(o.dataId),u=this.readSync(e.dataId);for(let r=0;r<l.length;++r){const e=r*s;let t=u[e],n=0;for(let r=0;r<s;++r){const i=u[e+r];i>t&&(t=i,n=r)}l[r]=n}return o}cumsum(e,t,n,r){if(yL(e,"cumsum"),t!==e.rank-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${e.rank-1} but got axis=`+t);const i=wy(e.dtype,"int32"),a=YS(e.shape,i),o=this.readSync(a.dataId),s=this.readSync(e.dataId),l=e.shape[e.rank-1],u=r?(e,t)=>e+l-t-1:(e,t)=>e+t;for(let c=0;c<s.length;c+=l)for(let e=0;e<l;e++){const t=u(c,e);if(0===e)o[t]=n?0:s[t];else{const r=u(c,e-1);o[t]=n?s[r]+o[r]:s[t]+o[r]}}return a}equal(e,t){return yL([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",(e,t)=>e===t?1:0)}notEqual(e,t){return yL([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",(e,t)=>e!==t?1:0)}less(e,t){return yL([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",(e,t)=>e<t?1:0)}lessEqual(e,t){return yL([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",(e,t)=>e<=t?1:0)}greater(e,t){return yL([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",(e,t)=>e>t?1:0)}greaterEqual(e,t){return yL([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",(e,t)=>e>=t?1:0)}logicalAnd(e,t){return yL([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",(e,t)=>e&&t)}logicalOr(e,t){return yL([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",(e,t)=>e||t)}select(e,t,n){yL([e,t,n],"select");const i=this.readSync(e.dataId),a=this.readSync(t.dataId),o=this.readSync(n.dataId),s=YS(t.shape,wy(t.dtype,n.dtype)),l=this.readSync(s.dataId);let u=0;const c=0===e.rank||e.rank>1||1===t.rank?1:r.sizeFromShape(t.shape.slice(1));for(let r=0;r<i.length;r++)for(let e=0;e<c;e++)l[u++]=1===i[r]?a[r]:o[r];return s}where(e){yL([e],"where");const t=this.readSync(e.dataId);return SL(e.shape,t)}topk(e,t,n){yL(e,"topk");const r=this.readSync(e.dataId);return _L(r,e.shape,e.dtype,t,n)}min(e,t){yL(e,"min"),g.assertAxesAreInnerMostDims("min",t,e.rank);const[n,i]=g.computeOutAndReduceShapes(e.shape,t),a=YS(n,e.dtype),o=r.sizeFromShape(i),s=this.readSync(a.dataId),l=this.readSync(e.dataId);for(let r=0;r<s.length;++r){const e=r*o;let t=l[e];for(let n=0;n<o;++n){const r=l[e+n];r<t&&(t=r)}s[r]=t}return a}minimum(e,t){return yL([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,(e,t)=>Math.min(e,t))}mod(e,t){return yL([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,(e,t)=>{const n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})}maximum(e,t){return yL([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,(e,t)=>Math.max(e,t))}all(e,t){yL(e,"all"),g.assertAxesAreInnerMostDims("all",t,e.rank);const[n,i]=g.computeOutAndReduceShapes(e.shape,t),a=YS(n,e.dtype),o=r.sizeFromShape(i),s=this.readSync(a.dataId),l=this.readSync(e.dataId);for(let r=0;r<s.length;++r){const e=r*o;let t=l[e];for(let n=0;n<o;++n){const r=l[e+n];t=t&&r}s[r]=t}return a}any(e,t){yL(e,"any"),g.assertAxesAreInnerMostDims("any",t,e.rank);const[n,i]=g.computeOutAndReduceShapes(e.shape,t),a=YS(n,e.dtype),o=r.sizeFromShape(i),s=this.readSync(a.dataId),l=this.readSync(e.dataId);for(let r=0;r<s.length;++r){const e=r*o;let t=l[e];for(let n=0;n<o;++n){const r=l[e+n];t=t||r}s[r]=t}return a}squaredDifference(e,t){return yL([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,(e,t)=>{const n=e-t;return n*n})}eluDer(e,t){yL([e,t],"eluDer");const n=new Float32Array(t.size),r=this.readSync(t.dataId),i=this.readSync(e.dataId);for(let a=0;a<r.length;++a){const e=r[a];n[a]=e>=1?i[a]:i[a]*(e+1)}return this.makeOutput(n,t.shape,"float32")}atan2(e,t){return yL([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,(e,t)=>Math.atan2(e,t))}tile(e,t){return yL(e,"tile"),wL(this.bufferSync(e),t)}gather(e,t,n){yL([e,t],"gather");const r=e.shape.slice(),i=this.readSync(t.dataId);r[n]=i.length;const a=Rb(r,e.dtype),o=this.bufferSync(e);for(let s=0;s<a.size;++s){const e=a.indexToLoc(s),t=e.slice();t[n]=i[e[n]];const r=o.locToIndex(t);a.values[s]=o.values[r]}return a.toTensor()}batchToSpaceND(e,t,n){yL([e],"batchToSpaceND");const r=t.reduce((e,t)=>e*t),i=g.getReshaped(e.shape,t,r),a=g.getPermuted(i.length,t.length),o=g.getReshapedPermuted(e.shape,t,r),s=g.getSliceBeginCoords(n,t.length),l=g.getSliceSize(o,n,t.length);return ax(e.reshape(i),a).reshape(o).slice(s,l)}pool3d(e,t,n){yL(e,"pool3d");const r=t.strideDepth,i=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,l=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,d=t.effectiveFilterWidth,h=t.padInfo.front,f=t.padInfo.top,p=t.padInfo.left,m="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=this.readSync(e.dataId),v=Rb(t.outShape,e.dtype),y=v.values,b=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],x=t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[3]*t.outShape[4],_=t.outShape[4];for(let S=0;S<t.batchSize;++S){const v=S*b,E=S*e.strides[0];for(let b=0;b<t.inChannels;++b)for(let S=0;S<t.outDepth;++S){const T=S*r-h;let k=T;for(;k<0;)k+=o;const C=Math.min(t.inDepth,u+T),I=v+S*x;for(let r=0;r<t.outHeight;++r){const u=r*i-f;let h=u;for(;h<0;)h+=s;const v=Math.min(t.inHeight,c+u),x=I+r*w;for(let r=0;r<t.outWidth;++r){const i=r*a-p;let u=i;for(;u<0;)u+=l;const c=Math.min(t.inWidth,d+i),f=x+r*_;let w=m,S=0,T=0;for(let t=k;t<C;t+=o){const r=E+t*e.strides[1];for(let t=h;t<v;t+=s){const i=r+t*e.strides[2];for(let t=u;t<c;t+=l){const r=g[i+t*e.strides[3]+b];if("max"===n&&r>w?w=r:"avg"===n&&(S+=r,T++),isNaN(w))break}if(isNaN(w))break}if(isNaN(w))break}y[f+b]="avg"===n?S/T:w}}}}return v.toTensor()}avgPool3d(e,t){return yL(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()}avgPool3dBackprop(e,t,n){yL([e,t],"avgPool3dBackprop");const r=n.strideDepth,i=n.strideHeight,a=n.strideWidth,o=n.filterDepth,s=n.filterHeight,l=n.filterWidth,u=n.dilationDepth,c=n.dilationHeight,d=n.dilationWidth,h=n.effectiveFilterDepth,f=n.effectiveFilterHeight,p=n.effectiveFilterWidth,m=h-1-n.padInfo.front,g=p-1-n.padInfo.left,v=f-1-n.padInfo.top,y=Rb(t.shape,"float32"),b=1/(o*s*l),x=this.bufferSync(e);for(let w=0;w<n.batchSize;++w)for(let e=0;e<n.inChannels;++e)for(let t=0;t<n.inDepth;++t)for(let o=0;o<n.inHeight;++o)for(let s=0;s<n.inWidth;++s){const l=t-m,_=o-v,S=s-g;let E=0;for(let t=0;t<h;t+=u){const o=(l+t)/r;if(!(o<0||o>=n.outDepth||Math.floor(o)!==o))for(let t=0;t<f;t+=c){const r=(_+t)/i;if(!(r<0||r>=n.outHeight||Math.floor(r)!==r))for(let t=0;t<p;t+=d){const i=(S+t)/a;i<0||i>=n.outWidth||Math.floor(i)!==i||(E+=x.get(w,o,r,i,e))}}}y.set(E*b,w,t,o,s,e)}return y.toTensor()}maxPool3d(e,t){return yL(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()}maxPool3dPositions(e,t){const n=Rb(t.outShape,"int32"),r=t.strideDepth,i=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,l=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,d=t.effectiveFilterWidth,h=t.padInfo.front,f=t.padInfo.top,p=t.padInfo.left,m=this.bufferSync(e);for(let g=0;g<t.batchSize;++g)for(let e=0;e<t.inChannels;++e)for(let v=0;v<t.outDepth;++v){const y=v*r-h;let b=y;for(;b<0;)b+=o;const x=Math.min(t.inDepth,u+y);for(let r=0;r<t.outHeight;++r){const u=r*i-f;let h=u;for(;h<0;)h+=s;const w=Math.min(t.inHeight,c+u);for(let i=0;i<t.outWidth;++i){const f=i*a-p;let _=f;for(;_<0;)_+=l;const S=Math.min(t.inWidth,d+f);let E=Number.NEGATIVE_INFINITY,T=-1;for(let t=b;t<x;t+=o){const n=t-y;for(let r=h;r<w;r+=s){const i=r-u;for(let a=_;a<S;a+=l){const o=a-f,s=m.get(g,t,r,a,e);s>=E&&(E=s,T=n*c*d+i*c+o)}}}n.set(T,g,v,r,i,e)}}}return n.toTensor()}maxPool3dBackprop(e,t,n,r){yL([t,n],"maxPool3dBackprop");const i=this.maxPool3dPositions(t,r),a=r.strideDepth,o=r.strideHeight,s=r.strideWidth,l=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=d-1-r.padInfo.front,m=f-1-r.padInfo.left,g=h-1-r.padInfo.top,v=Rb(t.shape,"float32"),y=this.bufferSync(i),b=this.bufferSync(e);for(let x=0;x<r.batchSize;++x)for(let e=0;e<r.inChannels;++e)for(let t=0;t<r.inDepth;++t)for(let n=0;n<r.inHeight;++n)for(let i=0;i<r.inWidth;++i){const w=t-p,_=n-g,S=i-m;let E=0;for(let t=0;t<d;t+=l){const n=(w+t)/a;if(!(n<0||n>=r.outDepth||Math.floor(n)!==n))for(let i=0;i<h;i+=u){const a=(_+i)/o;if(!(a<0||a>=r.outHeight||Math.floor(a)!==a))for(let o=0;o<f;o+=c){const l=(S+o)/s;if(l<0||l>=r.outWidth||Math.floor(l)!==l)continue;const u=d*h*f-1-y.get(x,n,a,l,e)===t*h*f+i*f+o?1:0;0!==u&&(E+=b.get(x,n,a,l,e)*u)}}}v.set(E,x,t,n,i,e)}return v.toTensor()}resizeBilinear(e,t,n,i){yL(e,"resizeBilinear");const[a,o,s,l]=e.shape,u=this.readSync(e.dataId),c=new Float32Array(r.sizeFromShape([a,t,n,l])),d=[i&&t>1?o-1:o,i&&n>1?s-1:s],h=[i&&t>1?t-1:t,i&&n>1?n-1:n];let f=0;const p=d[0]/h[0],m=d[1]/h[1];for(let r=0;r<a;r++)for(let i=0;i<t;i++){const t=p*i,a=Math.floor(t),d=t-a,h=Math.min(o-1,Math.ceil(t)),g=r*e.strides[0]+a*e.strides[1],v=r*e.strides[0]+h*e.strides[1];for(let r=0;r<n;r++){const t=m*r,n=Math.floor(t),i=t-n,a=Math.min(s-1,Math.ceil(t)),o=g+n*e.strides[2],h=v+n*e.strides[2],p=g+a*e.strides[2],y=v+a*e.strides[2];for(let e=0;e<l;e++){const t=u[o+e],n=u[h+e],r=t+(u[p+e]-t)*i;c[f++]=r+(n+(u[y+e]-n)*i-r)*d}}}return Hy(c,[a,t,n,l])}resizeBilinearBackprop(e,t,n){yL([e,t],"resizeBilinearBackprop");const[r,i,a,o]=t.shape,[,s,l]=e.shape,u=new Float32Array(r*i*a*o),c=[n&&s>1?i-1:i,n&&l>1?a-1:a],d=[n&&s>1?s-1:s,n&&l>1?l-1:l],h=c[0]/d[0],f=c[1]/d[1],p=this.readSync(e.dataId);let m=0;for(let g=0;g<r;g++){const e=g*t.strides[0];for(let n=0;n<s;n++){const r=n*h,s=Math.floor(r),c=Math.min(Math.ceil(r),i-1),d=e+s*t.strides[1],g=e+c*t.strides[1],v=r-s,y=1-v;for(let e=0;e<l;e++){const n=e*f,r=Math.floor(n),i=Math.min(Math.ceil(n),a-1),s=n-r,l=1-s,c=d+r*t.strides[2],h=d+i*t.strides[2],b=g+r*t.strides[2],x=g+i*t.strides[2],w=y*l,_=y*s,S=v*l,E=v*s;for(let e=0;e<o;e++){const t=p[m++];u[c+e]+=t*w,u[h+e]+=t*_,u[b+e]+=t*S,u[x+e]+=t*E}}}}return sT(u,[r,a,i,o],t.dtype)}resizeNearestNeighbor(e,t,n,r){yL(e,"resizeNearestNeighbor");const[i,a,o,s]=e.shape,l=this.readSync(e.dataId),u=new Float32Array(i*t*n*s),c=[r&&t>1?a-1:a,r&&n>1?o-1:o],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=c[0]/d[0],f=c[1]/d[1];let p=0;for(let m=0;m<i;m++){const i=m*e.strides[0];for(let c=0;c<t;c++){const t=h*c,d=i+Math.min(a-1,r?Math.round(t):Math.floor(t))*e.strides[1];for(let i=0;i<n;i++){const t=f*i,n=d+Math.min(o-1,r?Math.round(t):Math.floor(t))*e.strides[2];for(let e=0;e<s;e++)u[p++]=l[n+e]}}}return Hy(u,[i,t,n,s],e.dtype)}resizeNearestNeighborBackprop(e,t,n){yL([e,t],"resizeNearestNeighborBackprop");const[r,i,a,o]=t.shape,[,s,l]=e.shape,u=new Float32Array(r*i*a*o),c=this.readSync(e.dataId),d=[n&&s>1?i-1:i,n&&l>1?a-1:a],h=[n&&s>1?s-1:s,n&&l>1?l-1:l],f=d[0]/h[0],p=d[1]/h[1],m=1/f,g=1/p,v=2*Math.ceil(m)+2,y=2*Math.ceil(g)+2;for(let b=0;b<r;b++){const r=b*t.strides[0];for(let d=0;d<i;d++){const h=r+d*t.strides[1],b=Math.floor(d*m),x=Math.floor(b-v/2);for(let m=0;m<a;m++){const b=h+m*t.strides[2],w=Math.floor(m*g),_=Math.floor(w-y/2);for(let t=0;t<o;t++){let o=0;for(let u=0;u<v;u++){const h=u+x;if(h<0||h>=s)continue;const g=r+h*e.strides[1],v=h*f;if(d===Math.min(i-1,n?Math.round(v):Math.floor(v)))for(let r=0;r<y;r++){const i=r+_;if(i<0||i>=l)continue;const s=g+i*e.strides[2],u=i*p;m===Math.min(a-1,n?Math.round(u):Math.floor(u))&&(o+=c[s+t])}}u[b+t]=o}}}}return sT(u,t.shape,t.dtype)}localResponseNormalization4D(e,t,n,r,i){yL(e,"localResponseNormalization4D");const a=e.shape[3],o=a-1,s=this.readSync(e.dataId),l=e.size,u=new Float32Array(l);function c(e){const n=e%a;let r=e-n+Math.max(0,n-t);const i=e-n+Math.min(n+t,o);let l=0;for(;r<=i;r++){const e=s[r];l+=e*e}return l}for(let d=0;d<l;d++){const e=c(d),t=s[d]*Math.pow(n+r*e,-i);u[d]=t}return sT(u,e.shape)}LRNGrad(e,t,n,r,i,a,o){yL(e,"LRNGrad");const s=e.shape[3],l=this.readSync(e.dataId),u=this.readSync(t.dataId),c=this.readSync(n.dataId),d=new Float32Array(e.size),h=e.size;for(let f=0;f<h;f++){const e=f%s,t=f-e+Math.max(0,e-r),n=f-e+Math.min(s,e+r+1);let h=0;for(let r=t;r<n;r++)h+=Math.pow(u[r],2);h=a*h+i;for(let r=t;r<n;r++){let e=-2*a*o*u[r]*c[f]/h;f===r&&(e+=Math.pow(h,-o)),e*=l[f],d[r]+=e}}return sT(d,e.shape)}multinomial(e,t,n,r){yL(e,"multinomial");const i=t?e:GE(e),a=i.shape[0],o=i.shape[1],s=YS([a,n],"int32"),l=this.readSync(s.dataId),u=this.readSync(i.dataId);for(let c=0;c<a;++c){const e=c*o,t=new Float32Array(o-1);t[0]=u[e];for(let n=1;n<t.length;++n)t[n]=t[n-1]+u[e+n];const i=yE.alea(r.toString()),a=c*n;for(let r=0;r<n;++r){const e=i();l[a+r]=t.length;for(let n=0;n<t.length;n++)if(e<t[n]){l[a+r]=n;break}}}return s}oneHot(e,t,n,r){yL(e,"oneHot");const i=new Float32Array(e.size*t);i.fill(r);const a=this.readSync(e.dataId);for(let o=0;o<e.size;++o)a[o]>=0&&a[o]<t&&(i[o*t+a[o]]=n);return oT(i,[e.size,t],"int32")}nonMaxSuppression(e,t,n,r,i){yL(e,"nonMaxSuppression");const a=this.readSync(e.dataId),o=this.readSync(t.dataId);return bL(a,o,n,r,i)}depthToSpace(e,t,n){r.assert("NHWC"===n,()=>"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n),r.assert(t>1,()=>"blockSize should be > 1 for depthToSpace, but was: "+t);const i=e.shape[0],a=e.shape[1],o=e.shape[2],s=e.shape[3],l=a*t,u=o*t,c=s/(t*t),d=this.readSync(e.dataId),h=new Float32Array(i*l*u*c);let f=0;for(let r=0;r<i;++r)for(let e=0;e<l;++e){const n=Math.floor(e/t),i=e%t;for(let e=0;e<u;++e){const l=Math.floor(e/t),u=(i*t+e%t)*c;for(let e=0;e<c;++e)h[f++]=d[e+u+s*(l+o*(n+a*r))]}}return sT(h,[i,l,u,c])}broadcastedBinaryOp(e,t,n,r){const i=g.assertAndGetBroadcastShape(e.shape,t.shape),a=Rb(i,n),o=this.readSync(e.dataId),s=this.readSync(t.dataId),l=g.getBroadcastDims(e.shape,i),u=g.getBroadcastDims(t.shape,i),c=a.values;if(l.length+u.length===0)for(let d=0;d<c.length;++d)c[d]=r(o[d%o.length],s[d%s.length]);else{const n=this.bufferSync(e),i=this.bufferSync(t);for(let d=0;d<c.length;++d){const h=a.indexToLoc(d),f=h.slice(-e.rank);l.forEach(e=>f[e]=0);const p=n.locToIndex(f),m=h.slice(-t.rank);u.forEach(e=>m[e]=0);const g=i.locToIndex(m);c[d]=r(o[p],s[g])}}return a.toTensor()}split(e,t,n){return xL(e,t,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}cropAndResize(e,t,n,r,i,a){const[o,s,l,u]=e.shape,c=t.shape[0],[d,h]=r,f=Rb([c,d,h,u],"float32"),p=this.readSync(t.dataId),m=this.readSync(n.dataId),g=this.readSync(e.dataId),v=e.strides,y=f.strides;for(let b=0;b<c;b++){const e=4*b,t=p[e],n=p[e+1],r=p[e+2],c=p[e+3],x=m[b];if(x>=o)continue;const w=d>1?(r-t)*(s-1)/(d-1):0,_=h>1?(c-n)*(l-1)/(h-1):0;for(let o=0;o<d;o++){const e=d>1?t*(s-1)+o*w:.5*(t+r)*(s-1);if(e<0||e>s-1)for(let t=0;t<h;t++)for(let e=0;e<u;e++)f.values[e+t*y[2]+o*y[1]+b*y[0]]=a;else if("bilinear"===i){const t=Math.floor(e),r=Math.ceil(e),i=e-t;for(let e=0;e<h;e++){const s=h>1?n*(l-1)+e*_:.5*(n+c)*(l-1);if(s<0||s>l-1){for(let t=0;t<u;t++)f.values[t+e*y[2]+o*y[1]+b*y[0]]=a;continue}const d=Math.floor(s),p=Math.ceil(s),m=s-d;for(let n=0;n<u;n++){let a=n+d*v[2]+t*v[1]+x*v[0];const s=g[a];a=n+p*v[2]+t*v[1]+x*v[0];const l=g[a];a=n+d*v[2]+r*v[1]+x*v[0];const u=g[a];a=n+p*v[2]+r*v[1]+x*v[0];const c=g[a],h=s+(l-s)*m;a=n+e*y[2]+o*y[1]+b*y[0],f.values[a]=h+(u+(c-u)*m-h)*i}}}else for(let t=0;t<h;++t){const r=h>1?n*(l-1)+t*_:.5*(n+c)*(l-1);if(r<0||r>l-1){for(let e=0;e<u;e++)f.values[e+t*y[2]+o*y[1]+b*y[0]]=a;continue}const i=Math.round(r),s=Math.round(e);for(let e=0;e<u;e++)f.values[e+t*y[2]+o*y[1]+b*y[0]]=g[e+i*v[2]+s*v[1]+x*v[0]]}}}return f.toTensor()}sparseToDense(e,t,n,r){const{sliceRank:i,numUpdates:a,sliceSize:o,strides:s,outputSize:l}=g.calculateShapes(t,e,n);return this.scatter(e,t,n,l,o,a,i,s,r,!1)}gatherND(e,t){const n=t.shape,r=n[n.length-1],[i,a,o,s]=g.prepareAndValidate(e,t);if(0===a)return Hy([],i,e.dtype);const l=new uy([a,o],e.dtype),u=this.readSync(t.dataId),c=this.readSync(e.dataId);for(let d=0;d<a;d++){const t=[];let n=0;for(let e=0;e<r;e++){const i=u[d*r+e];n+=i*s[e],t.push(i)}if(n<0||n>=e.size/o)throw new Error(`Invalid indices: ${t} does not index into ${e.shape}`);for(let e=0;e<o;e++)l.values[d*o+e]=c[n*o+e]}return l.toTensor().reshape(i)}scatterND(e,t,n){const{sliceRank:r,numUpdates:i,sliceSize:a,strides:o,outputSize:s}=g.calculateShapes(t,e,n),l=Tw(0);return this.scatter(e,t,n,s,a,i,r,o,l,!0)}onesLike(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return Iw(e.shape,1,e.dtype)}zerosLike(e){const t=r.getArrayFromDType(e.dtype,r.sizeFromShape(e.shape));return this.makeOutput(t,e.shape,e.dtype)}linspace(e,t,n){return g.linspaceImpl(e,t,n)}scatter(e,t,n,r,i,a,o,s,l,u){const c=[r/i,i],d=this.readSync(e.dataId),h=this.readSync(t.dataId);if(0===r)return Hy([],n,t.dtype);const f=new uy(c,t.dtype);f.values.fill(this.readSync(l.dataId)[0]);for(let p=0;p<a;p++){const e=[];let a=0;for(let t=0;t<o;t++){const n=d[p*o+t];e.push(n),a+=n*s[t]}if(a<0||a>=r/i)throw new Error(`Invalid indices: ${e} does not index into ${n}`);for(let n=0;n<i;n++)u?f.values[a*i+n]+=h[p*i+n]:f.values[a*i+n]=0===t.rank?h[0]:h[p*i+n]}return f.toTensor().reshape(n)}}function TL(e,t,n){return({inputs:i,attrs:a,backend:o})=>{const{x:s}=i;if(yL(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const l=o,u=l.data.get(s.dataId).values,c=r.sizeFromShape(s.shape),d=n||s.dtype,h=r.getArrayFromDType(d,c);for(let e=0;e<c;++e)h[e]=t(u[e],a);return l.makeTensorInfo(s.shape,d,h)}}function kL(e,t,n){return({inputs:r,attrs:i,backend:a})=>{const{x:o}=r;if(yL(o,e),"string"===o.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const s=a,l=s.data.get(o.dataId).values,u=n||o.dtype,c=t(l,u,i);return s.makeTensorInfo(o.shape,u,c)}}lw("cpu",()=>new EL,1);const CL=TL(Hm,e=>e>=0?e:Math.exp(e)-1),IL={kernelName:Hm,backendName:"cpu",kernelFunc:CL};function OL(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const AL={kernelName:ag,backendName:"cpu",kernelFunc:OL};function DL(e){return(t,n,i,a,o)=>{const s=g.assertAndGetBroadcastShape(t,n),l=s.length,u=r.computeStrides(s),c=r.sizeFromShape(s),d=r.getTypedArrayFromDType(o,c),h=t.length,f=n.length,p=r.computeStrides(t),m=r.computeStrides(n),v=g.getBroadcastDims(t,s),y=g.getBroadcastDims(n,s);if(v.length+y.length===0)for(let r=0;r<d.length;++r)d[r]=e(i[r%i.length],a[r%a.length]);else for(let g=0;g<d.length;++g){const t=r.indexToLoc(g,l,u),n=t.slice(-h);v.forEach(e=>n[e]=0);const o=r.locToIndex(n,h,p),s=t.slice(-f);y.forEach(e=>s[e]=0);const c=r.locToIndex(s,f,m);d[g]=e(i[o],a[c])}return[d,s]}}const ML=DL((e,t)=>e<0?t*e:e);function NL(e){const{inputs:t,backend:n}=e,{x:r,alpha:i}=t;yL([r,i],"prelu");const a=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,[s,l]=ML(r.shape,i.shape,a,o,r.dtype);return n.makeTensorInfo(l,r.dtype,s)}const jL={kernelName:Vg,backendName:"cpu",kernelFunc:NL},RL=TL(Kg,e=>Math.max(0,e)),PL={kernelName:Kg,backendName:"cpu",kernelFunc:RL},FL=TL(nv,e=>Math.min(Math.max(0,e),6)),LL={kernelName:nv,backendName:"cpu",kernelFunc:FL};function $L(e,t,n,r){if("linear"===n)return OL({inputs:{x:t},backend:e});if("relu"===n)return RL({inputs:{x:t},backend:e});if("elu"===n)return CL({inputs:{x:t},backend:e});if("relu6"===n)return FL({inputs:{x:t},backend:e});if("prelu"===n)return NL({inputs:{x:t,alpha:r},backend:e});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}function BL(e){const{inputs:t,backend:n}=e,{real:r,imag:i}=t,a=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",a),imag:n.makeTensorInfo(i.shape,"float32",o)},s}const zL={kernelName:_m,backendName:"cpu",kernelFunc:BL};function UL(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.data.get(r.dataId).complexTensorInfos.real,a=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,a)}const HL={kernelName:Yg,backendName:"cpu",kernelFunc:UL};function WL(e){const{inputs:t,backend:n,attrs:i}=e,{x:a}=t,{dtype:o}=i;if("complex64"===o){if("complex64"===a.dtype)return OL({inputs:{x:a},backend:n});const e=YS(a.shape),t=WL({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),r=BL({inputs:{real:t,imag:e},backend:n});return e.dispose(),n.disposeIntermediateTensorInfo(t),r}if("complex64"===a.dtype){const e=UL({inputs:{input:a},backend:n}),t=WL({inputs:{x:e},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(e),t}if(!r.hasEncodingLoss(a.dtype,o)){const e=OL({inputs:{x:a},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:o}}if("int32"===o){const e=n.data.get(a.dataId).values,t=Int32Array.from(e);return n.makeTensorInfo(a.shape,"int32",t)}if("bool"===o){const e=n.data.get(a.dataId).values,t=r.toTypedArray([0],a.dtype),[i,o]=DL((e,t)=>e!==t?1:0)(a.shape,[],e,t,"bool");return n.makeTensorInfo(o,"bool",i)}throw new Error(`Error in Cast: failed to cast ${a.dtype} to ${o}`)}const VL={kernelName:bm,backendName:"cpu",kernelFunc:WL};function qL(e,t,n,r){return null==n?({inputs:n,backend:i})=>{const{a:a,b:o}=n,s=i;yL([a,o],e);const l=s.data.get(a.dataId).values,u=s.data.get(o.dataId).values,c=r||a.dtype,[d,h]=t(a.shape,o.shape,l,u,c);return s.makeTensorInfo(h,c,d)}:({inputs:e,backend:i})=>{const{a:a,b:o}=e,s=i;if("complex64"===a.dtype||"complex64"===o.dtype){const e=WL({inputs:{x:a},backend:s,attrs:{dtype:"complex64"}}),t=s.data.get(e.dataId),r=t.complexTensorInfos.imag,i=s.data.get(t.complexTensorInfos.real.dataId).values,l=s.data.get(r.dataId).values,u=WL({inputs:{x:o},backend:s,attrs:{dtype:"complex64"}}),c=s.data.get(u.dataId),d=c.complexTensorInfos.imag,h=s.data.get(c.complexTensorInfos.real.dataId).values,f=s.data.get(d.dataId).values,[p,m,g]=n(a.shape,o.shape,i,l,h,f),v=s.makeTensorInfo(g,"float32",p),y=s.makeTensorInfo(g,"float32",m),b=BL({inputs:{real:v,imag:y},backend:s});return s.disposeIntermediateTensorInfo(e),s.disposeIntermediateTensorInfo(u),s.disposeIntermediateTensorInfo(v),s.disposeIntermediateTensorInfo(y),b}{const e=s.data.get(a.dataId).values,n=s.data.get(o.dataId).values,i=r||a.dtype,[l,u]=t(a.shape,o.shape,e,n,i);return s.makeTensorInfo(u,i,l)}}}function GL(e){return(t,n,i,a,o,s)=>{const l=g.assertAndGetBroadcastShape(t,n),u=r.sizeFromShape(l),c=l.length,d=r.computeStrides(l),h=r.getTypedArrayFromDType("float32",u),f=r.getTypedArrayFromDType("float32",u),p=g.getBroadcastDims(t,l),m=g.getBroadcastDims(n,l),v=g.mergeRealAndImagArrays(i,a),y=g.mergeRealAndImagArrays(o,s),b=t.length,x=r.computeStrides(t),w=n.length,_=r.computeStrides(n);if(p.length+m.length===0)for(let r=0;r<h.length;r++){const t=r%v.length,n=r%y.length,i=e(v[2*t],v[2*t+1],y[2*n],y[2*n+1]);h[r]=i.real,f[r]=i.imag}else for(let g=0;g<h.length;g++){const t=r.indexToLoc(g,c,d),n=t.slice(-b);p.forEach(e=>n[e]=0);const i=r.locToIndex(n,b,x),a=t.slice(-w);m.forEach(e=>a[e]=0);const o=r.locToIndex(a,w,_),s=e(v[2*i],v[2*i+1],y[2*o],y[2*o+1]);h[g]=s.real,f[g]=s.imag}return[h,f,l]}}const YL=DL((e,t)=>e+t),XL=GL((e,t,n,r)=>({real:e+n,imag:t+r})),KL=qL(tm,YL,XL),ZL={kernelName:tm,backendName:"cpu",kernelFunc:KL};function JL(e){const{inputs:t,backend:n,attrs:i}=e,{x:a}=t,{shape:o}=i,s=r.sizeFromShape(a.shape),l=r.inferFromImplicitShape(o,s),u=r.sizeFromShape(l);r.assert(s===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${a.shape}) has ${s} elements. The new shape and old shape must have the same number of elements.`),n.incRef(a.dataId);const c=n.data.get(a.dataId);if(null!=c.complexTensorInfos){const e=c.complexTensorInfos.imag;c.complexTensorInfos.real.shape=l,e.shape=l}return{dataId:a.dataId,shape:l,dtype:a.dtype}}const QL={kernelName:Zg,backendName:"cpu",kernelFunc:JL};function e$(e){const{inputs:t,backend:n,attrs:i}=e,{a:a,b:o}=t,{transposeA:s,transposeB:l}=i;yL([a,o],"matMul");const u=a.shape.length,c=o.shape.length,d=s?a.shape[u-2]:a.shape[u-1],h=l?o.shape[c-1]:o.shape[c-2],f=s?a.shape[u-1]:a.shape[u-2],p=l?o.shape[c-2]:o.shape[c-1],m=a.shape.slice(0,-2),g=o.shape.slice(0,-2),v=r.sizeFromShape(m),y=r.sizeFromShape(g);r.assert(u>=2&&c>=2&&(v===y||1===v||1===y),()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${m}) and (${g}).`);const b=(v>y?a.shape.slice(0,-2):o.shape.slice(0,-2)).concat([f,p]);r.assert(d===h,()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${a.shape} and ${o.shape} and transposeA=${s} and transposeB=${l} must match.`);const x=l?[y,p,h]:[y,h,p],w=JL({inputs:{x:a},backend:n,attrs:{shape:s?[v,d,f]:[v,f,d]}}),_=JL({inputs:{x:o},backend:n,attrs:{shape:x}}),S=s?w.shape[1]:w.shape[2],E=s?w.shape[2]:w.shape[1],T=l?_.shape[1]:_.shape[2],k=Math.max(v,y),C=n.data.get(w.dataId).values,I=n.data.get(_.dataId).values,O=r.computeStrides(w.shape),A=r.computeStrides(_.shape),[D,M,N]=s?[O[0],1,O[1]]:[O[0],O[1],1],[j,R,P]=l?[1,A[1],A[0]]:[A[1],1,A[0]],F=E*T,L=Rb([k,E,T],w.dtype),$=L.values,B=n.blockSize;for(let r=0;r<k;r++)for(let e=0;e<E;e+=B)for(let t=0;t<T;t+=B)for(let n=0;n<S;n+=B){const i=Math.min(e+B,E),a=Math.min(t+B,T),o=Math.min(n+B,S);for(let s=e;s<i;s++)for(let e=t;e<a;e++){let t=0;for(let i=n;i<o;i++){const n=Math.min(r,v-1)*D,a=Math.min(r,y-1)*P;t+=C[n+s*M+i*N]*I[i*j+e*R+a]}$[r*F+(s*T+e)]+=t}}return n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(_),n.makeTensorInfo(b,L.dtype,L.values)}const t$={kernelName:gm,backendName:"cpu",kernelFunc:e$},n$={kernelName:Fv,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:a,bias:o,preluActivationWeights:s}=t,{transposeA:l,transposeB:u,activation:c}=r;let d,h,f;const p=[];d=e$({inputs:{a:i,b:a},attrs:{transposeA:l,transposeB:u},backend:n}),o&&(h=KL({inputs:{a:d,b:o},backend:n}),p.push(d),d=h),c&&(f=$L(n,d,c,s),p.push(d),d=f);for(const m of p)n.disposeIntermediateTensorInfo(m);return d}};function r$(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}const i$={kernelName:Jp,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend;let i=new Float32Array(r.sizeFromShape(t.shape));if("complex64"!==t.dtype)i=r$(n.data.get(t.dataId).values);else{const e=n.data.get(t.dataId),r=e.complexTensorInfos.imag,a=n.data.get(e.complexTensorInfos.real.dataId).values,o=n.data.get(r.dataId).values;for(let t=0;t<a.length;t++)i[t]=Math.hypot(a[t],o[t])}return n.makeOutput(i,t.shape,"float32")}},a$=TL(Qp,e=>Math.acos(e)),o$={kernelName:Qp,backendName:"cpu",kernelFunc:a$},s$=TL(em,e=>Math.acosh(e)),l$={kernelName:em,backendName:"cpu",kernelFunc:s$},u$=TL(sm,e=>Math.asin(e)),c$={kernelName:sm,backendName:"cpu",kernelFunc:u$},d$=TL(lm,e=>Math.asinh(e)),h$={kernelName:lm,backendName:"cpu",kernelFunc:d$},f$=TL(um,e=>Math.atan(e)),p$={kernelName:um,backendName:"cpu",kernelFunc:f$},m$=TL(cm,e=>Math.atanh(e)),g$={kernelName:cm,backendName:"cpu",kernelFunc:m$};function v$(e,t,n,r,i,a){const o=i.strideHeight,s=i.strideWidth,l=i.dilationHeight,u=i.dilationWidth,c=i.effectiveFilterHeight,d=i.effectiveFilterWidth,h=i.padInfo.top,f=i.padInfo.left,p="max"===a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=Rb(i.outShape,n),g=m.values,v=i.outShape[1]*i.outShape[2]*i.outShape[3],y=i.outShape[2]*i.outShape[3],b=i.outShape[3];for(let x=0;x<i.batchSize;++x){const t=x*v,n=x*r[0];for(let m=0;m<i.inChannels;++m)for(let v=0;v<i.outHeight;++v){const x=v*o-h,w=Math.max(0,x),_=Math.min(i.inHeight,c+x),S=t+v*y;for(let t=0;t<i.outWidth;++t){const o=t*s-f,c=Math.max(0,o),h=Math.min(i.inWidth,d+o);let v=p,y=0,x=0;for(let t=w;t<_;t+=l){const i=n+t*r[1];for(let t=c;t<h;t+=u){const n=e[i+t*r[2]+m];"max"===a&&n>v?v=n:"avg"===a&&(y+=n,x++)}if(isNaN(v))break}g[S+t*b+m]="avg"===a?y/x:v}}}return m}function y$(e,t,n,r,i=!1,a=!1){const o=Rb(r.outShape,"int32"),s=r.strideHeight,l=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,f=r.padInfo.top,p=r.padInfo.left,m=Rb(t,n,e);for(let g=0;g<r.batchSize;++g)for(let e=0;e<r.inChannels;++e)for(let t=0;t<r.outHeight;++t){const n=t*s-f;let v=n;for(;v<0;)v+=u;const y=Math.min(r.inHeight,d+n);for(let s=0;s<r.outWidth;++s){const d=s*l-p;let f=d;for(;f<0;)f+=c;const b=Math.min(r.inWidth,h+d);let x=Number.NEGATIVE_INFINITY,w=-1;for(let t=v;t<y;t+=u){const o=t-n;for(let n=f;n<b;n+=c){const s=n-d,l=m.get(g,t,n,e);l>x&&(x=l,w=i?a?((g*r.inHeight+t)*r.inWidth+n)*r.inChannels+e:(t*r.inWidth+n)*r.inChannels+e:o*h+s)}}o.set(w,g,t,s,e)}}return o}const b$={kernelName:hm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:a}=t;yL(a,"avgPool");const{filterSize:o,strides:s,pad:l,dimRoundingMode:u}=i;r.assert(g.eitherStridesOrDilationsAreOne(s,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '1'`);const c=g.computePool2DInfo(a.shape,o,s,1,l,u);let d;if(1===c.filterWidth&&1===c.filterHeight&&r.arraysEqual(c.inShape,c.outShape))d=OL({inputs:{x:a},backend:n});else{const e=n.data.get(a.dataId).values,t=r.computeStrides(a.shape),i=v$(e,0,a.dtype,t,c,"avg");d=n.makeTensorInfo(c.outShape,a.dtype,i.values)}return d}},x$={kernelName:fm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,o=a;yL([i,a],"avgPoolBackprop");const{filterSize:s,strides:l,pad:u}=r,c=g.computePool2DInfo(o.shape,s,l,1,u),d=c.strideHeight,h=c.strideWidth,f=c.filterHeight,p=c.filterWidth,m=c.dilationHeight,v=c.dilationWidth,y=c.effectiveFilterHeight,b=c.effectiveFilterWidth,x=b-1-c.padInfo.left,w=y-1-c.padInfo.top,_=Rb(o.shape,"float32"),S=1/(f*p),E=n.data.get(i.dataId).values,T=Rb(i.shape,"float32",E);for(let g=0;g<c.batchSize;++g)for(let e=0;e<c.inChannels;++e)for(let t=0;t<c.inHeight;++t)for(let n=0;n<c.inWidth;++n){const r=t-w,i=n-x;let a=0;for(let t=0;t<y;t+=m){const n=(r+t)/d;if(!(n<0||n>=c.outHeight||Math.floor(n)!==n))for(let t=0;t<b;t+=v){const r=(i+t)/h;r<0||r>=c.outWidth||Math.floor(r)!==r||(a+=T.get(g,n,r,e))}}_.set(a*S,g,t,n,e)}return n.makeTensorInfo(_.shape,_.dtype,_.values)}},w$={kernelName:eg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:a,scale:o,offset:s,mean:l,variance:u}=t;r.assert(l.shape.length===u.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),r.assert(null==s||l.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),r.assert(null==o||l.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),yL([a,l,u,o,s],"batchNorm");let{varianceEpsilon:c}=i;null==c&&(c=.001);const d=n.data.get(a.dataId).values,h=n.data.get(l.dataId).values,f=n.data.get(u.dataId).values,p=o?n.data.get(o.dataId).values:new Float32Array([1]),m=s?n.data.get(s.dataId).values:new Float32Array([0]),g=new Float32Array(d.length),v=m.length,y=p.length,b=f.length,x=h.length;let w=0,_=0,S=0,E=0;for(let r=0;r<d.length;++r)g[r]=m[w++]+(d[r]-h[_++])*p[S++]/Math.sqrt(f[E++]+c),w>=v&&(w=0),_>=x&&(_=0),S>=y&&(S=0),E>=b&&(E=0);return n.makeTensorInfo(a.shape,a.dtype,g)}};function _$(e){return(t,n,i)=>{const a=r.getTypedArrayFromDType(n,t.length);for(let r=0;r<t.length;++r)a[r]=e(t[r],i);return a}}const S$=_$(e=>Math.ceil(e)),E$=kL(xm,S$),T$={kernelName:xm,backendName:"cpu",kernelFunc:E$},k$=TL(wm,(e,t)=>e>t.clipValueMax?t.clipValueMax:e<t.clipValueMin?t.clipValueMin:e),C$={kernelName:wm,backendName:"cpu",kernelFunc:k$};function I$(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.data.get(r.dataId).complexTensorInfos.imag,a=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,a)}const O$={kernelName:sg,backendName:"cpu",kernelFunc:I$};function A$(e){const{inputs:t,backend:n,attrs:i}=e,{axis:a}=i,o=r.parseAxisParam(a,t[0].shape)[0];let s=g.computeOutShape(t.map(e=>e.shape),o);if(0===r.sizeFromShape(s))return n.makeTensorInfo(s,t[0].dtype,[]);const l=t.filter(e=>r.sizeFromShape(e.shape)>0);if(1===l.length)return l[0];const u=l.map(e=>e.shape);if(g.assertParamsConsistent(u,o),"complex64"===l[0].dtype){const e=l.map(e=>UL({inputs:{input:e},backend:n})),t=l.map(e=>I$({inputs:{input:e},backend:n})),r=A$({inputs:e,backend:n,attrs:{axis:o}}),i=A$({inputs:t,backend:n,attrs:{axis:o}}),a=BL({inputs:{real:r,imag:i},backend:n});return e.forEach(e=>n.disposeIntermediateTensorInfo(e)),t.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),a}const c=l.map(e=>{const t=r.sizeFromShape(e.shape.slice(o));return JL({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})});s=g.computeOutShape(c.map(e=>e.shape),1);const d=r.getTypedArrayFromDType(l[0].dtype,r.sizeFromShape(s));if(1===c[0].shape[0]){let e=0;c.forEach(t=>{const i=n.data.get(t.dataId).values,a=r.sizeFromShape(t.shape);d.set(i,e),e+=a})}else{let e=0;c.forEach(t=>{const r=n.data.get(t.dataId).values;let i=0;for(let n=0;n<t.shape[0];++n){const a=n*s[1]+e;for(let e=0;e<t.shape[1];++e)d[a+e]=r[i++]}e+=t.shape[1]})}const h=g.computeOutShape(l.map(e=>e.shape),o),f=n.makeTensorInfo(h,t[0].dtype,d);return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),f}const D$={kernelName:Sm,backendName:"cpu",kernelFunc:A$};function M$(e){const{inputs:t,backend:n,attrs:i}=e,{x:a,filter:o}=t,{strides:s,pad:l,dataFormat:u,dilations:c,dimRoundingMode:d}=i;yL([a,o],"conv2d");const h=g.convertConv2DDataFormat(u),f=g.computeConv2DInfo(a.shape,o.shape,s,c,l,d,!1,h),p=f.filterHeight,m=f.filterWidth,v=f.dilationHeight,y=f.dilationWidth,b=f.padInfo.left,x=f.padInfo.top,w="channelsLast"===f.dataFormat,_=new uy(f.outShape,a.dtype),S=r.computeStrides(a.shape),E=r.computeStrides(o.shape),T=S[0],k=w?S[1]:S[2],C=w?S[2]:1,I=w?1:S[1],O=_.strides[0],A=w?_.strides[1]:_.strides[2],D=w?_.strides[2]:1,M=w?1:_.strides[1],N=n.data.get(a.dataId).values,j=n.data.get(o.dataId).values,R=_.values;for(let r=0;r<f.batchSize;++r){const e=r*T,t=r*O;for(let n=0;n<f.outHeight;++n){const r=t+n*A,i=n*f.strideHeight-x;for(let t=0;t<p;++t){const n=i+t*v;if(n<0||n>=f.inHeight)continue;const a=t*E[0],o=e+n*k;for(let e=0;e<f.outWidth;++e){const t=r+e*D,n=e*f.strideWidth-b;for(let e=0;e<m;++e){const r=n+e*y;if(r<0||r>=f.inWidth)continue;const i=o+r*C;let s=a+e*E[1];for(let e=0;e<f.inChannels;++e){const n=N[i+e*I];for(let e=0;e<f.outChannels;++e)R[t+e*M]+=n*j[s+e];s+=f.outChannels}}}}}}return n.makeTensorInfo(_.shape,_.dtype,R)}const N$={kernelName:Em,backendName:"cpu",kernelFunc:M$},j$={kernelName:Tm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:o,pad:s,dataFormat:l,dimRoundingMode:u,filterShape:c}=r;yL([i,a],"conv2dBackpropFilter");const d=g.convertConv2DDataFormat(l),h=g.computeConv2DInfo(i.shape,c,o,1,s,u,!1,d),{strideHeight:f,strideWidth:p,filterHeight:m,filterWidth:v}=h,y="channelsLast"===h.dataFormat,b=new uy(h.filterShape,"float32"),x=h.padInfo.left,w=h.padInfo.top,_=n.data.get(i.dataId).values,S=n.data.get(a.dataId).values,E=new uy(i.shape,i.dtype,_),T=new uy(a.shape,a.dtype,S);for(let g=0;g<m;++g){const e=Math.max(0,Math.ceil((w-g)/f)),t=Math.min(h.outHeight,(h.inHeight+w-g)/f);for(let n=0;n<v;++n){const r=Math.max(0,Math.ceil((x-n)/p)),i=Math.min(h.outWidth,(h.inWidth+x-n)/p);for(let a=0;a<h.inChannels;++a)for(let o=0;o<h.outChannels;++o){let s=0;for(let l=0;l<h.batchSize;++l)for(let u=e;u<t;++u){const e=g+u*f-w;for(let t=r;t<i;++t){const r=n+t*p-x;s+=y?E.get(l,e,r,a)*T.get(l,u,t,o):E.get(l,a,e,r)*T.get(l,o,u,t)}}b.set(s,g,n,a,o)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}},R$={kernelName:km,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:a,filter:o}=t,{inputShape:s,strides:l,pad:u,dataFormat:c,dimRoundingMode:d}=i;yL([a,o],"conv2dBackpropInput");const h=r.computeStrides(o.shape),f=r.computeStrides(a.shape);let p=g.convertConv2DDataFormat(c);const m=g.computeConv2DInfo(s,o.shape,l,1,u,d,!1,p),v=new uy(m.inShape,"float32"),y=v.values,b=n.data.get(a.dataId).values,x=n.data.get(o.dataId).values,[w,_,S]=h,{batchSize:E,filterHeight:T,filterWidth:k,inChannels:C,inHeight:I,inWidth:O,outChannels:A,outHeight:D,outWidth:M,strideHeight:N,strideWidth:j}=m;p=m.dataFormat;const R=T-1-m.padInfo.top,P=k-1-m.padInfo.left,F="channelsLast"===p,L=v.strides[0],$=F?v.strides[1]:v.strides[2],B=F?v.strides[2]:1,z=F?1:v.strides[1],U=f[0],H=F?f[1]:f[2],W=F?f[2]:1,V=F?1:f[1];for(let r=0;r<E;++r)for(let e=0;e<C;++e)for(let t=0;t<I;++t){const n=t-R,i=Math.max(0,Math.ceil(n/N)),a=Math.min(D,(T+n)/N);for(let o=0;o<O;++o){const s=o-P,l=Math.max(0,Math.ceil(s/j)),u=Math.min(M,(k+s)/j);let c=0;for(let t=i;t<a;++t){const i=t*N-n;for(let n=l;n<u;++n){const a=U*r+H*t+W*n,o=w*(T-1-i)+_*(k-1-(n*j-s))+S*e;for(let e=0;e<A;++e)c+=b[a+V*e]*x[o+e]}}y[L*r+$*t+B*o+z*e]=c}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}},P$={kernelName:Cm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:a,filter:o}=t,{strides:s,pad:l,dilations:u}=i;yL([a,o],"conv3d");const c=g.computeConv3DInfo(a.shape,o.shape,s,u,l),{filterDepth:d,filterHeight:h,filterWidth:f,dilationDepth:p,dilationHeight:m,dilationWidth:v,padInfo:y}=c,b=y.front,x=y.left,w=y.top,_=new uy(c.outShape,a.dtype),S=n.data.get(a.dataId).values,E=n.data.get(o.dataId).values,T=_.values,k=r.computeStrides(a.shape),C=r.computeStrides(o.shape);for(let r=0;r<c.batchSize;++r){const e=r*k[0],t=r*_.strides[0];for(let n=0;n<c.outDepth;++n){const r=t+n*_.strides[1],i=n*c.strideDepth-b;for(let t=0;t<d;++t){const n=i+t*p;if(n<0||n>=c.inDepth)continue;const a=t*C[0],o=e+n*k[1];for(let e=0;e<c.outHeight;++e){const t=r+e*_.strides[2],n=e*c.strideHeight-w;for(let e=0;e<h;++e){const r=n+e*m;if(r<0||r>=c.inHeight)continue;const i=a+e*C[1],s=o+r*k[2];for(let e=0;e<c.outWidth;++e){const n=t+e*c.outChannels,r=e*c.strideWidth-x;for(let e=0;e<f;++e){const t=r+e*v;if(t<0||t>=c.inWidth)continue;const a=s+t*c.inChannels;let o=i+e*C[2];for(let e=0;e<c.inChannels;++e){const t=S[a+e];for(let e=0;e<c.outChannels;++e)T[n+e]+=t*E[o+e];o+=c.outChannels}}}}}}}}return n.makeTensorInfo(_.shape,_.dtype,_.values)}},F$={kernelName:Im,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:a,dy:o}=t,{strides:s,pad:l,filterShape:u}=i;yL([a,o],"conv3dBackpropFilterV2");const c=r.computeStrides(a.shape),d=r.computeStrides(o.shape),h=g.computeConv3DInfo(a.shape,u,s,1,l),f=h.strideDepth,p=h.strideHeight,m=h.strideWidth,v=h.filterDepth,y=h.filterHeight,b=h.filterWidth,x=new uy(h.filterShape,"float32"),w=x.values,[_,S,E,T]=x.strides,k=n.data.get(o.dataId).values,[C,I,O,A]=d,D=n.data.get(a.dataId).values,[M,N,j,R]=c,P=h.padInfo.front,F=h.padInfo.left,L=h.padInfo.top;for(let r=0;r<v;++r){const e=Math.max(0,Math.ceil((P-r)/f)),t=Math.min(h.outDepth,(h.inDepth+P-r)/f),n=r*_;for(let i=0;i<y;++i){const a=Math.max(0,Math.ceil((L-i)/p)),o=Math.min(h.outHeight,(h.inHeight+L-i)/p),s=i*S+n;for(let n=0;n<b;++n){const l=Math.max(0,Math.ceil((F-n)/m)),u=Math.min(h.outWidth,(h.inWidth+F-n)/m),c=n*E+s;for(let s=0;s<h.inChannels;++s){const d=s*T+c;for(let c=0;c<h.outChannels;++c){let g=0;for(let d=0;d<h.batchSize;++d){const h=d*M,v=d*C;for(let d=e;d<t;++d){const e=(r+d*f-P)*N+h,t=d*I+v;for(let r=a;r<o;++r){const a=(i+r*p-L)*j+e,o=r*O+t;for(let e=l;e<u;++e)g+=D[(n+e*m-F)*R+a+s]*k[e*A+o+c]}}}w[d+c]=g}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}},L$={kernelName:Om,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:a,filter:o}=t,{pad:s,strides:l,inputShape:u}=i;yL([a],"conv3dBackpropInputV2");const c=r.computeStrides(a.shape),d=r.computeStrides(o.shape),h=g.computeConv3DInfo(u,o.shape,l,1,s),f=new uy(h.inShape,"float32"),p=f.values,[m,v,y,b]=f.strides,x=n.data.get(a.dataId).values,[w,_,S,E]=c,T=n.data.get(o.dataId).values,[k,C,I,O]=d,{batchSize:A,filterDepth:D,filterHeight:M,filterWidth:N,inChannels:j,inDepth:R,inHeight:P,inWidth:F,outChannels:L,outDepth:$,outHeight:B,outWidth:z,strideDepth:U,strideHeight:H,strideWidth:W}=h,V=D-1-h.padInfo.front,q=M-1-h.padInfo.top,G=N-1-h.padInfo.left;for(let r=0;r<A;++r)for(let e=0;e<j;++e)for(let t=0;t<R;++t){const n=t-V,i=Math.max(0,Math.ceil(n/U)),a=Math.min($,(D+n)/U);for(let o=0;o<P;++o){const s=o-q,l=Math.max(0,Math.ceil(s/H)),u=Math.min(B,(M+s)/H);for(let c=0;c<F;++c){const d=c-G,h=Math.max(0,Math.ceil(d/W)),f=Math.min(z,(N+d)/W);let g=0;for(let t=i;t<a;++t){const i=t*U-n;for(let n=l;n<u;++n){const a=n*H-s;for(let o=h;o<f;++o){const s=w*r+_*t+S*n+E*o,l=k*(D-1-i)+C*(M-1-a)+I*(N-1-(o*W-d))+O*e;for(let e=0;e<L;++e)g+=x[s+e]*T[l+e]}}}p[m*r+v*t+y*o+b*c+e]=g}}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}},$$=TL(Am,e=>Math.cos(e)),B$={kernelName:Am,backendName:"cpu",kernelFunc:$$},z$=TL(Dm,e=>Math.cosh(e)),U$={kernelName:Dm,backendName:"cpu",kernelFunc:z$};function H$(e){const{inputs:t,backend:n,attrs:i}=e,{x:a,filter:o}=t,{strides:s,pad:l,dilations:u,dimRoundingMode:c}=i;yL([a,o],"depthwiseConv2DNative");const d=r.computeStrides(a.shape),h=r.computeStrides(o.shape);let f=u;null==f&&(f=[1,1]),r.assert(g.eitherStridesOrDilationsAreOne(s,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${f}'`);const p=g.computeConv2DInfo(a.shape,o.shape,s,f,l,c,!0),{filterHeight:m,filterWidth:v,dilationHeight:y,dilationWidth:b,padInfo:x}=p,w=x.left,_=x.top,S=p.outChannels/p.inChannels,E=new uy(p.outShape,a.dtype),T=n.data.get(a.dataId).values,k=n.data.get(o.dataId).values,C=E.values;for(let r=0;r<p.batchSize;++r){const e=r*d[0],t=r*E.strides[0];for(let n=0;n<p.outHeight;++n){const r=t+n*E.strides[1],i=n*p.strideHeight-w;for(let t=0;t<m;++t){const n=i+t*y;if(n<0||n>=p.inHeight)continue;const a=t*h[0],o=e+n*d[1];for(let e=0;e<p.outWidth;++e){const t=r+e*E.strides[2],n=e*p.strideWidth-_;for(let e=0;e<v;++e){const r=n+e*b;if(r<0||r>=p.inWidth)continue;const i=o+r*p.inChannels;let s=t,l=a+e*h[1];for(let e=0;e<p.inChannels;++e){const t=T[i+e];for(let e=0;e<S;++e)C[s+e]+=t*k[l+e];s+=S,l+=S}}}}}}return n.makeTensorInfo(E.shape,E.dtype,E.values)}const W$={kernelName:Rm,backendName:"cpu",kernelFunc:H$},V$={kernelName:Pm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:o,dilations:s,pad:l,dimRoundingMode:u,filterShape:c}=r;yL([i,a],"depthwiseConv2dNativeBackpropFilter");const d=g.computeConv2DInfo(i.shape,c,o,s,l,u,!0),{strideHeight:h,strideWidth:f,filterHeight:p,filterWidth:m}=d,v=new uy(d.filterShape,"float32"),y=d.padInfo.left,b=d.padInfo.top,x=d.outChannels/d.inChannels,w=n.data.get(i.dataId).values,_=new uy(i.shape,i.dtype,w),S=n.data.get(a.dataId).values,E=new uy(a.shape,a.dtype,S);for(let g=0;g<p;++g){const e=Math.max(0,Math.ceil((b-g)/h)),t=Math.min(d.outHeight,(d.inHeight+b-g)/h);for(let n=0;n<m;++n){const r=Math.max(0,Math.ceil((y-n)/f)),i=Math.min(d.outWidth,(d.inWidth+y-n)/f);for(let a=0;a<d.outChannels;++a){const o=Math.trunc(a/x),s=a%x;let l=0;for(let u=0;u<d.batchSize;++u)for(let s=e;s<t;++s){const e=g+s*h-b;for(let t=r;t<i;++t)l+=_.get(u,e,n+t*f-y,o)*E.get(u,s,t,a)}v.set(l,g,n,o,s)}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}},q$={kernelName:Fm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:a,filter:o}=t,{strides:s,dilations:l,pad:u,dimRoundingMode:c,inputShape:d}=i;yL([a,o],"depthwiseConv2DNativeBackpropInput");const h=r.computeStrides(a.shape),f=r.computeStrides(o.shape),p=g.computeConv2DInfo(d,o.shape,s,l,u,c,!0),m=new uy(p.inShape,"float32"),v=m.values,[y,b,x]=m.strides,w=n.data.get(a.dataId).values,[_,S,E]=h,T=n.data.get(o.dataId).values,[k,C,I]=f,{batchSize:O,filterHeight:A,filterWidth:D,inChannels:M,inHeight:N,inWidth:j,outChannels:R,outHeight:P,outWidth:F,strideHeight:L,strideWidth:$}=p,B=A-1-p.padInfo.top,z=D-1-p.padInfo.left,U=R/M;for(let r=0;r<O;++r)for(let e=0;e<M;++e)for(let t=0;t<N;++t){const n=t-B,i=Math.max(0,Math.ceil(n/L)),a=Math.min(P,(A+n)/L);for(let o=0;o<j;++o){const s=o-z,l=Math.max(0,Math.ceil(s/$)),u=Math.min(F,(D+s)/$);let c=0;for(let t=i;t<a;++t){const i=t*L-n;for(let n=l;n<u;++n){const a=_*r+S*t+E*n,o=k*(A-1-i)+C*(D-1-(n*$-s))+I*e;for(let t=0;t<U;++t)c+=w[a+(e*U+t)]*T[o+t]}}v[y*r+b*t+x*o+e]=c}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}},G$={kernelName:$m,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:i,filter:a}=e,{strides:o,pad:s,dilations:l}=n,u=t,c=u.data.get(i.dataId).values,d=i.shape.length,h=u.data.get(a.dataId).values,f=a.shape.length,{batchSize:p,inHeight:m,inWidth:v,inChannels:y,outHeight:b,outWidth:x,padInfo:w,strideHeight:_,strideWidth:S,filterHeight:E,filterWidth:T,dilationHeight:k,dilationWidth:C,outShape:I}=g.computeDilation2DInfo(i.shape,a.shape,o,s,"NHWC",l),O=r.sizeFromShape(I),A=I.length,D=r.getArrayFromDType(i.dtype,O);for(let g=0;g<p;++g)for(let e=0;e<b;++e){const t=e*_-w.top;for(let n=0;n<x;++n){const o=n*S-w.left;for(let s=0;s<y;++s){let l=Number.MIN_SAFE_INTEGER;for(let e=0;e<E;++e){const n=t+e*k;if(n>=0&&n<m)for(let t=0;t<T;++t){const u=o+t*C;if(u>=0&&u<v){const o=r.locToIndex([g,n,u,s],d,r.computeStrides(i.shape)),p=r.locToIndex([e,t,s],f,r.computeStrides(a.shape)),m=c[o]+h[p];m>l&&(l=m)}}}D[r.locToIndex([g,e,n,s],A,r.computeStrides(I))]=l}}}return{dataId:u.write(r.toTypedArray(D,i.dtype),I,i.dtype),shape:I,dtype:i.dtype}}},Y$={kernelName:zm,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:i,filter:a,dy:o}=e,{strides:s,pad:l,dilations:u}=n,c=t,d=r.toNestedArray(i.shape,c.data.get(i.dataId).values),h=r.toNestedArray(a.shape,c.data.get(a.dataId).values),{batchSize:f,inHeight:p,inWidth:m,inChannels:v,outHeight:y,outWidth:b,padInfo:x,strideHeight:w,strideWidth:_,filterHeight:S,filterWidth:E,dilationHeight:T,dilationWidth:k,outShape:C}=g.computeDilation2DInfo(i.shape,a.shape,s,l,"NHWC",u);r.assert(o.rank===C.length,()=>`Error in ${zm}, dy must have the same rank as output ${C.length}, but got `+o.rank);const I=r.toNestedArray(C,c.data.get(o.dataId).values),O=r.makeZerosNestedTypedArray(a.shape,a.dtype);for(let r=0;r<f;++r)for(let e=0;e<y;++e){const t=e*w-x.top;for(let n=0;n<b;++n){const i=n*_-x.left;for(let a=0;a<v;++a){let o=Number.MIN_SAFE_INTEGER,s=0,l=0;for(let e=0;e<S;++e){const n=t+e*T;if(n>=0&&n<p)for(let t=0;t<E;++t){const u=i+t*k;if(u>=0&&u<m){const i=d[r][n][u][a]+h[e][t][a];i>o&&(o=i,s=e,l=t)}}}O[s][l][a]+=I[r][e][n][a]}}}return{dataId:c.write(r.toTypedArray(O,i.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},X$={kernelName:Bm,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:i,filter:a,dy:o}=e,{strides:s,pad:l,dilations:u}=n,c=t,d=r.toNestedArray(i.shape,c.data.get(i.dataId).values),h=r.toNestedArray(a.shape,c.data.get(a.dataId).values),{batchSize:f,inHeight:p,inWidth:m,inChannels:v,outHeight:y,outWidth:b,padInfo:x,strideHeight:w,strideWidth:_,filterHeight:S,filterWidth:E,dilationHeight:T,dilationWidth:k,outShape:C}=g.computeDilation2DInfo(i.shape,a.shape,s,l,"NHWC",u);r.assert(o.rank===C.length,()=>`Error in ${Bm}, dy must have the same rank as output ${C.length}, but got `+o.rank);const I=r.toNestedArray(C,c.data.get(o.dataId).values),O=r.makeZerosNestedTypedArray(i.shape,i.dtype);for(let r=0;r<f;++r)for(let e=0;e<y;++e){const t=e*w-x.top;for(let n=0;n<b;++n){const i=n*_-x.left;for(let a=0;a<v;++a){let o=Number.MIN_SAFE_INTEGER,s=t<0?0:t,l=i<0?0:i;for(let e=0;e<S;++e){const n=t+e*T;if(n>=0&&n<p)for(let t=0;t<E;++t){const u=i+t*k;if(u>=0&&u<m){const i=d[r][n][u][a]+h[e][t][a];i>o&&(o=i,s=n,l=u)}}}O[r][s][l][a]+=I[r][e][n][a]}}}return{dataId:c.write(r.toTypedArray(O,i.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},K$=DL((e,t)=>e/t),Z$=qL(Um,K$),J$={kernelName:Um,backendName:"cpu",kernelFunc:Z$},Q$=g.ERF_P,eB=g.ERF_A1,tB=g.ERF_A2,nB=g.ERF_A3,rB=g.ERF_A4,iB=g.ERF_A5,aB=TL(Vm,e=>{const t=Math.sign(e),n=Math.abs(e),r=1/(1+Q$*n);return t*(1-((((iB*r+rB)*r+nB)*r+tB)*r+eB)*r*Math.exp(-n*n))}),oB={kernelName:Vm,backendName:"cpu",kernelFunc:aB},sB=_$(e=>Math.exp(e)),lB=kL(Gm,sB),uB={kernelName:Gm,backendName:"cpu",kernelFunc:lB},cB=_$(e=>Math.expm1(e)),dB=kL(Ym,cB),hB={kernelName:Ym,backendName:"cpu",kernelFunc:dB},fB=DL((e,t)=>e*t),pB=GL((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n})),mB=qL(jg,fB,pB),gB={kernelName:jg,backendName:"cpu",kernelFunc:mB};function vB(e,t,n,i,a){const o=d.isSliceContinous(i,t,n),s=r.sizeFromShape(n),l=r.computeStrides(i);if(o){const n=d.computeFlatOffset(t,l);return e.subarray(n,n+s)}const u=r.getTypedArrayFromDType(a,s);for(let c=0;c<s;++c){const a=n.length,o=r.computeStrides(n),s=r.indexToLoc(c,a,o).map((e,n)=>e+t[n]),d=r.locToIndex(s,i.length,l);u[c]=e[d]}return u}function yB(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:a,size:o}=r;yL(i,"slice");const[s,l]=d.parseSliceParams(i,a,o);d.assertParamsValid(i,s,l);const u=vB(n.data.get(i.dataId).values,s,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,u)}const bB={kernelName:uv,backendName:"cpu",kernelFunc:yB},xB=DL((e,t)=>e-t),wB=GL((e,t,n,r)=>({real:e-n,imag:t-r})),_B=qL(_v,xB,wB),SB={kernelName:_v,backendName:"cpu",kernelFunc:_B};function EB(e,t,n){const i=e.shape,a=i[0],o=i[1],s=n.data.get(e.dataId),l=s.complexTensorInfos.real,u=s.complexTensorInfos.imag,c=[a,o],d=r.sizeFromShape(c),h=r.getTypedArrayFromDType("float32",d),f=r.getTypedArrayFromDType("float32",d);for(let r=0;r<a;r++){const e=yB({inputs:{x:l},backend:n,attrs:{begin:[r,0],size:[1,o]}}),i=yB({inputs:{x:u},backend:n,attrs:{begin:[r,0],size:[1,o]}}),a=BL({inputs:{real:e,imag:i},backend:n}),{real:s,imag:c}=TB(a,t,n),d=g.mergeRealAndImagArrays(s,c);for(let t=0;t<o;t++){const e=g.getComplexWithIndex(d,t);h[r*o+t]=e.real,f[r*o+t]=e.imag}n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a)}const p=n.makeTensorInfo(c,"float32",h),m=n.makeTensorInfo(c,"float32",f),v=BL({inputs:{real:p,imag:m},backend:n});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),v}function TB(e,t,n){const i=r.sizeFromShape(e.shape),a=n.data.get(e.dataId),o=n.data.get(a.complexTensorInfos.real.dataId).values,s=n.data.get(a.complexTensorInfos.imag.dataId).values;if(0==((l=i)&l-1)){const a=function e(t,n,r,i,a){if(1===r)return{real:t,imag:n};const o=g.mergeRealAndImagArrays(t,n),s=r/2,l=g.complexWithEvenIndex(o),u=l.real,c=l.imag,d=[u.length],h=a.makeTensorInfo(d,"float32",u),f=a.makeTensorInfo(d,"float32",c),p=BL({inputs:{real:h,imag:f},backend:a}),m=g.complexWithOddIndex(o),v=m.real,y=m.imag,b=[v.length],x=a.makeTensorInfo(b,"float32",v),w=a.makeTensorInfo(b,"float32",y),_=BL({inputs:{real:x,imag:w},backend:a}),S=e(u,c,s,i,a),E=S.real,T=S.imag,k=[E.length],C=a.makeTensorInfo(k,"float32",E),I=a.makeTensorInfo(k,"float32",T),O=BL({inputs:{real:C,imag:I},backend:a}),A=e(v,y,s,i,a),D=A.real,M=A.imag,N=[D.length],j=a.makeTensorInfo(N,"float32",D),R=a.makeTensorInfo(N,"float32",M),P=BL({inputs:{real:j,imag:R},backend:a}),F=g.exponents(r,i),L=[F.real.length],$=a.makeTensorInfo(L,"float32",F.real),B=a.makeTensorInfo(L,"float32",F.imag),z=BL({inputs:{real:$,imag:B},backend:a}),U=mB({inputs:{a:z,b:P},backend:a}),H=KL({inputs:{a:O,b:U},backend:a}),W=_B({inputs:{a:O,b:U},backend:a}),V=UL({inputs:{input:H},backend:a}),q=UL({inputs:{input:W},backend:a}),G=I$({inputs:{input:H},backend:a}),Y=I$({inputs:{input:W},backend:a}),X=A$({inputs:[V,q],backend:a,attrs:{axis:0}}),K=A$({inputs:[G,Y],backend:a,attrs:{axis:0}}),Z=a.data.get(X.dataId).values,J=a.data.get(K.dataId).values;return a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(w),a.disposeIntermediateTensorInfo(_),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(I),a.disposeIntermediateTensorInfo(O),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(R),a.disposeIntermediateTensorInfo(P),a.disposeIntermediateTensorInfo($),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(Y),a.disposeIntermediateTensorInfo(X),a.disposeIntermediateTensorInfo(K),{real:Z,imag:J}}(o,s,i,t,n),l=[e.shape[0],e.shape[1]];if(t){const e=n.makeTensorInfo(l,"float32",a.real),t=n.makeTensorInfo(l,"float32",a.imag),o=n.makeTensorInfo([],"float32",r.createScalarValue(i,"float32")),s=OL({inputs:{x:o},backend:n}),u=J$.kernelFunc({inputs:{a:e,b:o},backend:n}),c=J$.kernelFunc({inputs:{a:t,b:s},backend:n}),d=n.data.get(u.dataId).values,h=n.data.get(c.dataId).values;return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),{real:d,imag:h}}return a}{const e=function(e,t,n){const r=new Float32Array(2*t);for(let i=0;i<t;i++){let a=0,o=0;for(let r=0;r<t;r++){const s=g.exponent(i*r,t,n),l=g.getComplexWithIndex(e,r);a+=l.real*s.real-l.imag*s.imag,o+=l.real*s.imag+l.imag*s.real}n&&(a/=t,o/=t),g.assignToTypedArray(r,a,o,i)}return r}(g.mergeRealAndImagArrays(o,s),i,t);return g.splitRealAndImagArrays(e)}var l}const kB={kernelName:Xm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:i}=t,a=r.sizeFromShape(i.shape),o=i.shape[i.shape.length-1],s=JL({inputs:{x:i},backend:n,attrs:{shape:[a/o,o]}}),l=EB(s,!1,n),u=JL({inputs:{x:l},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(l),u}},CB={kernelName:Km,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{shape:i,value:a,dtype:o}=n,s=o||r.inferDtype(a),l=r.getArrayFromDType(s,r.sizeFromShape(i));return function(e,t,n){e.fill(t)}(l,a),t.makeTensorInfo(i,s,l)}},IB={kernelName:Zm,backendName:"cpu",kernelFunc:({inputs:e,backend:t})=>{const{image:n}=e,i=t,a=r.getTypedArrayFromDType(n.dtype,r.sizeFromShape(n.shape)),[o,s,l,u]=n.shape,c=i.data.get(n.dataId).values;for(let r=0;r<o;r++){const e=r*l*s*u;for(let t=0;t<s;t++){const n=t*(l*u);for(let r=0;r<l;r++){const i=r*u;for(let s=0;s<u;s++){const d=Math.round(l-[o,t,r,s][2]),h=e+n+i+s;let f=c[h];d>=0&&d<l&&(f=c[e+n+d*u+s]),a[h]=f}}}}return{dataId:i.write(a,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},OB=_$(e=>Math.floor(e)),AB=kL(Jm,OB),DB={kernelName:Jm,backendName:"cpu",kernelFunc:AB},MB={kernelName:Lv,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a,bias:o,preluActivationWeights:s}=t,{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h,activation:f}=r;let p=M$({inputs:{x:i,filter:a},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h}});if(o){const e=p;p=KL({inputs:{a:p,b:o},backend:n}),n.disposeIntermediateTensorInfo(e)}if(f){const e=p;p=$L(n,p,f,s),n.disposeIntermediateTensorInfo(e)}return p}},NB={kernelName:$v,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a,bias:o,preluActivationWeights:s}=t,{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h,activation:f}=r;let p=H$({inputs:{x:i,filter:a},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h}});if(o){const e=p;p=KL({inputs:{a:p,b:o},backend:n}),n.disposeIntermediateTensorInfo(e)}if(f){const e=p;p=$L(n,p,f,s),n.disposeIntermediateTensorInfo(e)}return p}},jB={kernelName:og,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:i}=t,a=r.sizeFromShape(i.shape),o=i.shape[i.shape.length-1],s=JL({inputs:{x:i},backend:n,attrs:{shape:[a/o,o]}}),l=EB(s,!0,n),u=JL({inputs:{x:l},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(l),u}},RB=TL(lg,e=>Number.isFinite(e)?1:0,"bool"),PB={kernelName:lg,backendName:"cpu",kernelFunc:RB},FB=TL(ug,e=>Math.abs(e)===1/0?1:0,"bool"),LB={kernelName:ug,backendName:"cpu",kernelFunc:FB},$B=TL(cg,e=>Number.isNaN(e)?1:0,"bool"),BB={kernelName:cg,backendName:"cpu",kernelFunc:$B},zB=_$(e=>Math.log(e)),UB=kL(pg,zB),HB={kernelName:pg,backendName:"cpu",kernelFunc:UB},WB=TL(mg,e=>Math.log1p(e)),VB={kernelName:mg,backendName:"cpu",kernelFunc:WB},qB=TL(vg,e=>e?0:1,"bool"),GB={kernelName:vg,backendName:"cpu",kernelFunc:qB};function YB(e,t,n,i){const a=r.getTypedArrayFromDType(i,r.sizeFromShape(n));for(let r=0;r<a.length;++r){const n=r*t;let i=e[n];for(let r=0;r<t;++r){const t=e[n+r];t>i&&(i=t)}a[r]=i}return a}function XB(e,t,n,i,a){const o=t.length,s=r.sizeFromShape(t),l=r.computeStrides(t),u=r.computeStrides(a),c=r.getTypedArrayFromDType(n,r.sizeFromShape(a));for(let d=0;d<s;++d){const t=r.indexToLoc(d,o,l),n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t[i[e]];c[r.locToIndex(n,o,u)]=e[d]}return c}const KB={kernelName:_g,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:i}=e,{reductionIndices:a,keepDims:o}=t,s=n;let l=i.shape;const u=l.length,c=r.parseAxisParam(a,l);let d=c;const h=g.getAxesPermutation(d,u);let f=s.data.get(i.dataId).values;if(null!=h){const e=new Array(u);for(let t=0;t<e.length;t++)e[t]=l[h[t]];f=XB(f,l,i.dtype,h,e),d=g.getInnerMostAxes(d.length,u),l=e}yL(i,"max"),g.assertAxesAreInnerMostDims("max",d,u);const[p,m]=g.computeOutAndReduceShapes(l,d),v=YB(f,r.sizeFromShape(m),p,i.dtype),y=s.write(v,p,i.dtype);let b=p;return o&&(b=g.expandShapeToKeepDim(p,c)),{dataId:y,shape:b,dtype:i.dtype}}},ZB={kernelName:Eg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:a}=t;yL(a,"maxPool");const{filterSize:o,strides:s,pad:l,dimRoundingMode:u}=i;r.assert(g.eitherStridesOrDilationsAreOne(s,1),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '1'`);const c=g.computePool2DInfo(a.shape,o,s,1,l,u);let d;if(1===c.filterWidth&&1===c.filterHeight&&r.arraysEqual(c.inShape,c.outShape))d=OL({inputs:{x:a},backend:n});else{const e=n.data.get(a.dataId).values,t=r.computeStrides(a.shape),i=v$(e,0,a.dtype,t,c,"max");d=n.makeTensorInfo(c.outShape,a.dtype,i.values)}return d}},JB={kernelName:Tg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a,output:o}=t,s=a;yL([a,o],"maxPoolBackprop");const{filterSize:l,strides:u,pad:c,dimRoundingMode:d}=r,h=g.computePool2DInfo(s.shape,l,u,1,c,d),f=n.data.get(s.dataId).values,p=Rb(h.outShape,s.dtype,y$(f,s.shape,s.dtype,h).values),m=h.strideHeight,v=h.strideWidth,y=h.dilationHeight,b=h.dilationWidth,x=h.effectiveFilterHeight,w=h.effectiveFilterWidth,_=w-1-h.padInfo.left,S=x-1-h.padInfo.top,E=Rb(s.shape,"float32"),T=n.data.get(i.dataId).values,k=Rb(i.shape,"float32",T);for(let g=0;g<h.batchSize;++g)for(let e=0;e<h.inChannels;++e)for(let t=0;t<h.inHeight;++t)for(let n=0;n<h.inWidth;++n){const r=t-S,i=n-_;let a=0;for(let t=0;t<x;t+=y){const n=(r+t)/m;if(!(n<0||n>=h.outHeight||Math.floor(n)!==n))for(let r=0;r<w;r+=b){const o=(i+r)/v;if(o<0||o>=h.outWidth||Math.floor(o)!==o)continue;const s=x*w-1-p.get(g,n,o,e)===t*w+r?1:0;0!==s&&(a+=k.get(g,n,o,e)*s)}}E.set(a,g,t,n,e)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}},QB={kernelName:Ig,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:i}=e,{filterSize:a,strides:o,pad:s,includeBatchInIndex:l}=t,u=n;yL(i,"MaxPoolWithArgmax");const c=u.data.get(i.dataId).values,d=g.computePool2DInfo(i.shape,a,o,[1,1],s),[h,f]=function(e,t,n,i,a){const o=v$(e,0,n,r.computeStrides(t),a,"max"),s=y$(e,t,n,a,!0,i);return[o.values,s.values]}(c,i.shape,i.dtype,l,d),p=u.write(h,d.outShape,i.dtype),m=u.write(f,d.outShape,i.dtype);return[{dataId:p,shape:d.outShape,dtype:i.dtype},{dataId:m,shape:d.outShape,dtype:"int32"}]}},ez={kernelName:Mg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:a}=t,{paddings:o,mode:s}=i;yL(a,"mirrorPad");const l=o.map((e,t)=>e[0]+a.shape[t]+e[1]),u=o.map(e=>e[0]),c=o.map((e,t)=>e[0]+a.shape[t]),d="reflect"===s?0:1,h=n.data.get(a.dataId).values,f=a.shape.length,p=r.computeStrides(a.shape),m=r.sizeFromShape(l),g=l.length,v=r.computeStrides(l),y=r.getTypedArrayFromDType(a.dtype,m);for(let b=0;b<m;b++){let e=r.indexToLoc(b,g,v);for(let n=0;n<g;n++)e[n]<u[n]?e[n]=2*u[n]-e[n]-d:e[n]>=c[n]&&(e[n]=2*(c[n]-1)-e[n]+d);e=e.map((e,t)=>e-u[t]);const t=r.locToIndex(e,f,p);y[b]=h[t]}return{dataId:n.write(y,l,a.dtype),shape:l,dtype:a.dtype}}},tz=v.nonMaxSuppressionV4Impl,nz={kernelName:Lg,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{boxes:r,scores:i}=e,{maxOutputSize:a,iouThreshold:o,scoreThreshold:s,padToMaxOutputSize:l}=n,u=t;yL(r,"NonMaxSuppressionPadded");const c=u.data.get(r.dataId).values,d=u.data.get(i.dataId).values,{selectedIndices:h,validOutputs:f}=tz(c,d,a,o,s,l);return[h,f]}},rz=v.nonMaxSuppressionV5Impl,iz={kernelName:$g,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{boxes:r,scores:i}=e,{maxOutputSize:a,iouThreshold:o,scoreThreshold:s,softNmsSigma:l}=n,u=t;yL(r,"NonMaxSuppressionWithScore");const c=u.data.get(r.dataId).values,d=u.data.get(i.dataId).values,h=a,f=o,p=s,m=l,{selectedIndices:g,selectedScores:v}=rz(c,d,h,f,p,m);return[g,v]}},az=DL((e,t)=>e!==t?1:0),oz=qL(Pg,az,null,"bool"),sz={kernelName:Pg,backendName:"cpu",kernelFunc:oz},lz={kernelName:Ug,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:a}=t,{paddings:o,constantValue:s}=i;yL(a,"pad");const l=o.map((e,t)=>e[0]+a.shape[t]+e[1]),u=o.map(e=>e[0]),c=n.data.get(a.dataId).values,d=r.sizeFromShape(a.shape),h=a.shape.length,f=r.computeStrides(a.shape),p=r.sizeFromShape(l),m=l.length,g=r.computeStrides(l),v=r.getTypedArrayFromDType(a.dtype,p);0!==s&&v.fill(s);for(let y=0;y<d;y++){const e=r.indexToLoc(y,h,f).map((e,t)=>e+u[t]);v[r.locToIndex(e,m,g)]=c[y]}return{dataId:n.write(v,l,a.dtype),shape:l,dtype:a.dtype}}},uz=TL(Xg,e=>1/e),cz={kernelName:Xg,backendName:"cpu",kernelFunc:uz},dz={kernelName:Pv,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:i}=e,{radians:a,fillValue:o,center:s}=t,l=n,u=r.getTypedArrayFromDType(i.dtype,r.sizeFromShape(i.shape)),[c,d,h,f]=i.shape,[p,m]=g.getImageCenter(s,d,h),v=Math.sin(a),y=Math.cos(a),b=l.data.get(i.dataId).values;for(let r=0;r<c;r++){const e=r*h*d*f;for(let t=0;t<d;t++){const n=t*(h*f);for(let r=0;r<h;r++){const i=r*f;for(let a=0;a<f;a++){const s=[c,t,r,a],l=s[2],g=s[1];let x=(l-p)*y-(g-m)*v,w=(l-p)*v+(g-m)*y;x=Math.round(x+p),w=Math.round(w+m);let _=o;"number"!=typeof o&&(_=3===a?255:o[a]),x>=0&&x<h&&w>=0&&w<d&&(_=b[e+w*(h*f)+x*f+a]),u[e+n+i+a]=_}}}}return{dataId:l.write(u,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},hz=TL(iv,e=>{const t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2==0?t:t+1}),fz={kernelName:iv,backendName:"cpu",kernelFunc:hz},pz=_$(e=>1/Math.sqrt(e)),mz=kL(av,pz),gz={kernelName:av,backendName:"cpu",kernelFunc:mz},vz=g.SELU_SCALEALPHA,yz=g.SELU_SCALE,bz=TL(lv,e=>e>=0?yz*e:vz*(Math.exp(e)-1)),xz={kernelName:lv,backendName:"cpu",kernelFunc:bz},wz=TL(fv,e=>1/(1+Math.exp(-e))),_z={kernelName:fv,backendName:"cpu",kernelFunc:wz},Sz=TL(hv,e=>e<0?-1:e>0?1:0),Ez={kernelName:hv,backendName:"cpu",kernelFunc:Sz},Tz=TL(cv,e=>Math.sin(e)),kz={kernelName:cv,backendName:"cpu",kernelFunc:Tz},Cz=TL(dv,e=>Math.sinh(e)),Iz={kernelName:dv,backendName:"cpu",kernelFunc:Cz},Oz=Math.log(1.1920928955078125e-7)+2,Az=TL(pv,e=>{const t=e>-Oz,n=e<Oz,r=Math.exp(e);let i;return i=n?r:t?e:Math.log(1+r),i}),Dz={kernelName:pv,backendName:"cpu",kernelFunc:Az};function Mz(e){const{inputs:t,attrs:n,backend:r}=e,{x:i}=t,{perm:a}=n;yL(i,"transpose");const o=new Array(i.shape.length);for(let l=0;l<o.length;l++)o[l]=i.shape[a[l]];const s=XB(r.data.get(i.dataId).values,i.shape,i.dtype,a,o);return{dataId:r.write(s,o,i.dtype),shape:o,dtype:i.dtype}}const Nz={kernelName:Ov,backendName:"cpu",kernelFunc:Mz},jz={kernelName:vv,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:a}=t,{blockShape:o,paddings:s}=i;yL([a],"spaceToBatchND");const l=r.sizeFromShape(o),u=[[0,0]];u.push(...s);for(let r=1+o.length;r<a.shape.length;++r)u.push([0,0]);const c=lz.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),d=g.getReshaped(c.shape,o,l,!1),h=g.getPermuted(d.length,o.length,!1),f=g.getReshapedPermuted(c.shape,o,l,!1),p=JL({inputs:{x:c},backend:n,attrs:{shape:d}}),m=Mz({inputs:{x:p},backend:n,attrs:{perm:h}}),v=JL({inputs:{x:m},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),v}},Rz=TL(mv,e=>Math.sqrt(e)),Pz={kernelName:mv,backendName:"cpu",kernelFunc:Rz},Fz={kernelName:wv,backendName:"cpu",kernelFunc:({inputs:e,backend:t})=>{const{x:n}=e,r=t;yL(n,"square");const i=r.data.get(n.dataId).values,a=new Float32Array(i.length);for(let o=0;o<i.length;++o){const e=i[o];a[o]=e*e}return{dataId:r.write(a,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},Lz=DL((e,t)=>{const n=e-t;return n*n}),$z=qL(xv,Lz),Bz={kernelName:xv,backendName:"cpu",kernelFunc:$z},zz=TL(jv,(e,t)=>{const n=t;return isNaN(e)?NaN:e>0?1:n.alpha}),Uz={kernelName:jv,backendName:"cpu",kernelFunc:zz},Hz=TL(Tv,e=>Math.tan(e)),Wz={kernelName:Tv,backendName:"cpu",kernelFunc:Hz},Vz=TL(kv,e=>Math.tanh(e));function qz(e,t,n,i){const a=r.parseAxisParam(t,n)[0],o=[1,n[0],1];for(let r=0;r<a;r++)o[0]*=n[r];o[1]=n[a];for(let r=a+1;r<n.length;r++)o[2]*=n[r];const s={},l=new Int32Array(n[a]),u=new uy(o,i,e),c=[],d=1===o[0]&&1===o[2];for(let r=0;r<n[a];r++){let t;if(d)t=e[r].toString();else{const e=[];for(let t=0;t<o[0];t++)for(let n=0;n<o[2];n++)e.push(u.get(t,r,n));t=e.join(",")}if(void 0!==s[t])l[r]=s[t];else{const e=Object.keys(s).length;s[t]=e,l[r]=e,c.push(r)}}const h=o.slice();h[1]=Object.keys(s).length;const f=new uy(h,i);c.forEach((e,t)=>{for(let n=0;n<o[0];n++)for(let r=0;r<o[2];r++)f.set(u.get(n,e,r),n,t,r)});const p=n.slice();return p[a]=h[1],{outputValues:f.values,outputShape:p,indices:l}}const Gz=[n$,i$,o$,l$,ZL,c$,h$,p$,g$,b$,x$,t$,w$,VL,T$,C$,zL,D$,j$,R$,N$,F$,L$,P$,B$,U$,W$,V$,q$,G$,X$,Y$,J$,IL,oB,uB,hB,kB,CB,IB,DB,MB,NB,AL,jB,O$,PB,LB,BB,HB,VB,GB,ZB,JB,QB,KB,ez,gB,nz,iz,sz,lz,jL,HL,cz,PL,LL,QL,dz,fz,gz,xz,_z,Ez,kz,Iz,bB,Dz,jz,Pz,Fz,Bz,Uz,SB,Wz,{kernelName:kv,backendName:"cpu",kernelFunc:Vz},Nz,{kernelName:Av,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{axis:i}=n,{x:a}=t;yL(a,"unique");const o=r.data.get(a.dataId).values,{outputValues:s,outputShape:l,indices:u}=qz(o,i,a.shape,a.dtype);return[r.makeTensorInfo(l,a.dtype,s),r.makeTensorInfo([u.length],"int32",u)]}}];for(const iBe of Gz)Vv(iBe);const Yz={},Xz={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Kz(e){if(!(e in Yz)){const t=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",t=>{t.preventDefault(),delete Yz[e]},!1),1===e?t.getContext("webgl",Xz)||t.getContext("experimental-webgl",Xz):t.getContext("webgl2",Xz)}(e);if(null===t)return console.log("Could not get context for WebGL version",e),null;Yz[e]=t}const t=Yz[e];return t.isContextLost()?(delete Yz[e],Kz(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Yz[e])}var Zz,Jz,Qz;function eU(e,t){return[t,e]}function tU(e){const t=r.sizeFromShape(e),n=Math.ceil(t/4);return r.sizeToSquarishShape(n)}function nU(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function rU(e,t){const n=e;let r,i,a,o,s,l,u,c,d,h;return 2===Gp().getNumber("WEBGL_VERSION")?(r=n.R32F,i=n.R16F,a=n.RGBA16F,o=n.RGBA32F,s=n.RED,u=4,c=1,d=n.HALF_FLOAT,h=n.FLOAT):(r=e.RGBA,i=e.RGBA,a=e.RGBA,o=n.RGBA,s=e.RGBA,u=4,c=4,d=null!=t?t.HALF_FLOAT_OES:null,h=e.FLOAT),l=e.RGBA,{internalFormatFloat:r,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:d,textureTypeFloat:h}}function iU(e,t){const n=t();return Gp().getBool("DEBUG")&&function(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}(e,t))}(e),n}function aU(e){return!!(Gp().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function oU(e,t){return fU(e,()=>e.getExtension(t),'Extension "'+t+'" not supported on this browser.')}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(Zz||(Zz={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Jz||(Jz={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Qz||(Qz={}));const sU=/ERROR: [0-9]+:([0-9]+):/g;function lU(e,t){if(iU(e,()=>e.validateProgram(t)),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function uU(e,t,n,r,i,a,o){const s=e.getAttribLocation(t,n);return-1!==s&&(iU(e,()=>e.bindBuffer(e.ARRAY_BUFFER,r)),iU(e,()=>e.vertexAttribPointer(s,i,e.FLOAT,!1,a,o)),iU(e,()=>e.enableVertexAttribArray(s)),!0)}function cU(e,t,n){iU(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,n)),iU(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))}function dU(e,t){iU(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,t)),iU(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0))}function hU(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}(e,t))}function fU(e,t,n){const r=iU(e,()=>t());if(null==r)throw new Error(n);return r}function pU(e,t=2){return r.sizeFromShape(e.slice(0,e.length-t))}function mU(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function gU(e){let t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[pU(e),...mU(e)]),t}function vU(e){return e%2==0}function yU(e,t){if(e=e.slice(-2),t=t.slice(-2),r.arraysEqual(e,t))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){const n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(vU(n)&&vU(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&vU(e[0])&&vU(t[0])}let bU,xU;function wU(e,t){return null!=e.getExtension(t)}function _U(e){try{if(null!=Kz(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function SU(e){const t=rU(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),i}function EU(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{null!=e&&r.assert("complex64"!==e.dtype,()=>t+" does not support complex64 tensors in the WebGL backend.")})}const TU=Gp();TU.registerFlag("HAS_WEBGL",()=>TU.getNumber("WEBGL_VERSION")>0),TU.registerFlag("WEBGL_VERSION",()=>_U(2)?2:_U(1)?1:0),TU.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1),TU.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>2===TU.get("WEBGL_VERSION")),TU.registerFlag("WEBGL_CPU_FORWARD",()=>!0),TU.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1),TU.registerFlag("WEBGL_PACK",()=>TU.getBool("HAS_WEBGL")),TU.registerFlag("WEBGL_PACK_NORMALIZATION",()=>TU.getBool("WEBGL_PACK")),TU.registerFlag("WEBGL_PACK_CLIP",()=>TU.getBool("WEBGL_PACK")),TU.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>!1),TU.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>TU.getBool("WEBGL_PACK")),TU.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>TU.getBool("WEBGL_PACK")),TU.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>TU.getBool("WEBGL_PACK")),TU.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>TU.getBool("WEBGL_PACK")),TU.registerFlag("WEBGL_PACK_REDUCE",()=>TU.getBool("WEBGL_PACK")),TU.registerFlag("WEBGL_LAZILY_UNPACK",()=>TU.getBool("WEBGL_PACK")),TU.registerFlag("WEBGL_CONV_IM2COL",()=>TU.getBool("WEBGL_PACK")),TU.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>function(e){if(null==bU){const t=Kz(e);bU=t.getParameter(t.MAX_TEXTURE_SIZE)}return bU}(TU.getNumber("WEBGL_VERSION"))),TU.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>function(e){if(null==xU){const t=Kz(e);xU=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,xU)}(TU.getNumber("WEBGL_VERSION"))),TU.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const e=TU.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;let t;const n=Kz(e);return t=wU(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:wU(n,"EXT_disjoint_timer_query")?1:0,t}(e)}),TU.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>TU.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!a.isMobile()),TU.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>function(e){if(0===e)return!1;const t=Kz(e);if(1===e){if(!wU(t,"OES_texture_float"))return!1}else if(!wU(t,"EXT_color_buffer_float"))return!1;return SU(t)}(TU.getNumber("WEBGL_VERSION"))),TU.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>!TU.getBool("WEBGL_FORCE_F16_TEXTURES")&&TU.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")),TU.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>function(e){if(0===e)return!1;const t=Kz(e);if(1!==e){if(wU(t,"EXT_color_buffer_float"))return SU(t);const e="EXT_color_buffer_half_float";if(wU(t,e)){const n=t.getExtension(e);return function(e,t){const n=rU(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(i),a}(t,n)}return!1}return!!wU(t,"OES_texture_float")&&!!wU(t,"WEBGL_color_buffer_float")&&SU(t)}(TU.getNumber("WEBGL_VERSION"))),TU.registerFlag("WEBGL_FENCE_API_ENABLED",()=>{return 2===(e=TU.getNumber("WEBGL_VERSION"))&&null!=Kz(e).fenceSync;var e}),TU.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>TU.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0),TU.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,e=>{if(e<0&&-1!==e)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)});const{simpleAbsImpl:kU,addImpl:CU,ceilImpl:IU,expImpl:OU,expm1Impl:AU,floorImpl:DU,logImpl:MU,maxImpl:NU,multiplyImpl:jU,rsqrtImpl:RU,sliceImpl:PU,subImpl:FU,transposeImpl:LU,uniqueImpl:$U}=U;class BU{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((e,t)=>"T"+t);const n=[];this.variableNames.forEach(e=>{n.push(`float v${e} = get${e}AtOutCoords();`)});const r=this.variableNames.map(e=>"v"+e).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${r};\n        setOutput(result);\n      }\n    `}}class zU{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((e,t)=>"T"+t);const n=[];this.variableNames.forEach(e=>{n.push(`vec4 v${e} = get${e}AtOutCoords();`)});const r=this.variableNames.map(e=>"v"+e).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${r};\n        setOutput(result);\n      }\n    `}}class UU{constructor(e,t,n){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:a}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${r};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${r}; i++) {\n          int inIdx = ${n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));"};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${"max"===t?">":"<"} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}function HU(e,t){return["x","y","z","w","u","v"].slice(0,t).map(t=>`${e}.${t}`)}function WU(e,t){return 1===t?[e]:HU(e,t)}function VU(){let e,t,n,r,i,a,o,s,l,u;return 2===Gp().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",i="texture",a="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",l="",u="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",i="texture2D",a="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",l="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",u="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:i,output:a,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:l,defineRound:u}}function qU(e,t,n="index"){const i=r.computeStrides(t);return i.map((t,r)=>`int ${e[r]} = ${n} / ${t}; ${r===i.length-1?`int ${e[r+1]} = ${n} - ${e[r]} * ${t}`:`index -= ${e[r]} * ${t}`};`).join("")}function GU(e){const t=r.computeStrides(e).map(e=>e.toString());return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;\n  }\n`}const YU="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:XU}=g;const KU="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ZU="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",JU="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",QU="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function eH(e){return"offset"+e}function tH(e){const t=e.name,n=r.sizeFromShape(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${t}[i];\n      }\n    }\n  `}function nH(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function rH(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function iH(e,t){return t.map(t=>e[t]).join(", ")}class aH{constructor(e,t,n,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,r.assert(e.length>2,()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`);const a=Math.ceil(e[e.length-1]/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),i||this.variableNames.push("bestIndicesA");const o=this.outputShape,s=o.length,l=nH(s),u=WU("coords",s);let c,d;if(1===a){d=s+1;const e=nH(d);c=`\n        ${e} sourceLocR = ${e}(${u.join()}, 0);\n        ++${u[s-1]};\n        ${e} sourceLocG = ${e}(${u.join()}, 0);\n        ++${u[s-2]};\n        ${e} sourceLocA = ${e}(${u.join()}, 0);\n        --${u[s-1]};\n        ${e} sourceLocB = ${e}(${u.join()}, 0);\n        --${u[s-2]};`}else d=s,c=`\n        ${l} sourceLocR = coords;\n        ++${u[s-1]};\n        ${l} sourceLocG = coords;\n        ++${u[s-2]};\n        ${l} sourceLocA = coords;\n        --${u[s-1]};\n        ${l} sourceLocB = coords;\n        --${u[s-2]};`;const h=["x","y","z","w","u","v"].slice(0,d),f="."+h[d-1],p=h.map(e=>"int "+e),m=WU("sourceLocR",d-1).concat("inIdx.r"),g=WU("sourceLocG",d-1).concat("inIdx.g"),v=WU("sourceLocB",d-1).concat("inIdx.b"),y=WU("sourceLocA",d-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",x=i?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${m.join()}),\n                             getBestIndicesAChannel(${g.join()}),\n                             getBestIndicesAChannel(${v.join()}),\n                             getBestIndicesAChannel(${y.join()})));`,w=`vec4(\n            getAChannel(${m.join()}),\n            hasNextCol ? getAChannel(${g.join()}) : 0.,\n            hasNextRow ? getAChannel(${v.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${y.join()}) : 0.)`,_=i?"":`\n      float getBestIndicesAChannel(${p.join()}) {\n        return getChannel(getBestIndicesA(${h.join()}),\n                                          vec2(${h.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${p.join()}) {\n        return getChannel(getA(${h.join()}),\n                               vec2(${h.slice(-2).join()}));\n      }\n      ${_}\n      void main() {\n        ${l} coords = getOutputCoords();\n        bool hasNextCol = ${u[s-1]} < ${o[s-1]-1};\n        bool hasNextRow = ${u[s-2]} < ${o[s-2]-1};\n        ${c}\n        ivec4 srcIdx = ivec4(sourceLocR${f}, sourceLocG${f},\n          sourceLocB${f}, sourceLocA${f}) * ${t};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${w};\n\n        for (int i = 0; i < ${t}; i++) {\n          inIdx = srcIdx;\n          ${x}\n          vec4 candidate = ${w};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${b}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}class oH{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.effectiveFilterHeight,n=e.effectiveFilterWidth;this.userCode=`\n      const ivec2 pads = ivec2(${t-1-e.padInfo.top}, ${n-1-e.padInfo.left});\n      const float avgMultiplier = float(${1/(e.filterHeight*e.filterWidth)});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${t};\n            wR += ${e.dilationHeight}) {\n          float dyR = float(dyRCorner + wR) / ${e.strideHeight}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${n};\n            wC+= ${e.dilationWidth}) {\n            float dyC = float(dyCCorner + wC) / ${e.strideWidth}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class sH{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.effectiveFilterDepth,n=e.effectiveFilterHeight,r=e.effectiveFilterWidth;this.userCode=`\n      const ivec3 pads = ivec3(${t-1-e.padInfo.front}, ${n-1-e.padInfo.top}, ${r-1-e.padInfo.left});\n      const float avgMultiplier = float(${1/(e.filterDepth*e.filterHeight*e.filterWidth)});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${t};\n            wD += ${e.dilationDepth}) {\n          float dyD = float(dyDCorner + wD) / ${e.strideDepth}.0;\n\n          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${n};\n              wR += ${e.dilationHeight}) {\n            float dyR = float(dyRCorner + wR) / ${e.strideHeight}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${r};\n                wC += ${e.dilationWidth}) {\n              float dyC = float(dyCCorner + wC) / ${e.strideWidth}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const lH="return (a < 0.) ? b * a : a;";class uH{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=g.assertAndGetBroadcastShape(t,n),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${e}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}const cH="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";class dH{constructor(e,t,n,i=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=g.assertAndGetBroadcastShape(t,n);const a=this.outputShape.length;let o="";if(i)if(0===a||1===r.sizeFromShape(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o=`\n          ${nH(a)} coords = getOutputCoords();\n        `,1===a)o+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const e=WU("coords",a);o+=`\n            bool nextRowOutOfBounds =\n              (${e[a-2]} + 1) >= ${this.outputShape[a-2]};\n            bool nextColOutOfBounds =\n              (${e[a-1]} + 1) >= ${this.outputShape[a-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${e}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${o}\n\n        setOutput(result);\n      }\n    `}}class hH{constructor(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}getCustomSetupFunc(e,t){return(n,r)=>{null==this.minLoc&&(this.minLoc=n.getUniformLocationNoThrow(r,"minVal"),this.maxLoc=n.getUniformLocationNoThrow(r,"maxVal")),n.gl.uniform1f(this.minLoc,e),n.gl.uniform1f(this.maxLoc,t)}}}class fH{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}getCustomSetupFunc(e,t){return(n,r)=>{null==this.minLoc&&(this.minLoc=n.getUniformLocationNoThrow(r,"minVal"),this.maxLoc=n.getUniformLocationNoThrow(r,"maxVal")),n.gl.uniform1f(this.minLoc,e),n.gl.uniform1f(this.maxLoc,t)}}}class pH{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}class mH{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yR = 0; yR < ${e.outHeight}; yR++) {\n            int xR = wR + yR * ${e.strideHeight} - ${e.padInfo.top};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${e.outWidth}; yC++) {\n              int xC = wC + yC * ${e.strideWidth} - ${e.padInfo.left};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              if (${"channelsLast"===e.dataFormat}) {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class gH{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r="channelsLast"===e.dataFormat;this.userCode=`\n      const ivec2 pads = ivec2(${t-1-e.padInfo.top}, ${n-1-e.padInfo.left});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${r?3:1}];\n\n        ivec2 dyCorner = ivec2(coords[${r?1:2}], coords[${r?2:3}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${e.strideHeight}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${e.strideWidth}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n\n              if (${r}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class vH{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape,this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yF = 0; yF < ${e.outDepth}; yF++) {\n            int xF = wF + yF * ${e.strideDepth} - ${e.padInfo.front};\n\n            if (xF < 0 || xF >= ${e.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${e.outHeight}; yR++) {\n              int xR = wR + yR * ${e.strideHeight} - ${e.padInfo.top};\n\n              if (xR < 0 || xR >= ${e.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${e.outWidth}; yC++) {\n                int xC = wC + yC * ${e.strideWidth} - ${e.padInfo.left};\n\n                if (xC < 0 || xC >= ${e.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class yH{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth;this.userCode=`\n      const ivec3 pads = ivec3(${t-1-e.padInfo.front}, ${n-1-e.padInfo.top}, ${r-1-e.padInfo.left});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${t}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${e.strideDepth}.0;\n\n          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${t} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${e.strideHeight}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${r}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${e.strideWidth}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${r} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class bH{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${e.outChannels/e.inChannels} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yR = 0; yR < ${e.outHeight}; yR++) {\n            int xR = wR + yR * ${e.strideHeight} - ${e.padInfo.top};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${e.outWidth}; yC++) {\n              int xC = wC + yC * ${e.strideWidth} - ${e.padInfo.left};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class xH{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.outChannels/e.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${t-1-e.padInfo.top}, ${n-1-e.padInfo.left});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${e.strideHeight}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${e.strideWidth}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${r}; dm++) {\n              int d2 = d1 * ${r} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class wH{constructor(e,t=!1,n=null,r=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,a=e.padInfo.left,o=e.strideHeight,s=e.strideWidth,l=e.dilationHeight,u=e.dilationWidth,c=e.filterHeight,d=e.filterWidth,h=4*Math.floor(e.inChannels/4),f=e.inChannels%4,p="channelsLast"===e.dataFormat,m=p?1:2,g=p?2:3,v=p?3:1;let y="",b="";n&&(y=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,b="result = activation(result);");const x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`\n      ${y}\n\n      const ivec2 strides = ivec2(${o}, ${s});\n      const ivec2 pads = ivec2(${i}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${v}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${m}], coords[${g}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${c}; wR++) {\n          int xR = xRCorner + wR * ${l};\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${d}; wC++) {\n            int xC = xCCorner + wC * ${u};\n\n            if (xC < 0 || xC >= ${e.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${h}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${p}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===f}) {\n\n              if (${p}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${h}) *\n                    getW(wR, wC, ${h}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${h}, xR, xC) *\n                    getW(wR, wC, ${h}, d2);\n              }\n\n            } else if (${2===f}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${h}, d2),\n                getW(wR, wC, ${h} + 1, d2)\n              );\n\n              if (${p}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${h}),\n                  getX(batch, xR, xC, ${h} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${h}, xR, xC),\n                  getX(batch, ${h} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===f}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${h}, d2),\n                getW(wR, wC, ${h} + 1, d2),\n                getW(wR, wC, ${h} + 2, d2)\n              );\n\n              if (${p}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${h}),\n                  getX(batch, xR, xC, ${h} + 1),\n                  getX(batch, xR, xC, ${h} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${h}, xR, xC),\n                  getX(batch, ${h} + 1, xR, xC),\n                  getX(batch, ${h} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${x}\n        ${b}\n        setOutput(result);\n      }\n    `}}class _H{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,c=e.filterDepth,d=e.filterHeight,h=e.filterWidth,f=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${i}, ${a}, ${o});\n      const ivec3 pads = ivec3(${t}, ${n}, ${r});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${c}; wF++) {\n          int xF = xFCorner + wF * ${s};\n\n          if (xF < 0 || xF >= ${e.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${d}; wR++) {\n            int xR = xRCorner + wR * ${l};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h}; wC++) {\n              int xC = xCCorner + wC * ${u};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${f}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===p}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${f}) *\n                  getW(wF, wR, wC, ${f}, d2);\n              } else if (${2===p}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${f}),\n                  getX(batch, xF, xR, xC, ${f} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${f}, d2),\n                  getW(wF, wR, wC, ${f} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===p}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${f}),\n                  getX(batch, xF, xR, xC, ${f} + 1),\n                  getX(batch, xF, xR, xC, ${f} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${f}, d2),\n                  getW(wF, wR, wC, ${f} + 1, d2),\n                  getW(wF, wR, wC, ${f} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class SH{constructor(e,t=!1,n=null,r=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.inHeight,a=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,d=e.dilationWidth,h=e.filterHeight,f=e.filterWidth,p=e.outChannels/e.inChannels;let m="",g="";n&&(m=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,g="result = activation(result);");const v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`\n      ${m}\n\n      const ivec2 strides = ivec2(${l}, ${u});\n      const ivec2 pads = ivec2(${o}, ${s});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${p};\n        int q = d2 - d1 * ${p};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${h}; wR++) {\n          int xR = xRCorner + wR * ${c};\n\n          if (xR < 0 || xR >= ${i}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${f}; wC++) {\n            int xC = xCCorner + wC * ${d};\n\n            if (xC < 0 || xC >= ${a}) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${v}\n        ${g}\n        setOutput(result);\n      }\n    `}}class EH{constructor(e,t=!1,n=null,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;const a=e.inHeight,o=e.inWidth,s=e.padInfo.top,l=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,d=e.dilationHeight,h=e.dilationWidth,f=e.filterHeight,p=e.filterWidth,m=p;let g="int xR; int xC; int xCOffset;";for(let r=0;r<f;r++)for(let e=0;e<p;e++)g+=`\n          vec4 xTexelR${r}C${2*e} = vec4(0.);\n          vec4 wR${r}C${e} = vec4(0.);\n          vec4 xR${r}C${e} = vec4(0.);`;for(let x=0;x<f;x++)for(let e=0;e<m;e++){const t=2*e;if(g+=`\n          xR = xRCorner + ${x*d};\n          xC = xCCorner + ${t*h};\n        `,1===c){if(t<p&&(g+=l%2==1?`\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < ${a} && xCOffset >= 0 && xCOffset < ${o}) {\n                  xTexelR${x}C${t} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ${o}) {\n                    xTexelR${x}C${t}.zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR${x}C${t} = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < ${a} && xCOffset >= 0 && xCOffset < ${o}) {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ${o}) {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR${x}C${t} = vec4(previous.zw, xTexelR${x}C${t}.xy);\n                } else {\n                  xR${x}C${t} = vec4(0, 0, xTexelR${x}C${t}.xy);\n                }\n              `:`\n                if(xR >= 0 && xR < ${a} && xC >= 0 && xC < ${o}) {\n                  xTexelR${x}C${t} = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR${x}C${t} = vec4(0.);\n                }\n\n                xR${x}C${t} = xTexelR${x}C${t};\n              `,t+1<p)){const e=l%2==0?r.nearestLargerEven(h):h;h%2==0&&l%2==1||h%2!=0&&l%2!=1?(g+=`\n                  xCOffset = xC + ${l%2} + ${e};\n\n                  if(xR >= 0 && xR < ${a} &&\n                    xCOffset >= 0 && xCOffset < ${o}) {\n                    xTexelR${x}C${t+2} = getX(batch, xR, xCOffset, d1);\n                  }\n                `,h>1&&(g+=`\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < ${a} &&\n                      xCOffset >= 0 && xCOffset < ${o}) {\n                      xTexelR${x}C${t} = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR${x}C${t} = vec4(0.);\n                    }\n                  `),g+=`\n                  xR${x}C${t+1} = vec4(\n                    xTexelR${x}C${t}.zw, xTexelR${x}C${t+2}.xy);\n                `):g+=`\n                  xCOffset = xC + ${e};\n\n                  if(xR >= 0 && xR < ${a} &&\n                    xCOffset >= 0 && xCOffset < ${o}) {\n                    xTexelR${x}C${t+2} = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR${x}C${t+1} = xTexelR${x}C${t+2};\n                `}}else t<p&&(g+=`\n              if(xR >= 0 && xR < ${a}) {\n            `,l%2==1?(g+=`\n                xCOffset = xC + 1 - ${c};\n                if(xCOffset >= 0 && xCOffset < ${o}) {\n                  xTexelR${x}C${t} = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR${x}C${t} = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < ${o}) {\n                  xTexelR${x}C${t+2} = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR${x}C${t+2} = vec4(0.);\n                }\n\n                xR${x}C${t} = vec4(\n                  xTexelR${x}C${t}.zw, xTexelR${x}C${t+2}.zw);\n              `,t+1<p&&(g+=`\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + ${c};\n                  if(xCOffset >= 0 && xCOffset < ${o}) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR${x}C${t+1} = vec4(xTexelR${x}C${t+2}.xy, final.xy);\n                `)):(g+=`\n                if(xC >= 0 && xC < ${o}) {\n                  xTexelR${x}C${t} = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR${x}C${t} = vec4(0.);\n                }\n\n                xCOffset = xC + ${c};\n                if(xCOffset >= 0 && xCOffset < ${o}) {\n                  xTexelR${x}C${t+2} = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR${x}C${t+2} = vec4(0.);\n                }\n\n                xR${x}C${t} = vec4(\n                  xTexelR${x}C${t}.xy, xTexelR${x}C${t+2}.xy);\n              `,t+1<p&&(g+=`\n                  xR${x}C${t+1} = vec4(\n                    xTexelR${x}C${t}.zw, xTexelR${x}C${t+2}.zw);\n                `)),g+="}");t<p&&(g+=`\n            vec4 wTexelR${x}C${t} = getW(${x}, ${t}, d1, q);\n            wR${x}C${t} = vec4(wTexelR${x}C${t}.xz, wTexelR${x}C${t}.xz);\n          `,t+1<p&&(g+=`\n              vec4 wTexelR${x}C${t+1} = getW(${x}, ${t+1}, d1, q);\n              wR${x}C${t+1} =\n                vec4(wTexelR${x}C${t+1}.xz, wTexelR${x}C${t+1}.xz);`))}for(let r=0;r<f;r++)for(let e=0;e<p;e++)g+=`dotProd += xR${r}C${e} * wR${r}C${e};`;let v="",y="";n&&(v=i?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,y="result = activation(result);");const b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode=`\n      ${v}\n\n      const ivec2 strides = ivec2(${u}, ${c});\n      const ivec2 pads = ivec2(${s}, ${l});\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        ${g}\n\n        vec4 result = dotProd;\n        ${b}\n        ${y}\n        setOutput(result);\n      }\n    `}}class TH{constructor(e,t,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[a,o,s,l]=e,[u]=t,[c,d]=n;this.outputShape=[u,c,d,l];const h="bilinear"===r?1:0,[f,p]=[o-1+".0",s-1+".0"],[m,g,v]=c>1?[""+(o-1)/(c-1),"(y2-y1) * height_ratio",`y1*${f} + float(y)*(height_scale)`]:["0.0","0.0","0.5 * (y1+y2) * "+f],[y,b,x]=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio",`x1*${p} + float(x)*(width_scale)`]:["0.0","0.0","0.5 * (x1+x2) * "+p];this.userCode=`\n      const float height_ratio = float(${m});\n      const float width_ratio = float(${y});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${a}) {\n          return;\n        }\n\n        float height_scale = ${g};\n        float width_scale = ${b};\n\n        float in_y = ${v};\n        if( in_y < 0.0 || in_y > ${f} ) {\n          setOutput(float(${i}));\n          return;\n        }\n        float in_x = ${x};\n        if( in_x < 0.0 || in_x > ${p} ) {\n          setOutput(float(${i}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${h} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}class kH{constructor(e,t,n){this.variableNames=["x"],this.outputShape=e;const r=e.length,i=t?"0.0":`getX(${CH(r,"coords")})`,a=e[e.length-1];let o="",s="";t?(o=n?"end != "+(a-1):"end != 0",s=n?"end + 1":"end - 1"):(o=n?"end + pow2 < "+a:"end >= pow2",s=n?"end + pow2":"end - pow2"),this.userCode=`\n      uniform float index;\n      void main() {\n        ${nH(r)} coords = getOutputCoords();\n        int end = ${IH(r,"coords")};\n        float val = ${i};\n        int pow2 = int(pow(2.0, index));\n        if (${o}) {\n          int idx = ${s};\n          ${IH(r,"coords")} = idx;\n          val += getX(${CH(r,"coords")});\n        }\n        setOutput(val);\n      }\n    `}getCustomSetupFunc(e){return(t,n)=>{null==this.index&&(this.index=t.getUniformLocation(n,"index")),t.gl.uniform1f(this.index,e)}}}function CH(e,t){if(1===e)return""+t;if(2===e)return`${t}.x, ${t}.y`;if(3===e)return`${t}.x, ${t}.y, ${t}.z`;if(4===e)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw Error(`Cumulative sum for rank ${e} is not yet supported`)}function IH(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error(`Cumulative sum for rank ${e} is not yet supported`)}class OH{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Zz.DENSE;const t=tU(e),n=VU();this.outputShape=e,this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${qU(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(${t[0]}, ${t[1]}));\n        int index = 4 * (resTexRC.x * ${t[1]} + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${n.output} = result;\n      }\n    `}}class AH{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Zz.DENSE;const t=tU(e),n=VU();this.outputShape=e,this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${qU(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(${t[0]}, ${t[1]}));\n        int index = 4 * (resTexRC.x * ${t[1]} + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${n.output} = result;\n      }\n    `}}class DH{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${t};\n      int offset_h = imod(h, ${t});\n      int in_w = w / ${t};\n      int offset_w = imod(w, ${t});\n      int offset_d = (offset_h * ${t} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}class MH{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}class NH{constructor(e){this.variableNames=["A"],this.outTexUsage=Jz.DOWNLOAD;const t=VU();this.outputShape=e,this.userCode=`\n      ${YU}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${t.output} = encode_float(x);\n      }\n    `}}class jH{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Jz.DOWNLOAD;const t=VU();this.outputShape=e,this.userCode=`\n      ${YU}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${t.output} = encode_float(x);\n      }\n    `}}class RH{constructor(e,t,n=!1){this.variableNames=["A"];const r=VU(),[i,a]=t;this.outputShape=e;let o="result";n&&(o="floor(result * 255. + 0.5)"),this.userCode=`\n      ${GU(e)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / ${a};\n        int c = imod(flatIndex, ${a});\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(${a}.0, ${i}.0);\n        vec4 values = ${r.texture2D}(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ${r.output} = vec4(${o}, 0., 0., 0.);\n      }\n    `}}class PH{constructor(e,t,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const r=VU(),[i,a]=t;this.outputShape=e;let o="",s="result";n&&(s="floor(result * 255. + 0.5)");for(let l=0;l<=1;l++)for(let t=0;t<=1;t++){const n=2*l+t;o+=`\n          localCoords = coords;\n          if(localCoords[2] + ${t} < ${e[2]}) {\n            localCoords[2] += ${t};\n            if(localCoords[1] + ${l} < ${e[1]}) {\n              localCoords[1] += ${l};\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / ${a};\n              c = imod(flatIndex, ${a});\n              uv = (vec2(c, r) + halfCR) / vec2(${a}.0, ${i}.0);\n              values = ${r.texture2D}(A, uv);\n\n              if(offset == 0) {\n                result[${n}] = values[0];\n              } else if(offset == 1) {\n                result[${n}] = values[1];\n              } else if(offset == 2) {\n                result[${n}] = values[2];\n              } else {\n                result[${n}] = values[3];\n              }\n            }\n          }\n        `}this.userCode=`\n      ${GU(e)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        ${o}\n\n        ${r.output} = ${s};\n      }\n    `}}class FH{constructor(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}getCustomSetupFunc(e){return(t,n)=>{null==this.valueLoc&&(this.valueLoc=t.getUniformLocationNoThrow(n,"value")),t.gl.uniform1f(this.valueLoc,e)}}}class LH{constructor(e,t,n){this.variableNames=["A","indices"];const r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;const i=nH(this.rank),a=function(e,t){const n=e.length;if(n>4)throw Error(`Gather for rank ${n} is not yet supported`);if(1===n)return"int(getIndices(resRC))";const r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[];for(let a=0;a<e.length;a++)i.push(a===t?`int(getIndices(${r[a]}))`:""+r[a]);return i.join()}(e,n);this.userCode=`\n      void main() {\n        ${i} resRC = getOutputCoords();\n        setOutput(getA(${a}));\n      }\n    `}}class $H{constructor(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;const r=nH(t.length),i=nH(n.length);this.userCode=`\n        ${r} strides = ${r}(${this.strides});\n         void main() {\n          ${i} coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ${this.sliceDim}; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ${this.sliceDim>1?"strides[j]":"strides"};\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      `}}function BH(e,t,n,r,i,a){!function(e,t){const n=Gp().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0)throw new Error(`Requested texture size [${e}x${t}] is invalid.`);if(e>n||t>n)throw new Error(`Requested texture size [${e}x${t}] greater than WebGL maximum on this browser / GPU [${n}x${n}].`)}(t,n);const o=function(e){return fU(e,()=>e.createTexture(),"Unable to create WebGLTexture.")}(e),s=e.TEXTURE_2D;return iU(e,()=>e.bindTexture(s,o)),iU(e,()=>e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)),iU(e,()=>e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),iU(e,()=>e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)),iU(e,()=>e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)),iU(e,()=>e.texImage2D(s,0,r,t,n,0,i,a,null)),iU(e,()=>e.bindTexture(e.TEXTURE_2D,null)),o}function zH(e){return e.internalFormatFloat}function UH(e){return e.internalFormatHalfFloat}function HH(e){return e.downloadTextureFormat}function WH(e){return e.internalFormatPackedFloat}function VH(e){return e.internalFormatPackedHalfFloat}class qH{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const t=Gp().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,function(e,t){Yz[e]=t}(t,e)):this.gl=Kz(t);let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(1===Gp().getNumber("WEBGL_VERSION")){const e="OES_texture_half_float";if(this.textureFloatExtension=oU(this.gl,"OES_texture_float"),wU(this.gl,e))this.textureHalfFloatExtension=oU(this.gl,e);else if(Gp().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),wU(this.gl,r))this.colorBufferHalfFloatExtension=oU(this.gl,r);else if(Gp().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",wU(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!wU(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=function(e){return function(e,t){const n=fU(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return iU(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),iU(e,()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}(this.gl),this.indexBuffer=function(e){return function(e,t){const n=fU(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return iU(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)),iU(e,()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)),n}(e,new Uint16Array([0,1,2,2,1,3]))}(this.gl),this.framebuffer=function(e){return fU(e,()=>e.createFramebuffer(),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=rU(this.gl,this.textureHalfFloatExtension)}get debug(){return Gp().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;iU(e,()=>e.finish()),iU(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),iU(e,()=>e.deleteFramebuffer(this.framebuffer)),iU(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),iU(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),iU(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=eU(t,n);return BH(e,i,a,zH(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=eU(t,n);return BH(e,i,a,UH(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=eU(t,n);return BH(e,i,a,HH(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),function(e,t,n){iU(e,()=>e.bindTexture(e.TEXTURE_2D,t)),n.data instanceof Uint8Array?iU(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)):iU(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),iU(e,()=>e.bindTexture(e.TEXTURE_2D,null))}(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,i,a){let o,s,l;iU(e,()=>e.bindTexture(e.TEXTURE_2D,t)),i instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,l=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,l=a.internalFormatPackedFloat),o.set(i),iU(e,()=>e.texImage2D(e.TEXTURE_2D,0,l,n,r,0,e.RGBA,s,o)),iU(e,()=>e.bindTexture(e.TEXTURE_2D,null))}(this.gl,e,t,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=nU(t,n);return BH(e,i,a,VH(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=nU(t,n);return BH(e,i,a,WH(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(dU(this.gl,this.framebuffer),this.outputTexture=null),iU(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,()=>function(e,t,n,r){const[i,a]=eU(t,n),o=new Uint8Array(t*n*4);return iU(e,()=>e.readPixels(0,0,i,a,r.downloadTextureFormat,e.UNSIGNED_BYTE,o)),new Float32Array(o.buffer)}(this.gl,t,n,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,n,r,i,a){return function(e,t,n,r,i,a,o,s){const l=e,u=new Float32Array(function(e,t){const[n,r]=nU(e,t);return n*r*4}(a,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,t),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}(this.gl,e,0,0,0,i,a)}downloadFloat32MatrixFromBuffer(e,t){return function(e,t,n){const r=e,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);const r=function(e,t,n,r){const i=e.createBuffer();iU(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,i));const a=16*t*n;return iU(e,()=>e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ)),iU(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)),iU(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null)),i}(this.gl,t,n);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(Gp().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{const e=r.clientWaitSync(i,0,0);return e===r.ALREADY_SIGNALED||e===r.CONDITION_SATISFIED},t=i}else Gp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,Gp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,()=>function(e,t,n){const r=new Float32Array(t*n*4);return iU(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)),r}(this.gl,t,n))}createProgram(e){this.throwIfDisposed();const t=this.gl,n=function(e,t){const n=fU(e,()=>e.createShader(e.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(iU(e,()=>e.shaderSource(n,t)),iU(e,()=>e.compileShader(n)),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw function(e,t){const n=sU.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);const i=+n[1],a=e.split("\n"),o=a.length.toString().length+2,s=a.map((e,t)=>r.rightPad((t+1).toString(),o)+e);let l=0;for(let r=0;r<s.length;r++)l=Math.max(s[r].length,l);const u=s.slice(0,i-1),c=s.slice(i-1,i),d=s.slice(i);console.log(u.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+r.rightPad(c[0],l),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join("\n"))}(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(t,e),i=function(e){const t=VU();return function(e,t){const n=fU(e,()=>e.createShader(e.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(iU(e,()=>e.shaderSource(n,t)),iU(e,()=>e.compileShader(n)),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,`${t.version}\n    precision highp float;\n    ${t.attribute} vec3 clipSpacePos;\n    ${t.attribute} vec2 uv;\n    ${t.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`)}(t),a=function(e){return fU(e,()=>e.createProgram(),"Unable to create WebGLProgram.")}(t);return iU(t,()=>t.attachShader(a,i)),iU(t,()=>t.attachShader(a,n)),function(e,t){if(iU(e,()=>e.linkProgram(t)),!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,a),this.debug&&lU(t,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=function(e,t,n){return iU(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),uU(e,t,"clipSpacePos",n,3,20,0)&&uU(e,t,"uv",n,2,20,12)}(t,this.program,this.vertexBuffer)),a}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&iU(this.gl,()=>this.gl.deleteProgram(e))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&lU(this.gl,this.program),iU(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,n=!0){return this.throwIfDisposed(),n?function(e,t,n){return fU(e,()=>e.getUniformLocation(t,n),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),iU(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(e,t,n,r){iU(e,()=>function(e,t,n){(function(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error(`textureUnit must be in [gl.TEXTURE0, gl.TEXTURE${n}].`)})(e,n),iU(e,()=>e.activeTexture(e.TEXTURE0+n)),iU(e,()=>e.bindTexture(e.TEXTURE_2D,t))}(e,t,r)),iU(e,()=>e.uniform1i(n,r))}(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();const[r,i]=nU(t,n);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&lU(this.gl,this.program),hU(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;this.debug&&this.debugValidate(),iU(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),iU(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=oU(this.gl,2===Gp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===Gp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===Gp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await r.repeatedTry(()=>this.disposed||this.isQueryAvailable(e,Gp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,Gp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){const t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{const t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){const t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=function(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map(e=>e.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||r.repeatedTry(()=>(this.pollItems(),0===this.itemsToPoll.length))}bindTextureToFrameBuffer(e){this.throwIfDisposed(),cU(this.gl,e,this.framebuffer),this.debug&&hU(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(cU(this.gl,this.outputTexture,this.framebuffer),this.debug&&hU(this.gl)):dU(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();const r=this.gl;cU(r,e,this.framebuffer),this.debug&&hU(r),this.outputTexture=e,iU(r,()=>r.viewport(0,0,t,n)),iU(r,()=>r.scissor(0,0,t,n))}setOutputMatrixWriteRegionDriver(e,t,n,r){this.throwIfDisposed(),iU(this.gl,()=>this.gl.scissor(e,t,n,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}function GH(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach((e,n)=>{const i=e.logicalShape,a=t[n],o=a.shape;if(!r.arraysEqual(i,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${o} must match`);if(e.isUniform&&a.isUniform)return;const s=e.texShape,l=a.isUniform?null:a.texData.texShape;if(!r.arraysEqual(s,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${s} and ${l} must match`)})}class YH{constructor(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;const{filterWidth:r,inChannels:i,strideWidth:a,strideHeight:o,padInfo:s,outWidth:l,dilationWidth:u,dilationHeight:c,dataFormat:d}=n,{left:h,top:f}=s,p=i*r,m=VU(),g="channelsLast"===d,v=g?0:1,y=g?1:2;let b="";for(let x=0;x<=1;x++)for(let n=0;n<=1;n++)b+=`\n          blockIndex = rc.y + ${n};\n          pos = rc.x + ${x};\n\n          if(blockIndex < ${e[1]} && pos < ${e[0]}) {\n            offsetY = int(blockIndex / (${l})) * ${o} - ${f};\n            d0 = offsetY + ${c} * (pos / ${p});\n\n            if(d0 < ${t[v]} && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), ${l}.) * ${a}. - ${h}.);\n              d1 = offsetX + ${u} * (int(mod(float(pos), ${p}.) / ${i}.));\n\n              if(d1 < ${t[y]} && d1 >= 0) {\n\n                ch = int(mod(float(pos), ${i}.));\n\n                if (${g}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*x+n}] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*x+n}] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${b}\n\n        ${m.output} = result;\n      }\n    `}}class XH{constructor(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[];const a=t,o=e[3]-1;let s;this.outputShape=e;const l=`float(${n}) + float(${r}) * sum`;s=.5===i?`inversesqrt(${l})`:1===i?`1.0/(${l})`:`exp(log(${l}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -${a}; j <= ${a}; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ${o}) {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ${s};\n        setOutput(val);\n      }\n    `}}class KH{constructor(e,t,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=i,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ${this.depth}; ++d) {\n          int depthBegin = int(max(0.0, float(d - ${t})));\n          int depthEnd = int(min(float(${this.depth}),\n              float(d + ${t} + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ${this.depth};\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(${r}) * norm + float(${n});\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(${r})\n                * float(${i})\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ${i});\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    `}}class ZH{constructor(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const a=t,o=e[3]-1;let s;this.outputShape=e;const l=`float(${n}) + float(${r}) * sum`;s=.5===i?`inversesqrt(${l})`:1===i?`1.0/(${l})`:`exp(log(${l}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ${this.outputShape[3]};\n        bool hasNextRow = c < ${this.outputShape[2]};\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ${a};\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ${a}; j <= ${a}; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${o}));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ${s};\n        setOutput(result);\n      }\n    `}}class JH{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.effectiveFilterHeight,n=e.effectiveFilterWidth;this.userCode=`\n      const ivec2 pads = ivec2(${t-1-e.padInfo.top}, ${n-1-e.padInfo.left});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${t};\n          wR += ${e.dilationHeight}) {\n          float dyR = float(dyRCorner + wR) / ${e.strideHeight}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${e.strideWidth}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${t*n-1} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${n} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class QH{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.effectiveFilterDepth,n=e.effectiveFilterHeight,r=e.effectiveFilterWidth;this.userCode=`\n      const ivec3 pads = ivec3(${t-1-e.padInfo.front}, ${n-1-e.padInfo.top}, ${r-1-e.padInfo.left});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${t};\n           wD += ${e.dilationDepth}) {\n          float dyD = float(dyDCorner + wD) / ${e.strideDepth}.0;\n\n          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${n};\n              wR += ${e.dilationHeight}) {\n            float dyR = float(dyRCorner + wR) / ${e.strideHeight}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${r};\n                wC += ${e.dilationWidth}) {\n              float dyC = float(dyCCorner + wC) / ${e.strideWidth}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${t*n*r-1} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${n} * ${r} +\n                  wR * ${r} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class eW{constructor(e,t,n,r=!1,i=!1,a=!1,o=null,s=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;const l=Math.ceil((r?e[1]:e[2])/2),u=r?"i * 2, rc.y":"rc.y, i * 2",c=i?"rc.z, i * 2":"i * 2, rc.z",d=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let f="",p="";o&&(f=s?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${o}\n        }`:`vec4 activation(vec4 x) {\n          ${o}\n        }`,p="result = activation(result);");const m=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights");let g="rc.x",v="rc.x";e[0]<t[0]?g=`int(min(float(rc.x), ${e[0]-1}.))`:t[0]<e[0]&&(v=`int(min(float(rc.x), ${t[0]-1}.))`),this.userCode=`\n      ${f}\n\n      const float sharedDimension = ${l}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ${l}; i++) {\n          int batchA = ${g};\n          int batchB = ${v};\n          vec4 a = getMatrixA(batchA, ${u});\n          vec4 b = getMatrixB(batchB, ${c});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${d[0]} * ${h[0]});\n          result += (${d[1]} * ${h[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${m}\n\n        ${p}\n\n        setOutput(result);\n      }\n    `}}class tW{constructor(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode=`\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ${t-1}; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(${t-1}));\n      }\n    `}getCustomSetupFunc(e){return(t,n)=>{null==this.seedLoc&&(this.seedLoc=t.getUniformLocation(n,"seed")),t.gl.uniform1f(this.seedLoc,e)}}}class nW{constructor(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(${r}), float(${n}),\n                      float(index == coords.y)));\n      }\n    `}}class rW{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;const t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const n=WU("rc",t),r=nH(t),i=function(e,t,n){if(1===e)return"rc > "+t[0];let r="";for(let i=e-2;i<e;i++)r+=`${n[i]} >= ${t[i]}`,i<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";const i=r.slice(-2);return`\n    int r = ${i[0]};\n    int c = ${i[1]};\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= ${t};\n    bool rEdge = rp1 >= ${n};\n  `}(t,e[e.length-1],e[e.length-2],n),o=function(e,t){const n=e.length,r=function(e,t){const n=[];for(let r=0;r<=1;r++)for(let i=0;i<=1;i++){let a=`${0===r?"r":"rp1"}, ${0===i?"c":"cp1"}`;for(let n=2;n<e;n++)a=t[t.length-1-n]+","+a;n.push(a)}return n}(n,t);return 1===n?`getA(rc),\n            rc + 1 >= ${e[0]} ? 0. : getA(rc + 1),\n            0, 0`:`getA(${r[0]}),\n          cEdge ? 0. : getA(${r[1]}),\n          rEdge ? 0. : getA(${r[2]}),\n          rEdge || cEdge ? 0. : getA(${r[3]})`}(e,n);this.userCode=`\n        void main() {\n          ${r} rc = getOutputCoords();\n\n          if(${i}) {\n            setOutput(vec4(0));\n          } else {\n            ${a}\n\n            setOutput(vec4(${o}));\n          }\n        }\n      `}}}class iW{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,i=nH(r),a=t.map(e=>e[0]).join(","),o=t.map((t,n)=>t[0]+e[n]).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?`\n      ${i} start = ${i}(${a});\n      ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float(${n}));\n        } else {\n          ${i} coords = outC - start;\n          setOutput(getX(${s}));\n        }\n      }\n    `:`\n        int start = ${a};\n        int end = ${o};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float(${n}));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}}class aW{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,i=nH(r),a=t.map(e=>e[0]).join(","),o=t.map((t,n)=>t[0]+e[n]).join(","),s=WU("rc",r),l=WU("source",r),u=`${s[r-1]} < ${this.outputShape[r-1]}`,c=1===r?"source":`vec2(${l.slice(-2).join()})`,d=[i+" rc = outputLoc;",`${s[r-1]} += 1;\n       if(${u}) {\n      `,1===r?"":`}\n       rc = outputLoc;\n       ${s[r-2]} += 1;\n       if(${s[r-2]} < ${this.outputShape[r-2]}) {`,1===r?"":`  ${s[r-1]} += 1;\n         if(${u}) {`],h=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let f="";for(let p=0,m=1===r?2:4;p<m;p++)f+=`\n        ${d[p]}\n        if (${h}) {\n          result[${p}] = float(${n});\n        } else {\n          ${i} source = rc - start;\n          result[${p}] = getChannel(getX(${l.join()}), ${c});\n        }\n      `;f+=1===r?"} ":"}}",this.userCode=`\n      const ${i} start = ${i}(${a});\n      const ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${f}\n        setOutput(result);\n      }\n    `}}class oW{constructor(e,t,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const a=e.filterWidth,o=e.strideHeight,s=e.strideWidth,l=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;const p="avg"===t;let m="0.0";if(p||(m="-1.0 / 1e-20"),n)return void(this.userCode=`\n        const ivec2 strides = ivec2(${o}, ${s});\n        const ivec2 pads = ivec2(${h}, ${f});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${c};\n              wR += ${l}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${d};\n                wC += ${u}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${r?i?`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`:`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`:`wR * ${d} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `);let g=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(g="avgValue / count");const v=4*Math.floor(a/4),y=a%4,b=`\n      if (${p}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${o}, ${s});\n      const ivec2 pads = ivec2(${h}, ${f});\n      const float initializationValue = ${m};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${e.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${m});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${c};\n            wR += ${l}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${v}; wC += 4) {\n            int xC = xCCorner + wC * ${u};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              getValue(batch, xR, xC + 2 * ${u}, d),\n              getValue(batch, xR, xC + 3 * ${u}, d)\n            );\n\n            ${b}\n          }\n\n          int xC = xCCorner + ${v};\n          if (${1===y}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${b}\n          } else if (${2===y}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${b}\n          } else if (${3===y}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              getValue(batch, xR, xC + 2 * ${u}, d),\n              initializationValue\n            );\n\n            ${b}\n          }\n        }\n        setOutput(${g});\n      }\n    `}}class sW{constructor(e,t,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const a=e.filterWidth,o=e.strideDepth,s=e.strideHeight,l=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterDepth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,v=e.padInfo.left;this.outputShape=e.outShape;const y="avg"===t;let b="0.0";if(y||(b="-1.0 / 1e-20"),n)return void(this.userCode=`\n        const ivec3 strides =\n            ivec3(${o}, ${s}, ${l});\n        const ivec3 pads = ivec3(${m}, ${g}, ${v});\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ${h};\n              wD += ${u}) {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ${e.inDepth}) {\n              continue;\n            }\n\n            for (int wR = 0; wR < ${f};\n                wR += ${c}) {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ${e.inHeight}) {\n                continue;\n              }\n\n              for (int wC = 0; wC < ${p};\n                  wC += ${d}) {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ${e.inWidth}) {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${f} * ${p} +\n                      wR * ${p} + wC`};\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `);let x=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(x="avgValue / count");const w=4*Math.floor(a/4),_=a%4,S=`\n      if (${y}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec3 strides =\n        ivec3(${o}, ${s}, ${l});\n      const ivec3 pads = ivec3(${m}, ${g}, ${v});\n      const float initializationValue = ${b};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ${e.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${b});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ${h};\n            wD += ${u}) {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ${e.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${f};\n            wR += ${c}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${w}; wC += 4) {\n              int xC = xCCorner + wC * ${d};\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${d}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${d}, ch),\n                getValue(batch, xD, xR, xC + 3 * ${d}, ch)\n              );\n\n              ${S}\n            }\n\n            int xC = xCCorner + ${w};\n            if (${1===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ${S}\n            } else if (${2===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${d}, ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ${S}\n            } else if (${3===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${d}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${d}, ch),\n                initializationValue\n              );\n\n              ${S}\n            }\n          }\n          setOutput(${x});\n        }\n      }\n    `}}class lW{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:i,outSize:a}=e;this.outputShape=[r,a];let o="0.0",s="";"prod"===t?o="1.0":"min"===t?(o="1.0 / 1e-20",s="min"):"max"===t&&(o="-1.0 / 1e-20",s="max");let l=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===t?l="sumValue":"prod"===t?l="prodValue":"all"===t?l="allValue":"any"===t&&(l="anyValue");const u=4*Math.floor(n/4),c=n%4;let d=`\n      if (${"sum"===t}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===t}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${s}(values, minMaxValue);\n      }\n    `,h="vec4";"all"===t?(o="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===t&&(o="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");let f="";i%n>0&&(f=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${o};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${f}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${o});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${u}; i += 4) {\n          int inIdx = inOffset + i;\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${d}\n        }\n\n        int inIdx = inOffset + ${u};\n        if (${1===c}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${d}\n        } else if (${2===c}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${d}\n        } else if (${3===c}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${d}\n        }\n        setOutput(${l});\n      }\n    `}}class uW{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;let n="";for(let i=0;i<4;i++){let e="thisRC = rc;";i%2==1&&(e+="thisRC.z += 1;"),i>1&&(e+="thisRC.y += 1;"),n+=`\n        ${e}\n        ${i>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${i}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${i>0?"}":""}\n      `}var r;this.userCode=`\n      ${r=t,`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${qU(["r","c","d"],r)}\n      return ivec3(r, c, d);\n    }\n  `}\n      ${GU(e)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${e[1]};\n        int cols = ${e[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}}class cW{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;const[,r,i]=t.shape,[,a,o]=e.shape,s=[n&&a>1?r-1:r,n&&o>1?i-1:i],l=[n&&a>1?a-1:a,n&&o>1?o-1:o],u=s[0]/l[0],c=s[1]/l[1],d=1/u,h=1/c,f=2*Math.ceil(d)+2,p=2*Math.ceil(h)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${u});\n        const float widthScale = float(${c});\n\n        const float invHeightScale = float(${d});\n        const float invWidthScale = float(${h});\n\n        const int winHeight = int(${f});\n        const int winWidth = int(${p});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${a}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${o}) {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}class dW{constructor(e,t,n,r){this.variableNames=["A"],this.outputShape=[];const[i,a,o,s]=e;this.outputShape=[i,t,n,s];const l=[r&&t>1?a-1:a,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${l[0]/u[0]},\n          ${l[1]/u[1]});\n      const vec2 inputShapeRC = vec2(${a}.0, ${o}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}class hW{constructor(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,o,s]=e;this.outputShape=[i,t,n,s];const l=[r&&t>1?a-1:a,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${l[0]/u[0]},\n          ${l[1]/u[1]},\n          ${l[1]/u[1]});\n      const vec3 inputShapeRC = vec3(${a}.0, ${o}.0,\n                                     ${o}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${s-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}class fW{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;const[,r,i]=t.shape,[,a,o]=e.shape,s=[n&&a>1?r-1:r,n&&o>1?i-1:i],l=[n&&a>1?a-1:a,n&&o>1?o-1:o],u=s[0]/l[0],c=s[1]/l[1],d=1/u,h=1/c,f=2*Math.ceil(d)+2,p=2*Math.ceil(h)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${u});\n        const float widthScale = float(${c});\n\n        const float invHeightScale = float(${d});\n        const float invWidthScale = float(${h});\n\n        const int winHeight = int(${f});\n        const int winWidth = int(${p});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${a}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${o}) {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(${s[0]}) *\n                (float(dyR) / float(${l[0]}));\n\n            float sourceFracCol =\n                float(${s[1]}) *\n                  (float(dyC) / float(${l[1]}));\n\n            int sourceNearestRow = int(min(\n                float(int(${r}) - 1),\n                ${n} ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(${i}) - 1),\n                ${n} ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}class pW{constructor(e,t,n,r){this.variableNames=["A"],this.outputShape=[];const[i,a,o,s]=e;this.outputShape=[i,t,n,s];const l=[r&&t>1?a-1:a,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${l[0]/u[0]},\n          ${l[1]/u[1]});\n      const vec2 inputShapeRC = vec2(${a}.0, ${o}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${r?"0.5":"0.0"})));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    `}}class mW{constructor(e,t){this.variableNames=["x"];const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=e,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${e[0]} - coord - 1));\n        }\n      `);const r=e.map((n,r)=>(n=>-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - coords[${n}] - 1`:`coords[${n}]`)(r)).join(","),i=nH(n);this.userCode=`\n      void main() {\n        ${i} coords = getOutputCoords();\n        setOutput(getX(${r}));\n      }\n    `}}class gW{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=e;const r=WU("rc",n),i=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,a=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,o=nH(n);function s(n){const r=e.map((r,i)=>function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - ${r[n]} - 1`:""+r[n]}(i,n));return`getChannel(getX(${r.join(",")}), vec2(${r.slice(-2).join(",")}))`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${e[0]} - rc - 1),\n            ${e[0]} - rc - 1);\n          if(${i}){\n              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),\n                ${e[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${o} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${function(e){return s(e)}(r.slice())};\n          if(${i}){\n            result.g = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())};\n          }\n          if(${a}) {\n            result.b = ${function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())};\n            if(${i}) {\n              result.a = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}class vW{constructor(e,t,n,r,i,a,o=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;const s=nH(i.length),l=nH(a.length);let u="";1===n?u="i":2===n&&(u="i, j");let c="";1===r?c="i":2===r&&(c="i, coords[1]"),this.userCode=`\n        ${s} strides = ${s}(${i});\n\n        void main() {\n          ${l} coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ${e}; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ${t}; j++) {\n              int index = round(getIndices(${u}));\n              flattenedIndex += index * ${t>1?"strides[j]":"strides"};\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates(${c});\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      `}}class yW{constructor(e,t){this.variableNames=["x","segmentIds"];const n=e.windowSize,r=e.batchSize,i=e.inSize,a=e.numSegments,o=a*Math.ceil(i/n);this.outputShape=[r,o];const s=4*Math.floor(n/4),l=n%4,u="\n        sumValue += dot(values, segFilter);\n    ";let c="";i%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `);let d="";i%n>0&&(d=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return -1.0;\n        }\n      `),this.userCode=`\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ${c}\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ${d}\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ${a})) * float(${n}));\n        int currentSeg = int(mod(float(outIdx), float(${a})));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${s}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ${u}\n        }\n\n        int inIdx = inOffset + ${s};\n        if (${1===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ${u}\n        } else if (${2===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ${u}\n        } else if (${3===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ${u}\n        }\n        setOutput(sumValue);\n      }\n    `}}class bW{constructor(e,t,n){let r,i;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error(`Where for rank ${n} is not yet supported`);if(1===n)i="resRC",r="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],o=[];for(let r=0;r<t.length;r++)o.push(""+n[r]),r<e&&a.push(""+n[r]);r=a.join(),i=o.join()}const a=nH(n);this.userCode=`\n      void main() {\n        ${a} resRC = getOutputCoords();\n        float cVal = getC(${r});\n        if (cVal >= 1.0) {\n          setOutput(getA(${i}));\n        } else {\n          setOutput(getB(${i}));\n        }\n      }\n    `}}class xW{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=nH(this.rank),n=`uniform int start[${this.rank}];`,r=function(e){if(1===e)return"sourceLoc";if(e<=6)return wW.slice(0,e).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}(this.rank);let i;i=`\n        ${t} sourceLoc;\n        ${t} coords = getOutputCoords();\n        ${e.map((e,t)=>`sourceLoc.${wW[t]} = start[${t}] + coords.${wW[t]};`).join("\n")}\n      `,this.userCode=`\n      ${n}\n      void main() {\n        ${i}\n        setOutput(getSource(${r}));\n      }\n    `}getCustomSetupFunc(e){if(e.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${e.length})`);return(t,n)=>{null==this.startLoc&&(this.startLoc=t.getUniformLocationNoThrow(n,"start"),null==this.startLoc)||t.gl.uniform1iv(this.startLoc,e)}}}const wW=["x","y","z","w","u","v"];class _W{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;const t=nH(this.rank),n=WU("coords",this.rank),r=WU("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":`vec2(${r.slice(-2).join()})`,a=`getChannel(getSource(${r.join()}), ${i})`,o=`\n      result.x = ${a};\n      if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n        ++${r[this.rank-1]};\n        result.y = ${a};\n        --${r[this.rank-1]};\n      }\n    `,s=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${e[this.rank-2]}) {\n        ++${r[this.rank-2]};\n        result.z = ${a};\n        if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n          ++${r[this.rank-1]};\n          result.w = ${a};\n        }\n      }\n    `,l=this.rank<=4?`sourceLoc = coords +\n            ${t}(${e.map((e,t)=>`start[${t}]`).join()});`:e.map((e,t)=>`${r[t]} = ${n[t]} + start[${t}];`).join("\n");this.userCode=`\n      uniform int start[${this.rank}];\n      void main() {\n        ${t} coords = getOutputCoords();\n        ${t} sourceLoc;\n        ${l}\n        vec4 result = vec4(0.);\n        ${o}\n        ${s}\n        setOutput(result);\n      }\n    `}getCustomSetupFunc(e){if(e.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${e.length})`);return(t,n)=>{null==this.startLoc&&(this.startLoc=t.getUniformLocationNoThrow(n,"start"),null==this.startLoc)||t.gl.uniform1iv(this.startLoc,e)}}}class SW{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,i=nH(n.length),a=nH(n.length);let o="";if(1===r)o="coords * strides + begin";else{let e=0;o=n.map((t,r)=>(e++,1===n.length?`coords * strides[${r}] + begin[${r}]`:`coords[${e-1}] * strides[${r}] + begin[${r}]`)).join(",")}this.userCode=`\n      ${i} begin = ${i}(${e});\n      ${i} strides = ${i}(${t});\n\n      void main() {\n        ${a} coords = getOutputCoords();\n        setOutput(getX(${o}));\n      }\n    `}}class EW{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(e,t,n){const r=kW(t,n),i=CW(e,r,n);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const a=TW(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=a,this.log();const e=this.freeTextures[i].shift();return this.usedTextures[i].push(e),e}let o;return r===Qz.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Qz.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Qz.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Qz.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Qz.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(o),this.numUsedTextures++,this._numBytesAllocated+=a,this.log(),o}releaseTexture(e,t,n,r){if(null==this.freeTextures)return;const i=kW(n,r),a=CW(t,i,r);a in this.freeTextures||(this.freeTextures[a]=[]);const o=TW(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=Gp().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e),this._numBytesAllocated-=o):(this.freeTextures[a].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;const l=this.usedTextures[a],u=l.indexOf(e);if(u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l.splice(u,1),this.log()}log(){if(!this.logEnabled)return;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${this.numFreeTextures+this.numUsedTextures})`);const e=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: "+this._numBytesAllocated),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const e in this.freeTextures)this.freeTextures[e].forEach(e=>{this.gpgpu.deleteMatrixTexture(e)});for(const e in this.usedTextures)this.usedTextures[e].forEach(e=>{this.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function TW(e,t,n,r,i){const a=function(e,t){switch(e){case Qz.PACKED_2X2_FLOAT32:return WH(t);case Qz.PACKED_2X2_FLOAT16:return VH(t);case Qz.UNPACKED_FLOAT32:return zH(t);case Qz.UNPACKED_FLOAT16:return UH(t);case Qz.PACKED_4X1_UNSIGNED_BYTE:return HH(t);default:throw new Error("Unknown physical texture type "+e)}}(t,r);let o;if(i){const[t,n]=nU(e[0],e[1]);o=t*n}else{const[t,n]=eU(e[0],e[1]);o=t*n}return o*function(e,t){if(t===e.R32F)return 4;if(t===e.R16F)return 2;if(t===e.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===e.RGBA16F)return 8;throw new Error("Unknown internal format "+t)}(n,a)}function kW(e,t){if(e===Jz.UPLOAD)return Qz.PACKED_2X2_FLOAT32;if(e===Jz.RENDER||null==e)return function(e){return Gp().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Qz.PACKED_2X2_FLOAT32:Qz.UNPACKED_FLOAT32:e?Qz.PACKED_2X2_FLOAT16:Qz.UNPACKED_FLOAT16}(t);if(e===Jz.DOWNLOAD||e===Jz.PIXELS)return Qz.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function CW(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}class IW{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let a=0;a<n.length;a++)n[a]=e[a]*t[a];this.outputShape=n,this.rank=n.length;const r=nH(this.rank),i=function(e){const t=e.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(1===t)return`imod(resRC, ${e[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let i=0;i<e.length;i++)r.push(`imod(${n[i]}, ${e[i]})`);return r.join()}(e);this.userCode=`\n      void main() {\n        ${r} resRC = getOutputCoords();\n        setOutput(getA(${i}));\n      }\n    `}}class OW{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode=`\n      float unaryOperation(float x) {\n        ${t}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}const AW="return abs(x);",DW="if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",MW="if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",NW="return (x >= 0.0) ? x : (exp(x) - 1.0);",jW=`\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ${g.SELU_SCALEALPHA};\n  float scale = ${g.SELU_SCALE};\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n`,RW="return -x;",PW="return ceil(x);",FW="return floor(x);",LW="return exp(x);",$W="return exp(x) - 1.0;",BW=`\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = ${g.ERF_P};\n  float a1 = ${g.ERF_A1};\n  float a2 = ${g.ERF_A2};\n  float a3 = ${g.ERF_A3};\n  float a4 = ${g.ERF_A4};\n  float a5 = ${g.ERF_A5};\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n`,zW="return x;",UW="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",HW="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",WW="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n";class VW{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${t}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}class qW{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;const t=e.length,n=WU("rc",t),r=nH(t),i=function(e,t){if(1===e)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),o=t<=1?"rc":`vec2(${a.join(",")})`;this.userCode=`\n      void main() {\n        ${r} rc = getOutputCoords();\n        vec4 packedInput = getA(${i});\n\n        setOutput(getChannel(packedInput, ${o}));\n      }\n    `}}const{segment_util:GW}=g,YW=v.split,XW=v.tile,KW=v.topkImpl,ZW=v.whereImpl,JW={};function QW(e,t=!1){if("linear"===e)return"return x;";if("relu"===e)return t?UW:DW;if("elu"===e)return t?WW:NW;if("relu6"===e)return t?HW:MW;if("prelu"===e)return t?cH:lH;throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}class eV extends Qf{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.warnedAboutMemory=!1,this.warnedAboutCPUBackend=!1,this.pendingDeletes=0,this.disposed=!1,!Gp().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){const e=Kz(Gp().getNumber("WEBGL_VERSION"));this.binaryCache=((t=Gp().getNumber("WEBGL_VERSION"))in JW||(JW[t]={}),JW[t]),this.gpgpu=new qH(e),this.canvas=e.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpu=e,this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;var t;this.textureManager=new EW(this.gpgpu),this.numMBBeforeWarning=null==Gp().global.screen?1024:Gp().global.screen.height*Gp().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new Jf(this,Xx())}numDataIds(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes}write(e,t,n){if((Gp().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Gp().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:Jz.UPLOAD,refCount:1,complexParentRefCount:0}),r}incRef(e){this.texData.get(e).refCount++}decRef(e){this.texData.has(e)&&this.texData.get(e).refCount--}move(e,t,n,r){if(Gp().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:Jz.UPLOAD,refCount:1,complexParentRefCount:0})}disposeIntermediateTensorInfo(e){const t=e.dataId;if(this.texData.has(t)){const e=this.texData.get(t);e.refCount--,e.refCount<1&&this.disposeData(t)}}readSync(e){const t=this.texData.get(e),{values:n,dtype:i,complexTensorInfos:a,slice:o,shape:s,isPacked:l}=t;if(null!=o){let t;t=l?new VW(s,zW):new OW(s,zW);const n=this.runWebGLProgram(t,[{dataId:e,shape:s,dtype:i}],i),r=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),r}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===i)return n;const u=null!=this.activeTimers;let c,d;if(u&&(c=r.now()),"complex64"===i){const e=this.readSync(a.real.dataId),t=this.readSync(a.imag.dataId);d=g.mergeRealAndImagArrays(e,t)}else d=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=r.now()-c),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const t=this.pendingRead.get(e);return new Promise(e=>t.push(e))}const t=this.texData.get(e),{values:n,shape:i,slice:a,dtype:o,complexTensorInfos:s,isPacked:l}=t;if(null!=a){let t;t=l?new VW(i,zW):new OW(i,zW);const n=this.runWebGLProgram(t,[{dataId:e,shape:i,dtype:o}],o),r=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),r}if(null!=n)return this.convertAndCacheOnCPU(e);if(!Gp().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===Gp().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u,c,d=null;if("complex64"!==o&&Gp().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(e);const t=this.texData.get(u.dataId);d=this.gpgpu.createBufferFromTexture(t.texture,...tU(i))}if(this.pendingRead.set(e,[]),"complex64"!==o&&await this.gpgpu.createAndWaitForFence(),"complex64"===o){const e=await Promise.all([this.read(s.real.dataId),this.read(s.imag.dataId)]);c=g.mergeRealAndImagArrays(e[0],e[1])}else if(null==d)c=this.getValuesFromTexture(e);else{const e=r.sizeFromShape(i);c=this.gpgpu.downloadFloat32MatrixFromBuffer(d,e)}null!=u&&this.disposeIntermediateTensorInfo(u);const h=this.convertAndCacheOnCPU(e,c),f=this.pendingRead.get(e);return this.pendingRead.delete(e),f.forEach(e=>e(h)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),h}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){const n=e[t];if(!aU(n)){if(Gp().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(e){const{shape:t,dtype:n,isPacked:i}=this.texData.get(e),a=r.sizeFromShape(t);if(Gp().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(e),r=this.texData.get(n.dataId),i=this.gpgpu.downloadMatrixFromPackedTexture(r.texture,...tU(t)).subarray(0,a);return this.disposeIntermediateTensorInfo(n),i}const o=Gp().getBool("WEBGL_PACK")&&!0===i,s=o?gU(t):t,l=o?new jH(s):new NH(s),u=this.runWebGLProgram(l,[{shape:s,dtype:n,dataId:e}],"float32"),c=this.texData.get(u.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture,c.texShape[0],c.texShape[1]).subarray(0,a);return this.disposeIntermediateTensorInfo(u),d}async time(e){const t=this.activeTimers,n=[];let i=!1;null==this.programTimersStack?(this.programTimersStack=n,i=!0):this.activeTimers.push(n),this.activeTimers=n,e();const a=r.flatten(this.activeTimers.map(e=>e.query)).filter(e=>null!=e),o=r.flatten(this.activeTimers.map(e=>e.name)).filter(e=>null!=e);this.activeTimers=t,i&&(this.programTimersStack=null);const s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};if(Gp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const e=await Promise.all(a);s.kernelMs=r.sum(e),s.getExtraProfileInfo=()=>e.map((e,t)=>({name:o[t],ms:e})).map(e=>`${e.name}: ${e.ms}`).join(", ")}else s.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,s}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Gp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:r.now(),endMs:null}}endTimer(e){return Gp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=r.now(),e)}async getQueryTime(e){return Gp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.waitForQueryAndGetTime(e):e.endMs-e.startMs}disposeData(e){if(this.pendingDisposal.has(e))return;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(!this.texData.has(e))return;if(this.texData.get(e).complexParentRefCount>0)return void this.texData.get(e).refCount--;this.releaseGPUData(e);const{complexTensorInfos:t}=this.texData.get(e);null!=t&&(this.texData.get(t.real.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(t.real),this.texData.get(t.imag.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(t.imag)),this.texData.delete(e)}releaseGPUData(e){const{texture:t,dtype:n,texShape:r,usage:i,isPacked:a,slice:o}=this.texData.get(e),s=o&&o.origDataId||e,l=this.dataRefCount.get(s);l>1?this.dataRefCount.set(s,l-1):(this.dataRefCount.delete(s),null!=t&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(t,r,i,a)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture}getDataInfo(e){return this.texData.get(e)}getCPUBackend(){return Gp().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Xx().findBackend("cpu")),this.cpuBackend):null}shouldExecuteOnCPU(e,t=128){const n=this.getCPUBackend();return this.warnedAboutCPUBackend||null!=n||(console.warn("Your application contains ops that are small enough to be executed on the CPU backend, however the CPU backend cannot be found. Consider importing the CPU backend (@tensorflow/tfjs-backend-cpu) for better performance."),this.warnedAboutCPUBackend=!0),null!=n&&e.every(e=>null==this.texData.get(e.dataId).texture&&r.sizeFromShape(e.shape)<t)}getGPGPUContext(){return this.gpgpu}slice(e,t,n){if(this.shouldExecuteOnCPU([e])){const r=PU(this.texData.get(e.dataId).values,t,n,e.shape,e.dtype);return this.makeOutput(n,e.dtype,r)}if(0===r.sizeFromShape(n))return Hy([],n,e.dtype);const{isPacked:i}=this.texData.get(e.dataId),a=d.isSliceContinous(e.shape,t,n);if(i||!a){const r=Gp().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _W(n):new xW(n),i=r.getCustomSetupFunc(t);return this.compileAndRun(r,[e],null,i)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)}shallowSlice(e,t,n){const r=this.texData.get(e.dataId),i=this.makeOutput(n,e.dtype),a=this.texData.get(i.dataId);Object.assign(a,r),a.shape=n,a.dtype=e.dtype;let o=d.computeFlatOffset(t,e.strides);r.slice&&(o+=r.slice.flatOffset),a.slice={flatOffset:o,origDataId:r.slice&&r.slice.origDataId||e.dataId};const s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),i}stridedSlice(e,t,n,r){const i=this.tryRunOnCpuOrThrow([e],()=>this.cpuBackend.stridedSlice(e,t,n,r));if(i)return i;const a=d.computeOutShape(t,n,r);if(a.some(e=>0===e))return Hy([],a);const o=new SW(t,r,a);return this.compileAndRun(o,[e])}reverse(e,t){const n=Gp().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new gW(e.shape,t):new mW(e.shape,t);return this.compileAndRun(n,[e])}neg(e){const t=this.tryRunOnCpuOrThrow([e],()=>this.cpuBackend.neg(e));if(t)return t;if(Gp().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,RW,e.dtype);const n=new OW(e.shape,RW);return this.compileAndRun(n,[e])}batchMatMul(e,t,n,r){const i=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],o=n?e.shape[1]:e.shape[2],s=Math.max(e.shape[0],t.shape[0]);if((1===i||1===a)&&o>1e3){n&&(e=ax(e,[0,2,1])),r&&(t=ax(t,[0,2,1]));const i=1===a?e:e.as3D(s,o,1),l=1===a?2:1,u=1===a?t.as3D(s,1,o):t;return pw(i,u).sum(l,!0)}const l=wy(e.dtype,t.dtype),u=new eW(e.shape,t.shape,[s,i,a],n,r);return this.compileAndRun(u,[e,t],l)}fusedBatchMatMul({a:e,b:t,transposeA:n,transposeB:r,bias:i,activation:a,preluActivationWeights:o}){const s=n?e.shape[2]:e.shape[1],l=r?t.shape[1]:t.shape[2],u=Math.max(e.shape[0],t.shape[0]),c=wy(e.dtype,t.dtype),d=null!=i,h=null!=o,f=a?QW(a,!0):null,p=new eW(e.shape,t.shape,[u,s,l],n,r,d,f,h),m=[e,t];return i&&m.push(i),o&&m.push(o),this.compileAndRun(p,m,c)}localResponseNormalization4D(e,t,n,r,i){const a=Gp().getBool("WEBGL_PACK_NORMALIZATION")?new ZH(e.shape,t,n,r,i):new XH(e.shape,t,n,r,i);return this.compileAndRun(a,[e])}LRNGrad(e,t,n,r,i,a,o){const s=new KH(t.shape,r,i,a,o);return this.compileAndRun(s,[t,n,e])}tile(e,t){if("string"===e.dtype){const n=this.readSync(e.dataId).map(e=>r.decodeString(e)),i=Rb(e.shape,e.dtype,n);return XW(i,t)}const n=new IW(e.shape,t);return this.compileAndRun(n,[e])}pad(e,t,n){const r=Gp().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new aW(e.shape,t,n):new iW(e.shape,t,n);return this.compileAndRun(r,[e])}gather(e,t,n){const r=this.tryRunOnCpuOrThrow([e,t],()=>this.cpuBackend.gather(e,t,n));if(r)return r;const i=new LH(e.shape,t.size,n);return this.compileAndRun(i,[e,t])}batchToSpaceND(e,t,n){r.assert(e.rank<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const i=t.reduce((e,t)=>e*t),a=g.getReshaped(e.shape,t,i),o=g.getPermuted(a.length,t.length),s=g.getReshapedPermuted(e.shape,t,i),l=g.getSliceBeginCoords(n,t.length),u=g.getSliceSize(s,n,t.length);return ax(e.reshape(a),o).reshape(s).slice(l,u)}spaceToBatchND(e,t,n){r.assert(e.rank<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const i=t.reduce((e,t)=>e*t),a=[[0,0]];a.push(...n);for(let r=1+t.length;r<e.shape.length;++r)a.push([0,0]);const o=e.pad(a),s=g.getReshaped(o.shape,t,i,!1),l=g.getPermuted(s.length,t.length,!1),u=g.getReshapedPermuted(o.shape,t,i,!1),c=ax(o.reshape(s),l);return nx(c,u)}reduce(e,t,n){const r=e.shape[0],i=e.shape[1],a=g.computeOptimalWindowSize(i),o=Math.ceil(i/a),s=new lW({windowSize:a,inSize:i,batchSize:r,outSize:o},t),l=this.compileAndRun(s,[e],n);return 1===l.shape[1]?l:this.reduce(l,t,n)}argReduce(e,t,n=null){let r=e.shape[0],i=e.shape[1];null!=n&&(r=n.shape[0],i=n.shape[1]);const a=g.computeOptimalWindowSize(i),o={windowSize:a,inSize:i,batchSize:r,outSize:Math.ceil(i/a)},s=new UU(o,t,null==n),l=[e];null!=n&&l.push(n);const u=this.compileAndRun(s,l,"int32");return 1===u.shape[1]?u:this.argReduce(e,t,u)}argReducePacked(e,t,n=null){const r=null!=n?n.shape:e.shape,i=g.computeOptimalWindowSize(r[r.length-1]),a=new aH(r,i,t,null==n),o=this.compileAndRun(a,null==n?[e]:[e,n],"int32");return o.rank===e.rank?this.argReducePacked(e,t,o):o}sum(e,t){g.assertAxesAreInnerMostDims("sum",t,e.rank);const[n,i]=g.computeOutAndReduceShapes(e.shape,t),a=r.sizeFromShape(i),o=e.as2D(-1,a),s=_y(e.dtype);return this.reduce(o,"sum",s).reshape(n)}prod(e,t){const n=this.tryRunOnCpuOrThrow([e],()=>this.cpuBackend.prod(e,t));if(n)return n;const[i,a]=g.computeOutAndReduceShapes(e.shape,t),o=r.sizeFromShape(a),s=e.as2D(-1,o),l=_y(e.dtype);return this.reduce(s,"prod",l).reshape(i)}unsortedSegmentSum(e,t,n){let i=0;const a=g.getAxesPermutation([i],e.rank);let o=e;null!=a&&(o=ax(e,a),i=g.getInnerMostAxes(1,e.rank)[0]);const s=GW.computeOutShape(o.shape,i,n),l=r.sizeFromShape([o.shape[i]]),u=o.as2D(-1,l),c=_y(e.dtype);let d=this.segOpCompute(u,"unsortedSegmentSum",t,c,n).reshape(s);return null!=a&&(d=ax(d,g.getUndoAxesPermutation(a))),d}segOpCompute(e,t,n,r,i){const a=e.shape[0],o=e.shape[1],s=GW.segOpComputeOptimalWindowSize(o,i),l=new yW({windowSize:s,inSize:o,batchSize:a,numSegments:i},t),u=this.compileAndRun(l,[e,n],r);return u.shape[1]===i?u:(n=kE(0,i).tile([o/s]),this.segOpCompute(u,t,n,r,i))}argMinMaxReduce(e,t,n){const i=[t];if(g.assertAxesAreInnerMostDims("arg"+n.charAt(0).toUpperCase()+n.slice(1),i,e.rank),!Gp().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){const[t,a]=g.computeOutAndReduceShapes(e.shape,i),o=r.sizeFromShape(a),s=e.as2D(-1,o);return this.argReduce(s,n).reshape(t)}return this.argReducePacked(e,n)}argMin(e,t){return this.argMinMaxReduce(e,t,"min")}argMax(e,t){return this.argMinMaxReduce(e,t,"max")}cumsum(e,t,n,r){if(t!==e.rank-1)throw new Error(`WebGL cumsum shader expects an inner-most axis=${e.rank-1} but got axis=`+t);const i=e.shape[t];let a=e;for(let o=0;o<=Math.ceil(Math.log2(i))-1;o++){const t=new kH(e.shape,!1,r),n=t.getCustomSetupFunc(o),i=a;a=this.compileAndRun(t,[a],a.dtype,n),i.dispose()}if(n){const t=new kH(e.shape,n,r),i=a;a=this.compileAndRun(t,[a]),i.dispose()}return a}equal(e,t){if(Gp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");const n=new uH("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}less(e,t){const n=this.tryRunOnCpuOrThrow([e,t],()=>this.cpuBackend.less(e,t));if(n)return n;if(Gp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");const r=new uH("return float(a < b);",e.shape,t.shape);return this.compileAndRun(r,[e,t],"bool")}lessEqual(e,t){if(Gp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");const n=new uH("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}greater(e,t){const n=this.tryRunOnCpuOrThrow([e,t],()=>this.cpuBackend.greater(e,t));if(n)return n;if(Gp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");const r=new uH("return float(a > b);",e.shape,t.shape);return this.compileAndRun(r,[e,t],"bool")}greaterEqual(e,t){if(Gp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");const n=new uH("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}logicalNot(e){const t=new OW(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])}logicalAnd(e,t){if(Gp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");const n=new uH("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}logicalOr(e,t){if(Gp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");const n=new uH("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}select(e,t,n){const r=new bW(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],wy(t.dtype,n.dtype))}where(e){g.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return ZW(e.shape,t)}topk(e,t,n){const r=e.dataSync();return KW(r,e.shape,e.dtype,t,n)}min(e,t){g.assertAxesAreInnerMostDims("min",t,e.rank);const[n,i]=g.computeOutAndReduceShapes(e.shape,t),a=r.sizeFromShape(i),o=e.as2D(-1,a);return this.reduce(o,"min",o.dtype).reshape(n)}minimum(e,t){const n=this.tryRunOnCpuOrThrow([e,t],()=>this.cpuBackend.minimum(e,t));if(n)return n;const r=Gp().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new dH("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new uH("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(r,[e,t])}mod(e,t){const n=Gp().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new dH("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new uH("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])}maximum(e,t){const n=this.tryRunOnCpuOrThrow([e,t],()=>this.cpuBackend.maximum(e,t));if(n)return n;const r=Gp().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new dH("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new uH("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(r,[e,t])}all(e,t){g.assertAxesAreInnerMostDims("all",t,e.rank);const[n,i]=g.computeOutAndReduceShapes(e.shape,t),a=r.sizeFromShape(i),o=e.as2D(-1,a);return this.reduce(o,"all",o.dtype).reshape(n)}any(e,t){g.assertAxesAreInnerMostDims("any",t,e.rank);const[n,i]=g.computeOutAndReduceShapes(e.shape,t),a=r.sizeFromShape(i),o=e.as2D(-1,a);return this.reduce(o,"any",o.dtype).reshape(n)}floorDiv(e,t){const n="int32";if(Gp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",n);const r=new uH("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(r,[e,t],n)}packedUnaryOp(e,t,n){const r=new VW(e.shape,t);return this.compileAndRun(r,[e],n)}packedBinaryOp(e,t,n,r,i=!1){const a=new dH(n,e.shape,t.shape,i);return this.compileAndRun(a,[e,t],r)}makeComplexComponentTensorInfo(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}addN(e){if(1===e.length)return e[0];if(e.length>Gp().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}const t=e.map(e=>e.dtype).reduce((e,t)=>wy(e,t)),n=e.map(e=>e.shape),r=Gp().getBool("WEBGL_PACK")?new zU(e[0].shape,n):new BU(e[0].shape,n);return this.compileAndRun(r,e,t)}pow(e,t){const n=Gp().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new dH("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new uH("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=wy(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)}ceil(e){if(this.shouldExecuteOnCPU([e])){const t=IU(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}if(Gp().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,PW,e.dtype);const t=new OW(e.shape,PW);return this.compileAndRun(t,[e])}floor(e){if(this.shouldExecuteOnCPU([e])){const t=DU(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}if(Gp().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,FW,e.dtype);const t=new OW(e.shape,FW);return this.compileAndRun(t,[e])}sign(e){const t=new OW(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])}isNaN(e){const t=new OW(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")}isInf(e){const t=new OW(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")}isFinite(e){const t=new OW(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")}round(e){const t=new OW(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])}exp(e){if(this.shouldExecuteOnCPU([e])){const t=OU(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}if(Gp().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,LW,e.dtype);const t=new OW(e.shape,LW);return this.compileAndRun(t,[e])}expm1(e){if(this.shouldExecuteOnCPU([e])){const t=AU(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}if(Gp().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,$W,e.dtype);const t=new OW(e.shape,$W);return this.compileAndRun(t,[e])}softmax(e,t){const n=r.parseAxisParam([t],e.shape),i=FS(e,n),a=g.expandShapeToKeepDim(i.shape,n),o=Dw(e,i.reshape(a)),s=this.exp(o),l=this.sum(s,n).reshape(a);return fw(s,l)}log(e){if(this.shouldExecuteOnCPU([e])){const t=MU(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}if(Gp().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);const t=new OW(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])}log1p(e){const t=new OW(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])}sqrt(e){const t=new OW(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])}rsqrt(e){if(this.shouldExecuteOnCPU([e])){const t=RU(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}const t=new OW(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])}reciprocal(e){const t=new OW(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])}relu(e){let t;return t=Gp().getBool("WEBGL_PACK")?new VW(e.shape,UW):new OW(e.shape,DW),this.compileAndRun(t,[e])}relu6(e){let t;return t=Gp().getBool("WEBGL_PACK")?new VW(e.shape,HW):new OW(e.shape,MW),this.compileAndRun(t,[e])}prelu(e,t){const n=Gp().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new dH(cH,e.shape,t.shape):new uH(lH,e.shape,t.shape);return this.compileAndRun(n,[e,t])}elu(e){if(Gp().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,WW,e.dtype);const t=new OW(e.shape,NW);return this.compileAndRun(t,[e])}eluDer(e,t){const n=Gp().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new dH("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new uH("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])}selu(e){const t=new OW(e.shape,jW);return this.compileAndRun(t,[e])}clip(e,t,n){let r;r=Gp().getBool("WEBGL_PACK_CLIP")?new fH(e.shape):new hH(e.shape);const i=r.getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,i)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){const t=kU(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(Gp().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,AW,e.dtype);const t=new OW(e.shape,AW);return this.compileAndRun(t,[e])}complexAbs(e){const t=this.texData.get(e.dataId),n=new pH(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensorInfos.real),this.makeComplexComponentTensorInfo(e,t.complexTensorInfos.imag)];return this.compileAndRun(n,r)}sigmoid(e){const t=new OW(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])}softplus(e){const t=new OW(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])}asin(e){const t=new OW(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(t,[e])}acos(e){const t=new OW(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(t,[e])}atan(e){const t=new OW(e.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(t,[e])}sinh(e){const t=new OW(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])}cosh(e){const t=new OW(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])}tanh(e){const t=new OW(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])}asinh(e){const t=new OW(e.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])}acosh(e){const t=new OW(e.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(t,[e])}atanh(e){const t=new OW(e.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(t,[e])}erf(e){const t=new OW(e.shape,BW);return this.compileAndRun(t,[e])}step(e,t){const n=new OW(e.shape,function(e=0){return`if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(${e});\n  `}(t));return this.compileAndRun(n,[e])}conv2dByMatMul(e,t,n,i,a,o){const s=e.shape,l=this.texData.get(e.dataId),u="channelsLast"===n.dataFormat,c=s[2]%2!=0&&!!l.isPacked;if((1==s[0]*s[1]*s[2]||1===n.outChannels)&&n.inChannels>1e3||!Gp().getBool("WEBGL_LAZILY_UNPACK")||!Gp().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!c){const r=nx(e,[1,u?s[0]*s[1]*s[2]:s[0]*s[2]*s[3],n.inChannels]),l=nx(t,[1,n.inChannels,n.outChannels]),c=this.fusedBatchMatMul({a:r,b:l,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:o});return nx(c,n.outShape)}const d={dataId:e.dataId,shape:[1,u?s[0]*s[1]*(s[2]+1):s[0]*s[2]*(s[3]+1),n.inChannels],dtype:e.dtype},h=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,r.assert(yU(l.shape,d.shape),()=>`packed reshape ${l.shape} to ${d.shape} isn't free`);const f=nx(t,[1,n.inChannels,n.outChannels]),p=this.fusedBatchMatMul({a:d,b:f,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:o}),m=this.texData.get(p.dataId);return r.assert(m.isPacked,()=>"batchMatMul result is expected to be packed"),l.shape=h,m.shape=n.outShape,Xx().makeTensorFromDataId(p.dataId,n.outShape,p.dtype)}conv2dWithIm2Row(e,t,n,r,i,a){const{filterWidth:o,filterHeight:s,inChannels:l,outWidth:u,outHeight:c,dataFormat:d}=n,h="channelsLast"===d,f=o*s*l,p=c*u,m=[f,p],g=e.squeeze([0]),v=t.reshape([1,f,-1]),y=new YH(m,g.shape,n),b=this.compileAndRun(y,[g]).reshape([1,m[0],m[1]]),x=null!=r,w=null!=a,_=i?QW(i,!0):null,S=new eW(b.shape,v.shape,[1,p,n.outChannels],!0,!1,x,_,w),E=[b,v];return r&&E.push(r),w&&E.push(a),this.compileAndRun(S,E).reshape(h?[1,c,u,n.outChannels]:[1,n.outChannels,c,u])}fusedConv2d({input:e,filter:t,convInfo:n,bias:r,activation:i,preluActivationWeights:a}){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n,r,i,a);if(Gp().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n,r,i,a);const o=null!=r,s=null!=a,l=i?QW(i,!1):null,u=new wH(n,o,l,s),c=[e,t];return r&&c.push(r),a&&c.push(a),this.compileAndRun(u,c)}conv2d(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(Gp().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);const r=new wH(n);return this.compileAndRun(r,[e,t])}conv2dDerInput(e,t,n){const r=new gH(n);return this.compileAndRun(r,[e,t])}conv2dDerFilter(e,t,n){const r=new mH(n);return this.compileAndRun(r,[e,t])}fusedDepthwiseConv2D({input:e,filter:t,convInfo:n,bias:r,activation:i,preluActivationWeights:a}){const o=Gp().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1,s=i?QW(i,o):null,l=[e,t],u=null!=r,c=null!=a;let d;return u&&l.push(r),c&&l.push(a),o?(d=new EH(n,u,s,c),this.compileAndRun(d,l)):(d=new SH(n,u,s,c),this.compileAndRun(d,l))}depthwiseConv2D(e,t,n){let r;return Gp().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new EH(n),this.compileAndRun(r,[e,t])):(r=new SH(n),this.compileAndRun(r,[e,t]))}depthwiseConv2DDerInput(e,t,n){const r=new xH(n);return this.compileAndRun(r,[e,t])}depthwiseConv2DDerFilter(e,t,n){const r=new bH(n);return this.compileAndRun(r,[e,t])}conv3d(e,t,n){const r=new _H(n);return this.compileAndRun(r,[e,t])}conv3dDerInput(e,t,n){const r=new yH(n);return this.compileAndRun(r,[e,t])}conv3dDerFilter(e,t,n){const r=new vH(n);return this.compileAndRun(r,[e,t])}unstack(e,t){const n=e.shape[t],r=new Array(e.rank-1);let i=0;for(let l=0;l<e.rank;l++)l!==t&&(r[i++]=e.shape[l]);const a=new Array(e.rank).fill(0),o=e.shape.slice();o[t]=1;const s=new Array(n);for(let l=0;l<s.length;l++)a[t]=l,s[l]=this.slice(e,a,o).reshape(r);return s}avgPool3d(e,t){const n=new sW(t,"avg",!1);return this.compileAndRun(n,[e],"float32")}avgPool3dBackprop(e,t,n){const r=new sH(n);return this.compileAndRun(r,[e],t.dtype)}maxPool3d(e,t){const n=new sW(t,"max",!1);return this.compileAndRun(n,[e],"float32")}maxPool3dBackprop(e,t,n,r){const i=new sW(r,"max",!0),a=this.compileAndRun(i,[t]),o=new QH(r),s=this.compileAndRun(o,[e,a],t.dtype);return a.dispose(),s}resizeBilinear(e,t,n,r){const i=Gp().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new hW(e.shape,t,n,r):new dW(e.shape,t,n,r);return this.compileAndRun(i,[e],"float32")}resizeBilinearBackprop(e,t,n){const r=new cW(e,t,n);return this.compileAndRun(r,[e])}resizeNearestNeighbor(e,t,n,r){const i=new pW(e.shape,t,n,r);return this.compileAndRun(i,[e])}resizeNearestNeighborBackprop(e,t,n){const r=new fW(e,t,n);return this.compileAndRun(r,[e])}multinomial(e,t,n,r){const i=t?e:GE(e),a=new tW(i.shape[0],i.shape[1],n),o=a.getCustomSetupFunc(r);return this.compileAndRun(a,[i],"int32",o)}oneHot(e,t,n,r){const i=new nW(e.size,t,n,r);return this.compileAndRun(i,[e])}diag(e){const t=new MH(e.size);return this.compileAndRun(t,[e])}cropAndResize(e,t,n,r,i,a){const o=new TH(e.shape,t.shape,r,i,a);return this.compileAndRun(o,[e,t,n],"float32")}depthToSpace(e,t,n){r.assert(t>1,()=>"blockSize should be > 1 for depthToSpace, but was: "+t);const i=e.shape[0],a=("NHWC"===n?e.shape[1]:e.shape[2])*t,o=("NHWC"===n?e.shape[2]:e.shape[3])*t,s=("NHWC"===n?e.shape[3]:e.shape[1])/(t*t),l=new DH("NHWC"===n?[i,a,o,s]:[i,s,a,o],t,n);return this.compileAndRun(l,[e])}split(e,t,n){return YW(e,t,n)}scatterND(e,t,n){const{sliceRank:r,numUpdates:i,sliceSize:a,strides:o,outputSize:s}=g.calculateShapes(t,e,n),l=[s/a,a],u=e.reshape([i,r]),c=t.reshape([i,a]);if(0===s)return g.reshapeTensor(Hy([]),n);const d=Tw(0),h=new vW(i,r,u.rank,c.rank,o,l);return this.compileAndRun(h,[c,u,d]).reshape(n)}sparseToDense(e,t,n,r){const{sliceRank:i,numUpdates:a,strides:o,outputSize:s}=g.calculateShapes(t,e,n),l=new vW(a,i,e.rank,t.rank,o,[s,1],!1);return this.compileAndRun(l,[t,e,r]).reshape(n)}gatherND(e,t){const n=t.shape,r=n[n.length-1],[i,a,o,s]=g.prepareAndValidate(e,t),l=t.reshape([a,r]),u=e.reshape([e.size/o,o]),c=new $H(r,s,[a,o]);return this.compileAndRun(c,[u,l]).reshape(i)}fill(e,t,n){if("string"===(n=n||r.inferDtype(t))){const i=r.getArrayFromDType(n,r.sizeFromShape(e));return i.fill(t),Xx().makeTensor(i,e,n,this)}{const r=new FH(e,t),i=r.getCustomSetupFunc(t);return this.compileAndRun(r,[],n,i)}}onesLike(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)}zerosLike(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)}linspace(e,t,n){return g.linspaceImpl(e,t,n)}makeTensorInfo(e,t,n){const r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,n){const{dataId:r}=this.makeTensorInfo(e,t,n);return Xx().makeTensorFromDataId(r,e,t,this)}unpackTensor(e){const t=new qW(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new rW(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const n=[pU(e.shape),...mU(e.shape)],r={dtype:e.dtype,shape:n,dataId:e.dataId},i=[pU(t),...mU(t)],a=new uW(i,n),o=this.runWebGLProgram(a,[r],e.dtype,null,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}}decode(e){const t=this.texData.get(e),{isPacked:n,shape:r,dtype:i}=t,a=gU(r);let o;return o=n?new AH(a):new OH(a),{dtype:i,shape:r,dataId:this.runWebGLProgram(o,[{shape:a,dtype:i,dataId:e}],i,null,!0).dataId}}runWebGLProgram(e,t,n,i,a=!1){const o=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(o.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===Zz.DENSE){const t=tU(e.outputShape);s.texShape=t.map(e=>2*e)}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===r.sizeFromShape(o.shape))return s.values=r.getTypedArrayFromDType(o.dtype,0),o;const l=[],u=t.map(t=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&r.sizeFromShape(t.shape)<=Gp().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),l.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!yU(n.shape,t.shape)){const e=t,r=t.shape;t.shape=n.shape,t=this.packedReshape(t,r),l.push(t),n=this.texData.get(t.dataId),e.shape=r}return this.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(o.dataId);const c={shape:o.shape,texData:s,isUniform:!1},d=function(e,t,n){let r="";t.concat(n).forEach(e=>{r+=`${e.shape}_${e.isUniform?"uniform":e.texData.texShape}_${null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0}`});let i=e.constructor.name;return i+="_"+r+"_"+e.userCode,i}(e,u,c),h=this.getAndSaveBinary(d,()=>function(e,t,n,i){const a=t.userCode,o=n.map((e,n)=>{const r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}}),s=o.map(e=>e.shapeInfo),l={logicalShape:i.shape,texShape:i.texData.texShape,isUniform:!1,isPacked:i.texData.isPacked,flatOffset:null},u=function(e,t,n,i){const a=[];e.forEach(e=>{const t=r.sizeFromShape(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?a.push(`uniform float ${e.name}${t>1?`[${t}]`:""};`):(a.push(`uniform sampler2D ${e.name};`),a.push(`uniform int offset${e.name};`))});const o=a.join("\n"),s=e.map(e=>function(e,t,n=!1){let i="";return i+=n?function e(t){switch(t.shapeInfo.logicalShape.length){case 0:return function(e){const t=e.name;return`\n    vec4 ${"get"+t.charAt(0).toUpperCase()+t.slice(1)}() {\n      return ${VU().texture2D}(${t}, halfCR);\n    }\n  `}(t);case 1:return function(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=VU();return`\n    vec4 ${n}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${i[0]}, ${i[1]}, index);\n      return ${a.texture2D}(${t}, uv);\n    }\n  `}(t);case 2:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,o=a[0],s=a[1],l=VU();if(null!=a&&r.arraysEqual(t,a))return`\n      vec4 ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}.0, ${o}.0);\n\n        return ${l.texture2D}(${n}, uv);\n      }\n    `;const u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`\n    vec4 ${i}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${Math.ceil(t[1]/2)}, ${u[0]}, ${u[1]}, row, col);\n      return ${l.texture2D}(${n}, uv);\n    }\n  `}(t);case 3:return function(t){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=t.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(1===n[0]){const r=[1,2],a=["b","row","col"];return`\n        ${e(rH(t,n.slice(1)))}\n        vec4 ${i}(int b, int row, int col) {\n          return ${i}(${iH(a,r)});\n        }\n      `}const s=o[0],l=o[1],u=Math.ceil(n[2]/2);return`\n    vec4 ${i}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${s}, ${l}, ${u*Math.ceil(n[1]/2)}, ${u}, b, row, col);\n      return ${VU().texture2D}(${r}, uv);\n    }\n  `}(t);default:return function(e){const t=e.shapeInfo.logicalShape,n=t.length,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=o[0],l=o[1],u=Math.ceil(t[n-1]/2);let c=u*Math.ceil(t[n-2]/2),d="int b, int row, int col",h=`b * ${c} + (row / 2) * ${u} + (col / 2)`;for(let f=2;f<n-1;f++)d=`int b${f}, `+d,c*=t[n-f-1],h=`b${f} * ${c} + `+h;return`\n    vec4 ${i}(${d}) {\n      int index = ${h};\n      int texR = index / ${l};\n      int texC = index - texR * ${l};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${l}, ${s});\n      return ${VU().texture2D}(${r}, uv);\n    }\n  `}(t)}}(e):function e(t){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return`float ${n}() {return ${t};}`;const[r,i]=e.shapeInfo.texShape;if(1===r&&1===i)return`\n      float ${n}() {\n        return sampleTexture(${t}, halfCR);\n      }\n    `;const[a,o]=e.shapeInfo.texShape;return`\n    float ${n}() {\n      vec2 uv = uvFromFlat(${a}, ${o}, ${eH(t)});\n      return sampleTexture(${t}, uv);\n    }\n  `}(t);case 1:return function(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return`\n      float ${n}(int index) {\n        ${tH(e)}\n      }\n    `;const r=e.shapeInfo.texShape,i=r[0],a=r[1];if(1===a&&1===i)return`\n      float ${n}(int index) {\n        return sampleTexture(${t}, halfCR);\n      }\n    `;const o=eH(t);return 1===a?`\n      float ${n}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / ${i}.0);\n        return sampleTexture(${t}, uv);\n      }\n    `:1===i?`\n      float ${n}(int index) {\n        vec2 uv = vec2((float(index + ${o}) + 0.5) / ${a}.0, 0.5);\n        return sampleTexture(${t}, uv);\n      }\n    `:`\n    float ${n}(int index) {\n      vec2 uv = uvFromFlat(${i}, ${a}, index + ${o});\n      return sampleTexture(${t}, uv);\n    }\n  `}(t);case 2:return function(t){const n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=t.shapeInfo.texShape;if(null!=o&&r.arraysEqual(n,o))return`\n    float ${a}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${o[1]}.0, ${o[0]}.0);\n      return sampleTexture(${i}, uv);\n    }\n  `;const{newShape:s,keptDims:l}=r.squeezeShape(n);if(s.length<n.length){const n=["row","col"];return`\n      ${e(rH(t,s))}\n      float ${a}(int row, int col) {\n        return ${a}(${iH(n,l)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${a}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));\n        ${tH(t)}\n      }\n    `;const u=o[0],c=o[1],d=eH(i);return 1===c?`\n    float ${a}(int row, int col) {\n      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);\n      return sampleTexture(${i}, uv);\n    }\n  `:1===u?`\n    float ${a}(int row, int col) {\n      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);\n      return sampleTexture(${i}, uv);\n    }\n  `:`\n  float ${a}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${n[1]} + col + ${d};\n    vec2 uv = uvFromFlat(${u}, ${c}, index);\n    return sampleTexture(${i}, uv);\n  }\n`}(t);case 3:return function(t){const n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=n[1]*n[2],s=n[2],{newShape:l,keptDims:u}=r.squeezeShape(n);if(l.length<n.length){const n=["row","col","depth"];return`\n        ${e(rH(t,l))}\n        float ${a}(int row, int col, int depth) {\n          return ${a}(${iH(n,u)});\n        }\n      `}if(t.shapeInfo.isUniform)return`\n      float ${a}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${o}, ${s}, 1)));\n        ${tH(t)}\n      }\n    `;const c=t.shapeInfo.texShape,d=c[0],h=c[1],f=t.shapeInfo.flatOffset;return h===o&&null==f?`\n        float ${a}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${s}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${h}.0, ${d}.0);\n          return sampleTexture(${i}, uv);\n        }\n      `:h===s&&null==f?`\n    float ${a}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${d}.0);\n      return sampleTexture(${i}, uv);\n    }\n  `:`\n      float ${a}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${o} + col * ${s} + depth + ${eH(i)};\n        vec2 uv = uvFromFlat(${d}, ${h}, index);\n        return sampleTexture(${i}, uv);\n      }\n  `}(t);case 4:return function(t){const n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=n[3],s=n[2]*o,l=n[1]*s,{newShape:u,keptDims:c}=r.squeezeShape(n);if(u.length<n.length){const n=["row","col","depth","depth2"];return`\n      ${e(rH(t,u))}\n      float ${a}(int row, int col, int depth, int depth2) {\n        return ${a}(${iH(n,c)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${a}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${l}, ${s}, ${o}, 1)));\n        ${tH(t)}\n      }\n    `;const d=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,f=h[0],p=h[1];return p===l&&null==d?`\n      float ${a}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${s}, ${o}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${f}.0);\n        return sampleTexture(${i}, uv);\n      }\n    `:p===o&&null==d?`\n      float ${a}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${n[1]*n[2]}, ${n[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${f}.0);\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n    float ${a}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${l} + col * ${s} +\n          depth * ${o} + depth2;\n      vec2 uv = uvFromFlat(${f}, ${p}, index + ${eH(i)});\n      return sampleTexture(${i}, uv);\n    }\n  `}(t);case 5:return function(t){const n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=n[4],s=n[3]*o,l=n[2]*s,u=n[1]*l,{newShape:c,keptDims:d}=r.squeezeShape(n);if(c.length<n.length){const n=["row","col","depth","depth2","depth3"];return`\n      ${e(rH(t,c))}\n      float ${a}(int row, int col, int depth, int depth2, int depth3) {\n        return ${a}(${iH(n,d)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${a}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${u}, ${l}, ${s}, ${o})) +\n          depth3;\n        ${tH(t)}\n      }\n    `;const h=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,p=f[0],m=f[1];return m===u&&null==h?`\n      float ${a}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${l}, ${s}, ${o}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${m}.0, ${p}.0);\n        return sampleTexture(${i}, uv);\n      }\n    `:m===o&&null==h?`\n      float ${a}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${n[1]*n[2]*n[3]},\n               ${n[2]*n[3]}, ${n[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${m}.0, ${p}.0);\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n    float ${a}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${u} + col * ${l} + depth * ${s} +\n          depth2 * ${o} + depth3 + ${eH(i)};\n      vec2 uv = uvFromFlat(${p}, ${m}, index);\n      return sampleTexture(${i}, uv);\n    }\n  `}(t);case 6:return function(t){const n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),{newShape:o,keptDims:s}=r.squeezeShape(n);if(o.length<n.length){const n=["row","col","depth","depth2","depth3","depth4"];return`\n      ${e(rH(t,o))}\n      float ${a}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${a}(${iH(n,s)});\n      }\n    `}const l=n[5],u=n[4]*l,c=n[3]*u,d=n[2]*c,h=n[1]*d;if(t.shapeInfo.isUniform)return`\n      float ${a}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${h}, ${d}, ${c}, ${u})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${l}, 1)));\n        ${tH(t)}\n      }\n    `;const f=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,m=p[0],g=p[1];return g===h&&null==f?`\n      float ${a}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${d}, ${c}, ${u}, ${l})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${g}.0, ${m}.0);\n        return sampleTexture(${i}, uv);\n      }\n    `:g===l&&null==f?`\n      float ${a}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${n[1]*n[2]*n[3]*n[4]},\n               ${n[2]*n[3]*n[4]},\n               ${n[3]*n[4]},\n               ${n[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${g}.0, ${m}.0);\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n    float ${a}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${h} + col * ${d} + depth * ${c} +\n          depth2 * ${u} + depth3 * ${l} + depth4 + ${eH(i)};\n      vec2 uv = uvFromFlat(${m}, ${g}, index);\n      return sampleTexture(${i}, uv);\n    }\n  `}(t);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(e),e.shapeInfo.logicalShape.length<=t.logicalShape.length&&(i+=n?function(e,t){const n=e.name,i=n.charAt(0).toUpperCase()+n.slice(1),a="get"+i+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,l=XU(e.shapeInfo.logicalShape,t.logicalShape),u=nH(s),c=s-o;let d;const h=["x","y","z","w","u","v"];d=0===o?"":s<2&&l.length>=1?"coords = 0;":l.map(e=>`coords.${h[e+c]} = 0;`).join("\n");let f="";f=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((e,t)=>"coords."+h[t+c]).join(", ");let p="return outputValue;";const m=1===r.sizeFromShape(e.shapeInfo.logicalShape),g=1===r.sizeFromShape(t.logicalShape);if(1!==o||m||g){if(m&&!g)p=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(l.length){const e=o-2,t=o-1;l.indexOf(e)>-1&&l.indexOf(t)>-1?p="return vec4(outputValue.x);":l.indexOf(e)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":l.indexOf(t)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${a}() {\n      ${u} coords = getOutputCoords();\n      ${d}\n      vec4 outputValue = get${i}(${f});\n      ${p}\n    }\n  `}(e,t):function(e,t){const n=e.name,i=n.charAt(0).toUpperCase()+n.slice(1),a="get"+i+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length;if(!e.shapeInfo.isUniform&&o===s&&null==e.shapeInfo.flatOffset&&r.arraysEqual(e.shapeInfo.texShape,t.texShape))return`\n      float ${a}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;const l=nH(s),u=XU(e.shapeInfo.logicalShape,t.logicalShape),c=s-o;let d;const h=["x","y","z","w","u","v"];d=0===o?"":s<2&&u.length>=1?"coords = 0;":u.map(e=>`coords.${h[e+c]} = 0;`).join("\n");let f="";return f=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((e,t)=>"coords."+h[t+c]).join(", "),`\n    float ${a}() {\n      ${l} coords = getOutputCoords();\n      ${d}\n      return get${i}(${f});\n    }\n  `}(e,t)),i}(e,t,i)).join("\n"),l=t.texShape,u=VU(),c=function(e){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${e.texture2D}(textureSampler, uv).r;\n    }\n  `}(u);let d,h,f=function(e){return`${e.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${e.varyingFs} vec2 resultUV;\n    ${e.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${e.defineSpecialNaN}\n    ${e.defineSpecialInf}\n    ${e.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${KU}\n    ${ZU}\n    ${JU}\n  `}(u);return t.isPacked?(d=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){const n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${n[1]}.0);\n      }\n    `:1===n[1]?`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${n[0]}.0);\n      }\n    `:`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      return 2 * (resTexRC.x * ${n[1]} + resTexRC.y);\n    }\n  `}(0,t);case 2:return function(e,t){const n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(r.arraysEqual(e,t))return`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${n[0]}, ${n[1]}));\n      }\n    `;const i=Math.ceil(e[1]/2);return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n\n      int index = resTexRC.x * ${n[1]} + resTexRC.y;\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}(e,t);case 3:return function(e,t){const n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),i=r*Math.ceil(e[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      int index = resTexRC.x * ${n[1]} + resTexRC.y;\n\n      int b = index / ${i};\n      index -= b * ${i};\n\n      int r = 2 * (index / ${r});\n      int c = imod(index, ${r}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}(e,t);default:return function(e,t){const n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),i=r*Math.ceil(e[e.length-2]/2);let a=i,o="",s="b, r, c";for(let l=2;l<e.length-1;l++)a*=e[e.length-l-1],o=`\n      int b${l} = index / ${a};\n      index -= b${l} * ${a};\n    `+o,s=`b${l}, `+s;return`\n    ivec${e.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      int index = resTexRC.x * ${n[1]} + resTexRC.y;\n\n      ${o}\n\n      int b = index / ${i};\n      index -= b * ${i};\n\n      int r = 2 * (index / ${r});\n      int c = imod(index, ${r}) * 2;\n\n      return ivec${e.length}(${s});\n    }\n  `}(e,t)}}(t.logicalShape,l),h=function(e){return`\n    void setOutput(vec4 val) {\n      ${e.output} = val;\n    }\n  `}(u)):(d=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(n=t)[0]?`\n      int getOutputCoords() {\n        return int(resultUV.x * ${n[1]}.0);\n      }\n    `:1===n[1]?`\n      int getOutputCoords() {\n        return int(resultUV.y * ${n[0]}.0);\n      }\n    `:`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      return resTexRC.x * ${n[1]} + resTexRC.y;\n    }\n  `;case 2:return function(e,t){return r.arraysEqual(e,t)?`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));\n      }\n    `:1===e[1]?`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `:1===e[0]?`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `:`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      int r = index / ${e[1]};\n      int c = index - r * ${e[1]};\n      return ivec2(r, c);\n    }\n  `}(e,t);case 3:return function(e,t){const n=qU(["r","c","d"],e);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${n}\n      return ivec3(r, c, d);\n    }\n  `}(e,t);case 4:return function(e,t){const n=qU(["r","c","d","d2"],e);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${n}\n      return ivec4(r, c, d, d2);\n    }\n  `}(e,t);case 5:return function(e,t){const n=qU(["r","c","d","d2","d3"],e);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},\n                             ${t[1]}));\n\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}(e,t);case 6:return function(e,t){const n=qU(["r","c","d","d2","d3","d4"],e);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n}(t.logicalShape,l),h=function(e){return`\n    void setOutput(float val) {\n      ${e.output} = vec4(val, 0, 0, 0);\n    }\n  `}(u)),i&&(f+=QU),[f,c,h,o,d,s,n].join("\n")}(o,l,a,t.packedInputs),c=e.createProgram(u);let d=null;const h=e.getUniformLocation(c,"NAN",!1);1===Gp().getNumber("WEBGL_VERSION")&&(d=e.getUniformLocation(c,"INFINITY",!1));const f={};for(let r=0;r<t.variableNames.length;r++){const n=t.variableNames[r],i=!1;f[n]=e.getUniformLocation(c,n,i),f["offset"+n]=e.getUniformLocation(c,"offset"+n,i)}return{program:t,source:u,webGLProgram:c,uniformLocations:f,inShapeInfos:s,outShapeInfo:l,infLoc:d,nanLoc:h}}(this.gpgpu,e,u,c)),f=null!=this.activeTimers;let p;if(f&&(p=this.startTimer()),function(e,t,n,i,a){GH(t.inShapeInfos,n),GH([t.outShapeInfo],[i]);const o=i.texData.texture,s=i.texData.texShape;i.texData.isPacked?e.setOutputPackedMatrixTexture(o,s[0],s[1]):e.setOutputMatrixTexture(o,s[0],s[1]),e.setProgram(t.webGLProgram),1===Gp().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((n,i)=>{const a=t.program.variableNames[i],o=t.uniformLocations[a],s=t.uniformLocations["offset"+a];if(null!=o)if(n.isUniform)if(r.sizeFromShape(n.shape)<2)e.gl.uniform1f(o,n.uniformValues[0]);else{let t=n.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(o,t)}else null!=n.texData.slice&&null!=s&&e.gl.uniform1i(s,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,o,i)}),null!=a&&a(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,h,u,c,i),l.forEach(e=>this.disposeIntermediateTensorInfo(e)),f&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)})),!Gp().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===a){const e=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),e}return o}compileAndRun(e,t,n,r,i=!1){const a=this.runWebGLProgram(e,t,n=n||t[0].dtype,r,i);return Xx().makeTensorFromDataId(a.dataId,a.shape,a.dtype)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(Gp().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Jx(()=>{if(!Gp().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=Gp().getBool("DEBUG");Gp().set("DEBUG",!1);const t=this.abs(Tw(1e-8)).dataSync()[0];if(Gp().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(e){const t=this.texData.get(e),{shape:n,dtype:i,values:a,texture:o,usage:s,isPacked:l}=t;if(null!=o)return;const u=null!=this.activeTimers;let c;u&&(c=r.now());let d=t.texShape;if(null==d&&(d=function(e,t=!1){let n=Gp().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,1===(e=e.map((t,n)=>n>=e.length-2?r.nearestLargerEven(e[n]):e[n])).length&&(e=[2,e[0]])),2!==e.length){const t=r.squeezeShape(e);e=t.newShape}let i=r.sizeFromShape(e);if(e.length<=1&&i<=n)return[1,i];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){const t=pU(e);let n=2,a=2;return e.length&&([n,a]=mU(e)),i=t*(n/2)*(a/2),r.sizeToSquarishShape(i).map(e=>2*e)}return r.sizeToSquarishShape(i)}(n,l),t.texShape=d),null!=a){const e=gU(n);let o,s=d[1],h=d[0];const f=a instanceof Uint8Array;l?([s,h]=nU(d[0],d[1]),o=new PH(e,[h,s],f)):o=new RH(e,[h,s],f);const p=this.makeTensorInfo([h,s],i);this.texData.get(p.dataId).usage=f?Jz.PIXELS:Jz.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(p.dataId),s,h,a);const m=this.runWebGLProgram(o,[p],i,null,!0),g=this.texData.get(m.dataId);t.texture=g.texture,t.texShape=g.texShape,t.isPacked=g.isPacked,t.usage=g.usage,this.disposeIntermediateTensorInfo(p),this.texData.delete(m.dataId),t.values=null,u&&(this.uploadWaitMs+=r.now()-c)}else{const e=this.acquireTexture(d,s,i,l);t.texture=e}}convertAndCacheOnCPU(e,t){const n=this.texData.get(e),{dtype:r}=n;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){const n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values}acquireTexture(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${e} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*r.bytesPerElement(t)}tryRunOnCpuOrThrow(e,t){if(this.shouldExecuteOnCPU(e))try{return t()}catch(n){if(Gp().getBool("IS_TEST"))throw new Error("CPU forwarding failed")}return null}}function tV(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}a.isBrowser()&&lw("webgl",()=>new eV,2);const nV={kernelName:ag,backendName:"webgl",kernelFunc:tV};function rV(e){const{inputs:t,backend:n}=e,{real:r,imag:i}=t,a=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(a.dataId),s=tV({inputs:{x:r},backend:n});n.texData.get(s.dataId).complexParentRefCount++;const l=tV({inputs:{x:i},backend:n});return n.texData.get(l.dataId).complexParentRefCount++,o.complexTensorInfos={real:s,imag:l},a}const iV={kernelName:_m,backendName:"webgl",kernelFunc:rV};function aV(e){return({inputs:t,backend:n})=>{const{x:r}=t,i=n,a=new OW(r.shape,e);return i.runWebGLProgram(a,[r],r.dtype)}}function oV({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:i,dtype:a}){return({inputs:o,backend:s})=>{const{a:l,b:u}=o,c=s;if(r&&"complex64"===l.dtype){const t=c.texData.get(l.dataId),n=c.texData.get(u.dataId),[r,i]=[[t.complexTensorInfos.real,n.complexTensorInfos.real],[t.complexTensorInfos.imag,n.complexTensorInfos.imag]].map(t=>{const[n,r]=t,i={dataId:n.dataId,dtype:n.dtype,shape:l.shape},a={dataId:r.dataId,dtype:r.dtype,shape:u.shape},o=new uH(e,l.shape,u.shape);return c.runWebGLProgram(o,[i,a],wy(n.dtype,r.dtype))}),a=rV({inputs:{real:r,imag:i},backend:c});return c.disposeIntermediateTensorInfo(r),c.disposeIntermediateTensorInfo(i),a}const d=a||wy(l.dtype,u.dtype);if(c.shouldExecuteOnCPU([l,u])&&null!=i){const e=c.texData.get(l.dataId),t=c.texData.get(u.dataId),[n,r]=i(l.shape,u.shape,e.values,t.values,d),a=c.makeTensorInfo(r,d);return c.texData.get(a.dataId).values=n,a}let h;return h=Gp().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=t?new dH(t,l.shape,u.shape,n):new uH(e,l.shape,u.shape),c.runWebGLProgram(h,[l,u],d)}}const sV="return a + b;",lV=oV({opSnippet:sV,packedOpSnippet:sV,supportsComplex:!0,cpuKernelImpl:CU}),uV={kernelName:tm,backendName:"webgl",kernelFunc:lV},cV=oV({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),dV={kernelName:dm,backendName:"webgl",kernelFunc:cV},hV={kernelName:hm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:a}=t;EU(a,"avgPool");const{filterSize:o,strides:s,pad:l,dimRoundingMode:u}=i;r.assert(g.eitherStridesOrDilationsAreOne(s,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '1'`);const c=g.computePool2DInfo(a.shape,o,s,1,l,u);if(1===c.filterWidth&&1===c.filterHeight&&r.arraysEqual(c.inShape,c.outShape))return tV({inputs:{x:a},backend:n});const d=new oW(c,"avg",!1);return n.runWebGLProgram(d,[a],"float32")}},fV={kernelName:fm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,o=a;EU([i,a],"avgPoolBackprop");const{filterSize:s,strides:l,pad:u}=r,c=g.computePool2DInfo(o.shape,s,l,1,u),d=new oH(c);return n.runWebGLProgram(d,[i],o.dtype)}};class pV{constructor(e,t,n,r,i,a){this.outputShape=[],this.variableNames=["x","mean","variance"],g.assertAndGetBroadcastShape(e,t),g.assertAndGetBroadcastShape(e,n);let o="0.0";null!=r&&(g.assertAndGetBroadcastShape(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let s="1.0";null!=i&&(g.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${o};\n        float scale = ${s};\n        float inv = scale * inversesqrt(variance + float(${a}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}class mV{constructor(e,t,n,r,i,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],g.assertAndGetBroadcastShape(e,t),g.assertAndGetBroadcastShape(e,n);let o="vec4(0.0)";null!=r&&(g.assertAndGetBroadcastShape(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let s="vec4(1.0)";null!=i&&(g.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`\n      void main() {\n        vec4 offset = ${o};\n        vec4 scale = ${s};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${a}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}const gV={kernelName:eg,backendName:"webgl",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:i,mean:a,variance:o,offset:s,scale:l}=e;r.assert(a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),r.assert(null==s||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),r.assert(null==l||a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:u}=n;null==u&&(u=.001);const c=[i,a,o];let d=null;null!=s&&(d=s.shape,c.push(s));let h=null;null!=l&&(h=l.shape,c.push(l));const f=Gp().getBool("WEBGL_PACK_NORMALIZATION")?new mV(i.shape,a.shape,o.shape,d,h,u):new pV(i.shape,a.shape,o.shape,d,h,u);return t.runWebGLProgram(f,c,c[0].dtype)}},vV=oV({opSnippet:"return float(a != b);",dtype:"bool"}),yV={kernelName:Pg,backendName:"webgl",kernelFunc:vV};function bV(e){const{inputs:t,backend:n}=e,{input:r}=t;return tV({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}const xV={kernelName:Yg,backendName:"webgl",kernelFunc:bV},wV={kernelName:bm,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:i,attrs:a}=t,{x:o}=n,{dtype:s}=a;if("complex64"===s){if("complex64"===o.dtype)return tV({inputs:{x:o},backend:i});const t=YS(o.shape),n=e({inputs:{x:o},backend:i,attrs:{dtype:"float32"}}),r=rV({inputs:{real:n,imag:t},backend:i});return t.dispose(),i.disposeIntermediateTensorInfo(n),r}if("complex64"===o.dtype){const t=bV({inputs:{input:o},backend:i}),n=e({inputs:{x:t},backend:i,attrs:{dtype:s}});return i.disposeIntermediateTensorInfo(t),n}if(!r.hasEncodingLoss(o.dtype,s)){const e=tV({inputs:{x:o},backend:i});return{dataId:e.dataId,shape:e.shape,dtype:s}}if("int32"===s)return function(e,t){const n=new OW(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(o,i);if("bool"===s){const e=i.makeTensorInfo([],"bool",r.getTypedArrayFromDType("bool",1)),t=vV({inputs:{a:o,b:e},backend:i});return i.disposeIntermediateTensorInfo(e),t}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${s}`)}};class _V{constructor(e){this.outputShape=[],this.outputShape=g.computeOutShape(e,1),this.variableNames=e.map((e,t)=>"T"+t);const t=new Array(e.length-1);t[0]=e[0][1];for(let r=1;r<t.length;r++)t[r]=t[r-1]+e[r][1];const n=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let r=1;r<t.length;r++)n.push(`else if (yC < ${t[r]}) setOutput(getT${r}(yR, yC-${t[r-1]}));`);n.push(`else setOutput(getT${t.length}(yR, yC-${t[t.length-1]}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}class SV{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=g.computeOutShape(e,t);const n=this.outputShape,r=n.length,i=nH(r),a=WU("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((e,t)=>"T"+t);const s=new Array(e.length-1);s[0]=e[0][t];for(let f=1;f<s.length;f++)s[f]=s[f-1]+e[f][t];const l=o[t],u=o.slice(-2),c=o.join();let d=`if (${l} < ${s[0]}) {\n        return getChannel(\n            getT0(${c}), vec2(${u.join()}));\n        }`;for(let f=1;f<s.length;f++){const e=s[f-1];d+=`\n        if (${l} < ${s[f]}  && ${l} >= ${s[f-1]}) {\n          return getChannel(\n            getT${f}(${EV(o,l,e)}),\n            vec2(${EV(u,l,e)}));\n        }`}const h=s[s.length-1];d+=`\n        return getChannel(\n          getT${s.length}(${EV(o,l,h)}),\n          vec2(${EV(u,l,h)}));`,this.userCode=`\n      float getValue(${o.map(e=>"int "+e)}) {\n        ${d}\n      }\n\n      void main() {\n        ${i} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${a}), 0., 0., 0.);\n\n        ${a[r-1]} = ${a[r-1]} + 1;\n        if (${a[r-1]} < ${n[r-1]}) {\n          result.g = getValue(${a});\n        }\n\n        ${a[r-2]} = ${a[r-2]} + 1;\n        if (${a[r-2]} < ${n[r-2]}) {\n          result.a = getValue(${a});\n        }\n\n        ${a[r-1]} = ${a[r-1]} - 1;\n        if (${a[r-2]} < ${n[r-2]} &&\n            ${a[r-1]} < ${n[r-1]}) {\n          result.b = getValue(${a});\n        }\n        setOutput(result);\n      }\n    `}}function EV(e,t,n){const r=e.indexOf(t);return e.map((e,t)=>t===r?`${e} - ${n}`:e).join()}function TV(e){const{inputs:t,backend:n}=e,{input:r}=t;return tV({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}const kV={kernelName:sg,backendName:"webgl",kernelFunc:TV};function CV(e){const{inputs:t,backend:n,attrs:i}=e,{x:a}=t,{shape:o}=i,s=n,l=r.sizeFromShape(a.shape),u=r.inferFromImplicitShape(o,l),c=r.sizeFromShape(u);r.assert(l===c,()=>`The new shape (${u}) has ${c} elements and the old shape (${a.shape}) has ${l} elements. The new shape and old shape must have the same number of elements.`);const d=s.texData.get(a.dataId);return!d.isPacked||yU(a.shape,u)||null!==d.texture&&yU(d.shape,u)?(s.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){const r=[pU(e.shape),...mU(e.shape)],i={dtype:e.dtype,shape:r,dataId:e.dataId},a=[pU(t),...mU(t)],o=new uW(a,r),s=n.runWebGLProgram(o,[i],e.dtype,null,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}(a,u,s)}const IV={kernelName:Zg,backendName:"webgl",kernelFunc:CV},OV={kernelName:Sm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{axis:a}=i,o=r.parseAxisParam(a,t[0].shape)[0],s=g.computeOutShape(t.map(e=>e.shape),o);if(0===r.sizeFromShape(s))return n.makeTensorInfo(s,t[0].dtype,[]);const l=t.filter(e=>r.sizeFromShape(e.shape)>0);if(1===l.length)return l[0];const u=l.map(e=>e.shape);return g.assertParamsConsistent(u,o),function e(t,n,i){const a=t[0].dtype;if("complex64"===a){const r=t.map(e=>bV({inputs:{input:e},backend:i})),a=t.map(e=>TV({inputs:{input:e},backend:i})),o=e(r,n,i),s=e(a,n,i),l=rV({inputs:{real:o,imag:s},backend:i});return r.forEach(e=>i.disposeIntermediateTensorInfo(e)),a.forEach(e=>i.disposeIntermediateTensorInfo(e)),i.disposeIntermediateTensorInfo(o),i.disposeIntermediateTensorInfo(s),l}if(t.length>Gp().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const r=Math.floor(t.length/2),a=e(t.slice(0,r),n,i),o=e(t.slice(r),n,i),s=e([a,o],n,i);return i.disposeIntermediateTensorInfo(a),i.disposeIntermediateTensorInfo(o),s}if(Gp().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){const e=new SV(t.map(e=>e.shape),n);return i.runWebGLProgram(e,t,a)}const o=g.computeOutShape(t.map(e=>e.shape),n),s=t.map(e=>CV({inputs:{x:e},attrs:{shape:[-1,r.sizeFromShape(e.shape.slice(n))]},backend:i})),l=new _V(s.map(e=>e.shape)),u=i.runWebGLProgram(l,s,a);s.forEach(e=>i.disposeIntermediateTensorInfo(e));const c=CV({inputs:{x:u},attrs:{shape:o},backend:i});return i.disposeIntermediateTensorInfo(u),c}(l,o,n)}},AV=aV("if (isnan(x)) return x;\n  return cos(x);\n"),DV={kernelName:Am,backendName:"webgl",kernelFunc:AV},MV=oV({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),NV={kernelName:Um,backendName:"webgl",kernelFunc:MV};class jV{constructor(e,t,n){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";let o;if("real"===e)o="return real * expR - imag * expI;";else{if("imag"!==e)throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);o="return real * expI + imag * expR;"}this.userCode=`\n      const float exponentMultiplier = ${i};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${o}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${r});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${r}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${a};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}}function RV(e,t,n){const i=n.texData.get(e.dataId),a=r.sizeFromShape(e.shape),o=e.shape[e.shape.length-1],s=CV({inputs:{x:e},backend:n,attrs:{shape:[a/o,o]}}).shape,l=new jV("real",s,t),u=new jV("imag",s,t),c=[{dataId:i.complexTensorInfos.real.dataId,dtype:i.complexTensorInfos.real.dtype,shape:s},{dataId:i.complexTensorInfos.imag.dataId,dtype:i.complexTensorInfos.imag.dtype,shape:s}],d=n.runWebGLProgram(l,c,"float32"),h=n.runWebGLProgram(u,c,"float32"),f=rV({inputs:{real:d,imag:h},backend:n});n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h);const p=CV({inputs:{x:f},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(p),p}const PV={kernelName:Xm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t;return RV(r,!1,n)}};class FV{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${t} - x;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${t}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}const LV={kernelName:Zm,backendName:"webgl",kernelFunc:({inputs:e,backend:t})=>{const{image:n}=e,r=t,i=new FV(n.shape);return r.runWebGLProgram(i,[n],n.dtype)}};class $V{constructor(e){this.variableNames=["A"];const t=VU(),[n,r]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);\n\n        vec4 values = ${t.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}class BV{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=VU(),[n,r]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${r}.0, ${n}.0);\n            vec4 values = ${t.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${t.output} = result;\n      }\n    `}}const zV={kernelName:Rv,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e;let{pixels:i}=t;const{numChannels:a}=r,o="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,[l,u]=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],c=[u,l],d=[u,l,a];(s||o)&&(null==UV&&(UV=document.createElement("canvas").getContext("2d")),UV.canvas.width=l,UV.canvas.height=u,UV.drawImage(i,0,0,l,u),i=UV.canvas);const h=n.makeTensorInfo(c,"int32");n.texData.get(h.dataId).usage=Jz.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),i);const f=Gp().getBool("WEBGL_PACK")?new BV(d):new $V(d),p=n.runWebGLProgram(f,[h],"int32");return n.disposeData(h.dataId),p}};let UV;const HV={kernelName:og,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t;return RV(r,!0,n)}};class WV{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:i,inSize:a,outSize:o}=e;this.outputShape=[i,o];const s=4*Math.floor(n/4),l=n%4;let u="sumValue += dot(values, ones);";if(null!=t){const e=1/t;u=`sumValue += dot(values * ${r.isInt(e)?e.toPrecision(2):e}, ones);`}let c="";a%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${a}) {\n          return 0.0;\n        }\n      `),this.userCode=`\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${c}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${s}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${u}\n        }\n\n        int inIdx = inOffset + ${s};\n        if (${1===l}) {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ${u}\n        } else if (${2===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ${u}\n        } else if (${3===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ${u}\n        }\n        setOutput(sumValue);\n      }\n    `}}function VV(e,t,n,r){const i=function(e){const t=[];for(;0===t.length||1!==t[t.length-1].outSize;){const n=t.length?t[t.length-1].outSize:e[1],r=g.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape);let a=e;for(let o=0;o<i.length;o++){const{inSize:s,windowSize:l,outSize:u}=i[o];let c,d;c="mean"===n?0===o?new WV({windowSize:l,inSize:s,batchSize:e.shape[0],outSize:u},s):new WV({windowSize:l,inSize:s,batchSize:e.shape[0],outSize:u}):new lW({windowSize:l,inSize:s,batchSize:e.shape[0],outSize:u},n),d=a,a=r.runWebGLProgram(c,[a],t),d.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(d)}return a}class qV{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let a=0;a<n.length;a++)n[a]=e[t[a]];this.outputShape=n,this.rank=n.length;const r=nH(this.rank),i=function(e){const t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let i=0;i<e.length;i++)r[e[i]]=n[i];return r.join()}(t);this.userCode=`\n    void main() {\n      ${r} resRC = getOutputCoords();\n      setOutput(getA(${i}));\n    }\n    `}}class GV{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(e.length);for(let u=0;u<n.length;u++)n[u]=e[t[u]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=nH(this.rank),i=HU("rc",this.rank),a=new Array(this.rank);for(let u=0;u<t.length;u++)a[t[u]]=i[u];const o=`vec2(${a.slice(-2).join()})`,s=`++${i[this.rank-1]} < ${n[this.rank-1]}`,l=`getChannel(getA(${a.join()}), ${o})`;this.userCode=`\n    void main() {\n      ${r} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${l};\n      if(${s}) {\n        result[1] = ${l};\n      }\n      --${i[this.rank-1]};\n      if(++${i[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${l};\n        if(${s}) {\n          result[3] = ${l};\n        }\n      }\n      setOutput(result);\n    }\n    `}}function YV(e,t,n){const r=Gp().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new GV(e.shape,t):new qV(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}const XV={kernelName:_g,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:i}=e,{reductionIndices:a,keepDims:o}=t,s=n,l=i.shape.length,u=r.parseAxisParam(a,i.shape);let c=u;const d=g.getAxesPermutation(c,l),h=null!=d,f=s.shouldExecuteOnCPU([i]);let p=i;if(h){if(f){const e=s.texData.get(p.dataId).values,t=new Array(l);for(let r=0;r<t.length;r++)t[r]=i.shape[d[r]];const n=LU(e,i.shape,i.dtype,d,t);p=s.makeTensorInfo(t,i.dtype),s.texData.get(p.dataId).values=n}else p=YV(i,d,s);c=g.getInnerMostAxes(c.length,l)}g.assertAxesAreInnerMostDims("max",c,l);const[m,v]=g.computeOutAndReduceShapes(p.shape,c);let y,b=m;if(o&&(b=g.expandShapeToKeepDim(m,u)),f){const e=s.texData.get(p.dataId),t=NU(e.values,r.sizeFromShape(v),b,i.dtype);y=s.makeTensorInfo(b,i.dtype),s.texData.get(y.dataId).values=t}else y=function(e,t,n,i){const a=r.sizeFromShape(t),o=CV({inputs:{x:e},attrs:{shape:[r.sizeFromShape(e.shape)/a,a]},backend:i}),s=VV(o,e.dtype,"max",i),l=CV({inputs:{x:s},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(o),i.disposeIntermediateTensorInfo(s),l}(p,v,b,s);return h&&s.disposeIntermediateTensorInfo(p),y}},KV={kernelName:Eg,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:a}=t;EU(a,"maxPool");const{filterSize:o,strides:s,pad:l,dimRoundingMode:u}=i;r.assert(g.eitherStridesOrDilationsAreOne(s,1),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '1'`);const c=g.computePool2DInfo(a.shape,o,s,1,l,u);if(1===c.filterWidth&&1===c.filterHeight&&r.arraysEqual(c.inShape,c.outShape))return tV({inputs:{x:a},backend:n});const d=new oW(c,"max",!1);return n.runWebGLProgram(d,[a],a.dtype)}},ZV={kernelName:Tg,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a,output:o}=t,s=a;EU([a,o],"maxPoolBackprop");const{filterSize:l,strides:u,pad:c,dimRoundingMode:d}=r,h=g.computePool2DInfo(s.shape,l,u,1,c,d),f=new oW(h,"max",!0),p=n.runWebGLProgram(f,[s],s.dtype),m=new JH(h),v=n.runWebGLProgram(m,[i,p],s.dtype);return n.disposeIntermediateTensorInfo(p),v}},JV={kernelName:Ig,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:i}=e,{filterSize:a,strides:o,pad:s,includeBatchInIndex:l}=t,u=n;r.assert(4===i.shape.length,()=>`Error in maxPool: input must be rank 4 but got rank ${i.shape.length}.`);const c=[1,1];r.assert(g.eitherStridesOrDilationsAreOne(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const d=g.computePool2DInfo(i.shape,a,o,c,s),[h,f]=function(e,t,n,r){let i=new oW(n,"max",!1);const a=r.runWebGLProgram(i,[e],"float32");return i=new oW(n,"max",!0,!0,t),[a,r.runWebGLProgram(i,[e],"float32")]}(i,l,d,u);return[h,f]}},QV={kernelName:Og,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:i}=e,{keepDims:a,axis:o}=t,s=n,l=i.shape.length,u=r.parseAxisParam(o,i.shape);let c=u;const d=g.getAxesPermutation(c,l),h=null!=d,f=s.shouldExecuteOnCPU([i]),p=[];let m=i;if(h){if(f){const e=s.texData.get(m.dataId).values,t=new Array(l);for(let r=0;r<t.length;r++)t[r]=i.shape[d[r]];const n=LU(e,i.shape,i.dtype,d,t);m=s.makeTensorInfo(t,i.dtype),s.texData.get(m.dataId).values=n}else m=YV(i,d,s);p.push(m),c=g.getInnerMostAxes(c.length,l)}g.assertAxesAreInnerMostDims("sum",c,l);const[v,y]=g.computeOutAndReduceShapes(m.shape,c);let b=v;a&&(b=g.expandShapeToKeepDim(v,u));const x=function(e,t,n,i){const a=r.sizeFromShape(t),o=CV({inputs:{x:e},attrs:{shape:[r.sizeFromShape(e.shape)/a,a]},backend:i}),s=VV(o,"float32","mean",i),l=CV({inputs:{x:s},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(o),i.disposeIntermediateTensorInfo(s),l}(m,y,b,s);for(const r of p)s.disposeIntermediateTensorInfo(r);return x}};class eq{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,i=nH(r),a=t.map(e=>e[0]).join(","),o=t.map((t,n)=>t[0]+e[n]).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l="reflect"===n?0:1;this.userCode=1!==r?`\n      ${i} start = ${i}(${a});\n      ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outC = getOutputCoords();\n        for (int i = 0; i < ${r}; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ${l};\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};\n          }\n        }\n        ${i} coords = outC - start;\n        setOutput(getX(${s}));\n      }\n    `:`\n        int start = ${a};\n        int end = ${o};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ${l};\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ${l};\n          }\n          setOutput(getX(outC - start));\n        }\n      `}}class tq{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,i=nH(r),a=t.map(e=>e[0]).join(","),o=t.map((t,n)=>t[0]+e[n]).join(","),s=WU("rc",r),l=WU("source",r),u=`${s[r-1]} < ${this.outputShape[r-1]}`,c=1===r?"source":`vec2(${l.slice(-2).join()})`,d="reflect"===n?0:1;let h="";if(1===r){const e=`\n        ${i} source = rc;\n        if (source < start) {\n          source = start * 2 - source - ${d};\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ${d};\n        }\n        source -= start;\n      `;h=`\n        ${i} rc = outputLoc;\n        ${e}\n        result[0] = getChannel(getX(${l.join()}), ${c});\n        ${s[r-1]} += 1;\n        if(${u}) {\n          ${e}\n          result[1] = getChannel(getX(${l.join()}), ${c});\n        }\n      `}else{const e=`\n        ${i} source = rc;\n        ${i} lt = ${i}(lessThan(source, start));\n        ${i} gte = ${i}(greaterThanEqual(source, end));\n        ${i} orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ${d}) +\n                gte * ((end - 1) * 2 - source + ${d});\n        source -= start;\n      `;h=`\n        ${i} rc = outputLoc;\n        ${e}\n        result[0] = getChannel(getX(${l.join()}), ${c});\n        ${s[r-1]} += 1;\n        if(${u}) {\n          ${e}\n          result[1] = getChannel(getX(${l.join()}), ${c});\n        }\n        rc = outputLoc;\n        ${s[r-2]} += 1;\n        if(${s[r-2]} < ${this.outputShape[r-2]}) {\n          ${e}\n          result[2] = getChannel(getX(${l.join()}), ${c});\n          ${s[r-1]} += 1;\n          if(${u}) {\n            ${e}\n            result[3] = getChannel(getX(${l.join()}), ${c});\n          }\n        }\n      `}this.userCode=`\n      const ${i} start = ${i}(${a});\n      const ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${h}\n        setOutput(result);\n      }\n    `}}const nq={kernelName:Mg,backendName:"webgl",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r}=e,{paddings:i,mode:a}=n,o=Gp().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new tq(r.shape,i,a):new eq(r.shape,i,a);return t.runWebGLProgram(o,[r],r.dtype)}};class rq{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=g.assertAndGetBroadcastShape(t,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${e}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}const iq="return a * b;",aq={kernelName:jg,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{a:r,b:i}=t,a=g.upcastType(r.dtype,i.dtype);if("complex64"===r.dtype){const e=n.texData.get(r.dataId),t=n.texData.get(i.dataId),a=new rq("return areal * breal - aimag * bimag;",r.shape,i.shape),o=new rq("return areal * bimag + aimag * breal;",r.shape,i.shape),s=[{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:r.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:i.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:i.shape}],l=n.runWebGLProgram(a,s,"float32"),u=n.runWebGLProgram(o,s,"float32"),c=rV({inputs:{real:l,imag:u},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),c}if(n.shouldExecuteOnCPU([r,i])){const e=n.texData.get(r.dataId),t=n.texData.get(i.dataId),[o,s]=jU(r.shape,i.shape,e.values,t.values,a),l=n.makeTensorInfo(s,a);return n.texData.get(l.dataId).values=o,l}let o;return o=Gp().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new dH(iq,r.shape,i.shape):new uH(iq,r.shape,i.shape),n.runWebGLProgram(o,[r,i],a)}},oq={kernelName:Fg,backendName:"webgl",kernelFunc:({inputs:e,backend:t,attrs:n})=>{g.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{boxes:r,scores:i}=e,{maxOutputSize:a,iouThreshold:o,scoreThreshold:s}=n,l=t,u=l.readSync(r.dataId),c=l.readSync(i.dataId);return v.nonMaxSuppressionV3Impl(u,c,a,o,s)}},sq=v.nonMaxSuppressionV4Impl,lq={kernelName:Lg,backendName:"webgl",kernelFunc:({inputs:e,backend:t,attrs:n})=>{g.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{boxes:r,scores:i}=e,{maxOutputSize:a,iouThreshold:o,scoreThreshold:s,padToMaxOutputSize:l}=n,u=t,c=u.readSync(r.dataId),d=u.readSync(i.dataId),{selectedIndices:h,validOutputs:f}=sq(c,d,a,o,s,l);return[h,f]}},uq=v.nonMaxSuppressionV5Impl,cq={kernelName:$g,backendName:"webgl",kernelFunc:({inputs:e,backend:t,attrs:n})=>{g.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{boxes:r,scores:i}=e,{maxOutputSize:a,iouThreshold:o,scoreThreshold:s,softNmsSigma:l}=n,u=t,c=u.readSync(r.dataId),d=u.readSync(i.dataId),h=a,f=o,p=s,m=l,{selectedIndices:v,selectedScores:y}=uq(c,d,h,f,p,m);return[v,y]}};class dq{constructor(e,t,n,r){this.variableNames=["Image"],this.outputShape=[];const i=e[1],a=e[2],o=Math.sin(t).toFixed(3),s=Math.cos(t).toFixed(3);this.outputShape=e;const[l,u]=g.getImageCenter(r,i,a),c=l.toFixed(3),d=u.toFixed(3);let h="";h="number"==typeof n?`float outputValue = ${n.toFixed(2)};`:`\n        vec3 fill = vec3(${n.join(",")});\n        float outputValue = fill[coords[3]];`,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - ${c}) * ${s} - (float(y) - ${d}) * ${o};\n          float coordYFloat = (float(x) - ${c}) * ${o} + (float(y) - ${d}) * ${s};\n          int coordX = int(round(coordXFloat + ${c}));\n          int coordY = int(round(coordYFloat + ${d}));\n          ${h}\n          if(coordX >= 0 && coordX < ${a} && coordY >= 0 && coordY < ${i}) {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}const hq={kernelName:Pv,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,{radians:i,fillValue:a,center:o}=t,s=n,l=new dq(r.shape,i,a,o);return s.runWebGLProgram(l,[r],r.dtype)}},fq=aV("if (isnan(x)) return x;\n  return sin(x);\n"),pq={kernelName:cv,backendName:"webgl",kernelFunc:fq},mq=aV("return x * x;"),gq={kernelName:wv,backendName:"webgl",kernelFunc:mq},vq="return (a - b) * (a - b);",yq=oV({opSnippet:vq,packedOpSnippet:vq}),bq={kernelName:xv,backendName:"webgl",kernelFunc:yq},xq="return a - b;",wq=oV({opSnippet:xq,packedOpSnippet:xq,supportsComplex:!0,cpuKernelImpl:FU}),_q={kernelName:_v,backendName:"webgl",kernelFunc:wq},Sq=aV("return tan(x);"),Eq=[uV,dV,hV,fV,gV,wV,iV,OV,DV,NV,PV,LV,zV,nV,HV,kV,XV,KV,ZV,JV,QV,nq,aq,oq,lq,cq,yV,xV,IV,hq,pq,gq,_q,bq,{kernelName:Tv,backendName:"webgl",kernelFunc:Sq},{kernelName:Ov,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{perm:i}=t,a=n,o=new Array(r.shape.length);for(let l=0;l<o.length;l++)o[l]=r.shape[i[l]];let s;if(a.shouldExecuteOnCPU([r])){const e=a.texData.get(r.dataId),t=LU(e.values,r.shape,r.dtype,i,o);s=a.makeTensorInfo(o,r.dtype),a.texData.get(s.dataId).values=t}else s=YV(r,i,a);return s}},{kernelName:Av,backendName:"webgl",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{axis:i}=n,{x:a}=t;EU(a,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=r.readSync(a.dataId),{outputValues:s,outputShape:l,indices:u}=$U(o,i,a.shape,a.dtype);return[r.makeTensorInfo(l,a.dtype,s),r.makeTensorInfo([u.length],"int32",u)]}}];for(const iBe of Eq)Vv(iBe);const Tq={"tfjs-core":Hx,"tfjs-backend-cpu":"2.7.0","tfjs-backend-webgl":"2.7.0","tfjs-data":vL,"tfjs-layers":PD,"tfjs-converter":hF,tfjs:"2.7.0"};var kq,Cq;let Iq;!function(e){e[e.float32=0]="float32",e[e.int32=1]="int32",e[e.bool=2]="bool",e[e.string=3]="string",e[e.complex64=4]="complex64"}(kq||(kq={})),function(e){e[e.linear=0]="linear",e[e.relu=1]="relu",e[e.relu6=2]="relu6",e[e.prelu=3]="prelu"}(Cq||(Cq={}));const Oq={kernelName:Fv,backendName:"wasm",setupFunc:function(e){Iq=e.wasm.cwrap(Fv,null,["number","array","number","number","array","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:a,bias:o,preluActivationWeights:s}=t;if("float32"!==i.dtype||"float32"!==a.dtype)throw new Error("_FusedMatMul for non non-float32 tensors not yet supported.");const{transposeA:l,transposeB:u,activation:c}=r,d=n.dataIdMap.get(i.dataId).id,h=n.dataIdMap.get(a.dataId).id;let f=0;if(null!=o){const e=n.dataIdMap.get(o.dataId);if(1!==e.shape.length)throw new Error(`_FusedMatMul only supports rank-1 bias but got rank ${e.shape.length}.`);f=e.id}const p=null==s?0:n.dataIdMap.get(s.dataId).id,m=Cq[c];if(null==m)throw new Error(c+" activation not yet supported for FusedConv2D in the wasm backend.");const g=n.makeOutput([i.shape[0],l?i.shape[2]:i.shape[1],u?a.shape[1]:a.shape[2]],i.dtype),v=n.dataIdMap.get(g.dataId).id,y=new Uint8Array(new Int32Array(i.shape).buffer),b=new Uint8Array(new Int32Array(a.shape).buffer);return Iq(d,y,i.shape.length,h,b,a.shape.length,l,u,m,f,p,v),g}};function Aq(e){let t;return{kernelName:e,backendName:"wasm",setupFunc:function(n){t=n.wasm.cwrap(e,null,["number","number"])},kernelFunc:function(e){const{backend:n,inputs:{x:i}}=e,a=n.dataIdMap.get(i.dataId).id,o=n.makeOutput(i.shape,i.dtype),s=n.dataIdMap.get(o.dataId).id;return 0===r.sizeFromShape(o.shape)||t(a,s),o}}}const Dq=Aq(Jp);function Mq(e,t,n){let i;return{kernelName:e,backendName:"wasm",setupFunc:function(t){i=t.wasm.cwrap(e,null,["number","array","number","number","array","number","number","number"])},kernelFunc:function(a){const{backend:o,inputs:s}=a,{a:l,b:u}=s,c=o.dataIdMap.get(l.dataId).id,d=o.dataIdMap.get(u.dataId).id,h=null!=n?n:l.dtype,f=g.assertAndGetBroadcastShape(l.shape,u.shape),p=o.makeOutput(f,h);if(0===r.sizeFromShape(f))return p;const m=new Uint8Array(new Int32Array(l.shape).buffer),v=new Uint8Array(new Int32Array(u.shape).buffer),y=o.dataIdMap.get(p.dataId).id,b=()=>i(c,m,l.shape.length,d,v,u.shape.length,kq[l.dtype],y);if(t&&"float32"===l.dtype)return b(),p;const x=g.getBroadcastDims(l.shape,f),w=g.getBroadcastDims(u.shape,f),_=x.every((e,t)=>e===t),S=w.every((e,t)=>e===t);if(_&&S)return b(),p;throw new Error(`Broadcasting along outer dims is not yet supported for ${l.dtype} ${e}.`)}}}const Nq=Mq(tm,!0);let jq;const Rq={kernelName:nm,backendName:"wasm",setupFunc:function(e){jq=e.wasm.cwrap(nm,null,["array","number","number","number"])},kernelFunc:function(e){const{inputs:t,backend:n}=e,i=n.makeOutput(t[0].shape,t[0].dtype);if(0===r.sizeFromShape(i.shape))return i;const a=t.map(e=>n.dataIdMap.get(e.dataId).id),o=new Uint8Array(new Int32Array(a).buffer),s=n.dataIdMap.get(i.dataId).id;return jq(o,a.length,kq[i.dtype],s),i}};function Pq(e){const{inputs:{x:t},backend:n}=e,r=n.makeOutput(t.shape,t.dtype),i=n.typedArrayFromHeap(t);return n.typedArrayFromHeap(r).set(i),r}const Fq={kernelName:ag,backendName:"wasm",kernelFunc:Pq};let Lq;function $q(e){const{inputs:t,backend:n,attrs:r}=e,[i,a]=function(e,t){const n=[],r=[];for(let i=0;i<e.length;++i)1!==e[i]&&n.push(e[i]),1!==e[t[i]]&&r.push(t[i]);for(let i=0;i<r.length;++i){let e=-1;for(let t=0;t<r.length;++t)r[t]>=i&&(-1===e||r[e]>r[t])&&(e=t);r[e]=i}return[n,r]}(t.x.shape,r.perm);let o=!0;for(let p=0;p<a.length;p++)a[p]!==p&&(o=!1);const s=function(e,t){const n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];return n}(t.x.shape,r.perm),l={dataId:t.x.dataId,shape:i,dtype:t.x.dtype};if(o){const e=Pq({inputs:t,backend:n});return e.shape=s,e}const u=n.makeOutput(s,l.dtype),c=n.dataIdMap.get(l.dataId).id,d=n.dataIdMap.get(u.dataId).id,h=new Uint8Array(new Int32Array(a).buffer),f=new Uint8Array(new Int32Array(l.shape).buffer);return Lq(c,f,l.shape.length,kq[l.dtype],d,h,a.length),u}const Bq={kernelName:Ov,backendName:"wasm",kernelFunc:$q,setupFunc:function(e){Lq=e.wasm.cwrap(Ov,null,["number","array","number","number","number","array","number"])}};function zq(e,t,n){const i=e.shape,a=e.shape.length,o=r.parseAxisParam(t,i);let s=o;const l=g.getAxesPermutation(s,a);let u=null,c=!1;if(null!=l){const t=new Array(a);for(let e=0;e<t.length;e++)t[e]=i[l[e]];s=g.getInnerMostAxes(s.length,a),u=$q({inputs:{x:e},attrs:{perm:l},backend:n});const r=n.dataIdMap.get(e.dataId).id;n.dataIdMap.get(u.dataId).id!==r&&(c=!0)}return{transposed:u,originalAxes:o,axes:s,inputWasTransposed:c}}let Uq;const Hq={kernelName:am,backendName:"wasm",kernelFunc:function(e){const{backend:t,inputs:n,attrs:i}=e,{axis:a}=i,{x:o}=n,s=t.dataIdMap.get(o.dataId).id;let l=s,u=o;const{transposed:c,axes:d,inputWasTransposed:h}=zq(o,a,t);if(h){const e=t.dataIdMap.get(c.dataId).id;e!==s&&(u=c,l=e)}const f=u.shape.slice(0,-1),p=t.makeOutput(f,"int32"),m=t.dataIdMap.get(p.dataId).id,g=r.sizeFromShape(p.shape);return Uq(l,kq[u.dtype],g,u.shape[d[0]],m),h&&t.disposeData(c.dataId),p},setupFunc:function(e){Uq=e.wasm.cwrap(am,null,["number","number","number","number","number"])}};let Wq;const Vq={kernelName:hm,backendName:"wasm",setupFunc:function(e){Wq=e.wasm.cwrap(hm,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,i=t.x,a=r.dataIdMap.get(i.dataId).id,{filterSize:o,strides:s,pad:l,dimRoundingMode:u}=n,c=g.computePool2DInfo(i.shape,o,s,1,l,u),d=c.filterHeight,h=c.filterWidth,f=c.padInfo.top,p=c.padInfo.right,m=c.padInfo.bottom,v=c.padInfo.left,y=c.strideHeight,b=c.strideWidth,x=c.inChannels;if("channelsLast"!==c.dataFormat)throw new Error("wasm backend does not support dataFormat:'"+c.dataFormat+"'. Please use 'channelsLast'.");if(1!==c.dilationWidth||1!==c.dilationHeight)throw new Error(`was backend only supports average pooling with dilation = [1, 1], got [${c.dilationHeight}, ${c.dilationWidth}].`);const w=r.makeOutput(c.outShape,"float32"),_=r.dataIdMap.get(w.dataId).id;return Wq(a,i.shape[0],i.shape[1],i.shape[2],d,h,f,p,m,v,y,b,x,_),w}};function qq(e){const{inputs:t,attrs:n}=e,{x:i}=t,{shape:a}=n,o=r.sizeFromShape(i.shape),s=r.inferFromImplicitShape(a,o);return r.assert(o===r.sizeFromShape(s),()=>`new shape: ${s}, old shape: ${i.shape}. New shape and old shape must have the same number of elements.`),{dataId:i.dataId,shape:s,dtype:i.dtype}}const Gq={kernelName:Zg,backendName:"wasm",kernelFunc:qq};let Yq;const Xq={kernelName:gm,backendName:"wasm",setupFunc:function(e){Yq=e.wasm.cwrap(gm,null,["number","array","number","number","array","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{a:a,b:o}=t,{transposeA:s,transposeB:l}=i;if("float32"!==a.dtype||"float32"!==o.dtype)throw new Error("BatchMatMul for non non-float32 tensors not yet supported.");const u=a.shape.length,c=o.shape.length,d=s?a.shape[u-2]:a.shape[u-1],h=l?o.shape[c-1]:o.shape[c-2],f=s?a.shape[u-1]:a.shape[u-2],p=l?o.shape[c-2]:o.shape[c-1],m=a.shape.slice(0,-2),g=o.shape.slice(0,-2),v=r.sizeFromShape(m),y=r.sizeFromShape(g);r.assert(u>=2&&c>=2&&(v===y||1===v||1===y),()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${m}) and (${g}).`);const b=(v>y?a.shape.slice(0,-2):o.shape.slice(0,-2)).concat([f,p]);r.assert(d===h,()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${a.shape} and ${o.shape} and transposeA=${s} and transposeB=${l} must match.`);const x=l?[y,p,h]:[y,h,p],w=qq({inputs:{x:a},backend:n,attrs:{shape:s?[v,d,f]:[v,f,d]}}),_=qq({inputs:{x:o},backend:n,attrs:{shape:x}}),S=n.dataIdMap.get(w.dataId).id,E=n.dataIdMap.get(_.dataId).id,T=s?w.shape[2]:w.shape[1],k=l?_.shape[1]:_.shape[2],C=Math.max(v,y),I=n.makeOutput([C,T,k],w.dtype),O=n.dataIdMap.get(I.dataId).id,A=new Uint8Array(new Int32Array(w.shape).buffer),D=new Uint8Array(new Int32Array(_.shape).buffer);return Yq(S,A,w.shape.length,E,D,_.shape.length,s,l,O),I.shape=b,I}};function Kq(e){const{inputs:{x:t},attrs:{dtype:n},backend:r}=e,i=r.makeOutput(t.shape,n),a=r.typedArrayFromHeap(t);return r.typedArrayFromHeap(i).set(a),i}const Zq={kernelName:bm,backendName:"wasm",kernelFunc:Kq};let Jq;const Qq={kernelName:wm,backendName:"wasm",setupFunc:function(e){Jq=e.wasm.cwrap(wm,null,["number","number","number","number"])},kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{clipValueMin:a,clipValueMax:o}=r,s=n.dataIdMap.get(i.dataId).id,l=n.makeOutput(i.shape,i.dtype),u=n.dataIdMap.get(l.dataId).id;return Jq(s,a,o,u),l}},eG={kernelName:Sm,backendName:"wasm",kernelFunc:function(e){const{inputs:t,backend:n}=e,i=r.parseAxisParam(e.attrs.axis,t[0].shape)[0],a=g.computeOutShape(t.map(e=>e.shape),i),o=n.makeOutput(a,t[0].dtype);if(0===r.sizeFromShape(a))return o;const s=t.filter(e=>r.sizeFromShape(e.shape)>0);if(1===s.length)return s[0];const l=s.map(e=>e.shape);g.assertParamsConsistent(l,i);const u=r.sizeFromShape(s[0].shape.slice(0,i));let c=0;const d=s.map(e=>{const t=r.sizeFromShape(e.shape.slice(i));return c+=t,t}),h=s.map(e=>n.typedArrayFromHeap(e)),f=n.typedArrayFromHeap(o);for(let r=0;r<u;r++){let e=r*c;for(let t=0;t<h.length;t++){const n=d[t],i=r*n,a=h[t].subarray(i,i+n);f.set(a,e),e+=n}}return o}};let tG;const nG={kernelName:Em,backendName:"wasm",setupFunc:function(e){tG=e.wasm.cwrap(Em,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{x:i,filter:a}=t,o=r.dataIdMap.get(i.dataId).id,s=r.dataIdMap.get(a.dataId).id,{strides:l,dilations:u,pad:c,dimRoundingMode:d,dataFormat:h}=n,f=g.convertConv2DDataFormat(h),p=g.computeConv2DInfo(i.shape,a.shape,l,u,c,d,!1,f),m=p.filterHeight,v=p.filterWidth,y=p.padInfo.top,b=p.padInfo.right,x=p.padInfo.bottom,w=p.padInfo.left,_=p.dilationHeight,S=p.dilationWidth,E=p.strideHeight,T=p.strideWidth,k=p.inChannels,C=p.outChannels,I="SAME"===p.padInfo.type?1:0;if("channelsLast"!==p.dataFormat)throw new Error("wasm backend Conv2D does not support dataFormat:'"+p.dataFormat+"'. Please use 'channelsLast'.");const O=r.makeOutput(p.outShape,"float32"),A=r.dataIdMap.get(O.dataId).id;return tG(o,i.shape[0],i.shape[1],i.shape[2],s,m,v,y,b,x,w,I,_,S,E,T,k,C,A),O}};let rG;const iG={kernelName:km,backendName:"wasm",setupFunc:function(e){rG=e.wasm.cwrap(km,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:i}=e,{dy:a,filter:o}=n,{strides:s,pad:l,dataFormat:u,dimRoundingMode:c,inputShape:d}=i,h=g.convertConv2DDataFormat(u),f=g.computeConv2DInfo(d,o.shape,s,1,l,c,!1,h),{batchSize:p,filterHeight:m,filterWidth:v,inChannels:y,inHeight:b,inWidth:x,outChannels:w,outHeight:_,outWidth:S,strideHeight:E,strideWidth:T}=f,k=m-1-f.padInfo.top,C=v-1-f.padInfo.left,I="channelsLast"===f.dataFormat,O=r.computeStrides(f.inShape),A=r.computeStrides(a.shape),[D,M,N]=r.computeStrides(o.shape),j=O[0],R=I?O[1]:O[2],P=I?O[2]:1,F=I?1:O[1],L=A[0],$=I?A[1]:A[2],B=I?A[2]:1,z=I?1:A[1],U=t.makeOutput(f.inShape,"float32"),H=t.dataIdMap.get(U.dataId).id,W=t.dataIdMap.get(a.dataId).id,V=t.dataIdMap.get(o.dataId).id;return rG(W,V,p,m,v,b,x,y,_,S,w,E,T,k,C,D,M,N,j,R,P,F,L,$,B,z,H),U}},aG=Aq(Am);var oG;let sG,lG,uG,cG,dG,hG,fG,pG,mG,gG,vG,yG,bG,xG,wG,_G,SG,EG,TG,kG,CG,IG,OG,AG,DG,MG,NG,jG,RG;function PG(e,t){const n=new Int32Array(e.wasm.HEAPU8.buffer,t,4),r=n[0],i=n[1],a=n[2],o=n[3];return e.wasm._free(t),{pSelectedIndices:r,selectedSize:i,pSelectedScores:a,pValidOutputs:o}}function FG(e){const{inputs:{x:t},attrs:{begin:n,size:i},backend:a}=e,[o,s]=d.parseSliceParams(t,n,i),l=d.isSliceContinous(t.shape,o,s),u=a.typedArrayFromHeap(t),c=a.makeOutput(s,t.dtype),h=a.typedArrayFromHeap(c),f=r.computeStrides(t.shape);if(l){const e=d.computeFlatOffset(o,f);return h.set(u.subarray(e,e+r.sizeFromShape(s))),c}const p=t.shape.length;return 2===p?function(e,t,n,r,i){let a=0;const o=r[0],s=r[1],l=o+i[0];for(let u=o;u<l;u++){const r=u*t+s;n.set(e.subarray(r,r+i[1]),a),a+=i[1]}}(u,f[0],h,o,s):3===p?function(e,t,n,r,i,a){let o=0;const s=i[0],l=i[1],u=i[2],c=s+a[0],d=l+a[1];for(let h=s;h<c;h++)for(let i=l;i<d;i++){const s=h*t+i*n+u;r.set(e.subarray(s,s+a[2]),o),o+=a[2]}}(u,f[0],f[1],h,o,s):4===p?function(e,t,n,r,i,a,o){let s=0;const l=a[0],u=a[1],c=a[2],d=l+o[0],h=u+o[1],f=c+o[2],p=a[3];for(let m=l;m<d;m++)for(let a=u;a<h;a++)for(let l=c;l<f;l++){const u=m*t+a*n+l*r+p;i.set(e.subarray(u,u+o[3]),s),s+=o[3]}}(u,f[0],f[1],f[2],h,o,s):function(e,t,n,r,i){const a=Rb(i,t.dtype,n),o=Rb(t.shape,t.dtype,e);for(let s=0;s<a.size;++s){const e=a.indexToLoc(s).map((e,t)=>e+r[t]);n[s]=o.get(...e)}}(u,t,h,o,s),c}!function(e){e[e.bilinear=0]="bilinear",e[e.nearest=1]="nearest"}(oG||(oG={}));const LG=[Dq,Nq,Rq,Hq,Vq,Xq,Zq,Qq,eG,nG,iG,aG,{kernelName:Nm,backendName:"wasm",setupFunc:function(e){sG=e.wasm.cwrap(Nm,null,["number","number","number","number","array","number","number","number","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{method:i,extrapolationValue:a,cropSize:o}=r,{image:s,boxes:l,boxInd:u}=n,c=l.shape[0],[d,h]=o,f=[c,d,h,s.shape[3]];let p,m=t.dataIdMap.get(s.dataId);"float32"!==s.dtype&&(p=Kq({backend:t,inputs:{x:s},attrs:{dtype:"float32"}}),m=t.dataIdMap.get(p.dataId));const g=m.id,v=t.dataIdMap.get(l.dataId).id,y=t.dataIdMap.get(u.dataId).id,b=t.makeOutput(f,"float32"),x=t.dataIdMap.get(b.dataId).id,w=new Uint8Array(new Int32Array(s.shape).buffer);return sG(g,v,y,c,w,d,h,oG[i],a,x),null!=p&&t.disposeData(p.dataId),b}},{kernelName:Mm,backendName:"wasm",setupFunc:function(e){lG=e.wasm.cwrap(Mm,null,["number","number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:a}=t,{axis:o,exclusive:s,reverse:l}=i,u=a.shape.length;r.assert("float32"===a.dtype||"int32"===a.dtype,()=>`cumsum does not support ${a.dtype} tensors in the WASM backend`);const c=g.getAxesPermutation([o],u);let d=a;null!==c&&(d=$q({inputs:{x:a},attrs:{perm:c},backend:n}));const h=g.getInnerMostAxes(1,u)[0];g.assertAxesAreInnerMostDims("cumsum",[h],u);const f=n.makeOutput(d.shape,d.dtype),p=d.shape[h],m=n.dataIdMap.get(d.dataId).id,v=n.dataIdMap.get(f.dataId).id;lG(m,s?1:0,l?1:0,p,v,kq[a.dtype]);let y=f;return null!==c&&(y=$q({inputs:{x:f},attrs:{perm:g.getUndoAxesPermutation(c)},backend:n}),n.disposeData(d.dataId),n.disposeData(f.dataId)),y}},{kernelName:jm,backendName:"wasm",setupFunc:function(e){uG=e.wasm.cwrap(jm,null,["number","number","number","array","number","array","array","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:i}=e,{x:a}=n,{blockSize:o,dataFormat:s}=i;r.assert(o>1,()=>"blockSize should be > 1 for depthToSpace, but was: "+o);const l=a.shape[0],u=("NHWC"===s?a.shape[1]:a.shape[2])*o,c=("NHWC"===s?a.shape[2]:a.shape[3])*o,d=("NHWC"===s?a.shape[3]:a.shape[1])/(o*o),h="NHWC"===s?[l,u,c,d]:[l,d,u,c],f=t.makeOutput(h,"float32"),p=t.dataIdMap.get(a.dataId).id,m=new Uint8Array(new Int32Array(r.computeStrides(a.shape)).buffer),g=new Uint8Array(new Int32Array(h).buffer),v=new Uint8Array(new Int32Array(r.computeStrides(h)).buffer),y=t.dataIdMap.get(f.dataId).id;return uG(p,o,"NHWC"===s?1:0,m,a.shape.length-1,g,v,h.length,y),f}},{kernelName:Rm,backendName:"wasm",setupFunc:function(e){cG=e.wasm.cwrap(Rm,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{x:i,filter:a}=t,o=r.dataIdMap.get(i.dataId).id,s=r.dataIdMap.get(a.dataId).id,{strides:l,dilations:u,pad:c,dimRoundingMode:d}=n,h=g.computeConv2DInfo(i.shape,a.shape,l,null==u?[1,1]:u,c,d,!0),f=h.filterHeight,p=h.filterWidth,m=h.padInfo.top,v=h.padInfo.right,y=h.padInfo.bottom,b=h.padInfo.left,x=h.dilationHeight,w=h.dilationWidth,_=h.strideHeight,S=h.strideWidth,E=h.inChannels,T=h.outChannels,k="SAME"===h.padInfo.type?1:0;if("channelsLast"!==h.dataFormat)throw new Error("wasm backend DepthwiseConv2dNative does not support dataFormat:'"+h.dataFormat+"'. Please use 'channelsLast'.");const C=r.makeOutput(h.outShape,"float32"),I=r.dataIdMap.get(C.dataId).id;return cG(o,i.shape[0],i.shape[1],i.shape[2],s,f,p,m,v,y,b,k,x,w,_,S,E,T,I),C}},Mq(Um,!0),Mq(qm,!1,"bool"),Aq(Gm),{kernelName:Km,backendName:"wasm",kernelFunc:function(e){const{attrs:{shape:t,value:n,dtype:r},backend:i}=e,a=i.makeOutput(t,r);return i.typedArrayFromHeap(a).fill(n),a}},{kernelName:Zm,backendName:"wasm",kernelFunc:function(e){const{inputs:t,backend:n}=e,{image:r}=t,i=n.makeOutput(r.shape,r.dtype),a=n.dataIdMap.get(r.dataId).id,o=n.dataIdMap.get(i.dataId).id,[s,l,u,c]=r.shape;return dG(a,s,l,u,c,o),i},setupFunc:function(e){dG=e.wasm.cwrap(Zm,null,["number","number","number","number","number","number"])}},Mq(Qm,!1),Oq,{kernelName:eg,backendName:"wasm",setupFunc:function(e){hG=e.wasm.cwrap(eg,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:i}=e,{varianceEpsilon:a}=i,{x:o,mean:s,variance:l,offset:u,scale:c}=n,d=t.dataIdMap.get(o.dataId).id,h=t.dataIdMap.get(s.dataId).id,f=t.dataIdMap.get(l.dataId).id,p=null!=u?t.dataIdMap.get(u.dataId).id:0,m=null!=c?t.dataIdMap.get(c.dataId).id:0,g=t.makeOutput(o.shape,o.dtype);if(0===r.sizeFromShape(o.shape))return g;const v=t.dataIdMap.get(g.dataId).id;return hG(d,h,f,p,m,a,v),g}},{kernelName:Lv,backendName:"wasm",setupFunc:function(e){fG=e.wasm.cwrap(Lv,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{x:i,filter:a,bias:o,preluActivationWeights:s}=t,{strides:l,pad:u,dilations:c,dataFormat:d,dimRoundingMode:h,activation:f}=n,p=g.computeConv2DInfo(i.shape,a.shape,l,c,u,h),m=Cq[f];if(null==m)throw new Error(f+" activation not yet supported for FusedConv2D in the wasm backend.");const v=r.dataIdMap.get(i.dataId).id,y=r.dataIdMap.get(a.dataId).id,b=p.outChannels;let x=0;if(null!=o){const e=r.dataIdMap.get(o.dataId);if(1!==e.shape.length)throw new Error(`FusedConv2D only supports rank-1 bias but got rank ${e.shape.length}.`);if(e.shape[0]!==b)throw new Error(`FusedConv2D bias shape (${e.shape}) does not match the number of output channels (${b})`);x=e.id}const w=p.filterHeight,_=p.filterWidth,S=p.padInfo.top,E=p.padInfo.right,T=p.padInfo.bottom,k=p.padInfo.left,C=p.dilationHeight,I=p.dilationWidth,O=p.strideHeight,A=p.strideWidth,D=p.inChannels,M="SAME"===p.padInfo.type?1:0,N=p.batchSize,j=p.inHeight,R=p.inWidth;if("NHWC"!==d)throw new Error("wasm backend FusedConv2D does not support dataFormat:'"+d+"'. Please use 'NHWC'.");const P=r.makeOutput(p.outShape,"float32"),F=r.dataIdMap.get(P.dataId).id,L=null==s?0:r.dataIdMap.get(s.dataId).id;return fG(v,N,j,R,y,w,_,x,S,E,T,k,M,C,I,O,A,D,b,m,L,F),P}},{kernelName:$v,backendName:"wasm",setupFunc:function(e){pG=e.wasm.cwrap($v,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{x:i,filter:a,bias:o,preluActivationWeights:s}=t,{strides:l,pad:u,dilations:c,dataFormat:d,dimRoundingMode:h,activation:f}=n,p=g.computeConv2DInfo(i.shape,a.shape,l,c,u,h,!0),m=Cq[f];if(null==m)throw new Error(f+" activation not yet supported for FusedDepthwiseConv2D in the wasm backend.");const v=r.dataIdMap.get(i.dataId).id,y=r.dataIdMap.get(a.dataId).id,b=p.outChannels;let x=0;if(null!=o){const e=r.dataIdMap.get(o.dataId);if(1!==e.shape.length)throw new Error(`FusedDepthwiseConv2D only supports rank-1 bias but got rank ${e.shape.length}.`);if(e.shape[0]!==b)throw new Error(`FusedDepthwiseConv2D bias shape (${e.shape}) does not match the number of output channels (${b})`);x=e.id}const w=p.filterHeight,_=p.filterWidth,S=p.padInfo.top,E=p.padInfo.right,T=p.padInfo.bottom,k=p.padInfo.left,C=p.dilationHeight,I=p.dilationWidth,O=p.strideHeight,A=p.strideWidth,D=p.inChannels,M="SAME"===p.padInfo.type?1:0,N=p.batchSize,j=p.inHeight,R=p.inWidth;if("NHWC"!==d)throw new Error("wasm backend FusedDepthwiseConv2D does not support dataFormat:'"+d+"'. Please use 'NHWC'.");const P=r.makeOutput(p.outShape,"float32"),F=r.dataIdMap.get(P.dataId).id,L=null==s?0:r.dataIdMap.get(s.dataId).id;return pG(v,N,j,R,y,w,_,x,S,E,T,k,M,C,I,O,A,D,b,m,L,F),P}},{kernelName:ng,backendName:"wasm",setupFunc:function(e){mG=e.wasm.cwrap(ng,null,["number","number","number","number","number","number","array","number"])},kernelFunc:function(e){const{backend:t,inputs:n}=e,{params:r,indices:i}=n,[a,o,s,l]=u.prepareAndValidate(r,i),c=t.makeOutput(a,r.dtype);if(0===o)return c;const d=i.shape,h=d[d.length-1],f=t.dataIdMap.get(r.dataId).id,p=t.dataIdMap.get(i.dataId).id,m=new Uint8Array(new Int32Array(l).buffer),g=t.dataIdMap.get(c.dataId).id;return mG(f,kq[r.dtype],p,o,h,s,m,g),c}},{kernelName:tg,backendName:"wasm",setupFunc:function(e){gG=e.wasm.cwrap("Gather",null,["number","number","array","number","number","number","array","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:i}=e,{x:a,indices:o}=n,{axis:s}=i,l=a.shape.slice();l[s]=r.sizeFromShape(o.shape);const u=a.shape.length-1,c=t.makeOutput(l,a.dtype);if(0===r.sizeFromShape(a.shape))return c;const d=t.dataIdMap.get(a.dataId).id,h=t.dataIdMap.get(o.dataId).id,f=t.dataIdMap.get(c.dataId).id,p=new Uint8Array(new Int32Array(r.computeStrides(a.shape)).buffer),m=new Uint8Array(new Int32Array(r.computeStrides(l)).buffer);gG(d,kq[a.dtype],p,u,h,s,m,f);const v=r.parseAxisParam(s,a.shape)[0],y=g.segment_util.collectGatherOpShapeInfo(a,o,v);return c.shape=y.outputShape,c}},Mq(rg,!1,"bool"),Mq(ig,!1,"bool"),Fq,Mq(dg,!1,"bool"),Mq(hg,!1,"bool"),Aq(pg),Mq(gg,!1,"bool"),{kernelName:_g,backendName:"wasm",setupFunc:function(e){vG=e.wasm.cwrap(_g,null,["number, number, number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:i}=e,{reductionIndices:a,keepDims:o}=i,{x:s}=n;let l=t.dataIdMap.get(s.dataId).id,u=s;const{transposed:c,axes:d,originalAxes:h,inputWasTransposed:f}=zq(s,a,t);f&&(u=c,l=t.dataIdMap.get(c.dataId).id),g.assertAxesAreInnerMostDims("max",d,u.shape.length);const[p,m]=g.computeOutAndReduceShapes(u.shape,d),v=r.sizeFromShape(m),y=t.makeOutput(p,s.dtype);if(0!==r.sizeFromShape(u.shape)){const e=t.dataIdMap.get(y.dataId).id;vG(l,v,e)}if(f&&t.disposeData(c.dataId),o){const e=g.expandShapeToKeepDim(y.shape,h);y.shape=e}return y}},Mq(Sg,!1),{kernelName:Eg,backendName:"wasm",setupFunc:function(e){yG=e.wasm.cwrap(Eg,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,i=t.x,a=r.dataIdMap.get(i.dataId).id,{filterSize:o,strides:s,pad:l,dimRoundingMode:u}=n,c=g.computePool2DInfo(i.shape,o,s,1,l,u),d=c.filterHeight,h=c.filterWidth,f=c.padInfo.top,p=c.padInfo.right,m=c.padInfo.bottom,v=c.padInfo.left,y=c.dilationHeight,b=c.dilationWidth,x=c.strideHeight,w=c.strideWidth,_=c.inChannels,S=c.outChannels;if("channelsLast"!==c.dataFormat)throw new Error("wasm backend does not support dataFormat:'"+c.dataFormat+"'. Please use 'channelsLast'.");const E=r.makeOutput(c.outShape,"float32"),T=r.dataIdMap.get(E.dataId).id;return yG(a,i.shape[0],i.shape[1],i.shape[2],d,h,f,p,m,v,y,b,x,w,_,S,T),E}},{kernelName:Ag,backendName:"wasm",setupFunc:function(e){bG=e.wasm.cwrap(Ag,null,["number, number, number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:i}=e,{axis:a,keepDims:o}=i,{x:s}=n,l=t.dataIdMap.get(s.dataId).id;let u=l,c=s;const{transposed:d,axes:h,originalAxes:f,inputWasTransposed:p}=zq(s,a,t);if(p){const e=t.dataIdMap.get(d.dataId).id;e!==l&&(c=d,u=e)}g.assertAxesAreInnerMostDims("min",h,c.shape.length);const[m,v]=g.computeOutAndReduceShapes(c.shape,h),y=r.sizeFromShape(v),b=t.makeOutput(m,c.dtype);if(0!==r.sizeFromShape(c.shape)){const e=t.dataIdMap.get(b.dataId).id;bG(u,y,e)}if(p&&t.disposeData(d.dataId),o){const e=g.expandShapeToKeepDim(b.shape,f);b.shape=e}return b}},Mq(Dg,!1),Mq(jg,!0),Aq(Rg),{kernelName:Fg,backendName:"wasm",setupFunc:function(e){xG=e.wasm.cwrap(Fg,"number",["number","number","number","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{iouThreshold:i,maxOutputSize:a,scoreThreshold:o}=r,{boxes:s,scores:l}=n,u=t.dataIdMap.get(s.dataId).id,c=t.dataIdMap.get(l.dataId).id,d=xG(u,c,a,i,o),{pSelectedIndices:h,selectedSize:f,pSelectedScores:p,pValidOutputs:m}=PG(t,d);return t.wasm._free(p),t.wasm._free(m),t.makeOutput([f],"int32",h)}},{kernelName:Lg,backendName:"wasm",setupFunc:function(e){wG=e.wasm.cwrap(Lg,"number",["number","number","number","number","number","bool"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{iouThreshold:i,maxOutputSize:a,scoreThreshold:o,padToMaxOutputSize:s}=r,{boxes:l,scores:u}=n,c=t.dataIdMap.get(l.dataId).id,d=t.dataIdMap.get(u.dataId).id,h=wG(c,d,a,i,o,s),{pSelectedIndices:f,selectedSize:p,pSelectedScores:m,pValidOutputs:g}=PG(t,h);return t.wasm._free(m),[t.makeOutput([p],"int32",f),t.makeOutput([],"int32",g)]}},{kernelName:$g,backendName:"wasm",setupFunc:function(e){_G=e.wasm.cwrap($g,"number",["number","number","number","number","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{iouThreshold:i,maxOutputSize:a,scoreThreshold:o,softNmsSigma:s}=r,{boxes:l,scores:u}=n,c=t.dataIdMap.get(l.dataId).id,d=t.dataIdMap.get(u.dataId).id,h=_G(c,d,a,i,o,s),{pSelectedIndices:f,selectedSize:p,pSelectedScores:m,pValidOutputs:g}=PG(t,h);return t.wasm._free(g),[t.makeOutput([p],"int32",f),t.makeOutput([p],"float32",m)]}},Mq(Pg,!1,"bool"),{kernelName:zg,backendName:"wasm",setupFunc:function(e){SG=e.wasm.cwrap(zg,null,["number","number","number","number","number"])},kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i}=t,{depth:a,onValue:o,offValue:s}=r,l=n.makeOutput([...i.shape,a],"int32"),u=n.dataIdMap.get(l.dataId).id,c=n.dataIdMap.get(i.dataId);return SG(c.id,a,o,s,u),l}},{kernelName:Bg,backendName:"wasm",kernelFunc:function(e){const{inputs:{x:t},backend:n}=e,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(1),r}},{kernelName:Ug,backendName:"wasm",kernelFunc:function(e){const{inputs:{x:t},backend:n,attrs:{paddings:r,constantValue:i}}=e,a=r.map((e,n)=>e[0]+t.shape[n]+e[1]),o=n.dataIdMap.get(t.dataId).id,s=n.makeOutput(a,t.dtype),l=n.dataIdMap.get(s.dataId).id,u=new Uint8Array(new Int32Array(t.shape).buffer),c=r.map(e=>e[0]),d=r.map(e=>e[1]),h=new Uint8Array(new Int32Array(c).buffer),f=new Uint8Array(new Int32Array(d).buffer);return EG(o,u,t.shape.length,kq[t.dtype],h,f,i,l),s},setupFunc:function(e){EG=e.wasm.cwrap(Ug,null,["number","array","number","number","array","array","number","number"])}},Mq(Wg,!1),{kernelName:Vg,backendName:"wasm",setupFunc:function(e){TG=e.wasm.cwrap(Vg,null,["number","number","number"])},kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r,alpha:i}=t,a=n.dataIdMap.get(r.dataId).id,o=n.dataIdMap.get(i.dataId).id,s=n.makeOutput(r.shape,"float32"),l=n.dataIdMap.get(s.dataId).id;return TG(a,o,l),s}},Aq(Kg),Aq(nv),Gq,{kernelName:ev,backendName:"wasm",setupFunc:function(e){kG=e.wasm.cwrap(ev,null,["number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:i}=e,{images:a}=n,{alignCorners:o,size:s}=i,[l,u]=s,[c,d,h,f]=a.shape,p=[c,l,u,f];let m,g=t.dataIdMap.get(a.dataId);"float32"!==g.dtype&&(m=Kq({backend:t,inputs:{x:a},attrs:{dtype:"float32"}}),g=t.dataIdMap.get(m.dataId));const v=g.id,y=t.makeOutput(p,"float32");if(0===r.sizeFromShape(a.shape))return y;const b=t.dataIdMap.get(y.dataId).id;return kG(v,c,d,h,f,l,u,o?1:0,b),null!=m&&t.disposeData(m.dataId),y}},{kernelName:rv,backendName:"wasm",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:a}=t,{dims:o}=i,s=r.parseAxisParam(o,a.shape);if(0===a.shape.length)return Pq({inputs:{x:a},backend:n});const l=n.makeOutput(a.shape,a.dtype),u=n.dataIdMap.get(a.dataId).id,c=n.dataIdMap.get(l.dataId).id,d=new Uint8Array(new Int32Array(s).buffer),h=new Uint8Array(new Int32Array(a.shape).buffer);return CG(u,d,s.length,h,a.shape.length,c),qq({inputs:{x:l},attrs:{shape:a.shape},backend:n})},setupFunc:function(e){CG=e.wasm.cwrap(rv,null,["number","array","number","array","number","number"])}},{kernelName:Pv,backendName:"wasm",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:i}=t,{radians:a,fillValue:o,center:s}=r,l=n.makeOutput(i.shape,i.dtype),u=n.dataIdMap.get(i.dataId).id,c=n.dataIdMap.get(l.dataId).id,[d,h,f,p]=i.shape,[m,v]=g.getImageCenter(s,h,f),y="number"==typeof o?[o,o,o,0===o?0:255]:[...o,255],b=new Uint8Array(new Int32Array(y).buffer);return IG(u,d,h,f,p,a,m,v,b,y.length,c),l},setupFunc:function(e){IG=e.wasm.cwrap(Pv,null,["number","number","number","number","number","number","number","number","array","number","number"])}},Aq(av),{kernelName:ov,backendName:"wasm",setupFunc:function(e){OG=e.wasm.cwrap(ov,null,["number","number","number","number","number","number","array","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:i}=e,{indices:a,updates:o}=n,{shape:s}=i,l=t.makeOutput(s,o.dtype);if(0===r.sizeFromShape(s))return l;const{sliceRank:u,numUpdates:d,sliceSize:h,strides:f,outputSize:p}=c.calculateShapes(o,a,s),m=t.dataIdMap.get(a.dataId).id,g=t.dataIdMap.get(o.dataId).id,v=new Uint8Array(new Int32Array(f).buffer),y=t.dataIdMap.get(l.dataId).id;return OG(m,g,kq[o.dtype],u,d,h,v,p,y),l}},{kernelName:sv,backendName:"wasm",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:i,t:a,e:o}=t,s=n.dataIdMap.get(i.dataId).id,l=n.dataIdMap.get(a.dataId).id,u=n.dataIdMap.get(o.dataId).id,c=n.makeOutput(a.shape,a.dtype),d=n.dataIdMap.get(c.dataId).id,h=i.shape.length,f=0===h||h>1||1===a.shape.length?1:r.sizeFromShape(a.shape.slice(1));return AG(s,l,u,f,d),c},setupFunc:function(e){AG=e.wasm.cwrap(sv,null,["number","number","number","number","number"])}},{kernelName:"Sigmoid",backendName:"wasm",setupFunc:function(e){DG=e.wasm.cwrap(fv,null,["number","number"])},kernelFunc:function(e){const{backend:t,inputs:{x:n}}=e,i=t.dataIdMap.get(n.dataId).id,a=t.makeOutput(n.shape,n.dtype),o=t.dataIdMap.get(a.dataId).id;return 0===r.sizeFromShape(a.shape)||DG(i,o),a}},Aq(cv),{kernelName:uv,backendName:"wasm",kernelFunc:FG},{kernelName:bv,backendName:"wasm",setupFunc:function(e){MG=e.wasm.cwrap(bv,null,["number","number","number","number"])},kernelFunc:function(e){const{backend:t,inputs:{logits:n},attrs:{dim:i}}=e,a=t.dataIdMap.get(n.dataId).id,o=t.makeOutput(n.shape,n.dtype),s=t.dataIdMap.get(o.dataId).id,l=n.shape[i],u=r.sizeFromShape(n.shape)/l;return 0===r.sizeFromShape(o.shape)||MG(a,s,l,u),o}},{kernelName:yv,backendName:"wasm",kernelFunc:function(e){const{inputs:t,attrs:n,backend:i}=e,{x:a}=t,{numOrSizeSplits:o,axis:s}=n,l=r.parseAxisParam(s,a.shape)[0],u=g.prepareSplitSize(a,o,s),c=new Array(a.shape.length).fill(0),d=a.shape.slice();return u.map(e=>{const t=[...d];t[l]=e;const n=FG({inputs:{x:a},attrs:{begin:c,size:t},backend:i});return c[l]+=e,n})}},Aq(mv),Aq(wv),Mq(xv,!0),{kernelName:Ev,backendName:"wasm",setupFunc:function(e){NG=e.wasm.cwrap(Ev,null,["number","array","number","array","array","array","array","array","number","number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:i}=e,{x:a}=n;let{begin:o,end:s,strides:l}=i;null==l&&(l=new Array(o.length));const{beginMask:u,endMask:c,ellipsisMask:d,newAxisMask:h,shrinkAxisMask:f}=i,p=g.slice_util.maskToAxes(d);if(p.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==d&&0!==h)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==d&&0!==f)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");const m=a.shape.length-o.length,v=g.slice_util.maskToAxes(h),y=a.shape.slice();v.forEach(e=>{o[e]=0,s[e]=1,y.splice(e,0,1)});const b=qq({inputs:{x:a},attrs:{shape:y},backend:t}),{begin:x,end:w,strides:_}=g.slice_util.getNormalizedAxes(b.shape,p,m,o,s,l,u,c,d);o=x,s=w,l=_;const S=g.slice_util.maskToAxes(f);S.forEach(e=>{s[e]=o[e]+1,l[e]=1});const E=g.slice_util.computeOutShape(o,s,l),T=E.filter((e,t)=>-1===S.indexOf(t));if(l.every(e=>1===e))return qq({inputs:{x:FG({inputs:{x:a},attrs:{begin:o,size:E},backend:t})},attrs:{shape:T},backend:t});const k=t.makeOutput(T,"float32");if(!T.some(e=>0===e)){const e=t.dataIdMap.get(b.dataId).id,n=new Uint8Array(new Int32Array(r.computeStrides(b.shape)).buffer),i=new Uint8Array(new Int32Array(o).buffer),a=new Uint8Array(new Int32Array(s).buffer),u=new Uint8Array(new Int32Array(l).buffer),c=new Uint8Array(new Int32Array(T).buffer),d=new Uint8Array(new Int32Array(r.computeStrides(T)).buffer),h=t.dataIdMap.get(k.dataId).id;NG(e,n,b.shape.length,i,a,u,c,d,T.length,h)}return qq({inputs:{x:k},attrs:{shape:T},backend:t})}},Mq(_v,!0),{kernelName:gv,backendName:"wasm",setupFunc:function(e){jG=e.wasm.cwrap(gv,null,["number, number, number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:i}=e,{axis:a,keepDims:o}=i,{x:s}=n,l=t.dataIdMap.get(s.dataId).id;let u=l,c=s;const{transposed:d,axes:h,originalAxes:f,inputWasTransposed:p}=zq(s,a,t);let m=h;if(p){const e=t.dataIdMap.get(d.dataId).id;e!==l&&(c=d,u=e,m=g.getInnerMostAxes(m.length,c.shape.length))}g.assertAxesAreInnerMostDims("sum",m,c.shape.length);const[v,y]=g.computeOutAndReduceShapes(c.shape,m),b=r.sizeFromShape(y),x=t.makeOutput(v,c.dtype);if(0!==r.sizeFromShape(c.shape)){const e=t.dataIdMap.get(x.dataId).id;jG(u,b,e)}if(p&&t.disposeData(d.dataId),o){const e=g.expandShapeToKeepDim(x.shape,f);x.shape=e}return x}},Aq(kv),{kernelName:Cv,backendName:"wasm",setupFunc:function(e){RG=e.wasm.cwrap(Cv,null,["number","array","number","array","number","number"])},kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,a=n.dataIdMap.get(i.dataId).id,{reps:o}=r,s=new Array(i.shape.length);for(let h=0;h<s.length;h++)s[h]=i.shape[h]*o[h];const l=new Uint8Array(new Int32Array(i.shape).buffer),u=new Uint8Array(new Int32Array(s).buffer),c=n.makeOutput(s,i.dtype),d=n.dataIdMap.get(c.dataId).id;return RG(a,l,i.shape.length,u,s.length,kq[c.dtype],d),c}},Bq,{kernelName:Dv,backendName:"wasm",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:i}=t,{axis:a}=r,o=i.shape[a],s=i.shape.length,l=new Array(s-1);let u=0;for(let f=0;f<s;f++)f!==a&&(l[u++]=i.shape[f]);const c=new Array(o),d=new Array(s).fill(0),h=i.shape.slice();h[a]=1;for(let f=0;f<c.length;f++)d[a]=f,c[f]=FG({inputs:{x:i},attrs:{begin:d,size:h},backend:n});return c.map(({dataId:e,dtype:t})=>({dataId:e,dtype:t,shape:l}))}},{kernelName:Nv,backendName:"wasm",kernelFunc:function(e){const{inputs:{x:t},backend:n}=e,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(0),r}}];for(const iBe of LG)Vv(iBe);const $G=Gp();$G.registerFlag("WASM_HAS_SIMD_SUPPORT",async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]))),$G.registerFlag("WASM_HAS_MULTITHREAD_SUPPORT",async()=>{if($G.get("IS_NODE"))return!1;try{return(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch(e){return!1}});var BG=n("VYYE"),zG=n.n(BG),UG=n("0I5M"),HG=n.n(UG);class WG extends Qf{constructor(e){super(),this.wasm=e,this.dataIdNextNumber=1,this.wasm.tfjs.init(),this.dataIdMap=new Jf(this,Xx())}write(e,t,n){const r={};return this.move(r,e,t,n),r}numDataIds(){return this.dataIdMap.numDataIds()}async time(e){const t=r.now();return e(),{kernelMs:r.now()-t}}move(e,t,n,i){const a=this.dataIdNextNumber++;if("string"===i)return void this.dataIdMap.set(e,{id:a,stringBytes:t,shape:n,dtype:i,memoryOffset:null});const o=r.sizeFromShape(n),s=o*r.bytesPerElement(i),l=this.wasm._malloc(s);this.dataIdMap.set(e,{id:a,memoryOffset:l,shape:n,dtype:i}),this.wasm.tfjs.registerTensor(a,o,l),null!=t&&this.wasm.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,s),l)}async read(e){return this.readSync(e)}readSync(e){const{memoryOffset:t,dtype:n,shape:i,stringBytes:a}=this.dataIdMap.get(e);return"string"===n?a:function(e,t){switch(t){case"float32":return new Float32Array(e);case"int32":return new Int32Array(e);case"bool":return new Uint8Array(e);default:throw new Error("Unknown dtype "+t)}}(this.wasm.HEAPU8.slice(t,t+r.sizeFromShape(i)*r.bytesPerElement(n)).buffer,n)}disposeData(e){const t=this.dataIdMap.get(e);this.wasm._free(t.memoryOffset),this.wasm.tfjs.disposeData(t.id),this.dataIdMap.delete(e)}floatPrecision(){return 32}getMemoryOffset(e){return this.dataIdMap.get(e).memoryOffset}dispose(){this.wasm.tfjs.dispose(),this.wasm=null}memory(){return{unreliable:!1}}makeOutput(e,t,n){let i;if(null==n)i=this.write(null,e,t);else{i={};const a=this.dataIdNextNumber++;this.dataIdMap.set(i,{id:a,memoryOffset:n,shape:e,dtype:t});const o=r.sizeFromShape(e);this.wasm.tfjs.registerTensor(a,o,n)}return{dataId:i,shape:e,dtype:t}}typedArrayFromHeap({shape:e,dtype:t,dataId:n}){const i=this.wasm.HEAPU8.buffer,{memoryOffset:a}=this.dataIdMap.get(n),o=r.sizeFromShape(e);switch(t){case"float32":return new Float32Array(i,a,o);case"int32":return new Int32Array(i,a,o);case"bool":return new Uint8Array(i,a,o);default:throw new Error("Unknown dtype "+t)}}}function VG(e,t,n){if(null!=GG)return GG;let r="tfjs-backend-wasm.wasm";return e&&t?r="tfjs-backend-wasm-threaded-simd.wasm":e&&(r="tfjs-backend-wasm-simd.wasm"),null!=XG&&null!=XG[r]?XG[r]:n+r}lw("wasm",async()=>{const{wasm:e}=await async function(){const[e,t]=await Promise.all([Gp().getAsync("WASM_HAS_SIMD_SUPPORT"),Gp().getAsync("WASM_HAS_MULTITHREAD_SUPPORT")]);return new Promise((n,i)=>{const a={};var o;let s;a.locateFile=(n,r)=>{if(n.endsWith(".worker.js")){const e=new Blob(['var threadInfoStruct=0;var selfThreadId=0;var parentThreadId=0;var Module={};function threadPrintErr(){var text=Array.prototype.slice.call(arguments).join(" ");console.error(text)}function threadAlert(){var text=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:text,threadId:selfThreadId})}var err=threadPrintErr;this.alert=threadAlert;Module["instantiateWasm"]=function(info,receiveInstance){var instance=new WebAssembly.Instance(Module["wasmModule"],info);Module["wasmModule"]=null;receiveInstance(instance);return instance.exports};this.onmessage=function(e){try{if(e.data.cmd==="load"){Module["DYNAMIC_BASE"]=e.data.DYNAMIC_BASE;Module["DYNAMICTOP_PTR"]=e.data.DYNAMICTOP_PTR;Module["wasmModule"]=e.data.wasmModule;Module["wasmMemory"]=e.data.wasmMemory;Module["buffer"]=Module["wasmMemory"].buffer;Module["ENVIRONMENT_IS_PTHREAD"]=true;if(typeof e.data.urlOrBlob==="string"){importScripts(e.data.urlOrBlob)}else{var objectUrl=URL.createObjectURL(e.data.urlOrBlob);importScripts(objectUrl);URL.revokeObjectURL(objectUrl)}Module=WasmBackendModuleThreadedSimd(Module);postMessage({"cmd":"loaded"})}else if(e.data.cmd==="objectTransfer"){Module["PThread"].receiveObjectTransfer(e.data)}else if(e.data.cmd==="run"){Module["__performance_now_clock_drift"]=performance.now()-e.data.time;threadInfoStruct=e.data.threadInfoStruct;Module["__register_pthread_ptr"](threadInfoStruct,0,0);selfThreadId=e.data.selfThreadId;parentThreadId=e.data.parentThreadId;var max=e.data.stackBase;var top=e.data.stackBase+e.data.stackSize;Module["establishStackSpace"](top,max);Module["_emscripten_tls_init"]();Module["PThread"].receiveObjectTransfer(e.data);Module["PThread"].setThreadStatus(Module["_pthread_self"](),1);try{var result=Module["dynCall_ii"](e.data.start_routine,e.data.arg);if(!Module["getNoExitRuntime"]())Module["PThread"].threadExit(result)}catch(ex){if(ex==="Canceled!"){Module["PThread"].threadCancel()}else if(ex!="unwind"){Atomics.store(Module["HEAPU32"],threadInfoStruct+4>>2,ex instanceof Module["ExitStatus"]?ex.status:-2);Atomics.store(Module["HEAPU32"],threadInfoStruct+0>>2,1);Module["_emscripten_futex_wake"](threadInfoStruct+0,2147483647);if(!(ex instanceof Module["ExitStatus"]))throw ex}}}else if(e.data.cmd==="cancel"){if(threadInfoStruct){Module["PThread"].threadCancel()}}else if(e.data.target==="setimmediate"){}else if(e.data.cmd==="processThreadQueue"){if(threadInfoStruct){Module["_emscripten_current_thread_process_queued_calls"]()}}else{err("worker.js received unknown command "+e.data.cmd);err(e.data)}}catch(ex){err("worker.js onmessage() captured an uncaught exception: "+ex);if(ex.stack)err(ex.stack);throw ex}};if(typeof process==="object"&&typeof process.versions==="object"&&typeof process.versions.node==="string"){self={location:{href:__filename}};var onmessage=this.onmessage;var nodeWorkerThreads=require("worker_threads");Worker=nodeWorkerThreads.Worker;var parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",function(data){onmessage({data:data})});var nodeFS=require("fs");var nodeRead=function(filename){return nodeFS.readFileSync(filename,"utf8")};function globalEval(x){global.require=require;global.Module=Module;eval.call(null,x)}importScripts=function(f){globalEval(nodeRead(f))};postMessage=function(msg){parentPort.postMessage(msg)};if(typeof performance==="undefined"){performance={now:function(){return Date.now()}}}}'],{type:"application/javascript"});return URL.createObjectURL(e)}return n.endsWith(".wasm")?VG(e,t,null!=YG?YG:r):r+n},ZG&&(a.instantiateWasm=(o=VG(e,t,null!=YG?YG:""),(e,t)=>(r.fetch(o,{credentials:"same-origin"}).then(n=>{n.ok||e.env.a(`failed to load wasm binary file at '${o}'`),n.arrayBuffer().then(n=>{WebAssembly.instantiate(n,e).then(e=>{t(e.instance)})})}),{}))),t&&e&&null==GG?(s=zG()(a),s.mainScriptUrlOrBlob=new Blob(["var _scriptDir = undefined; var WasmBackendModuleThreadedSimd = "+zG.a.toString()],{type:"text/javascript"})):s=HG()(a),s.tfjs={init:s.cwrap("init",null,[]),registerTensor:s.cwrap("register_tensor",null,["number","number","number"]),disposeData:s.cwrap("dispose_data",null,["number"]),dispose:s.cwrap("dispose",null,[])};let l=!1;s.onRuntimeInitialized=()=>{l=!0,KG=!1,n({wasm:s})},s.onAbort=()=>{l||KG||(KG=!0,i({message:"Make sure the server can serve the `.wasm` file relative to the bundled js file. For more details see https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/README.md#using-bundlers"}))}})}();return new WG(e)},2);const qG=["tfjs-backend-wasm.wasm","tfjs-backend-wasm-simd.wasm","tfjs-backend-wasm-threaded-simd.wasm"];let GG=null,YG=null,XG={},KG=!1,ZG=!1;var JG,QG=(JG=function(e,t){return(JG=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}JG(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),eY=Object.prototype.hasOwnProperty;function tY(e,t){return eY.call(e,t)}function nY(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);for(var r in t=[],e)tY(e,r)&&t.push(r);return t}function rY(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function iY(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function aY(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function oY(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function sY(e,t){var n=[e];for(var r in t){var i="object"==typeof t[r]?JSON.stringify(t[r],null,2):t[r];void 0!==i&&n.push(r+": "+i)}return n.join("\n")}var lY=function(e){function t(t,n,r,i,a){var o=this.constructor,s=e.call(this,sY(t,{name:n,index:r,operation:i,tree:a}))||this;return s.name=n,s.index=r,s.operation=i,s.tree=a,Object.setPrototypeOf(s,o.prototype),s.message=sY(t,{name:n,index:r,operation:i,tree:a}),s}return QG(t,e),t}(Error),uY=lY,cY=rY,dY={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=fY(n,this.path);r&&(r=rY(r));var i=pY(n,{op:"remove",path:this.from}).removed;return pY(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=fY(n,this.from);return pY(n,{op:"add",path:this.path,value:rY(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:bY(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},hY={add:function(e,t,n){return iY(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:dY.move,copy:dY.copy,test:dY.test,_get:dY._get};function fY(e,t){if(""==t)return e;var n={op:"_get",path:t};return pY(e,n),n.value}function pY(e,t,n,r,i,a){if(void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===i&&(i=!0),void 0===a&&(a=0),n&&("function"==typeof n?n(t,0,e,t.path):vY(t,0)),""===t.path){var o={newDocument:e};if("add"===t.op)return o.newDocument=t.value,o;if("replace"===t.op)return o.newDocument=t.value,o.removed=e,o;if("move"===t.op||"copy"===t.op)return o.newDocument=fY(e,t.from),"move"===t.op&&(o.removed=e),o;if("test"===t.op){if(o.test=bY(e,t.value),!1===o.test)throw new uY("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o.newDocument=e,o}if("remove"===t.op)return o.removed=e,o.newDocument=null,o;if("_get"===t.op)return t.value=e,o;if(n)throw new uY("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return o}r||(e=rY(e));var s=(t.path||"").split("/"),l=e,u=1,c=s.length,d=void 0,h=void 0,f=void 0;for(f="function"==typeof n?n:vY;;){if(h=s[u],i&&"__proto__"==h)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===d&&(void 0===l[h]?d=s.slice(0,u).join("/"):u==c-1&&(d=t.path),void 0!==d&&f(t,0,e,d)),u++,Array.isArray(l)){if("-"===h)h=l.length;else{if(n&&!iY(h))throw new uY("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);iY(h)&&(h=~~h)}if(u>=c){if(n&&"add"===t.op&&h>l.length)throw new uY("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);if(!1===(o=hY[t.op].call(t,l,h,e)).test)throw new uY("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}}else if(h&&-1!=h.indexOf("~")&&(h=oY(h)),u>=c){if(!1===(o=dY[t.op].call(t,l,h,e)).test)throw new uY("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}l=l[h]}}function mY(e,t,n,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=!0),n&&!Array.isArray(t))throw new uY("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=rY(e));for(var a=new Array(t.length),o=0,s=t.length;o<s;o++)a[o]=pY(e,t[o],n,!0,i,o),e=a[o].newDocument;return a.newDocument=e,a}function gY(e,t,n){var r=pY(e,t);if(!1===r.test)throw new uY("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function vY(e,t,n,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new uY("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!dY[e.op])throw new uY("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new uY("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new uY('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new uY("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new uY("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&function e(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return!0}else if("object"==typeof t){var i=nY(t),a=i.length;for(n=0;n<a;n++)if(e(t[i[n]]))return!0}return!1}(e.value))throw new uY("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var i=e.path.split("/").length,a=r.split("/").length;if(i!==a+1&&i!==a)throw new uY("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new uY("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var o=yY([{op:"_get",path:e.from,value:void 0}],n);if(o&&"OPERATION_PATH_UNRESOLVABLE"===o.name)throw new uY("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function yY(e,t,n){try{if(!Array.isArray(e))throw new uY("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)mY(rY(t),rY(e),n||!0);else{n=n||vY;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof uY)return i;throw i}}function bY(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,i,a=Array.isArray(e),o=Array.isArray(t);if(a&&o){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!bY(e[n],t[n]))return!1;return!0}if(a!=o)return!1;var s=Object.keys(e);if((r=s.length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!t.hasOwnProperty(s[n]))return!1;for(n=r;0!=n--;)if(!bY(e[i=s[n]],t[i]))return!1;return!0}return e!=e&&t!=t}var xY=new WeakMap,wY=function(){return function(e){this.observers=new Map,this.obj=e}}(),_Y=function(){return function(e,t){this.callback=e,this.observer=t}}();function SY(e,t){t.unobserve()}function EY(e,t){var n,r=function(e){return xY.get(e)}(e);if(r){var i=function(e,t){return e.observers.get(t)}(r,t);n=i&&i.observer}else r=new wY(e),xY.set(e,r);if(n)return n;if(n={},r.value=rY(e),t){n.callback=t,n.next=null;var a=function(){TY(n)},o=function(){clearTimeout(n.next),n.next=setTimeout(a)};"undefined"!=typeof window&&(window.addEventListener("mouseup",o),window.addEventListener("keyup",o),window.addEventListener("mousedown",o),window.addEventListener("keydown",o),window.addEventListener("change",o))}return n.patches=[],n.object=e,n.unobserve=function(){TY(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(r,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",o),window.removeEventListener("keyup",o),window.removeEventListener("mousedown",o),window.removeEventListener("keydown",o),window.removeEventListener("change",o))},r.observers.set(t,new _Y(t,n)),n}function TY(e,t){void 0===t&&(t=!1);var n=xY.get(e.object);kY(n.value,e.object,e.patches,"",t),e.patches.length&&mY(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function kY(e,t,n,r,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=nY(t),o=nY(e),s=!1,l=o.length-1;l>=0;l--){var u=e[d=o[l]];if(!tY(t,d)||void 0===t[d]&&void 0!==u&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+aY(d),value:rY(u)}),n.push({op:"remove",path:r+"/"+aY(d)}),s=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var c=t[d];"object"==typeof u&&null!=u&&"object"==typeof c&&null!=c?kY(u,c,n,r+"/"+aY(d),i):u!==c&&(i&&n.push({op:"test",path:r+"/"+aY(d),value:rY(u)}),n.push({op:"replace",path:r+"/"+aY(d),value:rY(c)}))}}if(s||a.length!=o.length)for(l=0;l<a.length;l++){var d;tY(e,d=a[l])||void 0===t[d]||n.push({op:"add",path:r+"/"+aY(d),value:rY(t[d])})}}}function CY(e,t,n){void 0===n&&(n=!1);var r=[];return kY(e,t,r,"",n),r}Object.assign({},W,V,{JsonPatchError:lY,deepClone:rY,escapePathComponent:aY,unescapePathComponent:oY});var IY=n("ZYJ9"),OY=n.n(IY),AY=n("3cPs");function DY(e,t,n){return e.fields=t||[],e.fname=n,e}function MY(e){return null==e?null:e.fname}function NY(e){return null==e?null:e.fields}function jY(e){return 1===e.length?RY(e[0]):PY(e)}const RY=e=>function(t){return t[e]},PY=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function FY(e){throw Error(e)}function LY(e){const t=[],n=e.length;let r,i,a,o=null,s=0,l="";function u(){t.push(l+e.substring(r,i)),l="",r=i+1}for(e+="",r=i=0;i<n;++i)if(a=e[i],"\\"===a)l+=e.substring(r,i),l+=e.substring(++i,++i),r=i;else if(a===o)u(),o=null,s=-1;else{if(o)continue;r===s&&'"'===a||r===s&&"'"===a?(r=i+1,o=a):"."!==a||s?"["===a?(i>r&&u(),s=r=i+1):"]"===a&&(s||FY("Access path missing open bracket: "+e),s>0&&u(),s=0,r=i+1):i>r?u():r=i+1}return s&&FY("Access path missing closing bracket: "+e),o&&FY("Access path missing closing quote: "+e),i>r&&(i++,u()),t}function $Y(e,t,n){const r=LY(e);return e=1===r.length?r[0]:e,DY((n&&n.get||jY)(r),[e],t||e)}const BY=$Y("id"),zY=DY(e=>e,[],"identity"),UY=DY(()=>0,[],"zero"),HY=DY(()=>1,[],"one"),WY=DY(()=>!0,[],"true"),VY=DY(()=>!1,[],"false");function qY(e,t,n){const r=[t].concat([].slice.call(n));console[e].apply(console,r)}const GY=0,YY=1,XY=2,KY=3,ZY=4;function JY(e,t){let n=e||GY;return{level(e){return arguments.length?(n=+e,this):n},error(){return n>=YY&&qY(t||"error","ERROR",arguments),this},warn(){return n>=XY&&qY(t||"warn","WARN",arguments),this},info(){return n>=KY&&qY(t||"log","INFO",arguments),this},debug(){return n>=ZY&&qY(t||"log","DEBUG",arguments),this}}}var QY=Array.isArray;function eX(e){return e===Object(e)}const tX=e=>"__proto__"!==e;function nX(...e){return e.reduce((e,t)=>{for(const n in t)"signals"===n?e.signals=iX(e.signals,t.signals):rX(e,n,t[n],"legend"===n?{layout:1}:"style"===n||null);return e},{})}function rX(e,t,n,r){if(!tX(t))return;let i,a;if(eX(n)&&!QY(n))for(i in a=eX(e[t])?e[t]:e[t]={},n)r&&(!0===r||r[i])?rX(a,i,n[i]):tX(i)&&(a[i]=n[i]);else e[t]=n}function iX(e,t){if(null==e)return t;const n={},r=[];function i(e){n[e.name]||(n[e.name]=1,r.push(e))}return t.forEach(i),e.forEach(i),r}function aX(e){return e[e.length-1]}function oX(e){return null==e||""===e?null:+e}const sX=e=>t=>e*Math.exp(t),lX=e=>t=>Math.log(e*t),uX=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),cX=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,dX=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function hX(e,t,n,r){const i=n(e[0]),a=n(aX(e)),o=(a-i)*t;return[r(i-o),r(a-o)]}function fX(e,t){return hX(e,t,oX,zY)}function pX(e,t){var n=Math.sign(e[0]);return hX(e,t,lX(n),sX(n))}function mX(e,t,n){return hX(e,t,dX(n),dX(1/n))}function gX(e,t,n){return hX(e,t,uX(n),cX(n))}function vX(e,t,n,r,i){const a=r(e[0]),o=r(aX(e)),s=null!=t?r(t):(a+o)/2;return[i(s+(a-s)*n),i(s+(o-s)*n)]}function yX(e,t,n){return vX(e,t,n,oX,zY)}function bX(e,t,n){const r=Math.sign(e[0]);return vX(e,t,n,lX(r),sX(r))}function xX(e,t,n,r){return vX(e,t,n,dX(r),dX(1/r))}function wX(e,t,n,r){return vX(e,t,n,uX(r),cX(r))}function _X(e){return 1+~~(new Date(e).getMonth()/3)}function SX(e){return 1+~~(new Date(e).getUTCMonth()/3)}function EX(e){return null!=e?QY(e)?e:[e]:[]}function TX(e,t,n){let r,i=e[0],a=e[1];return a<i&&(r=a,a=i,i=r),r=a-i,r>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-r),i+r]}function kX(e){return"function"==typeof e}function CX(e,t,n){n=n||{},t=EX(t)||[];const r=[],i=[],a={},o=n.comparator||OX;return EX(e).forEach((e,o)=>{null!=e&&(r.push("descending"===t[o]?-1:1),i.push(e=kX(e)?e:$Y(e,null,n)),(NY(e)||[]).forEach(e=>a[e]=1))}),0===i.length?null:DY(o(i,r),Object.keys(a))}const IX=(e,t)=>(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t==t?-1:t!=t&&e==e?1:0),OX=(e,t)=>1===e.length?AX(e[0],t[0]):DX(e,t,e.length),AX=(e,t)=>function(n,r){return IX(e(n),e(r))*t},DX=(e,t,n)=>(t.push(0),function(r,i){let a,o=0,s=-1;for(;0===o&&++s<n;)a=e[s],o=IX(a(r),a(i));return o*t[s]});function MX(e){return kX(e)?e:()=>e}function NX(e,t){let n;return r=>{n&&clearTimeout(n),n=setTimeout(()=>(t(r),n=null),e)}}function jX(e){for(let t,n,r=1,i=arguments.length;r<i;++r)for(n in t=arguments[r],t)e[n]=t[n];return e}function RX(e,t){let n,r,i,a,o=0;if(e&&(n=e.length))if(null==t){for(r=e[o];o<n&&(null==r||r!=r);r=e[++o]);for(i=a=r;o<n;++o)r=e[o],null!=r&&(r<i&&(i=r),r>a&&(a=r))}else{for(r=t(e[o]);o<n&&(null==r||r!=r);r=t(e[++o]));for(i=a=r;o<n;++o)r=t(e[o]),null!=r&&(r<i&&(i=r),r>a&&(a=r))}return[i,a]}function PX(e,t){const n=e.length;let r,i,a,o,s,l=-1;if(null==t){for(;++l<n;)if(i=e[l],null!=i&&i>=i){r=a=i;break}if(l===n)return[-1,-1];for(o=s=l;++l<n;)i=e[l],null!=i&&(r>i&&(r=i,o=l),a<i&&(a=i,s=l))}else{for(;++l<n;)if(i=t(e[l],l,e),null!=i&&i>=i){r=a=i;break}if(l===n)return[-1,-1];for(o=s=l;++l<n;)i=t(e[l],l,e),null!=i&&(r>i&&(r=i,o=l),a<i&&(a=i,s=l))}return[o,s]}const FX=Object.prototype.hasOwnProperty;function LX(e,t){return FX.call(e,t)}const $X={};function BX(e){let t,n={};function r(e){return LX(n,e)&&n[e]!==$X}const i={size:0,empty:0,object:n,has:r,get:e=>r(e)?n[e]:void 0,set(e,t){return r(e)||(++i.size,n[e]===$X&&--i.empty),n[e]=t,this},delete(e){return r(e)&&(--i.size,++i.empty,n[e]=$X),this},clear(){i.size=i.empty=0,i.object=n={}},test(e){return arguments.length?(t=e,i):t},clean(){const e={};let r=0;for(const i in n){const a=n[i];a===$X||t&&t(a)||(e[i]=a,++r)}i.size=r,i.empty=0,i.object=n=e}};return e&&Object.keys(e).forEach(t=>{i.set(t,e[t])}),i}function zX(e,t,n,r,i,a){if(!n&&0!==n)return a;const o=+n;let s,l=e[0],u=aX(e);u<l&&(s=l,l=u,u=s),s=Math.abs(t-l);const c=Math.abs(u-t);return s<c&&s<=o?r:c<=o?i:a}function UX(e,t,n){const r=e.prototype=Object.create(t.prototype);return r.constructor=e,jX(r,n)}function HX(e,t,n,r){let i,a=t[0],o=t[t.length-1];return a>o&&(i=a,a=o,o=i),r=void 0===r||r,((n=void 0===n||n)?a<=e:a<e)&&(r?e<=o:e<o)}function WX(e){return"boolean"==typeof e}function VX(e){return"[object Date]"===Object.prototype.toString.call(e)}function qX(e){return e&&kX(e[Symbol.iterator])}function GX(e){return"number"==typeof e}function YX(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function XX(e){return"string"==typeof e}function KX(e,t,n){e&&(e=t?EX(e).map(e=>e.replace(/\\(.)/g,"$1")):EX(e));const r=e&&e.length,i=n&&n.get||jY,a=e=>i(t?[e]:LY(e));let o;if(r)if(1===r){const t=a(e[0]);o=function(e){return""+t(e)}}else{const t=e.map(a);o=function(e){let n=""+t[0](e),i=0;for(;++i<r;)n+="|"+t[i](e);return n}}else o=function(){return""};return DY(o,e,"key")}function ZX(e,t){const n=e[0],r=aX(e),i=+t;return i?1===i?r:n+i*(r-n):n}function JX(e){let t,n,r;e=+e||1e4;const i=()=>{t={},n={},r=0},a=(i,a)=>(++r>e&&(n=t,t={},r=1),t[i]=a);return i(),{clear:i,has:e=>LX(t,e)||LX(n,e),get:e=>LX(t,e)?t[e]:LX(n,e)?a(e,n[e]):void 0,set:(e,n)=>LX(t,e)?t[e]=n:a(e,n)}}function QX(e,t,n,r){const i=t.length,a=n.length;if(!a)return t;if(!i)return n;const o=r||new t.constructor(i+a);let s=0,l=0,u=0;for(;s<i&&l<a;++u)o[u]=e(t[s],n[l])>0?n[l++]:t[s++];for(;s<i;++s,++u)o[u]=t[s];for(;l<a;++l,++u)o[u]=n[l];return o}function eK(e,t){let n="";for(;--t>=0;)n+=e;return n}function tK(e,t,n,r){const i=n||" ",a=e+"",o=t-a.length;return o<=0?a:"left"===r?eK(i,o)+a:"center"===r?eK(i,~~(o/2))+a+eK(i,Math.ceil(o/2)):a+eK(i,o)}function nK(e){return e&&aX(e)-e[0]||0}function rK(e){return QY(e)?"["+e.map(rK)+"]":eX(e)||XX(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function iK(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e||!e)}const aK=e=>GX(e)||VX(e)?e:Date.parse(e);function oK(e,t){return t=t||aK,null==e||""===e?null:t(e)}function sK(e){return null==e||""===e?null:e+""}function lK(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function uK(e,t,n,r){const i=null!=r?r:"\u2026",a=e+"",o=a.length,s=Math.max(0,t-i.length);return o<=t?a:"left"===n?i+a.slice(o-s):"center"===n?a.slice(0,Math.ceil(s/2))+i+a.slice(o-~~(s/2)):a.slice(0,s)+i}function cK(e,t,n){if(e)if(t){const r=e.length;for(let i=0;i<r;++i){const r=t(e[i]);r&&n(r,i,e)}}else e.forEach(n)}const dK=/^([A-Za-z]+:)?\/\//,hK=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,fK=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,pK="file://";async function mK(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function gK(e,t){t=jX({},this.options,t);const n=this.fileAccess,r={href:null};let i,a,o;const s=hK.test(e.replace(fK,""));null!=e&&"string"==typeof e&&s||FY("Sanitize failure, invalid URI: "+rK(e));const l=dK.test(e);return(o=t.baseURL)&&!l&&(e.startsWith("/")||"/"===o[o.length-1]||(e="/"+e),e=o+e),a=(i=e.startsWith(pK))||"file"===t.mode||"http"!==t.mode&&!l&&n,i?e=e.slice(pK.length):e.startsWith("//")&&("file"===t.defaultProtocol?(e=e.slice(2),a=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!a}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),"image"===t.context&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function vK(e){return e?t=>new Promise((n,r)=>{e.readFile(t,(e,t)=>{e?r(e):n(t)})}):yK}async function yK(){FY("No file system access.")}function bK(e){return e?async function(t,n){const r=jX({},this.options.http,n),i=n&&n.response,a=await e(t,r);return a.ok?kX(a[i])?a[i]():a.text():FY(a.status+""+a.statusText)}:xK}async function xK(){FY("No HTTP fetch method available.")}const wK=e=>!(Number.isNaN(+e)||e instanceof Date),_K={boolean:iK,integer:oX,number:oX,date:oK,string:sK,unknown:zY},SK=[e=>"true"===e||"false"===e||!0===e||!1===e,e=>wK(e)&&Number.isInteger(+e),wK,e=>!Number.isNaN(Date.parse(e))],EK=["boolean","integer","number","date"];function TK(e,t){if(!e||!e.length)return"unknown";const n=e.length,r=SK.length,i=SK.map((e,t)=>t+1);for(let o,s,l=0,u=0;l<n;++l)for(s=t?e[l][t]:e[l],o=0;o<r;++o)if(i[o]&&null!=(a=s)&&a==a&&!SK[o](s)&&(i[o]=0,++u,u===SK.length))return"string";var a;return EK[i.reduce((e,t)=>0===e?t:e,0)-1]}function kK(e,t){return t.reduce((t,n)=>(t[n]=TK(e,n),t),{})}var CK={},IK={};function OK(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function AK(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function DK(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function MK(e){const t=function(t,n){const r={delimiter:e};return NK(t,n?jX(n,r):r)};return t.responseType="text",t}function NK(e,t){return t.header&&(e=t.header.map(rK).join(t.delimiter)+"\n"+e),function(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],a=e.length,o=0,s=0,l=a<=0,u=!1;function c(){if(l)return IK;if(u)return u=!1,CK;var t,r,i=o;if(34===e.charCodeAt(i)){for(;o++<a&&34!==e.charCodeAt(o)||34===e.charCodeAt(++o););return(t=o)>=a?l=!0:10===(r=e.charCodeAt(o++))?u=!0:13===r&&(u=!0,10===e.charCodeAt(o)&&++o),e.slice(i+1,t-1).replace(/""/g,'"')}for(;o<a;){if(10===(r=e.charCodeAt(t=o++)))u=!0;else if(13===r)u=!0,10===e.charCodeAt(o)&&++o;else if(r!==n)continue;return e.slice(i,t)}return l=!0,e.slice(i,a)}for(10===e.charCodeAt(a-1)&&--a,13===e.charCodeAt(a-1)&&--a;(r=c())!==IK;){for(var d=[];r!==CK&&r!==IK;)d.push(r),r=c();t&&null==(d=t(d,s++))||i.push(d)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return o(t[e])})).join(e)}))}function a(t){return t.map(o).join(e)}function o(e){return null==e?"":e instanceof Date?(i=(n=e).getUTCHours(),a=n.getUTCMinutes(),o=n.getUTCSeconds(),s=n.getUTCMilliseconds(),isNaN(n)?"Invalid Date":((r=n.getUTCFullYear())<0?"-"+DK(-r,6):r>9999?"+"+DK(r,6):DK(r,4))+"-"+DK(n.getUTCMonth()+1,2)+"-"+DK(n.getUTCDate(),2)+(s?"T"+DK(i,2)+":"+DK(a,2)+":"+DK(o,2)+"."+DK(s,3)+"Z":o?"T"+DK(i,2)+":"+DK(a,2)+":"+DK(o,2)+"Z":a||i?"T"+DK(i,2)+":"+DK(a,2)+"Z":"")):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e;var n,r,i,a,o,s}return{parse:function(e,t){var n,i,a=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=OK(e);return function(r,i){return t(n(r),i,e)}}(e,t):OK(e)}));return a.columns=i||[],a},parseRows:r,format:function(t,n){return null==n&&(n=AK(t)),[n.map(o).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=AK(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(a).join("\n")},formatRow:a,formatValue:o}}(t.delimiter).parse(e+"")}function jK(e,t){const n=t&&t.property?$Y(t.property):zY;return!eX(e)||(r=e,"function"==typeof Buffer&&kX(Buffer.isBuffer)&&Buffer.isBuffer(r))?n(JSON.parse(e)):function(e,t){return!QY(e)&&qX(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}(n(e),t);var r}NK.responseType="text",jK.responseType="json";var RK=function(e){return e},PK=function(e,t){return"string"==typeof t&&(t=e.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return FK(e,t)}))}:FK(e,t)};function FK(e,t){var n=t.id,r=t.bbox,i=null==t.properties?{}:t.properties,a=LK(e,t);return null==n&&null==r?{type:"Feature",properties:i,geometry:a}:null==r?{type:"Feature",id:n,properties:i,geometry:a}:{type:"Feature",id:n,bbox:r,properties:i,geometry:a}}function LK(e,t){var n=function(e){if(null==e)return RK;var t,n,r=e.scale[0],i=e.scale[1],a=e.translate[0],o=e.translate[1];return function(e,s){s||(t=n=0);var l=2,u=e.length,c=new Array(u);for(c[0]=(t+=e[0])*r+a,c[1]=(n+=e[1])*i+o;l<u;)c[l]=e[l],++l;return c}}(e.transform),r=e.arcs;function i(e,t){t.length&&t.pop();for(var i=r[e<0?~e:e],a=0,o=i.length;a<o;++a)t.push(n(i[a],a));e<0&&function(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n}(t,o)}function a(e){return n(e)}function o(e){for(var t=[],n=0,r=e.length;n<r;++n)i(e[n],t);return t.length<2&&t.push(t[0]),t}function s(e){for(var t=o(e);t.length<4;)t.push(t[0]);return t}function l(e){return e.map(s)}return function e(t){var n,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(e)};case"Point":n=a(t.coordinates);break;case"MultiPoint":n=t.coordinates.map(a);break;case"LineString":n=o(t.arcs);break;case"MultiLineString":n=t.arcs.map(o);break;case"Polygon":n=l(t.arcs);break;case"MultiPolygon":n=t.arcs.map(l);break;default:return null}return{type:r,coordinates:n}}(t)}var $K=function(e,t){var n={},r={},i={},a=[],o=-1;function s(e,t){for(var r in e){var i=e[r];delete t[i.start],delete i.start,delete i.end,i.forEach((function(e){n[e<0?~e:e]=1})),a.push(i)}}return t.forEach((function(n,r){var i,a=e.arcs[n<0?~n:n];a.length<3&&!a[1][0]&&!a[1][1]&&(i=t[++o],t[o]=n,t[r]=i)})),t.forEach((function(t){var n,a,o=function(t){var n,r=e.arcs[t<0?~t:t],i=r[0];return e.transform?(n=[0,0],r.forEach((function(e){n[0]+=e[0],n[1]+=e[1]}))):n=r[r.length-1],t<0?[n,i]:[i,n]}(t),s=o[0],l=o[1];if(n=i[s])if(delete i[n.end],n.push(t),n.end=l,a=r[l]){delete r[a.start];var u=a===n?n:n.concat(a);r[u.start=n.start]=i[u.end=a.end]=u}else r[n.start]=i[n.end]=n;else if(n=r[l])if(delete r[n.start],n.unshift(t),n.start=s,a=i[s]){delete i[a.end];var c=a===n?n:a.concat(n);r[c.start=a.start]=i[c.end=n.end]=c}else r[n.start]=i[n.end]=n;else r[(n=[t]).start=s]=i[n.end=l]=n})),s(i,r),s(r,i),t.forEach((function(e){n[e<0?~e:e]||a.push([e])})),a},BK=function(e){return LK(e,zK.apply(this,arguments))};function zK(e,t,n){var r,i,a;if(arguments.length>1)r=UK(0,t,n);else for(i=0,r=new Array(a=e.arcs.length);i<a;++i)r[i]=i;return{type:"MultiLineString",arcs:$K(e,r)}}function UK(e,t,n){var r,i=[],a=[];function o(e){var t=e<0?~e:e;(a[t]||(a[t]=[])).push({i:e,g:r})}function s(e){e.forEach(o)}function l(e){e.forEach(s)}return function e(t){switch(r=t,t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"LineString":s(t.arcs);break;case"MultiLineString":case"Polygon":l(t.arcs);break;case"MultiPolygon":!function(e){e.forEach(l)}(t.arcs)}}(t),a.forEach(null==n?function(e){i.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&i.push(e[0].i)}),i}const HK={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function WK(e,t){let n,r,i,a;return e=jK(e,t),t&&t.feature?(n=PK,i=t.feature):t&&t.mesh?(n=BK,i=t.mesh,a=HK[t.filter]):FY("Missing TopoJSON feature or mesh parameter."),r=(r=e.objects[i])?n(e,r,a):FY("Invalid TopoJSON object: "+i),r&&r.features||[r]}WK.responseType="json";const VK={dsv:NK,csv:MK(","),tsv:MK("\t"),json:jK,topojson:WK};function qK(e,t){return arguments.length>1?(VK[e]=t,this):LX(VK,e)?VK[e]:null}function GK(e){const t=qK(e);return t&&t.responseType||"text"}var YK=Math.sqrt(50),XK=Math.sqrt(10),KK=Math.sqrt(2),ZK=function(e,t,n){var r,i,a,o,s=-1;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(o=JK(e,t,n))||!isFinite(o))return[];if(o>0)for(e=Math.ceil(e/o),t=Math.floor(t/o),a=new Array(i=Math.ceil(t-e+1));++s<i;)a[s]=(e+s)*o;else for(o=-o,e=Math.ceil(e*o),t=Math.floor(t*o),a=new Array(i=Math.ceil(t-e+1));++s<i;)a[s]=(e+s)/o;return r&&a.reverse(),a};function JK(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return i>=0?(a>=YK?10:a>=XK?5:a>=KK?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=YK?10:a>=XK?5:a>=KK?2:1)}function QK(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=YK?i*=10:a>=XK?i*=5:a>=KK&&(i*=2),t<e?-i:i}var eZ=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function tZ(e){if(!(t=eZ.exec(e)))throw new Error("invalid format: "+e);var t;return new nZ({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function nZ(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function rZ(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}tZ.prototype=nZ.prototype,nZ.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var iZ,aZ,oZ,sZ,lZ=function(e){return(e=rZ(Math.abs(e)))?e[1]:NaN},uZ=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(lZ(t)/3)))-lZ(Math.abs(e)))},cZ=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,lZ(t)-lZ(e))+1},dZ=function(e){return Math.max(0,-lZ(Math.abs(e)))},hZ=function(e,t){var n=rZ(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")},fZ={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>hZ(100*e,t),r:hZ,s:function(e,t){var n=rZ(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(iZ=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+rZ(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)},pZ=function(e){return e},mZ=Array.prototype.map,gZ=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"],vZ=function(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?pZ:(t=mZ.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,a=[],o=0,s=t[0],l=0;i>0&&s>0&&(l+s+1>r&&(s=Math.max(1,r-l)),a.push(e.substring(i-=s,i+s)),!((l+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?pZ:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(mZ.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",u=void 0===e.minus?"\u2212":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function d(e){var t=(e=tZ(e)).fill,n=e.align,d=e.sign,h=e.symbol,f=e.zero,p=e.width,m=e.comma,g=e.precision,v=e.trim,y=e.type;"n"===y?(m=!0,y="g"):fZ[y]||(void 0===g&&(g=12),v=!0,y="g"),(f||"0"===t&&"="===n)&&(f=!0,t="0",n="=");var b="$"===h?i:"#"===h&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",x="$"===h?a:/[%p]/.test(y)?l:"",w=fZ[y],_=/[defgprs%]/.test(y);function S(e){var i,a,l,h=b,S=x;if("c"===y)S=w(e)+S,e="";else{var E=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:w(Math.abs(e),g),v&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),E&&0==+e&&"+"!==d&&(E=!1),h=(E?"("===d?d:u:"-"===d||"("===d?"":d)+h,S=("s"===y?gZ[8+iZ/3]:"")+S+(E&&"("===d?")":""),_)for(i=-1,a=e.length;++i<a;)if(48>(l=e.charCodeAt(i))||l>57){S=(46===l?o+e.slice(i+1):e.slice(i))+S,e=e.slice(0,i);break}}m&&!f&&(e=r(e,1/0));var T=h.length+e.length+S.length,k=T<p?new Array(p-T+1).join(t):"";switch(m&&f&&(e=r(k+e,k.length?p-S.length:1/0),k=""),n){case"<":e=h+e+S+k;break;case"=":e=h+k+e+S;break;case"^":e=k.slice(0,T=k.length>>1)+h+e+S+k.slice(T);break;default:e=k+h+e+S}return s(e)}return g=void 0===g?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),S.toString=function(){return e+""},S}return{format:d,formatPrefix:function(e,t){var n=d(((e=tZ(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(lZ(t)/3))),i=Math.pow(10,-r),a=gZ[8+r/3];return function(e){return n(i*e)+a}}}};aZ=vZ({thousands:",",grouping:[3],currency:["$",""]}),oZ=aZ.format,sZ=aZ.formatPrefix;var yZ=new Date,bZ=new Date;function xZ(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,a){var o,s=[];if(n=i.ceil(n),a=null==a?1:Math.floor(a),!(n<r&&a>0))return s;do{s.push(o=new Date(+n)),t(n,a),e(n)}while(o<n&&n<r);return s},i.filter=function(n){return xZ((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return yZ.setTime(+t),bZ.setTime(+r),e(yZ),e(bZ),Math.floor(n(yZ,bZ))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var wZ=1e3,_Z=6e4,SZ=36e5,EZ=864e5,TZ=6048e5,kZ=xZ(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*_Z)/EZ,e=>e.getDate()-1);function CZ(e){return xZ((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*_Z)/TZ}))}var IZ=CZ(0),OZ=(CZ(1),CZ(2),CZ(3),CZ(4),CZ(5),CZ(6),xZ((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/EZ}),(function(e){return e.getUTCDate()-1})));function AZ(e){return xZ((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/TZ}))}var DZ=AZ(0),MZ=(AZ(1),AZ(2),AZ(3),AZ(4),AZ(5),AZ(6),xZ((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()})));MZ.every=function(e){return isFinite(e=Math.floor(e))&&e>0?xZ((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var NZ=MZ,jZ=xZ((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()})),RZ=xZ((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*wZ-e.getMinutes()*_Z)}),(function(e,t){e.setTime(+e+t*SZ)}),(function(e,t){return(t-e)/SZ}),(function(e){return e.getHours()})),PZ=xZ((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*wZ)}),(function(e,t){e.setTime(+e+t*_Z)}),(function(e,t){return(t-e)/_Z}),(function(e){return e.getMinutes()})),FZ=xZ((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*wZ)}),(function(e,t){return(t-e)/wZ}),(function(e){return e.getUTCSeconds()})),LZ=xZ((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));LZ.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?xZ((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):LZ:null};var $Z=LZ,BZ=xZ((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));BZ.every=function(e){return isFinite(e=Math.floor(e))&&e>0?xZ((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};var zZ=BZ,UZ=xZ((function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())}),(function(e){return e.getUTCMonth()})),HZ=xZ((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+t*SZ)}),(function(e,t){return(t-e)/SZ}),(function(e){return e.getUTCHours()})),WZ=xZ((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+t*_Z)}),(function(e,t){return(t-e)/_Z}),(function(e){return e.getUTCMinutes()})),VZ=function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN},qZ=function(e){let t=e,n=e;function r(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)<0?r=a+1:i=a}return r}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>VZ(e(t),n)}(e)),{left:r,center:function(e,n,i,a){null==i&&(i=0),null==a&&(a=e.length);const o=r(e,n,i,a-1);return o>i&&t(e[o-1],n)>-t(e[o],n)?o-1:o},right:function(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)>0?i=a:r=a+1}return r}}};const GZ="year",YZ="quarter",XZ="month",KZ="week",ZZ="date",JZ="day",QZ="dayofyear",eJ="hours",tJ="minutes",nJ="seconds",rJ="milliseconds",iJ=[GZ,YZ,XZ,KZ,ZZ,JZ,QZ,eJ,tJ,nJ,rJ],aJ=iJ.reduce((e,t,n)=>(e[t]=1+n,e),{});function oJ(e){const t=EX(e).slice(),n={};return t.length||FY("Missing time unit."),t.forEach(e=>{LX(aJ,e)?n[e]=1:FY("Invalid time unit: ".concat(e,"."))}),(n[KZ]||n[JZ]?1:0)+(n[YZ]||n[XZ]||n[ZZ]?1:0)+(n[QZ]?1:0)>1&&FY("Incompatible time units: ".concat(e)),t.sort((e,t)=>aJ[e]-aJ[t]),t}const sJ={[GZ]:"%Y ",[YZ]:"Q%q ",[XZ]:"%b ",[ZZ]:"%d ",[KZ]:"W%U ",[JZ]:"%a ",[QZ]:"%j ",[eJ]:"%H:00",[tJ]:"00:%M",[nJ]:":%S",[rJ]:".%L",["".concat(GZ,"-").concat(XZ)]:"%Y-%m ",["".concat(GZ,"-").concat(XZ,"-").concat(ZZ)]:"%Y-%m-%d ",["".concat(eJ,"-").concat(tJ)]:"%H:%M"};function lJ(e,t){const n=jX({},sJ,t),r=oJ(e),i=r.length;let a,o,s="",l=0;for(l=0;l<i;)for(a=r.length;a>l;--a)if(o=r.slice(l,a).join("-"),null!=n[o]){s+=n[o],l=a;break}return s.trim()}const uJ=new Date;function cJ(e){return uJ.setFullYear(e),uJ.setMonth(0),uJ.setDate(1),uJ.setHours(0,0,0,0),uJ}function dJ(e){return fJ(new Date(e))}function hJ(e){return pJ(new Date(e))}function fJ(e){return kZ.count(cJ(e.getFullYear())-1,e)}function pJ(e){return IZ.count(cJ(e.getFullYear())-1,e)}function mJ(e){return cJ(e).getDay()}function gJ(e,t,n,r,i,a,o){if(0<=e&&e<100){const s=new Date(-1,t,n,r,i,a,o);return s.setFullYear(e),s}return new Date(e,t,n,r,i,a,o)}function vJ(e){return bJ(new Date(e))}function yJ(e){return xJ(new Date(e))}function bJ(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return OZ.count(t-1,e)}function xJ(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return DZ.count(t-1,e)}function wJ(e){return uJ.setTime(Date.UTC(e,0,1)),uJ.getUTCDay()}function _J(e,t,n,r,i,a,o){if(0<=e&&e<100){const e=new Date(Date.UTC(-1,t,n,r,i,a,o));return e.setUTCFullYear(n.y),e}return new Date(Date.UTC(e,t,n,r,i,a,o))}function SJ(e,t,n,r,i){const a=t||1,o=aX(e),s=(e,t,i)=>function(e,t,n,r){const i=n<=1?e:r?(t,i)=>r+n*Math.floor((e(t,i)-r)/n):(t,r)=>n*Math.floor(e(t,r)/n);return t?(e,n)=>t(i(e,n),n):i}(n[i=i||e],r[i],e===o&&a,t),l=new Date,u=lK(e),c=u[GZ]?s(GZ):MX(2012),d=u[XZ]?s(XZ):u[YZ]?s(YZ):UY,h=u[KZ]&&u[JZ]?s(JZ,1,KZ+JZ):u[KZ]?s(KZ,1):u[JZ]?s(JZ,1):u[ZZ]?s(ZZ,1):u[QZ]?s(QZ,1):HY,f=u[eJ]?s(eJ):UY,p=u[tJ]?s(tJ):UY,m=u[nJ]?s(nJ):UY,g=u[rJ]?s(rJ):UY;return function(e){l.setTime(+e);const t=c(l);return i(t,d(l),h(l,t),f(l),p(l),m(l),g(l))}}function EJ(e,t,n){return t+7*e-(n+6)%7}const TJ={[GZ]:e=>e.getFullYear(),[YZ]:e=>Math.floor(e.getMonth()/3),[XZ]:e=>e.getMonth(),[ZZ]:e=>e.getDate(),[eJ]:e=>e.getHours(),[tJ]:e=>e.getMinutes(),[nJ]:e=>e.getSeconds(),[rJ]:e=>e.getMilliseconds(),[QZ]:e=>fJ(e),[KZ]:e=>pJ(e),[KZ+JZ]:(e,t)=>EJ(pJ(e),e.getDay(),mJ(t)),[JZ]:(e,t)=>EJ(1,e.getDay(),mJ(t))},kJ={[YZ]:e=>3*e,[KZ]:(e,t)=>EJ(e,0,mJ(t))};function CJ(e,t){return SJ(e,t||1,TJ,kJ,gJ)}const IJ={[GZ]:e=>e.getUTCFullYear(),[YZ]:e=>Math.floor(e.getUTCMonth()/3),[XZ]:e=>e.getUTCMonth(),[ZZ]:e=>e.getUTCDate(),[eJ]:e=>e.getUTCHours(),[tJ]:e=>e.getUTCMinutes(),[nJ]:e=>e.getUTCSeconds(),[rJ]:e=>e.getUTCMilliseconds(),[QZ]:e=>bJ(e),[KZ]:e=>xJ(e),[JZ]:(e,t)=>EJ(1,e.getUTCDay(),wJ(t)),[KZ+JZ]:(e,t)=>EJ(xJ(e),e.getUTCDay(),wJ(t))},OJ={[YZ]:e=>3*e,[KZ]:(e,t)=>EJ(e,0,wJ(t))};function AJ(e,t){return SJ(e,t||1,IJ,OJ,_J)}const DJ={[GZ]:NZ,[YZ]:jZ.every(3),[XZ]:jZ,[KZ]:IZ,[ZZ]:kZ,[JZ]:kZ,[QZ]:kZ,[eJ]:RZ,[tJ]:PZ,[nJ]:FZ,[rJ]:$Z},MJ={[GZ]:zZ,[YZ]:UZ.every(3),[XZ]:UZ,[KZ]:DZ,[ZZ]:OZ,[JZ]:OZ,[QZ]:OZ,[eJ]:HZ,[tJ]:WZ,[nJ]:FZ,[rJ]:$Z};function NJ(e){return DJ[e]}function jJ(e){return MJ[e]}function RJ(e,t,n){return e?e.offset(t,n):void 0}function PJ(e,t,n){return RJ(NJ(e),t,n)}function FJ(e,t,n){return RJ(jJ(e),t,n)}function LJ(e,t,n,r){return e?e.range(t,n,r):void 0}function $J(e,t,n,r){return LJ(NJ(e),t,n,r)}function BJ(e,t,n,r){return LJ(jJ(e),t,n,r)}const zJ=31536e6,UJ=[GZ,XZ,ZZ,eJ,tJ,nJ,rJ],HJ=UJ.slice(0,-1),WJ=HJ.slice(0,-1),VJ=WJ.slice(0,-1),qJ=VJ.slice(0,-1),GJ=[GZ,XZ],YJ=[GZ],XJ=[[HJ,1,1e3],[HJ,5,5e3],[HJ,15,15e3],[HJ,30,3e4],[WJ,1,6e4],[WJ,5,3e5],[WJ,15,9e5],[WJ,30,18e5],[VJ,1,36e5],[VJ,3,108e5],[VJ,6,216e5],[VJ,12,432e5],[qJ,1,864e5],[[GZ,KZ],1,6048e5],[GJ,1,2592e6],[GJ,3,7776e6],[YJ,1,zJ]];function KJ(e){const t=e.extent,n=e.maxbins||40,r=Math.abs(nK(t))/n;let i,a,o=qZ(e=>e[2]).right(XJ,r);return o===XJ.length?(i=YJ,a=QK(t[0]/zJ,t[1]/zJ,n)):o?(o=XJ[r/XJ[o-1][2]<XJ[o][2]/r?o-1:o],i=o[0],a=o[1]):(i=UJ,a=Math.max(QK(t[0],t[1],n),1)),{units:i,step:a}}var ZJ=new Date,JJ=new Date;function QJ(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,a){var o,s=[];if(n=i.ceil(n),a=null==a?1:Math.floor(a),!(n<r&&a>0))return s;do{s.push(o=new Date(+n)),t(n,a),e(n)}while(o<n&&n<r);return s},i.filter=function(n){return QJ((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return ZJ.setTime(+t),JJ.setTime(+r),e(ZJ),e(JJ),Math.floor(n(ZJ,JJ))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var eQ=1e3,tQ=6e4,nQ=36e5,rQ=864e5,iQ=6048e5;function aQ(e){return QJ((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/iQ}))}var oQ=aQ(0),sQ=aQ(1),lQ=(aQ(2),aQ(3),aQ(4)),uQ=(aQ(5),aQ(6),QJ((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/rQ}),(function(e){return e.getUTCDate()-1})));function cQ(e){return QJ((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*tQ)/iQ}))}var dQ=cQ(0),hQ=cQ(1),fQ=(cQ(2),cQ(3),cQ(4)),pQ=(cQ(5),cQ(6),QJ((function(e){e.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*tQ)/rQ}),(function(e){return e.getDate()-1}))),mQ=QJ((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));mQ.every=function(e){return isFinite(e=Math.floor(e))&&e>0?QJ((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var gQ=mQ,vQ=QJ((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));vQ.every=function(e){return isFinite(e=Math.floor(e))&&e>0?QJ((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};var yQ=vQ;function bQ(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function xQ(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function wQ(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function _Q(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,u=jQ(i),c=RQ(i),d=jQ(a),h=RQ(a),f=jQ(o),p=RQ(o),m=jQ(s),g=RQ(s),v=jQ(l),y=RQ(l),b={a:function(e){return o[e.getDay()]},A:function(e){return a[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:n0,e:n0,f:s0,g:y0,G:x0,H:r0,I:i0,j:a0,L:o0,m:l0,M:u0,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:H0,s:W0,S:c0,u:d0,U:h0,V:p0,w:m0,W:g0,x:null,X:null,y:v0,Y:b0,Z:w0,"%":U0},x={a:function(e){return o[e.getUTCDay()]},A:function(e){return a[e.getUTCDay()]},b:function(e){return l[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:_0,e:_0,f:C0,g:L0,G:B0,H:S0,I:E0,j:T0,L:k0,m:I0,M:O0,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:H0,s:W0,S:A0,u:D0,U:M0,V:j0,w:R0,W:P0,x:null,X:null,y:F0,Y:$0,Z:z0,"%":U0},w={a:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=p.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(e,t,n){var r=d.exec(t.slice(n));return r?(e.w=h.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=y.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=g.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(e,n,r){return E(e,t,n,r)},d:qQ,e:qQ,f:JQ,g:UQ,G:zQ,H:YQ,I:YQ,j:GQ,L:ZQ,m:VQ,M:XQ,p:function(e,t,n){var r=u.exec(t.slice(n));return r?(e.p=c.get(r[0].toLowerCase()),n+r[0].length):-1},q:WQ,Q:e0,s:t0,S:KQ,u:FQ,U:LQ,V:$Q,w:PQ,W:BQ,x:function(e,t,r){return E(e,n,t,r)},X:function(e,t,n){return E(e,r,t,n)},y:UQ,Y:zQ,Z:HQ,"%":QQ};function _(e,t){return function(n){var r,i,a,o=[],s=-1,l=0,u=e.length;for(n instanceof Date||(n=new Date(+n));++s<u;)37===e.charCodeAt(s)&&(o.push(e.slice(l,s)),null!=(i=IQ[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(a=t[r])&&(r=a(n,i)),o.push(r),l=s+1);return o.push(e.slice(l,s)),o.join("")}}function S(e,t){return function(n){var r,i,a=wQ(1900,void 0,1);if(E(a,e,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(t&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(i=(r=xQ(wQ(a.y,0,1))).getUTCDay(),r=i>4||0===i?sQ.ceil(r):sQ(r),r=uQ.offset(r,7*(a.V-1)),a.y=r.getUTCFullYear(),a.m=r.getUTCMonth(),a.d=r.getUTCDate()+(a.w+6)%7):(i=(r=bQ(wQ(a.y,0,1))).getDay(),r=i>4||0===i?hQ.ceil(r):hQ(r),r=pQ.offset(r,7*(a.V-1)),a.y=r.getFullYear(),a.m=r.getMonth(),a.d=r.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),i="Z"in a?xQ(wQ(a.y,0,1)).getUTCDay():bQ(wQ(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(i+5)%7:a.w+7*a.U-(i+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,xQ(a)):bQ(a)}}function E(e,t,n,r){for(var i,a,o=0,s=t.length,l=n.length;o<s;){if(r>=l)return-1;if(37===(i=t.charCodeAt(o++))){if(i=t.charAt(o++),!(a=w[i in IQ?t.charAt(o++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return b.x=_(n,b),b.X=_(r,b),b.c=_(t,b),x.x=_(n,x),x.X=_(r,x),x.c=_(t,x),{format:function(e){var t=_(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=S(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=_(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=S(e+="",!0);return t.toString=function(){return e},t}}}var SQ,EQ,TQ,kQ,CQ,IQ={"-":"",_:" ",0:"0"},OQ=/^\s*\d+/,AQ=/^%/,DQ=/[\\^$*+?|[\]().{}]/g;function MQ(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function NQ(e){return e.replace(DQ,"\\$&")}function jQ(e){return new RegExp("^(?:"+e.map(NQ).join("|")+")","i")}function RQ(e){return new Map(e.map((e,t)=>[e.toLowerCase(),t]))}function PQ(e,t,n){var r=OQ.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function FQ(e,t,n){var r=OQ.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function LQ(e,t,n){var r=OQ.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function $Q(e,t,n){var r=OQ.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function BQ(e,t,n){var r=OQ.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function zQ(e,t,n){var r=OQ.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function UQ(e,t,n){var r=OQ.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function HQ(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function WQ(e,t,n){var r=OQ.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function VQ(e,t,n){var r=OQ.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function qQ(e,t,n){var r=OQ.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function GQ(e,t,n){var r=OQ.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function YQ(e,t,n){var r=OQ.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function XQ(e,t,n){var r=OQ.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function KQ(e,t,n){var r=OQ.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function ZQ(e,t,n){var r=OQ.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function JQ(e,t,n){var r=OQ.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function QQ(e,t,n){var r=AQ.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function e0(e,t,n){var r=OQ.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function t0(e,t,n){var r=OQ.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function n0(e,t){return MQ(e.getDate(),t,2)}function r0(e,t){return MQ(e.getHours(),t,2)}function i0(e,t){return MQ(e.getHours()%12||12,t,2)}function a0(e,t){return MQ(1+pQ.count(gQ(e),e),t,3)}function o0(e,t){return MQ(e.getMilliseconds(),t,3)}function s0(e,t){return o0(e,t)+"000"}function l0(e,t){return MQ(e.getMonth()+1,t,2)}function u0(e,t){return MQ(e.getMinutes(),t,2)}function c0(e,t){return MQ(e.getSeconds(),t,2)}function d0(e){var t=e.getDay();return 0===t?7:t}function h0(e,t){return MQ(dQ.count(gQ(e)-1,e),t,2)}function f0(e){var t=e.getDay();return t>=4||0===t?fQ(e):fQ.ceil(e)}function p0(e,t){return e=f0(e),MQ(fQ.count(gQ(e),e)+(4===gQ(e).getDay()),t,2)}function m0(e){return e.getDay()}function g0(e,t){return MQ(hQ.count(gQ(e)-1,e),t,2)}function v0(e,t){return MQ(e.getFullYear()%100,t,2)}function y0(e,t){return MQ((e=f0(e)).getFullYear()%100,t,2)}function b0(e,t){return MQ(e.getFullYear()%1e4,t,4)}function x0(e,t){var n=e.getDay();return MQ((e=n>=4||0===n?fQ(e):fQ.ceil(e)).getFullYear()%1e4,t,4)}function w0(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+MQ(t/60|0,"0",2)+MQ(t%60,"0",2)}function _0(e,t){return MQ(e.getUTCDate(),t,2)}function S0(e,t){return MQ(e.getUTCHours(),t,2)}function E0(e,t){return MQ(e.getUTCHours()%12||12,t,2)}function T0(e,t){return MQ(1+uQ.count(yQ(e),e),t,3)}function k0(e,t){return MQ(e.getUTCMilliseconds(),t,3)}function C0(e,t){return k0(e,t)+"000"}function I0(e,t){return MQ(e.getUTCMonth()+1,t,2)}function O0(e,t){return MQ(e.getUTCMinutes(),t,2)}function A0(e,t){return MQ(e.getUTCSeconds(),t,2)}function D0(e){var t=e.getUTCDay();return 0===t?7:t}function M0(e,t){return MQ(oQ.count(yQ(e)-1,e),t,2)}function N0(e){var t=e.getUTCDay();return t>=4||0===t?lQ(e):lQ.ceil(e)}function j0(e,t){return e=N0(e),MQ(lQ.count(yQ(e),e)+(4===yQ(e).getUTCDay()),t,2)}function R0(e){return e.getUTCDay()}function P0(e,t){return MQ(sQ.count(yQ(e)-1,e),t,2)}function F0(e,t){return MQ(e.getUTCFullYear()%100,t,2)}function L0(e,t){return MQ((e=N0(e)).getUTCFullYear()%100,t,2)}function $0(e,t){return MQ(e.getUTCFullYear()%1e4,t,4)}function B0(e,t){var n=e.getUTCDay();return MQ((e=n>=4||0===n?lQ(e):lQ.ceil(e)).getUTCFullYear()%1e4,t,4)}function z0(){return"+0000"}function U0(){return"%"}function H0(e){return+e}function W0(e){return Math.floor(+e/1e3)}function V0(e){const t={};return n=>t[n]||(t[n]=e(n))}function q0(e){const t=V0(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(e){const n=tZ(e||",");if(null==n.precision){switch(n.precision=12,n.type){case"%":n.precision-=2;break;case"e":n.precision-=1}return function(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let a=function(e,t){let n,r=e.lastIndexOf("e");if(r>0)return r;for(r=e.length;--r>t;)if(n=e.charCodeAt(r),n>=48&&n<=57)return r+1}(r,i);const o=a<r.length?r.slice(a):"";for(;--a>i;)if("0"!==r[a]){++a;break}return r.slice(0,a)+o}}(t(n),t(".1f")(1)[1])}return t(n)},formatSpan(e,r,i,a){a=tZ(null==a?",f":a);const o=QK(e,r,i),s=Math.max(Math.abs(e),Math.abs(r));let l;if(null==a.precision)switch(a.type){case"s":return isNaN(l=uZ(o,s))||(a.precision=l),n(a,s);case"":case"e":case"g":case"p":case"r":isNaN(l=cZ(o,s))||(a.precision=l-("e"===a.type));break;case"f":case"%":isNaN(l=dZ(o))||(a.precision=l-2*("%"===a.type))}return t(a)}}}let G0,Y0;function X0(){return G0=q0({format:oZ,formatPrefix:sZ})}function K0(e){return q0(vZ(e))}function Z0(e){return arguments.length?G0=K0(e):G0}function J0(e,t,n){eX(n=n||{})||FY("Invalid time multi-format specifier: ".concat(n));const r=t(nJ),i=t(tJ),a=t(eJ),o=t(ZZ),s=t(KZ),l=t(XZ),u=t(YZ),c=t(GZ),d=e(n[rJ]||".%L"),h=e(n[nJ]||":%S"),f=e(n[tJ]||"%I:%M"),p=e(n[eJ]||"%I %p"),m=e(n[ZZ]||n[JZ]||"%a %d"),g=e(n[KZ]||"%b %d"),v=e(n[XZ]||"%B"),y=e(n[YZ]||"%B"),b=e(n[GZ]||"%Y");return e=>(r(e)<e?d:i(e)<e?h:a(e)<e?f:o(e)<e?p:l(e)<e?s(e)<e?m:g:c(e)<e?u(e)<e?v:y:b)(e)}function Q0(e){const t=V0(e.format),n=V0(e.utcFormat);return{timeFormat:e=>XX(e)?t(e):J0(t,NJ,e),utcFormat:e=>XX(e)?n(e):J0(n,jJ,e),timeParse:V0(e.parse),utcParse:V0(e.utcParse)}}function e1(){return Y0=Q0({format:EQ,parse:TQ,utcFormat:kQ,utcParse:CQ})}function t1(e){return Q0(_Q(e))}function n1(e){return arguments.length?Y0=t1(e):Y0}SQ=_Q({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),EQ=SQ.format,TQ=SQ.parse,kQ=SQ.utcFormat,CQ=SQ.utcParse,X0(),e1();const r1=(e,t)=>jX({},e,t);function i1(e,t){const n=e?K0(e):Z0(),r=t?t1(t):n1();return r1(n,r)}function a1(e,t){const n=arguments.length;return n&&2!==n&&FY("defaultLocale expects either zero or two arguments."),n?r1(Z0(e),n1(t)):r1(Z0(),n1())}function o1(){return X0(),e1(),a1()}var s1=function(e,t,n,r){const i=qK((t=t||{}).type||"json");return i||FY("Unknown data format type: "+t.type),e=i(e,t),t.parse&&function(e,t,n,r){if(!e.length)return;const i=n1();n=n||i.timeParse,r=r||i.utcParse;let a,o,s,l,u,c,d=e.columns||Object.keys(e[0]);"auto"===t&&(t=kK(e,d)),d=Object.keys(t);const h=d.map(e=>{const i=t[e];let a,o;if(i&&(i.startsWith("date:")||i.startsWith("utc:")))return a=i.split(/:(.+)?/,2),o=a[1],("'"===o[0]&&"'"===o[o.length-1]||'"'===o[0]&&'"'===o[o.length-1])&&(o=o.slice(1,-1)),("utc"===a[0]?r:n)(o);if(!_K[i])throw Error("Illegal format pattern: "+e+":"+i);return _K[i]});for(s=0,u=e.length,c=d.length;s<u;++s)for(a=e[s],l=0;l<c;++l)o=d[l],a[o]=h[l](a[o])}(e,t.parse,n,r),LX(e,"columns")&&delete e.columns,e};const l1=function(e,t){return t=>({options:t||{},sanitize:gK,load:mK,fileAccess:!1,file:vK(null),http:bK(e)})}("undefined"!=typeof fetch&&fetch);function u1(e){const t=e||zY,n=[],r={};return n.add=e=>{const i=t(e);return r[i]||(r[i]=1,n.push(e)),n},n.remove=e=>{const i=t(e);if(r[i]){r[i]=0;const t=n.indexOf(e);t>=0&&n.splice(t,1)}return n},n}async function c1(e,t){try{await t(e)}catch(rBe){e.error(rBe)}}const d1=Symbol("vega_id");let h1=1;function f1(e){return!(!e||!p1(e))}function p1(e){return e[d1]}function m1(e,t){return e[d1]=t,e}function g1(e){const t=e===Object(e)?e:{data:e};return p1(t)?t:m1(t,h1++)}function v1(e){return y1(e,g1({}))}function y1(e,t){for(const n in e)t[n]=e[n];return t}function b1(e,t){return m1(t,p1(e))}function x1(e,t){return e?t?(n,r)=>e(n,r)||p1(t(n))-p1(t(r)):(t,n)=>e(t,n)||p1(t)-p1(n):null}function w1(e){return e&&e.constructor===_1}function _1(){const e=[],t=[],n=[],r=[],i=[];let a=null,o=!1;return{constructor:_1,insert(t){const n=EX(t),r=n.length;for(let i=0;i<r;++i)e.push(n[i]);return this},remove(e){const n=kX(e)?r:t,i=EX(e),a=i.length;for(let t=0;t<a;++t)n.push(i[t]);return this},modify(e,t,r){const a={field:t,value:MX(r)};return kX(e)?(a.filter=e,i.push(a)):(a.tuple=e,n.push(a)),this},encode(e,t){return kX(e)?i.push({filter:e,field:t}):n.push({tuple:e,field:t}),this},clean(e){return a=e,this},reflow(){return o=!0,this},pulse(s,l){const u={},c={};let d,h,f,p,m,g;for(d=0,h=l.length;d<h;++d)u[p1(l[d])]=1;for(d=0,h=t.length;d<h;++d)m=t[d],u[p1(m)]=-1;for(d=0,h=r.length;d<h;++d)p=r[d],l.forEach(e=>{p(e)&&(u[p1(e)]=-1)});for(d=0,h=e.length;d<h;++d)m=e[d],g=p1(m),u[g]?u[g]=1:s.add.push(g1(e[d]));for(d=0,h=l.length;d<h;++d)m=l[d],u[p1(m)]<0&&s.rem.push(m);function v(e,t,n){n?e[t]=n(e):s.encode=t,o||(c[p1(e)]=e)}for(d=0,h=n.length;d<h;++d)f=n[d],m=f.tuple,p=f.field,g=u[p1(m)],g>0&&(v(m,p,f.value),s.modifies(p));for(d=0,h=i.length;d<h;++d)f=i[d],p=f.filter,l.forEach(e=>{p(e)&&u[p1(e)]>0&&v(e,f.field,f.value)}),s.modifies(f.field);if(o)s.mod=t.length||r.length?l.filter(e=>u[p1(e)]>0):l.slice();else for(g in c)s.mod.push(c[g]);return(a||null==a&&(t.length||r.length))&&s.clean(!0),s}}}const S1="_:mod:_";function E1(){Object.defineProperty(this,S1,{writable:!0,value:{}})}E1.prototype={set(e,t,n,r){const i=this,a=i[e],o=i[S1];return null!=t&&t>=0?(a[t]!==n||r)&&(a[t]=n,o[t+":"+e]=-1,o[e]=-1):(a!==n||r)&&(i[e]=n,o[e]=QY(n)?1+n.length:-1),i},modified(e,t){const n=this[S1];if(!arguments.length){for(const e in n)if(n[e])return!0;return!1}if(QY(e)){for(let t=0;t<e.length;++t)if(n[e[t]])return!0;return!1}return null!=t&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[S1]={},this}};let T1=0;const k1=new E1;function C1(e,t,n,r){this.id=++T1,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,r)}function I1(e){return function(t){const n=this.flags;return 0===arguments.length?!!(n&e):(this.flags=t?n|e:n&~e,this)}}C1.prototype={targets(){return this._targets||(this._targets=u1(BY))},set(e){return this.value!==e?(this.value=e,1):0},skip:I1(1),modified:I1(2),parameters(e,t,n){t=!1!==t;const r=this._argval=this._argval||new E1,i=this._argops=this._argops||[],a=[];let o,s,l,u;const c=(e,n,o)=>{o instanceof C1?(o!==this&&(t&&o.targets().add(this),a.push(o)),i.push({op:o,name:e,index:n})):r.set(e,n,o)};for(o in e)if(s=e[o],"pulse"===o)EX(s).forEach(e=>{e instanceof C1?e!==this&&(e.targets().add(this),a.push(e)):FY("Pulse parameters must be operator instances.")}),this.source=s;else if(QY(s))for(r.set(o,-1,Array(l=s.length)),u=0;u<l;++u)c(o,u,s[u]);else c(o,-1,s);return this.marshall().clear(),n&&(i.initonly=!0),a},marshall(e){const t=this._argval||k1,n=this._argops;let r,i,a,o;if(n){const s=n.length;for(i=0;i<s;++i)r=n[i],a=r.op,o=a.modified()&&a.stamp===e,t.set(r.name,r.index,a.value,o);if(n.initonly){for(i=0;i<s;++i)r=n[i],r.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,r,i;if(e)for(t=0,n=e.length;t<n;++t)r=e[t],i=r.op,i._targets&&i._targets.remove(this)},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),r=t.call(this,n,e);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};let O1=0;function A1(e,t,n){this.id=++O1,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function D1(e,t,n){return new A1(e,t,n)}A1.prototype={_filter:WY,_apply:zY,targets(){return this._targets||(this._targets=u1(BY))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,r=n?n.length:0;for(let e=0;e<r;++e)n[e].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=D1(e);return this.targets().add(t),t},apply(e){const t=D1(null,e);return this.targets().add(t),t},merge(){const e=D1();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const n=Date.now();return n-t>e?(t=n,1):0})},debounce(e){const t=D1();return this.targets().add(D1(null,null,NX(e,e=>{const n=e.dataflow;t.receive(e),n&&n.run&&n.run()}))),t},between(e,t){let n=!1;return e.targets().add(D1(null,null,()=>n=!0)),t.targets().add(D1(null,null,()=>n=!1)),this.filter(()=>n)},detach(){}};const M1={skip:!0};function N1(e,t,n,r,i,a){const o=jX({},a,M1);let s,l;kX(n)||(n=MX(n)),void 0===r?s=t=>e.touch(n(t)):kX(r)?(l=new C1(null,r,i,!1),s=t=>{l.evaluate(t);const r=n(t),i=l.value;w1(i)?e.pulse(r,i,a):e.update(r,i,o)}):s=t=>e.update(n(t),r,o),t.apply(s)}function j1(e,t,n,r,i,a){if(void 0===r)t.targets().add(n);else{const o=a||{},s=new C1(null,function(e,t){return t=kX(t)?t:MX(t),e?function(n,r){const i=t(n,r);return e.skip()||(e.skip(i!==this.value).value=i),i}:t}(n,r),i,!1);s.modified(o.force),s.rank=t.rank,t.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),e.connect(n,[s]))}}const R1={};function P1(e,t,n){this.dataflow=e,this.stamp=null==t?-1:t,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function F1(e,t){const n=[];return cK(e,t,e=>n.push(e)),n}function L1(e,t){const n={};return e.visit(t,e=>{n[p1(e)]=1}),e=>n[p1(e)]?null:e}function $1(e,t){return e?(n,r)=>e(n,r)&&t(n,r):t}function B1(e,t,n,r){const i=this,a=n.length;let o=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=r||null,this.pulses=n;for(let s=0;s<a;++s){const e=n[s];if(e.stamp===t){if(e.fields){const t=i.fields||(i.fields={});for(const n in e.fields)t[n]=1}e.changed(i.ADD)&&(o|=i.ADD),e.changed(i.REM)&&(o|=i.REM),e.changed(i.MOD)&&(o|=i.MOD)}}this.changes=o}function z1(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}P1.prototype={StopPropagation:R1,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(e){return new P1(this.dataflow).init(this,e)},clone(){const e=this.fork(7);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(23)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new P1(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,!e.fields||64&t||(n.fields=e.fields),1&t?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),2&t?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),4&t?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),32&t?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||7;return 1&t&&this.add.length||2&t&&this.rem.length||4&t&&this.mod.length},reflow(e){if(e)return this.fork(7).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(4,L1(this,1))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return QY(e)?e.forEach(e=>t[e]=!0):t[e]=!0,this},modified(e,t){const n=this.fields;return!(!t&&!this.mod.length||!n)&&(arguments.length?QY(e)?e.some(e=>n[e]):n[e]:!!n)},filter(e,t){const n=this;return 1&e&&(n.addF=$1(n.addF,t)),2&e&&(n.remF=$1(n.remF,t)),4&e&&(n.modF=$1(n.modF,t)),16&e&&(n.srcF=$1(n.srcF,t)),n},materialize(e){const t=this;return 1&(e=e||7)&&t.addF&&(t.add=F1(t.add,t.addF),t.addF=null),2&e&&t.remF&&(t.rem=F1(t.rem,t.remF),t.remF=null),4&e&&t.modF&&(t.mod=F1(t.mod,t.modF),t.modF=null),16&e&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,r=t;if(16&e)return cK(n.source,n.srcF,r),n;1&e&&cK(n.add,n.addF,r),2&e&&cK(n.rem,n.remF,r),4&e&&cK(n.mod,n.modF,r);const i=n.source;if(8&e&&i){const e=n.add.length+n.mod.length;e===i.length||cK(i,e?L1(n,5):n.srcF,r)}return n}},UX(B1,P1,{fork(e){const t=new P1(this.dataflow).init(this,e&this.NO_FIELDS);return void 0!==e&&(e&t.ADD&&this.visit(t.ADD,e=>t.add.push(e)),e&t.REM&&this.visit(t.REM,e=>t.rem.push(e)),e&t.MOD&&this.visit(t.MOD,e=>t.mod.push(e))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?QY(e)?e.some(e=>n[e]):n[e]:0},filter(){FY("MultiPulse does not support filtering.")},materialize(){FY("MultiPulse does not support materialization.")},visit(e,t){const n=this,r=n.pulses,i=r.length;let a=0;if(e&n.SOURCE)for(;a<i;++a)r[a].visit(e,t);else for(;a<i;++a)r[a].stamp===n.stamp&&r[a].visit(e,t);return n}});const U1={skip:!1,force:!1};function H1(e,t,n,r){let i,a;const o=e[n];for(;n>t&&(a=n-1>>1,i=e[a],r(o,i)<0);)e[n]=i,n=a;return e[n]=o}function W1(){this.logger(JY()),this.logLevel(YY),this._clock=0,this._rank=0,this._locale=a1();try{this._loader=l1()}catch(e){}this._touched=u1(BY),this._input={},this._pulse=null,this._heap=function(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),H1(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let r;return t.length?(r=t[0],t[0]=n,function(e,t,n){const r=t,i=e.length,a=e[t];let o,s=1+(t<<1);for(;s<i;)o=s+1,o<i&&n(e[s],e[o])>=0&&(s=o),e[t]=e[s],s=1+((t=s)<<1);e[t]=a,H1(e,r,t,n)}(t,0,e)):r=n,r}}}((e,t)=>e.qrank-t.qrank),this._postrun=[]}function V1(e){return function(){return this._log[e].apply(this,arguments)}}function q1(e,t){C1.call(this,e,null,t)}W1.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:V1("error"),warn:V1("warn"),info:V1("info"),debug:V1("debug"),logLevel:V1("level"),cleanThreshold:1e4,add:function(e,t,n,r){let i,a=1;return e instanceof C1?i=e:e&&e.prototype instanceof C1?i=new e:kX(e)?i=new C1(null,e):(a=0,i=new C1(e,t)),this.rank(i),a&&(r=n,n=t),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},connect:function(e,t){const n=e.rank,r=t.length;for(let i=0;i<r;++i)if(n<t[i].rank)return void this.rerank(e)},rank:function(e){e.rank=++this._rank},rerank:function(e){const t=[e];let n,r,i;for(;t.length;)if(this.rank(n=t.pop()),r=n._targets)for(i=r.length;--i>=0;)t.push(n=r[i]),n===e&&FY("Cycle detected in dataflow graph.")},pulse:function(e,t,n){this.touch(e,n||U1);const r=new P1(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];return r.target=e,this._input[e.id]=t.pulse(r,i),this},touch:function(e,t){const n=t||U1;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this},update:function(e,t,n){const r=n||U1;return(e.set(t)||r.force)&&this.touch(e,r),this},changeset:_1,ingest:function(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))},parse:function(e,t){const n=this.locale();return s1(e,t,n.timeParse,n.utcParse)},preload:async function(e,t,n){const r=this,i=r._pending||function(e){let t;const n=new Promise(e=>t=e);return n.requests=0,n.done=()=>{0==--n.requests&&(e._pending=null,t(e))},e._pending=n}(r);i.requests+=1;const a=await r.request(t,n);return r.pulse(e,r.changeset().remove(WY).insert(a.data||[])),i.done(),a},request:async function(e,t){const n=this;let r,i=0;try{r=await n.loader().load(e,{context:"dataflow",response:GK(t&&t.type)});try{r=n.parse(r,t)}catch(rBe){i=-2,n.warn("Data ingestion failed",e,rBe)}}catch(rBe){i=-1,n.warn("Loading failed",e,rBe)}return{data:r,status:i}},events:function(e,t,n,r){const i=this,a=D1(n,r),o=function(e){e.dataflow=i;try{a.receive(e)}catch(t){i.error(t)}finally{i.run()}};let s;s="string"==typeof e&&"undefined"!=typeof document?document.querySelectorAll(e):EX(e);const l=s.length;for(let u=0;u<l;++u)s[u].addEventListener(t,o);return a},on:function(e,t,n,r,i){return(e instanceof C1?j1:N1)(this,e,t,n,r,i),this},evaluate:async function(e,t,n){const r=this,i=[];if(r._pulse)return z1(r);if(r._pending&&await r._pending,t&&await c1(r,t),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const a=++r._clock;r._pulse=new P1(r,a,e),r._touched.forEach(e=>r._enqueue(e,!0)),r._touched=u1(BY);let o,s,l,u=0;try{for(;r._heap.size()>0;)o=r._heap.pop(),o.rank===o.qrank?(s=o.run(r._getPulse(o,e)),s.then?s=await s:s.async&&(i.push(s.async),s=R1),s!==R1&&o._targets&&o._targets.forEach(e=>r._enqueue(e)),++u):r._enqueue(o,!0)}catch(rBe){r._heap.clear(),l=rBe}if(r._input={},r._pulse=null,r.debug("Pulse ".concat(a,": ").concat(u," operators")),l&&(r._postrun=[],r.error(l)),r._postrun.length){const e=r._postrun.sort((e,t)=>t.priority-e.priority);r._postrun=[];for(let t=0;t<e.length;++t)await c1(r,e[t].callback)}return n&&await c1(r,n),i.length&&Promise.all(i).then(e=>r.runAsync(null,()=>{e.forEach(e=>{try{e(r)}catch(rBe){r.error(rBe)}})})),r},run:function(e,t,n){return this._pulse?z1(this):(this.evaluate(e,t,n),this)},runAsync:async function(e,t,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(r,r),this._running},runAfter:function(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(rBe){this.error(rBe)}},_enqueue:function(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))},_getPulse:function(e,t){const n=e.source,r=this._clock;return n&&QY(n)?new B1(this,r,n.map(e=>e.pulse),t):this._input[e.id]||function(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==R1&&(e.source=t.source),e)}(this._pulse,n&&n.pulse)}},UX(q1,C1,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(e=>this.pulse=e):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const G1={};function Y1(e){const t=X1(e);return t&&t.Definition||null}function X1(e){return e=e&&e.toLowerCase(),LX(G1,e)?G1[e]:null}function K1(e,t){let n;if(void 0===t)for(const r of e)null!=r&&(n<r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function Z1(e,t){let n;if(void 0===t)for(const r of e)null!=r&&(n>r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function J1(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}var Q1=function(e){return null===e?NaN:+e};function e2(e,t,n){if(r=(e=Float64Array.from(function*(e,t){if(void 0===t)for(let n of e)null!=n&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)null!=(r=t(r,++n,e))&&(r=+r)>=r&&(yield r)}}(e,n))).length){if((t=+t)<=0||r<2)return Z1(e);if(t>=1)return K1(e);var r,i=(r-1)*t,a=Math.floor(i),o=K1(function e(t,n,r=0,i=t.length-1,a=VZ){for(;i>r;){if(i-r>600){const o=i-r+1,s=n-r+1,l=Math.log(o),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(o-u)/o)*(s-o/2<0?-1:1);e(t,n,Math.max(r,Math.floor(n-s*u/o+c)),Math.min(i,Math.floor(n+(o-s)*u/o+c)),a)}const o=t[n];let s=r,l=i;for(J1(t,r,n),a(t[i],o)>0&&J1(t,r,i);s<l;){for(J1(t,s,l),++s,--l;a(t[s],o)<0;)++s;for(;a(t[l],o)>0;)--l}0===a(t[r],o)?J1(t,r,l):(++l,J1(t,l,i)),l<=n&&(r=l+1),n<=l&&(i=l-1)}return t}(e,a).subarray(0,a+1));return o+(Z1(e.subarray(a+1))-o)*(i-a)}}function t2(e,t,n=Q1){if(r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),o=+n(e[a],a,e);return o+(+n(e[a+1],a+1,e)-o)*(i-a)}}var n2=function(e,t){return e2(e,.5,t)};function*r2(e,t){if(null==t)for(let n of e)null!=n&&""!==n&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)r=t(r,++n,e),null!=r&&""!==r&&(r=+r)>=r&&(yield r)}}function i2(e,t,n){const r=Float64Array.from(r2(e,n));return r.sort(VZ),t.map(e=>t2(r,e))}function a2(e,t){return i2(e,[.25,.5,.75],t)}function o2(e,t){const n=e.length,r=function(e,t){const n=function(e,t){let n,r=0,i=0,a=0;if(void 0===t)for(let o of e)null!=o&&(o=+o)>=o&&(n=o-i,i+=n/++r,a+=n*(o-i));else{let o=-1;for(let s of e)null!=(s=t(s,++o,e))&&(s=+s)>=s&&(n=s-i,i+=n/++r,a+=n*(s-i))}if(r>1)return a/(r-1)}(e,t);return n?Math.sqrt(n):n}(e,t),i=a2(e,t);return 1.06*(Math.min(r,(i[2]-i[0])/1.34)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function s2(e){const t=e.maxbins||20,n=e.base||10,r=Math.log(n),i=e.divide||[5,2];let a,o,s,l,u,c,d=e.extent[0],h=e.extent[1];const f=e.span||h-d||Math.abs(d)||1;if(e.step)a=e.step;else if(e.steps){for(l=f/t,u=0,c=e.steps.length;u<c&&e.steps[u]<l;++u);a=e.steps[Math.max(0,u-1)]}else{for(o=Math.ceil(Math.log(t)/r),s=e.minstep||0,a=Math.max(s,Math.pow(n,Math.round(Math.log(f)/r)-o));Math.ceil(f/a)>t;)a*=n;for(u=0,c=i.length;u<c;++u)l=a/i[u],l>=s&&f/l<=t&&(a=l)}l=Math.log(a);const p=Math.pow(n,-(l>=0?0:1+~~(-l/r))-1);return(e.nice||void 0===e.nice)&&(l=Math.floor(d/a+p)*a,d=d<l?l-a:l,h=Math.ceil(h/a)*a),{start:d,stop:h===d?d+a:h,step:a}}var l2=Math.random;function u2(e){l2=e}function c2(e,t,n,r){if(!e.length)return[void 0,void 0];const i=Float64Array.from(r2(e,r)),a=i.length,o=t;let s,l,u,c;for(u=0,c=Array(o);u<o;++u){for(s=0,l=0;l<a;++l)s+=i[~~(l2()*a)];c[u]=s/a}return c.sort(VZ),[e2(c,n/2),e2(c,1-n/2)]}function d2(e,t,n,r){r=r||(e=>e);const i=e.length,a=new Float64Array(i);let o,s=0,l=1,u=r(e[0]),c=u,d=u+t;for(;l<i;++l){if(o=r(e[l]),o>=d){for(c=(u+c)/2;s<l;++s)a[s]=c;d=o+t,u=o}c=o}for(c=(u+c)/2;s<l;++s)a[s]=c;return n?function(e,t){const n=e.length;let r,i,a=0,o=1;for(;e[a]===e[o];)++o;for(;o<n;){for(r=o+1;e[o]===e[r];)++r;if(e[o]-e[o-1]<t){for(i=o+(a+r-o-o>>1);i<o;)e[i++]=e[o];for(;i>o;)e[i--]=e[a]}a=o,o=r}return e}(a,t+t/4):a}function h2(e){return function(){return(e=(1103515245*e+12345)%2147483647)/2147483647}}function f2(e,t){let n,r,i;null==t&&(t=e,e=0);const a={min(e){return arguments.length?(n=e||0,i=r-n,a):n},max(e){return arguments.length?(r=e||0,i=r-n,a):r},sample:()=>n+Math.floor(i*l2()),pdf:e=>e===Math.floor(e)&&e>=n&&e<r?1/i:0,cdf(e){const t=Math.floor(e);return t<n?0:t>=r?1:(t-n+1)/i},icdf:e=>e>=0&&e<=1?n-1+Math.floor(e*i):NaN};return a.min(e).max(t)}const p2=Math.sqrt(2*Math.PI),m2=Math.SQRT2;let g2=NaN;function v2(e,t){e=e||0,t=null==t?1:t;let n,r,i=0,a=0;if(g2==g2)i=g2,g2=NaN;else{do{i=2*l2()-1,a=2*l2()-1,n=i*i+a*a}while(0===n||n>1);r=Math.sqrt(-2*Math.log(n)/n),i*=r,g2=a*r}return e+i*t}function y2(e,t,n){const r=(e-(t||0))/(n=null==n?1:n);return Math.exp(-.5*r*r)/(n*p2)}function b2(e,t,n){const r=(e-(t=t||0))/(n=null==n?1:n),i=Math.abs(r);let a;if(i>37)a=0;else{const e=Math.exp(-i*i/2);let t;i<7.07106781186547?(t=.0352624965998911*i+.700383064443688,t=t*i+6.37396220353165,t=t*i+33.912866078383,t=t*i+112.079291497871,t=t*i+221.213596169931,t=t*i+220.206867912376,a=e*t,t=.0883883476483184*i+1.75566716318264,t=t*i+16.064177579207,t=t*i+86.7807322029461,t=t*i+296.564248779674,t=t*i+637.333633378831,t=t*i+793.826512519948,t=t*i+440.413735824752,a/=t):(t=i+.65,t=i+4/t,t=i+3/t,t=i+2/t,t=i+1/t,a=e/t/2.506628274631)}return r>0?1-a:a}function x2(e,t,n){return e<0||e>1?NaN:(t||0)+(null==n?1:n)*m2*function(e){let t,n=-Math.log((1-e)*(1+e));return n<6.25?(n-=3.125,t=-364441206401782e-35,t=t*n-16850591381820166e-35,t=128584807152564e-32+t*n,t=11157877678025181e-33+t*n,t=t*n-1333171662854621e-31,t=20972767875968562e-33+t*n,t=6637638134358324e-30+t*n,t=t*n-4054566272975207e-29,t=t*n-8151934197605472e-29,t=26335093153082323e-28+t*n,t=t*n-12975133253453532e-27,t=t*n-5415412054294628e-26,t=1.0512122733215323e-9+t*n,t=t*n-4.112633980346984e-9,t=t*n-2.9070369957882005e-8,t=4.2347877827932404e-7+t*n,t=t*n-13654692000834679e-22,t=t*n-13882523362786469e-21,t=.00018673420803405714+t*n,t=t*n-.000740702534166267,t=t*n-.006033670871430149,t=.24015818242558962+t*n,t=1.6536545626831027+t*n):n<16?(n=Math.sqrt(n)-3.25,t=2.2137376921775787e-9,t=9.075656193888539e-8+t*n,t=t*n-2.7517406297064545e-7,t=1.8239629214389228e-8+t*n,t=15027403968909828e-22+t*n,t=t*n-4013867526981546e-21,t=29234449089955446e-22+t*n,t=12475304481671779e-21+t*n,t=t*n-47318229009055734e-21,t=6828485145957318e-20+t*n,t=24031110387097894e-21+t*n,t=t*n-.0003550375203628475,t=.0009532893797373805+t*n,t=t*n-.0016882755560235047,t=.002491442096107851+t*n,t=t*n-.003751208507569241,t=.005370914553590064+t*n,t=1.0052589676941592+t*n,t=3.0838856104922208+t*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,t=-27109920616438573e-27,t=t*n-2.555641816996525e-10,t=1.5076572693500548e-9+t*n,t=t*n-3.789465440126737e-9,t=7.61570120807834e-9+t*n,t=t*n-1.496002662714924e-8,t=2.914795345090108e-8+t*n,t=t*n-6.771199775845234e-8,t=2.2900482228026655e-7+t*n,t=t*n-9.9298272942317e-7,t=4526062597223154e-21+t*n,t=t*n-1968177810553167e-20,t=7599527703001776e-20+t*n,t=t*n-.00021503011930044477,t=t*n-.00013871931833623122,t=1.0103004648645344+t*n,t=4.849906401408584+t*n):t=1/0,t*e}(2*e-1)}function w2(e,t){let n,r;const i={mean(e){return arguments.length?(n=e||0,i):n},stdev(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>v2(n,r),pdf:e=>y2(e,n,r),cdf:e=>b2(e,n,r),icdf:e=>x2(e,n,r)};return i.mean(e).stdev(t)}function _2(e,t){const n=w2();let r=0;const i={data(n){return arguments.length?(e=n,r=n?n.length:0,i.bandwidth(t)):e},bandwidth(n){return arguments.length?(!(t=n)&&e&&(t=o2(e)),i):t},sample:()=>e[~~(l2()*r)]+t*n.sample(),pdf(i){let a=0,o=0;for(;o<r;++o)a+=n.pdf((i-e[o])/t);return a/t/r},cdf(i){let a=0,o=0;for(;o<r;++o)a+=n.cdf((i-e[o])/t);return a/r},icdf(){throw Error("KDE icdf not supported.")}};return i.data(e)}function S2(e,t){return e=e||0,t=null==t?1:t,Math.exp(e+v2()*t)}function E2(e,t,n){if(e<=0)return 0;t=t||0,n=null==n?1:n;const r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*p2*e)}function T2(e,t,n){return b2(Math.log(e),t,n)}function k2(e,t,n){return Math.exp(x2(e,t,n))}function C2(e,t){let n,r;const i={mean(e){return arguments.length?(n=e||0,i):n},stdev(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>S2(n,r),pdf:e=>E2(e,n,r),cdf:e=>T2(e,n,r),icdf:e=>k2(e,n,r)};return i.mean(e).stdev(t)}function I2(e,t){let n,r=0;const i={weights(e){return arguments.length?(n=function(e){const t=[];let n,i=0;for(n=0;n<r;++n)i+=t[n]=null==e[n]?1:+e[n];for(n=0;n<r;++n)t[n]/=i;return t}(t=e||[]),i):t},distributions(n){return arguments.length?(n?(r=n.length,e=n):(r=0,e=[]),i.weights(t)):e},sample(){const t=l2();let i=e[r-1],a=n[0],o=0;for(;o<r-1;a+=n[++o])if(t<a){i=e[o];break}return i.sample()},pdf(t){let i=0,a=0;for(;a<r;++a)i+=n[a]*e[a].pdf(t);return i},cdf(t){let i=0,a=0;for(;a<r;++a)i+=n[a]*e[a].cdf(t);return i},icdf(){throw Error("Mixture icdf not supported.")}};return i.distributions(e).weights(t)}function O2(e,t){return null==t&&(t=null==e?1:e,e=0),e+(t-e)*l2()}function A2(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=t&&e<=n?1/(n-t):0}function D2(e,t,n){return null==n&&(n=null==t?1:t,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function M2(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function N2(e,t){let n,r;const i={min(e){return arguments.length?(n=e||0,i):n},max(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>O2(n,r),pdf:e=>A2(e,n,r),cdf:e=>D2(e,n,r),icdf:e=>M2(e,n,r)};return null==t&&(t=null==e?1:e,e=0),i.min(e).max(t)}function j2(e,t,n,r){const i=r-e*e,a=Math.abs(i)<1e-24?0:(n-e*t)/i;return[t-a*e,a]}function R2(e,t,n,r){e=e.filter(e=>{let r=t(e),i=n(e);return null!=r&&(r=+r)>=r&&null!=i&&(i=+i)>=i}),r&&e.sort((e,n)=>t(e)-t(n));const i=e.length,a=new Float64Array(i),o=new Float64Array(i);let s,l,u,c=0,d=0,h=0;for(u of e)a[c]=s=+t(u),o[c]=l=+n(u),++c,d+=(s-d)/c,h+=(l-h)/c;for(c=0;c<i;++c)a[c]-=d,o[c]-=h;return[a,o,d,h]}function P2(e,t,n,r){let i,a,o=-1;for(const s of e)i=t(s),a=n(s),null!=i&&(i=+i)>=i&&null!=a&&(a=+a)>=a&&r(i,a,++o)}function F2(e,t,n,r,i){let a=0,o=0;return P2(e,t,n,(e,t)=>{const n=t-i(e),s=t-r;a+=n*n,o+=s*s}),1-a/o}function L2(e,t,n){let r=0,i=0,a=0,o=0,s=0;P2(e,t,n,(e,t)=>{++s,r+=(e-r)/s,i+=(t-i)/s,a+=(e*t-a)/s,o+=(e*e-o)/s});const l=j2(r,i,a,o),u=e=>l[0]+l[1]*e;return{coef:l,predict:u,rSquared:F2(e,t,n,i,u)}}function $2(e,t,n){let r=0,i=0,a=0,o=0,s=0;P2(e,t,n,(e,t)=>{++s,e=Math.log(e),r+=(e-r)/s,i+=(t-i)/s,a+=(e*t-a)/s,o+=(e*e-o)/s});const l=j2(r,i,a,o),u=e=>l[0]+l[1]*Math.log(e);return{coef:l,predict:u,rSquared:F2(e,t,n,i,u)}}function B2(e,t,n){const[r,i,a,o]=R2(e,t,n);let s,l,u,c=0,d=0,h=0,f=0,p=0;P2(e,t,n,(e,t)=>{s=r[p++],l=Math.log(t),u=s*t,c+=(t*l-c)/p,d+=(u-d)/p,h+=(u*l-h)/p,f+=(s*u-f)/p});const[m,g]=j2(d/o,c/o,h/o,f/o),v=e=>Math.exp(m+g*(e-a));return{coef:[Math.exp(m-g*a),g],predict:v,rSquared:F2(e,t,n,o,v)}}function z2(e,t,n){let r=0,i=0,a=0,o=0,s=0,l=0;P2(e,t,n,(e,t)=>{const n=Math.log(e),u=Math.log(t);++l,r+=(n-r)/l,i+=(u-i)/l,a+=(n*u-a)/l,o+=(n*n-o)/l,s+=(t-s)/l});const u=j2(r,i,a,o),c=e=>u[0]*Math.pow(e,u[1]);return u[0]=Math.exp(u[0]),{coef:u,predict:c,rSquared:F2(e,t,n,s,c)}}function U2(e,t,n){const[r,i,a,o]=R2(e,t,n),s=r.length;let l,u,c,d,h=0,f=0,p=0,m=0,g=0;for(l=0;l<s;)u=r[l],c=i[l++],d=u*u,h+=(d-h)/l,f+=(d*u-f)/l,p+=(d*d-p)/l,m+=(u*c-m)/l,g+=(d*c-g)/l;const v=p-h*h,y=h*v-f*f,b=(g*h-m*f)/y,x=(m*v-g*f)/y,w=-b*h,_=e=>b*(e-=a)*e+x*e+w+o;return{coef:[w-x*a+b*a*a+o,x-2*b*a,b],predict:_,rSquared:F2(e,t,n,o,_)}}function H2(e,t,n,r){if(1===r)return L2(e,t,n);if(2===r)return U2(e,t,n);const[i,a,o,s]=R2(e,t,n),l=i.length,u=[],c=[],d=r+1;let h,f,p,m,g;for(h=0;h<d;++h){for(p=0,m=0;p<l;++p)m+=Math.pow(i[p],h)*a[p];for(u.push(m),g=new Float64Array(d),f=0;f<d;++f){for(p=0,m=0;p<l;++p)m+=Math.pow(i[p],h+f);g[f]=m}c.push(g)}c.push(u);const v=function(e){const t=e.length-1,n=[];let r,i,a,o,s;for(r=0;r<t;++r){for(o=r,i=r+1;i<t;++i)Math.abs(e[r][i])>Math.abs(e[r][o])&&(o=i);for(a=r;a<t+1;++a)s=e[a][r],e[a][r]=e[a][o],e[a][o]=s;for(i=r+1;i<t;++i)for(a=t;a>=r;a--)e[a][i]-=e[a][r]*e[r][i]/e[r][r]}for(i=t-1;i>=0;--i){for(s=0,a=i+1;a<t;++a)s+=e[a][i]*n[a];n[i]=(e[t][i]-s)/e[i][i]}return n}(c),y=e=>{let t=s+v[0]+v[1]*(e-=o)+v[2]*e*e;for(h=3;h<d;++h)t+=v[h]*Math.pow(e,h);return t};return{coef:W2(d,v,-o,s),predict:y,rSquared:F2(e,t,n,s,y)}}function W2(e,t,n,r){const i=Array(e);let a,o,s,l;for(a=0;a<e;++a)i[a]=0;for(a=e-1;a>=0;--a)for(s=t[a],l=1,i[a]+=s,o=1;o<=a;++o)l*=(a+1-o)/o,i[a-o]+=s*Math.pow(n,o)*l;return i[0]+=r,i}function V2(e,t,n,r){const[i,a,o,s]=R2(e,t,n,!0),l=i.length,u=Math.max(2,~~(r*l)),c=new Float64Array(l),d=new Float64Array(l),h=new Float64Array(l).fill(1);for(let f=-1;++f<=2;){const e=[0,u-1];for(let n=0;n<l;++n){const t=i[n],r=e[0],o=e[1];let s=0,l=0,u=0,f=0,p=0;const m=1/Math.abs(i[t-i[r]>i[o]-t?r:o]-t||1);for(let e=r;e<=o;++e){const n=i[e],r=a[e],o=q2(Math.abs(t-n)*m)*h[e],c=n*o;s+=o,l+=c,u+=r*o,f+=r*c,p+=n*c}const[g,v]=j2(l/s,u/s,f/s,p/s);c[n]=g+v*t,d[n]=Math.abs(a[n]-c[n]),G2(i,n+1,e)}if(2===f)break;const t=n2(d);if(Math.abs(t)<1e-12)break;for(let n,r,i=0;i<l;++i)n=d[i]/(6*t),h[i]=n>=1?1e-12:(r=1-n*n)*r}return function(e,t,n,r){const i=e.length,a=[];let o,s=0,l=0,u=[];for(;s<i;++s)o=e[s]+n,u[0]===o?u[1]+=(t[s]-u[1])/++l:(l=0,u[1]+=r,u=[o,t[s]],a.push(u));return u[1]+=r,a}(i,c,o,s)}function q2(e){return(e=1-e*e*e)*e*e}function G2(e,t,n){const r=e[t];let i=n[0],a=n[1]+1;if(!(a>=e.length))for(;t>i&&e[a]-r<=r-e[i];)n[0]=++i,n[1]=a,++a}const Y2=.1*Math.PI/180;function X2(e,t,n,r){n=n||25,r=Math.max(n,r||200);const i=t=>[t,e(t)],a=t[0],o=t[1],s=o-a,l=s/r,u=[i(a)],c=[];if(n===r){for(let e=1;e<r;++e)u.push(i(a+e/n*s));return u.push(i(o)),u}c.push(i(o));for(let f=n;--f>0;)c.push(i(a+f/n*s));let d=u[0],h=c[c.length-1];for(;h;){const e=i((d[0]+h[0])/2);e[0]-d[0]>=l&&K2(d,e,h)>Y2?c.push(e):(d=h,u.push(h),c.pop()),h=c[c.length-1]}return u}function K2(e,t,n){const r=Math.atan2(n[1]-e[1],n[0]-e[0]),i=Math.atan2(t[1]-e[1],t[0]-e[0]);return Math.abs(r-i)}var Z2=function(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),a=new Array(i);++r<i;)a[r]=e+r*n;return a};function J2(e){return e&&e.length?1===e.length?e[0]:(t=e,e=>{const n=t.length;let r=1,i=String(t[0](e));for(;r<n;++r)i+="|"+t[r](e);return i}):function(){return""};var t}function Q2(e,t,n){return n||e+(t?"_"+t:"")}const e5=()=>{},t5={init:e5,add:e5,rem:e5,idx:0},n5={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||void 0===e.min)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||void 0===e.max)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},r5=Object.keys(n5);function i5(e,t){return n5[e](t)}function a5(e,t){return e.idx-t.idx}function o5(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function s5(e,t){null!=e&&""!==e?e==e&&(++this.valid,this._ops.forEach(n=>n.add(this,e,t))):++this.missing}function l5(e,t){null!=e&&""!==e?e==e&&(--this.valid,this._ops.forEach(n=>n.rem(this,e,t))):--this.missing}function u5(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function c5(e,t){const n=t||zY,r=function(e){const t={};e.forEach(e=>t[e.name]=e);const n=e=>{e.req&&e.req.forEach(e=>{t[e]||n(t[e]=n5[e]())})};return e.forEach(n),Object.values(t).sort(a5)}(e),i=e.slice().sort(a5);function a(e){this._ops=r,this._out=i,this.cell=e,this.init()}return a.prototype.init=o5,a.prototype.add=s5,a.prototype.rem=l5,a.prototype.set=u5,a.prototype.get=n,a.fields=e.map(e=>e.out),a}function d5(e){this._key=e?$Y(e):p1,this.reset()}r5.forEach(e=>{n5[e]=function(e,t){return n=>jX({name:e,out:n||e},t5,t)}(e,n5[e])});const h5=d5.prototype;function f5(e){q1.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}function p5(e){q1.call(this,null,e)}function m5(e,t,n){const r=e;let i=t||[],a=n||[],o={},s=0;return{add:e=>a.push(e),remove:e=>o[r(e)]=++s,size:()=>i.length,data:(e,t)=>(s&&(i=i.filter(e=>!o[r(e)]),o={},s=0),t&&e&&i.sort(e),a.length&&(i=e?QX(e,i,a.sort(e)):i.concat(a),a=[]),i)}}function g5(e){q1.call(this,[],e)}function v5(e){C1.call(this,null,y5,e)}function y5(e){return this.value&&!e.modified()?this.value:CX(e.fields,e.orders)}function b5(e){q1.call(this,null,e)}function x5(e){q1.call(this,null,e)}h5.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},h5.add=function(e){this._add.push(e)},h5.rem=function(e){this._rem.push(e)},h5.values=function(){if(this._get=null,0===this._rem.length)return this._add;const e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,a=Array(r-i),o={};let s,l,u;for(s=0;s<i;++s)o[n(t[s])]=1;for(s=0,l=0;s<r;++s)o[n(u=e[s])]?o[n(u)]=0:a[l++]=u;return this._rem=[],this._add=a},h5.distinct=function(e){const t=this.values(),n={};let r,i=t.length,a=0;for(;--i>=0;)r=e(t[i])+"",LX(n,r)||(n[r]=1,++a);return a},h5.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=PX(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},h5.argmin=function(e){return this.extent(e)[0]||{}},h5.argmax=function(e){return this.extent(e)[1]||{}},h5.min=function(e){const t=this.extent(e)[0];return null!=t?e(t):void 0},h5.max=function(e){const t=this.extent(e)[1];return null!=t?e(t):void 0},h5.quartile=function(e){return this._get===e&&this._q||(this._q=a2(this.values(),e),this._get=e),this._q},h5.q1=function(e){return this.quartile(e)[0]},h5.q2=function(e){return this.quartile(e)[1]},h5.q3=function(e){return this.quartile(e)[2]},h5.ci=function(e){return this._get===e&&this._ci||(this._ci=c2(this.values(),1e3,.05,e),this._get=e),this._ci},h5.ci0=function(e){return this.ci(e)[0]},h5.ci1=function(e){return this.ci(e)[1]},f5.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:r5},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},UX(f5,q1,{transform(e,t){const n=this,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.modified();return n.stamp=r.stamp,n.value&&(i||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(e):{},t.visit(t.SOURCE,e=>n.add(e))):(n.value=n.value||n.init(e),t.visit(t.REM,e=>n.rem(e)),t.visit(t.ADD,e=>n.add(e))),r.modifies(n._outputs),n._drop=!1!==e.drop,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&r.clean(!0).runAfter(()=>this.clean()),n.changes(r)},cross(){const e=this,t=e.value,n=e._dnames,r=n.map(()=>({})),i=n.length;function a(e){let t,a,o,s;for(t in e)for(o=e[t].tuple,a=0;a<i;++a)r[a][s=o[n[a]]]=s}a(e._prev),a(t),function a(o,s,l){const u=n[l],c=r[l++];for(const n in c){const r=o?o+"|"+n:n;s[u]=c[n],l<i?a(r,s,l):t[r]||e.cell(r,s)}}("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],r={};function i(e){const n=EX(NY(e)),i=n.length;let a,o=0;for(;o<i;++o)r[a=n[o]]||(r[a]=1,t.push(a))}this._dims=EX(e.groupby),this._dnames=this._dims.map(e=>{const t=MY(e);return i(e),n.push(t),t}),this.cellkey=e.key?e.key:J2(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const a=e.fields||[null],o=e.ops||["count"],s=e.as||[],l=a.length,u={};let c,d,h,f,p,m;for(l!==o.length&&FY("Unmatched number of fields and aggregate ops."),m=0;m<l;++m)c=a[m],d=o[m],null==c&&"count"!==d&&FY("Null aggregate field specified."),f=MY(c),p=Q2(d,f,s[m]),n.push(p),"count"!==d?(h=u[f],h||(i(c),h=u[f]=[],h.field=c,this._measures.push(h)),"count"!==d&&(this._countOnly=!1),h.push(i5(d,p))):this._counts.push(p);return this._measures=this._measures.map(e=>c5(e,e.field)),{}},cellkey:J2(),cell(e,t){let n=this.value[e];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const e=this._measures,t=e.length;n.agg=Array(t);for(let r=0;r<t;++r)n.agg[r]=new e[r](n)}return n.store&&(n.data=new d5),n},newtuple(e,t){const n=this._dnames,r=this._dims,i=r.length,a={};for(let o=0;o<i;++o)a[n[o]]=r[o](e);return t?b1(t.tuple,a):g1(a)},clean(){const e=this.value;for(const t in e)0===e[t].num&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const r=n.agg;for(let i=0,a=r.length;i<a;++i)r[i].add(r[i].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const r=n.agg;for(let i=0,a=r.length;i<a;++i)r[i].rem(r[i].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let r=0,i=n.length;r<i;++r)t[n[r]]=e.num;if(!this._countOnly){const n=e.agg;for(let e=0,r=n.length;e<r;++e)n[e].set(t)}return t},changes(e){const t=this._adds,n=this._mods,r=this._prev,i=this._drop,a=e.add,o=e.rem,s=e.mod;let l,u,c,d;if(r)for(u in r)l=r[u],i&&!l.num||o.push(l.tuple);for(c=0,d=this._alen;c<d;++c)a.push(this.celltuple(t[c])),t[c]=null;for(c=0,d=this._mlen;c<d;++c)l=n[c],(0===l.num&&i?o:s).push(this.celltuple(l)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}}),p5.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},UX(p5,q1,{transform(e,t){const n=!1!==e.interval,r=this._bins(e),i=r.start,a=r.step,o=e.as||["bin0","bin1"],s=o[0],l=o[1];let u;return u=e.modified()?(t=t.reflow(!0)).SOURCE:t.modified(NY(e.field))?t.ADD_MOD:t.ADD,t.visit(u,n?e=>{const t=r(e);e[s]=t,e[l]=null==t?null:i+a*(1+(t-i)/a)}:e=>e[s]=r(e)),t.modifies(n?o:s)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=s2(e),r=n.step;let i,a,o=n.start,s=o+Math.ceil((n.stop-o)/r)*r;null!=(i=e.anchor)&&(a=i-(o+r*Math.floor((i-o)/r)),o+=a,s+=a);const l=function(e){let n=oX(t(e));return null==n?null:n<o?-1/0:n>s?1/0:(n=Math.max(o,Math.min(n,s-r)),o+r*Math.floor(1e-14+(n-o)/r))};return l.start=o,l.stop=n.stop,l.step=r,this.value=DY(l,NY(t),e.name||"bin_"+MY(t))}}),g5.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},UX(g5,q1,{transform(e,t){const n=t.fork(t.ALL),r=m5(p1,this.value,n.materialize(n.ADD).add),i=e.sort,a=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(a),this.value=n.source=r.data(x1(i),a),t.source&&t.source.root&&(this.value.root=t.source.root),n}}),UX(v5,C1),b5.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},UX(b5,q1,{transform(e,t){const n=t=>n=>{for(var r,i=function(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase()}return e.match(n)}(s(n),e.case,a)||[],l=0,u=i.length;l<u;++l)o.test(r=i[l])||t(r)},r=this._parameterCheck(e,t),i=this._counts,a=this._match,o=this._stop,s=e.field,l=e.as||["text","count"],u=n(e=>i[e]=1+(i[e]||0)),c=n(e=>i[e]-=1);return r?t.visit(t.SOURCE,u):(t.visit(t.ADD,u),t.visit(t.REM,c)),this._finish(t,l)},_parameterCheck(e,t){let n=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],a=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS);let s,l,u;for(s in n)l=r[s],u=n[s]||0,!l&&u?(r[s]=l=g1({}),l[i]=s,l[a]=u,o.add.push(l)):0===u?(l&&o.rem.push(l),n[s]=null,r[s]=null):l[a]!==u&&(l[a]=u,o.mod.push(l));return o.modifies(t)}}),x5.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},UX(x5,q1,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],a=r[1],o=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let s=this.value;return o?(s&&(n.rem=s),s=t.materialize(t.SOURCE).source,n.add=this.value=function(e,t,n,r){for(var i,a,o=[],s={},l=e.length,u=0;u<l;++u)for(s[t]=a=e[u],i=0;i<l;++i)s[n]=e[i],r(s)&&(o.push(g1(s)),(s={})[t]=a);return o}(s,i,a,e.filter||WY)):n.mod=s,n.source=this.value,n.modifies(r)}});const w5={kde:_2,mixture:I2,normal:w2,lognormal:C2,uniform:N2};function _5(e){q1.call(this,null,e)}const S5=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}];function E5(e,t){return e?e.map((e,n)=>t[n]||MY(e)):null}function T5(e,t,n){const r=[],i=e=>e(l);let a,o,s,l,u,c;if(null==t)r.push(e.map(n));else for(a={},o=0,s=e.length;o<s;++o)l=e[o],u=t.map(i),c=a[u],c||(a[u]=c=[],c.dims=u,r.push(c)),c.push(n(l));return r}function k5(e){q1.call(this,null,e)}function C5(e){C1.call(this,null,I5,e),this.modified(!0)}function I5(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:DY(n=>t(n,e),NY(t),MY(t))}function O5(e){q1.call(this,[void 0,void 0],e)}function A5(e,t){C1.call(this,e),this.parent=t,this.count=0}function D5(e){q1.call(this,{},e),this._keys=BX();const t=this._targets=[];t.active=0,t.forEach=e=>{for(let n=0,r=t.active;n<r;++n)e(t[n],n,t)}}function M5(e){C1.call(this,null,N5,e)}function N5(e){return this.value&&!e.modified()?this.value:QY(e.name)?EX(e.name).map(e=>$Y(e)):$Y(e.name,e.as)}function j5(e){q1.call(this,BX(),e)}function R5(e){q1.call(this,[],e)}function P5(e){q1.call(this,[],e)}function F5(e){q1.call(this,null,e)}function L5(e){q1.call(this,[],e)}_5.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:S5.concat({key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:S5},{name:"weights",type:"number",array:!0}]})},{name:"as",type:"string",array:!0,default:["value","density"]}]},UX(_5,q1,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=function e(t,n){const r=t.function;LX(w5,r)||FY("Unknown distribution function: "+r);const i=w5[r]();for(const a in t)"field"===a?i.data((t.from||n()).map(t[a])):"distributions"===a?i[a](t[a].map(t=>e(t,n))):"function"==typeof i[a]&&i[a](t[a]);return i}(e.distribution,function(e){return()=>e.materialize(e.SOURCE).source}(t)),i=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200;let o=e.method||"pdf";"pdf"!==o&&"cdf"!==o&&FY("Invalid density method: "+o),e.extent||r.data||FY("Missing density extent parameter."),o=r[o];const s=e.as||["value","density"],l=X2(o,e.extent||RX(r.data()),i,a).map(e=>{const t={};return t[s[0]]=e[0],t[s[1]]=e[1],g1(t)});this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}}),k5.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]},UX(k5,q1,{transform(e,t){if(this.value&&!e.modified()&&!t.changed())return t;const n=t.materialize(t.SOURCE).source,r=T5(t.source,e.groupby,zY),i=e.smooth||!1,a=e.field,o=e.step||((e,t)=>nK(RX(e,t))/30)(n,a),s=x1((e,t)=>a(e)-a(t)),l=e.as||"bin",u=r.length;let c,d=1/0,h=-1/0,f=0;for(;f<u;++f){const e=r[f].sort(s);c=-1;for(const t of d2(e,o,i,a))t<d&&(d=t),t>h&&(h=t),e[++c][l]=t}return this.value={start:d,stop:h,step:o},t.reflow(!0).modifies(l)}}),UX(C5,C1),O5.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},UX(O5,q1,{transform(e,t){const n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field");let a=n[0],o=n[1];if((i||null==a)&&(a=1/0,o=-1/0),t.visit(i?t.SOURCE:t.ADD,e=>{const t=oX(r(e));null!=t&&(t<a&&(a=t),t>o&&(o=t))}),!Number.isFinite(a)||!Number.isFinite(o)){let e=MY(r);e&&(e=' for field "'.concat(e,'"')),t.dataflow.warn("Infinite extent".concat(e,": [").concat(a,", ").concat(o,"]")),a=o=void 0}this.value=[a,o]}}),UX(A5,C1,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}}),UX(D5,q1,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,r){const i=this.value;let a,o,s=LX(i,e)&&i[e];return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(o=r||(o=this._group[e])&&o.tuple,a=n.dataflow,s=new A5(n.fork(n.NO_SOURCE),this),a.add(s).connect(t(a,e,o)),i[e]=s,this.activate(s)),s},clean(){const e=this.value;for(const t in e)if(0===e[t].count){const n=e[t].detachSubflow;n&&n(),delete e[t]}},initTargets(){const e=this._targets,t=e.length;for(let n=0;n<t&&null!=e[n];++n)e[n]=null;e.active=0},transform(e,t){const n=t.dataflow,r=e.key,i=e.subflow,a=this._keys,o=e.modified("key"),s=e=>this.subflow(e,i,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,e=>{const t=p1(e),n=a.get(t);void 0!==n&&(a.delete(t),s(n).rem(e))}),t.visit(t.ADD,e=>{const t=r(e);a.set(p1(e),t),s(t).add(e)}),o||t.modified(r.fields)?t.visit(t.MOD,e=>{const t=p1(e),n=a.get(t),i=r(e);n===i?s(i).mod(e):(a.set(t,i),s(n).rem(e),s(i).add(e))}):t.changed(t.MOD)&&t.visit(t.MOD,e=>{s(a.get(p1(e))).mod(e)}),o&&t.visit(t.REFLOW,e=>{const t=p1(e),n=a.get(t),i=r(e);n!==i&&(a.set(t,i),s(n).rem(e),s(i).add(e))}),t.clean()?n.runAfter(()=>{this.clean(),a.clean()}):a.empty>n.cleanThreshold&&n.runAfter(a.clean),t}}),UX(M5,C1),j5.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},UX(j5,q1,{transform(e,t){const n=t.dataflow,r=this.value,i=t.fork(),a=i.add,o=i.rem,s=i.mod,l=e.expr;let u=!0;function c(t){const n=p1(t),i=l(t,e),c=r.get(n);i&&c?(r.delete(n),a.push(t)):i||c?u&&i&&!c&&s.push(t):(r.set(n,1),o.push(t))}return t.visit(t.REM,e=>{const t=p1(e);r.has(t)?r.delete(t):o.push(e)}),t.visit(t.ADD,t=>{l(t,e)?a.push(t):r.set(p1(t),1)}),t.visit(t.MOD,c),e.modified()&&(u=!1,t.visit(t.REFLOW,c)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}}),R5.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},UX(R5,q1,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=E5(r,e.as||[]),a=e.index||null,o=i.length;return n.rem=this.value,t.visit(t.SOURCE,e=>{const t=r.map(t=>t(e)),s=t.reduce((e,t)=>Math.max(e,t.length),0);let l,u,c,d=0;for(;d<s;++d){for(u=v1(e),l=0;l<o;++l)u[i[l]]=null==(c=t[l][d])?null:c;a&&(u[a]=d),n.add.push(u)}}),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(i)}}),P5.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},UX(P5,q1,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(MY),a=e.as||["key","value"],o=a[0],s=a[1],l=r.length;return n.rem=this.value,t.visit(t.SOURCE,e=>{for(let t,a=0;a<l;++a)t=v1(e),t[o]=i[a],t[s]=r[a](e),n.add.push(t)}),this.value=n.source=n.add,n.modifies(a)}}),F5.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},UX(F5,q1,{transform(e,t){const n=e.expr,r=e.as,i=e.modified(),a=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;return i&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(r),t.visit(a,t=>t[r]=n(t,e))}}),UX(L5,q1,{transform(e,t){const n=t.fork(t.ALL),r=e.generator;let i,a,o,s=this.value,l=e.size-s.length;if(l>0){for(i=[];--l>=0;)i.push(o=g1(r(e))),s.push(o);n.add=n.add.length?n.materialize(n.ADD).add.concat(i):i}else a=s.slice(0,-l),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(a):a,s=s.slice(-l);return n.source=this.value=s,n}});const $5={value:"value",median:n2,mean:function(e,t){let n=0,r=0;if(void 0===t)for(let i of e)null!=i&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let a of e)null!=(a=t(a,++i,e))&&(a=+a)>=a&&(++n,r+=a)}if(n)return r/n},min:Z1,max:K1},B5=[];function z5(e){q1.call(this,[],e)}function U5(e){f5.call(this,e)}function H5(e){q1.call(this,null,e)}function W5(e){C1.call(this,null,V5,e)}function V5(e){return this.value&&!e.modified()?this.value:KX(e.fields,e.flat)}function q5(e){q1.call(this,[],e),this._pending=null}function G5(e,t,n){n.forEach(g1);const r=t.fork(t.NO_FIELDS&t.NO_SOURCE);return r.rem=e.value,e.value=r.source=r.add=n,e._pending=null,r.rem.length&&r.clean(!0),r}function Y5(e){q1.call(this,{},e)}function X5(e){C1.call(this,null,K5,e)}function K5(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let r,i,a=1/0,o=-1/0;for(r=0;r<n;++r)i=t[r],i[0]<a&&(a=i[0]),i[1]>o&&(o=i[1]);return[a,o]}function Z5(e){C1.call(this,null,J5,e)}function J5(e){return this.value&&!e.modified()?this.value:e.values.reduce((e,t)=>e.concat(t),[])}function Q5(e){q1.call(this,null,e)}function e3(e){f5.call(this,e)}function t3(e){D5.call(this,e)}function n3(e){q1.call(this,null,e)}function r3(e){q1.call(this,null,e)}function i3(e){q1.call(this,null,e)}function a3(e){q1.call(this,null,e)}function o3(e){q1.call(this,[],e),this.count=0}function s3(e){q1.call(this,null,e)}function l3(e){q1.call(this,null,e),this.modified(!0)}function u3(e){q1.call(this,null,e)}z5.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},UX(z5,q1,{transform(e,t){var n,r,i,a,o,s,l,u,c,d,h=t.fork(t.ALL),f=function(e){var t,n=e.method||$5.value;if(null!=$5[n])return n===$5.value?(t=void 0!==e.value?e.value:0,()=>t):$5[n];FY("Unrecognized imputation method: "+n)}(e),p=function(e){const t=e.field;return e=>e?t(e):NaN}(e),m=MY(e.field),g=MY(e.key),v=(e.groupby||[]).map(MY),y=function(e,t,n,r){var i,a,o,s,l,u,c,d,h=e=>e(d),f=[],p=r?r.slice():[],m={},g={};for(p.forEach((e,t)=>m[e]=t+1),s=0,c=e.length;s<c;++s)u=n(d=e[s]),l=m[u]||(m[u]=p.push(u)),(o=g[a=(i=t?t.map(h):B5)+""])||(o=g[a]=[],f.push(o),o.values=i),o[l-1]=d;return f.domain=p,f}(t.source,e.groupby,e.key,e.keyvals),b=[],x=this.value,w=y.domain.length;for(o=0,u=y.length;o<u;++o)for(i=(n=y[o]).values,r=NaN,l=0;l<w;++l)if(null==n[l]){for(a=y.domain[l],d={_impute:!0},s=0,c=i.length;s<c;++s)d[v[s]]=i[s];d[g]=a,d[m]=Number.isNaN(r)?r=f(n,p):r,b.push(g1(d))}return b.length&&(h.add=h.materialize(h.ADD).add.concat(b)),x.length&&(h.rem=h.materialize(h.REM).rem.concat(x)),this.value=b,h}}),U5.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:r5},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},UX(U5,f5,{transform(e,t){const n=this,r=e.modified();let i;return n.value&&(r||t.modified(n._inputs,!0))?(i=n.value=r?n.init(e):{},t.visit(t.SOURCE,e=>n.add(e))):(i=n.value=n.value||this.init(e),t.visit(t.REM,e=>n.rem(e)),t.visit(t.ADD,e=>n.add(e))),n.changes(),t.visit(t.SOURCE,e=>{jX(e,i[n.cellkey(e)].tuple)}),t.reflow(r).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(e[n]),e[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}}),H5.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},UX(H5,q1,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=T5(r,e.groupby,e.field),a=(e.groupby||[]).map(MY),o=e.bandwidth,s=e.cumulative?"cdf":"pdf",l=e.as||["value","density"],u=[];let c=e.extent,d=e.steps||e.minsteps||25,h=e.steps||e.maxsteps||200;"pdf"!==s&&"cdf"!==s&&FY("Invalid density method: "+s),"shared"===e.resolve&&(c||(c=RX(r,e.field)),d=h=e.steps||h),i.forEach(t=>{const n=_2(t,o)[s],r=e.counts?t.length:1;X2(n,c||RX(t),d,h).forEach(e=>{const n={};for(let r=0;r<a.length;++r)n[a[r]]=t.dims[r];n[l[0]]=e[0],n[l[1]]=e[1]*r,u.push(g1(n))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}}),UX(W5,C1),UX(q5,q1,{transform(e,t){const n=t.dataflow;return this._pending?G5(this,t,this._pending):function(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}(e)?t.StopPropagation:e.values?G5(this,t,n.parse(e.values,e.format)):e.async?{async:n.request(e.url,e.format).then(e=>(this._pending=EX(e.data),e=>e.touch(this)))}:n.request(e.url,e.format).then(e=>G5(this,t,EX(e.data)))}}),Y5.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},UX(Y5,q1,{transform(e,t){const n=e.fields,r=e.index,i=e.values,a=null==e.default?null:e.default,o=e.modified(),s=n.length;let l,u,c,d=o?t.SOURCE:t.ADD,h=t,f=e.as;return i?(u=i.length,s>1&&!f&&FY('Multi-field lookup requires explicit "as" parameter.'),f&&f.length!==s*u&&FY('The "as" parameter has too few output field names.'),f=f||i.map(MY),l=function(e){for(var t,o,l=0,c=0;l<s;++l)if(null==(o=r.get(n[l](e))))for(t=0;t<u;++t,++c)e[f[c]]=a;else for(t=0;t<u;++t,++c)e[f[c]]=i[t](o)}):(f||FY("Missing output field names."),l=function(e){for(var t,i=0;i<s;++i)t=r.get(n[i](e)),e[f[i]]=null==t?a:t}),o?h=t.reflow(!0):(c=n.some(e=>t.modified(e.fields)),d|=c?t.MOD:0),t.visit(d,l),h.modifies(f)}}),UX(X5,C1),UX(Z5,C1),UX(Q5,q1,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),e3.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:r5,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},UX(e3,f5,{_transform:f5.prototype.transform,transform(e,t){return this._transform(function(e,t){const n=e.field,r=e.value,i=("count"===e.op?"__count__":e.op)||"sum",a=NY(n).concat(NY(r)),o=function(e,t,n){const r={},i=[];return n.visit(n.SOURCE,t=>{const n=e(t);r[n]||(r[n]=1,i.push(n))}),i.sort(IX),t?i.slice(0,t):i}(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:o.map(()=>i),fields:o.map(e=>function(e,t,n,r){return DY(r=>t(r)===e?n(r):NaN,r,e+"")}(e,n,r,a)),as:o.map(e=>e+""),modified:e.modified.bind(e)}}(e,t),t)}}),UX(t3,D5,{transform(e,t){const n=e.subflow,r=e.field,i=e=>this.subflow(p1(e),n,t,e);return(e.modified("field")||r&&t.modified(NY(r)))&&FY("PreFacet does not support field modification."),this.initTargets(),r?(t.visit(t.MOD,e=>{const t=i(e);r(e).forEach(e=>t.mod(e))}),t.visit(t.ADD,e=>{const t=i(e);r(e).forEach(e=>t.add(g1(e)))}),t.visit(t.REM,e=>{const t=i(e);r(e).forEach(e=>t.rem(e))})):(t.visit(t.MOD,e=>i(e).mod(e)),t.visit(t.ADD,e=>i(e).add(e)),t.visit(t.REM,e=>i(e).rem(e))),t.clean()&&t.runAfter(()=>this.clean()),t}}),n3.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},UX(n3,q1,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=E5(e.fields,e.as||[]),a=r?(e,t)=>function(e,t,n,r){for(let i=0,a=n.length;i<a;++i)t[r[i]]=n[i](e);return t}(e,t,r,i):y1;let o;return this.value?o=this.value:(t=t.addAll(),o=this.value={}),t.visit(t.REM,e=>{const t=p1(e);n.rem.push(o[t]),o[t]=null}),t.visit(t.ADD,e=>{const t=a(e,g1({}));o[p1(e)]=t,n.add.push(t)}),t.visit(t.MOD,e=>{n.mod.push(a(e,o[p1(e)]))}),n}}),UX(r3,q1,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}}),i3.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]},UX(i3,q1,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const i=T5(t.materialize(t.SOURCE).source,e.groupby,e.field),a=(e.groupby||[]).map(MY),o=[],s=e.step||.01,l=e.probs||Z2(s/2,1-1e-14,s),u=l.length;return i.forEach(e=>{const t=i2(e,l);for(let n=0;n<u;++n){const i={};for(let t=0;t<a.length;++t)i[a[t]]=e.dims[t];i[r[0]]=l[n],i[r[1]]=t[n],o.push(g1(i))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=o,n}}),UX(a3,q1,{transform(e,t){let n,r;return this.value?r=this.value:(n=t=t.addAll(),r=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,e=>{const t=p1(e);n.rem.push(r[t]),r[t]=null}),t.visit(t.ADD,e=>{const t=v1(e);r[p1(e)]=t,n.add.push(t)}),t.visit(t.MOD,e=>{const t=r[p1(e)];for(const r in e)t[r]=e[r],n.modifies(r);n.mod.push(t)})),n}}),o3.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},UX(o3,q1,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,a=this.value.reduce((e,t)=>(e[p1(t)]=1,e),{});let o=this.value,s=this.count,l=0;function u(e){let t,r;o.length<i?o.push(e):(r=~~((s+1)*l2()),r<o.length&&r>=l&&(t=o[r],a[p1(t)]&&n.rem.push(t),o[r]=e)),++s}if(t.rem.length&&(t.visit(t.REM,e=>{const t=p1(e);a[t]&&(a[t]=-1,n.rem.push(e)),--s}),o=o.filter(e=>-1!==a[p1(e)])),(t.rem.length||r)&&o.length<i&&t.source&&(l=s=o.length,t.visit(t.SOURCE,e=>{a[p1(e)]||u(e)}),l=-1),r&&o.length>i){const e=o.length-i;for(let t=0;t<e;++t)a[p1(o[t])]=-1,n.rem.push(o[t]);o=o.slice(e)}return t.mod.length&&t.visit(t.MOD,e=>{a[p1(e)]&&n.mod.push(e)}),t.add.length&&t.visit(t.ADD,u),(t.add.length||l<0)&&(n.add=o.filter(e=>!a[p1(e)])),this.count=s,this.value=n.source=o,n}}),s3.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},UX(s3,q1,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),r=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=Z2(e.start,e.stop,e.step||1).map(e=>{const t={};return t[r]=e,g1(t)}),n.add=t.add.concat(this.value),n}}),UX(l3,q1,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});const c3=["unit0","unit1"];function d3(e){q1.call(this,BX(),e)}function h3(e){q1.call(this,null,e)}u3.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:iJ,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:c3}]},UX(u3,q1,{transform(e,t){const n=e.field,r=!1!==e.interval,i="utc"===e.timezone,a=this._floor(e,t),o=(i?jJ:NJ)(a.unit).offset,s=e.as||c3,l=s[0],u=s[1],c=a.step;let d=a.start||1/0,h=a.stop||-1/0,f=t.ADD;return(e.modified()||t.modified(NY(n)))&&(f=(t=t.reflow(!0)).SOURCE,d=1/0,h=-1/0),t.visit(f,e=>{const t=n(e);let i,s;null==t?(e[l]=null,r&&(e[u]=null)):(e[l]=i=s=a(t),r&&(e[u]=s=o(i,c)),i<d&&(d=i),s>h&&(h=s))}),a.start=d,a.stop=h,t.modifies(r?s:l)},_floor(e,t){const n="utc"===e.timezone,{units:r,step:i}=e.units?{units:e.units,step:e.step||1}:KJ({extent:e.extent||RX(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),a=oJ(r),o=this.value||{},s=(n?AJ:CJ)(a,i);return s.unit=aX(a),s.units=a,s.step=i,s.start=o.start,s.stop=o.stop,this.value=s}}),UX(d3,q1,{transform(e,t){const n=t.dataflow,r=e.field,i=this.value,a=e=>i.set(r(e),e);let o=!0;return e.modified("field")||t.modified(r.fields)?(i.clear(),t.visit(t.SOURCE,a)):t.changed()?(t.visit(t.REM,e=>i.delete(r(e))),t.visit(t.ADD,a)):o=!1,this.modified(o),i.empty>n.cleanThreshold&&n.runAfter(i.clean),t.fork()}}),UX(h3,q1,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(x1(e.sort)):t.source).map(e.field))}});const f3={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){const e=f3.rank(),t=e.next;return{init:e.init,next:e=>(t(e)-1)/(e.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,r=t.compare;let i=t.index;if(e<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){(t=+t)>0||FY("ntile num must be greater than zero.");const n=f3.cume_dist(),r=n.next;return{init:n.init,next:e=>Math.ceil(t*r(e))}},lag:function(e,t){return t=+t||1,{next:n=>{const r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return(t=+t)>0||FY("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const r=e(n.data[n.index]);return null!=r?t=r:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:r=>{const i=r.data;return r.index<=n?t:(n=function(e,t,n){for(let r=t.length;n<r;++n)if(null!=e(t[n]))return n;return-1}(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}},p3=Object.keys(f3);function m3(e){const t=EX(e.ops),n=EX(e.fields),r=EX(e.params),i=EX(e.as),a=this.outputs=[],o=this.windows=[],s={},l={},u=[],c=[];let d=!0;function h(e){EX(NY(e)).forEach(e=>s[e]=1)}h(e.sort),t.forEach((e,t)=>{const s=n[t],f=MY(s),p=Q2(e,f,i[t]);if(h(s),a.push(p),LX(f3,e))o.push(function(e,t,n,r){const i=f3[e](t,n);return{init:i.init||UY,update:function(e,t){t[r]=i.next(e)}}}(e,n[t],r[t],p));else{if(null==s&&"count"!==e&&FY("Null aggregate field specified."),"count"===e)return void u.push(p);d=!1;let t=l[f];t||(t=l[f]=[],t.field=s,c.push(t)),t.push(i5(e,p))}}),(u.length||c.length)&&(this.cell=function(e,t,n){e=e.map(e=>c5(e,e.field));const r={num:0,agg:null,store:!1,count:t};if(!n)for(var i=e.length,a=r.agg=Array(i),o=0;o<i;++o)a[o]=new e[o](r);if(r.store)var s=r.data=new d5;return r.add=function(e){if(r.num+=1,!n){s&&s.add(e);for(let t=0;t<i;++t)a[t].add(a[t].get(e),e)}},r.rem=function(e){if(r.num-=1,!n){s&&s.rem(e);for(let t=0;t<i;++t)a[t].rem(a[t].get(e),e)}},r.set=function(e){let i,o;for(s&&s.values(),i=0,o=t.length;i<o;++i)e[t[i]]=r.num;if(!n)for(i=0,o=a.length;i<o;++i)a[i].set(e)},r.init=function(){r.num=0,s&&s.reset();for(let e=0;e<i;++e)a[e].init()},r}(c,u,d)),this.inputs=Object.keys(s)}const g3=m3.prototype;function v3(e){q1.call(this,{},e),this._mlen=0,this._mods=[]}function y3(e,t,n,r){const i=r.sort,a=i&&!r.ignorePeers,o=r.frame||[null,0],s=e.data(n),l=s.length,u=a?qZ(i):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:i||MX(-1)};t.init();for(let d=0;d<l;++d)b3(c,o,d,l),a&&x3(c,u),t.update(c,s[d])}function b3(e,t,n,r){e.p0=e.i0,e.p1=e.i1,e.i0=null==t[0]?0:Math.max(0,n-Math.abs(t[0])),e.i1=null==t[1]?r:Math.min(r,n+Math.abs(t[1])+1),e.index=n}function x3(e,t){const n=e.i0,r=e.i1-1,i=e.compare,a=e.data,o=a.length-1;n>0&&!i(a[n],a[n-1])&&(e.i0=t.left(a,a[n])),r<o&&!i(a[r],a[r+1])&&(e.i1=t.right(a,a[r]))}function w3(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function _3(e){this._context=e}g3.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()},g3.update=function(e,t){const n=this.cell,r=this.windows,i=e.data,a=r&&r.length;let o;if(n){for(o=e.p0;o<e.i0;++o)n.rem(i[o]);for(o=e.p1;o<e.i1;++o)n.add(i[o]);n.set(t)}for(o=0;o<a;++o)r[o].update(e,t)},v3.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:p3.concat(r5)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},UX(v3,q1,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),r=x1(e.sort),i=J2(e.groupby),a=e=>this.group(i(e));let o=this.state;o&&!n||(o=this.state=new m3(e)),n||t.modified(o.inputs)?(this.value={},t.visit(t.SOURCE,e=>a(e).add(e))):(t.visit(t.REM,e=>a(e).remove(e)),t.visit(t.ADD,e=>a(e).add(e)));for(let s=0,l=this._mlen;s<l;++s)y3(this._mods[s],o,r,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(o.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=m5(p1),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}}),_3.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:w3(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:w3(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};var S3=function(){};function E3(e){this._context=e}function T3(e){this._context=e}function k3(e,t){this._basis=new _3(e),this._beta=t}E3.prototype={areaStart:S3,areaEnd:S3,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:w3(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},T3.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:w3(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},k3.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r,i=e[0],a=t[0],o=e[n]-i,s=t[n]-a,l=-1;++l<=n;)this._basis.point(this._beta*e[l]+(1-this._beta)*(i+(r=l/n)*o),this._beta*t[l]+(1-this._beta)*(a+r*s));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var C3=function e(t){function n(e){return 1===t?new _3(e):new k3(e,t)}return n.beta=function(t){return e(+t)},n}(.85);function I3(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function O3(e,t){this._context=e,this._k=(1-t)/6}O3.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:I3(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:I3(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var A3=function e(t){function n(e){return new O3(e,t)}return n.tension=function(t){return e(+t)},n}(0);function D3(e,t){this._context=e,this._k=(1-t)/6}D3.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:I3(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var M3=function e(t){function n(e){return new D3(e,t)}return n.tension=function(t){return e(+t)},n}(0);function N3(e,t){this._context=e,this._k=(1-t)/6}N3.prototype={areaStart:S3,areaEnd:S3,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:I3(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var j3=function e(t){function n(e){return new N3(e,t)}return n.tension=function(t){return e(+t)},n}(0),R3=Math.abs,P3=Math.atan2,F3=Math.cos,L3=Math.max,$3=Math.min,B3=Math.sin,z3=Math.sqrt,U3=1e-12,H3=Math.PI,W3=H3/2,V3=2*H3;function q3(e){return e>1?0:e<-1?H3:Math.acos(e)}function G3(e){return e>=1?W3:e<=-1?-W3:Math.asin(e)}function Y3(e,t,n){var r=e._x1,i=e._y1,a=e._x2,o=e._y2;if(e._l01_a>U3){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,l=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/l,i=(i*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/l}if(e._l23_a>U3){var u=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*u+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*u+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(r,i,a,o,e._x2,e._y2)}function X3(e,t){this._context=e,this._alpha=t}X3.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Y3(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var K3=function e(t){function n(e){return t?new X3(e,t):new O3(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function Z3(e,t){this._context=e,this._alpha=t}Z3.prototype={areaStart:S3,areaEnd:S3,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Y3(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var J3=function e(t){function n(e){return t?new Z3(e,t):new N3(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function Q3(e,t){this._context=e,this._alpha=t}Q3.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Y3(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var e4=function e(t){function n(e){return t?new Q3(e,t):new D3(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function t4(e){this._context=e}t4.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};var n4=function(e){return new t4(e)};function r4(e){this._context=e}function i4(e){return e<0?-1:1}function a4(e,t,n){var r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),s=(a*i+o*r)/(r+i);return(i4(a)+i4(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function o4(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function s4(e,t,n){var r=e._x0,i=e._x1,a=e._y1,o=(i-r)/3;e._context.bezierCurveTo(r+o,e._y0+o*t,i-o,a-o*n,i,a)}function l4(e){this._context=e}function u4(e){this._context=new c4(e)}function c4(e){this._context=e}function d4(e){this._context=e}function h4(e){var t,n,r=e.length-1,i=new Array(r),a=new Array(r),o=new Array(r);for(i[0]=0,a[0]=2,o[0]=e[0]+2*e[1],t=1;t<r-1;++t)i[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[r-1]=2,a[r-1]=7,o[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)a[t]-=n=i[t]/a[t-1],o[t]-=n*o[t-1];for(i[r-1]=o[r-1]/a[r-1],t=r-2;t>=0;--t)i[t]=(o[t]-i[t+1])/a[t];for(a[r-1]=(e[r]+i[r-1])/2,t=0;t<r-1;++t)a[t]=2*e[t+1]-i[t+1];return[i,a]}function f4(e,t){this._context=e,this._t=t}r4.prototype={areaStart:S3,areaEnd:S3,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}},l4.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:s4(this,this._t0,o4(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,s4(this,o4(this,n=a4(this,e,t)),n);break;default:s4(this,this._t0,n=a4(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(u4.prototype=Object.create(l4.prototype)).point=function(e,t){l4.prototype.point.call(this,t,e)},c4.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,a){this._context.bezierCurveTo(t,e,r,n,a,i)}},d4.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===n)this._context.lineTo(e[1],t[1]);else for(var r=h4(e),i=h4(t),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],e[o],t[o]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}},f4.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};const p4=Math.PI,m4=2*p4,g4=1e-6,v4=m4-g4;function y4(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function b4(){return new y4}y4.prototype=b4.prototype={constructor:y4,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(e,t,n,r,i){var a=this._x1,o=this._y1,s=(n=+n)-(e=+e),l=(r=+r)-(t=+t),u=a-e,c=o-t,d=u*u+c*c;if((i=+i)<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(d>g4)if(Math.abs(c*s-l*u)>g4&&i){var h=n-a,f=r-o,p=s*s+l*l,m=h*h+f*f,g=Math.sqrt(p),v=Math.sqrt(d),y=i*Math.tan((p4-Math.acos((p+d-m)/(2*g*v)))/2),b=y/v,x=y/g;Math.abs(b-1)>g4&&(this._+="L"+(e+b*u)+","+(t+b*c)),this._+="A"+i+","+i+",0,0,"+ +(c*h>u*f)+","+(this._x1=e+x*s)+","+(this._y1=t+x*l)}else this._+="L"+(this._x1=e)+","+(this._y1=t)},arc:function(e,t,n,r,i,a){e=+e,t=+t,a=!!a;var o=(n=+n)*Math.cos(r),s=n*Math.sin(r),l=e+o,u=t+s,c=1^a,d=a?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+l+","+u:(Math.abs(this._x1-l)>g4||Math.abs(this._y1-u)>g4)&&(this._+="L"+l+","+u),n&&(d<0&&(d=d%m4+m4),d>v4?this._+="A"+n+","+n+",0,1,"+c+","+(e-o)+","+(t-s)+"A"+n+","+n+",0,1,"+c+","+(this._x1=l)+","+(this._y1=u):d>g4&&(this._+="A"+n+","+n+",0,"+ +(d>=p4)+","+c+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var x4=b4,w4=function(e){return function(){return e}};function _4(e){return e.innerRadius}function S4(e){return e.outerRadius}function E4(e){return e.startAngle}function T4(e){return e.endAngle}function k4(e){return e&&e.padAngle}function C4(e,t,n,r,i,a,o,s){var l=n-e,u=r-t,c=o-i,d=s-a,h=d*l-c*u;if(!(h*h<U3))return[e+(h=(c*(t-a)-d*(e-i))/h)*l,t+h*u]}function I4(e,t,n,r,i,a,o){var s=e-n,l=t-r,u=(o?a:-a)/z3(s*s+l*l),c=u*l,d=-u*s,h=e+c,f=t+d,p=n+c,m=r+d,g=(h+p)/2,v=(f+m)/2,y=p-h,b=m-f,x=y*y+b*b,w=i-a,_=h*m-p*f,S=(b<0?-1:1)*z3(L3(0,w*w*x-_*_)),E=(_*b-y*S)/x,T=(-_*y-b*S)/x,k=(_*b+y*S)/x,C=(-_*y+b*S)/x,I=E-g,O=T-v,A=k-g,D=C-v;return I*I+O*O>A*A+D*D&&(E=k,T=C),{cx:E,cy:T,x01:-c,y01:-d,x11:E*(i/w-1),y11:T*(i/w-1)}}var O4=function(e){return"object"==typeof e&&"length"in e?e:Array.from(e)};function A4(e){return e[0]}function D4(e){return e[1]}var M4=function(e,t){var n=w4(!0),r=null,i=n4,a=null;function o(o){var s,l,u,c=(o=O4(o)).length,d=!1;for(null==r&&(a=i(u=x4())),s=0;s<=c;++s)!(s<c&&n(l=o[s],s,o))===d&&((d=!d)?a.lineStart():a.lineEnd()),d&&a.point(+e(l,s,o),+t(l,s,o));if(u)return a=null,u+""||null}return e="function"==typeof e?e:void 0===e?A4:w4(e),t="function"==typeof t?t:void 0===t?D4:w4(t),o.x=function(t){return arguments.length?(e="function"==typeof t?t:w4(+t),o):e},o.y=function(e){return arguments.length?(t="function"==typeof e?e:w4(+e),o):t},o.defined=function(e){return arguments.length?(n="function"==typeof e?e:w4(!!e),o):n},o.curve=function(e){return arguments.length?(i=e,null!=r&&(a=i(r)),o):i},o.context=function(e){return arguments.length?(null==e?r=a=null:a=i(r=e),o):r},o},N4=function(e,t,n){var r=null,i=w4(!0),a=null,o=n4,s=null;function l(l){var u,c,d,h,f,p=(l=O4(l)).length,m=!1,g=new Array(p),v=new Array(p);for(null==a&&(s=o(f=x4())),u=0;u<=p;++u){if(!(u<p&&i(h=l[u],u,l))===m)if(m=!m)c=u,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),d=u-1;d>=c;--d)s.point(g[d],v[d]);s.lineEnd(),s.areaEnd()}m&&(g[u]=+e(h,u,l),v[u]=+t(h,u,l),s.point(r?+r(h,u,l):g[u],n?+n(h,u,l):v[u]))}if(f)return s=null,f+""||null}function u(){return M4().defined(i).curve(o).context(a)}return e="function"==typeof e?e:void 0===e?A4:w4(+e),t="function"==typeof t?t:w4(void 0===t?0:+t),n="function"==typeof n?n:void 0===n?D4:w4(+n),l.x=function(t){return arguments.length?(e="function"==typeof t?t:w4(+t),r=null,l):e},l.x0=function(t){return arguments.length?(e="function"==typeof t?t:w4(+t),l):e},l.x1=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:w4(+e),l):r},l.y=function(e){return arguments.length?(t="function"==typeof e?e:w4(+e),n=null,l):t},l.y0=function(e){return arguments.length?(t="function"==typeof e?e:w4(+e),l):t},l.y1=function(e){return arguments.length?(n=null==e?null:"function"==typeof e?e:w4(+e),l):n},l.lineX0=l.lineY0=function(){return u().x(e).y(t)},l.lineY1=function(){return u().x(e).y(n)},l.lineX1=function(){return u().x(r).y(t)},l.defined=function(e){return arguments.length?(i="function"==typeof e?e:w4(!!e),l):i},l.curve=function(e){return arguments.length?(o=e,null!=a&&(s=o(a)),l):o},l.context=function(e){return arguments.length?(null==e?a=s=null:s=o(a=e),l):a},l},j4={draw:function(e,t){var n=Math.sqrt(t/H3);e.moveTo(n,0),e.arc(0,0,n,0,V3)}};function R4(e,t){if("undefined"!=typeof document&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}Math.sqrt(1/3),Math.sin(H3/10),Math.sin(7*H3/10),Math.sin(V3/10),Math.cos(V3/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12);const P4=()=>"undefined"!=typeof Image?Image:null,F4=qZ(VZ),L4=F4.right,$4=F4.left;qZ(Q1);var B4=L4;function z4(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function U4(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}const H4=Symbol("implicit");function W4(){var e=new Map,t=[],n=[],r=H4;function i(i){var a=i+"",o=e.get(a);if(!o){if(r!==H4)return r;e.set(a,o=t.push(i))}return n[(o-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=new Map;for(const r of n){const n=r+"";e.has(n)||e.set(n,t.push(r))}return i},i.range=function(e){return arguments.length?(n=Array.from(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return W4(t,n).unknown(r)},z4.apply(i,arguments),i}function V4(e,t,n,r){var i,a=QK(e,t,n);switch((r=tZ(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=uZ(a,o))||(r.precision=i),sZ(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=cZ(a,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=dZ(a))||(r.precision=i-2*("%"===r.type))}return oZ(r)}var q4=function(e,t,n){e.prototype=t.prototype=n,n.constructor=e};function G4(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Y4(){}var X4=.7,K4=1/X4,Z4="\\s*([+-]?\\d+)\\s*",J4="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Q4="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",e6=/^#([0-9a-f]{3,8})$/,t6=new RegExp("^rgb\\("+[Z4,Z4,Z4]+"\\)$"),n6=new RegExp("^rgb\\("+[Q4,Q4,Q4]+"\\)$"),r6=new RegExp("^rgba\\("+[Z4,Z4,Z4,J4]+"\\)$"),i6=new RegExp("^rgba\\("+[Q4,Q4,Q4,J4]+"\\)$"),a6=new RegExp("^hsl\\("+[J4,Q4,Q4]+"\\)$"),o6=new RegExp("^hsla\\("+[J4,Q4,Q4,J4]+"\\)$"),s6={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function l6(){return this.rgb().formatHex()}function u6(){return this.rgb().formatRgb()}function c6(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=e6.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?d6(t):3===n?new m6(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?h6(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?h6(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=t6.exec(e))?new m6(t[1],t[2],t[3],1):(t=n6.exec(e))?new m6(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=r6.exec(e))?h6(t[1],t[2],t[3],t[4]):(t=i6.exec(e))?h6(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=a6.exec(e))?b6(t[1],t[2]/100,t[3]/100,1):(t=o6.exec(e))?b6(t[1],t[2]/100,t[3]/100,t[4]):s6.hasOwnProperty(e)?d6(s6[e]):"transparent"===e?new m6(NaN,NaN,NaN,0):null}function d6(e){return new m6(e>>16&255,e>>8&255,255&e,1)}function h6(e,t,n,r){return r<=0&&(e=t=n=NaN),new m6(e,t,n,r)}function f6(e){return e instanceof Y4||(e=c6(e)),e?new m6((e=e.rgb()).r,e.g,e.b,e.opacity):new m6}function p6(e,t,n,r){return 1===arguments.length?f6(e):new m6(e,t,n,null==r?1:r)}function m6(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function g6(){return"#"+y6(this.r)+y6(this.g)+y6(this.b)}function v6(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function y6(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function b6(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new _6(e,t,n,r)}function x6(e){if(e instanceof _6)return new _6(e.h,e.s,e.l,e.opacity);if(e instanceof Y4||(e=c6(e)),!e)return new _6;if(e instanceof _6)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new _6(o,s,l,e.opacity)}function w6(e,t,n,r){return 1===arguments.length?x6(e):new _6(e,t,n,null==r?1:r)}function _6(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function S6(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function E6(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}q4(Y4,c6,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:l6,formatHex:l6,formatHsl:function(){return x6(this).formatHsl()},formatRgb:u6,toString:u6}),q4(m6,p6,G4(Y4,{brighter:function(e){return e=null==e?K4:Math.pow(K4,e),new m6(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?X4:Math.pow(X4,e),new m6(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:g6,formatHex:g6,formatRgb:v6,toString:v6})),q4(_6,w6,G4(Y4,{brighter:function(e){return e=null==e?K4:Math.pow(K4,e),new _6(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?X4:Math.pow(X4,e),new _6(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new m6(S6(e>=240?e-240:e+120,i,r),S6(e,i,r),S6(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));var T6=function(e){return function(){return e}};function k6(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):T6(isNaN(e)?t:e)}var C6=function e(t){var n=function(e){return 1==(e=+e)?k6:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):T6(isNaN(t)?n:t)}}(t);function r(e,t){var r=n((e=p6(e)).r,(t=p6(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=k6(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function I6(e){return function(t){var n,r,i=t.length,a=new Array(i),o=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=p6(t[n]),a[n]=r.r||0,o[n]=r.g||0,s[n]=r.b||0;return a=e(a),o=e(o),s=e(s),r.opacity=1,function(e){return r.r=a(e),r.g=o(e),r.b=s(e),r+""}}}I6((function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1];return E6((n-r/t)*t,r>0?e[r-1]:2*i-a,i,a,r<t-1?e[r+2]:2*a-i)}})),I6((function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t);return E6((n-r/t)*t,e[(r+t-1)%t],e[r%t],e[(r+1)%t],e[(r+2)%t])}}));var O6=function(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}};function A6(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=F6(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}var D6=function(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}},M6=function(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}},N6=function(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=F6(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}},j6=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,R6=new RegExp(j6.source,"g"),P6=function(e,t){var n,r,i,a=j6.lastIndex=R6.lastIndex=0,o=-1,s=[],l=[];for(e+="",t+="";(n=j6.exec(e))&&(r=R6.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:M6(n,r)})),a=R6.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)s[(n=l[r]).i]=n.x(e);return s.join("")})},F6=function(e,t){var n,r,i=typeof t;return null==t||"boolean"===i?T6(t):("number"===i?M6:"string"===i?(n=c6(t))?(t=n,C6):P6:t instanceof c6?C6:t instanceof Date?D6:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?A6:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?N6:M6:O6))(e,t)},L6=function(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}};function $6(e){return+e}var B6=[0,1];function z6(e){return e}function U6(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function H6(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return i<r?(r=U6(i,r),a=n(o,a)):(r=U6(r,i),a=n(a,o)),function(e){return a(r(e))}}function W6(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=U6(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=B4(e,t,1,r)-1;return a[n](i[n](t))}}function V6(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function q6(){var e,t,n,r,i,a,o=B6,s=B6,l=F6,u=z6;function c(){var e,t,n,l=Math.min(o.length,s.length);return u!==z6&&((e=o[0])>(t=o[l-1])&&(n=e,e=t,t=n),u=function(n){return Math.max(e,Math.min(t,n))}),r=l>2?W6:H6,i=a=null,d}function d(t){return isNaN(t=+t)?n:(i||(i=r(o.map(e),s,l)))(e(u(t)))}return d.invert=function(n){return u(t((a||(a=r(s,o.map(e),M6)))(n)))},d.domain=function(e){return arguments.length?(o=Array.from(e,$6),c()):o.slice()},d.range=function(e){return arguments.length?(s=Array.from(e),c()):s.slice()},d.rangeRound=function(e){return s=Array.from(e),l=L6,c()},d.clamp=function(e){return arguments.length?(u=!!e||z6,c()):u!==z6},d.interpolate=function(e){return arguments.length?(l=e,c()):l},d.unknown=function(e){return arguments.length?(n=e,d):n},function(n,r){return e=n,t=r,c()}}function G6(){return q6()(z6,z6)}function Y6(e){var t=e.domain;return e.ticks=function(e){var n=t();return ZK(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return V4(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i,a=t(),o=0,s=a.length-1,l=a[o],u=a[s],c=10;for(u<l&&(i=l,l=u,u=i,i=o,o=s,s=i);c-- >0;){if((i=JK(l,u,n))===r)return a[o]=l,a[s]=u,t(a);if(i>0)l=Math.floor(l/i)*i,u=Math.ceil(u/i)*i;else{if(!(i<0))break;l=Math.ceil(l*i)/i,u=Math.floor(u*i)/i}r=i}return e},e}function X6(e,t){var n,r=0,i=(e=e.slice()).length-1,a=e[r],o=e[i];return o<a&&(n=r,r=i,i=n,n=a,a=o,o=n),e[r]=t.floor(a),e[i]=t.ceil(o),e}function K6(e){return Math.log(e)}function Z6(e){return Math.exp(e)}function J6(e){return-Math.log(-e)}function Q6(e){return-Math.exp(-e)}function e8(e){return isFinite(e)?+("1e"+e):e<0?0:e}function t8(e){return function(t){return-e(-t)}}function n8(e){var t,n,r=e(K6,Z6),i=r.domain,a=10;function o(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(a),n=function(e){return 10===e?e8:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(a),i()[0]<0?(t=t8(t),n=t8(n),e(J6,Q6)):e(K6,Z6),r}return r.base=function(e){return arguments.length?(a=+e,o()):a},r.domain=function(e){return arguments.length?(i(e),o()):i()},r.ticks=function(e){var r,o=i(),s=o[0],l=o[o.length-1];(r=l<s)&&(h=s,s=l,l=h);var u,c,d,h=t(s),f=t(l),p=null==e?10:+e,m=[];if(!(a%1)&&f-h<p){if(h=Math.floor(h),f=Math.ceil(f),s>0){for(;h<=f;++h)for(c=1,u=n(h);c<a;++c)if(!((d=u*c)<s)){if(d>l)break;m.push(d)}}else for(;h<=f;++h)for(c=a-1,u=n(h);c>=1;--c)if(!((d=u*c)<s)){if(d>l)break;m.push(d)}2*m.length<p&&(m=ZK(s,l,p))}else m=ZK(h,f,Math.min(f-h,p)).map(n);return r?m.reverse():m},r.tickFormat=function(e,i){if(null==i&&(i=10===a?".0e":","),"function"!=typeof i&&(i=oZ(i)),e===1/0)return i;null==e&&(e=10);var o=Math.max(1,a*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*a<a-.5&&(r*=a),r<=o?i(e):""}},r.nice=function(){return i(X6(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function r8(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function i8(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function a8(e){return e<0?-e*e:e*e}function o8(e){var t=e(z6,z6),n=1;function r(){return 1===n?e(z6,z6):.5===n?e(i8,a8):e(r8(n),r8(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},Y6(t)}function s8(){var e=o8(q6());return e.copy=function(){return V6(e,s8()).exponent(e.exponent())},z4.apply(e,arguments),e}function l8(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function u8(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function c8(e){var t=1,n=e(l8(t),u8(t));return n.constant=function(n){return arguments.length?e(l8(t=+n),u8(t)):t},Y6(n)}var d8=QJ((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()})),h8=QJ((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*eQ-e.getMinutes()*tQ)}),(function(e,t){e.setTime(+e+t*nQ)}),(function(e,t){return(t-e)/nQ}),(function(e){return e.getHours()})),f8=QJ((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*eQ)}),(function(e,t){e.setTime(+e+t*tQ)}),(function(e,t){return(t-e)/tQ}),(function(e){return e.getMinutes()})),p8=QJ((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*eQ)}),(function(e,t){return(t-e)/eQ}),(function(e){return e.getUTCSeconds()})),m8=QJ((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));m8.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?QJ((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):m8:null};var g8=m8;function v8(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function y8(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function b8(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}var x8,w8,_8,S8={"-":"",_:" ",0:"0"},E8=/^\s*\d+/,T8=/^%/,k8=/[\\^$*+?|[\]().{}]/g;function C8(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function I8(e){return e.replace(k8,"\\$&")}function O8(e){return new RegExp("^(?:"+e.map(I8).join("|")+")","i")}function A8(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function D8(e,t,n){var r=E8.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function M8(e,t,n){var r=E8.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function N8(e,t,n){var r=E8.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function j8(e,t,n){var r=E8.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function R8(e,t,n){var r=E8.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function P8(e,t,n){var r=E8.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function F8(e,t,n){var r=E8.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function L8(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function $8(e,t,n){var r=E8.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function B8(e,t,n){var r=E8.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function z8(e,t,n){var r=E8.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function U8(e,t,n){var r=E8.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function H8(e,t,n){var r=E8.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function W8(e,t,n){var r=E8.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function V8(e,t,n){var r=E8.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function q8(e,t,n){var r=E8.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function G8(e,t,n){var r=E8.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Y8(e,t,n){var r=T8.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function X8(e,t,n){var r=E8.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function K8(e,t,n){var r=E8.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function Z8(e,t){return C8(e.getDate(),t,2)}function J8(e,t){return C8(e.getHours(),t,2)}function Q8(e,t){return C8(e.getHours()%12||12,t,2)}function e7(e,t){return C8(1+pQ.count(gQ(e),e),t,3)}function t7(e,t){return C8(e.getMilliseconds(),t,3)}function n7(e,t){return t7(e,t)+"000"}function r7(e,t){return C8(e.getMonth()+1,t,2)}function i7(e,t){return C8(e.getMinutes(),t,2)}function a7(e,t){return C8(e.getSeconds(),t,2)}function o7(e){var t=e.getDay();return 0===t?7:t}function s7(e,t){return C8(dQ.count(gQ(e)-1,e),t,2)}function l7(e){var t=e.getDay();return t>=4||0===t?fQ(e):fQ.ceil(e)}function u7(e,t){return e=l7(e),C8(fQ.count(gQ(e),e)+(4===gQ(e).getDay()),t,2)}function c7(e){return e.getDay()}function d7(e,t){return C8(hQ.count(gQ(e)-1,e),t,2)}function h7(e,t){return C8(e.getFullYear()%100,t,2)}function f7(e,t){return C8((e=l7(e)).getFullYear()%100,t,2)}function p7(e,t){return C8(e.getFullYear()%1e4,t,4)}function m7(e,t){var n=e.getDay();return C8((e=n>=4||0===n?fQ(e):fQ.ceil(e)).getFullYear()%1e4,t,4)}function g7(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+C8(t/60|0,"0",2)+C8(t%60,"0",2)}function v7(e,t){return C8(e.getUTCDate(),t,2)}function y7(e,t){return C8(e.getUTCHours(),t,2)}function b7(e,t){return C8(e.getUTCHours()%12||12,t,2)}function x7(e,t){return C8(1+uQ.count(yQ(e),e),t,3)}function w7(e,t){return C8(e.getUTCMilliseconds(),t,3)}function _7(e,t){return w7(e,t)+"000"}function S7(e,t){return C8(e.getUTCMonth()+1,t,2)}function E7(e,t){return C8(e.getUTCMinutes(),t,2)}function T7(e,t){return C8(e.getUTCSeconds(),t,2)}function k7(e){var t=e.getUTCDay();return 0===t?7:t}function C7(e,t){return C8(oQ.count(yQ(e)-1,e),t,2)}function I7(e){var t=e.getUTCDay();return t>=4||0===t?lQ(e):lQ.ceil(e)}function O7(e,t){return e=I7(e),C8(lQ.count(yQ(e),e)+(4===yQ(e).getUTCDay()),t,2)}function A7(e){return e.getUTCDay()}function D7(e,t){return C8(sQ.count(yQ(e)-1,e),t,2)}function M7(e,t){return C8(e.getUTCFullYear()%100,t,2)}function N7(e,t){return C8((e=I7(e)).getUTCFullYear()%100,t,2)}function j7(e,t){return C8(e.getUTCFullYear()%1e4,t,4)}function R7(e,t){var n=e.getUTCDay();return C8((e=n>=4||0===n?lQ(e):lQ.ceil(e)).getUTCFullYear()%1e4,t,4)}function P7(){return"+0000"}function F7(){return"%"}function L7(e){return+e}function $7(e){return Math.floor(+e/1e3)}x8=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,u=O8(i),c=A8(i),d=O8(a),h=A8(a),f=O8(o),p=A8(o),m=O8(s),g=A8(s),v=O8(l),y=A8(l),b={a:function(e){return o[e.getDay()]},A:function(e){return a[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:Z8,e:Z8,f:n7,g:f7,G:m7,H:J8,I:Q8,j:e7,L:t7,m:r7,M:i7,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:L7,s:$7,S:a7,u:o7,U:s7,V:u7,w:c7,W:d7,x:null,X:null,y:h7,Y:p7,Z:g7,"%":F7},x={a:function(e){return o[e.getUTCDay()]},A:function(e){return a[e.getUTCDay()]},b:function(e){return l[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:v7,e:v7,f:_7,g:N7,G:R7,H:y7,I:b7,j:x7,L:w7,m:S7,M:E7,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:L7,s:$7,S:T7,u:k7,U:C7,V:O7,w:A7,W:D7,x:null,X:null,y:M7,Y:j7,Z:P7,"%":F7},w={a:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=p[r[0].toLowerCase()],n+r[0].length):-1},A:function(e,t,n){var r=d.exec(t.slice(n));return r?(e.w=h[r[0].toLowerCase()],n+r[0].length):-1},b:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=g[r[0].toLowerCase()],n+r[0].length):-1},c:function(e,n,r){return E(e,t,n,r)},d:z8,e:z8,f:G8,g:F8,G:P8,H:H8,I:H8,j:U8,L:q8,m:B8,M:W8,p:function(e,t,n){var r=u.exec(t.slice(n));return r?(e.p=c[r[0].toLowerCase()],n+r[0].length):-1},q:$8,Q:X8,s:K8,S:V8,u:M8,U:N8,V:j8,w:D8,W:R8,x:function(e,t,r){return E(e,n,t,r)},X:function(e,t,n){return E(e,r,t,n)},y:F8,Y:P8,Z:L8,"%":Y8};function _(e,t){return function(n){var r,i,a,o=[],s=-1,l=0,u=e.length;for(n instanceof Date||(n=new Date(+n));++s<u;)37===e.charCodeAt(s)&&(o.push(e.slice(l,s)),null!=(i=S8[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(a=t[r])&&(r=a(n,i)),o.push(r),l=s+1);return o.push(e.slice(l,s)),o.join("")}}function S(e,t){return function(n){var r,i,a=b8(1900,void 0,1);if(E(a,e,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(t&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(i=(r=y8(b8(a.y,0,1))).getUTCDay(),r=i>4||0===i?sQ.ceil(r):sQ(r),r=uQ.offset(r,7*(a.V-1)),a.y=r.getUTCFullYear(),a.m=r.getUTCMonth(),a.d=r.getUTCDate()+(a.w+6)%7):(i=(r=v8(b8(a.y,0,1))).getDay(),r=i>4||0===i?hQ.ceil(r):hQ(r),r=pQ.offset(r,7*(a.V-1)),a.y=r.getFullYear(),a.m=r.getMonth(),a.d=r.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),i="Z"in a?y8(b8(a.y,0,1)).getUTCDay():v8(b8(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(i+5)%7:a.w+7*a.U-(i+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,y8(a)):v8(a)}}function E(e,t,n,r){for(var i,a,o=0,s=t.length,l=n.length;o<s;){if(r>=l)return-1;if(37===(i=t.charCodeAt(o++))){if(i=t.charAt(o++),!(a=w[i in S8?t.charAt(o++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return b.x=_(n,b),b.X=_(r,b),b.c=_(t,b),x.x=_(n,x),x.X=_(r,x),x.c=_(t,x),{format:function(e){var t=_(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=S(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=_(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=S(e+="",!0);return t.toString=function(){return e},t}}}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),w8=x8.format,_8=x8.utcFormat;var B7=31536e6;function z7(e){return new Date(e)}function U7(e){return e instanceof Date?+e:+new Date(+e)}function H7(e,t,n,r,i,a,o,s,l){var u=G6(),c=u.invert,d=u.domain,h=l(".%L"),f=l(":%S"),p=l("%I:%M"),m=l("%I %p"),g=l("%a %d"),v=l("%b %d"),y=l("%B"),b=l("%Y"),x=[[o,1,1e3],[o,5,5e3],[o,15,15e3],[o,30,3e4],[a,1,6e4],[a,5,3e5],[a,15,9e5],[a,30,18e5],[i,1,36e5],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,864e5],[r,2,1728e5],[n,1,6048e5],[t,1,2592e6],[t,3,7776e6],[e,1,B7]];function w(s){return(o(s)<s?h:a(s)<s?f:i(s)<s?p:r(s)<s?m:t(s)<s?n(s)<s?g:v:e(s)<s?y:b)(s)}function _(t,n,r){if(null==t&&(t=10),"number"==typeof t){var i,a=Math.abs(r-n)/t,o=qZ((function(e){return e[2]})).right(x,a);return o===x.length?(i=QK(n/B7,r/B7,t),t=e):o?(i=(o=x[a/x[o-1][2]<x[o][2]/a?o-1:o])[1],t=o[0]):(i=Math.max(QK(n,r,t),1),t=s),t.every(i)}return t}return u.invert=function(e){return new Date(c(e))},u.domain=function(e){return arguments.length?d(Array.from(e,U7)):d().map(z7)},u.ticks=function(e){var t,n=d(),r=n[0],i=n[n.length-1],a=i<r;return a&&(t=r,r=i,i=t),t=(t=_(e,r,i))?t.range(r,i+1):[],a?t.reverse():t},u.tickFormat=function(e,t){return null==t?w:l(t)},u.nice=function(e){var t=d();return(e=_(e,t[0],t[t.length-1]))?d(X6(t,e)):u},u.copy=function(){return V6(u,H7(e,t,n,r,i,a,o,s,l))},u}var W7=QJ((function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())}),(function(e){return e.getUTCMonth()})),V7=QJ((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+t*nQ)}),(function(e,t){return(t-e)/nQ}),(function(e){return e.getUTCHours()})),q7=QJ((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+t*tQ)}),(function(e,t){return(t-e)/tQ}),(function(e){return e.getUTCMinutes()}));function G7(){var e,t,n,r,i,a=0,o=1,s=z6,l=!1;function u(t){return isNaN(t=+t)?i:s(0===n?.5:(t=(r(t)-e)*n,l?Math.max(0,Math.min(1,t)):t))}function c(e){return function(t){var n,r;return arguments.length?([n,r]=t,s=e(n,r),u):[s(0),s(1)]}}return u.domain=function(i){return arguments.length?([a,o]=i,e=r(a=+a),t=r(o=+o),n=e===t?0:1/(t-e),u):[a,o]},u.clamp=function(e){return arguments.length?(l=!!e,u):l},u.interpolator=function(e){return arguments.length?(s=e,u):s},u.range=c(F6),u.rangeRound=c(L6),u.unknown=function(e){return arguments.length?(i=e,u):i},function(i){return r=i,e=i(a),t=i(o),n=e===t?0:1/(t-e),u}}function Y7(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function X7(){var e=Y6(G7()(z6));return e.copy=function(){return Y7(e,X7())},U4.apply(e,arguments)}function K7(){var e=o8(G7());return e.copy=function(){return Y7(e,K7()).exponent(e.exponent())},U4.apply(e,arguments)}function Z7(e,t){for(var n=0,r=t.length-1,i=t[0],a=new Array(r<0?0:r);n<r;)a[n]=e(i,i=t[++n]);return function(e){var t=Math.max(0,Math.min(r-1,Math.floor(e*=r)));return a[t](e-t)}}function J7(){var e,t,n,r,i,a,o,s=0,l=.5,u=1,c=1,d=z6,h=!1;function f(e){return isNaN(e=+e)?o:(e=.5+((e=+a(e))-t)*(c*e<c*t?r:i),d(h?Math.max(0,Math.min(1,e)):e))}function p(e){return function(t){var n,r,i;return arguments.length?([n,r,i]=t,d=Z7(e,[n,r,i]),f):[d(0),d(.5),d(1)]}}return f.domain=function(o){return arguments.length?([s,l,u]=o,e=a(s=+s),t=a(l=+l),n=a(u=+u),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),c=t<e?-1:1,f):[s,l,u]},f.clamp=function(e){return arguments.length?(h=!!e,f):h},f.interpolator=function(e){return arguments.length?(d=e,f):d},f.range=p(F6),f.rangeRound=p(L6),f.unknown=function(e){return arguments.length?(o=e,f):o},function(o){return a=o,e=o(s),t=o(l),n=o(u),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),c=t<e?-1:1,f}}function Q7(){var e=o8(J7());return e.copy=function(){return Y7(e,Q7()).exponent(e.exponent())},U4.apply(e,arguments)}function e9(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}var t9=function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1];return e9((n-r/t)*t,r>0?e[r-1]:2*i-a,i,a,r<t-1?e[r+2]:2*a-i)}},n9=function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t);return e9((n-r/t)*t,e[(r+t-1)%t],e[r%t],e[(r+1)%t],e[(r+2)%t])}},r9=e=>()=>e;function i9(e,t){return function(n){return e+n*t}}function a9(e,t){var n=t-e;return n?i9(e,n>180||n<-180?n-360*Math.round(n/360):n):r9(isNaN(e)?t:e)}function o9(e,t){var n=t-e;return n?i9(e,n):r9(isNaN(e)?t:e)}var s9=function e(t){var n=function(e){return 1==(e=+e)?o9:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):r9(isNaN(t)?n:t)}}(t);function r(e,t){var r=n((e=p6(e)).r,(t=p6(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=o9(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function l9(e){return function(t){var n,r,i=t.length,a=new Array(i),o=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=p6(t[n]),a[n]=r.r||0,o[n]=r.g||0,s[n]=r.b||0;return a=e(a),o=e(o),s=e(s),r.opacity=1,function(e){return r.r=a(e),r.g=o(e),r.b=s(e),r+""}}}var u9=l9(t9),c9=l9(n9),d9=function(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}};function h9(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}var f9=function(e,t){return(h9(t)?d9:p9)(e,t)};function p9(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=_9(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}var m9,g9=function(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}},v9=function(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}},y9=function(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=_9(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}},b9=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,x9=new RegExp(b9.source,"g"),w9=function(e,t){var n,r,i,a=b9.lastIndex=x9.lastIndex=0,o=-1,s=[],l=[];for(e+="",t+="";(n=b9.exec(e))&&(r=x9.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:v9(n,r)})),a=x9.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)s[(n=l[r]).i]=n.x(e);return s.join("")})},_9=function(e,t){var n,r=typeof t;return null==t||"boolean"===r?r9(t):("number"===r?v9:"string"===r?(n=c6(t))?(t=n,s9):w9:t instanceof c6?s9:t instanceof Date?g9:h9(t)?d9:Array.isArray(t)?p9:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?y9:v9)(e,t)},S9=function(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}},E9=function(e,t){var n=a9(+e,+t);return function(e){var t=n(e);return t-360*Math.floor(t/360)}},T9=function(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}},k9=180/Math.PI,C9={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},I9=function(e,t,n,r,i,a){var o,s,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,l/=s),e*r<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*k9,skewX:Math.atan(l)*k9,scaleX:o,scaleY:s}};function O9(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(a,o){var s=[],l=[];return a=e(a),o=e(o),function(e,r,i,a,o,s){if(e!==i||r!==a){var l=o.push("translate(",null,t,null,n);s.push({i:l-4,x:v9(e,i)},{i:l-2,x:v9(r,a)})}else(i||a)&&o.push("translate("+i+t+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,l),function(e,t,n,a){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:v9(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(a.rotate,o.rotate,s,l),function(e,t,n,a){e!==t?a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:v9(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(a.skewX,o.skewX,s,l),function(e,t,n,r,a,o){if(e!==n||t!==r){var s=a.push(i(a)+"scale(",null,",",null,")");o.push({i:s-4,x:v9(e,n)},{i:s-2,x:v9(t,r)})}else 1===n&&1===r||a.push(i(a)+"scale("+n+","+r+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,l),a=o=null,function(e){for(var t,n=-1,r=l.length;++n<r;)s[(t=l[n]).i]=t.x(e);return s.join("")}}}var A9=O9((function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?C9:I9(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),D9=O9((function(e){return null==e?C9:(m9||(m9=document.createElementNS("http://www.w3.org/2000/svg","g")),m9.setAttribute("transform",e),(e=m9.transform.baseVal.consolidate())?I9((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):C9)}),", ",")",")");function M9(e){return((e=Math.exp(e))+1/e)/2}var N9=function e(t,n,r){function i(e,i){var a,o,s=e[0],l=e[1],u=e[2],c=i[2],d=i[0]-s,h=i[1]-l,f=d*d+h*h;if(f<1e-12)o=Math.log(c/u)/t,a=function(e){return[s+e*d,l+e*h,u*Math.exp(t*e*o)]};else{var p=Math.sqrt(f),m=(c*c-u*u+r*f)/(2*u*n*p),g=(c*c-u*u-r*f)/(2*c*n*p),v=Math.log(Math.sqrt(m*m+1)-m),y=Math.log(Math.sqrt(g*g+1)-g);o=(y-v)/t,a=function(e){var r,i=e*o,a=M9(v),c=u/(n*p)*(a*(r=t*i+v,((r=Math.exp(2*r))-1)/(r+1))-function(e){return((e=Math.exp(e))-1/e)/2}(v));return[s+c*d,l+c*h,u*a/M9(t*i+v)]}}return a.duration=1e3*o*t/Math.SQRT2,a}return i.rho=function(t){var n=Math.max(.001,+t),r=n*n;return e(n,r,r*r)},i}(Math.SQRT2,2,4);function j9(e){return function(t,n){var r=e((t=w6(t)).h,(n=w6(n)).h),i=o9(t.s,n.s),a=o9(t.l,n.l),o=o9(t.opacity,n.opacity);return function(e){return t.h=r(e),t.s=i(e),t.l=a(e),t.opacity=o(e),t+""}}}var R9=j9(a9),P9=j9(o9),F9=Math.PI/180,L9=180/Math.PI,$9=.96422,B9=.82521,z9=4/29,U9=6/29,H9=3*U9*U9;function W9(e){if(e instanceof q9)return new q9(e.l,e.a,e.b,e.opacity);if(e instanceof Q9)return eee(e);e instanceof m6||(e=f6(e));var t,n,r=K9(e.r),i=K9(e.g),a=K9(e.b),o=G9((.2225045*r+.7168786*i+.0606169*a)/1);return r===i&&i===a?t=n=o:(t=G9((.4360747*r+.3850649*i+.1430804*a)/$9),n=G9((.0139322*r+.0971045*i+.7141733*a)/B9)),new q9(116*o-16,500*(t-o),200*(o-n),e.opacity)}function V9(e,t,n,r){return 1===arguments.length?W9(e):new q9(e,t,n,null==r?1:r)}function q9(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function G9(e){return e>.008856451679035631?Math.pow(e,1/3):e/H9+z9}function Y9(e){return e>U9?e*e*e:H9*(e-z9)}function X9(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function K9(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Z9(e){if(e instanceof Q9)return new Q9(e.h,e.c,e.l,e.opacity);if(e instanceof q9||(e=W9(e)),0===e.a&&0===e.b)return new Q9(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*L9;return new Q9(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function J9(e,t,n,r){return 1===arguments.length?Z9(e):new Q9(e,t,n,null==r?1:r)}function Q9(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function eee(e){if(isNaN(e.h))return new q9(e.l,0,0,e.opacity);var t=e.h*F9;return new q9(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}function tee(e,t){var n=o9((e=V9(e)).l,(t=V9(t)).l),r=o9(e.a,t.a),i=o9(e.b,t.b),a=o9(e.opacity,t.opacity);return function(t){return e.l=n(t),e.a=r(t),e.b=i(t),e.opacity=a(t),e+""}}function nee(e){return function(t,n){var r=e((t=J9(t)).h,(n=J9(n)).h),i=o9(t.c,n.c),a=o9(t.l,n.l),o=o9(t.opacity,n.opacity);return function(e){return t.h=r(e),t.c=i(e),t.l=a(e),t.opacity=o(e),t+""}}}q4(q9,V9,G4(Y4,{brighter:function(e){return new q9(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new q9(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new m6(X9(3.1338561*(t=$9*Y9(t))-1.6168667*(e=1*Y9(e))-.4906146*(n=B9*Y9(n))),X9(-.9787684*t+1.9161415*e+.033454*n),X9(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),q4(Q9,J9,G4(Y4,{brighter:function(e){return new Q9(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new Q9(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return eee(this).rgb()}}));var ree=nee(a9),iee=nee(o9),aee=-.29227,oee=-.90649,see=1.97294,lee=-1.7884503806,uee=3.5172982438,cee=-.6557636667999999;function dee(e){if(e instanceof fee)return new fee(e.h,e.s,e.l,e.opacity);e instanceof m6||(e=f6(e));var t=e.g/255,n=e.b/255,r=(cee*n+lee*(e.r/255)-uee*t)/(cee+lee-uee),i=n-r,a=(see*(t-r)-aee*i)/oee,o=Math.sqrt(a*a+i*i)/(see*r*(1-r)),s=o?Math.atan2(a,i)*L9-120:NaN;return new fee(s<0?s+360:s,o,r,e.opacity)}function hee(e,t,n,r){return 1===arguments.length?dee(e):new fee(e,t,n,null==r?1:r)}function fee(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function pee(e){return function t(n){function r(t,r){var i=e((t=hee(t)).h,(r=hee(r)).h),a=o9(t.s,r.s),o=o9(t.l,r.l),s=o9(t.opacity,r.opacity);return function(e){return t.h=i(e),t.s=a(e),t.l=o(Math.pow(e,n)),t.opacity=s(e),t+""}}return n=+n,r.gamma=t,r}(1)}q4(fee,hee,G4(Y4,{brighter:function(e){return e=null==e?K4:Math.pow(K4,e),new fee(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?X4:Math.pow(X4,e),new fee(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*F9,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new m6(255*(t+n*(-.14861*r+1.78277*i)),255*(t+n*(aee*r+oee*i)),255*(t+n*(see*r)),this.opacity)}}));var mee=pee(a9),gee=pee(o9);function vee(e,t){void 0===t&&(t=e,e=_9);for(var n=0,r=t.length-1,i=t[0],a=new Array(r<0?0:r);n<r;)a[n]=e(i,i=t[++n]);return function(e){var t=Math.max(0,Math.min(r-1,Math.floor(e*=r)));return a[t](e-t)}}var yee=function(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n};function bee(e,t,n){const r=e-t+2*n;return e?r>0?r:1:0}const xee="linear",wee="log",_ee="pow",See="sqrt",Eee="symlog",Tee="time",kee="utc",Cee="sequential",Iee="diverging",Oee="quantile",Aee="quantize",Dee="threshold",Mee="ordinal",Nee="point",jee="band",Ree="bin-ordinal",Pee="continuous",Fee="discrete",Lee="discretizing",$ee="interpolating",Bee="temporal";function zee(){const e=W4().unknown(void 0),t=e.domain,n=e.range;let r,i,a=[0,1],o=!1,s=0,l=0,u=.5;function c(){const e=t().length,c=a[1]<a[0],d=a[1-c],h=bee(e,s,l);let f=a[c-0];r=(d-f)/(h||1),o&&(r=Math.floor(r)),f+=(d-f-r*(e-s))*u,i=r*(1-s),o&&(f=Math.round(f),i=Math.round(i));const p=Z2(e).map(e=>f+r*e);return n(c?p.reverse():p)}return delete e.unknown,e.domain=function(e){return arguments.length?(t(e),c()):t()},e.range=function(e){return arguments.length?(a=[+e[0],+e[1]],c()):a.slice()},e.rangeRound=function(e){return a=[+e[0],+e[1]],o=!0,c()},e.bandwidth=function(){return i},e.step=function(){return r},e.round=function(e){return arguments.length?(o=!!e,c()):o},e.padding=function(e){return arguments.length?(l=Math.max(0,Math.min(1,e)),s=l,c()):s},e.paddingInner=function(e){return arguments.length?(s=Math.max(0,Math.min(1,e)),c()):s},e.paddingOuter=function(e){return arguments.length?(l=Math.max(0,Math.min(1,e)),c()):l},e.align=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),c()):u},e.invertRange=function(e){if(null==e[0]||null==e[1])return;const r=a[1]<a[0],o=r?n().reverse():n(),s=o.length-1;let l,u,c,d=+e[0],h=+e[1];return d!=d||h!=h||(h<d&&(c=d,d=h,h=c),h<o[0]||d>a[1-r])?void 0:(l=Math.max(0,L4(o,d)-1),u=d===h?l:L4(o,h)-1,d-o[l]>i+1e-10&&++l,r&&(c=l,l=s-u,u=s-c),l>u?void 0:t().slice(l,u+1))},e.invert=function(t){const n=e.invertRange([t,t]);return n?n[0]:n},e.copy=function(){return zee().domain(t()).range(a).round(o).paddingInner(s).paddingOuter(l).align(u)},c()}var Uee=Array.prototype.map;function Hee(e){return Uee.call(e,oX)}const Wee=Array.prototype.slice,Vee={};function qee(e,t,n){const r=function(){const n=t();return n.invertRange||(n.invertRange=n.invert?(r=n,function(e){let t,n=e[0],i=e[1];return i<n&&(t=n,n=i,i=t),[r.invert(n),r.invert(i)]}):n.invertExtent?function(e){return function(t){const n=e.range();let r,i,a,o,s=t[0],l=t[1],u=-1;for(l<s&&(i=s,s=l,l=i),a=0,o=n.length;a<o;++a)n[a]>=s&&n[a]<=l&&(u<0&&(u=a),r=a);if(!(u<0))return s=e.invertExtent(n[u]),l=e.invertExtent(n[r]),[void 0===s[0]?s[1]:s[0],void 0===l[1]?l[0]:l[1]]}}(n):void 0),n.type=e,n;var r};return r.metadata=lK(EX(n)),r}function Gee(e,t,n){return arguments.length>1?(Vee[e]=qee(e,t,n),this):Yee(e)?Vee[e]:void 0}function Yee(e){return LX(Vee,e)}function Xee(e,t){const n=Vee[e];return n&&n.metadata[t]}function Kee(e){return Xee(e,Pee)}function Zee(e){return Xee(e,Fee)}function Jee(e){return Xee(e,Lee)}function Qee(e){return Xee(e,wee)}function ete(e){return Xee(e,$ee)}function tte(e){return Xee(e,Oee)}Gee("identity",(function e(t){var n;function r(e){return isNaN(e=+e)?n:e}return r.invert=r,r.domain=r.range=function(e){return arguments.length?(t=Array.from(e,$6),r):t.slice()},r.unknown=function(e){return arguments.length?(n=e,r):n},r.copy=function(){return e(t).unknown(n)},t=arguments.length?Array.from(t,$6):[0,1],Y6(r)})),Gee(xee,(function e(){var t=G6();return t.copy=function(){return V6(t,e())},z4.apply(t,arguments),Y6(t)}),Pee),Gee(wee,(function e(){var t=n8(q6()).domain([1,10]);return t.copy=function(){return V6(t,e()).base(t.base())},z4.apply(t,arguments),t}),[Pee,wee]),Gee(_ee,s8,Pee),Gee(See,(function(){return s8.apply(null,arguments).exponent(.5)}),Pee),Gee(Eee,(function e(){var t=c8(q6());return t.copy=function(){return V6(t,e()).constant(t.constant())},z4.apply(t,arguments)}),Pee),Gee(Tee,(function(){return z4.apply(H7(gQ,d8,dQ,pQ,h8,f8,p8,g8,w8).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),[Pee,Bee]),Gee(kee,(function(){return z4.apply(H7(yQ,W7,oQ,uQ,V7,q7,p8,g8,_8).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}),[Pee,Bee]),Gee(Cee,X7,[Pee,$ee]),Gee("".concat(Cee,"-").concat(xee),X7,[Pee,$ee]),Gee("".concat(Cee,"-").concat(wee),(function e(){var t=n8(G7()).domain([1,10]);return t.copy=function(){return Y7(t,e()).base(t.base())},U4.apply(t,arguments)}),[Pee,$ee,wee]),Gee("".concat(Cee,"-").concat(_ee),K7,[Pee,$ee]),Gee("".concat(Cee,"-").concat(See),(function(){return K7.apply(null,arguments).exponent(.5)}),[Pee,$ee]),Gee("".concat(Cee,"-").concat(Eee),(function e(){var t=c8(G7());return t.copy=function(){return Y7(t,e()).constant(t.constant())},U4.apply(t,arguments)}),[Pee,$ee]),Gee("".concat(Iee,"-").concat(xee),(function e(){var t=Y6(J7()(z6));return t.copy=function(){return Y7(t,e())},U4.apply(t,arguments)}),[Pee,$ee]),Gee("".concat(Iee,"-").concat(wee),(function e(){var t=n8(J7()).domain([.1,1,10]);return t.copy=function(){return Y7(t,e()).base(t.base())},U4.apply(t,arguments)}),[Pee,$ee,wee]),Gee("".concat(Iee,"-").concat(_ee),Q7,[Pee,$ee]),Gee("".concat(Iee,"-").concat(See),(function(){return Q7.apply(null,arguments).exponent(.5)}),[Pee,$ee]),Gee("".concat(Iee,"-").concat(Eee),(function e(){var t=c8(J7());return t.copy=function(){return Y7(t,e()).constant(t.constant())},U4.apply(t,arguments)}),[Pee,$ee]),Gee(Oee,(function e(){var t,n=[],r=[],i=[];function a(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=t2(n,e/t);return o}function o(e){return isNaN(e=+e)?t:r[B4(i,e)]}return o.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},o.domain=function(e){if(!arguments.length)return n.slice();n=[];for(let t of e)null==t||isNaN(t=+t)||n.push(t);return n.sort(VZ),a()},o.range=function(e){return arguments.length?(r=Array.from(e),a()):r.slice()},o.unknown=function(e){return arguments.length?(t=e,o):t},o.quantiles=function(){return i.slice()},o.copy=function(){return e().domain(n).range(r).unknown(t)},z4.apply(o,arguments)}),[Lee,Oee]),Gee(Aee,(function e(){var t,n=0,r=1,i=1,a=[.5],o=[0,1];function s(e){return e<=e?o[B4(a,e,0,i)]:t}function l(){var e=-1;for(a=new Array(i);++e<i;)a[e]=((e+1)*r-(e-i)*n)/(i+1);return s}return s.domain=function(e){return arguments.length?([n,r]=e,n=+n,r=+r,l()):[n,r]},s.range=function(e){return arguments.length?(i=(o=Array.from(e)).length-1,l()):o.slice()},s.invertExtent=function(e){var t=o.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,a[0]]:t>=i?[a[i-1],r]:[a[t-1],a[t]]},s.unknown=function(e){return arguments.length?(t=e,s):s},s.thresholds=function(){return a.slice()},s.copy=function(){return e().domain([n,r]).range(o).unknown(t)},z4.apply(Y6(s),arguments)}),Lee),Gee(Dee,(function e(){var t,n=[.5],r=[0,1],i=1;function a(e){return e<=e?r[B4(n,e,0,i)]:t}return a.domain=function(e){return arguments.length?(n=Array.from(e),i=Math.min(n.length,r.length-1),a):n.slice()},a.range=function(e){return arguments.length?(r=Array.from(e),i=Math.min(n.length,r.length-1),a):r.slice()},a.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},a.unknown=function(e){return arguments.length?(t=e,a):t},a.copy=function(){return e().domain(n).range(r).unknown(t)},z4.apply(a,arguments)}),Lee),Gee(Ree,(function e(){let t=[],n=[];function r(e){return null==e||e!=e?void 0:n[(B4(t,e)-1)%n.length]}return r.domain=function(e){return arguments.length?(t=Hee(e),r):t.slice()},r.range=function(e){return arguments.length?(n=Wee.call(e),r):n.slice()},r.tickFormat=function(e,n){return V4(t[0],aX(t),null==e?10:e,n)},r.copy=function(){return e().domain(r.domain()).range(r.range())},r}),[Fee,Lee]),Gee(Mee,W4,Fee),Gee(jee,zee,Fee),Gee(Nee,(function(){return function e(t){const n=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return e(n())},t}(zee().paddingInner(1))}),Fee);const nte=["clamp","base","constant","exponent"];function rte(e,t){const n=t[0],r=aX(t)-n;return function(t){return e(n+t*r)}}function ite(e,t,n){return vee(ste(t||"rgb",n),e)}function ate(e,t){const n=new Array(t),r=t+1;for(let i=0;i<t;)n[i]=e(++i/r);return n}function ote(e,t,n){const r=n-t;let i,a,o;return r&&Number.isFinite(r)?(i=(a=e.type).indexOf("-"),a=i<0?a:a.slice(i+1),o=Gee(a)().domain([t,n]).range([0,1]),nte.forEach(t=>e[t]?o[t](e[t]()):0),o):MX(.5)}function ste(e,t){const n=G[function(e){return"interpolate"+e.toLowerCase().split("-").map(e=>e[0].toUpperCase()+e.slice(1)).join("")}(e)];return null!=t&&n&&n.gamma?n.gamma(t):n}function lte(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}function ute(e,t){for(const n in e)dte(n,t(e[n]))}const cte={};function dte(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(cte[e]=t,this):cte[e]}ute({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},lte),ute({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},e=>ite(lte(e)));const hte="symbol",fte=e=>QY(e)?e.map(e=>String(e)):String(e),pte=(e,t)=>e[1]-t[1],mte=(e,t)=>t[1]-e[1];function gte(e,t,n){let r;return GX(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),null!=n&&(t=Math.min(t,Math.floor(nK(e.domain())/n||1)))),eX(t)&&(r=t.step,t=t.interval),XX(t)&&(t=e.type===Tee?NJ(t):e.type==kee?jJ(t):FY("Only time and utc scales accept interval strings."),r&&(t=t.every(r))),t}function vte(e,t,n){let r=e.range(),i=r[0],a=aX(r),o=pte;if(i>a&&(r=a,a=i,i=r,o=mte),i=Math.floor(i),a=Math.ceil(a),t=t.map(t=>[t,e(t)]).filter(e=>i<=e[1]&&e[1]<=a).sort(o).map(e=>e[0]),n>0&&t.length>1){const e=[t[0],aX(t)];for(;t.length>n&&t.length>=3;)t=t.filter((e,t)=>!(t%2));t.length<3&&(t=e)}return t}function yte(e,t){return e.bins?vte(e,e.bins):e.ticks?e.ticks(t):e.domain()}function bte(e,t,n,r,i,a){const o=t.type;let s=fte;if(o===Tee||i===Tee)s=e.timeFormat(r);else if(o===kee||i===kee)s=e.utcFormat(r);else if(Qee(o)){const i=e.formatFloat(r);if(a||t.bins)s=i;else{const e=xte(t,n,!1);s=t=>e(t)?i(t):""}}else if(t.tickFormat){const i=t.domain();s=e.formatSpan(i[0],i[i.length-1],n,r)}else r&&(s=e.format(r));return s}function xte(e,t,n){const r=yte(e,t),i=e.base(),a=Math.log(i),o=Math.max(1,i*t/r.length),s=e=>{let t=e/Math.pow(i,Math.round(Math.log(e)/a));return t*i<i-.5&&(t*=i),t<=o};return n?r.filter(s):s}const wte={[Oee]:"quantiles",[Aee]:"thresholds",[Dee]:"domain"},_te={[Oee]:"quantiles",[Aee]:"domain"};function Ste(e,t){return e.bins?function(e){const t=e.slice(0,-1);return t.max=aX(e),t}(e.bins):e.type===wee?xte(e,t,!0):wte[e.type]?function(e){const t=[-1/0].concat(e);return t.max=1/0,t}(e[wte[e.type]]()):yte(e,t)}function Ete(e,t,n,r,i,a,o){const s=_te[t.type]&&a!==Tee&&a!==kee?function(e,t,n){const r=t[_te[t.type]](),i=r.length;let a,o=i>1?r[1]-r[0]:r[0];for(a=1;a<i;++a)o=Math.min(o,r[a]-r[a-1]);return e.formatSpan(0,o,30,n)}(e,t,i):bte(e,t,n,i,a,o);return r===hte&&(e=>wte[e.type]||e.bins)(t)?Tte(s):"discrete"===r?Cte(s):Ite(s)}const Tte=e=>(t,n,r)=>{const i=kte(r[n+1],kte(r.max,1/0)),a=Ote(t,e),o=Ote(i,e);return a&&o?a+" \u2013 "+o:o?"< "+o:"\u2265 "+a},kte=(e,t)=>null!=e?e:t,Cte=e=>(t,n)=>n?e(t):null,Ite=e=>t=>e(t),Ote=(e,t)=>Number.isFinite(e)?t(e):null;function Ate(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=function(e,t,n,r){const i=r||t.type;return XX(n)&&Xee(i,Bee)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||i!==Tee?n||i!==kee?Ete(e,t,5,null,n,r,!0):e.utcFormat("%A, %d %B %Y, %X UTC"):e.timeFormat("%A, %d %B %Y, %X")}(e,t,n.format,n.formatType);if(Jee(t.type)){const e=Ste(t).slice(1).map(i),n=e.length;return"".concat(n," boundar").concat(1===n?"y":"ies",": ").concat(e.join(", "))}if(Zee(t.type)){const e=t.domain(),n=e.length,a=n>r?e.slice(0,r-2).map(i).join(", ")+", ending with "+e.slice(-1).map(i):e.map(i).join(", ");return"".concat(n," value").concat(1===n?"":"s",": ").concat(a)}{const e=t.domain();return"values from ".concat(i(e[0])," to ").concat(i(aX(e)))}}let Dte=0;const Mte="p_";function Nte(e){return e&&e.gradient}function jte(e,t,n){const r=e.gradient;let i=e.id,a="radial"===r?Mte:"";return i||(i=e.id="gradient_"+Dte++,"radial"===r?(e.x1=Rte(e.x1,.5),e.y1=Rte(e.y1,.5),e.r1=Rte(e.r1,0),e.x2=Rte(e.x2,.5),e.y2=Rte(e.y2,.5),e.r2=Rte(e.r2,.5),a=Mte):(e.x1=Rte(e.x1,0),e.y1=Rte(e.y1,0),e.x2=Rte(e.x2,1),e.y2=Rte(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+a+i+")"}function Rte(e,t){return null!=e?e:t}function Pte(e,t){var n,r=[];return n={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:r,stop:function(e,t){return r.push({offset:e,color:t}),n}}}const Fte={basis:{curve:function(e){return new _3(e)}},"basis-closed":{curve:function(e){return new E3(e)}},"basis-open":{curve:function(e){return new T3(e)}},bundle:{curve:C3,tension:"beta",value:.85},cardinal:{curve:A3,tension:"tension",value:0},"cardinal-open":{curve:M3,tension:"tension",value:0},"cardinal-closed":{curve:j3,tension:"tension",value:0},"catmull-rom":{curve:K3,tension:"alpha",value:.5},"catmull-rom-closed":{curve:J3,tension:"alpha",value:.5},"catmull-rom-open":{curve:e4,tension:"alpha",value:.5},linear:{curve:n4},"linear-closed":{curve:function(e){return new r4(e)}},monotone:{horizontal:function(e){return new u4(e)},vertical:function(e){return new l4(e)}},natural:{curve:function(e){return new d4(e)}},step:{curve:function(e){return new f4(e,.5)}},"step-after":{curve:function(e){return new f4(e,1)}},"step-before":{curve:function(e){return new f4(e,0)}}};function Lte(e,t,n){var r=LX(Fte,e)&&Fte[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&null!=n&&(i=i[r.tension](n))),i}const $te={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Bte=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function zte(e){const t=[];let n,r,i,a,o,s,l,u,c,d;const h=e.slice().replace(Bte[0],"###$1").split(Bte[1]).slice(1);for(l=0,c=h.length;l<c;++l){for(n=h[l],r=n.slice(1).trim().replace(Bte[2],"$1###$2").replace(Bte[3],"$1###$2").split(Bte[4]),o=n.charAt(0),i=[o],u=0,d=r.length;u<d;++u)(a=+r[u])===a&&i.push(a);if(s=$te[o.toLowerCase()],i.length-1>s){const e=i.length;for(u=1,t.push([o].concat(i.slice(u,u+=s))),o="M"===o?"L":"m"===o?"l":o;u<e;u+=s)t.push([o].concat(i.slice(u,u+s)))}else t.push(i)}return t}const Ute=Math.PI/180,Hte=Math.PI/2,Wte=2*Math.PI,Vte=Math.sqrt(3)/2;var qte={},Gte={},Yte=[].join;function Xte(e){const t=Yte.call(e);if(Gte[t])return Gte[t];var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7];const c=u*o,d=-l*s,h=l*o,f=u*s,p=Math.cos(i),m=Math.sin(i),g=Math.cos(a),v=Math.sin(a),y=.5*(a-i),b=Math.sin(.5*y),x=8/3*b*b/Math.sin(y),w=n+p-x*m,_=r+m+x*p,S=n+g,E=r+v,T=S+x*v,k=E-x*g;return Gte[t]=[c*w+d*_,h*w+f*_,c*T+d*k,h*T+f*k,c*S+d*E,h*S+f*E]}const Kte=["l",0,0,0,0,0,0,0];function Zte(e,t,n){const r=Kte[0]=e[0];if("a"===r||"A"===r)Kte[1]=t*e[1],Kte[2]=n*e[2],Kte[3]=e[3],Kte[4]=e[4],Kte[5]=e[5],Kte[6]=t*e[6],Kte[7]=n*e[7];else if("h"===r||"H"===r)Kte[1]=t*e[1];else if("v"===r||"V"===r)Kte[1]=n*e[1];else for(var i=1,a=e.length;i<a;++i)Kte[i]=(i%2==1?t:n)*e[i];return Kte}function Jte(e,t,n,r,i,a){var o,s,l,u,c,d=null,h=0,f=0,p=0,m=0;null==n&&(n=0),null==r&&(r=0),null==i&&(i=1),null==a&&(a=i),e.beginPath&&e.beginPath();for(var g=0,v=t.length;g<v;++g){switch(o=t[g],1===i&&1===a||(o=Zte(o,i,a)),o[0]){case"l":e.lineTo((h+=o[1])+n,(f+=o[2])+r);break;case"L":e.lineTo((h=o[1])+n,(f=o[2])+r);break;case"h":e.lineTo((h+=o[1])+n,f+r);break;case"H":e.lineTo((h=o[1])+n,f+r);break;case"v":e.lineTo(h+n,(f+=o[1])+r);break;case"V":e.lineTo(h+n,(f=o[1])+r);break;case"m":e.moveTo((h+=o[1])+n,(f+=o[2])+r);break;case"M":e.moveTo((h=o[1])+n,(f=o[2])+r);break;case"c":e.bezierCurveTo(h+o[1]+n,f+o[2]+r,(p=h+o[3])+n,(m=f+o[4])+r,(s=h+o[5])+n,(l=f+o[6])+r),h=s,f=l;break;case"C":e.bezierCurveTo(o[1]+n,o[2]+r,(p=o[3])+n,(m=o[4])+r,(h=o[5])+n,(f=o[6])+r);break;case"s":e.bezierCurveTo((p=2*h-p)+n,(m=2*f-m)+r,h+o[1]+n,f+o[2]+r,(s=h+o[3])+n,(l=f+o[4])+r),p=h+o[1],m=f+o[2],h=s,f=l;break;case"S":e.bezierCurveTo((p=2*h-p)+n,(m=2*f-m)+r,o[1]+n,o[2]+r,(s=o[3])+n,(l=o[4])+r),h=s,f=l,p=o[1],m=o[2];break;case"q":e.quadraticCurveTo((p=h+o[1])+n,(m=f+o[2])+r,(s=h+o[3])+n,(l=f+o[4])+r),h=s,f=l;break;case"Q":e.quadraticCurveTo(o[1]+n,o[2]+r,(s=o[3])+n,(l=o[4])+r),h=s,f=l,p=o[1],m=o[2];break;case"t":s=h+o[1],l=f+o[2],null===d[0].match(/[QqTt]/)?(p=h,m=f):"t"===d[0]?(p=2*h-u,m=2*f-c):"q"===d[0]&&(p=2*h-p,m=2*f-m),u=p,c=m,e.quadraticCurveTo(p+n,m+r,s+n,l+r),p=(h=s)+o[1],m=(f=l)+o[2];break;case"T":e.quadraticCurveTo((p=2*h-p)+n,(m=2*f-m)+r,(s=o[1])+n,(l=o[2])+r),h=s,f=l;break;case"a":Qte(e,h+n,f+r,[o[1],o[2],o[3],o[4],o[5],o[6]+h+n,o[7]+f+r]),h+=o[6],f+=o[7];break;case"A":Qte(e,h+n,f+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),h=o[6],f=o[7];break;case"z":case"Z":e.closePath()}d=o}}function Qte(e,t,n,r){const i=function(e,t,n,r,i,a,o,s,l){const u=Yte.call(arguments);if(qte[u])return qte[u];const c=o*Ute,d=Math.sin(c),h=Math.cos(c),f=h*(s-e)*.5+d*(l-t)*.5,p=h*(l-t)*.5-d*(s-e)*.5;let m=f*f/((n=Math.abs(n))*n)+p*p/((r=Math.abs(r))*r);m>1&&(m=Math.sqrt(m),n*=m,r*=m);const g=h/n,v=d/n,y=-d/r,b=h/r,x=g*s+v*l,w=y*s+b*l,_=g*e+v*t,S=y*e+b*t;let E=1/((_-x)*(_-x)+(S-w)*(S-w))-.25;E<0&&(E=0);let T=Math.sqrt(E);a==i&&(T=-T);const k=.5*(x+_)-T*(S-w),C=.5*(w+S)+T*(_-x),I=Math.atan2(w-C,x-k);let O=Math.atan2(S-C,_-k)-I;O<0&&1===a?O+=Wte:O>0&&0===a&&(O-=Wte);const A=Math.ceil(Math.abs(O/(Hte+.001))),D=[];for(let M=0;M<A;++M)D[M]=[k,C,I+M*O/A,I+(M+1)*O/A,n,r,d,h];return qte[u]=D}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let a=0;a<i.length;++a){const t=Xte(i[a]);e.bezierCurveTo(t[0],t[1],t[2],t[3],t[4],t[5])}}const ene=.5773502691896257,tne={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,Wte)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,a=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-a),e.lineTo(i,-a),e.lineTo(0,-n),e.lineTo(-i,-a),e.lineTo(-r,-a),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=Vte*n,i=r-n*ene,a=n/4;e.moveTo(0,-r-i),e.lineTo(-a,r-i),e.lineTo(a,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=Vte*n,i=r-n*ene;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Vte*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Vte*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Vte*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Vte*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function nne(e){return LX(tne,e)?tne[e]:function(e){if(!LX(rne,e)){const t=zte(e);rne[e]={draw:function(e,n){Jte(e,t,0,0,Math.sqrt(n)/2)}}}return rne[e]}(e)}var rne={};const ine=.448084975506;function ane(e){return e.x}function one(e){return e.y}function sne(e){return e.width}function lne(e){return e.height}function une(e){return"function"==typeof e?e:()=>+e}function cne(e,t,n){return Math.max(t,Math.min(e,n))}function dne(){var e=ane,t=one,n=sne,r=lne,i=une(0),a=i,o=i,s=i,l=null;function u(u,c,d){var h,f=null!=c?c:+e.call(this,u),p=null!=d?d:+t.call(this,u),m=+n.call(this,u),g=+r.call(this,u),v=Math.min(m,g)/2,y=cne(+i.call(this,u),0,v),b=cne(+a.call(this,u),0,v),x=cne(+o.call(this,u),0,v),w=cne(+s.call(this,u),0,v);if(l||(l=h=x4()),y<=0&&b<=0&&x<=0&&w<=0)l.rect(f,p,m,g);else{var _=f+m,S=p+g;l.moveTo(f+y,p),l.lineTo(_-b,p),l.bezierCurveTo(_-ine*b,p,_,p+ine*b,_,p+b),l.lineTo(_,S-w),l.bezierCurveTo(_,S-ine*w,_-ine*w,S,_-w,S),l.lineTo(f+x,S),l.bezierCurveTo(f+ine*x,S,f,S-ine*x,f,S-x),l.lineTo(f,p+y),l.bezierCurveTo(f,p+ine*y,f+ine*y,p,f+y,p),l.closePath()}if(h)return l=null,h+""||null}return u.x=function(t){return arguments.length?(e=une(t),u):e},u.y=function(e){return arguments.length?(t=une(e),u):t},u.width=function(e){return arguments.length?(n=une(e),u):n},u.height=function(e){return arguments.length?(r=une(e),u):r},u.cornerRadius=function(e,t,n,r){return arguments.length?(i=une(e),a=null!=t?une(t):i,s=null!=n?une(n):i,o=null!=r?une(r):a,u):i},u.context=function(e){return arguments.length?(l=null==e?null:e,u):l},u}function hne(){var e,t,n,r,i,a,o,s,l=null;function u(e,t,n){const r=n/2;if(i){var u=o-t,c=e-a;if(u||c){var d=Math.sqrt(u*u+c*c),h=(u/=d)*s,f=(c/=d)*s,p=Math.atan2(c,u);l.moveTo(a-h,o-f),l.lineTo(e-u*r,t-c*r),l.arc(e,t,r,p-Math.PI,p),l.lineTo(a+h,o+f),l.arc(a,o,s,p,p+Math.PI)}else l.arc(e,t,r,0,Wte);l.closePath()}else i=1;a=e,o=t,s=r}function c(a){var o,s,c,d=a.length,h=!1;for(null==l&&(l=c=x4()),o=0;o<=d;++o)!(o<d&&r(s=a[o],o,a))===h&&(h=!h)&&(i=0),h&&u(+e(s,o,a),+t(s,o,a),+n(s,o,a));if(c)return l=null,c+""||null}return c.x=function(t){return arguments.length?(e=t,c):e},c.y=function(e){return arguments.length?(t=e,c):t},c.size=function(e){return arguments.length?(n=e,c):n},c.defined=function(e){return arguments.length?(r=e,c):r},c.context=function(e){return arguments.length?(l=null==e?null:e,c):l},c}function fne(e,t){return null!=e?e:t}const pne=e=>e.x||0,mne=e=>e.y||0,gne=e=>!(!1===e.defined),vne=function(){var e=_4,t=S4,n=w4(0),r=null,i=E4,a=T4,o=k4,s=null;function l(){var l,u,c=+e.apply(this,arguments),d=+t.apply(this,arguments),h=i.apply(this,arguments)-W3,f=a.apply(this,arguments)-W3,p=R3(f-h),m=f>h;if(s||(s=l=x4()),d<c&&(u=d,d=c,c=u),d>U3)if(p>V3-U3)s.moveTo(d*F3(h),d*B3(h)),s.arc(0,0,d,h,f,!m),c>U3&&(s.moveTo(c*F3(f),c*B3(f)),s.arc(0,0,c,f,h,m));else{var g,v,y=h,b=f,x=h,w=f,_=p,S=p,E=o.apply(this,arguments)/2,T=E>U3&&(r?+r.apply(this,arguments):z3(c*c+d*d)),k=$3(R3(d-c)/2,+n.apply(this,arguments)),C=k,I=k;if(T>U3){var O=G3(T/c*B3(E)),A=G3(T/d*B3(E));(_-=2*O)>U3?(x+=O*=m?1:-1,w-=O):(_=0,x=w=(h+f)/2),(S-=2*A)>U3?(y+=A*=m?1:-1,b-=A):(S=0,y=b=(h+f)/2)}var D=d*F3(y),M=d*B3(y),N=c*F3(w),j=c*B3(w);if(k>U3){var R,P=d*F3(b),F=d*B3(b),L=c*F3(x),$=c*B3(x);if(p<H3&&(R=C4(D,M,L,$,P,F,N,j))){var B=D-R[0],z=M-R[1],U=P-R[0],H=F-R[1],W=1/B3(q3((B*U+z*H)/(z3(B*B+z*z)*z3(U*U+H*H)))/2),V=z3(R[0]*R[0]+R[1]*R[1]);C=$3(k,(c-V)/(W-1)),I=$3(k,(d-V)/(W+1))}}S>U3?I>U3?(g=I4(L,$,D,M,d,I,m),v=I4(P,F,N,j,d,I,m),s.moveTo(g.cx+g.x01,g.cy+g.y01),I<k?s.arc(g.cx,g.cy,I,P3(g.y01,g.x01),P3(v.y01,v.x01),!m):(s.arc(g.cx,g.cy,I,P3(g.y01,g.x01),P3(g.y11,g.x11),!m),s.arc(0,0,d,P3(g.cy+g.y11,g.cx+g.x11),P3(v.cy+v.y11,v.cx+v.x11),!m),s.arc(v.cx,v.cy,I,P3(v.y11,v.x11),P3(v.y01,v.x01),!m))):(s.moveTo(D,M),s.arc(0,0,d,y,b,!m)):s.moveTo(D,M),c>U3&&_>U3?C>U3?(g=I4(N,j,P,F,c,-C,m),v=I4(D,M,L,$,c,-C,m),s.lineTo(g.cx+g.x01,g.cy+g.y01),C<k?s.arc(g.cx,g.cy,C,P3(g.y01,g.x01),P3(v.y01,v.x01),!m):(s.arc(g.cx,g.cy,C,P3(g.y01,g.x01),P3(g.y11,g.x11),!m),s.arc(0,0,c,P3(g.cy+g.y11,g.cx+g.x11),P3(v.cy+v.y11,v.cx+v.x11),m),s.arc(v.cx,v.cy,C,P3(v.y11,v.x11),P3(v.y01,v.x01),!m))):s.arc(0,0,c,w,x,m):s.lineTo(N,j)}else s.moveTo(0,0);if(s.closePath(),l)return s=null,l+""||null}return l.centroid=function(){var n=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +a.apply(this,arguments))/2-H3/2;return[F3(r)*n,B3(r)*n]},l.innerRadius=function(t){return arguments.length?(e="function"==typeof t?t:w4(+t),l):e},l.outerRadius=function(e){return arguments.length?(t="function"==typeof e?e:w4(+e),l):t},l.cornerRadius=function(e){return arguments.length?(n="function"==typeof e?e:w4(+e),l):n},l.padRadius=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:w4(+e),l):r},l.startAngle=function(e){return arguments.length?(i="function"==typeof e?e:w4(+e),l):i},l.endAngle=function(e){return arguments.length?(a="function"==typeof e?e:w4(+e),l):a},l.padAngle=function(e){return arguments.length?(o="function"==typeof e?e:w4(+e),l):o},l.context=function(e){return arguments.length?(s=null==e?null:e,l):s},l}().startAngle(e=>e.startAngle||0).endAngle(e=>e.endAngle||0).padAngle(e=>e.padAngle||0).innerRadius(e=>e.innerRadius||0).outerRadius(e=>e.outerRadius||0).cornerRadius(e=>e.cornerRadius||0),yne=N4().x(pne).y1(mne).y0(e=>(e.y||0)+(e.height||0)).defined(gne),bne=N4().y(mne).x1(pne).x0(e=>(e.x||0)+(e.width||0)).defined(gne),xne=M4().x(pne).y(mne).defined(gne),wne=dne().x(pne).y(mne).width(e=>e.width||0).height(e=>e.height||0).cornerRadius(e=>fne(e.cornerRadiusTopLeft,e.cornerRadius)||0,e=>fne(e.cornerRadiusTopRight,e.cornerRadius)||0,e=>fne(e.cornerRadiusBottomRight,e.cornerRadius)||0,e=>fne(e.cornerRadiusBottomLeft,e.cornerRadius)||0),_ne=function(e,t){var n=null;function r(){var r;if(n||(n=r=x4()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),r)return n=null,r+""||null}return e="function"==typeof e?e:w4(e||j4),t="function"==typeof t?t:w4(void 0===t?64:+t),r.type=function(t){return arguments.length?(e="function"==typeof t?t:w4(t),r):e},r.size=function(e){return arguments.length?(t="function"==typeof e?e:w4(+e),r):t},r.context=function(e){return arguments.length?(n=null==e?null:e,r):n},r}().type(e=>nne(e.shape||"circle")).size(e=>fne(e.size,64)),Sne=hne().x(pne).y(mne).defined(gne).size(e=>e.size||1);function Ene(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function Tne(e,t,n,r){return wne.context(e)(t,n,r)}var kne=1;function Cne(){kne=1}function Ine(e,t,n){var r=t.clip,i=e._defs,a=t.clip_id||(t.clip_id="clip"+kne++),o=i.clipping[a]||(i.clipping[a]={id:a});return kX(r)?o.path=r(null):Ene(n)?o.path=Tne(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+a+")"}function One(e){this.clear(),e&&this.union(e)}function Ane(e){this.mark=e,this.bounds=this.bounds||new One}function Dne(e){Ane.call(this,e),this.items=this.items||[]}function Mne(e){this._pending=0,this._loader=e||l1()}function Nne(e){e._pending+=1}function jne(e){e._pending-=1}function Rne(e,t,n){if(t.stroke&&0!==t.opacity&&0!==t.strokeOpacity){const r=null!=t.strokeWidth?+t.strokeWidth:1;e.expand(r+(n?function(e,t){return e.strokeJoin&&"miter"!==e.strokeJoin?0:t}(t,r):0))}return e}One.prototype={clone(){return new One(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:a,y2:o}=this,s=Math.cos(e),l=Math.sin(e),u=t-t*s+n*l,c=n-t*l-n*s;return[s*r-l*i+u,l*r+s*i+c,s*r-l*o+u,l*r+s*o+c,s*a-l*i+u,l*a+s*i+c,s*a-l*o+u,l*a+s*o+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},UX(Dne,Ane),Mne.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return Nne(t),t._loader.sanitize(e,{context:"href"}).then(e=>(jne(t),e)).catch(()=>(jne(t),null))},loadImage(e){const t=this,n=P4();return Nne(t),t._loader.sanitize(e,{context:"image"}).then(e=>{const r=e.href;if(!r||!n)throw{url:r};const i=new n,a=LX(e,"crossOrigin")?e.crossOrigin:"anonymous";return null!=a&&(i.crossOrigin=a),i.onload=()=>jne(t),i.onerror=()=>jne(t),i.src=r,i}).catch(e=>(jne(t),{complete:!1,width:0,height:0,src:e&&e.url||""}))},ready(){const e=this;return new Promise(t=>{!function n(r){e.pending()?setTimeout(()=>{n(!0)},10):t(r)}(!1)})}};const Pne=Wte-1e-8;let Fne,Lne,$ne,Bne,zne,Une,Hne,Wne;const Vne=(e,t)=>Fne.add(e,t),qne=(e,t)=>Vne(Lne=e,$ne=t),Gne=e=>Vne(e,Fne.y1),Yne=e=>Vne(Fne.x1,e),Xne=(e,t)=>zne*e+Hne*t,Kne=(e,t)=>Une*e+Wne*t,Zne=(e,t)=>Vne(Xne(e,t),Kne(e,t)),Jne=(e,t)=>qne(Xne(e,t),Kne(e,t));function Qne(e,t){return Fne=e,t?(Bne=t*Ute,zne=Wne=Math.cos(Bne),Une=Math.sin(Bne),Hne=-Une):(zne=Wne=1,Bne=Une=Hne=0),ere}const ere={beginPath(){},closePath(){},moveTo:Jne,lineTo:Jne,rect(e,t,n,r){Bne?(Zne(e+n,t),Zne(e+n,t+r),Zne(e,t+r),Jne(e,t)):(Vne(e+n,t+r),qne(e,t))},quadraticCurveTo(e,t,n,r){const i=Xne(e,t),a=Kne(e,t),o=Xne(n,r),s=Kne(n,r);tre(Lne,i,o,Gne),tre($ne,a,s,Yne),qne(o,s)},bezierCurveTo(e,t,n,r,i,a){const o=Xne(e,t),s=Kne(e,t),l=Xne(n,r),u=Kne(n,r),c=Xne(i,a),d=Kne(i,a);nre(Lne,o,l,c,Gne),nre($ne,s,u,d,Yne),qne(c,d)},arc(e,t,n,r,i,a){if(r+=Bne,i+=Bne,Lne=n*Math.cos(i)+e,$ne=n*Math.sin(i)+t,Math.abs(i-r)>Pne)Vne(e-n,t-n),Vne(e+n,t+n);else{const o=r=>Vne(n*Math.cos(r)+e,n*Math.sin(r)+t);let s,l;if(o(r),o(i),i!==r)if((r%=Wte)<0&&(r+=Wte),(i%=Wte)<0&&(i+=Wte),i<r&&(a=!a,s=r,r=i,i=s),a)for(i-=Wte,s=r-r%Hte,l=0;l<4&&s>i;++l,s-=Hte)o(s);else for(s=r-r%Hte+Hte,l=0;l<4&&s<i;++l,s+=Hte)o(s)}}};function tre(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function nre(e,t,n,r,i){const a=r-e+3*t-3*n,o=e+n-2*t,s=e-t;let l,u=0,c=0;Math.abs(a)>1e-14?(l=o*o+s*a,l>=0&&(l=Math.sqrt(l),u=(-o+l)/a,c=(-o-l)/a)):u=.5*s/o,0<u&&u<1&&i(rre(u,e,t,n,r)),0<c&&c<1&&i(rre(c,e,t,n,r))}function rre(e,t,n,r,i){const a=1-e,o=a*a,s=e*e;return o*a*t+3*o*e*n+3*a*s*r+s*e*i}var ire=(ire=R4(1,1))?ire.getContext("2d"):null;const are=new One;function ore(e){return function(t,n){if(!ire)return!0;e(ire,t),are.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:a,y2:o}=are;for(let e=i;e<=o;++e)for(let t=r;t<=a;++t)if(ire.isPointInPath(t,e))return!0;return!1}}function sre(e,t){return t.contains(e.x||0,e.y||0)}function lre(e,t){const n=e.x||0,r=e.y||0;return t.intersects(are.set(n,r,n+(e.width||0),r+(e.height||0)))}function ure(e,t){const n=e.x||0,r=e.y||0;return cre(t,n,r,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r)}function cre(e,t,n,r,i){const{x1:a,y1:o,x2:s,y2:l}=e,u=r-t,c=i-n;let d,h,f,p,m=0,g=1;for(p=0;p<4;++p){if(0===p&&(d=-u,h=-(a-t)),1===p&&(d=u,h=s-t),2===p&&(d=-c,h=-(o-n)),3===p&&(d=c,h=l-n),Math.abs(d)<1e-10&&h<0)return!1;if(f=h/d,d<0){if(f>g)return!1;f>m&&(m=f)}else if(d>0){if(f<m)return!1;f<g&&(g=f)}}return!0}function dre(e,t){e.globalCompositeOperation=t.blend||"source-over"}function hre(e,t){return null==e?t:e}function fre(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function pre(e,t,n){return Nte(n)?function(e,t,n){const r=n.width(),i=n.height();let a;if("radial"===t.gradient)a=e.createRadialGradient(n.x1+hre(t.x1,.5)*r,n.y1+hre(t.y1,.5)*i,Math.max(r,i)*hre(t.r1,0),n.x1+hre(t.x2,.5)*r,n.y1+hre(t.y2,.5)*i,Math.max(r,i)*hre(t.r2,.5));else{const o=hre(t.x1,0),s=hre(t.y1,0),l=hre(t.x2,1),u=hre(t.y2,0);if(o!==l&&s!==u&&r!==i){const n=R4(Math.ceil(r),Math.ceil(i)),a=n.getContext("2d");return a.scale(r,i),a.fillStyle=fre(a.createLinearGradient(o,s,l,u),t.stops),a.fillRect(0,0,r,i),e.createPattern(n,"no-repeat")}a=e.createLinearGradient(n.x1+o*r,n.y1+s*i,n.x1+l*r,n.y1+u*i)}return fre(a,t.stops)}(e,n,t.bounds):n}function mre(e,t,n){return(n*=null==t.fillOpacity?1:t.fillOpacity)>0&&(e.globalAlpha=n,e.fillStyle=pre(e,t,t.fill),!0)}var gre=[];function vre(e,t,n){var r=null!=(r=t.strokeWidth)?r:1;return!(r<=0)&&(n*=null==t.strokeOpacity?1:t.strokeOpacity)>0&&(e.globalAlpha=n,e.strokeStyle=pre(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||gre),e.lineDashOffset=t.strokeDashOffset||0),!0)}function yre(e,t){return e.zindex-t.zindex||e.index-t.index}function bre(e){if(!e.zdirty)return e.zitems;var t,n,r,i=e.items,a=[];for(n=0,r=i.length;n<r;++n)(t=i[n]).index=n,t.zindex&&a.push(t);return e.zdirty=!1,e.zitems=a.sort(yre)}function xre(e,t){var n,r,i=e.items;if(!i||!i.length)return;const a=bre(e);if(a&&a.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||t(i[n]);i=a}for(n=0,r=i.length;n<r;++n)t(i[n])}function wre(e,t){var n,r,i=e.items;if(!i||!i.length)return null;const a=bre(e);for(a&&a.length&&(i=a),r=i.length;--r>=0;)if(n=t(i[r]))return n;if(i===a)for(r=(i=e.items).length;--r>=0;)if(!i[r].zindex&&(n=t(i[r])))return n;return null}function _re(e){return function(t,n,r){xre(n,n=>{r&&!r.intersects(n.bounds)||Sre(e,t,n,n)})}}function Sre(e,t,n,r){var i=null==n.opacity?1:n.opacity;0!==i&&(e(t,r)||(dre(t,n),n.fill&&mre(t,n,i)&&t.fill(),n.stroke&&vre(t,n,i)&&t.stroke()))}function Ere(e){return e=e||WY,function(t,n,r,i,a,o){return r*=t.pixelRatio,i*=t.pixelRatio,wre(n,n=>{const s=n.bounds;if((!s||s.contains(a,o))&&s)return e(t,n,r,i,a,o)?n:void 0})}}function Tre(e,t){return function(n,r,i,a){var o,s,l=Array.isArray(r)?r[0]:r,u=null==t?l.fill:t,c=l.stroke&&n.isPointInStroke;return c&&(s=l.strokeCap,n.lineWidth=null!=(o=l.strokeWidth)?o:1,n.lineCap=null!=s?s:"butt"),!e(n,r)&&(u&&n.isPointInPath(i,a)||c&&n.isPointInStroke(i,a))}}function kre(e){return Ere(Tre(e))}function Cre(e,t){return"translate("+e+","+t+")"}function Ire(e){return"rotate("+e+")"}function Ore(e){return Cre(e.x||0,e.y||0)}function Are(e,t,n){function r(e,n){var r=n.x||0,i=n.y||0,a=n.angle||0;e.translate(r,i),a&&e.rotate(a*=Ute),e.beginPath(),t(e,n),a&&e.rotate(-a),e.translate(-r,-i)}return{type:e,tag:"path",nested:!1,attr:function(e,n){e("transform",function(e){return Cre(e.x||0,e.y||0)+(e.angle?" "+Ire(e.angle):"")}(n)),e("d",t(null,n))},bound:function(e,n){return t(Qne(e,n.angle),n),Rne(e,n).translate(n.x||0,n.y||0)},draw:_re(r),pick:kre(r),isect:n||ore(r)}}var Dre=Are("arc",(function(e,t){return vne.context(e)(t)}));function Mre(e,t,n){function r(e,n){e.beginPath(),t(e,n)}const i=Tre(r);return{type:e,tag:"path",nested:!0,attr:function(e,n){var r=n.mark.items;r.length&&e("d",t(null,r))},bound:function(e,n){var r=n.items;return 0===r.length?e:(t(Qne(e),r),Rne(e,r[0]))},draw:(a=r,function(e,t,n){!t.items.length||n&&!n.intersects(t.bounds)||Sre(a,e,t.items[0],t.items)}),pick:function(e,t,n,r,a,o){var s=t.items,l=t.bounds;return!s||!s.length||l&&!l.contains(a,o)?null:i(e,s,n*=e.pixelRatio,r*=e.pixelRatio)?s[0]:null},isect:sre,tip:n};var a}var Nre=Mre("area",(function(e,t){const n=t[0];return("horizontal"===n.orient?bne:yne).curve(Lte(n.interpolate||"linear",n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i="horizontal"===e[0].orient?t[1]:t[0],a="horizontal"===e[0].orient?"y":"x",o=e.length,s=1/0;--o>=0;)!1!==e[o].defined&&(r=Math.abs(e[o][a]-i))<s&&(s=r,n=e[o]);return n}));function jre(e,t){e.beginPath(),Ene(t)?Tne(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function Rre(e){const t=hre(e.strokeWidth,1);return null!=e.strokeOffset?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function Pre(e,t){const n=Rre(t);e("d",Tne(null,t,n,n))}function Fre(e,t,n,r){const i=Rre(t);e.beginPath(),Tne(e,t,(n||0)+i,(r||0)+i)}const Lre=Tre(Fre),$re=Tre(Fre,!1),Bre=Tre(Fre,!0);var zre={type:"group",tag:"g",nested:!1,attr:function(e,t){e("transform",Ore(t))},bound:function(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let t=0;t<r;++t)e.union(n[t].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),Rne(e,t),e.translate(t.x||0,t.y||0)},draw:function(e,t,n){xre(t,t=>{const r=t.x||0,i=t.y||0,a=t.strokeForeground,o=null==t.opacity?1:t.opacity;(t.stroke||t.fill)&&o&&(Fre(e,t,r,i),dre(e,t),t.fill&&mre(e,t,o)&&e.fill(),t.stroke&&!a&&vre(e,t,o)&&e.stroke()),e.save(),e.translate(r,i),t.clip&&jre(e,t),n&&n.translate(-r,-i),xre(t,t=>{this.draw(e,t,n)}),n&&n.translate(r,i),e.restore(),a&&t.stroke&&o&&(Fre(e,t,r,i),dre(e,t),vre(e,t,o)&&e.stroke())})},pick:function(e,t,n,r,i,a){if(t.bounds&&!t.bounds.contains(i,a)||!t.items)return null;const o=n*e.pixelRatio,s=r*e.pixelRatio;return wre(t,l=>{let u,c,d;const h=l.bounds;if(h&&!h.contains(i,a))return;c=l.x||0,d=l.y||0;const f=l.clip;if(f&&(i<c||i>c+(l.width||0)||a<d||a>d+(l.height||0)))return;if(e.save(),e.translate(c,d),c=i-c,d=a-d,f&&Ene(l)&&!Bre(e,l,o,s))return e.restore(),null;const p=l.strokeForeground,m=!1!==t.interactive;return m&&p&&l.stroke&&$re(e,l,o,s)?(e.restore(),l):(u=wre(l,e=>function(e,t,n){return(!1!==e.interactive||"group"===e.marktype)&&e.bounds&&e.bounds.contains(t,n)}(e,c,d)?this.pick(e,n,r,c,d):null),!u&&m&&(l.fill||!p&&l.stroke)&&Lre(e,l,o,s)&&(u=l),e.restore(),u||null)})},isect:lre,content:function(e,t,n){e("clip-path",t.clip?Ine(n,t,t):null)},background:function(e,t){e("class","background"),e("aria-hidden",!0),Pre(e,t)},foreground:function(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?Pre(e,t):e("d","")}},Ure={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function Hre(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(t=>{e.image=t,e.image.url=e.url})),n}function Wre(e,t){return null!=e.width?e.width:t&&t.width?!1!==e.aspect&&e.height?e.height*t.width/t.height:t.width:0}function Vre(e,t){return null!=e.height?e.height:t&&t.height?!1!==e.aspect&&e.width?e.width*t.height/t.width:t.height:0}function qre(e,t){return"center"===e?t/2:"right"===e?t:0}function Gre(e,t){return"middle"===e?t/2:"bottom"===e?t:0}var Yre={type:"image",tag:"image",nested:!1,attr:function(e,t,n){const r=Hre(t,n),i=Wre(t,r),a=Vre(t,r),o=(t.x||0)-qre(t.align,i),s=(t.y||0)-Gre(t.baseline,a);e("href",!r.src&&r.toDataURL?r.toDataURL():r.src||"",Ure["xmlns:xlink"],"xlink:href"),e("transform",Cre(o,s)),e("width",i),e("height",a),e("preserveAspectRatio",!1===t.aspect?"none":"xMidYMid")},bound:function(e,t){const n=t.image,r=Wre(t,n),i=Vre(t,n),a=(t.x||0)-qre(t.align,r),o=(t.y||0)-Gre(t.baseline,i);return e.set(a,o,a+r,o+i)},draw:function(e,t,n){xre(t,t=>{if(n&&!n.intersects(t.bounds))return;const r=Hre(t,this);let i,a,o,s,l=Wre(t,r),u=Vre(t,r),c=(t.x||0)-qre(t.align,l),d=(t.y||0)-Gre(t.baseline,u);!1!==t.aspect&&(a=r.width/r.height,o=t.width/t.height,a==a&&o==o&&a!==o&&(o<a?(s=l/a,d+=(u-s)/2,u=s):(s=u*a,c+=(l-s)/2,l=s))),(r.complete||r.toDataURL)&&(dre(e,t),e.globalAlpha=null!=(i=t.opacity)?i:1,e.imageSmoothingEnabled=!1!==t.smooth,e.drawImage(r,c,d,l,u))})},pick:Ere(),isect:WY,get:Hre,xOffset:qre,yOffset:Gre},Xre=Mre("line",(function(e,t){const n=t[0];return xne.curve(Lte(n.interpolate||"linear",n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i=Math.pow(e[0].strokeWidth||1,2),a=e.length;--a>=0;)if(!1!==e[a].defined&&(n=e[a].x-t[0])*n+(r=e[a].y-t[1])*r<i)return e[a];return null}));function Kre(e,t){var n=t.path;if(null==n)return!0;var r=t.x||0,i=t.y||0,a=t.scaleX||1,o=t.scaleY||1,s=(t.angle||0)*Ute,l=t.pathCache;l&&l.path===n||((t.pathCache=l=zte(n)).path=n),s&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(s),Jte(e,l,0,0,a,o),e.rotate(-s),e.translate(-r,-i)):Jte(e,l,r,i,a,o)}var Zre={type:"path",tag:"path",nested:!1,attr:function(e,t){1===(t.scaleX||1)&&1===(t.scaleY||1)||e("vector-effect","non-scaling-stroke"),e("transform",function(e){return Cre(e.x||0,e.y||0)+(e.angle?" "+Ire(e.angle):"")+(e.scaleX||e.scaleY?" scale("+(e.scaleX||1)+","+(e.scaleY||1)+")":"")}(t)),e("d",t.path)},bound:function(e,t){return Kre(Qne(e,t.angle),t)?e.set(0,0,0,0):Rne(e,t,!0)},draw:_re(Kre),pick:kre(Kre),isect:ore(Kre)};function Jre(e,t){e.beginPath(),Tne(e,t)}var Qre={type:"rect",tag:"path",nested:!1,attr:function(e,t){e("d",Tne(null,t))},bound:function(e,t){var n,r;return Rne(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)},draw:_re(Jre),pick:kre(Jre),isect:lre};function eie(e,t,n){var r,i,a,o;return!(!t.stroke||!vre(e,t,n)||(r=t.x||0,i=t.y||0,a=null!=t.x2?t.x2:r,o=null!=t.y2?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(a,o),0))}var tie={type:"rule",tag:"line",nested:!1,attr:function(e,t){e("transform",Ore(t)),e("x2",null!=t.x2?t.x2-(t.x||0):0),e("y2",null!=t.y2?t.y2-(t.y||0):0)},bound:function(e,t){var n,r;return Rne(e.set(n=t.x||0,r=t.y||0,null!=t.x2?t.x2:n,null!=t.y2?t.y2:r),t)},draw:function(e,t,n){xre(t,t=>{if(!n||n.intersects(t.bounds)){var r=null==t.opacity?1:t.opacity;r&&eie(e,t,r)&&(dre(e,t),e.stroke())}})},pick:Ere((function(e,t,n,r){return!!e.isPointInStroke&&eie(e,t,1)&&e.isPointInStroke(n,r)})),isect:ure},nie=Are("shape",(function(e,t){return(t.mark.shape||t.shape).context(e)(t)})),rie=Are("symbol",(function(e,t){return _ne.context(e)(t)}),sre);const iie=JX();var aie={height:die,measureWidth:uie,estimateWidth:sie,width:sie,canvas:oie};function oie(e){aie.width=e&&ire?uie:sie}function sie(e,t){return lie(mie(e,t),die(e))}function lie(e,t){return~~(.8*e.length*t)}function uie(e,t){return die(e)<=0||!(t=mie(e,t))?0:cie(t,vie(e))}function cie(e,t){const n="(".concat(t,") ").concat(e);let r=iie.get(n);return void 0===r&&(ire.font=t,r=ire.measureText(e).width,iie.set(n,r)),r}function die(e){return null!=e.fontSize?+e.fontSize||0:11}function hie(e){return null!=e.lineHeight?e.lineHeight:die(e)+2}function fie(e){return t=e.lineBreak&&e.text&&!QY(e.text)?e.text.split(e.lineBreak):e.text,QY(t)?t.length>1?t:t[0]:t;var t}function pie(e){const t=fie(e);return(QY(t)?t.length-1:0)*hie(e)}function mie(e,t){const n=null==t?"":(t+"").trim();return e.limit>0&&n.length?function(e,t){var n=+e.limit,r=function(e){if(aie.width===uie){const t=vie(e);return e=>cie(e,t)}{const t=die(e);return e=>lie(e,t)}}(e);if(r(t)<n)return t;var i,a=e.ellipsis||"\u2026",o="rtl"===e.dir,s=0,l=t.length;if(n-=r(a),o){for(;s<l;)r(t.slice(i=s+l>>>1))>n?s=i+1:l=i;return a+t.slice(s)}for(;s<l;)r(t.slice(0,i=1+(s+l>>>1)))<n?s=i:l=i-1;return t.slice(0,s)+a}(e,n):n}function gie(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function vie(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+die(e)+"px "+gie(e,t)}function yie(e){var t=e.baseline,n=die(e);return Math.round("top"===t?.79*n:"middle"===t?.3*n:"bottom"===t?-.21*n:"line-top"===t?.29*n+.5*hie(e):"line-bottom"===t?.29*n-.5*hie(e):0)}oie(!0);const bie={left:"start",center:"middle",right:"end"},xie=new One;function wie(e){var t,n=e.x||0,r=e.y||0,i=e.radius||0;return i&&(t=(e.theta||0)-Hte,n+=i*Math.cos(t),r+=i*Math.sin(t)),xie.x1=n,xie.y1=r,xie}function _ie(e,t,n){var r,i=aie.height(t),a=t.align,o=wie(t),s=o.x1,l=o.y1,u=t.dx||0,c=(t.dy||0)+yie(t)-Math.round(.8*i),d=fie(t);if(QY(d)?(i+=hie(t)*(d.length-1),r=d.reduce((e,n)=>Math.max(e,aie.width(t,n)),0)):r=aie.width(t,d),"center"===a?u-=r/2:"right"===a&&(u-=r),e.set(u+=s,c+=l,u+r,c+i),t.angle&&!n)e.rotate(t.angle*Ute,s,l);else if(2===n)return e.rotatedPoints(t.angle*Ute,s,l);return e}var Sie={arc:Dre,area:Nre,group:zre,image:Yre,line:Xre,path:Zre,rect:Qre,rule:tie,shape:nie,symbol:rie,text:{type:"text",tag:"text",nested:!1,attr:function(e,t){var n,r=t.dx||0,i=(t.dy||0)+yie(t),a=wie(t),o=a.x1,s=a.y1,l=t.angle||0;e("text-anchor",bie[t.align]||"start"),l?(n=Cre(o,s)+" "+Ire(l),(r||i)&&(n+=" "+Cre(r,i))):n=Cre(o+r,s+i),e("transform",n)},bound:_ie,draw:function(e,t,n){xre(t,t=>{var r,i,a,o,s,l,u,c=null==t.opacity?1:t.opacity;if(!(n&&!n.intersects(t.bounds)||0===c||t.fontSize<=0||null==t.text||0===t.text.length)){if(e.font=vie(t),e.textAlign=t.align||"left",i=(r=wie(t)).x1,a=r.y1,t.angle&&(e.save(),e.translate(i,a),e.rotate(t.angle*Ute),i=a=0),i+=t.dx||0,a+=(t.dy||0)+yie(t),l=fie(t),dre(e,t),QY(l))for(s=hie(t),o=0;o<l.length;++o)u=mie(t,l[o]),t.fill&&mre(e,t,c)&&e.fillText(u,i,a),t.stroke&&vre(e,t,c)&&e.strokeText(u,i,a),a+=s;else u=mie(t,l),t.fill&&mre(e,t,c)&&e.fillText(u,i,a),t.stroke&&vre(e,t,c)&&e.strokeText(u,i,a);t.angle&&e.restore()}})},pick:Ere((function(e,t,n,r,i,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=wie(t),s=o.x1,l=o.y1,u=_ie(xie,t,1),c=-t.angle*Ute,d=Math.cos(c),h=Math.sin(c);return u.contains(d*i-h*a+(s-d*s+h*l),h*i+d*a+(l-h*s-d*l))})),isect:function(e,t){const n=_ie(xie,e,2);return cre(t,n[0],n[1],n[2],n[3])||cre(t,n[0],n[1],n[4],n[5])||cre(t,n[4],n[5],n[6],n[7])||cre(t,n[2],n[3],n[6],n[7])}},trail:Mre("trail",(function(e,t){return Sne.context(e)(t)}),(function(e,t){for(var n,r,i=e.length;--i>=0;)if(!1!==e[i].defined&&(n=e[i].x-t[0])*n+(r=e[i].y-t[1])*r<(n=e[i].size||1)*n)return e[i];return null}))};function Eie(e,t,n){var r=Sie[e.mark.marktype];return r.nested&&(e=e.mark),(t||r.bound)(e.bounds||(e.bounds=new One),e,n)}var Tie={mark:null};function kie(e,t,n){var r,i,a,o,s=Sie[e.marktype],l=s.bound,u=e.items,c=u&&u.length;if(s.nested)return c?a=u[0]:(Tie.mark=e,a=Tie),o=Eie(a,l,n),t&&t.union(o)||o;if(t=t||e.bounds&&e.bounds.clear()||new One,c)for(r=0,i=u.length;r<i;++r)t.union(Eie(u[r],l,n));return e.bounds=t}const Cie=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function Iie(e,t){return JSON.stringify(e,Cie,t)}function Oie(e){return function e(t){var n,r,i,a=t.marktype,o=t.items;if(o)for(r=0,i=o.length;r<i;++r)o[r][n=a?"mark":"group"]=t,o[r].zindex&&(o[r][n].zdirty=!0),"group"===(a||n)&&e(o[r]);return a&&kie(t),t}("string"==typeof e?JSON.parse(e):e)}function Aie(e){arguments.length?this.root=Oie(e):(this.root=Die({marktype:"group",name:"root",role:"frame"}),this.root.items=[new Dne(this.root)])}function Die(e,t){const n={bounds:new One,clip:!!e.clip,group:t,interactive:!1!==e.interactive,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return null!=e.aria&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function Mie(e,t,n){return!e&&"undefined"!=typeof document&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function Nie(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function jie(e,t,n,r){var i,a=e.childNodes[t];return a&&a.tagName.toLowerCase()===n.toLowerCase()||(i=a||null,a=Mie(e.ownerDocument,n,r),e.insertBefore(a,i)),a}function Rie(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function Pie(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function Fie(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function Lie(e,t){this._active=null,this._handlers={},this._loader=e||l1(),this._tooltip=t||$ie}function $ie(e,t,n,r){e.element().setAttribute("title",r||"")}function Bie(e){this._el=null,this._bgcolor=null,this._loader=new Mne(e)}Aie.prototype={toJSON(e){return Iie(this.root,e||0)},mark(e,t,n){const r=Die(e,t=t||this.root.items[0]);return t.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}},Lie.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const r in t)n.push(...t[r]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(t=>{const n=new MouseEvent(e.type,e),r=Mie(null,"a");for(const e in t)r.setAttribute(e,t[e]);r.dispatchEvent(n)}).catch(()=>{})},handleTooltip(e,t,n){t&&null!=t.tooltip&&(t=function(e,t,n,r){var i,a,o=e&&e.mark;if(o&&(i=Sie[o.marktype]).tip){for((a=Fie(t,n))[0]-=r[0],a[1]-=r[1];e=e.mark.group;)a[0]-=e.x||0,a[1]-=e.y||0;e=i.tip(o.items,a)}return e}(t,e,this.canvas(),this._origin),this._tooltip.call(this._obj,this,e,t,n&&t&&t.tooltip||null))},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,a=i.width(),o=i.height();let s=i.x1+r[0]+n.left,l=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)s+=e.x||0,l+=e.y||0;return{x:s,y:l,width:a,height:o,left:s,top:l,right:s+a,bottom:l+o}}},Bie.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return 0===arguments.length?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then(()=>t):Promise.resolve(t)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const e=n._call;n._ready=n._loader.ready().then(t=>{t&&e(),n._ready=null})}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const zie="dragenter",Uie="dragleave",Hie="dragover",Wie="mousedown",Vie="mousemove",qie="mouseout",Gie="mouseover",Yie="click",Xie="mousewheel",Kie="touchstart",Zie="touchmove",Jie="touchend",Qie=Vie,eae=qie,tae=Yie;function nae(e,t){Lie.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}function rae(e,t){(e=>e===Kie||e===Zie||e===Jie?[Kie,Zie,Jie]:[e])(t).forEach(t=>function(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?n=>e[t](n):n=>e.fire(t,n)))}(e,t))}function iae(e,t,n){return function(r){const i=this._active,a=this.pickEvent(r);a===i||(i&&i.exit||this.fire(n,r),this._active=a,this.fire(t,r)),this.fire(e,r)}}function aae(e){return function(t){this.fire(e,t),this._active=null}}UX(nae,Lie,{initialize(e,t,n){return this._canvas=e&&Nie(e,"canvas"),[Yie,Wie,Vie,qie,Uie].forEach(e=>rae(this,e)),Lie.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:["keydown","keypress","keyup",zie,Uie,Hie,Wie,"mouseup",Vie,qie,Gie,Yie,"dblclick","wheel",Xie,Kie,Zie,Jie],DOMMouseScroll(e){this.fire(Xie,e)},mousemove:iae(Vie,Gie,qie),dragover:iae(Hie,zie,Uie),mouseout:aae(qie),dragleave:aae(Uie),mousedown(e){this._down=this._active,this.fire(Wie,e)},click(e){this._down===this._active&&(this.fire(Yie,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(Kie,e,!0)},touchmove(e){this.fire(Zie,e,!0)},touchend(e){this.fire(Jie,e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===tae&&r&&r.href?this.handleHref(t,r,r.href):e!==Qie&&e!==eae||this.handleTooltip(t,r,e!==eae),i)for(let a=0,o=i.length;a<o;++a)i[a].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(rae(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=Fie(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const a=this.context();return Sie[e.marktype].pick.call(this,a,e,t,n,r,i)}});var oae="undefined"!=typeof window&&window.devicePixelRatio||1;function sae(e){Bie.call(this,e),this._options={},this._redraw=!1,this._dirty=new One,this._tempb=new One}const lae=Bie.prototype;function uae(e,t){Lie.call(this,e,t);const n=this;n._hrefHandler=cae(n,(e,t)=>{t&&t.href&&n.handleHref(e,t,t.href)}),n._tooltipHandler=cae(n,(e,t)=>{n.handleTooltip(e,t,e.type!==eae)})}UX(sae,Bie,{initialize(e,t,n,r,i,a){return this._options=a||{},this._canvas=this._options.externalContext?null:R4(1,1),e&&this._canvas&&(Rie(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),lae.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(lae.resize.call(this,e,t,n,r),this._canvas)!function(e,t,n,r,i,a){const o="undefined"!=typeof HTMLElement&&e instanceof HTMLElement&&null!=e.parentNode,s=e.getContext("2d"),l=o?oae:i;e.width=t*l,e.height=n*l;for(const u in a)s[u]=a[u];o&&1!==l&&(e.style.width=t+"px",e.style.height=n+"px"),s.pixelRatio=l,s.setTransform(l,0,0,l,l*r[0],l*r[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const e=this._options.externalContext;e||FY("CanvasRenderer is missing a valid canvas or context"),e.scale(this._scale,this._scale),e.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty,o=(s=n,l=r,u=i,(new One).set(0,0,l,u).translate(-s[0],-s[1]));var s,l,u;t.save();const c=this._redraw||a.empty()?(this._redraw=!1,o.expand(1)):function(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-n[0]%1,-n[1]%1),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}(t,o.intersect(a),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,c),t.restore(),a.clear(),this},draw(e,t,n){const r=Sie[t.marktype];t.clip&&function(e,t){var n=t.clip;e.save(),kX(n)?(e.beginPath(),n(e),e.clip()):jre(e,t.group)}(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,a=this.context();"pdf"===i.type||i.externalContext||a.clearRect(e,t,n,r),null!=this._bgcolor&&(a.fillStyle=this._bgcolor,a.fillRect(e,t,n,r))}});const cae=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};UX(uae,Lie,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(tae,this._hrefHandler),r.removeEventListener(Qie,this._tooltipHandler),r.removeEventListener(eae,this._tooltipHandler)),this._svg=r=e&&Nie(e,"svg"),r&&(r.addEventListener(tae,this._hrefHandler),r.addEventListener(Qie,this._tooltipHandler),r.addEventListener(eae,this._tooltipHandler)),Lie.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){const i={type:e,handler:t,listener:cae(this,t)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const dae="aria-hidden",hae="aria-label",fae="role",pae="aria-roledescription",mae="graphics-object",gae="graphics-symbol",vae=(e,t,n)=>({[fae]:e,[pae]:t,[hae]:n||void 0}),yae=lK(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),bae={axis:{desc:"axis",caption:function(e){const t=e.datum,n=e.orient,r=t.title?Eae(e):null,i=e.context,a=i.scales[t.scale].value,o=i.dataflow.locale(),s=a.type;return"".concat("left"===n||"right"===n?"Y":"X","-axis")+(r?" titled '".concat(r,"'"):"")+" for a ".concat(Zee(s)?"discrete":s," scale")+" with ".concat(Ate(o,a,e))}},legend:{desc:"legend",caption:function(e){const t=e.datum,n=t.title?Eae(e):null,r="".concat(t.type||""," legend").trim(),i=t.scales,a=Object.keys(i),o=e.context,s=o.scales[i[a[0]]].value,l=o.dataflow.locale();return((u=r).length?u[0].toUpperCase()+u.slice(1):u)+(n?" titled '".concat(n,"'"):"")+" for ".concat(function(e){return(e=e.map(e=>e+("fill"===e||"stroke"===e?" color":""))).length<2?e[0]:e.slice(0,-1).join(", ")+" and "+aX(e)}(a))+" with ".concat(Ate(l,s,e));var u}},"title-text":{desc:"title",caption:e=>"Title text '".concat(Sae(e),"'")},"title-subtitle":{desc:"subtitle",caption:e=>"Subtitle text '".concat(Sae(e),"'")}},xae={ariaRole:fae,ariaRoleDescription:pae,description:hae};function wae(e,t){const n=!1===t.aria;if(e(dae,n||void 0),n||null==t.description)for(const r in xae)e(xae[r],void 0);else{const n=t.mark.marktype;e(hae,t.description),e(fae,t.ariaRole||("group"===n?mae:gae)),e(pae,t.ariaRoleDescription||"".concat(n," mark"))}}function _ae(e){return!1===e.aria?{[dae]:!0}:yae[e.role]?null:bae[e.role]?function(e,t){try{const n=e.items[0],r=t.caption||(()=>"");return vae(t.role||gae,t.desc,n.description||r(n))}catch(rBe){return null}}(e,bae[e.role]):function(e){const t=e.marktype,n="group"===t||"text"===t||e.items.some(e=>null!=e.description&&!1!==e.aria);return vae(n?mae:gae,"".concat(t," mark container"),e.description)}(e)}function Sae(e){return EX(e.text).join(" ")}function Eae(e){try{return EX(aX(e.items).items[0].text).join(" ")}catch(rBe){return null}}const Tae=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function kae(){let e="",t="",n="";const r=[],i=()=>t=n="",a=(e,n)=>(null!=n&&(t+=" ".concat(e,'="').concat(Tae(n).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;"),'"')),o),o={open(s,...l){(a=>{t&&(e+="".concat(t,">").concat(n),i()),r.push(a)})(s),t="<"+s;for(const e of l)for(const t in e)a(t,e[t]);return o},close(){const a=r.pop();return e+=t?t+(n?">".concat(n,"</").concat(a,">"):"/>"):"</".concat(a,">"),i(),o},attr:a,text:e=>(n+=Tae(e),o),toString:()=>e};return o}const Cae=e=>function e(t,n){if(t.open(n.tagName),n.hasAttributes()){const e=n.attributes,r=e.length;for(let n=0;n<r;++n)t.attr(e[n].name,e[n].value)}if(n.hasChildNodes()){const r=n.childNodes,i=r.length;for(let n=0;n<i;n++){const i=r[n];3===i.nodeType?t.text(i.nodeValue):e(t,i)}}return t.close()}(kae(),e)+"",Iae={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},Oae={fill:"none","stroke-miterlimit":10},Aae=Ure.xmlns;function Dae(e){Bie.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const Mae=Bie.prototype;function Nae(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function jae(e,t,n){let r,i,a;if("radial"===t.gradient){let r=jie(e,n++,"pattern",Aae);Uae(r,{id:Mte+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),r=jie(r,0,"rect",Aae),Uae(r,{width:1,height:1,fill:"url(".concat(Wae(),"#").concat(t.id,")")}),Uae(e=jie(e,n++,"radialGradient",Aae),{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else Uae(e=jie(e,n++,"linearGradient",Aae),{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)a=jie(e,r,"stop",Aae),a.setAttribute("offset",t.stops[r].offset),a.setAttribute("stop-color",t.stops[r].color);return Rie(e,r),n}function Rae(e,t,n){let r;return(e=jie(e,n,"clipPath",Aae)).setAttribute("id",t.id),t.path?(r=jie(e,0,"path",Aae),r.setAttribute("d",t.path)):(r=jie(e,0,"rect",Aae),Uae(r,{x:0,y:0,width:t.width,height:t.height})),Rie(e,1),n+1}function Pae(e,t,n,r,i){let a,o=e._svg;if(!o&&(a=t.ownerDocument,o=Mie(a,r,Aae),e._svg=o,e.mark&&(o.__data__=e,o.__values__={fill:"default"},"g"===r))){const t=Mie(a,"path",Aae);o.appendChild(t),t.__data__=e;const n=Mie(a,"g",Aae);o.appendChild(n),n.__data__=e;const r=Mie(a,"path",Aae);o.appendChild(r),r.__data__=e,r.__values__={fill:"default"}}return(o.ownerSVGElement!==i||function(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}(o,n))&&t.insertBefore(o,n?n.nextSibling:t.firstChild),o}UX(Dae,Bie,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=jie(e,0,"svg",Aae),Uae(this._svg,Ure),this._svg.setAttribute("class","marks"),Rie(e,1),this._root=jie(this._svg,0,"g",Aae),Uae(this._root,Oae),Rie(this._svg,1)),this.background(this._bgcolor),Mae.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),Mae.background.apply(this,arguments)},resize(e,t,n,r){return Mae.resize.call(this,e,t,n,r),this._svg&&(Uae(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}),this._root.setAttribute("transform","translate(".concat(this._origin,")"))),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=jie(e,0,"rect",Aae),Uae(n,{width:this._width,height:this._height,fill:t}));const r=Cae(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),Rie(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,a,o,s,l;for(o=0,s=e.length;o<s;++o)n=e[o],r=n.mark,r.marktype!==i&&(i=r.marktype,a=Sie[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,Nae(n,t),r.items.forEach(e=>{e.dirty=t})),r.zdirty||(n.exit?(a.nested&&r.items.length?(l=r.items[0],l._svg&&this._update(a,l._svg,l)):n._svg&&(l=n._svg.parentNode,l&&l.removeChild(n._svg)),n._svg=null):(n=a.nested?r.items[0]:n,n._update!==t&&(n._svg&&n._svg.ownerSVGElement?this._update(a,n._svg,n):(this._dirtyAll=!1,Nae(n,t)),n._update=t)));return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const r=this._svg,i=Sie[t.marktype],a=!1===t.interactive?"none":null,o="g"===i.tag;let s=null,l=0;const u=Pae(t,e,n,"g",r);u.setAttribute("class",Pie(t));const c=_ae(t);for(const h in c)Hae(u,h,c[h]);o||Hae(u,"pointer-events",a),Hae(u,"clip-path",t.clip?Ine(this,t,t.group):null);const d=e=>{const t=this.isDirty(e),n=Pae(e,u,s,i.tag,r);t&&(this._update(i,n,e),o&&function(e,t,n){t=t.lastChild.previousSibling;let r,i=0;xre(n,n=>{r=e.mark(t,n,r),++i}),Rie(t,1+i)}(this,n,e)),s=n,++l};return i.nested?t.items.length&&d(t.items[0]):xre(t,d),Rie(u,l),u},_update(e,t,n){Fae=t,Lae=t.__values__,wae(Bae,n),e.attr(Bae,n,this);const r=$ae[e.type];r&&r.call(this,e,t,n),Fae&&this.style(Fae,n)},style(e,t){if(null!=t)for(const n in Iae){let r="font"===n?gie(t):t[n];if(r===Lae[n])continue;const i=Iae[n];null==r?e.removeAttribute(i):(Nte(r)&&(r=jte(r,this._defs.gradient,Wae())),e.setAttribute(i,r+"")),Lae[n]=r}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=jie(e,1,"defs",Aae)),r=jae(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=jie(e,1,"defs",Aae)),r=Rae(n,t.clipping[i],r);n&&(0===r?(e.removeChild(n),t.el=null):Rie(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});let Fae=null,Lae=null;const $ae={group(e,t,n){const r=Fae=t.childNodes[2];Lae=r.__values__,e.foreground(Bae,n,this),Lae=t.__values__,Fae=t.childNodes[1],e.content(Bae,n,this);const i=Fae=t.childNodes[0];e.background(Bae,n,this);const a=!1===n.mark.interactive?"none":null;if(a!==Lae.events&&(Hae(r,"pointer-events",a),Hae(i,"pointer-events",a),Lae.events=a),n.strokeForeground&&n.stroke){const e=n.fill;Hae(r,"display",null),this.style(i,n),Hae(i,"stroke",null),e&&(n.fill=null),Lae=r.__values__,this.style(r,n),e&&(n.fill=e),Fae=null}else Hae(r,"display","none")},image(e,t,n){!1===n.smooth?(zae(t,"image-rendering","optimizeSpeed"),zae(t,"image-rendering","pixelated")):zae(t,"image-rendering",null)},text(e,t,n){const r=fie(n);let i,a,o,s;QY(r)?(a=r.map(e=>mie(n,e)),i=a.join("\n"),i!==Lae.text&&(Rie(t,0),o=t.ownerDocument,s=hie(n),a.forEach((e,r)=>{const i=Mie(o,"tspan",Aae);i.__data__=n,i.textContent=e,r&&(i.setAttribute("x",0),i.setAttribute("dy",s)),t.appendChild(i)}),Lae.text=i)):(a=mie(n,r),a!==Lae.text&&(t.textContent=a,Lae.text=a)),Hae(t,"font-family",gie(n)),Hae(t,"font-size",die(n)+"px"),Hae(t,"font-style",n.fontStyle),Hae(t,"font-variant",n.fontVariant),Hae(t,"font-weight",n.fontWeight)}};function Bae(e,t,n){t!==Lae[e]&&(n?function(e,t,n,r){null!=n?e.setAttributeNS(r,t,n):e.removeAttributeNS(r,t)}(Fae,e,t,n):Hae(Fae,e,t),Lae[e]=t)}function zae(e,t,n){n!==Lae[t]&&(null==n?e.style.removeProperty(t):e.style.setProperty(t,n+""),Lae[t]=n)}function Uae(e,t){for(const n in t)Hae(e,n,t[n])}function Hae(e,t,n){null!=n?e.setAttribute(t,n):e.removeAttribute(t)}function Wae(){let e;return"undefined"==typeof window?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function Vae(e){Bie.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}UX(Vae,Bie,{svg(){return this._text},_render(e){const t=kae();t.open("svg",jX({},Ure,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}));const n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",Oae,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=Sie[t.marktype],r=n.tag,i=[wae,n.attr];e.open("g",{class:Pie(t),"clip-path":t.clip?Ine(this,t,t.group):null},_ae(t),{"pointer-events":"g"!==r&&!1===t.interactive?"none":null});const a=a=>{const o=this.href(a);if(o&&e.open("a",o),e.open(r,this.attr(t,a,i,"g"!==r?r:null)),"text"===r){const t=fie(a);if(QY(t)){const n={x:0,dy:hie(a)};for(let r=0;r<t.length;++r)e.open("tspan",r?n:null).text(mie(a,t[r])).close()}else e.text(mie(a,t))}else if("g"===r){const r=a.strokeForeground,i=a.fill,o=a.stroke;r&&o&&(a.stroke=null),e.open("path",this.attr(t,a,n.background,"bgrect")).close(),e.open("g",this.attr(t,a,n.content)),xre(a,t=>this.mark(e,t)),e.close(),r&&o?(i&&(a.fill=null),a.stroke=o,e.open("path",this.attr(t,a,n.foreground,"bgrect")).close(),i&&(a.fill=i)):e.open("path",this.attr(t,a,n.foreground,"bgfore")).close()}e.close(),o&&e.close()};return n.nested?t.items&&t.items.length&&a(t.items[0]):xre(t,a),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(e=>{e["xlink:href"]=e.href,e.href=null,(this._hrefs||(this._hrefs={}))[t]=e})}return null},attr(e,t,n,r){const i={},a=(e,t,n,r)=>{i[r||e]=t};return Array.isArray(n)?n.forEach(e=>e(a,t,this)):n(a,t,this),r&&function(e,t,n,r,i){if(null==t)return e;if("bgrect"===r&&!1===n.interactive&&(e["pointer-events"]="none"),"bgfore"===r&&(!1===n.interactive&&(e["pointer-events"]="none"),e.display="none",null!==t.fill))return e;"image"===r&&!1===t.smooth&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),"text"===r&&(e["font-family"]=gie(t),e["font-size"]=die(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const a in Iae){let n=t[a];const r=Iae[a];("transparent"!==n||"fill"!==r&&"stroke"!==r)&&null!=n&&(Nte(n)&&(n=jte(n,i.gradient,"")),e[r]=n)}}(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(0!==Object.keys(t).length+Object.keys(n).length){e.open("defs");for(const n in t){const r=t[n],i=r.stops;"radial"===r.gradient?(e.open("pattern",{id:Mte+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+n+")"}).close(),e.close(),e.open("radialGradient",{id:n,fx:r.x1,fy:r.y1,fr:r.r1,cx:r.x2,cy:r.y2,r:r.r2})):e.open("linearGradient",{id:n,x1:r.x1,x2:r.x2,y1:r.y1,y2:r.y2});for(let t=0;t<i.length;++t)e.open("stop",{offset:i[t].offset,"stop-color":i[t].color}).close();e.close()}for(const t in n){const r=n[t];e.open("clipPath",{id:t}),r.path?e.open("path",{d:r.path}).close():e.open("rect",{x:0,y:0,width:r.width,height:r.height}).close(),e.close()}e.close()}}});const qae={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},Gae={};function Yae(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(Gae[e]=t,this):Gae[e]}function Xae(e,t,n){const r=[],i=(new One).union(t),a=e.marktype;return a?Kae(e,i,n,r):"group"===a?Zae(e,i,n,r):FY("Intersect scene must be mark node or group item.")}function Kae(e,t,n,r){if(function(e,t,n){return e.bounds&&t.intersects(e.bounds)&&("group"===e.marktype||!1!==e.interactive&&(!n||n(e)))}(e,t,n)){const i=e.items,a=e.marktype,o=i.length;let s=0;if("group"===a)for(;s<o;++s)Zae(i[s],t,n,r);else for(const e=Sie[a].isect;s<o;++s){const n=i[s];Jae(n,t,e)&&r.push(n)}}return r}function Zae(e,t,n,r){n&&n(e.mark)&&Jae(e,t,Sie.group.isect)&&r.push(e);const i=e.items,a=i&&i.length;if(a){const o=e.x||0,s=e.y||0;t.translate(-o,-s);for(let e=0;e<a;++e)Kae(i[e],t,n,r);t.translate(o,s)}return r}function Jae(e,t,n){const r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}Gae.canvas=Gae.png={renderer:sae,headless:sae,handler:nae},Gae.svg={renderer:Dae,headless:Vae,handler:uae},Gae.none={};const Qae=new One;function eoe(e){const t=e.clip;if(kX(t))t(Qne(Qae.clear()));else{if(!t)return;Qae.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(Qae)}function toe(e,t,n){return e===t||("path"===n?noe(e,t):e instanceof Date&&t instanceof Date?+e==+t:GX(e)&&GX(t)?Math.abs(e-t)<=1e-9:e&&t&&(eX(e)||eX(t))?function(e,t){var n,r,i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(i.sort(),a.sort(),r=i.length-1;r>=0;r--)if(i[r]!=a[r])return!1;for(r=i.length-1;r>=0;r--)if(!toe(e[n=i[r]],t[n],n))return!1;return typeof e==typeof t}(e,t):e==t)}function noe(e,t){return toe(zte(e),zte(t))}function roe(){Cne(),Dte=0}const ioe="top",aoe="left",ooe="right",soe="bottom",loe="start",uoe="middle",coe="end",doe="group",hoe="axis",foe="title",poe="legend",moe="row-header",goe="row-footer",voe="row-title",yoe="column-header",boe="column-footer",xoe="column-title",woe="none",_oe="all",Soe="each",Eoe="flush",Toe="column",koe="row";function Coe(e){q1.call(this,null,e)}function Ioe(e,t,n){return t(e.bounds.clear(),e,n)}UX(Coe,q1,{transform(e,t){const n=t.dataflow,r=e.mark,i=r.marktype,a=Sie[i],o=a.bound;let s,l=r.bounds;if(a.nested)r.items.length&&n.dirty(r.items[0]),l=Ioe(r,o),r.items.forEach(e=>{e.bounds.clear().union(l)});else if(i===doe||e.modified())switch(t.visit(t.MOD,e=>n.dirty(e)),l.clear(),r.items.forEach(e=>l.union(Ioe(e,o))),r.role){case hoe:case poe:case foe:t.reflow()}else s=t.changed(t.REM),t.visit(t.ADD,e=>{l.union(Ioe(e,o))}),t.visit(t.MOD,e=>{s=s||l.alignsWith(e.bounds),n.dirty(e),l.union(Ioe(e,o))}),s&&(l.clear(),r.items.forEach(e=>l.union(e.bounds)));return eoe(r),t.modifies("bounds")}});const Ooe=":vega_identifier:";function Aoe(e){q1.call(this,0,e)}function Doe(e){q1.call(this,null,e)}function Moe(e){q1.call(this,null,e)}Aoe.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},UX(Aoe,q1,{transform(e,t){const n=(i=t.dataflow)._signals[Ooe]||(i._signals[Ooe]=i.add(0)),r=e.as;var i;let a=n.value;return t.visit(t.ADD,e=>e[r]=e[r]||++a),n.set(this.value=a),t}}),UX(Doe,q1,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,function(e){const t=e.groups,n=e.parent;return t&&1===t.size?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const r=n.marktype===doe?Dne:Ane;return t.visit(t.ADD,e=>r.call(e,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});const Noe={parity:e=>e.filter((e,t)=>t%2?e.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((e,r)=>r&&joe(n.bounds,e.bounds,t)?e.opacity=0:(n=e,1))}},joe=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),Roe=(e,t)=>{for(var n,r=1,i=e.length,a=e[0].bounds;r<i;a=n,++r)if(joe(a,n=e[r].bounds,t))return!0},Poe=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},Foe=e=>(e.forEach(e=>e.opacity=1),e),Loe=(e,t)=>e.reflow(t.modified()).modifies("opacity");function $oe(e){q1.call(this,null,e)}UX(Moe,q1,{transform(e,t){const n=Noe[e.method]||Noe.parity,r=e.separation||0;let i,a,o=t.materialize(t.SOURCE).source;if(!o||!o.length)return;if(!e.method)return e.modified("method")&&(Foe(o),t=Loe(t,e)),t;if(o=o.filter(Poe),!o.length)return;if(e.sort&&(o=o.slice().sort(e.sort)),i=Foe(o),t=Loe(t,e),i.length>=3&&Roe(i,r)){do{i=n(i,r)}while(i.length>=3&&Roe(i,r));i.length<3&&!aX(o).opacity&&(i.length>1&&(aX(i).opacity=0),aX(o).opacity=1)}var s,l,u,c;e.boundScale&&e.boundTolerance>=0&&(s=e.boundOrient,l=+e.boundTolerance,u=e.boundScale.range(),c=new One,s===ioe||s===soe?c.set(u[0],-1/0,u[1],1/0):c.set(-1/0,u[0],1/0,u[1]),c.expand(l||1),a=e=>c.encloses(e.bounds),o.forEach(e=>{a(e)||(e.opacity=0)}));const d=i[0].mark.bounds.clear();return o.forEach(e=>{e.opacity&&d.union(e.bounds)}),t}}),UX($oe,q1,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,e=>n.dirty(e)),t.fields&&t.fields.zindex){const e=t.source&&t.source[0];e&&(e.mark.zdirty=!0)}}});const Boe=new One;function zoe(e,t,n){return e[t]===n?0:(e[t]=n,1)}function Uoe(e){var t=e.items[0].orient;return t===aoe||t===ooe}function Hoe(e,t,n,r){var i,a,o=t.items[0],s=o.datum,l=null!=o.translate?o.translate:.5,u=o.orient,c=function(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}(s),d=o.range,h=o.offset,f=o.position,p=o.minExtent,m=o.maxExtent,g=s.title&&o.items[c[2]].items[0],v=o.titlePadding,y=o.bounds,b=g&&pie(g),x=0,w=0;switch(Boe.clear().union(y),y.clear(),(i=c[0])>-1&&y.union(o.items[i].bounds),(i=c[1])>-1&&y.union(o.items[i].bounds),u){case ioe:x=f||0,w=-h,a=Math.max(p,Math.min(m,-y.y1)),y.add(0,-a).add(d,0),g&&Woe(e,g,a,v,b,0,-1,y);break;case aoe:x=-h,w=f||0,a=Math.max(p,Math.min(m,-y.x1)),y.add(-a,0).add(0,d),g&&Woe(e,g,a,v,b,1,-1,y);break;case ooe:x=n+h,w=f||0,a=Math.max(p,Math.min(m,y.x2)),y.add(0,0).add(a,d),g&&Woe(e,g,a,v,b,1,1,y);break;case soe:x=f||0,w=r+h,a=Math.max(p,Math.min(m,y.y2)),y.add(0,0).add(d,a),g&&Woe(e,g,a,v,0,0,1,y);break;default:x=o.x,w=o.y}return Rne(y.translate(x,w),o),zoe(o,"x",x+l)|zoe(o,"y",w+l)&&(o.bounds=Boe,e.dirty(o),o.bounds=y,e.dirty(o)),o.mark.bounds.clear().union(y)}function Woe(e,t,n,r,i,a,o,s){const l=t.bounds;if(t.auto){const s=o*(n+i+r);let u=0,c=0;e.dirty(t),a?u=(t.x||0)-(t.x=s):c=(t.y||0)-(t.y=s),t.mark.bounds.clear().union(l.translate(-u,-c)),e.dirty(t)}s.union(l)}const Voe=(e,t)=>Math.floor(Math.min(e,t)),qoe=(e,t)=>Math.ceil(Math.max(e,t));function Goe(e){return(new One).set(0,0,e.width||0,e.height||0)}function Yoe(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Xoe(e,t,n){const r=eX(e)?e[t]:e;return null!=r?r:void 0!==n?n:0}function Koe(e){return e<0?Math.ceil(-e):0}function Zoe(e,t,n){var r,i,a,o,s,l,u,c,d,h,f,p=!n.nodirty,m=n.bounds===Eoe?Goe:Yoe,g=Boe.set(0,0,0,0),v=Xoe(n.align,Toe),y=Xoe(n.align,koe),b=Xoe(n.padding,Toe),x=Xoe(n.padding,koe),w=n.columns||t.length,_=w<=0?1:Math.ceil(t.length/w),S=t.length,E=Array(S),T=Array(w),k=0,C=Array(S),I=Array(_),O=0,A=Array(S),D=Array(S),M=Array(S);for(i=0;i<w;++i)T[i]=0;for(i=0;i<_;++i)I[i]=0;for(i=0;i<S;++i)s=M[i]=m(l=t[i]),l.x=l.x||0,A[i]=0,l.y=l.y||0,D[i]=0,a=i%w,o=~~(i/w),k=Math.max(k,u=Math.ceil(s.x2)),O=Math.max(O,c=Math.ceil(s.y2)),T[a]=Math.max(T[a],u),I[o]=Math.max(I[o],c),E[i]=b+Koe(s.x1),C[i]=x+Koe(s.y1),p&&e.dirty(t[i]);for(i=0;i<S;++i)i%w==0&&(E[i]=0),i<w&&(C[i]=0);if(v===Soe)for(a=1;a<w;++a){for(f=0,i=a;i<S;i+=w)f<E[i]&&(f=E[i]);for(i=a;i<S;i+=w)E[i]=f+T[a-1]}else if(v===_oe){for(f=0,i=0;i<S;++i)i%w&&f<E[i]&&(f=E[i]);for(i=0;i<S;++i)i%w&&(E[i]=f+k)}else for(v=!1,a=1;a<w;++a)for(i=a;i<S;i+=w)E[i]+=T[a-1];if(y===Soe)for(o=1;o<_;++o){for(f=0,r=(i=o*w)+w;i<r;++i)f<C[i]&&(f=C[i]);for(i=o*w;i<r;++i)C[i]=f+I[o-1]}else if(y===_oe){for(f=0,i=w;i<S;++i)f<C[i]&&(f=C[i]);for(i=w;i<S;++i)C[i]=f+O}else for(y=!1,o=1;o<_;++o)for(r=(i=o*w)+w;i<r;++i)C[i]+=I[o-1];for(d=0,i=0;i<S;++i)A[i]+=(d=E[i]+(i%w?d:0))-t[i].x;for(a=0;a<w;++a)for(h=0,i=a;i<S;i+=w)D[i]+=(h+=C[i])-t[i].y;if(v&&Xoe(n.center,Toe)&&_>1)for(i=0;i<S;++i)(d=(s=v===_oe?k:T[i%w])-M[i].x2-t[i].x-A[i])>0&&(A[i]+=d/2);if(y&&Xoe(n.center,koe)&&1!==w)for(i=0;i<S;++i)(h=(s=y===_oe?O:I[~~(i/w)])-M[i].y2-t[i].y-D[i])>0&&(D[i]+=h/2);for(i=0;i<S;++i)g.union(M[i].translate(A[i],D[i]));switch(d=Xoe(n.anchor,"x"),h=Xoe(n.anchor,"y"),Xoe(n.anchor,Toe)){case coe:d-=g.width();break;case uoe:d-=g.width()/2}switch(Xoe(n.anchor,koe)){case coe:h-=g.height();break;case uoe:h-=g.height()/2}for(d=Math.round(d),h=Math.round(h),g.clear(),i=0;i<S;++i)t[i].mark.bounds.clear();for(i=0;i<S;++i)(l=t[i]).x+=A[i]+=d,l.y+=D[i]+=h,g.union(l.mark.bounds.union(l.bounds.translate(A[i],D[i]))),p&&e.dirty(l);return g}function Joe(e,t){return"x1"===t?e.x||0:"y1"===t?e.y||0:"x2"===t?(e.x||0)+(e.width||0):"y2"===t?(e.y||0)+(e.height||0):void 0}function Qoe(e,t){return e.bounds[t]}function ese(e,t,n,r,i,a,o,s,l,u,c,d,h,f){var p,m,g,v,y,b,x,w,_,S=n.length,E=0,T=0;if(!S)return E;for(p=c;p<S;p+=d)n[p]&&(E=o(E,l(n[p],u)));if(!t.length)return E;for(t.length>i&&(e.warn("Grid headers exceed limit: "+i),t=t.slice(0,i)),E+=a,m=0,v=t.length;m<v;++m)e.dirty(t[m]),t[m].mark.bounds.clear();for(p=c,m=0,v=t.length;m<v;++m,p+=d){for(y=(b=t[m]).mark.bounds,g=p;g>=0&&null==(x=n[g]);g-=h);s?(w=null==f?x.x:Math.round(x.bounds.x1+f*x.bounds.width()),_=E):(w=E,_=null==f?x.y:Math.round(x.bounds.y1+f*x.bounds.height())),y.union(b.bounds.translate(w-(b.x||0),_-(b.y||0))),b.x=w,b.y=_,e.dirty(b),T=o(T,y[u])}return T}function tse(e,t,n,r,i,a){if(t){e.dirty(t);var o=n,s=n;r?o=Math.round(i.x1+a*i.width()):s=Math.round(i.y1+a*i.height()),t.bounds.translate(o-(t.x||0),s-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=s,e.dirty(t)}}function nse(e,t,n,r,i,a,o){const s=function(e,t){const n=e[t]||{};return(t,r)=>null!=n[t]?n[t]:null!=e[t]?e[t]:r}(n,t),l=function(e,t){let n=-1/0;return e.forEach(e=>{null!=e.offset&&(n=Math.max(n,e.offset))}),n>-1/0?n:t}(e,s("offset",0)),u=s("anchor",loe),c=u===coe?1:u===uoe?.5:0,d={align:Soe,bounds:s("bounds",Eoe),columns:"vertical"===s("direction")?1:e.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(t){case aoe:d.anchor={x:Math.floor(r.x1)-l,column:coe,y:c*(o||r.height()+2*r.y1),row:u};break;case ooe:d.anchor={x:Math.ceil(r.x2)+l,y:c*(o||r.height()+2*r.y1),row:u};break;case ioe:d.anchor={y:Math.floor(i.y1)-l,row:coe,x:c*(a||i.width()+2*i.x1),column:u};break;case soe:d.anchor={y:Math.ceil(i.y2)+l,x:c*(a||i.width()+2*i.x1),column:u};break;case"top-left":d.anchor={x:l,y:l};break;case"top-right":d.anchor={x:a-l,y:l,column:coe};break;case"bottom-left":d.anchor={x:l,y:o-l,row:coe};break;case"bottom-right":d.anchor={x:a-l,y:o-l,column:coe,row:coe}}return d}function rse(e,t){var n,r,i=t.items[0],a=i.datum,o=i.orient,s=i.bounds,l=i.x,u=i.y;return i._bounds?i._bounds.clear().union(s):i._bounds=s.clone(),s.clear(),function(e,t,n){var r=t.padding,i=r-n.x,a=r-n.y;if(t.datum.title){var o=t.items[1].items[0],s=o.anchor,l=t.titlePadding||0,u=r-o.x,c=r-o.y;switch(o.orient){case aoe:i+=Math.ceil(o.bounds.width())+l;break;case ooe:case soe:break;default:a+=o.bounds.height()+l}switch((i||a)&&ase(e,n,i,a),o.orient){case aoe:c+=ise(t,n,o,s,1,1);break;case ooe:u+=ise(t,n,o,coe,0,0)+l,c+=ise(t,n,o,s,1,1);break;case soe:u+=ise(t,n,o,s,0,0),c+=ise(t,n,o,coe,-1,0,1)+l;break;default:u+=ise(t,n,o,s,0,0)}(u||c)&&ase(e,o,u,c),(u=Math.round(o.bounds.x1-r))<0&&(ase(e,n,-u,0),ase(e,o,-u,0))}else(i||a)&&ase(e,n,i,a)}(e,i,i.items[0].items[0]),s=function(e,t){return e.items.forEach(e=>t.union(e.bounds)),t.x1=e.padding,t.y1=e.padding,t}(i,s),n=2*i.padding,r=2*i.padding,s.empty()||(n=Math.ceil(s.width()+n),r=Math.ceil(s.height()+r)),"symbol"===a.type&&function(e){const t=e.reduce((e,t)=>(e[t.column]=Math.max(t.bounds.x2-t.x,e[t.column]||0),e),{});e.forEach(e=>{e.width=t[e.column],e.height=e.bounds.y2-e.y})}(i.items[0].items[0].items[0].items),o!==woe&&(i.x=l=0,i.y=u=0),i.width=n,i.height=r,Rne(s.set(l,u,l+n,u+r),i),i.mark.bounds.clear().union(s),i}function ise(e,t,n,r,i,a,o){const s=n.datum.vgrad,l=("symbol"===e.datum.type||!a&&s||o?t:t.items[0]).bounds[i?"y2":"x2"]-e.padding,u=s&&a?l:0,c=s&&a?0:l,d=i<=0?0:pie(n);return Math.round(r===loe?u:r===coe?c-d:.5*(l-d))}function ase(e,t,n,r){t.x+=n,t.y+=r,t.bounds.translate(n,r),t.mark.bounds.translate(n,r),e.dirty(t)}function ose(e){q1.call(this,null,e)}function sse(e,t){let n=0;if(void 0===t)for(let r of e)(r=+r)&&(n+=r);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}function lse(e){q1.call(this,null,e)}function use(e){q1.call(this,null,e)}function cse(){return g1({})}function dse(e){q1.call(this,null,e)}function hse(e){q1.call(this,[],e)}UX(ose,q1,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach(t=>{e.layout&&function(e,t,n){var r,i,a,o,s,l,u,c=function(e){var t,n,r=e.items,i=r.length,a=0;const o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;a<i;++a)if(n=(t=r[a]).items,t.marktype===doe)switch(t.role){case hoe:case poe:case foe:break;case moe:o.rowheaders.push(...n);break;case goe:o.rowfooters.push(...n);break;case yoe:o.colheaders.push(...n);break;case boe:o.colfooters.push(...n);break;case voe:o.rowtitle=n[0];break;case xoe:o.coltitle=n[0];break;default:o.marks.push(...n)}return o}(t),d=c.marks,h=n.bounds===Eoe?Joe:Qoe,f=n.offset,p=n.columns||d.length,m=p<=0?1:Math.ceil(d.length/p),g=m*p;const v=Zoe(e,d,n);v.empty()&&v.set(0,0,0,0),c.rowheaders&&(l=Xoe(n.headerBand,koe,null),r=ese(e,c.rowheaders,d,0,m,-Xoe(f,"rowHeader"),Voe,0,h,"x1",0,p,1,l)),c.colheaders&&(l=Xoe(n.headerBand,Toe,null),i=ese(e,c.colheaders,d,0,p,-Xoe(f,"columnHeader"),Voe,1,h,"y1",0,1,p,l)),c.rowfooters&&(l=Xoe(n.footerBand,koe,null),a=ese(e,c.rowfooters,d,0,m,Xoe(f,"rowFooter"),qoe,0,h,"x2",p-1,p,1,l)),c.colfooters&&(l=Xoe(n.footerBand,Toe,null),o=ese(e,c.colfooters,d,0,p,Xoe(f,"columnFooter"),qoe,1,h,"y2",g-p,1,p,l)),c.rowtitle&&(s=Xoe(n.titleAnchor,koe),u=Xoe(f,"rowTitle"),u=s===coe?a+u:r-u,l=Xoe(n.titleBand,koe,.5),tse(e,c.rowtitle,u,0,v,l)),c.coltitle&&(s=Xoe(n.titleAnchor,Toe),u=Xoe(f,"columnTitle"),u=s===coe?o+u:i-u,l=Xoe(n.titleBand,Toe,.5),tse(e,c.coltitle,u,1,v,l))}(n,t,e.layout),function(e,t,n){var r,i,a,o,s,l=t.items,u=Math.max(0,t.width||0),c=Math.max(0,t.height||0),d=(new One).set(0,0,u,c),h=d.clone(),f=d.clone(),p=[];for(o=0,s=l.length;o<s;++o)switch((i=l[o]).role){case hoe:(Uoe(i)?h:f).union(Hoe(e,i,u,c));break;case foe:r=i;break;case poe:p.push(rse(e,i));break;case"frame":case"scope":case moe:case goe:case voe:case yoe:case boe:case xoe:h.union(i.bounds),f.union(i.bounds);break;default:d.union(i.bounds)}if(p.length){const t={};p.forEach(e=>{(a=e.orient||ooe)!==woe&&(t[a]||(t[a]=[])).push(e)});for(const r in t){const i=t[r];Zoe(e,i,nse(i,r,n.legends,h,f,u,c))}p.forEach(t=>{const r=t.bounds;if(r.equals(t._bounds)||(t.bounds=t._bounds,e.dirty(t),t.bounds=r,e.dirty(t)),n.autosize&&"fit"===n.autosize.type)switch(t.orient){case aoe:case ooe:d.add(r.x1,0).add(r.x2,0);break;case ioe:case soe:d.add(0,r.y1).add(0,r.y2)}else d.union(r)})}d.union(h).union(f),r&&d.union(function(e,t,n,r,i){var a,o=t.items[0],s=o.orient,l=o.anchor,u=o.offset,c=o.padding,d=o.items[0].items[0],h=o.items[1]&&o.items[1].items[0],f=s===aoe||s===ooe?r:n,p=0,m=0,g=0,v=0,y=0;if(o.frame!==doe?s===aoe?(p=i.y2,f=i.y1):s===ooe?(p=i.y1,f=i.y2):(p=i.x1,f=i.x2):s===aoe&&(p=r,f=0),a=l===loe?p:l===coe?f:(p+f)/2,h&&h.text){switch(s){case ioe:case soe:y=d.bounds.height()+c;break;case aoe:v=d.bounds.width()+c;break;case ooe:v=-d.bounds.width()-c}Boe.clear().union(h.bounds),Boe.translate(v-(h.x||0),y-(h.y||0)),zoe(h,"x",v)|zoe(h,"y",y)&&(e.dirty(h),h.bounds.clear().union(Boe),h.mark.bounds.clear().union(Boe),e.dirty(h)),Boe.clear().union(h.bounds)}else Boe.clear();switch(Boe.union(d.bounds),s){case ioe:m=a,g=i.y1-Boe.height()-u;break;case aoe:m=i.x1-Boe.width()-u,g=a;break;case ooe:m=i.x2+Boe.width()+u,g=a;break;case soe:m=a,g=i.y2+u;break;default:m=o.x,g=o.y}return zoe(o,"x",m)|zoe(o,"y",g)&&(Boe.translate(m,g),e.dirty(o),o.bounds.clear().union(Boe),t.bounds.clear().union(Boe),e.dirty(o)),o.bounds}(e,r,u,c,d)),t.clip&&d.set(0,0,t.width||0,t.height||0),function(e,t,n,r){const i=r.autosize||{},a=i.type;if(e._autosize<1||!a)return;let o=e._width,s=e._height,l=Math.max(0,t.width||0),u=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),d=Math.max(0,Math.ceil(-n.y1));const h=Math.max(0,Math.ceil(n.x2-l)),f=Math.max(0,Math.ceil(n.y2-c));if("padding"===i.contains){const t=e.padding();o-=t.left+t.right,s-=t.top+t.bottom}a===woe?(u=0,d=0,l=o,c=s):"fit"===a?(l=Math.max(0,o-u-h),c=Math.max(0,s-d-f)):"fit-x"===a?(l=Math.max(0,o-u-h),s=c+d+f):"fit-y"===a?(o=l+u+h,c=Math.max(0,s-d-f)):"pad"===a&&(o=l+u+h,s=c+d+f),e._resizeView(o,s,l,c,[u,d],i.resize)}(e,t,d,n)}(n,t,e)}),(r=e.mark.group)&&"legend-entry"!==r.mark.role?t.reflow():t;var r}}),UX(lse,q1,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,a=e.scale,o=gte(a,null==e.count?e.values?e.values.length:10:e.count,e.minstep),s=e.format||bte(n,a,o,e.formatSpecifier,e.formatType,!!e.values),l=e.values?vte(a,e.values,o):yte(a,o);return i&&(r.rem=i),i=l.map((e,t)=>g1({index:t/(l.length-1||1),value:e,label:s(e)})),e.extra&&i.length&&i.push(g1({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}}),UX(use,q1,{transform(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||cse,a=e.key||p1,o=this.value;return QY(r.encode)&&(r.encode=null),o&&(e.modified("key")||t.modified(a))&&FY("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=function(e){const t=BX().test(e=>e.exit);return t.lookup=n=>t.get(e(n)),t}(a)),t.visit(t.ADD,e=>{const t=a(e);let n=o.get(t);n?n.exit?(o.empty--,r.add.push(n)):r.mod.push(n):(n=i(e),o.set(t,n),r.add.push(n)),n.datum=e,n.exit=!1}),t.visit(t.MOD,e=>{const t=a(e),n=o.get(t);n&&(n.datum=e,r.mod.push(n))}),t.visit(t.REM,e=>{const t=a(e),n=o.get(t);e!==n.datum||n.exit||(r.rem.push(n),n.exit=!0,++o.empty)}),t.changed(t.ADD_MOD)&&r.modifies("datum"),(t.clean()||e.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),r}}),UX(dse,q1,{transform(e,t){var n=t.fork(t.ADD_REM),r=e.mod||!1,i=e.encoders,a=t.encode;if(QY(a)){if(!n.changed()&&!a.every(e=>i[e]))return t.StopPropagation;a=a[0],n.encode=null}var o="enter"===a,s=i.update||VY,l=i.enter||VY,u=i.exit||VY,c=(a&&!o?i[a]:s)||VY;if(t.changed(t.ADD)&&(t.visit(t.ADD,t=>{l(t,e),s(t,e)}),n.modifies(l.output),n.modifies(s.output),c!==VY&&c!==s&&(t.visit(t.ADD,t=>{c(t,e)}),n.modifies(c.output))),t.changed(t.REM)&&u!==VY&&(t.visit(t.REM,t=>{u(t,e)}),n.modifies(u.output)),o||c!==VY){const i=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(i,t=>{const i=l(t,e)||r;(c(t,e)||i)&&n.mod.push(t)}),n.mod.length&&n.modifies(l.output)):t.visit(i,t=>{(c(t,e)||r)&&n.mod.push(t)}),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}}),UX(hse,q1,{transform(e,t){if(null!=this.value&&!e.modified())return t.StopPropagation;var n,r,i,a,o,s=t.dataflow.locale(),l=t.fork(t.NO_SOURCE|t.NO_FIELDS),u=this.value,c=e.type||hte,d=e.scale,h=+e.limit,f=gte(d,null==e.count?5:e.count,e.minstep),p=e.format||Ete(s,d,f,c,e.formatSpecifier,e.formatType,!!e.values||c===hte),m=e.values||Ste(d,f);return u&&(l.rem=u),c===hte?(h&&m.length>h?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),u=m.slice(0,h-1),o=!0):u=m,kX(i=e.size)?(e.values||0!==d(u[0])||(u=u.slice(1)),a=u.reduce((t,n)=>Math.max(t,i(n,e)),0)):i=MX(a=i||8),u=u.map((t,n)=>g1({index:n,label:p(t,n,u),value:t,offset:a,size:i(t,e)})),o&&(o=m[u.length],u.push(g1({index:u.length,label:"\u2026".concat(m.length-u.length," entries"),value:o,offset:a,size:i(o,e)})))):"gradient"===c?(n=d.domain(),r=ote(d,n[0],aX(n)),m.length<3&&!e.values&&n[0]!==aX(n)&&(m=[n[0],aX(n)]),u=m.map((e,t)=>g1({index:t,label:p(e,t,m),value:e,perc:r(e)}))):(i=m.length-1,r=function(e){const t=e.domain(),n=t.length-1;let r=+t[0],i=+aX(t),a=i-r;if(e.type===Dee){const e=n?a/n:.1;r-=e,i+=e,a=i-r}return e=>(e-r)/a}(d),u=m.map((e,t)=>g1({index:t,label:p(e,t,m),value:e,perc:t?r(e):0,perc2:t===i?1:r(m[t+1])}))),l.source=u,l.add=u,this.value=u,l}});const fse=e=>e.source.x,pse=e=>e.source.y,mse=e=>e.target.x,gse=e=>e.target.y;function vse(e){q1.call(this,{},e)}vse.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},UX(vse,q1,{transform(e,t){var n=e.sourceX||fse,r=e.sourceY||pse,i=e.targetX||mse,a=e.targetY||gse,o=e.as||"path",s=e.shape||"line",l=wse.get(s+"-"+(e.orient||"vertical"))||wse.get(s);return l||FY("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,e=>{e[o]=l(n(e),r(e),i(e),a(e))}),t.reflow(e.modified()).modifies(o)}});const yse=(e,t,n,r)=>"M"+e+","+t+"L"+n+","+r,bse=(e,t,n,r)=>{var i=n-e,a=r-t,o=Math.sqrt(i*i+a*a)/2;return"M"+e+","+t+"A"+o+","+o+" "+180*Math.atan2(a,i)/Math.PI+" 0 1 "+n+","+r},xse=(e,t,n,r)=>{const i=n-e,a=r-t,o=.2*(i+a),s=.2*(a-i);return"M"+e+","+t+"C"+(e+o)+","+(t+s)+" "+(n+s)+","+(r-o)+" "+n+","+r},wse=BX({line:yse,"line-radial":(e,t,n,r)=>yse(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),arc:bse,"arc-radial":(e,t,n,r)=>bse(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),curve:xse,"curve-radial":(e,t,n,r)=>xse(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),"orthogonal-horizontal":(e,t,n,r)=>"M"+e+","+t+"V"+r+"H"+n,"orthogonal-vertical":(e,t,n,r)=>"M"+e+","+t+"H"+n+"V"+r,"orthogonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n);return"M"+t*i+","+t*a+"A"+t+","+t+" 0 0,"+((Math.abs(n-e)>Math.PI?n<=e:n>e)?1:0)+" "+t*o+","+t*s+"L"+r*o+","+r*s},"diagonal-horizontal":(e,t,n,r)=>{const i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},"diagonal-vertical":(e,t,n,r)=>{const i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),l=(t+r)/2;return"M"+t*i+","+t*a+"C"+l*i+","+l*a+" "+l*o+","+l*s+" "+r*o+","+r*s}});function _se(e){q1.call(this,null,e)}function Sse(e){return Kee(e)&&e!==Cee}_se.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},UX(_se,q1,{transform(e,t){var n,r,i,a=e.as||["startAngle","endAngle"],o=a[0],s=a[1],l=e.startAngle||0,u=null!=e.endAngle?e.endAngle:2*Math.PI,c=t.source,d=c.map(e.field||HY),h=d.length,f=l,p=(u-l)/sse(d),m=Z2(h);for(e.sort&&m.sort((e,t)=>d[e]-d[t]),n=0;n<h;++n)i=d[m[n]],(r=c[m[n]])[o]=f,r[s]=f+=i*p;return this.value=d,t.reflow(e.modified()).modifies(a)}});const Ese=lK(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function Tse(e){q1.call(this,null,e),this.modified(!0)}function kse(e,t,n){return Qee(e)&&Math.abs(t.reduce((e,t)=>e+(t<0?-1:t>0?1:0),0))!==t.length&&n.warn("Log scale domain includes zero: "+rK(t)),t}function Cse(e,t,n){return kX(e)&&(t||n)?rte(e,Ise(t||[0,1],n)):e}function Ise(e,t){return t?e.slice().reverse():e}function Ose(e){q1.call(this,null,e)}UX(Tse,q1,{transform(e,t){var n=t.dataflow,r=this.value,i=function(e){var t,n=e.type,r="";return n===Cee?"sequential-linear":(function(e){const t=e.type;return Kee(t)&&t!==Tee&&t!==kee&&(e.scheme||e.range&&e.range.length&&e.range.every(XX))}(e)&&(r=2===(t=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(null!=e.domainMid):0)?"sequential-":3===t?"diverging-":""),(r+n||xee).toLowerCase())}(e);for(i in r&&i===r.type||(this.value=r=Gee(i)()),e)if(!Ese[i]){if("padding"===i&&Sse(r.type))continue;kX(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}return function(e,t,n){var r=e.type,i=t.round||!1,a=t.range;if(null!=t.rangeStep)a=function(e,t,n){return e!==jee&&e!==Nee&&FY("Only band and point scales support rangeStep."),[0,t.rangeStep*bee(n,e===Nee?1:(null!=t.paddingInner?t.paddingInner:t.padding)||0,(null!=t.paddingOuter?t.paddingOuter:t.padding)||0)]}(r,t,n);else if(t.scheme&&(a=function(e,t,n){var r,i=t.schemeExtent;return QY(t.scheme)?r=ite(t.scheme,t.interpolate,t.interpolateGamma):(r=dte(t.scheme.toLowerCase()))||FY("Unrecognized scheme name: ".concat(t.scheme)),n=e===Dee?n+1:e===Ree?n-1:e===Oee||e===Aee?+t.schemeCount||5:n,ete(e)?Cse(r,i,t.reverse):kX(r)?ate(Cse(r,i),n):e===Mee?r:r.slice(0,n)}(r,t,n),kX(a))){if(e.interpolator)return e.interpolator(a);FY("Scale type ".concat(r," does not support interpolating color schemes."))}if(a&&ete(r))return e.interpolator(ite(Ise(a,t.reverse),t.interpolate,t.interpolateGamma));a&&t.interpolate&&e.interpolate?e.interpolate(ste(t.interpolate,t.interpolateGamma)):kX(e.round)?e.round(i):kX(e.rangeRound)&&e.interpolate(i?T9:_9),a&&e.range(Ise(a,t.reverse))}(r,e,function(e,t,n){let r=t.bins;if(r&&!QY(r)){const t=e.domain(),n=t[0],i=aX(t),a=r.step;let o=null==r.start?n:r.start,s=null==r.stop?i:r.stop;a||FY("Scale bins parameter missing step property."),o<n&&(o=a*Math.ceil(n/a)),s>i&&(s=a*Math.floor(i/a)),r=Z2(o,s+a/2,a)}return r?e.bins=r:e.bins&&delete e.bins,e.type===Ree&&(r?t.domain||t.domainRaw||(e.domain(r),n=r.length):e.bins=e.domain()),n}(r,e,function(e,t,n){const r=function(e,t,n){return t?(e.domain(kse(e.type,t,n)),t.length):-1}(e,t.domainRaw,n);if(r>-1)return r;var i,a,o=t.domain,s=e.type,l=t.zero||void 0===t.zero&&function(e){const t=e.type;return!e.bins&&(t===xee||t===_ee||t===See)}(e);if(!o)return 0;if(Sse(s)&&t.padding&&o[0]!==aX(o)&&(o=function(e,t,n,r,i,a){var o=Math.abs(aX(n)-n[0]),s=o/(o-2*r),l=e===wee?bX(t,null,s):e===See?xX(t,null,s,.5):e===_ee?xX(t,null,s,i||1):e===Eee?wX(t,null,s,a||1):yX(t,null,s);return(t=t.slice())[0]=l[0],t[t.length-1]=l[1],t}(s,o,t.range,t.padding,t.exponent,t.constant)),(l||null!=t.domainMin||null!=t.domainMax||null!=t.domainMid)&&(i=(o=o.slice()).length-1||1,l&&(o[0]>0&&(o[0]=0),o[i]<0&&(o[i]=0)),null!=t.domainMin&&(o[0]=t.domainMin),null!=t.domainMax&&(o[i]=t.domainMax),null!=t.domainMid)){const e=(a=t.domainMid)>o[i]?i+1:a<o[0]?0:i;e!==i&&n.warn("Scale domainMid exceeds domain min or max.",a),o.splice(e,0,a)}return e.domain(kse(s,o,n)),s===Mee&&e.unknown(t.domainImplicit?H4:void 0),t.nice&&e.nice&&e.nice(!0!==t.nice&&gte(e,t.nice)||null),o.length}(r,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),UX(Ose,q1,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(x1(e.sort)),this.modified(n),t}});const Ase="zero",Dse="center",Mse="normalize",Nse=["y0","y1"];function jse(e){q1.call(this,null,e)}function Rse(e,t,n,r,i){for(var a,o=(t-e.sum)/2,s=e.length,l=0;l<s;++l)(a=e[l])[r]=o,a[i]=o+=Math.abs(n(a))}function Pse(e,t,n,r,i){for(var a,o=1/e.sum,s=0,l=e.length,u=0,c=0;u<l;++u)(a=e[u])[r]=s,a[i]=s=o*(c+=Math.abs(n(a)))}function Fse(e,t,n,r,i){for(var a,o,s=0,l=0,u=e.length,c=0;c<u;++c)(a=+n(o=e[c]))<0?(o[r]=l,o[i]=l+=a):(o[r]=s,o[i]=s+=a)}jse.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:Ase,values:[Ase,Dse,Mse]},{name:"as",type:"string",array:!0,length:2,default:Nse}]},UX(jse,q1,{transform(e,t){var n,r,i,a,o=e.as||Nse,s=o[0],l=o[1],u=x1(e.sort),c=e.field||HY,d=e.offset===Dse?Rse:e.offset===Mse?Pse:Fse;for(n=function(e,t,n,r){var i,a,o,s,l,u,c,d,h,f=[],p=e=>e(l);if(null==t)f.push(e.slice());else for(i={},a=0,o=e.length;a<o;++a)l=e[a],(c=i[u=t.map(p)])||(i[u]=c=[],f.push(c)),c.push(l);for(u=0,h=0,s=f.length;u<s;++u){for(a=0,d=0,o=(c=f[u]).length;a<o;++a)d+=Math.abs(r(c[a]));c.sum=d,d>h&&(h=d),n&&c.sort(n)}return f.max=h,f}(t.source,e.groupby,u,c),r=0,i=n.length,a=n.max;r<i;++r)d(n[r],a,c,s,l);return t.reflow(e.modified()).modifies(o)}});var Lse=e=>e;function $se(e,t){e&&zse.hasOwnProperty(e.type)&&zse[e.type](e,t)}var Bse={Feature:function(e,t){$se(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)$se(n[r].geometry,t)}},zse={Sphere:function(e,t){t.sphere()},Point:function(e,t){t.point((e=e.coordinates)[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)t.point((e=n[r])[0],e[1],e[2])},LineString:function(e,t){Use(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Use(n[r],t,0)},Polygon:function(e,t){Hse(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Hse(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)$se(n[r],t)}};function Use(e,t,n){var r,i=-1,a=e.length-n;for(t.lineStart();++i<a;)t.point((r=e[i])[0],r[1],r[2]);t.lineEnd()}function Hse(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)Use(e[n],t,1);t.polygonEnd()}var Wse=function(e,t){e&&Bse.hasOwnProperty(e.type)?Bse[e.type](e,t):$se(e,t)};class Vse{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=t[r],a=e+i,o=Math.abs(e)<Math.abs(i)?e-(a-i):i-(a-e);o&&(t[n++]=o),e=a}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t,n,r,i=this._n,a=0;if(i>0){for(a=e[--i];i>0&&(t=a,n=e[--i],a=t+n,r=n-(a-t),!r););i>0&&(r<0&&e[i-1]<0||r>0&&e[i-1]>0)&&(n=2*r,t=a+n,n==t-a&&(a=t))}return a}}var qse=1e-6,Gse=1e-12,Yse=Math.PI,Xse=Yse/2,Kse=Yse/4,Zse=2*Yse,Jse=180/Yse,Qse=Yse/180,ele=Math.abs,tle=Math.atan,nle=Math.atan2,rle=Math.cos,ile=Math.ceil,ale=Math.exp,ole=(Math,Math.hypot),sle=Math.log,lle=Math.pow,ule=Math.sin,cle=Math.sign||function(e){return e>0?1:e<0?-1:0},dle=Math.sqrt,hle=Math.tan;function fle(e){return e>1?0:e<-1?Yse:Math.acos(e)}function ple(e){return e>1?Xse:e<-1?-Xse:Math.asin(e)}function mle(){}var gle,vle,yle,ble,xle=new Vse,wle=new Vse,_le={point:mle,lineStart:mle,lineEnd:mle,polygonStart:function(){_le.lineStart=Sle,_le.lineEnd=kle},polygonEnd:function(){_le.lineStart=_le.lineEnd=_le.point=mle,xle.add(ele(wle)),wle=new Vse},result:function(){var e=xle/2;return xle=new Vse,e}};function Sle(){_le.point=Ele}function Ele(e,t){_le.point=Tle,gle=yle=e,vle=ble=t}function Tle(e,t){wle.add(ble*e-yle*t),yle=e,ble=t}function kle(){Tle(gle,vle)}var Cle,Ile,Ole,Ale,Dle=_le,Mle=1/0,Nle=Mle,jle=-Mle,Rle=jle,Ple={point:function(e,t){e<Mle&&(Mle=e),e>jle&&(jle=e),t<Nle&&(Nle=t),t>Rle&&(Rle=t)},lineStart:mle,lineEnd:mle,polygonStart:mle,polygonEnd:mle,result:function(){var e=[[Mle,Nle],[jle,Rle]];return jle=Rle=-(Nle=Mle=1/0),e}},Fle=0,Lle=0,$le=0,Ble=0,zle=0,Ule=0,Hle=0,Wle=0,Vle=0,qle={point:Gle,lineStart:Yle,lineEnd:Zle,polygonStart:function(){qle.lineStart=Jle,qle.lineEnd=Qle},polygonEnd:function(){qle.point=Gle,qle.lineStart=Yle,qle.lineEnd=Zle},result:function(){var e=Vle?[Hle/Vle,Wle/Vle]:Ule?[Ble/Ule,zle/Ule]:$le?[Fle/$le,Lle/$le]:[NaN,NaN];return Fle=Lle=$le=Ble=zle=Ule=Hle=Wle=Vle=0,e}};function Gle(e,t){Fle+=e,Lle+=t,++$le}function Yle(){qle.point=Xle}function Xle(e,t){qle.point=Kle,Gle(Ole=e,Ale=t)}function Kle(e,t){var n=e-Ole,r=t-Ale,i=dle(n*n+r*r);Ble+=i*(Ole+e)/2,zle+=i*(Ale+t)/2,Ule+=i,Gle(Ole=e,Ale=t)}function Zle(){qle.point=Gle}function Jle(){qle.point=eue}function Qle(){tue(Cle,Ile)}function eue(e,t){qle.point=tue,Gle(Cle=Ole=e,Ile=Ale=t)}function tue(e,t){var n=e-Ole,r=t-Ale,i=dle(n*n+r*r);Ble+=i*(Ole+e)/2,zle+=i*(Ale+t)/2,Ule+=i,Hle+=(i=Ale*e-Ole*t)*(Ole+e),Wle+=i*(Ale+t),Vle+=3*i,Gle(Ole=e,Ale=t)}var nue=qle;function rue(e){this._context=e}rue.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Zse)}},result:mle};var iue,aue,oue,sue,lue,uue=new Vse,cue={point:mle,lineStart:function(){cue.point=due},lineEnd:function(){iue&&hue(aue,oue),cue.point=mle},polygonStart:function(){iue=!0},polygonEnd:function(){iue=null},result:function(){var e=+uue;return uue=new Vse,e}};function due(e,t){cue.point=hue,aue=sue=e,oue=lue=t}function hue(e,t){uue.add(dle((sue-=e)*sue+(lue-=t)*lue)),sue=e,lue=t}var fue=cue;function pue(){this._string=[]}function mue(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}pue.prototype={_radius:4.5,_circle:mue(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:null==this._circle&&(this._circle=mue(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}};var gue=function(e,t){var n,r,i=4.5;function a(e){return e&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),Wse(e,n(r))),r.result()}return a.area=function(e){return Wse(e,n(Dle)),Dle.result()},a.measure=function(e){return Wse(e,n(fue)),fue.result()},a.bounds=function(e){return Wse(e,n(Ple)),Ple.result()},a.centroid=function(e){return Wse(e,n(nue)),nue.result()},a.projection=function(t){return arguments.length?(n=null==t?(e=null,Lse):(e=t).stream,a):e},a.context=function(e){return arguments.length?(r=null==e?(t=null,new pue):new rue(t=e),"function"!=typeof i&&r.pointRadius(i),a):t},a.pointRadius=function(e){return arguments.length?(i="function"==typeof e?e:(r.pointRadius(+e),+e),a):i},a.projection(e).context(t)},vue=function(){var e,t=[];return{point:function(t,n,r){e.push([t,n,r])},lineStart:function(){t.push(e=[])},lineEnd:mle,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}},yue=function(e,t){return ele(e[0]-t[0])<qse&&ele(e[1]-t[1])<qse};function bue(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}var xue=function(e,t,n,r,i){var a,o,s=[],l=[];if(e.forEach((function(e){if(!((t=e.length-1)<=0)){var t,n,r=e[0],o=e[t];if(yue(r,o)){if(!r[2]&&!o[2]){for(i.lineStart(),a=0;a<t;++a)i.point((r=e[a])[0],r[1]);return void i.lineEnd()}o[0]+=2e-6}s.push(n=new bue(r,e,null,!0)),l.push(n.o=new bue(r,null,n,!1)),s.push(n=new bue(o,e,null,!1)),l.push(n.o=new bue(o,null,n,!0))}})),s.length){for(l.sort(t),wue(s),wue(l),a=0,o=l.length;a<o;++a)l[a].e=n=!n;for(var u,c,d=s[0];;){for(var h=d,f=!0;h.v;)if((h=h.n)===d)return;u=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(f)for(a=0,o=u.length;a<o;++a)i.point((c=u[a])[0],c[1]);else r(h.x,h.n.x,1,i);h=h.n}else{if(f)for(a=(u=h.p.z).length-1;a>=0;--a)i.point((c=u[a])[0],c[1]);else r(h.x,h.p.x,-1,i);h=h.p}u=(h=h.o).z,f=!f}while(!h.v);i.lineEnd()}}};function wue(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function _ue(e){return[nle(e[1],e[0]),ple(e[2])]}function Sue(e){var t=e[0],n=e[1],r=rle(n);return[r*rle(t),r*ule(t),ule(n)]}function Eue(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Tue(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function kue(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Cue(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Iue(e){var t=dle(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function Oue(e){return ele(e[0])<=Yse?e[0]:cle(e[0])*((ele(e[0])+Yse)%Zse-Yse)}function Aue(e){return Array.from(function*(e){for(const t of e)yield*t}(e))}var Due=function(e,t,n,r){return function(i){var a,o,s,l=t(i),u=vue(),c=t(u),d=!1,h={point:f,lineStart:m,lineEnd:g,polygonStart:function(){h.point=v,h.lineStart=y,h.lineEnd=b,o=[],a=[]},polygonEnd:function(){h.point=f,h.lineStart=m,h.lineEnd=g,o=Aue(o);var e=function(e,t){var n=Oue(t),r=t[1],i=ule(r),a=[ule(n),-rle(n),0],o=0,s=0,l=new Vse;1===i?r=Xse+qse:-1===i&&(r=-Xse-qse);for(var u=0,c=e.length;u<c;++u)if(h=(d=e[u]).length)for(var d,h,f=d[h-1],p=Oue(f),m=f[1]/2+Kse,g=ule(m),v=rle(m),y=0;y<h;++y,p=x,g=_,v=S,f=b){var b=d[y],x=Oue(b),w=b[1]/2+Kse,_=ule(w),S=rle(w),E=x-p,T=E>=0?1:-1,k=T*E,C=k>Yse,I=g*_;if(l.add(nle(I*T*ule(k),v*S+I*rle(k))),o+=C?E+T*Zse:E,C^p>=n^x>=n){var O=Tue(Sue(f),Sue(b));Iue(O);var A=Tue(a,O);Iue(A);var D=(C^E>=0?-1:1)*ple(A[2]);(r>D||r===D&&(O[0]||O[1]))&&(s+=C^E>=0?1:-1)}}return(o<-1e-6||o<qse&&l<-1e-12)^1&s}(a,r);o.length?(d||(i.polygonStart(),d=!0),xue(o,Nue,e,n,i)):e&&(d||(i.polygonStart(),d=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),d&&(i.polygonEnd(),d=!1),o=a=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function f(t,n){e(t,n)&&i.point(t,n)}function p(e,t){l.point(e,t)}function m(){h.point=p,l.lineStart()}function g(){h.point=f,l.lineEnd()}function v(e,t){s.push([e,t]),c.point(e,t)}function y(){c.lineStart(),s=[]}function b(){v(s[0][0],s[0][1]),c.lineEnd();var e,t,n,r,l=c.clean(),h=u.result(),f=h.length;if(s.pop(),a.push(s),s=null,f)if(1&l){if((t=(n=h[0]).length-1)>0){for(d||(i.polygonStart(),d=!0),i.lineStart(),e=0;e<t;++e)i.point((r=n[e])[0],r[1]);i.lineEnd()}}else f>1&&2&l&&h.push(h.pop().concat(h.shift())),o.push(h.filter(Mue))}return h}};function Mue(e){return e.length>1}function Nue(e,t){return((e=e.x)[0]<0?e[1]-Xse-qse:Xse-e[1])-((t=t.x)[0]<0?t[1]-Xse-qse:Xse-t[1])}var jue=Due((function(){return!0}),(function(e){var t,n=NaN,r=NaN,i=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(a,o){var s=a>0?Yse:-Yse,l=ele(a-n);ele(l-Yse)<qse?(e.point(n,r=(r+o)/2>0?Xse:-Xse),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),e.point(a,r),t=0):i!==s&&l>=Yse&&(ele(n-i)<qse&&(n-=i*qse),ele(a-s)<qse&&(a-=s*qse),r=function(e,t,n,r){var i,a,o=ule(e-n);return ele(o)>qse?tle((ule(t)*(a=rle(r))*ule(n)-ule(r)*(i=rle(t))*ule(e))/(i*a*o)):(t+r)/2}(n,r,a,o),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),t=0),e.point(n=a,r=o),i=s},lineEnd:function(){e.lineEnd(),n=r=NaN},clean:function(){return 2-t}}}),(function(e,t,n,r){var i;if(null==e)r.point(-Yse,i=n*Xse),r.point(0,i),r.point(Yse,i),r.point(Yse,0),r.point(Yse,-i),r.point(0,-i),r.point(-Yse,-i),r.point(-Yse,0),r.point(-Yse,i);else if(ele(e[0]-t[0])>qse){var a=e[0]<t[0]?Yse:-Yse;r.point(-a,i=n*a/2),r.point(0,i),r.point(a,i)}else r.point(t[0],t[1])}),[-Yse,-Xse]),Rue=function(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return(n=t.invert(n,r))&&e.invert(n[0],n[1])}),n};function Pue(e,t){return[ele(e)>Yse?e+Math.round(-e/Zse)*Zse:e,t]}function Fue(e,t,n){return(e%=Zse)?t||n?Rue($ue(e),Bue(t,n)):$ue(e):t||n?Bue(t,n):Pue}function Lue(e){return function(t,n){return[(t+=e)>Yse?t-Zse:t<-Yse?t+Zse:t,n]}}function $ue(e){var t=Lue(e);return t.invert=Lue(-e),t}function Bue(e,t){var n=rle(e),r=ule(e),i=rle(t),a=ule(t);function o(e,t){var o=rle(t),s=rle(e)*o,l=ule(e)*o,u=ule(t),c=u*n+s*r;return[nle(l*i-c*a,s*n-u*r),ple(c*i+l*a)]}return o.invert=function(e,t){var o=rle(t),s=rle(e)*o,l=ule(e)*o,u=ule(t),c=u*i-l*a;return[nle(l*i+u*a,s*n+c*r),ple(c*n-s*r)]},o}function zue(e,t){(t=Sue(t))[0]-=e,Iue(t);var n=fle(-t[1]);return((-t[2]<0?-n:n)+Zse-qse)%Zse}Pue.invert=Pue;var Uue=function(e){var t=rle(e),n=6*Qse,r=t>0,i=ele(t)>qse;function a(e,n){return rle(e)*rle(n)>t}function o(e,n,r){var i=[1,0,0],a=Tue(Sue(e),Sue(n)),o=Eue(a,a),s=a[0],l=o-s*s;if(!l)return!r&&e;var u=t*o/l,c=-t*s/l,d=Tue(i,a),h=Cue(i,u);kue(h,Cue(a,c));var f=d,p=Eue(h,f),m=Eue(f,f),g=p*p-m*(Eue(h,h)-1);if(!(g<0)){var v=dle(g),y=Cue(f,(-p-v)/m);if(kue(y,h),y=_ue(y),!r)return y;var b,x=e[0],w=n[0],_=e[1],S=n[1];w<x&&(b=x,x=w,w=b);var E=w-x,T=ele(E-Yse)<qse;if(!T&&S<_&&(b=_,_=S,S=b),T||E<qse?T?_+S>0^y[1]<(ele(y[0]-x)<qse?_:S):_<=y[1]&&y[1]<=S:E>Yse^(x<=y[0]&&y[0]<=w)){var k=Cue(f,(-p+v)/m);return kue(k,h),[y,_ue(k)]}}}function s(t,n){var i=r?e:Yse-e,a=0;return t<-i?a|=1:t>i&&(a|=2),n<-i?a|=4:n>i&&(a|=8),a}return Due(a,(function(e){var t,n,l,u,c;return{lineStart:function(){u=l=!1,c=1},point:function(d,h){var f,p=[d,h],m=a(d,h),g=r?m?0:s(d,h):m?s(d+(d<0?Yse:-Yse),h):0;if(!t&&(u=l=m)&&e.lineStart(),m!==l&&(!(f=o(t,p))||yue(t,f)||yue(p,f))&&(p[2]=1),m!==l)c=0,m?(e.lineStart(),f=o(p,t),e.point(f[0],f[1])):(f=o(t,p),e.point(f[0],f[1],2),e.lineEnd()),t=f;else if(i&&t&&r^m){var v;g&n||!(v=o(p,t,!0))||(c=0,r?(e.lineStart(),e.point(v[0][0],v[0][1]),e.point(v[1][0],v[1][1]),e.lineEnd()):(e.point(v[1][0],v[1][1]),e.lineEnd(),e.lineStart(),e.point(v[0][0],v[0][1],3)))}!m||t&&yue(t,p)||e.point(p[0],p[1]),t=p,l=m,n=g},lineEnd:function(){l&&e.lineEnd(),t=null},clean:function(){return c|(u&&l)<<1}}}),(function(t,r,i,a){!function(e,t,n,r,i,a){if(n){var o=rle(t),s=ule(t),l=r*n;null==i?(i=t+r*Zse,a=t-l/2):(i=zue(o,i),a=zue(o,a),(r>0?i<a:i>a)&&(i+=r*Zse));for(var u,c=i;r>0?c>a:c<a;c-=l)u=_ue([o,-s*rle(c),-s*ule(c)]),e.point(u[0],u[1])}}(a,e,n,i,t,r)}),r?[0,-e]:[-Yse,e-Yse])},Hue=1e9,Wue=-Hue;function Vue(e,t,n,r){function i(i,a){return e<=i&&i<=n&&t<=a&&a<=r}function a(i,a,s,u){var c=0,d=0;if(null==i||(c=o(i,s))!==(d=o(a,s))||l(i,a)<0^s>0)do{u.point(0===c||3===c?e:n,c>1?r:t)}while((c=(c+s+4)%4)!==d);else u.point(a[0],a[1])}function o(r,i){return ele(r[0]-e)<qse?i>0?0:3:ele(r[0]-n)<qse?i>0?2:1:ele(r[1]-t)<qse?i>0?1:0:i>0?3:2}function s(e,t){return l(e.x,t.x)}function l(e,t){var n=o(e,1),r=o(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(o){var l,u,c,d,h,f,p,m,g,v,y,b=o,x=vue(),w={point:_,lineStart:function(){w.point=S,u&&u.push(c=[]),v=!0,g=!1,p=m=NaN},lineEnd:function(){l&&(S(d,h),f&&g&&x.rejoin(),l.push(x.result())),w.point=_,g&&b.lineEnd()},polygonStart:function(){b=x,l=[],u=[],y=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,i=u.length;n<i;++n)for(var a,o,s=u[n],l=1,c=s.length,d=s[0],h=d[0],f=d[1];l<c;++l)a=h,o=f,h=(d=s[l])[0],f=d[1],o<=r?f>r&&(h-a)*(r-o)>(f-o)*(e-a)&&++t:f<=r&&(h-a)*(r-o)<(f-o)*(e-a)&&--t;return t}(),n=y&&t,i=(l=Aue(l)).length;(n||i)&&(o.polygonStart(),n&&(o.lineStart(),a(null,null,1,o),o.lineEnd()),i&&xue(l,s,t,a,o),o.polygonEnd()),b=o,l=u=c=null}};function _(e,t){i(e,t)&&b.point(e,t)}function S(a,o){var s=i(a,o);if(u&&c.push([a,o]),v)d=a,h=o,f=s,v=!1,s&&(b.lineStart(),b.point(a,o));else if(s&&g)b.point(a,o);else{var l=[p=Math.max(Wue,Math.min(Hue,p)),m=Math.max(Wue,Math.min(Hue,m))],x=[a=Math.max(Wue,Math.min(Hue,a)),o=Math.max(Wue,Math.min(Hue,o))];!function(e,t,n,r,i,a){var o,s=e[0],l=e[1],u=0,c=1,d=t[0]-s,h=t[1]-l;if(o=n-s,d||!(o>0)){if(o/=d,d<0){if(o<u)return;o<c&&(c=o)}else if(d>0){if(o>c)return;o>u&&(u=o)}if(o=i-s,d||!(o<0)){if(o/=d,d<0){if(o>c)return;o>u&&(u=o)}else if(d>0){if(o<u)return;o<c&&(c=o)}if(o=r-l,h||!(o>0)){if(o/=h,h<0){if(o<u)return;o<c&&(c=o)}else if(h>0){if(o>c)return;o>u&&(u=o)}if(o=a-l,h||!(o<0)){if(o/=h,h<0){if(o>c)return;o>u&&(u=o)}else if(h>0){if(o<u)return;o<c&&(c=o)}return u>0&&(e[0]=s+u*d,e[1]=l+u*h),c<1&&(t[0]=s+c*d,t[1]=l+c*h),!0}}}}}(l,x,e,t,n,r)?s&&(b.lineStart(),b.point(a,o),y=!1):(g||(b.lineStart(),b.point(l[0],l[1])),b.point(x[0],x[1]),s||b.lineEnd(),y=!1)}p=a,m=o,g=s}return w}}function que(e){return function(t){var n=new Gue;for(var r in e)n[r]=e[r];return n.stream=t,n}}function Gue(){}function Yue(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=r&&e.clipExtent(null),Wse(n,e.stream(Ple)),t(Ple.result()),null!=r&&e.clipExtent(r),e}function Xue(e,t,n){return Yue(e,(function(n){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],a=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),o=+t[0][0]+(r-a*(n[1][0]+n[0][0]))/2,s=+t[0][1]+(i-a*(n[1][1]+n[0][1]))/2;e.scale(150*a).translate([o,s])}),n)}function Kue(e,t,n){return Xue(e,[[0,0],t],n)}function Zue(e,t,n){return Yue(e,(function(n){var r=+t,i=r/(n[1][0]-n[0][0]),a=(r-i*(n[1][0]+n[0][0]))/2,o=-i*n[0][1];e.scale(150*i).translate([a,o])}),n)}function Jue(e,t,n){return Yue(e,(function(n){var r=+t,i=r/(n[1][1]-n[0][1]),a=-i*n[0][0],o=(r-i*(n[1][1]+n[0][1]))/2;e.scale(150*i).translate([a,o])}),n)}Gue.prototype={constructor:Gue,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var Que=rle(30*Qse),ece=function(e,t){return+t?function(e,t){function n(r,i,a,o,s,l,u,c,d,h,f,p,m,g){var v=u-r,y=c-i,b=v*v+y*y;if(b>4*t&&m--){var x=o+h,w=s+f,_=l+p,S=dle(x*x+w*w+_*_),E=ple(_/=S),T=ele(ele(_)-1)<qse||ele(a-d)<qse?(a+d)/2:nle(w,x),k=e(T,E),C=k[0],I=k[1],O=C-r,A=I-i,D=y*O-v*A;(D*D/b>t||ele((v*O+y*A)/b-.5)>.3||o*h+s*f+l*p<Que)&&(n(r,i,a,o,s,l,C,I,T,x/=S,w/=S,_,m,g),g.point(C,I),n(C,I,T,x,w,_,u,c,d,h,f,p,m,g))}}return function(t){var r,i,a,o,s,l,u,c,d,h,f,p,m={point:g,lineStart:v,lineEnd:b,polygonStart:function(){t.polygonStart(),m.lineStart=x},polygonEnd:function(){t.polygonEnd(),m.lineStart=v}};function g(n,r){n=e(n,r),t.point(n[0],n[1])}function v(){c=NaN,m.point=y,t.lineStart()}function y(r,i){var a=Sue([r,i]),o=e(r,i);n(c,d,u,h,f,p,c=o[0],d=o[1],u=r,h=a[0],f=a[1],p=a[2],16,t),t.point(c,d)}function b(){m.point=g,t.lineEnd()}function x(){v(),m.point=w,m.lineEnd=_}function w(e,t){y(r=e,t),i=c,a=d,o=h,s=f,l=p,m.point=y}function _(){n(c,d,u,h,f,p,i,a,r,o,s,l,16,t),m.lineEnd=b,b()}return m}}(e,t):function(e){return que({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)},tce=que({point:function(e,t){this.stream.point(e*Qse,t*Qse)}});function nce(e,t,n,r,i,a){if(!a)return function(e,t,n,r,i){function a(a,o){return[t+e*(a*=r),n-e*(o*=i)]}return a.invert=function(a,o){return[(a-t)/e*r,(n-o)/e*i]},a}(e,t,n,r,i);var o=rle(a),s=ule(a),l=o*e,u=s*e,c=o/e,d=s/e,h=(s*n-o*t)/e,f=(s*t+o*n)/e;function p(e,a){return[l*(e*=r)-u*(a*=i)+t,n-u*e-l*a]}return p.invert=function(e,t){return[r*(c*e-d*t+h),i*(f-d*e-c*t)]},p}function rce(e){return ice((function(){return e}))()}function ice(e){var t,n,r,i,a,o,s,l,u,c,d=150,h=480,f=250,p=0,m=0,g=0,v=0,y=0,b=0,x=1,w=1,_=null,S=jue,E=null,T=Lse,k=.5;function C(e){return l(e[0]*Qse,e[1]*Qse)}function I(e){return(e=l.invert(e[0],e[1]))&&[e[0]*Jse,e[1]*Jse]}function O(){var e=nce(d,0,0,x,w,b).apply(null,t(p,m)),r=nce(d,h-e[0],f-e[1],x,w,b);return n=Fue(g,v,y),s=Rue(t,r),l=Rue(n,s),o=ece(s,k),A()}function A(){return u=c=null,C}return C.stream=function(e){return u&&c===e?u:u=tce(function(e){return que({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}(n)(S(o(T(c=e)))))},C.preclip=function(e){return arguments.length?(S=e,_=void 0,A()):S},C.postclip=function(e){return arguments.length?(T=e,E=r=i=a=null,A()):T},C.clipAngle=function(e){return arguments.length?(S=+e?Uue(_=e*Qse):(_=null,jue),A()):_*Jse},C.clipExtent=function(e){return arguments.length?(T=null==e?(E=r=i=a=null,Lse):Vue(E=+e[0][0],r=+e[0][1],i=+e[1][0],a=+e[1][1]),A()):null==E?null:[[E,r],[i,a]]},C.scale=function(e){return arguments.length?(d=+e,O()):d},C.translate=function(e){return arguments.length?(h=+e[0],f=+e[1],O()):[h,f]},C.center=function(e){return arguments.length?(p=e[0]%360*Qse,m=e[1]%360*Qse,O()):[p*Jse,m*Jse]},C.rotate=function(e){return arguments.length?(g=e[0]%360*Qse,v=e[1]%360*Qse,y=e.length>2?e[2]%360*Qse:0,O()):[g*Jse,v*Jse,y*Jse]},C.angle=function(e){return arguments.length?(b=e%360*Qse,O()):b*Jse},C.reflectX=function(e){return arguments.length?(x=e?-1:1,O()):x<0},C.reflectY=function(e){return arguments.length?(w=e?-1:1,O()):w<0},C.precision=function(e){return arguments.length?(o=ece(s,k=e*e),A()):dle(k)},C.fitExtent=function(e,t){return Xue(C,e,t)},C.fitSize=function(e,t){return Kue(C,e,t)},C.fitWidth=function(e,t){return Zue(C,e,t)},C.fitHeight=function(e,t){return Jue(C,e,t)},function(){return t=e.apply(this,arguments),C.invert=t.invert&&I,O()}}function ace(e){var t=0,n=Yse/3,r=ice(e),i=r(t,n);return i.parallels=function(e){return arguments.length?r(t=e[0]*Qse,n=e[1]*Qse):[t*Jse,n*Jse]},i}function oce(e,t){var n=ule(e),r=(n+ule(t))/2;if(ele(r)<qse)return function(e){var t=rle(e);function n(e,n){return[e*t,ule(n)/t]}return n.invert=function(e,n){return[e/t,ple(n*t)]},n}(e);var i=1+n*(2*r-n),a=dle(i)/r;function o(e,t){var n=dle(i-2*r*ule(t))/r;return[n*ule(e*=r),a-n*rle(e)]}return o.invert=function(e,t){var n=a-t,o=nle(e,ele(n))*cle(n);return n*r<0&&(o-=Yse*cle(e)*cle(n)),[o/r,ple((i-(e*e+n*n)*r*r)/(2*r))]},o}var sce=function(){return ace(oce).scale(155.424).center([0,33.6442])},lce=function(){return sce().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])};function uce(e){return function(t,n){var r=rle(t),i=rle(n),a=e(r*i);return a===1/0?[2,0]:[a*i*ule(t),a*ule(n)]}}function cce(e){return function(t,n){var r=dle(t*t+n*n),i=e(r),a=ule(i),o=rle(i);return[nle(t*a,r*o),ple(r&&n*a/r)]}}var dce=uce((function(e){return dle(2/(1+e))}));dce.invert=cce((function(e){return 2*ple(e/2)}));var hce=uce((function(e){return(e=fle(e))&&e/ule(e)}));function fce(e,t){return[e,sle(hle((Xse+t)/2))]}function pce(e){var t,n,r,i=rce(e),a=i.center,o=i.scale,s=i.translate,l=i.clipExtent,u=null;function c(){var a=Yse*o(),s=i(function(e){function t(t){return(t=e(t[0]*Qse,t[1]*Qse))[0]*=Jse,t[1]*=Jse,t}return e=Fue(e[0]*Qse,e[1]*Qse,e.length>2?e[2]*Qse:0),t.invert=function(t){return(t=e.invert(t[0]*Qse,t[1]*Qse))[0]*=Jse,t[1]*=Jse,t},t}(i.rotate()).invert([0,0]));return l(null==u?[[s[0]-a,s[1]-a],[s[0]+a,s[1]+a]]:e===fce?[[Math.max(s[0]-a,u),t],[Math.min(s[0]+a,n),r]]:[[u,Math.max(s[1]-a,t)],[n,Math.min(s[1]+a,r)]])}return i.scale=function(e){return arguments.length?(o(e),c()):o()},i.translate=function(e){return arguments.length?(s(e),c()):s()},i.center=function(e){return arguments.length?(a(e),c()):a()},i.clipExtent=function(e){return arguments.length?(null==e?u=t=n=r=null:(u=+e[0][0],t=+e[0][1],n=+e[1][0],r=+e[1][1]),c()):null==u?null:[[u,t],[n,r]]},c()}function mce(e){return hle((Xse+e)/2)}function gce(e,t){var n=rle(e),r=e===t?ule(e):sle(n/rle(t))/sle(mce(t)/mce(e)),i=n*lle(mce(e),r)/r;if(!r)return fce;function a(e,t){i>0?t<-Xse+qse&&(t=-Xse+qse):t>Xse-qse&&(t=Xse-qse);var n=i/lle(mce(t),r);return[n*ule(r*e),i-n*rle(r*e)]}return a.invert=function(e,t){var n=i-t,a=cle(r)*dle(e*e+n*n),o=nle(e,ele(n))*cle(n);return n*r<0&&(o-=Yse*cle(e)*cle(n)),[o/r,2*tle(lle(i/a,1/r))-Xse]},a}function vce(e,t){return[e,t]}function yce(e,t){var n=rle(e),r=e===t?ule(e):(n-rle(t))/(t-e),i=n/r+e;if(ele(r)<qse)return vce;function a(e,t){var n=i-t,a=r*e;return[n*ule(a),i-n*rle(a)]}return a.invert=function(e,t){var n=i-t,a=nle(e,ele(n))*cle(n);return n*r<0&&(a-=Yse*cle(e)*cle(n)),[a/r,i-cle(r)*dle(e*e+n*n)]},a}hce.invert=cce((function(e){return e})),fce.invert=function(e,t){return[e,2*tle(ale(t))-Xse]},vce.invert=vce;var bce=1.340264,xce=-.081106,wce=893e-6,_ce=.003796,Sce=dle(3)/2;function Ece(e,t){var n=ple(Sce*ule(t)),r=n*n,i=r*r*r;return[e*rle(n)/(Sce*(bce+3*xce*r+i*(7*wce+9*_ce*r))),n*(bce+xce*r+i*(wce+_ce*r))]}function Tce(e,t){var n=rle(t),r=rle(e)*n;return[n*ule(e)/r,ule(t)/r]}function kce(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),t*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}function Cce(e,t){return[rle(t)*ule(e),ule(t)]}function Ice(e,t){var n=rle(t),r=1+rle(e)*n;return[n*ule(e)/r,ule(t)/r]}function Oce(e,t){return[sle(hle((Xse+t)/2)),-e]}Ece.invert=function(e,t){for(var n,r=t,i=r*r,a=i*i*i,o=0;o<12&&(a=(i=(r-=n=(r*(bce+xce*i+a*(wce+_ce*i))-t)/(bce+3*xce*i+a*(7*wce+9*_ce*i)))*r)*i*i,!(ele(n)<Gse));++o);return[Sce*e*(bce+3*xce*i+a*(7*wce+9*_ce*i))/rle(r),ple(ule(r)/Sce)]},Tce.invert=cce(tle),kce.invert=function(e,t){var n,r=t,i=25;do{var a=r*r,o=a*a;r-=n=(r*(1.007226+a*(.015085+o*(.028874*a-.044475-.005916*o)))-t)/(1.007226+a*(.045255+o*(.259866*a-.311325-.005916*11*o)))}while(ele(n)>qse&&--i>0);return[e/(.8707+(a=r*r)*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979)),r]},Cce.invert=cce(ple),Ice.invert=cce((function(e){return 2*tle(e)})),Oce.invert=function(e,t){return[-t,2*tle(ale(e))-Xse]};var Ace=Math.abs,Dce=(Math,Math,Math,Math.cos),Mce=(Math,Math,Math,Math,Math,Math,Math,Math,Math.sin),Nce=(Math,Math.PI),jce=Nce/2,Rce=(Math,Fce(2));function Pce(e){return e>1?jce:e<-1?-jce:Math.asin(e)}function Fce(e){return e>0?Math.sqrt(e):0}function Lce(e,t){var n,r=e*Mce(t),i=30;do{t-=n=(t+Mce(t)-r)/(1+Dce(t))}while(Ace(n)>1e-6&&--i>0);return t/2}Fce(Nce);var $ce=function(e,t,n){function r(r,i){return[e*r*Dce(i=Lce(n,i)),t*Mce(i)]}return r.invert=function(r,i){return i=Pce(i/t),[r/(e*Dce(i)),Pce((2*i+Mce(2*i))/n)]},r}(Rce/jce,Rce,Nce);const Bce=gue(),zce=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function Uce(e,t){return function n(){const r=t();return r.type=e,r.path=gue().projection(r),r.copy=r.copy||function(){const e=n();return zce.forEach(t=>{r[t]&&e[t](r[t]())}),e.path.pointRadius(r.path.pointRadius()),e},r}}function Hce(e,t){if(!e||"string"!=typeof e)throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(Vce[e]=Uce(e,t),this):Vce[e]||null}function Wce(e){return e&&e.path||Bce}const Vce={albers:lce,albersusa:function(){var e,t,n,r,i,a,o=lce(),s=sce().rotate([154,0]).center([-2,58.5]).parallels([55,65]),l=sce().rotate([157,0]).center([-3,19.9]).parallels([8,18]),u={point:function(e,t){a=[e,t]}};function c(e){var t=e[0],o=e[1];return a=null,n.point(t,o),a||(r.point(t,o),a)||(i.point(t,o),a)}function d(){return e=t=null,c}return c.invert=function(e){var t=o.scale(),n=o.translate(),r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?s:i>=.166&&i<.234&&r>=-.214&&r<-.115?l:o).invert(e)},c.stream=function(n){return e&&t===n?e:(r=[o.stream(t=n),s.stream(n),l.stream(n)],i=r.length,e={point:function(e,t){for(var n=-1;++n<i;)r[n].point(e,t)},sphere:function(){for(var e=-1;++e<i;)r[e].sphere()},lineStart:function(){for(var e=-1;++e<i;)r[e].lineStart()},lineEnd:function(){for(var e=-1;++e<i;)r[e].lineEnd()},polygonStart:function(){for(var e=-1;++e<i;)r[e].polygonStart()},polygonEnd:function(){for(var e=-1;++e<i;)r[e].polygonEnd()}});var r,i},c.precision=function(e){return arguments.length?(o.precision(e),s.precision(e),l.precision(e),d()):o.precision()},c.scale=function(e){return arguments.length?(o.scale(e),s.scale(.35*e),l.scale(e),c.translate(o.translate())):o.scale()},c.translate=function(e){if(!arguments.length)return o.translate();var t=o.scale(),a=+e[0],c=+e[1];return n=o.translate(e).clipExtent([[a-.455*t,c-.238*t],[a+.455*t,c+.238*t]]).stream(u),r=s.translate([a-.307*t,c+.201*t]).clipExtent([[a-.425*t+qse,c+.12*t+qse],[a-.214*t-qse,c+.234*t-qse]]).stream(u),i=l.translate([a-.205*t,c+.212*t]).clipExtent([[a-.214*t+qse,c+.166*t+qse],[a-.115*t-qse,c+.234*t-qse]]).stream(u),d()},c.fitExtent=function(e,t){return Xue(c,e,t)},c.fitSize=function(e,t){return Kue(c,e,t)},c.fitWidth=function(e,t){return Zue(c,e,t)},c.fitHeight=function(e,t){return Jue(c,e,t)},c.scale(1070)},azimuthalequalarea:function(){return rce(dce).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return rce(hce).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return ace(gce).scale(109.5).parallels([30,30])},conicequalarea:sce,conicequidistant:function(){return ace(yce).scale(131.154).center([0,13.9389])},equalEarth:function(){return rce(Ece).scale(177.158)},equirectangular:function(){return rce(vce).scale(152.63)},gnomonic:function(){return rce(Tce).scale(144.049).clipAngle(60)},identity:function(){var e,t,n,r,i,a,o,s=1,l=0,u=0,c=1,d=1,h=0,f=null,p=1,m=1,g=que({point:function(e,t){var n=b([e,t]);this.stream.point(n[0],n[1])}}),v=Lse;function y(){return p=s*c,m=s*d,a=o=null,b}function b(n){var r=n[0]*p,i=n[1]*m;if(h){var a=i*e-r*t;r=r*e+i*t,i=a}return[r+l,i+u]}return b.invert=function(n){var r=n[0]-l,i=n[1]-u;if(h){var a=i*e+r*t;r=r*e-i*t,i=a}return[r/p,i/m]},b.stream=function(e){return a&&o===e?a:a=g(v(o=e))},b.postclip=function(e){return arguments.length?(v=e,f=n=r=i=null,y()):v},b.clipExtent=function(e){return arguments.length?(v=null==e?(f=n=r=i=null,Lse):Vue(f=+e[0][0],n=+e[0][1],r=+e[1][0],i=+e[1][1]),y()):null==f?null:[[f,n],[r,i]]},b.scale=function(e){return arguments.length?(s=+e,y()):s},b.translate=function(e){return arguments.length?(l=+e[0],u=+e[1],y()):[l,u]},b.angle=function(n){return arguments.length?(t=ule(h=n%360*Qse),e=rle(h),y()):h*Jse},b.reflectX=function(e){return arguments.length?(c=e?-1:1,y()):c<0},b.reflectY=function(e){return arguments.length?(d=e?-1:1,y()):d<0},b.fitExtent=function(e,t){return Xue(b,e,t)},b.fitSize=function(e,t){return Kue(b,e,t)},b.fitWidth=function(e,t){return Zue(b,e,t)},b.fitHeight=function(e,t){return Jue(b,e,t)},b},mercator:function(){return pce(fce).scale(961/Zse)},mollweide:function(){return rce($ce).scale(169.529)},naturalEarth1:function(){return rce(kce).scale(175.295)},orthographic:function(){return rce(Cce).scale(249.5).clipAngle(90.000001)},stereographic:function(){return rce(Ice).scale(250).clipAngle(142)},transversemercator:function(){var e=pce(Oce),t=e.center,n=e.rotate;return e.center=function(e){return arguments.length?t([-e[1],e[0]]):[(e=t())[1],-e[0]]},e.rotate=function(e){return arguments.length?n([e[0],e[1],e.length>2?e[2]+90:90]):[(e=n())[0],e[1],e[2]-90]},n([0,0,90]).scale(159.155)}};for(const iBe in Vce)Hce(iBe,Vce[iBe]);function qce(e,t,n){var r=Z2(e,t-qse,n).concat(t);return function(e){return r.map((function(t){return[e,t]}))}}function Gce(e,t,n){var r=Z2(e,t-qse,n).concat(t);return function(e){return r.map((function(t){return[t,e]}))}}var Yce=function(e,t,n){e.prototype=t.prototype=n,n.constructor=e};function Xce(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Kce(){}var Zce=.7,Jce=1/Zce,Qce="\\s*([+-]?\\d+)\\s*",ede="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",tde="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",nde=/^#([0-9a-f]{3,8})$/,rde=new RegExp("^rgb\\("+[Qce,Qce,Qce]+"\\)$"),ide=new RegExp("^rgb\\("+[tde,tde,tde]+"\\)$"),ade=new RegExp("^rgba\\("+[Qce,Qce,Qce,ede]+"\\)$"),ode=new RegExp("^rgba\\("+[tde,tde,tde,ede]+"\\)$"),sde=new RegExp("^hsl\\("+[ede,tde,tde]+"\\)$"),lde=new RegExp("^hsla\\("+[ede,tde,tde,ede]+"\\)$"),ude={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function cde(){return this.rgb().formatHex()}function dde(){return this.rgb().formatRgb()}function hde(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=nde.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?fde(t):3===n?new vde(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?pde(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?pde(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=rde.exec(e))?new vde(t[1],t[2],t[3],1):(t=ide.exec(e))?new vde(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=ade.exec(e))?pde(t[1],t[2],t[3],t[4]):(t=ode.exec(e))?pde(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=sde.exec(e))?wde(t[1],t[2]/100,t[3]/100,1):(t=lde.exec(e))?wde(t[1],t[2]/100,t[3]/100,t[4]):ude.hasOwnProperty(e)?fde(ude[e]):"transparent"===e?new vde(NaN,NaN,NaN,0):null}function fde(e){return new vde(e>>16&255,e>>8&255,255&e,1)}function pde(e,t,n,r){return r<=0&&(e=t=n=NaN),new vde(e,t,n,r)}function mde(e){return e instanceof Kce||(e=hde(e)),e?new vde((e=e.rgb()).r,e.g,e.b,e.opacity):new vde}function gde(e,t,n,r){return 1===arguments.length?mde(e):new vde(e,t,n,null==r?1:r)}function vde(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function yde(){return"#"+xde(this.r)+xde(this.g)+xde(this.b)}function bde(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function xde(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function wde(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Ede(e,t,n,r)}function _de(e){if(e instanceof Ede)return new Ede(e.h,e.s,e.l,e.opacity);if(e instanceof Kce||(e=hde(e)),!e)return new Ede;if(e instanceof Ede)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new Ede(o,s,l,e.opacity)}function Sde(e,t,n,r){return 1===arguments.length?_de(e):new Ede(e,t,n,null==r?1:r)}function Ede(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Tde(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function kde(){}Yce(Kce,hde,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:cde,formatHex:cde,formatHsl:function(){return _de(this).formatHsl()},formatRgb:dde,toString:dde}),Yce(vde,gde,Xce(Kce,{brighter:function(e){return e=null==e?Jce:Math.pow(Jce,e),new vde(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?Zce:Math.pow(Zce,e),new vde(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:yde,formatHex:yde,formatRgb:bde,toString:bde})),Yce(Ede,Sde,Xce(Kce,{brighter:function(e){return e=null==e?Jce:Math.pow(Jce,e),new Ede(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Zce:Math.pow(Zce,e),new Ede(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new vde(Tde(e>=240?e-240:e+120,i,r),Tde(e,i,r),Tde(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));const Cde=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function Ide(){var e=1,t=1,n=o;function r(e,t){return t.map(t=>i(e,t))}function i(r,i){var o=[],s=[];return function(n,r,i){var o,s,l,u,c,d=new Array,h=new Array;for(o=s=-1,Cde[(l=n[0]>=r)<<1].forEach(f);++o<e-1;)Cde[l|(l=n[o+1]>=r)<<1].forEach(f);for(Cde[l<<0].forEach(f);++s<t-1;){for(o=-1,Cde[(l=n[s*e+e]>=r)<<1|(u=n[s*e]>=r)<<2].forEach(f);++o<e-1;)c=u,Cde[l|(l=n[s*e+e+o+1]>=r)<<1|(u=n[s*e+o+1]>=r)<<2|c<<3].forEach(f);Cde[l|u<<3].forEach(f)}for(o=-1,Cde[(u=n[s*e]>=r)<<2].forEach(f);++o<e-1;)c=u,Cde[(u=n[s*e+o+1]>=r)<<2|c<<3].forEach(f);function f(e){var t,n,r=[e[0][0]+o,e[0][1]+s],l=[e[1][0]+o,e[1][1]+s],u=a(r),c=a(l);(t=h[u])?(n=d[c])?(delete h[t.end],delete d[n.start],t===n?(t.ring.push(l),i(t.ring)):d[t.start]=h[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete h[t.end],t.ring.push(l),h[t.end=c]=t):(t=d[c])?(n=h[u])?(delete d[t.start],delete h[n.end],t===n?(t.ring.push(l),i(t.ring)):d[n.start]=h[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete d[t.start],t.ring.unshift(r),d[t.start=u]=t):d[u]=h[c]={start:u,end:c,ring:[r,l]}}Cde[u<<3].forEach(f)}(r,i,e=>{n(e,r,i),function(e){for(var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}(e)>0?o.push([e]):s.push(e)}),s.forEach(e=>{for(var t,n=0,r=o.length;n<r;++n)if(-1!==Ode((t=o[n])[0],e))return void t.push(e)}),{type:"MultiPolygon",value:i,coordinates:o}}function a(t){return 2*t[0]+t[1]*(e+1)*4}function o(n,r,i){n.forEach(n=>{var a,o=n[0],s=n[1],l=0|o,u=0|s,c=r[u*e+l];o>0&&o<e&&l===o&&(n[0]=o+(i-(a=r[u*e+l-1]))/(c-a)-.5),s>0&&s<t&&u===s&&(n[1]=s+(i-(a=r[(u-1)*e+l]))/(c-a)-.5)})}return r.contour=i,r.size=function(n){if(!arguments.length)return[e,t];var i=Math.floor(n[0]),a=Math.floor(n[1]);return i>=0&&a>=0||FY("invalid size"),e=i,t=a,r},r.smooth=function(e){return arguments.length?(n=e?o:kde,r):n===o},r}function Ode(e,t){for(var n,r=-1,i=t.length;++r<i;)if(n=Ade(e,t[r]))return n;return 0}function Ade(e,t){for(var n=t[0],r=t[1],i=-1,a=0,o=e.length,s=o-1;a<o;s=a++){var l=e[a],u=l[0],c=l[1],d=e[s],h=d[0],f=d[1];if(Dde(l,d,t))return 0;c>r!=f>r&&n<(h-u)*(r-c)/(f-c)+u&&(i=-i)}return i}function Dde(e,t,n){var r,i,a,o;return function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])}(e,t,n)&&(i=e[r=+(e[0]===t[0])],o=t[r],i<=(a=n[r])&&a<=o||o<=a&&a<=i)}function Mde(e,t,n){return function(r){var i=RX(r),a=n?Math.min(i[0],0):i[0],o=i[1],s=o-a,l=t?QK(a,o,e):s/(e+1);return Z2(l,o,l)}}function Nde(e){q1.call(this,null,e)}function jde(e,t,n,r,i){const a=e.x1||0,o=e.y1||0,s=t*n<0;function l(e){e.forEach(u)}function u(e){s&&e.reverse(),e.forEach(c)}function c(e){e[0]=(e[0]-a)*t+r,e[1]=(e[1]-o)*n+i}return function(e){return e.coordinates.forEach(l),e}}function Rde(e,t,n){const r=e>=0?e:o2(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function Pde(e){return kX(e)?e:MX(+e)}function Fde(){var e=e=>e[0],t=e=>e[1],n=HY,r=[-1,-1],i=960,a=500,o=2;function s(s,l){const u=Rde(r[0],s,e)>>o,c=Rde(r[1],s,t)>>o,d=u?u+2:0,h=c?c+2:0,f=2*d+(i>>o),p=2*h+(a>>o),m=new Float32Array(f*p),g=new Float32Array(f*p);let v=m;s.forEach(r=>{const i=d+(+e(r)>>o),a=h+(+t(r)>>o);i>=0&&i<f&&a>=0&&a<p&&(m[i+a*f]+=+n(r))}),u>0&&c>0?(Lde(f,p,m,g,u),$de(f,p,g,m,c),Lde(f,p,m,g,u),$de(f,p,g,m,c),Lde(f,p,m,g,u),$de(f,p,g,m,c)):u>0?(Lde(f,p,m,g,u),Lde(f,p,g,m,u),Lde(f,p,m,g,u),v=g):c>0&&($de(f,p,m,g,c),$de(f,p,g,m,c),$de(f,p,m,g,c),v=g);const y=l?Math.pow(2,-2*o):1/sse(v);for(let e=0,t=f*p;e<t;++e)v[e]*=y;return{values:v,scale:1<<o,width:f,height:p,x1:d,y1:h,x2:d+(i>>o),y2:h+(a>>o)}}return s.x=function(t){return arguments.length?(e=Pde(t),s):e},s.y=function(e){return arguments.length?(t=Pde(e),s):t},s.weight=function(e){return arguments.length?(n=Pde(e),s):n},s.size=function(e){if(!arguments.length)return[i,a];var t=+e[0],n=+e[1];return t>=0&&n>=0||FY("invalid size"),i=t,a=n,s},s.cellSize=function(e){return arguments.length?((e=+e)>=1||FY("invalid cell size"),o=Math.floor(Math.log(e)/Math.LN2),s):1<<o},s.bandwidth=function(e){return arguments.length?(1===(e=EX(e)).length&&(e=[+e[0],+e[0]]),2!==e.length&&FY("invalid bandwidth"),r=e,s):r},s}function Lde(e,t,n,r,i){const a=1+(i<<1);for(let o=0;o<t;++o)for(let t=0,s=0;t<e+i;++t)t<e&&(s+=n[t+o*e]),t>=i&&(t>=a&&(s-=n[t-a+o*e]),r[t-i+o*e]=s/Math.min(t+1,e-1+a-t,a))}function $de(e,t,n,r,i){const a=1+(i<<1);for(let o=0;o<e;++o)for(let s=0,l=0;s<t+i;++s)s<t&&(l+=n[o+s*e]),s>=i&&(s>=a&&(l-=n[o+(s-a)*e]),r[o+(s-i)*e]=l/Math.min(s+1,t-1+a-s,a))}function Bde(e){q1.call(this,null,e)}Nde.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},UX(Nde,q1,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||zY,a=Ide().smooth(!1!==e.smooth),o=e.thresholds||function(e,t,n){const r=Mde(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?r:r(e.map(e=>K1(t(e).values)))}(r,i,e),s=null===e.as?null:e.as||"contour",l=[];return r.forEach(t=>{const n=i(t),r=a.size([n.width,n.height])(n.values,QY(o)?o:o(n.values));!function(e,t,n,r){let i=r.scale||t.scale,a=r.translate||t.translate;if(kX(i)&&(i=i(n,r)),kX(a)&&(a=a(n,r)),(1===i||null==i)&&!a)return;const o=(GX(i)?i:i[0])||1,s=(GX(i)?i:i[1])||1;e.forEach(jde(t,o,s,a&&a[0]||0,a&&a[1]||0))}(r,n,t,e),r.forEach(e=>{l.push(y1(t,g1(null!=s?{[s]:e}:e)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n}}),Bde.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const zde=["x","y","weight","size","cellSize","bandwidth"];function Ude(e,t){return zde.forEach(n=>null!=t[n]?e[n](t[n]):0),e}function Hde(e){q1.call(this,null,e)}UX(Bde,q1,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=function(e,t){var n,r,i,a,o,s,l=[],u=e=>e(a);if(null==t)l.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(s=n[o=t.map(u)])||(n[o]=s=[],s.dims=o,l.push(s)),s.push(a);return l}(t.materialize(t.SOURCE).source,e.groupby),a=(e.groupby||[]).map(MY),o=Ude(Fde(),e),s=e.as||"grid";return n=i.map(t=>g1(function(e,t){for(let n=0;n<a.length;++n)e[a[n]]=t[n];return e}({[s]:o(t,e.counts)},t.dims))),this.value&&(r.rem=this.value),this.value=r.source=r.add=n,r}}),Hde.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},UX(Hde,q1,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=Ide().smooth(!1!==e.smooth),o=e.values,s=e.thresholds||Mde(e.count||10,e.nice,!!o),l=e.size;return o||(o=t.materialize(t.SOURCE).source,r=jde(n=Ude(Fde(),e)(o,!0),n.scale||1,n.scale||1,0,0),l=[n.width,n.height],o=n.values),s=QY(s)?s:s(o),o=a.size(l)(o,s),r&&o.forEach(r),this.value&&(i.rem=this.value),this.value=i.source=i.add=(o||[]).map(g1),i}});const Wde="Feature",Vde="FeatureCollection";function qde(e){q1.call(this,null,e)}function Gde(e){q1.call(this,null,e)}function Yde(e){q1.call(this,null,e)}function Xde(e){q1.call(this,null,e)}function Kde(e){q1.call(this,[],e),this.generator=function(){var e,t,n,r,i,a,o,s,l,u,c,d,h=10,f=h,p=90,m=360,g=2.5;function v(){return{type:"MultiLineString",coordinates:y()}}function y(){return Z2(ile(r/p)*p,n,p).map(c).concat(Z2(ile(s/m)*m,o,m).map(d)).concat(Z2(ile(t/h)*h,e,h).filter((function(e){return ele(e%p)>qse})).map(l)).concat(Z2(ile(a/f)*f,i,f).filter((function(e){return ele(e%m)>qse})).map(u))}return v.lines=function(){return y().map((function(e){return{type:"LineString",coordinates:e}}))},v.outline=function(){return{type:"Polygon",coordinates:[c(r).concat(d(o).slice(1),c(n).reverse().slice(1),d(s).reverse().slice(1))]}},v.extent=function(e){return arguments.length?v.extentMajor(e).extentMinor(e):v.extentMinor()},v.extentMajor=function(e){return arguments.length?(s=+e[0][1],o=+e[1][1],(r=+e[0][0])>(n=+e[1][0])&&(e=r,r=n,n=e),s>o&&(e=s,s=o,o=e),v.precision(g)):[[r,s],[n,o]]},v.extentMinor=function(n){return arguments.length?(a=+n[0][1],i=+n[1][1],(t=+n[0][0])>(e=+n[1][0])&&(n=t,t=e,e=n),a>i&&(n=a,a=i,i=n),v.precision(g)):[[t,a],[e,i]]},v.step=function(e){return arguments.length?v.stepMajor(e).stepMinor(e):v.stepMinor()},v.stepMajor=function(e){return arguments.length?(p=+e[0],m=+e[1],v):[p,m]},v.stepMinor=function(e){return arguments.length?(h=+e[0],f=+e[1],v):[h,f]},v.precision=function(h){return arguments.length?(g=+h,l=qce(a,i,90),u=Gce(t,e,g),c=qce(s,o,90),d=Gce(r,n,g),v):g},v.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()}function Zde(e){q1.call(this,null,e)}function Jde(e){if(!kX(e))return!1;const t=lK(NY(e));return t.$x||t.$y||t.$value||t.$max}function Qde(e){q1.call(this,null,e),this.modified(!0)}function ehe(e,t,n){kX(e[t])&&e[t](n)}function the(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,a,o,s,l,u,c,d,h,f=e._root,p={data:r},m=e._x0,g=e._y0,v=e._x1,y=e._y1;if(!f)return e._root=p,e;for(;f.length;)if((u=t>=(a=(m+v)/2))?m=a:v=a,(c=n>=(o=(g+y)/2))?g=o:y=o,i=f,!(f=f[d=c<<1|u]))return i[d]=p,e;if(s=+e._x.call(null,f.data),l=+e._y.call(null,f.data),t===s&&n===l)return p.next=f,i?i[d]=p:e._root=p,e;do{i=i?i[d]=new Array(4):e._root=new Array(4),(u=t>=(a=(m+v)/2))?m=a:v=a,(c=n>=(o=(g+y)/2))?g=o:y=o}while((d=c<<1|u)==(h=(l>=o)<<1|s>=a));return i[h]=f,i[d]=p,e}qde.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},UX(qde,q1,{transform(e,t){var n,r=this._features,i=this._points,a=e.fields,o=a&&a[0],s=a&&a[1],l=e.geojson||!a&&zY,u=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(NY(l))||o&&t.modified(NY(o))||s&&t.modified(NY(s)),this.value&&!n||(u=t.SOURCE,this._features=r=[],this._points=i=[]),l&&t.visit(u,e=>r.push(l(e))),o&&s&&(t.visit(u,e=>{var t=o(e),n=s(e);null!=t&&null!=n&&(t=+t)===t&&(n=+n)===n&&i.push([t,n])}),r=r.concat({type:Wde,geometry:{type:"MultiPoint",coordinates:i}})),this.value={type:Vde,features:r}}}),Gde.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},UX(Gde,q1,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||zY,a=e.as||"path",o=n.SOURCE;!r||e.modified()?(this.value=r=Wce(e.projection),n.materialize().reflow()):o=i===zY||t.modified(i.fields)?n.ADD_MOD:n.ADD;const s=function(e,t){const n=e.pointRadius();return e.context(null),null!=t&&e.pointRadius(t),n}(r,e.pointRadius);return n.visit(o,e=>e[a]=r(i(e))),r.pointRadius(s),n.modifies(a)}}),Yde.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},UX(Yde,q1,{transform(e,t){var n,r=e.projection,i=e.fields[0],a=e.fields[1],o=e.as||["x","y"],s=o[0],l=o[1];function u(e){const t=r([i(e),a(e)]);t?(e[s]=t[0],e[l]=t[1]):(e[s]=void 0,e[l]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,u):(n=t.modified(i.fields)||t.modified(a.fields),t.visit(n?t.ADD_MOD:t.ADD,u)),t.modifies(o)}}),Xde.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},UX(Xde,q1,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",a=n.ADD;return r&&!e.modified()||(this.value=r=function(e,t,n){const r=null==n?n=>e(t(n)):r=>{var i=e.pointRadius(),a=e.pointRadius(n)(t(r));return e.pointRadius(i),a};return r.context=t=>(e.context(t),r),r}(Wce(e.projection),e.field||$Y("datum"),e.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,e=>e[i]=r),n.modifies(i)}}),Kde.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},UX(Kde,q1,{transform(e,t){var n,r=this.value,i=this.generator;if(!r.length||e.modified())for(const a in e)kX(i[a])&&i[a](e[a]);return n=i(),r.length?t.mod.push(b1(r[0],n)):t.add.push(g1(n)),r[0]=n,t}}),Zde.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},UX(Zde,q1,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,r="shared"===e.resolve,i=e.field||zY,a=function(e,t){let n;return kX(e)?(n=n=>e(n,t),n.dep=Jde(e)):e?n=MX(e):(n=e=>e.$value/e.$max||0,n.dep=!0),n}(e.opacity,e),o=function(e,t){let n;return kX(e)?(n=n=>gde(e(n,t)),n.dep=Jde(e)):n=MX(gde(e||"#888")),n}(e.color,e),s=e.as||"image",l={$x:0,$y:0,$value:0,$max:r?K1(n.map(e=>K1(i(e).values))):0};return n.forEach(e=>{const t=i(e),n=jX({},e,l);r||(n.$max=K1(t.values||[])),e[s]=function(e,t,n,r){const i=e.width,a=e.x1||0,o=e.y1||0,s=e.x2||i,l=e.y2||e.height,u=e.values,c=u?e=>u[e]:UY,d=R4(s-a,l-o),h=d.getContext("2d"),f=h.getImageData(0,0,s-a,l-o),p=f.data;for(let m=o,g=0;m<l;++m){t.$y=m-o;for(let e=a,o=m*i;e<s;++e,g+=4){t.$x=e-a,t.$value=c(e+o);const i=n(t);p[g+0]=i.r,p[g+1]=i.g,p[g+2]=i.b,p[g+3]=~~(255*r(t))}}return h.putImageData(f,0,0),d}(t,n,o.dep?o:MX(o(n)),a.dep?a:MX(a(n)))}),t.reflow(!0).modifies(s)}}),UX(Qde,q1,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=function(e){const t=Hce((e||"mercator").toLowerCase());return t||FY("Unrecognized projection type: "+e),t()}(e.type),zce.forEach(t=>{null!=e[t]&&ehe(n,t,e[t])})):zce.forEach(t=>{e.modified(t)&&ehe(n,t,e[t])}),null!=e.pointRadius&&n.path.pointRadius(e.pointRadius),e.fit&&function(e,t){const n=function(e){return 1===(e=EX(e)).length?e[0]:{type:Vde,features:e.reduce((e,t)=>e.concat(function(e){return e.type===Vde?e.features:EX(e).filter(e=>null!=e).map(e=>e.type===Wde?e:{type:Wde,geometry:e})}(t)),[])}}(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});var nhe=function(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i};function rhe(e){return e[0]}function ihe(e){return e[1]}function ahe(e,t,n){var r=new ohe(null==t?rhe:t,null==n?ihe:n,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}function ohe(e,t,n,r,i,a){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=a,this._root=void 0}function she(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var lhe=ahe.prototype=ohe.prototype;lhe.copy=function(){var e,t,n=new ohe(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=she(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var i=0;i<4;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(4)}):r.target[i]=she(t));return n},lhe.add=function(e){var t=+this._x.call(null,e),n=+this._y.call(null,e);return the(this.cover(t,n),t,n,e)},lhe.addAll=function(e){var t,n,r,i,a=e.length,o=new Array(a),s=new Array(a),l=1/0,u=1/0,c=-1/0,d=-1/0;for(n=0;n<a;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||(o[n]=r,s[n]=i,r<l&&(l=r),r>c&&(c=r),i<u&&(u=i),i>d&&(d=i));if(l>c||u>d)return this;for(this.cover(l,u).cover(c,d),n=0;n<a;++n)the(this,o[n],s[n],e[n]);return this},lhe.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,a=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,a=(r=Math.floor(t))+1;else{for(var o,s,l=i-n,u=this._root;n>e||e>=i||r>t||t>=a;)switch(s=(t<r)<<1|e<n,(o=new Array(4))[s]=u,u=o,l*=2,s){case 0:i=n+l,a=r+l;break;case 1:n=i-l,a=r+l;break;case 2:i=n+l,r=a-l;break;case 3:n=i-l,r=a-l}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=r,this._x1=i,this._y1=a,this},lhe.data=function(){var e=[];return this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)})),e},lhe.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},lhe.find=function(e,t,n){var r,i,a,o,s,l,u,c=this._x0,d=this._y0,h=this._x1,f=this._y1,p=[],m=this._root;for(m&&p.push(new nhe(m,c,d,h,f)),null==n?n=1/0:(c=e-n,d=t-n,h=e+n,f=t+n,n*=n);l=p.pop();)if(!(!(m=l.node)||(i=l.x0)>h||(a=l.y0)>f||(o=l.x1)<c||(s=l.y1)<d))if(m.length){var g=(i+o)/2,v=(a+s)/2;p.push(new nhe(m[3],g,v,o,s),new nhe(m[2],i,v,g,s),new nhe(m[1],g,a,o,v),new nhe(m[0],i,a,g,v)),(u=(t>=v)<<1|e>=g)&&(l=p[p.length-1],p[p.length-1]=p[p.length-1-u],p[p.length-1-u]=l)}else{var y=e-+this._x.call(null,m.data),b=t-+this._y.call(null,m.data),x=y*y+b*b;if(x<n){var w=Math.sqrt(n=x);c=e-w,d=t-w,h=e+w,f=t+w,r=m.data}}return r},lhe.remove=function(e){if(isNaN(a=+this._x.call(null,e))||isNaN(o=+this._y.call(null,e)))return this;var t,n,r,i,a,o,s,l,u,c,d,h,f=this._root,p=this._x0,m=this._y0,g=this._x1,v=this._y1;if(!f)return this;if(f.length)for(;;){if((u=a>=(s=(p+g)/2))?p=s:g=s,(c=o>=(l=(m+v)/2))?m=l:v=l,t=f,!(f=f[d=c<<1|u]))return this;if(!f.length)break;(t[d+1&3]||t[d+2&3]||t[d+3&3])&&(n=t,h=d)}for(;f.data!==e;)if(r=f,!(f=f.next))return this;return(i=f.next)&&delete f.next,r?(i?r.next=i:delete r.next,this):t?(i?t[d]=i:delete t[d],(f=t[0]||t[1]||t[2]||t[3])&&f===(t[3]||t[2]||t[1]||t[0])&&!f.length&&(n?n[h]=f:this._root=f),this):(this._root=i,this)},lhe.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},lhe.root=function(){return this._root},lhe.size=function(){var e=0;return this.visit((function(t){if(!t.length)do{++e}while(t=t.next)})),e},lhe.visit=function(e){var t,n,r,i,a,o,s=[],l=this._root;for(l&&s.push(new nhe(l,this._x0,this._y0,this._x1,this._y1));t=s.pop();)if(!e(l=t.node,r=t.x0,i=t.y0,a=t.x1,o=t.y1)&&l.length){var u=(r+a)/2,c=(i+o)/2;(n=l[3])&&s.push(new nhe(n,u,c,a,o)),(n=l[2])&&s.push(new nhe(n,r,c,u,o)),(n=l[1])&&s.push(new nhe(n,u,i,a,c)),(n=l[0])&&s.push(new nhe(n,r,i,u,c))}return this},lhe.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new nhe(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var a,o=t.x0,s=t.y0,l=t.x1,u=t.y1,c=(o+l)/2,d=(s+u)/2;(a=i[0])&&n.push(new nhe(a,o,s,c,d)),(a=i[1])&&n.push(new nhe(a,c,s,l,d)),(a=i[2])&&n.push(new nhe(a,o,d,c,u)),(a=i[3])&&n.push(new nhe(a,c,d,l,u))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},lhe.x=function(e){return arguments.length?(this._x=e,this):this._x},lhe.y=function(e){return arguments.length?(this._y=e,this):this._y};var uhe=function(e){return function(){return e}},che=function(e){return 1e-6*(e()-.5)};function dhe(e){return e.x+e.vx}function hhe(e){return e.y+e.vy}var fhe={value:function(){}};function phe(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new mhe(r)}function mhe(e){this._=e}function ghe(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function vhe(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function yhe(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=fhe,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}mhe.prototype=phe.prototype={constructor:mhe,on:function(e,t){var n,r=this._,i=ghe(e+"",r),a=-1,o=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<o;)if(n=(e=i[a]).type)r[n]=yhe(r[n],e.name,t);else if(null==t)for(n in r)r[n]=yhe(r[n],e.name,null);return this}for(;++a<o;)if((n=(e=i[a]).type)&&(n=vhe(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new mhe(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),a=0;a<n;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=0,n=(r=this._[e]).length;a<n;++a)r[a].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};var bhe,xhe,whe=phe,_he=0,She=0,Ehe=0,The=0,khe=0,Che=0,Ihe="object"==typeof performance&&performance.now?performance:Date,Ohe="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Ahe(){return khe||(Ohe(Dhe),khe=Ihe.now()+Che)}function Dhe(){khe=0}function Mhe(){this._call=this._time=this._next=null}function Nhe(e,t,n){var r=new Mhe;return r.restart(e,t,n),r}function jhe(){khe=(The=Ihe.now())+Che,_he=She=0;try{!function(){Ahe(),++_he;for(var e,t=bhe;t;)(e=khe-t._time)>=0&&t._call.call(null,e),t=t._next;--_he}()}finally{_he=0,function(){for(var e,t,n=bhe,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:bhe=t);xhe=e,Phe(r)}(),khe=0}}function Rhe(){var e=Ihe.now(),t=e-The;t>1e3&&(Che-=t,The=e)}function Phe(e){_he||(She&&(She=clearTimeout(She)),e-khe>24?(e<1/0&&(She=setTimeout(jhe,e-Ihe.now()-Che)),Ehe&&(Ehe=clearInterval(Ehe))):(Ehe||(The=Ihe.now(),Ehe=setInterval(Rhe,1e3)),_he=1,Ohe(jhe)))}Mhe.prototype=Nhe.prototype={constructor:Mhe,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?Ahe():+n)+(null==t?0:+t),this._next||xhe===this||(xhe?xhe._next=this:bhe=this,xhe=this),this._call=e,this._time=n,Phe()},stop:function(){this._call&&(this._call=null,this._time=1/0,Phe())}};const Fhe=4294967296;function Lhe(e){return e.x}function $he(e){return e.y}var Bhe=Math.PI*(3-Math.sqrt(5));function zhe(e){return e.index}function Uhe(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}const Hhe={center:function(e,t){var n,r=1;function i(){var i,a,o=n.length,s=0,l=0;for(i=0;i<o;++i)s+=(a=n[i]).x,l+=a.y;for(s=(s/o-e)*r,l=(l/o-t)*r,i=0;i<o;++i)(a=n[i]).x-=s,a.y-=l}return null==e&&(e=0),null==t&&(t=0),i.initialize=function(e){n=e},i.x=function(t){return arguments.length?(e=+t,i):e},i.y=function(e){return arguments.length?(t=+e,i):t},i.strength=function(e){return arguments.length?(r=+e,i):r},i},collide:function(e){var t,n,r,i=1,a=1;function o(){for(var e,o,l,u,c,d,h,f=t.length,p=0;p<a;++p)for(o=ahe(t,dhe,hhe).visitAfter(s),e=0;e<f;++e)h=(d=n[(l=t[e]).index])*d,u=l.x+l.vx,c=l.y+l.vy,o.visit(m);function m(e,t,n,a,o){var s=e.data,f=e.r,p=d+f;if(!s)return t>u+p||a<u-p||n>c+p||o<c-p;if(s.index>l.index){var m=u-s.x-s.vx,g=c-s.y-s.vy,v=m*m+g*g;v<p*p&&(0===m&&(v+=(m=che(r))*m),0===g&&(v+=(g=che(r))*g),v=(p-(v=Math.sqrt(v)))/v*i,l.vx+=(m*=v)*(p=(f*=f)/(h+f)),l.vy+=(g*=v)*p,s.vx-=m*(p=1-p),s.vy-=g*p)}}}function s(e){if(e.data)return e.r=n[e.data.index];for(var t=e.r=0;t<4;++t)e[t]&&e[t].r>e.r&&(e.r=e[t].r)}function l(){if(t){var r,i,a=t.length;for(n=new Array(a),r=0;r<a;++r)n[(i=t[r]).index]=+e(i,r,t)}}return"function"!=typeof e&&(e=uhe(null==e?1:+e)),o.initialize=function(e,n){t=e,r=n,l()},o.iterations=function(e){return arguments.length?(a=+e,o):a},o.strength=function(e){return arguments.length?(i=+e,o):i},o.radius=function(t){return arguments.length?(e="function"==typeof t?t:uhe(+t),l(),o):e},o},nbody:function(){var e,t,n,r,i,a=uhe(-30),o=1,s=1/0,l=.81;function u(n){var i,a=e.length,o=ahe(e,Lhe,$he).visitAfter(d);for(r=n,i=0;i<a;++i)t=e[i],o.visit(h)}function c(){if(e){var t,n,r=e.length;for(i=new Array(r),t=0;t<r;++t)i[(n=e[t]).index]=+a(n,t,e)}}function d(e){var t,n,r,a,o,s=0,l=0;if(e.length){for(r=a=o=0;o<4;++o)(t=e[o])&&(n=Math.abs(t.value))&&(s+=t.value,l+=n,r+=n*t.x,a+=n*t.y);e.x=r/l,e.y=a/l}else{(t=e).x=t.data.x,t.y=t.data.y;do{s+=i[t.data.index]}while(t=t.next)}e.value=s}function h(e,a,u,c){if(!e.value)return!0;var d=e.x-t.x,h=e.y-t.y,f=c-a,p=d*d+h*h;if(f*f/l<p)return p<s&&(0===d&&(p+=(d=che(n))*d),0===h&&(p+=(h=che(n))*h),p<o&&(p=Math.sqrt(o*p)),t.vx+=d*e.value*r/p,t.vy+=h*e.value*r/p),!0;if(!(e.length||p>=s)){(e.data!==t||e.next)&&(0===d&&(p+=(d=che(n))*d),0===h&&(p+=(h=che(n))*h),p<o&&(p=Math.sqrt(o*p)));do{e.data!==t&&(t.vx+=d*(f=i[e.data.index]*r/p),t.vy+=h*f)}while(e=e.next)}}return u.initialize=function(t,r){e=t,n=r,c()},u.strength=function(e){return arguments.length?(a="function"==typeof e?e:uhe(+e),c(),u):a},u.distanceMin=function(e){return arguments.length?(o=e*e,u):Math.sqrt(o)},u.distanceMax=function(e){return arguments.length?(s=e*e,u):Math.sqrt(s)},u.theta=function(e){return arguments.length?(l=e*e,u):Math.sqrt(l)},u},link:function(e){var t,n,r,i,a,o,s=zhe,l=function(e){return 1/Math.min(i[e.source.index],i[e.target.index])},u=uhe(30),c=1;function d(r){for(var i=0,s=e.length;i<c;++i)for(var l,u,d,h,f,p,m,g=0;g<s;++g)h=(d=(l=e[g]).target).x+d.vx-(u=l.source).x-u.vx||che(o),f=d.y+d.vy-u.y-u.vy||che(o),f*=p=((p=Math.sqrt(h*h+f*f))-n[g])/p*r*t[g],d.vx-=(h*=p)*(m=a[g]),d.vy-=f*m,u.vx+=h*(m=1-m),u.vy+=f*m}function h(){if(r){var o,l,u=r.length,c=e.length,d=new Map(r.map((e,t)=>[s(e,t,r),e]));for(o=0,i=new Array(u);o<c;++o)(l=e[o]).index=o,"object"!=typeof l.source&&(l.source=Uhe(d,l.source)),"object"!=typeof l.target&&(l.target=Uhe(d,l.target)),i[l.source.index]=(i[l.source.index]||0)+1,i[l.target.index]=(i[l.target.index]||0)+1;for(o=0,a=new Array(c);o<c;++o)a[o]=i[(l=e[o]).source.index]/(i[l.source.index]+i[l.target.index]);t=new Array(c),f(),n=new Array(c),p()}}function f(){if(r)for(var n=0,i=e.length;n<i;++n)t[n]=+l(e[n],n,e)}function p(){if(r)for(var t=0,i=e.length;t<i;++t)n[t]=+u(e[t],t,e)}return null==e&&(e=[]),d.initialize=function(e,t){r=e,o=t,h()},d.links=function(t){return arguments.length?(e=t,h(),d):e},d.id=function(e){return arguments.length?(s=e,d):s},d.iterations=function(e){return arguments.length?(c=+e,d):c},d.strength=function(e){return arguments.length?(l="function"==typeof e?e:uhe(+e),f(),d):l},d.distance=function(e){return arguments.length?(u="function"==typeof e?e:uhe(+e),p(),d):u},d},x:function(e){var t,n,r,i=uhe(.1);function a(e){for(var i,a=0,o=t.length;a<o;++a)(i=t[a]).vx+=(r[a]-i.x)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=uhe(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:uhe(+e),o(),a):i},a.x=function(t){return arguments.length?(e="function"==typeof t?t:uhe(+t),o(),a):e},a},y:function(e){var t,n,r,i=uhe(.1);function a(e){for(var i,a=0,o=t.length;a<o;++a)(i=t[a]).vy+=(r[a]-i.y)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=uhe(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:uhe(+e),o(),a):i},a.y=function(t){return arguments.length?(e="function"==typeof t?t:uhe(+t),o(),a):e},a}},Whe="forces",Vhe=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],qhe=["static","iterations"],Ghe=["x","y","vx","vy"];function Yhe(e){q1.call(this,null,e)}function Xhe(e,t,n,r){var i,a,o,s,l=EX(t.forces);for(i=0,a=Vhe.length;i<a;++i)(o=Vhe[i])!==Whe&&t.modified(o)&&e[o](t[o]);for(i=0,a=l.length;i<a;++i)s=Whe+i,(o=n||t.modified(Whe,i)?Zhe(l[i]):r&&Khe(l[i],r)?e.force(s):null)&&e.force(s,o);for(a=e.numForces||0;i<a;++i)e.force(Whe+i,null);return e.numForces=l.length,e}function Khe(e,t){var n,r;for(n in e)if(kX(r=e[n])&&t.modified(NY(r)))return 1;return 0}function Zhe(e){var t,n;for(n in LX(Hhe,e.force)||FY("Unrecognized force: "+e.force),t=Hhe[e.force](),e)kX(t[n])&&Jhe(t[n],e[n],e);return t}function Jhe(e,t,n){e(kX(t)?e=>t(e,n):t)}function Qhe(e){var t=0,n=e.children,r=n&&n.length;if(r)for(;--r>=0;)t+=n[r].value;else t=1;e.value=t}function efe(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=nfe)):void 0===t&&(t=tfe);for(var n,r,i,a,o,s=new afe(e),l=[s];n=l.pop();)if((i=t(n.data))&&(o=(i=Array.from(i)).length))for(n.children=i,a=o-1;a>=0;--a)l.push(r=i[a]=new afe(i[a])),r.parent=n,r.depth=n.depth+1;return s.eachBefore(ife)}function tfe(e){return e.children}function nfe(e){return Array.isArray(e)?e[1]:null}function rfe(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function ife(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function afe(e){this.data=e,this.depth=this.height=0,this.parent=null}function ofe(e,t){var n,r;if(ufe(t,e))return[t];for(n=0;n<e.length;++n)if(sfe(t,e[n])&&ufe(dfe(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(r=n+1;r<e.length;++r)if(sfe(dfe(e[n],e[r]),t)&&sfe(dfe(e[n],t),e[r])&&sfe(dfe(e[r],t),e[n])&&ufe(hfe(e[n],e[r],t),e))return[e[n],e[r],t];throw new Error}function sfe(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function lfe(e,t){var n=e.r-t.r+1e-9*Math.max(e.r,t.r,1),r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function ufe(e,t){for(var n=0;n<t.length;++n)if(!lfe(e,t[n]))return!1;return!0}function cfe(e){switch(e.length){case 1:return{x:(t=e[0]).x,y:t.y,r:t.r};case 2:return dfe(e[0],e[1]);case 3:return hfe(e[0],e[1],e[2])}var t}function dfe(e,t){var n=e.x,r=e.y,i=e.r,a=t.x,o=t.y,s=t.r,l=a-n,u=o-r,c=s-i,d=Math.sqrt(l*l+u*u);return{x:(n+a+l/d*c)/2,y:(r+o+u/d*c)/2,r:(d+i+s)/2}}function hfe(e,t,n){var r=e.x,i=e.y,a=e.r,o=t.x,s=t.y,l=t.r,u=n.x,c=n.y,d=n.r,h=r-o,f=r-u,p=i-s,m=i-c,g=l-a,v=d-a,y=r*r+i*i-a*a,b=y-o*o-s*s+l*l,x=y-u*u-c*c+d*d,w=f*p-h*m,_=(p*x-m*b)/(2*w)-r,S=(m*g-p*v)/w,E=(f*b-h*x)/(2*w)-i,T=(h*v-f*g)/w,k=S*S+T*T-1,C=2*(a+_*S+E*T),I=_*_+E*E-a*a,O=-(k?(C+Math.sqrt(C*C-4*k*I))/(2*k):I/C);return{x:r+_+S*O,y:i+E+T*O,r:O}}function ffe(e,t,n){var r,i,a,o,s=e.x-t.x,l=e.y-t.y,u=s*s+l*l;u?(i=t.r+n.r,o=e.r+n.r,(i*=i)>(o*=o)?(r=(u+o-i)/(2*u),a=Math.sqrt(Math.max(0,o/u-r*r)),n.x=e.x-r*s-a*l,n.y=e.y-r*l+a*s):(r=(u+i-o)/(2*u),a=Math.sqrt(Math.max(0,i/u-r*r)),n.x=t.x+r*s-a*l,n.y=t.y+r*l+a*s)):(n.x=t.x+n.r,n.y=t.y)}function pfe(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function mfe(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,a=(t.y*n.r+n.y*t.r)/r;return i*i+a*a}function gfe(e){this._=e,this.next=null,this.previous=null}function vfe(e){return null==e?null:yfe(e)}function yfe(e){if("function"!=typeof e)throw new Error;return e}function bfe(){return 0}Yhe.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:Ghe}]},UX(Yhe,q1,{transform(e,t){var n,r,i=this.value,a=t.changed(t.ADD_REM),o=e.modified(Vhe),s=e.iterations||300;if(i?(a&&(t.modifies("index"),i.nodes(t.source)),(o||t.changed(t.MOD))&&Xhe(i,e,0,t)):(this.value=i=function(e,t){const n=function(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),a=0,o=.6,s=new Map,l=Nhe(d),u=whe("tick","end"),c=function(){let e=1;return()=>(e=(1664525*e+1013904223)%Fhe)/Fhe}();function d(){h(),u.call("tick",t),n<r&&(l.stop(),u.call("end",t))}function h(r){var l,u,c=e.length;void 0===r&&(r=1);for(var d=0;d<r;++d)for(n+=(a-n)*i,s.forEach((function(e){e(n)})),l=0;l<c;++l)null==(u=e[l]).fx?u.x+=u.vx*=o:(u.x=u.fx,u.vx=0),null==u.fy?u.y+=u.vy*=o:(u.y=u.fy,u.vy=0);return t}function f(){for(var t,n=0,r=e.length;n<r;++n){if((t=e[n]).index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var i=10*Math.sqrt(.5+n),a=n*Bhe;t.x=i*Math.cos(a),t.y=i*Math.sin(a)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function p(t){return t.initialize&&t.initialize(e,c),t}return null==e&&(e=[]),f(),t={tick:h,restart:function(){return l.restart(d),t},stop:function(){return l.stop(),t},nodes:function(n){return arguments.length?(e=n,f(),s.forEach(p),t):e},alpha:function(e){return arguments.length?(n=+e,t):n},alphaMin:function(e){return arguments.length?(r=+e,t):r},alphaDecay:function(e){return arguments.length?(i=+e,t):+i},alphaTarget:function(e){return arguments.length?(a=+e,t):a},velocityDecay:function(e){return arguments.length?(o=1-e,t):1-o},randomSource:function(e){return arguments.length?(c=e,s.forEach(p),t):c},force:function(e,n){return arguments.length>1?(null==n?s.delete(e):s.set(e,p(n)),t):s.get(e)},find:function(t,n,r){var i,a,o,s,l,u=0,c=e.length;for(null==r?r=1/0:r*=r,u=0;u<c;++u)(o=(i=t-(s=e[u]).x)*i+(a=n-s.y)*a)<r&&(l=s,r=o);return l},on:function(e,n){return arguments.length>1?(u.on(e,n),t):u.on(e)}}}(e),r=n.stop,i=n.restart;let a=!1;return n.stopped=()=>a,n.restart=()=>(a=!1,i()),n.stop=()=>(a=!0,r()),Xhe(n,t,!0).on("end",()=>a=!0)}(t.source,e),i.on("tick",(n=t.dataflow,r=this,()=>n.touch(r).run())),e.static||(a=!0,i.tick()),t.modifies("index")),o||a||e.modified(qhe)||t.changed()&&e.restart)if(i.alpha(Math.max(i.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(i.alphaMin(),1/s)),e.static)for(i.stop();--s>=0;)i.tick();else if(i.stopped()&&i.restart(),!a)return t.StopPropagation;return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let s,l=this._argops,u=0,c=l.length;u<c;++u)if(s=l[u],s.name===Whe&&"link"===s.op._argval.force)for(var r,i=s.op._argops,a=0,o=i.length;a<o;++a)if("links"===i[a].name&&(r=i[a].op.source)){n.pulse(r,n.changeset().reflow());break}return t.reflow(e.modified()).modifies(Ghe)}}),afe.prototype=efe.prototype={constructor:afe,count:function(){return this.eachAfter(Qhe)},each:function(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this},eachAfter:function(e,t){for(var n,r,i,a=this,o=[a],s=[],l=-1;a=o.pop();)if(s.push(a),n=a.children)for(r=0,i=n.length;r<i;++r)o.push(n[r]);for(;a=s.pop();)e.call(t,a,++l,this);return this},eachBefore:function(e,t){for(var n,r,i=this,a=[i],o=-1;i=a.pop();)if(e.call(t,i,++o,this),n=i.children)for(r=n.length-1;r>=0;--r)a.push(n[r]);return this},find:function(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r},sum:function(e){return this.eachAfter((function(t){for(var n=+e(t.data)||0,r=t.children,i=r&&r.length;--i>=0;)n+=r[i].value;t.value=n}))},sort:function(e){return this.eachBefore((function(t){t.children&&t.children.sort(e)}))},path:function(e){for(var t=this,n=function(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),i=null;for(e=n.pop(),t=r.pop();e===t;)i=e,e=n.pop(),t=r.pop();return i}(t,e),r=[t];t!==n;)r.push(t=t.parent);for(var i=r.length;e!==n;)r.splice(i,0,e),e=e.parent;return r},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore((function(t){t.children||e.push(t)})),e},links:function(){var e=this,t=[];return e.each((function(n){n!==e&&t.push({source:n.parent,target:n})})),t},copy:function(){return efe(this).eachBefore(rfe)},[Symbol.iterator]:function*(){var e,t,n,r,i=this,a=[i];do{for(e=a.reverse(),a=[];i=e.pop();)if(yield i,t=i.children)for(n=0,r=t.length;n<r;++n)a.push(t[n])}while(a.length)}};var xfe=function(e){return function(){return e}};function wfe(e){return Math.sqrt(e.value)}function _fe(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function Sfe(e,t){return function(n){if(r=n.children){var r,i,a,o=r.length,s=e(n)*t||0;if(s)for(i=0;i<o;++i)r[i].r+=s;if(a=function(e){if(!(a=(t=e,e="object"==typeof t&&"length"in t?t:Array.from(t)).length))return 0;var t,n,r,i,a,o,s,l,u,c,d,h;if((n=e[0]).x=0,n.y=0,!(a>1))return n.r;if(n.x=-(r=e[1]).r,r.x=n.r,r.y=0,!(a>2))return n.r+r.r;ffe(r,n,i=e[2]),n=new gfe(n),r=new gfe(r),i=new gfe(i),n.next=i.previous=r,r.next=n.previous=i,i.next=r.previous=n;e:for(l=3;l<a;++l){ffe(n._,r._,i=e[l]),i=new gfe(i),u=r.next,c=n.previous,d=r._.r,h=n._.r;do{if(d<=h){if(pfe(u._,i._)){n.next=r=u,r.previous=n,--l;continue e}d+=u._.r,u=u.next}else{if(pfe(c._,i._)){(n=c).next=r,r.previous=n,--l;continue e}h+=c._.r,c=c.previous}}while(u!==c.next);for(i.previous=n,i.next=r,n.next=r.previous=r=i,o=mfe(n);(i=i.next)!==r;)(s=mfe(i))<o&&(n=i,o=s);r=n.next}for(n=[r._],i=r;(i=i.next)!==r;)n.push(i._);for(i=function(e){for(var t,n,r=0,i=(e=function(e){for(var t,n,r=e.length;r;)n=Math.random()*r--|0,t=e[r],e[r]=e[n],e[n]=t;return e}(Array.from(e))).length,a=[];r<i;)t=e[r],n&&lfe(n,t)?++r:(n=cfe(a=ofe(a,t)),r=0);return n}(n),l=0;l<a;++l)(n=e[l]).x-=i.x,n.y-=i.y;return i.r}(r),s)for(i=0;i<o;++i)r[i].r-=s;n.r=a+s}}}function Efe(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}var Tfe=function(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)},kfe=function(e,t,n,r,i){for(var a,o=e.children,s=-1,l=o.length,u=e.value&&(r-t)/e.value;++s<l;)(a=o[s]).y0=n,a.y1=i,a.x0=t,a.x1=t+=a.value*u},Cfe={depth:-1},Ife={};function Ofe(e){return e.id}function Afe(e){return e.parentId}var Dfe=function(){var e=Ofe,t=Afe;function n(n){var r,i,a,o,s,l,u,c=Array.from(n),d=c.length,h=new Map;for(i=0;i<d;++i)s=c[i]=new afe(r=c[i]),null!=(l=e(r,i,n))&&(l+="")&&(u=s.id=l,h.set(u,h.has(u)?Ife:s)),null!=(l=t(r,i,n))&&(l+="")&&(s.parent=l);for(i=0;i<d;++i)if(l=(s=c[i]).parent){if(!(o=h.get(l)))throw new Error("missing: "+l);if(o===Ife)throw new Error("ambiguous: "+l);o.children?o.children.push(s):o.children=[s],s.parent=o}else{if(a)throw new Error("multiple roots");a=s}if(!a)throw new Error("no root");if(a.parent=Cfe,a.eachBefore((function(e){e.depth=e.parent.depth+1,--d})).eachBefore(ife),a.parent=null,d>0)throw new Error("cycle");return a}return n.id=function(t){return arguments.length?(e=yfe(t),n):e},n.parentId=function(e){return arguments.length?(t=yfe(e),n):t},n};function Mfe(e,t){return e.parent===t.parent?1:2}function Nfe(e){var t=e.children;return t?t[0]:e.t}function jfe(e){var t=e.children;return t?t[t.length-1]:e.t}function Rfe(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function Pfe(e,t,n){return e.a.parent===t.parent?e.a:n}function Ffe(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function Lfe(e,t){return e.parent===t.parent?1:2}function $fe(e,t){return e+t.x}function Bfe(e,t){return Math.max(e,t.y)}Ffe.prototype=Object.create(afe.prototype);var zfe=function(e,t,n,r,i){for(var a,o=e.children,s=-1,l=o.length,u=e.value&&(i-n)/e.value;++s<l;)(a=o[s]).x0=t,a.x1=r,a.y0=n,a.y1=n+=a.value*u},Ufe=(1+Math.sqrt(5))/2;function Hfe(e,t,n,r,i,a){for(var o,s,l,u,c,d,h,f,p,m,g,v=[],y=t.children,b=0,x=0,w=y.length,_=t.value;b<w;){l=i-n,u=a-r;do{c=y[x++].value}while(!c&&x<w);for(d=h=c,g=c*c*(m=Math.max(u/l,l/u)/(_*e)),p=Math.max(h/g,g/d);x<w;++x){if(c+=s=y[x].value,s<d&&(d=s),s>h&&(h=s),g=c*c*m,(f=Math.max(h/g,g/d))>p){c-=s;break}p=f}v.push(o={value:c,dice:l<u,children:y.slice(b,x)}),o.dice?kfe(o,n,r,i,_?r+=u*c/_:a):zfe(o,n,r,_?n+=l*c/_:i,a),_-=c,b=x}return v}var Wfe=function e(t){function n(e,n,r,i,a){Hfe(t,e,n,r,i,a)}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(Ufe),Vfe=function e(t){function n(e,n,r,i,a){if((o=e._squarify)&&o.ratio===t)for(var o,s,l,u,c,d=-1,h=o.length,f=e.value;++d<h;){for(l=(s=o[d]).children,u=s.value=0,c=l.length;u<c;++u)s.value+=l[u].value;s.dice?kfe(s,n,r,i,f?r+=(a-r)*s.value/f:a):zfe(s,n,r,f?n+=(i-n)*s.value/f:i,a),f-=s.value}else e._squarify=o=Hfe(t,e,n,r,i,a),o.ratio=t}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(Ufe);function qfe(e,t,n){const r={};return e.each(e=>{const i=e.data;n(i)&&(r[t(i)]=e)}),e.lookup=r,e}function Gfe(e){q1.call(this,null,e)}Gfe.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const Yfe=e=>e.values;function Xfe(){const e=[],t={entries:t=>function t(n,r){if(++r>e.length)return n;const i=[];for(const e in n)i.push({key:e,values:t(n[e],r)});return i}(function t(n,r){if(r>=e.length)return n;const i=n.length,a=e[r++],o={},s={};let l,u,c,d=-1;for(;++d<i;)l=a(u=n[d])+"",(c=o[l])?c.push(u):o[l]=[u];for(l in o)s[l]=t(o[l],r);return s}(t,0),0),key:n=>(e.push(n),t)};return t}function Kfe(e){q1.call(this,null,e)}UX(Gfe,q1,{transform(e,t){t.source||FY("Nest transform requires an upstream data source.");var n=e.generate,r=e.modified(),i=t.clone(),a=this.value;return(!a||r||t.changed())&&(a&&a.each(e=>{e.children&&f1(e.data)&&i.rem.push(e.data)}),this.value=a=efe({values:EX(e.keys).reduce((e,t)=>(e.key(t),e),Xfe()).entries(i.source)},Yfe),n&&a.each(e=>{e.children&&(e=g1(e.data),i.add.push(e),i.source.push(e))}),qfe(a,p1,p1)),i.source.root=a,i}});const Zfe=(e,t)=>e.parent===t.parent?1:2;UX(Kfe,q1,{transform(e,t){t.source&&t.source.root||FY(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),r=this.fields,i=t.source.root,a=e.as||r;e.field?i.sum(e.field):i.count(),e.sort&&i.sort(x1(e.sort,e=>e.data)),function(e,t,n){for(let r,i=0,a=t.length;i<a;++i)r=t[i],r in n&&e[r](n[r])}(n,this.params,e),n.separation&&n.separation(!1!==e.separation?Zfe:HY);try{this.value=n(i)}catch(rBe){FY(rBe)}return i.each(e=>function(e,t,n){const r=e.data,i=t.length-1;for(let a=0;a<i;++a)r[n[a]]=e[t[a]];r[n[i]]=e.children?e.children.length:0}(e,r,a)),t.reflow(e.modified()).modifies(a).modifies("leaf")}});const Jfe=["x","y","r","depth","children"];function Qfe(e){Kfe.call(this,e)}Qfe.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:Jfe.length,default:Jfe}]},UX(Qfe,Kfe,{layout:function(){var e=null,t=1,n=1,r=bfe;function i(i){return i.x=t/2,i.y=n/2,e?i.eachBefore(_fe(e)).eachAfter(Sfe(r,.5)).eachBefore(Efe(1)):i.eachBefore(_fe(wfe)).eachAfter(Sfe(bfe,1)).eachAfter(Sfe(r,i.r/Math.min(t,n))).eachBefore(Efe(Math.min(t,n)/(2*i.r))),i}return i.radius=function(t){return arguments.length?(e=vfe(t),i):e},i.size=function(e){return arguments.length?(t=+e[0],n=+e[1],i):[t,n]},i.padding=function(e){return arguments.length?(r="function"==typeof e?e:xfe(+e),i):r},i},params:["radius","size","padding"],fields:Jfe});const epe=["x0","y0","x1","y1","depth","children"];function tpe(e){Kfe.call(this,e)}function npe(e){q1.call(this,null,e)}tpe.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:epe.length,default:epe}]},UX(tpe,Kfe,{layout:function(){var e=1,t=1,n=0,r=!1;function i(i){var a=i.height+1;return i.x0=i.y0=n,i.x1=e,i.y1=t/a,i.eachBefore(function(e,t){return function(r){r.children&&kfe(r,r.x0,e*(r.depth+1)/t,r.x1,e*(r.depth+2)/t);var i=r.x0,a=r.y0,o=r.x1-n,s=r.y1-n;o<i&&(i=o=(i+o)/2),s<a&&(a=s=(a+s)/2),r.x0=i,r.y0=a,r.x1=o,r.y1=s}}(t,a)),r&&i.eachBefore(Tfe),i}return i.round=function(e){return arguments.length?(r=!!e,i):r},i.size=function(n){return arguments.length?(e=+n[0],t=+n[1],i):[e,t]},i.padding=function(e){return arguments.length?(n=+e,i):n},i},params:["size","round","padding"],fields:epe}),npe.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},UX(npe,q1,{transform(e,t){t.source||FY("Stratify transform requires an upstream data source.");let n=this.value;const r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),a=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return i.source=i.source.slice(),a&&(n=i.source.length?qfe(Dfe().id(e.key).parentId(e.parentKey)(i.source),e.key,WY):qfe(Dfe()([{}]),e.key,e.key)),i.source.root=this.value=n,i}});const rpe={tidy:function(){var e=Mfe,t=1,n=1,r=null;function i(i){var l=function(e){for(var t,n,r,i,a,o=new Ffe(e,0),s=[o];t=s.pop();)if(r=t._.children)for(t.children=new Array(a=r.length),i=a-1;i>=0;--i)s.push(n=t.children[i]=new Ffe(r[i],i)),n.parent=t;return(o.parent=new Ffe(null,0)).children=[o],o}(i);if(l.eachAfter(a),l.parent.m=-l.z,l.eachBefore(o),r)i.eachBefore(s);else{var u=i,c=i,d=i;i.eachBefore((function(e){e.x<u.x&&(u=e),e.x>c.x&&(c=e),e.depth>d.depth&&(d=e)}));var h=u===c?1:e(u,c)/2,f=h-u.x,p=t/(c.x+h+f),m=n/(d.depth||1);i.eachBefore((function(e){e.x=(e.x+f)*p,e.y=e.depth*m}))}return i}function a(t){var n=t.children,r=t.parent.children,i=t.i?r[t.i-1]:null;if(n){!function(e){for(var t,n=0,r=0,i=e.children,a=i.length;--a>=0;)(t=i[a]).z+=n,t.m+=n,n+=t.s+(r+=t.c)}(t);var a=(n[0].z+n[n.length-1].z)/2;i?(t.z=i.z+e(t._,i._),t.m=t.z-a):t.z=a}else i&&(t.z=i.z+e(t._,i._));t.parent.A=function(t,n,r){if(n){for(var i,a=t,o=t,s=n,l=a.parent.children[0],u=a.m,c=o.m,d=s.m,h=l.m;s=jfe(s),a=Nfe(a),s&&a;)l=Nfe(l),(o=jfe(o)).a=t,(i=s.z+d-a.z-u+e(s._,a._))>0&&(Rfe(Pfe(s,t,r),t,i),u+=i,c+=i),d+=s.m,u+=a.m,h+=l.m,c+=o.m;s&&!jfe(o)&&(o.t=s,o.m+=d-c),a&&!Nfe(l)&&(l.t=a,l.m+=u-h,r=t)}return r}(t,i,t.parent.A||r[0])}function o(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function s(e){e.x*=t,e.y=e.depth*n}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i},cluster:function(){var e=Lfe,t=1,n=1,r=!1;function i(i){var a,o=0;i.eachAfter((function(t){var n=t.children;n?(t.x=function(e){return e.reduce($fe,0)/e.length}(n),t.y=function(e){return 1+e.reduce(Bfe,0)}(n)):(t.x=a?o+=e(t,a):0,t.y=0,a=t)}));var s=function(e){for(var t;t=e.children;)e=t[0];return e}(i),l=function(e){for(var t;t=e.children;)e=t[t.length-1];return e}(i),u=s.x-e(s,l)/2,c=l.x+e(l,s)/2;return i.eachAfter(r?function(e){e.x=(e.x-i.x)*t,e.y=(i.y-e.y)*n}:function(e){e.x=(e.x-u)/(c-u)*t,e.y=(1-(i.y?e.y/i.y:1))*n})}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i}},ipe=["x","y","depth","children"];function ape(e){Kfe.call(this,e)}function ope(e){q1.call(this,[],e)}ape.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:ipe.length,default:ipe}]},UX(ape,Kfe,{layout(e){const t=e||"tidy";if(LX(rpe,t))return rpe[t]();FY("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:ipe}),ope.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},UX(ope,q1,{transform(e,t){const n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),a={};return r||FY("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(i.rem=n,t.visit(t.SOURCE,e=>a[p1(e)]=1),r.each(e=>{const t=e.data,n=e.parent&&e.parent.data;n&&a[p1(t)]&&a[p1(n)]&&i.add.push(g1({source:n,target:t}))}),this.value=i.add):t.changed(t.MOD)&&(t.visit(t.MOD,e=>a[p1(e)]=1),n.forEach(e=>{(a[p1(e.source)]||a[p1(e.target)])&&i.mod.push(e)})),i}});const spe={binary:function(e,t,n,r,i){var a,o,s=e.children,l=s.length,u=new Array(l+1);for(u[0]=o=a=0;a<l;++a)u[a+1]=o+=s[a].value;!function e(t,n,r,i,a,o,l){if(t>=n-1){var c=s[t];return c.x0=i,c.y0=a,c.x1=o,void(c.y1=l)}for(var d=u[t],h=r/2+d,f=t+1,p=n-1;f<p;){var m=f+p>>>1;u[m]<h?f=m+1:p=m}h-u[f-1]<u[f]-h&&t+1<f&&--f;var g=u[f]-d,v=r-g;if(o-i>l-a){var y=r?(i*v+o*g)/r:o;e(t,f,g,i,a,y,l),e(f,n,v,y,a,o,l)}else{var b=r?(a*v+l*g)/r:l;e(t,f,g,i,a,o,b),e(f,n,v,i,b,o,l)}}(0,l,e.value,t,n,r,i)},dice:kfe,slice:zfe,slicedice:function(e,t,n,r,i){(1&e.depth?zfe:kfe)(e,t,n,r,i)},squarify:Wfe,resquarify:Vfe},lpe=["x0","y0","x1","y1","depth","children"];function upe(e){Kfe.call(this,e)}function cpe(e){const t=y1(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=.0625,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}upe.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:lpe.length,default:lpe}]},UX(upe,Kfe,{layout(){const e=function(){var e=Wfe,t=!1,n=1,r=1,i=[0],a=bfe,o=bfe,s=bfe,l=bfe,u=bfe;function c(e){return e.x0=e.y0=0,e.x1=n,e.y1=r,e.eachBefore(d),i=[0],t&&e.eachBefore(Tfe),e}function d(t){var n=i[t.depth],r=t.x0+n,c=t.y0+n,d=t.x1-n,h=t.y1-n;d<r&&(r=d=(r+d)/2),h<c&&(c=h=(c+h)/2),t.x0=r,t.y0=c,t.x1=d,t.y1=h,t.children&&(n=i[t.depth+1]=a(t)/2,r+=u(t)-n,c+=o(t)-n,(d-=s(t)-n)<r&&(r=d=(r+d)/2),(h-=l(t)-n)<c&&(c=h=(c+h)/2),e(t,r,c,d,h))}return c.round=function(e){return arguments.length?(t=!!e,c):t},c.size=function(e){return arguments.length?(n=+e[0],r=+e[1],c):[n,r]},c.tile=function(t){return arguments.length?(e=yfe(t),c):e},c.padding=function(e){return arguments.length?c.paddingInner(e).paddingOuter(e):c.paddingInner()},c.paddingInner=function(e){return arguments.length?(a="function"==typeof e?e:xfe(+e),c):a},c.paddingOuter=function(e){return arguments.length?c.paddingTop(e).paddingRight(e).paddingBottom(e).paddingLeft(e):c.paddingTop()},c.paddingTop=function(e){return arguments.length?(o="function"==typeof e?e:xfe(+e),c):o},c.paddingRight=function(e){return arguments.length?(s="function"==typeof e?e:xfe(+e),c):s},c.paddingBottom=function(e){return arguments.length?(l="function"==typeof e?e:xfe(+e),c):l},c.paddingLeft=function(e){return arguments.length?(u="function"==typeof e?e:xfe(+e),c):u},c}();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{LX(spe,t)?e.tile(spe[t]):FY("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:lpe});const dpe=31,hpe=new Uint32Array(33),fpe=new Uint32Array(33);fpe[0]=0,hpe[0]=~fpe[0];for(let iBe=1;iBe<=32;++iBe)fpe[iBe]=fpe[iBe-1]<<1|1,hpe[iBe]=~fpe[iBe];function ppe(e,t,n,r,i,a){let o=n/2;return e-o<0||e+o>i||t-(o=r/2)<0||t+o>a}function mpe(e,t,n,r,i,a,o,s){const l=i*a/(2*r),u=e(t-l),c=e(t+l),d=e(n-(a/=2)),h=e(n+a);return o.outOfBounds(u,d,c,h)||o.getRange(u,d,c,h)||s&&s.getRange(u,d,c,h)}const gpe=[-1,-1,1,1],vpe=[-1,1,-1,1],ype=["right","center","left"],bpe=["bottom","middle","top"];function xpe(e,t,n,r,i,a,o,s,l,u,c,d){return!(i.outOfBounds(e,n,t,r)||(d&&a?a.getRange(e,n,t,r)||!function(e,t,n,r,i){return i[0]<=e&&n<=i[2]&&i[3]<=t&&r<=i[5]}(o,l,s,u,c):i.getRange(e,n,t,r)))}const wpe={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},_pe={naive:function(e,t,n,r){const i=e.width,a=e.height;return function(e){const t=e.datum.datum.items[r].items,n=t.length,o=e.datum.fontSize,s=aie.width(e.datum,e.datum.text);let l,u,c,d,h,f,p,m=0;for(let r=0;r<n;++r)l=t[r].x,c=t[r].y,u=void 0===t[r].x2?l:t[r].x2,d=void 0===t[r].y2?c:t[r].y2,h=(l+u)/2,f=(c+d)/2,p=Math.abs(u-l+d-c),p>=m&&(m=p,e.x=h,e.y=f);return h=s/2,f=o/2,l=e.x-h,u=e.x+h,c=e.y-f,d=e.y+f,e.align="center",l<0&&u<=i?e.align="left":0<=l&&i<u&&(e.align="right"),e.baseline="middle",c<0&&d<=a?e.baseline="top":0<=c&&a<d&&(e.baseline="bottom"),!0}},"reduced-search":function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1];function l(t,n,r,l,u){const c=e.invert(t),d=e.invert(n);let h,f=r,p=a;if(!ppe(c,d,l,u,i,a)&&!mpe(e,c,d,u,l,f,o,s)&&!mpe(e,c,d,u,l,u,o,null)){for(;p-f>=1;)h=(f+p)/2,mpe(e,c,d,u,l,h,o,s)?p=h:f=h;if(f>r)return[c,d,f,!0]}}return function(t){const s=t.datum.datum.items[r].items,u=s.length,c=t.datum.fontSize,d=aie.width(t.datum,t.datum.text);let h,f,p,m,g,v,y,b,x,w,_,S,E,T,k,C,I,O=n?c:0,A=!1,D=!1,M=0;for(let r=0;r<u;++r){for(h=s[r].x,p=s[r].y,f=void 0===s[r].x2?h:s[r].x2,m=void 0===s[r].y2?p:s[r].y2,h>f&&(I=h,h=f,f=I),p>m&&(I=p,p=m,m=I),x=e(h),_=e(f),w=~~((x+_)/2),S=e(p),T=e(m),E=~~((S+T)/2),y=w;y>=x;--y)for(b=E;b>=S;--b)C=l(y,b,O,d,c),C&&([t.x,t.y,O,A]=C);for(y=w;y<=_;++y)for(b=E;b<=T;++b)C=l(y,b,O,d,c),C&&([t.x,t.y,O,A]=C);A||n||(k=Math.abs(f-h+m-p),g=(h+f)/2,v=(p+m)/2,k>=M&&!ppe(g,v,d,c,i,a)&&!mpe(e,g,v,c,d,c,o,null)&&(M=k,t.x=g,t.y=v,D=!0))}return!(!A&&!D||(g=d/2,v=c/2,o.setRange(e(t.x-g),e(t.y-v),e(t.x+g),e(t.y+v)),t.align="center",t.baseline="middle",0))}},floodfill:function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1],l=e.bitmap();return function(t){const u=t.datum.datum.items[r].items,c=u.length,d=t.datum.fontSize,h=aie.width(t.datum,t.datum.text),f=[];let p,m,g,v,y,b,x,w,_,S,E,T,k=n?d:0,C=!1,I=!1,O=0;for(let r=0;r<c;++r){for(p=u[r].x,g=u[r].y,m=void 0===u[r].x2?p:u[r].x2,v=void 0===u[r].y2?g:u[r].y2,f.push([e((p+m)/2),e((g+v)/2)]);f.length;)if([x,w]=f.pop(),!(o.get(x,w)||s.get(x,w)||l.get(x,w))){l.set(x,w);for(let e=0;e<4;++e)y=x+gpe[e],b=w+vpe[e],l.outOfBounds(y,b,y,b)||f.push([y,b]);if(y=e.invert(x),b=e.invert(w),_=k,S=a,!ppe(y,b,h,d,i,a)&&!mpe(e,y,b,d,h,_,o,s)&&!mpe(e,y,b,d,h,d,o,null)){for(;S-_>=1;)E=(_+S)/2,mpe(e,y,b,d,h,E,o,s)?S=E:_=E;_>k&&(t.x=y,t.y=b,k=_,C=!0)}}C||n||(T=Math.abs(m-p+v-g),y=(p+m)/2,b=(g+v)/2,T>=O&&!ppe(y,b,h,d,i,a)&&!mpe(e,y,b,d,h,d,o,null)&&(O=T,t.x=y,t.y=b,I=!0))}return!(!C&&!I||(y=h/2,b=d/2,o.setRange(e(t.x-y),e(t.y-b),e(t.x+y),e(t.y+b)),t.align="center",t.baseline="middle",0))}}};const Spe=["x","y","opacity","align","baseline"],Epe=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function Tpe(e){q1.call(this,null,e)}function kpe(e,t){var n,r,i,a,o,s,l=[],u=function(e){return e(a)};if(null==t)l.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(s=n[o=t.map(u)])||(n[o]=s=[],s.dims=o,l.push(s)),s.push(a);return l}function Cpe(e){q1.call(this,null,e)}Tpe.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:Epe},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:Spe.length,default:Spe}]},UX(Tpe,q1,{transform(e,t){const n=e.modified();if(!(n||t.changed(t.ADD_REM)||function(n){const r=e.sort;return kX(r)&&t.modified(r.fields)}()))return;e.size&&2===e.size.length||FY("Size parameter should be specified as a [width, height] array.");const r=e.as||Spe;return function(e,t,n,r,i,a,o,s,l,u,c){if(!e.length)return e;const d=Math.max(r.length,i.length),h=function(e,t){const n=new Float64Array(t),r=e.length;for(let i=0;i<r;++i)n[i]=e[i]||0;for(let i=r;i<t;++i)n[i]=n[r-1];return n}(r,d),f=function(e,t){const n=new Int8Array(t),r=e.length;for(let i=0;i<r;++i)n[i]|=wpe[e[i]];for(let i=r;i<t;++i)n[i]=n[r-1];return n}(i,d),p=(x=e[0].datum)&&x.mark&&x.mark.marktype,m="group"===p&&e[0].datum.items[l].marktype,g="area"===m,v=function(e,t,n,r){const i=e=>[e.x,e.x,e.x,e.y,e.y,e.y];return e?"line"===e||"area"===e?e=>i(e.datum):"line"===t?e=>{const t=e.datum.items[r].items;return i(t.length?t["start"===n?0:t.length-1]:{x:NaN,y:NaN})}:e=>{const t=e.datum.bounds;return[t.x1,(t.x1+t.x2)/2,t.x2,t.y1,(t.y1+t.y2)/2,t.y2]}:i}(p,m,s,l),y=function(e,t,n){const r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),a=~~((t+2*n+r)/r),o=e=>~~((e+n)/r);return o.invert=e=>e*r-n,o.bitmap=()=>function(e,t){const n=new Uint32Array(~~((e*t+32)/32));function r(e,t){n[e]|=t}function i(e,t){n[e]&=t}return{array:n,get:(t,r)=>{const i=r*e+t;return n[i>>>5]&1<<(i&dpe)},set:(t,n)=>{const i=n*e+t;r(i>>>5,1<<(i&dpe))},clear:(t,n)=>{const r=n*e+t;i(r>>>5,~(1<<(r&dpe)))},getRange:(t,r,i,a)=>{let o,s,l,u,c=a;for(;c>=r;--c)if(o=c*e+t,s=c*e+i,l=o>>>5,u=s>>>5,l===u){if(n[l]&hpe[o&dpe]&fpe[1+(s&dpe)])return!0}else{if(n[l]&hpe[o&dpe])return!0;if(n[u]&fpe[1+(s&dpe)])return!0;for(let e=l+1;e<u;++e)if(n[e])return!0}return!1},setRange:(t,n,i,a)=>{let o,s,l,u,c;for(;n<=a;++n)if(o=n*e+t,s=n*e+i,l=o>>>5,u=s>>>5,l===u)r(l,hpe[o&dpe]&fpe[1+(s&dpe)]);else for(r(l,hpe[o&dpe]),r(u,fpe[1+(s&dpe)]),c=l+1;c<u;++c)r(c,4294967295)},clearRange:(t,n,r,a)=>{let o,s,l,u,c;for(;n<=a;++n)if(o=n*e+t,s=n*e+r,l=o>>>5,u=s>>>5,l===u)i(l,fpe[o&dpe]|hpe[1+(s&dpe)]);else for(i(l,fpe[o&dpe]),i(u,hpe[1+(s&dpe)]),c=l+1;c<u;++c)i(c,0)},outOfBounds:(n,r,i,a)=>n<0||r<0||a>=t||i>=e}}(i,a),o.ratio=r,o.padding=n,o.width=e,o.height=t,o}(t[0],t[1],u),b=g&&"naive"===c;var x;const w=e.map(e=>({datum:e,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:v(e)}));let _;if(!b){n&&w.sort((e,t)=>n(e.datum,t.datum));let t=!1;for(let e=0;e<f.length&&!t;++e)t=5===f[e]||h[e]<0;p&&(o||g)&&(a=[e.map(e=>e.datum)].concat(a)),_=a.length?function(e,t,n,r){const i=e.width,a=e.height,o=n||r,s=R4(i,a).getContext("2d");t.forEach(e=>function e(t,n,r){if(!n.length)return;const i=n[0].mark.marktype;"group"===i?n.forEach(n=>{n.items.forEach(n=>e(t,n.items,r))}):Sie[i].draw(t,{items:r?n.map(cpe):n})}(s,e,o));const l=new Uint32Array(s.getImageData(0,0,i,a).data.buffer),u=e.bitmap(),c=o&&e.bitmap();let d,h,f,p,m;for(h=0;h<a;++h)for(d=0;d<i;++d)m=4278190080&l[h*i+d],m&&(f=e(d),p=e(h),r||u.set(f,p),o&&268435456^m&&c.set(f,p));return[u,c]}(y,a,t,g):function(e,t){const n=e.bitmap();return(t||[]).forEach(t=>n.set(e(t.boundary[0]),e(t.boundary[3]))),[n,void 0]}(y,o&&w)}const S=g?_pe[c](y,_,o,l):function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1],l=r.length;return function(t){const u=t.boundary,c=t.datum.fontSize;if(u[2]<0||u[5]<0||u[0]>i||u[3]>a)return!1;let d,h,f,p,m,g,v,y,b,x,w,_,S,E,T,k=0;for(let i=0;i<l;++i){if(d=(3&n[i])-1,h=(n[i]>>>2&3)-1,f=0===d&&0===h||r[i]<0,p=d&&h?Math.SQRT1_2:1,m=r[i]<0?-1:1,g=u[1+d]+r[i]*d*p,w=u[4+h]+m*c*h/2+r[i]*h*p,y=w-c/2,b=w+c/2,_=e(g),E=e(y),T=e(b),!k){if(!xpe(_,_,E,T,o,s,g,g,y,b,u,f))continue;k=aie.width(t.datum,t.datum.text)}if(x=g+m*k*d/2,g=x-k/2,v=x+k/2,_=e(g),S=e(v),xpe(_,S,E,T,o,s,g,v,y,b,u,f))return t.x=d?d*m<0?v:g:x,t.y=h?h*m<0?b:y:w,t.align=ype[d*m+1],t.baseline=bpe[h*m+1],o.setRange(_,E,S,T),!0}return!1}}(y,_,f,h);return w.forEach(e=>e.opacity=+S(e)),w}(t.materialize(t.SOURCE).source,e.size,e.sort,EX(e.offset||1),EX(e.anchor||Epe),e.avoidMarks||[],!1!==e.avoidBaseMark,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach(e=>{const t=e.datum;t[r[0]]=e.x,t[r[1]]=e.y,t[r[2]]=e.opacity,t[r[3]]=e.align,t[r[4]]=e.baseline}),t.reflow(n).modifies(r)}}),Cpe.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},UX(Cpe,q1,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=kpe(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(MY),a=i.length,o=e.as||[MY(e.x),MY(e.y)],s=[];r.forEach(t=>{V2(t,e.x,e.y,e.bandwidth||.3).forEach(e=>{const n={};for(let r=0;r<a;++r)n[i[r]]=t.dims[r];n[o[0]]=e[0],n[o[1]]=e[1],s.push(g1(n))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=s}return n}});const Ipe={linear:L2,log:$2,exp:B2,pow:z2,quad:U2,poly:H2};function Ope(e){q1.call(this,null,e)}Ope.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(Ipe)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},UX(Ope,q1,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=kpe(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(MY),a=e.method||"linear",o=e.order||3,s=((e,t)=>"poly"===e?t:"quad"===e?2:1)(a,o),l=e.as||[MY(e.x),MY(e.y)],u=Ipe[a],c=[];let d=e.extent;LX(Ipe,a)||FY("Invalid regression method: "+a),null!=d&&"log"===a&&d[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null),r.forEach(n=>{if(n.length<=s)return void t.dataflow.warn("Skipping regression with more parameters than data points.");const r=u(n,e.x,e.y,o);if(e.params)return void c.push(g1({keys:n.dims,coef:r.coef,rSquared:r.rSquared}));const h=d||RX(n,e.x),f=e=>{const t={};for(let r=0;r<i.length;++r)t[i[r]]=n.dims[r];t[l[0]]=e[0],t[l[1]]=e[1],c.push(g1(t))};"linear"===a?h.forEach(e=>f([e,r.predict(e)])):X2(r.predict,h,25,200).forEach(f)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}});const Ape=Math.pow(2,-52),Dpe=new Uint32Array(512);class Mpe{static from(e,t=Bpe,n=zpe){const r=e.length,i=new Float64Array(2*r);for(let a=0;a<r;a++){const r=e[a];i[2*a]=t(r),i[2*a+1]=n(r)}return new Mpe(i)}constructor(e){const t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:r,_hullHash:i}=this,a=e.length>>1;let o=1/0,s=1/0,l=-1/0,u=-1/0;for(let T=0;T<a;T++){const t=e[2*T],n=e[2*T+1];t<o&&(o=t),n<s&&(s=n),t>l&&(l=t),n>u&&(u=n),this._ids[T]=T}const c=(o+l)/2,d=(s+u)/2;let h,f,p,m=1/0;for(let T=0;T<a;T++){const t=Npe(c,d,e[2*T],e[2*T+1]);t<m&&(h=T,m=t)}const g=e[2*h],v=e[2*h+1];m=1/0;for(let T=0;T<a;T++){if(T===h)continue;const t=Npe(g,v,e[2*T],e[2*T+1]);t<m&&t>0&&(f=T,m=t)}let y=e[2*f],b=e[2*f+1],x=1/0;for(let T=0;T<a;T++){if(T===h||T===f)continue;const t=Fpe(g,v,y,b,e[2*T],e[2*T+1]);t<x&&(p=T,x=t)}let w=e[2*p],_=e[2*p+1];if(x===1/0){for(let r=0;r<a;r++)this._dists[r]=e[2*r]-e[0]||e[2*r+1]-e[1];Lpe(this._ids,this._dists,0,a-1);const t=new Uint32Array(a);let n=0;for(let e=0,r=-1/0;e<a;e++){const i=this._ids[e];this._dists[i]>r&&(t[n++]=i,r=this._dists[i])}return this.hull=t.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(Rpe(g,v,y,b,w,_)){const e=f,t=y,n=b;f=p,y=w,b=_,p=e,w=t,_=n}const S=function(e,t,n,r,i,a){const o=n-e,s=r-t,l=i-e,u=a-t,c=o*o+s*s,d=l*l+u*u,h=.5/(o*u-s*l);return{x:e+(u*c-s*d)*h,y:t+(o*d-l*c)*h}}(g,v,y,b,w,_);this._cx=S.x,this._cy=S.y;for(let T=0;T<a;T++)this._dists[T]=Npe(e[2*T],e[2*T+1],S.x,S.y);Lpe(this._ids,this._dists,0,a-1),this._hullStart=h;let E=3;n[h]=t[p]=f,n[f]=t[h]=p,n[p]=t[f]=h,r[h]=0,r[f]=1,r[p]=2,i.fill(-1),i[this._hashKey(g,v)]=h,i[this._hashKey(y,b)]=f,i[this._hashKey(w,_)]=p,this.trianglesLen=0,this._addTriangle(h,f,p,-1,-1,-1);for(let T,k,C=0;C<this._ids.length;C++){const a=this._ids[C],o=e[2*a],s=e[2*a+1];if(C>0&&Math.abs(o-T)<=Ape&&Math.abs(s-k)<=Ape)continue;if(T=o,k=s,a===h||a===f||a===p)continue;let l=0;for(let e=0,t=this._hashKey(o,s);e<this._hashSize&&(l=i[(t+e)%this._hashSize],-1===l||l===n[l]);e++);l=t[l];let u,c=l;for(;u=n[c],!Rpe(o,s,e[2*c],e[2*c+1],e[2*u],e[2*u+1]);)if(c=u,c===l){c=-1;break}if(-1===c)continue;let d=this._addTriangle(c,a,n[c],-1,-1,r[c]);r[a]=this._legalize(d+2),r[c]=d,E++;let m=n[c];for(;u=n[m],Rpe(o,s,e[2*m],e[2*m+1],e[2*u],e[2*u+1]);)d=this._addTriangle(m,a,u,r[a],-1,r[m]),r[a]=this._legalize(d+2),n[m]=m,E--,m=u;if(c===l)for(;u=t[c],Rpe(o,s,e[2*u],e[2*u+1],e[2*c],e[2*c+1]);)d=this._addTriangle(u,a,c,-1,r[c],r[u]),this._legalize(d+2),r[u]=d,n[c]=c,E--,c=u;this._hullStart=t[a]=c,n[c]=t[m]=a,n[a]=m,i[this._hashKey(o,s)]=a,i[this._hashKey(e[2*c],e[2*c+1])]=c}this.hull=new Uint32Array(E);for(let T=0,k=this._hullStart;T<E;T++)this.hull[T]=k,k=n[k];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:r}=this;let i=0,a=0;for(;;){const o=n[e],s=e-e%3;if(a=s+(e+2)%3,-1===o){if(0===i)break;e=Dpe[--i];continue}const l=o-o%3,u=l+(o+2)%3,c=t[a],d=t[e],h=t[s+(e+1)%3],f=t[u];if(Ppe(r[2*c],r[2*c+1],r[2*d],r[2*d+1],r[2*h],r[2*h+1],r[2*f],r[2*f+1])){t[e]=f,t[o]=c;const r=n[u];if(-1===r){let t=this._hullStart;do{if(this._hullTri[t]===u){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,r),this._link(o,n[a]),this._link(a,u);const s=l+(o+1)%3;i<Dpe.length&&(Dpe[i++]=s)}else{if(0===i)break;e=Dpe[--i]}}return a}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,n,r,i,a){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,r),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o}}function Npe(e,t,n,r){const i=e-n,a=t-r;return i*i+a*a}function jpe(e,t,n,r,i,a){const o=(r-t)*(i-e),s=(n-e)*(a-t);return Math.abs(o-s)>=33306690738754716e-32*Math.abs(o+s)?o-s:0}function Rpe(e,t,n,r,i,a){return(jpe(i,a,e,t,n,r)||jpe(e,t,n,r,i,a)||jpe(n,r,i,a,e,t))<0}function Ppe(e,t,n,r,i,a,o,s){const l=e-o,u=t-s,c=n-o,d=r-s,h=i-o,f=a-s,p=c*c+d*d,m=h*h+f*f;return l*(d*m-p*f)-u*(c*m-p*h)+(l*l+u*u)*(c*f-d*h)<0}function Fpe(e,t,n,r,i,a){const o=n-e,s=r-t,l=i-e,u=a-t,c=o*o+s*s,d=l*l+u*u,h=.5/(o*u-s*l),f=(u*c-s*d)*h,p=(o*d-l*c)*h;return f*f+p*p}function Lpe(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const r=e[i],a=t[r];let o=i-1;for(;o>=n&&t[e[o]]>a;)e[o+1]=e[o--];e[o+1]=r}else{let i=n+1,a=r;$pe(e,n+r>>1,i),t[e[n]]>t[e[r]]&&$pe(e,n,r),t[e[i]]>t[e[r]]&&$pe(e,i,r),t[e[n]]>t[e[i]]&&$pe(e,n,i);const o=e[i],s=t[o];for(;;){do{i++}while(t[e[i]]<s);do{a--}while(t[e[a]]>s);if(a<i)break;$pe(e,i,a)}e[n+1]=e[a],e[a]=o,r-i+1>=a-n?(Lpe(e,t,i,r),Lpe(e,t,n,a-1)):(Lpe(e,t,n,a-1),Lpe(e,t,i,r))}}function $pe(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function Bpe(e){return e[0]}function zpe(e){return e[1]}const Upe=1e-6;class Hpe{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){const r=(e=+e)+(n=+n),i=t=+t;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${r},${i}`:(Math.abs(this._x1-r)>Upe||Math.abs(this._y1-i)>Upe)&&(this._+="L"+r+","+i),n&&(this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=r},${this._y1=i}`)}rect(e,t,n,r){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+r}h${-n}Z`}value(){return this._||null}}class Wpe{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class Vpe{constructor(e,[t,n,r,i]=[0,0,960,500]){if(!((r=+r)>=(t=+t)&&(i=+i)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(2*e.points.length),this.vectors=new Float64Array(2*e.points.length),this.xmax=r,this.xmin=t,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:n},vectors:r}=this,i=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let h,f,p=0,m=0,g=n.length;p<g;p+=3,m+=2){const t=2*n[p],r=2*n[p+1],a=2*n[p+2],o=e[t],s=e[t+1],l=e[a],u=e[a+1],c=e[r]-o,d=e[r+1]-s,g=l-o,v=u-s,y=c*c+d*d,b=g*g+v*v,x=2*(c*v-d*g);if(x)if(Math.abs(x)<1e-8)h=(o+l)/2,f=(s+u)/2;else{const e=1/x;h=o+(v*y-d*b)*e,f=s+(c*b-g*y)*e}else h=(o+l)/2-1e8*v,f=(s+u)/2+1e8*g;i[m]=h,i[m+1]=f}let a,o,s,l=t[t.length-1],u=4*l,c=e[2*l],d=e[2*l+1];r.fill(0);for(let h=0;h<t.length;++h)l=t[h],a=u,o=c,s=d,u=4*l,c=e[2*l],d=e[2*l+1],r[a+2]=r[u]=s-d,r[a+3]=r[u+1]=c-o}render(e){const t=null==e?e=new Hpe:void 0,{delaunay:{halfedges:n,inedges:r,hull:i},circumcenters:a,vectors:o}=this;if(i.length<=1)return null;for(let u=0,c=n.length;u<c;++u){const t=n[u];if(t<u)continue;const r=2*Math.floor(u/3),i=2*Math.floor(t/3);this._renderSegment(a[r],a[r+1],a[i],a[i+1],e)}let s,l=i[i.length-1];for(let u=0;u<i.length;++u){s=l,l=i[u];const t=2*Math.floor(r[l]/3),n=a[t],c=a[t+1],d=4*s,h=this._project(n,c,o[d+2],o[d+3]);h&&this._renderSegment(n,c,h[0],h[1],e)}return t&&t.value()}renderBounds(e){const t=null==e?e=new Hpe:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const n=null==t?t=new Hpe:void 0,r=this._clip(e);if(null===r||!r.length)return;t.moveTo(r[0],r[1]);let i=r.length;for(;r[0]===r[i-2]&&r[1]===r[i-1]&&i>1;)i-=2;for(let a=2;a<i;a+=2)r[a]===r[a-2]&&r[a+1]===r[a-1]||t.lineTo(r[a],r[a+1]);return t.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){const e=this.cellPolygon(t);e&&(e.index=t,yield e)}}cellPolygon(e){const t=new Wpe;return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,r,i){let a;const o=this._regioncode(e,t),s=this._regioncode(n,r);0===o&&0===s?(i.moveTo(e,t),i.lineTo(n,r)):(a=this._clipSegment(e,t,n,r,o,s))&&(i.moveTo(a[0],a[1]),i.lineTo(a[2],a[3]))}contains(e,t,n){return(t=+t)==t&&(n=+n)==n&&this.delaunay._step(e,t,n)===e}*neighbors(e){const t=this._clip(e);if(t)for(const n of this.delaunay.neighbors(e)){const e=this._clip(n);if(e)e:for(let r=0,i=t.length;r<i;r+=2)for(let a=0,o=e.length;a<o;a+=2)if(t[r]==e[a]&&t[r+1]==e[a+1]&&t[(r+2)%i]==e[(a+o-2)%o]&&t[(r+3)%i]==e[(a+o-1)%o]){yield n;break e}}}_cell(e){const{circumcenters:t,delaunay:{inedges:n,halfedges:r,triangles:i}}=this,a=n[e];if(-1===a)return null;const o=[];let s=a;do{const n=Math.floor(s/3);if(o.push(t[2*n],t[2*n+1]),s=s%3==2?s-2:s+1,i[s]!==e)break;s=r[s]}while(s!==a&&-1!==s);return o}_clip(e){if(0===e&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(null===t)return null;const{vectors:n}=this,r=4*e;return n[r]||n[r+1]?this._clipInfinite(e,t,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(e,t)}_clipFinite(e,t){const n=t.length;let r,i,a,o,s,l=null,u=t[n-2],c=t[n-1],d=this._regioncode(u,c);for(let h=0;h<n;h+=2)if(r=u,i=c,u=t[h],c=t[h+1],a=d,d=this._regioncode(u,c),0===a&&0===d)o=s,s=0,l?l.push(u,c):l=[u,c];else{let t,n,h,f,p;if(0===a){if(null===(t=this._clipSegment(r,i,u,c,a,d)))continue;[n,h,f,p]=t}else{if(null===(t=this._clipSegment(u,c,r,i,d,a)))continue;[f,p,n,h]=t,o=s,s=this._edgecode(n,h),o&&s&&this._edge(e,o,s,l,l.length),l?l.push(n,h):l=[n,h]}o=s,s=this._edgecode(f,p),o&&s&&this._edge(e,o,s,l,l.length),l?l.push(f,p):l=[f,p]}if(l)o=s,s=this._edgecode(l[0],l[1]),o&&s&&this._edge(e,o,s,l,l.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return l}_clipSegment(e,t,n,r,i,a){for(;;){if(0===i&&0===a)return[e,t,n,r];if(i&a)return null;let o,s,l=i||a;8&l?(o=e+(n-e)*(this.ymax-t)/(r-t),s=this.ymax):4&l?(o=e+(n-e)*(this.ymin-t)/(r-t),s=this.ymin):2&l?(s=t+(r-t)*(this.xmax-e)/(n-e),o=this.xmax):(s=t+(r-t)*(this.xmin-e)/(n-e),o=this.xmin),i?i=this._regioncode(e=o,t=s):a=this._regioncode(n=o,r=s)}}_clipInfinite(e,t,n,r,i,a){let o,s=Array.from(t);if((o=this._project(s[0],s[1],n,r))&&s.unshift(o[0],o[1]),(o=this._project(s[s.length-2],s[s.length-1],i,a))&&s.push(o[0],o[1]),s=this._clipFinite(e,s))for(let l,u=0,c=s.length,d=this._edgecode(s[c-2],s[c-1]);u<c;u+=2)l=d,d=this._edgecode(s[u],s[u+1]),l&&d&&(u=this._edge(e,l,d,s,u),c=s.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(s=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return s}_edge(e,t,n,r,i){for(;t!==n;){let n,a;switch(t){case 5:t=4;continue;case 4:t=6,n=this.xmax,a=this.ymin;break;case 6:t=2;continue;case 2:t=10,n=this.xmax,a=this.ymax;break;case 10:t=8;continue;case 8:t=9,n=this.xmin,a=this.ymax;break;case 9:t=1;continue;case 1:t=5,n=this.xmin,a=this.ymin}r[i]===n&&r[i+1]===a||!this.contains(e,n,a)||(r.splice(i,0,n,a),i+=2)}if(r.length>4)for(let a=0;a<r.length;a+=2){const e=(a+2)%r.length,t=(a+4)%r.length;(r[a]===r[e]&&r[e]===r[t]||r[a+1]===r[e+1]&&r[e+1]===r[t+1])&&(r.splice(e,2),a-=2)}return i}_project(e,t,n,r){let i,a,o,s=1/0;if(r<0){if(t<=this.ymin)return null;(i=(this.ymin-t)/r)<s&&(o=this.ymin,a=e+(s=i)*n)}else if(r>0){if(t>=this.ymax)return null;(i=(this.ymax-t)/r)<s&&(o=this.ymax,a=e+(s=i)*n)}if(n>0){if(e>=this.xmax)return null;(i=(this.xmax-e)/n)<s&&(a=this.xmax,o=t+(s=i)*r)}else if(n<0){if(e<=this.xmin)return null;(i=(this.xmin-e)/n)<s&&(a=this.xmin,o=t+(s=i)*r)}return[a,o]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}}const qpe=2*Math.PI,Gpe=Math.pow;function Ype(e){return e[0]}function Xpe(e){return e[1]}function Kpe(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class Zpe{static from(e,t=Ype,n=Xpe,r){return new Zpe("length"in e?function(e,t,n,r){const i=e.length,a=new Float64Array(2*i);for(let o=0;o<i;++o){const i=e[o];a[2*o]=t.call(r,i,o,e),a[2*o+1]=n.call(r,i,o,e)}return a}(e,t,n,r):Float64Array.from(function*(e,t,n,r){let i=0;for(const a of e)yield t.call(r,a,i,e),yield n.call(r,a,i,e),++i}(e,t,n,r)))}constructor(e){this._delaunator=new Mpe(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&function(e){const{triangles:t,coords:n}=e;for(let r=0;r<t.length;r+=3){const e=2*t[r],i=2*t[r+1],a=2*t[r+2];if((n[a]-n[e])*(n[i+1]-n[e+1])-(n[i]-n[e])*(n[a+1]-n[e+1])>1e-10)return!1}return!0}(e)){this.collinear=Int32Array.from({length:t.length/2},(e,t)=>t).sort((e,n)=>t[2*e]-t[2*n]||t[2*e+1]-t[2*n+1]);const e=this.collinear[0],n=this.collinear[this.collinear.length-1],r=[t[2*e],t[2*e+1],t[2*n],t[2*n+1]],i=1e-8*Math.hypot(r[3]-r[1],r[2]-r[0]);for(let a=0,o=t.length/2;a<o;++a){const e=Kpe(t[2*a],t[2*a+1],i);t[2*a]=e[0],t[2*a+1]=e[1]}this._delaunator=new Mpe(t)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let s=0,l=n.length;s<l;++s){const e=i[s%3==2?s-2:s+1];-1!==n[s]&&-1!==a[e]||(a[e]=s)}for(let s=0,l=r.length;s<l;++s)o[r[s]]=s;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],this.triangles[1]=r[1],this.triangles[2]=r[1],a[r[0]]=1,2===r.length&&(a[r[1]]=0))}voronoi(e){return new Vpe(this,e)}*neighbors(e){const{inedges:t,hull:n,_hullIndex:r,halfedges:i,triangles:a,collinear:o}=this;if(o){const t=o.indexOf(e);return t>0&&(yield o[t-1]),void(t<o.length-1&&(yield o[t+1]))}const s=t[e];if(-1===s)return;let l=s,u=-1;do{if(yield u=a[l],l=l%3==2?l-2:l+1,a[l]!==e)return;if(l=i[l],-1===l){const t=n[(r[e]+1)%n.length];return void(t!==u&&(yield t))}}while(l!==s)}find(e,t,n=0){if((e=+e)!=e||(t=+t)!=t)return-1;const r=n;let i;for(;(i=this._step(n,e,t))>=0&&i!==n&&i!==r;)n=i;return i}_step(e,t,n){const{inedges:r,hull:i,_hullIndex:a,halfedges:o,triangles:s,points:l}=this;if(-1===r[e]||!l.length)return(e+1)%(l.length>>1);let u=e,c=Gpe(t-l[2*e],2)+Gpe(n-l[2*e+1],2);const d=r[e];let h=d;do{let r=s[h];const d=Gpe(t-l[2*r],2)+Gpe(n-l[2*r+1],2);if(d<c&&(c=d,u=r),h=h%3==2?h-2:h+1,s[h]!==e)break;if(h=o[h],-1===h){if(h=i[(a[e]+1)%i.length],h!==r&&Gpe(t-l[2*h],2)+Gpe(n-l[2*h+1],2)<c)return h;break}}while(h!==d);return u}render(e){const t=null==e?e=new Hpe:void 0,{points:n,halfedges:r,triangles:i}=this;for(let a=0,o=r.length;a<o;++a){const t=r[a];if(t<a)continue;const o=2*i[a],s=2*i[t];e.moveTo(n[o],n[o+1]),e.lineTo(n[s],n[s+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t=2){const n=null==e?e=new Hpe:void 0,{points:r}=this;for(let i=0,a=r.length;i<a;i+=2){const n=r[i],a=r[i+1];e.moveTo(n+t,a),e.arc(n,a,t,0,qpe)}return n&&n.value()}renderHull(e){const t=null==e?e=new Hpe:void 0,{hull:n,points:r}=this,i=2*n[0],a=n.length;e.moveTo(r[i],r[i+1]);for(let o=1;o<a;++o){const t=2*n[o];e.lineTo(r[t],r[t+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new Wpe;return this.renderHull(e),e.value()}renderTriangle(e,t){const n=null==t?t=new Hpe:void 0,{points:r,triangles:i}=this,a=2*i[e*=3],o=2*i[e+1],s=2*i[e+2];return t.moveTo(r[a],r[a+1]),t.lineTo(r[o],r[o+1]),t.lineTo(r[s],r[s+1]),t.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new Wpe;return this.renderTriangle(e,t),t.value()}}function Jpe(e){q1.call(this,null,e)}Jpe.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const Qpe=[-1e5,-1e5,1e5,1e5];function eme(e){const t=e[0][0],n=e[0][1];let r=e.length-1;for(;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}UX(Jpe,q1,{transform(e,t){const n=e.as||"path",r=t.source;if(!r||!r.length)return t;let i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:Qpe;const a=this.value=Zpe.from(r,e.x,e.y).voronoi(i);for(let o=0,s=r.length;o<s;++o){const e=a.cellPolygon(o);r[o][n]=e?eme(e):null}return t.reflow(e.modified()).modifies(n)}});var tme=Math.PI/180,nme=2048;function rme(e,t,n,r){if(!t.sprite){var i=e.context,a=e.ratio;i.clearRect(0,0,2048/a,nme/a);var o,s,l,u,c,d=0,h=0,f=0,p=n.length;for(--r;++r<p;){if(t=n[r],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font,o=i.measureText(t.text+"m").width*a,l=t.size<<1,t.rotate){var m=Math.sin(t.rotate*tme),g=Math.cos(t.rotate*tme),v=o*g,y=o*m,b=l*g,x=l*m;o=Math.max(Math.abs(v+x),Math.abs(v-x))+31>>5<<5,l=~~Math.max(Math.abs(y+b),Math.abs(y-b))}else o=o+31>>5<<5;if(l>f&&(f=l),d+o>=2048&&(d=0,h+=f,f=0),h+l>=nme)break;i.translate((d+(o>>1))/a,(h+(l>>1))/a),t.rotate&&i.rotate(t.rotate*tme),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=o,t.height=l,t.xoff=d,t.yoff=h,t.x1=o>>1,t.y1=l>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,d+=o}for(var w=i.getImageData(0,0,2048/a,nme/a).data,_=[];--r>=0;)if((t=n[r]).hasText){for(s=(o=t.width)>>5,l=t.y1-t.y0,u=0;u<l*s;u++)_[u]=0;if(null==(d=t.xoff))return;h=t.yoff;var S=0,E=-1;for(c=0;c<l;c++){for(u=0;u<o;u++){var T=w[2048*(h+c)+(d+u)<<2]?1<<31-u%32:0;_[s*c+(u>>5)]|=T,S|=T}S?E=c:(t.y0++,l--,c--,h++)}t.y1=t.y0+E,t.sprite=_.slice(0,(t.y1-t.y0)*s)}}}function ime(e,t,n){for(var r,i=e.sprite,a=e.width>>5,o=e.x-(a<<4),s=127&o,l=32-s,u=e.y1-e.y0,c=(e.y+e.y0)*(n>>=5)+(o>>5),d=0;d<u;d++){r=0;for(var h=0;h<=a;h++)if((r<<l|(h<a?(r=i[d*a+h])>>>s:0))&t[c+h])return!0;c+=n}return!1}function ame(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function ome(e){var t=e[0]/e[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function sme(e){return"function"==typeof e?e:function(){return e}}var lme={archimedean:ome,rectangular:function(e){var t=4*e[0]/e[1],n=0,r=0;return function(e){var i=e<0?-1:1;switch(Math.sqrt(1+4*i*e)-i&3){case 0:n+=t;break;case 1:r+=4;break;case 2:n-=t;break;default:r-=4}return[n,r]}}};const ume=["x","y","font","fontSize","fontStyle","fontWeight","angle"],cme=["text","font","rotate","fontSize","fontStyle","fontWeight"];function dme(e){q1.call(this,function(){var e,t,n,r,i,a,o,s=[256,256],l=ome,u=[],c=Math.random,d={};function h(e,t,n){for(var r,i,a,o,u,d=t.x,h=t.y,f=Math.sqrt(s[0]*s[0]+s[1]*s[1]),p=l(s),m=c()<.5?1:-1,g=-m;(r=p(g+=m))&&(i=~~r[0],a=~~r[1],!(Math.min(Math.abs(i),Math.abs(a))>=f));)if(t.x=d+i,t.y=h+a,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>s[0]||t.y+t.y1>s[1]||n&&ime(t,e,s[0])||n&&!((o=t).x+o.x1>(u=n)[0].x&&o.x+o.x0<u[1].x&&o.y+o.y1>u[0].y&&o.y+o.y0<u[1].y))){for(var v,y=t.sprite,b=t.width>>5,x=s[0]>>5,w=t.x-(b<<4),_=127&w,S=32-_,E=t.y1-t.y0,T=(t.y+t.y0)*x+(w>>5),k=0;k<E;k++){v=0;for(var C=0;C<=b;C++)e[T+C]|=v<<S|(C<b?(v=y[k*b+C])>>>_:0);T+=x}return t.sprite=null,!0}return!1}return d.layout=function(){for(var l=function(e){e.width=e.height=1;var t=Math.sqrt(e.getContext("2d").getImageData(0,0,1,1).data.length>>2);e.width=2048/t,e.height=nme/t;var n=e.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:t}}(R4()),d=function(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}((s[0]>>5)*s[1]),f=null,p=u.length,m=-1,g=[],v=u.map(s=>({text:e(s),font:t(s),style:r(s),weight:i(s),rotate:a(s),size:~~(n(s)+1e-14),padding:o(s),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:s})).sort((e,t)=>t.size-e.size);++m<p;){var y=v[m];y.x=s[0]*(c()+.5)>>1,y.y=s[1]*(c()+.5)>>1,rme(l,y,v,m),y.hasText&&h(d,y,f)&&(g.push(y),f?ame(f,y):f=[{x:y.x+y.x0,y:y.y+y.y0},{x:y.x+y.x1,y:y.y+y.y1}],y.x-=s[0]>>1,y.y-=s[1]>>1)}return g},d.words=function(e){return arguments.length?(u=e,d):u},d.size=function(e){return arguments.length?(s=[+e[0],+e[1]],d):s},d.font=function(e){return arguments.length?(t=sme(e),d):t},d.fontStyle=function(e){return arguments.length?(r=sme(e),d):r},d.fontWeight=function(e){return arguments.length?(i=sme(e),d):i},d.rotate=function(e){return arguments.length?(a=sme(e),d):a},d.text=function(t){return arguments.length?(e=sme(t),d):e},d.spiral=function(e){return arguments.length?(l=lme[e]||e,d):l},d.fontSize=function(e){return arguments.length?(n=sme(e),d):n},d.padding=function(e){return arguments.length?(o=sme(e),d):o},d.random=function(e){return arguments.length?(c=e,d):c},d}(),e)}dme.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:ume}]},UX(dme,q1,{transform(e,t){!e.size||e.size[0]&&e.size[1]||FY("Wordcloud size dimensions must be non-zero.");const n=e.modified();if(!(n||t.changed(t.ADD_REM)||cme.some((function(n){const r=e[n];return kX(r)&&t.modified(r.fields)}))))return;const r=t.materialize(t.SOURCE).source,i=this.value,a=e.as||ume;let o,s=e.fontSize||14;if(kX(s)?o=e.fontSizeRange:s=MX(s),o){const e=s,t=Gee("sqrt")().domain(RX(r,e)).range(o);s=n=>t(e(n))}r.forEach(e=>{e[a[0]]=NaN,e[a[1]]=NaN,e[a[3]]=0});const l=i.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(s).random(l2).layout(),u=i.size(),c=u[0]>>1,d=u[1]>>1,h=l.length;for(let f,p,m=0;m<h;++m)f=l[m],p=f.datum,p[a[0]]=f.x+c,p[a[1]]=f.y+d,p[a[2]]=f.font,p[a[3]]=f.size,p[a[4]]=f.style,p[a[5]]=f.weight,p[a[6]]=f.rotate;return t.reflow(n).modifies(a)}});const hme=e=>new Uint8Array(e),fme=e=>new Uint16Array(e),pme=e=>new Uint32Array(e);function mme(e,t,n){const r=(t<257?hme:t<65537?fme:pme)(e);return n&&r.set(n),r}function gme(e,t,n){const r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(e,t){const n=this,i=n.bisect(n.range,e.value),a=e.index,o=i[0],s=i[1],l=a.length;let u;for(u=0;u<o;++u)t[a[u]]|=r;for(u=s;u<l;++u)t[a[u]]|=r;return n}}}function vme(){let e=pme(0),t=[],n=0;return{insert:function(r,i,a){if(!i.length)return[];const o=n,s=i.length,l=pme(s);let u,c,d,h=Array(s);for(d=0;d<s;++d)h[d]=r(i[d]),l[d]=d;if(h=function(e,t){return e.sort.call(t,(t,n)=>{const r=e[t],i=e[n];return r<i?-1:r>i?1:0}),n=e,Array.from(t,e=>n[e]);var n}(h,l),o)u=t,c=e,t=Array(o+s),e=pme(o+s),function(e,t,n,r,i,a,o,s,l){let u,c=0,d=0;for(u=0;c<r&&d<o;++u)t[c]<i[d]?(s[u]=t[c],l[u]=n[c++]):(s[u]=i[d],l[u]=a[d++]+e);for(;c<r;++c,++u)s[u]=t[c],l[u]=n[c];for(;d<o;++d,++u)s[u]=i[d],l[u]=a[d]+e}(a,u,c,o,h,l,s,t,e);else{if(a>0)for(d=0;d<s;++d)l[d]+=a;t=h,e=l}return n=o+s,{index:l,value:h}},remove:function(r,i){const a=n;let o,s,l;for(s=0;!i[e[s]]&&s<a;++s);for(l=s;s<a;++s)i[o=e[s]]||(e[l]=o,t[l]=t[s],++l);n=a-r},bisect:function(e,r){let i;return r?i=r.length:(r=t,i=n),[$4(r,e[0],0,i),L4(r,e[1],0,i)]},reindex:function(t){for(let r=0,i=n;r<i;++r)e[r]=t[e[r]]},index:()=>e,size:()=>n}}function yme(e){q1.call(this,function(){let e=8,t=[],n=pme(0),r=mme(0,e),i=mme(0,e);return{data:()=>t,seen:()=>{return n=(e=n).length>=(r=t.length)?e:((i=i||new e.constructor(r)).set(e),i);var e,r,i},add(e){for(let n,r=0,i=t.length,a=e.length;r<a;++r)n=e[r],n._index=i++,t.push(n)},remove(e,n){const a=t.length,o=Array(a-e),s=t;let l,u,c;for(u=0;!n[u]&&u<a;++u)o[u]=t[u],s[u]=u;for(c=u;u<a;++u)l=t[u],n[u]?s[u]=-1:(s[u]=c,r[c]=r[u],i[c]=i[u],o[c]=l,l._index=c++),r[u]=0;return t=o,s},size:()=>t.length,curr:()=>r,prev:()=>i,reset:e=>i[e]=r[e],all:()=>e<257?255:e<65537?65535:4294967295,set(e,t){r[e]|=t},clear(e,t){r[e]&=~t},resize(t,n){(t>r.length||n>e)&&(e=Math.max(n,e),r=mme(t,e,r),i=mme(t,e))}}}(),e),this._indices=null,this._dims=null}function bme(e){q1.call(this,null,e)}yme.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},UX(yme,q1,{transform(e,t){return this._dims?e.modified("fields")||e.fields.some(e=>t.modified(e.fields))?this.reinit(e,t):this.eval(e,t):this.init(e,t)},init(e,t){const n=e.fields,r=e.query,i=this._indices={},a=this._dims=[],o=r.length;let s,l,u=0;for(;u<o;++u)s=n[u].fname,l=i[s]||(i[s]=vme()),a.push(gme(l,u,r[u]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),r=e.fields,i=e.query,a=this._indices,o=this._dims,s=this.value,l=s.curr(),u=s.prev(),c=s.all(),d=n.rem=n.add,h=n.mod,f=i.length,p={};let m,g,v,y,b,x,w,_,S;if(u.set(l),t.rem.length&&(b=this.remove(e,t,n)),t.add.length&&s.add(t.add),t.mod.length)for(x={},y=t.mod,w=0,_=y.length;w<_;++w)x[y[w]._index]=1;for(w=0;w<f;++w)S=r[w],(!o[w]||e.modified("fields",w)||t.modified(S.fields))&&(v=S.fname,(m=p[v])||(a[v]=g=vme(),p[v]=m=g.insert(S,t.source,0)),o[w]=gme(g,w,i[w]).onAdd(m,l));for(w=0,_=s.data().length;w<_;++w)b[w]||(u[w]!==l[w]?d.push(w):x[w]&&l[w]!==c&&h.push(w));return s.mask=(1<<f)-1,n},eval(e,t){const n=t.materialize().fork(),r=this._dims.length;let i=0;return t.rem.length&&(this.remove(e,t,n),i|=(1<<r)-1),e.modified("query")&&!e.modified("fields")&&(i|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),i|=(1<<r)-1),t.mod.length&&(this.modify(t,n),i|=(1<<r)-1),this.value.mask=i,n},insert(e,t,n){const r=t.add,i=this.value,a=this._dims,o=this._indices,s=e.fields,l={},u=n.add,c=i.size()+r.length,d=a.length;let h,f,p,m=i.size();i.resize(c,d),i.add(r);const g=i.curr(),v=i.prev(),y=i.all();for(h=0;h<d;++h)f=s[h].fname,p=l[f]||(l[f]=o[f].insert(s[h],r,m)),a[h].onAdd(p,g);for(;m<c;++m)v[m]=y,g[m]!==y&&u.push(m)},modify(e,t){const n=t.mod,r=this.value,i=r.curr(),a=r.all(),o=e.mod;let s,l,u;for(s=0,l=o.length;s<l;++s)u=o[s]._index,i[u]!==a&&n.push(u)},remove(e,t,n){const r=this._indices,i=this.value,a=i.curr(),o=i.prev(),s=i.all(),l={},u=n.rem,c=t.rem;let d,h,f,p;for(d=0,h=c.length;d<h;++d)f=c[d]._index,l[f]=1,o[f]=p=a[f],a[f]=s,p!==s&&u.push(f);for(f in r)r[f].remove(h,l);return this.reindex(t,h,l),l},reindex(e,t,n){const r=this._indices,i=this.value;e.runAfter(()=>{const e=i.remove(t,n);for(const t in r)r[t].reindex(e)})},update(e,t,n){const r=this._dims,i=e.query,a=t.stamp,o=r.length;let s,l,u=0;for(n.filters=0,l=0;l<o;++l)e.modified("query",l)&&(s=l,++u);if(1===u)u=r[s].one,this.incrementOne(r[s],i[s],n.add,n.rem);else for(l=0,u=0;l<o;++l)e.modified("query",l)&&(u|=r[l].one,this.incrementAll(r[l],i[l],a,n.add),n.rem=n.add);return u},incrementAll(e,t,n,r){const i=this.value,a=i.seen(),o=i.curr(),s=i.prev(),l=e.index(),u=e.bisect(e.range),c=e.bisect(t),d=c[0],h=c[1],f=u[0],p=u[1],m=e.one;let g,v,y;if(d<f)for(g=d,v=Math.min(f,h);g<v;++g)y=l[g],a[y]!==n&&(s[y]=o[y],a[y]=n,r.push(y)),o[y]^=m;else if(d>f)for(g=f,v=Math.min(d,p);g<v;++g)y=l[g],a[y]!==n&&(s[y]=o[y],a[y]=n,r.push(y)),o[y]^=m;if(h>p)for(g=Math.max(d,p),v=h;g<v;++g)y=l[g],a[y]!==n&&(s[y]=o[y],a[y]=n,r.push(y)),o[y]^=m;else if(h<p)for(g=Math.max(f,h),v=p;g<v;++g)y=l[g],a[y]!==n&&(s[y]=o[y],a[y]=n,r.push(y)),o[y]^=m;e.range=t.slice()},incrementOne(e,t,n,r){const i=this.value.curr(),a=e.index(),o=e.bisect(e.range),s=e.bisect(t),l=s[0],u=s[1],c=o[0],d=o[1],h=e.one;let f,p,m;if(l<c)for(f=l,p=Math.min(c,u);f<p;++f)m=a[f],i[m]^=h,n.push(m);else if(l>c)for(f=c,p=Math.min(l,d);f<p;++f)m=a[f],i[m]^=h,r.push(m);if(u>d)for(f=Math.max(l,d),p=u;f<p;++f)m=a[f],i[m]^=h,n.push(m);else if(u<d)for(f=Math.max(c,u),p=d;f<p;++f)m=a[f],i[m]^=h,r.push(m);e.range=t.slice()}}),bme.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},UX(bme,q1,{transform(e,t){const n=~(e.ignore||0),r=e.filter,i=r.mask;if(0==(i&n))return t.StopPropagation;const a=t.fork(t.ALL),o=r.data(),s=r.curr(),l=r.prev(),u=e=>s[e]&n?null:o[e];return a.filter(a.MOD,u),i&i-1?(a.filter(a.ADD,e=>{const t=s[e]&n;return!t&&t^l[e]&n?o[e]:null}),a.filter(a.REM,e=>{const t=s[e]&n;return!t||t^t^l[e]&n?null:o[e]})):(a.filter(a.ADD,u),a.filter(a.REM,e=>(s[e]&n)===i?o[e]:null)),a.filter(a.SOURCE,e=>u(e._index))}});const xme="Literal",wme="CallExpression";function _me(e){this.type=e}var Sme,Eme,Tme,kme,Cme;_me.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case wme:return[e.callee].concat(e.arguments);case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];case"Identifier":case xme:case"RawCode":default:return[]}}(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1},(Sme={})[1]="Boolean",Sme[2]="<end>",Sme[3]="Identifier",Sme[4]="Keyword",Sme[5]="Null",Sme[6]="Numeric",Sme[7]="Punctuator",Sme[8]="String",Sme[9]="RegularExpression";var Ime="Identifier",Ome="Unexpected token %0",Ame="Invalid regular expression",Dme="Invalid regular expression: missing /",Mme="Octal literals are not allowed in strict mode.",Nme="ILLEGAL",jme="Disabled.",Rme=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),Pme=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function Fme(e,t){if(!e)throw new Error("ASSERT: "+t)}function Lme(e){return e>=48&&e<=57}function $me(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Bme(e){return"01234567".indexOf(e)>=0}function zme(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Ume(e){return 10===e||13===e||8232===e||8233===e}function Hme(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&Rme.test(String.fromCharCode(e))}function Wme(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&Pme.test(String.fromCharCode(e))}const Vme={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function qme(){for(;Tme<kme;){const e=Eme.charCodeAt(Tme);if(!zme(e)&&!Ume(e))break;++Tme}}function Gme(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)Tme<kme&&$me(Eme[Tme])?(r=Eme[Tme++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):sge({},Ome,Nme);return String.fromCharCode(i)}function Yme(){var e,t;for(t=0,"}"===(e=Eme[Tme])&&sge({},Ome,Nme);Tme<kme&&$me(e=Eme[Tme++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&sge({},Ome,Nme),t<=65535?String.fromCharCode(t):String.fromCharCode(55296+(t-65536>>10),56320+(t-65536&1023))}function Xme(){var e,t;for(e=Eme.charCodeAt(Tme++),t=String.fromCharCode(e),92===e&&(117!==Eme.charCodeAt(Tme)&&sge({},Ome,Nme),++Tme,(e=Gme("u"))&&"\\"!==e&&Hme(e.charCodeAt(0))||sge({},Ome,Nme),t=e);Tme<kme&&Wme(e=Eme.charCodeAt(Tme));)++Tme,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==Eme.charCodeAt(Tme)&&sge({},Ome,Nme),++Tme,(e=Gme("u"))&&"\\"!==e&&Wme(e.charCodeAt(0))||sge({},Ome,Nme),t+=e);return t}function Kme(){var e,t,n,r,i=Tme,a=Eme.charCodeAt(Tme),o=Eme[Tme];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Tme,{type:7,value:String.fromCharCode(a),start:i,end:Tme};default:if(61===(e=Eme.charCodeAt(Tme+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Tme+=2,{type:7,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:Tme};case 33:case 61:return 61===Eme.charCodeAt(Tme+=2)&&++Tme,{type:7,value:Eme.slice(i,Tme),start:i,end:Tme}}}return">>>="===(r=Eme.substr(Tme,4))?{type:7,value:r,start:i,end:Tme+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:Tme+=3}:o===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===t?{type:7,value:t,start:i,end:Tme+=2}:"<>=!+-*%&|^/".indexOf(o)>=0?{type:7,value:o,start:i,end:++Tme}:void sge({},Ome,Nme)}function Zme(){var e,t,n;if(Fme(Lme((n=Eme[Tme]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=Tme,e="","."!==n){if(e=Eme[Tme++],n=Eme[Tme],"0"===e){if("x"===n||"X"===n)return++Tme,function(e){let t="";for(;Tme<kme&&$me(Eme[Tme]);)t+=Eme[Tme++];return 0===t.length&&sge({},Ome,Nme),Hme(Eme.charCodeAt(Tme))&&sge({},Ome,Nme),{type:6,value:parseInt("0x"+t,16),start:e,end:Tme}}(t);if(Bme(n))return function(e){let t="0"+Eme[Tme++];for(;Tme<kme&&Bme(Eme[Tme]);)t+=Eme[Tme++];return(Hme(Eme.charCodeAt(Tme))||Lme(Eme.charCodeAt(Tme)))&&sge({},Ome,Nme),{type:6,value:parseInt(t,8),octal:!0,start:e,end:Tme}}(t);n&&Lme(n.charCodeAt(0))&&sge({},Ome,Nme)}for(;Lme(Eme.charCodeAt(Tme));)e+=Eme[Tme++];n=Eme[Tme]}if("."===n){for(e+=Eme[Tme++];Lme(Eme.charCodeAt(Tme));)e+=Eme[Tme++];n=Eme[Tme]}if("e"===n||"E"===n)if(e+=Eme[Tme++],"+"!==(n=Eme[Tme])&&"-"!==n||(e+=Eme[Tme++]),Lme(Eme.charCodeAt(Tme)))for(;Lme(Eme.charCodeAt(Tme));)e+=Eme[Tme++];else sge({},Ome,Nme);return Hme(Eme.charCodeAt(Tme))&&sge({},Ome,Nme),{type:6,value:parseFloat(e),start:t,end:Tme}}function Jme(){if(qme(),Tme>=kme)return{type:2,start:Tme,end:Tme};const e=Eme.charCodeAt(Tme);return Hme(e)?(t=Tme,{type:1===(n=92===Eme.charCodeAt(Tme)?Xme():function(){var e,t;for(e=Tme++;Tme<kme;){if(92===(t=Eme.charCodeAt(Tme)))return Tme=e,Xme();if(!Wme(t))break;++Tme}return Eme.slice(e,Tme)}()).length?3:Vme.hasOwnProperty(n)?4:"null"===n?5:"true"===n||"false"===n?1:3,value:n,start:t,end:Tme}):40===e||41===e||59===e?Kme():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for(Fme("'"===(e=Eme[Tme])||'"'===e,"String literal must starts with a quote"),t=Tme,++Tme;Tme<kme;){if((n=Eme[Tme++])===e){e="";break}if("\\"===n)if((n=Eme[Tme++])&&Ume(n.charCodeAt(0)))"\r"===n&&"\n"===Eme[Tme]&&++Tme;else switch(n){case"u":case"x":"{"===Eme[Tme]?(++Tme,i+=Yme()):i+=Gme(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:Bme(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),Tme<kme&&Bme(Eme[Tme])&&(a=!0,r=8*r+"01234567".indexOf(Eme[Tme++]),"0123".indexOf(n)>=0&&Tme<kme&&Bme(Eme[Tme])&&(r=8*r+"01234567".indexOf(Eme[Tme++]))),i+=String.fromCharCode(r)):i+=n}else{if(Ume(n.charCodeAt(0)))break;i+=n}}return""!==e&&sge({},Ome,Nme),{type:8,value:i,octal:a,start:t,end:Tme}}():46===e?Lme(Eme.charCodeAt(Tme+1))?Zme():Kme():Lme(e)?Zme():Kme();var t,n}function Qme(){const e=Cme;return Tme=e.end,Cme=Jme(),Tme=e.end,e}function ege(){const e=Tme;Cme=Jme(),Tme=e}function tge(e,t,n){const r=new _me("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return r.operator=e,r.left=t,r.right=n,r}function nge(e,t){const n=new _me("CallExpression");return n.callee=e,n.arguments=t,n}function rge(e){const t=new _me(Ime);return t.name=e,t}function ige(e){const t=new _me("Literal");return t.value=e.value,t.raw=Eme.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function age(e,t,n){const r=new _me("MemberExpression");return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function oge(e,t,n){const r=new _me("Property");return r.key=t,r.value=n,r.kind=e,r}function sge(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(e,t)=>(Fme(t<r.length,"Message reference must be in range"),r[t]));throw(n=new Error(i)).index=Tme,n.description=i,n}function lge(e){2===e.type&&sge(e,"Unexpected end of input"),6===e.type&&sge(e,"Unexpected number"),8===e.type&&sge(e,"Unexpected string"),3===e.type&&sge(e,"Unexpected identifier"),4===e.type&&sge(e,"Unexpected reserved word"),sge(e,Ome,e.value)}function uge(e){const t=Qme();7===t.type&&t.value===e||lge(t)}function cge(e){return 7===Cme.type&&Cme.value===e}function dge(e){return 4===Cme.type&&Cme.value===e}function hge(){Tme=Cme.start;const e=Qme();return 8===e.type||6===e.type?(e.octal&&sge(e,Mme),ige(e)):rge(e.value)}function fge(){var e,t,n;return Tme=Cme.start,3===(e=Cme).type?(n=hge(),uge(":"),oge("init",n,xge())):2!==e.type&&7!==e.type?(t=hge(),uge(":"),oge("init",t,xge())):void lge(e)}const pge={if:1};function mge(){const e=[];if(uge("("),!cge(")"))for(;Tme<kme&&(e.push(xge()),!cge(")"));)uge(",");return uge(")"),e}function gge(){uge("[");const e=wge();return uge("]"),e}function vge(){const e=function(){var e;for(e=function(){var e,t,n,r,i,a,o;if(cge("("))return function(){uge("(");const e=wge();return uge(")"),e}();if(cge("["))return function(){const e=[];for(Tme=Cme.start,uge("[");!cge("]");)cge(",")?(Qme(),e.push(null)):(e.push(xge()),cge("]")||uge(","));return Qme(),function(e){const t=new _me("ArrayExpression");return t.elements=e,t}(e)}();if(cge("{"))return function(){var e,t,n=[],r={},i=String;for(Tme=Cme.start,uge("{");!cge("}");)t="$"+((e=fge()).key.type===Ime?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?sge({},"Duplicate data property in object literal not allowed in strict mode"):r[t]=!0,n.push(e),cge("}")||uge(",");return uge("}"),function(e){const t=new _me("ObjectExpression");return t.properties=e,t}(n)}();if(Tme=Cme.start,3===(e=Cme.type)||pge[Cme.value])n=rge(Qme().value);else if(8===e||6===e)Cme.octal&&sge(Cme,Mme),n=ige(Qme());else{if(4===e)throw new Error(jme);1===e?((t=Qme()).value="true"===t.value,n=ige(t)):5===e?((t=Qme()).value=null,n=ige(t)):cge("/")||cge("/=")?(n=ige((Cme=null,qme(),r=Tme,i=function(){var e,t,n,r;for(Fme("/"===(e=Eme[Tme]),"Regular expression literal must start with a slash"),t=Eme[Tme++],n=!1,r=!1;Tme<kme;)if(t+=e=Eme[Tme++],"\\"===e)Ume((e=Eme[Tme++]).charCodeAt(0))&&sge({},Dme),t+=e;else if(Ume(e.charCodeAt(0)))sge({},Dme);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||sge({},Dme),{value:t.substr(1,t.length-2),literal:t}}(),a=function(){var e,t,n;for(t="",n="";Tme<kme&&Wme((e=Eme[Tme]).charCodeAt(0));)++Tme,"\\"===e&&Tme<kme?sge({},Ome,Nme):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&sge({},Ame,n),{value:n,literal:t}}(),o=function(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(e,t)=>{if(parseInt(t,16)<=1114111)return"x";sge({},Ame)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(r){sge({},Ame)}try{return new RegExp(e,t)}catch(i){return null}}(i.value,a.value),{literal:i.literal+a.literal,value:o,regex:{pattern:i.value,flags:a.value},start:r,end:Tme})),ege()):lge(Qme())}return n}();;)if(cge("."))e=age(".",e,(uge("."),function(){Tme=Cme.start;const e=Qme();return function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e)||lge(e),rge(e.value)}()));else if(cge("("))e=nge(e,mge());else{if(!cge("["))break;e=age("[",e,gge())}return e}();if(7===Cme.type&&(cge("++")||cge("--")))throw new Error(jme);return e}function yge(){var e,t;if(7!==Cme.type&&4!==Cme.type)t=vge();else{if(cge("++")||cge("--"))throw new Error(jme);if(cge("+")||cge("-")||cge("~")||cge("!"))e=Qme(),t=yge(),t=function(e,t){const n=new _me("UnaryExpression");return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(dge("delete")||dge("void")||dge("typeof"))throw new Error(jme);t=vge()}}return t}function bge(e){let t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function xge(){var e,t;return e=function(){var e,t,n,r,i,a,o,s,l,u;if(e=Cme,l=yge(),0===(i=bge(r=Cme)))return l;for(r.prec=i,Qme(),t=[e,Cme],a=[l,r,o=yge()];(i=bge(Cme))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,l=a.pop(),t.pop(),n=tge(s,l,o),a.push(n);(r=Qme()).prec=i,a.push(r),t.push(Cme),n=yge(),a.push(n)}for(n=a[u=a.length-1],t.pop();u>1;)t.pop(),n=tge(a[u-1].value,a[u-2],n),u-=2;return n}(),cge("?")&&(Qme(),t=xge(),uge(":"),e=function(e,t,n){const r=new _me("ConditionalExpression");return r.test=e,r.consequent=t,r.alternate=n,r}(e,t,xge())),e}function wge(){const e=xge();if(cge(","))throw new Error(jme);return e}function _ge(e){Tme=0,kme=(Eme=e).length,Cme=null,ege();const t=wge();if(2!==Cme.type)throw new Error("Unexpect token after expression.");return t}var Sge={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function Ege(e){function t(t,n,r){return i=>function(t,n,r,i){let a=e(n[0]);return r&&(a=r+"("+a+")",0===r.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+t+(i<0?"":0===i?"()":"("+n.slice(1).map(e).join(",")+")")}(t,i,n,r)}const n="new Date",r="String",i="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){t.length<3&&FY("Missing arguments to clamp function."),t.length>3&&FY("Too many arguments to clamp function.");const n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),join:t("join",null),indexof:t("indexOf",null),lastindexof:t("lastIndexOf",null),slice:t("slice",null),reverse:function(t){return"("+e(t[0])+").slice().reverse()"},parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase",r,0),lower:t("toLowerCase",r,0),substring:t("substring",r),split:t("split",r),replace:t("replace",r),trim:t("trim",r,0),regexp:i,test:t("test",i),if:function(t){t.length<3&&FY("Missing arguments to if function."),t.length>3&&FY("Too many arguments to if function.");const n=t.map(e);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}var Tge,kge,Cge,Ige,Oge,Age=new Vse,Dge=new Vse,Mge={point:mle,lineStart:mle,lineEnd:mle,polygonStart:function(){Age=new Vse,Mge.lineStart=Nge,Mge.lineEnd=jge},polygonEnd:function(){var e=+Age;Dge.add(e<0?Zse+e:e),this.lineStart=this.lineEnd=this.point=mle},sphere:function(){Dge.add(Zse)}};function Nge(){Mge.point=Rge}function jge(){Pge(Tge,kge)}function Rge(e,t){Mge.point=Pge,Tge=e,kge=t,Cge=e*=Qse,Ige=rle(t=(t*=Qse)/2+Kse),Oge=ule(t)}function Pge(e,t){var n=(e*=Qse)-Cge,r=n>=0?1:-1,i=r*n,a=rle(t=(t*=Qse)/2+Kse),o=ule(t),s=Oge*o,l=Ige*a+s*rle(i),u=s*r*ule(i);Age.add(nle(u,l)),Cge=e,Ige=a,Oge=o}var Fge,Lge,$ge,Bge,zge,Uge,Hge,Wge,Vge,qge,Gge,Yge={point:Xge,lineStart:Zge,lineEnd:Jge,polygonStart:function(){Yge.point=Qge,Yge.lineStart=eve,Yge.lineEnd=tve,Vge=new Vse,Mge.polygonStart()},polygonEnd:function(){Mge.polygonEnd(),Yge.point=Xge,Yge.lineStart=Zge,Yge.lineEnd=Jge,Age<0?(Fge=-($ge=180),Lge=-(Bge=90)):Vge>qse?Bge=90:Vge<-1e-6&&(Lge=-90),Gge[0]=Fge,Gge[1]=$ge},sphere:function(){Fge=-($ge=180),Lge=-(Bge=90)}};function Xge(e,t){qge.push(Gge=[Fge=e,$ge=e]),t<Lge&&(Lge=t),t>Bge&&(Bge=t)}function Kge(e,t){var n=Sue([e*Qse,t*Qse]);if(Wge){var r=Tue(Wge,n),i=Tue([r[1],-r[0],0],r);Iue(i),i=_ue(i);var a,o=e-zge,s=o>0?1:-1,l=i[0]*Jse*s,u=ele(o)>180;u^(s*zge<l&&l<s*e)?(a=i[1]*Jse)>Bge&&(Bge=a):u^(s*zge<(l=(l+360)%360-180)&&l<s*e)?(a=-i[1]*Jse)<Lge&&(Lge=a):(t<Lge&&(Lge=t),t>Bge&&(Bge=t)),u?e<zge?nve(Fge,e)>nve(Fge,$ge)&&($ge=e):nve(e,$ge)>nve(Fge,$ge)&&(Fge=e):$ge>=Fge?(e<Fge&&(Fge=e),e>$ge&&($ge=e)):e>zge?nve(Fge,e)>nve(Fge,$ge)&&($ge=e):nve(e,$ge)>nve(Fge,$ge)&&(Fge=e)}else qge.push(Gge=[Fge=e,$ge=e]);t<Lge&&(Lge=t),t>Bge&&(Bge=t),Wge=n,zge=e}function Zge(){Yge.point=Kge}function Jge(){Gge[0]=Fge,Gge[1]=$ge,Yge.point=Xge,Wge=null}function Qge(e,t){if(Wge){var n=e-zge;Vge.add(ele(n)>180?n+(n>0?360:-360):n)}else Uge=e,Hge=t;Mge.point(e,t),Kge(e,t)}function eve(){Mge.lineStart()}function tve(){Qge(Uge,Hge),Mge.lineEnd(),ele(Vge)>qse&&(Fge=-($ge=180)),Gge[0]=Fge,Gge[1]=$ge,Wge=null}function nve(e,t){return(t-=e)<0?t+360:t}function rve(e,t){return e[0]-t[0]}function ive(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var ave,ove,sve,lve,uve,cve,dve,hve,fve,pve,mve,gve,vve,yve,bve,xve,wve={sphere:mle,point:_ve,lineStart:Eve,lineEnd:Cve,polygonStart:function(){wve.lineStart=Ive,wve.lineEnd=Ove},polygonEnd:function(){wve.lineStart=Eve,wve.lineEnd=Cve}};function _ve(e,t){e*=Qse;var n=rle(t*=Qse);Sve(n*rle(e),n*ule(e),ule(t))}function Sve(e,t,n){++ave,sve+=(e-sve)/ave,lve+=(t-lve)/ave,uve+=(n-uve)/ave}function Eve(){wve.point=Tve}function Tve(e,t){e*=Qse;var n=rle(t*=Qse);yve=n*rle(e),bve=n*ule(e),xve=ule(t),wve.point=kve,Sve(yve,bve,xve)}function kve(e,t){e*=Qse;var n=rle(t*=Qse),r=n*rle(e),i=n*ule(e),a=ule(t),o=nle(dle((o=bve*a-xve*i)*o+(o=xve*r-yve*a)*o+(o=yve*i-bve*r)*o),yve*r+bve*i+xve*a);ove+=o,cve+=o*(yve+(yve=r)),dve+=o*(bve+(bve=i)),hve+=o*(xve+(xve=a)),Sve(yve,bve,xve)}function Cve(){wve.point=_ve}function Ive(){wve.point=Ave}function Ove(){Dve(gve,vve),wve.point=_ve}function Ave(e,t){gve=e,vve=t,e*=Qse,t*=Qse,wve.point=Dve;var n=rle(t);yve=n*rle(e),bve=n*ule(e),xve=ule(t),Sve(yve,bve,xve)}function Dve(e,t){e*=Qse;var n=rle(t*=Qse),r=n*rle(e),i=n*ule(e),a=ule(t),o=bve*a-xve*i,s=xve*r-yve*a,l=yve*i-bve*r,u=ole(o,s,l),c=ple(u),d=u&&-c/u;fve.add(d*o),pve.add(d*s),mve.add(d*l),ove+=c,cve+=c*(yve+(yve=r)),dve+=c*(bve+(bve=i)),hve+=c*(xve+(xve=a)),Sve(yve,bve,xve)}const Mve=Math.PI/180,Nve=180/Math.PI,jve=.96422,Rve=.82521,Pve=4/29,Fve=.12841854934601665;function Lve(e){if(e instanceof Bve)return new Bve(e.l,e.a,e.b,e.opacity);if(e instanceof Gve)return Yve(e);e instanceof vde||(e=mde(e));var t,n,r=Wve(e.r),i=Wve(e.g),a=Wve(e.b),o=zve((.2225045*r+.7168786*i+.0606169*a)/1);return r===i&&i===a?t=n=o:(t=zve((.4360747*r+.3850649*i+.1430804*a)/jve),n=zve((.0139322*r+.0971045*i+.7141733*a)/Rve)),new Bve(116*o-16,500*(t-o),200*(o-n),e.opacity)}function $ve(e,t,n,r){return 1===arguments.length?Lve(e):new Bve(e,t,n,null==r?1:r)}function Bve(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function zve(e){return e>.008856451679035631?Math.pow(e,1/3):e/Fve+Pve}function Uve(e){return e>.20689655172413793?e*e*e:Fve*(e-Pve)}function Hve(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Wve(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Vve(e){if(e instanceof Gve)return new Gve(e.h,e.c,e.l,e.opacity);if(e instanceof Bve||(e=Lve(e)),0===e.a&&0===e.b)return new Gve(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*Nve;return new Gve(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function qve(e,t,n,r){return 1===arguments.length?Vve(e):new Gve(e,t,n,null==r?1:r)}function Gve(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function Yve(e){if(isNaN(e.h))return new Bve(e.l,0,0,e.opacity);var t=e.h*Mve;return new Bve(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}Yce(Bve,$ve,Xce(Kce,{brighter:function(e){return new Bve(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new Bve(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new vde(Hve(3.1338561*(t=jve*Uve(t))-1.6168667*(e=1*Uve(e))-.4906146*(n=Rve*Uve(n))),Hve(-.9787684*t+1.9161415*e+.033454*n),Hve(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),Yce(Gve,qve,Xce(Kce,{brighter:function(e){return new Gve(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new Gve(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return Yve(this).rgb()}}));const Xve="intersect",Kve="union";var Zve="index:unit";function Jve(e,t){for(var n,r,i=t.fields,a=t.values,o=i.length,s=0;s<o;++s)if((r=i[s]).getter=$Y.getter||$Y(r.field),VX(n=r.getter(e))&&(n=oX(n)),VX(a[s])&&(a[s]=oX(a[s])),VX(a[s][0])&&(a[s]=a[s].map(oX)),"E"===r.type){if(QY(a[s])?a[s].indexOf(n)<0:n!==a[s])return!1}else if("R"===r.type){if(!HX(n,a[s]))return!1}else if("R-RE"===r.type){if(!HX(n,a[s],!0,!1))return!1}else if("R-E"===r.type){if(!HX(n,a[s],!1,!1))return!1}else if("R-LE"===r.type&&!HX(n,a[s],!1,!0))return!1;return!0}var Qve={E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(e=>t.indexOf(e)>=0):t},R_union:function(e,t){var n=oX(t[0]),r=oX(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=oX(t[0]),r=oX(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};function eye(e,t,n,r){t[0].type!==xme&&FY("First argument to selection functions must be a string literal.");const i=t[0].value,a=":"+i;(t.length>=2&&aX(t).value)!==Xve||LX(r,"@unit")||(r["@unit"]=n.getData(i).indataRef(n,"unit")),LX(r,a)||(r[a]=n.getData(i).tuplesRef())}function tye(e){const t=this.context.data[e];return t?t.values.value:[]}const nye=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},rye=nye("format"),iye=nye("timeFormat"),aye=nye("utcFormat"),oye=nye("timeParse"),sye=nye("utcParse"),lye=new Date(2e3,0,1);function uye(e,t,n){return Number.isInteger(e)&&Number.isInteger(t)?(lye.setYear(2e3),lye.setMonth(e),lye.setDate(t),iye.call(this,lye,n)):""}function cye(e,t,n,r){t[0].type!==xme&&FY("First argument to data functions must be a string literal.");const i=t[0].value,a=":"+i;if(!LX(a,r))try{r[a]=n.getData(i).tuplesRef()}catch(rBe){}}function dye(e,t,n,r){if(t[0].type===xme)hye(n,r,t[0].value);else for(e in n.scales)hye(n,r,e)}function hye(e,t,n){const r="%"+n;if(!LX(t,r))try{t[r]=e.scaleRef(n)}catch(rBe){}}function fye(e,t){let n;return kX(e)?e:XX(e)?(n=t.scales[e])&&n.value:void 0}function pye(e,t){return function(n,r,i){if(n){const t=fye(n,(i||this).context);return t&&t.path[e](r)}return t(r)}}const mye=pye("area",(function(e){return Dge=new Vse,Wse(e,Mge),2*Dge})),gye=pye("bounds",(function(e){var t,n,r,i,a,o,s;if(Bge=$ge=-(Fge=Lge=1/0),qge=[],Wse(e,Yge),n=qge.length){for(qge.sort(rve),t=1,a=[r=qge[0]];t<n;++t)ive(r,(i=qge[t])[0])||ive(r,i[1])?(nve(r[0],i[1])>nve(r[0],r[1])&&(r[1]=i[1]),nve(i[0],r[1])>nve(r[0],r[1])&&(r[0]=i[0])):a.push(r=i);for(o=-1/0,t=0,r=a[n=a.length-1];t<=n;r=i,++t)(s=nve(r[1],(i=a[t])[0]))>o&&(o=s,Fge=i[0],$ge=r[1])}return qge=Gge=null,Fge===1/0||Lge===1/0?[[NaN,NaN],[NaN,NaN]]:[[Fge,Lge],[$ge,Bge]]})),vye=pye("centroid",(function(e){ave=ove=sve=lve=uve=cve=dve=hve=0,fve=new Vse,pve=new Vse,mve=new Vse,Wse(e,wve);var t=+fve,n=+pve,r=+mve,i=ole(t,n,r);return i<Gse&&(t=cve,n=dve,r=hve,ove<qse&&(t=sve,n=lve,r=uve),(i=ole(t,n,r))<Gse)?[NaN,NaN]:[nle(n,t)*Jse,ple(r/i)*Jse]}));function yye(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(rBe){e.warn(rBe)}return n[n.length-1]}function bye(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function xye(e){const t=gde(e);return.2126*bye(t.r)+.7152*bye(t.g)+.0722*bye(t.b)}function wye(e,t){return e===t||e!=e&&t!=t||(QY(e)?!(!QY(t)||e.length!==t.length)&&function(e,t){for(let n=0,r=e.length;n<r;++n)if(!wye(e[n],t[n]))return!1;return!0}(e,t):!(!eX(e)||!eX(t))&&_ye(e,t))}function _ye(e,t){for(const n in e)if(!wye(e[n],t[n]))return!1;return!0}function Sye(e){return t=>_ye(e,t)}const Eye=e=>e.data;function Tye(e,t){const n=tye.call(t,e);return n.root&&n.root.lookup||{}}const kye=()=>"undefined"!=typeof window&&window||null,Cye={random:()=>l2(),cumulativeNormal:b2,cumulativeLogNormal:T2,cumulativeUniform:D2,densityNormal:y2,densityLogNormal:E2,densityUniform:A2,quantileNormal:x2,quantileLogNormal:k2,quantileUniform:M2,sampleNormal:v2,sampleLogNormal:S2,sampleUniform:O2,isArray:QY,isBoolean:WX,isDate:VX,isDefined:e=>void 0!==e,isNumber:GX,isObject:eX,isRegExp:YX,isString:XX,isTuple:f1,isValid:e=>null!=e&&e==e,toBoolean:iK,toDate:oK,toNumber:oX,toString:sK,flush:zX,lerp:ZX,merge:function(){const e=[].slice.call(arguments);return e.unshift({}),jX(...e)},pad:tK,peek:aX,span:nK,inrange:HX,truncate:uK,rgb:gde,lab:$ve,hcl:qve,hsl:Sde,luminance:xye,contrast:function(e,t){const n=xye(e),r=xye(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},sequence:Z2,format:rye,utcFormat:aye,utcParse:sye,utcOffset:FJ,utcSequence:BJ,timeFormat:iye,timeParse:oye,timeOffset:PJ,timeSequence:$J,timeUnitSpecifier:lJ,monthFormat:function(e){return uye.call(this,e,1,"%B")},monthAbbrevFormat:function(e){return uye.call(this,e,1,"%b")},dayFormat:function(e){return uye.call(this,0,2+e,"%A")},dayAbbrevFormat:function(e){return uye.call(this,0,2+e,"%a")},quarter:_X,utcquarter:SX,week:hJ,utcweek:yJ,dayofyear:dJ,utcdayofyear:vJ,warn:function(){return yye(this.context.dataflow,"warn",arguments)},info:function(){return yye(this.context.dataflow,"info",arguments)},debug:function(){return yye(this.context.dataflow,"debug",arguments)},extent:RX,inScope:function(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},intersect:function(e,t,n){if(!e)return[];const[r,i]=e,a=(new One).set(r[0],r[1],i[0],i[1]);return Xae(n||this.context.dataflow.scenegraph().root,a,function(e){let t=null;if(e){const n=EX(e.marktype),r=EX(e.markname);t=e=>(!n.length||n.some(t=>e.marktype===t))&&(!r.length||r.some(t=>e.name===t))}return t}(t))},clampRange:TX,pinchDistance:function(e){const t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){const e=kye();return e?e.screen:{}},containerSize:function(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){const e=kye();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]},bandspace:function(e,t,n){return bee(e||0,t||0,n||0)},setdata:function(e,t){const n=this.context.dataflow;return n.pulse(this.context.data[e].input,n.changeset().remove(WY).insert(t)),1},pathShape:function(e){let t=null;return function(n){return n?Jte(n,t=t||zte(e)):e}},panLinear:fX,panLog:pX,panPow:mX,panSymlog:gX,zoomLinear:yX,zoomLog:bX,zoomPow:xX,zoomSymlog:wX,encode:function(e,t,n){if(e){const n=this.context.dataflow;n.pulse(e.mark.source,n.changeset().encode(e,t))}return void 0!==n?n:e},modify:function(e,t,n,r,i,a){const o=this.context.dataflow,s=this.context.data[e],l=s.input,u=o.stamp();let c,d,h=s.changes;if(!1===o._trigger||!(l.value.length||t||r))return 0;if((!h||h.stamp<u)&&(s.changes=h=o.changeset(),h.stamp=u,o.runAfter(()=>{s.modified=!0,o.pulse(l,h).run()},!0,1)),n&&(c=!0===n?WY:QY(n)||f1(n)?n:Sye(n),h.remove(c)),t&&h.insert(t),r&&(c=Sye(r),l.value.some(c)?h.remove(c):h.insert(r)),i)for(d in a)h.modify(i,d,a[d]);return 1}},Iye=["view","item","group","xy","x","y"],Oye="this.",Aye={},Dye={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>"_[".concat(rK("$"+e),"]"),functions:function(e){const t=Ege(e);Iye.forEach(e=>t[e]="event.vega."+e);for(const n in Cye)t[n]=Oye+n;return jX(t,function(e,t,n){t.__bandwidth=e=>e&&e.bandwidth?e.bandwidth():0,n._bandwidth=dye,n._range=dye,n._scale=dye;const r=t=>"_["+(t.type===xme?rK("%"+t.value):rK("%")+"+"+e(t))+"]";return{_bandwidth:e=>"this.__bandwidth(".concat(r(e[0]),")"),_range:e=>"".concat(r(e[0]),".range()"),_scale:t=>"".concat(r(t[0]),"(").concat(e(t[1]),")")}}(e,Cye,Aye)),t},constants:Sge,visitors:Aye},Mye=function(e){const t=(e=e||{}).allowed?lK(e.allowed):{},n=e.forbidden?lK(e.forbidden):{},r=e.constants||Sge,i=(e.functions||Ege)(d),a=e.globalvar,o=e.fieldvar,s=kX(a)?a:e=>"".concat(a,'["').concat(e,'"]');let l={},u={},c=0;function d(e){if(XX(e))return e;const t=h[e.type];return null==t&&FY("Unsupported type: "+e.type),t(e)}const h={Literal:e=>e.raw,Identifier:e=>{const i=e.name;return c>0?i:LX(n,i)?FY("Illegal identifier: "+i):LX(r,i)?r[i]:LX(t,i)?i:(l[i]=1,s(i))},MemberExpression:e=>{const t=!e.computed,n=d(e.object);t&&(c+=1);const r=d(e.property);return n===o&&(u[function(e){const t=e&&e.length-1;return t&&('"'===e[0]&&'"'===e[t]||"'"===e[0]&&"'"===e[t])?e.slice(1,-1):e}(r)]=1),t&&(c-=1),n+(t?"."+r:"["+r+"]")},CallExpression:e=>{"Identifier"!==e.callee.type&&FY("Illegal callee type: "+e.callee.type);const t=e.callee.name,n=e.arguments,r=LX(i,t)&&i[t];return r||FY("Unrecognized function: "+t),kX(r)?r(n):r+"("+n.map(d).join(",")+")"},ArrayExpression:e=>"["+e.elements.map(d).join(",")+"]",BinaryExpression:e=>"("+d(e.left)+e.operator+d(e.right)+")",UnaryExpression:e=>"("+e.operator+d(e.argument)+")",ConditionalExpression:e=>"("+d(e.test)+"?"+d(e.consequent)+":"+d(e.alternate)+")",LogicalExpression:e=>"("+d(e.left)+e.operator+d(e.right)+")",ObjectExpression:e=>"{"+e.properties.map(d).join(",")+"}",Property:e=>{c+=1;const t=d(e.key);return c-=1,t+":"+d(e.value)}};function f(e){const t={code:d(e),globals:Object.keys(l),fields:Object.keys(u)};return l={},u={},t}return f.functions=i,f.constants=r,f}(Dye);function Nye(e,t,n){return 1===arguments.length?Cye[e]:(Cye[e]=t,n&&(Aye[e]=n),Mye&&(Mye.functions[e]=Oye+e),this)}function jye(e,t){const n={};let r;try{r=_ge(e=XX(e)?e:rK(e)+"")}catch(rBe){FY("Expression parse error: "+e)}r.visit(e=>{if(e.type!==wme)return;const r=e.callee.name,i=Dye.visitors[r];i&&i(r,e.arguments,t,n)});const i=Mye(r);return i.globals.forEach(e=>{const r="$"+e;!LX(n,r)&&t.getSignal(e)&&(n[r]=t.signalRef(e))}),{$expr:jX({code:i.code},t.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}Nye("bandwidth",(function(e,t){const n=fye(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}),dye),Nye("copy",(function(e,t){const n=fye(e,(t||this).context);return n?n.copy():void 0}),dye),Nye("domain",(function(e,t){const n=fye(e,(t||this).context);return n?n.domain():[]}),dye),Nye("range",(function(e,t){const n=fye(e,(t||this).context);return n&&n.range?n.range():[]}),dye),Nye("invert",(function(e,t,n){const r=fye(e,(n||this).context);return r?QY(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0}),dye),Nye("scale",(function(e,t,n){const r=fye(e,(n||this).context);return r?r(t):void 0}),dye),Nye("gradient",(function(e,t,n,r,i){e=fye(e,(i||this).context);const a=Pte(t,n);let o=e.domain(),s=o[0],l=aX(o),u=zY;return l-s?u=ote(e,s,l):e=(e.interpolator?Gee("sequential")().interpolator(e.interpolator()):Gee("linear")().interpolate(e.interpolate()).range(e.range())).domain([s=0,l=1]),e.ticks&&(o=e.ticks(+r||15),s!==o[0]&&o.unshift(s),l!==aX(o)&&o.push(l)),o.forEach(t=>a.stop(u(t),e(t))),a}),dye),Nye("geoArea",mye,dye),Nye("geoBounds",gye,dye),Nye("geoCentroid",vye,dye),Nye("geoShape",(function(e,t,n){const r=fye(e,(n||this).context);return function(e){return r?r.path.context(e)(t):""}}),dye),Nye("indata",(function(e,t,n){const r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i?i.count:i}),(function(e,t,n,r){t[0].type!==xme&&FY("First argument to indata must be a string literal."),t[1].type!==xme&&FY("Second argument to indata must be a string literal.");const i=t[0].value,a=t[1].value,o="@"+a;LX(o,r)||(r[o]=n.getData(i).indataRef(n,a))})),Nye("data",tye,cye),Nye("treePath",(function(e,t,n){const r=Tye(e,this),i=r[t],a=r[n];return i&&a?i.path(a).map(Eye):void 0}),cye),Nye("treeAncestors",(function(e,t){const n=Tye(e,this)[t];return n?n.ancestors().map(Eye):void 0}),cye),Nye("vlSelectionTest",(function(e,t,n){for(var r,i,a,o,s,l=this.context.data[e],u=l?l.values.value:[],c=l?l[Zve]&&l[Zve].value:void 0,d=n===Xve,h=u.length,f=0;f<h;++f)if(r=u[f],c&&d){if(-1===(a=(i=i||{})[o=r.unit]||0))continue;if(s=Jve(t,r),i[o]=s?-1:++a,s&&1===c.size)return!0;if(!s&&a===c.get(o).count)return!1}else if(d^(s=Jve(t,r)))return s;return h&&d}),eye),Nye("vlSelectionResolve",(function(e,t,n){for(var r,i,a,o,s,l,u,c,d,h,f=this.context.data[e],p=f?f.values.value:[],m={},g={},v={},y=p.length,b=0;b<y;++b){for(o=(r=p[b]).unit,a=r.values,d=0,h=(i=r.fields).length;d<h;++d)u=(l=m[(s=i[d]).field]||(m[s.field]={}))[o]||(l[o]=[]),v[s.field]=c=s.type.charAt(0),l[o]=(0,Qve[c+"_union"])(u,EX(a[d]));n&&(u=g[o]||(g[o]=[])).push(EX(a).reduce((e,t,n)=>(e[i[n].field]=t,e),{}))}return t=t||Kve,Object.keys(m).forEach(e=>{m[e]=Object.keys(m[e]).map(t=>m[e][t]).reduce((n,r)=>void 0===n?r:Qve[v[e]+"_"+t](n,r))}),p=Object.keys(g),n&&p.length&&(m.vlMulti=t===Kve?{or:p.reduce((e,t)=>(e.push(...g[t]),e),[])}:{and:p.map(e=>({or:g[e]}))}),m}),eye);const Rye=lK(["rule"]),Pye=lK(["group","image","rect"]);function Fye(e){return(e+"").toLowerCase()}function Lye(e,t,n){";"!==n[n.length-1]&&(n="return("+n+");");const r=Function(...t.concat(n));return e&&e.functions?r.bind(e.functions):r}var $ye={operator:(e,t)=>Lye(e,["_"],t.code),parameter:(e,t)=>Lye(e,["datum","_"],t.code),event:(e,t)=>Lye(e,["event"],t.code),handler:(e,t)=>Lye(e,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(t.code,";")),encode:(e,t)=>{const{marktype:n,channels:r}=t;let i="var o=item,datum=o.datum,m=0,$;";for(const a in r){const e="o["+rK(a)+"]";i+="$=".concat(r[a].code,";if(").concat(e,"!==$)").concat(e,"=$,m=1;")}return i+=function(e,t){let n="";return Rye[t]||(e.x2&&(e.x?(Pye[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(Pye[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(r,n),i+="return m;",Lye(e,["item","_"],i)},codegen:{get(e){const t="[".concat(e.map(rK).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const r=Function("a","b","var u, v; return "+e.map((e,r)=>{const i=t[r];let a,o;return e.path?(a="a".concat(e.path),o="b".concat(e.path)):((n=n||{})["f"+r]=e,a="this.f".concat(r,"(a)"),o="this.f".concat(r,"(b)")),function(e,t,n,r){return"((u = ".concat(e,") < (v = ").concat(t,") || u == null) && v != null ? ").concat(n,"\n  : (u > v || v == null) && u != null ? ").concat(r,"\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ").concat(n,"\n  : v !== v && u === u ? ").concat(r," : ")}(a,o,-i,i)}).join("")+"0;");return n?r.bind(n):r}}};function Bye(e,t,n){if(!e||!eX(e))return e;for(let r,i=0,a=zye.length;i<a;++i)if(r=zye[i],LX(e,r.key))return r.parse(e,t,n);return e}var zye=[{key:"$ref",parse:function(e,t){return t.get(e.$ref)||FY("Operator not defined: "+e.$ref)}},{key:"$key",parse:function(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=KX(e.$key,e.$flat,t.expr.codegen))}},{key:"$expr",parse:function(e,t,n){e.$params&&t.parseParameters(e.$params,n);const r="e:"+e.$expr.code+"_"+e.$name;return t.fn[r]||(t.fn[r]=DY(t.parameterExpression(e.$expr),e.$fields,e.$name))}},{key:"$field",parse:function(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=$Y(e.$field,e.$name,t.expr.codegen))}},{key:"$encode",parse:function(e,t){const n=e.$encode,r={};for(const i in n){const e=n[i];r[i]=DY(t.encodeExpression(e.$expr),e.$fields),r[i].output=e.$output}return r}},{key:"$compare",parse:function(e,t){const n="c:"+e.$compare+"_"+e.$order,r=EX(e.$compare).map(e=>e&&e.$tupleid?p1:e);return t.fn[n]||(t.fn[n]=CX(r,e.$order,t.expr.codegen))}},{key:"$context",parse:function(e,t){return t}},{key:"$subflow",parse:function(e,t){const n=e.$subflow;return function(e,r,i){const a=t.fork().parse(n),o=a.get(n.operators[0].id),s=a.signals.parent;return s&&s.set(i),o.detachSubflow=()=>t.detach(a),o}}},{key:"$tupleid",parse:function(){return p1}}];const Uye={skip:!0};function Hye(e,t,n,r){return new Wye(e,t,n,r)}function Wye(e,t,n,r){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=r||$ye,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function Vye(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}Wye.prototype=Vye.prototype={fork(){const e=new Vye(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(t=>t!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,r=n.dataflow,i=e.value;if(n.set(e.id,t),"collect"===Fye(e.type)&&i&&(i.$ingest?r.ingest(t,i.$ingest,i.$format):i.$request?r.preload(t,i.$request,i.$format):r.pulse(t,r.changeset().insert(i))),e.root&&(n.root=t),e.parent){let i=n.get(e.parent.$ref);i?(r.connect(i,[t]),t.targets().add(i)):(n.unresolved=n.unresolved||[]).push(()=>{i=n.get(e.parent.$ref),r.connect(i,[t]),t.targets().add(i)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const a in e.data){const r=n.data[a]||(n.data[a]={});e.data[a].forEach(e=>r[e]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[Fye(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:function(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(e=>t.parseOperator(e)),n.forEach(e=>t.parseOperatorParameters(e)),(e.streams||[]).forEach(e=>t.parseStream(e)),(e.updates||[]).forEach(e=>t.parseUpdate(e)),t.resolve()},parseOperator:function(e){const t=this;"operator"!==Fye(e.type)&&e.type?t.transform(e,e.type):t.operator(e,e.update?t.operatorExpression(e.update):null)},parseOperatorParameters:function(e){const t=this;if(e.params){const n=t.get(e.id);n||FY("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}},parseParameters:function(e,t){t=t||{};const n=this;for(const r in e){const i=e[r];t[r]=QY(i)?i.map(e=>Bye(e,n,t)):Bye(i,n,t)}return t},parseStream:function(e){var t,n=this,r=null!=e.filter?n.eventExpression(e.filter):void 0,i=null!=e.stream?n.get(e.stream):void 0;e.source?i=n.events(e.source,e.type,r):e.merge&&(i=(t=e.merge.map(e=>n.get(e)))[0].merge.apply(t[0],t.slice(1))),e.between&&(t=e.between.map(e=>n.get(e)),i=i.between(t[0],t[1])),e.filter&&(i=i.filter(r)),null!=e.throttle&&(i=i.throttle(+e.throttle)),null!=e.debounce&&(i=i.debounce(+e.debounce)),null==i&&FY("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),n.stream(e,i)},parseUpdate:function(e){var t,n=this,r=eX(r=e.source)?r.$ref:r,i=n.get(r),a=e.update,o=void 0;i||FY("Source not defined: "+e.source),t=e.target&&e.target.$expr?n.eventExpression(e.target.$expr):n.get(e.target),a&&a.$expr&&(a.$params&&(o=n.parseParameters(a.$params)),a=n.handlerExpression(a.$expr)),n.update(e,i,t,a,o)},getState:function(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach(n=>{const i=t.signals[n];e.signals(n,i)&&(r[n]=i.value)})}if(e.data){var i=n.data={};Object.keys(t.data).forEach(n=>{const r=t.data[n];e.data(n,r)&&(i[n]=r.input.value)})}return t.subcontext&&!1!==e.recurse&&(n.subcontext=t.subcontext.map(t=>t.getState(e))),n},setState:function(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach(e=>{n.update(t.signals[e],i[e],Uye)}),Object.keys(r||{}).forEach(e=>{n.pulse(t.data[e].input,n.changeset().remove(WY).insert(r[e]))}),(e.subcontext||[]).forEach((e,n)=>{const r=t.subcontext[n];r&&r.setState(e)})}};var qye,Gye,Yye=0,Xye=0,Kye=0,Zye=0,Jye=0,Qye=0,ebe="object"==typeof performance&&performance.now?performance:Date,tbe="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function nbe(){return Jye||(tbe(rbe),Jye=ebe.now()+Qye)}function rbe(){Jye=0}function ibe(){this._call=this._time=this._next=null}function abe(){Jye=(Zye=ebe.now())+Qye,Yye=Xye=0;try{!function(){nbe(),++Yye;for(var e,t=qye;t;)(e=Jye-t._time)>=0&&t._call.call(null,e),t=t._next;--Yye}()}finally{Yye=0,function(){for(var e,t,n=qye,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:qye=t);Gye=e,sbe(r)}(),Jye=0}}function obe(){var e=ebe.now(),t=e-Zye;t>1e3&&(Qye-=t,Zye=e)}function sbe(e){Yye||(Xye&&(Xye=clearTimeout(Xye)),e-Jye>24?(e<1/0&&(Xye=setTimeout(abe,e-ebe.now()-Qye)),Kye&&(Kye=clearInterval(Kye))):(Kye||(Zye=ebe.now(),Kye=setInterval(obe,1e3)),Yye=1,tbe(abe)))}function lbe(e,t){e&&(null==t?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}ibe.prototype=(function(e,t,n){var r=new ibe;return r.restart(e,t,n),r}).prototype={constructor:ibe,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?nbe():+n)+(null==t?0:+t),this._next||Gye===this||(Gye?Gye._next=this:qye=this,Gye=this),this._call=e,this._time=n,sbe()},stop:function(){this._call&&(this._call=null,this._time=1/0,sbe())}};const ube="default";function cbe(e,t){const n=e.globalCursor()?"undefined"!=typeof document&&document.body:e.container();if(n)return null==t?n.style.removeProperty("cursor"):n.style.cursor=t}function dbe(e,t){var n=e._runtime.data;return LX(n,t)||FY("Unrecognized data set: "+t),n[t]}function hbe(e,t){w1(t)||FY("Second argument to changes must be a changeset.");const n=dbe(this,e);return n.modified=!0,this.pulse(n.input,t)}function fbe(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function pbe(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function mbe(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}const gbe="view",vbe={trap:!1};function ybe(e,t,n){const r=e._eventConfig&&e._eventConfig[t];return!(!1===r||eX(r)&&!r[n])||(e.warn("Blocked ".concat(t," ").concat(n," event listener.")),!1)}function bbe(e){return e.item}function xbe(e){return e.item.mark.source}function wbe(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function _be(e,t,n){const r=document.createElement(e);for(const i in t)r.setAttribute(i,t[i]);return null!=n&&(r.textContent=n),r}function Sbe(e,t,n,r){const i=_be("input");for(const a in n)"signal"!==a&&"element"!==a&&i.setAttribute("input"===a?"type":a,n[a]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",()=>e.update(i.value)),e.elements=[i],e.set=e=>i.value=e}function Ebe(e,t,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const a=_be("input",i);t.appendChild(a),a.addEventListener("change",()=>e.update(a.checked)),e.elements=[a],e.set=e=>a.checked=!!e||null}function Tbe(e,t,n,r){const i=_be("select",{name:n.signal}),a=n.labels||[];n.options.forEach((e,t)=>{const n={value:e};Ibe(e,r)&&(n.selected=!0),i.appendChild(_be("option",n,(a[t]||e)+""))}),t.appendChild(i),i.addEventListener("change",()=>{e.update(n.options[i.selectedIndex])}),e.elements=[i],e.set=e=>{for(let t=0,r=n.options.length;t<r;++t)if(Ibe(n.options[t],e))return void(i.selectedIndex=t)}}function kbe(e,t,n,r){const i=_be("span",{class:"vega-bind-radio"}),a=n.labels||[];t.appendChild(i),e.elements=n.options.map((t,o)=>{const s={type:"radio",name:n.signal,value:t};Ibe(t,r)&&(s.checked=!0);const l=_be("input",s);l.addEventListener("change",()=>e.update(t));const u=_be("label",{},(a[o]||t)+"");return u.prepend(l),i.appendChild(u),l}),e.set=t=>{const n=e.elements,r=n.length;for(let e=0;e<r;++e)Ibe(n[e].value,t)&&(n[e].checked=!0)}}function Cbe(e,t,n,r){r=void 0!==r?r:(+n.max+ +n.min)/2;const i=null!=n.max?n.max:Math.max(100,+r)||100,a=n.min||Math.min(0,i,+r)||0,o=n.step||QK(a,i,100),s=_be("input",{type:"range",name:n.signal,min:a,max:i,step:o});s.value=r;const l=_be("span",{},+r);t.appendChild(s),t.appendChild(l);const u=()=>{l.textContent=s.value,e.update(+s.value)};s.addEventListener("input",u),s.addEventListener("change",u),e.elements=[s],e.set=e=>{s.value=e,l.textContent=e}}function Ibe(e,t){return e===t||e+""==t+""}function Obe(e,t,n,r,i,a){return(t=t||new r(e.loader())).initialize(n,fbe(e),pbe(e),mbe(e),i,a).background(e.background())}function Abe(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function Dbe(e,t){if("string"==typeof t){if("undefined"==typeof document)return e.error("DOM document instance not found."),null;if(!(t=document.querySelector(t)))return e.error("Signal bind element not found: "+t),null}if(t)try{t.innerHTML=""}catch(n){t=null,e.error(n)}return t}const Mbe=e=>+e||0;function Nbe(e){return eX(e)?{top:Mbe(e.top),bottom:Mbe(e.bottom),left:Mbe(e.left),right:Mbe(e.right)}:(e=>({top:e,bottom:e,left:e,right:e}))(Mbe(e))}async function jbe(e,t,n,r){const i=Yae(t),a=i&&i.headless;return a||FY("Unrecognized renderer type: "+t),await e.runAsync(),Obe(e,null,null,a,n,r).renderAsync(e._scenegraph.root)}var Rbe="padding",Pbe={skip:!0};function Fbe(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===Rbe?r.left+r.right:0)}function Lbe(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===Rbe?r.top+r.bottom:0)}function $be(e,t){return t.modified&&QY(t.input.value)&&e.indexOf("_:vega:_")}function Bbe(e,t){return!("parent"===e||t instanceof G1.proxy)}function zbe(e,t,n,r){const i=e.element();i&&i.setAttribute("title",function(e){return null==e?"":QY(e)?Ube(e):eX(e)&&!VX(e)?(t=e,Object.keys(t).map(e=>{const n=t[e];return e+": "+(QY(n)?Ube(n):Hbe(n))}).join("\n")):e+"";var t}(r))}function Ube(e){return"["+e.map(Hbe).join(", ")+"]"}function Hbe(e){return QY(e)?"[\u2026]":eX(e)&&!VX(e)?"{\u2026}":e}function Wbe(e,t){const n=this;if(t=t||{},W1.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),null!=t.logLevel&&n.logLevel(t.logLevel),t.locale||e.locale){const r=jX({},e.locale,t.locale);n.locale(i1(r.number,r.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||qae.Canvas,n._scenegraph=new Aie;const r=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||zbe,n._redraw=!0,n._handler=(new nae).scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(e){const t=jX({defaults:{}},e),n=(e,t)=>{t.forEach(t=>{QY(e[t])&&(e[t]=lK(e[t]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=function(e,t,n){return Hye(e,G1,Cye,n).parse(t)}(n,e,t.expr);n._runtime=i,n._signals=i.signals,n._bind=(e.bindings||[]).map(e=>({state:null,param:jX({},e)})),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=Fbe(n,n._width),n._viewHeight=Lbe(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(e){var t=e._signals,n=t.width,r=t.height,i=t.padding;function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,t=>{e._width=t.size,e._viewWidth=Fbe(e,t.size),a()},{size:n}),e._resizeHeight=e.add(null,t=>{e._height=t.size,e._viewHeight=Lbe(e,t.size),a()},{size:r});const o=e.add(null,a,{pad:i});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=r.rank+1,o.rank=i.rank+1}(n),function(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}(n),function(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:ube,item:null}));e.on(e.events("view","mousemove"),t,(e,n)=>{const r=t.value,i=r?XX(r)?r:r.user:ube,a=n.item&&n.item.cursor||null;return r&&i===r.user&&a==r.item?r:{user:i,item:a}}),e.add(null,(function(t){let n=t.cursor,r=this.value;return XX(n)||(r=n.item,n=n.user),cbe(e,n&&n!==ube?n:r||n),r}),{cursor:t})}(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function Vbe(e,t){return LX(e._signals,t)?e._signals[t]:FY("Unrecognized signal name: "+rK(t))}function qbe(e,t){const n=(e._targets||[]).filter(e=>e._update&&e._update.handler===t);return n.length?n[0]:null}function Gbe(e,t,n,r){let i=qbe(n,r);return i||(i=Abe(e,()=>r(t,n.value)),i.handler=r,e.on(n,null,i)),e}function Ybe(e,t,n){const r=qbe(t,n);return r&&t._targets.remove(r),e}UX(Wbe,W1,{async evaluate(e,t,n){if(await W1.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,i=mbe(r=this),a=fbe(r),o=pbe(r),r._renderer.background(r.background()),r._renderer.resize(a,o,i),r._handler.origin(i),r._resizeListeners.forEach(e=>{try{e(a,o)}catch(t){r.error(t)}})),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(s){this.error(s)}var r,i,a,o;return n&&c1(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=null!=e?e+"":null;return t!==this._desc&&lbe(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const r=Vbe(this,e);return 1===arguments.length?r.value:this.update(r,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",Nbe(e)):Nbe(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(Yae(e)||FY("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(W1.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(Vbe(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(e,t,n,r,i,a){this.runAfter(o=>{let s=0;o._autosize=0,o.width()!==n&&(s=1,o.signal("width",n,Pbe),o._resizeWidth.skip(!0)),o.height()!==r&&(s=1,o.signal("height",r,Pbe),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),o._origin[0]===i[0]&&o._origin[1]===i[1]||(o._resize=1,o._origin=i),s&&o.run("enter"),a&&o.runAfter(e=>e.resize())},!1,1)},addEventListener(e,t,n){let r=t;return n&&!1===n.trap||(r=Abe(this,t),r.raw=t),this._handler.on(e,r),this},removeEventListener(e,t){for(var n,r,i=this._handler.handlers(e),a=i.length;--a>=0;)if(n=i[a].handler,e===(r=i[a].type)&&(t===n||t===n.raw)){this._handler.off(r,n);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return Gbe(this,e,Vbe(this,e),t)},removeSignalListener(e,t){return Ybe(this,Vbe(this,e),t)},addDataListener(e,t){return Gbe(this,e,dbe(this,e).values,t)},removeDataListener(e,t){return Ybe(this,dbe(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=cbe(this,null);this._globalCursor=!!e,t&&cbe(this,t)}return this}return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:function(e,t){this._timers.push(function(e,t,n){var r=new ibe,i=t;return null==t?(r.restart(e,t,n),r):(r._restart=r.restart,r.restart=function(e,t,n){t=+t,n=null==n?nbe():+n,r._restart((function a(o){o+=i,r._restart(a,i+=t,n),e(o)}),t,n)},r.restart(e,t,n),r)}((function(t){e({timestamp:Date.now(),elapsed:t})}),t))},events:function(e,t,n){var r,i=this,a=new A1(n),o=function(n,r){i.runAsync(null,()=>{e===gbe&&function(e,t){var n=e._eventConfig.defaults,r=n.prevent,i=n.allow;return!1!==r&&!0!==i&&(!0===r||!1===i||(r?r[t]:i?!i[t]:e.preventDefault()))}(i,t)&&n.preventDefault(),a.receive(function(e,t,n){var r,i,a=e._renderer,o=a&&a.canvas();return o&&(i=mbe(e),(r=Fie(t.changedTouches?t.changedTouches[0]:t,o))[0]-=i[0],r[1]-=i[1]),t.dataflow=e,t.item=n,t.vega=function(e,t,n){const r=t?"group"===t.mark.marktype?t:t.mark.group:null;function i(e){var n,i=r;if(e)for(n=t;n;n=n.mark.group)if(n.mark.name===e){i=n;break}return i&&i.mark&&i.mark.interactive?i:{}}function a(e){if(!e)return n;XX(e)&&(e=i(e));const t=n.slice();for(;e;)t[0]-=e.x||0,t[1]-=e.y||0,e=e.mark&&e.mark.group;return t}return{view:MX(e),item:MX(t||{}),group:i,xy:a,x:function(e){return a(e)[0]},y:function(e){return a(e)[1]}}}(e,n,r),t}(i,n,r))})};if("timer"===e)ybe(i,"timer",t)&&i.timer(o,t);else if(e===gbe)ybe(i,"view",t)&&i.addEventListener(t,o,vbe);else if("window"===e?ybe(i,"window",t)&&"undefined"!=typeof window&&(r=[window]):"undefined"!=typeof document&&ybe(i,"selector",t)&&(r=document.querySelectorAll(e)),r){for(var s=0,l=r.length;s<l;++s)r[s].addEventListener(t,o);i._eventListeners.push({type:t,sources:r,handler:o})}else i.warn("Can not resolve event source: "+e);return a},finalize:function(){var e,t,n,r=this._tooltip,i=this._timers,a=this._eventListeners;for(e=i.length;--e>=0;)i[e].stop();for(e=a.length;--e>=0;)for(t=(n=a[e]).sources.length;--t>=0;)n.sources[t].removeEventListener(n.type,n.handler);return r&&r.call(this,this._handler,null,null,null),this},hover:function(e,t){return t=[t||"update",(e=[e||"hover"])[0]],this.on(this.events("view","mouseover",bbe),xbe,wbe(e)),this.on(this.events("view","mouseout",bbe),xbe,wbe(t)),this},data:function(e,t){return arguments.length<2?dbe(this,e).values.value:hbe.call(this,e,_1().remove(WY).insert(t))},change:hbe,insert:function(e,t){return hbe.call(this,e,_1().insert(t))},remove:function(e,t){return hbe.call(this,e,_1().remove(t))},scale:function(e){var t=this._runtime.scales;return LX(t,e)||FY("Unrecognized scale or projection: "+e),t[e].value},initialize:function(e,t){const n=this,r=n._renderType,i=n._eventConfig.bind,a=Yae(r);e=n._el=e?Dbe(n,e):null,function(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),lbe(t,e.description()))}(n),a||n.error("Unrecognized renderer type: "+r);const o=a.handler||nae,s=e?a.renderer:a.headless;return n._renderer=s?Obe(n,n._renderer,e,s):null,n._handler=function(e,t,n,r){const i=new r(e.loader(),Abe(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,mbe(e),e);return t&&t.handlers().forEach(e=>{i.on(e.type,e.handler)}),i}(n,n._handler,e,o),n._redraw=!0,e&&"none"!==i&&(t=t?n._elBind=Dbe(n,t):e.appendChild(_be("form",{class:"vega-bindings"})),n._bind.forEach(e=>{e.param.element&&"container"!==i&&(e.element=Dbe(n,e.param.element))}),n._bind.forEach(e=>{!function(e,t,n){if(!t)return;const r=n.param;let i=n.state;i||(i=n.state={elements:null,active:!1,set:null,update:t=>{t!==e.signal(r.signal)&&e.runAsync(null,()=>{i.source=!0,e.signal(r.signal,t)})}},r.debounce&&(i.update=NX(r.debounce,i.update))),function(e,t,n,r){const i=_be("div",{class:"vega-bind"}),a="radio"===n.input?i:i.appendChild(_be("label"));a.appendChild(_be("span",{class:"vega-bind-name"},n.name||n.signal)),t.appendChild(i);let o=Sbe;switch(n.input){case"checkbox":o=Ebe;break;case"select":o=Tbe;break;case"radio":o=kbe;break;case"range":o=Cbe}o(e,a,n,r)}(i,t,r,e.signal(r.signal)),i.active||(e.on(e._signals[r.signal],null,()=>{i.source?i.source=!1:i.set(e.signal(r.signal))}),i.active=!0)}(n,e.element||t,e)})),n},toImageURL:async function(e,t){e!==qae.Canvas&&e!==qae.SVG&&e!==qae.PNG&&FY("Unrecognized image type: "+e);const n=await jbe(this,e,t);return e===qae.SVG?function(e,t){const n=new Blob([e],{type:"image/svg+xml"});return window.URL.createObjectURL(n)}(n.svg()):n.canvas().toDataURL("image/png")},toCanvas:async function(e,t){return(await jbe(this,qae.Canvas,e,t)).canvas()},toSVG:async function(e){return(await jbe(this,qae.SVG,e)).svg()},getState:function(e){return this._runtime.getState(e||{data:$be,signals:Bbe,recurse:!0})},setState:function(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},e=>{e._trigger=!0}),this}});const Xbe=/[[\]{}]/,Kbe={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let Zbe,Jbe;function Qbe(e,t,n){return Zbe=t||"view",Jbe=n||Kbe,txe(e.trim()).map(nxe)}function exe(e,t,n,r,i){const a=e.length;let o,s=0;for(;t<a;++t){if(o=e[t],!s&&o===n)return t;i&&i.indexOf(o)>=0?--s:r&&r.indexOf(o)>=0&&++s}return t}function txe(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=exe(e,i,",","[{","]}"),t.push(e.substring(r,i).trim()),r=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function nxe(e){return"["===e[0]?function(e){const t=e.length;let n,r=1;if(r=exe(e,r,"]","[","]"),r===t)throw"Empty between selector: "+e;if(n=txe(e.substring(1,r)),2!==n.length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(r+1).trim())[0])throw"Expected '>' after between selector: "+e;n=n.map(nxe);const i=nxe(e.slice(1).trim());return i.between?{between:n,stream:i}:(i.between=n,i)}(e):function(e){const t={source:Zbe},n=[];let r,i,a=[0,0],o=0,s=0,l=e.length,u=0;if("}"===e[l-1]){if(u=e.lastIndexOf("{"),!(u>=0))throw"Unmatched right brace: "+e;try{a=function(e){const t=e.split(",");if(!e.length||t.length>2)throw e;return t.map(t=>{const n=+t;if(n!=n)throw e;return n})}(e.substring(u+1,l-1))}catch(c){throw"Invalid throttle specification: "+e}l=(e=e.slice(0,u).trim()).length,u=0}if(!l)throw e;if("@"===e[0]&&(o=++u),r=exe(e,u,":"),r<l&&(n.push(e.substring(s,r).trim()),s=u=++r),u=exe(e,u,"["),u===l)n.push(e.substring(s,l).trim());else if(n.push(e.substring(s,u).trim()),i=[],s=++u,s===l)throw"Unmatched left bracket: "+e;for(;u<l;){if(u=exe(e,u,"]"),u===l)throw"Unmatched left bracket: "+e;if(i.push(e.substring(s,u).trim()),u<l-1&&"["!==e[++u])throw"Expected left bracket: "+e;s=++u}if(!(l=n.length)||Xbe.test(n[l-1]))throw"Invalid event selector: "+e;return l>1?(t.type=n[1],o?t.markname=n[0].slice(1):Jbe[n[0]]?t.marktype=n[0]:t.source=n[0]):t.type=n[0],"!"===t.type.slice(-1)&&(t.consume=!0,t.type=t.type.slice(0,-1)),null!=i&&(t.filter=i),a[0]&&(t.throttle=a[0]),a[1]&&(t.debounce=a[1]),t}(e)}function rxe(e){return eX(e)?e:{type:e||"pad"}}const ixe=e=>+e||0;function axe(e){return eX(e)?e.signal?e:{top:ixe(e.top),bottom:ixe(e.bottom),left:ixe(e.left),right:ixe(e.right)}:{top:t=ixe(e),bottom:t,left:t,right:t};var t}const oxe=e=>eX(e)&&!QY(e)?jX({},e):{value:e};function sxe(e,t,n,r){return null!=n?(eX(n)&&!QY(n)||QY(n)&&n.length&&eX(n[0])?e.update[t]=n:e[r||"enter"][t]={value:n},1):0}function lxe(e,t,n){for(const r in t)sxe(e,r,t[r]);for(const r in n)sxe(e,r,n[r],"update")}function uxe(e,t,n){for(const r in t)n&&LX(n,r)||(e[r]=jX(e[r]||{},t[r]));return e}function cxe(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const dxe="mark",hxe="frame",fxe="scope",pxe="legend-label";function mxe(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const gxe=e=>XX(e)?rK(e):e.signal?"(".concat(e.signal,")"):xxe(e);function vxe(e){if(null!=e.gradient)return function(e){const t=[e.start,e.stop,e.count].map(e=>null==e?null:rK(e));for(;t.length&&null==aX(t);)t.pop();return t.unshift(gxe(e.gradient)),"gradient(".concat(t.join(","),")")}(e);let t=e.signal?"(".concat(e.signal,")"):e.color?function(e){return e.c?yxe("hcl",e.h,e.c,e.l):e.h||e.s?yxe("hsl",e.h,e.s,e.l):e.l||e.a?yxe("lab",e.l,e.a,e.b):e.r||e.g||e.b?yxe("rgb",e.r,e.g,e.b):null}(e.color):null!=e.field?xxe(e.field):void 0!==e.value?rK(e.value):void 0;return null!=e.scale&&(t=function(e,t){const n=gxe(e.scale);return null!=e.range?t="lerp(_range(".concat(n,"), ").concat(+e.range,")"):(void 0!==t&&(t="_scale(".concat(n,", ").concat(t,")")),e.band&&(t=(t?t+"+":"")+"_bandwidth(".concat(n,")")+(1==+e.band?"":"*"+bxe(e.band)),e.extra&&(t="(datum.extra ? _scale(".concat(n,", datum.extra.value) : ").concat(t,")"))),null==t&&(t="0")),t}(e,t)),void 0===t&&(t=null),null!=e.exponent&&(t="pow(".concat(t,",").concat(bxe(e.exponent),")")),null!=e.mult&&(t+="*".concat(bxe(e.mult))),null!=e.offset&&(t+="+".concat(bxe(e.offset))),e.round&&(t="round(".concat(t,")")),t}const yxe=(e,t,n,r)=>"(".concat(e,"(").concat([t,n,r].map(vxe).join(","),")+'')");function bxe(e){return eX(e)?"("+vxe(e)+")":e}function xxe(e){return function e(t){let n,r,i;if(t.signal)n="datum",i=t.signal;else if(t.group||t.parent){for(r=Math.max(1,t.level||1),n="item";r-- >0;)n+=".mark.group";t.parent?(i=t.parent,n+=".datum"):i=t.group}else t.datum?(n="datum",i=t.datum):FY("Invalid field reference: "+rK(t));return t.signal||(i=XX(i)?LY(i).map(rK).join("]["):e(i)),n+"["+i+"]"}(eX(e)?e:{datum:e})}function wxe(e,t,n,r,i,a){const o={};(a=a||{}).encoders={$encode:o},e=function(e,t,n,r,i){const a={},o={};let s,l,u,c;for(l in l="lineBreak","text"!==t||null==i[l]||cxe(l,e)||mxe(a,l,i[l]),("legend"==n||String(n).startsWith("axis"))&&(n=null),c=n===hxe?i.group:n===dxe?jX({},i.mark,i[t]):null,c)u=cxe(l,e)||("fill"===l||"stroke"===l)&&(cxe("fill",e)||cxe("stroke",e)),u||mxe(a,l,c[l]);for(l in EX(r).forEach(t=>{const n=i.style&&i.style[t];for(const r in n)cxe(r,e)||mxe(a,r,n[r])}),e=jX({},e),a)c=a[l],c.signal?(s=s||{})[l]=c:o[l]=c;return e.enter=jX(o,e.enter),s&&(e.update=jX(s,e.update)),e}(e,t,n,r,i.config);for(const s in e)o[s]=_xe(e[s],t,a,i);return a}function _xe(e,t,n,r){const i={},a={};for(const s in e)null!=e[s]&&(i[s]=Sxe(QY(o=e[s])?function(e){let t="";return e.forEach(e=>{const n=vxe(e);t+=e.test?"(".concat(e.test,")?").concat(n,":"):n}),":"===aX(t)&&(t+="null"),t}(o):vxe(o),r,n,a));var o;return{$expr:{marktype:t,channels:i},$fields:Object.keys(a),$output:Object.keys(e)}}function Sxe(e,t,n,r){const i=jye(e,t);return i.$fields.forEach(e=>r[e]=1),jX(n,i.$params),i.$expr}const Exe=["value","update","init","react","bind"];function Txe(e,t){FY(e+' for "outer" push: '+rK(t))}function kxe(e,t){const n=e.name;if("outer"===e.push)t.signals[n]||Txe("No prior signal definition",n),Exe.forEach(t=>{void 0!==e[t]&&Txe("Invalid property ",t)});else{const r=t.addSignal(n,e.value);!1===e.react&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}}function Cxe(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function Ixe(e,t,n,r){return new Cxe(e,t,n,r)}function Oxe(e,t){return Ixe("operator",e,t)}function Axe(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function Dxe(e,t){return t?{$field:e,$name:t}:{$field:e}}const Mxe=Dxe("key");function Nxe(e,t){return{$compare:e,$order:t}}function jxe(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const Rxe="scope",Pxe="view";function Fxe(e){return e&&e.signal}function Lxe(e){if(Fxe(e))return!0;if(eX(e))for(const t in e)if(Lxe(e[t]))return!0;return!1}function $xe(e,t){return null!=e?e:t}function Bxe(e){return e&&e.signal||e}const zxe="timer";function Uxe(e,t){return(e.merge?Hxe:e.stream?Wxe:e.type?Vxe:FY("Invalid stream specification: "+rK(e)))(e,t)}function Hxe(e,t){const n=qxe({merge:e.merge.map(e=>Uxe(e,t))},e,t);return t.addStream(n).id}function Wxe(e,t){const n=qxe({stream:Uxe(e.stream,t)},e,t);return t.addStream(n).id}function Vxe(e,t){let n;var r;e.type===zxe?(n=t.event(zxe,e.throttle),e={between:e.between,filter:e.filter}):n=t.event((r=e.source)===Rxe?Pxe:r||Pxe,e.type);const i=qxe({stream:n},e,t);return 1===Object.keys(i).length?n:t.addStream(i).id}function qxe(e,t,n){let r=t.between;return r&&(2!==r.length&&FY('Stream "between" parameter must have 2 entries: '+rK(t)),e.between=[Uxe(r[0],n),Uxe(r[1],n)]),r=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&r.push(function(e,t,n){const r="event.item";return r+(e&&"*"!==e?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}(t.marktype,t.markname,t.markrole)),t.source===Rxe&&r.push("inScope(event.item)"),r.length&&(e.filter=jye("("+r.join(")&&(")+")",n).$expr),null!=(r=t.throttle)&&(e.throttle=+r),null!=(r=t.debounce)&&(e.debounce=+r),t.consume&&(e.consume=!0),e}const Gxe={code:"_.$value",ast:{type:"Identifier",value:"value"}};function Yxe(e){return{signal:"["+e.map(e=>e.scale?'scale("'+e.scale+'")':e.signal)+"]"}}const Xxe=e=>(t,n,r)=>Ixe(e,n,t||void 0,r),Kxe=Xxe("aggregate"),Zxe=Xxe("axisticks"),Jxe=Xxe("bound"),Qxe=Xxe("collect"),ewe=Xxe("compare"),twe=Xxe("datajoin"),nwe=Xxe("encode"),rwe=Xxe("expression"),iwe=Xxe("facet"),awe=Xxe("field"),owe=Xxe("key"),swe=Xxe("legendentries"),lwe=Xxe("load"),uwe=Xxe("mark"),cwe=Xxe("multiextent"),dwe=Xxe("multivalues"),hwe=Xxe("overlap"),fwe=Xxe("params"),pwe=Xxe("prefacet"),mwe=Xxe("projection"),gwe=Xxe("proxy"),vwe=Xxe("relay"),ywe=Xxe("render"),bwe=Xxe("scale"),xwe=Xxe("sieve"),wwe=Xxe("sortitems"),_we=Xxe("viewlayout"),Swe=Xxe("values");let Ewe=0;const Twe={min:"min",max:"max",count:"sum"};function kwe(e,t){return eX(e)?e.signal?t.signalRef(e.signal):FY("Unsupported object: "+rK(e)):e}function Cwe(e,t){return e.signal?t.signalRef(e.signal):e.map(e=>kwe(e,t))}function Iwe(e){FY("Can not find data set: "+rK(e))}function Owe(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(QY(e)?Awe:e.fields?Mwe:Dwe)(e,t,n);null==t.domainMin&&null==t.domainMax||FY("No scale domain defined for domainMin/domainMax to override.")}function Awe(e,t,n){return e.map(e=>kwe(e,n))}function Dwe(e,t,n){const r=n.getData(e.data);return r||Iwe(e.data),Zee(t.type)?r.valuesRef(n,e.field,jwe(e.sort,!1)):tte(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function Mwe(e,t,n){const r=e.data,i=e.fields.reduce((e,t)=>(t=XX(t)?{data:r,field:t}:QY(t)||t.signal?function(e,t){const n="_:vega:_"+Ewe++,r=Qxe({});if(QY(e))r.value={$ingest:e};else if(e.signal){const i="setdata("+rK(n)+","+e.signal+")";r.params.input=t.signalRef(i)}return t.addDataPipeline(n,[r,xwe({})]),{data:n,field:"data"}}(t,n):t,e.push(t),e),[]);return(Zee(t.type)?Nwe:tte(t.type)?Rwe:Pwe)(e,n,i)}function Nwe(e,t,n){const r=jwe(e.sort,!0);let i,a;const o=n.map(e=>{const n=t.getData(e.data);return n||Iwe(e.data),n.countsRef(t,e.field,r)}),s={groupby:Mxe,pulse:o};r&&(i=r.op||"count",a=r.field?jxe(i,r.field):"count",s.ops=[Twe[i]],s.fields=[t.fieldRef(a)],s.as=[a]),i=t.add(Kxe(s));const l=t.add(Qxe({pulse:Axe(i)}));return a=t.add(Swe({field:Mxe,sort:t.sortRef(r),pulse:Axe(l)})),Axe(a)}function jwe(e,t){return e&&(e.field||e.op?e.field||"count"===e.op?t&&e.field&&e.op&&!Twe[e.op]&&FY("Multiple domain scales can not be sorted using "+e.op):FY("No field provided for sort aggregate op: "+e.op):eX(e)?e.field="key":e={field:"key"}),e}function Rwe(e,t,n){const r=n.map(e=>{const n=t.getData(e.data);return n||Iwe(e.data),n.domainRef(t,e.field)});return Axe(t.add(dwe({values:r})))}function Pwe(e,t,n){const r=n.map(e=>{const n=t.getData(e.data);return n||Iwe(e.data),n.extentRef(t,e.field)});return Axe(t.add(cwe({extents:r})))}function Fwe(e,t,n){return QY(e)?e.map(e=>Fwe(e,t,n)):eX(e)?e.signal?n.signalRef(e.signal):"fit"===t?e:FY("Unsupported parameter object: "+rK(e)):e}const Lwe="top",$we="left",Bwe="right",zwe="bottom",Uwe="center",Hwe="index",Wwe="label",Vwe="perc",qwe="value",Gwe="guide-label",Ywe="guide-title",Xwe="symbol",Kwe="gradient",Zwe="discrete",Jwe="size",Qwe=[Jwe,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],e_e={name:1,style:1,interactive:1},t_e={value:0},n_e={value:1},r_e="group",i_e="rect",a_e="rule",o_e="text";function s_e(e){return e.type=r_e,e.interactive=e.interactive||!1,e}function l_e(e,t){const n=(n,r)=>$xe(e[n],$xe(t[n],r));return n.isVertical=n=>"vertical"===$xe(e.direction,t.direction||(n?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>$xe(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>$xe(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>$xe(e.columns,$xe(t.columns,+n.isVertical(!0))),n}function u_e(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function c_e(e,t,n){return"item.anchor === '".concat("start","' ? ").concat(e," : item.anchor === '").concat("end","' ? ").concat(t," : ").concat(n)}const d_e=c_e(rK($we),rK(Bwe),rK(Uwe));function h_e(e,t){return t?e?eX(e)?Object.assign({},e,{offset:h_e(e.offset,t)}):{value:e,offset:t}:t:e}function f_e(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=uxe(e.encode,t,e_e)):e.interactive=!1,e}function p_e(e,t,n,r){const i=l_e(e,n),a=i.isVertical(),o=i.gradientThickness(),s=i.gradientLength();let l,u,c,d,h;a?(u=[0,1],c=[0,0],d=o,h=s):(u=[0,0],c=[1,0],d=s,h=o);const f={enter:l={opacity:t_e,x:t_e,y:t_e,width:oxe(d),height:oxe(h)},update:jX({},l,{opacity:n_e,fill:{gradient:t,start:u,stop:c}}),exit:{opacity:t_e}};return lxe(f,{stroke:i("gradientStrokeColor"),strokeWidth:i("gradientStrokeWidth")},{opacity:i("gradientOpacity")}),f_e({type:i_e,role:"legend-gradient",encode:f},r)}function m_e(e,t,n,r,i){const a=l_e(e,n),o=a.isVertical(),s=a.gradientThickness(),l=a.gradientLength();let u,c,d,h,f="";o?(u="y",d="y2",c="x",h="width",f="1-"):(u="x",d="x2",c="y",h="height");const p={opacity:t_e,fill:{scale:t,field:qwe}};p[u]={signal:f+"datum."+Vwe,mult:l},p[c]=t_e,p[d]={signal:f+"datum.perc2",mult:l},p[h]=oxe(s);const m={enter:p,update:jX({},p,{opacity:n_e}),exit:{opacity:t_e}};return lxe(m,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),f_e({type:i_e,role:"legend-band",key:qwe,from:i,encode:m},r)}const g_e="datum.".concat(Vwe,'<=0?"').concat($we,'":datum.').concat(Vwe,'>=1?"').concat(Bwe,'":"').concat(Uwe,'"'),v_e="datum.".concat(Vwe,'<=0?"').concat(zwe,'":datum.').concat(Vwe,'>=1?"').concat(Lwe,'":"').concat("middle",'"');function y_e(e,t,n,r){const i=l_e(e,t),a=i.isVertical(),o=oxe(i.gradientThickness()),s=i.gradientLength();let l,u,c,d,h=i("labelOverlap"),f="";const p={enter:l={opacity:t_e},update:u={opacity:n_e,text:{field:Wwe}},exit:{opacity:t_e}};return lxe(p,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:$xe(e.labelLimit,t.gradientLabelLimit)}),a?(l.align={value:"left"},l.baseline=u.baseline={signal:v_e},c="y",d="x",f="1-"):(l.align=u.align={signal:g_e},l.baseline={value:"top"},c="x",d="y"),l[c]=u[c]={signal:f+"datum."+Vwe,mult:s},l[d]=u[d]=o,o.offset=$xe(e.labelOffset,t.gradientLabelOffset)||0,h=h?{separation:i("labelSeparation"),method:h,order:"datum.index"}:void 0,f_e({type:o_e,role:pxe,style:Gwe,key:qwe,from:r,encode:p,overlap:h},n)}function b_e(e,t,n,r,i){const a=l_e(e,t),o=n.entries,s=!(!o||!o.interactive),l=o?o.name:void 0,u=a("clipHeight"),c=a("symbolOffset"),d={data:"value"},h="(".concat(i,") ? datum.").concat("offset"," : datum.").concat(Jwe),f=u?oxe(u):{field:Jwe},p="datum.".concat(Hwe),m="max(1, ".concat(i,")");let g,v,y,b,x;f.mult=.5,g={enter:v={opacity:t_e,x:{signal:h,mult:.5,offset:c},y:f},update:y={opacity:n_e,x:v.x,y:v.y},exit:{opacity:t_e}};let w=null,_=null;e.fill||(w=t.symbolBaseFillColor,_=t.symbolBaseStrokeColor),lxe(g,{fill:a("symbolFillColor",w),shape:a("symbolType"),size:a("symbolSize"),stroke:a("symbolStrokeColor",_),strokeDash:a("symbolDash"),strokeDashOffset:a("symbolDashOffset"),strokeWidth:a("symbolStrokeWidth")},{opacity:a("symbolOpacity")}),Qwe.forEach(t=>{e[t]&&(y[t]=v[t]={scale:e[t],field:qwe})});const S=f_e({type:"symbol",role:"legend-symbol",key:qwe,from:d,clip:!!u||void 0,encode:g},n.symbols),E=oxe(c);E.offset=a("labelOffset"),g={enter:v={opacity:t_e,x:{signal:h,offset:E},y:f},update:y={opacity:n_e,text:{field:Wwe},x:v.x,y:v.y},exit:{opacity:t_e}},lxe(g,{align:a("labelAlign"),baseline:a("labelBaseline"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:a("labelLimit")});const T=f_e({type:o_e,role:pxe,style:Gwe,key:qwe,from:d,encode:g},n.labels);return g={enter:{noBound:{value:!u},width:t_e,height:u?oxe(u):t_e,opacity:t_e},exit:{opacity:t_e},update:y={opacity:n_e,row:{signal:null},column:{signal:null}}},a.isVertical(!0)?(b="ceil(item.mark.items.length / ".concat(m,")"),y.row.signal="".concat(p,"%").concat(b),y.column.signal="floor(".concat(p," / ").concat(b,")"),x={field:["row",p]}):(y.row.signal="floor(".concat(p," / ").concat(m,")"),y.column.signal="".concat(p," % ").concat(m),x={field:p}),y.column.signal="(".concat(i,")?").concat(y.column.signal,":").concat(p),s_e({role:fxe,from:r={facet:{data:r,name:"value",groupby:Hwe}},encode:uxe(g,o,e_e),marks:[S,T],name:l,interactive:s,sort:x})}const x_e='item.orient === "left"',w_e='item.orient === "right"',__e="(".concat(x_e," || ").concat(w_e,")"),S_e="datum.vgrad && ".concat(__e),E_e=c_e('"top"','"bottom"','"middle"'),T_e=c_e('"right"','"left"','"center"'),k_e="datum.vgrad && ".concat(w_e," ? (").concat(T_e,") : (").concat(__e," && !(datum.vgrad && ").concat(x_e,')) ? "left" : ').concat(d_e),C_e="item._anchor || (".concat(__e,' ? "middle" : "start")'),I_e="".concat(S_e," ? (").concat(x_e," ? -90 : 90) : 0"),O_e="".concat(__e," ? (datum.vgrad ? (").concat(w_e,' ? "bottom" : "top") : ').concat(E_e,') : "top"');function A_e(e,t){let n;return eX(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+D_e(e.path)+")":e.sphere&&(n="geoShape("+D_e(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function D_e(e){return eX(e)&&e.signal?e.signal:rK(e)}function M_e(e){const t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?e.type===r_e?fxe:t||dxe:t}function N_e(e){return{marktype:e.type,name:e.name||void 0,role:e.role||M_e(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function j_e(e,t){return e&&e.signal?t.signalRef(e.signal):!1!==e}function R_e(e,t){const n=Y1(e.type);n||FY("Unrecognized transform type: "+rK(e.type));const r=Ixe(n.type.toLowerCase(),null,P_e(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function P_e(e,t,n){const r={},i=e.params.length;for(let a=0;a<i;++a){const i=e.params[a];r[i.name]=F_e(i,t,n)}return r}function F_e(e,t,n){const r=e.type,i=t[e.name];return"index"===r?function(e,t,n){return XX(t.from)||FY('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}(0,t,n):void 0!==i?"param"===r?function(e,t,n){const r=t[e.name];return e.array?(QY(r)||FY("Expected an array of sub-parameters. Instead: "+rK(r)),r.map(t=>$_e(e,t,n))):$_e(e,r,n)}(e,t,n):"projection"===r?n.projectionRef(t[e.name]):e.array&&!Fxe(i)?i.map(t=>L_e(e,t,n)):L_e(e,i,n):void(e.required&&FY("Missing required "+rK(t.type)+" parameter: "+rK(e.name)))}function L_e(e,t,n){const r=e.type;if(Fxe(t))return H_e(r)?FY("Expression references can not be signals."):W_e(r)?n.fieldRef(t):V_e(r)?n.compareRef(t):n.signalRef(t.signal);{const i=e.expr||W_e(r);return i&&B_e(t)?n.exprRef(t.expr,t.as):i&&z_e(t)?Dxe(t.field,t.as):H_e(r)?jye(t,n):U_e(r)?Axe(n.getData(t).values):W_e(r)?Dxe(t):V_e(r)?n.compareRef(t):t}}function $_e(e,t,n){const r=e.params.length;let i;for(let o=0;o<r;++o){i=e.params[o];for(const e in i.key)if(i.key[e]!==t[e]){i=null;break}if(i)break}i||FY("Unsupported parameter: "+rK(t));const a=jX(P_e(i,t,n),i.key);return Axe(n.add(fwe(a)))}const B_e=e=>e&&e.expr,z_e=e=>e&&e.field,U_e=e=>"data"===e,H_e=e=>"expr"===e,W_e=e=>"field"===e,V_e=e=>"compare"===e;function q_e(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:Axe(t.getData(e.data).output)}function G_e(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}function Y_e(e){return XX(e)?e:null}function X_e(e,t,n){const r=jxe(n.op,n.field);let i;if(t.ops){for(let a=0,o=t.as.length;a<o;++a)if(t.as[a]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function K_e(e,t,n,r,i,a,o){const s=t[n]||(t[n]={}),l=function(e){return eX(e)?("descending"===e.order?"-":"+")+jxe(e.op,e.field):""}(a);let u,c,d=Y_e(i);if(null!=d&&(e=t.scope,d+=l?"|"+l:"",u=s[d]),!u){const n=a?{field:Mxe,pulse:t.countsRef(e,i,a)}:{field:e.fieldRef(i),pulse:Axe(t.output)};l&&(n.sort=e.sortRef(a)),c=e.add(Ixe(r,void 0,n)),o&&(t.index[i]=c),u=Axe(c),null!=d&&(s[d]=u)}return u}function Z_e(e,t,n){const r=e.remove,i=e.insert,a=e.toggle,o=e.modify,s=e.values,l=t.add(Oxe()),u=jye("if("+e.trigger+',modify("'+n+'",'+[i,r,a,o,s].map(e=>null==e?"null":e).join(",")+"),0)",t);l.update=u.$expr,l.params=u.$params}function J_e(e,t){const n=M_e(e),r=e.type===r_e,i=e.from&&e.from.facet,a=e.overlap;let o,s,l,u,c,d,h,f=e.layout||n===fxe||n===hxe;const p=n===dxe||f||i,m=function(e,t,n){let r,i,a,o,s;return e?(r=e.facet)&&(t||FY("Only group marks can be faceted."),null!=r.field?o=s=q_e(r,n):(e.data?s=Axe(n.getData(e.data).aggregate):(a=R_e(jX({type:"aggregate",groupby:EX(r.groupby)},r.aggregate),n),a.params.key=n.keyRef(r.groupby),a.params.pulse=q_e(r,n),o=s=Axe(n.add(a))),i=n.keyRef(r.groupby,!0))):o=Axe(n.add(Qxe(null,[{}]))),o||(o=q_e(e,n)),{key:i,pulse:o,parent:s}}(e.from,r,t);s=t.add(twe({key:m.key||(e.key?Dxe(e.key):void 0),pulse:m.pulse,clean:!r}));const g=Axe(s);s=l=t.add(Qxe({pulse:g})),s=t.add(uwe({markdef:N_e(e),interactive:j_e(e.interactive,t),clip:A_e(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:Axe(s)}));const v=Axe(s);s=u=t.add(nwe(wxe(e.encode,e.type,n,e.style,t,{mod:!1,pulse:v}))),s.params.parent=t.encode(),e.transform&&e.transform.forEach(e=>{const n=R_e(e,t),r=n.metadata;(r.generates||r.changes)&&FY("Mark transforms should not generate new data."),r.nomod||(u.params.mod=!0),n.params.pulse=Axe(s),t.add(s=n)}),e.sort&&(s=t.add(wwe({sort:t.compareRef(e.sort),pulse:Axe(s)})));const y=Axe(s);(i||f)&&(f=t.add(_we({layout:t.objectProperty(e.layout),legends:t.legends,mark:v,pulse:y})),d=Axe(f));const b=t.add(Jxe({mark:v,pulse:d||y}));h=Axe(b),r&&(p&&(o=t.operators,o.pop(),f&&o.pop()),t.pushState(y,d||h,g),i?function(e,t,n){const r=e.from.facet,i=r.name,a=q_e(r,t);let o;r.name||FY("Facet must have a name: "+rK(r)),r.data||FY("Facet must reference a data set: "+rK(r)),r.field?o=t.add(pwe({field:t.fieldRef(r.field),pulse:a})):r.groupby?o=t.add(iwe({key:t.keyRef(r.groupby),group:Axe(t.proxy(n.parent)),pulse:a})):FY("Facet must specify groupby or field: "+rK(r));const s=t.fork(),l=s.add(Qxe()),u=s.add(xwe({pulse:Axe(l)}));s.addData(i,new G_e(s,l,l,u)),s.addSignal("parent",null),o.params.subflow={$subflow:s.parse(e).toRuntime()}}(e,t,m):p?function(e,t,n){const r=t.add(pwe({pulse:n.pulse})),i=t.fork();i.add(xwe()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(e).toRuntime()}}(e,t,m):t.parse(e),t.popState(),p&&(f&&o.push(f),o.push(b))),a&&(h=function(e,t,n){const r=e.method,i=e.bound,a=e.separation,o={separation:Fxe(a)?n.signalRef(a.signal):a,method:Fxe(r)?n.signalRef(r.signal):r,pulse:t};if(e.order&&(o.sort=n.compareRef({field:e.order})),i){const e=i.tolerance;o.boundTolerance=Fxe(e)?n.signalRef(e.signal):+e,o.boundScale=n.scaleRef(i.scale),o.boundOrient=i.orient}return Axe(n.add(hwe(o)))}(a,h,t));const x=t.add(ywe({pulse:h})),w=t.add(xwe({pulse:Axe(x)},void 0,t.parent()));null!=e.name&&(c=e.name,t.addData(c,new G_e(t,l,x,w)),e.on&&e.on.forEach(e=>{(e.insert||e.remove||e.toggle)&&FY("Marks only support modify triggers."),Z_e(e,t,c)}))}function Q_e(e,t,n){const r={enter:{},update:{}};return lxe(r,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),r}function eSe(e,t,n){return t[e]?'scale("'.concat(t[e],'",datum)'):u_e(e,n[0].encode)}G_e.fromEntries=function(e,t){const n=t.length,r=t[n-1],i=t[n-2];let a=t[0],o=null,s=1;for(a&&"load"===a.type&&(a=t[1]),e.add(t[0]);s<n;++s)t[s].params.pulse=Axe(t[s-1]),e.add(t[s]),"aggregate"===t[s].type&&(o=t[s]);return new G_e(e,a,i,r,o)},G_e.prototype={countsRef(e,t,n){const r=this,i=r.counts||(r.counts={}),a=Y_e(t);let o,s,l;return null!=a&&(e=r.scope,o=i[a]),o?n&&n.field&&X_e(e,o.agg.params,n):(l={groupby:e.fieldRef(t,"key"),pulse:Axe(r.output)},n&&n.field&&X_e(e,l,n),s=e.add(Kxe(l)),o=e.add(Qxe({pulse:Axe(s)})),o={agg:s,ref:Axe(o)},null!=a&&(i[a]=o)),o.ref},tuplesRef(){return Axe(this.values)},extentRef(e,t){return K_e(e,this,"extent","extent",t,!1)},domainRef(e,t){return K_e(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return K_e(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return K_e(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return K_e(e,this,"indata","tupleindex",t,!0,!0)}};const tSe='item.orient==="'.concat($we,'"?-90:item.orient==="').concat(Bwe,'"?90:0');function nSe(e,t){const n={enter:{},update:{}};return lxe(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:d_e},angle:{signal:tSe},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),uxe(n,t,e_e)}function rSe(e){const t=Qxe({},e);return t.metadata={source:!0},t}function iSe(e,t){return lwe({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const aSe=e=>e===zwe||e===Lwe,oSe=(e,t,n)=>Fxe(e)?hSe(e.signal,t,n):e===$we||e===Lwe?t:n,sSe=(e,t,n)=>Fxe(e)?cSe(e.signal,t,n):aSe(e)?t:n,lSe=(e,t,n)=>Fxe(e)?dSe(e.signal,t,n):aSe(e)?n:t,uSe=(e,t,n)=>Fxe(e)?fSe(e.signal,t,n):e===Lwe?{value:t}:{value:n},cSe=(e,t,n)=>pSe("".concat(e," === '").concat(Lwe,"' || ").concat(e," === '").concat(zwe,"'"),t,n),dSe=(e,t,n)=>pSe("".concat(e," !== '").concat(Lwe,"' && ").concat(e," !== '").concat(zwe,"'"),t,n),hSe=(e,t,n)=>gSe("".concat(e," === '").concat($we,"' || ").concat(e," === '").concat(Lwe,"'"),t,n),fSe=(e,t,n)=>gSe("".concat(e," === '").concat(Lwe,"'"),t,n),pSe=(e,t,n)=>(t=null!=t?oxe(t):t,n=null!=n?oxe(n):n,mSe(t)&&mSe(n)?(t=t?t.signal||rK(t.value):null,n=n?n.signal||rK(n.value):null,{signal:"".concat(e," ? (").concat(t,") : (").concat(n,")")}):[jX({test:e},t)].concat(n||[])),mSe=e=>null==e||1===Object.keys(e).length,gSe=(e,t,n)=>({signal:"".concat(e," ? (").concat(vSe(t),") : (").concat(vSe(n),")")}),vSe=e=>Fxe(e)?e.signal:null==e?null:rK(e),ySe=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function bSe(e,t,n,r){let i;if(t&&LX(t,e))return t[e];if(LX(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r["guide-title"][i]}if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r["guide-label"][i]}return null}function xSe(e){const t={};for(const n of e)if(n)for(const e in n)t[e]=1;return Object.keys(t)}function wSe(e,t){return{scale:e.scale,range:t}}function _Se(e,t,n,r,i){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function SSe(e,t){const n=function(e,t){var n,r,i,a,o,s,l,u,c=t.config,d=c.style,h=c.axis,f="band"===t.scaleType(e.scale)&&c.axisBand,p=e.orient;if(Fxe(p)){const e=xSe([c.axisX,c.axisY]),t=xSe([c.axisTop,c.axisBottom,c.axisLeft,c.axisRight]);for(i of(n={},e))n[i]=sSe(p,bSe(i,c.axisX,h,d),bSe(i,c.axisY,h,d));for(i of(r={},t))r[i]=(a=p.signal,o=bSe(i,c.axisTop,h,d),s=bSe(i,c.axisBottom,h,d),l=bSe(i,c.axisLeft,h,d),u=bSe(i,c.axisRight,h,d),{signal:(null!=l?"".concat(a," === '").concat($we,"' ? (").concat(vSe(l),") : "):"")+(null!=s?"".concat(a," === '").concat(zwe,"' ? (").concat(vSe(s),") : "):"")+(null!=u?"".concat(a," === '").concat(Bwe,"' ? (").concat(vSe(u),") : "):"")+(null!=o?"".concat(a," === '").concat(Lwe,"' ? (").concat(vSe(o),") : "):"")+"(null)"})}else n=p===Lwe||p===zwe?c.axisX:c.axisY,r=c["axis"+p[0].toUpperCase()+p.slice(1)];return n||r||f?jX({},h,n,r,f):h}(e,t),r=e.encode||{},i=r.axis||{},a=i.name||void 0,o=i.interactive,s=i.style,l=l_e(e,n),u=function(e){const t=e("tickBand");let n,r,i=e("tickOffset");return t?t.signal?(n={signal:"(".concat(t.signal,") === 'extent' ? 1 : 0.5")},r={signal:"(".concat(t.signal,") === 'extent'")},eX(i)||(i={signal:"(".concat(t.signal,") === 'extent' ? 0 : ").concat(i)})):"extent"===t?(n=1,r=!0,i=0):(n=.5,r=!1):(n=e("bandPosition"),r=e("tickExtra")),{extra:r,band:n,offset:i}}(l),c={scale:e.scale,ticks:!!l("ticks"),labels:!!l("labels"),grid:!!l("grid"),domain:!!l("domain"),title:null!=e.title},d=Axe(t.add(Qxe({},[c]))),h=Axe(t.add(Zxe({scale:t.scaleRef(e.scale),extra:t.property(u.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),f=[];let p;return c.grid&&f.push(function(e,t,n,r,i){const a=l_e(e,t),o=e.orient,s=e.gridScale,l=oSe(o,1,-1),u=function(e,t){if(1===t);else if(eX(e)){let n=e=jX({},e);for(;null!=n.mult;){if(!eX(n.mult))return n.mult=Fxe(t)?{signal:"(".concat(n.mult,") * (").concat(t.signal,")")}:n.mult*t,e;n=n.mult=jX({},n.mult)}n.mult=t}else e=Fxe(t)?{signal:"(".concat(t.signal,") * (").concat(e||0,")")}:t*(e||0);return e}(e.offset,l);let c,d,h;const f={enter:c={opacity:t_e},update:h={opacity:n_e},exit:d={opacity:t_e}};lxe(f,{stroke:a("gridColor"),strokeCap:a("gridCap"),strokeDash:a("gridDash"),strokeDashOffset:a("gridDashOffset"),strokeOpacity:a("gridOpacity"),strokeWidth:a("gridWidth")});const p={scale:e.scale,field:qwe,band:i.band,extra:i.extra,offset:i.offset,round:a("tickRound")},m=sSe(o,{signal:"height"},{signal:"width"}),g=s?{scale:s,range:0,mult:l,offset:u}:{value:0,offset:u},v=s?{scale:s,range:1,mult:l,offset:u}:jX(m,{mult:l,offset:u});return c.x=h.x=sSe(o,p,g),c.y=h.y=lSe(o,p,g),c.x2=h.x2=lSe(o,v),c.y2=h.y2=sSe(o,v),d.x=sSe(o,p),d.y=lSe(o,p),f_e({type:a_e,role:"axis-grid",key:qwe,from:r,encode:f},n)}(e,n,r.grid,h,u)),c.ticks&&(p=l("tickSize"),f.push(function(e,t,n,r,i,a){const o=l_e(e,t),s=e.orient,l=oSe(s,-1,1);let u,c,d;const h={enter:u={opacity:t_e},update:d={opacity:n_e},exit:c={opacity:t_e}};lxe(h,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const f=oxe(i);f.mult=l;const p={scale:e.scale,field:qwe,band:a.band,extra:a.extra,offset:a.offset,round:o("tickRound")};return d.y=u.y=sSe(s,t_e,p),d.y2=u.y2=sSe(s,f),c.x=sSe(s,p),d.x=u.x=lSe(s,t_e,p),d.x2=u.x2=lSe(s,f),c.y=lSe(s,p),f_e({type:a_e,role:"axis-tick",key:qwe,from:r,encode:h},n)}(e,n,r.ticks,h,p,u))),c.labels&&(p=c.ticks?p:0,f.push(function(e,t,n,r,i,a){const o=l_e(e,t),s=e.orient,l=e.scale,u=oSe(s,-1,1),c=Bxe(o("labelFlush")),d=Bxe(o("labelFlushOffset")),h=o("labelAlign"),f=o("labelBaseline");let p,m=0===c||!!c;const g=oxe(i);g.mult=u,g.offset=oxe(o("labelPadding")||0),g.offset.mult=u;const v={scale:l,field:qwe,band:.5,offset:h_e(a.offset,o("labelOffset"))},y=sSe(s,m?_Se(l,c,'"left"','"right"','"center"'):{value:"center"},((e,t,n)=>Fxe(e)?gSe("".concat(e.signal," === '").concat(Bwe,"'"),"left","right"):e===Bwe?{value:t}:{value:n})(s,"left","right")),b=sSe(s,uSe(s,"bottom","top"),m?_Se(l,c,'"top"','"bottom"','"middle"'):{value:"middle"}),x=_Se(l,c,"-(".concat(d,")"),d,0);m=m&&d;const w={opacity:t_e,x:sSe(s,v,g),y:lSe(s,v,g)},_={enter:w,update:p={opacity:n_e,text:{field:Wwe},x:w.x,y:w.y,align:y,baseline:b},exit:{opacity:t_e,x:w.x,y:w.y}};lxe(_,{dx:!h&&m?sSe(s,x):null,dy:!f&&m?lSe(s,x):null}),lxe(_,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:h,baseline:f});const S=o("labelBound");let E=o("labelOverlap");return E=E||S?{separation:o("labelSeparation"),method:E,order:"datum.index",bound:S?{scale:l,orient:s,tolerance:S}:null}:void 0,p.align!==y&&(p.align=ySe(p.align,y)),p.baseline!==b&&(p.baseline=ySe(p.baseline,b)),f_e({type:o_e,role:"axis-label",style:Gwe,key:qwe,from:r,encode:_,overlap:E},n)}(e,n,r.labels,h,p,u))),c.domain&&f.push(function(e,t,n,r){const i=l_e(e,t),a=e.orient;let o,s;const l={enter:o={opacity:t_e},update:s={opacity:n_e},exit:{opacity:t_e}};lxe(l,{stroke:i("domainColor"),strokeCap:i("domainCap"),strokeDash:i("domainDash"),strokeDashOffset:i("domainDashOffset"),strokeWidth:i("domainWidth"),strokeOpacity:i("domainOpacity")});const u=wSe(e,0),c=wSe(e,1);return o.x=s.x=sSe(a,u,t_e),o.x2=s.x2=sSe(a,c),o.y=s.y=lSe(a,u,t_e),o.y2=s.y2=lSe(a,c),f_e({type:a_e,role:"axis-domain",from:r,encode:l},n)}(e,n,r.domain,d)),c.title&&f.push(function(e,t,n,r){const i=l_e(e,t),a=e.orient,o=oSe(a,-1,1);let s,l;const u={enter:s={opacity:t_e,anchor:oxe(i("titleAnchor",null)),align:{signal:d_e}},update:l=jX({},s,{opacity:n_e,text:oxe(e.title)}),exit:{opacity:t_e}},c={signal:'lerp(range("'.concat(e.scale,'"), ').concat(c_e(0,1,.5),")")};return l.x=sSe(a,c),l.y=lSe(a,c),s.angle=sSe(a,t_e,((e,t)=>Fxe(e)?{signal:"(".concat(e.signal,") * ").concat(90)}:{value:90*e})(o)),s.baseline=sSe(a,uSe(a,zwe,Lwe),{value:zwe}),l.angle=s.angle,l.baseline=s.baseline,lxe(u,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),function(e,t,n,r){const i=(e,t)=>null!=e?(n.update[t]=ySe(oxe(e),n.update[t]),!1):!cxe(t,r),a=i(e("titleX"),"x"),o=i(e("titleY"),"y");n.enter.auto=o===a?oxe(o):sSe(t,oxe(o),oxe(a))}(i,a,u,n),u.update.align=ySe(u.update.align,s.align),u.update.angle=ySe(u.update.angle,s.angle),u.update.baseline=ySe(u.update.baseline,s.baseline),f_e({type:o_e,role:"axis-title",style:Ywe,from:r,encode:u},n)}(e,n,r.title,d)),J_e(s_e({role:"axis",from:d,encode:uxe(ESe(l,e),i,e_e),marks:f,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:a,interactive:o,style:s}),t)}function ESe(e,t){const n={enter:{},update:{}};return lxe(n,{orient:e("orient"),offset:e("offset")||0,position:$xe(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:'abs(span(range("'.concat(t.scale,'")))')},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function TSe(e,t,n){const r=EX(e.signals),i=EX(e.scales);return n||r.forEach(e=>kxe(e,t)),EX(e.projections).forEach(e=>function(e,t){const n=t.config.projection||{},r={};for(const i in e)"name"!==i&&(r[i]=Fwe(e[i],i,t));for(const i in n)null==r[i]&&(r[i]=Fwe(n[i],i,t));t.addProjection(e.name,r)}(e,t)),i.forEach(e=>function(e,t){const n=e.type||"linear";Yee(n)||FY("Unrecognized scale type: "+rK(n)),t.addScale(e.name,{type:n,domain:void 0})}(e,t)),EX(e.data).forEach(e=>function(e,t){const n=[];e.transform&&e.transform.forEach(e=>{n.push(R_e(e,t))}),e.on&&e.on.forEach(n=>{Z_e(n,t,e.name)}),t.addDataPipeline(e.name,function(e,t,n){const r=[];let i,a,o,s,l,u=null,c=!1,d=!1;for(e.values?Lxe(e.values)||Lxe(e.format)?(r.push(iSe(t,e)),r.push(u=rSe())):r.push(u=rSe({$ingest:e.values,$format:e.format})):e.url?Lxe(e.url)||Lxe(e.format)?(r.push(iSe(t,e)),r.push(u=rSe())):r.push(u=rSe({$request:e.url,$format:e.format})):e.source&&(u=i=EX(e.source).map(e=>Axe(t.getData(e).output)),r.push(null)),a=0,o=n.length;a<o;++a)s=n[a],l=s.metadata,u||l.source||r.push(u=rSe()),r.push(s),l.generates&&(d=!0),l.modifies&&!d&&(c=!0),l.source?u=s:l.changes&&(u=null);return i&&(o=i.length-1,r[0]=vwe({derive:c,pulse:o?i:i[0]}),(c||o)&&r.splice(1,0,rSe())),u||r.push(rSe()),r.push(xwe({})),r}(e,t,n))}(e,t)),i.forEach(e=>function(e,t){const n=t.getScale(e.name).params;let r;var i;for(r in n.domain=Owe(e.domain,e,t),null!=e.range&&(n.range=function e(t,n,r){const i=n.config.range;let a=t.range;if(a.signal)return n.signalRef(a.signal);if(XX(a)){if(i&&LX(i,a))return e(t=jX({},t,{range:i[a]}),n,r);"width"===a?a=[0,{signal:"width"}]:"height"===a?a=Zee(t.type)?[0,{signal:"height"}]:[{signal:"height"},0]:FY("Unrecognized scale range value: "+rK(a))}else{if(a.scheme)return r.scheme=QY(a.scheme)?Cwe(a.scheme,n):kwe(a.scheme,n),a.extent&&(r.schemeExtent=Cwe(a.extent,n)),void(a.count&&(r.schemeCount=kwe(a.count,n)));if(a.step)return void(r.rangeStep=kwe(a.step,n));if(Zee(t.type)&&!QY(a))return Owe(a,t,n);QY(a)||FY("Unsupported range type: "+rK(a))}return a.map(e=>(QY(e)?Cwe:kwe)(e,n))}(e,t,n)),null!=e.interpolate&&function(e,t){t.interpolate=kwe(e.type||e),null!=e.gamma&&(t.interpolateGamma=kwe(e.gamma))}(e.interpolate,n),null!=e.nice&&(n.nice=eX(i=e.nice)?{interval:kwe(i.interval),step:kwe(i.step)}:kwe(i)),null!=e.bins&&(n.bins=function(e,t){return e.signal||QY(e)?Cwe(e,t):t.objectProperty(e)}(e.bins,t)),e)LX(n,r)||"name"===r||(n[r]=kwe(e[r],t))}(e,t)),(n||r).forEach(e=>function(e,t){const n=t.getSignal(e.name);let r=e.update;e.init&&(r?FY("Signals can not include both init and update expressions."):(r=e.init,n.initonly=!0)),r&&(r=jye(r,t),n.update=r.$expr,n.params=r.$params),e.on&&e.on.forEach(e=>function(e,t,n){const r=e.encode,i={target:n};let a=e.events,o=e.update,s=[];a||FY("Signal update missing events specification."),XX(a)&&(a=Qbe(a,t.isSubscope()?Rxe:Pxe)),a=EX(a).filter(e=>e.signal||e.scale?(s.push(e),0):1),s.length>1&&(s=[Yxe(s)]),a.length&&s.push(a.length>1?{merge:a}:a[0]),null!=r&&(o&&FY("Signal encode and update are mutually exclusive."),o="encode(item(),"+rK(r)+")"),i.update=XX(o)?jye(o,t):null!=o.expr?jye(o.expr,t):null!=o.value?o.value:null!=o.signal?{$expr:Gxe,$params:{$value:t.signalRef(o.signal)}}:FY("Invalid signal update specification."),e.force&&(i.options={force:!0}),s.forEach(e=>t.addUpdate(jX(function(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):Uxe(e,t)}}(e,t),i)))}(e,t,n.id))}(e,t)),EX(e.axes).forEach(e=>SSe(e,t)),EX(e.marks).forEach(e=>J_e(e,t)),EX(e.legends).forEach(e=>function(e,t){const n=t.config.legend,r=e.encode||{},i=l_e(e,n),a=r.legend||{},o=a.name||void 0,s=a.interactive,l=a.style,u={};let c,d,h,f=0;Qwe.forEach(t=>e[t]?(u[t]=e[t],f=f||e[t]):0),f||FY("Missing valid scale for legend.");const p=function(e,t){let n=e.type||Xwe;return e.type||1!==function(e){return Qwe.reduce((t,n)=>t+(e[n]?1:0),0)}(e)||!e.fill&&!e.stroke||(n=Kee(t)?Kwe:Jee(t)?Zwe:Xwe),n!==Kwe?n:Jee(t)?Zwe:Kwe}(e,t.scaleType(f)),m={title:null!=e.title,scales:u,type:p,vgrad:"symbol"!==p&&i.isVertical()},g=Axe(t.add(Qxe(null,[m]))),v=Axe(t.add(swe(d={type:p,scale:t.scaleRef(f),count:t.objectProperty(i("tickCount")),limit:t.property(i("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return p===Kwe?(h=[p_e(e,f,n,r.gradient),y_e(e,n,r.labels,v)],d.count=d.count||t.signalRef("max(2,2*floor((".concat(Bxe(i.gradientLength()),")/100))"))):p===Zwe?h=[m_e(e,f,n,r.gradient,v),y_e(e,n,r.labels,v)]:(c=function(e,t){const n=l_e(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(e,n),h=[b_e(e,n,r,v,Bxe(c.columns))],d.size=function(e,t,n){const r=Bxe(eSe("size",e,n)),i=Bxe(eSe("strokeWidth",e,n)),a=Bxe(function(e,t,n){return u_e("fontSize",e)||function(e,t,n){const r=t.config.style["guide-label"];return r&&r.fontSize}(0,t)}(n[1].encode,t));return jye("max(ceil(sqrt(".concat(r,")+").concat(i,"),").concat(a,")"),t)}(e,t,h[0].marks)),h=[s_e({role:"legend-entry",from:g,encode:{enter:{x:{value:0},y:{value:0}}},marks:h,layout:c,interactive:s})],m.title&&h.push(function(e,t,n,r){const i=l_e(e,t),a={enter:{opacity:t_e},update:{opacity:n_e,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:t_e}};return lxe(a,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:C_e},angle:{signal:I_e},align:{signal:k_e},baseline:{signal:O_e},text:e.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")}),f_e({type:o_e,role:"legend-title",style:Ywe,from:r,encode:a},n)}(e,n,r.title,g)),J_e(s_e({role:"legend",from:g,encode:uxe(Q_e(i,e,n),a,e_e),marks:h,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:o,interactive:s,style:l}),t)}(e,t)),e.title&&function(e,t){const n=l_e(e=XX(e)?{text:e}:e,t.config.title),r=e.encode||{},i=r.group||{},a=i.name||void 0,o=i.interactive,s=i.style,l=[],u=Axe(t.add(Qxe(null,[{}])));l.push(function(e,t,n,r){const i={value:0},a={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return lxe(a,{text:e.text,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),f_e({type:o_e,role:"title-text",style:"group-title",from:r,encode:a},n)}(e,n,function(e){const t=e.encode;return t&&t.title||jX({name:e.name,interactive:e.interactive,style:e.style},t)}(e),u)),e.subtitle&&l.push(function(e,t,n,r){const i={value:0},a={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return lxe(a,{text:e.subtitle,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),f_e({type:o_e,role:"title-subtitle",style:"group-subtitle",from:r,encode:a},n)}(e,n,r.subtitle,u)),J_e(s_e({role:"title",from:u,encode:nSe(n,i),marks:l,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:o,style:s}),t)}(e.title,t),t.parseLambdas(),t}function kSe(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function CSe(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function ISe(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function OSe(e){return(QY(e)?ASe:DSe)(e)}function ASe(e){const t=e.length;let n="[";for(let r=0;r<t;++r){const t=e[r];n+=(r>0?",":"")+(eX(t)?t.signal||OSe(t):rK(t))}return n+"]"}function DSe(e){let t,n,r="{",i=0;for(t in e)n=e[t],r+=(++i>1?",":"")+rK(t)+":"+(eX(n)?n.signal||OSe(n):rK(n));return r+"}"}function MSe(e,t,n){return eX(e)||FY("Input Vega specification must be an object."),function(e,t){const n=t.config,r=Axe(t.root=t.add(Oxe())),i=function(e,t){const n=n=>$xe(e[n],t[n]),r=[kSe("background",n("background")),kSe("autosize",rxe(n("autosize"))),kSe("padding",axe(n("padding"))),kSe("width",n("width")||0),kSe("height",n("height")||0)],i=r.reduce((e,t)=>(e[t.name]=t,e),{}),a={};return EX(e.signals).forEach(e=>{LX(i,e.name)?e=jX(i[e.name],e):r.push(e),a[e.name]=e}),EX(t.signals).forEach(e=>{LX(a,e.name)||LX(i,e.name)||r.push(e)}),r}(e,n);i.forEach(e=>kxe(e,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const a=t.add(Qxe()),o=t.add(nwe(wxe((e=>uxe({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e))(e.encode),r_e,hxe,e.style,t,{pulse:Axe(a)}))),s=t.add(_we({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:Axe(o)}));t.operators.pop(),t.pushState(Axe(o),Axe(s),null),TSe(e,t,i),t.operators.push(s);let l=t.add(Jxe({mark:r,pulse:Axe(s)}));return l=t.add(ywe({pulse:Axe(l)})),l=t.add(xwe({pulse:Axe(l)})),t.addData("root",new G_e(t,a,a,l)),t}(e,new CSe(t=nX(function(){const e="sans-serif",t="#4c78a8",n="#000",r="#888",i="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:t},area:{fill:t},image:null,line:{stroke:t,strokeWidth:2},path:{stroke:t},rect:{fill:t},rule:{stroke:n},shape:{stroke:t},symbol:{fill:t,size:64},text:{fill:n,font:e,fontSize:11},trail:{fill:t,size:2},style:{"guide-label":{fill:n,font:e,fontSize:10},"guide-title":{fill:n,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:n,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:n,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:i}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:r,grid:!1,gridWidth:1,gridColor:i,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:r,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:i,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:r,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}(),t,e.config),n)).toRuntime()}CSe.prototype=ISe.prototype={parse(e){return TSe(e,this)},fork(){return new ISe(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof Cxe?Axe(e):e;return this.add(gwe({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(e,t,n){let r,i;e&&(r=e.data||(e.data={}),i=r[t]||(r[t]=[]),i.push(n))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const r in t.index)n(t.index[r],e,"index:"+r)}return this},pushState(e,t,n){this._encode.push(Axe(this.add(xwe({pulse:e})))),this._parent.push(t),this._lookup.push(n?Axe(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return aX(this._parent)},encode(){return aX(this._encode)},lookup(){return aX(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(XX(e))return Dxe(e,t);e.signal||FY("Unsupported field reference: "+rK(e));const n=e.signal;let r=this.field[n];if(!r){const e={name:this.signalRef(n)};t&&(e.as=t),this.field[n]=r=Axe(this.add(awe(e)))}return r},compareRef(e){let t=!1;const n=e=>Fxe(e)?(t=!0,this.signalRef(e.signal)):function(e){return e&&e.expr}(e)?(t=!0,this.exprRef(e.expr)):e,r=EX(e.field).map(n),i=EX(e.order).map(n);return t?Axe(this.add(ewe({fields:r,orders:i}))):Nxe(r,i)},keyRef(e,t){let n=!1;const r=this.signals;return e=EX(e).map(e=>Fxe(e)?(n=!0,Axe(r[e.signal])):e),n?Axe(this.add(owe({fields:e,flat:t}))):function(e,t){const n={$key:e};return t&&(n.$flat=!0),n}(e,t)},sortRef(e){if(!e)return e;const t=jxe(e.op,e.field),n=e.order||"ascending";return n.signal?Axe(this.add(ewe({fields:t,orders:this.signalRef(n.signal)}))):Nxe(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},hasOwnSignal(e){return LX(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&FY("Duplicate signal name: "+rK(e));const n=t instanceof Cxe?t:this.add(Oxe(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||FY("Unrecognized signal name: "+rK(e)),this.signals[e]},signalRef(e){return this.signals[e]?Axe(this.signals[e]):(LX(this.lambdas,e)||(this.lambdas[e]=this.add(Oxe(null))),Axe(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const n=e[t],r=jye(n,this),i=this.lambdas[n];i.params=r.$params,i.update=r.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&eX(e)?this.signalRef(e.signal||OSe(e)):e},exprRef(e,t){const n={expr:jye(e,this)};return t&&(n.expr.$name=t),Axe(this.add(rwe(n)))},addBinding(e,t){this.bindings||FY("Nested signals do not support binding: "+rK(e)),this.bindings.push(jX({signal:e},t))},addScaleProj(e,t){LX(this.scales,e)&&FY("Duplicate scale or projection name: "+rK(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,bwe(t))},addProjection(e,t){this.addScaleProj(e,mwe(t))},getScale(e){return this.scales[e]||FY("Unrecognized scale name: "+rK(e)),this.scales[e]},scaleRef(e){return Axe(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return LX(this.data,e)&&FY("Duplicate data set name: "+rK(e)),this.data[e]=t},getData(e){return this.data[e]||FY("Undefined data set name: "+rK(e)),this.data[e]},addDataPipeline(e,t){return LX(this.data,e)&&FY("Duplicate data set name: "+rK(e)),this.addData(e,G_e.fromEntries(this,t))}};var NSe="5.17.0";jX(G1,q,Y,X,K,Z,Q,J,ee,te,ne,re);var jSe=n("qHvB");Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var RSe=n("JBAE"),PSe=n.n(RSe),FSe=n("aUsF"),LSe=n.n(FSe),$Se=n("9x6x"),BSe=n.n($Se);function zSe(e){return!!e.or}function USe(e){return!!e.and}function HSe(e){return!!e.not}function WSe(e,t){return HSe(e)?{not:WSe(e.not,t)}:USe(e)?{and:e.and.map(e=>WSe(e,t))}:zSe(e)?{or:e.or.map(e=>WSe(e,t))}:t(e)}const VSe=LSe.a,qSe=PSe.a;function GSe(e,t){const n={};for(const r of t)LX(e,r)&&(n[r]=e[r]);return n}function YSe(e,t){const n=Object.assign({},e);for(const r of t)delete n[r];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>BSe()(e)).join(",")})`};const XSe=BSe.a;function KSe(e){if(GX(e))return e;const t=XX(e)?e:BSe()(e);if(t.length<250)return t;let n=0;for(let r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r),n&=n;return n}function ZSe(e){return!1===e||null===e}function JSe(e,t){return e.indexOf(t)>-1}function QSe(e,t){let n=0;for(const[r,i]of e.entries())if(t(i,r,n++))return!0;return!1}function eEe(e,t){let n=0;for(const[r,i]of e.entries())if(!t(i,r,n++))return!1;return!0}function tEe(e,...t){for(const n of t)nEe(e,null!=n?n:{});return e}function nEe(e,t){for(const n of cEe(t))rX(e,n,t[n],!0)}function rEe(e,t){const n=[],r={};let i;for(const a of e)i=t(a),i in r||(r[i]=1,n.push(a));return n}function iEe(e,t){const n=cEe(e),r=cEe(t);if(n.length!==r.length)return!1;for(const i of n)if(e[i]!==t[i])return!1;return!0}function aEe(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function oEe(e,t){for(const n of e)if(t.has(n))return!0;return!1}function sEe(e){const t=new Set;for(const n of e){const e=LY(n).map((e,t)=>0===t?e:`[${e}]`),r=e.map((t,n)=>e.slice(0,n+1).join(""));for(const n of r)t.add(n)}return t}function lEe(e,t){return void 0===e||void 0===t||oEe(sEe(e),sEe(t))}function uEe(e){return 0===cEe(e).length}const cEe=Object.keys,dEe=Object.values,hEe=Object.entries;function fEe(e){return!0===e||!1===e}function pEe(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function mEe(e,t){return HSe(e)?"!("+mEe(e.not,t)+")":USe(e)?"("+e.and.map(e=>mEe(e,t)).join(") && (")+")":zSe(e)?"("+e.or.map(e=>mEe(e,t)).join(") || (")+")":t(e)}function gEe(e,t){if(0===t.length)return!0;const n=t.shift();return n in e&&gEe(e[n],t)&&delete e[n],uEe(e)}function vEe(e){return e.charAt(0).toUpperCase()+e.substr(1)}function yEe(e,t="datum"){const n=LY(e),r=[];for(let i=1;i<=n.length;i++){const e=`[${n.slice(0,i).map(rK).join("][")}]`;r.push(`${t}${e}`)}return r.join(" && ")}function bEe(e,t="datum"){return`${t}[${rK(LY(e).join("."))}]`}function xEe(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function wEe(e){return""+LY(e).map(xEe).join("\\.")}function _Ee(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function SEe(e){return""+LY(e).join(".")}function EEe(e){return e?LY(e).length:0}function TEe(...e){for(const t of e)if(void 0!==t)return t}let kEe=42;function CEe(e){const t=++kEe;return e?String(e)+t:t}function IEe(){kEe=42}function OEe(e){return AEe(e)?e:"__"+e}function AEe(e){return 0===e.indexOf("__")}function DEe(e){if(void 0!==e)return(e%360+360)%360}function MEe(e){return!!GX(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const NEe={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function jEe(e){return e&&e.condition}const REe=["domain","grid","labels","ticks","title"],PEe={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},FEe={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},LEe=Object.assign(Object.assign({},FEe),{style:1,labelExpr:1,encoding:1});function $Ee(e){return!!LEe[e]}cEe(LEe);const BEe=cEe({axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1}),zEe={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},UEe={count:1,min:1,max:1};function HEe(e){return!!e&&!!e.argmin}function WEe(e){return!!e&&!!e.argmax}function VEe(e){return XX(e)&&!!zEe[e]}cEe(zEe);const qEe=["count","valid","missing","distinct"];function GEe(e){return XX(e)&&JSe(qEe,e)}const YEe=["count","sum","distinct","valid","missing"],XEe=lK(["mean","average","median","q1","q3","min","max"]);var KEe=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const ZEe="row",JEe="column",QEe="facet",eTe="x",tTe="y",nTe="x2",rTe="y2",iTe="radius",aTe="radius2",oTe="theta",sTe="theta2",lTe="latitude",uTe="longitude",cTe="latitude2",dTe="longitude2",hTe="color",fTe="fill",pTe="stroke",mTe="shape",gTe="size",vTe="angle",yTe="opacity",bTe="fillOpacity",xTe="strokeOpacity",wTe="strokeWidth",_Te="strokeDash",STe="text",ETe="order",TTe="detail",kTe="key",CTe="tooltip",ITe="href",OTe="url",ATe="description",DTe={theta:1,theta2:1,radius:1,radius2:1};function MTe(e){return e in DTe}const NTe={longitude:1,longitude2:1,latitude:1,latitude2:1},jTe=cEe(NTe),RTe=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),DTe),NTe),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function PTe(e){return e===hTe||e===fTe||e===pTe}const FTe={row:1,column:1,facet:1},LTe=cEe(FTe),$Te=Object.assign(Object.assign({},RTe),FTe),BTe=cEe($Te),zTe=KEe($Te,["order","detail","tooltip"]),UTe=KEe(zTe,["row","column","facet"]);function HTe(e){return!!$Te[e]}cEe(zTe),cEe(UTe);const WTe=[nTe,rTe,cTe,dTe,sTe,aTe];function VTe(e){return qTe(e)!==e}function qTe(e){switch(e){case nTe:return eTe;case rTe:return tTe;case cTe:return lTe;case dTe:return uTe;case sTe:return oTe;case aTe:return iTe}return e}function GTe(e){if(MTe(e))switch(e){case oTe:return"startAngle";case sTe:return"endAngle";case iTe:return"outerRadius";case aTe:return"innerRadius"}return e}function YTe(e){switch(e){case eTe:return nTe;case tTe:return rTe;case lTe:return cTe;case uTe:return dTe;case oTe:return sTe;case iTe:return aTe}}function XTe(e){switch(e){case eTe:case nTe:return"width";case tTe:case rTe:return"height"}}cEe(RTe);const KTe=KEe(RTe,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),ZTe=cEe(KTe),JTe={x:1,y:1},QTe=cEe(JTe);function eke(e){return e in JTe}const tke={theta:1,radius:1},nke=cEe(tke);function rke(e){return"width"===e?eTe:tTe}const ike=KEe(KTe,["text","tooltip","href","url","description","detail","key","order"]),ake=cEe(ike),oke=Object.assign(Object.assign(Object.assign({},JTe),tke),ike),ske=cEe(oke);function lke(e){return!!oke[e]}const uke={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},cke=KEe(uke,["geoshape"]);function dke(e){switch(e){case eTe:case tTe:case oTe:case iTe:case gTe:case vTe:case wTe:case yTe:case bTe:case xTe:case nTe:case rTe:case sTe:case aTe:return;case QEe:case ZEe:case JEe:case mTe:case _Te:case STe:case CTe:case ITe:case OTe:case ATe:return"discrete";case hTe:case fTe:case pTe:return"flexible";case lTe:case uTe:case cTe:case dTe:case TTe:case kTe:case ETe:return}}function hke(e){return WX(e)&&(e=jAe(e,void 0)),"bin"+cEe(e).map(t=>gke(e[t])?pEe(`_${t}_${hEe(e[t])}`):pEe(`_${t}_${e[t]}`)).join("")}function fke(e){return!0===e||mke(e)&&!e.binned}function pke(e){return"binned"===e||mke(e)&&!0===e.binned}function mke(e){return eX(e)}function gke(e){return null==e?void 0:e.selection}function vke(e){switch(e){case ZEe:case JEe:case gTe:case hTe:case fTe:case pTe:case wTe:case yTe:case bTe:case xTe:case mTe:return 6;case _Te:return 4;default:return 10}}function yke(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const bke='Autosize "fit" only works for single views and layered views.';function xke(e){return("width"==e?"Width":"Height")+' "container" only works for single views and layered views.'}function wke(e){return`${"width"==e?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${"width"==e?"x":"y"}".`}function _ke(e){return e?`Dropping "fit-${e}" because spec has discrete ${XTe(e)}.`:'Dropping "fit" because spec has discrete size.'}function Ske(e){return`Unknown field for ${e}. Cannot calculate view size.`}function Eke(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function Tke(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function kke(e){return`The "nearest" transform is not supported for ${e} marks.`}function Cke(e){return`Selection not supported for ${e} yet.`}function Ike(e){return`Cannot find a selection named "${e}".`}const Oke="Scale bindings are currently only supported for scales with unbinned, continuous domains.",Ake="Legend bindings are only supported for selections over an individual field or encoding channel.";function Dke(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}const Mke="The same selection must be used to override scale domains in a layered view.",Nke='Interval selections should be initialized using "x" and/or "y" keys.';function jke(e){return`Unknown repeated value "${e}".`}function Rke(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const Pke="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function Fke(e){return`Unrecognized parse "${e}".`}function Lke(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}const $ke="Attempt to add the same child twice.";function Bke(e){return`Ignoring an invalid transform: ${XSe(e)}.`}const zke='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function Uke(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function Hke(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${XSe(t)} is overridden by a child projection ${XSe(n)}.`}const Wke="Arc marks uses theta channel rather than angle, replacing angle with theta.";function Vke(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${XSe(n)}}.`}function qke(e){return`Invalid field type "${e}".`}function Gke(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function Yke(e){return`Invalid aggregation operator "${e}".`}function Xke(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}function Kke(e,t){const{fill:n,stroke:r}=t;return`Dropping color ${e} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function Zke(e,t){return`Dropping ${XSe(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}function Jke(e,t,n){return`${e}-encoding with type ${t} is deprecated. Replacing with ${n}-encoding.`}const Qke="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function eCe(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?" when "+n:""}.`}function tCe(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function nCe(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}function rCe(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function iCe(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${"ordinal"===t?"order":"magnitude"}.`}function aCe(e){return`The ${e} for range marks cannot be an expression`}function oCe(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function sCe(e,t){return`Specified orient "${e}" overridden with "${t}".`}const lCe="Custom domain scale cannot be unioned with default field-based domain.",uCe='Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.';function cCe(e){return`Cannot use the scale property "${e}" with non-color channel.`}function dCe(e){return`Using unaggregated domain with raw field has no effect (${XSe(e)}).`}function hCe(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function fCe(e){return`Unaggregated domain is currently unsupported for log scale (${XSe(e)}).`}function pCe(e){return`Cannot apply size to non-oriented mark "${e}".`}function mCe(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function gCe(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function vCe(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function yCe(e,t){return`Scale type "${t}" does not work with mark "${e}".`}function bCe(e){return`The step for "${e}" is dropped because the ${"width"===e?"x":"y"} is continuous.`}function xCe(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${XSe(n)} and ${XSe(r)}). Using ${XSe(n)}.`}function wCe(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${XSe(n)} and ${XSe(r)}). Using the union of the two domains.`}function _Ce(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function SCe(e){return`Dropping sort property ${XSe(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const ECe="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",TCe="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",kCe="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",CCe="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.",ICe="Invalid channel for axis.";function OCe(e){return`Cannot stack "${e}" if there is already "${e}2".`}function ACe(e){return`Cannot stack non-linear scale (${e}).`}function DCe(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function MCe(e,t){return`Invalid ${e}: ${XSe(t)}.`}function NCe(e){return`Dropping day from datetime ${XSe(e)} as day cannot be combined with other units.`}function jCe(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function RCe(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function PCe(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function FCe(e){return`1D error band does not support ${e}.`}function LCe(e){return`Channel ${e} is required for "binned" bin.`}function $Ce(e){return`Channel ${e} should not be used with "binned" bin.`}function BCe(e){return`Domain for ${e} is required for threshold scale.`}const zCe=JY(XY);let UCe=zCe;function HCe(...e){UCe.warn(...e)}function WCe(e){if(e&&eX(e))for(const t of JCe)if(t in e)return!0;return!1}new WeakMap;const VCe=["january","february","march","april","may","june","july","august","september","october","november","december"],qCe=VCe.map(e=>e.substr(0,3)),GCe=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],YCe=GCe.map(e=>e.substr(0,3));function XCe(e,t){const n=[];if(t&&void 0!==e.day&&cEe(e).length>1&&(HCe(ae.droppedDay(e)),delete(e=qSe(e)).day),n.push(void 0!==e.year?e.year:2012),void 0!==e.month){const r=t?function(e){if(MEe(e)&&(e=+e),GX(e))return e-1;{const t=e.toLowerCase(),n=VCe.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=qCe.indexOf(r);if(-1!==i)return i;throw new Error(ae.invalidTimeUnit("month",e))}}(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){const r=t?function(e){if(MEe(e)&&(e=+e),GX(e))return e>4&&HCe(ae.invalidTimeUnit("quarter",e)),e-1;throw new Error(ae.invalidTimeUnit("quarter",e))}(e.quarter):e.quarter;n.push(GX(r)?3*r:r+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){const r=t?function(e){if(MEe(e)&&(e=+e),GX(e))return e%7;{const t=e.toLowerCase(),n=GCe.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=YCe.indexOf(r);if(-1!==i)return i;throw new Error(ae.invalidTimeUnit("day",e))}}(e.day):e.day;n.push(GX(r)?r+1:r+"+1")}else n.push(1);for(const r of["hours","minutes","seconds","milliseconds"]){const t=e[r];n.push(void 0===t?0:t)}return n}function KCe(e){const t=XCe(e,!0).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}const ZCe={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},JCe=cEe(ZCe);function QCe(e){return e.startsWith("utc")}const eIe={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function tIe(e){const t=[];for(const n of JCe)nIe(e,n)&&t.push(n);return t}function nIe(e,t){const n=e.indexOf(t);return!(n<0||n>0&&"seconds"===t&&"i"===e.charAt(n-1)||e.length>n+3&&"day"===t&&"o"===e.charAt(n+3)||n>0&&"year"===t&&"f"===e.charAt(n-1))}function rIe(e){if(!e)return;const t=tIe(e);return`timeUnitSpecifier(${BSe()(t)}, ${BSe()(eIe)})`}function iIe(e){if(!e)return;let t;return XX(e)?t={unit:e}:eX(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),QCe(t.unit)&&(t.utc=!0,t.unit=t.unit.substr(3)),t}function aIe(e){return e&&!!e.signal}function oIe(e){return!!e.step}function sIe(e){return!QY(e)&&"field"in e&&"data"in e}const lIe=cEe({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1}),uIe={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},cIe=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function dIe(e){return e&&!!e.field&&void 0!==e.equal}function hIe(e){return e&&!!e.field&&void 0!==e.lt}function fIe(e){return e&&!!e.field&&void 0!==e.lte}function pIe(e){return e&&!!e.field&&void 0!==e.gt}function mIe(e){return e&&!!e.field&&void 0!==e.gte}function gIe(e){if(e&&e.field){if(QY(e.range)&&2===e.range.length)return!0;if(aIe(e.range))return!0}return!1}function vIe(e){return e&&!!e.field&&(QY(e.oneOf)||QY(e.in))}function yIe(e){return vIe(e)||dIe(e)||gIe(e)||hIe(e)||pIe(e)||fIe(e)||mIe(e)}function bIe(e,t){return FAe(e,{timeUnit:t,wrapTime:!0})}function xIe(e,t=!0){var n;const{field:r}=e,i=null===(n=iIe(e.timeUnit))||void 0===n?void 0:n.unit,a=i?"time("+function(e,t,{end:n}={end:!1}){const r=yEe(t),i=QCe(e)?"utc":"";let a;const o={};for(const l of JCe)nIe(e,l)&&(o[l]="quarter"===(s=l)?`(${i}quarter(${r})-1)`:`${i}${s}(${r})`,a=l);var s;return n&&(o[a]+="+1"),function(e){const t=XCe(e,!1).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}(o)}(i,r)+")":bAe(e,{expr:"datum"});if(dIe(e))return a+"==="+bIe(e.equal,i);if(hIe(e))return`${a}<${bIe(e.lt,i)}`;if(pIe(e))return`${a}>${bIe(e.gt,i)}`;if(fIe(e))return`${a}<=${bIe(e.lte,i)}`;if(mIe(e))return`${a}>=${bIe(e.gte,i)}`;if(vIe(e))return`indexof([${function(e,t){return e.map(e=>bIe(e,t))}(e.oneOf,i).join(",")}], ${a}) !== -1`;if(function(e){return e&&!!e.field&&void 0!==e.valid}(e))return wIe(a,e.valid);if(gIe(e)){const{range:n}=e,r=aIe(n)?{signal:n.signal+"[0]"}:n[0],o=aIe(n)?{signal:n.signal+"[1]"}:n[1];if(null!==r&&null!==o&&t)return"inrange("+a+", ["+bIe(r,i)+", "+bIe(o,i)+"])";const s=[];return null!==r&&s.push(`${a} >= ${bIe(r,i)}`),null!==o&&s.push(`${a} <= ${bIe(o,i)}`),s.length>0?s.join(" && "):"true"}throw new Error("Invalid field predicate: "+JSON.stringify(e))}function wIe(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function _Ie(e){var t;return yIe(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:null===(t=iIe(e.timeUnit))||void 0===t?void 0:t.unit}):e}const SIe={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},EIe=SIe.quantitative,TIe=SIe.ordinal,kIe=SIe.temporal,CIe=SIe.nominal,IIe=SIe.geojson;cEe(SIe);const OIe="linear",AIe="time",DIe="utc",MIe="point",NIe={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function jIe(e,t){const n=NIe[e],r=NIe[t];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n}cEe(NIe);const RIe={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function PIe(e){return RIe[e]}const FIe=["linear","log","pow","sqrt","symlog","time","utc"],LIe=lK(FIe),$Ie=lK(["linear","log","pow","sqrt","symlog"]),BIe=lK(["quantile","quantize","threshold"]),zIe=lK(FIe.concat(["quantile","quantize","threshold","sequential","identity"])),UIe=lK(["ordinal","bin-ordinal","point","band"]);function HIe(e){return e in UIe}function WIe(e){return e in zIe}function VIe(e){return e in LIe}function qIe(e){return e in BIe}function GIe(e){return null==e?void 0:e.selection}const YIe={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},XIe=(cEe(YIe),function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(YIe,["type","domain","range","rangeMax","rangeMin","scheme"])),KIe=cEe(XIe);function ZIe(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!JSe(["point","band","identity"],e);case"bins":return!JSe(["point","band","identity","ordinal"],e);case"round":return VIe(e)||"band"===e||"point"===e;case"padding":case"rangeMin":case"rangeMax":return VIe(e)||JSe(["point","band"],e);case"paddingOuter":case"align":return JSe(["point","band"],e);case"paddingInner":return"band"===e;case"domainMax":case"domainMid":case"domainMin":case"clamp":return VIe(e);case"nice":return VIe(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return WIe(e)&&!JSe(["log","time","utc","threshold","quantile"],e)}}function JIe(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return PTe(e)?void 0:ae.cannotUseScalePropertyWithNonColor(e);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function QIe(e){return e&&!!e.expr}function eOe(e){const t=cEe(e||{}),n={};for(const r of t)n[r]=WAe(e[r]);return n}const tOe={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},nOe=tOe.arc,rOe=tOe.area,iOe=tOe.bar,aOe=tOe.image,oOe=tOe.line,sOe=tOe.point,lOe=tOe.rect,uOe=tOe.rule,cOe=tOe.text,dOe=tOe.tick,hOe=tOe.trail,fOe=tOe.circle,pOe=tOe.square,mOe=tOe.geoshape;function gOe(e){return JSe(["line","area","trail"],e)}function vOe(e){return JSe(["rect","bar","image","arc"],e)}const yOe=cEe(tOe);function bOe(e){return e.type}lK(yOe);const xOe=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],wOe=cEe({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),_Oe=cEe({mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1}),SOe={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]};function EOe(e){const{channel:t,channelDef:n,markDef:r,scale:i,config:a}=e,o=AOe(e);return oAe(n)&&!GEe(n.aggregate)&&i&&VIe(i.get("type"))&&!1===i.get("zero")?TOe({fieldDef:n,channel:t,markDef:r,ref:o,config:a}):o}function TOe({fieldDef:e,channel:t,markDef:n,ref:r,config:i}){return gOe(n.type)||null===KAe("invalid",n,i)?r:[kOe(e,t),r]}function kOe(e,t){const n=COe(e,!0),r=qTe(t);return Object.assign({test:n},"y"===r?{field:{group:"height"}}:{value:0})}function COe(e,t=!0){return wIe(XX(e)?e:bAe(e,{expr:"datum"}),!t)}function IOe(e,t,n,r){const i={};if(t&&(i.scale=t),lAe(e)){const{datum:t}=e;WCe(t)?i.signal=KCe(t):aIe(t)?i.signal=t.signal:QIe(t)?i.signal=t.expr:i.value=t}else i.field=bAe(e,n);if(r){const{offset:e,band:t}=r;e&&(i.offset=e),t&&(i.band=t)}return i}function OOe({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:r,startSuffix:i,band:a=.5}){const o=0<a&&a<1?"datum":void 0,s=bAe(t,{expr:o,suffix:i}),l=void 0!==n?bAe(n,{expr:o}):bAe(t,{suffix:"end",expr:o}),u={};return 0===a||1===a?(u.scale=e,u.field=0===a?s:l):u.signal=`scale("${e}", ${a} * ${s} + ${1-a} * ${l})`,r&&(u.offset=r),u}function AOe({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u,band:c}){var d;if(t){if(dAe(t)){if(hAe(t)){c=null!=c?c:tAe({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:s,config:i,isMidPoint:!0});const{bin:o,timeUnit:u,type:d}=t;if(fke(o)||c&&u&&d===kIe)return s&&s.impute?IOe(t,a,{binSuffix:"mid"},{offset:l}):c?OOe({scaleName:a,fieldOrDatumDef:t,band:c,offset:l}):IOe(t,a,$Ae(t,e)?{binSuffix:"range"}:{},{offset:l});if(pke(o)){if(oAe(n))return OOe({scaleName:a,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:l});HCe(ae.channelRequiredForBinned(e===eTe?nTe:rTe))}}const u=null==o?void 0:o.get("type");return IOe(t,a,HIe(u)?{binSuffix:"range"}:{},{offset:l,band:"band"===u?null!==(d=null!=c?c:t.band)&&void 0!==d?d:.5:void 0})}if(fAe(t)){const n=l?{offset:l}:{};return Object.assign(Object.assign({},DOe(e,t.value)),n)}}return kX(u)&&(u=u()),u?Object.assign(Object.assign({},u),l?{offset:l}:{}):u}function DOe(e,t){return JSe(["x","x2"],e)&&"width"===t?{field:{group:"width"}}:JSe(["y","y2"],e)&&"height"===t?{field:{group:"height"}}:qAe(t)}function MOe(e){return e&&"number"!==e&&"time"!==e}function NOe(e,t,n){return`${e}(${t}${n?", "+JSON.stringify(n):""})`}function jOe({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a}){var o,s;if(MOe(n))return POe({fieldOrDatumDef:e,format:t,formatType:n,expr:r,config:a});const l=ROe(e,r,i);if(PAe(e)){const n=function(e,t,n,r,i){return!t||n?`${i?"utc":"time"}Format(${e}, '${n=XX(n)?n:r}')`:function(e,t,n){if(!e)return;const r=rIe(e);return`${n||QCe(e)?"utc":"time"}Format(${t}, ${r})`}(t,e,i)}(l,oAe(e)?null===(o=iIe(e.timeUnit))||void 0===o?void 0:o.unit:void 0,t,a.timeFormat,pAe(e)&&(null===(s=e.scale)||void 0===s?void 0:s.type)===DIe);return n?{signal:n}:void 0}return t=$Oe(sAe(e),t,a),oAe(e)&&fke(e.bin)?{signal:UOe(l,bAe(e,{expr:r,binSuffix:"end"}),t,n,a)}:t||"quantitative"===sAe(e)?{signal:""+BOe(l,t)}:{signal:`isValid(${l}) ? ${l} : ""+${l}`}}function ROe(e,t,n){return oAe(e)?n?`${bAe(e,{expr:t,suffix:"end"})}-${bAe(e,{expr:t,suffix:"start"})}`:bAe(e,{expr:t}):function(e){const{datum:t}=e;return WCe(t)?KCe(t):""+JSON.stringify(t)}(e)}function POe({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a,field:o}){return o=null!=o?o:ROe(e,r,i),oAe(e)&&fke(e.bin)?{signal:UOe(o,bAe(e,{expr:r,binSuffix:"end"}),t,n,a)}:{signal:NOe(n,o,t)}}function FOe(e,t,n,r,i,a){var o;if(!MOe(r))return PAe(e)?function(e,t,n,r){return e||(t?{signal:rIe(t)}:r?void 0:n.timeFormat)}(n,oAe(e)?null===(o=iIe(e.timeUnit))||void 0===o?void 0:o.unit:void 0,i,a):$Oe(t,n,i)}function LOe(e,t,n){return e&&(aIe(e)||"number"===e||"time"===e)?e:PAe(t)&&"time"!==n&&"utc"!==n?"time":void 0}function $Oe(e,t,n){return XX(t)?t:e===EIe?n.numberFormat:void 0}function BOe(e,t){return`format(${e}, "${t||""}")`}function zOe(e,t,n,r){var i;return MOe(n)?NOe(n,e,t):BOe(e,null!==(i=XX(t)?t:void 0)&&void 0!==i?i:r.numberFormat)}function UOe(e,t,n,r,i){const a=zOe(e,n,r,i),o=zOe(t,n,r,i);return`${wIe(e,!1)} ? "null" : ${a} + " \u2013 " + ${o}`}const HOe="min",WOe={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function VOe(e){return e in WOe}function qOe(e){return!!e&&!!e.encoding}function GOe(e){return!(!e||"count"!==e.op&&!e.field)}function YOe(e){return!!e&&QY(e)}function XOe(e){return"row"in e||"column"in e}function KOe(e){return!!e&&"header"in e}function ZOe(e){return"facet"in e}var JOe=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function QOe(e){const{field:t,timeUnit:n,bin:r,aggregate:i}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})}function eAe(e){return"sort"in e}function tAe({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:i,config:a,isMidPoint:o}){if(dAe(t)&&void 0!==t.band)return t.band;if(oAe(t)){const{timeUnit:e,bin:i}=t;if(e&&!n)return o?ZAe("timeUnitBandPosition",r,a):vOe(r.type)?ZAe("timeUnitBand",r,a):0;if(fke(i))return vOe(r.type)&&!o?1:.5}return(null==i?void 0:i.fieldChannel)===e&&o?.5:void 0}function nAe(e,t,n,r,i,a){return!!(fke(t.bin)||t.timeUnit&&hAe(t)&&"temporal"===t.type)&&!!tAe({channel:e,fieldDef:t,fieldDef2:n,stack:r,markDef:i,config:a})}function rAe(e){return!!e&&"condition"in e}function iAe(e){const t=e&&e.condition;return!!t&&!QY(t)&&oAe(t)}function aAe(e){const t=e&&e.condition;return!!t&&!QY(t)&&dAe(t)}function oAe(e){return!(!e||!e.field&&"count"!==e.aggregate)}function sAe(e){return e&&e.type}function lAe(e){return!!e&&"datum"in e}function uAe(e){return hAe(e)&&wAe(e)||cAe(e)}function cAe(e){return lAe(e)&&GX(e.datum)}function dAe(e){return oAe(e)||lAe(e)}function hAe(e){return!!e&&("field"in e||"count"===e.aggregate)&&"type"in e}function fAe(e){return e&&"value"in e&&"value"in e}function pAe(e){return!!e&&("scale"in e||"sort"in e)}function mAe(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function gAe(e){return!!e&&"legend"in e}function vAe(e){return!!e&&("format"in e||"formatType"in e)}function yAe(e){return YSe(e,["legend","axis","header","scale"])}function bAe(e,t={}){var n,r,i;let a=e.field;const o=t.prefix;let s=t.suffix,l="";if(function(e){return"count"===e.aggregate}(e))a=OEe("count");else{let o;if(!t.nofn)if(function(e){return"op"in e}(e))o=e.op;else{const{bin:u,aggregate:c,timeUnit:d}=e;fke(u)?(o=hke(u),s=(null!==(n=t.binSuffix)&&void 0!==n?n:"")+(null!==(r=t.suffix)&&void 0!==r?r:"")):c?WEe(c)?(l=`["${a}"]`,a="argmax_"+c.argmax):HEe(c)?(l=`["${a}"]`,a="argmin_"+c.argmin):o=String(c):d&&(o=function(e){const t=iIe(e),{utc:n}=t,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(t,["utc"]);return r.unit?(n?"utc":"")+cEe(r).map(e=>pEe(`${"unit"===e?"":`_${e}_`}${r[e]}`)).join(""):(n?"utc":"")+"timeunit"+cEe(r).map(e=>pEe(`_${e}_${r[e]}`)).join("")}(d),s=(!JSe(["range","mid"],t.binSuffix)&&t.binSuffix||"")+(null!==(i=t.suffix)&&void 0!==i?i:""))}o&&(a=a?`${o}_${a}`:o)}return s&&(a=`${a}_${s}`),o&&(a=`${o}_${a}`),t.forAs?SEe(a):t.expr?bEe(a,t.expr)+l:wEe(a)+l}function xAe(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return oAe(e)&&!!e.bin;case"temporal":return!1}throw new Error(ae.invalidFieldType(e.type))}function wAe(e){return!xAe(e)}const _Ae=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(e){const{aggregate:t,bin:n,timeUnit:r,field:i}=e;if(WEe(t))return`${i} for argmax(${t.argmax})`;if(HEe(t))return`${i} for argmin(${t.argmin})`;const a=iIe(r),o=t||(null==a?void 0:a.unit)||(null==a?void 0:a.maxbins)&&"timeunit"||fke(n)&&"bin";return o?o.toUpperCase()+"("+i+")":i}(e);default:return function(e,t){var n;const{field:r,bin:i,timeUnit:a,aggregate:o}=e;if("count"===o)return t.countTitle;if(fke(i))return r+" (binned)";if(a){const e=null===(n=iIe(a))||void 0===n?void 0:n.unit;if(e)return`${r} (${tIe(e).join("-")})`}else if(o)return WEe(o)?`${r} for max ${o.argmax}`:HEe(o)?`${r} for min ${o.argmin}`:`${vEe(o)} of ${r}`;return r}(e,t)}};let SAe=_Ae;function EAe(e){SAe=e}function TAe(e,t,{allowDisabling:n,includeDefault:r=!0}){var i,a;const o=null===(i=kAe(e))||void 0===i?void 0:i.title;if(!oAe(e))return o;const s=e,l=r?CAe(s,t):void 0;return n?TEe(o,s.title,l):null!==(a=null!=o?o:s.title)&&void 0!==a?a:l}function kAe(e){return mAe(e)&&e.axis?e.axis:gAe(e)&&e.legend?e.legend:KOe(e)&&e.header?e.header:void 0}function CAe(e,t){return SAe(e,t)}function IAe(e){var t;if(vAe(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}{const n=null!==(t=kAe(e))&&void 0!==t?t:{},{format:r,formatType:i}=n;return{format:r,formatType:i}}}function OAe(e){return oAe(e)?e:iAe(e)?e.condition:void 0}function AAe(e){return dAe(e)?e:aAe(e)?e.condition:void 0}function DAe(e,t,n,r={}){if(XX(e)||GX(e)||WX(e)){const n=XX(e)?"string":GX(e)?"number":"boolean";return HCe(ae.primitiveChannelDef(t,n,e)),{value:e}}return dAe(e)?MAe(e,t,n,r):aAe(e)?Object.assign(Object.assign({},e),{condition:MAe(e.condition,t,n,r)}):e}function MAe(e,t,n,r){if(vAe(e)){const{formatType:i}=e,a=JOe(e,["format","formatType"]);if(MOe(i)&&!n.customFormatTypes)return HCe(ae.customFormatTypeNotAllowed(t)),MAe(a,t,n,r)}else{const i=mAe(e)?"axis":gAe(e)?"legend":KOe(e)?"header":null;if(i&&e[i]){const a=e[i],{formatType:o}=a,s=JOe(a,["format","formatType"]);if(MOe(o)&&!n.customFormatTypes)return HCe(ae.customFormatTypeNotAllowed(t)),MAe(Object.assign(Object.assign({},e),{[i]:s}),t,n,r)}}return oAe(e)?NAe(e,t,r):function(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=GX(n)?"quantitative":XX(n)?"nominal":WCe(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}(e)}function NAe(e,t,{compositeMark:n=!1}={}){const{aggregate:r,timeUnit:i,bin:a,field:o}=e,s=Object.assign({},e);if(n||!r||VEe(r)||WEe(r)||HEe(r)||(HCe(ae.invalidAggregate(r)),delete s.aggregate),i&&(s.timeUnit=iIe(i)),o&&(s.field=""+o),fke(a)&&(s.bin=jAe(a,t)),pke(a)&&!eke(t)&&HCe(ae.channelShouldNotBeUsedForBinned(t)),hAe(s)){const{type:e}=s,t=function(e){if(e)switch(e=e.toLowerCase()){case"q":case EIe:return"quantitative";case"t":case kIe:return"temporal";case"o":case TIe:return"ordinal";case"n":case CIe:return"nominal";case IIe:return"geojson"}}(e);e!==t&&(s.type=t),"quantitative"!==e&&GEe(r)&&(HCe(ae.invalidFieldTypeForCountAggregate(e,r)),s.type="quantitative")}else if(!VTe(t)){const e=function(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(eAe(e)&&QY(e.sort))return"ordinal";const{aggregate:r,bin:i,timeUnit:a}=e;if(a)return"temporal";if(i||r&&!WEe(r)&&!HEe(r))return"quantitative";if(pAe(e)&&(null===(n=e.scale)||void 0===n?void 0:n.type))switch(NIe[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}(s,t);s.type=e}if(hAe(s)){const{compatible:e,warning:n}=function(e,t){const n=e.type;if("geojson"===n&&"shape"!==t)return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case ZEe:case JEe:case QEe:return wAe(e)?{compatible:!1,warning:ae.facetChannelShouldBeDiscrete(t)}:RAe;case eTe:case tTe:case hTe:case fTe:case pTe:case STe:case TTe:case kTe:case CTe:case ITe:case OTe:case vTe:case oTe:case iTe:case ATe:return RAe;case uTe:case dTe:case lTe:case cTe:return n!==EIe?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:RAe;case yTe:case bTe:case xTe:case wTe:case gTe:case sTe:case aTe:case nTe:case rTe:return"nominal"!==n||e.sort?RAe:{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`};case _Te:return JSe(["ordinal","nominal"],e.type)?RAe:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case mTe:return JSe(["ordinal","nominal","geojson"],e.type)?RAe:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case ETe:return"nominal"!==e.type||"sort"in e?RAe:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(s,t)||{};!1===e&&HCe(n)}if(eAe(s)&&XX(s.sort)){const{sort:e}=s;if(VOe(e))return Object.assign(Object.assign({},s),{sort:{encoding:e}});const t=e.substr(1);if("-"===e.charAt(0)&&VOe(t))return Object.assign(Object.assign({},s),{sort:{encoding:t,order:"descending"}})}if(KOe(s)){const{header:e}=s,{orient:t}=e,n=JOe(e,["orient"]);if(t)return Object.assign(Object.assign({},s),{header:Object.assign(Object.assign({},n),{labelOrient:e.labelOrient||t,titleOrient:e.titleOrient||t})})}return s}function jAe(e,t){return WX(e)?{maxbins:vke(t)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:vke(t)})}const RAe={compatible:!0};function PAe(e){const{formatType:t}=IAe(e);return"time"===t||!t&&(n=e)&&("temporal"===n.type||oAe(n)&&!!n.timeUnit);var n}function FAe(e,{timeUnit:t,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var a;const o=t&&(null===(a=iIe(t))||void 0===a?void 0:a.unit);let s,l=o||"temporal"===n;return QIe(e)?s=e.expr:aIe(e)?s=e.signal:WCe(e)?(l=!0,s=KCe(e)):(XX(e)||GX(e))&&l&&(s=`datetime(${JSON.stringify(e)})`,function(e){return!!ZCe[e]}(o)&&(GX(e)&&e<1e4||XX(e)&&isNaN(Date.parse(e)))&&(s=KCe({[o]:e}))),s?r&&l?`time(${s})`:s:i?void 0:JSON.stringify(e)}function LAe(e,t){const{type:n}=e;return t.map(t=>{const r=FAe(t,{timeUnit:oAe(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==r?{signal:r}:t})}function $Ae(e,t){return fke(e.bin)?lke(t)&&JSe(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function BAe(e){const{anchor:t,frame:n,offset:r,orient:i,color:a,subtitleColor:o,subtitleFont:s,subtitleFontSize:l,subtitleFontStyle:u,subtitleFontWeight:c,subtitleLineHeight:d,subtitlePadding:h}=e,f=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},f),a?{fill:a}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),s?{subtitleFont:s}:{}),l?{subtitleFontSize:l}:{}),u?{subtitleFontStyle:u}:{}),c?{subtitleFontWeight:c}:{}),d?{subtitleLineHeight:d}:{}),h?{subtitlePadding:h}:{});return{titleMarkConfig:p,subtitleMarkConfig:GSe(p,["align","baseline","dx","dy","limit"]),nonMark:m,subtitle:g}}function zAe(e){return XX(e)||QY(e)&&XX(e[0])}var UAe=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function HAe(e){const t=QY(e.condition)?e.condition.map(VAe):VAe(e.condition);return Object.assign(Object.assign({},WAe(e)),{condition:t})}function WAe(e){if(QIe(e)){const{expr:t}=e,n=UAe(e,["expr"]);return Object.assign({signal:t},n)}return e}function VAe(e){if(QIe(e)){const{expr:t}=e,n=UAe(e,["expr"]);return Object.assign({signal:t},n)}return e}function qAe(e){if(QIe(e)){const{expr:t}=e,n=UAe(e,["expr"]);return Object.assign({signal:t},n)}return aIe(e)?e:void 0!==e?{value:e}:void 0}function GAe(e){return aIe(e)?e.signal:rK(e.value)}function YAe(e){return aIe(e)?e.signal:null==e?null:rK(e)}function XAe(e){var t;return[].concat(e.type,null!==(t=e.style)&&void 0!==t?t:[])}function KAe(e,t,n,r={}){const{vgChannel:i,ignoreVgConfig:a}=r;return i&&void 0!==t[i]?t[i]:void 0!==t[e]?t[e]:!a||i&&i!==e?ZAe(e,t,n,r):void 0}function ZAe(e,t,n,{vgChannel:r}={}){return TEe(r?JAe(e,t,n.style):void 0,JAe(e,t,n.style),r?n[t.type][r]:void 0,n[t.type][e],r?n.mark[r]:n.mark[e])}function JAe(e,t,n){return QAe(e,XAe(t),n)}function QAe(e,t,n){let r;t=EX(t);for(const i of t){const t=n[i];t&&void 0!==t[e]&&(r=t[e])}return r}function eDe(e,t){return EX(e).reduce((e,n)=>{var r;return e.field.push(bAe(n,t)),e.order.push(null!==(r=n.sort)&&void 0!==r?r:"ascending"),e},{field:[],order:[]})}function tDe(e,t){const n=[...e];return t.forEach(e=>{for(const t of n)if(VSe(t,e))return;n.push(e)}),n}function nDe(e,t){return VSe(e,t)||!t?e:e?[...EX(e),...EX(t)].join(", "):t}function rDe(e,t){const n=e.value,r=t.value;if(null==n||null===r)return{explicit:e.explicit,value:null};if((zAe(n)||aIe(n))&&(zAe(r)||aIe(r)))return{explicit:e.explicit,value:nDe(n,r)};if(zAe(n)||aIe(n))return{explicit:e.explicit,value:n};if(zAe(r)||aIe(r))return{explicit:e.explicit,value:r};if(!(zAe(n)||aIe(n)||zAe(r)||aIe(r)))return{explicit:e.explicit,value:tDe(n,r)};throw new Error("It should never reach here")}function iDe(e){return"mark"in e}class aDe{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return!!iDe(e)&&(bOe(t=e.mark)?t.type:t)===this.name;var t}}function oDe(e,t){const n=e&&e[t];return!!n&&(QY(n)?QSe(n,e=>!!e.field):oAe(n)||iAe(n))}function sDe(e){return QSe(BTe,t=>{if(oDe(e,t)){const n=e[t];if(QY(n))return QSe(n,e=>!!e.aggregate);{const e=OAe(n);return e&&!!e.aggregate}}return!1})}function lDe(e,t){const n=[],r=[],i=[],a=[],o={};return cDe(e,(s,l)=>{if(oAe(s)){const{field:u,aggregate:c,bin:d,timeUnit:h}=s,f=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(s,["field","aggregate","bin","timeUnit"]);if(c||h||d){const e=kAe(s),p=e&&e.title;let m=bAe(s,{forAs:!0});const g=Object.assign(Object.assign(Object.assign({},p?[]:{title:TAe(s,t,{allowDisabling:!0})}),f),{field:m});if(c){let e;if(WEe(c)?(e="argmax",m=bAe({op:"argmax",field:c.argmax},{forAs:!0}),g.field=`${m}.${u}`):HEe(c)?(e="argmin",m=bAe({op:"argmin",field:c.argmin},{forAs:!0}),g.field=`${m}.${u}`):"boxplot"!==c&&"errorbar"!==c&&"errorband"!==c&&(e=c),e){const t={op:e,as:m};u&&(t.field=u),a.push(t)}}else if(n.push(m),hAe(s)&&fke(d))r.push({bin:d,field:u,as:m}),n.push(bAe(s,{binSuffix:"end"})),$Ae(s,l)&&n.push(bAe(s,{binSuffix:"range"})),eke(l)&&(o[l+"2"]={field:m+"_end"}),g.bin="binned",VTe(l)||(g.type=EIe);else if(h){i.push({timeUnit:h,field:u,as:m});const e=hAe(s)&&s.type!==kIe&&"time";e&&(l===STe||l===CTe?g.formatType=e:function(e){return!!KTe[e]}(l)?g.legend=Object.assign({formatType:e},g.legend):eke(l)&&(g.axis=Object.assign({formatType:e},g.axis)))}o[l]=g}else n.push(u),o[l]=e[l]}else o[l]=e[l]}),{bins:r,timeUnits:i,aggregate:a,groupby:n,encoding:o}}function uDe(e,t){const n={};for(const r of cEe(e)){const i=DAe(e[r],r,t,{compositeMark:!0});n[r]=i}return n}function cDe(e,t,n){if(e)for(const r of cEe(e)){const i=e[r];if(QY(i))for(const e of i)t.call(n,e,r);else t.call(n,i,r)}}function dDe(e,t){return cEe(t).reduce((n,r)=>{switch(r){case eTe:case tTe:case ITe:case ATe:case OTe:case nTe:case rTe:case oTe:case sTe:case iTe:case aTe:case lTe:case uTe:case cTe:case dTe:case STe:case mTe:case vTe:case CTe:return n;case ETe:if("line"===e||"trail"===e)return n;case TTe:case kTe:{const e=t[r];if(QY(e)||oAe(e))for(const t of EX(e))t.aggregate||n.push(bAe(t,{}));return n}case gTe:if("trail"===e)return n;case hTe:case fTe:case pTe:case yTe:case bTe:case xTe:case _Te:case wTe:{const e=OAe(t[r]);return e&&!e.aggregate&&n.push(bAe(e,{})),n}}},[])}var hDe=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function fDe(e,t,n,r=!0){return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[...e.map(({fieldPrefix:e,titlePrefix:n})=>{const i=r?" of "+pDe(t):"";return{field:e+t.field,type:t.type,title:aIe(n)?{signal:n+`"${escape(i)}"`}:n+i}}),...rEe(function(e){const t=[];for(const n of cEe(e))if(oDe(e,n)){const r=EX(e[n]);for(const e of r)oAe(e)?t.push(e):iAe(e)&&t.push(e.condition)}return t}(n).map(yAe),KSe)]}}function pDe(e){const{title:t,field:n}=e;return TEe(t,n)}function mDe(e,t,n,r,i){const{scale:a,axis:o}=n;return({partName:s,mark:l,positionPrefix:u,endPositionPrefix:c,extraEncoding:d={}})=>{const h=pDe(n);return gDe(e,s,i,{mark:l,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:u+"_"+n.field,type:n.type},void 0!==h?{title:h}:{}),void 0!==a?{scale:a}:{}),void 0!==o?{axis:o}:{})},XX(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),r),d)})}}function gDe(e,t,n,r){const{clip:i,color:a,opacity:o}=e,s=e.type;return e[t]||void 0===e[t]&&n[t]?[Object.assign(Object.assign({},r),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),i?{clip:i}:{}),a?{color:a}:{}),o?{opacity:o}:{}),bOe(r.mark)?r.mark:{type:r.mark}),{style:`${s}-${t}`}),WX(e[t])?{}:e[t])})]:[]}function vDe(e,t,n){const{encoding:r}=e,i="vertical"===t?"y":"x",a=r[i+"2"],o=r[i+"Error"],s=r[i+"Error2"];return{continuousAxisChannelDef:yDe(r[i],n),continuousAxisChannelDef2:yDe(a,n),continuousAxisChannelDefError:yDe(o,n),continuousAxisChannelDefError2:yDe(s,n),continuousAxis:i}}function yDe(e,t){if(e&&e.aggregate){const{aggregate:n}=e,r=hDe(e,["aggregate"]);return n!==t&&HCe(ae.errorBarContinuousAxisHasCustomizedAggregate(n,t)),r}return e}function bDe(e,t){const{mark:n,encoding:r}=e,{x:i,y:a}=r;if(bOe(n)&&n.orient)return n.orient;if(uAe(i)){if(uAe(a)){const e=oAe(i)&&i.aggregate,n=oAe(a)&&a.aggregate;if(e||n!==t){if(n||e!==t){if(e===t&&n===t)throw new Error("Both x and y cannot have aggregate");return PAe(a)&&!PAe(i)?"horizontal":"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(uAe(a))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}var xDe=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const wDe="boxplot",_De=new aDe(wDe,EDe);function SDe(e){return GX(e)?"tukey":e}function EDe(e,{config:t}){var n,r;e=Object.assign(Object.assign({},e),{encoding:uDe(e.encoding,t)});const{mark:i,selection:a}=e,o=xDe(e,["mark","encoding","selection","projection"]),s=bOe(i)?i:{type:i};a&&HCe(ae.selectionNotSupported("boxplot"));const l=null!==(n=s.extent)&&void 0!==n?n:t.boxplot.extent,u=KAe("size",s,t),c=SDe(l),{bins:d,timeUnits:h,transform:f,continuousAxisChannelDef:p,continuousAxis:m,groupby:g,aggregate:v,encodingWithoutContinuousAxis:y,ticksOrient:b,boxOrient:x,customTooltipWithoutAggregatedField:w}=function(e,t,n){const r=bDe(e,wDe),{continuousAxisChannelDef:i,continuousAxis:a}=vDe(e,r,wDe),o=i.field,s=SDe(t),l=[...TDe(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:("min-max"===s?"lower_whisker_":"min_")+o},{op:"max",field:o,as:("min-max"===s?"upper_whisker_":"max_")+o}],u="min-max"===s||"tukey"===s?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],c=xDe(e.encoding,["symbol"==typeof a?a:a+""]),{customTooltipWithoutAggregatedField:d,filteredEncoding:h}=function(e){const{tooltip:t}=e,n=hDe(e,["tooltip"]);if(!t)return{filteredEncoding:n};let r,i;if(QY(t)){for(const e of t)e.aggregate?(r||(r=[]),r.push(e)):(i||(i=[]),i.push(e));r&&(n.tooltip=r)}else t.aggregate?n.tooltip=t:i=t;return QY(i)&&1===i.length&&(i=i[0]),{customTooltipWithoutAggregatedField:i,filteredEncoding:n}}(c),{bins:f,timeUnits:p,aggregate:m,groupby:g,encoding:v}=lDe(h,n),y="vertical"===r?"horizontal":"vertical",b=r;return{bins:f,timeUnits:p,transform:[...f,...p,{aggregate:[...m,...l],groupby:g},...u],groupby:g,aggregate:m,continuousAxisChannelDef:i,continuousAxis:a,encodingWithoutContinuousAxis:v,ticksOrient:y,boxOrient:b,customTooltipWithoutAggregatedField:d}}(e,l,t),{color:_,size:S}=y,E=xDe(y,["color","size"]),T=e=>mDe(s,m,p,e,t.boxplot),k=T(E),C=T(y),I=T(Object.assign(Object.assign({},E),S?{size:S}:{})),O=fDe([{fieldPrefix:"min-max"===c?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===c?"lower_whisker_":"min_",titlePrefix:"Min"}],p,y),A={type:"tick",color:"black",opacity:1,orient:b,invalid:null,aria:!1},D="min-max"===c?O:fDe([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,y),M=[...k({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:D}),...k({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:D}),...k({partName:"ticks",mark:A,positionPrefix:"lower_whisker",extraEncoding:D}),...k({partName:"ticks",mark:A,positionPrefix:"upper_whisker",extraEncoding:D})],N=[..."tukey"!==c?M:[],...C({partName:"box",mark:Object.assign(Object.assign({type:"bar"},u?{size:u}:{}),{orient:x,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:O}),...I({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},eX(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),u?{size:u}:{}),{orient:b,aria:!1}),positionPrefix:"mid_box",extraEncoding:O})];if("min-max"===c)return Object.assign(Object.assign({},o),{transform:(null!==(r=o.transform)&&void 0!==r?r:[]).concat(f),layer:N});const j=`datum["lower_box_${p.field}"]`,R=`datum["upper_box_${p.field}"]`,P=`(${R} - ${j})`,F=`${j} - ${l} * ${P}`,L=`${R} + ${l} * ${P}`,$=`datum["${p.field}"]`,B={joinaggregate:TDe(p.field),groupby:g},z={transform:[{filter:`(${F} <= ${$}) && (${$} <= ${L})`},{aggregate:[{op:"min",field:p.field,as:"lower_whisker_"+p.field},{op:"max",field:p.field,as:"upper_whisker_"+p.field},{op:"min",field:"lower_box_"+p.field,as:"lower_box_"+p.field},{op:"max",field:"upper_box_"+p.field,as:"upper_box_"+p.field},...v],groupby:g}],layer:M},U=xDe(E,["tooltip"]),{scale:H,axis:W}=p,V=pDe(p),q=YSe(W,["title"]),G=gDe(s,"outliers",t.boxplot,{transform:[{filter:`(${$} < ${F}) || (${$} > ${L})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[m]:Object.assign(Object.assign(Object.assign({field:p.field,type:p.type},void 0!==V?{title:V}:{}),void 0!==H?{scale:H}:{}),uEe(q)?{}:{axis:q})},U),_?{color:_}:{}),w?{tooltip:w}:{})})[0];let Y;const X=[...d,...h,B];return G?Y={transform:X,layer:[G,z]}:(Y=z,Y.transform.unshift(...X)),Object.assign(Object.assign({},o),{layer:[Y,{transform:f,layer:N}]})}function TDe(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}var kDe=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const CDe="errorbar",IDe=new aDe(CDe,ODe);function ODe(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:uDe(e.encoding,t)});const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,ticksOrient:o,markDef:s,outerSpec:l,tooltipEncoding:u}=ADe(e,CDe,t);delete a.size;const c=mDe(s,i,r,a,t.errorbar),d=s.thickness,h=s.size,f=Object.assign(Object.assign({type:"tick",orient:o,aria:!1},void 0!==d?{thickness:d}:{}),void 0!==h?{size:h}:{}),p=[...c({partName:"ticks",mark:f,positionPrefix:"lower",extraEncoding:u}),...c({partName:"ticks",mark:f,positionPrefix:"upper",extraEncoding:u}),...c({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},void 0!==d?{size:d}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u})];return Object.assign(Object.assign(Object.assign({},l),{transform:n}),p.length>1?{layer:p}:Object.assign({},p[0]))}function ADe(e,t,n){var r;const{mark:i,encoding:a,selection:o}=e,s=kDe(e,["mark","encoding","selection","projection"]),l=bOe(i)?i:{type:i};o&&HCe(ae.selectionNotSupported(t));const{orient:u,inputType:c}=function(e,t){const{encoding:n}=e;if(function(e){return(dAe(e.x)||dAe(e.y))&&!dAe(e.x2)&&!dAe(e.y2)&&!dAe(e.xError)&&!dAe(e.xError2)&&!dAe(e.yError)&&!dAe(e.yError2)}(n))return{orient:bDe(e,t),inputType:"raw"};const r=function(e){return dAe(e.x2)||dAe(e.y2)}(n),i=function(e){return dAe(e.xError)||dAe(e.xError2)||dAe(e.yError)||dAe(e.yError2)}(n),a=n.x,o=n.y;if(r){if(i)throw new Error(t+" cannot be both type aggregated-upper-lower and aggregated-error");const e=n.x2,r=n.y2;if(dAe(e)&&dAe(r))throw new Error(t+" cannot have both x2 and y2");if(dAe(e)){if(uAe(a))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error("Both x and x2 have to be quantitative in "+t)}if(dAe(r)){if(uAe(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error("Both y and y2 have to be quantitative in "+t)}throw new Error("No ranged axis")}{const e=n.xError,r=n.yError,i=n.yError2;if(dAe(n.xError2)&&!dAe(e))throw new Error(t+" cannot have xError2 without xError");if(dAe(i)&&!dAe(r))throw new Error(t+" cannot have yError2 without yError");if(dAe(e)&&dAe(r))throw new Error(t+" cannot have both xError and yError with both are quantiative");if(dAe(e)){if(uAe(a))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(dAe(r)){if(uAe(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:h,continuousAxisChannelDefError:f,continuousAxisChannelDefError2:p,continuousAxis:m}=vDe(e,u,t),{errorBarSpecificAggregate:g,postAggregateCalculates:v,tooltipSummary:y,tooltipTitleWithFieldName:b}=function(e,t,n,r,i,a,o,s){let l=[],u=[];const c=t.field;let d,h=!1;if("raw"===a){const t=e.center?e.center:e.extent?"iqr"===e.extent?"median":"mean":s.errorbar.center,n=e.extent?e.extent:"mean"===t?"stderr":"iqr";if("median"===t!=("iqr"===n)&&HCe(ae.errorBarCenterIsUsedWithWrongExtent(t,n,o)),"stderr"===n||"stdev"===n)l=[{op:n,field:c,as:"extent_"+c},{op:t,field:c,as:"center_"+c}],u=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],d=[{fieldPrefix:"center_",titlePrefix:vEe(t)},{fieldPrefix:"upper_",titlePrefix:DDe(t,n,"+")},{fieldPrefix:"lower_",titlePrefix:DDe(t,n,"-")}],h=!0;else{let e,t,r;"ci"===n?(e="mean",t="ci0",r="ci1"):(e="median",t="q1",r="q3"),l=[{op:t,field:c,as:"lower_"+c},{op:r,field:c,as:"upper_"+c},{op:e,field:c,as:"center_"+c}],d=[{fieldPrefix:"upper_",titlePrefix:TAe({field:c,aggregate:r,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:TAe({field:c,aggregate:t,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:TAe({field:c,aggregate:e,type:"quantitative"},s,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&HCe(ae.errorBarCenterAndExtentAreNotNeeded(e.center,e.extent)),"aggregated-upper-lower"===a?(d=[],u=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):"aggregated-error"===a&&(d=[{fieldPrefix:"",titlePrefix:c}],u=[{calculate:`datum["${c}"] + datum["${r.field}"]`,as:"upper_"+c}],u.push(i?{calculate:`datum["${c}"] + datum["${i.field}"]`,as:"lower_"+c}:{calculate:`datum["${c}"] - datum["${r.field}"]`,as:"lower_"+c}));for(const e of u)d.push({fieldPrefix:e.as.substring(0,6),titlePrefix:_Ee(_Ee(e.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:u,errorBarSpecificAggregate:l,tooltipSummary:d,tooltipTitleWithFieldName:h}}(l,d,h,f,p,c,t,n),x="x"===m?"x2":"y2",w="x"===m?"xError":"yError",_="x"===m?"xError2":"yError2",S=kDe(a,["symbol"==typeof m?m:m+"","symbol"==typeof x?x:x+"","symbol"==typeof w?w:w+"","symbol"==typeof _?_:_+""]),{bins:E,timeUnits:T,aggregate:k,groupby:C,encoding:I}=lDe(S,n),O=[...k,...g],A="raw"!==c?[]:C,D=fDe(y,d,I,b);return{transform:[...null!==(r=s.transform)&&void 0!==r?r:[],...E,...T,...0===O.length?[]:[{aggregate:O,groupby:A}],...v],groupby:A,continuousAxisChannelDef:d,continuousAxis:m,encodingWithoutContinuousAxis:I,ticksOrient:"vertical"===u?"horizontal":"vertical",markDef:l,outerSpec:s,tooltipEncoding:D}}function DDe(e,t,n){return vEe(e)+" "+n+" "+t}const MDe="errorband",NDe=new aDe(MDe,jDe);function jDe(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:uDe(e.encoding,t)});const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,markDef:o,outerSpec:s,tooltipEncoding:l}=ADe(e,MDe,t),u=o,c=mDe(u,i,r,a,t.errorband),d=void 0!==e.encoding.x&&void 0!==e.encoding.y;let h={type:d?"area":"rect"},f={type:d?"line":"rule"};const p=Object.assign(Object.assign({},u.interpolate?{interpolate:u.interpolate}:{}),u.tension&&u.interpolate?{tension:u.tension}:{});return d?(h=Object.assign(Object.assign(Object.assign({},h),p),{ariaRoleDescription:"errorband"}),f=Object.assign(Object.assign(Object.assign({},f),p),{aria:!1})):u.interpolate?HCe(ae.errorBand1DNotSupport("interpolate")):u.tension&&HCe(ae.errorBand1DNotSupport("tension")),Object.assign(Object.assign({},s),{transform:n,layer:[...c({partName:"band",mark:h,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l}),...c({partName:"borders",mark:f,positionPrefix:"lower",extraEncoding:l}),...c({partName:"borders",mark:f,positionPrefix:"upper",extraEncoding:l})]})}const RDe={};function PDe(e,t,n){const r=new aDe(e,t);RDe[e]={normalizer:r,parts:n}}PDe(wDe,EDe,["box","median","outliers","rule","ticks"]),PDe(CDe,ODe,["ticks","rule"]),PDe(MDe,jDe,["band","borders"]);const FDe=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],LDe={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},$De={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},BDe=cEe(LDe),zDe=cEe($De),UDe=cEe({header:1,headerRow:1,headerColumn:1,headerFacet:1}),HDe=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],WDe={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1};cEe(WDe);var VDe=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function qDe(e){const t=[];for(const n of e||[]){const{expr:e,bind:r}=n,i=VDe(n,["expr","bind"]);if(r&&e){const n=Object.assign(Object.assign({},i),{bind:r,init:e});t.push(n)}else{const n=Object.assign(Object.assign(Object.assign({},i),e?{update:e}:{}),r?{bind:r}:{});t.push(n)}}return t}const GDe="_vgsid_",YDe={single:{on:"click",fields:[GDe],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[GDe],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function XDe(e){return!(!e||"legend"!==e&&!e.legend)}function KDe(e){return XDe(e)&&eX(e)}function ZDe(e){return"concat"in e}function JDe(e){return"vconcat"in e}function QDe(e){return"hconcat"in e}function eMe(e){return eX(e)&&void 0!==e.step}function tMe(e){return e.view||e.width||e.height}const nMe=cEe({align:1,bounds:1,center:1,columns:1,spacing:1});function rMe(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e["width"===t?"continuousWidth":"continuousHeight"]}function iMe(e,t){const n=aMe(e,t);return eMe(n)?n.step:oMe}function aMe(e,t){var n;return TEe(null!==(n=e[t])&&void 0!==n?n:e["width"===t?"discreteWidth":"discreteHeight"],{step:e.step})}const oMe=20,sMe={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:oMe},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:{binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},circle:{},geoshape:{},image:{},line:{},point:{},rect:{binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5},rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:YDe,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},lMe=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],uMe={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},cMe={blue:lMe[0],orange:lMe[1],red:lMe[2],teal:lMe[3],green:lMe[4],yellow:lMe[5],purple:lMe[6],pink:lMe[7],brown:lMe[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function dMe(e){const t=cEe(e||{}),n={};for(const r of t){const t=e[r];n[r]=jEe(t)?HAe(t):WAe(t)}return n}const hMe=[..._Oe,...BEe,...UDe,"background","padding","legend","lineBreak","scale","style","title","view"];function fMe(e={}){const{color:t,font:n,fontSize:r}=e,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["color","font","fontSize"]),a=nX({},sMe,n?function(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}(n):{},t?function(e={}){return{signals:[{name:"color",value:eX(e)?Object.assign(Object.assign({},cMe),e):cMe}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(t):{},r?function(e){return{signals:[{name:"fontSize",value:eX(e)?Object.assign(Object.assign({},uMe),e):uMe}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(r):{},i||{}),o=YSe(a,hMe);for(const s of["background","lineBreak","padding"])a[s]&&(o[s]=WAe(a[s]));for(const s of _Oe)a[s]&&(o[s]=eOe(a[s]));for(const s of BEe)a[s]&&(o[s]=dMe(a[s]));for(const s of UDe)a[s]&&(o[s]=eOe(a[s]));return a.legend&&(o.legend=eOe(a.legend)),a.scale&&(o.scale=eOe(a.scale)),a.style&&(o.style=function(e){const t=cEe(e),n={};for(const r of t)n[r]=dMe(e[r]);return n}(a.style)),a.title&&(o.title=eOe(a.title)),a.view&&(o.view=eOe(a.view)),o}const pMe=["view",...yOe],mMe=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],gMe=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function vMe(e,t,n,r){"view"===t&&(n="cell");const i=Object.assign(Object.assign({},r?e[t][r]:e[t]),e.style[null!=n?n:t]);uEe(i)||(e.style[null!=n?n:t]=i),r||delete e[t]}function yMe(e){return"layer"in e}const bMe={zero:1,center:1,normalize:1},xMe=new Set([nOe,iOe,rOe,uOe,sOe,fOe,pOe,oOe,cOe,dOe]),wMe=new Set([iOe,rOe,nOe]);function _Me(e,t){var n,r;const i="x"===t?"y":"radius",a=e[t],o=e[i];if(oAe(a)&&oAe(o))if("quantitative"===sAe(a)&&"quantitative"===sAe(o)){if(a.stack)return t;if(o.stack)return i;const e=oAe(a)&&!!a.aggregate;if(e!==(oAe(o)&&!!o.aggregate))return e?t:i;{const e=null===(n=a.scale)||void 0===n?void 0:n.type,s=null===(r=o.scale)||void 0===r?void 0:r.type;if(e&&"linear"!==e)return i;if(s&&"linear"!==s)return t}}else{if("quantitative"===sAe(a))return t;if("quantitative"===sAe(o))return i}else{if("quantitative"===sAe(a))return t;if("quantitative"===sAe(o))return i}}function SMe(e,t,n={}){const r=bOe(e)?e.type:e;if(!xMe.has(r))return null;const i=_Me(t,"x")||_Me(t,"theta");if(!i)return null;const a=t[i],o=oAe(a)?bAe(a,{}):void 0;let s=function(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(i),l=t[s],u=oAe(l)?bAe(l,{}):void 0;u===o&&(u=void 0,l=void 0,s=void 0);const c=ZTe.reduce((e,n)=>{if("tooltip"!==n&&oDe(t,n)){const r=t[n];for(const t of EX(r)){const r=OAe(t);if(r.aggregate)continue;const i=bAe(r,{});i&&i===u||e.push({channel:n,fieldDef:r})}}return e},[]);let d;if(void 0!==a.stack?d=WX(a.stack)?a.stack?"zero":null:a.stack:c.length>0&&wMe.has(r)&&(d="zero"),!d||!(d in bMe))return null;if(sDe(t)&&0===c.length)return null;if(a.scale&&a.scale.type&&a.scale.type!==OIe){if(n.disallowNonLinearStack)return null;HCe(ae.cannotStackNonLinearScale(a.scale.type))}return dAe(t[YTe(i)])?(void 0!==a.stack&&HCe(ae.cannotStackRangedMark(i)),null):(oAe(a)&&a.aggregate&&!JSe(YEe,a.aggregate)&&HCe(ae.stackNonSummativeAggregate(a.aggregate)),{groupbyChannel:l?s:void 0,groupbyField:u,fieldChannel:i,impute:null!==a.impute&&gOe(r),stackBy:c,offset:d})}var EMe=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function TMe(e){const t=EMe(e,["point","line"]);return cEe(t).length>1?t:t.type}function kMe(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:YSe(e[t],["point","line"])}));return e}function CMe(e,t={},n){return"transparent"===e.point?{opacity:0}:e.point?eX(e.point)?e.point:{}:void 0!==e.point?null:t.point||n.shape?eX(t.point)?t.point:{}:void 0}function IMe(e,t={}){return e.line?!0===e.line?{}:e.line:void 0!==e.line?null:t.line?!0===t.line?{}:t.line:void 0}class OMe{constructor(){this.name="path-overlay"}hasMatchingType(e,t){if(iDe(e)){const{mark:n,encoding:r}=e,i=bOe(n)?n:{type:n};switch(i.type){case"line":case"rule":case"trail":return!!CMe(i,t[i.type],r);case"area":return!!CMe(i,t[i.type],r)||!!IMe(i,t[i.type])}}return!1}run(e,t,n){const{config:r}=t,{selection:i,projection:a,mark:o,encoding:s}=e,l=EMe(e,["selection","projection","mark","encoding"]),u=uDe(s,r),c=bOe(o)?o:{type:o},d=CMe(c,r[c.type],u),h="area"===c.type&&IMe(c,r[c.type]),f=[Object.assign(Object.assign({},i?{selection:i}:{}),{mark:TMe(Object.assign(Object.assign({},"area"===c.type&&void 0===c.opacity&&void 0===c.fillOpacity?{opacity:.7}:{}),c)),encoding:YSe(u,["shape"])})],p=SMe(c,u);let m=u;if(p){const{fieldChannel:e,offset:t}=p;m=Object.assign(Object.assign({},u),{[e]:Object.assign(Object.assign({},u[e]),t?{stack:t}:{})})}return h&&f.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"line"},GSe(c,["clip","interpolate","tension","tooltip"])),h),encoding:m})),d&&f.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},GSe(c,["clip","tooltip"])),d),encoding:m})),n(Object.assign(Object.assign({},l),{layer:f}),Object.assign(Object.assign({},t),{config:kMe(r)}))}}var AMe=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class DMe{constructor(){this.name="RangeStep"}hasMatchingType(e){var t;if(iDe(e)&&e.encoding)for(const n of QTe){const r=e.encoding[n];if(r&&dAe(r)&&(null===(t=null==r?void 0:r.scale)||void 0===t?void 0:t.rangeStep))return!0}return!1}run(e){var t;const n={};let r=Object.assign({},e.encoding);for(const i of QTe){const e=XTe(i),a=r[i];if(a&&dAe(a)&&(null===(t=null==a?void 0:a.scale)||void 0===t?void 0:t.rangeStep)){const{scale:t}=a,o=AMe(a,["scale"]),s=AMe(t,["rangeStep"]);n[e]={step:t.rangeStep},HCe(ae.RANGE_STEP_DEPRECATED),r=Object.assign(Object.assign({},r),{[i]:Object.assign(Object.assign({},o),uEe(s)?{}:{scale:s})})}}return Object.assign(Object.assign(Object.assign({},n),e),{encoding:r})}}function MMe(e,t){return t?XOe(e)?LMe(e,t):RMe(e,t):e}function NMe(e,t){return t?LMe(e,t):e}function jMe(e,t,n){const r=t[e];return(i=r)&&!XX(i)&&"repeat"in i?r.repeat in n?Object.assign(Object.assign({},t),{[e]:n[r.repeat]}):void HCe(ae.noSuchRepeatedValue(r.repeat)):t;var i}function RMe(e,t){if(void 0!==(e=jMe("field",e,t))){if(null===e)return null;if(eAe(e)&&GOe(e.sort)){const n=jMe("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function PMe(e,t){if(oAe(e))return RMe(e,t);{const n=jMe("datum",e,t);return n===e||n.type||(n.type="nominal"),n}}function FMe(e,t){if(!dAe(e)){if(aAe(e)){const n=PMe(e.condition,t);return n?Object.assign(Object.assign({},e),{condition:n}):function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["condition"])}return e}{const n=PMe(e,t);if(n)return n;if(rAe(e))return{condition:e.condition}}}function LMe(e,t){const n={};for(const r in e)if(LX(e,r)){const i=e[r];if(QY(i))n[r]=i.map(e=>FMe(e,t)).filter(e=>e);else{const e=FMe(i,t);void 0!==e&&(n[r]=e)}}return n}class $Me{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(iDe(e)){const{encoding:t,mark:n}=e;if("line"===n)for(const e of WTe){const n=t[qTe(e)];if(t[e]&&(oAe(n)&&!pke(n.bin)||lAe(n)))return!0}}return!1}run(e,t,n){const{encoding:r}=e;return HCe(ae.lineWithRange(!!r.x2,!!r.y2)),n(Object.assign(Object.assign({},e),{mark:"rule"}),t)}}var BMe=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function zMe({parentEncoding:e,encoding:t={},layer:n}){let r={};if(e){const i=new Set([...cEe(e),...cEe(t)]);for(const a of i){const i=t[a],o=e[a];if(dAe(i)){const e=Object.assign(Object.assign({},o),i);r[a]=e}else aAe(i)?r[a]=Object.assign(Object.assign({},i),{condition:Object.assign(Object.assign({},o),i.condition)}):i||null===i?r[a]=i:(n||fAe(o)||aIe(o)||dAe(o)||QY(o))&&(r[a]=o)}}else r=t;return!r||uEe(r)?void 0:r}function UMe(e){const{parentProjection:t,projection:n}=e;return t&&n&&HCe(ae.projectionOverridden({parentProjection:t,projection:n})),null!=n?n:t}function HMe(e,t){void 0===t&&(t=fMe(e.config));const n=function(e,t={}){return WMe.map(e,{config:t})}(e,t),{width:r,height:i}=e,a=function(e,t,n){let{width:r,height:i}=t;const a=iDe(e)||yMe(e),o={};a?"container"==r&&"container"==i?(o.type="fit",o.contains="padding"):"container"==r?(o.type="fit-x",o.contains="padding"):"container"==i&&(o.type="fit-y",o.contains="padding"):("container"==r&&(HCe(ae.containerSizeNonSingle("width")),r=void 0),"container"==i&&(HCe(ae.containerSizeNonSingle("height")),i=void 0));const s=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?VMe(n.autosize):{}),VMe(e.autosize));if("fit"!==s.type||a||(HCe(ae.FIT_NON_SINGLE),s.type="pad"),"container"==r&&"fit"!=s.type&&"fit-x"!=s.type&&HCe(ae.containerSizeNotCompatibleWithAutosize("width")),"container"==i&&"fit"!=s.type&&"fit-y"!=s.type&&HCe(ae.containerSizeNotCompatibleWithAutosize("height")),!VSe(s,{type:"pad"}))return s}(n,{width:r,height:i,autosize:e.autosize},t);return Object.assign(Object.assign({},n),a?{autosize:a}:{})}const WMe=new class extends class{map(e,t){return ZOe(e)?this.mapFacet(e,t):function(e){return"repeat"in e}(e)?this.mapRepeat(e,t):QDe(e)?this.mapHConcat(e,t):JDe(e)?this.mapVConcat(e,t):ZDe(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if(yMe(e))return this.mapLayer(e,t);if(iDe(e))return this.mapUnit(e,t);throw new Error(ae.invalidSpec(e))}mapLayer(e,t){return Object.assign(Object.assign({},e),{layer:e.layer.map(e=>this.mapLayerOrUnit(e,t))})}mapHConcat(e,t){return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map(e=>this.map(e,t))})}mapVConcat(e,t){return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map(e=>this.map(e,t))})}mapConcat(e,t){const{concat:n}=e,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["concat"]);return Object.assign(Object.assign({},r),{concat:n.map(e=>this.map(e,t))})}mapFacet(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}mapRepeat(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}}{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[_De,IDe,NDe,new OMe,new $Me,new DMe]}map(e,t){if(iDe(e)){const n=oDe(e.encoding,ZEe),r=oDe(e.encoding,JEe),i=oDe(e.encoding,QEe);if(n||r||i)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:r}=t,i=NMe(e.encoding,t.repeater),a=Object.assign(Object.assign({},e),i?{encoding:i}:{});if(n||r)return this.mapUnitWithParentEncodingOrProjection(a,t);const o=this.mapLayerOrUnit.bind(this);for(const s of this.nonFacetUnitNormalizers)if(s.hasMatchingType(a,t.config))return s.run(a,t,o);return a}mapRepeat(e,t){return function(e){return!QY(e.repeat)&&e.repeat.layer}(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:r}=e,i=BMe(e,["repeat","spec"]),{row:a,column:o,layer:s}=n,{repeater:l={},repeaterPrefix:u=""}=t;return a||o?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},a?{row:a}:{}),o?{column:o}:{}),spec:{repeat:{layer:s},spec:r}}),t):Object.assign(Object.assign({},i),{layer:s.map(e=>{const n=Object.assign(Object.assign({},l),{layer:e}),i=(r.name||"")+u+"child__layer_"+pEe(e),a=this.mapLayerOrUnit(r,Object.assign(Object.assign({},t),{repeater:n,repeaterPrefix:i}));return a.name=i,a})})}mapNonLayerRepeat(e,t){var n;const{repeat:r,spec:i,data:a}=e,o=BMe(e,["repeat","spec","data"]);!QY(r)&&e.columns&&(e=YSe(e,["columns"]),HCe(ae.columnsNotSupportByRowCol("repeat")));const s=[],{repeater:l={},repeaterPrefix:u=""}=t,c=!QY(r)&&r.row||[l?l.row:null],d=!QY(r)&&r.column||[l?l.column:null],h=QY(r)&&r||[l?l.repeat:null];for(const p of h)for(const e of c)for(const n of d){const a={repeat:p,row:e,column:n,layer:l.layer},o=(i.name||"")+u+"child__"+(QY(r)?""+pEe(p):(r.row?"row_"+pEe(e):"")+(r.column?"column_"+pEe(n):"")),c=this.map(i,Object.assign(Object.assign({},t),{repeater:a,repeaterPrefix:o}));c.name=o,s.push(YSe(c,["data"]))}const f=QY(r)?e.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:null!==(n=i.data)&&void 0!==n?n:a,align:"all"},o),{columns:f,concat:s})}mapFacet(e,t){const{facet:n}=e;return XOe(n)&&e.columns&&(e=YSe(e,["columns"]),HCe(ae.columnsNotSupportByRowCol("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:r}=e,{parentEncoding:i,parentProjection:a,config:o}=t,s=UMe({parentProjection:a,projection:r}),l=zMe({parentEncoding:i,encoding:NMe(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),s?{projection:s}:{}),l?{encoding:l}:{}),{config:o})}mapFacetedUnit(e,t){const n=e.encoding,{row:r,column:i,facet:a}=n,o=BMe(n,["row","column","facet"]),{mark:s,width:l,projection:u,height:c,view:d,selection:h}=e,f=BMe(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:p,layout:m}=this.getFacetMappingAndLayout({row:r,column:i,facet:a},t),g=NMe(o,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},f),m),{facet:p,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),c?{height:c}:{}),d?{view:d}:{}),u?{projection:u}:{}),{mark:s,encoding:g}),h?{selection:h}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:r,column:i,facet:a}=e;if(r||i){a&&HCe(ae.facetChannelDropped([...r?[ZEe]:[],...i?[JEe]:[]]));const t={},o={};for(const r of[ZEe,JEe]){const i=e[r];if(i){const e=BMe(i,["align","center","spacing","columns"]);t[r]=e;for(const t of["align","center","spacing"])void 0!==i[t]&&(o[t]=null!==(n=o[t])&&void 0!==n?n:{},o[t][r]=i[t])}}return{facetMapping:t,layout:o}}{const{align:e,center:n,spacing:r,columns:i}=a;return{facetMapping:MMe(BMe(a,["align","center","spacing","columns"]),t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},e?{align:e}:{}),n?{center:n}:{}),r?{spacing:r}:{}),i?{columns:i}:{})}}}mapLayer(e,t){var{parentEncoding:n,parentProjection:r}=t,i=BMe(t,["parentEncoding","parentProjection"]);const{encoding:a,projection:o}=e,s=BMe(e,["encoding","projection"]),l=Object.assign(Object.assign({},i),{parentEncoding:zMe({parentEncoding:n,encoding:a,layer:!0}),parentProjection:UMe({parentProjection:r,projection:o})});return super.mapLayer(s,l)}};function VMe(e){return XX(e)?{type:e}:null!=e?e:{}}const qMe=["background","padding"];function GMe(e,t){const n={};for(const r of qMe)e&&void 0!==e[r]&&(n[r]=WAe(e[r]));return t&&(n.params=e.params),n}class YMe{constructor(e={},t={}){this.explicit=e,this.implicit=t}clone(){return new YMe(qSe(this.explicit),qSe(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(e){return TEe(this.explicit[e],this.implicit[e])}getWithExplicit(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)}copyKeyFromObject(e,t){void 0!==t[e]&&this.set(e,t[e],!0)}copyAll(e){for(const t of cEe(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function XMe(e){return{explicit:!0,value:e}}function KMe(e){return{explicit:!1,value:e}}function ZMe(e){return(t,n,r,i)=>{const a=e(t.value,n.value);return a>0?t:a<0?n:JMe(t,n,r,i)}}function JMe(e,t,n,r){return e.explicit&&t.explicit&&HCe(ae.mergeConflictingProperty(n,r,e.value,t.value)),e}function QMe(e,t,n,r,i=JMe){return void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:VSe(e.value,t.value)?e:i(e,t,n,r)}class eNe extends YMe{constructor(e={},t={},n=!1){super(e,t),this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function tNe(e){return"url"in e}function nNe(e){return"values"in e}function rNe(e){return"name"in e&&!tNe(e)&&!nNe(e)&&!iNe(e)}function iNe(e){return e&&(aNe(e)||oNe(e)||sNe(e))}function aNe(e){return"sequence"in e}function oNe(e){return"sphere"in e}function sNe(e){return"graticule"in e}var lNe;function uNe(e){return"filter"in e}function cNe(e){return"lookup"in e}function dNe(e){return"pivot"in e}function hNe(e){return"density"in e}function fNe(e){return"quantile"in e}function pNe(e){return"regression"in e}function mNe(e){return"loess"in e}function gNe(e){return"sample"in e}function vNe(e){return"window"in e}function yNe(e){return"joinaggregate"in e}function bNe(e){return"flatten"in e}function xNe(e){return"calculate"in e}function wNe(e){return"bin"in e}function _Ne(e){return"impute"in e}function SNe(e){return"timeUnit"in e}function ENe(e){return"aggregate"in e}function TNe(e){return"stack"in e}function kNe(e){return"fold"in e}function CNe(e,t,n,r){const i=rAe(t)&&t.condition,a=r(t);return i?{[n]:[...EX(i).map(t=>{const n=r(t),i=function(e){return e.selection}(t)?Wje(e,t.selection):qje(e,t.test);return Object.assign({test:i},n)}),...void 0!==a?[a]:[]]}:void 0!==a?{[n]:a}:{}}function INe(e,t="text"){return CNe(e,e.encoding[t],t,t=>ONe(t,e.config))}function ONe(e,t,n="datum"){if(e){if(fAe(e))return qAe(e.value);if(dAe(e)){const{format:r,formatType:i}=IAe(e);return jOe({fieldOrDatumDef:e,format:r,formatType:i,expr:n,config:t})}}}function ANe(e,t={}){const{encoding:n,markDef:r,config:i,stack:a}=e,o=n.tooltip;if(QY(o))return{tooltip:MNe({tooltip:o},a,i,t)};{const s=t.reactiveGeom?"datum.datum":"datum";return CNe(e,o,"tooltip",e=>{const o=ONe(e,i,s);if(o)return o;if(null===e)return;let l=KAe("tooltip",r,i);return!0===l&&(l={content:"encoding"}),XX(l)?{value:l}:eX(l)?aIe(l)?l:"encoding"===l.content?MNe(n,a,i,t):{signal:s}:void 0})}}function DNe(e,t,n,{reactiveGeom:r}={}){const i={},a=r?"datum.datum":"datum",o=[];function s(r,s){const l=qTe(s),u=hAe(r)?r:Object.assign(Object.assign({},r),{type:e[l].type}),c=EX(u.title||CAe(u,n)).join(", ");let d;if(eke(s)){const r="x"===s?"x2":"y2",o=OAe(e[r]);if(pke(u.bin)&&o){const e=bAe(u,{expr:a}),t=bAe(o,{expr:a}),{format:s,formatType:l}=IAe(u);d=UOe(e,t,s,l,n),i[r]=!0}else if(t&&t.fieldChannel===s&&"normalize"===t.offset){const{format:e,formatType:t}=IAe(u);d=jOe({fieldOrDatumDef:u,format:e,formatType:t,expr:a,config:n,normalizeStack:!0}).signal}}d=null!=d?d:ONe(u,n,a).signal,o.push({channel:s,key:c,value:d})}cDe(e,(e,t)=>{oAe(e)?s(e,t):iAe(e)&&s(e.condition,t)});const l={};for(const{channel:u,key:c,value:d}of o)i[u]||l[c]||(l[c]=d);return l}function MNe(e,t,n,{reactiveGeom:r}={}){const i=DNe(e,t,n,{reactiveGeom:r}),a=hEe(i).map(([e,t])=>`"${e}": ${t}`);return a.length>0?{signal:`{${a.join(", ")}}`}:void 0}function NNe(e,t,n={}){const{markDef:r,encoding:i,config:a}=t,{vgChannel:o}=n;let{defaultRef:s,defaultValue:l}=n;return void 0===s&&(l=null!=l?l:KAe(e,r,a,{vgChannel:o,ignoreVgConfig:!0}),void 0!==l&&(s=qAe(l))),CNe(t,i[e],null!=o?o:e,n=>AOe({channel:e,channelDef:n,markDef:r,config:a,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:s}))}function jNe(e,t={filled:void 0}){var n,r,i,a;const{markDef:o,encoding:s,config:l}=e,{type:u}=o,c=null!==(n=t.filled)&&void 0!==n?n:KAe("filled",o,l),d=JSe(["bar","point","circle","square","geoshape"],u)?"transparent":void 0,h=null!==(i=null!==(r=KAe(!0===c?"color":void 0,o,l,{vgChannel:"fill"}))&&void 0!==r?r:l.mark[!0===c&&"color"])&&void 0!==i?i:d,f=null!==(a=KAe(!1===c?"color":void 0,o,l,{vgChannel:"stroke"}))&&void 0!==a?a:l.mark[!1===c&&"color"],p=c?"fill":"stroke",m=Object.assign(Object.assign({},h?{fill:qAe(h)}:{}),f?{stroke:qAe(f)}:{});return o.color&&(c?o.fill:o.stroke)&&HCe(ae.droppingColor("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},m),NNe("color",e,{vgChannel:p,defaultValue:c?h:f})),NNe("fill",e,{defaultValue:s.fill?h:void 0})),NNe("stroke",e,{defaultValue:s.stroke?f:void 0}))}function RNe(e,t){const n=t[function(e){switch(e){case eTe:return"xOffset";case tTe:return"yOffset";case nTe:return"x2Offset";case rTe:return"y2Offset";case oTe:return"thetaOffset";case iTe:return"radiusOffset";case sTe:return"theta2Offset";case aTe:return"radius2Offset"}}(e)];if(n)return n}function PNe(e,t,{defaultPos:n,vgChannel:r,isMidPoint:i}){const{encoding:a,markDef:o,config:s,stack:l}=t,u=a[e],c=a[YTe(e)],d=t.scaleName(e),h=t.getScaleComponent(e),f=RNe(e,o),p=FNe({model:t,defaultPos:n,channel:e,scaleName:d,scale:h}),m=!u&&eke(e)&&(a.latitude||a.longitude)?{field:t.getName(e)}:function(e){const{channel:t,channelDef:n,isMidPoint:r,scaleName:i,stack:a,offset:o,markDef:s,config:l}=e;if(dAe(n)&&a&&t===a.fieldChannel){if(oAe(n)){const e=tAe({channel:t,fieldDef:n,isMidPoint:r,markDef:s,stack:a,config:l});if(void 0!==e)return OOe({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",band:e,offset:o})}return IOe(n,i,{suffix:"end"},{offset:o})}return EOe(e)}({channel:e,channelDef:u,channel2Def:c,markDef:o,config:s,isMidPoint:i,scaleName:d,scale:h,stack:l,offset:f,defaultRef:p});return m?{[r||e]:m}:void 0}function FNe({model:e,defaultPos:t,channel:n,scaleName:r,scale:i}){const{markDef:a,config:o}=e;return()=>{const s=qTe(n),l=GTe(n),u=KAe(n,a,o,{vgChannel:l});if(void 0!==u)return DOe(n,u);switch(t){case"zeroOrMin":case"zeroOrMax":if(r){const e=i.get("type");if(JSe(["log",AIe,DIe],e));else if(i.domainDefinitelyIncludesZero())return{scale:r,value:0}}if("zeroOrMin"===t)return"y"===s?{field:{group:"height"}}:{value:0};switch(s){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const t=e[XTe(n)];return Object.assign(Object.assign({},t),{mult:.5})}}}}!function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"}(lNe||(lNe={}));const LNe={left:"x",center:"xc",right:"x2"},$Ne={top:"y",middle:"yc",bottom:"y2"};function BNe(e,t,n,r="middle"){if("radius"===e||"theta"===e)return GTe(e);const i="x"===e?"align":"baseline",a=KAe(i,t,n);let o;return aIe(a)?(HCe(ae.rangeMarkAlignmentCannotBeExpression(i)),o=void 0):o=a,"x"===e?LNe[o||("top"===r?"left":"center")]:$Ne[o||r]}function zNe(e,t,{defaultPos:n,defaultPos2:r,range:i}){return i?UNe(e,t,{defaultPos:n,defaultPos2:r}):PNe(e,t,{defaultPos:n})}function UNe(e,t,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:a}=t,o=YTe(e),s=XTe(e),l=function(e,t,n){const{encoding:r,mark:i,markDef:a,stack:o,config:s}=e,l=qTe(n),u=XTe(n),c=GTe(n),d=r[l],h=e.scaleName(l),f=e.getScaleComponent(l),p=RNe(n in r||n in a?n:l,e.markDef);if(!d&&("x2"===n||"y2"===n)&&(r.latitude||r.longitude))return{[c]:{field:e.getName(n)}};const m=function({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u}){return dAe(t)&&s&&e.charAt(0)===s.fieldChannel.charAt(0)?IOe(t,a,{suffix:"start"},{offset:l}):EOe({channel:e,channelDef:n,scaleName:a,scale:o,stack:s,markDef:r,config:i,offset:l,defaultRef:u})}({channel:n,channelDef:d,channel2Def:r[n],markDef:a,config:s,scaleName:h,scale:f,stack:o,offset:p,defaultRef:void 0});return void 0!==m?{[c]:m}:HNe(n,a)||HNe(n,{[n]:JAe(n,a,s.style),[u]:JAe(u,a,s.style)})||HNe(n,s[i])||HNe(n,s.mark)||{[c]:FNe({model:e,defaultPos:t,channel:n,scaleName:h,scale:f})()}}(t,r,o),u=l[s]?BNe(e,i,a):GTe(e);return Object.assign(Object.assign({},PNe(e,t,{defaultPos:n,vgChannel:u})),l)}function HNe(e,t){const n=XTe(e),r=GTe(e);return void 0!==t[r]?{[r]:DOe(e,t[r])}:void 0!==t[e]?{[r]:DOe(e,t[e])}:t[n]?{[n]:DOe(e,t[n])}:void 0}function WNe(e,t,n){var r,i,a,o;const{config:s,encoding:l,markDef:u,stack:c}=e,d=YTe(t),h=XTe(t),f=l[t],p=l[d],m=e.getScaleComponent(t),g=m?m.get("type"):void 0,v=e.scaleName(t),y=u.orient,b=null!==(i=null!==(r=l[h])&&void 0!==r?r:l.size)&&void 0!==i?i:KAe("size",u,s,{vgChannel:h}),x="bar"===n&&("x"===t?"vertical"===y:"horizontal"===y);if(oAe(f)&&(fke(f.bin)||pke(f.bin)||f.timeUnit&&!p)&&!b&&!HIe(g)){const n=tAe({channel:t,fieldDef:f,stack:c,markDef:u,config:s}),r=null===(a=e.component.axes[t])||void 0===a?void 0:a[0];return function({fieldDef:e,fieldDef2:t,channel:n,band:r,scaleName:i,markDef:a,spacing:o=0,axisTranslate:s,reverse:l,config:u}){const c=YTe(n),d=GTe(n),h=GTe(c),f=RNe(n,a);if(fke(e.bin)||e.timeUnit)return{[h]:GNe({channel:n,fieldDef:e,scaleName:i,markDef:a,band:(1-r)/2,offset:qNe(c,o,l,s,f),config:u}),[d]:GNe({channel:n,fieldDef:e,scaleName:i,markDef:a,band:1-(1-r)/2,offset:qNe(n,o,l,s,f),config:u})};if(pke(e.bin)){const r=IOe(e,i,{},{offset:qNe(c,o,l,s,f)});if(oAe(t))return{[h]:r,[d]:IOe(t,i,{},{offset:qNe(n,o,l,s,f)})};if(mke(e.bin)&&e.bin.step)return{[h]:r,[d]:{signal:`scale("${i}", ${bAe(e,{expr:"datum"})} + ${e.bin.step})`,offset:qNe(n,o,l,s,f)}}}HCe(ae.channelRequiredForBinned(c))}({fieldDef:f,fieldDef2:p,channel:t,markDef:u,scaleName:v,band:n,axisTranslate:null!==(o=null==r?void 0:r.get("translate"))&&void 0!==o?o:.5,spacing:eke(t)?KAe("binSpacing",u,s):void 0,reverse:m.get("reverse"),config:s})}return(dAe(f)&&HIe(g)||x)&&!p?function(e,t,n,r){var i;const{markDef:a,encoding:o,config:s,stack:l}=r,u=a.orient,c=r.scaleName(n),d=r.getScaleComponent(n),h=XTe(n),f=YTe(n),p="horizontal"===u&&"y"===n||"vertical"===u&&"x"===n,m=KAe(p?"size":h,a,s,{vgChannel:h});let g;(o.size||void 0!==m)&&(p?g=NNe("size",r,{vgChannel:h,defaultValue:m}):HCe(ae.cannotApplySizeToNonOrientedMark(a.type)));const v=null!==(i=dAe(t)?tAe({channel:n,fieldDef:t,markDef:a,stack:l,config:s}):void 0)&&void 0!==i?i:1;g=g||{[h]:VNe(e,h,c,d,s,v)};const y="band"!==(null==d?void 0:d.get("type"))||!("band"in g[h]),b=BNe(n,a,s,y?"middle":"top"),x=RNe(n,a),w=EOe({channel:n,channelDef:t,markDef:a,config:s,scaleName:c,scale:d,stack:l,offset:x,defaultRef:FNe({model:r,defaultPos:"mid",channel:n,scaleName:c,scale:d}),band:y?.5:(1-v)/2});if(h)return Object.assign({[b]:w},g);{const e=GTe(f),t=g[h],n=x?Object.assign(Object.assign({},t),{offset:x}):t;return{[b]:w,[e]:QY(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:n})]:Object.assign(Object.assign({},w),{offset:n})}}}(n,f,t,e):UNe(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function VNe(e,t,n,r,i,a){if(r){const t=r.get("type");if("point"===t||"band"===t){if(void 0!==i[e].discreteBandSize)return{value:i[e].discreteBandSize};if(t===MIe){const e=r.get("range");return oIe(e)&&GX(e.step)?{value:e.step-2}:{value:oMe-2}}return{scale:n,band:a}}return{value:i[e].continuousBandSize}}const o=iMe(i.view,t),s=TEe(i[e].discreteBandSize,o-2);return void 0!==s?{value:s}:void 0}function qNe(e,t,n,r,i){if(MTe(e))return 0;const a="x"===e||"y2"===e?-t/2:t/2;if(aIe(n)||aIe(i)||aIe(r)){const e=YAe(n),t=YAe(i),o=YAe(r);return{signal:(o?o+" + ":"")+(e?`(${e} ? -1 : 1) * `:"")+(t?`(${t} + ${a})`:a)}}return i=i||0,r+(n?-i-a:+i+a)}function GNe({channel:e,fieldDef:t,scaleName:n,markDef:r,band:i,offset:a,config:o}){return TOe({fieldDef:t,channel:e,markDef:r,ref:OOe({scaleName:n,fieldOrDatumDef:t,band:i,offset:a}),config:o})}const YNe=new Set(["aria"]);function XNe(e,t){const{fill:n,stroke:r}="include"===t.color?jNe(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(e,t){return lIe.reduce((n,r)=>(YNe.has(r)||void 0===e[r]||"ignore"===t[r]||(n[r]=qAe(e[r])),n),{})}(e.markDef,t)),KNe(e,"fill",n)),KNe(e,"stroke",r)),NNe("opacity",e)),NNe("fillOpacity",e)),NNe("strokeOpacity",e)),NNe("strokeWidth",e)),NNe("strokeDash",e)),function(e){const{encoding:t,mark:n}=e,r=t.order;return!gOe(n)&&fAe(r)?CNe(e,r,"zindex",e=>qAe(e.value)):{}}(e)),ANe(e)),INe(e,"href")),function(e){const{markDef:t,config:n}=e,r=KAe("aria",t,n);return!1===r?{}:Object.assign(Object.assign(Object.assign({},r?{aria:r}:{}),function(e){const{mark:t,markDef:n,config:r}=e;if(!1===r.aria)return{};const i=KAe("ariaRoleDescription",n,r);return null!=i?{ariaRoleDescription:{value:i}}:t in uIe?{}:{ariaRoleDescription:{value:t}}}(e)),function(e){const{encoding:t,markDef:n,config:r,stack:i}=e,a=t.description;if(a)return CNe(e,a,"description",t=>ONe(t,e.config));const o=KAe("description",n,r);if(null!=o)return{description:qAe(o)};if(!1===r.aria)return{};const s=DNe(t,i,r);return uEe(s)?void 0:{description:{signal:hEe(s).map(([e,t],n)=>`"${n>0?"; ":""}${e}: " + (${t})`).join(" + ")}}}(e))}(e))}function KNe(e,t,n){const{config:r,mark:i,markDef:a}=e;if("hide"===KAe("invalid",a,r)&&n&&!gOe(i)){const r=function(e,{invalid:t=!1,channels:n}){const r=n.reduce((t,n)=>{const r=e.getScaleComponent(n);if(r){const i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&WIe(i)&&(t[a]=!0)}return t},{}),i=cEe(r);if(i.length>0){const e=t?"||":"&&";return i.map(e=>COe(e,t)).join(` ${e} `)}}(e,{invalid:!0,channels:ske});if(r)return{[t]:[{test:r,value:null},...EX(n)]}}return n?{[t]:n}:{}}function ZNe(e){const{config:t,markDef:n}=e;if(KAe("invalid",n,t)){const t=function(e,{invalid:t=!1,channels:n}){const r=n.reduce((t,n)=>{const r=e.getScaleComponent(n);if(r){const i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&WIe(i)&&(t[a]=!0)}return t},{}),i=cEe(r);if(i.length>0){const e=t?"||":"&&";return i.map(e=>COe(e,t)).join(` ${e} `)}}(e,{channels:QTe});if(t)return{defined:{signal:t}}}return{}}function JNe(e,t){if(void 0!==t)return{[e]:qAe(t)}}const QNe="voronoi";var eje={has:e=>"interval"!==e.type&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(QNe)},marks:(e,t,n)=>{const{x:r,y:i}=t.project.hasChannel,a=e.mark;if(gOe(a))return HCe(ae.nearestNotSupportForContinuous(a)),n;const o={name:e.getName(QNe),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},ANe(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let s=0,l=!1;return n.forEach((t,n)=>{var r;const i=null!==(r=t.name)&&void 0!==r?r:"";i===e.component.mark[0].name?s=n:i.indexOf(QNe)>=0&&(l=!0)}),l||n.splice(s+1,0,o),n}};class tje{constructor(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){this._children.indexOf(e)>-1?HCe(ae.ADD_SAME_CHILD_TWICE):void 0!==t?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const n of this._children)n.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class nje extends tje{constructor(e,t,n,r){super(e,t),this.type=n,this.refCounts=r,this._source=this._name=t,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash="Output "+CEe()),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}var rje=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class ije extends tje{constructor(e,t){super(e),this.formula=t}clone(){return new ije(null,qSe(this.formula))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((e,n,r)=>{const{field:i,timeUnit:a}=n,o=rFe(t)?t.encoding[YTe(r)]:void 0,s=rFe(t)&&nAe(r,n,o,t.stack,t.markDef,t.config);if(a){const t=bAe(n,{forAs:!0});e[KSe({as:t,field:i,timeUnit:a})]=Object.assign({as:t,field:i,timeUnit:a},s?{band:!0}:{})}return e},{});return uEe(n)?null:new ije(e,n)}static makeFromTransform(e,t){const n=Object.assign({},t),{timeUnit:r}=n,i=rje(n,["timeUnit"]),a=iIe(r),o=Object.assign(Object.assign({},i),{timeUnit:a});return new ije(e,{[KSe(o)]:o})}merge(e){this.formula=Object.assign({},this.formula);for(const t in e.formula)this.formula[t]&&!e.formula[t].band||(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}removeFormulas(e){const t={};for(const[n,r]of hEe(this.formula))e.has(r.as)||(t[n]=r);this.formula=t}producedFields(){return new Set(dEe(this.formula).map(e=>e.as))}dependentFields(){return new Set(dEe(this.formula).map(e=>e.field))}hash(){return"TimeUnit "+KSe(this.formula)}assemble(){const e=[];for(const t of dEe(this.formula)){const{field:n,as:r,timeUnit:i}=t,a=iIe(i),{unit:o,utc:s}=a,l=rje(a,["unit","utc"]);e.push(Object.assign(Object.assign(Object.assign(Object.assign({field:wEe(n),type:"timeunit"},o?{units:tIe(o)}:{}),s?{timezone:"utc"}:{}),l),{as:[r,r+"_end"]}))}return e}}const aje="_tuple_fields";class oje{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}var sje={has:e=>"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind&&!XDe(e.bind),parse:(e,t,n,r)=>{r.on||delete t.events,r.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const r=t.name,i=t.project,a=t.bind,o=t.init&&t.init[0],s=eje.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach((e,i)=>{var l,u;const c=pEe(`${r}_${e.field}`);n.filter(e=>e.name===c).length||n.unshift(Object.assign(Object.assign({name:c},o?{init:Eje(o[i])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${s}[${rK(e.field)}] : null`}]:[],bind:null!==(u=null!==(l=a[e.field])&&void 0!==l?l:a[e.channel])&&void 0!==u?u:a}))}),n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.filter(e=>e.name===r+Rje)[0],o=r+aje,s=i.items.map(e=>pEe(`${r}_${e.field}`)),l=s.map(e=>e+" !== null").join(" && ");return s.length&&(a.update=`${l} ? {fields: ${o}, values: [${s.join(", ")}]} : null`),delete a.value,delete a.on,n}};const lje="_toggle";var uje={has:e=>"multi"===e.type&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+lje,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Rje,r=t.name+lje;return`${r} ? null : ${n}, `+("global"===t.resolve?r+" ? null : true, ":`${r} ? null : {unit: ${$je(e)}}, `)+`${r} ? ${n} : null`}};const cje={has:e=>void 0!==e.clear&&!1!==e.clear,parse:(e,t,n)=>{n.clear&&(t.clear=XX(n.clear)?Qbe(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(sje.has(t))for(const r of t.project.items){const e=n.findIndex(e=>e.name===pEe(`${t.name}_${r.field}`));-1!==e&&n[e].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function r(e,r){-1!==e&&n[e].on&&n[e].on.push({events:t.clear,update:r})}if("interval"===t.type)for(const i of t.project.items){const e=n.findIndex(e=>e.name===i.signals.visual);r(e,"[0, 0]"),-1===e&&r(n.findIndex(e=>e.name===i.signals.data),"null")}else{let e=n.findIndex(e=>e.name===t.name+Rje);r(e,"null"),uje.has(t)&&(e=n.findIndex(e=>e.name===t.name+lje),r(e,"false"))}return n}};var dje={has:e=>"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind,parse:(e,t)=>{const n=t.scales=[];for(const r of t.project.items){const i=r.channel;if(!lke(i))continue;const a=e.getScaleComponent(i),o=a?a.get("type"):void 0;a&&WIe(o)?(a.set("selectionExtent",{selection:t.name,field:r.field},!0),n.push(r)):HCe(ae.SCALE_BINDINGS_CONTINUOUS)}},topLevelSignals:(e,t,n)=>{const r=t.scales.filter(e=>0===n.filter(t=>t.name===e.signals.data).length);if(!e.parent||fje(e)||0===r.length)return n;const i=n.filter(e=>e.name===t.name)[0];let a=i.update;if(a.indexOf(Pje)>=0)i.update=`{${r.map(e=>`${rK(e.field)}: ${e.signals.data}`).join(", ")}}`;else{for(const e of r){const t=`${rK(e.field)}: ${e.signals.data}`;a.indexOf(t)<0&&(a=`${a.substring(0,a.length-1)}, ${t}}`)}i.update=a}return n.concat(r.map(e=>({name:e.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!fje(e))for(const r of t.scales){const e=n.filter(e=>e.name===r.signals.data)[0];e.push="outer",delete e.value,delete e.update}return n}};function hje(e,t){return`domain(${rK(e.scaleName(t))})`}function fje(e){var t;return e.parent&&oFe(e.parent)&&(null!==(t=!e.parent.parent)&&void 0!==t?t:fje(e.parent.parent))}const pje={has:e=>{const t="global"===e.resolve&&e.bind&&XDe(e.bind),n=1===e.project.items.length&&e.project.items[0].field!==GDe;return t&&!n&&HCe(ae.LEGEND_BINDINGS_MUST_HAVE_PROJECTION),t&&n},parse:(e,t,n,r)=>{var i;if(r.on||delete t.events,r.clear||delete t.clear,r.on||r.clear){const e='event.item && indexof(event.item.mark.role, "legend") < 0';for(const n of t.events)n.filter=EX(null!==(i=n.filter)&&void 0!==i?i:[]),n.filter.indexOf(e)<0&&n.filter.push(e)}const a=KDe(t.bind)?t.bind.legend:"click",o=XX(a)?Qbe(a,"view"):EX(a);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const r=t.name,i=KDe(t.bind)&&t.bind.legend,a=e=>t=>{const n=qSe(t);return n.markname=e,n};for(const o of t.project.items){if(!o.hasLegend)continue;const e=pEe(o.field)+"_legend",s=`${r}_${e}`;if(0===n.filter(e=>e.name===s).length){const r=i.merge.map(a(e+"_symbols")).concat(i.merge.map(a(e+"_labels"))).concat(i.merge.map(a(e+"_entries")));n.unshift(Object.assign(Object.assign({name:s},t.init?{}:{value:null}),{on:[{events:r,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:"!event.item || !datum ? null : "+s,force:!0}]}))}}return n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.find(e=>e.name===r+Rje),o=r+aje,s=i.items.filter(e=>e.hasLegend).map(e=>pEe(`${r}_${pEe(e.field)}_legend`)),l=`${s.map(e=>e+" !== null").join(" && ")} ? {fields: ${o}, values: [${s.join(", ")}]} : null`;t.events&&s.length>0?a.on.push({events:s.map(e=>({signal:e})),update:l}):s.length>0&&(a.update=l,delete a.value,delete a.on);const u=n.find(e=>e.name===r+lje),c=KDe(t.bind)&&t.bind.legend;return u&&(t.events?u.on.push(Object.assign(Object.assign({},u.on[0]),{events:c})):u.on[0].events=c),n}},mje="_translate_anchor",gje="_translate_delta",vje={has:e=>"interval"===e.type&&e.translate,signals:(e,t,n)=>{const r=t.name,i=dje.has(t),a=r+mje,{x:o,y:s}=t.project.hasChannel;let l=Qbe(t.translate,"scope");return i||(l=l.map(e=>(e.between[0].markname=r+Cje,e))),n.push({name:a,value:{},on:[{events:l.map(e=>e.between[0]),update:"{x: x(unit), y: y(unit)"+(void 0!==o?", extent_x: "+(i?hje(e,eTe):`slice(${o.signals.visual})`):"")+(void 0!==s?", extent_y: "+(i?hje(e,tTe):`slice(${s.signals.visual})`):"")+"}"}]},{name:r+gje,value:{},on:[{events:l,update:`{x: ${a}.x - x(unit), y: ${a}.y - y(unit)}`}]}),void 0!==o&&yje(e,t,o,"width",n),void 0!==s&&yje(e,t,s,"height",n),n}};function yje(e,t,n,r,i){var a;const o=t.name,s=o+mje,l=o+gje,u=n.channel,c=dje.has(t),d=i.filter(e=>e.name===n.signals[c?"data":"visual"])[0],h=e.getSizeSignalRef(r).signal,f=e.getScaleComponent(u),p=f.get("type"),m=`${s}.extent_${u}`,g=`${c?"log"===p?"panLog":"pow"===p?"panPow":"panLinear":"panLinear"}(${m}, ${`${c&&u===eTe?"-":""}${l}.${u} / `+(c?""+h:`span(${m})`)}`+(c&&"pow"===p?", "+(null!==(a=f.get("exponent"))&&void 0!==a?a:1):"")+")";d.on.push({events:{signal:l},update:c?g:`clampRange(${g}, 0, ${h})`})}const bje="_zoom_delta",xje={has:e=>"interval"===e.type&&e.zoom,signals:(e,t,n)=>{const r=t.name,i=dje.has(t),a=r+bje,{x:o,y:s}=t.project.hasChannel,l=rK(e.scaleName(eTe)),u=rK(e.scaleName(tTe));let c=Qbe(t.zoom,"scope");return i||(c=c.map(e=>(e.markname=r+Cje,e))),n.push({name:r+"_zoom_anchor",on:[{events:c,update:i?"{"+[l?`x: invert(${l}, x(unit))`:"",u?`y: invert(${u}, y(unit))`:""].filter(e=>!!e).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==o&&wje(e,t,o,"width",n),void 0!==s&&wje(e,t,s,"height",n),n}};function wje(e,t,n,r,i){var a;const o=t.name,s=n.channel,l=dje.has(t),u=i.filter(e=>e.name===n.signals[l?"data":"visual"])[0],c=e.getSizeSignalRef(r).signal,d=e.getScaleComponent(s),h=d.get("type"),f=l?hje(e,s):u.name,p=o+bje,m=`${l?"log"===h?"zoomLog":"pow"===h?"zoomPow":"zoomLinear":"zoomLinear"}(${f}, ${o}_zoom_anchor.${s}, ${p}`+(l&&"pow"===h?", "+(null!==(a=d.get("exponent"))&&void 0!==a?a:1):"")+")";u.on.push({events:{signal:p},update:l?m:`clampRange(${m}, 0, ${c})`})}const _je=[{has:()=>!0,parse:(e,t,n)=>{var r,i,a;const o=t.name,s=null!==(r=t.project)&&void 0!==r?r:t.project=new oje,l={},u={},c=new Set,d=(e,t)=>{const n="visual"===t?e.channel:e.field;let r=pEe(`${o}_${n}`);for(let i=1;c.has(r);i++)r=pEe(`${o}_${n}_${i}`);return c.add(r),{[t]:r}};if(!n.fields&&!n.encodings){const t=e.config.selection[n.type];if(n.init)for(const e of EX(n.init))for(const r of cEe(e))UTe[r]?(n.encodings||(n.encodings=[])).push(r):"interval"===n.type?(HCe(ae.INTERVAL_INITIALIZED_WITH_X_Y),n.encodings=t.encodings):(n.fields||(n.fields=[])).push(r);else n.encodings=t.encodings,n.fields=t.fields}for(const h of null!==(i=n.fields)&&void 0!==i?i:[]){const e={type:"E",field:h};e.signals=Object.assign({},d(e,"data")),s.items.push(e),s.hasField[h]=e}for(const h of null!==(a=n.encodings)&&void 0!==a?a:[]){const n=e.fieldDef(h);if(n){let r=n.field;if(n.aggregate){HCe(ae.cannotProjectAggregate(h,n.aggregate));continue}if(!r){HCe(ae.cannotProjectOnChannelWithoutField(h));continue}if(n.timeUnit){r=e.vgField(h);const t={timeUnit:n.timeUnit,as:r,field:n.field};u[KSe(t)]=t}if(!l[r]){let i="E";"interval"===t.type?WIe(e.getScaleComponent(h).get("type"))&&(i="R"):n.bin&&(i="R-RE");const a={field:r,channel:h,type:i};a.signals=Object.assign(Object.assign({},d(a,"data")),d(a,"visual")),s.items.push(l[r]=a),s.hasField[r]=s.hasChannel[h]=l[r]}}else HCe(ae.cannotProjectOnChannelWithoutField(h))}if(n.init){const e=e=>s.items.map(t=>void 0!==e[t.channel]?e[t.channel]:e[t.field]);if("interval"===n.type)t.init=e(n.init);else{const r=EX(n.init);t.init=r.map(e)}}uEe(u)||(s.timeUnit=new ije(null,u))},signals:(e,t,n)=>{const r=t.name+aje;return n.filter(e=>e.name===r).length>0?n:n.concat({name:r,value:t.project.items.map(e=>{const t=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["signals","hasLegend"]);return t.field=wEe(t.field),t})})}},uje,dje,pje,vje,xje,sje,eje,cje];function Sje(e,t){for(const n of _je)n.has(e)&&t(n)}function Eje(e,t=!0,n=zY){if(QY(e)){const r=e.map(e=>Eje(e,t,n));return t?`[${r.join(", ")}]`:r}return WCe(e)?n(t?KCe(e):function(e){const t=XCe(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}(e)):t?n(JSON.stringify(e)):e}function Tje(e,t){return Lje(e,(n,r)=>{t=r.marks?r.marks(e,n,t):t,Sje(n,r=>{r.marks&&(t=r.marks(e,n,t))})}),t}function kje(e){return e.map(e=>(e.on&&!e.on.length&&delete e.on,e))}const Cje="_brush",Ije="_scale_trigger",Oje={signals:(e,t)=>{const n=t.name,r=n+aje,i=dje.has(t),a=[],o=[],s=[];if(t.translate&&!i){const e="!event.item || event.item.mark.name !== "+rK(n+Cje);Aje(t,(t,n)=>{var r;const i=EX(null!==(r=n.between[0].filter)&&void 0!==r?r:n.between[0].filter=[]);return i.indexOf(e)<0&&i.push(e),t})}t.project.items.forEach((n,r)=>{const i=n.channel;if(i!==eTe&&i!==tTe)return void HCe("Interval selections only support x and y encoding channels.");const l=function(e,t,n,r){const i=n.channel,a=n.signals.visual,o=n.signals.data,s=dje.has(t),l=rK(e.scaleName(i)),u=e.getScaleComponent(i),c=u?u.get("type"):void 0,d=e=>`scale(${l}, ${e})`,h=e.getSizeSignalRef(i===eTe?"width":"height").signal,f=i+"(unit)",p=Aje(t,(e,t)=>[...e,{events:t.between[0],update:`[${f}, ${f}]`},{events:t,update:`[${a}[0], clamp(${f}, 0, ${h})]`}]);return p.push({events:{signal:t.name+Ije},update:WIe(c)?`[${d(o+"[0]")}, ${d(o+"[1]")}]`:"[0, 0]"}),s?[{name:o,on:[]}]:[Object.assign(Object.assign({name:a},r?{init:Eje(r,!0,d)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},r?{init:Eje(r)}:{}),{on:[{events:{signal:a},update:`${a}[0] === ${a}[1] ? null : invert(${l}, ${a})`}]})]}(e,t,n,t.init?t.init[r]:null),u=n.signals.data,c=n.signals.visual,d=rK(e.scaleName(i)),h=WIe(e.getScaleComponent(i).get("type"))?"+":"";a.push(...l),o.push(u),s.push({scaleName:e.scaleName(i),expr:`(!isArray(${u}) || (${h}invert(${d}, ${c})[0] === ${h}${u}[0] && ${h}invert(${d}, ${c})[1] === ${h}${u}[1]))`})}),i||a.push({name:n+Ije,value:{},on:[{events:s.map(e=>({scale:e.scaleName})),update:s.map(e=>e.expr).join(" && ")+` ? ${n+Ije} : {}`}]});const l=t.init,u=`unit: ${$je(e)}, fields: ${r}, values`;return a.concat(Object.assign(Object.assign({name:n+Rje},l?{init:`{${u}: ${Eje(l)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${u}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>t.name+Rje+", "+("global"===t.resolve?"true":`{unit: ${$je(e)}}`),marks:(e,t,n)=>{const r=t.name,{x:i,y:a}=t.project.hasChannel,o=i&&i.signals.visual,s=a&&a.signals.visual,l=`data(${rK(t.name+jje)})`;if(dje.has(t))return n;const u={x:void 0!==i?{signal:o+"[0]"}:{value:0},y:void 0!==a?{signal:s+"[0]"}:{value:0},x2:void 0!==i?{signal:o+"[1]"}:{field:{group:"width"}},y2:void 0!==a?{signal:s+"[1]"}:{field:{group:"height"}}};if("global"===t.resolve)for(const g of cEe(u))u[g]=[Object.assign({test:`${l}.length && ${l}[0].unit === ${$je(e)}`},u[g]),{value:0}];const c=t.mark,{fill:d,fillOpacity:h,cursor:f}=c,p=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(c,["fill","fillOpacity","cursor"]),m=cEe(p).reduce((e,t)=>(e[t]=[{test:[void 0!==i&&`${o}[0] !== ${o}[1]`,void 0!==a&&`${s}[0] !== ${s}[1]`].filter(e=>e).join(" && "),value:p[t]},{value:null}],e),{});return[{name:r+Cje+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:d},fillOpacity:{value:h}},update:u}},...n,{name:r+Cje,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},f?{cursor:{value:f}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},u),m)}}]}};function Aje(e,t){return e.events.reduce((e,n)=>n.between?t(e,n):(HCe(n+" is not an ordered event stream for interval selections."),e),[])}function Dje(e,t){const n=t.name,r=n+aje,i="(item().isVoronoi ? datum.datum : datum)",a=t.project.items.map(t=>{const n=e.fieldDef(t.channel);return n&&n.bin?`[${i}[${rK(e.vgField(t.channel,{}))}], ${i}[${rK(e.vgField(t.channel,{binSuffix:"end"}))}]]`:`${i}[${rK(t.field)}]`}).join(", "),o=`unit: ${$je(e)}, fields: ${r}, values`,s=t.events;return[{name:n+Rje,on:s?[{events:s,update:`datum && item().mark.marktype !== 'group' ? {${o}: [${a}]} : null`,force:!0}]:[]}]}const Mje={signals:Dje,modifyExpr:(e,t)=>t.name+Rje+", "+("global"===t.resolve?"null":`{unit: ${$je(e)}}`)},Nje={signals:Dje,modifyExpr:(e,t)=>t.name+Rje+", "+("global"===t.resolve?"true":`{unit: ${$je(e)}}`)},jje="_store",Rje="_tuple",Pje="vlSelectionResolve",Fje={single:Nje,multi:Mje,interval:Oje};function Lje(e,t){const n=e.component.selection;if(n)for(const r of dEe(n))if(!0===t(r,Fje[r.type]))break}function $je(e,{escape:t}={escape:!0}){let n=t?rK(e.name):e.name;const r=function(e){let t=e.parent;for(;t&&!iFe(t);)t=t.parent;return t}(e);if(r){const{facet:e}=r;for(const t of LTe)e[t]&&(n+=` + '__facet_${t}_' + (facet[${rK(r.vgField(t))}])`)}return n}function Bje(e){let t=!1;return Lje(e,e=>{t=t||e.project.items.some(e=>e.field===GDe)}),t}function zje(e){const t=_ge(e),n=new Set;return t.visit(e=>{"MemberExpression"===e.type&&function e(t){return"MemberExpression"===t.object.type?e(t.object):"datum"===t.object.name}(e)&&n.add(function e(t){const n=[];return"Identifier"===t.type?[t.name]:"Literal"===t.type?[t.value]:("MemberExpression"===t.type&&(n.push(...e(t.object)),n.push(...e(t.property))),n)}(e).slice(1).join("."))}),n}class Uje extends tje{constructor(e,t,n){super(e),this.model=t,this.filter=n,this.expr=qje(this.model,this.filter,this),this._dependentFields=zje(this.expr)}clone(){return new Uje(null,this.model,qSe(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return"Filter "+this.expr}}var Hje=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Wje(e,t,n,r="datum"){const i=[],a=mEe(t,(function(t){const a=pEe(t),o=e.getSelectionComponent(a,t),s=rK(a+jje);if(o.project.timeUnit){const t=null!=n?n:e.component.data.raw,r=o.project.timeUnit.clone();t.parent?r.insertAsParentOf(t):t.parent=r}return"none"!==o.empty&&i.push(s),`vlSelectionTest(${s}, ${r}`+("global"===o.resolve?")":`, ${rK(o.resolve)})`)}));return(i.length?"!("+i.map(e=>`length(data(${e}))`).join(" || ")+") || ":"")+`(${a})`}function Vje(e,t){const n=t.encoding;let r=t.field;if(n||r){if(n&&!r){const i=e.project.items.filter(e=>e.channel===n);!i.length||i.length>1?(r=e.project.items[0].field,HCe((i.length?"Multiple ":"No ")+`matching ${rK(n)} encoding found for selection ${rK(t.selection)}. `+`Using "field": ${rK(r)}.`)):r=i[0].field}}else r=e.project.items[0].field,e.project.items.length>1&&HCe(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${rK(r)}.`);return`${e.name}[${rK(r)}]`}function qje(e,t,n){return mEe(t,t=>XX(t)?t:function(e){return null==e?void 0:e.selection}(t)?Wje(e,t.selection,n):xIe(t))}var Gje=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Yje(e,t,n,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update[n]=r}function Xje(e,t,n,r={header:!1}){var i,a;const o=e.combine(),{disable:s,orient:l,scale:u,labelExpr:c,title:d,zindex:h}=o,f=Gje(o,["disable","orient","scale","labelExpr","title","zindex"]);if(!s){for(const e in f){const n=PEe[e],r=f[e];if(n&&n!==t&&"both"!==n)delete f[e];else if(jEe(r)){const{condition:t}=r,n=Gje(r,["condition"]),i=EX(t),a=NEe[e];if(a){const{vgProp:t,part:r}=a;Yje(f,r,t,[...i.map(e=>{const{test:t}=e,n=Gje(e,["test"]);return Object.assign({test:qje(null,t)},n)}),n]),delete f[e]}else if(null===a){const t={signal:i.map(e=>{const{test:t}=e,n=Gje(e,["test"]);return`${qje(null,t)} ? ${GAe(n)} : `}).join("")+GAe(n)};f[e]=t}}else if(aIe(r)){const t=NEe[e];if(t){const{vgProp:n,part:i}=t;Yje(f,i,n,r),delete f[e]}}}if("grid"===t){if(!f.grid)return;if(f.encode){const{grid:e}=f.encode;f.encode=Object.assign({},e?{grid:e}:{}),uEe(f.encode)&&delete f.encode}return Object.assign(Object.assign({scale:u,orient:l},f),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:TEe(h,0)})}{if(!r.header&&e.mainExtracted)return;if(void 0!==c){let e=c;(null===(a=null===(i=f.encode)||void 0===i?void 0:i.labels)||void 0===a?void 0:a.update)&&aIe(f.encode.labels.update.text)&&(e=_Ee(c,"datum.label",f.encode.labels.update.text.signal)),Yje(f,"labels","text",{signal:e})}if(null===f.labelAlign&&delete f.labelAlign,f.encode){for(const t of REe)e.hasAxisPart(t)||delete f.encode[t];uEe(f.encode)&&delete f.encode}const t=function(e,t){if(e)return QY(e)&&!zAe(e)?e.map(e=>CAe(e,t)).join(", "):e}(d,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:u,orient:l,grid:!1},t?{title:t}:{}),f),!1===n.aria?{aria:!1}:{}),{zindex:TEe(h,0)})}}}function Kje(e){const{axes:t}=e.component,n=[];for(const r of QTe)if(t[r])for(const i of t[r])if(!i.get("disable")&&!i.get("gridScale")){const t="x"===r?"height":"width",i=e.getSizeSignalRef(t).signal;t!==i&&n.push({name:t,update:i})}return n}function Zje(e,t,n,r){return Object.assign.apply(null,[{},...e.map(e=>{if("axisOrient"===e){const e="x"===n?"bottom":"left",i=t["x"===n?"axisBottom":"axisLeft"]||{},a=t["x"===n?"axisTop":"axisRight"]||{},o=new Set([...cEe(i),...cEe(a)]),s={};for(const t of o.values())s[t]={signal:`${r.signal} === "${e}" ? ${YAe(i[t])} : ${YAe(a[t])}`};return s}return t[e]})])}function Jje(e,t){var n;const r=[{}];for(const i of e){let e=null===(n=t[i])||void 0===n?void 0:n.style;if(e){e=EX(e);for(const n of e)r.push(t.style[n])}}return Object.assign.apply(null,r)}function Qje(e,t,n,r={}){var i;const a=QAe(e,n,t);if(void 0!==a)return{configFrom:"style",configValue:a};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(void 0!==(null===(i=r[o])||void 0===i?void 0:i[e]))return{configFrom:o,configValue:r[o][e]};return{}}const eRe={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:r,formatType:i}=n;return FOe(e,e.type,r,i,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return LOe(r,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var r;return(!oAe(e)||!pke(e.bin))&&(null!==(r=t.grid)&&void 0!==r?r:function(e,t){return!HIe(e)&&oAe(t)&&!fke(null==t?void 0:t.bin)}(n,e))},gridScale:({model:e,channel:t})=>function(e,t){const n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelAlign||rRe(t,n,r),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelBaseline||nRe(t,n,r),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var r;return null!==(r=e.labelFlush)&&void 0!==r?r:function(e,t){if("x"===t&&JSe(["quantitative","temporal"],e))return!0}(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var r;return null!==(r=e.labelOverlap)&&void 0!==r?r:function(e,t,n,r){if(n&&!eX(r)||"nominal"!==e&&"ordinal"!==e)return"log"!==t&&"symlog"!==t||"greedy"}(t.type,n,oAe(t)&&!!t.timeUnit,oAe(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:r,scaleType:i})=>{var a;const o="x"===e?"width":"y"===e?"height":void 0,s=o?t.getSizeSignalRef(o):void 0;return null!==(a=n.tickCount)&&void 0!==a?a:function({fieldOrDatumDef:e,scaleType:t,size:n,values:r}){var i;if(!r&&!HIe(t)&&"log"!==t){if(oAe(e)){if(fke(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&JSe(["month","hours","day","quarter"],null===(i=iIe(e.timeUnit))||void 0===i?void 0:i.unit))return}return{signal:`ceil(${n.signal}/40)`}}}({fieldOrDatumDef:r,scaleType:i,size:s,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(void 0!==e.title)return e.title;const r=iRe(t,n);if(void 0!==r)return r;const i=t.typedFieldDef(n),a=t.fieldDef("x"===n?"x2":"y2");return tDe(i?[QOe(i)]:[],oAe(a)?[QOe(a)]:[])},values:({axis:e,fieldOrDatumDef:t})=>function(e,t){const n=e.values;return QY(n)?LAe(t,n):aIe(n)?n:void 0}(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var r;return null!==(r=e.zindex)&&void 0!==r?r:function(e,t){return"rect"===e&&xAe(t)?1:0}(n,t)}};function tRe(e){return`(((${e.signal} % 360) + 360) % 360)`}function nRe(e,t,n,r){if(void 0!==e){if("x"===n){if(aIe(e)){const n=tRe(e);return{signal:`(45 < ${n} && ${n} < 135) || (225 < ${n} && ${n} < 315) ? "middle" :(${n} <= 45 || 315 <= ${n}) === ${aIe(t)?`(${t.signal} === "top")`:"top"===t} ? "bottom" : "top"`}}return 45<e&&e<135||225<e&&e<315?"middle":aIe(t)?{signal:`${t.signal} ${e<=45||315<=e?"===":"!=="} "top" ? "bottom" : "top"`}:(e<=45||315<=e)==("top"===t)?"bottom":"top"}if(aIe(e)){const n=tRe(e);return{signal:`${n} <= 45 || 315 <= ${n} || (135 <= ${n} && ${n} <= 225) ? ${r?'"middle"':"null"} : (45 <= ${n} && ${n} <= 135) === ${aIe(t)?`(${t.signal} === "left")`:"left"===t} ? "top" : "bottom"`}}return e<=45||315<=e||135<=e&&e<=225?r?"middle":null:aIe(t)?{signal:`${t.signal} ${45<=e&&e<=135?"===":"!=="} "left" ? "top" : "bottom"`}:(45<=e&&e<=135)==("left"===t)?"top":"bottom"}}function rRe(e,t,n){if(void 0===e)return;const r="x"===n,i=r?0:90,a=r?"bottom":"left";if(aIe(e)){const n=tRe(e);return{signal:`(${i?"("+n+" + 90)":n} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${n} && ${n} < ${180+i}) === ${aIe(t)?`(${t.signal} === "${a}")`:t===a} ? "left" : "right"`}}return(e+i)%180==0?r?null:"center":aIe(t)?{signal:`${t.signal} ${i<e&&e<180+i?"===":"!=="} "${a}" ? "left" : "right"`}:(i<e&&e<180+i)==(t===a)?"left":"right"}function iRe(e,t){const n="x"===t?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),a=r?r.title:void 0,o=i?i.title:void 0;return a&&o?nDe(a,o):a||o||(void 0!==a?a:void 0!==o?o:void 0)}class aRe extends tje{constructor(e,t){super(e),this.transform=t,this._dependentFields=zje(this.transform.calculate)}clone(){return new aRe(null,qSe(this.transform))}static parseAllForSortIndex(e,t){return t.forEachFieldDef((t,n)=>{if(pAe(t)&&YOe(t.sort)){const{field:r,timeUnit:i}=t,a=t.sort,o=a.map((e,t)=>`${xIe({field:r,timeUnit:i,equal:e})} ? ${t} : `).join("")+a.length;e=new aRe(e,{calculate:o,as:oRe(t,n,{forAs:!0})})}}),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return"Calculate "+KSe(this.transform)}}function oRe(e,t,n){return bAe(e,Object.assign({prefix:t,suffix:"sort_index"},null!=n?n:{}))}function sRe(e,t){return JSe(["top","bottom"],t)?"column":JSe(["left","right"],t)||"row"===e?"row":"column"}function lRe(e,t,n,r){return TEe((t||{})[e],("row"===r?n.headerRow:"column"===r?n.headerColumn:n.headerFacet)[e],n.header[e])}function uRe(e,t,n,r){const i={};for(const a of e){const e=lRe(a,t||{},n,r);void 0!==e&&(i[a]=e)}return i}const cRe=["row","column"],dRe=["header","footer"];function hRe(e,t){const n=e.component.layoutHeaders[t].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:a,titleAngle:o,titleOrient:s}=uRe(["titleAnchor","titleAngle","titleOrient"],i.header,r,t),l=sRe(t,s),u=DEe(o);return{name:t+"-title",type:"group",role:l+"-title",title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},"row"===t?{orient:"left"}:{}),{style:"guide-title"}),pRe(u,l)),fRe(l,u,a)),wRe(r,i,t,BDe,LDe))}}function fRe(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=rRe(t,"row"===e?"left":"top","row"===e?"y":"x");return r?{align:r}:{}}function pRe(e,t){const n=nRe(e,"row"===t?"left":"top","row"===t?"y":"x",!0);return n?{baseline:n}:{}}function mRe(e,t){const n=e.component.layoutHeaders[t],r=[];for(const i of dRe)if(n[i])for(const a of n[i]){const o=yRe(e,t,i,n,a);null!=o&&r.push(o)}return r}function gRe(e,t){var n;const{sort:r}=e;return GOe(r)?{field:bAe(r,{expr:"datum"}),order:null!==(n=r.order)&&void 0!==n?n:"ascending"}:QY(r)?{field:oRe(e,t,{expr:"datum"}),order:"ascending"}:{field:bAe(e,{expr:"datum"}),order:null!=r?r:"ascending"}}function vRe(e,t,n){const{format:r,formatType:i,labelAngle:a,labelAnchor:o,labelOrient:s,labelExpr:l}=uRe(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),u=jOe({fieldOrDatumDef:e,format:r,formatType:i,expr:"parent",config:n}).signal,c=sRe(t,s);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:l?_Ee(_Ee(l,"datum.label",u),"datum.value",bAe(e,{expr:"parent"})):u}},"row"===t?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),pRe(a,c)),fRe(c,a,o)),wRe(n,e,t,zDe,$De))}function yRe(e,t,n,r,i){if(i){let a=null;const{facetFieldDef:o}=r,s=e.config?e.config:void 0;if(o&&i.labels){const{labelOrient:e}=uRe(["labelOrient"],o.header,s,t);("row"===t&&!JSe(["top","bottom"],e)||"column"===t&&!JSe(["left","right"],e))&&(a=vRe(o,t,s))}const l=iFe(e)&&!XOe(e.facet),u=i.axes,c=(null==u?void 0:u.length)>0;if(a||c){const s="row"===t?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:gRe(o,t)}:{}),c&&l?{from:{data:e.getName("facet_domain_"+t)}}:{}),a?{title:a}:{}),i.sizeSignal?{encode:{update:{[s]:i.sizeSignal}}}:{}),c?{axes:u}:{})}}return null}const bRe={column:{start:0,end:1},row:{start:1,end:0}};function xRe(e,t){return bRe[t][e]}function wRe(e,t,n,r,i){const a={};for(const o of r){if(!i[o])continue;const r=lRe(o,null==t?void 0:t.header,e,n);void 0!==r&&(a[i[o]]=r)}return a}function _Re(e){return[...SRe(e,"width"),...SRe(e,"height"),...SRe(e,"childWidth"),...SRe(e,"childHeight")]}function SRe(e,t){const n="width"===t?"x":"y",r=e.component.layoutSize.get(t);if(!r||"merged"===r)return[];const i=e.getSizeSignalRef(t).signal;if("step"===r){const t=e.getScaleComponent(n);if(t){const r=t.get("type"),a=t.get("range");if(HIe(r)&&oIe(a)){const r=e.scaleName(n);return iFe(e.parent)&&"independent"===e.parent.component.resolve.scale[n]?[ERe(r,a)]:[ERe(r,a),{name:i,update:TRe(r,t,`domain('${r}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==r){const t=i.endsWith("width"),n=t?"containerSize()[0]":"containerSize()[1]",r=`isFinite(${n}) ? ${n} : ${rMe(e.config.view,t?"width":"height")}`;return[{name:i,init:r,on:[{update:r,events:"window:resize"}]}]}return[{name:i,value:r}]}function ERe(e,t){return{name:e+"_step",value:t.step}}function TRe(e,t,n){const r=t.get("type"),i=t.get("padding"),a=TEe(t.get("paddingOuter"),i);let o=t.get("paddingInner");return o="band"===r?void 0!==o?o:i:1,`bandspace(${n}, ${YAe(o)}, ${YAe(a)}) * ${e}_step`}function kRe(e){return"childWidth"===e?"width":"childHeight"===e?"height":e}function CRe(e,t){return cEe(e).reduce((n,r)=>{const i=e[r];return Object.assign(Object.assign({},n),CNe(t,i,r,e=>qAe(e.value)))},{})}function IRe(e,t){if(oFe(t)||iFe(t))return"shared";if(aFe(t))return eke(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function ORe(e,t){const n=e.scale[t],r=eke(t)?"axis":"legend";return"independent"===n?("shared"===e[r][t]&&HCe(ae.independentScaleMeansIndependentGuide(t)),"independent"):e[r][t]||"shared"}const ARe=Object.assign(Object.assign({},WDe),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),DRe=cEe(ARe);class MRe extends YMe{}const NRe={symbols:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i,legendType:a}){var o,s,l,u,c,d,h,f;if("symbol"!==a)return;const{markDef:p,encoding:m,config:g,mark:v}=n,y=p.filled&&"trail"!==v;let b=Object.assign(Object.assign({},function(e,t,n){for(const r of n){const n=ZAe(r,t.markDef,t.config);void 0!==n&&(e[r]=qAe(n))}return e}({},n,xOe)),jNe(n,{filled:y}));const x=null!==(o=i.get("symbolOpacity"))&&void 0!==o?o:g.legend.symbolOpacity,w=null!==(s=i.get("symbolFillColor"))&&void 0!==s?s:g.legend.symbolFillColor,_=null!==(l=i.get("symbolStrokeColor"))&&void 0!==l?l:g.legend.symbolStrokeColor,S=void 0===x?null!==(u=jRe(m.opacity))&&void 0!==u?u:p.opacity:void 0;if(b.fill)if("fill"===r||y&&r===hTe)delete b.fill;else if(b.fill.field)w?delete b.fill:(b.fill=qAe(null!==(c=g.legend.symbolBaseFillColor)&&void 0!==c?c:"black"),b.fillOpacity=qAe(null!=S?S:1));else if(QY(b.fill)){const e=null!==(f=null!==(h=RRe(null!==(d=m.fill)&&void 0!==d?d:m.color))&&void 0!==h?h:p.fill)&&void 0!==f?f:y&&p.color;e&&(b.fill=qAe(e))}if(b.stroke)if("stroke"===r||!y&&r===hTe)delete b.stroke;else if(b.stroke.field||_)delete b.stroke;else if(QY(b.stroke)){const e=TEe(RRe(m.stroke||m.color),p.stroke,y?p.color:void 0);e&&(b.stroke={value:e})}if(r!==yTe){const e=oAe(t)&&FRe(0,i,t);e?b.opacity=[Object.assign({test:e},qAe(null!=S?S:1)),qAe(g.legend.unselectedOpacity)]:S&&(b.opacity=qAe(S))}return b=Object.assign(Object.assign({},b),e),uEe(b)?void 0:b},gradient:function(e,{model:t,legendType:n,legendCmpt:r}){var i;if("gradient"!==n)return;const{config:a,markDef:o,encoding:s}=t;let l={};const u=void 0===(null!==(i=r.get("gradientOpacity"))&&void 0!==i?i:a.legend.gradientOpacity)?jRe(s.opacity)||o.opacity:void 0;return u&&(l.opacity=qAe(u)),l=Object.assign(Object.assign({},l),e),uEe(l)?void 0:l},labels:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i}){const a=n.legend(r)||{},o=n.config,s=oAe(t)?FRe(0,i,t):void 0,l=s?[{test:s,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:u,formatType:c}=a,d=MOe(c)?POe({fieldOrDatumDef:t,field:"datum.value",format:u,formatType:c,config:o}):void 0,h=Object.assign(Object.assign(Object.assign({},l?{opacity:l}:{}),d?{text:d}:{}),e);return uEe(h)?void 0:h},entries:function(e,{legendCmpt:t}){const n=t.get("selections");return(null==n?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}};function jRe(e){return PRe(e,(e,t)=>Math.max(e,t.value))}function RRe(e){return PRe(e,(e,t)=>TEe(e,t.value))}function PRe(e,t){return function(e){const t=e&&e.condition;return!!t&&(QY(t)||fAe(t))}(e)?EX(e.condition).reduce(t,e.value):fAe(e)?e.value:void 0}function FRe(e,t,n){const r=t.get("selections");if(!(null==r?void 0:r.length))return;const i=rK(n.field);return r.map(e=>`(!length(data(${rK(pEe(e)+jje)})) || (${e}[${i}] && indexof(${e}[${i}], datum.value) >= 0))`).join(" || ")}const LRe={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:r,formatType:i}=t;return FOe(e,e.type,r,i,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return LOe(r,t,n)},gradientLength:e=>{var t,n;const{legend:r,legendConfig:i}=e;return null!==(n=null!==(t=r.gradientLength)&&void 0!==t?t:i.gradientLength)&&void 0!==n?n:function({legendConfig:e,model:t,direction:n,orient:r,scaleType:i}){const{gradientHorizontalMaxLength:a,gradientHorizontalMinLength:o,gradientVerticalMaxLength:s,gradientVerticalMinLength:l}=e;if(VIe(i))return"horizontal"===n?"top"===r||"bottom"===r?BRe(t,"width",o,a):o:BRe(t,"height",l,s)}(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var r,i;return null!==(i=null!==(r=e.labelOverlap)&&void 0!==r?r:t.labelOverlap)&&void 0!==i?i:function(e){if(JSe(["quantile","threshold","log","symlog"],e))return"greedy"}(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:r})=>{var i;return null!==(i=e.symbolType)&&void 0!==i?i:function(e,t,n,r){var i;if("shape"!==t){const e=null!==(i=RRe(n))&&void 0!==i?i:r;if(e)return e}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(t.type,n,r.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>TAe(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(PTe(n)&&VIe(t)){if("gradient"===e)return}else if("symbol"===e)return;return e},values:({fieldOrDatumDef:e,legend:t})=>function(e,t){const n=e.values;return QY(n)?LAe(t,n):aIe(n)?n:void 0}(t,e)};function $Re({legendConfig:e,legendType:t,orient:n,legend:r}){var i,a;return null!==(a=null!==(i=r.direction)&&void 0!==i?i:e[t?"gradientDirection":"symbolDirection"])&&void 0!==a?a:function(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===t?"horizontal":void 0}}(n,t)}function BRe(e,t,n,r){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${r})`}}function zRe(e,t,n,r){switch(t){case"disable":return void 0!==n;case"values":return!!(null==n?void 0:n.values);case"title":if("title"===t&&e===(null==r?void 0:r.title))return!0}return e===(n||{})[t]}function URe(e,t){var n,r,i;let a=e.legend(t);const{markDef:o,encoding:s,config:l}=e,u=l.legend,c=new MRe({},function(e,t){const n=e.scaleName(t);if("trail"===e.mark){if("color"===t)return{stroke:n};if("size"===t)return{strokeWidth:n}}return"color"===t?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}(e,t));!function(e,t,n){var r;const i=null===(r=e.fieldDef(t))||void 0===r?void 0:r.field;Lje(e,e=>{var r,a;const o=null!==(r=e.project.hasField[i])&&void 0!==r?r:e.project.hasChannel[t];if(o&&pje.has(e)){const t=null!==(a=n.get("selections"))&&void 0!==a?a:[];t.push(e.name),n.set("selections",t,!1),o.hasLegend=!0}})}(e,t,c);const d=void 0!==a?!a:u.disable;if(c.set("disable",d,void 0!==a),d)return c;a=a||{};const h=e.getScaleComponent(t).get("type"),f=AAe(s[t]),p=oAe(f)?null===(n=iIe(f.timeUnit))||void 0===n?void 0:n.unit:void 0,m=a.orient||l.legend.orient||"right",g=function(e){const{legend:t}=e;return TEe(t.type,function({channel:e,timeUnit:t,scaleType:n}){if(PTe(e)){if(JSe(["quarter","month","day"],t))return"symbol";if(VIe(n))return"gradient"}return"symbol"}(e))}({legend:a,channel:t,timeUnit:p,scaleType:h}),v={legend:a,channel:t,model:e,markDef:o,encoding:s,fieldOrDatumDef:f,legendConfig:u,config:l,scaleType:h,orient:m,legendType:g,direction:$Re({legend:a,legendType:g,orient:m,legendConfig:u})};for(const _ of DRe){if("gradient"===g&&_.startsWith("symbol")||"symbol"===g&&_.startsWith("gradient"))continue;const n=_ in LRe?LRe[_](v):a[_];if(void 0!==n){const r=zRe(n,_,a,e.fieldDef(t));(r||void 0===l.legend[_])&&c.set(_,n,r)}}const y=null!==(r=null==a?void 0:a.encoding)&&void 0!==r?r:{},b=c.get("selections"),x={},w={fieldOrDatumDef:f,model:e,channel:t,legendCmpt:c,legendType:g};for(const _ of["labels","legend","title","symbols","gradient","entries"]){const t=CRe(null!==(i=y[_])&&void 0!==i?i:{},e),n=_ in NRe?NRe[_](t,w):t;void 0===n||uEe(n)||(x[_]=Object.assign(Object.assign(Object.assign({},(null==b?void 0:b.length)&&oAe(f)?{name:`${pEe(f.field)}_legend_${_}`}:{}),(null==b?void 0:b.length)?{interactive:!!b}:{}),{update:n}))}return uEe(x)||c.set("encode",x,!!(null==a?void 0:a.encoding)),c}function HRe(e,t){var n,r,i,a;if(!e)return t.clone();const o=e.getWithExplicit("orient"),s=t.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value)return;let l=!1;for(const u of DRe){const n=QMe(e.getWithExplicit(u),t.getWithExplicit(u),u,"legend",(e,t)=>{switch(u){case"symbolType":return"circle"===(n=t).value?n:e;case"title":return rDe(e,t);case"type":return l=!0,KMe("symbol")}var n;return JMe(e,t,u,"legend")});e.setWithExplicit(u,n)}return l&&((null===(r=null===(n=e.implicit)||void 0===n?void 0:n.encode)||void 0===r?void 0:r.gradient)&&gEe(e.implicit,["encode","gradient"]),(null===(a=null===(i=e.explicit)||void 0===i?void 0:i.encode)||void 0===a?void 0:a.gradient)&&gEe(e.explicit,["encode","gradient"])),e}function WRe(e){const t=e.component.legends,n={};for(const r of cEe(t)){const i=e.getScaleComponent(r),a=XSe(i.get("domains"));if(n[a])for(const e of n[a])HRe(e,t[r])||n[a].push(t[r]);else n[a]=[t[r].clone()]}return dEe(n).flat().map(t=>function(e,t){var n,r,i;const a=e.combine(),{disable:o,labelExpr:s}=a,l=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(a,["disable","labelExpr","selections"]);if(!o){if(!1===t.aria&&null==l.aria&&(l.aria=!1),null===(n=l.encode)||void 0===n?void 0:n.symbols){const e=l.encode.symbols.update;!e.fill||"transparent"===e.fill.value||e.stroke||l.stroke||(e.stroke={value:"transparent"});for(const t of HDe)l[t]&&delete e[t]}if(l.title||delete l.title,void 0!==s){let e=s;(null===(i=null===(r=l.encode)||void 0===r?void 0:r.labels)||void 0===i?void 0:i.update)&&aIe(l.encode.labels.update.text)&&(e=_Ee(s,"datum.label",l.encode.labels.update.text.signal)),function(e,t,n,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update.text=r}(l,"labels",0,{signal:e})}return l}}(t,e.config)).filter(e=>void 0!==e)}function VRe(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:r}=n;if(t.data){const i={signal:`[${t.size.map(e=>e.signal).join(", ")}]`},a=t.data.reduce((t,n)=>{const r=aIe(n)?n.signal:`data('${e.lookupDataSource(n)}')`;return JSe(t,r)||t.push(r),t},[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:r,size:i,fit:{signal:a.length>1?`[${a.join(", ")}]`:a[0]}},n)]}return[Object.assign(Object.assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const qRe=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class GRe extends YMe{constructor(e,t,n,r){super(Object.assign({},t),{name:e}),this.specifiedProjection=t,this.size=n,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function YRe(e,t){return`${hke(e)}_${t}`}function XRe(e,t,n){var r;const i=YRe(null!==(r=jAe(n,void 0))&&void 0!==r?r:{},t);return e.getName(i+"_bins")}function KRe(e,t,n){let r,i;r=function(e){return"as"in e}(e)?XX(e.as)?[e.as,e.as+"_end"]:[e.as[0],e.as[1]]:[bAe(e,{forAs:!0}),bAe(e,{binSuffix:"end",forAs:!0})];const a=Object.assign({},jAe(t,void 0)),o=YRe(a,e.field),{signal:s,extentSignal:l}=function(e,t){return{signal:e.getName(t+"_bins"),extentSignal:e.getName(t+"_extent")}}(n,o);if(gke(a.extent)){const e=a.extent,t=e.selection;i=Vje(n.getSelectionComponent(pEe(t),t),e),delete a.extent}return{key:o,binComponent:Object.assign(Object.assign(Object.assign({bin:a,field:e.field,as:[r]},s?{signal:s}:{}),l?{extentSignal:l}:{}),i?{span:i}:{})}}class ZRe extends tje{constructor(e,t){super(e),this.bins=t}clone(){return new ZRe(null,qSe(this.bins))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((e,n,r)=>{if(hAe(n)&&fke(n.bin)){const{key:i,binComponent:a}=KRe(n,n.bin,t);e[i]=Object.assign(Object.assign(Object.assign({},a),e[i]),function(e,t,n,r){var i,a;if($Ae(t,n)){const o=rFe(e)&&null!==(a=null!==(i=e.axis(n))&&void 0!==i?i:e.legend(n))&&void 0!==a?a:{},s=bAe(t,{expr:"datum"}),l=bAe(t,{expr:"datum",binSuffix:"end"});return{formulaAs:bAe(t,{binSuffix:"range",forAs:!0}),formula:UOe(s,l,o.format,o.formatType,r)}}return{}}(t,n,r,t.config))}return e},{});return uEe(n)?null:new ZRe(e,n)}static makeFromTransform(e,t,n){const{key:r,binComponent:i}=KRe(t,t.bin,n);return new ZRe(e,{[r]:i})}merge(e,t){for(const n of cEe(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=rEe([...this.bins[n].as,...e.bins[n].as],KSe)):this.bins[n]=e.bins[n];for(const n of e.children)e.removeChild(n),n.parent=this;e.remove()}producedFields(){return new Set(dEe(this.bins).map(e=>e.as).flat(2))}dependentFields(){return new Set(dEe(this.bins).map(e=>e.field))}hash(){return"Bin "+KSe(this.bins)}assemble(){return dEe(this.bins).flatMap(e=>{const t=[],[n,...r]=e.as,i=e.bin,{extent:a}=i,o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(i,["extent"]),s=Object.assign(Object.assign(Object.assign({type:"bin",field:wEe(e.field),as:n,signal:e.signal},gke(a)?{extent:null}:{extent:a}),e.span?{span:{signal:`span(${e.span})`}}:{}),o);!a&&e.extentSignal&&(t.push({type:"extent",field:wEe(e.field),signal:e.extentSignal}),s.extent={signal:e.extentSignal}),t.push(s);for(const l of r)for(let e=0;e<2;e++)t.push({type:"formula",expr:bAe({field:n[e]},{expr:"datum"}),as:l[e]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t})}}class JRe extends tje{constructor(e,t,n){super(e),this.dimensions=t,this.measures=n}clone(){return new JRe(null,new Set(this.dimensions),qSe(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef(e=>{e.aggregate&&(n=!0)});const r={},i=new Set;return n?(t.forEachFieldDef((e,n)=>{var a,o,s,l;const{aggregate:u,field:c}=e;if(u)if("count"===u)r["*"]=null!==(a=r["*"])&&void 0!==a?a:{},r["*"].count=new Set([bAe(e,{forAs:!0})]);else{if(HEe(u)||WEe(u)){const e=HEe(u)?"argmin":"argmax",t=u[e];r[t]=null!==(o=r[t])&&void 0!==o?o:{},r[t][e]=new Set([bAe({op:e,field:t},{forAs:!0})])}else r[c]=null!==(s=r[c])&&void 0!==s?s:{},r[c][u]=new Set([bAe(e,{forAs:!0})]);lke(n)&&"unaggregated"===t.scaleDomain(n)&&(r[c]=null!==(l=r[c])&&void 0!==l?l:{},r[c].min=new Set([bAe({field:c,aggregate:"min"},{forAs:!0})]),r[c].max=new Set([bAe({field:c,aggregate:"max"},{forAs:!0})]))}else!function(e,t,n,r){const i=rFe(r)?r.encoding[YTe(t)]:void 0;if(hAe(n)&&rFe(r)&&nAe(t,n,i,r.stack,r.markDef,r.config))e.add(bAe(n,{})),e.add(bAe(n,{suffix:"end"})),n.bin&&$Ae(n,t)&&e.add(bAe(n,{binSuffix:"range"}));else if(t in NTe){const n=function(e){switch(e){case lTe:return"y";case cTe:return"y2";case uTe:return"x";case dTe:return"x2"}}(t);e.add(r.getName(n))}else e.add(bAe(n))}(i,n,e,t)}),i.size+cEe(r).length===0?null:new JRe(e,i,r)):null}static makeFromTransform(e,t){var n,r,i;const a=new Set,o={};for(const s of t.aggregate){const{op:e,field:t,as:i}=s;e&&("count"===e?(o["*"]=null!==(n=o["*"])&&void 0!==n?n:{},o["*"].count=new Set([i||bAe(s,{forAs:!0})])):(o[t]=null!==(r=o[t])&&void 0!==r?r:{},o[t][e]=new Set([i||bAe(s,{forAs:!0})])))}for(const s of null!==(i=t.groupby)&&void 0!==i?i:[])a.add(s);return a.size+cEe(o).length===0?null:new JRe(e,a,o)}merge(e){return aEe(this.dimensions,e.dimensions)?(function(e,t){var n;for(const r of cEe(t)){const i=t[r];for(const t of cEe(i))r in e?e[r][t]=new Set([...null!==(n=e[r][t])&&void 0!==n?n:[],...i[t]]):e[r]={[t]:i[t]}}}(this.measures,e.measures),!0):(UCe.debug("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...cEe(this.measures)])}producedFields(){const e=new Set;for(const t of cEe(this.measures))for(const n of cEe(this.measures[t])){const r=this.measures[t][n];0===r.size?e.add(`${n}_${t}`):r.forEach(e.add,e)}return e}hash(){return"Aggregate "+KSe({dimensions:this.dimensions,measures:this.measures})}assemble(){const e=[],t=[],n=[];for(const r of cEe(this.measures))for(const i of cEe(this.measures[r]))for(const a of this.measures[r][i])n.push(a),e.push(i),t.push("*"===r?null:wEe(r));return{type:"aggregate",groupby:[...this.dimensions].map(wEe),ops:e,fields:t,as:n}}}class QRe extends tje{constructor(e,t,n,r){super(e),this.model=t,this.name=n,this.data=r;for(const i of LTe){const e=t.facet[i];if(e){const{bin:n,sort:r}=e;this[i]=Object.assign({name:t.getName(i+"_domain"),fields:[bAe(e),...fke(n)?[bAe(e,{binSuffix:"end"})]:[]]},GOe(r)?{sortField:r}:QY(r)?{sortIndexField:oRe(e,i)}:{})}}this.childModel=t.child}hash(){let e="Facet";for(const t of LTe)this[t]&&(e+=` ${t.charAt(0)}:${KSe(this[t])}`);return e}get fields(){var e;const t=[];for(const n of LTe)(null===(e=this[n])||void 0===e?void 0:e.fields)&&t.push(...this[n].fields);return t}dependentFields(){const e=new Set(this.fields);for(const t of LTe)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of QTe){const n=this.childModel.component.scales[t];if(n&&!n.merged){const r=n.get("type"),i=n.get("range");if(HIe(r)&&oIe(i)){const n=BPe(zPe(this.childModel,t));n?e[t]=n:HCe(ae.unknownField(t))}}}return e}assembleRowColumnHeaderData(e,t,n){const r={row:"y",column:"x"}[e],i=[],a=[],o=[];n&&n[r]&&(t?(i.push("distinct_"+n[r]),a.push("max")):(i.push(n[r]),a.push("distinct")),o.push("distinct_"+n[r]));const{sortField:s,sortIndexField:l}=this[e];if(s){const{op:e=HOe,field:t}=s;i.push(t),a.push(e),o.push(bAe(s,{forAs:!0}))}else l&&(i.push(l),a.push("max"),o.push(l));return{name:this[e].name,source:null!=t?t:this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},i.length?{fields:i,ops:a,as:o}:{})]}}assembleFacetHeaderData(e){var t,n;const{columns:r}=this.model.layout,{layoutHeaders:i}=this.model.component,a=[],o={};for(const u of cRe){for(const e of dRe){const r=null!==(t=i[u]&&i[u][e])&&void 0!==t?t:[];for(const e of r)if((null===(n=e.axes)||void 0===n?void 0:n.length)>0){o[u]=!0;break}}if(o[u]){const e=`length(data("${this.facet.name}"))`;a.push({name:`${this.facet.name}_${u}`,transform:[{type:"sequence",start:0,stop:"row"===u?r?{signal:`ceil(${e} / ${r})`}:1:r?{signal:`min(${e}, ${r})`}:{signal:e}}]})}}const{row:s,column:l}=o;return(s||l)&&a.unshift(this.assembleRowColumnHeaderData("facet",null,e)),a}assemble(){var e,t;const n=[];let r=null;const i=this.getChildIndependentFieldsWithStep(),{column:a,row:o,facet:s}=this;if(a&&o&&(i.x||i.y)){r=`cross_${this.column.name}_${this.row.name}`;const a=[].concat(null!==(e=i.x)&&void 0!==e?e:[],null!==(t=i.y)&&void 0!==t?t:[]),o=a.map(()=>"distinct");n.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:a,ops:o}]})}for(const l of[JEe,ZEe])this[l]&&n.push(this.assembleRowColumnHeaderData(l,r,i));if(s){const e=this.assembleFacetHeaderData(i);e&&n.push(...e)}return n}}function ePe(e){return"'"===e[0]&&"'"===e[e.length-1]||'"'===e[0]&&'"'===e[e.length-1]?e.slice(1,-1):e}function tPe(e){const t={};return function e(t,n){if(HSe(t))e(t.not,n);else if(USe(t))for(const r of t.and)e(r,n);else if(zSe(t))for(const r of t.or)e(r,n);else n(t)}(e.filter,e=>{var n;if(yIe(e)){let r=null;dIe(e)?r=WAe(e.equal):fIe(e)?r=WAe(e.lte):hIe(e)?r=WAe(e.lt):pIe(e)?r=WAe(e.gt):mIe(e)?r=WAe(e.gte):gIe(e)?r=e.range[0]:vIe(e)&&(r=(null!==(n=e.oneOf)&&void 0!==n?n:e.in)[0]),r&&(WCe(r)?t[e.field]="date":GX(r)?t[e.field]="number":XX(r)&&(t[e.field]="string")),e.timeUnit&&(t[e.field]="date")}}),t}class nPe extends tje{constructor(e,t){super(e),this._parse=t}clone(){return new nPe(null,qSe(this._parse))}hash(){return"Parse "+KSe(this._parse)}static makeExplicit(e,t,n){let r={};const i=t.data;return!iNe(i)&&i&&i.format&&i.format.parse&&(r=i.format.parse),this.makeWithAncestors(e,r,{},n)}static makeWithAncestors(e,t,n,r){for(const o of cEe(n)){const e=r.getWithExplicit(o);void 0!==e.value&&(e.explicit||e.value===n[o]||"derived"===e.value||"flatten"===n[o]?delete n[o]:HCe(ae.differentParse(o,n[o],e.value)))}for(const o of cEe(t)){const e=r.get(o);void 0!==e&&(e===t[o]?delete t[o]:HCe(ae.differentParse(o,t[o],e)))}const i=new YMe(t,n);r.copyAll(i);const a={};for(const o of cEe(i.combine())){const e=i.get(o);null!==e&&(a[o]=e)}return 0===cEe(a).length||r.parseNothing?null:new nPe(e,a)}get parse(){return this._parse}merge(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}assembleFormatParse(){const e={};for(const t of cEe(this._parse)){const n=this._parse[t];1===EEe(t)&&(e[t]=n)}return e}producedFields(){return new Set(cEe(this._parse))}dependentFields(){return new Set(cEe(this._parse))}assembleTransforms(e=!1){return cEe(this._parse).filter(t=>!e||EEe(t)>1).map(e=>{const t=function(e,t){const n=yEe(e);return"number"===t?`toNumber(${n})`:"boolean"===t?`toBoolean(${n})`:"string"===t?`toString(${n})`:"date"===t?`toDate(${n})`:"flatten"===t?n:0===t.indexOf("date:")?`timeParse(${n},'${ePe(t.slice(5,t.length))}')`:0===t.indexOf("utc:")?`utcParse(${n},'${ePe(t.slice(4,t.length))}')`:(HCe(ae.unrecognizedParse(t)),null)}(e,this._parse[e]);return t?{type:"formula",expr:t,as:SEe(e)}:null}).filter(e=>null!==e)}}class rPe extends tje{clone(){return new rPe(null)}constructor(e){super(e)}dependentFields(){return new Set}producedFields(){return new Set([GDe])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:GDe}}}class iPe extends tje{constructor(e,t){super(e),this.params=t}clone(){return new iPe(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return"Graticule "+KSe(this.params)}assemble(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)}}class aPe extends tje{constructor(e,t){super(e),this.params=t}clone(){return new aPe(null,this.params)}dependentFields(){return new Set}producedFields(){var e;return new Set([null!==(e=this.params.as)&&void 0!==e?e:"data"])}hash(){return"Hash "+KSe(this.params)}assemble(){return Object.assign({type:"sequence"},this.params)}}class oPe extends tje{constructor(e){let t;if(super(null),iNe(e=null!=e?e:{name:"source"})||(t=e.format?Object.assign({},YSe(e.format,["parse"])):{}),nNe(e))this._data={values:e.values};else if(tNe(e)){if(this._data={url:e.url},!t.type){let n=/(?:\.([^.]+))?$/.exec(e.url)[1];JSe(["json","csv","tsv","dsv","topojson"],n)||(n="json"),t.type=n}}else oNe(e)?this._data={values:[{type:"Sphere"}]}:(rNe(e)||iNe(e))&&(this._data={});this._generator=iNe(e),e.name&&(this._name=e.name),t&&!uEe(t)&&(this._data.format=t)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var sPe,lPe=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n};function uPe(e){return e instanceof oPe||e instanceof iPe||e instanceof aPe}class cPe{constructor(){sPe.set(this,void 0),lPe(this,sPe,!1)}setModified(){lPe(this,sPe,!0)}get modifiedFlag(){return function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}(this,sPe)}}sPe=new WeakMap;class dPe extends cPe{getNodeDepths(e,t,n){n.set(e,t);for(const r of e.children)this.getNodeDepths(r,t+1,n);return n}optimize(e){const t=[...this.getNodeDepths(e,0,new Map).entries()].sort((e,t)=>t[1]-e[1]);for(const n of t)this.run(n[0]);return this.modifiedFlag}}class hPe extends cPe{optimize(e){this.run(e);for(const t of e.children)this.optimize(t);return this.modifiedFlag}}class fPe extends hPe{mergeNodes(e,t){const n=t.shift();for(const r of t)e.removeChild(r),r.parent=n,r.remove()}run(e){const t=e.children.map(e=>e.hash()),n={};for(let r=0;r<t.length;r++)void 0===n[t[r]]?n[t[r]]=[e.children[r]]:n[t[r]].push(e.children[r]);for(const r of cEe(n))n[r].length>1&&(this.setModified(),this.mergeNodes(e,n[r]))}}class pPe extends hPe{constructor(e){super(),this.requiresSelectionId=e&&Bje(e)}run(e){e instanceof rPe&&(this.requiresSelectionId&&(uPe(e.parent)||e.parent instanceof JRe||e.parent instanceof nPe)||(this.setModified(),e.remove()))}}class mPe extends cPe{optimize(e){return this.run(e,new Set),this.modifiedFlag}run(e,t){let n=new Set;e instanceof ije&&(n=e.producedFields(),oEe(n,t)&&(this.setModified(),e.removeFormulas(t),0===e.producedFields.length&&e.remove()));for(const r of e.children)this.run(r,new Set([...t,...n]))}}class gPe extends hPe{constructor(){super()}run(e){e instanceof nje&&!e.isRequired()&&(this.setModified(),e.remove())}}class vPe extends dPe{run(e){if(!(uPe(e)||e.numChildren()>1))for(const t of e.children)if(t instanceof nPe)if(e instanceof nPe)this.setModified(),e.merge(t);else{if(lEe(e.producedFields(),t.dependentFields()))continue;this.setModified(),t.swapWithParent()}}}class yPe extends dPe{run(e){const t=[...e.children],n=e.children.filter(e=>e instanceof nPe);if(e.numChildren()>1&&n.length>=1){const r={},i=new Set;for(const e of n){const t=e.parse;for(const e of cEe(t))e in r?r[e]!==t[e]&&i.add(e):r[e]=t[e]}for(const e of i)delete r[e];if(!uEe(r)){this.setModified();const n=new nPe(e,r);for(const i of t){if(i instanceof nPe)for(const e of cEe(r))delete i.parse[e];e.removeChild(i),i.parent=n,i instanceof nPe&&0===cEe(i.parse).length&&i.remove()}}}}}class bPe extends dPe{run(e){e instanceof nje||e.numChildren()>0||e instanceof QRe||e instanceof oPe||(this.setModified(),e.remove())}}class xPe extends dPe{run(e){const t=e.children.filter(e=>e instanceof ije),n=t.pop();for(const r of t)this.setModified(),n.merge(r)}}class wPe extends dPe{run(e){const t=e.children.filter(e=>e instanceof JRe),n={};for(const r of t){const e=KSe(r.groupBy);e in n||(n[e]=[]),n[e].push(r)}for(const r of cEe(n)){const t=n[r];if(t.length>1){const n=t.pop();for(const r of t)n.merge(r)&&(e.removeChild(r),r.parent=n,r.remove(),this.setModified())}}}}class _Pe extends dPe{constructor(e){super(),this.model=e}run(e){const t=!(uPe(e)||e instanceof Uje||e instanceof nPe||e instanceof rPe),n=[],r=[];for(const i of e.children)i instanceof ZRe&&(t&&!lEe(e.producedFields(),i.dependentFields())?n.push(i):r.push(i));if(n.length>0){const t=n.pop();for(const e of n)t.merge(e,this.model.renameSignal.bind(this.model));this.setModified(),e instanceof ZRe?e.merge(t,this.model.renameSignal.bind(this.model)):t.swapWithParent()}if(r.length>1){const e=r.pop();for(const t of r)e.merge(t,this.model.renameSignal.bind(this.model));this.setModified()}}}class SPe extends dPe{run(e){const t=[...e.children];if(!QSe(t,e=>e instanceof nje)||e.numChildren()<=1)return;const n=[];let r;for(const i of t)if(i instanceof nje){let t=i;for(;1===t.numChildren();){const[e]=t.children;if(!(e instanceof nje))break;t=e}n.push(...t.children),r?(e.removeChild(i),i.parent=r.parent,r.parent.removeChild(r),r.parent=t,this.setModified()):r=t}else n.push(i);if(n.length){this.setModified();for(const e of n)e.parent.removeChild(e),e.parent=r}}}class EPe extends tje{constructor(e,t){super(e),this.transform=t}clone(){return new EPe(null,qSe(this.transform))}addDimensions(e){this.transform.groupby=rEe(this.transform.groupby.concat(e),e=>e)}dependentFields(){const e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map(e=>e.field).filter(e=>void 0!==e).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:bAe(e)}hash(){return"JoinAggregateTransform "+KSe(this.transform)}assemble(){const e=[],t=[],n=[];for(const i of this.transform.joinaggregate)t.push(i.op),n.push(this.getDefaultName(i)),e.push(void 0===i.field?null:i.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:t,fields:e},void 0!==r?{groupby:r}:{})}}class TPe extends tje{constructor(e,t){super(e),this._stack=t}clone(){return new TPe(null,qSe(this._stack))}static makeFromTransform(e,t){const{stack:n,groupby:r,as:i,offset:a="zero"}=t,o=[],s=[];if(void 0!==t.sort)for(const c of t.sort)o.push(c.field),s.push(TEe(c.order,"ascending"));const l={field:o,order:s};let u;return u=function(e){return QY(e)&&e.every(e=>XX(e))&&e.length>1}(i)?i:XX(i)?[i,i+"_end"]:[t.stack+"_start",t.stack+"_end"],new TPe(e,{stackField:n,groupby:r,offset:a,sort:l,facetby:[],as:u})}static makeFromEncoding(e,t){const n=t.stack,{encoding:r}=t;if(!n)return null;const{groupbyChannel:i,fieldChannel:a,offset:o,impute:s}=n;let l;i&&(l=OAe(r[i]));const u=function(e){return e.stack.stackBy.reduce((e,t)=>{const n=bAe(t.fieldDef);return n&&e.push(n),e},[])}(t),c=t.encoding.order;let d;return d=QY(c)||oAe(c)?eDe(c):u.reduce((e,t)=>(e.field.push(t),e.order.push("y"===a?"descending":"ascending"),e),{field:[],order:[]}),new TPe(e,{dimensionFieldDef:l,stackField:t.vgField(a),facetby:[],stackby:u,sort:d,offset:o,impute:s,as:[t.vgField(a,{suffix:"start",forAs:!0}),t.vgField(a,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return"Stack "+KSe(this._stack)}getGroupbyFields(){const{dimensionFieldDef:e,impute:t,groupby:n}=this._stack;return e?e.bin?t?[bAe(e,{binSuffix:"mid"})]:[bAe(e,{}),bAe(e,{binSuffix:"end"})]:[bAe(e)]:null!=n?n:[]}assemble(){const e=[],{facetby:t,dimensionFieldDef:n,stackField:r,stackby:i,sort:a,offset:o,impute:s,as:l}=this._stack;if(s&&n){const{band:a=.5,bin:o}=n;o&&e.push({type:"formula",expr:a+"*"+bAe(n,{expr:"datum"})+`+${1-a}*`+bAe(n,{expr:"datum",binSuffix:"end"}),as:bAe(n,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:r,groupby:[...i,...t],key:bAe(n,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:r,sort:a,as:l,offset:o}),e}}class kPe extends tje{constructor(e,t){super(e),this.transform=t}clone(){return new kPe(null,qSe(this.transform))}addDimensions(e){this.transform.groupby=rEe(this.transform.groupby.concat(e),e=>e)}dependentFields(){var e,t;const n=new Set;return(null!==(e=this.transform.groupby)&&void 0!==e?e:[]).forEach(n.add,n),(null!==(t=this.transform.sort)&&void 0!==t?t:[]).forEach(e=>n.add(e.field)),this.transform.window.map(e=>e.field).filter(e=>void 0!==e).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:bAe(e)}hash(){return"WindowTransform "+KSe(this.transform)}assemble(){var e;const t=[],n=[],r=[],i=[];for(const c of this.transform.window)n.push(c.op),r.push(this.getDefaultName(c)),i.push(void 0===c.param?null:c.param),t.push(void 0===c.field?null:c.field);const a=this.transform.frame,o=this.transform.groupby;if(a&&null===a[0]&&null===a[1]&&n.every(e=>VEe(e)))return Object.assign({type:"joinaggregate",as:r,ops:n,fields:t},void 0!==o?{groupby:o}:{});const s=[],l=[];if(void 0!==this.transform.sort)for(const c of this.transform.sort)s.push(c.field),l.push(null!==(e=c.order)&&void 0!==e?e:"ascending");const u=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:i,as:r,ops:n,fields:t,sort:{field:s,order:l}},void 0!==u?{ignorePeers:u}:{}),void 0!==o?{groupby:o}:{}),void 0!==a?{frame:a}:{})}}function CPe(e){if(e instanceof QRe)if(1!==e.numChildren()||e.children[0]instanceof nje){const n=e.model.component.data.main;!function e(t){if(t instanceof nje&&t.type===lNe.Main&&1===t.numChildren()){const n=t.children[0];n instanceof QRe||(n.swapWithParent(),e(t))}}(n);const r=(t=e,function e(n){if(!(n instanceof QRe)){const r=n.clone();if(r instanceof nje){const e=IPe+r.getSource();r.setSource(e),t.model.component.data.outputNodes[e]=r}else(r instanceof JRe||r instanceof TPe||r instanceof kPe||r instanceof EPe)&&r.addDimensions(t.fields);for(const t of n.children.flatMap(e))t.parent=r;return[r]}return n.children.flatMap(e)}),i=e.children.map(r).flat();for(const e of i)e.parent=n}else{const t=e.children[0];(t instanceof JRe||t instanceof TPe||t instanceof kPe||t instanceof EPe)&&t.addDimensions(e.fields),t.swapWithParent(),CPe(e)}else e.children.map(CPe);var t}const IPe="scale_";function OPe(e){for(const t of e){for(const e of t.children)if(e.parent!==t)return!1;if(!OPe(t.children))return!1}return!0}function APe(e,t){let n=!1;for(const r of t)n=e.optimize(r)||n;return n}function DPe(e,t,n){let r=e.sources,i=!1;return i=APe(new gPe,r)||i,i=APe(new pPe(t),r)||i,r=r.filter(e=>e.numChildren()>0),i=APe(new bPe,r)||i,r=r.filter(e=>e.numChildren()>0),n||(i=APe(new vPe,r)||i,i=APe(new _Pe(t),r)||i,i=APe(new mPe,r)||i,i=APe(new yPe,r)||i,i=APe(new wPe,r)||i,i=APe(new xPe,r)||i,i=APe(new fPe,r)||i,i=APe(new SPe,r)||i),e.sources=r,i}class MPe{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new MPe(()=>e(t))}}function NPe(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:r}=e,i=function(e,t,n,r){if("unaggregated"===e){const{valid:e,reason:r}=LPe(t,n);if(!e)return void HCe(r)}else if(void 0===e&&r.useUnaggregatedDomain){const{valid:e}=LPe(t,n);if(e)return"unaggregated"}return e}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:i})),"x"===t&&AAe(r.x2)?AAe(r.x)?QMe(RPe(n,i,e,"x"),RPe(n,i,e,"x2"),"domain","scale",$Pe):RPe(n,i,e,"x2"):"y"===t&&AAe(r.y2)?AAe(r.y)?QMe(RPe(n,i,e,"y"),RPe(n,i,e,"y2"),"domain","scale",$Pe):RPe(n,i,e,"y2"):RPe(n,i,e,t)}function jPe(e,t,n){var r;const i=null===(r=iIe(n))||void 0===r?void 0:r.unit;return"temporal"===t||i?function(e,t,n){return e.map(e=>({signal:`{data: ${FAe(e,{timeUnit:n,type:t})}}`}))}(e,t,i):[e]}function RPe(e,t,n,r){const{encoding:i}=n,a=AAe(i[r]),{type:o}=a,s=a.timeUnit;if(function(e){return e&&e.unionWith}(t)){const i=RPe(e,void 0,n,r),a=jPe(t.unionWith,o,s);return XMe([...i.value,...a])}if(aIe(t))return XMe([t]);if(t&&"unaggregated"!==t&&!GIe(t))return XMe(jPe(t,o,s));const l=n.stack;if(l&&r===l.fieldChannel){if("normalize"===l.offset)return KMe([[0,1]]);const e=n.requestDataName(lNe.Main);return KMe([{data:e,field:n.vgField(r,{suffix:"start"})},{data:e,field:n.vgField(r,{suffix:"end"})}])}const u=lke(r)&&oAe(a)?function(e,t,n){if(!HIe(n))return;const r=e.fieldDef(t),i=r.sort;if(YOe(i))return{op:"min",field:oRe(r,t),order:"ascending"};const{stack:a}=e,o=a?[...a.groupbyField?[a.groupbyField]:[],...a.stackBy.map(e=>e.fieldDef.field)]:void 0;if(GOe(i))return PPe(i,a&&!JSe(o,i.field));if(qOe(i)){const{encoding:t,order:n}=i,r=e.fieldDef(t),{aggregate:s,field:l}=r,u=a&&!JSe(o,l);if(HEe(s)||WEe(s))return PPe({field:bAe(r),order:n},u);if(VEe(s)||!s)return PPe({op:s,field:l,order:n},u)}else{if("descending"===i)return{op:"min",field:e.vgField(t),order:"descending"};if(JSe(["ascending",void 0],i))return!0}}(n,r,e):void 0;if(lAe(a))return KMe(jPe([a.datum],o,s));const c=a;if("unaggregated"===t){const e=n.requestDataName(lNe.Main),{field:t}=a;return KMe([{data:e,field:bAe({field:t,aggregate:"min"})},{data:e,field:bAe({field:t,aggregate:"max"})}])}if(fke(c.bin)){if(HIe(e))return KMe("bin-ordinal"===e?[]:[{data:fEe(u)?n.requestDataName(lNe.Main):n.requestDataName(lNe.Raw),field:n.vgField(r,$Ae(c,r)?{binSuffix:"range"}:{}),sort:!0!==u&&eX(u)?u:{field:n.vgField(r,{}),op:"min"}}]);{const{bin:e}=c;if(fke(e)){const t=XRe(n,c.field,e);return KMe([new MPe(()=>{const e=n.getSignalName(t);return`[${e}.start, ${e}.stop]`})])}return KMe([{data:n.requestDataName(lNe.Main),field:n.vgField(r,{})}])}}if(c.timeUnit&&JSe(["time","utc"],e)&&nAe(r,c,rFe(n)?n.encoding[YTe(r)]:void 0,n.stack,n.markDef,n.config)){const e=n.requestDataName(lNe.Main);return KMe([{data:e,field:n.vgField(r)},{data:e,field:n.vgField(r,{suffix:"end"})}])}return KMe(u?[{data:fEe(u)?n.requestDataName(lNe.Main):n.requestDataName(lNe.Raw),field:n.vgField(r),sort:u}]:[{data:n.requestDataName(lNe.Main),field:n.vgField(r)}])}function PPe(e,t){const{op:n,field:r,order:i}=e;return Object.assign(Object.assign({op:null!=n?n:t?"sum":HOe},r?{field:wEe(r)}:{}),i?{order:i}:{})}function FPe(e,t){var n;const r=e.component.scales[t],i=e.specifiedScales[t].domain,a=null===(n=e.fieldDef(t))||void 0===n?void 0:n.bin,o=GIe(i)&&i,s=mke(a)&&gke(a.extent)&&a.extent;(o||s)&&r.set("selectionExtent",null!=o?o:s,!0)}function LPe(e,t){const{aggregate:n,type:r}=e;return n?XX(n)&&!XEe[n]?{valid:!1,reason:ae.unaggregateDomainWithNonSharedDomainOp(n)}:"quantitative"===r&&"log"===t?{valid:!1,reason:ae.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:ae.unaggregateDomainHasNoEffectForRawField(e)}}function $Pe(e,t,n,r){return e.explicit&&t.explicit&&HCe(ae.mergeConflictingDomainProperty(n,r,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function BPe(e){if(sIe(e)&&XX(e.field))return e.field;if(function(e){return!QY(e)&&"fields"in e&&!("data"in e)}(e)){let t;for(const n of e.fields)if(sIe(n)&&XX(n.field))if(t){if(t!==n.field)return HCe(ae.FACETED_INDEPENDENT_DIFFERENT_SOURCES),t}else t=n.field;return HCe(ae.FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES),t}if(function(e){return!QY(e)&&"fields"in e&&"data"in e}(e)){HCe(ae.FACETED_INDEPENDENT_SAME_SOURCE);const t=e.fields[0];return XX(t)?t:void 0}}function zPe(e,t){return function(e){const t=rEe(e.map(e=>sIe(e)?function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["sort"]):e),KSe),n=rEe(e.map(e=>{if(sIe(e)){const t=e.sort;return void 0===t||fEe(t)||("op"in t&&"count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}}).filter(e=>void 0!==e),KSe);if(0===t.length)return;if(1===t.length){const t=e[0];if(sIe(t)&&n.length>0){let e=n[0];return n.length>1?(HCe(ae.MORE_THAN_ONE_SORT),e=!0):eX(e)&&"field"in e&&t.field===e.field&&(e=!e.order||{order:e.order}),Object.assign(Object.assign({},t),{sort:e})}return t}const r=rEe(n.map(e=>fEe(e)||!("op"in e)||XX(e.op)&&e.op in UEe?e:(HCe(ae.domainSortDropped(e)),!0)),KSe);let i;1===r.length?i=r[0]:r.length>1&&(HCe(ae.MORE_THAN_ONE_SORT),i=!0);const a=rEe(e.map(e=>sIe(e)?e.data:null),e=>e);return Object.assign(1===a.length&&null!==a[0]?{data:a[0],fields:t.map(e=>e.field)}:{fields:t},i?{sort:i}:{})}(e.component.scales[t].get("domains").map(t=>(sIe(t)&&(t.data=e.lookupDataSource(t.data)),t)))}function UPe(e){return cEe(e.component.scales).reduce((t,n)=>{const r=e.component.scales[n];if(r.merged)return t;const i=r.combine(),{name:a,type:o,selectionExtent:s,reverse:l}=i,u=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(i,["name","type","selectionExtent","domains","range","reverse"]),c=function(e,t,n,r){if(eke(n)){if(oIe(e))return{step:{signal:t+"_step"}}}else if(eX(e)&&sIe(e))return Object.assign(Object.assign({},e),{data:r.lookupDataSource(e.data)});return e}(i.range,a,n,e);let d;s&&(d=function(e,t){const n=t.selection;return{signal:Vje(e.getSelectionComponent(n,pEe(n)),t)}}(e,s));const h=zPe(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:a,type:o},h?{domain:h}:{}),d?{domainRaw:d}:{}),{range:c}),void 0!==l?{reverse:l}:{}),u)),t},[])}class HPe extends YMe{constructor(e,t){super({},{name:e}),this.merged=!1,this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||QSe(this.get("domains"),e=>QY(e)&&2===e.length&&e[0]<=0&&e[1]>=0)}}const WPe=["range","scheme"];function VPe(e){return"x"===e?"width":"y"===e?"height":void 0}function qPe(e,t){const n=e.fieldDef(t);if(n&&n.bin&&fke(n.bin)){const r=XRe(e,n.field,n.bin),i=VPe(t),a=e.getName(i);return new MPe(()=>{const t=e.getSignalName(r),n=`(${t}.stop - ${t}.start) / ${t}.step`;return`${e.getSignalName(a)} / (${n})`})}}function GPe(e,t){const n=t.specifiedScales[e],{size:r}=t,i=t.getScaleComponent(e).get("type");for(const u of WPe)if(void 0!==n[u]){const r=ZIe(i,u),o=JIe(e,u);if(r)if(o)HCe(o);else switch(u){case"range":{const r=n.range;if(QY(r)){if(eke(e))return XMe(r.map(e=>{if("width"===e||"height"===e){const n=t.getName(e),r=t.getSignalName.bind(t);return MPe.fromName(r,n)}return e}))}else if(eX(r))return XMe({data:t.requestDataName(lNe.Main),field:r.field,sort:{op:"min",field:t.vgField(e)}});return XMe(r)}case"scheme":return XMe(function(e){return!XX(e)&&!!e.name}(a=n[u])?Object.assign({scheme:a.name},YSe(a,["name"])):{scheme:a})}else HCe(ae.scalePropertyNotWorkWithScaleType(i,u,e))}var a;if(e===eTe||e===tTe){const t=e===eTe?"width":"height",n=r[t];if(eMe(n)){if(HIe(i))return XMe({step:n.step});HCe(ae.stepDropped(t))}}const{rangeMin:o,rangeMax:s}=n,l=function(e,t){const{size:n,config:r,mark:i,encoding:a}=t,o=t.getSignalName.bind(t),{type:s}=AAe(a[e]),l=t.getScaleComponent(e).get("type"),{domain:u,domainMid:c}=t.specifiedScales[e];switch(e){case eTe:case tTe:{if(JSe(["point","band"],l))if(e!==eTe||n.width){if(e===tTe&&!n.height){const e=aMe(r.view,"height");if(eMe(e))return e}}else{const e=aMe(r.view,"width");if(eMe(e))return e}const i=VPe(e),a=t.getName(i);return e===tTe&&WIe(l)?[MPe.fromName(o,a),0]:[0,MPe.fromName(o,a)]}case gTe:{const a=function e(t,n,r){if(n)return aIe(n)?{signal:`${n.signal} ? 0 : ${e(t,!1,r)}`}:0;switch(t){case"bar":case"tick":return r.scale.minBandSize;case"line":case"trail":case"rule":return r.scale.minStrokeWidth;case"text":return r.scale.minFontSize;case"point":case"square":case"circle":return r.scale.minSize}throw new Error(ae.incompatibleChannel("size",t))}(i,t.component.scales[e].get("zero"),r),o=function(e,t,n,r){const i={x:qPe(n,"x"),y:qPe(n,"y")};switch(e){case"bar":case"tick":{if(void 0!==r.scale.maxBandSize)return r.scale.maxBandSize;const e=XPe(t,i,r.view);return GX(e)?e-1:new MPe(()=>e.signal+" - 1")}case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":{if(r.scale.maxSize)return r.scale.maxSize;const e=XPe(t,i,r.view);return GX(e)?Math.pow(YPe*e,2):new MPe(()=>`pow(0.95 * ${e.signal}, 2)`)}}throw new Error(ae.incompatibleChannel("size",e))}(i,n,t,r);return qIe(l)?function(e,t,n){const r=()=>{const r=YAe(t),i=YAe(e),a=`(${r} - ${i}) / (${n} - 1)`;return`sequence(${i}, ${r} + ${a}, ${a})`};return aIe(t)?new MPe(r):{signal:r()}}(a,o,function(e,t,n,r){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return void 0!==n&&QY(n)?n.length+1:(HCe(ae.domainRequiredForThresholdScale(r)),3)}}(l,r,u,e)):[a,o]}case oTe:return[0,2*Math.PI];case vTe:return[0,360];case iTe:return[0,new MPe(()=>`min(${t.getSignalName("width")},${t.getSignalName("height")})/2`)];case wTe:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case _Te:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case mTe:return"symbol";case hTe:case fTe:case pTe:return"ordinal"===l?"nominal"===s?"category":"ordinal":void 0!==c?"diverging":"rect"===i||"geoshape"===i?"heatmap":"ramp";case yTe:case bTe:case xTe:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error("Scale range undefined for channel "+e)}(e,t);return(void 0!==o||void 0!==s)&&ZIe(i,"rangeMin")&&QY(l)&&2===l.length?XMe([null!=o?o:l[0],null!=s?s:l[1]]):KMe(l)}const YPe=.95;function XPe(e,t,n){const r=eMe(e.width)?e.width.step:iMe(n,"width"),i=eMe(e.height)?e.height.step:iMe(n,"height");return t.x||t.y?new MPe(()=>`min(${[t.x?t.x.signal:r,t.y?t.y.signal:i].join(", ")})`):Math.min(r,i)}function KPe(e,t){rFe(e)?function(e,t){const n=e.component.scales,{config:r,encoding:i,markDef:a,specifiedScales:o}=e;for(const s of cEe(n)){const l=o[s],u=n[s],c=e.getScaleComponent(s),d=AAe(i[s]),h=l[t],f=c.get("type"),p=c.get("padding"),m=c.get("paddingInner"),g=ZIe(f,t),v=JIe(s,t);if(void 0!==h&&(g?v&&HCe(v):HCe(ae.scalePropertyNotWorkWithScaleType(f,t,s))),g&&void 0===v)if(void 0!==h){const e=d.timeUnit,n=d.type;switch(t){case"domainMax":case"domainMin":WCe(l[t])||"temporal"===n||e?u.set(t,{signal:FAe(l[t],{type:n,timeUnit:e})},!0):u.set(t,l[t],!0);break;default:u.copyKeyFromObject(t,l)}}else{const n=t in ZPe?ZPe[t]({model:e,channel:s,fieldOrDatumDef:d,scaleType:f,scalePadding:p,scalePaddingInner:m,domain:l.domain,markDef:a,config:r}):r.scale[t];void 0!==n&&u.set(t,n,!1)}}}(e,t):QPe(e,t)}const ZPe={bins:({model:e,fieldOrDatumDef:t})=>oAe(t)?function(e,t){const n=t.bin;if(fke(n)){const r=XRe(e,t.field,n);return new MPe(()=>e.getSignalName(r))}if(pke(n)&&mke(n)&&void 0!==n.step)return{step:n.step}}(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>function(e,t){if(JSe([hTe,fTe,pTe],e)&&"nominal"!==t)return"hcl"}(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>function(e,t,n){var r;if(!(null===(r=OAe(n))||void 0===r?void 0:r.bin)&&!JSe([AIe,DIe],e))return t in JTe||void 0}(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:r,config:i})=>function(e,t,n,r,i,a){if(e in JTe){if(VIe(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;const{type:t,orient:o}=i;if("bar"===t&&(!oAe(r)||!r.bin&&!r.timeUnit)&&("vertical"===o&&"x"===e||"horizontal"===o&&"y"===e))return a.continuousBandSize}if(t===MIe)return n.pointPadding}}(e,t,i.scale,n,r,i.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:r})=>function(e,t,n,r){if(void 0===e&&t in JTe){const{bandPaddingInner:e,barBandPaddingInner:t,rectBandPaddingInner:i}=r;return TEe(e,"bar"===n?t:i)}}(e,t,n.type,r.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,scalePaddingInner:r,config:i})=>function(e,t,n,r,i,a){if(void 0===e&&t in JTe&&"band"===n){const{bandPaddingOuter:e}=a;return TEe(e,aIe(i)?{signal:i.signal+"/2"}:i/2)}}(e,t,n,0,r,i.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:r})=>function(e,t,n,r){return"x"===n&&void 0!==r.xReverse?WIe(e)&&"descending"===t?aIe(r.xReverse)?{signal:"!"+r.xReverse.signal}:!r.xReverse:r.xReverse:!(!WIe(e)||"descending"!==t)||void 0}(t,oAe(e)?e.sort:void 0,n,r.scale),zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:r,scaleType:i})=>function(e,t,n,r,i){if(n&&"unaggregated"!==n&&WIe(i)){if(QY(n)){const e=n[n.length-1];if(n[0]<=0&&e>=0)return!0}return!1}if("size"===e&&"quantitative"===t.type&&!qIe(i))return!0;if((!oAe(t)||!t.bin)&&JSe([...QTe,...nke],e)){const{orient:t,type:n}=r;return!JSe(["bar","area","line","trail"],n)||!("horizontal"===t&&"y"===e||"vertical"===t&&"x"===e)}return!1}(e,t,n,r,i)};function JPe(e){rFe(e)?function(e){const t=e.component.scales;for(const n of ske){const r=t[n];if(!r)continue;const i=GPe(n,e);r.setWithExplicit("range",i)}}(e):QPe(e,"range")}function QPe(e,t){const n=e.component.scales;for(const r of e.children)"range"===t?JPe(r):KPe(r,t);for(const r of cEe(n)){let i;for(const n of e.children){const e=n.component.scales[r];e&&(i=QMe(i,e.getWithExplicit(t),t,"scale",ZMe((e,n)=>{switch(t){case"range":return e.step&&n.step?e.step-n.step:0}return 0})))}n[r].setWithExplicit(t,i)}}const eFe=ZMe((e,t)=>PIe(e)-PIe(t));var tFe=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class nFe{constructor(){this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return void 0!==this.nameMap[e]}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function rFe(e){return"unit"===(null==e?void 0:e.type)}function iFe(e){return"facet"===(null==e?void 0:e.type)}function aFe(e){return"concat"===(null==e?void 0:e.type)}function oFe(e){return"layer"===(null==e?void 0:e.type)}class sFe{constructor(e,t,n,r,i,a,o){var s,l;this.type=t,this.parent=n,this.config=i,this.children=[],this.correctDataNames=e=>(e.from&&e.from.data&&(e.from.data=this.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=this.lookupDataSource(e.from.facet.data)),e),this.parent=n,this.config=i,this.view=eOe(o),this.name=null!==(s=e.name)&&void 0!==s?s:r,this.title=zAe(e.title)?{text:e.title}:e.title?this.initTitle(e.title):void 0,this.scaleNameMap=n?n.scaleNameMap:new nFe,this.projectionNameMap=n?n.projectionNameMap:new nFe,this.signalNameMap=n?n.signalNameMap:new nFe,this.data=e.data,this.description=e.description,this.transforms=(null!==(l=e.transform)&&void 0!==l?l:[]).map(e=>uNe(e)?{filter:WSe(e.filter,_Ie)}:e),this.layout="layer"===t||"unit"===t?{}:function(e,t,n){var r,i;const a=n[t],o={},{spacing:s,columns:l}=a;void 0!==s&&(o.spacing=s),void 0!==l&&(ZOe(e)&&!XOe(e.facet)||ZDe(e))&&(o.columns=l),JDe(e)&&(o.columns=1);for(const u of nMe)if(void 0!==e[u])if("spacing"===u){const t=e[u];o[u]=GX(t)?t:{row:null!==(r=t.row)&&void 0!==r?r:s,column:null!==(i=t.column)&&void 0!==i?i:s}}else o[u]=e[u];return o}(e,t,i),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:ZOe(e)||n&&n.component.data.isFaceted&&void 0===e.data},layoutSize:new YMe,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},a?qSe(a):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}initTitle(e){const t=cEe(e),n={text:WAe(e.text)};for(const r of t)n[r]=WAe(e[r]);return n}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(e,{ignoreRange:t}={}){(function e(t){t.component.scales=rFe(t)?function(e){const{encoding:t,mark:n}=e;return ske.reduce((r,i)=>{const a=AAe(t[i]);if(a&&n===mOe&&i===mTe&&a.type===IIe)return r;let o=a&&a.scale;if(a&&null!==o&&!1!==o){o=null!=o?o:{};const t=function(e,t,n,r){const i=function(e,t,n){var r;switch(t.type){case"nominal":case"ordinal":if(PTe(e)||"discrete"===dke(e))return"shape"===e&&"ordinal"===t.type&&HCe(ae.discreteChannelCannotEncode(e,"ordinal")),"ordinal";if(e in JTe){if(JSe(["rect","bar","image","rule"],n))return"band"}else if("arc"===n&&e in tke)return"band";return void 0!==t.band||mAe(t)&&(null===(r=t.axis)||void 0===r?void 0:r.tickBand)?"band":"point";case"temporal":return PTe(e)?"time":"discrete"===dke(e)?(HCe(ae.discreteChannelCannotEncode(e,"temporal")),"ordinal"):oAe(t)&&t.timeUnit&&iIe(t.timeUnit).utc?"utc":"time";case"quantitative":return PTe(e)?oAe(t)&&fke(t.bin)?"bin-ordinal":"linear":"discrete"===dke(e)?(HCe(ae.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(ae.invalidFieldType(t.type))}(t,n,r),{type:a}=e;return lke(t)?void 0!==a?function(e,t){if(!lke(e))return!1;switch(e){case eTe:case tTe:case oTe:case iTe:return VIe(t)||JSe(["band","point"],t);case gTe:case wTe:case yTe:case bTe:case xTe:case vTe:return VIe(t)||qIe(t)||JSe(["band","point","ordinal"],t);case hTe:case fTe:case pTe:return"band"!==t;case _Te:return"ordinal"===t||qIe(t);case mTe:return"ordinal"===t}}(t,a)?oAe(n)&&(o=a,!(JSe([TIe,CIe],s=n.type)?void 0===o||HIe(o):s===kIe?JSe([AIe,DIe,void 0],o):s!==EIe||JSe(["log","pow","sqrt","symlog","quantile","quantize","threshold",OIe,void 0],o)))?(HCe(ae.scaleTypeNotWorkWithFieldDef(a,i)),i):a:(HCe(ae.scaleTypeNotWorkWithChannel(t,a,i)),i):i:null;var o,s}(o,i,a,n);r[i]=new HPe(e.scaleName(i+"",!0),{value:t,explicit:o.type===t})}return r},{})}(t):function(t){var n;const r=t.component.scales={},i={},a=t.component.resolve;for(const o of t.children){e(o);for(const e of cEe(o.component.scales))if(a.scale[e]=null!==(n=a.scale[e])&&void 0!==n?n:IRe(e,t),"shared"===a.scale[e]){const t=i[e],n=o.component.scales[e].getWithExplicit("type");t?jIe(t.value,n.value)?i[e]=QMe(t,n,"type","scale",eFe):(a.scale[e]="independent",delete i[e]):i[e]=n}}for(const e of cEe(i)){const n=t.scaleName(e,!0);r[e]=new HPe(n,i[e]);for(const r of t.children){const t=r.component.scales[e];t&&(r.renameScale(t.get("name"),n),t.merged=!0)}}return r}(t)})(e),function e(t){rFe(t)?function(e){const t=e.component.scales;for(const n of cEe(t)){const r=NPe(e,n);if(t[n].setWithExplicit("domains",r),FPe(e,n),e.component.data.isFaceted){let t=e;for(;!iFe(t)&&t.parent;)t=t.parent;if("shared"===t.component.resolve.scale[n])for(const e of r.value)sIe(e)&&(e.data=IPe+e.data.replace(IPe,""))}}}(t):function(t){for(const r of t.children)e(r);const n=t.component.scales;for(const e of cEe(n)){let r,i=null;for(const n of t.children){const t=n.component.scales[e];if(t){r=void 0===r?t.getWithExplicit("domains"):QMe(r,t.getWithExplicit("domains"),"domains","scale",$Pe);const e=t.get("selectionExtent");i&&e&&i.selection!==e.selection&&HCe(ae.NEEDS_SAME_SELECTION),i=e}}n[e].setWithExplicit("domains",r),i&&n[e].set("selectionExtent",i,!0)}}(t)}(e);for(const n of KIe)KPe(e,n);t||JPe(e)}(this)}parseProjection(){!function e(t){t.component.projection=rFe(t)?function(e){var t;if(e.hasProjection){const n=e.specifiedProjection,r=!(n&&(null!=n.scale||null!=n.translate)),i=r?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,a=r?function(e){const t=[],{encoding:n}=e;for(const r of[[uTe,lTe],[dTe,cTe]])(AAe(n[r[0]])||AAe(n[r[1]]))&&t.push({signal:e.getName("geojson_"+t.length)});return e.channelHasField(mTe)&&e.typedFieldDef(mTe).type===IIe&&t.push({signal:e.getName("geojson_"+t.length)}),0===t.length&&t.push(e.requestDataName(lNe.Main)),t}(e):void 0;return new GRe(e.projectionName(!0),Object.assign(Object.assign({},null!==(t=e.config.projection)&&void 0!==t?t:{}),null!=n?n:{}),i,a)}}(t):function(t){if(0===t.children.length)return;let n;for(const i of t.children)e(i);const r=eEe(t.children,e=>{const t=e.component.projection;if(t){if(n){const e=function(e,t){const n=eEe(qRe,n=>!LX(e.explicit,n)&&!LX(t.explicit,n)||!(!LX(e.explicit,n)||!LX(t.explicit,n)||XSe(e.get(n))!==XSe(t.get(n))));if(XSe(e.size)===XSe(t.size)){if(n)return e;if(XSe(e.explicit)===XSe({}))return t;if(XSe(t.explicit)===XSe({}))return e}return null}(n,t);return e&&(n=e),!!e}return n=t,!0}return!0});if(n&&r){const e=t.projectionName(!0),r=new GRe(e,n.specifiedProjection,n.size,qSe(n.data));for(const n of t.children){const t=n.component.projection;t&&(t.isFit&&r.data.push(...n.component.projection.data),n.renameProjection(t.get("name"),e),t.merged=!0)}return r}}(t)}(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){!function e(t){const n=rFe(t)?function(e){const{encoding:t}=e,n={};for(const r of[hTe,...HDe]){const i=AAe(t[r]);i&&e.getScaleComponent(r)&&(r===mTe&&oAe(i)&&i.type===IIe||(n[r]=URe(e,r)))}return n}(t):function(t){const{legends:n,resolve:r}=t.component;for(const i of t.children){e(i);for(const e of cEe(i.component.legends))r.legend[e]=ORe(t.component.resolve,e),"shared"===r.legend[e]&&(n[e]=HRe(n[e],i.component.legends[e]),n[e]||(r.legend[e]="independent",delete n[e]))}for(const e of cEe(n))for(const n of t.children)n.component.legends[e]&&"shared"===r.legend[e]&&delete n.component.legends[e];return n}(t);return t.component.legends=n,n}(this)}assembleGroupStyle(){var e,t;if("unit"===this.type||"layer"===this.type)return null!==(t=null===(e=this.view)||void 0===e?void 0:e.style)&&void 0!==t?t:"cell"}assembleEncodeFromView(e){const t=tFe(e,["style"]),n={};for(const r of cEe(t)){const e=t[r];void 0!==e&&(n[r]=qAe(e))}return n}assembleGroupEncodeEntry(e){let t={};return this.view&&(t=this.assembleEncodeFromView(this.view)),e||(this.description&&(t.description=qAe(this.description)),"unit"!==this.type&&"layer"!==this.type)?uEe(t)?void 0:t:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!=t?t:{})}assembleLayout(){if(!this.layout)return;const e=this.layout,{spacing:t}=e,n=tFe(e,["spacing"]),{component:r,config:i}=this,a=function(e,t){const n={};for(const r of LTe){const i=e[r];if(null==i?void 0:i.facetFieldDef){const{titleAnchor:e,titleOrient:a}=uRe(["titleAnchor","titleOrient"],i.facetFieldDef.header,t,r),o=sRe(r,a),s=xRe(e,o);void 0!==s&&(n[o]=s)}}return uEe(n)?void 0:n}(r.layoutHeaders,i);return Object.assign(Object.assign(Object.assign({padding:t},this.assembleDefaultLayout()),n),a?{titleBand:a}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of LTe)e[n].title&&t.push(hRe(this,n));for(const n of cRe)t=t.concat(mRe(this,n));return t}assembleAxes(){return function(e,t){const{x:n=[],y:r=[]}=e;return[...n.map(e=>Xje(e,"grid",t)),...r.map(e=>Xje(e,"grid",t)),...n.map(e=>Xje(e,"main",t)),...r.map(e=>Xje(e,"main",t))].filter(e=>e)}(this.component.axes,this.config)}assembleLegends(){return WRe(this)}assembleProjections(){return oFe(e=this)||aFe(e)?function(e){return e.children.reduce((e,t)=>e.concat(t.assembleProjections()),VRe(e))}(e):VRe(e);var e}assembleTitle(){var e,t,n;const r=null!==(e=this.title)&&void 0!==e?e:{},{encoding:i}=r,a=tFe(r,["encoding"]),o=Object.assign(Object.assign(Object.assign({},BAe(this.config.title).nonMark),a),i?{encode:{update:i}}:{});if(o.text)return JSe(["unit","layer"],this.type)?JSe(["middle",void 0],o.anchor)&&(o.frame=null!==(t=o.frame)&&void 0!==t?t:"group"):o.anchor=null!==(n=o.anchor)&&void 0!==n?n:"start",uEe(o)?void 0:o}assembleGroup(e=[]){const t={};(e=e.concat(this.assembleSignals())).length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||iFe(this.parent)?function e(t){return oFe(t)||aFe(t)?t.children.reduce((t,n)=>t.concat(e(n)),UPe(t)):UPe(t)}(this):[];r.length>0&&(t.scales=r);const i=this.assembleAxes();i.length>0&&(t.axes=i);const a=this.assembleLegends();return a.length>0&&(t.legends=a),t}getName(e){return pEe((this.name?this.name+"_":"")+e)}getDataName(e){return this.getName(lNe[e].toLowerCase())}requestDataName(e){const t=this.getDataName(e),n=this.component.data.outputNodeRefCounts;return n[t]=(n[t]||0)+1,t}getSizeSignalRef(e){if(iFe(this.parent)){const t=rke(kRe(e)),n=this.component.scales[t];if(n&&!n.merged){const e=n.get("type"),r=n.get("range");if(HIe(e)&&oIe(r)){const e=n.get("name"),r=BPe(zPe(this,t));return r?{signal:TRe(e,n,bAe({aggregate:"distinct",field:r},{expr:"datum"}))}:(HCe(ae.unknownField(t)),null)}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):HTe(e)&&lke(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(ae.selectionNotFound(t));return n}hasAxisOrientSignalRef(){var e,t;return(null===(e=this.component.axes.x)||void 0===e?void 0:e.some(e=>e.hasOrientSignalRef()))||(null===(t=this.component.axes.y)||void 0===t?void 0:t.some(e=>e.hasOrientSignalRef()))}}class lFe extends sFe{vgField(e,t={}){const n=this.fieldDef(e);if(n)return bAe(n,t)}reduceFieldDef(e,t){return function(e,t,n,r){return e?cEe(e).reduce((n,i)=>{const a=e[i];return QY(a)?a.reduce((e,n)=>t.call(r,e,n,i),n):t.call(r,n,a,i)},n):n}(this.getMapping(),(t,n,r)=>{const i=OAe(n);return i?e(t,i,r):t},t)}forEachFieldDef(e,t){cDe(this.getMapping(),(t,n)=>{const r=OAe(t);r&&e(r,n)},t)}}class uFe extends tje{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=qSe(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"value",null!==(i=a[1])&&void 0!==i?i:"density"]}clone(){return new uFe(null,qSe(this.transform))}dependentFields(){var e;return new Set([this.transform.density,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"DensityTransform "+KSe(this.transform)}assemble(){const e=this.transform,{density:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["density"]);return Object.assign({type:"kde",field:t},n)}}class cFe extends tje{constructor(e,t){super(e),this.filter=t}clone(){return new cFe(null,Object.assign({},this.filter))}static make(e,t){const{config:n,mark:r,markDef:i}=t;if("filter"!==KAe("invalid",i,n))return null;const a=t.reduceFieldDef((e,n,i)=>{const a=lke(i)&&t.getScaleComponent(i);return a&&WIe(a.get("type"))&&"count"!==n.aggregate&&!gOe(r)&&(e[n.field]=n),e},{});return cEe(a).length?new cFe(e,a):null}dependentFields(){return new Set(cEe(this.filter))}producedFields(){return new Set}hash(){return"FilterInvalid "+KSe(this.filter)}assemble(){const e=cEe(this.filter).reduce((e,t)=>{const n=this.filter[t],r=bAe(n,{expr:"datum"});return null!==n&&("temporal"===n.type?e.push(`(isDate(${r}) || (isValid(${r}) && isFinite(+${r})))`):"quantitative"===n.type&&(e.push(`isValid(${r})`),e.push(`isFinite(+${r})`))),e},[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class dFe extends tje{constructor(e,t){super(e),this.transform=t,this.transform=qSe(t);const{flatten:n,as:r=[]}=this.transform;this.transform.as=n.map((e,t)=>{var n;return null!==(n=r[t])&&void 0!==n?n:e})}clone(){return new dFe(this.parent,qSe(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return"FlattenTransform "+KSe(this.transform)}assemble(){const{flatten:e,as:t}=this.transform;return{type:"flatten",fields:e,as:t}}}class hFe extends tje{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=qSe(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"key",null!==(i=a[1])&&void 0!==i?i:"value"]}clone(){return new hFe(null,qSe(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return"FoldTransform "+KSe(this.transform)}assemble(){const{fold:e,as:t}=this.transform;return{type:"fold",fields:e,as:t}}}class fFe extends tje{constructor(e,t,n,r){super(e),this.fields=t,this.geojson=n,this.signal=r}clone(){return new fFe(null,qSe(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const r of[[uTe,lTe],[dTe,cTe]]){const i=r.map(e=>{const n=AAe(t.encoding[e]);return oAe(n)?n.field:lAe(n)?{expr:""+n.datum}:fAe(n)?{expr:""+n.value}:void 0});(i[0]||i[1])&&(e=new fFe(e,i,null,t.getName("geojson_"+n++)))}if(t.channelHasField(mTe)){const r=t.typedFieldDef(mTe);r.type===IIe&&(e=new fFe(e,null,r.field,t.getName("geojson_"+n++)))}return e}dependentFields(){var e;const t=(null!==(e=this.fields)&&void 0!==e?e:[]).filter(XX);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${KSe(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class pFe extends tje{constructor(e,t,n,r){super(e),this.projection=t,this.fields=n,this.as=r}clone(){return new pFe(null,this.projection,qSe(this.fields),qSe(this.as))}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[[uTe,lTe],[dTe,cTe]]){const r=n.map(e=>{const n=AAe(t.encoding[e]);return oAe(n)?n.field:lAe(n)?{expr:""+n.datum}:fAe(n)?{expr:""+n.value}:void 0}),i=n[0]===dTe?"2":"";(r[0]||r[1])&&(e=new pFe(e,t.projectionName(),r,[t.getName("x"+i),t.getName("y"+i)]))}return e}dependentFields(){return new Set(this.fields.filter(XX))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${KSe(this.fields)} ${KSe(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class mFe extends tje{constructor(e,t){super(e),this.transform=t}clone(){return new mFe(null,qSe(this.transform))}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:r}=e;return{signal:`sequence(${[t,n,...r?[r]:[]].join(",")})`}}static makeFromTransform(e,t){return new mFe(e,t)}static makeFromEncoding(e,t){const n=t.encoding,r=n.x,i=n.y;if(oAe(r)&&oAe(i)){const a=r.impute?r:i.impute?i:void 0;if(void 0===a)return;const o=r.impute?i:i.impute?r:void 0,{method:s,value:l,frame:u,keyvals:c}=a.impute,d=dDe(t.mark,n);return new mFe(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:a.field,key:o.field},s?{method:s}:{}),void 0!==l?{value:l}:{}),u?{frame:u}:{}),void 0!==c?{keyvals:c}:{}),d.length?{groupby:d}:{}))}return null}hash(){return"Impute "+KSe(this.transform)}assemble(){const{impute:e,key:t,keyvals:n,method:r,groupby:i,value:a,frame:o=[null,null]}=this.transform,s=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:e,key:t},n?{keyvals:(l=n,void 0!==(null==l?void 0:l.stop)?this.processSequence(n):n)}:{}),{method:"value"}),i?{groupby:i}:{}),{value:r&&"value"!==r?null:a});var l;return r&&"value"!==r?[s,Object.assign({type:"window",as:[`imputed_${e}_value`],ops:[r],fields:[e],frame:o,ignorePeers:!1},i?{groupby:i}:{}),{type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e}]:[s]}}class gFe extends tje{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=qSe(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:t.on,null!==(i=a[1])&&void 0!==i?i:t.loess]}clone(){return new gFe(null,qSe(this.transform))}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"LoessTransform "+KSe(this.transform)}assemble(){const e=this.transform,{loess:t,on:n}=e,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["loess","on"]);return Object.assign({type:"loess",x:n,y:t},r)}}class vFe extends tje{constructor(e,t,n){super(e),this.transform=t,this.secondary=n}clone(){return new vFe(null,qSe(this.transform),this.secondary)}static make(e,t,n,r){const i=t.component.data.sources,{from:a}=n;let o=null;if(function(e){return"data"in e}(a)){let e=DFe(a.data,i);e||(e=new oPe(a.data),i.push(e));const n=t.getName("lookup_"+r);o=new nje(e,n,lNe.Lookup,t.component.data.outputNodeRefCounts),t.component.data.outputNodes[n]=o}else if(function(e){return"selection"in e}(a)){const e=a.selection;if(n=Object.assign({as:e},n),o=t.getSelectionComponent(pEe(e),e).materialized,!o)throw new Error(ae.noSameUnitLookup(e))}return new vFe(e,n,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?EX(this.transform.as):this.transform.from.fields)}hash(){return"Lookup "+KSe({transform:this.transform,secondary:this.secondary})}assemble(){let e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:EX(this.transform.as)}:{});else{let t=this.transform.as;XX(t)||(HCe(ae.NO_FIELDS_NEEDS_AS),t="_lookup"),e={as:[t]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}class yFe extends tje{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=qSe(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"prob",null!==(i=a[1])&&void 0!==i?i:"value"]}clone(){return new yFe(null,qSe(this.transform))}dependentFields(){var e;return new Set([this.transform.quantile,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"QuantileTransform "+KSe(this.transform)}assemble(){const e=this.transform,{quantile:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["quantile"]);return Object.assign({type:"quantile",field:t},n)}}class bFe extends tje{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=qSe(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:t.on,null!==(i=a[1])&&void 0!==i?i:t.regression]}clone(){return new bFe(null,qSe(this.transform))}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"RegressionTransform "+KSe(this.transform)}assemble(){const e=this.transform,{regression:t,on:n}=e,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["regression","on"]);return Object.assign({type:"regression",x:n,y:t},r)}}class xFe extends tje{constructor(e,t){super(e),this.transform=t}clone(){return new xFe(null,qSe(this.transform))}addDimensions(e){var t;this.transform.groupby=rEe((null!==(t=this.transform.groupby)&&void 0!==t?t:[]).concat(e),e=>e)}producedFields(){}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}hash(){return"PivotTransform "+KSe(this.transform)}assemble(){const{pivot:e,value:t,groupby:n,limit:r,op:i}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:e,value:t},void 0!==r?{limit:r}:{}),void 0!==i?{op:i}:{}),void 0!==n?{groupby:n}:{})}}class wFe extends tje{constructor(e,t){super(e),this.transform=t}clone(){return new wFe(null,qSe(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return"SampleTransform "+KSe(this.transform)}assemble(){return{type:"sample",size:this.transform.sample}}}function _Fe(e){let t=0;return function n(r,i){var a;if(r instanceof oPe&&!r.isGenerator&&!tNe(r.data)&&(e.push(i),i={name:null,source:i.name,transform:[]}),r instanceof nPe&&(r.parent instanceof oPe&&!i.source?(i.format=Object.assign(Object.assign({},null!==(a=i.format)&&void 0!==a?a:{}),{parse:r.assembleFormatParse()}),i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof QRe){i.name||(i.name="data_"+t++),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source;for(const t of r.assemble())e.push(t)}else switch((r instanceof iPe||r instanceof aPe||r instanceof cFe||r instanceof Uje||r instanceof aRe||r instanceof pFe||r instanceof fFe||r instanceof JRe||r instanceof vFe||r instanceof kPe||r instanceof EPe||r instanceof hFe||r instanceof dFe||r instanceof uFe||r instanceof gFe||r instanceof yFe||r instanceof bFe||r instanceof rPe||r instanceof wFe||r instanceof xFe)&&i.transform.push(r.assemble()),(r instanceof ZRe||r instanceof ije||r instanceof mFe||r instanceof TPe)&&i.transform.push(...r.assemble()),r instanceof nje&&(i.source&&0===i.transform.length?r.setSource(i.source):r.parent instanceof nje?r.setSource(i.name):(i.name||(i.name="data_"+t++),r.setSource(i.name),1===r.numChildren()&&(e.push(i),i={name:null,source:i.name,transform:[]}))),r.numChildren()){case 0:r instanceof nje&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name="data_"+t++);let a=i.name;!i.source||i.transform.length>0?e.push(i):a=i.source;for(const e of r.children)n(e,{name:null,source:a,transform:[]});break}}}}function SFe(e,t){var n;const{facet:r,config:i,child:a,component:o}=e;if(e.channelHasField(t)){const s=r[t],l=lRe("title",null,i,t);let u=TAe(s,i,{allowDisabling:!0,includeDefault:void 0===l||!!l});a.component.layoutHeaders[t].title&&(u=QY(u)?u.join(", "):u,u+=" / "+a.component.layoutHeaders[t].title,a.component.layoutHeaders[t].title=null);const c=lRe("labelOrient",s,i,t),d=TEe((null!==(n=s.header)&&void 0!==n?n:{}).labels,i.header.labels,!0),h=JSe(["bottom","right"],c)?"footer":"header";o.layoutHeaders[t]={title:u,facetFieldDef:s,[h]:"facet"===t?[]:[EFe(e,t,d)]}}}function EFe(e,t,n){const r="row"===t?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):void 0,axes:[]}}function TFe(e,t){var n;const{child:r}=e;if(r.component.axes[t]){const{layoutHeaders:a,resolve:o}=e.component;if(o.axis[t]=ORe(o,t),"shared"===o.axis[t]){const o="x"===t?"column":"row",s=a[o];for(const a of r.component.axes[t]){const t="top"===(i=a.get("orient"))||"left"===i||aIe(i)?"header":"footer";s[t]=null!==(n=s[t])&&void 0!==n?n:[EFe(e,o,!1)];const r=Xje(a,"main",e.config,{header:!0});r&&s[t][0].axes.push(r),a.mainExtracted=!0}}}var i}function kFe(e){for(const t of e.children)t.parseLayoutSize()}function CFe(e,t){const n=kRe(t),r=rke(n),i=e.component.resolve,a=e.component.layoutSize;let o;for(const s of e.children){const e=s.component.layoutSize.getWithExplicit(n),t=i.scale[r];if("independent"===t&&"step"===e.value){o=void 0;break}if(o){if("independent"===t&&o.value!==e.value){o=void 0;break}o=QMe(o,e,n,"")}else o=e}if(o){for(const r of e.children)e.renameSignal(r.getName(n),e.getName(t)),r.component.layoutSize.set(n,"merged",!1);a.setWithExplicit(t,o)}else a.setWithExplicit(t,{explicit:!1,value:void 0})}function IFe(e,t){const n=e.config,r=e.getScaleComponent("width"===t?"x":"y");if(r){const e=r.get("type"),i=r.get("range");if(HIe(e)){const e=aMe(n.view,t);return oIe(i)||eMe(e)?"step":e}return rMe(n.view,t)}if(e.hasProjection||"arc"===e.mark)return rMe(n.view,t);{const e=aMe(n.view,t);return eMe(e)?e.step:e}}function OFe(e,t,n){return bAe(t,Object.assign({suffix:"by_"+bAe(e)},null!=n?n:{}))}class AFe extends lFe{constructor(e,t,n,r){super(e,"facet",t,n,r,e.resolve),this.child=ZFe(e.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(e.facet)}initFacet(e){if(!XOe(e))return{facet:this.initFacetFieldDef(e,"facet")};const t=cEe(e),n={};for(const r of t){if(!JSe([ZEe,JEe],r)){HCe(ae.incompatibleChannel(r,"facet"));break}const t=e[r];if(void 0===t.field){HCe(ae.emptyFieldDef(t,r));break}n[r]=this.initFacetFieldDef(t,r)}return n}initFacetFieldDef(e,t){const{header:n}=e,r=NAe(function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["header"]),t);return n&&(r.header=eOe(n)),r}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=MFe(this),this.child.parseData()}parseLayoutSize(){kFe(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(e){for(const t of LTe)SFe(e,t);TFe(e,"x"),TFe(e,"y")}(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){var e,t,n;const r={};for(const i of LTe)for(const a of dRe){const o=this.component.layoutHeaders[i],s=o[a],{facetFieldDef:l}=o;if(l){const t=lRe("titleOrient",l.header,this.config,i);if(JSe(["right","bottom"],t)){const n=sRe(i,t);r.titleAnchor=null!==(e=r.titleAnchor)&&void 0!==e?e:{},r.titleAnchor[n]="end"}}if(null==s?void 0:s[0]){const e="row"===i?"height":"width",s="header"===a?"headerBand":"footerBand";"facet"===i||this.child.component.layoutSize.get(e)||(r[s]=null!==(t=r[s])&&void 0!==t?t:{},r[s][i]=.5),o.title&&(r.offset=null!==(n=r.offset)&&void 0!==n?n:{},r.offset["row"===i?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let r="all";return(t||"independent"!==this.component.resolve.scale.x)&&(e||"independent"!==this.component.resolve.scale.y)||(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof AFe))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(e){return this.parent&&this.parent instanceof AFe?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:bAe(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(e)):super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof AFe){if(this.child.channelHasField("column")){const r=bAe(this.child.facet.column);e.push(r),t.push("distinct"),n.push("distinct_"+r)}}else for(const r of QTe){const i=this.child.component.scales[r];if(i&&!i.merged){const a=i.get("type"),o=i.get("range");if(HIe(a)&&oIe(o)){const i=BPe(zPe(this.child,r));i?(e.push(i),t.push("distinct"),n.push("distinct_"+i)):HCe(ae.unknownField(r))}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:t}=this.component.data.facetRoot,{row:n,column:r}=this.facet,{fields:i,ops:a,as:o}=this.getCardinalityAggregateForChild(),s=[];for(const u of LTe){const e=this.facet[u];if(e){s.push(bAe(e));const{bin:t,sort:l}=e;if(fke(t)&&s.push(bAe(e,{binSuffix:"end"})),GOe(l)){const{field:t,op:s=HOe}=l,u=OFe(e,l);n&&r?(i.push(u),a.push("max"),o.push(u)):(i.push(t),a.push(s),o.push(u))}else if(QY(l)){const t=oRe(e,u);i.push(t),a.push("max"),o.push(t)}}}const l=!!n&&!!r;return Object.assign({name:e,data:t,groupby:s},l||i.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),i.length?{fields:i,ops:a,as:o}:{})}:{})}facetSortFields(e){const{facet:t}=this,n=t[e];return n?GOe(n.sort)?[OFe(n,n.sort,{expr:"datum"})]:QY(n.sort)?[oRe(n,e,{expr:"datum"})]:[bAe(n,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:t}=this,n=t[e];if(n){const{sort:e}=n;return[(GOe(e)?e.order:!QY(e)&&e)||"ascending"]}return[]}assembleLabelTitle(){var e;const{facet:t,config:n}=this;if(t.facet)return vRe(t.facet,"facet",n);const r={row:["top","bottom"],column:["left","right"]};for(const i of cRe)if(t[i]){const a=lRe("labelOrient",null===(e=t[i])||void 0===e?void 0:e.header,n,i);if(JSe(r[i],a))return vRe(t[i],i,n)}}assembleMarks(){const{child:e}=this,t=function(e){const t=[],n=_Fe(t);for(const r of e.children)n(r,{source:e.name,name:null,transform:[]});return t}(this.component.data.facetRoot),n=e.assembleGroupEncodeEntry(!1),r=this.assembleLabelTitle()||e.assembleTitle(),i=e.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},r?{title:r}:{}),i?{style:i}:{}),{from:{facet:this.assembleFacet()},sort:{field:LTe.map(e=>this.facetSortFields(e)).flat(),order:LTe.map(e=>this.facetSortOrder(e)).flat()}}),t.length>0?{data:t}:{}),n?{encode:{update:n}}:{}),e.assembleGroup(function(e,t){if(e.component.selection&&cEe(e.component.selection).length){const n=rK(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:Qbe("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return kje(t)}(this,[])))]}getMapping(){return this.facet}}function DFe(e,t){var n,r,i,a;for(const o of t){const t=o.data;if(e.name&&o.hasName()&&e.name!==o.dataName)continue;const s=null===(n=e.format)||void 0===n?void 0:n.mesh,l=null===(r=t.format)||void 0===r?void 0:r.feature;if(s&&l)continue;const u=null===(i=e.format)||void 0===i?void 0:i.feature;if((u||l)&&u!==l)continue;const c=null===(a=t.format)||void 0===a?void 0:a.mesh;if(!s&&!c||s===c)if(nNe(e)&&nNe(t)){if(VSe(e.values,t.values))return o}else if(tNe(e)&&tNe(t)){if(e.url===t.url)return o}else if(rNe(e)&&e.name===o.dataName)return o}return null}function MFe(e){var t,n,r,i,a,o,s,l,u,c;let d=function(e,t){if(e.data||!e.parent){if(null===e.data){const e=new oPe({values:[]});return t.push(e),e}const n=DFe(e.data,t);if(n)return iNe(e.data)||(n.data.format=tEe({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const n=new oPe(e.data);return t.push(n),n}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}(e,e.component.data.sources);const{outputNodes:h,outputNodeRefCounts:f}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new eNe,m=e.data;iNe(m)?(aNe(m)?d=new aPe(d,m.sequence):sNe(m)&&(d=new iPe(d,m.graticule)),p.parseNothing=!0):null===(null===(t=null==m?void 0:m.format)||void 0===t?void 0:t.parse)&&(p.parseNothing=!0),d=null!==(n=nPe.makeExplicit(d,e,p))&&void 0!==n?n:d,d=new rPe(d);const g=e.parent&&oFe(e.parent);(rFe(e)||iFe(e))&&g&&(d=null!==(r=ZRe.makeFromEncoding(d,e))&&void 0!==r?r:d),e.transforms.length>0&&(d=function(e,t,n){var r,i;let a=0;for(const o of t.transforms){let s,l=void 0;if(xNe(o))s=e=new aRe(e,o),l="derived";else if(uNe(o)){const i=tPe(o);s=e=null!==(r=nPe.makeWithAncestors(e,{},i,n))&&void 0!==r?r:e,e=new Uje(e,t,o.filter)}else if(wNe(o))s=e=ZRe.makeFromTransform(e,o,t),l="number";else if(SNe(o))l="date",void 0===n.getWithExplicit(o.field).value&&(e=new nPe(e,{[o.field]:l}),n.set(o.field,l,!1)),s=e=ije.makeFromTransform(e,o);else if(ENe(o))s=e=JRe.makeFromTransform(e,o),l="number",Bje(t)&&(e=new rPe(e));else if(cNe(o))s=e=vFe.make(e,t,o,a++),l="derived";else if(vNe(o))s=e=new kPe(e,o),l="number";else if(yNe(o))s=e=new EPe(e,o),l="number";else if(TNe(o))s=e=TPe.makeFromTransform(e,o),l="derived";else if(kNe(o))s=e=new hFe(e,o),l="derived";else if(bNe(o))s=e=new dFe(e,o),l="derived";else if(dNe(o))s=e=new xFe(e,o),l="derived";else if(gNe(o))e=new wFe(e,o);else if(_Ne(o))s=e=mFe.makeFromTransform(e,o),l="derived";else if(hNe(o))s=e=new uFe(e,o),l="derived";else if(fNe(o))s=e=new yFe(e,o),l="derived";else if(pNe(o))s=e=new bFe(e,o),l="derived";else{if(!mNe(o)){HCe(ae.invalidTransformIgnored(o));continue}s=e=new gFe(e,o),l="derived"}if(s&&void 0!==l)for(const e of null!==(i=s.producedFields())&&void 0!==i?i:[])n.set(e,l,!1)}return e}(d,e,p));const v=function(e){const t={};if(rFe(e)&&e.component.selection)for(const n of cEe(e.component.selection)){const r=e.component.selection[n];for(const e of r.project.items)!e.channel&&EEe(e.field)>1&&(t[e.field]="flatten")}return t}(e),y=function(e){const t={};function n(e){var n;PAe(e)?t[e.field]="date":"quantitative"===e.type&&XX(n=e.aggregate)&&JSe(["min","max"],n)?t[e.field]="number":EEe(e.field)>1?e.field in t||(t[e.field]="flatten"):pAe(e)&&GOe(e.sort)&&EEe(e.sort.field)>1&&(e.sort.field in t||(t[e.sort.field]="flatten"))}if((rFe(e)||iFe(e))&&e.forEachFieldDef((t,r)=>{if(hAe(t))n(t);else{const i=qTe(r),a=e.fieldDef(i);n(Object.assign(Object.assign({},t),{type:a.type}))}}),rFe(e)){const{mark:n,markDef:r,encoding:i}=e;if(gOe(n)&&!e.encoding.order){const e=i["horizontal"===r.orient?"y":"x"];oAe(e)&&"quantitative"===e.type&&!(e.field in t)&&(t[e.field]="number")}}return t}(e);d=null!==(i=nPe.makeWithAncestors(d,{},Object.assign(Object.assign({},v),y),p))&&void 0!==i?i:d,rFe(e)&&(d=fFe.parseAll(d,e),d=pFe.parseAll(d,e)),(rFe(e)||iFe(e))&&(g||(d=null!==(a=ZRe.makeFromEncoding(d,e))&&void 0!==a?a:d),d=null!==(o=ije.makeFromEncoding(d,e))&&void 0!==o?o:d,d=aRe.parseAllForSortIndex(d,e));const b=e.getDataName(lNe.Raw),x=new nje(d,b,lNe.Raw,f);if(h[b]=x,d=x,rFe(e)){const t=JRe.makeFromEncoding(d,e);t&&(d=t,Bje(e)&&(d=new rPe(d))),d=null!==(s=mFe.makeFromEncoding(d,e))&&void 0!==s?s:d,d=null!==(l=TPe.makeFromEncoding(d,e))&&void 0!==l?l:d}rFe(e)&&(d=null!==(u=cFe.make(d,e))&&void 0!==u?u:d);const w=e.getDataName(lNe.Main),_=new nje(d,w,lNe.Main,f);h[w]=_,d=_,rFe(e)&&function(e,t){Lje(e,n=>{const r=n.name,i=e.getName("lookup_"+r);e.component.data.outputNodes[i]=n.materialized=new nje(new Uje(t,e,{selection:r}),i,lNe.Lookup,e.component.data.outputNodeRefCounts)})}(e,_);let S=null;if(iFe(e)){const t=e.getName("facet");d=null!==(c=function(e,t){const{row:n,column:r}=t;if(n&&r){let t=null;for(const i of[n,r])if(GOe(i.sort)){const{field:n,op:r=HOe}=i.sort;e=t=new EPe(e,{joinaggregate:[{op:r,field:n,as:OFe(i,i.sort,{forAs:!0})}],groupby:[bAe(i)]})}return t}return null}(d,e.facet))&&void 0!==c?c:d,S=new QRe(d,e,t,_.getSource()),h[t]=S}return Object.assign(Object.assign({},e.component.data),{outputNodes:h,outputNodeRefCounts:f,raw:x,main:_,facetRoot:S,ancestorParse:p})}class NFe extends sFe{constructor(e,t,n,r){var i,a,o,s;super(e,"concat",t,n,r,e.resolve),"shared"!==(null===(a=null===(i=e.resolve)||void 0===i?void 0:i.axis)||void 0===a?void 0:a.x)&&"shared"!==(null===(s=null===(o=e.resolve)||void 0===o?void 0:o.axis)||void 0===s?void 0:s.y)||HCe(ae.CONCAT_CANNOT_SHARE_AXIS),this.children=this.getChildren(e).map((e,t)=>ZFe(e,this,this.getName("concat_"+t),void 0,r))}parseData(){this.component.data=MFe(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of cEe(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return JDe(e)?e.vconcat:QDe(e)?e.hconcat:e.concat}parseLayoutSize(){!function(e){kFe(e);const t=void 0===e.layout.columns?"height":"childHeight";CFe(e,1===e.layout.columns?"width":"childWidth"),CFe(e,t)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce((e,t)=>t.assembleSelectionTopLevelSignals(e),e)}assembleSignals(){return this.children.forEach(e=>e.assembleSignals()),[]}assembleLayoutSignals(){const e=_Re(this);for(const t of this.children)e.push(...t.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce((e,t)=>t.assembleSelectionData(e),e)}assembleMarks(){return this.children.map(e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),r=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),r?{encode:{update:r}}:{}),e.assembleGroup())})}assembleDefaultLayout(){const e=this.layout.columns;return Object.assign(Object.assign({},null!=e?{columns:e}:{}),{bounds:"full",align:"each"})}}const jFe=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},FEe),{labelExpr:1,encode:1}),RFe=cEe(jFe);class PFe extends YMe{constructor(e={},t={},n=!1){super(),this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new PFe(qSe(this.explicit),qSe(this.implicit),this.mainExtracted)}hasAxisPart(e){return!("axis"!==e&&("grid"===e||"title"===e?!this.get(e):!1===(t=this.get(e))||null===t));var t}hasOrientSignalRef(){return aIe(this.explicit.orient)}}const FFe={bottom:"top",top:"bottom",left:"right",right:"left"};function LFe(e,t){if(!e)return t.map(e=>e.clone());{if(e.length!==t.length)return;const n=e.length;for(let r=0;r<n;r++){const n=e[r],i=t[r];if(!!n!=!!i)return;if(n&&i){const t=n.getWithExplicit("orient"),a=i.getWithExplicit("orient");if(t.explicit&&a.explicit&&t.value!==a.value)return;e[r]=$Fe(n,i)}}}return e}function $Fe(e,t){for(const n of RFe){const r=QMe(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(e,t)=>{switch(n){case"title":return rDe(e,t);case"gridScale":return{explicit:e.explicit,value:TEe(e.value,t.value)}}return JMe(e,t,n,"axis")});e.setWithExplicit(n,r)}return e}function BFe(e,t,n,r,i){if("disable"===t)return void 0!==n;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(aIe(n.labelAngle)?n.labelAngle:DEe(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===iRe(r,i))return!0}return e===n[t]}const zFe=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function UFe(e,t){var n,r,i;let a=t.axis(e);const o=new PFe,s=AAe(t.encoding[e]),{mark:l,config:u}=t,c=(null==a?void 0:a.orient)||(null===(n=u["x"===e?"axisX":"axisY"])||void 0===n?void 0:n.orient)||(null===(r=u.axis)||void 0===r?void 0:r.orient)||function(e){return"x"===e?"bottom":"left"}(e),d=t.getScaleComponent(e).get("type"),h=function(e,t,n,r){const i="band"===t?["axisDiscrete","axisBand"]:"point"===t?["axisDiscrete","axisPoint"]:t in $Ie?["axisQuantitative"]:"time"===t||"utc"===t?["axisTemporal"]:[],a="x"===e?"axisX":"axisY",o=aIe(n)?"axisOrient":"axis"+vEe(n),s=[...i,...i.map(e=>a+e.substr(4))],l=["axis",o,a];return{vlOnlyAxisConfig:Zje(s,r,e,n),vgAxisConfig:Zje(l,r,e,n),axisConfigStyle:Jje([...l,...s],r)}}(e,d,c,t.config),f=void 0!==a?!a:Qje("disable",u.style,null==a?void 0:a.style,h).configValue;if(o.set("disable",f,void 0!==a),f)return o;a=a||{};const p=function(e,t,n,r,i){const a=null==t?void 0:t.labelAngle;if(void 0!==a)return aIe(a)?a:DEe(a);{const{configValue:a}=Qje("labelAngle",r,null==t?void 0:t.style,i);return void 0!==a?DEe(a):n!==eTe||!JSe([CIe,TIe],e.type)||oAe(e)&&e.timeUnit?void 0:270}}(s,a,e,u.style,h),m={fieldOrDatumDef:s,axis:a,channel:e,model:t,scaleType:d,orient:c,labelAngle:p,mark:l,config:u};for(const y of RFe){const n=y in eRe?eRe[y](m):$Ee(y)?a[y]:void 0,r=void 0!==n,i=BFe(n,y,a,t,e);if(r&&i)o.set(y,n,i);else{const{configValue:e,configFrom:t}=$Ee(y)&&"values"!==y?Qje(y,u.style,a.style,h):{},s=void 0!==e;r&&!s?o.set(y,n,i):("vgAxisConfig"!==t||zFe.has(y)&&s||jEe(e)||aIe(e))&&o.set(y,e,!1)}}const g=null!==(i=a.encoding)&&void 0!==i?i:{},v=REe.reduce((n,r)=>{var i;if(!o.hasAxisPart(r))return n;const a=CRe(null!==(i=g[r])&&void 0!==i?i:{},t),s="labels"===r?function(e,t,n){var r;const{encoding:i,config:a}=e,o=null!==(r=AAe(i[t]))&&void 0!==r?r:AAe(i[YTe(t)]),s=e.axis(t)||{},{format:l,formatType:u}=s;return MOe(u)?Object.assign({text:POe({fieldOrDatumDef:o,field:"datum.value",format:l,formatType:u,config:a})},n):n}(t,e,a):a;return void 0===s||uEe(s)||(n[r]={update:s}),n},{});return uEe(v)||o.set("encode",v,!!a.encoding||void 0!==a.labelAngle),o}function HFe(e,t){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},XNe(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),PNe("x",e,{defaultPos:"mid"})),PNe("y",e,{defaultPos:"mid"})),NNe("size",e)),NNe("angle",e)),function(e,t,n){return n?{shape:{value:n}}:NNe("shape",e)}(e,0,t))}function WFe(e){var t;const{config:n,markDef:r}=e,{orient:i}=r,a="horizontal"===i?"width":"height",o=e.getScaleComponent("horizontal"===i?"x":"y"),s=null!==(t=KAe("size",r,n,{vgChannel:a}))&&void 0!==t?t:n.tick.bandSize;if(void 0!==s)return s;{const e=o?o.get("range"):void 0;return e&&oIe(e)&&GX(e.step)?3*e.step/4:3*iMe(n.view,a)/4}}const VFe={arc:{vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},XNe(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),PNe("x",e,{defaultPos:"mid"})),PNe("y",e,{defaultPos:"mid"})),WNe(e,"radius","arc")),WNe(e,"theta","arc"))},area:{vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},XNe(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),zNe("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===e.markDef.orient})),zNe("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===e.markDef.orient})),ZNe(e))},bar:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},XNe(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),WNe(e,"x","bar")),WNe(e,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:e=>HFe(e,"circle")},geoshape:{vgMark:"shape",encodeEntry:e=>Object.assign({},XNe(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&oAe(n)&&n.type===IIe?{field:bAe(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},XNe(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),WNe(e,"x","image")),WNe(e,"y","image")),INe(e,"url"))},line:{vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},XNe(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),PNe("x",e,{defaultPos:"mid"})),PNe("y",e,{defaultPos:"mid"})),NNe("size",e,{vgChannel:"strokeWidth"})),ZNe(e))},point:{vgMark:"symbol",encodeEntry:e=>HFe(e)},rect:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},XNe(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),WNe(e,"x","rect")),WNe(e,"y","rect"))},rule:{vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},XNe(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),zNe("x",e,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n})),zNe("y",e,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n})),NNe("size",e,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:e=>HFe(e,"square")},text:{vgMark:"text",encodeEntry:e=>{const{config:t}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},XNe(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),PNe("x",e,{defaultPos:"mid"})),PNe("y",e,{defaultPos:"mid"})),INe(e)),NNe("size",e,{vgChannel:"fontSize"})),NNe("angle",e)),JNe("align",function(e,t,n){if(void 0===KAe("align",e,n))return"center"}(e.markDef,0,t))),JNe("baseline",function(e,t,n){if(void 0===KAe("baseline",e,n))return"middle"}(e.markDef,0,t))),PNe("radius",e,{defaultPos:null,isMidPoint:!0})),PNe("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,r=n.orient,i="horizontal"===r?"width":"height",a="horizontal"===r?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},XNe(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),PNe("x",e,{defaultPos:"mid",vgChannel:"xc"})),PNe("y",e,{defaultPos:"mid",vgChannel:"yc"})),NNe("size",e,{defaultValue:WFe(e),vgChannel:i})),{[a]:qAe(KAe("thickness",n,t))})}},trail:{vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},XNe(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),PNe("x",e,{defaultPos:"mid"})),PNe("y",e,{defaultPos:"mid"})),NNe("size",e)),ZNe(e))}},qFe="faceted_path_",GFe="stack_group_";function YFe(e,t={fromPrefix:""}){const{mark:n,markDef:r,encoding:i,config:a}=e,o=TEe(r.clip,function(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return!!(t&&t.get("selectionExtent")||n&&n.get("selectionExtent"))||void 0}(e),function(e){const t=e.component.projection;return!(!t||t.isFit)||void 0}(e)),s=XAe(r),l=i.key,u=function(e){const{encoding:t,stack:n,mark:r,markDef:i,config:a}=e,o=t.order;if(!(!QY(o)&&fAe(o)&&ZSe(o.value)||!o&&ZSe(KAe("order",i,a)))){if((QY(o)||oAe(o))&&!n)return eDe(o,{expr:"datum"});if(gOe(r)){const n="horizontal"===i.orient?"y":"x",r=t[n];if(oAe(r)){const t=r.sort;return QY(t)?{field:bAe(r,{prefix:n,suffix:"sort_index",expr:"datum"})}:GOe(t)?{field:bAe({aggregate:sDe(e.encoding)?t.op:void 0,field:t.field},{expr:"datum"})}:qOe(t)?{field:bAe(e.fieldDef(t.encoding),{expr:"datum"}),order:t.order}:null===t?void 0:{field:bAe(r,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}}}}(e),c=function(e){if(!e.component.selection)return null;const t=cEe(e.component.selection).length;let n=t,r=e.parent;for(;r&&0===n;)n=cEe(r.component.selection).length,r=r.parent;return n?{interactive:t>0||!!e.encoding.tooltip}:null}(e),d=KAe("aria",r,a),h=VFe[n].postEncodingTransform?VFe[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:VFe[n].vgMark},o?{clip:!0}:{}),s?{style:s}:{}),l?{key:l.field}:{}),u?{sort:u}:{}),c||{}),!1===d?{aria:d}:{}),{from:{data:t.fromPrefix+e.requestDataName(lNe.Main)},encode:{update:VFe[n].encodeEntry(e)}}),h?{transform:h}:{})]}class XFe extends lFe{constructor(e,t,n,r={},i){super(e,"unit",t,n,i,void 0,tMe(e)?e.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const a=bOe(e.mark)?Object.assign({},e.mark):{type:e.mark},o=a.type;void 0===a.filled&&(a.filled=function(e,t,{graticule:n}){if(n)return!1;const r=ZAe("filled",e,t),i=e.type;return TEe(r,i!==sOe&&i!==oOe&&i!==uOe)}(a,i,{graticule:e.data&&sNe(e.data)}));const s=this.encoding=function(e,t,n,r){return cEe(e).reduce((i,a)=>{if(!HTe(a))return HCe(ae.invalidEncodingChannel(a)),i;const o=e[a];if("angle"!==a||"arc"!==t||e.theta||(HCe(ae.REPLACE_ANGLE_WITH_THETA),a=oTe),!function(e,t,n){const r=function(e,t){return function(e){switch(e){case hTe:case fTe:case pTe:case ATe:case TTe:case kTe:case CTe:case ITe:case ETe:case yTe:case bTe:case xTe:case wTe:case QEe:case ZEe:case JEe:return uke;case eTe:case tTe:case lTe:case uTe:return cke;case nTe:case rTe:case cTe:case dTe:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case gTe:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case _Te:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case mTe:return{point:"always",geoshape:"always"};case STe:return{text:"always"};case vTe:return{point:"always",square:"always",text:"always"};case OTe:return{image:"always"};case oTe:case iTe:return{text:"always",arc:"always"};case sTe:case aTe:return{arc:"always"}}}(e)[t]}(t,n);if(!r)return!1;if("binned"===r){const n=e[t===nTe?eTe:tTe];return!!(oAe(n)&&oAe(e[t])&&pke(n.bin))}return!0}(e,a,t))return HCe(ae.incompatibleChannel(a,t)),i;if(a===gTe&&"line"===t){const t=OAe(e[a]);if(null==t?void 0:t.aggregate)return HCe(ae.LINE_WITH_VARYING_SIZE),i}if(a===hTe&&(n?"fill"in e:"stroke"in e))return HCe(ae.droppingColor("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;if(a===TTe||a===ETe&&!QY(o)&&!fAe(o)||a===CTe&&QY(o))o&&(i[a]=EX(o).reduce((e,t)=>(oAe(t)?e.push(NAe(t,a)):HCe(ae.emptyFieldDef(t,a)),e),[]));else{if(a===CTe&&null===o)i[a]=null;else if(!(oAe(o)||lAe(o)||fAe(o)||rAe(o)||aIe(o)))return HCe(ae.emptyFieldDef(o,a)),i;i[a]=DAe(o,a,r)}return i},{})}(e.encoding||{},o,a.filled,i);this.markDef=function(e,t,n){const r=eOe(e),i=KAe("orient",r,n);if(r.orient=function(e,t,n){switch(e){case sOe:case fOe:case pOe:case cOe:case lOe:case aOe:return}const{x:r,y:i,x2:a,y2:o}=t;switch(e){case iOe:if(oAe(r)&&(pke(r.bin)||oAe(i)&&i.aggregate&&!r.aggregate))return"vertical";if(oAe(i)&&(pke(i.bin)||oAe(r)&&r.aggregate&&!i.aggregate))return"horizontal";if(o||a){if(n)return n;if(!a&&(oAe(r)&&r.type===EIe&&!fke(r.bin)||cAe(r)))return"horizontal";if(!o&&(oAe(i)&&i.type===EIe&&!fke(i.bin)||cAe(i)))return"vertical"}case uOe:if(a&&(!oAe(r)||!pke(r.bin))&&o&&(!oAe(i)||!pke(i.bin)))return;case rOe:if(o)return oAe(i)&&pke(i.bin)?"horizontal":"vertical";if(a)return oAe(r)&&pke(r.bin)?"vertical":"horizontal";if(e===uOe){if(r&&!i)return"vertical";if(i&&!r)return"horizontal"}case oOe:case dOe:{const t=uAe(r),a=uAe(i);if(t&&!a)return"tick"!==e?"horizontal":"vertical";if(!t&&a)return"tick"!==e?"vertical":"horizontal";if(t&&a){const t=r,a=i,o=t.type===kIe,s=a.type===kIe;return o&&!s?"tick"!==e?"vertical":"horizontal":!o&&s?"tick"!==e?"horizontal":"vertical":!t.aggregate&&a.aggregate?"tick"!==e?"vertical":"horizontal":t.aggregate&&!a.aggregate?"tick"!==e?"horizontal":"vertical":n||"vertical"}return n||void 0}}return"vertical"}(r.type,t,i),void 0!==i&&i!==r.orient&&HCe(ae.orientOverridden(r.orient,i)),"bar"===r.type&&r.orient){const e=KAe("cornerRadiusEnd",r,n);if(void 0!==e){const n="horizontal"===r.orient&&t.x2||"vertical"===r.orient&&t.y2?["cornerRadius"]:SOe[r.orient];for(const t of n)r[t]=e;void 0!==r.cornerRadiusEnd&&delete r.cornerRadiusEnd}}return void 0===KAe("opacity",r,n)&&(r.opacity=function(e,t){if(JSe([sOe,dOe,fOe,pOe],e)&&!sDe(t))return.7}(r.type,t)),void 0===KAe("cursor",r,n)&&(r.cursor=function(e,t,n){return t.href||e.href||KAe("href",e,n)?"pointer":e.cursor}(r,t,n)),r}(a,s,i),this.size=function({encoding:e,size:t}){for(const n of QTe){const r=XTe(n);eMe(t[r])&&uAe(e[n])&&(delete t[r],HCe(ae.stepDropped(r)))}return t}({encoding:s,size:tMe(e)?Object.assign(Object.assign(Object.assign({},r),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):r}),this.stack=SMe(o,s),this.specifiedScales=this.initScales(o,s),this.specifiedAxes=this.initAxes(s),this.specifiedLegends=this.initLegends(s),this.specifiedProjection=e.projection,this.selection=e.selection}get hasProjection(){const{encoding:e}=this,t=this.mark===mOe,n=e&&jTe.some(t=>dAe(e[t]));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return ske.reduce((e,n)=>{var r;const i=AAe(t[n]);return i&&(e[n]=this.initScale(null!==(r=i.scale)&&void 0!==r?r:{})),e},{})}initScale(e){const{domain:t,range:n}=e,r=eOe(e);return QY(t)&&(r.domain=t.map(WAe)),QY(n)&&(r.range=n.map(WAe)),r}initAxes(e){return QTe.reduce((t,n)=>{const r=e[n];if(dAe(r)||n===eTe&&dAe(e.x2)||n===tTe&&dAe(e.y2)){const e=dAe(r)?r.axis:void 0;t[n]=e?this.initAxis(Object.assign({},e)):e}return t},{})}initAxis(e){const t=cEe(e),n={};for(const r of t){const t=e[r];n[r]=jEe(t)?HAe(t):WAe(t)}return n}initLegends(e){return ake.reduce((t,n)=>{const r=AAe(e[n]);if(r&&function(e){switch(e){case hTe:case fTe:case pTe:case gTe:case mTe:case yTe:case wTe:case _Te:return!0;case bTe:case xTe:case vTe:return!1}}(n)){const e=r.legend;t[n]=e?eOe(e):e}return t},{})}parseData(){this.component.data=MFe(this)}parseLayoutSize(){!function(e){const{size:t,component:n}=e;for(const r of QTe){const i=XTe(r);if(t[i]){const e=t[i];n.layoutSize.set(i,eMe(e)?"step":e,!0)}else{const t=IFe(e,i);n.layoutSize.set(i,t,!1)}}}(this)}parseSelections(){this.component.selection=function(e,t){var n;const r={},i=e.config.selection;for(const a of cEe(null!=t?t:{})){const o=qSe(t[a]),s=Hje(i[o.type],["fields","encodings"]);for(const e in s)"encodings"===e&&o.fields||"fields"===e&&o.encodings||("mark"===e&&(o[e]=Object.assign(Object.assign({},s[e]),o[e])),void 0!==o[e]&&!0!==o[e]||(o[e]=null!==(n=s[e])&&void 0!==n?n:o[e]));const l=pEe(a),u=r[l]=Object.assign(Object.assign({},o),{name:l,events:XX(o.on)?Qbe(o.on,"scope"):qSe(o.on)});Sje(u,n=>{n.has(u)&&n.parse&&n.parse(e,u,o,t[a])})}return r}(this,this.selection)}parseMarkGroup(){this.component.mark=function(e){if(JSe([oOe,rOe,hOe],e.mark)){const t=dDe(e.mark,e.encoding);if(t.length>0)return function(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:qFe+e.requestDataName(lNe.Main),data:e.requestDataName(lNe.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:YFe(e,{fromPrefix:qFe})}]}(e,t)}else if(JSe([iOe],e.mark)){const t=cIe.some(t=>KAe(t,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return function(e){const[t]=YFe(e,{fromPrefix:GFe}),n=e.scaleName(e.stack.fieldChannel),r=(t={})=>e.vgField(e.stack.fieldChannel,t),i=(e,t)=>`${e}(${[r({prefix:"min",suffix:"start",expr:t}),r({prefix:"max",suffix:"start",expr:t}),r({prefix:"min",suffix:"end",expr:t}),r({prefix:"max",suffix:"end",expr:t})].map(e=>`scale('${n}',${e})`).join(",")})`;let a,o;"x"===e.stack.fieldChannel?(a=Object.assign(Object.assign({},GSe(t.encode.update,["y","yc","y2","height",...cIe])),{x:{signal:i("min","datum")},x2:{signal:i("max","datum")},clip:{value:!0}}),o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},YSe(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(a=Object.assign(Object.assign({},GSe(t.encode.update,["x","xc","x2","width"])),{y:{signal:i("min","datum")},y2:{signal:i("max","datum")},clip:{value:!0}}),o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},YSe(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const u of cIe){const n=ZAe(u,e.markDef,e.config);t.encode.update[u]?(a[u]=t.encode.update[u],delete t.encode.update[u]):n&&(a[u]=qAe(n)),n&&(t.encode.update[u]={value:0})}const s=e.fieldDef(e.stack.groupbyChannel),l=bAe(s)?[bAe(s)]:[];return((null==s?void 0:s.bin)||(null==s?void 0:s.timeUnit))&&l.push(bAe(s,{binSuffix:"end"})),a=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((n,r)=>{if(t.encode.update[r])return Object.assign(Object.assign({},n),{[r]:t.encode.update[r]});{const t=ZAe(r,e.markDef,e.config);return void 0!==t?Object.assign(Object.assign({},n),{[r]:qAe(t)}):n}},a),a.stroke&&(a.strokeForeground={value:!0},a.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(lNe.Main),name:GFe+e.requestDataName(lNe.Main),groupby:l,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:a},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}(e)}return YFe(e)}(this)}parseAxesAndHeaders(){var e;this.component.axes=(e=this,QTe.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[UFe(n,e)]),t),{}))}assembleSelectionTopLevelSignals(e){return function(e,t){let n=!1;return Lje(e,(r,i)=>{const a=r.name,o=rK(a+jje);if(0===t.filter(e=>e.name===a).length){const e="multi"===r.type?", true)":")";t.push({name:r.name,update:`${Pje}(${o}, ${rK("global"===r.resolve?"union":r.resolve)}${e}`})}n=!0,i.topLevelSignals&&(t=i.topLevelSignals(e,r,t)),Sje(r,n=>{n.topLevelSignals&&(t=n.topLevelSignals(e,r,t))})}),n&&0===t.filter(e=>"unit"===e.name).length&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),kje(t)}(this,e)}assembleSignals(){return[...Kje(this),...(e=this,t=[],Lje(e,(n,r)=>{const i=n.name;let a=r.modifyExpr(e,n);t.push(...r.signals(e,n)),Sje(n,r=>{r.signals&&(t=r.signals(e,n,t)),r.modifyExpr&&(a=r.modifyExpr(e,n,a))}),t.push({name:i+"_modify",on:[{events:{signal:n.name+Rje},update:`modify(${rK(n.name+jje)}, ${a})`}]})}),kje(t))];var e,t}assembleSelectionData(e){return function(e,t){const n=[...t];return Lje(e,t=>{const r={name:t.name+jje};if(t.init){const n=t.project.items.map(e=>function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["signals"])),i=t.init.map(e=>Eje(e,!1));r.values="interval"===t.type?[{unit:$je(e,{escape:!1}),fields:n,values:i}]:i.map(t=>({unit:$je(e,{escape:!1}),fields:n,values:t}))}n.filter(e=>e.name===t.name+jje).length||n.push(r)}),n}(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return _Re(this)}assembleMarks(){var e;let t=null!==(e=this.component.mark)&&void 0!==e?e:[];return this.parent&&oFe(this.parent)||(t=Tje(this,t)),t.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return oDe(this.encoding,e)}fieldDef(e){return OAe(this.encoding[e])}typedFieldDef(e){const t=this.fieldDef(e);return hAe(t)?t:null}}class KFe extends sFe{constructor(e,t,n,r,i){super(e,"layer",t,n,i,e.resolve,e.view);const a=Object.assign(Object.assign(Object.assign({},r),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});this.children=e.layer.map((e,t)=>{if(yMe(e))return new KFe(e,this,this.getName("layer_"+t),a,i);if(iDe(e))return new XFe(e,this,this.getName("layer_"+t),a,i);throw new Error(ae.invalidSpec(e))})}parseData(){this.component.data=MFe(this);for(const e of this.children)e.parseData()}parseLayoutSize(){kFe(this),CFe(this,"width"),CFe(this,"height")}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of cEe(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){!function(e){var t;const{axes:n,resolve:r}=e.component,i={top:0,bottom:0,right:0,left:0};for(const a of e.children){a.parseAxesAndHeaders();for(const t of cEe(a.component.axes))r.axis[t]=ORe(e.component.resolve,t),"shared"===r.axis[t]&&(n[t]=LFe(n[t],a.component.axes[t]),n[t]||(r.axis[t]="independent",delete n[t]))}for(const a of QTe){for(const o of e.children)if(o.component.axes[a]){if("independent"===r.axis[a]){n[a]=(null!==(t=n[a])&&void 0!==t?t:[]).concat(o.component.axes[a]);for(const e of o.component.axes[a]){const{value:t,explicit:n}=e.getWithExplicit("orient");if(!aIe(t)){if(i[t]>0&&!n){const n=FFe[t];i[t]>i[n]&&e.set("orient",n,!1)}i[t]++}}}delete o.component.axes[a]}if("independent"===r.axis[a]&&n[a]&&n[a].length>1)for(const e of n[a])e.get("grid")&&!e.explicit.grid&&(e.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce((e,t)=>t.assembleSelectionTopLevelSignals(e),e)}assembleSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleSignals()),Kje(this))}assembleLayoutSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleLayoutSignals()),_Re(this))}assembleSelectionData(e){return this.children.reduce((e,t)=>t.assembleSelectionData(e),e)}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e}assembleLayout(){return null}assembleMarks(){return function(e,t){for(const n of e.children)rFe(n)&&(t=Tje(n,t));return t}(this,this.children.flatMap(e=>e.assembleMarks()))}assembleLegends(){return this.children.reduce((e,t)=>e.concat(t.assembleLegends()),WRe(this))}}function ZFe(e,t,n,r,i){if(ZOe(e))return new AFe(e,t,n,i);if(yMe(e))return new KFe(e,t,n,r,i);if(iDe(e))return new XFe(e,t,n,r,i);if(function(e){return JDe(e)||QDe(e)||ZDe(e)}(e))return new NFe(e,t,n,i);throw new Error(ae.invalidSpec(e))}function JFe(e,t={}){t.logger&&(UCe=t.logger),t.fieldTitle&&EAe(t.fieldTitle);try{const n=fMe(nX(t.config,e.config)),r=HMe(e,n),i=ZFe(r,null,"",void 0,n);return i.parse(),function(e,t){OPe(e.sources);let n=0,r=0;for(let i=0;i<5&&DPe(e,t,!0);i++)n++;e.sources.map(CPe);for(let i=0;i<5&&DPe(e,t,!1);i++)r++;OPe(e.sources),5===Math.max(n,r)&&HCe("Maximum optimization runs(5) reached.")}(i.component.data,i),{spec:function(e,t,n={},r){const i=e.config?function(e){e=qSe(e);for(const t of mMe)delete e[t];if(e.axis)for(const t in e.axis)jEe(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of FDe)delete e.legend[t];if(e.mark){for(const t of wOe)delete e.mark[t];e.mark.tooltip&&eX(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(qDe(e.params)),delete e.params);for(const t of pMe){for(const r of wOe)delete e[t][r];const n=gMe[t];if(n)for(const r of n)delete e[t][r];vMe(e,t)}for(const t of cEe(RDe))delete e[t];!function(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:r}=BAe(e.title);uEe(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),uEe(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),uEe(r)?delete e.title:e.title=r}(e);for(const t in e)eX(e[t])&&uEe(e[t])&&delete e[t];return uEe(e)?void 0:e}(e.config):void 0,a=[].concat(e.assembleSelectionData([]),function(e,t){var n,r;const i=[],a=_Fe(i);let o=0;for(const l of e.sources){l.hasName()||(l.dataName="source_"+o++);const e=l.assemble();a(l,e)}for(const l of i)0===l.transform.length&&delete l.transform;let s=0;for(const[l,u]of i.entries())0!==(null!==(n=u.transform)&&void 0!==n?n:[]).length||u.source||i.splice(s++,0,i.splice(l,1)[0]);for(const l of i)for(const t of null!==(r=l.transform)&&void 0!==r?r:[])"lookup"===t.type&&(t.from=e.outputNodes[t.from].getSource());for(const l of i)l.name in t&&(l.values=t[l.name]);return i}(e.component.data,n)),o=e.assembleProjections(),s=e.assembleTitle(),l=e.assembleGroupStyle(),u=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();c=c.filter(e=>"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1));const{params:d}=t,h=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(t,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),h),s?{title:s}:{}),l?{style:l}:{}),u?{encode:{update:u}}:{}),{data:a}),o.length>0?{projections:o}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([]),...qDe(d)])),i?{config:i}:{}),r?{usermeta:r}:{})}(i,function(e,t,n,r){const i=r.component.layoutSize.get("width"),a=r.component.layoutSize.get("height");if(void 0===t?(t={type:"pad"},r.hasAxisOrientSignalRef()&&(t.resize=!0)):XX(t)&&(t={type:t}),i&&a&&("fit"===(o=t.type)||"fit-x"===o||"fit-y"===o))if("step"===i&&"step"===a)HCe(ae.droppingFit()),t.type="pad";else if("step"===i||"step"===a){const e="step"===i?"width":"height";HCe(ae.droppingFit(rke(e))),t.type=function(e){return e?"fit-"+rke(e):"fit"}("width"===e?"height":"width")}var o;return Object.assign(Object.assign(Object.assign({},1===cEe(t).length&&t.type?"pad"===t.type?{}:{autosize:t.type}:{autosize:t}),GMe(n,!1)),GMe(e,!0))}(e,r.autosize,n,i),e.datasets,e.usermeta),normalized:r}}finally{t.logger&&(UCe=zCe),t.fieldTitle&&EAe(_Ae)}}var QFe=function(e){const[t,n]=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}};const eLe="#fff",tLe={background:"#333",title:{color:eLe},style:{"guide-label":{fill:eLe},"guide-title":{fill:eLe}},axis:{domainColor:eLe,gridColor:"#888",tickColor:eLe}},nLe="#4572a7",rLe={background:"#fff",arc:{fill:nLe},area:{fill:nLe},line:{stroke:nLe,strokeWidth:2},path:{stroke:nLe},rect:{fill:nLe},shape:{stroke:nLe},symbol:{fill:nLe,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},iLe="#30a2da",aLe="#cbcbcb",oLe="#f0f0f0",sLe="#333",lLe={arc:{fill:iLe},area:{fill:iLe},axis:{domainColor:aLe,grid:!0,gridColor:aLe,gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:aLe,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:oLe,group:{fill:oLe},legend:{labelColor:sLe,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:sLe,titleFontSize:14,titlePadding:10},line:{stroke:iLe,strokeWidth:2},path:{stroke:iLe,strokeWidth:.5},rect:{fill:iLe},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:iLe},bar:{binSpacing:2,fill:iLe,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},uLe="#000",cLe={group:{fill:"#e5e5e5"},arc:{fill:uLe},area:{fill:uLe},line:{stroke:uLe},path:{stroke:uLe},rect:{fill:uLe},shape:{stroke:uLe},symbol:{fill:uLe,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},dLe="Benton Gothic, sans-serif",hLe="#82c6df",fLe="Benton Gothic Bold, sans-serif",pLe="normal",mLe={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},gLe={background:"#ffffff",title:{anchor:"start",color:"#000000",font:fLe,fontSize:22,fontWeight:"normal"},arc:{fill:hLe},area:{fill:hLe},line:{stroke:hLe,strokeWidth:2},path:{stroke:hLe},rect:{fill:hLe},shape:{stroke:hLe},symbol:{fill:hLe,size:30},axis:{labelFont:dLe,labelFontSize:11.5,labelFontWeight:"normal",titleFont:fLe,titleFontSize:13,titleFontWeight:pLe},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:dLe,labelFontSize:11.5,symbolType:"square",titleFont:fLe,titleFontSize:13,titleFontWeight:pLe},range:{category:mLe["category-6"],diverging:mLe["fireandice-6"],heatmap:mLe["fire-7"],ordinal:mLe["fire-7"],ramp:mLe["fire-7"]}},vLe="#ab5787",yLe="#979797",bLe={background:"#f9f9f9",arc:{fill:vLe},area:{fill:vLe},line:{stroke:vLe},path:{stroke:vLe},rect:{fill:vLe},shape:{stroke:vLe},symbol:{fill:vLe,size:30},axis:{domainColor:yLe,domainWidth:.5,gridWidth:.2,labelColor:yLe,tickColor:yLe,tickWidth:.2,titleColor:yLe},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},xLe="#3e5c69",wLe={background:"#fff",arc:{fill:xLe},area:{fill:xLe},line:{stroke:xLe},path:{stroke:xLe},rect:{fill:xLe},shape:{stroke:xLe},symbol:{fill:xLe},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},_Le="#1696d2",SLe="#000000",ELe="Lato",TLe="Lato",kLe={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},CLe={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:ELe},axisX:{domain:!0,domainColor:SLe,domainWidth:1,grid:!1,labelFontSize:12,labelFont:TLe,labelAngle:0,tickColor:SLe,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:ELe},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:TLe,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:ELe,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:TLe,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:ELe,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:kLe["six-groups-cat-1"],diverging:kLe["diverging-colors"],heatmap:kLe["diverging-colors"],ordinal:kLe["six-groups-seq"],ramp:kLe["shades-blue"]},area:{fill:_Le},rect:{fill:_Le},line:{color:_Le,stroke:_Le,strokeWidth:5},trail:{color:_Le,stroke:_Le,strokeWidth:0,size:1},path:{stroke:_Le,strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:_Le,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:_Le,stroke:null}},arc:{fill:_Le},shape:{stroke:_Le},symbol:{fill:_Le,size:30}},ILe="#3366CC",OLe="#ccc",ALe="Arial, sans-serif",DLe={arc:{fill:ILe},area:{fill:ILe},path:{stroke:ILe},rect:{fill:ILe},shape:{stroke:ILe},symbol:{stroke:ILe},circle:{fill:ILe},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:ALe,fontSize:12},"guide-title":{font:ALe,fontSize:12},"group-title":{font:ALe,fontSize:12}},title:{font:ALe,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:OLe,tickColor:OLe,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},MLe="2.9.1",NLe="vg-tooltip-element",jLe={offsetX:10,offsetY:10,id:NLe,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function RLe(e,t){return JSON.stringify(e,function(e){const t=[];return function(n,r){if("object"!=typeof r||null===r)return r;const i=t.indexOf(this)+1;return t.length=i,t.length>e?"[Object]":t.indexOf(r)>=0?"[Circular]":(t.push(r),r)}}(t))}class PLe{constructor(e){this.options=Object.assign(Object.assign({},jLe),e);const t=this.options.id;if(this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const e=document.createElement("style");e.setAttribute("id",this.options.styleId),e.innerHTML=function(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return"#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n".toString().replace(NLe,e)}(t);const n=document.head;n.childNodes.length>0?n.insertBefore(e,n.childNodes[0]):n.appendChild(e)}this.el=document.getElementById(t),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",t),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el))}tooltipHandler(e,t,n,r){if(null==r||""===r)return void this.el.classList.remove("visible",this.options.theme+"-theme");this.el.innerHTML=function(e,t,n){if(QY(e))return`[${e.map(e=>t(XX(e)?e:RLe(e,n))).join(", ")}]`;if(eX(e)){let r="";const i=e,{title:a,image:o}=i,s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(i,["title","image"]);a&&(r+=`<h2>${t(a)}</h2>`),o&&(r+=`<img src="${t(o)}">`);const l=Object.keys(s);if(l.length>0){r+="<table>";for(const e of l){let i=s[e];void 0!==i&&(eX(i)&&(i=RLe(i,n)),r+=`<tr><td class="key">${t(e)}:</td><td class="value">${t(i)}</td></tr>`)}r+="</table>"}return r||"{}"}return t(e)}(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",this.options.theme+"-theme");const{x:i,y:a}=function(e,t,n,r){let i=e.clientX+n;i+t.width>window.innerWidth&&(i=+e.clientX-n-t.width);let a=e.clientY+r;return a+t.height>window.innerHeight&&(a=+e.clientY-r-t.height),{x:i,y:a}}(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${i}px`)}}function FLe(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(t){a(t)}}function s(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((r=r.apply(e,t||[])).next())}))}var LLe;function $Le(e,...t){for(const n of t)BLe(e,n);return e}function BLe(e,t){for(const n of Object.keys(t))rX(e,n,t[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});const zLe=ie;let ULe=oe;const HLe="undefined"!=typeof window?window:void 0;void 0===ULe&&(null===(LLe=null==HLe?void 0:HLe.vl)||void 0===LLe?void 0:LLe.compile)&&(ULe=HLe.vl);const WLe={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},VLe={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},qLe={vega:"Vega","vega-lite":"Vega-Lite"},GLe={vega:zLe.version,"vega-lite":ULe?ULe.version:"not available"},YLe={vega:e=>e,"vega-lite":(e,t)=>ULe.compile(e,{config:t}).spec};function XLe(e,t,n,r){const i=`<html><head>${t}</head><body><pre><code class="json">`,a=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(i+e+a),o.document.title=qLe[r]+" JSON Source"}function KLe(e,t){var n;return FLe(this,void 0,void 0,(function*(){const r=XX(e.config)?JSON.parse(yield t.load(e.config)):null!==(n=e.config)&&void 0!==n?n:{},i=XX(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),i?{patch:i}:{}),r?{config:r}:{})}))}var ZLe=function(e,t,n={}){var r,i,a;return FLe(this,void 0,void 0,(function*(){const o=(s=n.loader)&&"load"in s?n.loader:zLe.loader(n.loader);var s;const l=XX(t)?JSON.parse(yield o.load(t)):t,u=yield KLe(null!==(r=l.usermeta&&l.usermeta.embedOptions)&&void 0!==r?r:{},o),c=yield KLe(n,o),d=Object.assign(Object.assign({},$Le(c,u)),{config:nX(null!==(i=c.config)&&void 0!==i?i:{},null!==(a=u.config)&&void 0!==a?a:{})});return yield function(e,t,n={},r){var i,a,o,s,l,u;return FLe(this,void 0,void 0,(function*(){const c=n.theme?nX(se[n.theme],null!==(i=n.config)&&void 0!==i?i:{}):n.config,d=WX(n.actions)?n.actions:$Le({},WLe,null!==(a=n.actions)&&void 0!==a?a:{}),h=Object.assign(Object.assign({},VLe),n.i18n),f=null!==(o=n.renderer)&&void 0!==o?o:"canvas",p=null!==(s=n.logLevel)&&void 0!==s?s:zLe.Warn,m=null!==(l=n.downloadFileName)&&void 0!==l?l:"visualization",g="string"==typeof e?document.querySelector(e):e;if(!g)throw new Error(e+" does not exist");if(!1!==n.defaultStyle){const e="vega-embed-style",{root:t,rootContainer:r}=function(e){var t;const n=e.getRootNode?e.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:null!==(t=document.head)&&void 0!==t?t:document.body}}(g);if(!t.getElementById(e)){const t=document.createElement("style");t.id=e,t.innerText=void 0===n.defaultStyle||!0===n.defaultStyle?'.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box; }\n  .vega-embed.has-actions {\n    padding-right: 38px; }\n  .vega-embed details:not([open]) > :not(summary) {\n    display: none !important; }\n  .vega-embed summary {\n    list-style: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    padding: 6px;\n    z-index: 1000;\n    background: white;\n    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n    color: #1b1e23;\n    border: 1px solid #aaa;\n    border-radius: 999px;\n    opacity: 0.2;\n    transition: opacity 0.4s ease-in;\n    outline: none;\n    cursor: pointer;\n    line-height: 0px; }\n    .vega-embed summary::-webkit-details-marker {\n      display: none; }\n    .vega-embed summary:active {\n      box-shadow: #aaa 0px 0px 0px 1px inset; }\n    .vega-embed summary svg {\n      width: 14px;\n      height: 14px; }\n  .vega-embed details[open] summary {\n    opacity: 0.7; }\n  .vega-embed:hover summary,\n  .vega-embed:focus summary {\n    opacity: 1 !important;\n    transition: opacity 0.2s ease; }\n  .vega-embed .vega-actions {\n    position: absolute;\n    z-index: 1001;\n    top: 35px;\n    right: -9px;\n    display: flex;\n    flex-direction: column;\n    padding-bottom: 8px;\n    padding-top: 8px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n    border: 1px solid #d9d9d9;\n    background: white;\n    animation-duration: 0.15s;\n    animation-name: scale-in;\n    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n    text-align: left; }\n    .vega-embed .vega-actions a {\n      padding: 8px 16px;\n      font-family: sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      color: #434a56;\n      text-decoration: none; }\n      .vega-embed .vega-actions a:hover {\n        background-color: #f7f7f9;\n        color: black; }\n    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n      content: "";\n      display: inline-block;\n      position: absolute; }\n    .vega-embed .vega-actions::before {\n      left: auto;\n      right: 14px;\n      top: -16px;\n      border: 8px solid #0000;\n      border-bottom-color: #d9d9d9; }\n    .vega-embed .vega-actions::after {\n      left: auto;\n      right: 15px;\n      top: -14px;\n      border: 7px solid #0000;\n      border-bottom-color: #fff; }\n  .vega-embed .chart-wrapper {\n    width: 100%;\n    height: 100%; }\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px; }\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6); }\n  to {\n    opacity: 1;\n    transform: scale(1); } }\n'.toString():n.defaultStyle,r.appendChild(t)}}const v=function(e,t){var n;if(e.$schema){const r=QFe(e.$schema);t&&t!==r.library&&console.warn(`The given visualization spec is written in ${qLe[r.library]}, but mode argument sets ${null!==(n=qLe[t])&&void 0!==n?n:t}.`);const i=r.library;return Object(AY.satisfies)(GLe[i],"^"+r.version.slice(1))||console.warn(`The input spec uses ${qLe[i]} ${r.version}, but the current version of ${qLe[i]} is v${GLe[i]}.`),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":null!=t?t:"vega"}(t,n.mode);let y=YLe[v](t,c);if("vega-lite"===v&&y.$schema){const e=QFe(y.$schema);Object(AY.satisfies)(GLe.vega,"^"+e.version.slice(1))||console.warn(`The compiled spec uses Vega ${e.version}, but current version is v${GLe.vega}.`)}g.classList.add("vega-embed"),d&&g.classList.add("has-actions"),g.innerHTML="";let b=g;if(d){const e=document.createElement("div");e.classList.add("chart-wrapper"),g.appendChild(e),b=e}const x=n.patch;x&&(y=x instanceof Function?x(y):mY(y,x,!0,!1).newDocument),n.formatLocale&&zLe.formatLocale(n.formatLocale),n.timeFormatLocale&&zLe.timeFormatLocale(n.timeFormatLocale);const{ast:w}=n,_=zLe.parse(y,"vega-lite"===v?{}:c,{ast:w}),S=new zLe.View(_,Object.assign({loader:r,logLevel:p,renderer:f},w?{expr:zLe.expressionInterpreter}:{}));if(!1!==n.tooltip){let e;e="function"==typeof n.tooltip?n.tooltip:new PLe(!0===n.tooltip?{}:n.tooltip).call,S.tooltip(e)}let E,{hover:T}=n;if(void 0===T&&(T="vega"===v),T){const{hoverSet:e,updateSet:t}="boolean"==typeof T?{}:T;S.hover(e,t)}if(n&&(null!=n.width&&S.width(n.width),null!=n.height&&S.height(n.height),null!=n.padding&&S.padding(n.padding)),yield S.initialize(b,n.bind).runAsync(),!1!==d){let e=g;if(!1!==n.defaultStyle){const t=document.createElement("details");t.title=h.CLICK_TO_VIEW_ACTIONS,g.append(t),e=t;const n=document.createElement("summary");n.innerHTML='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>',t.append(n),E=e=>{t.contains(e.target)||t.removeAttribute("open")},document.addEventListener("click",E)}const r=document.createElement("div");if(e.append(r),r.classList.add("vega-actions"),!0===d||!1!==d.export)for(const t of["svg","png"])if(!0===d||!0===d.export||d.export[t]){const e=h[t.toUpperCase()+"_ACTION"],i=document.createElement("a");i.text=e,i.href="#",i.target="_blank",i.download=`${m}.${t}`,i.addEventListener("mousedown",(function(e){return FLe(this,void 0,void 0,(function*(){e.preventDefault();const r=yield S.toImageURL(t,n.scaleFactor);this.href=r}))})),r.append(i)}if(!0===d||!1!==d.source){const e=document.createElement("a");e.text=h.SOURCE_ACTION,e.href="#",e.addEventListener("click",(function(e){var r,i;XLe(OY()(t),null!==(r=n.sourceHeader)&&void 0!==r?r:"",null!==(i=n.sourceFooter)&&void 0!==i?i:"",v),e.preventDefault()})),r.append(e)}if("vega-lite"===v&&(!0===d||!1!==d.compiled)){const e=document.createElement("a");e.text=h.COMPILED_ACTION,e.href="#",e.addEventListener("click",(function(e){var t,r;XLe(OY()(y),null!==(t=n.sourceHeader)&&void 0!==t?t:"",null!==(r=n.sourceFooter)&&void 0!==r?r:"","vega"),e.preventDefault()})),r.append(e)}if(!0===d||!1!==d.editor){const e=null!==(u=n.editorUrl)&&void 0!==u?u:"https://vega.github.io/editor/",i=document.createElement("a");i.text=h.EDITOR_ACTION,i.href="#",i.addEventListener("click",(function(n){!function(e,t,n){const r=e.open(t),{origin:i}=new URL(t);let a=40;e.addEventListener("message",(function t(n){n.source===r&&(a=0,e.removeEventListener("message",t,!1))}),!1),setTimeout((function e(){a<=0||(r.postMessage(n,i),setTimeout(e,250),a-=1)}),250)}(window,e,{config:c,mode:v,renderer:f,spec:OY()(t)}),n.preventDefault()})),r.append(i)}}return{view:S,spec:t,vgSpec:y,finalize:function(){E&&document.removeEventListener("click",E),S.finalize()}}}))}(e,l,d,o)}))},JLe=function(e){return e.autumn="autumn",e.blues="blues",e.bone="bone",e.cool="cool",e.coolwarm="coolwarm",e.copper="copper",e.gray="gray",e.hot="hot",e.hotIron="hotIron",e.hotMetalBlue="hotMetalBlue",e.hsv="hsv",e.jet="jet",e.pet="pet",e.pet20Step="pet20Step",e.spectral="spectral",e.spring="spring",e.summer="summer",e.winter="winter",e}({}),QLe=n("rNSh"),e$e=n("Nm83"),t$e=n("gdl2"),n$e=n("5q2q"),r$e=n("bkNj"),i$e=n("W6+N"),a$e=n("23LK"),o$e=n("yLV6"),s$e=n.n(o$e);const l$e=e=>{const t=Math.ceil(e.reduce((e,t)=>Math.max(e,t.x),0)),n=Math.floor(e.reduce((e,t)=>Math.min(e,t.x),Number.MAX_VALUE)),r=t-n,i=Math.ceil(e.reduce((e,t)=>Math.max(e,t.y),0)),a=Math.floor(e.reduce((e,t)=>Math.min(e,t.y),Number.MAX_VALUE));return{top:a,bottom:i,left:n,right:t,width:r,height:i-a}},u$e=(e,t)=>{const n=t({x:e.left,y:e.top}),r=t({x:e.right,y:e.bottom}),i=Math.floor(n.x),a=Math.ceil(r.x),o=Math.floor(n.y),s=Math.ceil(r.y);return{left:i,right:a,top:o,bottom:s,height:s-o,width:a-i}},c$e=(e,t)=>void 0!==e&&void 0!==t&&e.length===t.length&&t.every((t,n)=>{const r=e[n];return t.x===r.x&&t.y===r.y}),d$e=n$e,h$e=t$e,f$e=e$e,p$e=i$e,m$e=r$e,g$e=a$e;var v$e=function(e){return e.Pan="Pan",e.FreehandRoi="FreehandRoi",e.Probe="Probe",e.Zoom="Zoom",e.Wwwc="Wwwc",e.StackScrollMouseWheel="StackScrollMouseWheel",e}({});const y$e={[v$e.Pan]:d$e.PanTool,[v$e.FreehandRoi]:d$e.FreehandRoiTool,[v$e.Probe]:d$e.ProbeTool,[v$e.Zoom]:d$e.ZoomTool,[v$e.Wwwc]:d$e.WwwcTool,[v$e.StackScrollMouseWheel]:d$e.StackScrollMouseWheelTool},b$e=e=>y$e[e];window.getToolFromName=b$e;let x$e=(()=>{class e{constructor(){function e(e){const t=window.URL||window.webkitURL,n=new Blob([`importScripts('${e}')`],{type:"application/javascript"});return t.createObjectURL(n)}this.cornerstoneTools=n$e,this.cornerstone=t$e,this.cornerstoneMath=m$e,this.pointInFreehand=d$e.import("util/freehandUtils").pointInFreehand,this.pointInFreehand2=(e,t,n)=>{let r=!1;const i=null!=n?n:l$e(e);if(t.x<i.left||t.x>i.right||t.y<i.top||t.y>i.bottom)return!1;for(let a=0,o=e.length-1;a<e.length;o=a++)e[a].y>t.y!=e[o].y>t.y&&t.x<(e[o].x-e[a].x)*(t.y-e[a].y)/(e[o].y-e[a].y)+e[a].x&&(r=!r);return r},this.pointInFreehandCached=(e,t)=>{let n=!1;const r=[];for(let i=0,a=e.length-1;i<e.length;a=i++)r.push((e[a].x-e[i].x)/(e[a].y-e[i].y)),e[i].y>t.y!=e[a].y>t.y&&t.x<(e[a].x-e[i].x)*(t.y-e[i].y)/(e[a].y-e[i].y)+e[i].x&&(n=!n);for(let i=0,a=e.length-1;i<e.length;a=i++)e[i].y>t.y!=e[a].y>t.y&&t.x<r[i]*(t.y-e[i].y)+e[i].x&&(n=!n);return n},this.lineInFreehand=(e,t,n)=>{const r=Array(t.length),i=Array(t.length),a=Array(n.length).map(e=>!1);for(let o=0,s=t.length-1;o<t.length;s=o++)r[o]=(t[s].x-t[o].x)*(e-t[o].y)/(t[s].y-t[o].y)+t[o].x,i[o]=t[o].y>e!=t[s].y>e;for(let o=0;o<t.length;o++){const e=i[o],t=r[o];n.forEach((n,r)=>{e&&n<t&&(a[r]=!a[r])})}return a},this.calculateScaleRatio=(e,t)=>{let n,r;return n=e instanceof HTMLElement?h$e.getViewport(e):e,r=t instanceof HTMLElement?h$e.getViewport(t):t,r.displayedArea.columnPixelSpacing/n.displayedArea.columnPixelSpacing},this.buildTranslatePoints=(e,t,n)=>{const r=h$e.getViewport(e),i=h$e.getViewport(t),a=this.calculateScaleRatio(r,i),o=n(e,t);return e=>({x:(e.x-o.dx-i.displayedArea.brhc.x/2)*a+r.displayedArea.brhc.x/2,y:(e.y-o.dy-i.displayedArea.brhc.y/2)*a+r.displayedArea.brhc.y/2})},this.panZoomSynchronizer=(e,t)=>(n,r,i)=>{if(i===r)return;const a=h$e.getViewport(r),o=h$e.getViewport(i),s=this.calculateScaleRatio(a,o),l=e.getElement().id===r.id,u=(a.translation.x-(l?e.dx:t.dx))/s+(l?t.dx:e.dx),c=(a.translation.y-(l?e.dy:t.dy))/s+(l?t.dy:e.dy);o.scale===a.scale*s&&o.translation.x===u&&o.translation.y===c||(o.scale=a.scale*s,o.translation.x=u,o.translation.y=c,n.setViewport(i,o))},this.freehandRoiSynchronizer=e=>(t,n,r,i)=>{n.focus(),this.syncronize(e,n,r)},this.syncronize=(e,t,n)=>{var r,i;if(t===n)return;const a=d$e.getToolForElement(n,v$e.FreehandRoi);if("disabled"===a.mode||"enabled"===a.mode)return;const o=null===(r=d$e.getToolState(n,v$e.FreehandRoi))||void 0===r?void 0:r.data,s=null===(i=d$e.getToolState(t,v$e.FreehandRoi))||void 0===i?void 0:i.data;if(!e.shouldSynchronize()){if(s)for(const n of s)(n.area>.1||n.canComplete)&&e.onUpdateCompleted(n,t);return}const l=this.buildTranslatePoints(n,t,e.getTranslation),u=e=>Object.assign(Object.assign({},e),l(e)),c=(t,n)=>{console.log("addData");const r=h$e.getImage(t),i=e.getImageVisibility(t);for(const e of n){console.log(e,i);const n=Object.assign(Object.assign({},e),{visible:e.area<.1||i});n.handles=Object.assign({},n.handles),n.handles.points=n.handles.points.map(u),d$e.addToolState(t,v$e.FreehandRoi,n),(n.canComplete||e.area>.1)&&a.updateCachedStats(r,t,n)}h$e.updateImage(t)};if(o||s){if(o)if(s){console.log("different");const r=e.getImageVisibility(n);for(const i of s)if(e.didChangeRoi(i,t)){const a=o.find(e=>e.uuid===i.uuid);void 0!==a&&d$e.removeToolState(n,v$e.FreehandRoi,a);const s=Object.assign(Object.assign({},i),{visible:i.area<.1||r});s.handles=Object.assign({},s.handles),s.handles.points=s.handles.points.map(u),d$e.addToolState(n,v$e.FreehandRoi,s),s.canComplete||i.area>.1?(e.onUpdateCompleted(s,n),e.onUpdateCompleted(i,t)):i.visible=!0;break}h$e.updateImage(n)}else console.log("source more"),c(t,o);else console.log("target more"),c(n,s);d$e.getToolForElement(n,v$e.FreehandRoi)._configuration.mouseLocation.handles.start=Object.assign({},d$e.getToolForElement(t,v$e.FreehandRoi)),h$e.updateImage(t),h$e.updateImage(n)}},this.createRoiData=(e,t,n)=>({active:!1,area:10,canComplete:!1,handles:{invalidHandlePlacement:!1,points:t.map(e=>Object.assign({active:!1,highlight:!1,lines:[]},e)),textBox:{active:!1,allowedOutsideImage:!1,drawnIndependently:!0,hasMoved:!1,movesIndependently:!1}},highlight:!1,invalidated:!1,meanStdDev:{count:100,mean:300,stdDev:10,variance:20},unit:"",uuid:e,visible:n,polyBoundingBox:l$e(t)}),this.imageRegistration=(e,t,n)=>Zf(this,void 0,void 0,(function*(){const r=e=>new Promise(t=>{e.toBlob(t)}),i=h$e.getImage(e),a=h$e.getImage(t),o=(yield Promise.all([r(e.querySelector("canvas")),r(t.querySelector("canvas"))]),new FormData);o.append("cut1",new Blob([i.getPixelData().buffer],{type:"application/octet-stream"})),o.append("cut2",new Blob([a.getPixelData().buffer],{type:"application/octet-stream"}));const s=`?lw=${i.width}&lh=${i.height}&rw=${a.width}&rh=${a.height}&method=${n.method}`,l=yield fetch("http://127.0.0.1:5000/files/registration"+s,{method:"POST",body:o});let u;if(l.ok){if(console.log(l),console.log(l.headers.get("Content-Type")),"application/json"===l.headers.get("Content-Type"))u=yield l.json();else{const e=yield l.blob(),t=window.URL.createObjectURL(e);u=yield g$e.loadImage(t).promise}console.log(u)}return{response:l,data:u}})),this.rotateViewport=()=>{},this.stackImageIndexSynchronizer=(e,t,n,r)=>{if(n===t)return;const i=d$e.getToolState(t,"stack").data[0],a=d$e.getToolState(n,"stack").data[0];let o=i.currentImageIdIndex-r;if(console.log(r,o),o=Math.min(Math.max(o,0),a.imageIds.length-1),o===a.currentImageIdIndex)return;const s=d$e.loadHandlerManager,l=s.getStartLoadHandler(n),u=s.getEndLoadHandler(n),c=s.getErrorLoadingHandler(n);let d;l&&l(n),d=!0===a.preventCache?h$e.loadImage(a.imageIds[o]):h$e.loadAndCacheImage(a.imageIds[o]),d.then(t=>{const r=h$e.getViewport(n);a.currentImageIdIndex=o,e.displayImage(n,t,r),u&&u(n,t)},e=>{c&&c(n,a.imageIds[o],e)})},p$e.external.cornerstone=h$e,d$e.external.cornerstone=h$e,d$e.external.cornerstoneMath=m$e,d$e.external.Hammer=s$e.a,d$e.init(),f$e.external.cornerstone=h$e,f$e.external.dicomParser=QLe,g$e.external.cornerstone=h$e,console.log(d$e),console.log(h$e),console.log(m$e),window.cornerstone=h$e,window.cornerstoneTools=d$e,window.cornerstoneMath=m$e,window.cornerstoneNIFTIImageLoader=p$e,window.cornerstoneWADOImageLoader=f$e,window.cornerstoneWebImageLoader=g$e,window.imageRegistration=this.imageRegistration,e("https://unpkg.com/cornerstone-wado-image-loader@2.2.4/dist/cornerstoneWADOImageLoaderWebWorker.min.js"),e("https://unpkg.com/cornerstone-wado-image-loader@2.2.4/dist/cornerstoneWADOImageLoaderCodecs.js");const t={webWorkerPath:document.location.href+"assets/cornerstoneWADOImageLoaderWebWorker.min.js",taskConfiguration:{decodeTask:{codecsPath:document.location.href+"assets/cornerstoneWADOImageLoaderCodecs.js"}}};f$e.webWorkerManager.initialize(t),g$e.configure({beforeSend:()=>{}}),h$e.registerUnknownImageLoader(g$e.loadImage)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ht({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),w$e=(()=>{class e{constructor(e){this.cornerstone=e,this.getDicomSummary=e=>{if(void 0===e)return;const t={};return Object.entries(_$e).forEach(([n,r])=>{let i="";if(void 0!==e.elements[r]){const t=e.string(r);void 0!==t&&(i=t)}t[n]=i}),t["Image Orientation Patient"]=t["Image Orientation Patient"].replace(/\\/g,"\\ "),Object.entries(S$e).forEach(([n,r])=>{const i=e.elements[r];let a="";void 0!==i&&(2===i.length?a+=e.uint16(r):4===i.length&&(a+=e.uint32(r))),t[n]=a}),{info:t,instanceId:Number.parseInt(t["Instance #"])}},this.getNiftiSummary=e=>{const t={},n=t=>this.cornerstone.cornerstone.metaData.get(t,e);return Object.entries({imagePixelModule:["columns","rows","samplesPerPixel","photometricInterpretation","planarConfiguration","pixelAspectRatio","bitsAllocated","bitsStored","highBit","pixelRepresentation","smallestPixelValue","largestPixelValue"]}).forEach(([e,r])=>{r.forEach(r=>{t[r]=""+n(e)[r]})}),[["numberOfFrames","multiFrameModule"],["pixelSpacing","imagePlaneModule"],["windowCenter","voiLutModule"],["windowWidth","voiLutModule"],["rescaleIntercept","modalityLutModule"],["rescaleSlope","modalityLutModule"]].forEach(([e,r])=>{t[e]=""+n(r)[e]}),Object.entries(n("imagePlaneModule")).forEach(([e,n])=>{"frameOfReferenceUID"!==e&&(t[e]=""+n)}),t}}}return e.\u0275fac=function(t){return new(t||e)(Kt(x$e))},e.\u0275prov=ht({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const _$e={"Study UID":"x0020000d","Series UID":"x0020000e","Instance UID":"x00080018","SOP Class UID":"x00080016","Transfer Syntax UID":"x00020010","Frame of Reference UID":"x00200052",Manufacturer:"x00080070",Model:"x00081090","Station Name":"x00081010","AE Title":"x00020016","Institution Name":"x00080080","Software Version":"x00181020","Implementation Version Name":"x00020013","Photometric Interpretation":"x00280004","Image Type":"x00080008","Window Center":"x00281050","Window Width":"x00281051","Rescale Slope":"x00281053","Rescale Intercept":"x00281052","Image Position Patient":"x00200032","Image Orientation Patient":"x00200037","Pixel Spacing":"x00280030","Instance #":"x00200013","Acquisition #":"x00200012","Acquisition Date":"x00080022","Acquisition Time":"x00080032","Content Date":"x00080023","Content Time":"x00080033","Patient Name":"x00100010","Patient ID":"x00100020","Patient Birth Date":"x00100030","Patient Sex":"x00100040","Study Description":"x00081030","Protocol Name":"x00181030","Accession #":"x00080050","Study Id":"x00200010","Study Date":"x00080020","Study Time":"x00080030","Series Description":"x0008103e","Series #":"x00200011",Modality:"x00080060","Body Part":"x00180015","Series Date":"x00080021","Series Time":"x00080031"},S$e={Rows:"x00280010",Columns:"x00280011","Bits Allocated":"x00280100","Bits Stored":"x00280101",HighBit:"x00280102","Pixel Representation (0=us)":"x00280103","Samples Per Pixel":"x00280002"};let E$e=(()=>{class e{constructor(){this.onFileDropped=new Zs,this.background="#f5fcff",this.opacity="1"}onDragOver(e){e.preventDefault(),e.stopPropagation(),this.background="#9ecbec",this.opacity="0.8"}onDragLeave(e){e.preventDefault(),e.stopPropagation(),this.background="#f5fcff",this.opacity="1"}onDrop(e){e.preventDefault(),e.stopPropagation(),this.background="#f5fcff",this.opacity="1";const t=e.dataTransfer.files;t.length>0&&this.onFileDropped.emit(t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=xn({type:e,selectors:[["","appDropFile",""]],hostVars:4,hostBindings:function(e,t){1&e&&Ro("dragover",(function(e){return t.onDragOver(e)}))("dragleave",(function(e){return t.onDragLeave(e)}))("drop",(function(e){return t.onDrop(e)})),2&e&&Wo("background-color",t.background)("opacity",t.opacity)},outputs:{onFileDropped:"onFileDropped"}}),e})();const T$e=["dicomImageLeft"],k$e=["dicomImageRight"],C$e=["canvasComp"];function I$e(e,t){if(1&e&&(Ao(0,"option",80),Xo(1),Do()),2&e){const e=t.$implicit,n=Lo();$o("value",e.id),Io("selected",e.id===n.selectedColormap),Ni(1),Zo("",e.name," ")}}function O$e(e,t){if(1&e&&(Ao(0,"option",80),Xo(1),Do()),2&e){const e=t.$implicit,n=Lo();$o("value",e),Io("selected",n.registerMethod===""+e),Ni(1),Zo("",e," ")}}function A$e(e,t){if(1&e&&(Ao(0,"option",80),Xo(1),Do()),2&e){const e=t.$implicit,n=Lo(2);$o("value",e.key),Io("selected",n.imageDataLeft.imageId===e.key),Ni(1),Ko(e.key)}}function D$e(e,t){if(1&e){const e=No();Ao(0,"fieldset",81),Ao(1,"label",82),Xo(2,"Image import"),Do(),Ao(3,"select",83,84),Ro("input",(function(){rr(e);const t=ko(4),n=Lo();return n.changeImage(t,n.imageDataLeft)})),To(5,A$e,2,3,"option",16),Xs(6,"keyvalue"),Ao(7,"option",85),Xo(8,"Import Image"),Do(),Do(),Do()}if(2&e){const e=Lo();Ni(5),Io("ngForOf",Ks(6,2,e.importedImageIds)),Ni(2),Io("selected",!1)}}function M$e(e,t){if(1&e&&(Ao(0,"div",86),Xo(1),Do()),2&e){const e=Lo();Ni(1),Jo(" ",e.imageDataLeft.stackPosition+1,"/",e.imageDataLeft.stackSize," ")}}function N$e(e,t){if(1&e&&(Ao(0,"option",80),Xo(1),Do()),2&e){const e=t.$implicit,n=Lo(2);$o("value",e.key),Io("selected",n.imageDataRight.imageId===e.key),Ni(1),Ko(e.key)}}function j$e(e,t){if(1&e){const e=No();Ao(0,"fieldset",81),Ao(1,"label",87),Xo(2,"Image import"),Do(),Ao(3,"select",88,89),Ro("input",(function(){rr(e);const t=ko(4),n=Lo();return n.changeImage(t,n.imageDataRight)})),To(5,N$e,2,3,"option",16),Xs(6,"keyvalue"),Ao(7,"option",85),Xo(8,"Import Image"),Do(),Do(),Do()}if(2&e){const e=Lo();Ni(5),Io("ngForOf",Ks(6,2,e.importedImageIds)),Ni(2),Io("selected",!e.imageDataRight.loaded)}}function R$e(e,t){if(1&e&&(Ao(0,"div",86),Xo(1),Do()),2&e){const e=Lo();Ni(1),Jo(" ",e.imageDataRight.stackPosition+1,"/",e.imageDataRight.stackSize," ")}}function P$e(e,t){1&e&&(Ao(0,"div",90),Ao(1,"div",91),Mo(2,"div",92),Ao(3,"h3",93),Xo(4,"Loading files..."),Do(),Do(),Do())}function F$e(e,t){1&e&&(Ao(0,"div",90),Ao(1,"div",91),Mo(2,"div",92),Ao(3,"h3",93),Xo(4,"Loading files..."),Do(),Do(),Do())}function L$e(e,t){if(1&e){const e=No();Ao(0,"button",94),Ro("click",(function(){rr(e);const t=Lo();return t.currentInfoView=t.InfoView.Comparison})),Xo(1,"Comparison"),Do()}}function $$e(e,t){if(1&e){const e=No();Ao(0,"button",94),Ro("click",(function(){rr(e);const t=Lo();return t.currentInfoView=t.InfoView.Metadata})),Xo(1,"Metadata"),Do()}}function B$e(e,t){if(1&e&&(Ao(0,"tr"),Ao(1,"td"),Xo(2),Do(),Ao(3,"td"),Xo(4),Do(),Do()),2&e){const e=t.$implicit;Ni(2),Ko(e.key),Ni(2),Ko(e.value)}}function z$e(e,t){1&e&&(Ao(0,"div",99),Xo(1," No matches for filter "),Do())}function U$e(e,t){if(1&e&&(Ao(0,"table",95),Ao(1,"thead"),Ao(2,"tr"),Ao(3,"td",96),Xo(4,"Key"),Do(),Ao(5,"td"),Xo(6,"Value"),Do(),Do(),Do(),Ao(7,"tbody"),To(8,B$e,5,2,"tr",97),Xs(9,"keyvalue"),Do(),To(10,z$e,2,0,"div",98),Do()),2&e){const e=Lo();Ni(8),Io("ngForOf",Ks(9,2,e.selectedMetadata.filteredInfo)),Ni(2),Io("ngIf",e.noMatchesForFilter)}}function H$e(e,t){1&e&&(Ao(0,"div",74),Ao(1,"div",100),Xo(2," No metadata available. "),Do(),Do())}function W$e(e,t){1&e&&(Ao(0,"div",100),Xo(1," No comparison available. Select a region of interest for the comparison. "),Do())}function V$e(e,t){if(1&e&&(Ao(0,"div",101),Ao(1,"table"),Ao(2,"h4"),Xo(3,"Left (union)"),Do(),Ao(4,"tr"),Ao(5,"td"),Xo(6,"Mean"),Do(),Ao(7,"td"),Xo(8),Do(),Do(),Ao(9,"tr"),Ao(10,"td"),Xo(11,"Std."),Do(),Ao(12,"td"),Xo(13),Do(),Do(),Ao(14,"tr"),Ao(15,"td"),Xo(16,"Area"),Do(),Ao(17,"td"),Xo(18),Do(),Do(),Ao(19,"h4"),Xo(20,"Right (union)"),Do(),Ao(21,"tr"),Ao(22,"td"),Xo(23,"Mean"),Do(),Ao(24,"td"),Xo(25),Do(),Do(),Ao(26,"tr"),Ao(27,"td"),Xo(28,"Std."),Do(),Ao(29,"td"),Xo(30),Do(),Do(),Ao(31,"tr"),Ao(32,"td"),Xo(33,"Area"),Do(),Ao(34,"td"),Xo(35),Do(),Do(),Ao(36,"h4"),Xo(37,"Difference"),Do(),Ao(38,"tr"),Ao(39,"td"),Xo(40,"Mean"),Do(),Ao(41,"td"),Xo(42),Do(),Do(),Ao(43,"tr"),Ao(44,"td"),Xo(45,"Std."),Do(),Ao(46,"td"),Xo(47),Do(),Do(),Do(),Do()),2&e){const e=Lo();Ni(8),Jo("",e.volumeStats.meanLeftOwn," (",e.volumeStats.meanLeft,")"),Ni(5),Jo("",e.volumeStats.stdLeftOwn," (",e.volumeStats.stdLeft,")"),Ni(5),Zo("",e.volumeStats.areaLeft," mm\xb2"),Ni(7),Jo("",e.volumeStats.meanRightOwn," (",e.volumeStats.meanRight,")"),Ni(5),Jo("",e.volumeStats.stdRightOwn," (",e.volumeStats.stdRight,")"),Ni(5),Zo("",e.volumeStats.areaRight," mm\xb2"),Ni(7),Ko(e.volumeStats.mean),Ni(5),Ko(e.volumeStats.std)}}const q$e=function(e){return{pressed:e}},G$e=function(){return[1,2,3,4,5,6,7,8]},Y$e=function(e){return{hidden:e}};!function(e,t=!1){if(KG)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPaths()` before you call `tf.setBackend()` or `tf.ready()`");if("string"==typeof e)YG=e;else{XG=e;const t=qG.filter(e=>null==XG[e]);if(t.length>0)throw new Error("There were no entries found for the following binaries: "+t.join(",")+". Please either call setWasmPaths with a map providing a path for each binary, or with a string indicating the directory where all the binaries can be found.")}ZG=t}(document.location.href+"assets/"),nw("wasm").then(e=>{console.log("loadedTFWasm: ",e)});const X$e=(e,t,n)=>Jx(()=>{const r=sx(Array.from(e),[t.h,t.w,1],"float32");return Fk.resizeBilinear(r,[n.h,n.w])}),K$e={uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array};window.resizeImage=X$e,window.resizeCornerstoneImage=(e,t)=>{const n=e.getPixelData();let r;n instanceof Uint8Array?r="uint8":n instanceof Uint16Array?r="uint16":n instanceof Uint32Array&&(r="uint32");const i=X$e(n,{h:e.height,w:e.width},t),a=K$e[r].from(i.dataSync());return Object.assign(Object.assign({},e),{getPixelData:()=>a,columnPixelSpacing:e.columnPixelSpacing*e.width/t.w,rowPixelSpacing:e.rowPixelSpacing*e.height/t.h,sizeInBytes:e.sizeInBytes*(t.w/e.width)*(t.h/e.height),height:t.h,rows:t.h,width:t.w,columns:t.w})},window.tf=H;class Z$e{constructor(e,{isLeft:t}){this.loading=!1,this.loaded=!1,this.visible=!0,this.opacity=.7,this.angle=0,this.dx=0,this.dy=0,this.parsingResult=void 0,this.roiPointsByStack=[],this.currentStackIndex=()=>d$e.getToolState(this.getElement(),"stack").data[0].currentImageIdIndex,this.translateOrRotate=e=>{var t,n,r,i,a;const o=this.getElement(),s=h$e.getViewport(o);this.angle=null!==(t=e.angle)&&void 0!==t?t:s.rotation,this.dx=this.dx+(null!==(n=e.x)&&void 0!==n?n:0),this.dy=this.dy+(null!==(r=e.y)&&void 0!==r?r:0),s.rotation=this.angle,s.translation.x+=null!==(i=e.x)&&void 0!==i?i:0,s.translation.y+=null!==(a=e.y)&&void 0!==a?a:0,h$e.setViewport(o,s),h$e.updateImage(o)},this.currentStackPoints=e=>{if(void 0===e)try{e=this.currentStackIndex()}catch(t){return}return this.roiPointsByStack[e]},this.setPoints=(e,t)=>{let n=this.roiPointsByStack[e];n||(n={},this.roiPointsByStack[e]=n),n[t.uuid]={uuid:t.uuid,points:t.handles.points.map(e=>Object.assign({},e)),stats:Object.assign(Object.assign({},t.meanStdDev),{area:t.area})}},this.getRoiPixels=()=>{const e=this.currentStackPoints();return e?Object.entries(e).map(([e,{points:t}])=>{const n=l$e(t);return{pixels:h$e.getPixels(this.getElement(),n.left,n.top,n.width,n.height),bbox:n,points:t,uuid:e}}):[]},this.getData=(e,t)=>{let n;switch(e){case eBe.lastRoi:n=e=>e.uuid===t;break;case eBe.stackPosition:const e=this.currentStackPoints();n=t=>void 0!==e&&void 0!==e[t.uuid];break;case eBe.volume:n=e=>!0}return this.roiPointsByStack.flatMap(e=>Object.values(e)).filter(e=>void 0!==e.diffData&&n(e))},this.removeData=(e,t)=>{if(!this.loaded)return!1;let n=!1;switch(e){case eBe.lastRoi:if(void 0!==t)for(const r of this.roiPointsByStack)void 0!==r&&void 0!==r[t]&&(delete r[t],n=!0);break;case eBe.stackPosition:const e=this.currentStackIndex();n=void 0!==this.roiPointsByStack[e]&&Object.keys(this.roiPointsByStack[e]).length>0,this.roiPointsByStack[e]={};break;case eBe.volume:n=this.roiPointsByStack.length>0,this.roiPointsByStack=[]}return n&&(d$e.clearToolState(this.getElement(),v$e.FreehandRoi),h$e.updateImage(this.getElement(),!0)),n},this.getElement=e,this.isLeft=t}}var J$e=function(e){return e.Comparison="Comparison",e.Metadata="Metadata",e}({}),Q$e=function(e){return e[e.dist=0]="dist",e[e.diff=1]="diff",e}({}),eBe=function(e){return e.volume="volume",e.lastRoi="lastRoi",e.stackPosition="stackPosition",e}({});let tBe=(()=>{class e{constructor(e,t){this.cornerstoneService=e,this.metadataService=t,this.ToolName=v$e,this.InfoView=J$e,this.HistogramType=Q$e,this.HistogramRegion=eBe,this.colormaps=h$e.colors.getColormapsList(),this.defaultTool=v$e.Pan,this.enabledTool=v$e.Pan,this.selectedColormap=JLe.hotIron,this.deltaStackIndex=0,this.registerMethod="4",this.importedImageIds=new Map,this.imageDataLeft=new Z$e(()=>this._dicomImageLeftElem.nativeElement,{isLeft:!0}),this.imageDataRight=new Z$e(()=>this._dicomImageRightElem.nativeElement,{isLeft:!1}),this.synchronizeRoi=!0,this.synchronizeStack=!0,this.isLoadingRegistration=!1,this.currentInfoView=J$e.Metadata,this.selectedHistogram=Q$e.dist,this.selectedHistogramRegion=eBe.lastRoi,this.isLeftSelected=!0,this.metadataFilter="",this.noMatchesForFilter=!1,this.changeImage=(e,t)=>{if("IMPORT"===e.value)e.value=t.imageId,document.getElementById("fileInput"+(t===this.imageDataLeft?"Left":"Right")).click();else if(e.value!==t.imageId){const n=this.importedImageIds.get(e.value);this.loadAndViewImages(e.value,n,t,!1)}},this.changeColormap=e=>{if(this.selectedColormap=e,this.allLoaded)for(const{getElement:t,overlayLayerId:n}of[this.imageDataLeft,this.imageDataRight]){const e=h$e.getLayer(t(),n),r=h$e.colors.getColormap(this.selectedColormap);r.setColor(0,[0,0,0,0]),e.viewport.colormap=r,h$e.updateImage(t(),!0)}},this.updateLayerOpacity=(e,t)=>{t.opacity=e,this.allLoaded&&(h$e.getLayer(t.getElement(),t.overlayLayerId).options.opacity=t.opacity,h$e.updateImage(t.getElement()))},this.updateLayerVisibility=e=>{e.visible=!e.visible,this.synchronizeRoiPoints(e),h$e.updateImage(e.getElement())},this.updateRoiSynchronization=()=>{this.synchronizeRoi=!this.synchronizeRoi},this.updateStackSynchronization=()=>{this.synchronizeStack=!this.synchronizeStack},this._drawRoiInCanvas=(e,t)=>{const n=this.canvasElem;if(void 0===n)return;const r=n.getContext("2d"),i=e.reduce((e,t)=>Math.max(e,t),0),a=e.reduce((e,t)=>Math.min(e,t),Number.MAX_VALUE);console.log(a),console.log(i),r.clearRect(0,0,n.width,n.height),r.beginPath(),r.fillStyle="#CCCCCC";for(let o=0;o<t.height;o++)for(let n=0;n<t.width;n++){const s=o*t.width+n,l=Math.floor(254*(i-(e[s]-a))/(i-a));isNaN(l)&&(console.log(254*(i-(e[s]-a))/(i-a)),console.log(e[s])),r.fillStyle="#000000"+l.toString(16),r.fillRect(1*n*2,1*o,2,1)}r.stroke()},this._didChangeRoi=(e,t)=>{let n;n=t.id===this.imageDataLeft.getElement().id?this.imageDataLeft:this.imageDataRight,e.visible=n.visible;const r=n.currentStackIndex(),i=n.currentStackPoints(r);return!(i&&i[e.uuid]&&c$e(i[e.uuid].points,e.handles.points))},this._onRoiEdited=(e,t)=>{let n;if(n=t.id===this.imageDataLeft.getElement().id?this.imageDataLeft:this.imageDataRight,e.visible=n.visible,!this._didChangeRoi(e,t))return!1;const r=d$e.getToolForElement(t,v$e.FreehandRoi),i=h$e.getImage(t);r.updateCachedStats(i,t,e),this.lastRoiUuid=e.uuid;const a=n.currentStackIndex();return n.setPoints(a,e),this.selectedSide=n,h$e.updateImage(n.getElement(),!0),!0},this.drawHistogram=e=>{const t=[...e.map(e=>({intensity:e.left,type:"Left"})),...e.map(e=>({intensity:e.right,type:"Right"}))];ZLe("#distChart",{width:600,height:180,data:{values:t},mark:"bar",transform:[{bin:!0,field:"intensity",as:"Binned",groupby:["type"]},{aggregate:[{op:"count",field:"Binned",as:"Count"}],groupby:["type","Binned","Binned_end"]},{joinaggregate:[{op:"sum",field:"Count",as:"TotalCount"}],groupby:["type"]},{calculate:"datum.Count/datum.TotalCount",as:"RelativeCount",groupby:["type"]}],encoding:{x:{bin:{binned:!0},field:"Binned",type:"quantitative",axis:{title:"Intensity"}},x2:{field:"Binned_end"},y:{field:"RelativeCount",type:"quantitative",axis:{title:"Percentage"}},color:{field:"type",scale:{range:["#675193","#ca8861"]},legend:{orient:"bottom"}},opacity:{value:.6}}});const n={width:600,height:180,data:{values:e.map(e=>({delta:e.diff}))},mark:"bar",encoding:{x:{field:"delta",bin:!0,axis:{title:"Intensity Difference (Left - Right)"}},y:{aggregate:"count",stack:null,axis:{title:"Pixel Count"}},color:{field:"delta",type:"quantitative",bin:!0,legend:null}}};ZLe("#diffChart",n)},this.uploadFile=(e,t)=>{const n=[];console.log(e);for(let r=0;r<e.length;r++)n.push(e[r]);if(n.length>0){let e;const r=n.map((t,n)=>(0===n&&(e=t.name),"application/x-gzip"===t.type?"nifti:"+URL.createObjectURL(t):f$e.wadouri.fileManager.add(t)));this.loadAndViewImages(e,r,t,!0)}},this.clearTool=e=>{for(const t of[this.imageDataLeft,this.imageDataRight])t.removeData(e,this.lastRoiUuid)&&this.synchronizeRoiPoints(t);this.imageDataLeft.getElement().click()},this.toggleTool=e=>{(this.imageDataLeft.loaded||this.imageDataRight.loaded)&&(this.enabledTool!==e?(this.enabledTool=e,d$e.setToolActive(e,{mouseButtonMask:1}),d$e.setToolActive(this.defaultTool,{mouseButtonMask:4})):(this.enabledTool=this.defaultTool,d$e.setToolPassive(e,{mouseButtonMask:1}),d$e.setToolActive(this.defaultTool,{mouseButtonMask:1}),d$e.setToolActive(v$e.Wwwc,{mouseButtonMask:4})))},this.otherData=e=>e===this.imageDataLeft?this.imageDataRight:this.imageDataLeft,this.loadAndViewImages=(e,t,n,r)=>Zf(this,void 0,void 0,(function*(){n.loaded||(n.loading=!0);const i=(yield Promise.all(t.map(e=>h$e.loadImage(e).catch(e=>{console.log(e)})))).filter(e=>void 0!==e);let a,o;if(console.log(i),t[0].startsWith("nifti:")){o=i[0];const e=i[0].imageId,t=p$e.nifti.ImageId.fromURL(e),r=this.metadataService.getNiftiSummary(e);n.parsingResult={info:r,warnings:[],filteredInfo:r};const s=h$e.metaData.get("multiFrameModule",t.url).numberOfFrames;a={currentImageIdIndex:0,imageIds:Array.from(Array(s),(e,n)=>`nifti:${t.filePath}#${t.slice.dimension}-${n}`)}}else{const e=i.map(e=>({image:e,metadata:this.metadataService.getDicomSummary(e.data)})).sort((e,t)=>e.metadata.instanceId-t.metadata.instanceId);o=e[0].image;const t=e[0].metadata.info;n.parsingResult={info:t,warnings:e[0].image.data.warnings,filteredInfo:t},a={currentImageIdIndex:0,imageIds:e.map(e=>e.image.imageId)}}const s=n.getElement();if(n.loaded=!0,this._setUpTools(s),void 0!==n.layerId?(h$e.removeLayer(s,n.layerId),h$e.removeLayer(s,n.overlayLayerId),d$e.clearToolState(s,"stack")):d$e.addStackStateManager(s,["stack"]),this.allLoaded&&(a.currentImageIdIndex=this.otherData(n).currentStackIndex()),d$e.addToolState(s,"stack",a),n.stackPosition=a.currentImageIdIndex,n.stackSize=a.imageIds.length,n.layerId=h$e.addLayer(s,o,{opacity:1}),r){n.imageId=e;let t=1;for(;this.importedImageIds.has(n.imageId);)n.imageId=e+t++;this.importedImageIds.set(n.imageId,a.imageIds)}console.log(o),n.dynamicImage={imageId:n.getElement().id,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:o.width/2,windowWidth:o.width,getPixelData:this.createGetPixelData(n),rows:o.rows,columns:o.columns,render:h$e.renderGrayscaleImage,height:o.height,width:o.width,color:!1,columnPixelSpacing:o.columnPixelSpacing,rowPixelSpacing:o.rowPixelSpacing,invert:!1,sizeInBytes:o.height*o.width,data:{rawPixels:new Uint8Array(o.height*o.width)}};const l=h$e.colors.getColormap(this.selectedColormap);l.setColor(0,[0,0,0,0]),n.overlayLayerId=h$e.addLayer(s,n.dynamicImage,{opacity:n.opacity,viewport:{colormap:l}}),this.toggleTool(v$e.FreehandRoi),this.toggleTool(v$e.FreehandRoi),this.allLoaded&&(d$e.clearToolState(s,v$e.FreehandRoi),this.otherData(n).getElement().click());for(const{loaded:e,getElement:t}of[this.imageDataLeft,this.imageDataRight])e&&h$e.updateImage(t(),!0);s.addEventListener(d$e.EVENTS.STACK_SCROLL,e=>Zf(this,void 0,void 0,(function*(){const t=e.detail;n.stackPosition=t.newImageIdIndex;const r=this.otherData(n),i=r.loaded?Math.min(Math.max(r.currentStackIndex()+(r.isLeft?1:-1)*this.deltaStackIndex,0),r.stackSize-1):0;if(this.synchronizeStack){if([this.imageDataLeft,this.imageDataRight].every(e=>e.loaded)){let e=0;for(;e<5&&t.newImageIdIndex!==i;)yield new Promise(e=>setTimeout(e,20)),e++;r.stackPosition=n.isLeft?this.imageDataRight.currentStackIndex():this.imageDataLeft.currentStackIndex()}for(const e of[this.imageDataLeft,this.imageDataRight]){if(!e.loaded||e===n&&t.newImageIdIndex!==e.currentStackIndex()||e===r&&i===e.currentStackIndex())return;this.synchronizeRoiPoints(e),h$e.updateImage(e.getElement(),!0)}}else yield new Promise(e=>setTimeout(e,20)),this.synchronizeRoiPoints(n),h$e.updateImage(n.getElement(),!0)}))),setTimeout(()=>{var e;const t=h$e.getLayer(s,n.overlayLayerId).syncProps;t&&(t.originalScale=null===(e=h$e.getLayer(s,n.layerId).syncProps)||void 0===e?void 0:e.originalScale,h$e.updateImage(s))},10),n.loading=!1})),this.synchronizeRoiPoints=e=>{var t,n,r,i;const a=e.getElement(),o=null!==(t=e.currentStackPoints())&&void 0!==t?t:{},s=(null!==(n=d$e.getToolState(a,v$e.FreehandRoi))&&void 0!==n?n:{data:[]}).data;s.length>Object.keys(o).length&&d$e.clearToolState(a,v$e.FreehandRoi);const l=s.reduce((e,t)=>(e.set(t.uuid,t),e),new Map);let u=!1;if(Object.entries(o).map(([t,{points:n}])=>{if(l.has(t)){const r=l.get(t);r.handles.points.forEach((e,t)=>{u=u||e.x!==n[t].x||e.y!==n[t].y,e.x=n[t].x,e.y=n[t].y}),u=u||r.visible!==e.visible,r.visible=e.visible}else u=!0,d$e.addToolState(a,v$e.FreehandRoi,this.cornerstoneService.createRoiData(t,n,e.visible))}),u){const t=e.getElement(),n=d$e.getToolForElement(t,v$e.FreehandRoi),o=h$e.getImage(t);for(const e of null!==(i=null===(r=d$e.getToolState(a,v$e.FreehandRoi))||void 0===r?void 0:r.data)&&void 0!==i?i:[])n.updateCachedStats(o,t,e)}return u},this.createGetPixelData=e=>()=>{const t=e.currentStackPoints(),n=e.getRoiPixels();if(0===n.length)return e.dynamicImage.data.rawPixels;const r=new Uint8Array(e.dynamicImage.height*e.dynamicImage.width),i=this.otherData(e),a=this.cornerstoneService.buildTranslatePoints(i.getElement(),e.getElement(),this.getTranslation),o=this.cornerstoneService.calculateScaleRatio(i.getElement(),e.getElement());for(let s=0;s<n.length;s++){const l=n[s];let u=t[l.uuid].diffData;if(console.log(l.bbox),(null==u?void 0:u.imageId)!==this.imageDataLeft.imageId||!c$e(null==u?void 0:u.points,l.points)){const t=u$e(l.bbox,a);let n,r,s=h$e.getPixels(i.getElement(),t.left,t.top,t.width,t.height),c=l.pixels,d=l.bbox,h=l.points;1!==o&&(s=X$e(s,{h:t.height,w:t.width},{w:l.bbox.width,h:l.bbox.height}).dataSync()),e.isLeft?(n=c,r=s):(r=c,n=s);let f=0;const p=[];let m=Number.MIN_VALUE,g=Number.MAX_VALUE,v=0;for(let i=d.top;i<d.top+d.height;i++)for(let t=d.left;t<d.left+d.width;t++){if(this.cornerstoneService.pointInFreehand2(h,{x:t,y:i},d)){const a=n[f]-r[f];isNaN(a)&&console.log(t,i,f,n[f],r[f],n.length,r.length),m=Math.max(m,a),g=Math.min(g,a),v+=a,p.push({left:n[f],right:r[f],index:i*e.dynamicImage.width+t,diff:a,x:t,y:i})}f++}u={array:p,max:m,min:g,sum:v,points:l.points.map(e=>Object.assign({},e)),imageId:e.imageId},e.currentStackPoints()[l.uuid].diffData=u}console.log("max",u.max,"min",u.min);for(const e of u.array){const t=Math.floor((e.diff-u.min)/(u.max-u.min)*255);r[e.index]=t}}return setTimeout(this.updateVolumeStats,10),r},this.updateVolumeStats=()=>{const e=this.imageDataLeft.getData(this.selectedHistogramRegion,this.lastRoiUuid),t=this.imageDataRight.getData(this.selectedHistogramRegion,this.lastRoiUuid);if(0===e.length&&0===t.length)return;let n,r=null;this.selectedHistogramRegion===eBe.lastRoi?this.selectedSide.isLeft?(n=e.flatMap(e=>e.diffData.array),r="left"):(n=t.flatMap(e=>e.diffData.array),r="right"):n=e.flatMap(e=>e.diffData.array).concat(t.flatMap(e=>e.diffData.array));const i=[...n.reduce((e,t)=>(e.set(`${t.x}_${t.y}`,t),e),new Map).values()];this.drawHistogram(i);const a=i.reduce((e,t)=>(e.sumLeft+=t.left,e.sumRight+=t.right,e.sumDiff+=t.diff,e.minLeft=Math.min(e.minLeft,t.left),e.maxLeft=Math.max(e.maxLeft,t.left),e.minRight=Math.min(e.minRight,t.right),e.maxRight=Math.max(e.maxRight,t.right),e.minDiff=Math.min(e.minDiff,t.diff),e.maxDiff=Math.max(e.maxDiff,t.diff),e),{sumDiff:0,sumLeft:0,sumRight:0,minLeft:Number.MAX_VALUE,maxLeft:Number.MIN_VALUE,minRight:Number.MAX_VALUE,maxRight:Number.MIN_VALUE,minDiff:Number.MAX_VALUE,maxDiff:Number.MIN_VALUE}),o=a.sumDiff/i.length,s=a.sumLeft/i.length,l=a.sumRight/i.length,u=i.reduce((e,t)=>(e.diff+=Math.pow(t.diff-o,2),e.left+=Math.pow(t.left-s,2),e.right+=Math.pow(t.right-l,2),e),{left:0,right:0,diff:0}),c=e=>e.getData(this.selectedHistogramRegion,this.lastRoiUuid).reduce((e,{stats:t})=>(e.sum+=t.mean*t.count,e.count+=t.count,e.varianceSum+=t.variance*t.count,e.area+=t.area,e),{count:0,sum:0,varianceSum:0,area:0}),d=c(this.imageDataLeft),h=c(this.imageDataRight),f=e=>Number.parseFloat(e.toFixed(1));i.length>0&&(this.volumeStats=Object.assign(Object.assign({},a),{count:i.length,max:a.maxDiff,min:a.minDiff,sum:a.sumDiff,mean:f(o),std:f(Math.sqrt(u.diff/i.length)),meanLeft:f(s),stdLeft:f(Math.sqrt(u.left/i.length)),meanRight:f(l),stdRight:f(Math.sqrt(u.right/i.length)),areaLeft:f("right"===r?h.area:d.area),areaRight:f("left"===r?d.area:h.area),meanLeftOwn:f(d.sum/d.count),stdLeftOwn:f(Math.sqrt(d.varianceSum/d.count)),meanRightOwn:f(h.sum/h.count),stdRightOwn:f(Math.sqrt(h.varianceSum/h.count))}))},this._setUpTools=e=>{if(h$e.enable(e),this.allLoaded){const e=new d$e.Synchronizer(h$e.EVENTS.IMAGE_RENDERED,this.cornerstoneService.panZoomSynchronizer(this.imageDataLeft,this.imageDataRight)),t=new d$e.Synchronizer(h$e.EVENTS.IMAGE_RENDERED,(e,t,n,r)=>{if(this.synchronizeStack)return this.cornerstoneService.stackImageIndexSynchronizer(e,t,n,this.imageDataLeft.getElement().id===t.id?this.deltaStackIndex:-this.deltaStackIndex)}),n=new d$e.Synchronizer("click",this.cornerstoneService.freehandRoiSynchronizer({onUpdateCompleted:this._onRoiEdited,didChangeRoi:this._didChangeRoi,getImageVisibility:e=>this.imageDataLeft.getElement()===e?this.imageDataLeft.visible:this.imageDataRight.visible,shouldSynchronize:()=>this.synchronizeRoi&&this.synchronizeStack,getTranslation:this.getTranslation}));for(const r of[this.imageDataLeft,this.imageDataRight]){const i=r.getElement();e.add(i),t.add(i),n.add(i),i.addEventListener("keydown",e=>{var t;if("Escape"===e.key){d$e.getToolForElement(i,v$e.FreehandRoi).cancelDrawing(i);const e=this.otherData(r),n=null===(t=d$e.getToolState(e.getElement(),v$e.FreehandRoi))||void 0===t?void 0:t.data;for(const t of n)void 0===t.area&&d$e.removeToolState(e.getElement(),v$e.FreehandRoi,t);h$e.updateImage(e.getElement()),h$e.updateImage(i)}})}window.synchronizer=e,this.configureTools([{name:v$e.Pan,options:{mouseButtonMask:1,synchronizationContext:e}},{name:v$e.Zoom,options:{mouseButtonMask:2,synchronizationContext:e}},{name:v$e.StackScrollMouseWheel,options:{synchronizationContext:t}},{name:v$e.FreehandRoi,options:{synchronizationContext:n}}])}this.configureTools([{name:v$e.Pan,options:{mouseButtonMask:1}},{name:v$e.Zoom,options:{mouseButtonMask:2}},{name:v$e.Wwwc,options:{mouseButtonMask:4}},{name:v$e.StackScrollMouseWheel,options:{}},{name:v$e.Probe,options:{},active:!1},{name:v$e.FreehandRoi,options:{},active:!1}])},this.configureTools=e=>{var t,n;for(const r of e){const e=b$e(r.name);d$e.addTool(e),(null===(t=r.active)||void 0===t||t)&&d$e.setToolActive(r.name,null!==(n=r.options)&&void 0!==n?n:{})}},this.selectRegisterMethod=e=>{this.registerMethod=e},this.resetStackPosition=()=>{const e=this.imageDataLeft.currentStackIndex();this.imageDataLeft.removeData(eBe.volume,""),this.imageDataRight.removeData(eBe.volume,"");const t=this.imageDataRight.currentStackIndex();this.deltaStackIndex=e-t,this.synchronizeStack=!0},this.registerImages=()=>Zf(this,void 0,void 0,(function*(){const e=this.imageDataRight.currentStackIndex();this.isLoadingRegistration=!0;try{const t=yield this.cornerstoneService.imageRegistration(this.imageDataLeft.getElement(),this.imageDataRight.getElement(),{method:this.registerMethod});if("imageId"in t.data){const n=this.imageDataRight.getElement();d$e.getToolState(n,"stack").data[0].imageIds[e]=t.data.imageId,h$e.updateImage(n,!0)}else if(t.data){const e=t.data;this.imageDataRight.translateOrRotate({x:this.imageDataRight.dx+(e.centerx-e.deltax),y:this.imageDataRight.dy+(e.centery-e.deltay),angle:-180*e.angle/Math.PI})}}catch(t){console.log(t)}finally{this.isLoadingRegistration=!1}})),this.selectMetadata=e=>{this.isLeftSelected=e,this._updateMetadata()},this.selectHistogram=e=>{this.selectedHistogram=e},this.selectHistogramRegion=e=>{this.selectedHistogramRegion=e,this.updateVolumeStats()},this.onSearchInput=e=>{this.metadataFilter=e.toLowerCase(),this._updateMetadata()},this.getTranslation=(e,t)=>{const n={dx:this.imageDataRight.dx,dy:this.imageDataRight.dy},r=this.cornerstoneService.calculateScaleRatio(this.imageDataRight.getElement(),this.imageDataLeft.getElement());return this.imageDataLeft.getElement().id===e.id?(console.log("top"),n.dx=-n.dx,n.dy=-n.dy):(console.log("bottom"),n.dx=n.dx/r,n.dy=n.dy/r),n},this._updateMetadata=()=>{void 0!==this.selectedMetadata&&"info"in this.selectedMetadata&&(this.selectedMetadata.filteredInfo=Object.entries(this.selectedMetadata.info).filter(([e,t])=>e.toLowerCase().includes(this.metadataFilter)||t.toLowerCase().includes(this.metadataFilter)).reduce((e,[t,n])=>(e[t]=n,e),{}),this.noMatchesForFilter=0===Object.keys(this.selectedMetadata.filteredInfo).length)},window.app=this}get allLoaded(){return window.dataL=this.imageDataLeft,window.dataR=this.imageDataRight,this.imageDataLeft.loaded&&this.imageDataRight.loaded}get selectedMetadata(){return this.isLeftSelected?this.imageDataLeft.parsingResult:this.imageDataRight.parsingResult}get canvasElem(){var e;return null===(e=this._canvasCompElem)||void 0===e?void 0:e.nativeElement}}return e.\u0275fac=function(t){return new(t||e)(Co(x$e),Co(w$e))},e.\u0275cmp=pn({type:e,selectors:[["app-root"]],viewQuery:function(e,t){var n;1&e&&(ul(T$e,!0),ul(k$e,!0),ul(C$e,!0)),2&e&&(ll(n=cl())&&(t._dicomImageLeftElem=n.first),ll(n=cl())&&(t._dicomImageRightElem=n.first),ll(n=cl())&&(t._canvasCompElem=n.first))},decls:162,vars:85,consts:[[1,"col",2,"height","100%"],["id","top-section",1,"row",2,"justify-content","center"],[1,"col",2,"width","250px","padding-right","15px","overflow-y","auto","height","100%"],[1,"col",2,"align-items","center"],[1,"row"],[3,"ngClass","click"],[2,"align-self","center","padding","5px 0"],[1,"dropdown"],[1,"dropdown-button",2,"white-space","break-spaces"],[1,"dropdown-content"],[3,"click"],[1,"row",2,"justify-content","space-between"],[1,"col"],["for","selectColormap",1,"small-label"],["name","colormap","id","selectColormap",3,"change"],["selectColormap",""],[3,"value","selected",4,"ngFor","ngForOf"],[1,"col",2,"align-items","center","padding-right","3px"],["for","checkboxRoisSynchronization",1,"small-label"],["type","checkbox","id","checkboxRoiSynchronization",3,"disabled","checked","change"],["checkboxRoiSynchronization",""],["for","registerMethodSelect",1,"small-label"],["name","register-method-select","id","registerMethodSelect","ng-model","registerMethod",3,"change"],["registerMethodSelect",""],[3,"disabled","click"],[1,"col",2,"justify-content","space-between","align-items","center"],["for","checkboxStackSynchronization",1,"small-label"],["type","checkbox","id","checkboxStackSynchronization",3,"checked","change"],["checkboxStackSynchronization",""],["class","select-fieldset",4,"ngIf"],["style","align-self: center;",4,"ngIf"],[1,"row",2,"justify-content","space-between","align-items","flex-end"],["for","layerOpacityLeft",1,"small-label"],["type","checkbox","id","layerVisibilityLeft",3,"checked","change"],["layerVisibilityLeft",""],["id","layerOpacityLeft","type","range","min","0","max","1","step","0.05",3,"value","change"],["layerOpacityLeft",""],["for","layerOpacityRight",1,"small-label"],["type","checkbox","id","layerVisibilityRight",3,"checked","change"],["layerVisibilityRight",""],["id","layerOpacityRight","type","range","min","0","max","1","step","0.05",3,"value","change"],["layerOpacityRight",""],[1,"col",2,"padding-top","3px","padding-bottom","15px"],["id","translate-buttons-row",1,"row"],[1,"small-label",3,"click"],[1,"row",2,"padding-top","2px"],["for","rotationRight",1,"small-label",2,"padding-right","4px","padding-top","2px"],["id","rotationRight","type","range","min","0","max","360","step","0.2",2,"flex","1",3,"value","change"],["rotationRight",""],["oncontextmenu","return false;","unselectable","on","onselectstart","return false;","onmousedown","return false;",1,"disable-selection","noIbar","image-wrapper"],["id","dicomImageLeft","tabindex","0",1,"image-inner"],["dicomImageLeft",""],["appDropFile","",1,"dropZone",3,"onFileDropped"],["hidden","","id","fileInputLeft","type","file","multiple","",3,"change"],["fileInputLeft",""],["class","center",4,"ngIf"],["id","dicomImageRight","tabindex","0",1,"image-inner"],["dicomImageRight",""],["hidden","","id","fileInputRight","type","file","multiple","",3,"change"],["fileInputRight",""],[1,"col",2,"flex","1","overflow","auto"],[1,"row",2,"justify-content","space-between","flex","2",3,"ngClass"],[1,"row",2,"align-items","center"],[2,"padding","0 25px 5px 5px"],[3,"disabled","ngClass","click"],[1,"row-min",2,"align-items","center"],["for","inputSearchMetadata",2,"padding-right","5px"],["type","text","id","inputSearchMetadata",3,"keyup"],["inputSearchMetadata",""],[1,"row",2,"justify-content","flex-end","align-items","center","flex","1"],["style","width:100px;",3,"click",4,"ngIf"],[2,"flex","1","overflow","auto",3,"ngClass"],["id","metadata-table",4,"ngIf"],["class","row","style","justify-content: space-around;align-items: center;height: 100%;",4,"ngIf"],[1,"row",2,"justify-content","space-around","align-items","center","height","100%"],["style","flex: 1;text-align: center;",4,"ngIf"],["style","padding-left: 25px;",4,"ngIf"],[1,"col",2,"padding-right","14px"],["id","distChart",2,"flex","1"],["id","diffChart",2,"flex","1"],[3,"value","selected"],[1,"select-fieldset"],["for","selectImageLeft",1,"small-label"],["name","select-image","id","selectImageLeft",3,"input"],["selectImageLeft",""],["value","IMPORT",3,"selected"],[2,"align-self","center"],["for","selectImageRight",1,"small-label"],["name","select-image","id","selectImageRight",3,"input"],["selectImageRight",""],[1,"center"],[1,"col-min",2,"align-items","center"],[1,"loading-indicator"],[2,"color","black"],[2,"width","100px",3,"click"],["id","metadata-table"],[2,"width","13em"],[4,"ngFor","ngForOf"],["style","padding: 5px 10px;",4,"ngIf"],[2,"padding","5px 10px"],[2,"flex","1","text-align","center"],[2,"padding-left","25px"]],template:function(e,t){if(1&e){const e=No();Ao(0,"div",0),Ao(1,"div",1),Ao(2,"div",2),Ao(3,"h4"),Xo(4,"Region of Interest"),Do(),Ao(5,"div",3),Ao(6,"div",4),Ao(7,"button",5),Ro("click",(function(){return t.toggleTool(t.ToolName.Probe)})),Xo(8," Probe Tool "),Do(),Ao(9,"button",5),Ro("click",(function(){return t.toggleTool(t.ToolName.FreehandRoi)})),Xo(10," ROI Tool "),Do(),Do(),Do(),Ao(11,"div",6),Ao(12,"div",7),Ao(13,"button",8),Xo(14),Do(),Ao(15,"div",9),Ao(16,"button",10),Ro("click",(function(){return t.clearTool(t.HistogramRegion.lastRoi)})),Xo(17,"Selected ROI"),Do(),Ao(18,"button",10),Ro("click",(function(){return t.clearTool(t.HistogramRegion.stackPosition)})),Xo(19,"Stack Position"),Do(),Ao(20,"button",10),Ro("click",(function(){return t.clearTool(t.HistogramRegion.volume)})),Xo(21,"Volume"),Do(),Do(),Do(),Do(),Ao(22,"div",11),Ao(23,"div",12),Ao(24,"label",13),Xo(25,"Roi Colormap"),Do(),Ao(26,"select",14,15),Ro("change",(function(){rr(e);const n=ko(27);return t.changeColormap(n.value)})),To(28,I$e,2,3,"option",16),Do(),Do(),Ao(29,"div",17),Ao(30,"label",18),Xo(31,"Sync Rois"),Do(),Ao(32,"input",19,20),Ro("change",(function(){return t.updateRoiSynchronization()})),Do(),Do(),Do(),Ao(34,"div",12),Ao(35,"h4"),Xo(36,"Stack"),Do(),Ao(37,"div",11),Ao(38,"div",12),Ao(39,"label",21),Xo(40,"Method"),Do(),Ao(41,"select",22,23),Ro("change",(function(){rr(e);const n=ko(42);return t.selectRegisterMethod(n.value)})),To(43,O$e,2,3,"option",16),Do(),Do(),Ao(44,"button",24),Ro("click",(function(){return t.registerImages()})),Xo(45),Do(),Ao(46,"button",24),Ro("click",(function(){return t.resetStackPosition()})),Xo(47," Reset "),Do(),Ao(48,"div",25),Ao(49,"label",26),Xo(50,"Sync Stack"),Do(),Ao(51,"input",27,28),Ro("change",(function(){return t.updateStackSynchronization()})),Do(),Do(),Do(),Do(),Ao(53,"div",12),Ao(54,"h4"),Xo(55,"Left"),Do(),Ao(56,"div",11),To(57,D$e,9,4,"fieldset",29),To(58,M$e,2,2,"div",30),Do(),Ao(59,"div",12),Ao(60,"div",31),Ao(61,"label",32),Xo(62),Do(),Ao(63,"input",33,34),Ro("change",(function(){return t.updateLayerVisibility(t.imageDataLeft)})),Do(),Do(),Ao(65,"input",35,36),Ro("change",(function(){rr(e);const n=ko(66);return t.updateLayerOpacity(n.value,t.imageDataLeft)})),Do(),Do(),Do(),Ao(67,"div",12),Ao(68,"h4"),Xo(69,"Right"),Do(),Ao(70,"div",11),To(71,j$e,9,4,"fieldset",29),To(72,R$e,2,2,"div",30),Do(),Ao(73,"div",12),Ao(74,"div",31),Ao(75,"label",37),Xo(76),Do(),Ao(77,"input",38,39),Ro("change",(function(){return t.updateLayerVisibility(t.imageDataRight)})),Do(),Do(),Ao(79,"input",40,41),Ro("change",(function(){rr(e);const n=ko(80);return t.updateLayerOpacity(n.value,t.imageDataRight)})),Do(),Do(),Ao(81,"div",42),Ao(82,"h4"),Xo(83,"Transform"),Do(),Ao(84,"div",43),Ao(85,"button",44),Ro("click",(function(){return t.imageDataRight.translateOrRotate({x:-1})})),Xo(86,"Left"),Do(),Ao(87,"button",44),Ro("click",(function(){return t.imageDataRight.translateOrRotate({x:1})})),Xo(88,"Right"),Do(),Ao(89,"button",44),Ro("click",(function(){return t.imageDataRight.translateOrRotate({y:-1})})),Xo(90,"Up"),Do(),Ao(91,"button",44),Ro("click",(function(){return t.imageDataRight.translateOrRotate({y:1})})),Xo(92,"Down"),Do(),Do(),Ao(93,"div",45),Ao(94,"label",46),Xo(95,"Angle"),Do(),Ao(96,"input",47,48),Ro("change",(function(){rr(e);const n=ko(97);return t.imageDataRight.translateOrRotate({angle:n.value})})),Do(),Do(),Do(),Do(),Do(),Ao(98,"div",49),Ao(99,"div",50,51),Ao(101,"div",52),Ro("onFileDropped",(function(e){return t.uploadFile(e,t.imageDataLeft)})),Ao(102,"label"),Ao(103,"input",53,54),Ro("change",(function(e){return t.uploadFile(e.target.files,t.imageDataLeft)})),Do(),Xo(105," Select Files "),Do(),Do(),To(106,P$e,5,0,"div",55),Do(),Do(),Ao(107,"div",49),Ao(108,"div",56,57),Ao(110,"div",52),Ro("onFileDropped",(function(e){return t.uploadFile(e,t.imageDataRight)})),Ao(111,"label"),Ao(112,"input",58,59),Ro("change",(function(e){return t.uploadFile(e.target.files,t.imageDataRight)})),Do(),Xo(114," Select Files "),Do(),Do(),To(115,F$e,5,0,"div",55),Do(),Do(),Do(),Ao(116,"div",60),Ao(117,"div",11),Ao(118,"div",61),Ao(119,"div",62),Ao(120,"h2",63),Xo(121,"Metadata"),Do(),Ao(122,"button",64),Ro("click",(function(){return t.selectMetadata(!0)})),Xo(123,"Left"),Do(),Ao(124,"button",64),Ro("click",(function(){return t.selectMetadata(!1)})),Xo(125,"Right"),Do(),Do(),Ao(126,"div",65),Ao(127,"label",66),Xo(128,"Search:"),Do(),Ao(129,"input",67,68),Ro("keyup",(function(){rr(e);const n=ko(130);return t.onSearchInput(n.value)})),Do(),Do(),Do(),Ao(131,"div",61),Ao(132,"div",62),Ao(133,"h2",63),Xo(134,"Comparison"),Do(),Ao(135,"button",64),Ro("click",(function(){return t.selectHistogramRegion(t.HistogramRegion.volume)})),Xo(136,"Volume"),Do(),Ao(137,"button",64),Ro("click",(function(){return t.selectHistogramRegion(t.HistogramRegion.stackPosition)})),Xo(138,"Stack Position"),Do(),Ao(139,"button",64),Ro("click",(function(){return t.selectHistogramRegion(t.HistogramRegion.lastRoi)})),Xo(140,"Selected ROI"),Do(),Do(),Ao(141,"div",62),Ao(142,"button",64),Ro("click",(function(){return t.selectHistogram(t.HistogramType.dist)})),Xo(143,"Distribution"),Do(),Ao(144,"button",64),Ro("click",(function(){return t.selectHistogram(t.HistogramType.diff)})),Xo(145,"Difference"),Do(),Do(),Do(),Ao(146,"div",69),To(147,L$e,2,0,"button",70),To(148,$$e,2,0,"button",70),Do(),Do(),Ao(149,"div",71),To(150,U$e,11,4,"table",72),To(151,H$e,3,0,"div",73),Do(),Ao(152,"div",71),Ao(153,"div",74),To(154,W$e,2,0,"div",75),To(155,V$e,48,12,"div",76),Ao(156,"div",77),Ao(157,"h4"),Xo(158,"Distribution"),Do(),Mo(159,"div",78),Mo(160,"div",79),Do(),Do(),Do(),Do(),Do(),Mo(161,"router-outlet")}2&e&&(Ni(7),Io("ngClass",Gs(58,q$e,t.enabledTool===t.ToolName.Probe)),Ni(2),Io("ngClass",Gs(60,q$e,t.enabledTool===t.ToolName.FreehandRoi)),Ni(5),Ko("Clear  \u25bc"),Ni(14),Io("ngForOf",t.colormaps),Ni(4),Io("disabled",!t.synchronizeStack)("checked",t.synchronizeRoi&&t.synchronizeStack),Ni(11),Io("ngForOf",function(e,t,n){const r=ur()+62,i=tr();return i[r]===Ii?_o(i,r,t()):function(e,t){return e[t]}(i,r)}(0,G$e)),Ni(1),Io("disabled",t.isLoadingRegistration||!t.imageDataLeft.loaded||!t.imageDataRight.loaded),Ni(1),Zo(" ",t.isLoadingRegistration?"Loading":"Register"," "),Ni(1),Io("disabled",!t.imageDataLeft.loaded||!t.imageDataRight.loaded),Ni(5),Io("checked",t.synchronizeStack),Ni(6),Io("ngIf",t.imageDataLeft.loaded||t.importedImageIds.size>1),Ni(1),Io("ngIf",t.imageDataLeft.loaded&&1!==t.imageDataLeft.stackSize),Ni(4),Zo("Opacity: ",t.imageDataLeft.opacity,""),Ni(1),Io("checked",t.imageDataLeft.visible),Ni(2),$o("value",t.imageDataLeft.opacity),Ni(6),Io("ngIf",t.imageDataRight.loaded||t.importedImageIds.size>1),Ni(1),Io("ngIf",t.imageDataRight.loaded&&1!==t.imageDataRight.stackSize),Ni(4),Zo("Opacity: ",t.imageDataRight.opacity,""),Ni(1),Io("checked",t.imageDataRight.visible),Ni(2),$o("value",t.imageDataRight.opacity),Ni(17),$o("value",t.imageDataRight.angle),Ni(5),Wo("display",!1===t.imageDataLeft.loaded&&!1===t.imageDataLeft.loading?void 0:"none"),Ni(5),Io("ngIf",!0===t.imageDataLeft.loading),Ni(4),Wo("display",!1===t.imageDataRight.loaded&&!1===t.imageDataRight.loading?void 0:"none"),Ni(5),Io("ngIf",!0===t.imageDataRight.loading),Ni(3),Io("ngClass",Gs(63,Y$e,t.currentInfoView!==t.InfoView.Metadata)),Ni(4),Io("disabled",!1===t.imageDataLeft.loaded)("ngClass",Gs(65,q$e,!0===t.imageDataLeft.loaded&&t.isLeftSelected)),Ni(2),Io("disabled",!1===t.imageDataRight.loaded)("ngClass",Gs(67,q$e,!0===t.imageDataRight.loaded&&!t.isLeftSelected)),Ni(7),Io("ngClass",Gs(69,Y$e,t.currentInfoView!==t.InfoView.Comparison)),Ni(4),Io("disabled",!1===t.imageDataLeft.loaded||!1===t.imageDataRight.loaded)("ngClass",Gs(71,q$e,t.selectedHistogramRegion===t.HistogramRegion.volume)),Ni(2),Io("disabled",!1===t.imageDataLeft.loaded||!1===t.imageDataRight.loaded)("ngClass",Gs(73,q$e,t.selectedHistogramRegion===t.HistogramRegion.stackPosition)),Ni(2),Io("disabled",!1===t.imageDataLeft.loaded||!1===t.imageDataRight.loaded)("ngClass",Gs(75,q$e,t.selectedHistogramRegion===t.HistogramRegion.lastRoi)),Ni(3),Io("disabled",!1===t.imageDataLeft.loaded||!1===t.imageDataRight.loaded)("ngClass",Gs(77,q$e,t.selectedHistogram===t.HistogramType.dist)),Ni(2),Io("disabled",!1===t.imageDataLeft.loaded||!1===t.imageDataRight.loaded)("ngClass",Gs(79,q$e,t.selectedHistogram===t.HistogramType.diff)),Ni(3),Io("ngIf",t.currentInfoView!==t.InfoView.Comparison),Ni(1),Io("ngIf",t.currentInfoView!==t.InfoView.Metadata),Ni(1),Io("ngClass",Gs(81,Y$e,t.currentInfoView!==t.InfoView.Metadata)),Ni(1),Io("ngIf",void 0!==t.selectedMetadata),Ni(1),Io("ngIf",void 0===t.selectedMetadata),Ni(1),Io("ngClass",Gs(83,Y$e,t.currentInfoView!==t.InfoView.Comparison)),Ni(2),Io("ngIf",void 0===t.volumeStats),Ni(1),Io("ngIf",void 0!==t.volumeStats),Ni(1),Wo("display",void 0!==t.volumeStats?void 0:"none"),Ni(3),Wo("display",t.selectedHistogram===t.HistogramType.dist?void 0:"none"),Ni(1),Wo("display",t.selectedHistogram===t.HistogramType.diff?void 0:"none"))},directives:[Du,Nu,Ru,E$e,Af],pipes:[Lu],styles:["@keyframes spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.loading-indicator[_ngcontent-%COMP%]{border:8px solid #eee;border-top-color:#9b9b9b;border-radius:50%;width:50px;height:50px;animation:spin 1.5s linear infinite}.dropZone[_ngcontent-%COMP%]{flex:1;display:flex;width:100%;height:100%;align-items:center;justify-content:center}.dropZone[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#000;padding:12px;border-radius:8px;background-color:#fff;cursor:pointer;box-shadow:2px 2px #888181}#metadata-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}#metadata-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{font-weight:700;font-size:larger;padding:0 5px}#metadata-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid #e6e6e6}#metadata-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:2px 5px}#top-section[_ngcontent-%COMP%]{height:460px}.image-wrapper[_ngcontent-%COMP%]{width:460px;height:460px;position:relative;color:#fff;display:inline-block;border-style:solid;border-color:#000}.image-inner[_ngcontent-%COMP%]{width:460px;height:460px;top:0;left:0;position:absolute;outline:none}.small-label[_ngcontent-%COMP%]{font-size:.8em}#top-menu[_ngcontent-%COMP%]{padding:3px 0;justify-content:space-between;width:1050px;align-self:center}#top-menu[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-height:20px;margin-top:1px}#top-menu[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]{width:95px}#canvasComp[_ngcontent-%COMP%]{height:250px;width:250px}.select-fieldset[_ngcontent-%COMP%]{padding:0 0 3px;margin:0;border:0;display:flex;flex-direction:column}.select-fieldset[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:145px}#translate-buttons-row[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1}.dropdown-button[_ngcontent-%COMP%]{min-width:110px;border-radius:0}.dropdown[_ngcontent-%COMP%]{position:relative;display:inline-block}.dropdown-content[_ngcontent-%COMP%]{display:none;position:absolute;background-color:#f9f9f9;width:100%;box-shadow:0 8px 16px 0 rgba(0,0,0,.2);z-index:1}.dropdown-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;border-radius:0}.dropdown[_ngcontent-%COMP%]:hover   .dropdown-content[_ngcontent-%COMP%]{display:block}.dropdown[_ngcontent-%COMP%]:hover   .dropdown-button[_ngcontent-%COMP%]{background-color:#eee}\n.cornerstone-enabled-image[_ngcontent-%COMP%]{-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;cursor:default}",'[_nghost-%COMP%] {\n    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";\n    font-size: 14px;\n    color: #333;\n    box-sizing: border-box;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n  }']}),e})(),nBe=(()=>{class e{}return e.\u0275mod=yn({type:e,bootstrap:[tBe]}),e.\u0275inj=ft({factory:function(t){return new(t||e)},providers:[],imports:[[vc,Kf]]}),e})();(function(){if(pi)throw new Error("Cannot enable prod mode after platform setup.");fi=!1})(),mc().bootstrapModule(nBe).catch(e=>console.error(e))},zn8P:function(e,t){function n(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="zn8P"},zv5s:function(e,t,n){const r=n("ex/Z");e.exports=(e,t)=>{try{return new r(e,t).range||"*"}catch(n){return null}}}},[[0,0]]]);